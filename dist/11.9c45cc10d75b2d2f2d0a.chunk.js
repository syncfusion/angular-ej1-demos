webpackJsonp([11],{1036:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
*  filename: ej.diagram.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.diagram.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(t){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(4),__webpack_require__(94),__webpack_require__(21),__webpack_require__(65),__webpack_require__(38),__webpack_require__(16),__webpack_require__(48)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=t)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(function(){var LoadingPriority,RoutingPriority,SegmentOrientation,ObstacleSideType,PortDirection,Orientation,ScanDirection,RoutingSolution,Directions;(function($,ej,undefined){"use strict";ej.widget("ejDiagram","ej.datavisualization.Diagram",{element:null,model:null,_requiresID:!0,validTags:["div"],defaults:{width:"",height:"",nodes:[],connectors:[],labelRenderingMode:"html",defaultSettings:{connector:null,node:null,group:null},nodeTemplate:null,connectorTemplate:null,dataSourceSettings:{dataSource:null,query:null,tableName:null,id:"",parent:"",nodes:null,connectors:null,root:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[],connectionDataSource:{dataSource:null,id:"",sourceNode:"",targetNode:"",sourcePointX:"",sourcePointY:"",targetPointX:"",targetPointY:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[]}},serializationSettings:{preventDefaultValues:!1},rulerSettings:{showRulers:!1,horizontalRuler:{interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25},verticalRuler:{interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25}},snapSettings:{horizontalGridLines:{linesInterval:null,snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},verticalGridLines:{linesInterval:null,snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},snapConstraints:15,enableSnapToObject:!0,snapAngle:5,snapObjectDistance:5},scrollSettings:{horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,minZoom:.25,maxZoom:30,zoomFactor:.2,padding:{left:0,right:0,top:0,bottom:0}},pageSettings:{pageWidth:null,pageHeight:null,multiplePage:!1,pageBorderWidth:0,pageBackgroundColor:"#ffffff",pageBorderColor:"#565656",pageMargin:24,showPageBreak:!1,pageOrientation:"portrait",scrollLimit:"diagram",scrollableArea:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},autoScrollBorder:{left:15,top:15,right:15,bottom:15},boundaryConstraints:"infinity"},locale:"en-US",contextMenu:{items:[],showCustomMenuItemsOnly:!1},enableContextMenu:!0,enableAutoScroll:!0,tooltip:{templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5}},showTooltip:!0,layout:{avoidSegmentOverlapping:!1,bounds:null,type:"none",horizontalAlignment:"center",verticalAlignment:"top",orientation:"toptobottom",horizontalSpacing:30,verticalSpacing:30,margin:{left:0,right:0,top:0,bottom:0},marginX:0,marginY:0,fixedNode:"",getLayoutInfo:null,getConnectorSegments:null,root:"",springLength:100,springFactor:.442,maxIteration:1e3},drawingTools:{},backgroundImage:{source:"",scale:"meet",alignment:"xmidymid"},backgroundColor:"transparent",bridgeDirection:"top",version:"13.1",constraints:502,tool:null,drawType:{},selectedItems:{offsetX:0,offsetY:0,width:0,height:0,rotateAngle:0,children:[],constraints:30,userHandles:[],tooltip:{templateId:"",alignment:{horizontal:"center",vertical:"bottom"},margin:{top:10}},getConstraints:null},commandManager:{commands:{}},historyManager:{push:null,pop:null,canPop:null,canLog:null,undo:null,redo:null,startGroupAction:null,closeGroupAction:null,stackLimit:null,undoStack:[],redoStack:[]},layers:[],connectorType:"straightLine",editorFocusChange:null,nodeCollectionChange:null,templateNodeRendering:null,historyChange:null,autoScrollChange:null,itemClick:null,connectorCollectionChange:null,selectionChange:null,mouseLeave:null,mouseEnter:null,mouseOver:null,click:null,doubleClick:null,dragEnter:null,dragOver:null,dragLeave:null,drop:null,drag:null,textChange:null,sizeChange:null,connectionChange:null,rotationChange:null,contextMenuClick:null,contextMenuBeforeOpen:null,contextMenuClose:null,connectorSourceChange:null,connectorTargetChange:null,scrollChange:null,segmentChange:null,propertyChange:null,groupChange:null,create:null,destroy:null},observables:["nodes","connectors","locale","enableContextMenu","backgroundColor","backgroundImage","enableAutoScroll","showTooltip","bridgeDirection","tool","pageSettings.pageHeight","pageSettings.pageWidth","pageSettings.multiplePage","pageSettings.pageBorderWidth","pageSettings.pageBackgroundColor","pageSettings.pageBorderColor","pageSettings.pageMargin","pageSettings.showPageBreak","pageSettings.pageOrientation","pageSettings.scrollLimit","snapSettings.enableSnapToObject","snapSettings.snapAngle","snapSettings.snapObjectDistance","snapSettings.snapConstraints","dataSourceSettings.id","dataSourceSettings.parent","dataSourceSettings.root","dataSourceSettings.dataSource","dataSourceSettings.tableName","dataSourceSettings.query","layout.type","layout.orientation","layout.horizontalSpacing","layout.avoidSegmentOverlapping ","layout.verticalSpacing","layout.marginX","layout.marginY","layout.fixedNode","selectedItems.offsetX","selectedItems.offsetY","selectedItems.width","selectedItems.height","selectedItems.rotateAngle","scrollSettings.horizontalOffset","scrollSettings.verticalOffset","scrollSettings.zoomFactor","tooltip.templateId","tooltip.relativeMode","tooltip.alignment.horizontal","tooltip.alignment.vertical","contextMenu.items","contextMenu.showCustomMenuItemsOnly"],nodes:ej.util.valueFunction("nodes"),connectors:ej.util.valueFunction("connectors"),locale:ej.util.valueFunction("locale"),enableContextMenu:ej.util.valueFunction("enableContextMenu"),enableAutoScroll:ej.util.valueFunction("enableAutoScroll"),showTooltip:ej.util.valueFunction("showTooltip"),bridgeDirection:ej.util.valueFunction("bridgeDirection"),tool:ej.util.valueFunction("tool"),_backgroundColor:ej.util.valueFunction("backgroundColor"),_backgroundImage:ej.util.valueFunction("backgroundImage"),_pageHeight:ej.util.valueFunction("pageSettings.pageHeight"),_pageWidth:ej.util.valueFunction("pageSettings.pageWidth"),_multiplePage:ej.util.valueFunction("pageSettings.multiplePage"),_pageBorderWidth:ej.util.valueFunction("pageSettings.pageBorderWidth"),_pageBackgroundColor:ej.util.valueFunction("pageSettings.pageBackgroundColor"),_pageBorderColor:ej.util.valueFunction("pageSettings.pageBorderColor"),_pageMargin:ej.util.valueFunction("pageSettings.pageMargin"),_showPageBreak:ej.util.valueFunction("pageSettings.showPageBreak"),_pageOrientation:ej.util.valueFunction("pageSettings.pageOrientation"),_scrollLimit:ej.util.valueFunction("pageSettings.scrollLimit"),_enableSnapToObject:ej.util.valueFunction("snapSettings.enableSnapToObject"),_snapConstraints:ej.util.valueFunction("snapSettings.snapConstraints"),_snapAngle:ej.util.valueFunction("snapSettings.snapAngle"),_snapObjectDistance:ej.util.valueFunction("snapSettings.snapObjectDistance"),_selectorOffsetX:ej.util.valueFunction("selectedItems.offsetX"),_selectorOffsetY:ej.util.valueFunction("selectedItems.offsetY"),_selectorWidth:ej.util.valueFunction("selectedItems.width"),_selectorHeight:ej.util.valueFunction("selectedItems.height"),_selectorRotateAngle:ej.util.valueFunction("selectedItems.rotateAngle"),_horizontalOffset:ej.util.valueFunction("scrollSettings.horizontalOffset"),_verticalOffset:ej.util.valueFunction("scrollSettings.verticalOffset"),zoomFactor:ej.util.valueFunction("scrollSettings.zoomFactor"),_layoutType:ej.util.valueFunction("layout.type"),_layoutOrientation:ej.util.valueFunction("layout.orientation"),_horizontalSpacing:ej.util.valueFunction("layout.horizontalSpacing"),_avoidSegmentOverlapping:ej.util.valueFunction("layout.avoidSegmentOverlapping "),_verticalSpacing:ej.util.valueFunction("layout.verticalSpacing"),_layoutMarginX:ej.util.valueFunction("layout.marginX"),_layoutMarginY:ej.util.valueFunction("layout.marginY"),_fixedNode:ej.util.valueFunction("layout.fixedNode"),_dataSourceUniqueId:ej.util.valueFunction("dataSourceSettings.id"),_dataSourceParentId:ej.util.valueFunction("dataSourceSettings.parent"),_dataSource:ej.util.valueFunction("dataSourceSettings.dataSource"),_dataSourceTableName:ej.util.valueFunction("dataSourceSettings.tableName"),_dataSourceQueryString:ej.util.valueFunction("dataSourceSettings.query"),_dataSourceRoot:ej.util.valueFunction("dataSourceSettings.root"),_tooltipTemplateId:ej.util.valueFunction("tooltip.templateId"),_horizontalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.horizontal"),_verticalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.vertical"),_tooltipMode:ej.util.valueFunction("tooltip.relativeMode"),_showCustomContextMenuItems:ej.util.valueFunction("contextMenu.showCustomMenuItemsOnly"),_contextMenuItems:ej.util.valueFunction("contextMenu.items"),dataTypes:{nodes:"data",connectors:"data",contextMenu:{items:"array"},dataSourceSettings:{dataSource:"data"},defaultSettings:{connector:{segments:"data",labels:"data"},node:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"},group:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"}},snapSettings:{horizontalGridLines:{linesInterval:"data",snapInterval:"data"},verticalGridLines:{linesInterval:"data",snapInterval:"data"}},selectedItems:{children:"data",userHandles:"data"}},_doubleClickEvent:!1,_nodes:[],_connectors:[],_canvas:null,_svg:null,_toolToActivate:null,_inAction:!1,_isPinching:!1,_isEditing:!1,_nodeToHit:null,_enableAPIMethods:!0,_currentCursor:null,_pasteIndex:null,_page:null,_view:null,_currentLabel:null,_zOrder:0,_clipboardData:null,_currZoom:1,_UndoRedo:!1,_mouseEventTriggered:!1,_selectedItem:"",_historyList:{currentEntry:{next:null,previous:null},canUndo:!1,canRedo:!1},_historyCount:0,_lastbefore:null,_defaultContextMenuItems:[{name:"cut",text:"Cut"},{name:"copy",text:"Copy"},{name:"paste",text:"Paste"},{name:"undo",text:"Undo"},{name:"redo",text:"Redo"},{name:"selectAll",text:"Select All"},{name:"grouping",text:"Grouping",subItems:[{name:"group",text:"Group"},{name:"ungroup",text:"Ungroup"}]},{name:"order",text:"Order",subItems:[{name:"bringToFront",text:"Bring To Front"},{name:"moveForward",text:"Move Forward"},{name:"sendToBack",text:"Send To Back"},{name:"sendBackward",text:"Send Backward"}]}],_hScrollOffset:0,_vScrollOffset:0,_hScrollbar:null,_vScrollbar:null,_scrollPixel:30,_previousSelectedItems:[],_eventCause:{},_crudDeleteNodes:[],_isMobile:!1,_labelHashTable:{},activeTool:null,selectionList:[],tools:null,nameTable:{},boundaryTable:{},_init:function(){var t,e,i,a;this.boundaryTable={},this.nameTable={},this.selectionList=[],this._isInit=!0,this.nameTable={},this.boundaryTable={},!!window.SVGSVGElement&&("NewVersion"===this.model.version&&(this.model.version=ej.version),this.model.height||(this.model.height="18px"),ej.widget.unobtrusive!==undefined&&(this.model.snapSettings.horizontalGridLines&&this.model.snapSettings.horizontalGridLines.linesInterval&&"string"==typeof this.model.snapSettings.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=JSON.parse(this.model.snapSettings.horizontalGridLines.linesInterval)),this.model.snapSettings.verticalGridLines&&this.model.snapSettings.verticalGridLines.linesInterval&&"string"==typeof this.model.snapSettings.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=JSON.parse(this.model.snapSettings.verticalGridLines.linesInterval)),this.model.defaultSettings.connector&&(t=ej.datavisualization.Diagram.Connector({}),this.model.defaultSettings.connector=this._equivalentPropMap(t,this.model.defaultSettings.connector)),this.model.defaultSettings.node&&(e=ej.datavisualization.Diagram.Node({}),this.model.defaultSettings.node=this._equivalentPropMap(e,this.model.defaultSettings.node))),this.model.snapSettings.horizontalGridLines&&null==this.model.snapSettings.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75]),this.model.snapSettings.verticalGridLines&&null==this.model.snapSettings.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75]),(i=this).model.dataSourceSettings.crudAction.read&&($.ajax({type:"GET",url:i.model.dataSourceSettings.crudAction.read,async:!1,success:function(t){i.model.dataSourceSettings.dataSource=t},error:function(){}}),this._isWebAPI=!0),i.model.dataSourceSettings.connectionDataSource.crudAction.read&&($.ajax({type:"GET",url:i.model.dataSourceSettings.connectionDataSource.crudAction.read,async:!1,success:function(t){i.model.dataSourceSettings.connectionDataSource.dataSource=t},error:function(){}}),this._isWebAPI=!0),this.model.backgroundImage&&("string"==typeof this.model.backgroundImage&&(a=this.model.backgroundImage),"function"==typeof this.model.backgroundImage&&(a=this.model.backgroundImage()),a&&(this.model.backgroundImage=ej.datavisualization.Diagram.BackgroundImage({source:a}))),this._layoutMarginX()&&(this.model.layout.margin.left=this.model.layout.margin.right=this._layoutMarginX()),this._layoutMarginY()&&(this.model.layout.margin.top=this.model.layout.margin.bottom=this._layoutMarginY()),this._cloneGlobalVariables(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this),this._initDefaults(),this._initViews(),this._initLineRouting(),this._initData(),this._initCanvas(),this._initDiagramTool(),this._initVisualGuide(),this._wireEvents(),this._initHandles(),this._initContextMenu(),this._drawingTool=!1,this._isDropped=!1,this._initCommands(),this._initHistoryManager(),this.model.zoomFactor&&.2!==this.model.zoomFactor&&(this.model.scrollSettings.zoomFactor=this.model.zoomFactor),this._updateScrollSettings(this.model.scrollSettings),delete this._viewPort,this._cloneModel=$.extend(!0,{},this.model)),delete this._isInit},_initLineRouting:function(){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&(this.lineRouting=new LineRouting,this.lineRouting.firstLoad=!0,this.lineRouting.Init(this.model),this.lineRouting.SetLineRoutingSettings())},_resetConnectorPoints:function(t,e){var i,a,n,o,s,r,l;if(t._undoSegments||t._redoSegments)l=t._undoSegments?t._undoSegments:t._redoSegments,this.updateConnector(t.name,{segments:l});else if(t._points&&t._points.size()>0){for(r=e.nameTable[t.name],this._isUndo||"move"!=this.activeTool.name&&"resize"!==this.activeTool.name&&"rotatetool"!==this.activateTool.name||(this.tools[this.activeTool.name].undoObject.connectors[r.name]={name:r.name,segments:r.segments}),r.segments=[],r.sourcePoint=t._points.get(0),r.targetPoint=t._points.get(t._points.size()-1),r._sourcePortLocation=$.extend(!0,{},t._points.get(0)),r._targetPortLocation=$.extend(!0,{},t._points.get(t._points.size()-1)),[],l=[],i=0;i<t._points.size()-1;i++){if(a=t._points.get(i),n=t._points.get(i+1),a.x==n.x&&a.y==n.y){if(t._points.RemoveAt(i+1),i+1==t._points.size())break;n=t._points.get(i+1)}o=Point.findLength(a,n),s=ej.datavisualization.Diagram.Util._getBezierDirection(a,n),l.push({length:o,direction:s,type:"orthogonal"})}this.updateConnector(r.name,{segments:l}),this._isUndo||"move"!=this.activeTool.name&&"resize"!==this.activeTool.name&&"rotate"!==this.activateTool.name||(this.tools[this.activeTool.name]._redoConnectors[r.name]={name:r.name,segments:r.segments}),delete r._sourcePortLocation,delete r._targetPortLocation}else(r=e.nameTable[t.name]).segments=[],l=[{type:"orthogonal"}],this.updateConnector(r.name,{segments:l})},_equivalentPropMap:function(t,e){var i,a={};for(var n in t)i=n.toLowerCase(),ej.isPlainObject(e[i])||ej.isPlainObject(e[n])?a[n]=this._equivalentPropMap(t[n],e[i]?e[i]:e[n]):(e[i]||e[n])&&(a[n]=e[i]?e[i]:e[n]);return a},getDiagramBounds:function(){var t=this._getDigramBounds();return t.width=t.width>this.model.scrollSettings.viewPortWidth?t.width+(t.x>0?t.x:0):this.model.scrollSettings.viewPortWidth,t.height=t.height>this.model.scrollSettings.viewPortHeight?t.height+(t.y>0?t.y:0):this.model.scrollSettings.viewPortHeight,t.x=t.x>0?0:t.x,t.y=t.y>0?0:t.y,t},getDiagramContent:function(t){var e,i,a,n,o,s,r={};r={top:isNaN(r.top)?0:r.top,bottom:isNaN(r.bottom)?0:r.bottom,left:isNaN(r.left)?0:r.left,right:isNaN(r.right)?0:r.right};var l,d,h=this._currZoom,g=this._hScrollOffset,c=this._vScrollOffset,u=this.model.width,m=this.model.height,p=this.getDiagramBounds();for(this._hScrollbar&&this._hScrollbar._scrollData&&this._hScrollbar.model.minimum/h,this._vScrollbar&&this._vScrollbar._scrollData&&this._vScrollbar.model.minimum/h,this._preventZoomEvent=!0,1!==this._currZoom&&((s=new ej.datavisualization.Diagram.Zoom).zoomFactor=1/h-1,this.zoomTo(s)),e={},p.x!==this._hScrollOffset/h&&(e.horizontalOffset=p.x),p.y!==this._vScrollOffset/h&&(e.verticalOffset=p.y),Object.keys(e).length>0&&this.update({scrollSettings:e}),$("#"+this.element[0].id).ejDiagram({width:p.width+"px",height:p.height+"px"}),l=this._hScrollbar.element[0].style.visibility,this._hScrollbar.element[0].style.visibility="hidden",d=this._vScrollbar.element[0].style.visibility,this._vScrollbar.element[0].style.visibility="hidden",(i=this.model.snapSettings.snapConstraints&ej.datavisualization.Diagram.SnapConstraints.ShowLines)&&$("#"+this.element[0].id).ejDiagram({snapSettings:{snapConstraints:this.model.snapSettings.snapConstraints&~ej.datavisualization.Diagram.SnapConstraints.ShowLines}}),this._clearSelection(!0),t=t||document.styleSheets,a="",n=0;n<t.length;n++)(t[n].href||"string"==typeof t[n])&&(a+='<link href="'+(t[n].href||t[n])+'" rel="stylesheet" />');return o=$(this.element).html(),o=(o=a+"<body style='margin:0px;padding:0px'><div style=\""+("margin-left:"+r.left+"px;margin-top:"+r.top+"px;margin-right:"+r.right+"px;margin-bottom:"+r.bottom+"px;")+'">'+o+"</div></body>").replace(/ transform: t/g," -webkit-transform: t"),$("#"+this.element[0].id).ejDiagram({width:u,height:m}),h&&((s=new ej.datavisualization.Diagram.Zoom).zoomFactor=h/this._currZoom-1,this.zoomTo(s)),this.update({scrollSettings:{horizontalOffset:g,verticalOffset:c}}),delete this._preventZoomEvent,this._hScrollbar&&(this._hScrollbar.element[0].style.visibility=l),this._vScrollbar&&(this._vScrollbar.element[0].style.visibility=d),i&&$("#"+this.element[0].id).ejDiagram({snapSettings:{snapConstraints:this.model.snapSettings.snapConstraints|ej.datavisualization.Diagram.SnapConstraints.ShowLines}}),o},refresh:function(){var t,e;if(this._updateTableNodes(),this._updateGroupChildren(this.model),this._isSwimlaneExist){for(t=this.connectors(),e=0;e<t.length;e++)t[e].zOrder=-1;delete this._isSwimlaneExist}this._updateScrollOffset(0,0),this._destroy(),this.element.addClass("e-datavisualization-diagram"),this._currZoom=1,this._hScrollbar=null,this._vScrollbar=null,this._view=null,this._svg=null,this._page=null,this._pageBackgroundLayer=null,this._diagramLayer=null,this._htmlLayer=null,this.clearHistory(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this),this.model.dataSourceSettings&&this.model.dataSourceSettings.dataSource&&(this.nodes([]),this.connectors([]),this._nodes=[],this._connectors=[]),this._init()},_initCommands:function(t){var e,i,a,n,o=ej.datavisualization.Diagram.KeyModifiers,s=ej.datavisualization.Diagram.Keys;if(t)e=this.model.commandManager.commands;else for(i in t=this.model.commandManager.commands,e={copy:{gesture:{key:s.C,keyModifiers:o.Control},_isDefault:!0},paste:{gesture:{key:s.V,keyModifiers:o.Control},_isDefault:!0},cut:{gesture:{key:s.X,keyModifiers:o.Control},_isDefault:!0},delete:{gesture:{key:s.Delete},_isDefault:!0},undo:{gesture:{key:s.Z,keyModifiers:o.Control},_isDefault:!0},redo:{gesture:{key:s.Y,keyModifiers:o.Control},_isDefault:!0},selectAll:{gesture:{key:s.A,keyModifiers:o.Control},_isDefault:!0},nudgeUp:{parameter:"up",gesture:{key:s.Up},_isDefault:!0},nudgeRight:{parameter:"right",gesture:{key:s.Right},_isDefault:!0},nudgeDown:{parameter:"down",gesture:{key:s.Down},_isDefault:!0},nudgeLeft:{parameter:"left",gesture:{key:s.Left},_isDefault:!0},startEdit:{gesture:{key:113},_isDefault:!0},endEdit:{gesture:{key:s.Escape},_isDefault:!0},focusToNextItem:{gesture:{key:s.Tab},_isDefault:!0},focusToPreviousItem:{gesture:{key:s.Tab,keyModifiers:o.Control},_isDefault:!0},selectFocusedItem:{gesture:{key:s.Enter},_isDefault:!0}})this._initCommandValues(i,e[i]);for(a in t)e[a]?t[a]?(t[a]&&e[a].gesture&&t[a].gesture&&(this._isLoad||e[a]._isDefault&&delete e[a]._isDefault,t[a].gesture=ej.datavisualization.Diagram.Gesture($.extend({},!0,e[a].gesture,t[a].gesture)),this._tempCommandManager&&this._tempCommandManager.commands&&this._tempCommandManager.commands[a]._isDefault&&this._initCommandValues(a,t[a])),$.extend(e[a],!0,t[a])):e[a]=null:t[a]&&(n=ej.datavisualization.Diagram.Command(t[a]),e[a]=n);this.model.commandManager.commands=e},_initCommandValues:function(t,e){switch(t){case"copy":e.execute=$.proxy(this.copy,this),e.canExecute=$.proxy(this._canExecute,this);break;case"paste":e.execute=$.proxy(this._commandPaste,this),e.canExecute=$.proxy(this._canExecute,this);break;case"cut":e.execute=$.proxy(this.cut,this),e.canExecute=$.proxy(this._canExecute,this);break;case"delete":e.execute=$.proxy(this.remove,this),e.canExecute=$.proxy(this._canExecute,this);break;case"undo":e.execute=$.proxy(this.undo,this),e.canExecute=$.proxy(this._canExecute,this);break;case"redo":e.execute=$.proxy(this.redo,this),e.canExecute=$.proxy(this._canExecute,this);break;case"selectAll":e.execute=$.proxy(this._selectCommand,this),e.canExecute=$.proxy(this._canExecute,this);break;case"nudgeUp":case"nudgeRight":case"nudgeDown":case"nudgeLeft":e.execute=$.proxy(this._nudgeCommand,this),e.canExecute=$.proxy(this._canExecute,this);break;case"startEdit":e.execute=$.proxy(this._startEditCommand,this),e.canExecute=$.proxy(this._canExecute,this);break;case"endEdit":e.execute=$.proxy(this._endEdit,this),e.canExecute=$.proxy(this._canExecute,this);break;case"focusToNextItem":case"focusToPreviousItem":e.execute=$.proxy(this._focusToItem,this),e.canExecute=$.proxy(this._canExecute,this);break;case"selectFocusedItem":e.execute=$.proxy(this._selectFocusedItem,this),e.canExecute=$.proxy(this._canExecute,this)}},_initViews:function(t){t||(this._views=[],this._views.push(this._id)),this._views[this._id]={type:"mainview",context:ej.datavisualization.Diagram.SvgContext,style:"position:relative; height:"+this.model.height+"; width:"+this.model.width+";"}},_initDefaults:function(){this.tool()||(ej.isMobile()?(this.tool(ej.datavisualization.Diagram.Tool.ZoomPan),this._isMobile=!0):this.tool(ej.datavisualization.Diagram.Tool.SingleSelect|ej.datavisualization.Diagram.Tool.MultipleSelect)),this._initTools()},_initCanvas:function(t){this._renderCanvas(t)},_initVisualGuide:function(){this.model.tooltip&&(this.model.tooltip=ej.datavisualization.Diagram.Tooltip(this.model.tooltip)),this.model.selectedItems&&(this.model.selectorConstraints&&(this.model.selectedItems.constraints=this.model.selectorConstraints),this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Util.canEnableTooltip(this)&&this.showTooltip()?this.model.selectedItems.tooltip?ej.datavisualization.Diagram.Tooltip(this.model.selectedItems.tooltip):ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null,this.model.selectedItems.tooltip&&this.model.tooltipTemplateId&&(this.model.selectedItems.tooltip.templateId=this.model.selectedItems.tooltip.templateId||this.model.tooltipTemplateId))},_initTools:function(){this.tools={select:new ej.datavisualization.Diagram.SelectTool(this),move:new ej.datavisualization.Diagram.MoveTool(this),resize:new ej.datavisualization.Diagram.ResizeTool(this),rotate:new ej.datavisualization.Diagram.RotateTool(this),endPoint:new ej.datavisualization.Diagram.ConnectionEditTool(this),panTool:new ej.datavisualization.Diagram.PanTool(this),portTool:new ej.datavisualization.Diagram.PortTool(this),straightLine:new ej.datavisualization.Diagram.StraightLineTool(this),orthogonalLine:new ej.datavisualization.Diagram.OrthogonalLineTool(this),bezierLine:new ej.datavisualization.Diagram.BezierLineTool(this),phase:new ej.datavisualization.Diagram.PhaseTool(this),shapeTool:new ej.datavisualization.Diagram.ShapeTool(this),text:new ej.datavisualization.Diagram.TextTool(this),labelMove:new ej.datavisualization.Diagram.LabelMoveTool(this),labelResize:new ej.datavisualization.Diagram.LabelResizeTool(this),labelRotate:new ej.datavisualization.Diagram.LabelRotateTool(this)},this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate],this._registerDrawingTools()},_initDiagramTool:function(){var t,e=this.tool();e&ej.datavisualization.Diagram.Tool.ContinuesDraw?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!1)):e&ej.datavisualization.Diagram.Tool.DrawOnce?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!0)):e&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):e&ej.datavisualization.Diagram.Tool.MultipleSelect&&(this.activateTool("select"),this.activeTool.singleAction=!1)},_initHandles:function(){var t,e=this.model.selectedItems.userHandles;if(e)for(t=0;t<e.length;t++)e[t]=ej.datavisualization.Diagram.UserHandle(e[t]),e[t].tool&&(e[t].tool.diagram=this,this.tools[e[t].name]=e[t].tool)},_initHistoryManager:function(){this.model.historyManager.push=$.proxy(this.addHistoryEntry,this),this.model.historyManager.pop=$.proxy(this.removeHistoryEntry,this),this.model.historyManager.canPop=$.proxy(this.canRemoveHistoryEntry,this),this.model.historyManager.startGroupAction=$.proxy(this._startGroupAction,this),this.model.historyManager.closeGroupAction=$.proxy(this._closeGroupAction,this)},_cloneGlobalVariables:function(){this._historyList=$.extend(!0,{},this._historyList)},_setNodesConnectors:function(t,e){var i,a=[],n=!1,o=!1,s=t.nodes?"function"==typeof t.nodes?t.nodes().length:t.nodes.length:0,r=t.connectors?t.connectors&&"function"==typeof t.connectors?t.connectors().length:t.connectors.length:0;if(t.nodes&&s!=this._nodes.length){for(i=0;i<this.nodes().length;i++)this._removeElementFromCollection(this.nameTable[this.nodes()[i].name]);this._isPreventModelChange=!0,this.nodes("function"==typeof t.nodes?t.nodes():t.nodes),this._isPreventModelChange=!1,this._initNodeCollection(e),n=!0}if(t.connectors&&r!=this._connectors.length){for(i=0;i<this.connectors().length;i++)this._removeElementFromCollection(this.nameTable[this.connectors()[i].name]);this._isPreventModelChange=!0,this.connectors("function"==typeof t.connectors?t.connectors():t.connectors),this._isPreventModelChange=!1,this._initConnectorCollection(),o=!0}return((a=(a=this.nodes()).length>0?this.nodes().concat(this.connectors()):this.connectors()).length>0||0==t.nodes.length||0==t.connectors.length)&&this._resetObjectCollection(a,e,n,o),!0},_removeElementFromCollection:function(t){if(t){if(t.children)for(var e=0;e<t.children.length;e++)this._removeElementFromCollection(this.nameTable[this._getChild(t.children[e])]);t.segments?this._removeEdges(t):(this._disConnect(t,{}),t.inEdges=t.outEdges=[]),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t),this._removeElement(t),delete this.nameTable[t.name]}},_updateCloneModel:function(t){t&&(this._cloneModel[t]="string"==typeof this.model[t]?this.model[t]:$.extend(!0,{},this.model[t]))},_compareModelProperty:function(t,e,i){if(t&&this._cloneModel[t]!==this.model[t]){var a={};a[t]=this.model[t],this._comparePropertyValues(this._cloneModel,t,a,e,i),this._updateCloneModel(t)}},_setModel:function(t){var e,i,a,n,o,s,r,l,d,h,g=!1;for(a in t){switch(a){case"height":case"width":this._svgParentDimention=null,t.dataSourceSettings&&(this._layoutUpdate=!0),this._initViews(!0),this._initCanvas(!0),delete this._layoutUpdate;break;case"nodes":case"connectors":n=!1,window.angular&&"nodes"===a&&t.nodes&&t.nodes()&&this.nodes()&&t.nodes()===this.nodes()&&(n=!0),n||(g||this._isPreventModelChange||this._isRefreshTriggered&&"function"==typeof this.model.nodes||(this._initLineRouting(),g=this._setNodesConnectors(t,this._isLoad),this._trigger("refresh"),this._iiii=1),delete this._isRefreshTriggered);break;case"enableContextMenu":this.model.enableContextMenu=t[a],this._initContextMenu(this._isLoad);break;case"contextMenu":this.model.contextMenu=$.extend({},this.model.contextMenu,t[a]),this._initContextMenu(this._isLoad);break;case"rulerSettings":this._updateRulerSettings(t[a]);break;case"snapSettings":(i=t[a])&&Object.keys(i).length>0&&(this._updateSnapSettings(t[a]),ej.datavisualization.Diagram.SvgContext._renderGrid(this._canvas,this._svg,this._page,this));break;case"selectorConstraints":this._setSelectorConstraints(t[a]);break;case"constraints":if(this.model.constraints=t[a],this._hasSelection()&&!ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._clearSelection(),(o=this._getConnectors()).length>0)for(h=0;h<o.length;h++)ej.datavisualization.Diagram.Util.updateBridging(this.model.connectors[h],this),ej.datavisualization.Diagram.DiagramContext.update(this.model.connectors[h],this);break;case"drawingTools":this.model.drawingTools=t[a],this._registerDrawingTools();break;case"backgroundImage":this.model.backgroundImage=this.model.backgroundImage&&"string"==typeof this.model.backgroundImage?ej.datavisualization.Diagram.BackgroundImage({source:this.model.backgroundImage}):$.extend(!0,{},this.model.backgroundImage,t[a]),ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"backgroundColor":this.model.backgroundColor=t[a],ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"enableAutoScroll":this.enableAutoScroll(t[a]);break;case"autoScrollMargin":this.model.autoScrollMargin=t[a];break;case"layout":this._isLoad||(t[a].marginX&&(this.model.layout.margin.left=this.model.layout.margin.right=Number("function"==typeof t[a].marginX?this._layoutMarginX():t[a].marginX)),t[a].marginY&&(this.model.layout.margin.top=this.model.layout.margin.bottom=Number("function"==typeof t[a].marginY?this._layoutMarginY():t[a].marginY)),this.model.layout=$.extend(!0,{},this.model.layout,t[a]),this._setLayout(t[a]));break;case"selectedItems":this.updateSelector(t[a]);break;case"pageSettings":this.updatePageSettings(t[a]);break;case"scrollSettings":this._updateScrollSettings(t[a]);break;case"locale":this.locale(t[a]),(s=document.getElementById(this.element[0].id+"_contextMenu")).parentNode.removeChild(s),this.model.contextMenu&&this.model.contextMenu.items&&this.model.contextMenu.items.length>0&&(this.model.contextMenu.items=[]),this._renderContextMenu();break;case"nodeTemplate":this._isLoad||t.dataSourceSettings||t.nodes||(this._clearElementCollection(),this._initData(),e=this,this._views.forEach(function(t){var i=e._views[t],a=e._setNodeZOrder(i);e._renderDiagramObjects(a,i)}),this.layout());break;case"bridgeDirection":case"tool":this.update(t);break;case"connectorTemplate":this._updateConnectors();break;case"commandManager":r=t[a]&&t[a].commands?t[a].commands:undefined,this._initCommands(r);break;case"historyManager":this.model.historyManager=$.extend(!0,this.model.historyManager,{},t[a]);var c=this.model.historyManager.stackLimit,u=this.model.historyManager.redoStack.length,m=this.model.historyManager.undoStack.length;u>0&&(u>c?(l=u-c,this.model.historyManager.redoStack.splice(0,l),this.model.historyManager.undoStack=[]):(l=m-(c-u),this.model.historyManager.undoStack.splice(0,l))),m>0&&((l=m-c)>0&&this.model.historyManager.undoStack.splice(0,l)),this._initHistoryManager();break;case"showTooltip":this.model.showTooltip=t[a],this.model.selectedItems.tooltip=this.showTooltip()?ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null;break;case"toolTipTemplateId":this.model.selectedItems.tooltip||(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip({margin:{top:10}})),this.model.selectedItems.tooltip.templateId=t[a];break;case"tooltip":this.model.tooltip=null===t[a]?null:ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.tooltip,{},t[a]));break;case"dataSourceSettings":if(!this._isLoad&&((i=t[a])&&Object.keys(i).length>0&&i.dataSource&&(this.clear(),$.extend(this.model.dataSourceSettings,t[a]),this._initLineRouting(),this._initData(),e=this,this._views.forEach(function(t){var i=e._views[t],a=e._setNodeZOrder(i);e._renderDiagramObjects(a,i)}),this.layout(),(d=e.connectors()).length>1&&ej.datavisualization.Diagram.Util.canRouteDiagram(this))))for(e.lineRouting.GenerateVisibilityGraph(e,d.length),h=0;h<d.length;h++)e._routeEdge(d[h])}"nodes"===a||"connectors"===a||"selectorConstraints"===a||"selectedItems"===a||"bridgeDirection"===a||"tool"===a||"dataSourceSettings"===a||this._compareModelProperty(a)}},_resetObjectCollection:function(t,e,i,a){var n,o,s,r;if(i&&($(this.element).find(".ej-d-node").remove(),$(this.element).find(".ej-d-group").remove(),$(this.element).find(".ej-d-seperator").remove()),a)for(o=(n=$(this.element).find(".ej-d-connector")).length-1;o>=0;o--)(s=this.nameTable[n[o].id])&&""==s.parent&&$(n[o]).remove();this._hasSelection()&&this._clearSelection(),r=this,this._views.forEach(function(t){var e=r._views[t],i=r._setNodeZOrder(e);r._renderDiagramObjects(i,e)})},_getConnectors:function(){var t,e,i=[];for(t in this.nameTable)("connector"===(e=this.nameTable[t])._type||e.segments)&&i.push(e);return i},_generateNodes:function(t){for(var e,i,a=[],n=0;n<t.length;n++)e=t[n],null!=(i=this._makeNode(e))&&i.name&&!this._findNodeByName(a,i.name)&&a.push(i);return a},_generateConnectors:function(t){for(var e,i,a=[],n=0;n<t.length;n++)e=t[n],(i=this._makeLine(e))&&i.name&&!this._findNodeByName(a,i.name)&&a.push(i);return a},_findNodeByName:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name===e)return!0;return!1},_makeNode:function(t){var e,i=this.model.dataSourceSettings,a={},n=t[i.id];if(n){if(a.name=n,i.customFields&&i.customFields.length>0)for(e=0;e<i.customFields.length;e++)a[i.customFields[e]]=t[i.customFields[e]];return a}return null},_makeLine:function(t){var e,i=this.model.dataSourceSettings.connectionDataSource,a={};if(a.name=t[i.id]?t[i.id]:"connector_"+ej.datavisualization.Diagram.Util.randomId(),a.sourceNode=t[i.sourceNode],a.targetNode=t[i.targetNode],t[i.sourcePointX]&&t[i.sourcePointY]&&(a.sourcePoint={x:Number(t[i.sourcePointX]),y:Number(t[i.sourcePointY])}),t[i.targetPointX]&&t[i.targetPointY]&&(a.targetPoint={x:Number(t[i.targetPointX]),y:Number(t[i.targetPointY])}),i.customFields&&i.customFields.length>0)for(e=0;e<i.customFields.length;e++)a[i.customFields[e]]=t[i.customFields[e]];return a},insertData:function(t){var e,i,a,n;if(t)a=this._parameterMap(t),e="connector"===t.type?this.model.dataSourceSettings.connectionDataSource.crudAction.create:this.model.dataSourceSettings.crudAction.create,a&&this._raiseAjaxPost(JSON.stringify({data:[a]}),e);else{if((i=this._getNewNodes()).nodes){for(a=[],n=0;n<i.nodes.length;n++)a.push(this._parameterMap(i.nodes[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.crudAction.create)}if(i.connectors){for(a=[],n=0;n<i.connectors.length;n++)a.push(this._parameterMap(i.connectors[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.connectionDataSource.crudAction.create)}}},updateData:function(t){var e,i,a,n;if(t)a=this._parameterMap(t),e="connector"===t.type?this.model.dataSourceSettings.connectionDataSource.crudAction.update:this.model.dataSourceSettings.crudAction.update,a&&this._raiseAjaxPost(JSON.stringify({data:[a]}),e);else{if((i=this._getUpdatedNodes()).nodes){for(a=[],n=0;n<i.nodes.length;n++)a.push(this._parameterMap(i.nodes[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.crudAction.update)}if(i.connectors){for(a=[],n=0;n<i.connectors.length;n++)a.push(this._parameterMap(i.connectors[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.connectionDataSource.crudAction.update)}}},removeData:function(t){var e,i,a,n;if(t)a=this._parameterMap(t),e="connector"===t.type?this.model.dataSourceSettings.connectionDataSource.crudAction.destroy:this.model.dataSourceSettings.crudAction.destroy,a&&this._raiseAjaxPost(JSON.stringify({data:[a]}),e);else{if((i=this._getDeletedNodes()).nodes){for(a=[],n=0;n<i.nodes.length;n++)a.push(this._parameterMap(i.nodes[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.crudAction.destroy)}if(i.connectors){for(a=[],n=0;n<i.connectors.length;n++)a.push(this._parameterMap(i.connectors[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.connectionDataSource.crudAction.destroy)}}},_parameterMap:function(t){var e,i,a={};if("connector"===t.type){if((e=this.model.dataSourceSettings.connectionDataSource).id&&(a[e.id]=t.name),e.sourcePointX&&e.sourcePointY&&(a[e.sourcePointX]=t.sourcePoint.X,a[e.sourcePointY]=t.sourcePoint.Y),e.targetPointX&&e.targetPointY&&(a[e.targetPointX]=t.targetPoint.X,a[e.targetPointY]=t.targetPoint.Y),e.sourceNode&&(a[e.sourceNode]=t.sourceNode),e.targetNode&&(a[e.targetNode]=t.targetNode),e.customFields&&e.customFields.length>0)for(i=0;i<e.customFields.length;i++)a[e.customFields[i]]=t[e.customFields[i]]}else if((e=this.model.dataSourceSettings).id&&(a[e.id]=t.name),e.width&&(a[e.width]=t.width),e.height&&(a[e.height]=t.height),e.offsetX&&(a[e.offsetX]=t.offsetX),e.offsetY&&(a[e.offsetY]=t.offsetY),e.customFields&&e.customFields.length>0)for(i=0;i<e.customFields.length;i++)a[e.customFields[i]]=t[e.customFields[i]];return a},_raiseAjaxPost:function(t,e){$.ajax({contentType:"application/json",type:"POST",url:e,data:this._isWebAPI?JSON.stringify(JSON.parse(t).data):JSON.stringify(JSON.parse(t)),dataType:"json",error:function(t){404===t.status&&console.log("Method not found")}})},_initData:function(){var dataSourceSettings,dataSource,nodes,connectors,dataSourceApplied,tempNodes,tempconnectors,i,collapsedNodes;if(this.model.dataSourceSettings&&(dataSourceSettings={},this.model.dataSourceSettings.dataSource&&this.model.dataSourceSettings.connectionDataSource.dataSource?(dataSourceSettings.dataSource=this.model.dataSourceSettings.dataSource,dataSourceSettings.isBinding=!0,dataSourceSettings.nodes=this._generateNodes(this.model.dataSourceSettings.dataSource),dataSourceSettings.connectors=this._generateConnectors(this.model.dataSourceSettings.connectionDataSource.dataSource)):this.model.dataSourceSettings.dataSource&&(dataSourceSettings.id=this._dataSourceUniqueId(),dataSourceSettings.parent=this._dataSourceParentId(),dataSourceSettings.root=this._dataSourceRoot(),dataSourceSettings.dataSource=this._dataSource(),dataSourceSettings.tableName=this._dataSourceTableName(),dataSourceSettings.query=this._dataSourceQueryString()),dataSource=dataSourceSettings.dataSource||this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors),dataSource){if(nodes=[],connectors=[],dataSourceSettings&&dataSourceSettings.isBinding)dataSourceSettings.nodes&&dataSourceSettings.nodes.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.nodes,nodes,"nodes"),dataSourceSettings.connectors&&dataSourceSettings.connectors.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.connectors,connectors,"connectors");else if(this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors){if(this.model.dataSourceSettings.nodes){if(dataSource=this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.dataSource,dataSource)if(dataSource instanceof ej.DataManager){$.ajaxSetup({async:!1});var query=this._findQuery(this.model.dataSourceSettings.nodes,this.model.dataSourceSettings.nodeBinding),queryPromise=dataSource.executeQuery(eval(query)),diagram=this;queryPromise.done(function(t){diagram.retriveData=t.result,diagram._applyTemplate(diagram.model.dataSourceSettings,t.result,nodes,"nodes")})}else this._applyTemplate(this.model.dataSourceSettings,dataSource,nodes,"nodes");this.model.dataSourceSettings.connectors&&(dataSource=this.model.dataSourceSettings.connectors||this.model.dataSourceSettings.dataSource,dataSource&&(dataSource instanceof ej.DataManager?($.ajaxSetup({async:!1}),query=this._findQuery(this.model.dataSourceSettings.connectors,this.model.dataSourceSettings.connectorBinding),queryPromise=dataSource.executeQuery(eval(query)),queryPromise.done(function(t){diagram.retriveData=t.result,diagram._applyTemplate(diagram.model.dataSourceSettings,t.result,connectors,"connectors")})):this._applyTemplate(this.model.dataSourceSettings,dataSource,connectors,"connectors")))}}else dataSource instanceof ej.DataManager?(this._initDataSource(dataSourceSettings,nodes,connectors),dataSourceSettings.parent&&(dataSourceApplied=!0)):"string"!=typeof dataSource&&dataSource.length&&(this._applyDataSource(dataSourceSettings,dataSource,nodes,connectors),this.model.dataSourceSettings.parent&&(dataSourceApplied=!0));for(tempNodes=[],tempconnectors=[],this.nodes().length>0&&(tempNodes=this.nodes()),this.connectors().length>0&&(tempconnectors=this.connectors()),this.nodes(nodes),this.connectors(connectors),i=0;i<tempNodes.length;i++)this.nodes().push(tempNodes[i]),this._nodes=$.extend(!0,[],this.nodes());for(i=0;i<tempconnectors.length;i++)this.connectors().push(tempconnectors[i]),this._connectors=$.extend(!0,[],this.connectors())}collapsedNodes=this._initNodeCollection(!1,dataSourceApplied),this._initConnectorCollection(dataSourceApplied),collapsedNodes.length>0&&this._collapseNodes(collapsedNodes),this._cloneModel=$.extend(!0,{},this.model)},_getSetTool:function(){var t;return this.model.setTool&&("string"==typeof this.model.setTool&&(t=ej.util.getObject(this.model.setTool,window)),$.isFunction(this.model.setTool)&&(t=this.model.setTool)),t},_getNodeTemplate:function(){var t;return this.model.nodeTemplate&&("string"==typeof this.model.nodeTemplate&&(t=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(t=this.model.nodeTemplate)),t},_getConnectorTemplate:function(){var t;return this.model.connectorTemplate&&("string"==typeof this.model.connectorTemplate&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(t=this.model.connectorTemplate)),t},_initNodeCollection:function(t,e){var i,a,n=[],o=this.nodes();for((!this.model.dataSourceSettings.dataSource||this._isLoad)&&(i=this._getNodeTemplate()),this._isNodeInitializing=!0,a=0;a<o.length;a++)o[a].container&&!$.isEmptyObject(o[a].container)||o[a].isSwimlane||"swimlane"===o[a].type?o[a=this._convertGroupChild(o[a],o)]=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,o[a]):"object"!=typeof o[a].shape&&(o[a]=ej.datavisualization.Diagram.NodeType(o[a],this)),""==o[a].name&&(o[a].name="node_"+ej.datavisualization.Diagram.Util.randomId()),"swimlane"===o[a].type||o[a].isSwimlane?this.nameTable[o[a].name]=ej.datavisualization.Diagram.Group(o[a]):"group"===o[a]._type||o[a].children&&o[a].children.length>0?("bpmn"==o[a].type&&o[a].container?o[a]=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,o[a]):o[a=this._convertGroupChild(o[a],o)]=this._getNewGroup(o[a]),o[a]._type="group",this.nameTable[o[a].name]=o[a],this._initGroupNode(o[a]),t||"bpmn"===o[a].type||this._udpateChildRotateAngle(o[a])):e?o[a].shape&&"object"==typeof o[a].shape&&ej.datavisualization.Diagram.Util._updateShapeProperties(o[a]):(o[a]=this._getNewNode(o[a]),this.nameTable[o[a].name]=o[a]),!e&&i&&(i(this,o[a]),"object"!=typeof o[a].shape&&(o[a]=ej.datavisualization.Diagram.NodeType(o[a],this)),("group"===o[a]._type||o[a].children&&o[a].children.length>0)&&(o[a]="bpmn"==o[a].type&&o[a].container?ej.datavisualization.Diagram.ContainerHelper._initContainer(this,o[a]):this._getNewGroup(o[a]),this._initGroupNode(o[a]))),"node"===o[a]._type&&o[a].labels.length&&(0==o[a].width||0==o[a].height)&&this._getNodeDimension(o[a]),this.nameTable[o[a].name]=o[a],this._updateQuad(o[a]),o[a].isExpanded||n.push(o[a]),this._setBounds(o[a]);if(delete this._isNodeInitializing,this._nodes=$.extend(!1,[],o),ej.datavisualization.Diagram.Util.canRouteDiagram(this))for(this.lineRouting.GenerateVisibilityGraph(this,o.length),a=0;a<this._nodes.length;a++)this._resetValues(this._nodes[a]);return n},_convertGroupChild:function(t,e){var i,a;if(t.children&&t.children.length>0)for(i=0;i<t.children.length;i++)(a=t.children[i])&&"string"==typeof a&&(a=this.nameTable[a],t.children[i]=a,ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[a.name],a),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,a,!1),"group"===a.type&&(i=this._convertGroupChild(a,t.children)),"connector"===a.type?ej.datavisualization.Diagram.Util.removeItem(this.connectors(),a):ej.datavisualization.Diagram.Util.removeItem(this.nodes(),a));return e.indexOf(t)},_checkFromSwimlane:function(t){if(t){if(t.isSwimlane||t.isLane||t.isLaneStack||t.isPhaseStack||t.isPhase||"phase"==t.type)return!0;if(t.parent){var e=this.nameTable[t.parent];if(e)return this._checkFromSwimlane(e)}}return!1},_setBounds:function(t){!this._selectedSymbol&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&(t.segments||this._checkFromSwimlane(t)||(1!=this.nodes().length||this.lineRouting.router||this.lineRouting.router.graph||this.lineRouting.GenerateVisibilityGraph(this,1==this.nodes().length),this.lineRouting.RemoveNode(t),this._isInit||(this._setObstacle(),this.lineRouting.AddNode(t))))},_setObstacle:function(){this.lineRouting.IsDirt=!0},_initConnectorCollection:function(t){for(var e,i=this.connectors(),a=this._getConnectorTemplate(),n=0,o=i.length;n<o;n++)e=t?i[n]:this._getNewConnector(i[n]),this.nameTable[e.name]=e,t||(this.model.layout&&this._layoutType()===ej.datavisualization.Diagram.LayoutTypes.None||this._isLoad)&&this._dock(e,this.nameTable),this._updateEdges(e),a&&!t&&a(this,e),i[n]=e,this.model.layout&&this._layoutType()===ej.datavisualization.Diagram.LayoutTypes.None&&(this._isUndo=!0,this._routeEdge(i[n]),this._isUndo=!1);this._connectors=$.extend(!0,[],i)},_initDataSource:function(dataSourceSettings,nodes,connectors){var dataSource=dataSourceSettings.dataSource,diagram=this,mapper,query,queryPromise;dataSource.dataSource.json&&dataSource.dataSource.json.length>0?diagram._applyDataSource(dataSourceSettings,dataSource.dataSource.json,nodes,connectors):dataSource.dataSource.table||(mapper=dataSourceSettings,dataSource instanceof ej.DataManager&&($.ajaxSetup({async:!1}),query=this._findQuery(mapper,dataSourceSettings.nodeBinding),queryPromise=dataSourceSettings.dataSource.executeQuery(eval(query)),queryPromise.done(function(t){diagram.retriveData=t.result,diagram._applyDataSource(dataSourceSettings,t.result,nodes,connectors)})))},_findQuery:function(t,e){var i,a,n,o,s,r,l=[],d=ej.Query(),h=t.query||this.model.dataSourceSettings.query;if(ej.isNullOrUndefined(h)){for(n in i=t.dataSource||this.model.dataSourceSettings.dataSource,a=t.tableName||this.model.dataSourceSettings.tableName,t)"tableName"===n||"dataSource"===n||"designTemplate"===n||n.match("Binding")||t[n]&&l.push(t[n]);for(o in e)if("labels"===o)for(s=e[o],r=0;r<s.length;r++)s[r].text&&l.push(s[r].text);else"shape"==o||"line"==o?e[o][type]&&n.push(e[o][type]):e[o]&&l.push(e[o]);l.length>0&&d.select(l),i.dataSource.url.match(a+"$")||ej.isNullOrUndefined(a)||d.from(a)}else d=h;return d},_updateMultipleRootNodes:function(t,e,i){var a,n,o=t[i.parent];if(o&&o.length>0)for(n=0;n<o.length;n++)e[a=o[n]]?e[a].items.push(t):e[a]={items:[t]};return e},_applyDataSource:function(t,e,i,a){for(var n,o,s,r,l,d,h,g,c,u,m,p=[],f=0;f<e.length;f++)h=e[f],Array.isArray(h[t.parent])?p=this._updateMultipleRootNodes(h,p,t,e):p[h[t.parent]]?p[h[t.parent]].items.push(h):p[h[t.parent]]={items:[h]},t.root===h[t.id]&&(n={items:[h]});if(g=[],t.parent)if(n)g.push(n);else for(d in p)(d||0===d)&&"undefined"!=d&&'""'!=d&&"null"!=d||g.push(p[d]);else g.push(p[undefined]);for(this.model.nodeTemplate&&(u=this._getNodeTemplate()),this.model.connectorTemplate&&(m=this._getConnectorTemplate()),o=0;o<g.length;o++)for(s=0;s<g[o].items.length;s++)r=g[o].items[s],l=this._applyNodeTemplate(t,r,u),i.push(l),t.parent&&((c=p[l[t.id]])&&c.items&&this._renderChildNodes(t,c,l.name,i,a,p,u,m))},_getNewNodes:function(){var t,e,i=[],a=[];for(t in this.nameTable)(e=this.nameTable[t])&&"connector"===e.type&&"new"===e._status?(e._status="",a.push(e)):e&&"new"===e._status&&(e._status="",i.push(e));return{nodes:i,connectors:a}},_getUpdatedNodes:function(){var t,e,i=[],a=[];for(t in this.nameTable)(e=this.nameTable[t])&&"connector"===e.type&&"update"===e._status?(e._status="",a.push(e)):e&&"update"===e._status&&(e._status="",i.push(e));return{nodes:i,connectors:a}},_getDeletedNodes:function(){for(var t,e=[],i=[],a=0;a<this._crudDeleteNodes.length;a++)(t=this._crudDeleteNodes[a])&&"connector"===t.type?i.push(t):t&&e.push(t);return this._crudDeleteNodes=[],{nodes:e,connectors:i}},_isContainsSameConnector:function(t,e,i){var a,n;if(e&&i)for(a=0;a<t.length;a++)if((n=t[a])&&n.sourceNode===e&&n.targetNode===i)return!0;return!1},_renderChildNodes:function(t,e,i,a,n,o,s,r){for(var l,d,h,g,c=0;c<e.items.length;c++)l=e.items[c],d=this._applyNodeTemplate(t,l,s),g=!1,this._collectionContains(d.name,a)?g=!0:a.push(d),this._isContainsSameConnector(n,i,d.name)||n.push(this._applyConnectorTemplate(t,null,i,d.name,r)),g||(h=o[l[t.id]])&&this._renderChildNodes(t,h,d.name,a,n,o,s,r)},_applyTemplate:function(t,e,i,a){var n,o,s,r,l;if(this.model.nodeTemplate&&(n=this._getNodeTemplate()),this.model.connectorTemplate&&(l=this._getConnectorTemplate()),"nodes"==a)for(o=0;o<e.length;o++)s=this._applyNodeTemplate(t,e[o],n),i.push(s);if("connectors"==a)for(o=0;o<e.length;o++)r=this._applyConnectorTemplate(t,e[o],e[o].sourceNode,e[o].targetNode,l),i.push(r)},_applyNodeTemplate:function(t,e,i){var a=e;return""!==a.name&&a.name||(a.name=ej.datavisualization.Diagram.Util.randomId()),a="group"!=a.type?this._getNewNode(a):this._getNewGroup(a),i&&i(this,a),"group"===a._type&&this._initGroupNode(a),a},_applyConnectorTemplate:function(t,e,i,a,n){var o={};return o.name=e&&e.name?e.name:ej.datavisualization.Diagram.Util.randomId(),o.sourceNode=i,o.targetNode=a,o=this._getNewConnector(o),n&&n(this,o),o},_collapseNodes:function(t){for(var e,i=0;i<t.length;i++)e=t[i],this._collapseChildren(e)},_getNewNode:function(t){return t.shape&&"object"==typeof t.shape&&ej.datavisualization.Diagram.Util._updateShapeProperties(t),ej.datavisualization.Diagram.Node($.extend(!0,{},this.model.defaultSettings.node,t))},_getNewGroup:function(t){var e,i=null,a=0;if("bpmn"==t.type&&(t=ej.datavisualization.Diagram.Util._updateBpmnChild(ej.datavisualization.Diagram.Node(t),this)),t.children&&t.children.length>0)for(e=0;e<t.children.length;e++)(i=this.nameTable[this._getChild(t.children[e])])&&(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),i.segments?(a=this.connectors().indexOf(i),delete this.nameTable[i.name],this.nameTable[i.name]=this._getNewConnector(i),a>=0&&(this.connectors()[a]=this.nameTable[i.name]),this._dock(this.nameTable[i.name],this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(this.nameTable[i.name],this)):"node"===i._type?(a=this.nodes().indexOf(i),delete this.nameTable[i.name],this.nameTable[i.name]=this._getNewNode(i),a>=0&&(this.nodes()[a]=this.nameTable[i.name])):"group"===i._type&&(a=this.nodes().indexOf(i),delete this.nameTable[i.name],this.nameTable[i.name]=this._getNewGroup(i),a>=0&&(this.nodes()[a]=this.nameTable[i.name])));return ej.datavisualization.Diagram.Group($.extend(!1,{},this.model.defaultSettings.group,t))},_isEmptyDiagramObject:function(t){if($.isEmptyObject(t))return!0;for(var e in t)if("object"==typeof t[e])return this._isEmptyDiagramObject(t[e]);return!1},_getNewConnector:function(t){var e,i,a,n=$.extend(!0,{},this.model.defaultSettings.connector,t);return this.model.layout&&"organizationalchart"==this.model.layout.type&&(n=$.extend(!0,{},{segments:[{type:"orthogonal"}]},n)),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments[0]&&(n.defaultType=this.model.defaultSettings.connector.segments[0].type),n.shape&&!this._isEmptyDiagramObject(n.shape)&&("umlactivity"==n.shape.type&&((n=ej.datavisualization.Diagram.UMLConnectorShape(n)).sourceNode&&(e=this.nameTable[n.sourceNode]),n.targetNode&&(i=this.nameTable[n.targetNode]),a=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(i,e,n,this),n.targetNode=a?a.name:null),"umlclassifier"==n.shape.type?((n=ej.datavisualization.Diagram.UMLConnectorShape(n)).sourceNode&&(e=this.nameTable[n.sourceNode]),n.targetNode&&(i=this.nameTable[n.targetNode]),a=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(i,e,n,this),n.targetNode=a?a.name:null):(n.shape=$.extend(!0,{},ej.datavisualization.Diagram.ConnectorShapeDefaults,n.shape),"sequence"==n.shape.flow&&("normal"==n.shape.sequence&&(n=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},n)),"conditional"==n.shape.sequence&&((n=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},n)).sourceDecorator={shape:"diamond",fillColor:"white",width:20,height:10}),"default"==n.shape.sequence&&(n=$.extend(!0,{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},n))),"association"==n.shape.flow&&("directional"==n.shape.association&&(n=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},n)),"nondirectional"==n.shape.association&&(n=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"none"}},n)),"bidirectional"==n.shape.association&&((n=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},n)).sourceDecorator={shape:"openarrow",width:5,height:10})),"message"==n.shape.flow&&(n=$.extend(!0,{},{segments:[{type:"straight"}],sourceDecorator:{shape:"circle",fillColor:"white"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"},n)))),ej.datavisualization.Diagram.Util._initConnectionEnds(n,this),ej.datavisualization.Diagram.Connector(n)},_setOverview:function(t,e){var i,a,n;t?(this._overview=t,this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._views[t._id]||(this._views.push(t._id),this._views[t._id]={context:ej.datavisualization.Diagram.SvgContext,type:"overview"},t._renderDocument(this._views[t._id]),i=this._views[t._id],a=this._setNodeZOrder(i),this._renderDiagramObjects(a,i,null,!0),t._updateOverview(i)),delete this._viewPort):((t=$("#"+e).ejOverview("instance"))._removeDocument(this._views[e]),this._views[e]=undefined,n=this._views.indexOf(e),this._views.splice(n,1))},_updateScrollOffset:function(t,e,i){this._hScrollOffset=Number(t),this._vScrollOffset=Number(e),this._verticalOffset(Number(e)),this._horizontalOffset(Number(t)),this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),ej.datavisualization.Diagram.ScrollUtil._transform(this,t,e,i);var a=this;this._views.forEach(function(i){var n;"overview"==a._views[i].type&&((n=$("#"+i).ejOverview("instance"))&&n._scrollOverviewRect(t,e,a._currZoom))}),this.model.scrollSettings.viewPortHeight=this._viewPort.height,this.model.scrollSettings.viewPortWidth=this._viewPort.width,this.model.scrollSettings.currentZoom=this._currZoom},_getChild:function(t){return ej.datavisualization.Diagram.Util.getChild(t)},_getChildren:function(t){var e,i,a;if(t){for(e=[],i=0;i<t.length;i++)(a=t[i])&&("object"==typeof a?e.push(a.name):e.push(a));return e}},_initGroupNode:function(t,e){for(var i,a,n,o,s=null,r=0;t.children&&r<t.children.length;r++)(s="string"==typeof(o=e?$.extend(!0,{},e[this._getChild(t.children[r])]):t.children[r])?this.nameTable[o]:o)&&(s._type||"umlclassifier"!=s.type||(s._type="group"),s.container&&(s._type="group",s.labels=s.labels||[]),o&&"object"==typeof o&&("object"!=typeof s.shape&&"bpmn"!=t.type&&(s=ej.datavisualization.Diagram.NodeType(s,this)),"group"==s._type||s.children||s.segments||"connector"==s.type?s.segments||"connector"==s.type?""==(s=this._getNewConnector(s)).name&&(s.name=ej.datavisualization.Diagram.Util.randomId()):(""==(s=this._getNewGroup(s)).name&&(s.name=ej.datavisualization.Diagram.Util.randomId()),this._initGroupNode(s)):("bpmn"!=t.type&&"umlclassifier"!=t.type&&(i=!1,t.parent&&((a=this.getNode(t.parent))&&(a.subProcess&&a.subProcess.events.length>0||a.task&&a.task.events.length>0)&&(i=!0)),i||(s=this._getNewNode(s))),""==s.name&&(s.name=ej.datavisualization.Diagram.Util.randomId()),"node"==s._type&&s.labels.length&&(0==s.width||0==s.height)&&this._getNodeDimension(s)),t.children[r]=s,s.parent=t.name,this.nameTable[s.name]=s,s.segments&&this._dock(s,this.nameTable)),this._updateQuad(this.nameTable[this._getChild(t.children[r])]));this._isLoad||ej.datavisualization.Diagram.Util._updateGroupBounds(t,this),"group"===t._type?this._updateFlipOffset(t,t.flip,!(!this._isLoad||!this.model.serializationSettings.preventDefaultValues)):t.parent&&((n=this.findNode(t.parent))&&(n.subProcess&&n.subProcess.events.length>0||n.task&&n.task.events.length>0)&&ej.datavisualization.Diagram.Util._updateGroupBounds(t,this))},_udpateChildRotateAngle:function(t){var e,i,a,n,o,s;if(t.rotateAngle)for(a=ej.Matrix.identity(),ej.Matrix.rotate(a,t.rotateAngle,t.offsetX,t.offsetY),n=0;n<t.children.length;n++)(i=this.nameTable[this._getChild(t.children[n])]).rotateAngle=i.rotateAngle?i.rotateAngle+t.rotateAngle:t.rotateAngle,i.rotateAngle%=360,i.rotateAngle<0&&(i.rotateAngle+=360),i.segments?(i.sourceNode||this._setEndPoint(i,ej.Matrix.transform(a,i.sourcePoint),!1),i.targetNode||this._setEndPoint(i,ej.Matrix.transform(a,i.targetPoint),!0)):("group"==i.type&&this._udpateChildRotateAngle(i),o=i.offsetX,e=i.offsetY,s=ej.Matrix.transform(a,ej.datavisualization.Diagram.Point(o,e)),this._translate(i,s.x-o,s.y-e,this.nameTable),this._updateAssociatedConnectorEnds(i,this.nameTable))},_getNodeDimension:function(t){var e,i,a,n=t._width,o=t._height,s=t.width?t.width:t.maxWidth?t.maxWidth:t.minWidth,r=document.createElement("span"),l=0,d=0;if(t.labels.length){for(ej.datavisualization.Diagram.Util.attr(r,{id:t.name+"_label",class:"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(r),i=0;i<t.labels.length;i++)(e=t.labels[i]).bold&&(r.style.fontWeight="bold"),e.italic&&(r.style.fontStyle="italic"),r.style.textDecoration=e.textDecoration,r.style.fontFamily=e.fontFamily,r.style.fontSize=e.fontSize+"px",r.style.color=e.fontColor,r.style.backgroundColor=e.fillColor,r.style.borderColor=e.borderColor,r.style.borderWidth=e.borderWidth+"px",r.textContent=e.text,"nowrap"==e.wrapping?(r.style.whiteSpace="nowrap",r.style.wordWrap="normal"):("wrap"==e.wrapping&&(r.style.wordBreak="break-all"),r.style.wordWrap="break-word",r.style.whiteSpace="pre"),t.maxWidth&&(r.style.maxWidth=s-(e.margin.left+e.margin.right)-e.fontSize+"px"),t.minWidth&&(r.style.minWidth=s-(e.margin.left+e.margin.right)-e.fontSize+"px"),l+=r.offsetWidth+e.margin.left+e.margin.right+5,d+=r.offsetHeight+e.margin.top+e.margin.bottom;a=t.name.match("_attribute")?"attribute":t.name.match("_method")?"method":t.name.match("_member")?"member":"header",t._width=Math.max(t.minWidth||0,l||0),t.maxWidth&&(t._width=Math.min(t.maxWidth,t._width)),t._height=Math.max(t.minHeight||0,d||0),t.maxHeight&&(t._height=Math.min(t.maxHeight,t._height)),t.width||"left"!=t.labels[0].horizontalAlignment||"attribute"==a||"method"==a||"member"==a||(t.offsetX+=(t._width-n)/2),t.width||"right"!=t.labels[0].horizontalAlignment||(t.offsetX-=(t._width-n)/2),t.height||"top"!=t.labels[0].verticalAlignment||(t.offsetY+=(t._height-o)/2),t.height||"bottom"!=t.labels[0].verticalAlignment||(t.offsetY-=(t._height-o)/2),t.parent&&this.nameTable[t.parent],this.element[0].removeChild(r)}},_getMinMaxSize:function(t,e,i,a,n){var o,s,r,l,d,h,g=null,c=null;return e>=t.minWidth&&e<=t.maxWidth?g=e:"stretch"!=t.horizontalAlign||!t.parent||a||n?n?(s=this.nameTable[t.parent])&&(r=ej.datavisualization.Diagram.Util.bounds(s),g=(h=this._getMinMaxSize(s,r.width,r.height)).width?h.width:e):g=e<t.minWidth&&0!=t.minWidth?t.minWidth:e>t.maxWidth&&0!=t.maxWidth&&!t.isSwimlane?t.maxWidth:e:(s=this.nameTable[t.parent])&&(0==(r=ej.datavisualization.Diagram.Util.bounds(s)).width&&0==r.height&&(r.width=e,r.height=i),h=this._getMinMaxSize(s,r.width,r.height),s.isSwimlane&&"vertical"==s.orientation&&((o=this.nameTable[this._getChild(s.children[0])])&&(h.height-=o.height)),h.width-=s.paddingLeft+s.paddingRight+s.marginLeft+s.marginRight,h.height-=s.paddingTop+s.paddingBottom+s.marginTop+s.marginBottom,g=h.width?h.width:e),i>=t.minHeight&&i<=t.maxHeight?c=i:(s=this.nameTable[t.parent],"stretch"!=t.verticalAlign||!t.parent||a||t.isLane?c=i<t.minHeight&&0!=t.minHeight?t.minHeight:i>t.maxHeight&&0!=t.maxHeight?t.maxHeight:i:(0==(r=ej.datavisualization.Diagram.Util.bounds(s)).width&&0==r.height&&(l=null,d=!1,r.width=t.minWidth,r.height=t.minHeight,(0==t.minWidth||0==t.minHeight)&&(r.width=e,r.height=i,l=!1,d=!0),d||(l=!0)),(h=this._getMinMaxSize(s,r.width,r.height)).width-=s.paddingLeft+s.paddingRight+s.marginLeft+s.marginRight,h.height-=s.paddingTop+s.paddingBottom+s.marginTop+s.marginBottom,l&&(h.height-=t.marginTop),c=h.height?h.height:i)),{width:g,height:c}},_updateConnectorBridging:function(t){var e,i,a=[];for(this.boundaryTable[t.name]=ej.datavisualization.Diagram.Util.bounds(t),t._intersects&&t._intersects.length&&(a=t._intersects),e=0;e<a.length;e++)(i=this.nameTable[a[e]])&&i.visible&&i.segments&&i!=t&&ej.datavisualization.Diagram.Util.canBridge(i,this)&&(ej.datavisualization.Diagram.Util.updateBridging(i,this,[t]),this._disableSegmentChange||ej.datavisualization.Diagram.DiagramContext._refreshOnlySegments(i,this))},_drawToolShape:function(t,e){"image"==t||"native"==t||"html"==t||"text"===t||"basic"===t||"flow"===t||"arrow"===t||"bpmn"===t||this.activeTool._isPolyline()?this.activateTool("shapeTool",e):"straightLine"==t?this.activateTool("straightLine",e):"orthogonalLine"==t?this.activateTool("orthogonalLine",e):"bezierLine"==t&&this.activateTool("bezierLine",e)},_destroy:function(){(this.element.empty().removeClass("e-datavisualization-diagram"),this.enableContextMenu())&&$("#"+this.element[0].id+"_contextMenu").data("ejMenu").destroy();$("#"+this.element[0].id+"_contextMenu").remove()},_updateRuler:function(t,e){var i={};t.interval&&(i.interval=t.interval),t.segmentWidth&&(i.segmentWidth=t.segmentWidth),t.tickAlignment&&(i.tickAlignment=t.tickAlignment),t.markerColor&&(i.markerColor=t.markerColor),t.thickness&&(i.thickness=t.thickness),t.arrangeTick&&(i.arrangeTick=t.arrangeTick),$.isEmptyObject(i)||$("#"+e[0].id).ejRuler(i)},_updateRulerSettings:function(t){this.updateViewPort(),(t.showRulers!=undefined||t.horizontalRuler&&t.horizontalRuler.thickness||t.verticalRuler&&t.verticalRuler.thickness)&&(this._svgParentDimention=null,this._initViews(!0),this._initCanvas(!0)),t.horizontalRuler&&this._updateRuler(t.horizontalRuler,this._hRuler),t.verticalRuler&&this._updateRuler(t.verticalRuler,this._vRuler),ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this),ej.datavisualization.Diagram.ScrollUtil._updateRuler(this,this._hScrollOffset,this._vScrollOffset)},_updateScrollSettings:function(t){var e,i,a,n,o=this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Limited,s=this.model.pageSettings.scrollableArea,r=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);(t.horizontalOffset!==undefined||t.verticalOffset!==undefined)&&(e={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:r},t.horizontalOffset!==undefined&&(i=Number("function"==typeof t.horizontalOffset?t.horizontalOffset():t.horizontalOffset),(!o||i>=s.x&&i<=s.x+s.width)&&("diagram"==this._scrollLimit()&&(i=Math.max(this._hScrollbar.model.minimum,i),i=Math.min(this._hScrollbar.model.maximum,i)),this._updateScrollOffset(i,this._verticalOffset()))),t.verticalOffset!==undefined&&(a=Number("function"==typeof t.verticalOffset?t.verticalOffset():t.verticalOffset),(!o||a>=s.y&&a<=s.y+s.height)&&("diagram"==this._scrollLimit()&&(a=Math.max(this._vScrollbar.model.minimum,a),a=Math.min(this._vScrollbar.model.maximum,a)),this._updateScrollOffset(this._horizontalOffset(),a))),n={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:r},this._raiseEvent("scrollChange",{newValues:n,oldValues:e})),t.zoomFactor&&this.zoomFactor("function"==typeof t.zoomFactor?t.zoomFactor():t.zoomFactor),t.padding&&($.extend(this.model.scrollSettings.padding,t.padding),this._updateScrollOffset(this._horizontalOffset(),this._verticalOffset()))},updatePageSettings:function(t){if(t){var e=$.extend(!0,{},this.model.pageSettings);t.pageHeight&&this._pageHeight(Number("function"==typeof t.pageHeight?t.pageHeight():t.pageHeight)),t.pageWidth&&this._pageWidth(Number("function"==typeof t.pageWidth?t.pageWidth():t.pageWidth)),("function"==typeof t.multiplePage||"boolean"==typeof t.multiplePage)&&this._multiplePage("function"==typeof t.multiplePage?t.multiplePage():t.multiplePage),("function"==typeof t.showPageBreak||"boolean"==typeof t.showPageBreak)&&this._showPageBreak("function"==typeof t.showPageBreak?t.showPageBreak():t.showPageBreak),(t.pageBorderColor||""===t.pageBorderColor)&&this._pageOrientation("function"==typeof t.pageOrientation?t.pageOrientation():t.pageOrientation),(t.pageBorderWidth||0===t.pageBorderWidth)&&this._pageBorderWidth(Number("function"==typeof t.pageBorderWidth?t.pageBorderWidth():t.pageBorderWidth)),(t.pageMargin||0===t.pageMargin)&&this._pageMargin(Number("function"==typeof t.pageMargin?t.pageMargin():t.pageMargin)),(t.pageBackgroundColor||""===t.pageBackgroundColor)&&this._pageBackgroundColor("function"==typeof t.pageBackgroundColor?t.pageBackgroundColor():t.pageBackgroundColor),t.scrollLimit&&this._scrollLimit("function"==typeof t.scrollLimit?t.scrollLimit():t.scrollLimit),t.scrollableArea&&(this.model.pageSettings.scrollableArea=t.scrollableArea),(t.pageBorderColor||""===t.pageBorderColor)&&this._pageBorderColor("function"==typeof t.pageBorderColor?t.pageBorderColor():t.pageBorderColor),this._compareModelProperty("pageSettings"),this._isUndo||this.addHistoryEntry({type:"pagesettingschanged",undoObject:e,category:"internal",redoObject:$.extend(!0,{},this.model.pageSettings)}),ej.datavisualization.Diagram.PageUtil._updatePageSize(this),ej.datavisualization.Diagram.SvgContext._updateBackground(this._hScrollOffset,this._vScrollOffset,this._currZoom,this),ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this)}},_updateSnapSettings:function(t){t&&(t.horizontalGridLines&&t.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=t.horizontalGridLines.linesInterval),t.verticalGridLines&&t.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=t.verticalGridLines.linesInterval),t.snapAngle&&this._snapAngle(Number("function"==typeof t.snapAngle?t.snapAngle():t.snapAngle)),t.snapObjectDistance&&this._snapObjectDistance(Number("function"==typeof t.snapObjectDistance?t.snapObjectDistance():t.snapObjectDistance)))},_cloneObject:function(t){var e,i;if(("node"===this.getObjectType(t)||"connector"===this.getObjectType(t))&&"bpmn"!=t.type)return $.extend(!0,{},t);if(!("group"!==this.getObjectType(t)&&"bpmn"!==t.type||t.isSwimlane)){for(e=$.extend(!0,{},t),i=0;e.children&&e.children.length>0&&i<e.children.length;i++)e.children[i]=this._cloneObject(this.nameTable[this._getChild(e.children[i])]),e.children[i].parent=e.name;return e}return"group"===this.getObjectType(t)&&t.isSwimlane?this.getNode(t):void 0},_cloneSelectionList:function(){for(var t,e,i=[],a=0;a<this.selectionList.length;a++)if("pseudoGroup"===this.getObjectType(this.selectionList[a]))for(t=this.selectionList[0],e=0;t.children&&t.children.length>0&&e<t.children.length;e++)i.push(this._cloneObject(this.nameTable[this._getChild(t.children[e])]));else i.push(this._cloneObject(this.selectionList[a]));return i},getNode:function(t,e){if(t)return this._getNode(t,e)},addPhase:function(t,e){this._addPhase(t,e)},stopEvents:function(t){this.activeTool.inAction&&!t.originalEvent.target&&t.target&&(t.originalEvent.target=t.target,this._mouseup(t))},_updateSwimlanePhase:function(t,e){var i,a;t&&e&&(e.label&&((i=this.nameTable[t.name])&&(this._comparePropertyValues(t,"label",e),e.label=$.extend(!0,{},e.label),e.label.rotateAngle="vertical"===e.orientation?270:0,e.label.name=i.labels[0].name,e.label.mode=ej.datavisualization.Diagram.LabelEditMode.View,t.label=e.label,this.updateLabel(i.name,i.labels[0],t.label))),(e.lineColor||e.lineDashArray||e.lineWidth)&&(a={},e.lineColor&&(this._comparePropertyValues(t,"lineColor",e),t.lineColor=e.lineColor,a.stroke=e.lineColor),e.lineDashArray&&(this._comparePropertyValues(t,"lineDashArray",e),t.lineDashArray=e.lineDashArray,a["stroke-dasharray"]=e.lineDashArray),e.lineWidth&&(this._comparePropertyValues(t,"lineWidth",e),t.lineWidth=e.lineWidth,a["stroke-width"]=e.lineWidth),ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(t,a,this)),e.fillColor&&(this._comparePropertyValues(t,"fillColor",e),t.fillColor=e.fillColor,ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(t,this)))},_updateNodeVisibility:function(t,e){var i,a,n,o;if(t){if("group"===t.type)for(n=0;n<t.children.length;n++)(i=this.nameTable[this._getChild(t.children[n])])&&this._updateNodeVisibility(i,e);if(t.isSwimlane&&(a=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,t)))for(n=0;n<a.length;n++)(o=this.nameTable[this._getChild(a[n])]).visible=e.visible,ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(o,e,this);t.visible=e.visible}},_compareInnerProperties:function(t,e){var i;if(t&&e)for(i in e)if("object"==typeof t[i]){if(!this._compareInnerProperties(t[i],e[i]))return!1}else if(t[i]!==e[i])return!1;return!0},_comparePropertyValues:function(t,e,i,a,n){var o,s;if(t){var r=null,l=t,d=i,h=e.split("."),g=h.length;if(g>1)for(o=0;g>o&&(l=l[h[o]],d=d[h[o]],o++,l&&d);)o==g-1&&l[h[o]]!=d[h[o]]&&(r={element:t,cause:n||(a?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown),propertyName:h[0],oldValue:l,newValue:d},this._raisePropertyChange(r));else r={cause:n||(a?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown),propertyName:e,oldValue:t[e],newValue:i[e]},"labels"===e||"ports"===e||"segments"===e||("object"!=typeof t[e]||this._compareInnerProperties(t[e],i[e]))&&t[e]&&("object"==typeof t[e]||t[e]==i[e])?"segments"===e?t[e]!=i[e]&&(r.element=t):("labels"===e||"ports"===e)&&t[e].length>0&&(s="ports"===e?this._findPort(t,i.name):this._findLabel(t,i.name),this._compareInnerProperties(s,i)||(r.element=s,r.oldValue=s,r.newValue=i)):r.element=t,r.element&&this._raisePropertyChange(r)}},updateNode:function(t,e){var i,a,n,o,s,r,l,d,h,g,c;if(t){var u,m,p,f=this._findNode(t),_=ej.Matrix.identity(),v=!1,y=ej.datavisualization.Diagram.NodeConstraints,b=f&&(f.isSwimlane||f.isLane||f.isPhase||"phase"===f.type);(b||!b)&&(this._needUpdate=!1,i=null,f&&((f.isSwimlane||f.isLane)&&e.header&&(a=e.header,delete e.header,this.model.historyManager.startGroupAction(),v=!0),this._isUndo||this._isSizingCommand||this._recordPropertiesChanged(f,e,"node"),e.pivot!=undefined&&(ej.datavisualization.Diagram.Util.bounds(f,!0),ej.Matrix.rotate(_,f.rotateAngle,f.offsetX,f.offsetY),e.pivot.x!==undefined&&(this._comparePropertyValues(f,"pivot.x",e),n=e.pivot.x-f.pivot.x,f.pivot.x=e.pivot.x,f.offsetX+=n*(f.width||f._width||0)),e.pivot.y!==undefined&&(this._comparePropertyValues(f,"pivot.y",e),o=e.pivot.y-f.pivot.y,f.pivot.y=e.pivot.y,f.offsetY+=o*(f.height||f._height||0)),p=ej.Matrix.transform(_,{x:f.offsetX,y:f.offsetY}),f.offsetX=p.x,f.offsetY=p.y),e.offsetX!=undefined&&(u=e.offsetX-f.offsetX,this._outOfBoundsOnNudge(f,u,0)&&(i={element:f,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetX",oldValue:f.offsetX,newValue:f.offsetX+u},this._raisePropertyChange(i),this._translate(f,u,0,this.nameTable),0!=f.marginLeft&&(f.marginLeft+=u))),e.offsetY!=undefined&&(m=e.offsetY-f.offsetY,this._outOfBoundsOnNudge(f,0,m)&&(i={element:f,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetY",oldValue:f.offsetY,newValue:f.offsetY+m},this._raisePropertyChange(i),this._translate(f,0,m,this.nameTable),0!=f.marginTop&&(f.marginTop+=m))),e.rotateAngle!=undefined&&(this._comparePropertyValues(f,"rotateAngle",e),this._rotate(f,e.rotateAngle-f.rotateAngle,this.nameTable)),f.isSwimlane||f.isLane?this._updateSwimlaneSize(f,e):(s=this.tools.resize,e.width!=undefined&&(f.width=f.width?f.width:1,i={element:f,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"width",oldValue:f.width,newValue:e.width},this._raisePropertyChange(i),r=!1,l=!!f.isLane,s._outOfBoundsDrag(f,e.width/f.width,1,new ej.datavisualization.Diagram.Point(f.offsetX,f.offsetY))&&(this.scale(f,e.width/f.width,1,new ej.datavisualization.Diagram.Point(f.offsetX,f.offsetY),this.nameTable,r,l),"bpmn"===f.type&&"group"===f._type&&ej.datavisualization.Diagram.Util._updateGroupBounds(f,this))),e.height!=undefined&&(f.height=f.height?f.height:1,i={element:f,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"height",oldValue:f.height,newValue:e.height},this._raisePropertyChange(i),r=!1,l=!!f.isLane,s._outOfBoundsDrag(f,1,e.height/f.height,new ej.datavisualization.Diagram.Point(f.offsetX,f.offsetY))&&(this.scale(f,1,e.height/f.height,new ej.datavisualization.Diagram.Point(f.offsetX,f.offsetY),this.nameTable,r,l),"bpmn"===f.type&&"group"===f._type&&ej.datavisualization.Diagram.Util._updateGroupBounds(f,this)))),e.connectorPadding!=undefined&&(this._comparePropertyValues(f,"connectorPadding",e),f.connectorPadding=e.connectorPadding,this.scale(f,1,1,new ej.datavisualization.Diagram.Point(f.offsetX,f.offsetY),this.nameTable)),e.visible!=undefined&&(this._comparePropertyValues(f,"visible",e),this._updateNodeVisibility(f,e),e.visible||this._clearSelection()),e.constraints!=undefined&&(this._comparePropertyValues(f,"constraints",e),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(("group"!=f._type||"bpmn"===f.type)&&(f.constraints&y.Shadow||e.constraints&y.Shadow)&&(!(f.constraints&y.Shadow)&&e.constraints&y.Shadow?(f.constraints=e.constraints,"bpmn"===f.type&&f.children&&"group"!=f.shape?(ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(f,this),ej.datavisualization.Diagram.DiagramContext.renderShadow(this.nameTable[this._getChild(f.children[0])],this)):ej.datavisualization.Diagram.DiagramContext.renderShadow(f,this)):f.constraints&y.Shadow&&!(e.constraints&y.Shadow)&&(f.constraints=e.constraints,ej.datavisualization.Diagram.DiagramContext.removeShadow(f,this))),f.constraints=e.constraints,this.selectionList[0]&&this.selectionList[0].name===f.name&&(ej.datavisualization.Diagram.Util.canSelect(this.selectionList[0])?(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,undefined,this),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,"pseudoGroup"===this.selectionList[0].type,this._currZoom,this._adornerLayer,this)):this._clearSelection(!0)))),e.fillColor!=undefined&&(this._comparePropertyValues(f,"fillColor",e),f.fillColor=e.fillColor),e.cssClass!=undefined&&(this._comparePropertyValues(f,"cssClass",e),f.cssClass=e.cssClass),e.opacity!=undefined&&(this._comparePropertyValues(f,"opacity",e),f.opacity=e.opacity),e.borderColor!=undefined&&(this._comparePropertyValues(f,"borderColor",e),f.borderColor=e.borderColor),e.borderWidth!=undefined&&(this._comparePropertyValues(f,"borderWidth",e),f.borderWidth=e.borderWidth),e.borderDashArray!=undefined&&(this._comparePropertyValues(f,"borderDashArray",e),f.borderDashArray=e.borderDashArray),e.shadow!=undefined&&(this._comparePropertyValues(f,"shadow",e),"bpmn"===f.type&&f.children&&"group"!=f.shape?(f.children[0].shadow=ej.datavisualization.Diagram.Shadow($.extend(!0,f.children[0].shadow,{},e.shadow)),ej.datavisualization.Diagram.DiagramContext.updateShadow(f.children[0],this)):(f.shadow=ej.datavisualization.Diagram.Shadow($.extend(!0,f.shadow,{},e.shadow)),ej.datavisualization.Diagram.DiagramContext.updateShadow(f,this))),e.gradient!==undefined&&(this._comparePropertyValues(f,"gradient",e),f.gradient=null===e.gradient?e.gradient:e.gradient&&"radial"===e.gradient.type?ej.datavisualization.Diagram.RadialGradient(e.gradient):ej.datavisualization.Diagram.LinearGradient(e.gradient)),e.borderGradient!==undefined&&(this._comparePropertyValues(f,"borderGradient",e),f.borderGradient=null===e.borderGradient?e.borderGradient:e.borderGradient&&"radial"===e.borderGradient.type?ej.datavisualization.Diagram.RadialGradient(e.borderGradient):ej.datavisualization.Diagram.LinearGradient(e.borderGradient)),e.isExpanded!==undefined&&(this._comparePropertyValues(f,"isExpanded",e),f._updateExpander=!0,e.isExpanded?(f.isExpanded=!0,this._expandChildren(f)):(f.isExpanded=!1,this._collapseChildren(f)),this._selectionContains(f)&&(d=!0,this._clearSelection(!0)),this.layout(),d&&this._addSelection(f,!0)),e.tooltip!==undefined&&(this._comparePropertyValues(f,"tooltip",e),f.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,f.tooltip,{},e.tooltip))),e.excludeFromLayout!=undefined&&(this._comparePropertyValues(f,"excludeFromLayout",e),f.excludeFromLayout=e.excludeFromLayout,this.layout()),e.flip!=undefined&&(f.flip=e.flip,"group"===f._type&&this._updateFlipOffset(f,e.flip),this._updateAssociatedConnectorEnds(f,this.nameTable)),e.addInfo!=undefined&&(this._comparePropertyValues(f,"addInfo",e),f.addInfo=e.addInfo),e.maxWidth!=undefined&&(this._comparePropertyValues(f,"maxWidth",e),f.maxWidth=e.maxWidth),e.maxHeight!=undefined&&(this._comparePropertyValues(f,"maxHeight",e),f.maxHeight=e.maxHeight),f=this._findNode(t),e.shape&&"object"==typeof e.shape&&(this._comparePropertyValues(f,"shape",e),ej.datavisualization.Diagram.Util._updateShapeProperties(e),"html"==f.type&&(h=document.getElementById(f.name+"_parentdiv")).parentNode.removeChild(h),ej.datavisualization.Diagram.DiagramContext.setNodeShape(f,this)),("node"==this.getObjectType(f)||"bpmn"==f.type)&&(f=this._updateShape(f,e)),f&&"phase"!=f.type&&(ej.datavisualization.Diagram.DiagramContext.update(f,this),"bpmn"==f.type?ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(f,this):ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(f,this)),this.selectionList[0]&&this.selectionList[0].name===f.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(f,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints))),t&&(e&&e.pathData&&(g=f._absolutePath),f=this._findNode(t),g&&(f._absolutePath=g,f._absoluteBounds=null),f&&"node"===f._type&&e&&"group"===e.type&&e.children&&e.children.length>0&&(c=!1,this._svg.document.getElementById(f.name)&&(c=!0),this.remove(f),f.borderColor="transparent",f.borderDashArray="",f.borderWidth=1,f.fillColor="#1BA0E2",f.labels=[],f.fillColor="",f.type=e.type,f.children=e.children,f=ej.datavisualization.Diagram.Group(f),this._initGroupNode(f),c&&(ej.datavisualization.Diagram.Util._updateGroupBounds(f,this),this.add(f)))),f&&(f.isLane||f.isSwimlane||"phase"===f.type||f.isPhase)&&(this._needUpdate=!0,e.header=a,f.isLane?this._updateLane(f,e):f.isSwimlane?(this._needUpdate=!1,this._updateSwimlane(f,e,!0)):("phase"===f.type||f.phase)&&(this._needUpdate=!1,e.offset&&this._updatePhase({name:f.name,offset:e.offset}),this._updateSwimlanePhase(f,e))),v&&this.model.historyManager.closeGroupAction()}},_updateFlipOffset:function(t,e,i){var a,n,o;if(t&&t.children&&!t.isSwimlane&&!t.lane&&"bpmn"!==t.type)for(a=this._getChildren(t.children),i&&e&&"none"!==e&&"both"!==e&&(t._flipRotateAngle=!0),t._flipRotateAngle&&(t.rotateAngle=360-t.rotateAngle,delete t._flipRotateAngle),e&&"none"!==e&&"both"!==e&&(t.rotateAngle=360-t.rotateAngle,t._flipRotateAngle=!0),n=0;n<a.length;n++)(o=this.nameTable[this._getChild(a[n])])._flip=e,i&&e&&"none"!==e&&"both"!==e&&(o._flipRotateAngle=!0),o._flipRotateAngle&&(o.rotateAngle=360-o.rotateAngle,delete o._flipRotateAngle),e&&"none"!==e&&"both"!==e&&(o.rotateAngle=360-o.rotateAngle,o._flipRotateAngle=!0),"Group"!==o._type?(i&&(e===ej.datavisualization.Diagram.FlipDirection.Horizontal||e===ej.datavisualization.Diagram.FlipDirection.Both)&&(o._flipOffsetX=!0),i&&(e===ej.datavisualization.Diagram.FlipDirection.Vertical||e===ej.datavisualization.Diagram.FlipDirection.Both)&&(o._flipOffsetY=!0),o._flipOffsetX&&(o.offsetX=t.offsetX-o.offsetX+t.offsetX,delete o._flipOffsetX),o._flipOffsetY&&(o.offsetY=t.offsetY-o.offsetY+t.offsetY,delete o._flipOffsetY),(e===ej.datavisualization.Diagram.FlipDirection.Horizontal||e===ej.datavisualization.Diagram.FlipDirection.Both)&&(o._flipOffsetX=!0),(e===ej.datavisualization.Diagram.FlipDirection.Vertical||e===ej.datavisualization.Diagram.FlipDirection.Both)&&(o._flipOffsetY=!0),o._flipOffsetX&&(o.offsetX=t.offsetX-o.offsetX+t.offsetX),o._flipOffsetY&&(o.offsetY=t.offsetY-o.offsetY+t.offsetY),e===ej.datavisualization.Diagram.FlipDirection.None&&delete o._flip):this._updateFlipOffset(o,e),this._updateAssociatedConnectorEnds(o,this.nameTable)},_updateSwimlaneSize:function(t,e){var i,a,n,o,s,r;if(t)if(e.height&&(this._comparePropertyValues(t,"height",e),i=e.height-t.height,this._comparePropertyValues(t,"offsetY",{offsetY:t.offsetY+i/2})),e.width&&(this._comparePropertyValues(t,"width",e),i=e.width-t.width,this._comparePropertyValues(t,"offsetX",{offsetX:t.offsetX+i/2})),t.isSwimlane&&(e.height||e.width)){if((o=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,t)).length>0&&(a=this.nameTable[this._getChild(o[o.length-1])])){if("vertical"===t.orientation){if(e.width&&e.width>t.width&&(a.minWidth=a.width+e.width-t.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,a,!0)),e.height)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],e.height>=t.height&&(r.minHeight=e.height)}else{if(e.width)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],e.width>=t.width&&(r.minWidth=e.width);e.height&&e.height>t.height&&(a.minHeight=a.height+e.height-t.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,a,!0))}ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,t,!0),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,t)}}else if(t.isLane&&(e.height||e.width)){if(n=this.nameTable[t.parent.split("laneStack")[0]],o=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,n),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),n&&"vertical"===n.orientation){if(e.width&&(e.minWidth=e.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,t,!0)),e.height)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],e.height>=r.height&&(r.minHeight=e.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,r,!0))}else{if(e.width)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],e.width>=r.width&&(r.minWidth=e.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,r,!0));e.height&&(e.minHeight=e.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,t,!0))}ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,n)}},_updateShape:function(t,e){var i,a,n,o,s,r=!1;return e.type&&(this._comparePropertyValues(t,"type",e),t.type=t._shape=e.type,r=!0),e.shape&&(this._comparePropertyValues(t,"shape",e),t.shape=t._shape=e.shape,r=!0),"bpmn"!=t.type?(e.cornerRadius!=undefined&&(this._comparePropertyValues(t,"cornerRadius",e),t.cornerRadius=e.cornerRadius,r=!0),e.pathData&&(this._comparePropertyValues(t,"pathData",e),t.pathData=e.pathData,r=!0),e.templateId!==undefined&&(t.templateId=e.templateId,r=!0),e.html!==undefined&&(this._comparePropertyValues(t,"html",e),t.html=e.html,r=!0),e.contentId!==undefined&&(this._comparePropertyValues(t,"contentId",e),t.contentId=e.contentId,r=!0),e.source&&(this._comparePropertyValues(t,"source",e),t.source=e.source,r=!0),e.textBlock&&(this._comparePropertyValues(t,"textBlock",e),t.textBlock=e.textBlock,r=!0),e.points&&(this._comparePropertyValues(t,"points",e),t.points=e.points,r=!0),r&&(t.children&&delete t.children,t=ej.datavisualization.Diagram.NodeType(t,this),(i=document.getElementById(t.name+"_parentdiv"))&&i.parentNode.removeChild(i),ej.datavisualization.Diagram.DiagramContext.setNodeShape(t,this),this._clearSelection(!0),this._addSelection(t,!0))):(a=$.extend(!0,{},this.nameTable[t.name]),e.event&&(this._comparePropertyValues(t,"event",e),a.event=e.event,r=!0),e.trigger&&(this._comparePropertyValues(t,"trigger",e),a.trigger=e.trigger,r=!0),e.gateway&&(this._comparePropertyValues(t,"gateway",e),a.gateway=e.gateway,r=!0),e.data&&(this._comparePropertyValues(t,"data",e),a.data=$.extend(a.data,e.data),r=!0),e.activity&&(this._comparePropertyValues(t,"activity",e),a.activity=e.activity,r=!0),e.task!==undefined&&(this._comparePropertyValues(t,"task",e),a.task=$.extend(a.task,e.task),r=!0),e.annotation!==undefined&&(this._comparePropertyValues(t,"annotation",e),a.annotation=$.extend(a.annotation,e.annotation),r=!0),e.subProcess!==undefined&&(this._comparePropertyValues(t,"subProcess",e),a.subProcess=$.extend(a.subProcess,e.subProcess),r=!0),e.direction&&(this._comparePropertyValues(t,"direction",e),a.direction=e.direction,r=!0),r&&(n=this._svg.getElementById(t.name).nextSibling,this._removeElement(t),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[t.name]),this._nodes=$.extend(!0,[],this.nodes()),t="bpmn"==(t=ej.datavisualization.Diagram.NodeType(a,this)).type&&t.container?ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t):this._getNewGroup(t),this._initGroupNode(t),this.nameTable[t.name]=t,this.nodes().push(t),t.parent&&((o=this.nameTable[t.parent])&&(s=this._getChildIndexFromParent(o,t.name),o.children[s]=t)),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(t),ej.datavisualization.Diagram.DiagramContext.renderGroup(t,this),n&&this._svg.getElementById(t.name).parentNode.insertBefore(this._svg.getElementById(t.name),this._svg.getElementById(n.id)),this._clearSelection(!0),this._addSelection(t,!0))),t},_getChildIndexFromParent:function(t,e){for(var i,a=0;a<t.children.length;a++)if((i="object"==typeof(i=t.children[a])?i.name:i)===e)return a;return null},_updateObject:function(t){var e,i,a,n;if(t)if("pseudoGroup"==t.type)for(a=0,n=(i=this._getChildren(t.children)).length;a<n;a++)e=this.nameTable[this._getChild(i[a])],ej.datavisualization.Diagram.DiagramContext.update(e,this);else t.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[t.parent],this),ej.datavisualization.Diagram.DiagramContext.update(t,this)},_udatePhaseSize:function(t,e){var i,a,n,o,s,r,l=this.nameTable[this._getChild(t.children[1])];if("vertical"===t.orientation){if(l.minWidth!=e.phaseSize){if(l.width=l.maxWidth,l.minWidth=e.phaseSize,i=l.maxWidth-e.phaseSize,a=e.phaseSize/l.maxWidth,l.maxWidth=e.phaseSize,this.scale(l,a,1e-4,ej.datavisualization.Diagram.Point(l.offsetX,l.offsetY),this.nameTable),l.children&&l.children.length>0)for(s=0;s<l.children.length;s++)(r=this.nameTable[this._getChild(l.children[s])])&&this.scale(r,a,1e-4,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);this.nameTable[this._getChild(t.children[2])].marginLeft-=i}}else if("horizontal"===t.orientation&&l.minHeight!=e.phaseSize){if(l.height=l.maxHeight,l.minHeight=e.phaseSize,n=l.maxHeight-e.phaseSize,o=(o=e.phaseSize/l.maxHeight)===1/0?0:o,l.maxHeight=e.phaseSize,this.scale(l,1e-4,o,ej.datavisualization.Diagram.Point(l.offsetX,l.offsetY),this.nameTable),l.children&&l.children.length>0)for(s=0;s<l.children.length;s++)(r=this.nameTable[this._getChild(l.children[s])])&&this.scale(r,1e-4,o,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);this.nameTable[this._getChild(t.children[2])].marginTop-=n}},_updateLane:function(t,e){var i,a,n,o;t&&e&&(e.header&&(this._comparePropertyValues(this.getNode(t.name),"header",e),t.children&&t.children.length>0&&((i=this._getChild(t.children[0]))&&(a=this.nameTable[i]),a&&(this.updateLabel(a.name,a.labels[0],e.header),e.header.fillColor&&e.header.fillColor!=a.fillColor&&this.updateNode(a.name,{fillColor:e.header.fillColor})))),e.fillColor&&e.fillColor!=t.fillColor&&(this._comparePropertyValues(t,"fillColor",e),this.updateNode(t.name,{fillColor:e.fillColor})),(e.minHeight&&e.minHeight!=t.minHeight||e.minWidth&&e.minWidth!=t.minWidth)&&(e.minHeight&&(this._comparePropertyValues(t,"minHeight",e),t.minHeight=e.minHeight),e.minWidth&&(this._comparePropertyValues(t,"minWidth",e),t.minWidth=e.minWidth),(n=this.nameTable[t.parent])&&((o=this.nameTable[n.parent])&&ej.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(this,o)),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,o),ej.datavisualization.Diagram.SvgContext.updateSelector(o,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)),e.constraints&&e.constraints!=t.constraints&&(this._comparePropertyValues(t,"constraints",e),t.constraints=e.constraints))},_updateLastPhase:function(t,e,i){var a,n,o,s;t.isSwimlane&&t.phases&&1==t.phases.length&&(a=0,n=this.nameTable[this._getChild(t.phases[0])],"horizontal"===t.orientation?(n.offset=t.minWidth-a,this.updateNode(this.nameTable["phaseStack"+this._getChild(t.phases[0])].name,{width:t.minWidth-a}),i&&(s=ej.datavisualization.Diagram.Util.bounds(t),this.updateNode(this.nameTable["phaseStack"+this._getChild(t.phases[0])].name,{offsetX:s.x+t.width/2}))):"vertical"===t.orientation&&(n.offset=t.minHeight-a,o=n.offset-a,o-=e.header?e.header.height:50,this.updateNode(this.nameTable["phaseStack"+this._getChild(t.phases[0])].name,{height:o}),i&&(s=ej.datavisualization.Diagram.Util.bounds(t),this.updateNode(this.nameTable["phaseStack"+this._getChild(t.phases[0])].name,{offsetY:(e.header?e.header.height:50)/2+s.y+t.height/2}))))},_updateSwimlane:function(t,e,i){var a,n,o,s,r,l,d,h;for(o in e.header&&t.children&&t.children.length>0&&((a=this._getChild(t.children[0]))&&(n=this.nameTable[a]),n&&(this._comparePropertyValues(this.getNode(t.name),"header",e),this.updateLabel(n.name,n.labels[0],e.header),e.header.fillColor&&e.header.fillColor!=n.fillColor&&this.updateNode(n.name,{fillColor:e.header.fillColor}))),e)t[o]&&e[o]!==t[o]&&("offsetX"===o?(this._comparePropertyValues(this.getNode(t.name),"offsetX",e),s=e.offsetX-t.offsetX,this._outOfBoundsOnNudge(t,s,0)&&this._translate(t,s,0,this.nameTable)):"offsetY"===o?(this._comparePropertyValues(this.getNode(t.name),"offsetY",e),r=e.offsetY-t.offsetY,this._outOfBoundsOnNudge(t,0,r)&&this._translate(t,0,r,this.nameTable)):"minWidth"!==o&&"minHeight"!==o&&"maxwidth"!==o&&"maxHeight"!==o&&"width"!=o&&"height"!=o&&"phaseSize"!=o&&(t[o]=e[o]));if(e.phases&&e.phases.length>0)for(d=0;d<e.phases.length;d++)(g=this.nameTable[this._getChild(e.phases[d])])&&this._updateSwimlanePhase(g,e.phases[d],!0);if(i&&(e.phaseSize||0===e.phaseSize)&&e.phaseSize!==t.phaseSize){this._comparePropertyValues(this.getNode(t.name),"phaseSize",e),e.phaseSize!=t.phaseSize&&!0;var g,c=this.nameTable[t.name+"phaseStack"],u=this.nameTable[t.name+"laneStack"],m=e.phaseSize-t.phaseSize;for(d=0;d<c.children.length;d++)(g=this.nameTable[this._getChild(c.children[d])])&&(e.phaseSize=0===e.phaseSize?1e-4:e.phaseSize,"horizontal"===t.orientation?g.height=e.phaseSize:g.width=e.phaseSize);t.phaseSize+=m,"horizontal"===t.orientation?u.marginTop+=m:u.marginLeft+=m,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,c,null,t)}if(e.lanes&&e.lanes.length>0)for(d=0;d<e.lanes.length;d++)(l=this.nameTable[this._getChild(e.lanes[d])])&&this._updateLane(l,e.lanes[d]);i||(e&&e.phaseSize&&(h=!1),e.minHeight&&e.minHeight!=t.minHeight&&(this._comparePropertyValues(this.getNode(t.name),"minHeight",e),t.minHeight=e.minHeight,h=!0),e.minWidth&&e.minWidth!=t.minWidth&&(this._comparePropertyValues(this.getNode(t.name),"minWidth",e),t.minWidth=e.minWidth,h=!0),e.maxHeight&&e.maxHeight!=t.maxHeight&&(this._comparePropertyValues(this.getNode(t.name),"maxHeight",e),t.minHeight=e.maxHeight,h=!0),e.maxWidth&&e.maxWidth!=t.maxWidth&&(this._comparePropertyValues(this.getNode(t.name),"maxWidth",e),t.minWidth=e.maxWidth,h=!0),h&&!this._isUndo&&this._updateLastPhase(t,e),(e.phaseSize||0===e.phaseSize)&&e.phaseSize!=t.phaseSize&&(this._comparePropertyValues(this.getNode(t.name),"phaseSize",e),this._udatePhaseSize(t,e),0===e.phaseSize&&(t.phaseSize=0))),ej.datavisualization.Diagram.DiagramContext.update(t,this),this.selectionList[0]&&this.selectionList[0].name===t.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},updateConnector:function(t,e){var i,a,n,o,s,r;if(t&&(i=this._findConnector(t))){if(this._isUndo||ej.datavisualization.Diagram.Util.canRouteDiagram(this)||this._recordPropertiesChanged(i,e,"connector"),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&e.constraints!==undefined&&(this._comparePropertyValues(i,"constraints",e),i.constraints=e.constraints,!ej.datavisualization.Diagram.Util.canSelect(i)&&ej.datavisualization.Diagram.Util.enableLayerOption(i,"lock",this)&&this._clearSelection(!0)),e.lineColor&&(this._comparePropertyValues(i,"lineColor",e),i.lineColor=e.lineColor),(e.cssClass||""===e.cssClass)&&(this._comparePropertyValues(i,"cssClass",e),i.cssClass=e.cssClass),(e.lineWidth||0===e.lineWidth)&&(this._comparePropertyValues(i,"lineWidth",e),i.lineWidth=e.lineWidth),e.lineDashArray!==undefined&&(this._comparePropertyValues(i,"lineDashArray",e),i.lineDashArray=e.lineDashArray),i.shape&&"umlclassifier"==i.shape.type&&e.shape&&e.shape.multiplicity!=undefined)for(i.shape.multiplicity=e.shape.multiplicity,i.shape.multiplicity=ej.datavisualization.Diagram.UMLConnectorMultiplicity(i.shape.multiplicity),a=ej.datavisualization.Diagram.ClassifierHelper.umlConnectorMultiplicity(i),n=0;n<i.labels.length;n++)i.labels[n].name==i.name+"_sourcelabel"?i.labels[n].text=a[0].text:i.labels[n].name==i.name+"_targetlabel"&&(i.labels[n].text=a[1].text);if(e.opacity!==undefined&&(this._comparePropertyValues(i,"opacity",e),i.opacity=e.opacity),e.cornerRadius!==undefined&&(this._comparePropertyValues(i,"cornerRadius",e),i.cornerRadius=e.cornerRadius),e.lineHitPadding!==undefined&&(this._comparePropertyValues(i,"lineHitPadding",e),i.lineHitPadding=e.lineHitPadding),e.sourcePadding!=undefined&&(this._comparePropertyValues(i,"sourcePadding",e),i.sourcePadding=e.sourcePadding,this._dock(i,this.nameTable)),e.targetPadding!=undefined&&(this._comparePropertyValues(i,"targetPadding",e),i.targetPadding=e.targetPadding,this._dock(i,this.nameTable)),e.visible!=undefined&&(this._comparePropertyValues(i,"visible",e),i.visible=e.visible,e.visible||this._clearSelection()),e.flip!==undefined&&(i.flip=e.flip,ej.datavisualization.Diagram.Util.flipConnector(i,i.flip)),e.bridgeSpace!=undefined&&(this._comparePropertyValues(i,"bridgeSpace",e),i.bridgeSpace=e.bridgeSpace),e.tooltip!==undefined&&(this._comparePropertyValues(i,"tooltip",e),i.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,i.tooltip,{},e.tooltip))),e.segments&&(this._comparePropertyValues(i,"segments",e),e.segments.length>1?(o=$.extend(!0,[],e.segments),i.segments=o):i.segments=e.segments,ej.datavisualization.Diagram.Util._initConnectionEnds(i,this),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments.length&&(s=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Util._initializeSegments(i,s),this._dock(i,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(i,this),i==this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSegments(this._adornerSvg),ej.datavisualization.Diagram.SvgContext.addSegments(this._adornerSvg,this.selectionList[0],this._currZoom))),e.targetDecorator&&(this._comparePropertyValues(i,"targetDecorator",e),r=i.targetDecorator?$.extend(!0,{},i.targetDecorator,e.targetDecorator):ej.datavisualization.Diagram.Decorator(e.targetDecorator),i.targetDecorator=r),e.sourceDecorator&&(this._comparePropertyValues(i,"sourceDecorator",e),r=i.sourceDecorator?$.extend(!0,{},i.sourceDecorator,e.sourceDecorator):ej.datavisualization.Diagram.Decorator(e.sourceDecorator),i.sourceDecorator=r),(e.sourceDecorator||e.targetDecorator)&&(ej.datavisualization.Diagram.DiagramContext.clearDecorators(i,this),ej.datavisualization.Diagram.DiagramContext.renderDecorators(i,this)),e.hasOwnProperty("sourceNode")||e.hasOwnProperty("targetNode")||e.hasOwnProperty("targetPort")||e.hasOwnProperty("sourcePort")||e.hasOwnProperty("targetPoint")||e.hasOwnProperty("sourcePoint")){if(e.sourceNode!==undefined){this._comparePropertyValues(i,"sourceNode",e);var l=this.nameTable[i.sourceNode],d=this.nameTable[e.sourceNode],h=this.nameTable[i.targetNode],g=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(d,h,i,this);e.sourceNode=g?g.name:null,l&&-1!=l.outEdges.indexOf(i.name)&&ej.datavisualization.Diagram.Util.removeItem(l.outEdges,i.name),i.sourceNode=e.sourceNode}if(e.targetNode!==undefined){this._comparePropertyValues(i,"targetNode",e);d=this.nameTable[i.sourceNode],h=this.nameTable[e.targetNode],l=this.nameTable[i.targetNode],g=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(h,d,i,this);e.targetNode=g?g.name:null,l&&-1!=l.inEdges.indexOf(i.name)&&ej.datavisualization.Diagram.Util.removeItem(l.inEdges,i.name),i.targetNode=e.targetNode}e.targetPort!==undefined&&(this._comparePropertyValues(i,"targetPort",e),i.targetPort=e.targetPort),e.sourcePort!==undefined&&(this._comparePropertyValues(i,"sourcePort",e),i.sourcePort=e.sourcePort),e.targetPoint!==undefined&&(this._comparePropertyValues(i,"targetPoint",e),ej.datavisualization.Diagram.Util._setLineEndPoint(i,e.targetPoint,!0)),e.sourcePoint!==undefined&&(this._comparePropertyValues(i,"sourcePoint",e),ej.datavisualization.Diagram.Util._setLineEndPoint(i,e.sourcePoint,!1)),this._updateEdges(i),this._dock(i,this.nameTable)}ej.datavisualization.Diagram.Util.updateBridging(i,this),this._svg&&(this._updateConnectorBridging(i),ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.DiagramContext.updateConnectorStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},_updateDrawType:function(t){var e,i,a,n,o=!1,s=t.tool;if(s&ej.datavisualization.Diagram.Tool.ContinuesDraw?o=!1:s&ej.datavisualization.Diagram.Tool.DrawOnce&&(o=!0),a=t.drawType?t.drawType:this.model.drawType)if("connector"!==a.type||this.activeTool._isPolyline()){if("text"===a.type)this.activateTool("text",o);else if(a.type||a.shape){for(n in e=a.shape?a.shape:a.type,"basic"==a.type?i=ej.datavisualization.Diagram.BasicShapes:"flow"==a.type?i=ej.datavisualization.Diagram.FlowShapes:"arrow"==a.type?i=ej.datavisualization.Diagram.ArrowShapes:"bpmn"==a.type&&(i=ej.datavisualization.Diagram.BPMNShapes),i)if(i[n]==a.shape){e=a.type;break}e&&this._drawToolShape(e,o)}}else{var r=this.model.defaultSettings.connector,l=r&&r.segments&&r.segments.length?r.segments[0].type:"",d=a.segments&&a.segments.length&&a.segments[0].type?a.segments[0].type:l;"bezier"===d||"bezierLine"===this.model.connectorType?this.activateTool("bezierLine",o):"orthogonal"===d||"orthogonalLine"===this.model.connectorType?this.activateTool("orthogonalLine",o):("straight"===d||"straightLine"===this.model.connectorType)&&this.activateTool("straightLine",o)}},update:function(t){var e,i,a,n,o;if(t.scrollSettings&&(this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Unknown,this._setModel({scrollSettings:t.scrollSettings})),t.backgroundColor&&this._setModel({backgroundColor:t.backgroundColor}),t.tool&&(this.activeTool._showAllPorts(!0),e=t.tool,this.tool(e),this._compareModelProperty("tool"),e&ej.datavisualization.Diagram.Tool.ContinuesDraw||e&ej.datavisualization.Diagram.Tool.DrawOnce?this._updateDrawType(t):e&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):e&ej.datavisualization.Diagram.Tool.MultipleSelect&&this.activateTool("select",!1)),t.bridgeDirection)for(this.bridgeDirection("function"==typeof t.bridgeDirection?t.bridgeDirection():t.bridgeDirection),this._compareModelProperty("bridgeDirection"),a=0,n=(i=this.connectors()).length;a<n;a++)(o=i[a])&&ej.datavisualization.Diagram.Util.canBridge(o,this)&&(ej.datavisualization.Diagram.Util.updateBridging(o,this),ej.datavisualization.Diagram.DiagramContext.update(o,this));t.rulerSettings&&this._setModel({scrollSettings:t.scrollSettings})},bringToCenter:function(t){var e=this._currZoom,i=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),a=t.x*e,n=t.y*e,o=t.width*e,s=t.height*e,r=a+o/2-i.width/2,l=n+s/2-i.height/2;ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-r,this._vScrollOffset-l,null,!1)},bringIntoView:function(t){var e,i=0,a=0,n=this._currZoom;t.right=t.right?t.right:t.x+t.width,t.bottom=t.bottom?t.bottom:t.y+t.height;var o=this._hScrollOffset,s=this._vScrollOffset,r=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);t={x:t.x*n,y:t.y*n,width:t.width*n,height:t.height*n,right:t.right*n,bottom:t.bottom*n},e={x:this._hScrollOffset,y:this._vScrollOffset,width:r.width,height:r.height},ej.datavisualization.Diagram.Geometry.containsRect(e,t)||(t.right>-o+r.width&&(i=t.right-r.width),t.x<-o&&(i=t.x),t.bottom>-s+r.height&&(a=t.bottom-r.height),t.y<-s&&(a=t.y),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-i,this._vScrollOffset-a,null,!1))},getBridgeSegment:function(t,e,i,a,n){return"A "+a/2+" "+a/2+"  "+i+" , 1 "+n+" "+e.x+","+e.y},fitToPage:function(t,e,i,a){var n,o,s,r,l,d,h,g,c,u={},m=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);if(i=i||{},i={top:isNaN(i.top)?25:i.top,bottom:isNaN(i.bottom)?25:i.bottom,left:isNaN(i.left)?25:i.left,right:isNaN(i.right)?25:i.right},"pageSettings"==(e=e||"pageSettings")&&this.model.pageSettings.pageWidth&&this.model.pageSettings.pageHeight||this.nodes().length>0||this.connectors().length>0){switch(t=t||"page","custom"!=e&&((s=this._getDigramBounds(e)).x-=this.model.scrollSettings.padding.left,s.y-=this.model.scrollSettings.padding.top,s.width+=this.model.scrollSettings.padding.left+this.model.scrollSettings.padding.right,s.height+=this.model.scrollSettings.padding.top+this.model.scrollSettings.padding.bottom),r=s.width,l=s.height,u.x=(m.width-(i.left+i.right))/r,u.y=(m.height-(i.top+i.bottom))/l,a||this._vScrollbar&&this._vScrollbar._scrollData||this._hScrollbar&&this._hScrollbar._scrollData||(u.x=Math.min(1,u.x),u.y=Math.min(1,u.y)),d=this._hScrollOffset,h=this._vScrollOffset,t){case"width":o=(n=u.x)/this._getCurrentZoom(),d+=(g=(m.width-("content"!=e?s.width:r)*n)/2-s.x*n)+(i.left-i.right)/2*n,h-=this._vScrollOffset*o,h="custom"!=e?h:h+this._vScrollOffset*o;break;case"height":o=(n=u.y)/this._getCurrentZoom(),g=(m.width-("content"!=e?s.width:r)*n)/2-s.x*n,c=(m.height-("content"!=e?s.height:l)*n)/2-s.y*n,d+=g+(i.left-i.right)/2*n,h+=c+(i.top-i.bottom)/2*n;break;case"page":o=(n=Math.min(u.x,u.y))/this._getCurrentZoom(),g=(m.width-("content"!=e?s.width:r)*n)/2-s.x*n,c=(m.height-("content"!=e?s.height:l)*n)/2-s.y*n,d+=g+(i.left-i.right)/2*n,h+=c+(i.top-i.bottom)/2*n}ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,o,d,h,new ej.datavisualization.Diagram.Point(0,0),!0)}else o=1/this._getCurrentZoom(),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,o,this._hScrollOffset,this._vScrollOffset,new ej.datavisualization.Diagram.Point(0,0),!0)},_convertImagesToBuffer:function(t){for(var e,i=[],a=0;a<t.length;a++){var n=t[a].replace(/^data:[a-z]*;,/,"").split(","),o=atob(n[1]),s=new ArrayBuffer(o.length),r=new Uint8Array(s);for(e=0;e<o.length;e++)r[e]=o.charCodeAt(e);i.push(s)}return i},_downloadImage:function(t,e,i,a){var n,o,s,r,l,d,h=ej.browserInfo();if("msie"===h.name&&parseFloat(h.version)<10||"webkit"==h.name)return n="webkit"==h.name?"Safari":"IE-9",alert("Downloading option is not supported in "+n+", Please use the returned data"),a;for(o=0;o<t.length;o++)s=new Blob([t[o]],{type:"application/octet-stream"}),"msie"===h.name||"edge"===h.name?window.navigator.msSaveOrOpenBlob(s,e+"."+i):(r=document.createElement("a"),l=URL.createObjectURL(s),r.href=l,r.setAttribute("download",e+"."+i),document.createEvent?((d=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(d)):r.fireEvent&&r.fireEvent("onclick"))},exportImage:function(t,e){var i,a,n,o,s,r;i=(e=ej.datavisualization.Diagram.ExportSettings(e))&&e.region?e.region:"content",a=e.margin||{},a={top:isNaN(a.top)?25:a.top,bottom:isNaN(a.bottom)?25:a.bottom,left:isNaN(a.left)?25:a.left,right:isNaN(a.right)?25:a.right},n=this._getDigramBounds(i),e.bounds&&(n={x:isNaN(e.bounds.x)?n.x:e.bounds.x,y:isNaN(e.bounds.y)?n.y:e.bounds.y,width:e.bounds.width||n.width,height:e.bounds.height||n.height}),o=document.createElement("img"),s={src:t},ej.datavisualization.Diagram.Util.attr(o,s),r=this,o.onload=function(){var i,o,s,l,d,h,g,c,u=new ej.datavisualization.Diagram.Canvas({width:n.width+(a.left+a.right),height:n.height+(a.top+a.bottom)}),m=u.document.getContext("2d");m.fillStyle=r._pageBackgroundColor(),m.fillRect(0,0,n.width+(a.left+a.right),n.height+(a.top+a.bottom)),m.drawImage(this,n.x,n.y,n.width,n.height,a.left,a.top,n.width,n.height),t=u.document.toDataURL(),e.printOptions?r._raisePrintAction(t,e.printOptions):(m.restore(),i=e.fileName||"diagram",o=e.format||"jpg",e.multiplePage?(e.pageHeight=e.pageHeight?e.pageHeight:r.model.pageSettings.pageHeight,e.pageWidth=e.pageWidth?e.pageWidth:r.model.pageSettings.pageWidth,e.pageHeight=e.pageHeight?e.pageHeight:u.width,e.pageWidth=e.pageWidth?e.pageWidth:u.height,e.pageOrientation=r.model.pageSettings.pageOrientation||e.pageOrientation,a=e.margin||{},s=!1,e.pageOrientation==ej.datavisualization.Diagram.PageOrientations.Landscape?e.pageHeight>e.pageWidth&&(s=!0):e.pageWidth>e.pageHeight&&(s=!0),s&&(l=e.pageWidth,e.pageWidth=e.pageHeight,e.pageHeight=l),e.margin={top:isNaN(a.top)?0:a.top,bottom:isNaN(a.bottom)?0:a.bottom,left:isNaN(a.left)?0:a.left,right:isNaN(a.right)?0:a.right},d=document.createElement("img"),h={id:r.element[0].id+"_printImage",src:t},ej.datavisualization.Diagram.Util.attr(d,h),d.onload=function(){var t=r._getMultipleImage(d,e,!0),a=r._convertImagesToBuffer(t);r._downloadImage(a,i,o,t)}):(g=[t],c=r._convertImagesToBuffer(g),r._downloadImage(c,i,o,g)))}},exportDiagram:function(t){var e,i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C;t=ej.datavisualization.Diagram.ExportSettings(t),n=[],t||(t={});var z=t&&t.region?t.region:"content",S=t&&t.mode?t.mode:"download",P=t.margin||{};if(P={top:isNaN(P.top)?25:P.top,bottom:isNaN(P.bottom)?25:P.bottom,left:isNaN(P.left)?25:P.left,right:isNaN(P.right)?25:P.right},o=this._getDigramBounds(z),t.bounds&&(i=!0,o={x:isNaN(t.bounds.x)?o.x:t.bounds.x,y:isNaN(t.bounds.y)?o.y:t.bounds.y,width:t.bounds.width||o.width,height:t.bounds.height||o.height}),!t.bounds)for(s=this.nodes(),r=0;r<s.length;r++)for(d=(l=s[r]).labels,h=0;h<d.length;h++)(g=d[h]).visible&&(c=ej.datavisualization.Diagram.Util.getLabelbounds(this,l,g)),c&&(o=this._union(c,o));if(o.x-=P.left,o.y-=P.top,o.width+=P.left+P.right,o.height+=P.top+P.bottom,u=t.fileName||"diagram","svg"!=t.format){if(this._setScaleValueforCanvas(t,o),m=this._diagramAsCanvas({bounds:o,margin:P,region:z,scaleX:t._scaleX,scaleY:t._scaleY},i),e=t.format||"jpg",p=a=m.toDataURL(),"data"==S)return a;"msie"===ej.browserInfo().name&&parseFloat(ej.browserInfo().version)<10||(t.multiplePage?(t.pageHeight=t.pageHeight?t.pageHeight:this.model.pageSettings.pageHeight,t.pageWidth=t.pageWidth?t.pageWidth:this.model.pageSettings.pageWidth,t.pageHeight=t.pageHeight?t.pageHeight:m.width,t.pageWidth=t.pageWidth?t.pageWidth:m.height,t.pageOrientation=this.model.pageSettings.pageOrientation||t.pageOrientation,P=t.margin||{},f=!1,t.pageOrientation==ej.datavisualization.Diagram.PageOrientations.Landscape?t.pageHeight>t.pageWidth&&(f=!0):t.pageWidth>t.pageHeight&&(f=!0),f&&(_=t.pageWidth,t.pageWidth=t.pageHeight,t.pageHeight=_),t.margin={top:isNaN(P.top)?0:P.top,bottom:isNaN(P.bottom)?0:P.bottom,left:isNaN(P.left)?0:P.left,right:isNaN(P.right)?0:P.right},v=document.createElement("img"),y={id:this.element[0].id+"_printImage",src:p},ej.datavisualization.Diagram.Util.attr(v,y),b=this,v.onload=function(){var i=b._getMultipleImage(v,t,!0);n=b._convertImagesToBuffer(i),b._downloadImage(n,u,e,a)}):(x=[p],n=this._convertImagesToBuffer(x)))}else{if(e=t.format||"svg",D=a=this._diagramAsSvg({bounds:o,margin:P}),"data"==S)return a;"msie"===ej.browserInfo().name&&parseFloat(ej.browserInfo().version)<10||(C=(new XMLSerializer).serializeToString(D),n.push(C))}"download"==S&&this._downloadImage(n,u,e,a)},_diagramAsSvg:function(t){var e,i,a,n,o,s,r,l,d=new ej.datavisualization.Diagram.Svg({id:"diagram_svg",width:t.bounds.width,height:t.bounds.height});document.body.appendChild(d.document),e=this._svg.document.getElementById(this._canvas.id+"_pageBackground"),e=(e=$(e).find("#pageback")[0]).cloneNode(!0);var h=this._getDigramBounds(),g=h.x,c=h.y,u=h.width,m=h.height;for(d.appendChild(e),e.setAttribute("transform","translate("+-t.bounds.x+", "+-t.bounds.y+")"),e.setAttribute("x",g),e.setAttribute("y",c),e.setAttribute("width",u),e.setAttribute("height",m),e=(e=this._svg.document.getElementById(this._canvas.id+"_diagramLayer")).cloneNode(!0),d.appendChild(e),e.setAttribute("transform","translate("+-t.bounds.x+", "+-t.bounds.y+")"),i=this.nodes(),r=0;r<i.length;r++)if("group"==(a=i[r])._type?ej.datavisualization.Diagram.SvgContext._renderLabelGroup(a,d,this):ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(a,d,this),a.annotation&&a._annotation&&a._annotation.length)for(n=0;n<a._annotation.length;n++)diagram.nameTable[a._annotation[n]]&&(o=diagram.nameTable[a._annotation[n]],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(o,d,this));for(s=this.connectors(),r=0;r<s.length;r++)l=s[r],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(l,d,this);return document.body.removeChild(d.document),d.appendChild(this._svg.document.getElementById(this._canvas.id+"patterndefinition").cloneNode(!0)),d.document},_setScaleValueforCanvas:function(t,e){t._scaleX=1,t._scaleY=1,t.pageHeight=t.pageHeight?t.pageHeight:this.model.pageSettings.pageHeight,t.pageWidth=t.pageWidth?t.pageWidth:this.model.pageSettings.pageWidth;var i=t.pageHeight?t.pageHeight:e.height,a=t.pageWidth?t.pageWidth:e.width;("fill"===t.stretch||"uniform"===t.stretch||"uniformtofill"===t.stretch)&&(t._scaleX=a/e.width,t._scaleY=i/e.height,"uniform"===t.stretch?t._scaleX=t._scaleY=Math.min(t._scaleX,t._scaleY):"uniformtofill"===t.stretch&&(t._scaleX=t._scaleY=Math.max(t._scaleX,t._scaleY)),e.width=a,e.height=i),e.x*=t._scaleX,e.y*=t._scaleY},_diagramAsCanvas:function(t){var e,i,a,n,o,s,r,l,d,h,g=t.margin,c=a=t.bounds,u=this._pageBackgroundColor(),m=new ej.datavisualization.Diagram.Canvas({id:"mycanvas",width:c.width,height:c.height});if(m._diagram=this,m._scaleX=t.scaleX,m._scaleY=t.scaleY,(n=m.document.getContext("2d")).fillStyle=this._backgroundColor(),n.translate(-c.x,-c.y),n.fillRect(c.x,c.y,c.width,c.height),(o=this._backgroundImage())&&o.source){(s=new Image).src=o.source;var p=a.width/s.width,f=a.height/s.height,_=a.x,v=a.y,y=a.width,b=a.height,x=ej.datavisualization.Diagram.CanvasContext._isImageExportable(o);"none"!=o.scale&&"none"!=o.alignment?(y=(r="meet"==o.scale?Math.min(p,f):Math.max(p,f))*s.width,b=r*s.height,o.alignment.indexOf("xmid")>-1?_+=(a.width-y)/2:o.alignment.indexOf("xmax")>-1&&(_=_+a.width-y),o.alignment.indexOf("ymid")>-1?v+=(a.height-b)/2:o.alignment.indexOf("ymax")>-1&&(v=v+a.height-b),("none"==this._backgroundColor()||"transparent"==this._backgroundColor())&&(n.fillStyle="white",n.fillRect(a.x*t.scaleX,a.y*t.scaleY,a.width*t.scaleX,a.height*t.scaleY)),x&&n.drawImage(s,_,v,r*s.width,r*s.height)):x&&n.drawImage(s,_,v,a.width,a.height)}else n.fillStyle=u,n.fillRect(a.x*t.scaleX-g.left,a.y*t.scaleY-g.top,a.width*t.scaleX+g.left+g.right,t.scaleY*a.height+g.top+g.bottom);for(l=this._pageBorderColor(),(d=this._pageBorderWidth())&&(n.strokeStyle="none"==l?"transparent":l,n.lineWidth=d,n.strokeRect(a.x*t.scaleX,a.y*t.scaleY,a.width*t.scaleX,a.height*t.scaleY)),e=this.nodes().concat(this.connectors()),e=this._sortByZIndex(e,!0),this._sortByGroupChildrenZIndex(!0),h=0;h<e.length;h++)i=e[h],ej.datavisualization.Diagram.Util.enableLayerOption(i,"print",this)&&(i.segments?ej.datavisualization.Diagram.CanvasContext.renderConnector(i,m):"group"!==i._type||i.parent?"node"!==i._type||i.isPhase||i.parent||ej.datavisualization.Diagram.CanvasContext.renderNode(i,m,this):ej.datavisualization.Diagram.CanvasContext.renderGroup(i,m,this));return m.document},_renderCanvasPhase:function(t,e){var i,a,n,o,s,r,l,d,h,g=0,c=0,u=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,t);if(u)for(a=0;a<u.length;a++){if(i=this.nameTable[this._getChild(u[a])],n=this.nameTable[t.name]){(o=this._getChildren(n.children)).length>1&&(s=this.nameTable[o[0]]);var m=ej.datavisualization.Diagram.Util.bounds(n),p=[];m.top,m.left;if("vertical"==i.orientation)for(p.push({x:0,y:0}),p.push({x:m.width,y:0}),ej.datavisualization.Diagram.SvgContext._convertToSVGPoints(p),g=m.x,c=m.y+i.offset,s&&(c+=s.height),r=0,l=p.length;r<l;++r)h=ej.datavisualization.Diagram.Geometry.translate(p[r],g,c),p[r]=h;else for(p.push({x:0,y:s.height?s.height:0}),p.push({x:0,y:m.height}),g=m.x+i.offset,c=m.y,r=0,l=p.length;r<l;++r)h=ej.datavisualization.Diagram.Geometry.translate(p[r],g,c),p[r]=h}for(d=0;d<p.length;d++)(h=p[d]).x*=e._scaleX,h.y*=e._scaleY;ej.datavisualization.Diagram.CanvasContext.renderPhases(i,e,p)}},_getPrintCanvasStyle:function(t,e){var i,a=0,n=0;return t&&(a=t.width,n=t.height),e&&((e.pageHeight||e.pageWidth)&&(n=e.pageHeight?e.pageHeight:n,a=e.pageWidth?e.pageWidth:a),e.pageOrientation&&("landscape"===e.pageOrientation&&n>a?i=a:"portrait"===e.pageOrientation&&a>n&&(i=a),i&&(a=n,n=i))),{height:n,width:a}},_getMultipleImage:function(t,e,i){var a,n,o,s,r,l=[],d=document.createElement("div"),h=this._getPrintCanvasStyle(t,e),g=e.margin,c=g.left,u=g.top,m=g.right,p=g.bottom,f=0,_=0;if(S=h.width+f,P=h.height+_,a=0,n=0,e&&e.multiplePage){if(d.style.height="auto",d.style.width="auto",o=t.height,s=t.width,t){var v,y,b,x=0,D=0,C=0,z=0;do{do{C=h.width,z=h.height,a+h.width>=s&&(C=s-a),n+h.height>=o&&(z=o-n),(y=(b=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint"+x+D,width:h.width,height:h.height})).document.getContext("2d")).drawImage(t,f+a+c,_+n+u,C-m-c,z-p-u,0+c,0+u,C-m-c,z-p-u),a+h.width>=s&&(a-=a-s),v=b.document.toDataURL(),y.restore(),a+=S,i?l.push(v):this._printImage(d,v,x+""+D),x++}while(a<s);D++,x=f=a=0,n+h.height>=o&&(n-=n-o),n+=P}while(n<o)}}else if(!e||"content"!==e.region||e.pageWidth||e.pageHeight){var S,P;f=0,_=0;S=(h=this._getPrintCanvasStyle(t,e)).width,P=h.height,y=(b=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint0",width:t.width,height:t.height})).document.getContext("2d"),r=Math.min(t.width/S,t.height/P),S=t.width*r,P=t.height*r,y.drawImage(t,f+c,_+u,t.width-(m+c),t.height-(u+p),0+c,0+u,S-(m+c),P-(u+p)),v=b.document.toDataURL(),y.restore(),this._printImage(d,v,0)}else(y=(b=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint10",width:t.width,height:t.height})).document.getContext("2d")).drawImage(t,f+c,_+u,t.width-(m+c),t.height-(u+p),0+c,0+u,t.width-(m+c),t.height-(u+p)),v=b.document.toDataURL(),y.restore(),this._printImage(d,v,0);return i?l:d},_printImage:function(t,e,i){var a,n,o;a=document.createElement("img"),n=document.createElement("div"),o={class:"e-diagram-print-page"},ej.datavisualization.Diagram.Util.attr(n,o),o={id:this.element[0].id+"_multiplePrint_img"+i,style:"float:left",src:e},ej.datavisualization.Diagram.Util.attr(a,o),n.appendChild(a),t.appendChild(n)},printImage:function(t,e){var i=(e=e||{}).margin||{};i={top:isNaN(i.top)?0:i.top,bottom:isNaN(i.bottom)?0:i.bottom,left:isNaN(i.left)?0:i.left,right:isNaN(i.right)?0:i.right},e=ej.datavisualization.Diagram.PrintSettings(e),this.exportImage(t,{printOptions:e,region:e.region,margin:i})},_raisePrintAction:function(t,e){var i,a=document.createElement("img"),n={id:this.element[0].id+"_printImage",src:t};ej.datavisualization.Diagram.Util.attr(a,n),i=this,a.onload=function(){var t=i._getMultipleImage(a,e),n=window.open("");null!=n&&(n.document.write("<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page {page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}  </style><title></title></head>"),n.document.write('<BODY onload="setTimeout(function(){window.print();}, 100)">'),n.document.write("<center>"+t.innerHTML+"</center>"),n.document.close())}},print:function(t){t=ej.datavisualization.Diagram.PrintSettings(t);var e=this.exportDiagram({mode:"data",region:t.region,margin:{top:10,bottom:10,left:10,right:10},stretch:t.stretch});this._raisePrintAction(e,t)},save:function(){var t,e,i=this.model.drawingTools,a=this.model.selectedItems.userHandles;for(this.model.drawingTools=null,this.model.selectedItems.userHandles=[],this.nameTable.multipleSelection&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable.multipleSelection),this._nodes=$.extend(!0,[],this.nodes())),this._updateTableNodes(),t=jQuery.extend(!0,{},this.model),e=0;e<t.nodes.length;e++)this._resetValues(t.nodes[e]);for(e=0;e<t.connectors.length;e++)this._resetValues(t.connectors[e]);return delete t.historyManager,ej.version&&(t.version=ej.version),this._updateGroupChildren(t),this.model.drawingTools=i,this.model.selectedItems.userHandles=a,this._checkForNullValues(t),this.model.serializationSettings.preventDefaultValues&&(t=this._optimizeJson(t)),t},_updateDefaults:function(t){var e,i;this.defaultTabels||(this.defaultTabels={},this.defaultTabels.defaults=$.extend(!0,{},this.defaults),this.defaultTabels.defaults.snapSettings.verticalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],this.defaultTabels.defaults.snapSettings.horizontalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],this.defaultTabels.defaults.tooltip=this.defaultTabels.defaults.selectedItems.tooltip=ej.datavisualization.Diagram.TooltipDefaults),t&&t.type&&(this.defaultTabels[t.type]||("group"===t.type&&t.isSwimlane?((e=ej.datavisualization.Diagram.SwimLane({})).phases=[ej.datavisualization.Diagram.Phase({label:{text:"Phase"}})],e.lanes=[ej.datavisualization.Diagram.Lane({})],this.defaultTabels.Swimlane=e):"group"===t.type?this.defaultTabels[t.type]=$.extend(!1,ej.datavisualization.Diagram.Group(this.model.defaultSettings.group?this.model.defaultSettings.group:{type:t.type})):"connector"===t.type?this.defaultTabels[t.type]=ej.datavisualization.Diagram.ConnectorDefaults:"textBlock"===t.type?this.defaultTabels[t.type]=ej.datavisualization.Diagram.TextBlockDefaults:"labels"===t.type||"label"===t.type?this.defaultTabels[t.type]=ej.datavisualization.Diagram.LabelDefaults:"ports"===t.type?this.defaultTabels[t.type]=ej.datavisualization.Diagram.PortDefaults:"basic"===t.type||"flow"===t.type||"arrow"===t.type||"bpmn"===t.type||"text"===t.type||"image"===t.type||"native"===t.type||"html"===t.type||"node"===t.type?((i=ej.datavisualization.Diagram.Node($.extend(!1,{type:t.type},ej.datavisualization.Diagram.NodeBase({type:t.type}),ej.datavisualization.Diagram.NodeType({type:t.type,shape:t.shape},this)))).container&&(i.container=ej.datavisualization.Diagram.Container(i.container)),this.defaultTabels[t.type]=i):("umlclassifier"===t.type||"umlactivity"===t.type)&&(i=ej.datavisualization.Diagram.Node($.extend(!1,{type:t.type},ej.datavisualization.Diagram.NodeBase({type:t.type}),ej.datavisualization.Diagram.NodeType({type:t.type,shape:t.shape,classifier:t.classifier,class:t.class,interface:t.interface,enumeration:t.enumeration},this))),this.defaultTabels[t.type]=i)))},_optimizeJson:function(t){return this._updateDefaults(),this._compareObject(t,this.defaultTabels.defaults)},_updateHistoryManager:function(t){for(var e in t)("push"!==t[e]||"stackLimit"!==t[e]||"pop"!==t[e])&&delete t[e];return t},_compareObject:function(t,e){var i,a,n,o,s,r,l,d,h,g,c;if(t&&e)for(i in t)if(null===(a=t[i])||""===a)delete t[i];else if(t.hasOwnProperty(i))if("_"===i.charAt(0)||"bpmn"===t.type&&"container"===i)delete t[i];else if(n=e[i]===undefined?this.defaultTabels[i]:e[i],a!==undefined&&n!==undefined&&(("collapseIcon"===i||"expandIcon"===i||"layout"===i)&&(a.shape===n.shape&&delete t[i].shape,a.type===n.type&&delete t[i].type),"isSwimlane"!==i&&"classifier"!==i&&"type"!==i&&"shape"!==i&&a===n&&delete t[i]),null!==a&&"object"==typeof a){if(null!==a&&a instanceof Array)if(0===a.length)delete t[i];else for(o in a)if("object"==typeof a[o]){if("labels"===i||"label"===i||"textBlock"===i||"ports"===i){if(this._updateDefaults({type:i}),s=this.defaultTabels[i],t&&"bpmn"===t.type&&"labels"===i&&((s=$.extend(!0,{},s)).offset={x:.5,y:1}),"label"===i&&(s=this.defaultTabels.labels),("labels"===i||"ports"===i)&&this.model.defaultSettings)for(l in r=this.model.defaultSettings)if((d=r[l])&&d[i])for(h in d[i][o])this.defaultTabels[i][h]=d[i][h]}else"children"===i?(this._updateDefaults({type:a[o].type}),s=this.defaultTabels[a[o].type]):(this._updateDefaults(a[o]),s=this.defaultTabels[a[o].type]);a[o].isSwimlane?s=this.defaultTabels.Swimlane:"umlclassifier"!==a[o].type&&("bpmn"!==a[o].type||a[o].container)||delete t[i][o].children,t[i][o]=this._compareObject(a[o],s===undefined?n:s)}else t[i]=this._compareObject(a,n);else if("class"!==i&&"interface"!==i&&"enumeration"!==i){if("commandManager"===i||"contextMenu"===i)if("contextMenu"!==i||this.model.enableContextMenu){if("commandManager"===i){for(c in g=a.commands)g[c]._isDefault&&delete g[c];$.isEmptyObject(a.commands)&&delete t[i].commands}}else delete t[i];t[i]="historyManager"===i?this._updateHistoryManager(a):this._compareObject(a,n)}($.isEmptyObject(a)||0===a.length)&&delete t[i]}return t},_checkForNullValues:function(t){this._checkTargetNull(t.pageSettings)},_checkTargetNull:function(t){for(var e in t)null==t[e]||t[e]==1/0?t[e]=0:"object"==typeof t[e]&&t[e]&&this._checkTargetNull(t[e])},_updateGroupChildren:function(t){var e,i,a,n=[],o=[],s="function"==typeof t.nodes?t.nodes():t.nodes;if(s&&s.length>0)for(a=0;a<s.length;a++)""!==s[a].parent||s[a].isSwimlane?s[a].isSwimlane&&(e=this._getNode(s[a].name),this._isSwimlaneExist=!0,e&&n.push(jQuery.extend(!0,{},e))):(this._updateChildren(s[a]),n.push(jQuery.extend(!0,{},s[a])));if((i="function"==typeof t.connectors?t.connectors():t.connectors)&&i.length>0)for(a=0;a<i.length;a++)o.push(i[a]);t.connectors=o,t.nodes=n},_updateChildren:function(t){var e,i,a,n=[];if(t&&t.children&&t.children.length>0){for(a=0;a<t.children.length;a++)(i=this._getChild(t.children[a]))&&(e=this.nameTable[i]),e&&n.push(jQuery.extend(!0,{},e));t.children=n}},_containsNode:function(t){var e,i;for(t=this._getChild(t),e=null,i=0;i<this.nodes().length;i++)if((e=this.nodes()[i])&&e.name===t)return!0;return null},_updateTableNodes:function(){for(var t,e,i=0;i<this.nodes().length;i++)(t=this.nameTable[this.nodes()[i].name])&&(this.nodes()[i]=t,"group"===t._type&&this._updateTableGroup(t));for(;i<this.connectors().length;i++)(e=this.nameTable[this.connectors()[i].name])&&(this.connectors()[i]=e)},_updateTableGroup:function(t){t.children;for(var e=0;e<t.children.length;e++)t.children[e]=this.nameTable[this._getChild(t.children[e])],t.children[e]&&"group"===t.children[e]._type&&this._updateTableGroup(t.children[e])},upgrade:function(t){var e,i,a,n,o,s;if(t){if(e=Number(t.version),isNaN(e)&&t.version&&(e=t.version.split("."),t.version=e=Number(e[0]+"."+e[1])),t.version)if(e<14.2){if(t.nodes&&e<14.1)for(i=0;i<t.nodes.length;i++)a=t.nodes[i],this.setConstraints(a),a&&("native"===a.type||"image"===a.type||"html"===a.type)&&(a.scale="stretch");if(t.connectors)for(n=0;n<t.connectors.length;n++){if(o=t.connectors[n],e<14.1&&(o.constraints|=ej.datavisualization.Diagram.ConnectorConstraints.PointerEvents,o.labels&&o.labels.length>0))for(s=0;s<o.labels.length;s++)o.labels[s].relativeMode=ej.datavisualization.Diagram.LabelRelativeMode.SegmentBounds;e<14.2&&o&&o.segments&&1===o.segments.length&&"orthogonal"===o.segments[0].type&&(o.segments[0].length=13)}}else t.version;else if(this.commonAPIChanges(t),t.nodes)for(i=0;i<t.nodes.length;i++)t.nodes[i].inEdges||(t.nodes[i].inEdges=[],t.nodes[i].outEdges=[]),t.nodes[i].constraints=ej.datavisualization.Diagram.NodeConstraints.Default;t.version<15.4&&(t.scrollSettings?(t.scrollSettings.minZoom=.25,t.scrollSettings.maxZoom=30):t.scrollSettings={horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,zoomFactor:.2,minZoom:.25,maxZoom:30,padding:{left:0,right:0,top:0,bottom:0}}),t.version=ej.version}},setConstraints:function(t){var e,i,a,n,o;if(t&&"group"==t.type&&!t.isSwimlane)for(t.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,e=0;e<t.children.length;e++)"group"==(o=t.children[e]).type?this.setConstraints(o):o.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents;else if(t&&"group"==t.type&&t.isSwimlane){for(t.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,i=0;i<t.lanes.length;i++)if((a=t.lanes[i]).constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,a.children)for(n=0;n<a.children.length;n++)"group"==(o=a.children[n]).type?this.setConstraints(o):o.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents}else t.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents},commonAPIChanges:function(t){var e,i;if(t.defaultSettings={node:t.nodeDefaults,connectors:t.connectorDefaults},t.connectors)for(e=0;e<t.connectors.length;e++)t.connectors[e].constraints=ej.datavisualization.Diagram.ConnectorConstraints.Default,t.connectors[e].line&&("straight"==t.connectors[e].line.type?(i=[{type:"straight",startPoint:t.connectors[e].line.startPoint,endPoint:t.connectors[e].line.endPoint}],this.commonSourceTargetChanges(t.connectors[e])):"orthogonal"==t.connectors[e].line.type?(i=[{type:"orthogonal",startPoint:t.connectors[e].line.startPoint,endPoint:t.connectors[e].line.endPoint}],this.commonSourceTargetChanges(t.connectors[e])):"bezier"==t.connectors[e].line.type&&(i=[{type:"bezier",startPoint:t.connectors[e].line.startPoint,endPoint:t.connectors[e].line.endPoint,point1:t.connectors[e].line.point1,point2:t.connectors[e].line.point2}],this.commonSourceTargetChanges(t.connectors[e])),t.connectors[e].sourcePoint=t.connectors[e].line.startPoint,t.connectors[e].targetPoint=t.connectors[e].line.endPoint,t.connectors[e].segments=i)},commonSourceTargetChanges:function(t){t.sourceNodeName&&(t.sourceNode=t.sourceNodeName),t.sourceNodePort&&(t.sourcePort=t.sourceNodePort),t.targetNodeName&&(t.targetNode=t.targetNodeName),t.targetPortName&&(t.targetPort=t.targetPortName)},load:function(t){var e,i,a,n,o;if(t&&"NewVersion"===t.version&&(t.version=ej.version),this._isLoad=!0,this._isOptimize=!0,this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this),this.clear(),this._zOrder=0,this.enableContextMenu()&&(!this.model.serializationSettings.preventDefaultValues||t.contextMenu)&&($("#"+this.element[0].id+"_contextMenu").data("ejMenu").destroy(),$("#"+this.element[0].id+"_contextMenu").remove()),t&&t.nodes&&t.nodes.length>0)for(i=t.nodes.length-1;i>=0;i--)(e=t.nodes[i])&&("connector"===e.type||e.segments)&&(t.connectors.push(e),t.nodes.splice(i,1)),e._shape&&(this._isOptimize=!1);if(t&&t.connectors&&t.connectors.length>0)for(i=t.connectors.length-1;i>=0;i--)n=!1,(a=t.connectors[i]).targetNode&&(this._isExist(t,a.targetNode)||(n=!0,t.connectors.splice(i,1))),a.sourceNode&&(this._isExist(t,a.sourceNode)||n||t.connectors.splice(i,1));t.selectedItems&&(t.selectedItems.userHandles=this.model.selectedItems.userHandles?this.model.selectedItems.userHandles:[]),this.upgrade(t),o={nodes:t.nodes?t.nodes:[],connectors:t.connectors?t.connectors:[],commandManager:t.commandManager?t.commandManager:{},contextMenu:t.contextMenu?t.contextMenu:{},snapSettings:t.snapSettings?t.snapSettings:{},historyManager:t.historyManager?t.historyManager:this._initHistoryManager(),backgroundImage:t.backgroundImage?t.backgroundImage:ej.datavisualization.Diagram.BackgroundImage({source:""}),enableAutoScroll:!t.enableAutoScroll||t.enableAutoScroll,autoScrollMargin:t.autoScrollMargin?t.autoScrollMargin:20,layout:t.layout?t.layout:{},pageSettings:t.pageSettings?t.pageSettings:{},click:t.click?t.click:null,connectionChange:t.connectionChange?t.connectionChange:null,defaultSettings:t.defaultSettings?t.defaultSettings:{node:null,connector:null},dataSourceSettings:t.dataSourceSettings?t.dataSourceSettings:{},doubleClick:t.doubleClick?t.doubleClick:null,enableContextMenu:t.enableContextMenu===undefined||t.enableContextMenu,tooltip:t.tooltip?t.tooltip:null,height:t.height?t.height:null,mouseEnter:t.mouseEnter?t.mouseEnter:null,mouseOver:t.mouseOver?t.mouseOver:null,mouseLeave:t.mouseLeave?t.mouseLeave:null,nodeTemplate:t.nodeTemplate?t.nodeTemplate:null,rotationChange:t.rotationChange?t.rotationChange:null,selectedItems:t.selectedItems?t.selectedItems:this.model.selectedItems,width:t.width?t.width:null,constraints:t.constraints,phases:t.phases?t.phases:[],scrollSettings:t.scrollSettings,rulerSettings:t.rulerSettings?t.rulerSettings:this.rulerSettings,serializationSettings:t.serializationSettings?t.serializationSettings:this.serializationSettings},this._tempCommandManager=t.commandManager,t.showTooltip!==undefined&&(o.showTooltip=t.showTooltip),t.tooltipTemplateId!==undefined&&(o.tooltipTemplateId=t.tooltipTemplateId),$("#"+this._id).ejDiagram(o),this._isLoad=!1,delete this._isOptimize,delete this._tempCommandManager},_isExist:function(t,e){for(var i,a,n,o=!1,s=0;t.nodes&&s<t.nodes.length;s++)if(!o&&(i=t.nodes[s]))if(i.isSwimlane){if(i.lanes)for(a=i.lanes,n=0;n<a.length&&!(o=this._checkNodeExist(a[n],e));n++);}else if(o=this._checkNodeExist(i,e))break;return o},_checkNodeExist:function(t,e){var i,a,n,o;if(t.children){for(i=0;i<t.children.length;i++)if(a=t.children[i],this._checkNodeExist(a,e))return!0}else if(this.model.serializationSettings.preventDefaultValues&&t&&(t.subProcess&&t.subProcess.events.length>0||t.task&&t.task.events.length>0))for(n=t.subProcess.events.length>0?t.subProcess.events:t.task.events,o=0;o<n.length;o++)if(n[o].name===e)return!0;return t.name===e},layout:function(){this._isLayoutExecute=!0,this._setLayout(),delete this._isLayoutExecute},_setLayout:function(){this._doLayout(),ej.datavisualization.Diagram.PageUtil._updatePageSize(this),this._clearSelection()},addSelection:function(t,e){var i,a;t&&!this._selectionContains(t)&&(this.model.selectedItems.children.length>0&&!e?((a=this.nameTable.multipleSelection)||(a=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this.nodes().push(a),this.nameTable[a.name]=a),this.model.selectedItems.children.length>1?a.children=this.selectionList[0].children:a.children.push(this.selectionList[0].name),a.children.push(t.name),ej.datavisualization.Diagram.Util._updateGroupBounds(a,this,null,!0),i=a):i=t,this._hasSelection()&&this._clearSelection(!0),a&&this.nameTable.multipleSelection===undefined&&!1===e&&(this.nodes().push(a),this.nameTable[a.name]=a),this._addSelection(i))},clearSelection:function(){this._clearSelection()},removeSelection:function(t){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&t&&(t=this.nameTable[t.name],this.selectionList[0]==t||"pseudoGroup"==this.selectionList[0].type&&1==this.selectionList[0].children.length?this._clearSelection():"pseudoGroup"==this.selectionList[0].type&&this._collectionContains(t.name,this.selectionList[0].children)&&(-1!=this.selectionList[0].children.indexOf(t.name)?ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,t.name):ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,t),ej.datavisualization.Diagram.Util.removeItem(this.model.selectedItems.children,t),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),this._updateSelectionHandle()))},updateSelectedObject:function(t,e){var i=this.nameTable[t];i&&ej.datavisualization.Diagram.Util.enableLayerOption(i,"lock",this)&&(ej.datavisualization.Diagram.Util.canSelect(i)||i._isHeader)&&(this.activeTool.selectedObject=i),e&&e.isSwimlane&&(this.activeTool.selectedObject=e)},updateSelection:function(t){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&this._updateSelectionHandle(t)},activateTool:function(t,e){this.tools[t]&&(this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this._toolToActivate=t,this.activeTool=this.tools[this._toolToActivate],this.activeTool.singleAction=!0,(!1===e||"panTool"===t)&&(this.activeTool.singleAction=!1)),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(this._currentCursor="pointer",this.activeTool.startPoint=ej.datavisualization.Diagram.Point(0,0),this.activeTool._isMouseDown=!1),this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&(this.activeTool.singleAction?this.tool(this.tool()|ej.datavisualization.Diagram.Tool.DrawOnce):this.tool(this.tool()|ej.datavisualization.Diagram.Tool.ContinuesDraw),this.activeTool._showAllPorts()),this._drawingTool=!0},deactivateTool:function(){this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this.tool()&ej.datavisualization.Diagram.Tool.DrawOnce&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.DrawOnce),this.tool()&ej.datavisualization.Diagram.Tool.ContinuesDraw&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.ContinuesDraw),this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._mousedown=!1,this._currentCursor="pointer"):(this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate],this.tool(ej.datavisualization.Diagram.Tool.SingleSelect|ej.datavisualization.Diagram.Tool.MultipleSelect)),this.activeTool._removeHighLighter(),ej.datavisualization.Diagram.SvgContext._removePortHighlighter(this._adornerSvg,this._adornerLayer)},updateLabel:function(t,e,i){var a,n;if(t&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&((a=this._findNode(t))||(a=this._findConnector(t)),i&&e&&!i.name||e.name==i.name||a&&a._isHeader&&e.name===i.name+"_label")){if(a){for(n in i.templateId&&e.templateId&&e.templateId!=i.templateId&&ej.datavisualization.Diagram.DiagramContext.setLabelTemplate(a,e,this),this._isUndo||this._recordPropertiesChanged(a,i,"label",e),"text"!==a.type&&(e=this._findLabel(a,e.name)),i.name=e.name,this._comparePropertyValues(a,"labels",i),i)e.hasOwnProperty(n)&&(e[n]="object"==typeof i[n]?$.extend(!0,{},e[n],i[n]):i[n]);i.wrapText!==undefined&&(e.wrapping=i.wrapText?"wrapwithoverflow":"nowrap"),a.segments||"text"!==a.type?(ej.datavisualization.Diagram.DiagramContext.updateLabelStyle(a,e,this),ej.datavisualization.Diagram.DiagramContext.updateLabel(a,e,this)):"text"===a.type&&ej.datavisualization.Diagram.DiagramContext.updateTextBlock(a,e,this),this._updateQuad(a)}i.mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&this.startLabelEdit(a,e)}return e},startLabelEdit:function(t,e){var i,a,n;if(t){for(i=0;i<this.selectionList.length;i++)if((a=this.selectionList[i])!==t&&void 0!==a.labels.length)for(n=0;n<a.labels.length;n++)a.labels[n].mode=ej.datavisualization.Diagram.LabelEditMode.View;e||"text"!==t.type||(e=t.textBlock),this._setLabelEditing(e)?this._startEdit(t):this._endEdit()}},_setSelectorConstraints:function(t){this.model.selectedItems.constraints=t,this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,t,undefined,this),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,"pseudoGroup"==this.selectionList[0].type,this._currZoom,this._adornerLayer,this))},_raiseGroupChangeEvent:function(t,e,i,a){var n={};return n.element=t||null,n.oldParent=e||null,n.newParent=i||null,n.cause=a||null,e!=i&&this._raiseEvent("groupChange",n),n},group:function(){var t,e,i,a,n,o,s;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type){for(t=[],e=0;e<this.selectionList[0].children.length;e++)t.push(this.nameTable[this._getChild(this.selectionList[0].children[e])]);for(this._sortByZIndex(t,!0),a=ej.datavisualization.Diagram.Util.randomId(),n=new ej.datavisualization.Diagram.Group({name:a,rotateAngle:this.selectionList[0].rotateAngle}),this._clearSelection(!0),e=0;e<t.length;e++)this._isUndo=!0,n.children.push(t[e]),t[e].parent&&((o=this.nameTable[t[e].parent])&&ej.datavisualization.Diagram.Util.removeChildFromGroup(o.children,t[e])),t[e].parent=a,ej.datavisualization.Diagram.Util.removeItem(this.selectionList,t[e].name),t[e].segments?(ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[t[e].name]),this._connectors=$.extend(!0,[],this.connectors())):(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[t[e].name]),this._nodes=$.extend(!0,[],this.nodes())),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t[e].name],t[e]),"html"==t[e].type?(i=document.getElementById(t[e].name+"_parentdiv")).parentNode.removeChild(i):"group"===t[e]._type&&this._checkForHtmlNode(t[e]),(i=this._svg.document.getElementById(t[e].name))&&i.parentNode.removeChild(i),this._removeElement(t[e]),this._raiseGroupChangeEvent(t[e],o,n,"group");ej.datavisualization.Diagram.Util.clear(this.selectionList),n=this._getNewGroup(n),this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Unknown,this._isGroupNode=!0,this.add(n),s={type:"groupchanged",object:n,actionType:"group",category:"internal"},this.addHistoryEntry(s),this._isUndo=!1,delete this._isGroupNode}},_checkForHtmlNode:function(t){for(var e,i,a=this._getChildren(t.children),n=0;n<a.length;n++)(e=this.nameTable[a[n]])&&("group"===e._type?this._checkForHtmlNode(e):"html"==e.type&&(i=document.getElementById(e.name+"_parentdiv")).parentNode.removeChild(i))},_removeChildren:function(t,e){for(var i,a=this._getChildren(t.children),n=0;n<a.length;n++)(i=this.nameTable[a[n]])&&(t.isLane||i.inEdges.length>0||i.outEdges.length>0?(this._disConnect(i,e),this._removeConnector(i,e)):i.segments?(this._removeEdges(i),i.sourceNode=i.sourcePort=i.targetNode=i.targetPort=null):this._disConnect(i,e,!0),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),i),this._nodes=$.extend(!0,[],this.nodes()),"group"===i._type?(this._removeChildren(i,e),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]):(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]),this._removeElement(i))},ungroup:function(){var t,e,i,a,n,o,s,r,l;if(this.selectionList[0]&&"group"===this.selectionList[0]._type&&this.selectionList[0].canUngroup&&!this.selectionList[0].isSwimlane&&!this.selectionList[0].isLane){for(this._isUndo=!0,t=this.selectionList[0].children,a=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],i=this.selectionList[0],$("#"+this.selectionList[0].name)[0].parentNode.removeChild($("#"+this.selectionList[0].name)[0]),this._removeElement(this.selectionList[0]),this._checkForHtmlNode(this.selectionList[0]),this._clearSelection(),ej.datavisualization.Diagram.Util.clear(this.selectionList),e=0;e<t.length;e++)(r=this.nameTable[this._getChild(t[e])]).parent&&(s=this.nameTable[r.parent]),$(a).children("#"+r.name)[0]&&a.removeChild($(a).children("#"+r.name)[0]),r&&(r.parent&&(r.parent=null),r.segments?((n=r).parent="",this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),-1===this.connectors().indexOf(n)&&(this.connectors().push(n),this._connectors=$.extend(!0,[],this.connectors()))):((n=r).parent="","group"===n._type?(this._updateChildrenEdges(n),(n.isLane||n.isSwimlane)&&(n.width=0,n.height=0),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this)):ej.datavisualization.Diagram.DiagramContext.renderNode(n,this),-1===this.nodes().indexOf(n)&&(this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()))),r.parent&&(o=this.nameTable[r.parent]),this._raiseGroupChangeEvent(r,s,o,"unGroup"));ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(i.name)),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),l={type:"groupchanged",object:i,actionType:"ungroup",category:"internal"},this.addHistoryEntry(l),this._isUndo=!1}},nudge:function(t,e){var i,a={up:{x:0,y:-(e=e||1)},down:{x:0,y:e},left:{x:-e,y:0},right:{x:e,y:0}}[t];"up"===t?i="down":"down"===t?i="up":"left"===t?i="right":"right"===t&&(i="left"),a&&this.selectionList[0]&&!this.selectionList[0].isLane&&!this.selectionList[0].isPhase&&(this._isUndo||this.addHistoryEntry({type:"nudge",object:this.selectionList[0],undoDirection:i,redoDirection:t,values:e,category:"internal"}),this._nudge(this.selectionList[0],a.x,a.y,t))},selectAll:function(){var t,e,i,a,n,o=null;for(this._clearSelection(!0),t=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),i=0,a=(e=this.nodes()).length;i<a;i++)ej.datavisualization.Diagram.Util.canSelect(e[i])&&ej.datavisualization.Diagram.Util.enableLayerOption(e[i],"lock",this)&&((o=this.nameTable[e[i].name])&&""==o.parent&&"pseudoGroup"!=o.type&&o.visible&&t.children.push(o.name));for(i=0,a=(n=this.connectors()).length;i<a;i++)ej.datavisualization.Diagram.Util.canSelect(n[i])&&ej.datavisualization.Diagram.Util.enableLayerOption(n[i],"lock",this)&&""==n[i].parent&&n[i].visible&&t.children.push(n[i].name);ej.datavisualization.Diagram.Util._updateGroupBounds(t,this),t.children.length>1?(this.nodes().push(t),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[t.name]=t,this._addSelection(t)):1===t.children.length&&this._addSelection(this.nameTable[t.children[0]])},align:function(t){var e,i,a,n,o,s;if(this.selectionList[0]&&("group"===this.selectionList[0].type||"pseudoGroup"==this.selectionList[0].type)&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var r,l=this.nameTable[this.selectionList[0].name].children,d=[],h=this._findCornerNodes();if("left"===t?r=h.left:"right"===t?r=h.right:"top"===t?r=h.top:"bottom"===t&&(r=h.bottom),r?e=ej.datavisualization.Diagram.Util.bounds(r):("center"===t||"middle"===t)&&(e=ej.datavisualization.Diagram.Util.bounds(this.selectionList[0])),e){for(this._associatedConnectorsUpdate=!0,n=0,o=0,i=0;i<l.length;i++)s=this.nameTable[this._getChild(l[i])],a=ej.datavisualization.Diagram.Util.bounds(s),"left"===t?n=-(a.x-e.x):"right"===t?n=-(a.x+a.width-(e.x+e.width)):"top"===t?o=-(a.y-e.y):"bottom"===t?o=-(a.y+a.height-(e.y+e.height)):"center"===t?n=-(a.x+a.width/2-(e.x+e.width/2)):"middle"===t&&(o=-(a.y+a.height/2-(e.y+e.height/2))),this._moveNode(n,o,s),this._updateContainerOnNudge(s),d.push({object:s,delta:{x:n,y:o}});for(delete this._associatedConnectorsUpdate,i=0;i<l.length;i++)(s=this.nameTable[this._getChild(l[i])]).segments||this._updateAssociateConnector(s);ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}this.addHistoryEntry({type:"alignCommand",values:d,category:"internal",object:this.selectionList[0]})}},_updateAssociateConnector:function(t){var e,i,a;if(t.children&&(i=t.children))for(a=0;a<i.length;a++)(e=this.nameTable[this._getChild(i[a])])&&this._updateAssociateConnector(e);ej.datavisualization.Diagram.SvgContext._updateAssociatedConnector(t,this._svg,this)},sameSize:function(){var t,e;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,a=this.nameTable[this._getChild(this.selectionList[0].children[0])],n=ej.datavisualization.Diagram.Util.bounds(a),o=[];for(this._isSizingCommand=!0,t=0;t<i.length;t++)(e=this.nameTable[this._getChild(i[t])]).segments||(o.push({object:e,values:{width:e.width||e._width||0,height:e.height||e._height||0}}),this.updateNode(e.name,{width:n.width,height:n.height}));delete this._isSizingCommand,this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:o}),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameHeight:function(){var t,e;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,a=this.nameTable[this._getChild(this.selectionList[0].children[0])],n=[],o=ej.datavisualization.Diagram.Util.bounds(a);for(this._isSizingCommand=!0,t=0;t<i.length;t++)(e=this.nameTable[this._getChild(i[t])]).segments||(n.push({object:e,values:{width:e.width||e._width||0,height:e.height||e._height||0}}),this.updateNode(e.name,{height:o.height}));delete this._isSizingCommand,this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:n}),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameWidth:function(){var t,e;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,a=this.nameTable[this._getChild(this.selectionList[0].children[0])],n=ej.datavisualization.Diagram.Util.bounds(a),o=[];for(this._isSizingCommand=!0,t=0;t<i.length;t++)(e=this.nameTable[this._getChild(i[t])]).segments||(o.push({object:e,values:{width:e.width||e._width||0,height:e.height||e._height||0}}),this.updateNode(e.name,{width:n.width}));delete this._isSizingCommand,this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:o}),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},spaceDown:function(){var t,e,i,a,n,o,s;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByYvalue(this.selectionList[0].children),e=t.length,i=[],t&&e>2)){this._findCornerNodes().top;var r=0,l=null,d=null;for(n=0;n<t.length;n++)l=null,d=null,l=this.nameTable[this._getChild(t[n])],d=this.nameTable[this._getChild(t[Number(n)+1])],l&&d&&(o=ej.datavisualization.Diagram.Util.bounds(l),r+=(s=ej.datavisualization.Diagram.Util.bounds(d)).y-(o.y+o.height));for(a=r/(e-1),n=0;n<t.length;n++)l=this.nameTable[this._getChild(t[n])],d=this.nameTable[this._getChild(t[Number(n)+1])],l&&d&&(o=ej.datavisualization.Diagram.Util.bounds(l),s=ej.datavisualization.Diagram.Util.bounds(d),this._comparePropertyOnAlign(d,0,o.bottom-s.top+a),this._translate(d,0,o.bottom-s.top+a,this.nameTable),i.push({object:d,delta:{x:0,y:o.bottom-s.top+a}}),this._updateQuad(this,d),this._updateNodeMargin(d),ej.datavisualization.Diagram.DiagramContext.update(d,this));this.addHistoryEntry({type:"spacingCommand",values:i,category:"internal",object:this.selectionList[0]})}},spaceAcross:function(){var t,e,i,a,n,o,s;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByXvalue(this.selectionList[0].children),e=t.length,i=[],t&&e>2)){this._findCornerNodes().left;var r=0,l=null,d=null;for(n=0;n<t.length;n++)l=null,d=null,l=this.nameTable[this._getChild(t[n])],d=this.nameTable[this._getChild(t[Number(n)+1])],l&&d&&(o=ej.datavisualization.Diagram.Util.bounds(l),r+=(s=ej.datavisualization.Diagram.Util.bounds(d)).x-(o.x+o.width));for(a=r/(e-1),0,n=0;n<t.length;n++)l=this.nameTable[this._getChild(t[n])],d=this.nameTable[this._getChild(t[Number(n)+1])],l&&d&&(o=ej.datavisualization.Diagram.Util.bounds(l),s=ej.datavisualization.Diagram.Util.bounds(d),this._comparePropertyOnAlign(d,o.right-s.left+a,0),this._translate(d,o.right-s.left+a,0,this.nameTable),i.push({object:d,delta:{x:o.right-s.left+a,y:0}}),this._updateQuad(this,d),this._updateNodeMargin(d),ej.datavisualization.Diagram.DiagramContext.update(d,this));this.addHistoryEntry({type:"spacingCommand",values:i,category:"internal",object:this.selectionList[0]})}},sendBackward:function(){var t,e,i,a,n,o;if(this.selectionList[0]&&"pseudoGroup"!=this.selectionList[0].type&&(i=this.selectionList[0])){for(t=this._findOverlapNode(i,"sendBackward"),this._sortByZIndex(t),a=0;a<t.length;a++)if(i.zOrder>t[a].zOrder){e=t[a];break}n=i.zOrder,e&&(o=e.zOrder,this._comparePropertyValues(i,"zOrder",{zOrder:o},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(n,o,i,e),this.addHistoryEntry({type:"zOrder",command:"back",start:o,end:n,nearestNode:e,object:i,category:"internal"}))}},_sendElementsToBack:function(t,e,i,a){for(var n,o,s=e;s<t;s++)""!=i.parent?(n=this._findObjectByIndex(s,!0))&&(n.zOrder+=1):(n=this._findObjectByIndex(s))&&(n.zOrder+=1);this._deleteZorderProcess(),""!=i.parent?i.parent&&(o=this.nameTable[i.parent],this._findChildren(o,i.name).zOrder=e):this._findObjectByName(i.name).zOrder=e;var r=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],l=$(r).find("#"+i.name+"_label")[0],d=$(r).find("#"+i.name+"_parentdiv")[0],h=$(r).find("#"+a.name+"_parentdiv")[0];h||(h=$(r).find("#"+a.name)[0]),h&&d&&h.parentNode.insertBefore(d,h),h&&l&&h.parentNode.insertBefore(l,h),this._svg.getElementById(a.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(a.name)),this._updateSelectionHandle()},_deleteZorderProcess:function(){for(var t,e=this.nodes(),i=0;i<e.length;i++)e[i]._isProcessed&&delete e[i]._isProcessed;for(t=this.connectors(),i=0;i<t.length;i++)t[i]._isProcessed&&delete t[i]._isProcessed},_bringElementsToFront:function(t,e,i,a){for(var n,o,s=e;s>t;s--)""!=i.parent?(n=this._findObjectByIndex(s,!0))&&(n.zOrder-=1):(n=this._findObjectByIndex(s))&&(n.zOrder-=1);this._deleteZorderProcess(),i.parent?(o=this.nameTable[i.parent],this._findChildren(o,i.name).zOrder=e):this._findObjectByName(i.name).zOrder=e;var r=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],l=$(r).find("#"+i.name+"_label")[0],d=$(r).find("#"+a.name+"_label")[0],h=$(r).find("#"+i.name+"_parentdiv")[0],g=$(r).find("#"+a.name+"_parentdiv")[0];g||(g=$(r).find("#"+a.name)[0]),d&&h&&d.parentNode.insertBefore(h,d.nextSibling),h&&l&&h.parentNode.insertBefore(l,h.nextSibling),g&&h&&g.parentNode.insertBefore(h,g.nextSibling),this._svg.getElementById(a.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(a.name).nextSibling),this._updateSelectionHandle()},moveForward:function(){var t,e,i,a,n,o;if(this.selectionList[0]&&"pseudoGroup"!=this.selectionList[0].type&&(i=this.selectionList[0])){for(t=this._findOverlapNode(i,"moveForward"),this._sortByZIndex(t),a=t.length-1;a>=0;a--)if(i.zOrder<t[a].zOrder){e=t[a];break}n=i.zOrder,e&&(o=e.zOrder,this._comparePropertyValues(i,"zOrder",{zOrder:o},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(n,o,i,e),this.addHistoryEntry({type:"zOrder",command:"front",start:o,end:n,nearestNode:e,object:i,category:"internal"}))}},sendToBack:function(){var t,e,i=this.selectionList[0];if(i&&"pseudoGroup"!=i.type){var a,n=this._findOverlapNode(i,"sendToBack"),o=this._sortByZIndex(n),s=i.zOrder,r=i.zOrder;for(e=0;e<o.length;e++)o[e].zOrder<r&&(0==e&&(a=o[e]),r=o[e].zOrder,t=o[e]);t&&(this._comparePropertyValues(i,"zOrder",{zOrder:r},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(s,r,i,t),this.addHistoryEntry({type:"zOrder",command:"back",start:r,end:s,nearestNode:a,object:i,category:"internal"}))}},bringToFront:function(){var t,e,i=this.selectionList[0];if(i&&"pseudoGroup"!=i.type){var a=this._findOverlapNode(i,"bringToFront"),n=this._sortByZIndex(a),o=i.zOrder,s=i.zOrder;for(e=0;e<n.length;e++)n[e].zOrder>s&&(s=n[e].zOrder,t=n[e]);t&&(this._comparePropertyValues(i,"zOrder",{zOrder:s},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(o,s,i,t),this.addHistoryEntry({type:"zOrder",command:"front",start:s,end:o,nearestNode:n[e-1],object:i,category:"internal"}))}},_getChildFromCollection:function(t,e){if(t&&t.length>0&&e)for(var i=0;i<t.length;i++)if(t[i].name===e)return t[i]},_updateNameTable:function(t){var e,i;if(t.children&&t.children.length>0)for(e=0;e<t.children.length;e++)(i="object"==typeof t.children[e]?t.children[e]:null)&&(this.nameTable[i.name]=i,i.children&&i.children.length>0&&this._updateNameTable(i))},_recordPageSettingsChanged:function(t){var e=t.redoObject;t.isUndo&&(e=t.undoObject),e&&this.updatePageSettings(e)},_recordMultiRotationChanged:function(t){ej.datavisualization.Diagram.canvasHelper._undoMultiRotateNode(this,t)},_recordMultiPinPointChanged:function(t){ej.datavisualization.Diagram.canvasHelper._undoMultiDragNode(this,t)},_recordMultiSizeChanged:function(t){ej.datavisualization.Diagram.canvasHelper._undoMultiResizeNode(this,t)},undo:function(){var t;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&ej.datavisualization.Diagram.Util.canUndo(this)){if(this._getHistoryList(),this._isUndo=!0,(t=this.getUndoEntry())&&("closeGroup"==t.type?this._groupUndo=!0:"startGroup"==t.type?this._groupUndo=!1:this._undo(t),this._groupUndo)){for(t=this.getUndoEntry();t&&"startGroup"!=t.type&&(this._undo(t),this._groupUndo);)t=this.getUndoEntry();delete this._groupUndo}this._isUndo=!1}},redo:function(){this._isUndo=!0;var t=this.getRedoEntry();if(t&&("startGroup"==t.type?this._groupRedo=!0:this._redo(t),this._groupRedo)){for(t=this.getRedoEntry();t&&"closeGroup"!=t.type;)this._isUndo=!0,this._redo(t),t=this.getRedoEntry();delete this._groupRedo}this._isUndo=!1},_ComparehistoryChangeEvent:function(t,e){var i,a,n,o,s,r={source:[],changes:[]};switch(e.type){case"positionchanged":case"rotationchanged":case"sizechanged":r=this._getPseudoGroupElements(t,e);break;case"endpointchanged":this._UndoRedo?(a=this._historyChangeEvent(e.undoObject,e.redoObject,e),i={type:e.type,oldValues:a.changes?a.changes.oldValues:a.oldValues,newValues:a.changes?a.changes.newValues:a.newValues,cancel:!1},r.source.push(e.undoObject)):(a=this._historyChangeEvent(e.redoObject,e.undoObject,e),i={type:e.type,oldValues:a.changes?a.changes.oldValues:a.oldValues,newValues:a.changes?a.changes.newValues:a.newValues,cancel:!1},r.source.push(e.redoObject)),r.changes.push(i);break;case"collectionchanged":"remove"==e.changeType&&(i={type:e.type,addedItems:[],deletedItems:[t]}),"insert"==e.changeType&&(i={type:e.type,addedItems:[t],deletedItems:[]}),r.changes.push(i),r.source.push(t);break;case"labelchanged":i=this._UndoRedo?{type:e.type,newValues:{text:e.previousLabelValue},oldValues:{text:e.updatedLabelValue}}:{type:e.type,newValues:{text:e.updatedLabelValue},oldValues:{text:e.previousLabelValue}},r.changes.push(i),r.source.push(e.shape);break;case"labelcollectionchanged":i={type:e.type,source:e.shape,addedItems:[e.label],deletedItems:[]},r.changes.push(i),r.source.push(e.shape);case"groupchanged":i="group"==e.actionType?{type:e.type,source:e.object,addedItems:[e.object],deletedItems:[]}:{type:e.type,source:e.object,addedItems:[],deletedItems:[e.object]},r.changes.push(i),r.source.push(e.object);break;case"phasepositionchanged":this._UndoRedo?(i={type:e.type,newValues:{offset:e.undoObject.offset},oldValues:{offset:e.redoObject.offset}},r.source.push(e.undoObject)):(i={type:e.type,newValues:{offset:e.redoObject.offset},oldValues:{offset:e.undoObject.offset}},r.source.push(e.redoObject)),r.changes.push(i);break;case"phasecollectionchanged":i=e.isAdded?{type:e.type,addedItems:[e.phase],deletedItems:[]}:{type:e.type,addedItems:[],deletedItems:[e.phase]},r.source.push(e.phase),r.changes.push(i);break;case"propertiesChanged":i=this._propertyChangeEventValues(e),r.source.push(i.source),r.changes.push(i.changes);break;case"portscollectionchanged":"insert"==e.changeType&&(i={type:e.type,addedItems:[e.collection],deletedItems:[]}),"remove"==e.changeType&&(i={type:e.type,addedItems:[],deletedItems:[e.collection]}),r.source.push(e.object),r.changes.push(i);break;case"nudge":l={},d={},"label"!==e.object._type?this._UndoRedo?("left"==e.undoDirection&&(l.offsetX=e.object.offsetX-e.values,d.offsetX=e.object.offsetX),"right"==e.undoDirection&&(l.offsetX=e.object.offsetX+e.values,d.offsetX=e.object.offsetX),"up"==e.undoDirection&&(l.offsetY=e.object.offsetY-e.values,d.offsetY=e.object.offsetY),"down"==e.undoDirection&&(l.offsetY=e.object.offsetY+e.values,d.offsetY=e.object.offsetY),i={type:e.type,newValues:l,oldValues:d}):("left"==e.redoDirection&&(l.offsetX=e.object.offsetX-e.values,d.offsetX=e.object.offsetX),"right"==e.redoDirection&&(l.offsetX=e.object.offsetX+e.values,d.offsetX=e.object.offsetX),"up"==e.redoDirection&&(l.offsetY=e.object.offsetY-e.values,d.offsetY=e.object.offsetY),"down"==e.redoDirection&&(l.offsetY=e.object.offsetY+e.values,d.offsetY=e.object.offsetY),i={type:e.type,newValues:l,oldValues:d}):i=this._labelNudge(e),r.source.push(e.object),r.changes.push(i);break;case"spacingCommand":case"alignCommand":var l={},d={},h=[],g=[];for(o=0;o<e.values.length;o++)(s=e.values[o]).object.segments?(d={sourcePoint:(n=$.extend(!0,{},s.object)).sourcePoint,targetPoint:n.targetPoint},g.push(d),ej.datavisualization.Diagram.Util._translateLine(n,s.delta.x,s.delta.y),l={sourcePoint:n.sourcePoint,targetPoint:n.targetPoint},h.push(l)):(l={offsetX:s.object.offsetX-s.delta.x,offsetY:s.object.offsetY-s.delta.y},h.push(l),d={offsetX:s.object.offsetX,offsetY:s.object.offsetY},g.push(d));i={type:e.type,newValues:h,oldValues:g},r.source.push(e.object),r.changes.push(i);break;case"sizeCommand":l={},d={},h=[],g=[];for(o=0;o<e.values.length;o++)l={width:(s=e.values[o]).values.width,height:s.values.height},h.push(l),d={width:s.object.width,height:s.object.height},g.push(d);i={type:e.type,newValues:h,oldValues:g},r.source.push(e.object),r.changes.push(i);break;case"zOrder":i={type:e.type,source:e.object,newValues:{zOrder:e.end},oldValues:{zOrder:e.object.zOrder}},r.source.push(e.object),r.changes.push(i)}return r},_labelNudge:function(t){var e=this.findNode(t.object._parent),i={},a={},n=this._UndoRedo?t.undoDirection:t.redoDirection;return"left"==n||"right"==n?(i.offsetX="left"==n?t.object.offset.x-t.values/e.width:t.object.offset.x+t.values/e.width,a.offsetX=t.object.offset.x):("up"==n||"down"==n)&&(i.offsetY="up"==n?t.object.offset.y-t.values/e.height:t.object.offset.y+t.values/e.height,a.offsetY=t.object.offset.y),{type:t.type,newValues:i,oldValues:a}},_getPseudoGroupElements:function(t,e){var i,a,n,o,s,r,l=this._UndoRedo||!this._isUndo?e.undoObject.node:e.redoObject.node;if(n={source:[],changes:[]},t&&"pseudoGroup"==t.type)for(s=this._getChildren(t.children),a=0;a<s.length;a++)i=this.nameTable[this._getChild(s[a])],r=this._UndoRedo||!this._isUndo?e.undoObject.childTable[s[a]]:e.redoObject.childTable[s[a]],(o=this._isUndo?this._historyChangeEvent(r,i,e):this._historyChangeEvent(i,r,e)).source&&n.source.push(o.source),o.changes&&n.changes.push(o.changes);else(o=this._isUndo?this._historyChangeEvent(l,t,e):this._historyChangeEvent(t,l,e)).source&&n.source.push(o.source),o.changes&&n.changes.push(o.changes);return n},_propertyChangeEventValues:function(t){var e,i,a,n,o,s=[],r=t.updateValues?t.updateValues:t.values;for(o in i="label"==t.elementType?t.label:"port"==t.elementType?t.port:t.object,a={},n={},r)i[o]!=r[o]&&(a[o]=i[o],n[o]=r[o]);return e={type:t.type,newValues:n,oldValues:a,deletedItems:[],addedItems:[]},s.push(e),{changes:s,source:i}},_historyChangeEvent:function(t,e,i){var a,n,o={type:i.type,deletedItems:[],addedItems:[],oldValues:{},newValues:{}};return t.offsetX!=e.offsetX&&(o.oldValues.offsetX=e.offsetX,o.newValues.offsetX=t.offsetX),t.offsetY!=e.offsetY&&(o.oldValues.offsetY=e.offsetY,o.newValues.offsetY=t.offsetY),t.width!=e.width&&(o.oldValues.width=e.width,o.newValues.width=t.width),t.height!=e.height&&(o.oldValues.height=e.height,o.newValues.height=t.height),t.rotateAngle!=e.rotateAngle&&(o.oldValues.rotateAngle=e.rotateAngle,o.newValues.rotateAngle=t.rotateAngle),(t.sourcePoint||e.sourcePoint)&&(a=t.sourcePoint||{},n=e.sourcePoint||{},(a.x!=n.x||a.y!=n.y)&&(o.oldValues.sourcePoint=e.sourcePoint,o.newValues.sourcePoint=t.sourcePoint)),(t.targetPoint||e.targetPoint)&&(a=t.targetPoint||{},n=e.targetPoint||{},(a.x!=n.x||a.y!=n.y)&&(o.oldValues.targetPoint=e.targetPoint,o.newValues.targetPoint=t.targetPoint)),{changes:o,source:e}},_undo:function(t){var e,i,a,n,o,s,r,l,d,h,g,c=[];if(this._UndoRedo=!0,t)if("internal"==t.category){if(!(e=t.object||(t.undoObject?t.undoObject.node||t.undoObject:undefined)||t.shape)&&t.phase&&(e=t.phase),e&&t.undoObject&&t.undoObject.node&&(e=this.nameTable[e.name]||e),!e)return void this.undo();if(this.model.historyManager.undoStack.length>0&&(i=this.model.historyManager.undoStack.splice(0,1),this.model.historyManager.redoStack.splice(0,0,i[0])),(c=this._ComparehistoryChangeEvent(e,t)).cause=ej.datavisualization.Diagram.HistoryChangeCause.Undo,this._raiseEvent("historyChange",c),e&&e.parent&&(a="object"==typeof e.parent?e.parent.name:e.parent),a&&!e.isLane&&!this.nameTable[a])return this._isUndo=!1,void this.undo();switch(t.type){case"pagesettingschanged":o={isUndo:!0,undoObject:t.undoObject,redoObject:t.redoObject},this._recordPageSettingsChanged(o);break;case"positionchanged":t.swimlaneMultiSelection?(t.undo=!0,this._recordMultiPinPointChanged(t)):(n={object:t.undoObject,isMultipleNode:t.isMultipleNode},this._recordPinPointChanged(n)),this._undoredoUpdateRouting(t.undoObject.connectors);break;case"rotationchanged":t.swimlaneMultiSelection?(t.undo=!0,this._recordMultiRotationChanged(t)):(n={object:t.undoObject,isMultipleNode:t.isMultipleNode},this._recordRotationChanged(n)),this._undoredoUpdateRouting(t.undoObject.connectors);break;case"sizechanged":t.undo=!0,t.swimlaneMultiSelection?this._recordMultiSizeChanged(t):(n={object:t.undoObject,isMultipleNode:t.isMultipleNode},this._recordSizeChanged(n,t)),this._undoredoUpdateRouting(t.undoObject.connectors);break;case"endpointchanged":n={undoObject:t.undoObject,redoObject:t.redoObject,removePortType:t.removePortType,removedPort:t.removedPort,isMultipleNode:t.isMultipleNode,_isUndo:!0},this._recordEndPointChanged(n);break;case"collectionchanged":if("insert"==t.changeType&&!this.nameTable[t.object.name]&&"pseudoGroup"!==t.object._type){if(this._groupUndo)return;this._isUndo=!1,this.undo()}(n={changeType:t.changeType,childTable:t.childTable,edgeTable:t.edgeTable,isUndo:!0,sourcePorts:t.sourcePorts,targetPorts:t.targetPorts,index:t.index}).object=jQuery.extend(!0,{},t.object),this._recordCollectionChanged(n,t)&&(t.sourcePorts=n.sourcePorts,t.targetPorts=n.targetPorts,t.edgeTable=n.edgeTable,t.childTable=n.childTable);break;case"labelchanged":n={object:t.shape,label:t.previousLabelValue,index:t.index?t.index:0},this._recordLabelChanged(n);break;case"labelpositionchanged":case"labelsizechanged":case"labelrotationchanged":t.undo=!0,this._recordLabelPositionChanged(t);break;case"labelcollectionchanged":t.isUndo=!0,this.labelcollectionchanged(t);break;case"groupchanged":n={object:t.object,isUndo:!0,actionType:t.actionType},this._recordGroupChanged(n);break;case"phasepositionchanged":t.undo=!0,this._recordPhasesizeChanged(t);break;case"phasecollectionchanged":(t=$.extend(!0,{},{phase:t.phase,group:t.group,isAdded:t.isAdded,phaseObject:t.phaseObject,islastPhase:t.islastPhase})).undo=!0,this._recordPhaseCollectionChanged(t);break;case"propertiesChanged":(l=this.nameTable[t.object.name])&&(s=this._getModifiedProperties(l,t.values,t[t.elementType]),"node"==t.elementType?this.updateNode(l.name,t.values):"connector"==t.elementType?this.updateConnector(l.name,t.values):"label"==t.elementType?t.label=this.updateLabel(l.name,t.label,t.values):"port"==t.elementType&&this.updatePort(l.name,t.port,t.values),t.values=s);break;case"portpositionchanged":t.undo=!0,this._recordPortPositionChanged(t);break;case"portscollectionchanged":t.isUndo=!0,this._recordPortsCollectionChanged(t);break;case"nudge":this._recordNudgingChanges(e,t);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(t);break;case"sizeCommand":this._recordSizeCommandChanges(t);break;case"swapLane":(t=jQuery.extend(!0,{},{undoObject:t.undoObject,redoObject:t.redoObject,moveIndex:t.moveIndex,insertIndex:t.currentIndex})).undo=!0,ej.datavisualization.Diagram.canvasHelper._undoSwap(this,t);break;case"zOrder":r=t.start,l=this.nameTable[t.object.name],this._comparePropertyValues(l,"zOrder",{zOrder:t.end}),"back"==t.command?(this._bringElementsToFront(t.start,t.end,t.object,t.nearestNode),t.command="front"):(this._sendElementsToBack(t.start,t.end,t.object,t.nearestNode),t.command="back"),t.nearestNode=this._findObjectByIndex(r),d=t.start,t.start=t.end,t.end=d,this._deleteZorderProcess()}t.activeLabel?(this._clearSelection(!0),this._addSelection(t.activeLabel,!0)):this.selectionList.length&&e&&this.selectionList[0].name!=e.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[e.name],!0))}else this.model.historyManager.undo&&("string"==typeof(h=this.model.historyManager.undo)&&(h=ej.util.getObject(h,window)),$.isFunction(h)&&((g=h(t.data))&&(t.data=g)))},_undoredoUpdateRouting:function(t){var e,i,a;if(ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&t)for(e=Object.keys(t),i=0;i<e.length;i++)(a=this.nameTable[e[i]])._undoSegments=t[e[i]].segments,this._resetConnectorPoints(a,null),delete a._undoSegments},_redo:function(t){var e,i,a,n,o,s,r,l,d,h,g,c=[];if(this._UndoRedo=!1,t)if("internal"==t.category){if(!(e=t.object||(t.undoObject?t.undoObject.node||t.undoObject:undefined)||t.shape)&&t.phase&&(e=t.phase),e&&t.undoObject&&t.undoObject.node&&(e=this.nameTable[e.name]||e),!e)return void this.redo();if(this.model.historyManager.redoStack.length>0&&(i=this.model.historyManager.redoStack.splice(0,1),this.model.historyManager.undoStack.splice(0,0,i[0])),(c=this._ComparehistoryChangeEvent(e,t)).cause=ej.datavisualization.Diagram.HistoryChangeCause.Redo,this._raiseEvent("historyChange",c),e&&e.parent&&(a="object"==typeof e.parent?e.parent.name:e.parent),a&&!this.nameTable[a])return this._isUndo=!1,void this.redo();switch(t.type){case"pagesettingschanged":n={isUndo:!1,undoObject:t.undoObject,redoObject:t.redoObject},this._recordPageSettingsChanged(n);break;case"positionchanged":t.swimlaneMultiSelection?(t.undo=!1,this._recordMultiPinPointChanged(t)):(o={object:t.redoObject,isMultipleNode:t.isMultipleNode},this._recordPinPointChanged(o)),this._undoredoUpdateRouting(t.redoObject.connectors);break;case"rotationchanged":t.swimlaneMultiSelection?(t.undo=!1,this._recordMultiRotationChanged(t)):(o={object:t.redoObject,isMultipleNode:t.isMultipleNode},this._recordRotationChanged(o)),this._undoredoUpdateRouting(t.redoObject.connectors);break;case"sizechanged":t.undo=!1,t.swimlaneMultiSelection?this._recordMultiSizeChanged(t):(o={object:t.redoObject,isMultipleNode:t.isMultipleNode},this._recordSizeChanged(o)),this._undoredoUpdateRouting(t.redoObject.connectors);break;case"endpointchanged":o={undoObject:t.undoObject,redoObject:t.redoObject,removePortType:t.removePortType,removedPort:t.removedPort,isMultipleNode:t.isMultipleNode,_isUndo:!1},this._recordEndPointChanged(o);break;case"collectionchanged":(o={changeType:t.changeType,childTable:t.childTable,edgeTable:t.edgeTable,isUndo:!1,sourcePorts:t.sourcePorts,targetPorts:t.targetPorts,index:t.index}).object=jQuery.extend(!0,{},t.object),this._recordCollectionChanged(o,t.object);break;case"labelchanged":o={object:t.shape,label:t.updatedLabelValue,index:t.index?t.index:0},this._recordLabelChanged(o);break;case"labelpositionchanged":case"labelsizechanged":case"labelrotationchanged":t.undo=!1,this._recordLabelPositionChanged(t);break;case"labelcollectionchanged":t.isUndo=!1,this.labelcollectionchanged(t);break;case"groupchanged":o={object:t.object,actionType:t.actionType,isUndo:!1},this._recordGroupChanged(o);break;case"phasepositionchanged":t.undo=!1,this._recordPhasesizeChanged(t);break;case"phasecollectionchanged":(t=$.extend(!0,{},{phase:t.phase,group:t.group,phaseObject:t.phaseObject,islastPhase:t.islastPhase,isAdded:t.isAdded})).undo=!1,this._recordPhaseCollectionChanged(t);break;case"propertiesChanged":(l=this.nameTable[t.object.name])&&(s=this._getModifiedProperties(l,t.values,t[t.elementType]),"node"==t.elementType?this.updateNode(l.name,t.values):"connector"==t.elementType?this.updateConnector(l.name,t.values):"label"==t.elementType?t.label=this.updateLabel(l.name,t.label,t.values):"port"==t.elementType&&this.updatePort(l.name,t.port,t.values),t.values=s);break;case"portpositionchanged":t.undo=!1,this._recordPortPositionChanged(t);break;case"portscollectionchanged":t.isUndo=!1,this._recordPortsCollectionChanged(t);break;case"nudge":this._recordNudgingChanges(e,t,!0);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(t);break;case"sizeCommand":this._recordSizeCommandChanges(t);break;case"swapLane":(t=jQuery.extend(!0,{},{undoObject:t.undoObject,redoObject:t.redoObject,moveIndex:t.moveIndex,insertIndex:t.currentIndex})).undo=!1,ej.datavisualization.Diagram.canvasHelper._undoSwap(this,t);break;case"zOrder":r=t.start,l=this.nameTable[t.object.name],this._comparePropertyValues(l,"zOrder",{zOrder:t.end}),"back"==t.command?(this._bringElementsToFront(t.start,t.end,t.object,t.nearestNode),t.command="front"):(this._sendElementsToBack(t.start,t.end,t.object,t.nearestNode),t.command="back"),t.nearestNode=this._findObjectByIndex(r),d=t.start,t.start=t.end,t.end=d,this._deleteZorderProcess()}t.activeLabel?(this._clearSelection(!0),this._addSelection(t.activeLabel,!0)):this.selectionList.length&&e&&this.selectionList[0].name!=e.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[e.name],!0))}else this.model.historyManager.redo&&("string"==typeof(h=this.model.historyManager.redo)&&(h=ej.util.getObject(h,window)),$.isFunction(h)&&((g=h(t.data))&&(t.data=g)))},_startGroupAction:function(){this.addHistoryEntry({type:"startGroup",category:"internal"})},_closeGroupAction:function(){this.addHistoryEntry({type:"closeGroup",category:"internal"})},addHistoryEntry:function(t){var e,i,a,n,o;if(!this._preventHistoryEntry&&!this.model.historyManager.suspend){if(this.model.historyManager.canLog&&("string"==typeof(e=this.model.historyManager.canLog)&&(e=ej.util.getObject(e,window)),$.isFunction(e)&&(n=this.getNode(t.object||t.undoObject&&t.undoObject.node||t.shape),0==e(o={changes:(i=this._ComparehistoryChangeEvent(n,t)).changes.length?i.changes[0]:null,source:i.source.length?this.getNode(i.source[0]):null}))))return;"internal"!=t.category&&(t={data:t}),this._historyList.canUndo&&this._historyList.currentEntry&&(this._historyList.currentEntry.data||"internal"==this._historyList.currentEntry.category)&&((a=this._historyList.currentEntry).next?a.previous&&(a.next.previous=null,a.next=t,t.previous=a):(a.next=t,t.previous=a)),this._historyList.currentEntry=t,this.model.historyManager.stackLimit&&(this._historyList.currentEntry&&this._historyList.currentEntry.previous&&!this._lastbefore?this._lastbefore=t:this._historyList.currentEntry.previous||(this._lastbefore=null,this._historyCount=0),this._historyCount<this.model.historyManager.stackLimit?this._historyCount++:this._lastbefore&&(this._lastbefore.previous&&delete this._lastbefore.previous,this._lastbefore.next&&(this._lastbefore=this._lastbefore.next))),n=t.object||(t.redoObject?t.redoObject.node||t.redoObject:undefined)||t.shape,(o=this._ComparehistoryChangeEvent(n,t)).cause=ej.datavisualization.Diagram.HistoryChangeCause.CustomAction,this._getHistoryList(),this._raiseEvent("historyChange",o),this._historyList.canUndo=!0,this._historyList.canRedo=!1}},removeHistoryEntry:function(t){var e,i,a,n,o;if(null!=this._historyList.currentEntry){if(e=this._historyList.currentEntry)if(e==t)i=e.previous,a=e.next,this._historyList.currentEntry=a||i;else{for(n=e.next;n;){if(n==t){i=n.previous,a=n.next;break}n=n.next}for(o=e.previous;o;){if(o==t){i=o.previous,a=o.next;break}o=o.previous}}i&&a?(i.next=a,a.previous=i):i?i.next=null:a&&(a.previous=null)}},canRemoveHistoryEntry:function(t){return"internal"!=t.category},clearHistory:function(){var t=this._historyList;t.currentEntry=null,t.canUndo=!1,t.canRedo=!1,this.model.historyManager.undoStack=[],this.model.historyManager.redoStack=[]},_getHistroyObject:function(t,e){e&&"startGroup"!==e.type&&"closeGroup"!==e.type&&t.push({redoObject:e.redoObject?e.redoObject:null,undoObject:e.undoObject?e.undoObject:null,type:e.type?e.type:null,isMultipleNode:e.isMultipleNode?e.isMultipleNode:null,category:e.category?e.category:""})},_getHistoryList:function(){var t,e,i=[],a=[],n=this._historyList.currentEntry;for(n=this._historyList.currentEntry,this._historyList.canUndo||0===this.model.historyManager.undoStack.length?this._getHistroyObject(i,n):this._getHistroyObject(a,n);n&&n.previous;)t=n.previous,this._getHistroyObject(i,t),n=n.previous;for(n=this._historyList.currentEntry;n&&n.next;)e=n.next,this._getHistroyObject(a,e),n=n.next;this.model.historyManager.undoStack=i,this.model.historyManager.redoStack=a},getUndoEntry:function(){var t,e=null,i=this._historyList;return i.canUndo&&(e=i.currentEntry,(t=i.currentEntry.previous)?(i.currentEntry=t,i.canRedo||(i.canRedo=!0)):(i.canRedo=!0,i.canUndo=!1)),e},getRedoEntry:function(){var t,e=null,i=this._historyList;return i.canRedo&&((t=i.currentEntry.previous||i.canUndo?i.currentEntry.next:i.currentEntry)&&(i.currentEntry=t,i.canUndo||(i.canUndo=!0),t.next||(i.canRedo=!1,i.canUndo=!0)),e=i.currentEntry),e},cut:function(){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=0,this._setClipboard(),this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,this._delete(),delete this._multipleAction)},insertLabel:function(t,e,i){var a,n,o,s;ej.datavisualization.Diagram.Util.isPageEditable(this)&&((a=this.nameTable[t])&&e&&((n=(n="node"==this.getObjectType(a)?this.model.defaultSettings.node:this.model.defaultSettings.connector)||{})&&n.labels&&a.labels&&n.labels[i!==undefined?i:a.labels.length]&&(e=$.extend(!0,{},n.labels[i!==undefined?i:a.labels.length],e)),n.labels=n.labels?n.labels:[],(e=ej.datavisualization.Diagram.Label(e))._parent=t,(o=n.labels).splice(),this._collectionContains(e,a.labels)||a.labels.splice(i,0,e),s={element:a,index:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:o,newValue:a.labels},this._raisePropertyChange(s),ej.datavisualization.Diagram.DiagramContext.addLabel(a,e,this,i),this._isUndo||this.addHistoryEntry({type:"labelcollectionchanged",shape:a,label:e,isUndo:!0,category:"internal",index:i})))},addLabel:function(t,e){var i,a,n,o;ej.datavisualization.Diagram.Util.isPageEditable(this)&&((i=this.nameTable[t])&&e&&((n="node"==this.getObjectType(i)?this.model.defaultSettings.node:this.model.defaultSettings.connector)&&n.labels&&i.labels&&n.labels[i.labels.length]&&(e=$.extend(!0,{},n.labels[i.labels.length],e)),(e=ej.datavisualization.Diagram.Label(e))._parent=t,a=i.labels,i.labels.push(e),o={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:a,newValue:i.labels},this._raisePropertyChange(o),ej.datavisualization.Diagram.DiagramContext.addLabel(i,e,this),this.addHistoryEntry({type:"labelcollectionchanged",shape:i,label:e,isUndo:!0,category:"internal"})))},removeLabels:function(t,e){var i,a,n,o=[];if(e&&e.length>0){if((i=this.nameTable[t])&&i.labels&&i.labels.length>0)for(a=e.length-1;a>=0;a--)for(n=i.labels.length-1;n>=0;n--)i.labels[n].name===e[a].name&&(ej.datavisualization.Diagram.SvgContext.deleteLabel(i,i.labels[n],this),o.push({index:n,label:$.extend(!0,{},i.labels[n])}),i.labels.splice(n,1));this._isUndo||this.addHistoryEntry({type:"labelcollectionchanged",shape:i,labels:o,isLabelRemove:!0,isUndo:!0,category:"internal"})}},_initLayer:function(){for(var t,e=this.model.layers,i=0;i<e.length;i++)e[i]=ej.datavisualization.Diagram.Layers(e[i]),(!(t=e[i]).visible||t.lock)&&(t.active=!1),this._updateLayer(e[i])},_updateLayer:function(t){for(var e,i=t.objects,a=0;a<i.length;a++)e=i[a],this._isUpdate(this.nameTable[e],t)&&this.updateNode(e,{})},_findLayer:function(t){for(var e,i=this.model.layers,a=0;a<i.length;a++)i[a].name===t&&(e=i[a]);return e},_checkGroupChild:function(t){for(var e,i,a,n,o=this._getChildren(t.children),s=0;o&&s<o.length;s++)if(e=this.nameTable[o[s]],i=this.model.layers,e.length>0){for(a=0;a<i.length;a++)(n=i[a].objects.indexOf(e.name))>-1&&(this.model.layers[a].objects.splice(n,1),this._updateLayer(i[a]));e.children&&this._checkGroupChild(e)}},addLayers:function(t){for(var e,i,a,n=0;n<t.length;n++)if(this.model.layers,t[n]=ej.datavisualization.Diagram.Layers(t[n]),(!(e=t[n]).visible||e.lock)&&(e.active=!1),!this._findLayer(e.name)&&(this.model.layers.push(e),e.objects&&e.objects.length))for(i=0;e&&i<e.objects.length;i++)(a=this.nameTable[e.objects[i]])&&("group"===a.type&&this._checkGroupChild(a),!a||a.isLane||a.isPhase||this._isUpdate(a,e)&&(this.updateNode(a.name,{}),this._clearSelection(!0)))},addNodeToLayer:function(t,e){var i,a,n;if(i=this._findLayer(t))for(a=i.objects,n=0;n<e.length;n++)a.indexOf(e[n])<0&&(a.push(e[n]),this.updateNode(e[n],{}))},_isUpdate:function(t,e){var i=ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[t],"visible",this),a=ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[t],"lock",this);return e.visible!==i||e.lock!==a},removeNodeToLayer:function(t,e){var i,a,n,o;if(i=this._findLayer(t))for(a=i.objects,n=0;n<e.length;n++)(o=a.indexOf(e[n].name))>0&&(a.splice(o,1),this.updateNode(e[n],{}))},removeLayers:function(t){for(var e,i,a,n=0;n<t.length;n++)e=this.model.layers,i=this._findLayer(t[n].name),a=e.indexOf(i),this.model.layers.splice(a),this._updateLayer(i)},updateLayer:function(t,e){var i=this._findLayer(t),a=!1;e.visible!==undefined&&(i.visible!==e.visible&&(a=!0),i.visible=e.visible),e.lock!==undefined&&(i.lock!==e.lock&&(a=!0),i.lock=e.lock),e.print!==undefined&&(i.print=e.print),e.active!==undefined&&(i.active=e.active),e.snap!==undefined&&(i.snap!==e.snap&&(a=!0),i.snap=e.snap),e.objects!==undefined&&this._updateNodeToLayer(i.objects,e.objects),(!e.visible||e.lock)&&(i.active=!1),a&&this._updateLayer(i),this._clearSelection(!0)},_updateNodeToLayer:function(t,e){for(var i,a,n,o=0;o<e.length;o++)t.objects.indexOf(e[o])>-1&&i.push(e[o]);if(i.length>0)for(o=0;o<e.length;o++)a=e[o],i.indexOf(a)<0&&this.addNodeToLayer(t.name,a);else{for(n=ej.datavisualization.Diagram.Layers(),o=0;o<t.objects.length;o++)this.updateLayer(t.objects[o],n);t.objects=e,this._updateLayer(t)}},_isParent:function(t,e){if(t){if(e.indexOf(t.parent)>-1||e.indexOf(t.name)>-1)return!0;if(t.parent&&this.nameTable[t.parent].parent)return this._isParent(this.nameTable[this.nameTable[t.parent].parent],e)}},_updatePortConnection:function(t,e,i){for(var a,n=0;n<e.length;n++)(a=this.nameTable[e[n]])&&(a.sourcePort===i.name?(i._removeFromSourcePort=!0,i._removeLine=a.name,a.sourcePort=null):a.targetPort===i.name&&(i._removeFromTargetPort=!0,i._removeLine=a.name,a.targetPort=null),(i._removeFromSourcePort||i._removeFromTargetPort)&&(this._dock(a,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(a,this)))},removePorts:function(t,e){var i,a,n,o=[];if(e&&e.length>0){if((i=this.nameTable[t])&&i.ports&&i.ports.length>0)for(a=e.length-1;a>=0;a--)for(n=i.ports.length-1;n>=0;n--)i.ports[n].name===e[a].name&&(ej.datavisualization.Diagram.SvgContext.deletePort(i,i.ports[n],this),this._updatePortConnection(i,i.inEdges,i.ports[n]),this._updatePortConnection(i,i.outEdges,i.ports[n]),o.push($.extend(!0,{},i.ports[n])),i.ports.splice(n,1)[0]);this._isUndo||this.addHistoryEntry({type:"portscollectionchanged",object:i,collection:o,changeType:"remove",isUndo:!0,category:"internal"})}},_insertPort:function(t,e,i){var a,n;ej.datavisualization.Diagram.Util.isPageEditable(this)&&((a=this.nameTable[t])&&e&&(e=ej.datavisualization.Diagram.Port(e),this._collectionContains(e,a.ports)||(a.ports.splice(i,0,e),ej.datavisualization.Diagram.DiagramContext.renderPort(a,e,this,i))),n=[e],this.addHistoryEntry({type:"portscollectionchanged",object:a,collection:n.slice(),changeType:"insert",isUndo:!0,category:"internal"}))},addPorts:function(t,e){var i,a,n;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&((i=this.nameTable[t])&&e)){for(a=0;a<e.length;a++)(n=ej.datavisualization.Diagram.Port(e[a])).parent=i.name,i.ports.push(n),this._raisePropertyChange({element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"ports",oldValue:null,newValue:n}),ej.datavisualization.Diagram.DiagramContext.renderPort(i,n,this);this.addHistoryEntry({type:"portscollectionchanged",object:i,collection:i.ports,changeType:"insert",isUndo:!0,category:"internal"})}},updatePort:function(t,e,i){var a,n;if(t&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))){if(a=this._findNode(t),i&&e&&(!i.name||e.name==i.name)&&a){for(n in e=this._findPort(a,e.name),this._isUndo||this._recordPropertiesChanged(a,i,"port",e),i.name=e.name,this._comparePropertyValues(a,"ports",i),i)e.hasOwnProperty(n)&&(e[n]="object"==typeof i[n]?$.extend(!0,{},e[n],i[n]):i[n]);ej.datavisualization.Diagram.DiagramContext.updatePort(a,e,this)}i.offset&&(this._updateAssociatedConnectorEnds(a,this.nameTable),ej.datavisualization.Diagram.SvgContext._updateAssociatedConnector(a,this._svg,this))}},copy:function(){return(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=1,this.selectionList&&this.selectionList.length>0&&this._setClipboard()),this._cloneSelectionList()},paste:function(t,e){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&((t||this._clipboardData)&&(this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard),this._pasteMultipleLane(),this._paste(t,e===undefined||e))},_pasteMultipleLane:function(){var t,e,i,a,n,o,s=[],r=[],l=[];if(this._clipboardData&&(n=this._clipboardData,"pseudoGroup"==(o=(n=$.extend(!0,{},this._clipboardData)).node)._type)){for(a=0;a<o.children.length;a++)t=o.children[a],(e=n.childTable[t])&&(e.isLane?(e._laneIndex=this._getRemoveIndex(e),this._collectionContains(e.parent,r)||r.push(e.parent),s[a]=e):l.push(e.name));if(s.length>0){if(i=this._sameParent(s,r,this._clipboardData.childTable),l.length>0)for(a=0;a<l.length;a++)this._collectionContains(l[a],i.children)||i.children.push(l[a]);i&&i.children&&(this._clipboardData.node.children=i.children)}}},_sameParent:function(t,e,i){var a,n,o,s,r,l,d,h,g,c,u=[],m=[];if(c=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),t.length>1&&e.length>0){for(t=this._sortByLaneIndex(t),a=0;a<e.length;a++){for(l=ej.datavisualization.Diagram.Util.randomId(),u=[],n=0;n<t.length;n++)(s=t[n])&&s.isLane&&s.parent===e[a]&&(r=this.getNode(s),d=this._cloneLaneObj(r,l,i),u.push(d));if((g=this.nameTable[e[a]])&&g.parent&&(h=this.nameTable[g.parent]).isSwimlane)for(m=h.children[1].children.slice(),o=0;o<m.length;o++)m[o]=$.extend(!0,{},m[o]),m[o].name+=l;u&&m&&u.length>0&&m.length>0&&(h={type:"swimlane",offsetX:h.offsetX+10,offsetY:h.offsetY+10,orientation:h.orientation,lanes:u,phases:m},c.children.push(h))}return c}},_commandPaste:function(){this.paste()},_getNodesfrombounds:function(t,e){for(var i,a,n,o,s,r=!1,l=[],d=this.nodes(),h=0,g=d.length;h<g;h++)n=this.nameTable[d[h].name],e&&n&&(r=e.name===n.name),n&&n.visible&&!r&&(a=ej.datavisualization.Diagram.Util.bounds(n),a=ej.datavisualization.Diagram.Geometry.rect([a.topLeft,a.topRight,a.bottomRight,a.bottomLeft]),ej.datavisualization.Diagram.Util.canSelect(n)&&ej.datavisualization.Diagram.Util.enableLayerOption(n,"lock",this)&&(i=this.getObjectType(n),ej.datavisualization.Diagram.Geometry.containsRect(t,a)?""===n.parent&&l.push(n):"group"===i&&this.activeTool&&this.activeTool.inAction&&this.activeTool._checkGroupChildren(l,n,t)));for(h=0,g=(o=this.connectors()).length;h<g;h++)s=this.nameTable[o[h].name],e&&s&&(r=e.name===s.name),s&&s.visible&&!r&&(a=ej.datavisualization.Diagram.Util.bounds(s),a=ej.datavisualization.Diagram.Geometry.rect([a.topLeft,a.topRight,a.bottomRight,a.bottomLeft]),ej.datavisualization.Diagram.Util.canSelect(s)&&ej.datavisualization.Diagram.Util.enableLayerOption(o,"lock",this)&&ej.datavisualization.Diagram.Geometry.containsRect(t,a)&&""===s.parent&&l.push(s));return l},_setClipboard:function(){var t,e,i,a,n,o,s,r,l;if(this.selectionList.length>0){var d,h,g,c,u=this.selectionList[0],m={};if("group"===u._type||"pseudoGroup"===u.type){for(a=this._getChildren(u.children),e=0;e<a.length;e++)for(i=e+1;i<a.length;i++)n=this.nameTable[this._getChild(a[e])],(o=this.nameTable[this._getChild(a[i])])&&n&&o.zOrder<n.zOrder&&(t=a[e],a[e]=a[i],a[i]=t);for(s=[],r=u.children.length-1;r>=0;r--)"connector"===(l=this.nameTable[this._getChild(u.children[r])]).type&&(u.children.splice(u.children.indexOf(l.name),1),s.push(l.name));u.children=u.children.concat(s),m=this._getChildTable(u,m)}m[u.name]=u,c={x:(g=ej.datavisualization.Diagram.Util.bounds(u)).x,y:g.y,width:g.width,height:g.height},h=this._getNodesfrombounds(c,u),(d=$.extend(!0,{},{childTable:m,node:u,collection:h})).node.segments&&(d.node.targetNode=null,d.node.targetPort=null,d.node.sourceNode=null,d.node.sourcePort=null),d.addInfo=this._updateClipBoardConnectors(u,m),this._clipboardData=d}},_updateClipBoardConnectors:function(t,e){var i,a,n=[];if(t&&"pseudoGroup"===t.type&&t.children.length>0)for(a=0;a<t.children.length;a++)(i=this.nameTable[this._getChild(t.children[a])])&&(i.isSwimlane||i.isLane)&&this._updateSwimlaneGroupConnectors(t,i,e,n);else this._updateSwimlaneGroupConnectors(null,t,e,n);return n},_updateEdgesToClipboard:function(t,e,i,a,n,o){var s,r,l,d;i.parent&&t&&(s=this.nameTable[t.sourceNode],r=this.nameTable[t.targetNode],s&&r&&(l=this.nameTable[s.parent],d=this.nameTable[r.parent],(l&&l.isLane&&d&&d.isLane||l&&d&&("group"==l.type||"group"==d.type))&&(!this._collectionContains(t.name,o?i.outEdges:i.inEdges)||this._collectionContains(t.name,n)||this._collectionContains(t.name,e||[])||n.push(this.nameTable[this._getChild(t)]))))},_updateSwimlaneConnectors:function(t,e,i,a){if(e){for(var n,o=0;o<e.inEdges.length>0;o++)n=this.nameTable[this._getChild(e.inEdges[o])],this._updateEdgesToClipboard(n,t,e,i,a);for(o=0;o<e.outEdges.length>0;o++)n=this.nameTable[this._getChild(e.outEdges[o])],this._updateEdgesToClipboard(n,t,e,i,a,!0)}},_updateSwimlaneGroupConnectors:function(t,e,i,a){var n,o,s,r,l,d=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,e);for(!d&&t&&e.isLane&&(d=[e.name]),o=0;d&&o<d.length;o++)if((s=this.nameTable[this._getChild(d[o])])&&s.children&&s.children.length>0)for(n=s.children,r=0;r<n.length;r++)(l=this.nameTable[this._getChild(n[r])])&&this._updateSwimlaneGroupChildConnectors(t&&t.children?t.children:null,l,i,a)},_updateSwimlaneGroupChildConnectors:function(t,e,i,a){var n,o,s=0;if(this._updateSwimlaneConnectors(t&&t.children?t.children:null,e,i,a),o=e.children)for(s=0;s<o.length;s++)(n=this.nameTable[this._getChild(o[s])])&&this._updateSwimlaneGroupChildConnectors(t,n,i,a)},_getChildTable:function(t,e){var i,a,n,o,s,r,l,d;if(a=this._getChildren(t.children))for(o=0;o<a.length;o++)if(n=a[o],(i=this.nameTable[n])&&(i.parent===t.name||"pseudoGroup"==t.type)){if(("group"===(s=e[i.name]=$.extend(!0,{},i))._type||"pseudoGroup"===s.type)&&(e=this._getChildTable(s,e)),s.inEdges&&s.inEdges.length>0)for(r in s.inEdges)(d=this.nameTable[s.inEdges[r]])&&(e[d.name]&&delete e[d.name],e[d.name]=d);if(s.outEdges&&s.outEdges.length>0)for(l in s.outEdges)(d=this.nameTable[s.outEdges[l]])&&(e[d.name]&&delete e[d.name],e[d.name]=d)}return e},isSameParent:function(t){var e;if(t.length>1){for(e=1;e<t.length;e++)if(t[e]!==t[0])return!1;return!0}},_sortByLaneIndex:function(t){return t.sort(function(t,e){return t._laneIndex>e._laneIndex?1:e._laneIndex>t._laneIndex?-1:0})},_paste:function(t,e){var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C;if(t){var z="",S=[],P=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"});for(e&&(z=ej.datavisualization.Diagram.Util.randomId()),C=0;C<t.length;C++)t[C].name+=z,t[C].outEdges&&(t[C].outEdges=[]),t[C].inEdges&&(t[C].inEdges=[]),t.length>1&&P.children.push(t[C].name),"connector"!=t[C].type?("group"!==t[C].type&&"bpmn"!==t[C].type||t[C].isSwimlane||(this._clonePasteGroup(t[C],z,t),this.add($.extend({},t[C]))),t[C].isSwimlane?(this._clonePasteSwimlaneObj(t[C],z,t),D=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t[C],i),this._outOfBoundsOnNudge(D,10*diagram._pasteIndex,10*this._pasteIndex)&&this.add(D)):this.add($.extend({},t[C]))):S.push(t[C]);for(C=0;C<S.length;C++)S[C].sourceNode&&this.nameTable[S[C].sourceNode+z]?S[C].sourceNode+=z:(S[C].sourceNode="",S[C].sourcePort=""),S[C].targetNode&&this.nameTable[S[C].targetNode+z]?S[C].targetNode+=z:(S[C].targetNode="",S[C].targetPort=""),t.length>1&&P.children.push(S[C].name),this.add($.extend({},S[C]));t.length>1&&(this.nodes().push(P),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[P.name]=P,this._clearSelection(!0),ej.datavisualization.Diagram.Util._updateGroupBounds(P,this),this.addSelection(P,!0))}else if(this._clipboardData&&(i=this._clipboardData,S=[],n=!1,(a=(i=$.extend(!0,{},this._clipboardData)).node).zOrder=-1,this.tools.move._outOfBoundsDrag(a,10*this._pasteIndex,10*this._pasteIndex)&&a&&"phase"!=a.type)){if(a.container)a.isSwimlane?(this.model.historyManager.startGroupAction(),n=!0,a=this._pasteSwimlaneObj(a,i),i.childTable=this._getChildTable(a,i.childTable)):(a.isLane?("vertical"===(a=this._cloneLaneObj(a,ej.datavisualization.Diagram.Util.randomId(),i.childTable)).orientation&&(a.height=a.height),(v=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(a,this,this._clipboardData,!0))&&(this._pasteObj=!0,this.add(v),this._pasteObj=!1),a=v):!a.container||a.isLane||a.isSwimlane||(a=this._cloneContainer(a,ej.datavisualization.Diagram.Util.randomId(),i.childTable),this._preserveConnection(i.childTable,a),this.add(a),a=this.nameTable[a.name]),r=10*this._pasteIndex,this._translate(a,r,r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(a,this)),this._selectionContains(a)&&(this._clearSelection(!0),this._addSelection(a));else if("pseudoGroup"==a.type){for(o=a.children,P=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this._isUndo=!0,this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,C=0;C<o.length;C++)(s="object"==typeof(z=o[C])?z:i.childTable[z]).zOrder=-1,s._annotation&&delete s._annotation,s&&(s.isSwimlane||"swimlane"===s.type)?(n=!0,(s=this._pasteSwimlaneObj(s,i))&&this._isUndo&&(r=10*this._pasteIndex,this._translate(s,r,r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(s,this)),s||(this.add(z),s=this.nameTable[z.name],this._clipboardData.childTable=this._getChildTable(s,i.childTable),this._clipboardData.node.children[C]=s,this._clipboardData.childTable[s.name]=s,l=!0),s&&P.children.push(s.name),a=P):s&&s.isLane?((d=this._pasteSwimlane(s,i,!0,10*this._pasteIndex))&&P.children.push(d.name),r=10*this._pasteIndex,this._translate(d,r,r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(d,this)):s&&(z+=ej.datavisualization.Diagram.Util.randomId(),delete i.childTable[s.name],l&&(this._clipboardData.childTable[s.name]=s),s.name=z,s.parent="",i.childTable[s.name]=s,this._preserveConnection(i.childTable,s),h=!0,s.segments&&(g=!0,c=!0,i.childTable[s._oldSourceNode]&&!this.nameTable[s.sourceNode]&&(g=!1,s.sourceNode=null),i.childTable[s._oldTargetNode]&&!this.nameTable[s.targetNode]&&(c=!1,s.targetNode=null),g||c||(h=!1)),h&&(P.children.push(z),"group"===s._type&&"bpmn"!=s.type?this._pasteChildren(i.childTable,s):s.children=[],r=10*this._pasteIndex,this._translate(s,r,r,this.nameTable),!s.segments||1!=s.segments.length||"orthogonal"!=s.segments[0].type||s.sourceNode||s.targetNode||(f=s.segments[0].points),_=!1,_=this.add(s),f&&_&&((s=this.nameTable[s.name]).segments[0].points=f,ej.datavisualization.Diagram.DiagramContext.update(s,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom))));n&&this.model.historyManager.startGroupAction(),delete this._multipleAction,this._clearSelection(),P&&P.children.length>0&&(this.nodes().push(P),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[P.name]=P,ej.datavisualization.Diagram.Util._updateGroupBounds(P,this),this._addSelection(P),u={},u=this._getChildTable(this.selectionList[0],u),m={type:"collectionchanged",object:this._updatePsedoGroupChildren(this.selectionList[0]),childTable:jQuery.extend(!0,{},u),changeType:"insert",category:"internal"},this.addHistoryEntry(m),this._isUndo=!1)}else"bpmn"==a.type?(p=ej.datavisualization.Diagram.Util.randomId(),a.parent="",a.name=a.name+p,a.inEdges=[],a.outEdges=[],a.children=[],a._annotation&&delete a._annotation,r=10*this._pasteIndex,this._translate(a,r,r,this.nameTable),this.add(a)):(a.name=a.name+ej.datavisualization.Diagram.Util.randomId(),a.parent="","group"===a._type?this._pasteChildren(i.childTable,a):a.segments||a.segments||(a.inEdges=[],a.outEdges=[]),r=10*this._pasteIndex,this._translate(a,r,r,this.nameTable),!a.segments||1!=a.segments.length||"orthogonal"!=a.segments[0].type||a.sourceNode||a.targetNode||(f=a.segments[0].points),(_=this.add(a))&&f&&((a=this.nameTable[a.name]).segments[0].points=f,ej.datavisualization.Diagram.DiagramContext.update(a,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom)),this._updateSelectionHandle());if(i.addInfo.length){for(y in i.addInfo)(b=i.addInfo[y]).isSwimlane?(i.childTable[b.name]=b,i.childTable=this._getChildTable(b,i.childTable),b=this._pasteSwimlaneObj(b,i),i.childTable[b.name]=b,i.childTable=this._getChildTable(b,i.childTable)):(i.childTable[b.name]&&b!==i.childTable[b.name]&&(b=$.extend(!0,{},i.childTable[b.name])),x=b.name+ej.datavisualization.Diagram.Util.randomId(),b.name=x,b.parent="",b._oldSourceNode&&b._oldTargetNode&&(i.childTable[b.name]=b,this._preserveConnection(i.childTable,b),r=10*this._pasteIndex,this._translate(b,r,r,this.nameTable),this.add(b),l&&(S[y]=b),this._selectionContains(b)&&this._clearSelection(!0)));l&&(this._clipboardData.addInfo=S),this._selectionContains(a)||this._addSelection(a)}n&&this.model.historyManager.closeGroupAction(),this._pasteIndex++}},_cloneContainer:function(t,e,i){var a,n;for(t.name=t.name+e,a=0;a<t.children.length;a++)(n=(i||this.nameTable)[this._getChild(t.children[a])]).name+=e,n.parent=t.name,n.children&&n.children.length>0&&(n=this._cloneContainer(n,e,i)),t.children[a]=n;return ej.datavisualization.Diagram.bpmnHelper.updateProcessCollection(t,this),t},_clonePasteGroup:function(t,e,i){for(var a,n,o=0;o<t.children.length;o++)if(t.children[o].name+=e,t.children[o].parent=t.name,t.children[o].segments)t.children[o].sourceNode&&(t.children[o].sourceNode+=e),t.children[o].targetNode&&(t.children[o].targetNode+=e);else{for(n=0;n<t.children[o].inEdges.length;n++)a=t.children[o].inEdges[n],this._collectionContains(a,t.children)||i&&this._collectionContains(a,i)?a+=e:t.children[o].inEdges.splice(n,1);for(n=0;n<t.children[o].outEdges.length;n++)a=t.children[o].outEdges[n],this._collectionContains(a,t.children)||i&&this._collectionContains(a,i)?a+=e:t.children[o].outEdges.splice(n,1)}},_clonePasteSwimlaneObj:function(t,e,i){var a,n,o,s,r,l,d,h;if(t.lanes&&t.lanes.length>0)for(d=0;d<t.lanes.length;d++)if(t.lanes[d]&&(t.lanes[d].name+=e,t.lanes[d].children&&t.lanes[d].children.length>0)){for(a=t.lanes[d].children,n=[],o=0;o<a.length;o++){for((s=jQuery.extend(!0,{},a[o])).name+=e,s.parent=t.lanes[d].name,r=0;r<s.inEdges.length;r++)this._collectionContains(s.inEdges[r],i)?(s.inEdges[r]+=e,t.lanes[d].children[o]=s):s.inEdges.splice(r,1);for(r=0;r<s.outEdges.length;r++)this._collectionContains(s.outEdges[r],i)?(s.outEdges[r]+=e,t.lanes[d].children[o]=s):s.outEdges.splice(r,1);n.push(s)}t.lanes[d].children=n}if(t.phases&&t.phases.length>0){for(l=[],d=0;d<t.phases.length;d++)t.phases[d]&&((h=jQuery.extend(!0,{},t.phases[d])).name+=e,h.parent="",l.push(h));t.phases=l}},_cloneLaneObj:function(t,e,i){return t=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneLaneObj(this,t,e,i)},_cloneSwimlaneObj:function(t,e,i){return t=$.extend(!0,{},t),t=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneSwimlaneObj(this,t,e,i)},_pasteSwimlaneObj:function(t,e){return ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlaneObj(this,t,e)},_pasteSwimlane:function(t,e,i,a){if(t&&t.isSwimlane)return ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlane(this,t,e,i,a)},_cloneNode:function(t,e,i,a){var n,o=!1,s=null;if(t){if(t="string"==typeof t?t:t.name,(t=jQuery.extend(!0,{},e.childTable[t])).isPhaseStack&&(t.name=t.name.split("phaseStack")[0]+i+"phaseStack",o=!0,s=t.name),t.children&&t.children.length>0)for(n=0;n<t.children.length;n++)this._cloneNode(t.children[n],e,i,s),t.children[n]&&("string"==typeof t.children[n]?t.children[n]+=i:t.children[n].name+=i);a?t.parent="string"==typeof a?a:a.name:""!=t.parent&&(t.parent+=i),o||(t.name+=i),this._preserveConnection(e.childTable,t),this.nameTable[t.name]=t}},_cloneSwimlane:function(t,e,i){var a,n,o=t.name;if(t.name+=i,t.children&&t.children.length>0)for(n=0;n<t.children.length;n++)this._cloneNode(t.children[n],e,i,t),"string"==typeof t.children[n]?t.children[n]+=i:t.children[n]=t.children[n].isPhaseStack?o+i+"phaseStack":t.children[n].name+i;if(t.phases&&t.phases.length>0)for(n=0;n<t.phases.length;n++)(a=jQuery.extend(!0,{},this.nameTable[this._getChild(t.phases[n])])).name+=i,a.parent+=i,this.nameTable[a.name]=a,t.phases[n]=a.name;this.nameTable[t.name]=t},_pasteChild:function(t,e,i,a){var n=t.name+ej.datavisualization.Diagram.Util.randomId();delete e[t.name],t.name=n,e[t.name]=t,this._preserveConnection(e,t),t.parent=i.name,a.push(n),"group"===t._type&&this._pasteChildren(e,t),this.add(t)},_pasteChildren:function(t,e){for(var i,a=[],n=e.children,o=0;o<n.length;o++)(i=t[this._getChild(n[o])]).zOrder=-1,i&&this._pasteChild(i,t,e,a);for(e.children=[],o=0;o<a.length;o++)e.children.push(this.nameTable[a[o]]);this._preserveConnection(t,e)},_preserveConnections:function(t,e){for(var i,a=this._getChildren(e.children),n=0;n<a.length;n++)(i=t[a[n]])&&(this._preserveConnection(t,i),"group"===i._type&&this._preserveConnections(t,e))},_preserveConnection:function(t,e){var i,a,n,o;if(e.segments)e.targetNode&&((o=t[e.targetNode])&&o.inEdges.push(e.name)),e.sourceNode&&((o=t[e.sourceNode])&&o.outEdges.push(e.name));else{if((n=e.inEdges.length)>0){for(i=0;i<n;i++)(a=t[e.inEdges[i]])&&(a._oldTargetNode=a.targetNode,a.targetNode=e.name);e.inEdges=[]}if((n=e.outEdges.length)>0){for(i=0;i<e.outEdges.length;i++)(a=t[e.outEdges[i]])&&(a._oldSourceNode=a.sourceNode,a.sourceNode=e.name);e.outEdges=[]}}},_expandChildren:function(t){for(var e,i,a=0;a<t.outEdges.length;a++)e=this.nameTable[t.outEdges[a]],(i=this.nameTable[e.targetNode]).excludeFromLayout||(e.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(e,this),this._updateQuad(e),i.isExpanded&&this._expandChildren(i),i.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(i,this),this._updateQuad(i))},_collapseChildren:function(t){for(var e,i,a=0;a<t.outEdges.length;a++)e=this.nameTable[t.outEdges[a]],(i=this.nameTable[e.targetNode]).excludeFromLayout||(e.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(e,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[e.name],e),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,e),this._checkParentNodeVisible(i,e)&&(i.isExpanded&&this._collapseChildren(i),i.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i)))},_checkParentNodeVisible:function(t,e){var i,a;if(t.inEdges.length>=1){for(i=0;i<t.inEdges.length;i++)if((a=this._findNode(t.inEdges[i])).name!=e.name&&a.visible)return!1;return!0}},zoomTo:function(t){t||(t=new ej.datavisualization.Diagram.Zoom),t.zoomCommand&ej.datavisualization.Diagram.ZoomCommand.ZoomIn?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+t.zoomFactor,0,0,t.focusPoint,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+t.zoomFactor),0,0,t.focusPoint,!0)},remove:function(t){t&&this.nameTable[t.name]&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))?this._delete(t):this._delete()},clear:function(){if(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this)){this._clearSelection();var t=this;for(this._views.forEach(function(e){var i=t._views[e];$(i.diagramLayer).empty(),$(t._expander).empty(),$(t._adornerLayer.children).empty(),$(i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0]).empty()});this.nodes().length>0;)this.nodes().pop();for(;this.connectors().length>0;)this.connectors().pop();this._nodes=[],this._connectors=[],this.nameTable={},this.selectionList=[],this.clearHistory(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this),this._updateScrollOffset(0,0)}},_clearElementCollection:function(){$(this.element).find(".ej-d-node").remove(),$(this.element).find(".ej-d-group").remove(),$(this.element).find(".ej-d-seperator").remove();var t=this.model.dataSourceSettings.dataSource;if("string"!=typeof t&&t.length){for($(this.element).find(".ej-d-connector").remove();this.nodes().length>0;)this.nodes().pop();for(;this.connectors().length>0;)this.connectors().pop();this._nodes=[],this._connectors=[],this.nameTable={},this.selectionList=[],this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(this)}},_updateChildOnGroup:function(t){var e,i=null;return t&&t.parent&&(i=this._svg.document.getElementById(t.parent),(e=this.nameTable[t.parent])&&(e.container?ej.datavisualization.Diagram.ContainerHelper._add(this,t):(null!=(t=this.nameTable[this._getChild(t)])&&e.children.push(t),"group"==t._type&&this._initGroupNode(t),ej.datavisualization.Diagram.Util._refreshParentGroup(t,this)))),i},_raiseChildrenPropertyChange:function(t,e){var i,a,n,o;if(t&&t.parent){var s,r,l=[],d=[];if(h=this._findNode(t.parent)){if(h.isLaneStack)d=(d=(i=this._getNode(h.parent)).lanes).slice(),e?i.lanes.push(t):(c=ej.datavisualization.Diagram.canvasHelper._getLaneIndex(i,t),i.lanes.splice(c,1)),l=i.lanes,s=i,r="lanes";else if(h.isPhaseStack)d=(d=(i=this._getNode(h.parent)).phases).slice(),e?i.phases.push(t):(c=ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseIndex(this,t.name),i.phases.splice(c,1)),l=i.phases,s=i,r="phases";else{var h=this._getNode(t.parent),g=[],c=-1;for(a=0;a<h.children.length;a++)(n=this._getNode(h.children[a]))&&(n.name===t.name&&(c=a),g.push(n));d=g.slice(),l=g.slice(),e?l.push(t):l.splice(c,1),s=h,r="children"}o={element:s,cause:this._isDragg||this.activeTool.inAction?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:r,oldValue:d,newValue:l},this._raisePropertyChange(o)}}},addLane:function(t,e){var i,a;this._isLaneApi=!0,t.isLane&&(t=this._dynamicLane(t,this),e||t.parent?((i=this._updateDynamicLane(this,t,e))&&i.isSwimlane?(a=this.nameTable[this._getChild(i.children[2])],t=ej.datavisualization.Diagram.canvasHelper._updateDropLaneProperties(this,t,i),e||0===e?a.children.splice(e,0,t):a.children.push(t),t.parent=a.name,this._swimlaneObject=!0):t=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(t,this),this.add(t),a&&i&&(ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,a),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,i),this._clearSelection(!0),this._addSelection(i)),delete this._swimlaneObject):(t=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(t,this),this.add(t))),delete this._isLaneApi},_dynamicLane:function(t,e){var i=ej.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(t,e.nameTable),a=i.orientation;return(i=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(i,e.nameTable)).minHeight=t.height,i.minWidth=t.width,i.parent=t.parent,i.orientation=a,t.orientation&&(i.orientation=t.orientation),i.isLane&&(i=ej.datavisualization.Diagram.ContainerHelper._initContainer(e,i)),i},_updateDynamicLane:function(t,e){var i,a;if(e.parent)a=t.nameTable[e.parent];else for(i=0;i<this.selectionList.length;i++)a=this.selectionList[i];return a},_resetValues:function(t){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(t)&&t&&(t._points&&delete t._points,t._sourceNodeInfo&&delete t._sourceNodeInfo,t._targetNodeInfo&&delete t._targetNodeInfo,t._obstacle&&delete t._obstacle,t._outerBounds&&delete t._outerBounds,t._sourcePointInfo&&delete t._sourcePointInfo,t._sourcePortInfo&&delete t._sourcePortInfo,t._targetPointInfo&&delete t._targetPointInfo,t._targetPortInfo&&delete t._targetPortInfo)},_add:function(t,e,i,a){var n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D;if(this._resetValues(t),!t.length>0&&(t=ej.datavisualization.Diagram.NodeType(t,this),this.model.nodeTemplate&&"node"===t._type?n=this._getNodeTemplate():o=this._getConnectorTemplate(),n&&n(this,t),o&&o(this,t)),t.pivot||(t.pivot={x:.5,y:.5}),!t||!(t.segments||t.sourcePoint||t.targetPoint||t.sourceNode||t.targetNode)||t.segments&&t.segments[0]&&t.segments[0].points||(s=$.extend(!0,{},t),s=this._getNewConnector(s)),s&&this._outOfBoundsOnNudge(s,0,0)||!s&&this._outOfBoundsOnNudge(t,0,0)){if(r=this._eventCause,this._raiseChildrenPropertyChange(t,!0),this._eventCause=r,l=!1,(t.isSwimlane||"swimlane"===t.type)&&!this._pasteObj&&this._isNewNode&&(t=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t)),t.length>0)for(y=0;y<t.length;y++)this.add(t[y]);else if(t.addInfo&&(t.addInfo.height&&(t.height=t.addInfo.height),t.addInfo.width&&(t.width=t.addInfo.width)),d="connector"==t.type?"connector":"node",g={changeType:"insert",element:this.getNode(t)},t.isLane?this._isDragg||!this._selectedSymbol?(_=this._isUndo?ej.datavisualization.Diagram.GroupChangeCause.HistoryChange:ej.datavisualization.Diagram.GroupChangeCause.Drop,this._isLaneApi&&(_=ej.datavisualization.Diagram.GroupChangeCause.Unknown),g={changeType:"insert",element:h=this.getNode(t),state:"changing"},this._eventCause.nodeCollectionChange=_,c=g,(g=this._raiseEvent(d+"CollectionChange",g))||(g=c),g.cancel||(this._updateLane(t,g.element),this._raiseGroupChangeEvent(h,null,this.getNode(t.parent),_))):this._updateLane(t,g.element):t.isSwimlane?(g=this._raiseCollectionChangeEvent(t,d),this._updateSwimlane(t,g.element,!0)):t.container&&!$.isEmptyObject(t.container)&&(t=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t)),t.isLane||t.isSwimlane){if(!g.cancel&&(l=!(!t.isLane||!(this._selectedSymbol&&this._selectedSymbol.isLane||this._swimlaneObject||this._isUndo))||this.nodes().push(t),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[t.name]=t,l)){if("group"===t._type&&e){if(this._paletteItemClick&&(t.offsetX=t.minWidth/2+50,t.offsetY=t.minHeight/2+50),ej.datavisualization.Diagram.DiagramContext.renderGroup(t,this),t.phases&&t.phases.length>0)for(v=null,y=0,b=t.phases.length;y<b;y++)"phase"==(v=this.nameTable[this._getChild(t.phases[y])]).type&&ej.datavisualization.Diagram.SvgContext.renderphase(v,this._svg,this._diagramLayer,this);this._clearSelection(!0),this._addSelection(t)}this._updateQuad(t)}}else if("connector"!=t.type){if((_=this._eventCause[d+"CollectionChange"])||(this._eventCause[d+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),"group"===t._type||t.children&&t.children.length>0?(this._convertGroupChild(t,[]),t=ej.datavisualization.Diagram.Group(t),this.nameTable[t.name]=t,g=this._raiseCollectionChangeEvent(t,d),t._type="group","bpmn"==t.type&&(t=ej.datavisualization.Diagram.Util._updateBpmnChild(t,this)),this._initGroupNode(t),this._isGroupNode||"bpmn"===t.type||this._udpateChildRotateAngle(t)):t.isPhase||(t=this._getNewNode(t),this.nameTable[t.name]=t,g=this._raiseCollectionChangeEvent(t,d),this._getNodeDimension(t)),!g.cancel&&(t._status="new",l=!!t.parent||this.nodes().push(t),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[t.name]=t,l)){if(this._containerOverNode&&(ej.datavisualization.Diagram.canvasHelper._addNodeToContainer(this,t,this._containerOverNode),delete this._containerOverNode),"group"===t._type||t.children&&t.children.length>0?(this._updateParent(t),0==t.offsetX&&0==t.offsetY&&ej.datavisualization.Diagram.Util._updateGroupBounds(t,this,!0),this._updateChildrenEdges(t),u=null,u=this._updateChildOnGroup(t),e&&!t.parent&&(delete this._isNodeInitializing,ej.datavisualization.Diagram.DiagramContext.renderGroup(t,this))):e&&(u=null,u=this._updateChildOnGroup(t),(""===t.parent||t.isPhase||this._isInsert)&&ej.datavisualization.Diagram.DiagramContext.renderNode(t,this,u),this._selectedSymbol&&t.textBlock&&((m=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0])&&((p=$(m).find("#"+t.name+"label")[0])&&p.childNodes&&p.childNodes.length>0&&(p.childNodes[0].style.display="none")))),this._updateQuad(t),this.nameTable[t.name]=t,"group"===t._type||t.children&&t.children.length>0)for(y=0;y<t.children.length;y++)f=t.children[y],this.nameTable[f.name]=f;e&&!a&&(this._clearSelection(!0),this._addSelection(t))}this._addNodeToGraph(t)}else t=this._getNewConnector(t),this.nameTable[t.name]=t,(_=this._eventCause[d+"CollectionChange"])||(this._eventCause[d+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),(g=this._raiseCollectionChangeEvent(t,d)).cancel||(l=!!t.parent||this.connectors().push(t),t._status="new",l&&(this._updateEdges(t),this._dock(t,this.nameTable),this._routeEdge(t),ej.datavisualization.Diagram.Util.updateBridging(t,this),this._updateConnectorBridging(t),t.parent||e&&ej.datavisualization.Diagram.DiagramContext.renderConnector(t,this),this.nameTable[t.name]=t,this._updateQuad(t),this._updateChildOnGroup(t),e&&!a&&(this._clearSelection(!0),this._addSelection(t))));this._setZorder(t),!this._isUndo&&(!this._selectedSymbol||this._endEditing)&&l&&(x={},this.selectionList&&this.selectionList.length>0&&(x=this._getChildTable(this.selectionList[0],x)),i&&(!i||i.entryHistory)||t.isPhase||(D={type:"collectionchanged",object:jQuery.extend(!0,{},t),childTable:jQuery.extend(!0,{},x),changeType:"insert",category:"internal"},this.addHistoryEntry(D))),this._trigger("refresh"),this._isRefreshTriggered=!0,!l||t.isPhase||t.isLane||this._selectedSymbol&&!this._endEditing||(g.state="changed",this._raiseEvent(d+"CollectionChange",g))}return delete this._isNewNode,l},_raiseCollectionChangeEvent:function(t,e){var i={changeType:"insert",element:this.getNode(t),state:"changing"};return t.isPhase||this._selectedSymbol&&!this._endEditing||(this._raiseEvent(e+"CollectionChange",i),t._absolutePath=null),i},add:function(t,e){var i,a;if(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))return this._isNodeInitializing=!0,this._isNewNode=!0,(i=ej.datavisualization.Diagram.Util.enableLayerOption({},"active",this))&&((i=ej.datavisualization.Diagram.Layers(i)).objects.indexOf(t.name)<0&&i.objects.push(t.name)),a=this._add(t,!0,e),delete this._isNodeInitializing,a},updateUserHandles:function(t){t=this.nameTable[t.name],ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,t,this._adornerSvg,!1,!1,this._currZoom,this)},scrollToNode:function(t){var e,i,a,n,o=this._vScrollbar&&this._vScrollbar._scrollData?this._vScrollbar._scrollData.buttonSize:0,s=this._hScrollbar&&this._hScrollbar._scrollData?this._hScrollbar._scrollData.buttonSize:0,r=this._currZoom,l=this.element[0].getBoundingClientRect(),d=ej.datavisualization.Diagram.Util.bounds(t);e=(d.x+d.width/2)*r,i=(d.y+d.height/2)*r,a=this._hScrollOffset,n=this._vScrollOffset,l.width+this._hScrollOffset<e+d.width/2*r&&(a=e+(d.width/2+o)*r-l.width),l.height+this._vScrollOffset<i+d.height/2*r&&(n=i+(d.height/2+s)*r-l.height),this._updateScrollOffset(a,n)},findNode:function(t){return this._findNode(t)},getObjectType:function(t){return ej.datavisualization.Diagram.Util.getObjectType(t)},_registerDrawingTools:function(){var t,e;for(t in this.model.drawingTools)(e=this.model.drawingTools[t]).diagram=this,this.tools[e.name]=e},_sortByXvalue:function(t){for(var e,i,a,n,o,s,r=0;r<t.length;r++)for(i=r+1;i<t.length;i++)o=this.nameTable[this._getChild(t[r])],s=this.nameTable[this._getChild(t[i])],a=ej.datavisualization.Diagram.Util.bounds(o),n=ej.datavisualization.Diagram.Util.bounds(s),(a.x>n.x||a.right>n.right)&&(e=t[r],t[r]=t[i],t[i]=e);return t},_sortByYvalue:function(t){for(var e,i,a,n,o,s,r=0;r<t.length;r++)for(i=r+1;i<t.length;i++)o=this.nameTable[this._getChild(t[r])],s=this.nameTable[this._getChild(t[i])],a=ej.datavisualization.Diagram.Util.bounds(o),n=ej.datavisualization.Diagram.Util.bounds(s),(a.y>n.y||a.bottom>n.bottom)&&(e=t[r],t[r]=t[i],t[i]=e);return t},_sortByZIndex:function(t,e){var i,a,n;if(e)for(a=0;a<t.length;a++)for(n=a+1;n<t.length;n++)t[a].zOrder>t[n].zOrder&&(i=t[a],t[a]=t[n],t[n]=i);else for(a=0;a<t.length;a++)for(n=a+1;n<t.length;n++)t[a].zOrder<t[n].zOrder&&(i=t[a],t[a]=t[n],t[n]=i);return t},_updateBPMNIndex:function(t,e){var i,a,n,o,s,r,l;if("bpmn"===t.type&&t.parent&&((o=this.nameTable[t.parent])&&o.isLane))for(s=o.children,a=0;a<s.length;a++)for(n=a+1;n<s.length;n++)r=this.nameTable[this._getChild(s[a])],l=this.nameTable[this._getChild(s[n])],!(e?r.zOrder>l.zOrder:r.zOrder<l.zOrder)||r.isPhase||l.isPhase||r.isLane||l.isLane||(i=s[a],s[a]=s[n],s[n]=i)},_sortByGroupChildrenZIndex:function(t){for(var e,i,a,n,o,s,r,l=this.nodes(),d=0;d<l.length;d++)if(n=l[d],this._updateBPMNIndex(n,t),"group"===n._type&&"bpmn"!==n.type&&!n.isSwimlane){for(o=this._getChildren(n.children),i=0;i<o.length;i++)for(a=i+1;a<o.length;a++)s=this.nameTable[this._getChild(o[i])],r=this.nameTable[this._getChild(o[a])],!(t?s.zOrder>r.zOrder:s.zOrder<r.zOrder)||s.isPhase||r.isPhase||s.isLane||r.isLane||(e=o[i],o[i]=o[a],o[a]=e);n.children=o}},_findCornerNodes:function(){var t,e,i,a,n,o,s,r,l,d,h,g=this.selectionList[0].children,c=this.nameTable[this._getChild(this.selectionList[0].children[0])];if(t=c,e=c,i=c,a=c,g.length>1)for(n=0;n<g.length;n++)s=this.nameTable[this._getChild(g[n])],o=ej.datavisualization.Diagram.Util.bounds(s),r=ej.datavisualization.Diagram.Util.bounds(e),o.x+o.width>r.x+r.width&&(e=s),l=ej.datavisualization.Diagram.Util.bounds(a),o.y+o.height>l.y+l.height&&(a=s),d=ej.datavisualization.Diagram.Util.bounds(t),o.x<d.x&&(t=s),h=ej.datavisualization.Diagram.Util.bounds(i),o.y<h.y&&(i=s);return{left:t,right:e,top:i,bottom:a}},_comparePropertyOnAlign:function(t,e,i,a){t&&(t.segments?(this._comparePropertyValues(t,"sourcePoint",{sourcePoint:{x:t.sourcePoint.x+e,y:t.sourcePoint.y+i}},a),this._comparePropertyValues(t,"targetPoint",{targetPoint:{x:t.targetPoint.x+e,y:t.targetPoint.y+i}},a)):(t.offsetX!=t.offsetX+e&&this._comparePropertyValues(t,"offsetX",{offsetX:t.offsetX+e},null,a),t.offsetY!=t.offsetY+i&&this._comparePropertyValues(t,"offsetY",{offsetX:t.offsetY+i},null,a)))},_moveNode:function(t,e,i){this._comparePropertyOnAlign(i,t,e,ej.datavisualization.Diagram.ActionType.Align),this._translate(i,t,e,this.nameTable),this._updateNodeMargin(i),ej.datavisualization.Diagram.DiagramContext.update(i,this)},_updateContainerOnNudge:function(t){var e=this.nameTable[t.parent];e&&e.container&&(ej.datavisualization.Diagram.canvasHelper._updateNodeMargin(this,t,e),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,e,!0))},_outOfBoundsOnNudge:function(t,e,i){var a,n,o,s=this.nameTable[this._getChild(t.parent)];if(!(s&&s.isLane&&s.parent))return this.tools.move._outOfBoundsDrag(t,e,i);if((a=this.nameTable[this._getChild(s.parent)])&&a.isLaneStack&&a.parent&&((n=this.nameTable[this._getChild(a.parent)])&&"infinity"!=this.model.pageSettings.boundaryConstraints)){var r=ej.datavisualization.Diagram.Util.bounds(s),l=ej.datavisualization.Diagram.Util.bounds(t),d=ej.datavisualization.Diagram.Util.bounds(n),h=d.right,g=d.bottom;if(l.bottom+i+20>=r.bottom&&(g+=i),l.right+e+20>=r.right&&(h+=e),o=this.activeTool._getPageBounds(),i>0&&d.bottom!=g&&g>o.height||e>0&&d.right!=h&&h>o.width)return!1}return!0},_anyFromSwimlane:function(t){if(t.parent){var e=this.nameTable[t.parent];return e&&e.container&&e.isLane?this._getSwimlane(e):this._anyFromSwimlane(e)}return null},_nudge:function(t,e,i,a,n,o){var s,r,l,d,h,g;if(!(t&&t.segments&&t.sourceNode&&t.targetNode)){var c,u,m=this.nameTable[t.parent];if("label"!==t._type){if(this._outOfBoundsOnNudge(t,e,i)){if(!n)if(t.segments)u={element:t,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:a,propertyName:"sourcePoint",oldValue:{sourcePoint:t.sourcePoint},newValue:{sourcePoint:{x:t.sourcePoint.x+e,y:t.sourcePoint.y+i}}},this._raisePropertyChange(u),u={element:t,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:a,propertyName:"targetPoint",oldValue:{targetPoint:t.targetPoint},newValue:{targetPoint:{x:t.targetPoint.x+e,y:t.targetPoint.y+i}}},this._raisePropertyChange(u);else{var p="right"===a||"left"===a?t.offsetX:t.offsetY,f="right"===a||"left"===a?t.offsetX+e:t.offsetY+i,_="right"===a||"left"===a?"offsetX":"offsetY";u={element:t,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:a,propertyName:_,oldValue:p,newValue:f},this._raisePropertyChange(u)}if((d=this.nameTable[t.parent])&&d.isLane&&(s=this._moveOnLane(t,d,e,i)),!s||s.proceedY||(i=0),!s||s.proceedX||(e=0),"pseudoGroup"==t.type){for(r=this._removeContainerConnector(this._getChildren(t.children)),r=this._sortByYvalue(r),l=(r=this._sortByXvalue(r)).length-1;l>=0&&(!(c=this.nameTable[this._getChild(r[l])])||this._nudge(c,e,i,a,!0,0===l));l--);ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdateNode(this,c),delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.Util._updateGroupBounds(t,this)}else this._translate(t,e,i,this.nameTable,undefined,undefined,!0),o||t.parent&&(d=this.nameTable[t.parent],(h=this._anyFromSwimlane(t))&&h.isSwimlane&&(ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0)),this._updateContainerOnNudge(t);if(this._updateNodeMargin(t),t.parent){if((d=this.nameTable[t.parent])&&d.container&&(ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,"canvas"===d.container.type&&ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,d),delete this._disablePhaseUpdate,(h=this._anyFromSwimlane(t))&&(ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,h),this._updateSwimlanes||(this._updateSwimlanes=[]),this._collectionContains(h.name,this._updateSwimlanes)||this._updateSwimlanes.push(h.name),n||(delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(h,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,h,!0)))),o&&this._updateSwimlanes){for(delete this._disableSwimlaneUptate,g=0;g<this._updateSwimlanes.length;g++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[g]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[g]]);delete this._updateSwimlanes}}else if(o&&this._updateSwimlanes){for(g=0;g<this._updateSwimlanes.length;g++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[g]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[g]]);delete this._updateSwimlanes}else"pseudoGroup"!=t.type&&ej.datavisualization.Diagram.DiagramContext.update(t,this);return this._updateSelectionHandle(!0),!0}return!1}return m=this.findNode(t._parent),this.translateLabel(m,t,e,i),ej.datavisualization.Diagram.DiagramContext.update(t,this),this._updateSelectionHandle(!0),!0}},_removeContainerConnector:function(t){var e,i,a=[];if(t&&t.length>0)for(e=0;e<t.length;e++)(i=this.nameTable[this._getChild(t[e])])&&!i.segments?a.push(t[e]):!i.segments||i.sourceNode||i.targetNode||a.push(t[e]);return a},_moveOnLane:function(t,e,i,a){var n,o,s,r=!1,l=0,d=!1,h=0;return i=i||0,a=a||0,e.children&&e.children.length>0&&((n=this.nameTable[this._getChild(e.children[0])])&&-1!=n.name.indexOf("_Headerr")&&("horizontal"===e.orientation?l=n.width:"vertical"===e.orientation&&(h=n.height))),t&&e?(o=ej.datavisualization.Diagram.Util.bounds(t),s=ej.datavisualization.Diagram.Util.bounds(e),o.y+a>=s.y+e.paddingTop+h&&(r=!0),o.x+i>=s.x+e.paddingLeft+l&&(d=!0),{proceedY:r,proceedX:d,x:s.x+e.paddingLeft+l-o.x+i,y:s.y+e.paddingTop+h-o.y+a}):void 0},_selectCommand:function(t){this._isEditing&&(this._endEdit(),document.getElementById(this._id).focus()),t.keyDownEventArgs.preventDefault(),this.selectAll()},_nudgeCommand:function(t){!this._currentState&&this.selectionList[0]&&(this._currentState={x:this.selectionList[0].offsetX,y:this.selectionList[0].offsetY}),this.nudge(t.parameter,t.keyDownEventArgs.shiftKey?5:1),t.keyDownEventArgs.preventDefault()},_startEditCommand:function(){var t,e,i;this.selectionList.length>0&&("pseudoGroup"==(t=this.selectionList[0]).type||("text"===t.type&&this._setLabelEditing(t.textBlock)&&this._startEdit(t),t.isSwimlane?(e=this.nameTable[t.name+"_header_swimlane"])&&this._startEdit(e):t.isLane?t.children&&t.children.length>0&&((e=this.nameTable[this._getChild(t.children[0])])&&this._startEdit(e)):t.type&&"phase"===t.type?(i=this.nameTable["phaseStack"+t.name])&&this._startEdit(i):t.labels.length>0&&this._setLabelEditing(t.labels[0])&&this._startEdit(t)))},_findObjectByName:function(t){var e=null;return this._findNode(t)&&(e=this._findNode(t)),this._findConnector(t)&&(e=this._findConnector(t)),e},_findObjectByIndex:function(t,e){var i,a,n,o,s,r=null;if(e){if(s=this.nameTable[this.selectionList[0].parent])for(i=this._getChildren(s.children),o=0;o<i.length;o++)(a=this.nameTable[i[o]]).zOrder===t&&(r=i[o])}else{for(n=0;n<this.nodes().length;n++)(a=this.nodes()[n]).zOrder!==t||a._isProcessed||(r=a,a._isProcessed=!0);for(n=0;n<this.connectors().length;n++)(a=this.connectors()[n]).zOrder!==t||a._isProcessed||(r=a,a._isProcessed=!0)}return"string"==typeof r?this.nameTable[r]:r},_findOverlapNode:function(t,e){var i,a,n,o,s,r,l,d=[],h=[];if(t.parent){if(n=ej.datavisualization.Diagram.Util.bounds(t),o=this.nameTable[t.parent])for(r=this._getChildren(o.children),i=0;i<r.length;i++)r[i]!==t.name&&(s=this.nameTable[r[i]],l=ej.datavisualization.Diagram.Util.bounds(s),s&&this._intersect(n,l)&&h.push(s))}else{for(i=0;i<this.nodes().length;i++)d.push(this.nameTable[this._getChild(this.nodes()[i])]);for(i=0;i<this.connectors().length;i++)d.push(this.nameTable[this._getChild(this.connectors()[i])]);if("sendToBack"===e||"bringToFront"===e)return d;if(n=ej.datavisualization.Diagram.Util.bounds(t),t)for(a=0;a<d.length;a++)l=ej.datavisualization.Diagram.Util.bounds(d[a]),t.name===d[a].name||t.children&&this._collectionContains(d[a].name,t.children)||this._intersect(n,l)&&h.push(d[a])}return h},_intersect:function(t,e){return t.x<=e.x+e.width&&e.x<=t.x+t.width&&t.y<=e.y+e.height&&e.y<=t.y+t.height},_focusToItem:function(t){var e,i=this.nodes(),a=this.connectors(),n=0,o=[],s=this;if(i.length||a.length){this._diagramElements||(o=this.nodes().concat(this.connectors()),o=(o=this._sortByZIndex(o,!0)).map(function(t){return t.name}),this._diagramElements=o),n=this._focusedElement||this.selectionList.length||!this._diagramElements.length?this._focusedElement?this._diagramElements.indexOf(this._focusedElement):"pseudoGroup"!=this.selectionList[0].type?this._diagramElements.indexOf(this.selectionList[0].name):Math.min.apply(Math,this.selectionList[0].children.map(function(t){return s._diagramElements.indexOf(t.name||t)})):t.keyDownEventArgs.shiftKey?0:this._diagramElements.length-1;do{n=t.keyDownEventArgs.shiftKey?0!=n?--n:this._diagramElements.length-1:n!=this._diagramElements.length-1?++n:0,"pseudoGroup"!=this.nameTable[this._diagramElements[n]].type&&(this._focusedElement=this._diagramElements[n])}while(!ej.datavisualization.Diagram.Util.canSelect(this.nameTable[this._focusedElement])&&ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[this._focusedElement],"lock",this));e={x:(e=ej.datavisualization.Diagram.Util.bounds(this.nameTable[this._focusedElement])).x-8,y:e.y-8,width:e.width+16,height:e.height+16},this.bringIntoView({x:e.x-25,y:e.y-25,width:e.width+50,height:e.height+50}),ej.datavisualization.Diagram.SvgContext._drawNavigationHighlighter(e,this._adornerSvg,this._adornerLayer,this._currZoom),t.keyDownEventArgs.preventDefault()}},_selectFocusedItem:function(t){ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer);var e=this.nameTable[this._focusedElement];this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Keydown,e&&this.addSelection(e,!0),this._diagramElements=null,this._focusedElement=null,t.keyDownEventArgs.preventDefault()},_createDefaultTooltip:function(){var t,e=document.createElement("div"),i={id:this.element[0].id+"_DefaulttooltipDiv",class:"e-diagram-tooltip-default",style:"padding-top:3px; height: 24px;pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(e,i),this._tooltipLayer.appendChild(e),this.model.tooltipTemplateId||(t=document.createElement("span"),i={class:"e-diagram-tooltipLabel-default",id:"e-diagram-tooltipLabel-default"},ej.datavisualization.Diagram.Util.attr(t,i),e.appendChild(t)),e},_createMouseOverTooltip:function(){var t=document.createElement("div"),e={id:this.element[0].id+"_mouseovertooltipDiv",class:"e-diagram-tooltip-mouseover",style:"pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(t,e),this._tooltipLayer.appendChild(t),t},_renderTooltip:function(t,e){var i,a,n,o,s,r,l,d;t.parent&&this.nameTable[t.parent]&&this.nameTable[t.parent].container&&(i=this._currZoom,t={x:(a=ej.datavisualization.Diagram.Util.bounds(this.activeTool.helper,!0)).x*i,y:a.y*i,width:a.width*i,height:a.height*i,rotateAngle:this.activeTool.helper.rotateAngle,offsetX:this.activeTool.helper.offsetX,offsetY:this.activeTool.helper.offsetY,type:"SwimlaneHelper"}),this.model.selectedItems.tooltip&&((n=document.getElementById(this.element[0].id+"_DefaulttooltipDiv"))||(n=this._createDefaultTooltip()),r=this._currZoom,this.model.selectedItems.tooltip.templateId?$.templates&&this.model.selectedItems.tooltip&&(t.segments||((d=this._getTooltipPosition(t,this.model.selectedItems.tooltip)).x=-this._hScrollOffset+d.x*r,d.y=-this._vScrollOffset+d.y*r,n.style.top=d.y+"px",n.style.left=d.x+"px",n.style.transform="translate("+d.tx+" ,"+d.ty+")",s=$.templates("#"+this.model.selectedItems.tooltip.templateId).render(t),$(n).html(s))):(e&&(n.style.width="150px"),150,l=n.childNodes[0],this.activeTool instanceof ej.datavisualization.Diagram.MoveTool?t.segments||(o="SwimlaneHelper"!==t.type?"X : "+Math.round(t.offsetX-t.width*t.pivot.x)+"px  Y : "+Math.round(t.offsetY-t.height*t.pivot.y)+"px":"X : "+Math.round(t.x)+"px  Y : "+Math.round(t.y)+"px"):this.activeTool instanceof ej.datavisualization.Diagram.ResizeTool?o="W : "+Math.round(t.width)+"px  H : "+Math.round(t.height)+"px":this.activeTool instanceof ej.datavisualization.Diagram.RotateTool&&(e&&(n.style.width="50px"),50,o=Math.round(t.rotateAngle)+"°"),o?((d=this._getTooltipPosition(t,this.model.selectedItems.tooltip)).x=-this._hScrollOffset+d.x*r,d.y=-this._vScrollOffset+d.y*r,n.style.top=d.y+"px",n.style.left=d.x+"px",n.style.transform="translate("+d.tx+" ,"+d.ty+")",l.textContent=o):this._removeTooltip()))},_removeTooltip:function(){var t=document.getElementById(this.element[0].id+"_DefaulttooltipDiv");t&&t.parentNode.removeChild(t)},_removeMouseOverTooltip:function(){var t=document.getElementById(this.element[0].id+"_mouseovertooltipDiv");t&&t.parentNode.removeChild(t)},_renderCanvas:function(t){this._browserInfo=ej.browserInfo(),this._canvas=document.getElementById(this.element[0].id+"_canvas"),this._canvas||(this._canvas=document.createElement("div"),this.element.append(this._canvas)),this._canvas.setAttribute("id",this.element[0].id+"_canvas"),(null===this._canvas.getAttribute("class")||""===this._canvas.getAttribute("class"))&&this._canvas.setAttribute("class","drawing"),$(this._canvas).css({position:"relative",height:this.model.height,width:this.model.width}),this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width}),this._views[this._id].canvas=this._canvas,this.element[0].setAttribute("tabindex","0"),this._renderDiagram(t),ej.datavisualization.Diagram.Util.canFloatElements(this)&&this._setItemDraggable(this._canvas)},_getDigramBounds:function(t){var e,i,a,n,o;return e=this._spatialSearch.pageLeft||0,i=this._spatialSearch.pageTop||0,a=this._spatialSearch.pageRight-this._spatialSearch.pageLeft||0,n=this._spatialSearch.pageBottom-this._spatialSearch.pageTop||0,"content"!=t&&(this.model.pageSettings&&this._multiplePage()?(e=this._spatialSearch.pageLeft,i=this._spatialSearch.pageTop,this._pageWidth()&&(e=Math.floor(e/this._pageWidth())*this._pageWidth(),a=Math.ceil(this._spatialSearch.pageRight/this._pageWidth())*this._pageWidth()-e),this._pageHeight()&&(i=Math.floor(i/this._pageHeight())*this._pageHeight(),n=Math.ceil(this._spatialSearch.pageBottom/this._pageHeight())*this._pageHeight()-i),null===this._spatialSearch.pageRight&&0!==this._pageWidth()&&(a=this._pageWidth()),null===this._spatialSearch.pageBottom&&0!==this._pageHeight()&&(n=this._pageHeight())):(this._pageWidth()&&(e=0,a=this._pageWidth()),this._pageHeight()&&(i=0,n=this._pageHeight()))),(o=new ej.datavisualization.Diagram.Rectangle).x=e,o.y=i,o.width=a,o.height=n,o},_initContextMenu:function(t){this.enableContextMenu()?this._renderContextMenu(t):$("#"+this.element[0].id+"_contextMenu").remove()},_renderContextMenuItem:function(t){var e,i,a,n,o,s,r=document.createElement("li"),l=document.createElement("a"),d=ej.datavisualization.Diagram.Locale[this.locale()];if(d||(d=ej.datavisualization.Diagram.Locale["en-US"]),l.innerHTML=d[t.name]||t.text,r.setAttribute("id",this.element[0].id+"_contextMenu_"+t.name),(e=document.createElement("span")).setAttribute("id",t.name+"_image"),i="display:table-cell; vertical-align:middle; text-align:center;",t.imageUrl&&(i=i+"background-image: url("+t.imageUrl+");width:25px;height:25px"),e.setAttribute("style",i),a="sf-d-menuitem "+t.name,t.cssClass&&(a=a+" "+t.cssClass),e.setAttribute("class",a),l.appendChild(e),t.subItems&&t.subItems.length>0){for(n=document.createElement("ul"),o=0;o<t.subItems.length;o++)(s=this._renderContextMenuItem(t.subItems[o],n)).setAttribute("style","display:block;"),n.appendChild(s);r.appendChild(n)}return r.appendChild(l),r},_renderContextMenu:function(){var t,e,i,a,n,o,s,r,l=$.extend(!0,[],this.model.contextMenu.items);if(!this.model.contextMenu.showCustomMenuItemsOnly){for(t=[],a=0;a<this._defaultContextMenuItems.length;a++)if(e=!1,this.model.contextMenu.items.length)for(i=0;i<this.model.contextMenu.items.length;i++){if(this.model.contextMenu.items[i].name===this._defaultContextMenuItems[a].name){e=!0;break}i!==this.model.contextMenu.items.length-1||e||t.push(this._defaultContextMenuItems[a])}else t.push(this._defaultContextMenuItems[a]);for(a=0;a<t.length;a++)l.push(t[a])}for(a=0,(s=document.createElement("ul")).setAttribute("id",this.element[0].id+"_contextMenu"),a=0;a<l.length;a++)(n=l[a]).templateId?(r=this._renderEjTemplate("#"+n.templateId,n))&&(s.innerHTML=r):n&&n.name&&(o=this._renderContextMenuItem(n,s),s.appendChild(o));this._canvas.appendChild(s),$("#"+this.element[0].id+"_contextMenu").ejMenu({menuType:ej.MenuType.ContextMenu,contextMenuTarget:"#"+this.element[0].id+"_canvas",click:$.proxy(this._onMenuItemClick,this),beforeOpen:$.proxy(this._onContextMenuOpen,this),mouseover:$.proxy(this._onMenuItemMouseOver,this),mouseout:$.proxy(this._onMenuItemMouseOut,this),close:$.proxy(this._onContextMenuClose,this)}),$("#"+this.element[0].id+"_contextMenu")[0].style.display="none"},_onContextMenuClose:function(t){if(this.model.contextMenuClose){var e={diagram:this,contextMenu:t};this._trigger("contextMenuClose",e)}else this.element[0].focus()},_onContextMenuOpen:function(t){var e,i,a,n;if(t.events&&!t.events.originalEvent&&(t.events.originalEvent=t.events),this.activeTool.mouseup&&("textTool"==this.activeTool.name?(this._endEdit(),this.activeTool.singleAction&&this.activeTool.diagram.deactivateTool()):this.activeTool.mouseup(t.events,!0)),this._disableDefaultContextMenu)return delete this._disableDefaultContextMenu,!1;e=this.element[0].id,null===(i=this._findNodeUnderMouse(t))&&t.target&&"segmentEnd"===$(t.target).attr("class")&&this.selectionList[0]&&(i=this.selectionList[0]),a=!1,$(t.target).parents(".e-scrollbar").length&&this.enableContextMenu()&&(t.cancel=!0,$("#"+this.element[0].id+"_contextMenu").ejMenu("instance").hideContextMenu()),this.selectionList[0]&&("pseudoGroup"===this.selectionList[0].type||"group"===this.selectionList[0]._type)&&(a=!0),i||!(this.selectionList.length>0)||a||this.activeTool&&"textTool"==this.activeTool.name||this._clearSelection(),this.enableContextMenu()&&($("#"+e+"_contextMenu_cut")[0]&&($("#"+e+"_contextMenu_cut")[0].style.display=this.selectionList.length?"block":"none"),$("#"+e+"_contextMenu_copy")[0]&&($("#"+e+"_contextMenu_copy")[0].style.display=this.selectionList.length?"block":"none"),$("#"+e+"_contextMenu_paste")[0]&&($("#"+e+"_contextMenu_paste")[0].style.display=this._clipboardData?"block":"none"),$("#"+e+"_contextMenu_undo")[0]&&($("#"+e+"_contextMenu_undo")[0].style.display=this._historyList&&this._historyList.canUndo?"block":"none"),$("#"+e+"_contextMenu_redo")[0]&&($("#"+e+"_contextMenu_redo")[0].style.display=this._historyList&&this._historyList.canRedo?"block":"none"),$("#"+e+"_contextMenu_selectAll")[0]&&($("#"+e+"_contextMenu_selectAll")[0].style.display=this.nodes().length+this.connectors().length?"block":"none"),$("#"+e+"_contextMenu_grouping")[0]&&($("#"+e+"_contextMenu_grouping")[0].style.display=!this.selectionList[0]||"group"!=this.selectionList[0].type&&"pseudoGroup"!=this.selectionList[0].type?"none":"block"),$("#"+e+"_contextMenu_order")[0]&&($("#"+e+"_contextMenu_order")[0].style.display=this.selectionList.length?"block":"none")),(n={diagram:this,contextMenu:t,contextmenu:t}).target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this,this._trigger("contextMenuBeforeOpen",n),this.enableContextMenu()&&($("#"+e+"_contextMenu")[0].style.display="block",$("#"+e+"_contextMenu")[0].clientHeight<=2&&(t.cancel=!0),$("#"+e+"_contextMenu")[0].style.display="none")},_onMenuItemClick:function(t){var e=t.events.ID.replace(this._id+"_contextMenu_","");if(t.canExecute=!0,t.target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this,this._trigger("contextMenuClick",t),t.canExecute)switch(e){case"cut":this.cut();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"selectAll":this.selectAll();break;case"group":this.group();break;case"ungroup":this.ungroup();break;case"bringToFront":this.bringToFront();break;case"sendToBack":this.sendToBack();break;case"moveForward":this.moveForward();break;case"sendBackward":this.sendBackward()}},_onMenuItemMouseOver:function(t){var e=t.events.element.lastChild.childNodes[1];$(e).addClass("hover")},_onMenuItemMouseOut:function(t){var e=t.events.element.lastChild.childNodes[1];$(e).removeClass("hover")},_renderDiagram:function(t){var e=this;this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._layoutUpdate||this._doLayout(),this._views.forEach(function(i){var a,n=e._views[i];"mainview"==n.type&&n.context==ej.datavisualization.Diagram.SvgContext&&(n.context._renderDocument(n,e,t),e._createScrollbar(e._canvas,e),ej.datavisualization.Diagram.ScrollUtil._initScrollbar(e),ej.datavisualization.Diagram.PageUtil._updatePageSize(e)),t||(a=e._setNodeZOrder(n),e._renderDiagramObjects(a,n))}),$(this._svg.document).pinchDiagram(this._view,this)},_createScrollbar:function(t,e){var i,a=document.createElement("div");a.setAttribute("id",t.id+"_hScrollbar"),document.getElementById(t.id+"_hScrollbar")||e._svgParent.appendChild(a),(i=document.createElement("div")).setAttribute("id",t.id+"_vScrollbar"),document.getElementById(t.id+"_vScrollbar")||e._svgParent.appendChild(i)},_disableScrollbar:function(){this._isMobile&&($("#"+this._hScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}),$("#"+this._vScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}))},_doLayout:function(){var t,e;if(this.model.layout&&this._layoutType()!==ej.datavisualization.Diagram.LayoutTypes.None&&!this._isLoad&&(this._updateEdgeCollection(),ej.datavisualization.Diagram.Layout.doLayout(this),ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&(t=this.nodes()).length>1))for(this.lineRouting.GenerateVisibilityGraph(this,t.length),e=0;e<t.length;e++)this._updateAllEdges(t[e])},_updateNodes:function(){for(var t=this.nodes(),e=0;e<t.length;e++)ej.datavisualization.Diagram.DiagramContext.update(t[e],this)},_updateConnectors:function(){for(var t=this.connectors(),e=0;e<t.length;e++)ej.datavisualization.Diagram.DiagramContext.update(t[e],this)},_updateEdgeCollection:function(){for(var t=0;t<this.connectors().length;t++)this._updateEdges(this.connectors()[t])},updateViewPort:function(){this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),ej.datavisualization.Diagram.DiagramContext.updateViewPort(this),this.model.scrollSettings.viewPortHeight=this._viewPort.height,this.model.scrollSettings.viewPortWidth=this._viewPort.width;var t=this;this._views.forEach(function(e){var i;"overview"==t._views[e].type&&((i=$("#"+e).ejOverview("instance"))&&i._scrollOverviewRect(t._hScrollOffset,t._vScrollOffset,t._currZoom))}),ej.datavisualization.Diagram.ScrollUtil._updateRuler(this,t._hScrollOffset,t._vScrollOffset)},_containsSameIndex:function(){return!1},_setZorder:function(t){var e,i,a;if(t&&t.zOrder){if(-1==t.zOrder)if(this._containsSameIndex(this._zOrder)){do{this._zOrder++}while(this._containsSameIndex(this._zOrder));t.zOrder=this._zOrder}else t.zOrder=this._zOrder,this._zOrder++;if("group"===t._type)for(e=t.children,a=0;a<e.length;a++)(i=this.nameTable[this._getChild(e[a])])&&i.zOrder&&-1===i.zOrder&&this._setZorder(i)}},_union:function(t,e){var i=Math.min(t.x,e.x),a=Math.min(t.y,e.y),n=Math.max(t.x+t.width,e.x+e.width),o=Math.max(t.y+t.height,e.y+e.height);return new ej.datavisualization.Diagram.Rectangle(i,a,n-i,o-a)},_getSeperetor:function(t){return this.nameTable[t]},_updateNextPhase:function(t,e,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._updateNextPhase(this,t,e,i)},_getOuterNodes:function(t,e,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getOuterNodes(this,t,e,i)},_getInnerNodes:function(t,e,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getInnerNodes(this,t,e,i)},_moveOuterNodes:function(t,e,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOuterNodes(this,t,e,i)},_moveOnPhaseChange:function(t,e,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOnPhaseChange(this,t,e,i)},_getPhaseDifferece:function(t,e,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseDifferece(this,t,e,i)},_updatePhaseOffset:function(t){var e,i,a=this.nameTable[t.name],n=this.nameTable[a.parent],o=this._getChildren(n.children),s=o.indexOf(a.name);o&&o.length>0&&s>-1&&t.offset!=undefined&&(this.nameTable[o[s]],e=t.offset-a.offset,i=this.nameTable[n.parent],e=this._getPhaseDifferece(i,s,e),this._moveOuterNodes(i,e,s),0===s?"horizontal"===a.orientation?(a.width+=e,a.offset=a.width,this._comparePropertyValues(i,"offsetX",{offsetX:i.offsetX+e/2},this.activeTool.inAction)):(a.height+=e,a.offset=a.height,this._comparePropertyValues(i,"offsetY",{offsetY:i.offsetY+e/2},this.activeTool.inAction)):"horizontal"===a.orientation?(a.width+=e,a.offset+=e,this._comparePropertyValues(i,"offsetX",{offsetX:i.offsetX+e/2},this.activeTool.inAction)):(a.height+=e,a.offset+=e,this._comparePropertyValues(i,"offsetY",{offsetY:i.offsetY+e/2},this.activeTool.inAction)),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._moveOnPhaseChange(a,e,s),this._updateNextPhase(i,e,s),delete this._disablePhaseUpdate,delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,i))},_updatePhase:function(t){var e=this.nameTable[t.name];e&&(e.offset!=undefined&&t.offset!=undefined&&t.offset!=e.offset&&(this._comparePropertyValues(e,"offset",{offset:t.offset},this.activeTool.inAction),this._updatePhaseOffset(t),this._hasSelection()&&this._clearSelection(!0)),this._updateSwimlanePhase(e,t))},_setNodeZOrder:function(){for(var t,e,i,a,n,o,s,r=null,l=(l=this.nodes()).concat(this.connectors()),d=0;d<l.length;d++)""===l[d].parent&&this._setZorder(l[d]);for(t=0;t<l.length;t++){for(e=t+1;e<l.length;e++)l[t].zOrder>l[e].zOrder&&""===l[t].parent&&""===l[e].parent&&(r=l[t],l[t]=l[e],l[e]=r);if("group"===l[t]._type&&(i=l[t].children,!l[t].isSwimlane))for(a=0;a<i.length;a++)for(n=a+1;n<i.length;n++)o="object"==typeof i[a]?i[a]:this.nameTable[i[a]],s="object"==typeof i[n]?i[n]:this.nameTable[i[n]],!(o.zOrder>s.zOrder)||o.isPhase||s.isPhase||o.isLane||s.isLane||(r=i[a],i[a]=i[n],i[n]=r)}return l},_renderDiagramObjects:function(t,e,i,a){var n,o,s,r,l=[],d=[];for(this._initLayer(),r=0,n=t.length;r<n;++r)"node"===this.getObjectType(t[r])||"group"===this.getObjectType(t[r])?(o=this.nameTable[t[r].name])&&this._outOfBoundsOnNudge(o,0,0)?(this._isLoad&&(this._disableSegmentChange=!0),ej.datavisualization.Diagram.DiagramContext._renderNodeObject(o,e,i,a,this),this._isLoad&&delete this._disableSegmentChange,this._updateQuad(o)):l.push(r):(s=this.nameTable[t[r].name]||t[r])&&this._outOfBoundsOnNudge(s,0,0)?(ej.datavisualization.Diagram.DiagramContext._renderConnectorObject(s,e,this),this._updateQuad(s)):d.push(r);if(l.length>0||d.length>0){if(l.length>0){for(r=l.length-1;r>=0;r--)this._removeFromNameTable(this.nodes()[r]),this.nodes().splice(r,1);this._nodes=$.extend(!0,[],this.nodes())}if(d.length>0){for(r=d.length-1;r>=0;r--)this._removeFromNameTable(this.connectors()[r]),this.connectors().splice(r,1);this._connectors=$.extend(!0,[],this.connectors())}}},_removeFromNameTable:function(t){var e,i;if(t&&"group"===t._type)for(e=0;e<t.children.length;e++)"group"===(i=t.children[e])._type?this._removeChildrenFromNameTable(i):delete this.nameTable[this._getChild(i)];delete this.nameTable[this._getChild(t)]},_unWireEvents:function(){var t=$(this._canvas);this._off(t,ej.eventType.mouseDown,this._mousedown),this._off(t,ej.eventType.mouseMove,this._mousemove),this._off(t,ej.eventType.mouseUp,this._mouseup),this._off(t,ej.eventType.mouseLeave,this._documentmouseup),this._off(t,"doubletap",this._doubleclick),this._off(this.element,"keydown",this._keydown),this._off(this.element,"keyup",this._keyup),this._off(t,"pinchin",this._pinchin),this._off(t,"pinchout",this._pinchout),this._off(this.element,"touchstart",this._handleTouchStart),"mozilla"===ej.browserInfo().name?this._off(this.element,"DOMMouseScroll",this._handleMouseWheel):this._off(this.element,"mousewheel",this._handleMouseWheel),this._off($(document),"mouseup",this._documentmouseup),window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._off($(window),"resize",this.updateViewPort)},_wireEvents:function(){var t,e=$(this._canvas);this._on(e,ej.eventType.mouseDown,this._mousedown),this._on(e,ej.eventType.mouseMove,this._mousemove),this._on(e,ej.eventType.mouseUp,this._mouseup),this._on(e,ej.eventType.mouseLeave,this._documentmouseup),this._on(e,"doubletap",this._doubleclick),this._on(this.element,"keydown",this._keydown),this._on(this.element,"keyup",this._keyup),this._on(this.element,"contextmenu",this._preventDefaultContextMenu),this._on(e,"pinchin",this._pinchin),this._on(e,"pinchout",this._pinchout),this._on(this.element,"touchstart",this._handleTouchStart),"mozilla"===ej.browserInfo().name?this._on(this.element,"DOMMouseScroll",this._handleMouseWheel):this._on(this.element,"mousewheel",this._handleMouseWheel),this._on($(document),"mouseup",this._documentmouseup),window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._on($(window),"resize",this.updateViewPort),t=this,$(e).ejDroppable({over:function(e){t._isDropOver=!0;var i=!1;e.originalEvent&&e.originalEvent.changedTouches?i=!0:e&&e.changedTouches&&(i=!0),i||!1===t.activeTool.inAction&&t._selectedSymbol&&(t._viewPort||(t._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(t,!0)),t._addSymbolToDiagram(e),t._isSvgDropover=!0)},out:function(){delete t._isDropOver},drop:function(e,i){t._svgdrop(e,i),t._isDropped=!0}})},_preventDefaultContextMenu:function(t){if(this._disableDefaultContextMenu)return t.preventDefault(),t.stopPropagation(),delete this._disableDefaultContextMenu,!1},_mousePosition:function(t,e){var i=this._isTouchEvent(t),a=this._scrollLeft!==undefined?this._scrollLeft:this._canvas.scrollLeft,n=this._scrollTop!==undefined?this._scrollTop:this._canvas.scrollTop,o=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),s=i.clientX+a-o.left,r=n+i.clientY-o.top,l=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);return e||(s=(s+this._hScrollOffset-l.left)/this._currZoom,r=(r+this._vScrollOffset-l.top)/this._currZoom),new ej.datavisualization.Diagram.Point(Math.round(100*s)/100,Math.round(100*r)/100)},_contextmenu:function(t){t.preventDefault(),t.stopPropagation()},_pinchin:function(t){this._getTouchEvent(t),t.preventDefault()},_pinchout:function(t){this._getTouchEvent(t),t.preventDefault()},_handleTouchStart:function(t){this._getTouchEvent(t),this._isForeignObject(t.originalEvent.target)||t.preventDefault()},_getTouchEvent:function(t){this._isTouchedEvent="touchmove"==t.type||"touchstart"==t.type||"touchend"==t.type},_getvalues:function(t){$(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group");var e,i,a=t.target.id.split("_");return e=this.findNode(a[0]),i=this._mousePosition(t),{source:this._findPortAtPoint(i,e),action:ej.datavisualization.Diagram.ActiveTool}},_mousedown:function(t){var e,i,a,n;this._isDiagramMouseDown=!0,this._getTouchEvent(t),this._isPinching=!1,this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._diagramElements=null,ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer),this._invoke(t)&&(this._scrollLeft=this._canvas.scrollLeft,this._scrollTop=this._canvas.scrollTop,this._controlBBox=this._canvas.getBoundingClientRect(),e=this._mousePosition(t),(this._isForeignObject(t.originalEvent.target)||this._isHyperLink(t))&&!this._isForeignEvent(t)||t.preventDefault(),this.model.contextMenu&&"none"!==$("#"+this.element[0].id+"_contextMenu").css("display")&&(t.cancel=!0),this._isEditing&&(this._endEdit(),"textTool"===this.activeTool.name&&this.activeTool.singleAction&&this.activeTool.diagram.deactivateTool()),(1===t.which||3===t.which||0===t.which&&t.originalEvent.changedTouches)&&(this._removeMouseOverTooltip(),0===t.which&&t.originalEvent.changedTouches&&(i=null,a=this._isUserHandle(t),this._isInternalTool(this.activeTool)&&!this.activeTool.inAction&&(a||(i=this._findNodeUnderMouse(t),this._raiseMouseEvents(i,e)),!i&&this.selectionList[0]&&(i=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(t,i))),(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&t.shiftKey&&(!(i=this._findNodeUnderMouse(t))&&this.selectionList[0]&&(i=this.selectionList[0]),this._checkToolToActivate(t,i)),"panTool"===this._toolToActivate?this.activeTool=this.tools[this._toolToActivate]:("move"===this._toolToActivate&&((i=this._findNodeUnderMouse(t))&&i.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(i)&&(this._toolToActivate="select",this._currentCursor="default",this._updateCursor())),n=this.tools[this._toolToActivate]||this.activeTool,this.activateTool(this._toolToActivate,n?n.singleAction:null)),this.activeTool.mousedown&&this.activeTool.mousedown(t),this.activeTool._findNodeUnderMouse&&(this._focusedElement=this.activeTool._findNodeUnderMouse(t,!0))))},_getParentNode:function(t){var e,i=this.findNode(t);return i.parent&&((e=this.findNode(i.parent)).parent&&this._getParentNode(e.name)),e.name},_getDiagramElements:function(t){return t&&(t.isSwimlane||t.isLane)&&(t=this.getNode(t)),t},_mousemove:function(t){var e,i,a,n,o,s,r,l,d,h,g;if(this._getTouchEvent(t),this._mouseEventTriggered=!0,this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0)),"touchmove"==t.type&&t.originalEvent.touches.length>1)this._isPinching=!0;else if(this._isPinching=!1,o=null,e=this._isUserHandle(t),!1===this.activeTool.inAction&&this._selectedSymbol)this._previousData=null,this._addSymbolToDiagram(t);else{if(this.activeTool.inAction&&"move"===this.activeTool.name&&this.selectionList[0]&&(i=this._findNodeUnderMouse(t),this.nameTable[this._previousData]&&(!i||this._previousData!=(i._isHeader?i.parent:i.name))&&(this.nameTable[this._previousData].parent&&(a=this._getParentNode(this.nameTable[this._previousData].name)),n={element:this._getDiagramElements(this.selectionList[0]),target:this._getDiagramElements(this.nameTable[this._previousData]),targetType:this.getObjectType(this.nameTable[this._previousData]),actualObject:this.findNode(a)?a:null},this._raiseEvent("dragLeave",n),this._previousData=null),i&&this._previousData&&this.nameTable[this._previousData]!==(i._isHeader?this.nameTable[i.parent]:i)&&(this._previousData=i._isHeader?i.parent:i.name,this.nameTable[this._previousData].parent&&(a=this._getParentNode(this.nameTable[this._previousData].name)),n={element:this._getDiagramElements(this.selectionList[0]),target:this._getDiagramElements(this.nameTable[this._previousData]),targetType:this.getObjectType(this.nameTable[this._previousData]),actualObject:this.findNode(a)?a:null},this._raiseEvent("dragEnter",n))),o=ej.datavisualization.Diagram.Util.isClassifier(t)?ej.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(t,this):this._findNodeUnderMouse(t),this._isInternalTool(this.activeTool)&&!this.activeTool.inAction?(e||o&&(this._nodeUnderMouse&&this._nodeUnderMouse!=o&&!this._nodeUnderMouse.segments&&this.activeTool._showPort(this._nodeUnderMouse,!0),o.segments||this.activeTool._showPort(o)),!o&&this.selectionList[0]&&(o=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(t,o),1==t.which&&1==t.buttons&&(this._focusedElement=this.activeTool._findNodeUnderMouse(t,!0))):(s=!0,this._activatedFromPort&&!this.activeTool.inAction&&(l=null,this._nodeUnderMouse&&!this._nodeUnderMouse.segments&&(r=this._mousePosition(t),l=this._findPortAtPoint(r,this._nodeUnderMouse)),l&&(!l||l.constraints&ej.datavisualization.Diagram.PortConstraints.ConnectOnDrag)||(ej.datavisualization.Diagram.SvgContext._removePortHighlighter(this._adornerSvg,this._adornerLayer),this.deactivateTool(),s=!1,delete this._activatedFromPort)),s&&(this.activeTool.inAction||(this._toolToActivate=this.activeTool.name,this._currentCursor=this.activeTool.cursor),d=ej.datavisualization.Diagram.Util.isClassifier(t)?ej.datavisualization.Diagram.ClassifierHelper.getDropableElementUnderMouse(t,this):this._findNodeUnderMouse(t))),this._updateCursor(),d=d||this._findNodeUnderMouse(t),this.activeTool.mousemove&&this.activeTool.mousemove(t),this._raiseMouseEvents(d,t),h=!1,this.activeTool.inAction){do{if(!d||ej.datavisualization.Diagram.Util.canAllowDrop(d))break;if(d.parent)d=this.nameTable[d.parent];else{if(d.segments){h=!0;break}if(d.container)break;d=null}}while(d);this._nodeUnderMouse&&this._nodeUnderMouse.segments&&this._nodeUnderMouse!=d&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg),d&&d!=this._focusedElement&&d!=this.nodeUnderMouse&&(h||ej.datavisualization.Diagram.Util.canAllowDrop(d))?(g=this.getObjectType(d),this._focusedElement&&(this._focusedElement.isLane||this._focusedElement.isSwimlane||this._focusedElement.isPhase)&&"node"==g&&"connector"==g?this._nodeUnderMouse=null:this._nodeUnderMouse&&(this._nodeUnderMouse.isLane||this._nodeUnderMouse.isSwimlane||this._nodeUnderMouse.isPhase)&&d.segments||(this._nodeUnderMouse=d)):d&&d.container||(this._nodeUnderMouse=null)}else this._focusedElement||(this._nodeUnderMouse=d);this._initiateAutoScroll(t)}},_mouseup:function(t){var e,i,a,n,o,s,r,l,d,h,g;this._getTouchEvent(t),!this._isPinching&&t.originalEvent&&t.originalEvent.target&&this._invoke(t)&&(!(e=this._isForeignObject(t.originalEvent.target))&&this._isHyperLink(t)&&t.preventDefault(),this.activeTool instanceof ej.datavisualization.Diagram.PanTool?(document.onmousemove=null,document.onmouseup=null,(!ej.datavisualization.Diagram.Util.isPageEditable(this)||this.activeTool instanceof ej.datavisualization.Diagram.PanTool)&&!this.activeTool.inAction&&((s=this.activeTool._findNodeUnderMouse(t))&&this._raiseEvent("itemClick",{actualObject:s,selectedObject:s,model:this.model,cancel:!1,event:t}),i=this._mousePosition(t.originalEvent),this._raiseEvent("click",{element:s,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(t),offsetX:i.x,offsetY:i.y,event:t}),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(document.onmousemove=null,document.onmouseup=null))):t.target.id!==this._id+"_canvas_svg"||"panTool"!=!this.activeTool.name&&this.activeTool.inAction||(i=this._mousePosition(t.originalEvent),this._raiseEvent("click",{element:this,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(t),offsetX:i.x,offsetY:i.y,event:t})),t.target&&!this._isAnimating&&((a=$(t.target).parents(".ej-d-icon-template"))&&a.length&&((n=a[0]).id.endsWith("_expander")&&(o=n.id.replace("_expander",""),(s=this.nameTable[o])&&(("node"==(r=this.getObjectType(s))||"group"==r)&&(this.clearSelection(),ej.datavisualization.Diagram.LayoutUtil.expandSubTree(this,s,s.name,!0,ej.datavisualization.Diagram.Util.canSelect(s))))))),!this._selectedSymbol||this._selectedSymbol.isLane||this._isNodeEnters?this._selectedSymbol&&this._isNodeEnters&&(l=this.findNode(this.selectionList[0].name),this.edgeTable?delete this.edgeTable:(d={},d=this._getChildTable(this.selectionList[0],d),"pseudoGroup"==this._selectedSymbol.type?h={type:"collectionchanged",object:this._updatePsedoGroupChildren(this._selectedSymbol),childTable:jQuery.extend(!0,{},d),changeType:"insert",category:"internal"}:this._selectedSymbol.isPhase||(h={type:"collectionchanged",object:jQuery.extend(!0,{},this._selectedSymbol),childTable:jQuery.extend(!0,{},d),changeType:"insert",category:"internal"}),this.addHistoryEntry(h),this._isDragg=!0),this._clearSelection(!0),this._selectedSymbol=null,delete this._isNodeEnters,"pseudoGroup"==l.type&&(this.nodes().push(l),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[l.name]=l,ej.datavisualization.Diagram.Util._updateGroupBounds(l,this)),this._addSelection(l)):(this._findLabelEditing=!0,this._dropSymbol(null,t),delete this._findLabelEditing,this._isDragg=!0),"msie"===ej.browserInfo().name&&this._doubleClickEvent&&(this.activeTool._isMouseDown=!0),this.activeTool.mouseup?(this.activeTool.inAction||(this._isSelectMode=!0),this.activeTool.mouseup(t),delete this._isSelectMode):this._isInternalTool(this.activeTool)||(this._isUserHandle(t)&&(g=this.activeTool.cursor),this.deactivateTool()),this.activeTool instanceof ej.datavisualization.Diagram.TextTool||!document.activeElement||document.activeElement.id===this.element[0].id||this._isEditing||e||3===t.which&&this.enableContextMenu()||this._isDiagramMouseDown&&this.element[0].focus(),this._currentCursor=g||this.activeTool.cursor,"move"===this.activeTool.name&&this._focusedElement&&!ej.datavisualization.Diagram.Util.canSelect(this._focusedElement)&&ej.datavisualization.Diagram.Util.enableLayerOption(this._focusedElement,"lock",this)?(this._currentCursor="default",this._updateCursor()):this._updateCursor()),this._isSvgDropover&&($("#"+this.element[0].id+"_canvas").ejDroppable("instance")._mouseOver=!1),delete this._isSvgDropover,this._focusedElement=null,this._nodeUnderMouse=this._findNodeUnderMouse(t),delete this._scrollLeft,delete this._scrollTop,delete this._controlBBox,this._mouseEventTriggered=!1,this._isDragg=!1,delete this._viewPort,delete this._isDropOver,this._timeStamp=t.timeStamp,delete this._isDiagramMouseDown},_doubleclick:function(t){var e,i,a,n,o,s;if(this._getTouchEvent(t),this._doubleClickEvent=!this._doubleClickEvent,n=this._nodeUnderMouse||this,e={element:this.getNode(n),cancel:!1,actualObject:this.getNode(this.activeTool.actualObject)},this._isEditing||this._raiseEvent("doubleClick",e),i=this.activeTool._drawingPolygon,"panTool"!=this.activeTool.name&&(this._nodeUnderMouse&&this.activeTool._doubleClick(this._nodeUnderMouse),ej.datavisualization.Diagram.Util.isClassifier(t)&&(a=ej.datavisualization.Diagram.ClassifierHelper.getEditableElementUnderMouse(t,this)),ej.datavisualization.Diagram.Util.isPageEditable(this)&&!this.activeTool.inAction&&(this.selectionList.length>0||a||this.activeTool.selectedObject)&&!e.cancel&&!i)){if("umlclassifier"==(n=this.activeTool.selectedObject?this.activeTool.selectedObject:this.selectionList[0]?this.selectionList[0]:a).type)for(o=0;o<n.children.length;o++)n.children[o]="string"==typeof n.children[o]?this.nameTable[n.children[o]]:n.children[o],o!=n.children.length-n.children.length&&o==n.children.length-1&&(n.children[o].labels[0].text="\n---\n"+n.children[o].labels[0].text),o!=n.children.length-n.children.length&&o==n.children.length-2&&(n.children[o].labels[0].text="\n---\n"+n.children[o].labels[0].text),n.labels[0].text+=n.children[o].labels[0].text;this._isEditing||"pseudoGroup"==n.type||e.cancel||(this.activeTool._findLabelUnderMouse(t,!1,this._mousePosition(t.originalEvent),!0),n.labels&&n.labels.length>0&&((s=this.activeTool.getLabelUnderMouse())||(s=n.labels[0])),!this._isEditing&&"text"===n.type&&this._setLabelEditing(n.textBlock)?(this.scrollToNode(n),this._startEdit(n)):this._isEditing||1!==this.selectionList.length||"label"!==this.selectionList[0]._type||n.name!==this.selectionList[0].name?this._isEditing||n.isLaneStack||n.isLane||n.isSwimlane||!(n.labels&&(0===n.labels.length||void 0===n.labels.length)||n.labels&&n.labels.length>0&&this._setLabelEditing(s))?n.isLane&&n.labels&&n.labels.length>0&&this._setLabelEditing(s)?n.labels&&n.labels.length>0?(this.scrollToNode(n),this._startEdit(n)):this.activeTool.selectedObject=null:n.isLane&&(this.activeTool.selectedObject=null):(this.scrollToNode(n),this._startEdit(n)):(this.scrollToNode(this.nameTable[n._parent]),this._startEdit(this.nameTable[n._parent])))}this.activeTool._isMouseDown=!1},_documentmouseup:function(t){var e,i;this._getTouchEvent(t),e=this._selectedSymbol,this._removeMouseOverTooltip(),this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0)),!this.activeTool||!this.activeTool.inAction||this.activeTool instanceof ej.datavisualization.Diagram.TextTool||this.activeTool instanceof ej.datavisualization.Diagram.ShapeTool&&this.activeTool._drawingPolygon||(this._selectedSymbol&&"mouseleave"!=t.type&&(this._findLabelEditing=!0,this._dropSymbol(null,t),delete this._findLabelEditing,this._isDragg=!0),this.activeTool.mouseup(t,!0)),this.activeTool._removeRulerMarkers(),e&&(27!=t.keyCode&&46!=t.keyCode&&(null!=(i=document.getElementsByClassName("e-paletteItem dragClone")[0])&&(i.style.display="block"),this._selectedSymbol=e),this._raiseEvent("dragLeave",{element:this.selectionList[0],target:this,targetType:"diagram"}),this._mouseEventTriggered&&this._delete(this.selectionList[0])),this._isNodeEnters&&(delete this._isNodeEnters,this._selectedSymbol=null,null!=(i=document.getElementsByClassName("dragClone")[0])&&(i.style.display="block")),delete this._viewPort,delete this._isDropOver,this._mouseEventTriggered=!1,this._isDragg=!1},_invoke:function(t){if(t.originalEvent.target){var e=t.originalEvent.target.className;if(e&&"string"==typeof e&&("edit"==e||"editBox"==e||e.indexOf("e-hhandle")>-1||e.indexOf("e-hhandlespace")>-1||e.indexOf("e-vhandle")>-1||e.indexOf("e-vhandlespace")>-1))return!1}return!0},_handleMouseWheel:function(t){var e,i,a,n,o,s,r,l,d,h,g;this._isForeignEvent(t,!0)||(t.originalEvent.preventDefault&&t.originalEvent.preventDefault(),e=new ej.datavisualization.Diagram.Point(0,0),this._isEditing&&this._endEdit(),(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?(e=this._mousePosition(t.originalEvent),t.originalEvent.wheelDelta>0||-40*t.originalEvent.detail>0?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+Number(this.zoomFactor()),0,0,e,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+Number(this.zoomFactor())),0,0,e,!0)):(i=0,a={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},t.originalEvent.wheelDelta>0||-40*t.originalEvent.detail>0?(o=this._vScrollbar.model.minimum,s="limited"===this._scrollLimit()&&this._vScrollOffset-this._scrollPixel>=this.model.pageSettings.scrollableArea.y*this._currZoom,this._vScrollOffset-this._scrollPixel>=o||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||s?(r=!1,"diagram"!==this._scrollLimit()?r=!0:this._vScrollbar&&this._vScrollbar._scrollData&&((l=this._vScrollbar.element[0])&&("visible"===l.style.visibility||""===l.style.visibility)&&(r=!0)),r&&(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset-this._scrollPixel),n=!0,i=-this._scrollPixel)):(this._updateScrollOffset(this._hScrollOffset,o),n=!0,i=0)):(d=this._vScrollbar.model.maximum,h=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),s="limited"===this._scrollLimit()&&(this.model.pageSettings.scrollableArea.y+this.model.pageSettings.scrollableArea.height)*this._currZoom>=this._vScrollOffset+this._scrollPixel+h.height,d>=this._vScrollOffset+this._scrollPixel||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||s?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset+this._scrollPixel),n=!0,i=this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,d),n=!0,i=0)),n&&(g={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},(a.horizontalOffset!=g.horizontalOffset||a.verticalOffset!=g.verticalOffset)&&(this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Pan,this._raiseEvent("scrollChange",{newValues:g,oldValues:a}))),this._updateEditBox(0,i)))},_setActiveTool:function(t){var e,i;this._mousePosition(t);this.activeTool.inAction||!this._isUserHandleActive(this.activeTool.name)&&this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length||(this._isInternalTool(this.activeTool)||this.activeTool.singleAction)&&(i=!1,this.selectionList[0]&&(e=this.selectionList[0],i=this._checkToolToActivate(t,e)),i||(e=this._findNodeUnderMouse(t),this._isUserHandle(t)?($(t.target).parents("g").first().context.id.split("_")[0],this._checkToolToActivate(t,e),this.activeTool=this.tools[this._toolToActivate]):(this._checkToolToActivate(t,e),this._raiseMouseEvents(e),this._isUserHandleActive(this.activateTool.name)&&!this._drawingTool&&(this.activeTool=this.tools[this._toolToActivate]))))},_beginAutoScroll:function(t,e,i){var a=i||100,n=this,o=0,s=0,r=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),l=this._hScrollbar.model.maximum+r.width,d=this._vScrollbar.model.maximum+r.height,h=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);if(this._canAutoScroll){switch(t){case"right":(this._hScrollOffset+r.width+10-h.left<l||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(o=10);break;case"left":(this._hScrollOffset-10>this._hScrollbar.model.minimum-h.left||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(o=-10);break;case"bottom":(this._vScrollOffset+r.height+10-h.top<d||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(s=10);break;case"top":(this._vScrollOffset-10>this._vScrollbar.model.minimum-h.top||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(s=-10)}n._clearTimeOutValue=window.setTimeout(function(i){i={delay:a};n._raiseEvent("autoScrollChange",i),n._updateScrollBar(o,s,t,e,i.delay)},a)}},_updateScrollBar:function(t,e,i,a,n){if(this._clearTimeOutValue&&window.clearTimeout(this._clearTimeOutValue),0===t&&0===e)this._canAutoScroll=!1;else if(this.activeTool.inAction){var o=this._hScrollOffset+t*this._currZoom,s=this._vScrollOffset+e*this._currZoom;this._updateSelectionOnScroll(t,e)?(this._updateScrollOffset(o,s),this._beginAutoScroll(i,a,n)):this._canAutoScroll=!1}},_updateSelectionOnScroll:function(t,e){var i,a,n,o,s=this.activeTool;if("select"===s.name)s.currentPoint=new ej.datavisualization.Diagram.Point(s.currentPoint.x+t,s.currentPoint.y+e),s._updateHelper();else if("orthogonalLine"===s.name||"straightLine"===s.name)s.currentPoint=new ej.datavisualization.Diagram.Point(s.currentPoint.x+t,s.currentPoint.y+e),s._targetPossibleConnection=s._currentPossibleConnection,s._targetPort=s._possibleConnectionPort,s._updateHelper();else if(this.selectionList.length>0){if((i=this.selectionList[0]).isLane||(s.currentPoint=ej.datavisualization.Diagram.Point(s.currentPoint.x+t,s.currentPoint.y+e)),"move"===s.name){if(i.isLane||!s._outOfBoundsDrag(i,t,e))return!1;s._canMoveLabel?this._translateLabel(i,s.activeLabel,t,e):this._translate(i,t,e,this.nameTable)}else"resize"===s.name?(ej.datavisualization.Diagram.SnapUtil._removeGuidelines(this),s._updateSize(i,s.previousPoint,s.currentPoint)):"endPoint"===s.name&&(s.selectedSegment&&"segmentEnd"==s._endPoint?(a=s.currentPoint.x-s.previousPoint.x,n=s.currentPoint.y-s.previousPoint.y,s._updateAdjacentSegments(a,n)):(o=s._updatePoints(i)).cancel||(s._disconnect(i),s._updateConnection(i,o.updateSelection)));s.previousPoint=ej.datavisualization.Diagram.Point(s.currentPoint.x,s.currentPoint.y),s._canMoveLabel||"phase"==i.type||(ej.datavisualization.Diagram.DiagramContext.update(i,this),this._updateSelectionHandle(!0),this._renderTooltip(i))}return!0},_isUserHandle:function(t){return"userHandle"===t.target.parentNode.className.animVal},_isUserHandleActive:function(t){var e,i,a=!1;if(this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0)for(e=0,i=this.model.selectedItems.userHandles.length;e<i;e++){if(this.model.selectedItems.userHandles[e].name===t){a=!0;break}a=!0}return a},_getEventDetail:function(t){return"msie"===ej.browserInfo().name?this._timeStamp?t.timeStamp-this._timeStamp>=300?1:2:1:t.originalEvent.detail},_raiseMouseEvents:function(t,e){var i,a;this._isEditing||(this.nameTable[this._lastNodeUnderMouse]&&(!t||this._lastNodeUnderMouse!=(t._isHeader?t.parent:t.name))&&((i=document.getElementById(this.element[0].id+"_mouseovertooltipDiv"))&&i.parentNode.removeChild(i),this.activeTool.inAction||(this._raiseEvent("mouseLeave",{element:this.getNode(this.nameTable[this._lastNodeUnderMouse])}),this._lastNodeUnderMouse=null),null==this._nodeUnderMouse||this._nodeUnderMouse.segments||this.activeTool instanceof ej.datavisualization.Diagram.LineTool||this.activeTool._showPort&&this.activeTool._showPort(this._nodeUnderMouse,!0)),t&&!this.activeTool.inAction&&(this._lastNodeUnderMouse&&this._lastNodeUnderMouse==(t._isHeader?t.parent:t.name)||(this._lastNodeUnderMouse=t._isHeader?t.parent:t.name,this._raiseEvent("mouseEnter",{element:this.getNode(this._lastNodeUnderMouse)}))),t&&(a={element:this.getNode(t)},this._raiseEvent("mouseOver",a),a.element&&!this.activeTool.inAction?this._renderMouseOverTooltip(t,e):this._removeMouseOverTooltip()))},_renderMouseOverTooltip:function(t,e){var i,a,n,o,s,r,l,d,h,g,c,u;if(ej.datavisualization.Diagram.Util.canShowTooltip(t,this)&&(n="node"==(i=this.getObjectType(t))||"group"==i?ej.datavisualization.Diagram.NodeConstraints:ej.datavisualization.Diagram.ConnectorConstraints,t.constraints&n.InheritTooltip?(a=this.model.tooltip,o=!0):a=t.tooltip,a&&(!o||this._tooltipTemplateId()))){s=(h=this._getTooltipPosition(t,a,e,o)).x,r=h.y,l=h.tx,d=h.ty,"left:"+(s=-this._hScrollOffset+s*this._currZoom)+"px; top:"+(r=-this._vScrollOffset+r*this._currZoom)+"px; display: block; position: absolute; pointer-events: none; transform:translate("+l+","+d+")",(g=document.getElementById(this.element[0].id+"_mouseovertooltipDiv"))||(g=this._createMouseOverTooltip()),g.style.left=s+"px",g.style.top=r+"px",g.style.transform="translate("+l+" ,"+d+")",g.style.display="block",g.style.position="absolute",$.templates&&(c=o?this._tooltipTemplateId():a.templateId,u=$.templates("#"+c).render(t)),$(g).html(u),ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this),g.style.marginLeft=g.style.marginTop="0px";var m=this.element[0].getBoundingClientRect(),p=g.getBoundingClientRect(),f=this.model.scrollSettings.currentZoom,_=ej.datavisualization.Diagram.Util.bounds(t,"rotatetool"==this.activeTool.name);if(m.left>p.left||m.right<p.right){if("mouse"==(o?this._tooltipMode():a.relativeMode)||"center"==a.alignment.horizontal)var v=m.left>p.left?"left":"right",y="right"==v?p.right-m.right:m.left-p.left,b="right"==v?-y-a.margin.right:a.margin.left+y;else"left"!=a.alignment.horizontal&&"right"!=a.alignment.horizontal||"center"!=a.alignment.vertical?("center"==(v=a.alignment.horizontal)&&(v=m.left>p.left?"left":"right"),y="right"==v?p.right-m.right:m.left-p.left,b="right"==v?-y-a.margin.right:a.margin.left+y):(b=_.width*f+p.width+a.margin.left+a.margin.right,b="left"==a.alignment.horizontal?1*b:-1*b);g.style.marginLeft=b+"px"}(m.bottom<p.bottom||m.top>p.top)&&("mouse"==(o?this._tooltipMode():a.relativeMode)||"center"==a.alignment.vertical?(y="top"==(v=m.top>p.top?"top":"bottom")?p.top-m.top:p.bottom-m.bottom,b="top"==v?a.margin.top-y:-(y+a.margin.bottom)):"center"!=a.alignment.horizontal||"bottom"!=a.alignment.vertical&&"top"!=a.alignment.vertical?(y="top"==a.alignment.vertical?m.top-p.top:m.bottom-p.bottom,b="top"==a.alignment.vertical?a.margin.top+y:y-a.margin.bottom):(b=_.height*f+p.height+(a.margin.bottom+a.margin.top),b="bottom"==a.alignment.vertical?-1*b:1*b),g.style.marginTop=b+"px")}},_getTooltipPosition:function(t,e,i,a){var n,o,s,r,l,d=ej.datavisualization.Diagram.Util.bounds(t,!1);if("object"==(a?this._tooltipMode():e.relativeMode)){switch(a?this._horizontalTooltipAlignment():e.alignment.horizontal){case"left":n=d.x,n-=e.margin.left,s="-100%";break;case"right":n=d.right,n+=e.margin.right,s="0%";break;case"center":n=d.center.x,s="-50%"}switch(a?this._verticalTooltipAlignment():e.alignment.vertical){case"top":o=d.y,o-=e.margin.top,r="-100%";break;case"bottom":o=d.bottom,o+=e.margin.bottom,r="0%";break;case"center":o=d.center.y,r="-50%"}}else i&&(n=(l=this._mousePosition(i)).x+e.margin.left,o=l.y+e.margin.top);return{x:n,y:o,tx:s,ty:r}},_isHandle:function(t){return $(t.target).parent("g.handle").length>0},_findNodeUnderMouse:function(t){var e,i=null;if(t.target){var a,n=$(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0];t.target.className;if("lblbg"==(a=t.target.id.split("_"))[a.length-1])return;n&&((e="object"==typeof n.className?n.className.baseVal:n.className)&&("ej-d-node"===e||"ej-d-group"===e||ej.datavisualization.Diagram.Util.isClassifier(t))?((i=this._findNode(n.id))||(i=this._findNode(n.id.split("_label")[0])),i||(i=this._findNode(n.id.split("_parentdiv")[0])),i&&i._isInternalShape&&i.parent&&this.nameTable[i.parent]&&"bpmn"==this.nameTable[i.parent].type&&(i=this.nameTable[i.parent])):"ej-d-connector"===e&&((i=this._findConnector(n.id))||(i=this._findConnector(n.id.split("_label")[0])))),!i&&t.target&&t.target.parentNode&&(a=t.target.parentNode.id.split("_ej_ports"),i=this.findNode(a[0]))}return i},_findConnectableNodeUnderMouse:function(t){var e,i,a,n,o,s,r,l,d=null;if(t&&"touchmove"===t.type){var h=this._mousePosition(t),g=ej.datavisualization.Diagram.Rectangle(h.x,h.y,0,0),c=ej.datavisualization.Diagram.SpatialUtil.findQuads(this._spatialSearch,g);for(p=0;p<c.length;p++)if((e=c[p]).objects.length>0)for(i=0;i<e.objects.length;i++)if(a=e.objects[i],n=ej.datavisualization.Diagram.Util.bounds(a),ej.datavisualization.Diagram.Geometry.intersectsRect(g,n)&&!a.segments&&a.visible)return a}else{for(var u=$(t.target).parents(".ej-d-node,.ej-d-group"),m=u[0],p=1;m;)m.getAttribute("class"),(d=this._findNode(m.getAttribute("id")))||(d=this._findNode(m.getAttribute("id").split("_parentdiv")[0])),!d||!ej.datavisualization.Diagram.Util.canConnect(d)&&d.parent?(m=u[p],p++):m=null;d&&("umlclassifier"==d.type&&(o=this.activeTool.selectedObject),o&&o.sourceNode&&(s=this.nameTable[o.sourceNode]),o&&o.targetNode&&(r=this.nameTable[o.targetNode]),s&&(d=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(d,s,o,this)),r&&(d=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(d,r,o,this))),!d&&t.target&&t.target.parentNode&&(l=t.target.parentNode.id.split("_ej_ports"),d=this.findNode(l[0]))}return d},_isForeignEvent:function(t,e){if(t.originalEvent&&t.originalEvent.target)if(e){if("input"===t.originalEvent.target.localName&&("text"===t.originalEvent.target.type||"password"===t.originalEvent.target.type)||"textarea"===t.originalEvent.target.localName&&(!this._isEditing||t.originalEvent.target.id!==this.element[0].id+"_editBox"))return!0}else if("img"===t.originalEvent.target.localName)return!0},_isForeignObject:function(t){var e=t;if(e)for(;null!=e.parentNode;){if("foreignObject"===e.tagName||"string"==typeof e.className&&-1!==e.className.split(" ").indexOf("foreignObject"))return e;e=e.parentNode}return null},_altKeyPressed:function(t){return t&ej.datavisualization.Diagram.KeyModifiers.Alt},_ctrlKeyPressed:function(t){return t&ej.datavisualization.Diagram.KeyModifiers.Control},_shiftKeyPressed:function(t){return t&ej.datavisualization.Diagram.KeyModifiers.Shift},_keydown:function(t){var e,i,a,n;this._isKeyDown=!0,this._removeMouseOverTooltip();var o=t.keyCode?t.keyCode:t.which,s=navigator.platform.match("Mac")?t.metaKey:t.ctrlKey,r=t.key;if(!this._isForeignEvent(t,!0)){for(e in this.model.commandManager.commands)(i=this.model.commandManager.commands[e])&&i.gesture&&(i.gesture.keyModifiers||i.gesture.key)&&(!i.gesture.key||o==i.gesture.key||r==i.gesture.key||navigator.platform.match("Mac")&&"Backspace"===r&&"delete"===e)&&(!i.gesture.keyModifiers||(s||t.altKey||t.shiftKey)&&(!this._altKeyPressed(i.gesture.keyModifiers)||t.altKey)&&(!this._shiftKeyPressed(i.gesture.keyModifiers)||t.shiftKey)&&(!this._ctrlKeyPressed(i.gesture.keyModifiers)||s))&&(this._currentCommand=e,"focusToNextItem"!==this._currentCommand&&"focusToPreviousItem"!==this._currentCommand&&"selectFocusedItem"!==this._currentCommand&&(this._diagramElements=null,this._focusedElement=null,ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer)),i.execute&&i.canExecute&&(a=i.canExecute,"string"==typeof i.canExecute&&(a=ej.util.getObject(i.canExecute,window)),$.isFunction(a)&&a({model:this.model})&&(n=i.execute,"string"==typeof i.execute&&(n=ej.util.getObject(i.execute,window)),$.isFunction(n)&&n({keyDownEventArgs:t,parameter:i.parameter,model:this.model}))));this.activeTool.keydown&&this.activeTool.keydown(t)}this._isKeyDown=!1},_keyup:function(t){var e=t.keyCode?t.keyCode:t.which;this._isEditing||37!==e&&38!==e&&39!==e&&40!==e||(this._currentState,delete this._currentState,t.preventDefault(),this.activeTool.inAction=!1,this._updateSelectionHandle())},_registerHistoryEvents:function(){this.historyManager.addEventHandler("collectionchanged",$.proxy(this._recordCollectionChanged,this)),this.historyManager.addEventHandler("positionchanged",$.proxy(this._recordPinPointChanged,this)),this.historyManager.addEventHandler("sizechanged",$.proxy(this._recordResizeChanged,this)),this.historyManager.addEventHandler("rotationchanged",$.proxy(this._recordRotationChanged,this)),this.historyManager.addEventHandler("endpointchanged",$.proxy(this._recordEndPointChanged,this)),this.historyManager.addEventHandler("labelchanged",$.proxy(this._recordLabelChanged,this)),this.historyManager.addEventHandler("groupingchanged",$.proxy(this._recordGroupChanged,this))},_svgdrop:function(t,e){var i,a,n,o,s,r,l,d,h;if(this._selectedSymbol&&ej.datavisualization.Diagram.Util.isPageEditable(this)){i={},(a=t.originalEvent).preventDefault?a.preventDefault():a.returnValue=!1;var g=this._currZoom,c=$("#"+this.element[0].id).offset(),u=this._isTouchEvent(t);u.pageX||t.pageX||(t.originalEvent&&t.originalEvent.changedTouches?u=t.originalEvent.changedTouches[0]:t&&t.changedTouches&&(u=t.changedTouches[0]));var m=(u?u.pageX:t.pageX)+this._hScrollOffset-c.left,p=(u?u.pageY:t.pageY)+this._vScrollOffset-c.top,f=$.extend(!0,{},this._selectedSymbol),_=e.helper[0].getAttribute("paletteId"),v=$("#"+_).ejSymbolPalette("instance");if(_){if(this._selectedSymbol=null,f.name+=ej.datavisualization.Diagram.Util.randomId(),!f.isPhase&&f.segments)f.segments&&ej.datavisualization.Diagram.Util._translateLine(f,m,p),f=this.getNode(f);else if(!f.isPhase){if(n=$.extend(!0,{},v.nameTable),f.offsetX=m/g,f.offsetY=p/g,"group"===f._type){for(o=this._getChildren(f.children),s=0;s<o.length;s++)(r=$.extend(!0,{},n[o[s]])).parent=f.name,r.name=f.name+r.name,o[s]=r.name,this.nameTable[r.name]=r,this.nodes().push(r),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(this.nameTable[r.name]);f.height=f.width=0,this._updateChildBounds(f,this.nameTable)}"group"===f._type?f=this._getNewGroup(f):f.segments?f=this._getNewConnector(f):f.isPhase||"phase"===f.type||(f=this._getNewNode(f))}f&&f.isLane&&(this._cloneGroupNode(f,ej.datavisualization.Diagram.Util.randomId()),f=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(f,this.nameTable),f=this._initLaneContaier(f)),i={element:f,cancel:!1},this._raiseDropEvent(i),f&&f.isLane&&(l=f.children[0],(d=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(f,this,null,null,l))&&d.isSwimlane&&(f=d)),f.isPhase||(i.cancel||this.add(f),f=this.selectionList[0],this.scrollToNode(f),f.labels.length>0&&"edit"===f.labels[0].mode?(this._isEditing=!0,this.startLabelEdit(f,f.labels[0])):this.element[0].focus())}}else h=null,h=this._findNodeUnderMouse(t),i={element:e.helper,e:t,draggable:e.draggable,targetNode:h},this._raiseDropEvent(i)},_isTouchEvent:function(t){return"touchmove"==t.type||"touchstart"==t.type||"touchend"==t.type?t.originalEvent?t.originalEvent.changedTouches[0]:t.changedTouches[0]:t},_raiseDropEvent:function(t){t.source=this._symbolPalette?this._symbolPalette:null,t.objectType=t.source?ej.datavisualization.Diagram.ObjectTypes.Palette:ej.datavisualization.Diagram.ObjectTypes.Diagram,this._raiseEvent("drop",t),this._symbolPalette=null},_recordCollectionChanged:function(t,e){var i,a,n,o,s,r,l,d,h,g,c,u;if(this._isUndo=!0,this._isInsert=!0,i=t.changeType,t.isUndo&&(i="insert"==t.changeType?"remove":"insert"),this._clearSelection("insert"!=i),"insert"==i)if(t.object.container||t.object._isMultipleLaneDelete){for(c in h=[],t.childTable)d=t.childTable[c],this.nameTable[c]=d;if((n=t.object).isSwimlane)this.nameTable[n.name]=n,n.width=0,n.height=0,this._swimlanePaste=!0,this._multipleAction=!0,this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._pasteSwimlaneObj(n),delete this._swimlanePaste,this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._addAssiciatedChildConnectors(n),delete this._multipleAction,this._clearSelection(!0);else if("pseudoGroup"==n._type||n.isLane)if("pseudoGroup"==n._type){for(c=0;c<n.children.length;c++)d=n.children[c],h[c]=t.childTable[d.name],d.isLane&&this.nameTable[d.name]&&delete this.nameTable[d.name];for(g=this._sortByLaneIndex(h),c=0;c<g.length;c++)(d=g[c]).isLane?this._recordCollectionChangedAddLane(d,d._laneIndex):(this.add(d,t),this._clearSelection(!0))}else this._recordCollectionChangedAddLane(t.object,t.index);else this.add(n),this._addConnector(n,t)}else if("pseudoGroup"!=t.object.type){if(!t.object.segments){if(a=null,t.object.inEdges&&t.object.inEdges.length>0)for(c=0;c<t.object.inEdges.length;c++)this.nameTable[t.object.inEdges[c]]&&(this.nameTable[t.object.inEdges[c]].targetNode=t.object.name),t.targetPorts&&(a=t.targetPorts[t.object.inEdges[c]]),a&&this.nameTable[t.object.inEdges[c]]&&(this.nameTable[t.object.inEdges[c]].targetPort=a);if(t.object.outEdges&&t.object.outEdges.length>0)for(c=0;c<t.object.outEdges.length;c++)this.nameTable[t.object.outEdges[c]]&&(this.nameTable[t.object.outEdges[c]].sourceNode=t.object.name),t.sourcePorts&&(a=t.sourcePorts[t.object.outEdges[c]]),a&&this.nameTable[t.object.outEdges[c]]&&(this.nameTable[t.object.outEdges[c]].sourcePort=a)}"group"===t.object._type&&this._addChildren(t.object,t.childTable),t.object.isSwimlane&&(t.object=ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(t.object,this)),this.add(t.object,t),t.object.parent&&this.nameTable[t.object.parent],"group"===t.object._type?(this._addConnector(t.object,t),this._addGroupConnector(t.object,t)):this._addConnector(t.object,t)}else{for(delete this.nameTable.multipleSelection,r=[],l=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"}),c=0;c<t.object.children.length;c++)(d="object"==typeof t.object.children[c]?t.object.children[c]:t.childTable[t.object.children[c]])&&("group"!==(s=this.getObjectType(d))||d.isSwimlane||this._addChildren(d,t.childTable),d.isSwimlane?(this._swimlanePaste=!0,this._isUndo=!0,d=this._pasteSwimlaneObj(d,t),delete this._swimlanePaste):"connector"!=s?this.add(d,t):r.push(d),d&&l.children.push(d.name));for(c=0;c<r.length;c++)this.add(r[c],t);for(this._addGroupConnector(t.object,t),c=0;c<l.children.length;c++)if((n=this.nameTable[this._getChild(l.children[c])])&&!n.segments){if(n.inEdges.length>0)for(o=0;o<n.inEdges.length;o++)this._isUndo?t.childTable[n.inEdges[o]].targetNode=n.name:this.nameTable[n.inEdges[o]].targetNode=n.name;if(n.outEdges.length>0)for(o=0;o<n.outEdges.length;o++)this._isUndo?t.childTable[n.outEdges[o]].sourceNode=n.name:this.nameTable[n.outEdges[o]].sourceNode=n.name}this._clearSelection(),this.nodes().push(l),this._nodes=$.extend(!0,[],this.nodes()),l.offsetX=t.object.offsetX,l.offsetY=t.object.offsetY,l.height=t.object.height,l.width=t.object.width,l.rotateAngle=t.object.rotateAngle,this.nameTable[l.name]=l,this.addSelection(l,!0)}else if("remove"==i){if("pseudoGroup"!=t.object.type&&!t.object.isLane)return this._removeAdjacentConnections(t.object,t),t.object.isSwimlane||t.object.annotation?this._remove(this.nameTable[t.object.name]):this._remove(t.object),!0;if(t.object.isLane)u=t.object,t.index||0==t.index||(null,t.object.isLane&&e&&(e.index=this._getRemoveIndex(t.object,!0))),this._remove(u);else for(c=0;c<t.object.children.length;c++)this._remove(this.nameTable[this._getChild(t.object.children[c])])}this._groupUndo||(this._isUndo=!1),this._isInsert=!1,this.tools.move._isLane=!1},_recordCollectionChangedAddLane:function(t,e){var i,a;t&&t.isLane&&t.parent&&(t&&t.parent&&(a=this.nameTable[t.parent]),a&&a&&(i=this.nameTable[a.parent]),i&&(this.activeTool.selectedObject=t,this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,ej.datavisualization.Diagram.canvasHelper._addNewLane(this,t,i,!0,e),this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._addAssiciatedChildConnectors(t),this._clearSelection(!0)))},_addAssiciatedChildConnectors:function(t){var e,i,a,n=this._getChildren(t.children);if(n&&n.length>0)for(e=0,i=n.length;e<i;e++)(a=this.nameTable[n[e]])&&(this._addConnector(a),"group"===a.type&&this._addAssiciatedChildConnectors(a))},_updateRecordPinPoint:function(t,e,i){var a,n,o,s,r,l,d,h,g,c,u;if("pseudoGroup"==t.type){for(r=t,l=this._getChildren(t.children),n=0;n<l.length;n++)o=this.nameTable[l[n]],(s=e[l[n]])&&(o.segments?(d=e[o.name],o.sourcePoint=d.sourcePoint,o.targetPoint=d.targetPoint,o.segments=jQuery.extend(!0,o.segments,d.segments)):(this._propertyChangeValues(o,s),this._translate(o,s.offsetX-o.offsetX,s.offsetY-o.offsetY,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(o,this));this.selectionList[0]&&this.selectionList[0].name===r.name&&(this.selectionList[0].offsetX=r.offsetX,this.selectionList[0].offsetY=r.offsetY),ej.datavisualization.Diagram.SvgContext.updateSelector(r,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}else t.segments?i?(a=e[t.name],t.sourcePoint=a.sourcePoint,t.targetPoint=a.targetPoint,t.segments=$.extend(!0,[],a.segments),ej.datavisualization.Diagram.DiagramContext.update(t,this)):(this._clearSelection(!0),a=this._findConnector(t.name),t.targetNode&&(h=this.nameTable[t.targetNode],ej.datavisualization.Diagram.Util.removeItem(h.inEdges,t)),t.sourceNode&&(h=this.nameTable[t.sourceNode],ej.datavisualization.Diagram.Util.removeItem(h.outEdges,t)),t.targetNode&&(h=this.nameTable[t.targetNode]).inEdges.push(t.name),t.sourceNode&&(h=this.nameTable[t.sourceNode]).outEdges.push(t.name),this._propertyChangeConnectorValues(a,t),a.targetNode=t.targetNode,a.sourceNode=t.sourceNode,a.targetPort=t.targetPort,a.sourcePort=t.sourcePort,a.sourcePoint=t.sourcePoint,a.targetPoint=t.targetPoint,a.segments=$.extend(!0,[],t.segments),ej.datavisualization.Diagram.DiagramContext.update(a,this),ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints),this.addSelection(t,!0)):i?(a=e[t.name],this._translate(t,a.offsetX-t.offsetX,a.offsetY-t.offsetY,e),ej.datavisualization.Diagram.DiagramContext.update(a,this)):(a=this._findNode(t.name),this._clearSelection(!0),this._propertyChangeValues(a,t),t.parent&&(u=this.nameTable[t.parent]),u||(u=this.nameTable[a.parent],g=!0),u&&u.container?(this._raiseGroupChangeEvent(t,a.parent?this.nameTable[a.parent]:null,this.nameTable[t.parent],ej.datavisualization.Diagram.GroupChangeCause.HistoryChange),ej.datavisualization.Diagram.canvasHelper._undoDragNode(this,this.nameTable[t.name],t),g&&((c=this.nameTable[u.parent.split("laneStack")[0]])&&ej.datavisualization.Diagram.DiagramContext.update(c,this))):(this._translate(a,t.offsetX-a.offsetX,t.offsetY-a.offsetY,this.nameTable),t.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[a.parent],this),a.parent&&((u=this.nameTable[a.parent])&&a.parent&&""==t.parent&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(u.children,a.name),this._delete(a),("group"===t.type||"bpmn"===t.type)&&this._initGroupNode(t,e),this.add(t))),t.parent&&(u=this.nameTable[t.parent],t.parent&&""==a.parent&&(this._delete(a),("group"===(t=$.extend(!0,{},t)).type||"bpmn"===t.type)&&this._initGroupNode(t,e),this.add(t)))),ej.datavisualization.Diagram.DiagramContext.update(a,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,a),this.addSelection(a,!0))},_propertyChangeValues:function(t,e){var i,a=t.offsetX===e.offsetX?"":"offsetX",n=t.offsetY===e.offsetY?"":"offsetY";"offsetX"===a&&(i={element:e,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:a,oldValue:t.offsetX,newValue:e.offsetX},this._raisePropertyChange(i)),"offsetY"===n&&(i={element:e,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:n,oldValue:t.offsetY,newValue:e.offsetY},this._raisePropertyChange(i))},_propertyChangeResizeValues:function(t,e){var i,a=e.width===t.width?"":"width",n=e.height===t.height?"":"height";"width"===a&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:a,oldValue:t.width,newValue:e.width},this._raisePropertyChange(i)),"height"===n&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:n,oldValue:t.height,newValue:e.height},this._raisePropertyChange(i))},_propertyChangeConnectorValues:function(t,e){var i,a=t.sourcePoint.x===e.sourcePoint.x||t.sourcePoint.y===e.sourcePoint.y?"":"sourcePoint",n=t.targetPoint.x===e.targetPoint.x||t.targetPoint.y===e.targetPoint.y?"":"targetPoint";"sourcePoint"===a&&(i={element:e,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:a,oldValue:t.sourcePoint,newValue:e.sourcePoint},this._raisePropertyChange(i)),"targetPoint"===n&&(i={element:e,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:n,oldValue:t.targetPoint,newValue:e.targetPoint},this._raisePropertyChange(i))},_renderNodeOnLane:function(t,e){var i,a,n=this;n._views.forEach(function(o){i=n._views[o],a=i.svg||i._canvas,e=i.svg.getElementById(t.parent),i.type,"group"===t._type?i.context.renderGroup(t,a,e||i.diagramLayer,n.nameTable,n,null,!0):"node"===n.getObjectType(t)&&i.context.renderNode(t,a,e||i.diagramLayer)})},_updateUndoObject:function(t,e){var i,a;e.parent&&(a=this.nameTable[e.parent]),a&&this._collectionContains(e.name,a.children)?(ej.datavisualization.Diagram.Util.removeChildFromGroup(a.children,e.name),t.parent&&(i=this.nameTable[t.parent]),i&&i.children&&!this._collectionContains(e.name,i.children)&&(i.children.push(t.name),this.nameTable[t.name].parent=i.name,i.isLane&&this.tools.move._updateMargin(e,i))):t.parent&&(a=this.nameTable[t.parent])},_collectionContains:function(t,e){for(var i=0;i<e.length;i++)if("string"==typeof e[i]&&e[i]===t||e[i].name===t)return!0},_recordPinPointChanged:function(t){var e=t.object.node,i=t.object.childTable;(e||e.isSwimlane)&&this._updateRecordPinPoint(e,i)},_updateRecordRotation:function(t,e){var i,a,n,o,s,r,l,d;if("pseudoGroup"==t.type){for(this._clearSelection(!0),this.nameTable[t.name]=t,d=this.nameTable[t.name],o=t.children,i=0;i<o.length;i++)a=this.nameTable[this._getChild(o[i])],n=e[o[i]],a&&(a.segments?(s=e[a.name],a.sourcePoint=s.sourcePoint,a.targetPoint=s.targetPoint):n&&(this._translate(a,n.offsetX-a.offsetX,n.offsetY-a.offsetY,this.nameTable),this._comparePropertyValues(a,"rotateAngle",{rotateAngle:n.rotateAngle}),this._rotate(a,n.rotateAngle-a.rotateAngle,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(a,this));d&&(r=t.rotateAngle-d.rotateAngle,d.rotateAngle+=r,this.selectionList[0]&&(this.selectionList[0].rotateAngle=d.rotateAngle)),this.nameTable[t.name]=t,this.addSelection(t,!0)}else l=null,t.parent&&(l=this.nameTable[t.parent]),l&&l.container?(d=this._findNode(t.name),ej.datavisualization.Diagram.canvasHelper._undoRotateNode(this,d,t)):t&&(this._clearSelection(!0),d=this._findNode(t.name),this._comparePropertyValues(d,"rotateAngle",{rotateAngle:t.rotateAngle}),this._rotate(d,t.rotateAngle-d.rotateAngle,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(d,this),this.addSelection(d,!0))},_recordSizeChanged:function(t,e){var i=t.object.node,a=t.object.childTable;this._updateRecordSize(i,a,e)},_updateRecordSize:function(t,e,i){var a,n,o,s,r,l,d,h;if(this._clearSelection(!0),"group"!==t._type&&"pseudoGroup"!==t.type||t.isLane||t.isSwimlane||"bpmn"===t.type)t.isLane||t.isSwimlane?(a=this._findNode(t.name),ej.datavisualization.Diagram.canvasHelper._undoResizeLane(this,t,i)):"bpmn"==t.type&&t.container?(a=this._findNode(t.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,a,t)):(h=null,t.parent&&(h=this.nameTable[t.parent]),h&&h.container?(a=this._findNode(t.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,a,t)):t.segments||(a=this._findNode(t.name),this._propertyChangeResizeValues(a,t),this._translate(a,t.offsetX-a.offsetX,t.offsetY-a.offsetY,this.nameTable),this.scale(a,t.width/a.width,t.height/a.height,ej.datavisualization.Diagram.Point(a.offsetX,a.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(a,this),this.addSelection(a,!0)));else{for("pseudoGroup"==t.type&&(this.nameTable[t.name]=t),a=this._findNode(t.name),s=this._getChildren(a.children),r=this._getChildren(t.children),n=0;s&&n<s.length;n++)l=this.nameTable[r[n]],(o=e[r[n]])&&(l.segments?(d=e[l.name],l.sourcePoint=d.sourcePoint,l.targetPoint=d.targetPoint,l.segments=$.extend(!0,[],d.segments)):(this._propertyChangeResizeValues(l,o),this._translate(l,o.offsetX-l.offsetX,o.offsetY-l.offsetY,this.nameTable),this.scale(l,o.width/l.width,o.height/l.height,ej.datavisualization.Diagram.Point(l.offsetX,l.offsetY),this.nameTable)));h=null,t.parent&&(h=this.nameTable[t.parent]),h&&h.container?(a=this._findNode(t.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,a,t)):(a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.width=t.width,a.height=t.height,"resize"==this.activeTool.name&&this.activeTool.inAction&&"pseudoGroup"!=this.selectionList[0].type&&"group"!=this.selectionList[0].type||this._updateAssociatedConnectorEnds(a,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(a,this),this.addSelection(a,!0))}},_recordRotationChanged:function(t){var e=t.object.node,i=t.object.childTable;this._updateRecordRotation(e,i)},_recordEndPointChanged:function(t){var e,i,a,n,o,s;this.clearSelection(!0),t._isUndo?(e=i=t.undoObject,a=t.redoObject):(e=i=t.redoObject,a=t.undoObject),e=e.parent?this._findChildren(this.nameTable[e.parent],e.name):this._findConnector(e.name),a.targetNode&&(n=this.nameTable[a.targetNode],ej.datavisualization.Diagram.Util.removeItem(n.inEdges,a.name)),a.sourceNode&&(n=this.nameTable[a.sourceNode],ej.datavisualization.Diagram.Util.removeItem(n.outEdges,a.name)),i.targetNode&&(n=this.nameTable[i.targetNode]).inEdges.push(i.name),i.sourceNode&&(n=this.nameTable[i.sourceNode]).outEdges.push(i.name),this._propertyChangeConnectorValues(e,i),this._comparePropertyValues(e,"targetNode",{targetNode:i.targetNode}),e.targetNode=i.targetNode,this._comparePropertyValues(e,"sourceNode",{sourceNode:i.sourceNode}),e.sourceNode=i.sourceNode,this._comparePropertyValues(e,"targetPort",{targetPort:i.targetPort}),("targetpoint"==t.removePortType||"sourcepoint"==t.removePortType)&&(o=null,o="targetpoint"==t.removePortType?this._findNode(t.undoObject.targetNode):this._findNode(t.undoObject.sourceNode),this._findPort(o,t.removedPort.name),o._ports&&(this._UndoRedo?o._ports.push(t.removedPort):(s=o._ports.indexOf(t.removedPort),o._ports.splice(s,1)))),e.targetPort=i.targetPort,this._comparePropertyValues(e,"sourcePort",{sourcePort:i.sourcePort}),e.sourcePort=i.sourcePort,this._comparePropertyValues(e,"sourcePoint",{sourcePoint:i.sourcePoint}),e.sourcePoint=i.sourcePoint,this._comparePropertyValues(e,"targetPoint",{targetPoint:i.targetPoint}),e.targetPoint=i.targetPoint,e.segments=$.extend(!0,[],i.segments),this._updateEdges(e),this._dock(e,this.nameTable),ej.datavisualization.Diagram.Util._updateConnectorSegments(e,e.sourcePort,e.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(e,this),ej.datavisualization.Diagram.Util.updateBridging(e,this),ej.datavisualization.Diagram.DiagramContext.update(e,this),this._updateConnectorBridging(e),this._addSelection(e,!!this._selectionContains(e)),this.selectionList[0]&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom),ej.datavisualization.Diagram.SvgContext.updateSelector(e,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},_recordLabelPositionChanged:function(t){var e,i,a=t.activeLabel;a&&(e=t.redoObject?t.redoObject.node:null,t.undo&&(e=t.undoObject?t.undoObject.node:null),e&&(i=this._findLabel(e,a.name),this.updateLabel(e.name,a,{margin:i.margin,offset:i.offset,segmentOffset:i.segmentOffset,width:i.width,height:i.height,rotateAngle:i.rotateAngle})))},_recordPortPositionChanged:function(t){var e,i,a=t.activePort;a&&(e=t.redoObject?t.redoObject.node:null,t.undo&&(e=t.undoObject?t.undoObject.node:null),e&&(i=this._findPort(e,a.name),this.updatePort(e.name,a,{offset:i.offset})))},_recordLabelChanged:function(t){var e=this.nameTable[t.object.name];this._comparePropertyValues(e.labels[t.index?t.index:0],"text",{text:t.label}),"text"===t.object.type?(e.textBlock.text=t.label,ej.datavisualization.Diagram.DiagramContext.updateTextBlock(e,e.textBlock,this)):"umlclassifier"==e.type?(this._clearSelection(!0),t.label=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(t.label,e,this),(e=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(e,this)).labels[t.index].text="",ej.datavisualization.Diagram.DiagramContext.update(e,this),this.addSelection(e,!0)):e.shape&&"umlclassifier"==e.shape.type?(e=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(e,t.label,e.labels[t.index]),ej.datavisualization.Diagram.DiagramContext.update(e,this)):e.labels[t.index]?(e.labels[t.index].text=t.label,ej.datavisualization.Diagram.DiagramContext.updateLabel(e,e.labels[t.index],this)):(e.labels[t.index]=ej.datavisualization.Diagram.Label({text:t.label,_parent:e.name}),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(e,e.labels[t.index],null,this))},labelcollectionchanged:function(t){var e,i,a,n,o=this.nameTable[t.shape.name],s=o.labels;if(s.slice(0),t.isLabelRemove){if(t.labels&&t.labels.length>0)for(e=t.labels.slice(),n=0;n<e.length;n++)i=e[n].index,a=e[n].label,i!=undefined&&a&&(t.isUndo?this.insertLabel(o.name,a,i):this.removeLabels(o.name,[a]))}else t.isUndo?this.removeLabels(o.name,[t.label]):this.addLabel(o.name,t.label),this._raisePropertyChange({element:o,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:s,newValue:o.labels})},_recordGroupChanged:function(t){var e,i,a,n,o,s,r,l,d,h=t.actionType;if(t.isUndo&&("group"===t.actionType&&(h="ungroup"),"ungroup"===t.actionType&&(h="group")),this._clearSelection("group"==h),e=this._getChildren(t.object.children),"group"===h){for((i=new ej.datavisualization.Diagram.Group(t.object)).children=[],a=0;a<e.length;a++)d=this.nameTable[e[a]],i.children.push(d),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),d),d.parent&&(o=this.nameTable[d.parent]),d.parent=i.name,(r=this._svg.document.getElementById(e[a]))&&r.parentNode.removeChild(r),d.parent&&(s=this.nameTable[d.parent]),this._raiseGroupChangeEvent(d,o,s,"group");this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this.add(i),this._addSelection(i)}else{for(n=t.object,(r=this._svg.document.getElementById(n.name))&&r.parentNode.removeChild(r),l=this._getChildren(n.children),a=0;a<l.length;a++)(d=this.nameTable[l[a]]).parent&&(o=this.nameTable[d.parent]),d.parent="",this._isUndo=!0,d.segments||("group"==d._type?ej.datavisualization.Diagram.DiagramContext.renderGroup(d,this):ej.datavisualization.Diagram.DiagramContext.renderNode(d,this),-1===this.nodes().indexOf(d)&&(this.nodes().push(d),this._nodes=$.extend(!0,[],this.nodes()))),d.segments&&(ej.datavisualization.Diagram.DiagramContext.renderConnector(d,this),-1===this.connectors().indexOf(d)&&(this.connectors().push(d),this._connectors=$.extend(!0,[],this.connectors()))),this._isUndo=!1,this._nodes=$.extend(!0,[],this.nodes()),d.parent&&(s=this.nameTable[d.parent]),this._raiseGroupChangeEvent(d,o,s,"ungroup");this._removeElement(n),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(n.name)),this._nodes=$.extend(!0,[],this.nodes())}},_recordNudgingChanges:function(t,e,i){var a,n;this._isUndo=!0,a=e.undoDirection,i&&(a=e.redoDirection),this._clearSelection(!0),"pseudoGroup"===t.type&&(n=ej.datavisualization.Diagram.Group(t),delete this.nameTable[n.name],this.nameTable[n.name]=t),this._addSelection("label"==t._type?t:this.nameTable[t.name],!0),this.nudge(a,e.values),this._isUndo=!1},_recordPropertiesChanged:function(t,e,i,a){var n,o=this._getModifiedProperties("port"==i||"label"==i?a:t,e);o&&Object.keys(o).length&&("connector"==i&&((e.sourcePoint||e.sourceNode)&&(o.sourcePoint=t.sourcePoint,o.sourceNode=t.sourceNode,o.sourcePort=t.sourcePort),(e.targetPoint||e.targetNode)&&(o.targetNode=t.targetNode,o.targetPort=t.targetPort,o.targetPoint=t.targetPoint)),(n={type:"propertiesChanged",values:o,category:"internal",object:t,elementType:i,updateValues:e})[i]=a,this.addHistoryEntry(n))},_recordAlignCommandChanges:function(t){var e,i,a,n,o;if(t&&t.values.length){for(this._associatedConnectorsUpdate=!0,e=0;e<t.values.length;e++)(i=t.values[e]).object&&i.delta&&(a={x:-i.delta.x,y:-i.delta.y},n=this.nameTable[this._getChild(i.object)],this._comparePropertyOnAlign(n,-i.delta.x,-i.delta.y),this._translate(n,-i.delta.x,-i.delta.y,this.nameTable),this._updateContainerOnNudge(n),i.delta=a,this._updateObject(n));for(delete this._associatedConnectorsUpdate,e=0;e<t.values.length;e++)(o=this.nameTable[this._getChild(t.values[e].object)]).segments||this._updateAssociateConnector(o);this.nameTable[t.object.name]||(this.nameTable[t.object.name]=t.object),ej.datavisualization.Diagram.Util._updateGroupBounds(t.object,this),this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(t.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(t.object,!0)}},_recordPhaseCollectionChanged:function(t){t.undo?t.isAdded?t.phase&&this._removePhase(t.phase.name):t.phase&&this._addPhase(t.group,t.phase,t):t.isAdded?t.phase&&this._addPhase(t.group,t.phase,t):t.phase&&this._removePhase(t.phase.name),this._clearSelection(!0)},_recordSizeCommandChanges:function(t){var e,i,a,n;if(t&&t.values.length){for(e=0;e<t.values.length;e++)(i=t.values[e]).object&&i.values&&(a={width:i.object.width||i.object._width||0,height:i.object.height||i.object._height||0},n=this.nameTable[this._getChild(i.object)],this._comparePropertyValues(n,"height",{height:i.values.height}),this._comparePropertyValues(n,"width",{width:i.values.width}),this.scale(n,i.values.width/(n.width||n._width||0),i.values.height/(n.height||n.height||0),{x:n.offsetX,y:n.offsetY},this.nameTable),i.values=a,this._updateObject(n));this.nameTable[t.object.name]||"pseudoGroup"!=t.object.type||(this.nameTable[t.object.name]=t.object),ej.datavisualization.Diagram.Util._updateGroupBounds(t.object,this),this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(t.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(t.object,!0)}},_getModifiedProperties:function(t,e,i){var a,n;if(i=i||t,e&&Object.keys(e).length&&i){for(n in a={},e)(e[n]!=i[n]||"object"==typeof i[n])&&(a[n]=i[n]&&i[n]instanceof Array?i[n]:i[n]&&"object"==typeof i[n]?$.extend(!0,{},i[n]):i[n]);return a}},_addCollectionChangeToHistory:function(t){var e,i;""==t.parent&&(e={},this.selectionList&&this.selectionList.length>0&&(e=this._getChildTable(this.selectionList[0],e)),i={type:"collectionchanged",object:jQuery.extend(!0,{},t),childTable:jQuery.extend(!0,{},e),changeType:"insert",category:"internal"},this.addHistoryEntry(i))},_recordPhasesizeChanged:function(t){var e=$.extend(!0,{},t.undoObject),i=$.extend(!0,{},t.redoObject);t.undo?this._updatePhase({name:e.name,offset:e.offset}):this._updatePhase({name:i.name,offset:i.offset})},_recordPortsCollectionChanged:function(t){var e,i,a,n,o,s,r,l=t.changeType;if(t.isUndo&&(l="insert"==t.changeType?"remove":"insert"),e=this.nameTable[t.object.name],"remove"==l)for(o=0;o<t.collection.length;o++)for(this._updatePortConnection(e,e.inEdges,t.collection[o]),this._updatePortConnection(e,e.outEdges,t.collection[o]),ej.datavisualization.Diagram.Util.removeItem(e.ports,t.collection[o]),i=0;i<this._views.length;i++)a=this._views[i],(n=this._views[a].svg.document.getElementById(e.name+"_"+t.collection[o].name))&&n.parentNode.removeChild(n);else for(o=0;o<t.collection.length;o++)e.ports.push(t.collection[o]),ej.datavisualization.Diagram.DiagramContext.renderPort(e,t.collection[o],this),t.collection[o]._removeLine&&((s=t.collection[o]._removeLine)&&((r=this.nameTable[s])&&(t.collection[o]._removeFromSourcePort||t.collection[o]._removeFromTargetPort)&&(t.collection[o]._removeFromSourcePort&&(r.sourcePort=t.collection[o].name),t.collection[o]._removeFromTargetPort&&(r.targetPort=t.collection[o].name),this._dock(r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this))))},_initLaneContaier:function(t){return t.isLane&&(t=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t)),t},_addSymbolToDiagram:function(t){var e,i,a,n,o;if(ej.datavisualization.Diagram.Util.isPageEditable(this)){var s=this._currZoom,r=$("#"+this.element[0].id).offset(),l=this._isTouchEvent(t);l.pageX||t.pageX||(t.originalEvent&&t.originalEvent.changedTouches?l=t.originalEvent.changedTouches[0]:t&&t.changedTouches&&(l=t.changedTouches[0]));var d,h=(l?l.pageX:t.pageX)+this._hScrollOffset-r.left,g=(l?l.pageY:t.pageY)+this._vScrollOffset-r.top,c=$.extend(!0,{},this._selectedSymbol);if(this._selectedSymbol&&(d=c,this._isNodeEnters?d.isSwimlane&&(this.nameTable[d.name]=d,d=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,d,{childTable:this.childTable,object:d}),this._addAssiciatedChildConnectors(d)):(d&&"pseudoGroup"!=d.type&&(c.name+=ej.datavisualization.Diagram.Util.randomId()),c.segments?ej.datavisualization.Diagram.Util._translateLine(c,h/s,g/s):(this._cloneGroupNode(c,ej.datavisualization.Diagram.Util.randomId()),"group"===c._type?"bpmn"==c.type&&(0!==c.offsetX||0!==c.offsetY)?(c.offsetX=h/s,c.offsetY=g/s):(e=ej.datavisualization.Diagram.Util._getChildrenBounds(c,this),ej.datavisualization.Diagram.Util._translate(c,h/s-e.x-e.height/2,g/s-e.y-e.width/2,this.nameTable,null,this)):(c.offsetX=h/s,c.offsetY=g/s),c.isLane&&((i=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(c,this.nameTable)).isLane=c.isLane,i.orientation=c.orientation,d=i),"bpmn"==c.type&&delete d.children)),d&&(a={element:d,target:this,targetType:"diagram"},this._raiseEvent("dragEnter",a),!a.cancel))){if(this._isEditing&&(this._endEditing=!0,this._endEdit(),delete this._endEditing),d&&!this._isNodeEnters&&(d=this._initLaneContaier(d)),"pseudoGroup"!=d.type)d.isLane&&(this.nameTable[this._getChild(d.children[0])]._isHeader=!0),this.add(d);else{for(n=0;n<d.children.length;n++)this.add(d.children[n]),d.children[n]=d.children[n].name;for(o in this.edgeTable)this.nameTable[o]||this.add(this.edgeTable[o]);this._hasSelection()&&this._clearSelection(!0),this.nodes().push(d),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[d.name]=d,ej.datavisualization.Diagram.Util._updateGroupBounds(d,this),this.addSelection(d,!0)}this._focusedElement=d,d.isLane&&ej.datavisualization.Diagram.SvgContext._hideNode(d,this._svg),this.element[0].focus(),this._toolToActivate="move",document.getElementsByClassName("e-paletteItem dragClone")[0]&&$(".e-paletteItem.dragClone").css("display","none"),this.activateTool("move",!1),this._symbolDrop=!0,this.activeTool.mousedown(t),this.activeTool.mousemove(t)}}delete this._symbolDrop},_removeSymbolFromDiagram:function(){if(this._selectedSymbol){var t=document.getElementsByClassName("e-paletteItem dragClone")[0];null!=t&&(t.style.display="block"),this._remove(this.selectionList[0]),this._selectedSymbol=null}},_updateGroupChild:function(t){t.children;for(var e=0;e<t.children.length;e++)t.children[e]=this.nameTable[this._getChild(t.children[e])],t.children[e]&&"group"===t.children[e]._type&&this._updateGroupChild(t.children[e])},_dropSymbol:function(t,e){var i,a,n,o,s,r;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(i=t||this.selectionList[0]||this.activeTool.selectedObject,a={element:this.getNode(i)},this._nodeUnderMouse&&(a.target=this._nodeUnderMouse),n=!1,a.target||(a.target=this.model),i&&"group"===i._type&&this._updateGroupChild(i),this._remove(i),this.nameTable[a.element.name]=a.element,this._selectedSymbol=null,o=t||a.element,s=this.activeTool._getMouseOverElement(e),this.activeTool._outOfBoundsDrag(o)&&ej.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this,this.activeTool.selectedObject,s)?(this._raiseDropEvent(a),a.cancel||(this._isInsert=!0,this._containerOverNode=null,s&&s.container&&ej.datavisualization.Diagram.Util.canAllowDrop(s)&&!s.isSwimlane&&ej.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.activeTool.selectedObject,s)&&"connector"!==this.getObjectType(o)&&(o.parent=s.name,this._containerOverNode=s),this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Drop,n=this.add(o),delete this._containerOverNode,this.activeTool.selectedObject=this.selectionList[0],this._isInsert=!1),n?(r=this.nameTable[a.element.name],this._updateDroppedSymbol(r)):this.activeTool.selectedObject=null):(this.activeTool.selectedObject=null,delete this.nameTable[a.element.name],this._clearSelection(!0)),ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||(this._clearSelection(!0),this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan&&this.activateTool("panTool")))},_updateDroppedSymbol:function(t){t&&this.selectionList.length>0&&(this.scrollToNode(t),t.labels.length>0&&"edit"===t.labels[0].mode&&!t.labels[0].readOnly?t.isPhase||t.isSwimlane||t.isLane||"umlclassifier"!==t.type&&(this._isEditing=!0,this.startLabelEdit(t,t.labels[0])):this.element[0].focus(),this._nodeUnderMouse&&this._nodeUnderMouse.segments&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg))},_initiateAutoScroll:function(t){if(this.activeTool.inAction&&this.enableAutoScroll()&&!(this.activeTool instanceof ej.datavisualization.Diagram.RotateTool)){var e=this._viewPort,i=this._mousePosition(t,!0),a=this.model.pageSettings.autoScrollBorder,n=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);i.x+a.right-n.left>=e.width-18?(this._beginAutoScroll("right",t),this._canAutoScroll=!0):i.x<=a.left+n.left?(this._beginAutoScroll("left",t),this._canAutoScroll=!0):i.y+a.bottom+n.top>=e.height-18?(this._beginAutoScroll("bottom",t),this._canAutoScroll=!0):i.y<=a.top+n.top?(this._beginAutoScroll("top",t),this._canAutoScroll=!0):this._canAutoScroll=!1}},_updatePoints:function(t,e,i,a){var n=new ej.datavisualization.Diagram.Point(i.x-e.x,i.y-e.y);ej.datavisualization.Diagram.Geometry.isEmptyPoint(n)||t._updateEndPoint(n.x,n.y,a)},_cloneGroupNode:function(t,e,i){var a,n,o=null,s=t.children=this._getChildren(t.children);if("group"===t._type)for(n=0;n<s.length;n++)i?o=i[s[n]]:this._paletteTable&&(o=this._paletteTable[s[n]]),o&&("group"===(o=$.extend(!0,{},o))._type&&this._cloneGroupNode(o,e),(a=$.extend(!0,{},o)).name+=e,a.parent=t.name,s[n]=a.name,this.nameTable[a.name]=a)},_addGroupConnector:function(t,e){var i,a,n,o,s,r,l;if(!t.segments)for(r=this._getChildren(t.children),n=0;n<r.length;n++)if(l=this.nameTable[r[n]]){if(l.inEdges&&l.inEdges.length>0)for(o=0,s=(i=l.inEdges).length;o<s;o++)(a=e.edgeTable?e.edgeTable[i[o]]:e.childTable[i[o]])&&!this.nameTable[a.name]&&this.add(a);if(l.outEdges&&l.outEdges.length>0)for(o=0,s=(i=l.outEdges).length;o<s;o++)(a=e.edgeTable?e.edgeTable[i[o]]:e.childTable[i[o]])&&!this.nameTable[a.name]&&this.add(a)}},_addConnector:function(t,e){var i,a,n,o;if(!t.segments){if(t.inEdges&&t.inEdges.length>0)for(n=0,o=(i=t.inEdges).length;n<o;n++)(a=e?e.edgeTable[i[n]]:this.nameTable[i[n]]).zOrder=-1,this.add(a);if(t.outEdges&&t.outEdges.length>0)for(n=0,o=(i=t.outEdges).length;n<o;n++)(a=e?e.edgeTable[i[n]]:this.nameTable[i[n]]).zOrder=-1,this.add(a)}},_addChildren:function(t,e){for(var i,a=this._getChildren(t.children),n=0;n<a.length;n++)"group"===(i=e[a[n]])._type&&this._addChildren(i,e),this.nameTable[a[n]]=i,t.children[n]=i},_updateLabels:function(t,e){t.labels=e;for(var i=0;i<t.labels.length;i++)ej.datavisualization.Diagram.DiagramContext.updateLabel(t,t.labels[i],this)},_getNode:function(t,e){var i;return(i=e?"object"==typeof t?e[t.name]:e[t]:"object"==typeof t?this.nameTable[t.name]:this.nameTable[t])||"object"!=typeof t?i&&"string"==typeof t&&(i=e?e[t]:this.nameTable[t]):i=t,i?i.isLane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"lane"):i.isPhase||"phase"===i.type?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"phase"):i.isSwimlane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"swimlane",e):("node"===i._type||"group"===i._type||"pseudoGroup"===i._type||this.getObjectType(i),i):null},_updateEdges:function(t){var e;ej.datavisualization.Diagram.Util.isTargetConnected(t)&&((e=this.nameTable[t.targetNode])&&-1==e.inEdges.indexOf(t.name)&&e.inEdges.push(t.name)),ej.datavisualization.Diagram.Util.isSourceConnected(t)&&((e=this.nameTable[t.sourceNode])&&-1==e.outEdges.indexOf(t.name)&&e.outEdges.push(t.name))},_updateChildrenEdges:function(t){for(var e,i=this._getChildren(t.children),a=0;a<i.length;a++)(e=i[a]).segments?(this._updateEdges(e),this._dock(e,this.nameTable)):"group"===e._type&&this._updateChildrenEdges(e)},_updateParent:function(t){for(var e,i,a=this._getChildren(t.children),n=0;n<a.length;n++)e=this.nodes().indexOf(this.nameTable[a[n]]),(i="bpmn"!=(i=this.nameTable[a[n]]).type&&"connector"!=i.type?this._getNewNode(i):i)&&"group"===i._type?this._updateParent(i):i&&(i.parent=t.name,ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],this.nameTable[i.name]),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,this.nameTable[i.name]),this.nameTable[i.name]=i,-1!=e&&(this.nodes()[e]=i)),this._updateQuad(this.nameTable[i.name])},_findPortAtPoint:function(t,e){var i,a,n,o,s,r,l,d,h,g,c;if(e)for(d=ej.datavisualization.Diagram.Util.bounds(e,!0),g=0,c=(i=e.ports).length;g<c;++g)if(a=i[g],o=ej.datavisualization.Diagram.Size(a.size,a.size),s=ej.datavisualization.Diagram.Util._getPortPosition(a,d),h=ej.Matrix.identity(),ej.Matrix.rotate(h,e.rotateAngle,e.offsetX,e.offsetY),r=(s=ej.Matrix.transform(h,s)).x-a.size/2,l=s.y-a.size/2,n=ej.datavisualization.Diagram.Rectangle(r,l,o.width,o.height),ej.datavisualization.Diagram.Geometry.containsPoint(n,t)||this.portHighlight&&(n=ej.datavisualization.Diagram.Rectangle(r-1,l-1,o.width+1,o.height+1),ej.datavisualization.Diagram.Geometry.containsPoint(n,t)))return ej.datavisualization.Diagram.Util.canConnect(a,!0)?a:null;return null},_findLabelAtPoint:function(t,e){var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f=null,_=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],v=[];if(e&&this.model.labelRenderingMode!==ej.datavisualization.Diagram.LabelRenderingMode.Svg&&(g=ej.datavisualization.Diagram.Util.bounds(e,!0),(i=e.labels)&&i.length>0))for(f=i[0],m=0,p=i.length;m<p;m++)if(f=i[m],l=(c=$(_).find("#"+e.name+"_"+f.name)[0])?c.offsetWidth:0,d=c?c.offsetHeight:0,l||(l=g.width),d||(d=f.fontSize),n=ej.datavisualization.Diagram.Size(l,d),(o=ej.datavisualization.Diagram.Util._getLabelPosition(f,g)).x=g.x+o.x,o.y=g.y+o.y,u=ej.Matrix.identity(),e.segments?ej.Matrix.rotate(u,0,g.x+g.width/2,g.y+g.height/2):ej.Matrix.rotate(u,-e.rotateAngle,e.offsetX,e.offsetY),h=ej.Matrix.transform(u,t),u=ej.Matrix.identity(),ej.Matrix.rotate(u,-f.rotateAngle,o.x,o.y),h=ej.Matrix.transform(u,h),f.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Top?o.y+=n.height/2:f.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Bottom&&(o.y-=n.height/2),f.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Left?o.x+=n.width/2:f.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Right&&(o.x-=n.width/2),s=o.x-n.width/2,r=o.y-n.height/2,a=ej.datavisualization.Diagram.Rectangle(s,r,n.width,n.height),ej.datavisualization.Diagram.Geometry.containsPoint(a,h)&&v.push(f),m==i.length-1)return v.length?v[v.length-1]:null;return f},_getCurrentZoom:function(){return this._currZoom},_findNode:function(t){return this.nameTable[t]},_findPort:function(t,e){for(var i=t.ports,a=0,n=i.length;a<n;a++)if(i[a].name===e)return i[a];return null},_findLabel:function(t,e){for(var i=t.labels,a=0,n=i.length;a<n;a++)if(i[a].name===e)return i[a];return null},_findLabelRotateAngle:function(t){var e=this.findNode(t._parent),i=0;return e&&((i=e.segments?t.rotateAngle:t.rotateAngle+e.rotateAngle)>360&&(i%=360)),i},_findConnector:function(t){return this.nameTable[t]},_findChildren:function(t,e){for(var i,a,n=this._getChildren(t.children),o=0;o<n.length;o++)if(i=this.nameTable[n[o]]){if(e==i.name)return i;if("group"===i._type&&(a=this._findChildren(i,e)))return a}return null},_removeLaneParent:function(t){var e,i,a,n,o,s,r,l,d=[],h=[],g=[],c=0,u=!1,m=[];if(t.isLane&&t.parent){if((a=this.nameTable[t.parent]).children&&1===a.children.length&&a&&a.parent&&(l=this.nameTable[a.parent]))return{remove:!0,node:l}}else if("pseudoGroup"==t._type){for(e=0;e<t.children.length;e++)h[e]=this.nameTable[t.children[e]],h[e]&&h[e].isLane&&h[e].parent?(d[e]=h[e].parent,u=!0):m.push(h[e]);if(this.isSameParent(d)&&d.length==t.children.length){if((i=this.nameTable[d[0]]).children.length==d.length&&((l=this.nameTable[i.parent])&&l.isSwimlane))return{remove:!0,node:l}}else if(u){for(r=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),g=d.filter(function(t,e,i){return i.indexOf(t)==e}),e=0;e<g.length;e++){for(c=0,n=0;n<d.length;n++)g[e]==d[n]&&c++;if(s=this.nameTable[g[e]],c&&s&&s.children&&s.children.length==c)(l=this.nameTable[s.parent])&&l.isSwimlane&&r.children.push(l);else if(c)for(o=0;o<t.children.length;o++)(h=this.nameTable[t.children[o]]).parent==g[e]&&r.children.push(h)}if(m.length>0)for(o=0;o<m.length;o++)r.children.push(m[o]);if(r&&r.children.length>1)return ej.datavisualization.Diagram.Util._updateGroupBounds(r,this),{remove:!0,node:r}}}return{remove:!1}},_delete:function(t){var e,i,a,n,o,s,r,l,d,h,g,c=!1,u=!1;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(t=t||this.selectionList[0])){if(!t.isPhase&&(t.type&&"phase"!=t.type||t.segments||"node"==t._type||"pseudoGroup"==t._type)||this._dropPhase){if((r=this._removeLaneParent(t)).remove&&(t=r.node),"pseudoGroup"==(o=t).type)for(s=0;s<o.children.length;s++)i="object"==typeof o.children[s]?o.children[s].name:o.children[s],(e=this.findNode(i))&&e.parent&&e.isLane&&(e._laneIndex=this._getRemoveIndex(e),u=!0);if("pseudoGroup"==o.type&&u){for(a=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),n=this._getChildren(o.children),this._multipleAction=!0,s=n.length-1;s>=0;s--)(e=this.nameTable[n[s]]).isLane&&e.parent?l=(r=this._removeLaneParent(e)).remove?r.node:e:l=e,l&&a.children.push(l);for(u&&(a._isMultipleLaneDelete=!0),a&&a.children.length>0&&(ej.datavisualization.Diagram.Util._updateGroupBounds(a,this),this._selectedSymbol||this._removeAdjacentConnections(a)),s=(n=a.children).length-1;s>=0;s--)e="object"==typeof n[s]?n[s]:this.nameTable[n[s]],this._isUndo=!1,c=this._remove(e),this._isUndo=!0;delete this._multipleAction,this._isUndo=!1}else if("pseudoGroup"==o._type){for(s=0;s<t.children.length;s++)t.children[s]="object"==typeof t.children[s]?t.children[s].name:t.children[s];for(this._selectedSymbol||this._removeAdjacentConnections(t),n=this._getChildren(o.children),this._multipleAction=!0,s=n.length-1;s>=0;s--)this._remove(this.nameTable[n[s]])&&(c=!0),this._isUndo=!0;delete this._multipleAction,this._isUndo=!1}else this._selectedSymbol||this._removeAdjacentConnections(t),this._nodeUnderMouse===o&&(this._nodeUnderMouse=null),c=this._remove(o),o.container&&o.parent&&((d=this.nameTable[o.parent])&&d.container&&"stack"==d.container.type&&(this._getChild(d.children[0])?((h=this._getSwimlane(o))&&this._updateChildAdjacentConnectors(h,!0),ej.datavisualization.Diagram.DiagramContext.update(d,this)):(g=this.nameTable[d.parent])&&this._remove(g)));c&&this._clearSelection()}else t.type&&"phase"==t.type&&(this._removePhase(t.name),this._clearSelection());this._removeNodeFromGraph(t)}},_canUpdateOnGraph:function(t){return!t.parent},_addNodeToGraph:function(t){"pseudoGroup"!==t.type&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(t)&&this._canUpdateOnGraph(t)&&this._setBounds(t)},_updateNodeFromGraph:function(t){"pseudoGroup"!==t.type&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(t)&&this._canUpdateOnGraph(t)&&this._setBounds(t)},_routeEdge:function(t){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(t)&&(this.activeTool.inAction||this.lineRouting.routeEdge(t,this))},_updateAllEdges:function(t){ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(t)&&this.lineRouting&&(this.lineRouting.updateAllQuadObjects(this._spatialSearch.parentQuad),this.lineRouting.RerouteConnectors(this,t))},_removeNodeFromGraph:function(t){"pseudoGroup"!==t.type&&ej.datavisualization.Diagram.Util.canRouteDiagram(this)&&!this._checkFromSwimlane(t)&&this._canUpdateOnGraph(t)&&this.lineRouting.RemoveNode(t)},_removeAdjacentConnections:function(t,e){var i,a,n,o,s,r,l={},d={};if(l=this._getChildTable(t,l),d=this._getEdgeTable(t,d),!this._isUndo||e){if(i={},a={},!t.segments){if(t.outEdges&&t.outEdges.length>0)for(o=t.outEdges.length,s=0;s<o;s++)(n=this.nameTable[t.outEdges[s]])&&n.sourcePort&&(i[n.name]=n.sourcePort);if(t.inEdges&&t.inEdges.length>0)for(o=t.inEdges.length,s=0;s<o;s++)(n=this.nameTable[t.inEdges[s]])&&n.targetPort&&(a[n.name]=n.targetPort)}this._isUndo?(e.targetPorts=a,e.sourcePorts=i,e.edgeTable=d,e.childTable=l):(r=null,t.isLane&&(r=this._getRemoveIndex(t)),e={type:"collectionchanged",object:this._updatePsedoGroupChildren(t),index:r,childTable:jQuery.extend(!0,{},l),edgeTable:jQuery.extend(!0,{},d),sourcePorts:i,targetPorts:a,changeType:"remove",category:"internal"},t.isPhase||ej.datavisualization.Diagram.Util.canDelete(t)&&this.addHistoryEntry(e))}},_updatePsedoGroupChildren:function(t){var e,i,a=jQuery.extend(!0,{},t);if(t&&"pseudoGroup"==t.type)for(i=0;i<a.children.length;i++)(e=this.nameTable[this._getChild(a.children[i])])&&(e.isSwimlane||e.isLane&&t._isMultipleLaneDelete)&&(a.children[i]=this.getNode(e));return a},_getRemoveIndex:function(t){var e,i;if(t.parent&&((e=this.nameTable[t.parent])&&e.children&&e.children.length>0))for(i=0;i<e.children.length;i++)if(this._getChild(e.children[i])===this._getChild(t))return Number(i);return 0},_getSwimlaneHeader:function(t){var e;return t&&t.isSwimlane&&t.children&&t.children.length>0&&(e=this.nameTable[this._getChild(t.children[0])]),e},_addPhase:function(t,e,i){var a,n,o,s,r,l=this.nameTable[t],d=!1;if(l&&l.isSwimlane&&e&&(l&&l.orientation&&e.offset&&("horizontal"==l.orientation?(a=l.offsetX-l.width/2,(o=this._getFirstLane(l))&&(a+=o.width),d=e.offset>l.width||l.offsetX-l.width/2+e.offset<a):"vertical"==l.orientation&&(a=l.offsetY-l.height/2,(n=this._getSwimlaneHeader(l))&&(a+=n.height),(o=this._getFirstLane(l))&&(a+=o.height),d=e.offset>l.height||l.offsetY-l.height/2+e.offset<a)),e.offset&&!d)){if(i&&i.islastPhase&&(i.phase,"horizontal"===l.orientation?l.width>e.offset&&(e.width+=l.width-e.offset,e.offset=l.width):l.height-n.height>e.offset&&(e.height+=l.height-n.height-e.offset,e.offset=l.height-n.height)),(s=ej.datavisualization.Diagram.Phase(e)).orientation=l.orientation,s.label=ej.datavisualization.Diagram.Label(e.label?e.label:{text:"Phase"}),s.parent=l.name,this.nameTable[s.name]&&(ej.datavisualization.Diagram.Util.removeItem(this.model.phases,this.nameTable[s.name]),delete this.nameTable[s.name]),i&&i.islastPhase){var h=this._getInsertIndex(s)+1,g=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,l),c=$.extend(!0,{},i.phaseObject.prevPhase);this._updateInsertPhase(s,c.name,l,h,i),ej.datavisualization.Diagram.SvgContext.renderphase(s,this._svg,this._diagramLayer,this,l),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(l.children[1])],!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,s)}else{h=this._getInsertIndex(s)+1,g=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,l),c=$.extend(!0,{},this.nameTable[this._getChild(g[h-1])]);this._updateInsertPhase(s,g[h],l,h),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.SvgContext.renderphase(s,this._svg,this._diagramLayer,this,l),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(l.children[1])],!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,s)}this._isUndo||(r={type:"phasecollectionchanged",phase:s,category:"internal",group:l.name,isAdded:!0},this.addHistoryEntry(r))}this._clearSelection(!0)},_removePhase:function(t){var e,i,a,n,o,s,r,l,d=this.nameTable[t],h=!1,g=null;d&&(this._raiseChildrenPropertyChange(d),e=this.nameTable[d.parent.split("phaseStack")[0]],i=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,e),e&&i&&i.length>1&&(r=this,a=i.indexOf(d.name),this._views.forEach(function(e){var i=r._views[e].svg.getElementById(t+"_phase_g");i&&i.parentNode.removeChild(i)}),n=ej.datavisualization.Diagram.SwimLaneContainerHelper._getNextPhase(this,d),a===i.length-1&&(n=ej.datavisualization.Diagram.SwimLaneContainerHelper._getPrevPhase(this,d),g=$.extend(!0,{},{prevPhase:n,currPhase:d}),n.offset=d.offset,h=!0),"horizontal"===e.orientation?n.width+=d.width:n.height+=d.height,o=this.nameTable[t],ej.datavisualization.Diagram.Util.removeItem(this.nodes(),o),this._nodes=$.extend(!0,[],this.nodes()),s=this.nameTable[o.parent],delete this.nameTable[t],ej.datavisualization.Diagram.SvgContext._updatephase(n,this),ej.datavisualization.Diagram.Util.removeItem(i,d.name),ej.datavisualization.Diagram.Util.removeItem(s.children,o),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,s,!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,d),r=this,this._views.forEach(function(e){var i=r._views[e],a=i.svg.getElementById(t);a&&a.parentNode.removeChild(a);var n=i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=$(n).find("#"+o.name+"_label")[0],l=i.svg.getElementById(o.name);l&&l.parentNode&&l.parentNode.removeChild(l),s&&n.removeChild(s)}),this._isUndo||(l={type:"phasecollectionchanged",phase:d,group:e.name,category:"internal",phaseObject:g,islastPhase:h,isAdded:!1},this.addHistoryEntry(l))))},_getEdgeTable:function(t,e){var i,a,n,o,s,r,l;if(!t.segments){if("group"===t._type||"pseudoGroup"===t._type)for(r=this._getChildren(t.children),n=0;n<r.length;n++){if((l=this.nameTable[r[n]])&&l.inEdges&&l.inEdges.length>0)for(o=0,a=(i=l.inEdges).length;o<a;o++)(s=this.nameTable[i[o]])&&(e[s.name]=$.extend(!0,{},s));if(l&&l.outEdges&&l.outEdges.length>0)for(o=0,a=(i=l.outEdges).length;o<a;o++)(s=this.nameTable[i[o]])&&(e[s.name]=$.extend(!0,{},s))}if(t.inEdges&&t.inEdges.length>0)for(o=0,a=(i=t.inEdges).length;o<a;o++)(s=this.nameTable[i[o]])&&(e[s.name]=$.extend(!0,{},s));if(t.outEdges&&t.outEdges.length>0)for(o=0,a=(i=t.outEdges).length;o<a;o++)(s=this.nameTable[i[o]])&&(e[s.name]=$.extend(!0,{},s))}return e},_remove:function(t,e,i){var a,n,o,s,r,l,d,h,g,c,u=!1;if(this._raiseChildrenPropertyChange(t),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&t&&(ej.datavisualization.Diagram.Util.canDelete(t)||i)&&(a=t.segments?"connector":"node",e=e?ej.datavisualization.Diagram.dependentconnector.dependent:ej.datavisualization.Diagram.dependentconnector.independent,n={changeType:"remove",element:this.getNode(t),cancel:!1,dependent:e,state:"changing"},t.segments||(n.adjustDependent=!0,n.deleteDependent=!0),this._eventCause[a+"CollectionChange"]||(this._isKeyDown||this._isUndo)&&(this._eventCause[a+"CollectionChange"]=this._isUndo&&!this._multipleAction?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Keydown),t.isPhase||this._selectedSymbol||this._raiseEvent(a+"CollectionChange",n),!n.cancel)){if(u=!0,o=t.name,"group"==t.type&&"pseudoGroup"!=t.type)for(s=this._getChildren(t.children),r=0;r<s.length;r++)if((l=this.nameTable[s[r]])&&!ej.datavisualization.Diagram.Util.canDelete(l))return;if(t.isSwimlane&&ej.datavisualization.Diagram.SvgContext._removephases(t,this),"bpmn"==t.type)for(s=this._getChildren(t.children),r=0;s&&r<s.length;r++)if((l=this.nameTable[s[r]])&&l.annotation&&l._annotation)for(d=0;d<l._annotation.length;d++)this.nameTable[l._annotation[d]]&&this._remove(this.nameTable[l._annotation[d]],e,!0);if(t.segments)this._removeEdges(t),t.sourceNode=t.sourcePort=t.targetNode=t.targetPort=null,this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[t.name]),ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[t.name]),this._connectors=$.extend(!0,[],this.connectors());else{if(t.annotation&&t._annotation)for(d=0;d<t._annotation.length;d++)this.nameTable[t._annotation[d]]&&this._remove(this.nameTable[t._annotation[d]]);this._disConnect(t,n),this._removeConnector(t,n),this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[t.name]),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[t.name]),this._nodes=$.extend(!0,[],this.nodes()),this._removeNodeFromGraph(t)}a=this.getObjectType(t),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t,!1),t.parent&&((h=this.nameTable[t.parent])&&("group"==h.type||"bpmn"==h.type||"umlclassifier"==h.type)&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(h.children,t.name),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),g=$.extend(!0,{},h),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,h,!0),h.parent&&ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,this.nameTable[h.parent]),ej.datavisualization.Diagram.Util._refreshParentGroup(t,this),ej.datavisualization.Diagram.canvasHelper._updateAddRemoveNodeConnectors(this,h,g),ej.datavisualization.Diagram.canvasHelper._updateAddRemoveLaneConnectors(this,t),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[h.parent]),this._updateQuad(h))),delete this.nameTable[o],t.segments&&this._updateConnectorBridging(t),c=this._svg.getElementById(t.name),"group"==t._type&&"pseudoGroup"!=t.type&&this._removeChildren(t,n),this._removeElement(t),c&&c.parentNode&&c.parentNode.removeChild(c),ej.datavisualization.Diagram.SvgContext._removeContainerHelper(this.activeTool.selectedObject,this._adornerSvg,this._adornerLayer),this._clearSelection(!(!this._selectedSymbol&&!this._dropPhase))}return!u||t.isPhase||this._selectedSymbol||(n.state="changed","connector"===t.type?this._raiseEvent("connectorCollectionChange",n):this._raiseEvent("nodeCollectionChange",n)),u},_removeConnector:function(t,e){var i,a,n;if(!t.segments){if(e.deleteDependent&&!e.adjustDependent){if(t.inEdges&&t.inEdges.length>0)for(a=(i=t.inEdges).length-1;a>=0;a--)this._updateConnection(this.nameTable[i[a]],!0);if(t.outEdges&&t.outEdges.length>0)for(a=0,n=(i=t.outEdges).length;a<n;a++)this._updateConnection(this.nameTable[i[a]],!0)}if(e.deleteDependent&&e.adjustDependent)if(t.inEdges&&t.inEdges.length>0&&t.outEdges&&t.outEdges.length>0){for(a=(i=t.outEdges).length-1;a>=0;a--)this._updateConnection(this.nameTable[i[a]],!0);for(a=(i=t.inEdges).length-1;a>=0;a--)this.nameTable[i[a]]&&this._updateConnection(this.nameTable[i[a]],!0)}else if(t.inEdges&&0==t.inEdges.length&&t.outEdges.length>0)for(a=(i=t.outEdges).length-1;a>=0;a--)this._updateConnection(this.nameTable[i[a]],!0);else if(t.outEdges&&0==t.outEdges.length&&t.inEdges.length>0)for(a=(i=t.inEdges).length-1;a>=0;a--)this.nameTable[i[a]]&&this._updateConnection(this.nameTable[i[a]],!0);else if((t.inEdges&&1==t.inEdges.length||t.inEdges.length>1)&&1==t.outEdges.length)for(a=0,n=(i=t.outEdges).length;a<n;a++)this._updateConnection(this.nameTable[i[a]],!0);else if(!(t.inEdges&&t.inEdges.length>1&&t.outEdges.length>1))for(a=0,n=(i=t.inEdges).length;a<n;a++)this._updateConnection(this.nameTable[i[a]],!0)}},_updateConnection:function(t,e){t&&ej.datavisualization.Diagram.Util.canDelete(t)&&(this._remove(t,e),this.updateConnector(t.name))},_removeElement:function(t){for(var e,i=0;i<this._views.length;i++)e=this._views[i],this._views[e].context.removeChild(t,this._views[e])},_disConnect:function(t,e,i){var a,n,o,s,r,l,d,h,g,c,u;if(t.inEdges&&t.inEdges.length>0)for(d=0,g=(a=t.inEdges).length;d<g;d++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[a[d]])&&(u=!0);if(t.outEdges&&t.outEdges.length>0)for(d=0,g=(n=t.outEdges).length;d<g;d++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[n[d]])&&(u=!0);if(e.deleteDependent&&e.adjustDependent&&!i&&u){if(t.inEdges&&t.inEdges.length>0&&t.outEdges.length>0)if(a=t.inEdges,n=t.outEdges,(t.inEdges.length>1||1==t.inEdges.length)&&1==t.outEdges.length){for(d=0,g=a.length;d<g;d++)this.nameTable[a[d]]&&this.nameTable[n[0]]&&this.nameTable[a[d]].targetNode==this.nameTable[n[0]].sourceNode&&((r=this.nameTable[this.nameTable[n[0]].targetNode])&&(l=$.extend(!0,{},r),this.nameTable[a[d]].sourceNode!=this.nameTable[n[0]].targetNode&&(this.nameTable[a[d]].targetNode=this.nameTable[n[0]].targetNode,this.nameTable[a[d]].targetPort=this.nameTable[n[0]].targetPort,r.inEdges.push(this.nameTable[a[d]].name))),ej.datavisualization.Diagram.Util.dock(this.nameTable[a[d]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[a[d]],this));this.nameTable[n[0]]&&(this.nameTable[n[0]].sourceNode=null,this.nameTable[n[0]].sourcePort=null)}else if(!(t.inEdges.length>1&&t.outEdges.length>1))for(d=0,g=a.length;d<g;d++)if(t.outEdges.length>0&&this.nameTable[a[d]]){for(s=this.nameTable[this.nameTable[a[d]].sourceNode],l=$.extend(!0,{},s),h=0,c=n.length;h<c;h++)this.nameTable[a[d]].targetNode==this.nameTable[n[h]].sourceNode&&(this.nameTable[n[h]].sourceNode=this.nameTable[a[d]].sourceNode,this.nameTable[n[h]].sourcePort=this.nameTable[a[d]].sourcePort,s.outEdges[l.outEdges.length+h]=this.nameTable[n[h]].name,ej.datavisualization.Diagram.Util.dock(this.nameTable[n[h]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[n[h]],this));this.nameTable[a[d]].targetNode=null,this.nameTable[a[d]].targetPort=null}}else{if(t.inEdges&&t.inEdges.length>0)for(d=0,g=(a=t.inEdges).length;d<g;d++)(o=this.nameTable[a[d]])&&(o.targetNode=null,o.targetPort=null);if(t.outEdges&&t.outEdges.length>0)for(d=0,g=(n=t.outEdges).length;d<g;d++)(o=this.nameTable[n[d]])&&(o.sourceNode=null,o.sourcePort=null)}},_removeEdges:function(t){t.targetNode&&this.nameTable[t.targetNode]&&this.nameTable[t.targetNode].inEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[t.targetNode].inEdges,t.name),t.sourceNode&&this.nameTable[t.sourceNode]&&this.nameTable[t.sourceNode].outEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[t.sourceNode].outEdges,t.name)},_selectionContains:function(t){if(this._hasSelection()&&t)for(var e=0;e<this.selectionList.length;e++)if(t.name===this.selectionList[e].name)return!0;return!1},_getPhaseIndex:function(t){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseIndex(this,t)},_getPhaseBounds:function(t){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseBounds(this,t)},_addSelection:function(t,e){var i,a,n,o,s,r;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||t&&"pseudoGroup"===t._type||this._selectedSymbol||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&t&&ej.datavisualization.Diagram.Util.enableLayerOption(t,"lock",this)&&(ej.datavisualization.Diagram.Util.canSelect(t)||"phase"==t.type)&&!this._selectionContains(t)){var l=[],d=[],h=[];if(this._previousSelectedItems&&(d=this._previousSelectedItems),"pseudoGroup"==t.type)for(i=this._getChildren(t.children),a=0;a<i.length;a++)n=this.nameTable[i[a]],-1==d.indexOf(n)?l.push(n):ej.datavisualization.Diagram.Util.removeItem(d,n),h.push(n);else l.push(t),h.push(t);this._eventCause.selectionChange||(this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Unknown),this.getNode(t),o={changeType:"insert",element:this.getNode(t),state:"changing",selectedItems:h,oldItems:d,newItems:l,cancel:!1},this._selectedSymbol&&!this._endEditing||e||(this._raiseEvent("selectionChange",o),this._previousSelectedItems=o.newItems),o.cancel?t&&"pseudoGroup"==t.type&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),t),this._nodes=$.extend(!0,[],this.nodes()),delete this.nameTable[t.name]):(this.selectionList.push(t),this._updateSelectorObject(t),t.isPhase&&(s=this._getPhaseBounds(t)),ej.datavisualization.Diagram.SvgContext.renderSelector(t,this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,s,this),null!=this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0&&(r=!1,"pseudoGroup"==t.type&&(r=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,t,this._adornerSvg,r,this._currZoom,this._adornerLayer,this)),this._selectedSymbol&&!this._endEditing||e||(o={changeType:"insert",element:this.getNode(t),state:"changed",cause:o.cause,selectedItems:h,oldItems:d,newItems:l,cancel:!1},this._raiseEvent("selectionChange",o)))}},_getInsertIndex:function(t){var e,i,a,n=-1,o=this.nameTable[t.parent],s=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,o);if(s&&s.length>0&&this.nameTable[this._getChild(s[0])])for(e=this.nameTable[this._getChild(s[0])].offset,a=0;a<s.length;a++)(i=this.nameTable[this._getChild(s[a])])&&i.offset<=t.offset&&i.offset>=e&&(e=i.offset,n=a);return n},_updateInsertPhase:function(t,e,i,a,n){var o,s,r,l,d,h,g=this.nameTable[e],c=this.nameTable[this._getChild(i.children[1])];c&&c.children&&c.children.length>0&&(o=this.nameTable[e],s=ej.datavisualization.Diagram.Node(t),i.isSwimlane&&i.orientation&&"vertical"==i.orientation?(n?(r=t.height,o.height=n.phaseObject.prevPhase.height,o.offset=n.phaseObject.prevPhase.offset):(r=o.height,o.height=g.offset-t.offset,l=r-o.height,s.height=l),s.parent=c.name,s.name=t.name,s.width=o.width,s.isPhase=!0):(n?(d=t.width,o.width=n.phaseObject.prevPhase.width,o.offset=n.phaseObject.prevPhase.offset):(d=o.width,o.width=g.offset-t.offset,h=d-o.width,s.width=h),s.parent=c.name,s.name=t.name,s.height=o.height,s.isPhase=!0),s.x=0,s.y=0,this._isUndo&&0!==s.labels.length||(s.labels=[t.label?t.label:ej.datavisualization.Diagram.Label()]),s.labels[0].rotateAngle="horizontal"==t.orientation?0:270,s.constraints=ej.datavisualization.Diagram.NodeConstraints.Default&~(ej.datavisualization.Diagram.NodeConstraints.Select|ej.datavisualization.Diagram.NodeConstraints.Connect),s.isPhase=!0,s._type="node",this.add(s,{entryHistory:!0}),c.children.pop(s),c.children.splice(a,0,s))},_getFirstLane:function(t){var e,i,a;return t.children[2]&&(e=this.nameTable[this._getChild(t.children[2])]),e&&e.children&&e.children.length>0&&((i=this.nameTable[this._getChild(e.children[0])])&&i.children&&i.children.length>0&&(a=this.nameTable[this._getChild(i.children[0])]))?a:null},updateSelector:function(t){if(""!=this._selectedItem){var e={};t.offsetX&&(e.offsetX=Number("function"==typeof t.offsetX?t.offsetX():t.offsetX)),t.offsetY&&(e.offsetY=Number("function"==typeof t.offsetY?t.offsetY():t.offsetY)),t.width&&(e.width=Number("function"==typeof t.width?t.width():t.width)),t.height&&(e.height=Number("function"==typeof t.height?t.height():t.height)),t.rotateAngle&&(e.rotateAngle=Number("function"==typeof t.rotateAngle?t.rotateAngle():t.rotateAngle)),this.updateNode(this._selectedItem,e)}t.userHandles&&(this.model.selectedItems.userHandles=t.userHandles,this._initHandles(),this.selectionList[0]&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,"pseudoGroup"==this.selectionList[0].type,!1,this._currZoom,this)),t.tooltip&&(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.selectedItems.tooltip,{},t.tooltip)))},_updateSelectorObject:function(t){var e,i;if(t.segments||(this._selectorOffsetX(t.offsetX),this._selectorOffsetY(t.offsetY),this._selectorWidth(t.width),this._selectorHeight(t.height),this._selectorRotateAngle(t.rotateAngle),this._selectedItem=t.name),"pseudoGroup"==t.type)for(e=0;e<t.children.length;e++)"object"==typeof(i=t.children[e])?this.model.selectedItems.children.indexOf(i)<0&&this.model.selectedItems.children.push(i):"string"==typeof i&&this.model.selectedItems.children.indexOf(this.nameTable[this._getChild(i)])<0&&this.model.selectedItems.children.push(this.nameTable[this._getChild(i)]);else this.model.selectedItems.children.indexOf(t)<0&&this.model.selectedItems.children.push(t)},_clearSelectorObject:function(){this._selectorOffsetX(0),this._selectorOffsetY(0),this._selectorWidth(0),this._selectorHeight(0),this._selectorRotateAngle(0),this._selectedItem="",this.model.selectedItems.children=[]},_raiseEvent:function(t,e){if(this.model[t])return e.elementType=this.getObjectType(e.element),(("nodeCollectionChange"===t||"connectorCollectionChange"===t||"selectionChange"===t)&&"changing"===e.state||"scrollChange"===t)&&(e.cause=this._eventCause[t]?this._eventCause[t]:"unknown"),this._multipleAction||(this._eventCause={}),e.diagramId=this.element[0].id,this._trigger(t,e)},_clearSelection:function(t){if(this._hasSelection()){this._isEditing&&this.selectionList.length>0&&!this._isDragg&&this._endEdit();var e={changeType:"remove",state:"changing",element:null,selectedItems:[],oldItems:this.model.selectedItems.children,newItems:[],cancel:!1};this._selectedSymbol||t||(this._raiseEvent("selectionChange",e),this._previousSelectedItems=[]),e.cancel||(this._clearSelectorObject(),this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.selectionList[0]),this._nodes=$.extend(!0,[],this.nodes()),delete this.nameTable[this.selectionList[0].name]),ej.datavisualization.Diagram.Util.clear(this.selectionList),ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),this._selectedSymbol||t||(e={changeType:"remove",state:"changed",cause:e.cause,element:null,selectedItems:[],oldItems:this.model.selectedItems.children,newItems:[],cancel:!1},this._raiseEvent("selectionChange",e)))}},_updateSelectionHandle:function(t){var e,i,a;this.selectionList.length>0&&(e="label"==this.selectionList[0]._type?this.selectionList[0]:this.nameTable[this.selectionList[0].name],i=this.model.selectedItems.constraints,t&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&(i&=~ej.datavisualization.Diagram.SelectorConstraints.UserHandles),"label"!==this.selectionList[0]._type&&this._updateSelectorObject(e),ej.datavisualization.Diagram.SvgContext.updateSelector(e,this._adornerSvg,this._currZoom,this,i,this.activeTool._resizeDirection,t)||null!=this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0&&(a=!1,"pseudoGroup"==e.type&&(a=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,e,this._adornerSvg,a,t,this._currZoom,this)))},_hasSelection:function(){return this.selectionList.length>0},_canActivateLabelTool:function(t,e){var i,a,n,o,s,r;if(e){if(null==(i=this._findLabelAtPoint(this._mousePosition(t),e))&&("",n=t.target,this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg&&((o=$(t.target).parents(".ej-d-label"))[0]&&(n=o[0])),n&&"ej-d-label"==n.getAttribute("class")))for(s=n.id.split("_"),r=0;r<e.labels.length;r++)a=e.labels[r].name.split("_"),s[s.length-1]==a[a.length-1]&&(i=e.labels[r]);if(i)return ej.datavisualization.Diagram.Util.canMoveLabel(e)?1:ej.datavisualization.Diagram.Util.canSelect(i)||ej.datavisualization.Diagram.Util.canMove(i)||ej.datavisualization.Diagram.Util.canResize(i)||ej.datavisualization.Diagram.Util.canRotate(i)}return!1},_checkToolToActivate:function(t,e){var i,a,n,o,s,r,l=!1,d=!1;return i=ej.datavisualization.Diagram.Util._getPseudoGroupConstraints(this,e,this.selectionList[0]),e?((e.segments&&(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&t.shiftKey||(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&t.altKey)&&(this._toolToActivate="endPoint",this._currentCursor="move",l=!0),l||(t.target&&"ej-d-port"!=t.target.getAttribute("class")&&this._selectionContains(e)?(e.segments?l=this._canActivateEndPointTool(t,e):((!i||i&ej.datavisualization.Diagram.NodeConstraints.Resize)&&(l=this._canActivateResizeTool(t,e)),l||(!i||i&ej.datavisualization.Diagram.NodeConstraints.Rotate)&&(l=this._canActivateRotateTool(t,e))),l||(l=this._canActivateUserHandle(t,e)),l||(!i||i&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(e&&e.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(e)?(this._toolToActivate="select",this._currentCursor="default"):t&&t.target&&this._canActivateLabelTool(t,e)&&("ej-d-label"===t.target.getAttribute("class")||"ej-d-label"===t.target.parentNode.getAttribute("class")||this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg)?d=!0:l=this._canActivateMoveTool(t,e)),l||(l=this._canActivatephaseTool(t))):(t&&t.target&&t.target.classList&&t.target.classList.contains("ej-d-port")&&(a=this._mousePosition(t),(n=this._findPortAtPoint(a,e))&&(o=this._getvalues(t),(s=this._getSetTool())&&s(o,n),(s&&"draw"===o.action||"drag"!=o.action&&n.constraints&ej.datavisualization.Diagram.PortConstraints.ConnectOnDrag&&ej.datavisualization.Diagram.PortConstraints.Connect&&(n.visibility&ej.datavisualization.Diagram.PortVisibility.Visible||n.visibility&ej.datavisualization.Diagram.PortVisibility.Hover))&&(this._currentCursor="crosshair","orthogonal"===((r=this.model.drawType).segments&&r.segments.length&&r.segments[0].type?r.segments[0].type:"orthogonal")?this.activateTool("orthogonalLine",!0):this.activateTool("straightLine",!0),this._activatedFromPort=!0,l=!0))),t&&this._canActivateLabelTool(t,e)&&t.target&&("ej-d-label"===t.target.getAttribute("class")||"ej-d-label"===t.target.parentNode.getAttribute("class")||this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg)?d=!0:(!i||i&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(l=this._canActivateMoveTool(t,e))))):l=this._canActivatephaseTool(t),n&&"drag"===o.action&&(this._currentCursor="pointer",this._toolToActivate="portTool"),d&&(this._currentCursor="pointer",this._toolToActivate="labelMove",l=!0),l||(this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&(this._findNodeUnderMouse(t)&&(this._toolToActivate="select",this._currentCursor="default",l=!0)),l||(this._toolToActivate="panTool",this._currentCursor="pointer")):(this._toolToActivate="select",this._currentCursor="default")),"rotate"!=this._toolToActivate&&"labelRotate"!=this._toolToActivate&&this._adornerSvg.document.removeAttribute("class"),l},_canActivatephaseTool:function(t){if($(t.target).parents(".ej-d-seperator").first()[0]){var e=$(t.target).parents("g").first()[0].id,i=this._getSeperetor(e.split("_phase_g")[0]),a=this.nameTable[i.parent.split("phaseStack")[0]];if(a&&ej.datavisualization.Diagram.Util.canResize(a))return this._currentCursor=i?"horizontal"==i.orientation?"e-resize":"n-resize":"default",this._toolToActivate="phase",!0}},_canActivateUserHandle:function(t){if(this._isUserHandle(t)&&t.target){var e=t.target.id.split("_")[0];return this._toolToActivate=e,this._currentCursor=this.tools[this._toolToActivate].cursor,!0}return!1},_canActivateEndPointTool:function(t,e){if(e){var i=t.target.getAttribute("class");if(i&&("targetEndPoint"===i&&ej.datavisualization.Diagram.Util.canDragTargetEnd(e)||"sourceEndPoint"===i&&ej.datavisualization.Diagram.Util.canDragSourceEnd(e)||(i.match("bezierpoint")||"segmentEnd"==i)&&ej.datavisualization.Diagram.Util.canDragSegmentThumbs(e)))return this._toolToActivate="endPoint",this._currentCursor="move",!0}return!1},_canActivateResizeTool:function(t,e){var i,a=t.target.getAttribute("class");return!(!(ej.datavisualization.Diagram.Util.canResize(e,a)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Resizer)||"nw-resize"!==a&&"n-resize"!==a&&"ne-resize"!==a&&"w-resize"!==a&&"e-resize"!==a&&"sw-resize"!==a&&"s-resize"!==a&&"se-resize"!==a)&&("label"!==e._type?(this._toolToActivate="resize",i=e.rotateAngle):(this._toolToActivate="labelResize",i=this._findLabelRotateAngle(e)),i>=0&&i<25||i>=160&&i<=205||i>=340&&i<=360?this._currentCursor=a:i>=25&&i<=70||i>=205&&i<=250?this._currentCursor="n-resize"===a||"s-resize"===a?"ne-resize":"nw-resize"===a||"se-resize"===a?"n-resize":"e-resize"===a||"w-resize"===a?"nw-resize":"e-resize":i>=70&&i<=115||i>=250&&i<=295?this._currentCursor="n-resize"===a||"s-resize"===a?"e-resize":"nw-resize"===a||"se-resize"===a?"ne-resize":"e-resize"===a||"w-resize"===a?"n-resize":"nw-resize":(i>=115&&i<=155||i>=295&&i<=340)&&(this._currentCursor="n-resize"===a||"s-resize"===a?"nw-resize":"nw-resize"===a||"se-resize"===a?"e-resize":"e-resize"===a||"w-resize"===a?"ne-resize":"n-resize"),!0)},_canActivateMoveTool:function(t,e){var i,a,n,o;return t.target&&(i=t.target.className),!!((a=i&&ej.datavisualization.Diagram.Util.isClassifier(t)?ej.datavisualization.Diagram.ClassifierHelper.getMovableElementUnderMouse(t,this):i&&"ej-d-multiselector"===i.animVal&&e&&"pseudoGroup"==e.type&&ej.datavisualization.Diagram.Util.canDragHelper(this)?this.selectionList[0]:this._findNodeUnderMouse(t))&&a.name===e.name&&(!0,e.parent&&!!(this.selectionList.length>0&&this._selectionContains(e)),n=!1,e.parent&&(o=this.nameTable[e.parent],o&&((o.isSwimlane||o.isLane)&&ej.datavisualization.Diagram.Util.canMove(o)||o.isPhaseStack)&&(n=!0)),ej.datavisualization.Diagram.Util.canMove(e)||n))&&(this._toolToActivate="move",this._currentCursor=this._isHyperLink(t)?"pointer":this.selectionList.length>0&&(this._selectionContains(e)||this.selectionList[0].children&&this._findChildren(this.selectionList[0],e.name))?"move":"default",!0)},_isLabelTemplate:function(t){var e,i,a,n;if(t&&(e=$(t.target).parents(".ej-label-template")[0])){if("lblbg"==(i=e.parentNode.id.split("_"))[i.length-1])return!0;for(n=(a=t.target.parentNode).getAttribute("class");a;){if("ej-label-template"===n)return!0;n=(a=a.parentNode).getAttribute("class")}}},_isHyperLink:function(t){var e=t.target,i=e.getAttribute("class");return!(i&&"ej-d-label"!=!i||!e.parentNode||!$(e.parentNode).hasClass("ej-d-label")||(e=e.parentNode,!$(e.parentNode).hasClass("ej-d-anchor")))},_canActivateRotateTool:function(t,e){if(ej.datavisualization.Diagram.Util.canRotate(e)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Rotator&&"rotateHandle"===t.target.getAttribute("class"))return this._toolToActivate="label"!==e._type?"rotate":"labelRotate","msie"===ej.browserInfo().name?(this._currentcursor="default",this._adornerSvg.document.setAttribute("class","svg-rotate-ie"),this._currentCursor=""):(this._adornerSvg.document.setAttribute("class","svg-rotate"),this._currentCursor=""),!0;return!1},_canActivatePivotTool:function(t){return"pivot"===t.target.getAttribute("class")&&(this._toolToActivate="pivot",this._currentCursor="default",!0)},_updateCursor:function(){this._isInit||(this.element[0].style.cursor=this._currentCursor,this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0].style.cursor=this._currentCursor)},_getResizeCursor:function(t){var e="default";switch(t){case"topleft":e="nw-resize";break;case"topcenter":e="n-resize";break;case"topright":e="ne-resize";break;case"middleleft":e="w-resize";break;case"middleright":e="e-resize";break;case"bottomleft":e="sw-resize";break;case"bottomcenter":e="s-resize";break;case"bottomright":e="se-resize"}return e},_startEdit:function(t){var e,i,a,n,o,s,r,l,d,h,g,c,u,m,p=ej.Matrix.identity(),f=t.width?t.width:t._width,_=t.height?t.height:t._height;ej.Matrix.rotate(p,t.rotateAngle,f/2,_/2),"text"===t.type?(n=null!==this._svg.getElementById(t.name+"_shape")?this._svg.getElementById(t.name+"_shape").getBBox():{x:t.offsetX-f*t.pivot.x,y:t.offsetY-_*t.pivot.y,width:f,height:_},(e=t.textBlock)&&!e.readOnly&&(o=ej.datavisualization.Diagram.Util.bounds(t),s=new ej.datavisualization.Diagram.Rectangle(n.x-e.fontSize,n.y-e.fontSize,n.width+e.fontSize/2,n.height+e.fontSize/2),r=this._currZoom,m=ej.Matrix.transform(p,ej.datavisualization.Diagram.Util._getLabelPosition(e,o)),i=t.offsetX-f*t.pivot.x+m.x,a=t.offsetY-_*t.pivot.y+m.y,"left"==e.horizontalAlignment?i+=n.width/2:"right"==e.horizontalAlignment&&(i-=n.width/2),"top"==e.verticalAlignment?a+=n.height/2:"bottom"==e.verticalAlignment&&(a-=n.height/2),0===n.width||0===n.height?(n=ej.datavisualization.Diagram.Util.bounds(t),s.width=0==n.width?50:o.width*r,s.x=i*r-s.width/2*r-this._hScrollOffset,s.height=e.fontSize,s.y=a*r-s.height/2*r-this._vScrollOffset):(s.width=50,s.height=e.fontSize,s.x=i*r-s.width/2*r-this._hScrollOffset,s.y=a*r-s.height/2*r-this._vScrollOffset),this._boundingBox=s,this._createEditBox(e,s.x,s.y,s.width,s.height,t),this._isEditing=!0)):(t.labels.length>0?(e=this.activeTool.getLabelUnderMouse())||(e=t.labels[0]):(this._newLabelCreated=!0,l=this._findNode(t.name),(e=new ej.datavisualization.Diagram.Label({name:"label"+ej.datavisualization.Diagram.Util.randomId()}))._parent=t.name,t.labels.push(e),d=l!==t?l:null,ej.datavisualization.Diagram.DiagramContext.addNodeLabel(t,e,d,this),"textTool"===this.activeTool.name&&(this.activateTool.activeLabel=e)),e&&!e.readOnly&&""===e.hyperlink&&""===e.templateId&&("svg"!==this.model.labelRenderingMode?(h=this._htmlLayer?this._htmlLayer:this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],g=$(h).find("#"+t.name+"_"+e.name)[0]):g=this._svg.document.getElementById(t.name+"_"+e.name),g?(o=ej.datavisualization.Diagram.Util.bounds(t),"svg"!==this.model.labelRenderingMode?n=s=new ej.datavisualization.Diagram.Rectangle(g.offsetLeft,g.offsetTop,g.offsetWidth,g.offsetHeight):(n=g.getBBox(),s=new ej.datavisualization.Diagram.Rectangle(0,0,n.width,n.height)),r="svg"!=this.model.labelRenderingMode?this._currZoom:1,c=ej.datavisualization.Diagram.Util._getLabelPosition(e,o),t.segments||"segmentpath"==e.relativeMode?(s={x:(s=g.getBoundingClientRect()).left,y:s.top,width:s.width,height:s.height},u=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),i=(s.x+s.width/2-u.left+this._hScrollOffset)/r,a=(s.y+s.height/2-u.top+this._vScrollOffset)/r):("left"==e.horizontalAlignment?c.x+=n.width/2:"right"==e.horizontalAlignment&&(c.x-=n.width/2),"top"==e.verticalAlignment?c.y+=n.height/2:"bottom"==e.verticalAlignment&&(c.y-=n.height/2),m=ej.Matrix.transform(p,c),i=t.offsetX-f*t.pivot.x+m.x,a=t.offsetY-_*t.pivot.y+m.y),0===n.width||0===n.height?(n=ej.datavisualization.Diagram.Util.bounds(t),t.segments,s.width=n.width<50?50:o.width,s.x=i*r-s.width/2-this._hScrollOffset,s.height="umlclassifier"==t.type?t.height:e.fontSize,s.y=a*r-s.height/2*r-this._vScrollOffset):(s.x=i*r-s.width/2*r-this._hScrollOffset,s.y=a*r-s.height/2*r-this._vScrollOffset),this._boundingBox=s,this._createEditBox(e,s.x,s.y,s.width,s.height,t),this._isEditing=!0):this.activeTool.selectedObject=null))},_hideShowSVGLabels:function(t,e,i){var a;this._svg&&e&&((a="text"===e.type?this._svg.document.getElementById(e.name+"_shape_lblbg"):this._svg.document.getElementById(e.name+"_"+t.name))&&a.setAttribute("visibility",i&&(t.visible||e.visible)?"visible":"hidden"),(a=this._svg.document.getElementById(e.name+"_"+t.name+"_lblbg"))&&a.setAttribute("visibility",i&&t.visible?"visible":"hidden"))},_createEditBox:function(t,e,i,a,n,o){var s,r,l,d,h,g,c;this._svg&&(this.model.labelRenderingMode==ej.datavisualization.Diagram.LabelRenderingMode.Svg?this._hideShowSVGLabels(t,o):(s=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0])&&((r="text"===o.type?$(s).find("#"+o.name+"_shape_lblbg")[0]:$(s).find("#"+o.name+"_"+t.name+"_lblbg")[0])&&(r.style.display="none")),l=ej.datavisualization.Diagram.Util.bounds(o),d=document.createElement("div"),"stretch"==t.horizontalAlignment&&t.textOverflow&&0==t.rotateAngle&&o.isSwimlane?i-=t.fontSize:"stretch"==t.horizontalAlignment&&!o.isSwimlane&&o._isHeader&&t.textOverflow&&0!=t.rotateAngle&&(e=-e-t.fontSize-a/4),h={id:this.element[0].id+"_editBoxDiv",class:"edit",style:"top:"+i+"px;left:"+e+"px;width:"+a+"px;font-family:"+t.fontFamily+";font-size:"+t.fontSize+"px;min-width: 50px;min-height:"+t.fontSize+"px;"},ej.datavisualization.Diagram.Util.canZoomTextEditor(this)&&(h.style+="transform: scale("+this._currZoom+");"),ej.datavisualization.Diagram.Util.attr(d,h),g=document.createElement("textarea"),c="white"!=(c=t.fontColor?t.fontColor.toLowerCase():"black")&&"ffffff"!=c&&"rgb(255,255,255)"!=c?c:"black",h={id:this.element[0].id+"_editBox",class:"editBox",style:"font-size:"+t.fontSize+"px;font-family:"+t.fontFamily+";min-height:"+t.fontSize+"px; height: "+n+"px; line-height: normal; color:"+c+";font-weight:"+(t.bold?"bold":"normal")+";font-style:"+(t.italic?"italic":"normal")+";text-decoration:"+t.textDecoration,nodeWidth:l.width,nodeHeight:l.height,fontSize:t.fontSize,nodeOffsetX:o.offsetX,nodeOffsetY:o.offsetY,containerName:o.name},ej.datavisualization.Diagram.Util.attr(g,h),g.value=t.text,d.appendChild(g),$(this._canvas).append(d),""!==t.text&&this._updateEditor(null,d,g,l.width,t.fontSize,t,o),this._on($(g),"focusout",this._editboxfocusout),this._on($(g),"keyup",this._editBoxKeyUp),this._on($(g),"input",this._editBoxTextChange),this._on($(g),"focusin",this._editboxfocusin),g.focus())},_editBoxKeyUp:function(t){this._updateLabelPosition(t)},_editBoxTextChange:function(t){this._updateLabelPosition(t)},_updateEditBox:function(t,e){var i=document.getElementById(this.element[0].id+"_editBoxDiv");i&&(i.style.left=i.offsetLeft-t+"px",i.style.top=i.offsetTop-e+"px")},_editboxfocusout:function(){this._endEditing=!0,this._endEdit(),delete this._endEditing},_editboxfocusin:function(t){t.target.select(),this._raiseEvent("editorFocusChange",t)},_updateLabelPosition:function(t){var e,i,a=50,n=this._currZoom,o=this._boundingBox,s=Number(t.target.getAttribute("fontSize")),r=Number(t.target.getAttribute("nodeWidth")),l=o.x+o.width/2,d=o.y+o.height/2,h=this._textLength(t);0===h.width?(e=o.width<a?a:o.width,t.target.parentNode.style.width=e+"px",t.target.parentNode.style.left=l-e/2-s/4+"px"):(e=h.width<=r*n?h.width<a?a:h.width:h.width>=r*n?h.width>a?h.width:a:r<a?a:r*n,t.target.parentNode.style.width=e+"px",t.target.parentNode.style.left=l-e/2+"px"),0===h.height?(t.target.style.height=s+"px",t.target.parentNode.style.top=d-s/2+"px"):this._selectedItem&&("text"===this.nameTable[this._selectedItem].type&&(i=this._currentLabel)),this._updateEditor(t,t.target.parentNode,t.target,r,s,i)},_updateEditor:function(t,e,i,a,n,o,s){var r,l,d,h,g,c,u,m=this._textLength(t,o),p="svg"!=this.model.labelRenderingMode||s&&"text"===s.type?this._currZoom:1,f=this._boundingBox.x,_=this._boundingBox.y,v=this._boundingBox.width,y=this._boundingBox.height,b=i.value.split("\n");s||(s=this.activeTool.selectedObject),s&&s.parent&&(d=this.nameTable[s.parent]),this._nodeUnderMouse&&(this.old=this._nodeUnderMouse,h=this._nodeUnderMouse.name.match("_attribute")?"attribute":this._nodeUnderMouse.name.match("_method")?"method":this._nodeUnderMouse.name.match("_member")?"member":this._nodeUnderMouse.name.match("_header_classifier")?"header":"null"),this.old&&(h=this.old.name.match("_attribute")?"attribute":this.old.name.match("_method")?"method":this.old.name.match("_member")?"member":this.old.name.match("_header_classifier")?"header":"null"),g=h&&"null"!=h?m.width>a?m.width:a:a<m.width?a:m.width,"mozilla"===this._browserInfo.name&&(g+=2),c=g<50?50:g,e.style.width=c+"px",r=t?(c-v)/2:(c-v*p)/2,e.style.left=d&&d.isLane&&o&&"stretch"==o.horizontalAlignment&&o.textOverflow&&0!=o.rotateAngle?f-r-n-v/4+"px":f-r-n/4+"px",b.length>1||m.width!=a?(s&&"umlclassifier"!=s.type&&(i.style.height="0"),l="mozilla"===this._browserInfo.name?i.scrollHeight-5:i.scrollHeight-4):l=n;var x=$(i).offset(),D=$(this._canvas).offset(),C=$(this._canvas).height();C||(C=this._getCanvasHeight(this._canvas,C)),x.top-D.top+Number(l)>C&&(l-=x.top-D.top+Number(l)-C,l="mozilla"===this._browserInfo.name?l-7:l-6),i.style.height=l+"px",u=0,t?u=_-(l-y)/2*p:u=_-(d&&d.isSwimlane&&o&&"stretch"==o.horizontalAlignment&&o.textOverflow&&0==o.rotateAngle?(l-y*p)/2+o.fontSize:(l-y*p)/2)-3*p,e.style.top=u+"px",this._boundingBox=new ej.datavisualization.Diagram.Rectangle(f-r,u,c,l)},_getCanvasHeight:function(t,e){for(var i=e,a=t;i<=0;)(a=a.parentNode)&&(i=$(a).height());return i},_textLength:function(t,e){var i,a=document.createElement("div"),n=document.getElementById(this.element[0].id+"_editBox"),o={id:this.element[0].id+"_editBoxHiddenDiv",style:"position : absolute; width : auto; height : auto;font-size:"+n.style.fontSize+"px;font-family:"+n.style.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"};return e&&(o.style="position : absolute; width : auto; height : auto;font-weight:"+(e.bold?"bold":"normal")+";font-style:"+(e.italic?"italic":"normal")+";text-decoration:"+e.textDecoration+";font-size:"+e.fontSize+"px;font-family:"+e.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"),ej.datavisualization.Diagram.Util.attr(a,o),t?a.appendChild(document.createTextNode(t.target.value)):a.appendChild(document.createTextNode(n.value)),document.body.appendChild(a),i=a.getBoundingClientRect(),document.body.removeChild(a),i},_endEdit:function(t){var e,i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b=document.getElementById(this.element[0].id+"_editBox");if(b){if(o=this._findNode(b.getAttribute("containerName")),"textTool"===this.activeTool.name)o=this.activeTool.selectedObject;else if(!o)for(s=0;s<this.selectionList.length;s++)void 0!==(r=this.selectionList[s]).labels.length&&r.labels.length>0&&r.labels[0].mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&(o=this.selectionList[s]);o&&(this._isEditing=!1,"text"==o.type?l=o.textBlock:(l=this.activeTool.getLabelUnderMouse())||(l=o.labels[0]),"umlclassifier"==o.type&&(b.value=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(b.value,o,this)),l&&(d=l.text),"node"!=o._type||o.width&&o.height||!this.nameTable[o.name]||(a=o._width,n=o._height,o.labels[0].text=b.value,this._getNodeDimension(o)),"umlclassifier"==o.type&&(o=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(o,this)),t&&(h=27===t.keyDownEventArgs.keyCode?"ESC":String.fromCharCode(t.keyDownEventArgs.keyCode)),b.value!=d&&(e=this._raiseEvent("textChange",{element:this.getNode(o),label:l,value:b.value,keyCode:h})),e?(o._width&&a&&(o._width=a),o._height&&n&&(o._height=n),o&&"text"===o.type?ej.datavisualization.Diagram.DiagramContext.update(o,this):(l=this.activeTool.activeLabel?this.activeTool.activeLabel:o.labels.length>0?o.labels[0]:null)!=undefined&&(l.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(o,l,this)),this.activeTool&&(this.activeTool.activeLabel=null,this.activeTool.selectedObject=null)):(o&&o.type!==undefined&&"text"===o.type?(g=d,o.textBlock.text=b.value,o.textBlock.mode=ej.datavisualization.Diagram.LabelEditMode.View,this._findNode(o.name)?(ej.datavisualization.Diagram.DiagramContext.update(o,this),i={type:"labelchanged",shape:o,previousLabelValue:g,updatedLabelValue:b.value,category:"internal"},this.addHistoryEntry(i)):(""!==b.value&&(c=Number(b.style.height.substring(0,b.style.height.length-2)),o.height<c&&(o.offsetY=o.offsetY-o.height/2+c/2,o.height=c),this.selectionList.length>0&&this._clearSelection(!0),this.tools.move._outOfBoundsDrag(o)&&(this.add(o),(u=this.nameTable[o.parent])&&u.isLane&&((m=this._moveOnLane(o,u)).proceedX||this.updateNode(o.name,{offsetX:o.offsetX+m.x}),m.proceedY||this.updateNode(o.name,{offsetY:o.offsetY+m.y}),this._updateNodeMargin(o),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,u),u.isLane&&((p=this._getSwimlane(u))&&(this._updateChildAdjacentConnectors(p,!0),delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,p),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,p)))))),this.activeTool.selectedObject=null)):o==undefined||"pseudoGroup"==o.type||(l!=undefined?(this._comparePropertyValues(l,"text",{text:b.value}),(d=d||l.text)!=b.value&&(this._newLabelCreated?(l.text=b.value,i={type:"labelcollectionchanged",shape:o,label:l,isUndo:!0,category:"internal"}):i={type:"labelchanged",shape:o,previousLabelValue:l.text,updatedLabelValue:b.value,index:o.labels.indexOf(l),category:"internal"},this.addHistoryEntry(i)),l.text=b.value,l.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(o,l,this),o.isPhase&&(o.name.split("phaseStack")[1]&&(f=this.nameTable[o.name.split("phaseStack")[1]]),f&&f.label&&(f.label.text=b.value)),this.activeTool.selectedObject=null):0==o.labels.length&&((l=ej.datavisualization.Diagram.Label()).text=b.value,l.mode=ej.datavisualization.Diagram.LabelEditMode.View,l._parent=o.name,o.labels.push(l),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(o,l,null,this)),this.activeTool.activeLabel&&(this.activeTool.activeLabel=null)),o.shape&&"umlclassifier"==o.shape.type&&(o=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(o,b.value,l)),"node"!=o._type||o.width&&o.height||!this.nameTable[o.name]||(ej.datavisualization.Diagram.DiagramContext.update(o,this),o.parent&&ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[o.parent],this)),"umlclassifier"==o.type&&(o.labels[0].text="",ej.datavisualization.Diagram.DiagramContext.update(o,this)),o.shape&&"umlclassifier"==o.shape.type&&ej.datavisualization.Diagram.DiagramContext.update(o,this))),this._off($(b),"focusout",this._editboxfocusout),this._off($(b),"keyup",this._editBoxKeyUp),this._off($(b),"input",this._editBoxTextChange),(_=$("#"+this.element[0].id+"_editBoxDiv")[0])&&_.parentNode.removeChild(_),this._svg&&(this.model.labelRenderingMode==ej.datavisualization.Diagram.LabelRenderingMode.Svg?this._hideShowSVGLabels(l,o,!0):(v=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0])&&("text"===o.type?y=$(v).find("#"+o.name+"_shape_lblbg")[0]:l&&(y=$(v).find("#"+o.name+"_"+l.name+"_lblbg")[0]),y&&(y.style.display="block")),o&&this._updateQuad(o))}t&&t.keyDownEventArgs&&27===t.keyDownEventArgs.keyCode&&this.element[0].focus(),delete this._newLabelCreated},_getSwimlane:function(t){var e,i;return t="string"==typeof t?this.nameTable[t]:t,(i=this.nameTable[t.parent])&&(e=this.nameTable[i.parent]),e},_setLabelEditing:function(t){var e;if(t)return t.readOnly?(t.mode=ej.datavisualization.Diagram.LabelEditMode.View,e=!1):(this._currentLabel&&(this._currentLabel.mode=ej.datavisualization.Diagram.LabelEditMode.View),t.mode=ej.datavisualization.Diagram.LabelEditMode.Edit,this._currentLabel=t,e=!0),e},_isInternalTool:function(t){return!!(t instanceof ej.datavisualization.Diagram.SelectTool||t instanceof ej.datavisualization.Diagram.ConnectionEditTool||t instanceof ej.datavisualization.Diagram.MoveTool||t instanceof ej.datavisualization.Diagram.ResizeTool||t instanceof ej.datavisualization.Diagram.LabelMoveTool||t instanceof ej.datavisualization.Diagram.LabelResizeTool||t instanceof ej.datavisualization.Diagram.LabelRotateTool||t instanceof ej.datavisualization.Diagram.PhaseTool||t instanceof ej.datavisualization.Diagram.RotateTool||t instanceof ej.datavisualization.Diagram.PanTool&&this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan)},_updateNodeMargin:function(t){var e,i,a,n,o,s,r;if(""!=t.parent&&((e=this.nameTable[t.parent])&&e.container&&"canvas"==e.container.type)){var l=ej.datavisualization.Diagram.Util.bounds(e),d=ej.datavisualization.Diagram.Util.bounds(t),h=ej.datavisualization.Diagram.Geometry.rect([d.topLeft,d.topRight,d.bottomRight,d.bottomLeft]);t.marginLeft=h.x-(l.x+e.paddingLeft),i=l.x+e.width-(h.x+h.width)-e.paddingRight,t.marginRight=i<0?0:i,t.marginTop=h.y-(l.y+e.paddingTop),a=l.y+e.height-(h.y+h.height)-e.paddingBottom,t.marginBottom=a<0?0:a,e.isLane&&(n=0,o=0,"horizontal"===e.orientation?(n=50,o=0):(n=0,o=50),t.marginLeft=t.marginLeft>=n?t.marginLeft:n,t.marginTop=t.marginTop>=o?t.marginTop:o)}if(("pseudoGroup"==t.type||"multipleSelection"==t.name)&&t.children.length>0)for(r=0;r<t.children.length;r++)(s=this.nameTable[this._getChild(t.children[r])])&&this._updateNodeMargin(s)},_raisePropertyChange:function(t){t&&(this._isSizingCommand?t.cause=ej.datavisualization.Diagram.ActionType.Size:this._isUndo?t.cause=ej.datavisualization.Diagram.ActionType.HistoryChange:this._isTouchedEvent&&(t.cause=ej.datavisualization.Diagram.ActionType.Touch),this._raiseEvent("propertyChange",t))},_updateAdjacentEdges:function(t,e){var i,a;if(t.inEdges&&t.inEdges.length>0)for(i=0,a=t.inEdges.length;i<a;i++)e[t.inEdges[i]]=this.nameTable[t.inEdges[i]];if(t.outEdges&&t.outEdges.length>0)for(i=0,a=t.outEdges.length;i<a;i++)e[t.outEdges[i]]=this.nameTable[t.outEdges[i]]},_translate:function(t,e,i,a,n,o){var s,r,l,d;if(!e&&!i)return!1;if(t.segments)ej.datavisualization.Diagram.Util._translateLine(t,e,i,t),this._dock(t,a),ej.datavisualization.Diagram.Util.updateBridging(t,this),this._updateConnectorBridging(t);else{if(o||(s=!0),o=o||{},this._updateAdjacentEdges(t,o),t.offsetX+=e,t.offsetY+=i,this._parentNode||"phase"==this.activeTool.name||(this._parentNode=t),("group"===t._type||"pseudoGroup"===t.type)&&!n){for(r=this._getChildren(t.children),l=0;l<r.length;l++)(d=a[this._getChild(r[l])])&&(this._translate(d,e,i,a,undefined,o),d.parent&&d.parent!=t.name&&"pseudoGroup"!=t.type&&ej.datavisualization.Diagram.Util._updateGroupBounds(a[d.parent],this));"group"!=t.type&&t.container&&ej.datavisualization.Diagram.Util._updateGroupBounds(t,this),this._isUndo||this._updateNodeFromGraph(t)}if(t!=this.activeTool.helper&&(this.nameTable[t.name]&&this._updateQuad(t),ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(t,e,i,null,this),this._isUndo||this._updateNodeFromGraph(t)),this._parentNode==t&&delete this._parentNode,s&&!this._preventDocking&&t!=this.activeTool.helper&&!this._disableSegmentChange)for(l in o)(d=this.nameTable[l])&&((t.isSwimlane||("pseudoGroup"==t.type||"group"==t.type)&&!this._containsChild(t,d))&&ej.datavisualization.Diagram.Util._translateLine(d,e,i,d),this._dock(d,this.nameTable),this._isLayoutRoute&&this._routeEdge(d),d.annotation&&ej.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(d,this))}},_containsChild:function(t,e){var i,a,n;if(t.children&&t.children.length>0)for(i=this._getChildren(t.children),a=0;a<i.length;a++){if(this._collectionContains(e.name,i))return!0;(n=this._getChild(i[a]))&&n.children&&this._containsChild(n,e)}},_translatePort:function(t,e,i,a){e.offset.x=e.offset.x+i/t.width,e.offset.y=e.offset.y+a/t.height,ej.datavisualization.Diagram.DiagramContext.updatePort(t,e,this);this._adornerSvg;this._updateAssociatedConnectorEnds(t,this.nameTable,!0)},_translateLabel:function(t,e,i,a){var n,o=!1;t&&t.segments&&"segmentpath"===e.relativeMode&&ej.datavisualization.Diagram.Util.isAllowDragLimit(t)&&(o=!0),o||(n=$.extend(!0,{},e),e.margin.left+=i,e.margin.top+=a,e.margin.right-=i,e.margin.bottom-=a,"center"==e.horizontalAlignment&&(e.margin.right=0),"center"==e.verticalAlignment&&(e.margin.bottom=0),ej.datavisualization.Diagram.DiagramContext.updateLabel(t,e,this),this._comparePropertyValues(t,"labels",n))},translateLabel:function(t,e,i,a){var n,o;t&&(t.segments&&"segmentpath"===e.relativeMode&&!ej.datavisualization.Diagram.Util.isAllowDragLimit(t)?(n=$.extend(!0,{},e),e.margin.left+=i,e.margin.top+=a,e.margin.right-=i,e.margin.bottom-=a,"center"==e.horizontalAlignment&&(e.margin.right=0),"center"==e.verticalAlignment&&(e.margin.bottom=0),ej.datavisualization.Diagram.DiagramContext.updateLabel(t,e,this),this._comparePropertyValues(t,"labels",n)):(o=ej.datavisualization.Diagram.Util.bounds(t),e.offset.x+=i/o.width,e.offset.y+=a/o.height,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,e,this)))},_rotate:function(t,e,i){var a,n,o,s,r,l,d;if(!t.segments&&e){if(t.rotateAngle+=e,t.rotateAngle%=360,t.rotateAngle<0&&(t.rotateAngle+=360),"group"===t._type||"pseudoGroup"===t.type){for(a=ej.Matrix.identity(),ej.Matrix.rotate(a,e,t.offsetX,t.offsetY),s=this._getChildren(t.children),l=0;l<s.length;l++)(r=i[s[l]])&&(r.segments?(r.sourceNode||this._setEndPoint(r,ej.Matrix.transform(a,r.sourcePoint),!1),r.targetNode||this._setEndPoint(r,ej.Matrix.transform(a,r.targetPoint),!0)):(this._rotate(r,e,i),n=r.offsetX,o=r.offsetY,d=ej.Matrix.transform(a,ej.datavisualization.Diagram.Point(n,o)),this._translate(r,d.x-n,d.y-o,i),this._updateAssociatedConnectorEnds(r,i)),r.parent&&r.parent!=t.name&&"pseudoGroup"!=t.type&&ej.datavisualization.Diagram.Util._updateGroupBounds(i[r.parent],this));ej.datavisualization.Diagram.Util._updateGroupBounds(t,this)}t.parent&&this._updateParentBounds(t.parent),t!=this.activeTool.helper&&this._updateQuad(t),this._updateAssociatedConnectorEnds(t,i)}},_raiseOffsetPropertyChange:function(t,e,i,a){t&&!t.segments?(e=e||0,i=i||0,e!=t.offsetX&&this._comparePropertyValues(t,"offsetX",{offsetX:e},a),i!=t.offsetY&&this._comparePropertyValues(t,"offsetY",{offsetY:i},a)):(e=e||0,i=i||0,this._comparePropertyValues(t,"sourcePoint",{sourcePoint:{x:t.sourcePoint.x+e,y:t.sourcePoint.y+i}},a),this._comparePropertyValues(t,"targetPoint",{targetPoint:{x:t.targetPoint.x+e,y:t.targetPoint.y+i}},a))},_raiseSizePropertyChange:function(t,e,i,a){if(t&&i&&e){var n=t.height*i,o=t.width*e;n!=t.height&&(this._comparePropertyValues(t,"height",{height:n},a),this._comparePropertyValues(t,"offsetY",{offsetY:t.offsetY+(n-t.height)},a)),o!=t.width&&(this._comparePropertyValues(t,"width",{width:o},a),this._comparePropertyValues(t,"offsetX",{offsetX:t.offsetX+(o-t.width)/2},a))}},scale:function(t,e,i,a,n,o,s){var r,l,d,h,g,c,u,m,p,f,_,v;if(e&&1!=e||i&&1!=i||t.isPhase)if(t.container)switch(t.container.type){case"canvas":u={},f=ej.Matrix.identity(),ej.Matrix.rotate(f,-t.rotateAngle,a.x,a.y),ej.Matrix.scale(f,e,i,a.x,a.y),ej.Matrix.rotate(f,t.rotateAngle,a.x,a.y),y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),b=t.width*e,x=t.height*i,s&&(t.minHeight=x,t.minWidth=b),u.width=b,u.height=x,u&&u.width>1&&(m=t.offsetX-t.width/2,t.width!=u.width&&(t._scaled=!0),t.width=u.width,t.offsetX=t._isBpmn?y.x:m+t.width/2),u&&u.height>1&&(p=t.offsetY-t.height/2,t.height!=u.height&&(t._scaled=!0),t.height=u.height,t.offsetY=t._isBpmn?y.y:p+t.height/2);break;case"stack":f=ej.Matrix.identity(),ej.Matrix.rotate(f,-t.rotateAngle,a.x,a.y),ej.Matrix.scale(f,e,i,a.x,a.y),ej.Matrix.rotate(f,t.rotateAngle,a.x,a.y),y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),_=0,v=0,0!=e&&(_=t.marginLeft,v=t.marginRight),b=t.width*e-(_+v),x=t.height*i-(t.marginTop+t.marginBottom),u={height:t.height,width:t.width},this._resizeStack&&(t.width=b,t.height=x,t.offsetX=y.x,t.offsetY=y.y)}else if(f=ej.Matrix.identity(),t.segments){for(ej.Matrix.scale(f,e,i,a.x,a.y),h=0;h<t.segments.length;h++){for(g=t.segments[h],c=0;c<g.points.length;c++)g.points[c]=ej.Matrix.transform(f,g.points[c]),0!=h||0!=c||t.sourceNode||(g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],ej.datavisualization.Diagram.Util._setLineEndPoint(t,ej.Matrix.transform(f,t.sourcePoint),!1)),h!=t.segments.length-1||c!=g.points.length-1||t.targetNode||(g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],t.targetPoint=g._endPoint);g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],"orthogonal"==g.type?g.length||0===g.length?g.length=g._length=ej.datavisualization.Diagram.Geometry.distance(g._startPoint,g._endPoint):ej.datavisualization.Diagram.Util._addOrthogonalPoints(g,t.segments[h-1],t.segments[h+1],t.sourcePoint,t.targetPoint):(g.point&&(g.point=g._endPoint),g._point=g._endPoint)}(t.sourceNode||t.targetNode)&&this._dock(t,n)}else{if("group"!==t._type&&"pseudoGroup"!==t.type||this._scalePseudoGroup){ej.Matrix.rotate(f,-t.rotateAngle,a.x,a.y),ej.Matrix.scale(f,e,i,a.x,a.y),ej.Matrix.rotate(f,t.rotateAngle,a.x,a.y);var y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),b=t.width*e,x=t.height*i;if(0!=t.maxWidth&&(b=Math.min(t.maxWidth,b)),0!=t.minWidth&&(b=Math.max(t.minWidth,b)),0!=t.maxHeight&&(x=Math.min(t.maxHeight,x)),0!=t.minHeight&&(x=Math.max(t.minHeight,x)),b>0&&(b!=t.width&&(t._scaled=!0),b!=t.maxWidth&&b!=t.minWidth))for(t.width=b,t.offsetX=y.x,h=0;h<t.labels.length;h++)t.labels[h].width=t.labels[h].width*e;if(x>0&&(x!=t.height&&(t._scaled=!0),x!=t.maxHeight&&x!=t.minHeight))for(t.height=x,t.offsetY=y.y,h=0;h<t.labels.length;h++)t.labels[h].height=t.labels[h].height*i}else if("bpmn"!=t.type||t.width*e>=1&&t.height*i>=1){for(r={x:t.offsetX,y:t.offsetY},l=this._getChildren(t.children),h=0;h<l.length;h++)(d=n[l[h]])&&("bpmn"!=t.type||ej.datavisualization.Diagram.Util.canResize(d))&&(this.scale(d,e,i,a,n),d.parent&&d.parent!=t.name&&"pseudoGroup"!=t.type&&ej.datavisualization.Diagram.Util._updateGroupBounds(n[d.parent],this));if("bpmn"==t.type&&ej.datavisualization.Diagram.Util._updateBPMNProperties(t,this,n,!0),t.children.length<=0){ej.Matrix.rotate(f,-t.rotateAngle,a.x,a.y),ej.Matrix.scale(f,e,i,a.x,a.y),ej.Matrix.rotate(f,t.rotateAngle,a.x,a.y);y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),b=t.width?t.width*e:t._width*e,x=t.height?t.height*i:t._height*i;b>1&&(t.width?(b!=t.width&&(t._scaled=!0),t.width=b,t.offsetX=y.x):(b!=t._width&&(t._scaled=!0),t.maxWidth=t.parent&&n[t.parent].width!=t.maxWidth?n[t.parent].width:b,t.offsetX=y.x-(t._width*e-t._width)/2)),x>1&&(t.height?(x!=t.height&&(t._scaled=!0),t.height=x,t.offsetY=y.y):(x!=t._height&&(t._scaled=!0),t.maxHeight=t.parent&&n[t.parent].height>x?n[t.parent].height:x,t.offsetY=y.y-(t._height*i-t._height)/2))}"pseudoGroup"===t.type?(this._scalePseudoGroup=!0,this.scale(t,e,i,a,n),delete this._scalePseudoGroup):ej.datavisualization.Diagram.Util._updateGroupBounds(t,this),t!=this.activeTool.helper&&ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(t,1/e,1/i,r,this)}t.parent&&this._updateParentBounds(t.parent),ej.datavisualization.Diagram.Util._updateBPMNProperties(t,this,n,!0),"resize"==this.activeTool.name&&this.activeTool.inAction&&this.selectionList[0]&&"pseudoGroup"!=this.selectionList[0].type&&"group"!=this.selectionList[0].type||this._updateAssociatedConnectorEnds(t,n),t!=this.activeTool.helper&&this._updateQuad(t)}},_updateParentBounds:function(t){(t=this.nameTable[this._getChild(t)])&&"bpmn"!=t.type&&!t.container&&(ej.datavisualization.Diagram.Util._updateGroupBounds(t,this),ej.datavisualization.Diagram.DiagramContext.update(t,this),t.parent&&this._updateParentBounds(t.parent))},_dock:function(t,e,i){if(!(this._preventDocking||this._disableSegmentChange||this._layoutInAction&&this._isAnimating)){var a=t.segments.length,n=t.segments[0].points.length,o=t.segments[t.segments.length-1].points.length;this._preventSegmentAdjusting&&(t._preventSegmentAdjusting=!0),ej.datavisualization.Diagram.Util.dock(t,e,this),delete t._preventSegmentAdjusting,a!=t.segments.length&&this._svg&&(ej.datavisualization.Diagram.Util._updateConnectorSegments(t,t.sourcePort,t.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(t,this)),this.selectionList[0]==t&&(i||n!=t.segments[0].points.length||o!=t.segments[t.segments.length-1].points.length)&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom),this._updateQuad(t)}},_updateChildAdjacentConnectors:function(t,e){var i,a,n=this._getChildTable(t,{});for(i in n)(a=this.nameTable[i])&&a.segments&&-1==t.children.indexOf(i)&&(e||(a._staticLength=!0),this._dock(a,this.nameTable),delete a._staticLength,ej.datavisualization.Diagram.DiagramContext.update(a,this))},_setEndPoint:function(t,e,i){ej.datavisualization.Diagram.Util._setLineEndPoint(t,e,i),this._updateQuad(t)},_updateAssociatedConnectorEnds:function(t,e,i){var a,n,o,s,r,l,d;if(!t.segments&&(t.inEdges.length||t.outEdges.length)){for(s=this._isNodeToNodeConnection(t),r=t,"bpmn"==t.type&&"group"==t._type&&(r="object"==typeof t.children[0]?t.children[0]:this.nameTable[t.children[0]]),s&&(l=ej.datavisualization.Diagram.Util._findSegmentPoints(r)),d={},this._parentNode&&(d=this._getChildTable(this._parentNode,{})),a=0,n=t.inEdges.length;a<n;a++)!(o=e[t.inEdges[a]])||this._parentNode&&d[o.sourceNode]||(o.targetPadding?delete r._segmentPoints:r._segmentPoints=l,this._dock(o,e),i&&ej.datavisualization.Diagram.DiagramContext.update(o,this));for(a=0,n=t.outEdges.length;a<n;a++)!(o=e[t.outEdges[a]])||this._parentNode&&d[o.targetNode]||(o.sourcePadding?delete r._segmentPoints:r._segmentPoints=l,this._dock(o,e),i&&ej.datavisualization.Diagram.DiagramContext.update(o,this));delete r._segmentPoints}},_isNodeToNodeConnection:function(t){var e,i;if(t.inEdges.length)for(e=0,i=t.inEdges.length;e<i;e++)if(this.nameTable[t.inEdges[e]]&&!this.nameTable[t.inEdges[e]].targetPort&&("bpmn"!=t.type||"orthogonal"!=this.nameTable[t.inEdges[e]].segments[0].type))return!0;if(t.outEdges.length)for(e=0,i=t.outEdges.length;e<i;e++)if(this.nameTable[t.outEdges[e]]&&!this.nameTable[t.outEdges[e]].sourcePort&&("bpmn"!=t.type||"orthogonal"!=this.nameTable[t.outEdges[e]].segments[this.nameTable[t.outEdges[e]].segments.length-1].type))return!0},_updateChildBounds:function(t,e){var i,a,n,o,s,r,l;0==t.width&&0==t.height?(i=t.offsetX,a=t.offsetY,ej.datavisualization.Diagram.Util._updateGroupBounds(t,this),this._translate(t,i-t.offsetX,a-t.offsetY,e)):(i=t.offsetX,a=t.offsetY,n=ej.datavisualization.Diagram.Util._getChildrenBounds(t,this),t.offsetX=n.x+n.width*t.pivot.x,t.offsetY=n.y+n.height*t.pivot.y,o=i-t.offsetX,s=i-t.offsetY,this._translate(t,o,s,e),r=t.width/n.width,l=t.height/n.height,this.scale(t,r,l,t.pivot,e),this._translate(t,i-t.offsetX,a-t.offsetY,e))},_isLastChildOfParent:function(t){var e,i,a=this.nameTable[t.parent];if(a.children)for(i=0;i<a.children.length;i++)if((e=this.nameTable[this._getChild(a.children[i])])&&e.name==t.name&&i==a.children.length-1)return!0;return!1},_updateQuad:function(t){var e,i,a;this._spatialSearch&&this.nameTable[t.name]&&(this.getObjectType(t),e=!1,(t.isPhase||t.isLane||t._isHeader||t.isLaneStack||t.isPhaseStack||t._isInternalShape||"pseudoGroup"==t.type)&&(e=!0),t.parent&&this.nameTable[t.parent]&&(((i=this.nameTable[t.parent]).isPhaseStack||i.isSwimlane)&&(e=!0),"bpmn"!=i.type&&this._isLastChildOfParent(t)&&this._updateQuad(i)),null!=this._selectedSymbol&&this._selectedSymbol.isLane&&t.isLane&&!t.parent&&(e=!1),this._disableUpdateQuad&&(e=!0),e||t._connectorType||(this._spatialSearch._isRouting=ej.datavisualization.Diagram.Util.canRouteDiagram(this),this._spatialSearch._isRouting&&(a=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),this._spatialSearch._viewPortWidth=a.width||1e3,this._spatialSearch._viewPortHeight=a.height||1e3),ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,t),this._spatialSearch._isRouting&&(delete this._spatialSearch._isRouting,delete this._spatialSearch._viewPortWidth,delete this._spatialSearch._viewPortHeight)))},_sliceDockLines:function(t){var e=$.extend({},t),i=null;for(var a in e)(i=this.nameTable[this._getChild(e[a])])&&i.segments&&(i.sourceNode||i.targetNode)&&t.pop(i.name)},_canExecute:function(){return(!this._isEditing||"delete"!=this._currentCommand&&"cut"!=this._currentCommand&&"focusToPreviousItem"!=this._currentCommand&&"undo"!=this._currentCommand&&"redo"!=this._currentCommand&&"focusToNextItem"!=this._currentCommand&&"selectFocusedItem"!=this._currentCommand&&"selectAll"!=this._currentCommand&&"copy"!=this._currentCommand&&"paste"!=this._currentCommand&&!this._currentCommand.match("nudge"))&&!("endEdit"==this._currentCommand&&!this._isEditing)},_setItemDraggable:function(t){var e=this,i=!1;this._canDragGlobally=!0,$(t).ejDraggable({clone:!0,helper:function(){var t,i,a,n;return this._selectedSymbol=null,this._isDragged=!1,(t=e._renderItemContainer("diagram_clone",document.body)).document.setAttribute("drag","true"),e.activeTool&&e.activeTool.selectedObject&&!e.activeTool.helper&&(i=$.extend(!0,{},e.activeTool.selectedObject),e._updateChildren(i),e.edgeTable={},e.edgeTable=e._getEdgeTable(i,e.edgeTable),this._updateSelectedItem(i,i.isSwimlane),this._selectedSymbol=i,this._isDragged=!1,this._targetId=e._id,ej.datavisualization.Diagram.Util.bounds(i),this.cursorAt={top:105,left:105},a=ej.datavisualization.Diagram.NodeType({offsetX:i.offsetX,offsetY:i.offsetY,width:100,height:100,shape:"path",opacity:.5,pathData:"M49.955,50.7915L1.74601,99L98.164,99zM1,1.83699L1,98.332L49.2477,50.0843zM99,1.74699L50.662,50.0845L99,98.422zM1.57701,1L49.9548,49.3773L98.332,1zM0,0L100,0L100,100L0,100z "},e),a=e._getNewNode(a),ej.datavisualization.Diagram.SvgContext.renderNode(a,t,null,!0,e)),n=document.getElementById("diagram_clone_paletteItem"),$(n).addClass("dragClone"),$(n).css("display","none"),$(n)},drag:function(t){var e,a,n,o,s,r,l=$(t.target).parents(".e-datavisualization-diagram");if(l.length){if(o=$("#"+l.attr("id")).ejDiagram("instance"),(this.model._isDragged||this.model._targetId!=o._id)&&this.model._selectedSymbol){this.model._isDragged||this.model._targetId==o._id?this.model._targetId!=o._id&&(o.edgeTable&&delete o.edgeTable,i=!1):((e=$("#"+this.model._targetId).ejDiagram("instance"))._delete(e.nameTable[this.model._selectedSymbol.name]),i=!1,r=(s=e._historyList.currentEntry).previous,s.object=r.undoObject.node,r.undoObject.childTable&&(s.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(s.edgeTable=r.undoObject.edgeTable),e.removeHistoryEntry(r)),this.model._isDragged=!0,o._selectedSymbol=this.model._selectedSymbol,o._isNodeEnters=!0;var d=o._selectedSymbol,h=o._currZoom,g=$("#"+o.element[0].id).offset(),c=o._isTouchEvent(t.event),u=((c?c.pageX:t.event.pageX)+o._hScrollOffset-g.left)/h,m=((c?c.pageY:t.event.pageY)+o._vScrollOffset-g.top)/h;if(d.segments?this.model._translate(d,u-(d.sourcePoint.x+d.targetPoint.x)/2*h,m-(d.sourcePoint.y+d.targetPoint.y)/2*h):this.model._translate(d,u-d.offsetX/h,m-d.offsetY/h),this.model._isDragged&&o.edgeTable&&o.nameTable[d.name]&&!i&&"pseudoGroup"!=d.type){for(a in o.edgeTable)o.nameTable[a]?((n=o.nameTable[a]).sourceNode=o.edgeTable[a].sourceNode,n.sourcePort=o.edgeTable[a].sourcePort,n.targetNode=o.edgeTable[a].targetNode,n.targetPort=o.edgeTable[a].targetPort):o.add(o.edgeTable[a]);o._clearSelection(!0),o._addSelection(o.nameTable[d.name],!0),i=!0}}this.helper.css("display","none")}else this.model._selectedSymbol&&((o=$("#"+this.model._targetId).ejDiagram("instance"))._delete(o.nameTable[this.model._selectedSymbol.name]),i=!1,this.model._isDragged||(r=(s=o._historyList.currentEntry).previous,s.object=r.undoObject.node,r.undoObject.childTable&&(s.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(s.edgeTable=r.undoObject.edgeTable),o.removeHistoryEntry(r)),this.helper.css("display","block"),this.model._isDragged=!0);$("html,body").css("cursor","no-drop")},dragStop:function(t){var e,i,a,n=$(t.target).parents(".e-datavisualization-diagram");n&&(e=$("#"+n.attr("id")).ejDiagram("instance"),this.model._isDragged&&this.model._targetId==e._id&&(a=(i=e._historyList.currentEntry).previous,i.undoObject.node=a.object,a.childTable&&(i.undoObject.childTable=a.childTable),a.edgeTable&&(i.undoObject.edgeTable=a.edgeTable),e.removeHistoryEntry(a)),e._selectedSymbol=null,delete e._isNodeEnters),$(this.helper).remove(),$("html,body").css("cursor","default")},_translate:function(t,e,i){if(t.segments)ej.datavisualization.Diagram.Util._translateLine(t,e,i,t);else if(t.offsetX+=e,t.offsetY+=i,"pseudoGroup"==t.type||"group"==t.type)for(var a=0;a<t.children.length;a++)this._translate(t.children[a],e,i)},_updateSelectedItem:function(t,i){var a,n;if("pseudoGroup"==t.type||"group"==t.type)for(a=0;a<t.children.length;a++)"string"==typeof t.children[a]&&(t.children[a]=e.nameTable[e._getChild(t.children[a])]),this._updateSelectedItem(t.children[a],i);if(!i)if(t.segments)t.sourceNode=t.targetNode=t.sourcePort=t.targetPort="";else{for(a=0;a<t.inEdges.length;a++)n=e.findNode(t.inEdges[a]),-1==e.model.selectedItems.children.indexOf(n)&&t.inEdges.splice(a,1);for(a=0;a<t.outEdges.length;a++)n=e.findNode(t.outEdges[a]),-1==e.model.selectedItems.children.indexOf(n)&&t.outEdges.splice(a,1)}}})},_renderItemContainer:function(t,e){var i=document.createElement("div"),a={width:100,height:100},n={id:t+"_paletteItem",draggable:"true",height:a.height+"px",width:a.width+"px",style:"padding: 4; height:"+(a.height+1)+"px;width:"+(a.width+1)+"px;-ms-touch-action: none;touch-action: none;"};return ej.datavisualization.Diagram.Util.attr(i,n),e.appendChild(i),this._setItemDraggable(i),this._renderAnchor(i,t,a)},_renderAnchor:function(t,e,i){var a=document.createElement("div"),n={id:e+"_anchor",height:i.height+"px",class:"e-anchor"};return ej.datavisualization.Diagram.Util.attr(a,n),t.appendChild(a),this._renderSvg(a,e,i)},_renderSvg:function(t,e,i){var a,n=document.createElement("div"),o={id:e+"_svgWrapper",class:"e-svg-container",style:"width:"+i.width+"px;height:"+i.height+"px;"};return ej.datavisualization.Diagram.Util.attr(n,o),o={id:e+"_svg",width:i.width,height:i.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},a=new ej.datavisualization.Diagram.Svg(o),n.appendChild(a.document),t.appendChild(n),a}}),ej.datavisualization.Diagram.Locale={},ej.datavisualization.Diagram.Locale.default={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"},ej.datavisualization.Diagram.Locale["en-US"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"},$.fn.pinchDiagram=function(t,e){var i=[],a=function(t,e){var i=e.pageX-t.pageX,a=e.pageY-t.pageY;return Math.sqrt(i*i+a*a)},n=function(t,e){t.pageX=e.pageX,t.pageY=e.pageY};this[0].addEventListener("touchstart",function(t){var e,a,n,o,s,r,l=t.touches;if(l.length>=2)for(e=0;e<l.length;e++){for(a=l[e],n=!1,o=0;o<i.length;o++)if(s=i[o],a.identifier===s.identifier){n=!0;break}n||(r=$.extend({},a),i.push(r))}t.preventDefault()},!1),this[0].addEventListener("touchend",function(t){for(var e,a,n,o,s=t.changedTouches,r=0;r<s.length;r++)for(e=s[r],a=0;a<i.length;a++)(n=i[a]).identifier===e.identifier&&(o=i.indexOf(n),i.splice(o,1));t.preventDefault()},!1),this[0].addEventListener("touchmove",function(t){var o,s,r;if(t.preventDefault(),(o=t.touches).length>=2){var l=o[0],d=o[1],h=i[0],g=i[1];s=a(l,d)/a(h,g),r=e._mousePosition(t,!1),ej.datavisualization.Diagram.ZoomUtil.zoomPan(e,s,0,0,r,!0,!0),n(h,l),n(g,d)}},!1)}})(jQuery,Syncfusion),function(t,e){"use strict";e.MatrixTypes={Identity:0,Translation:1,Scaling:2,Unknown:4},e.MatrixDefaults={m11:1,m12:0,m21:0,m22:1,offsetX:0,offsetY:0,type:e.MatrixTypes.Identity},e.Matrix={identity:function(){return t.extend(!0,{},e.MatrixDefaults)},multiply:function(t,i){var a,n,o,s,r=t.type,l=i.type;if(l!=e.MatrixTypes.Identity){if(r==e.MatrixTypes.Identity)return t.m11=i.m11,t.m12=i.m12,t.m21=i.m21,t.m22=i.m22,t.offsetX=i.offsetX,t.offsetY=i.offsetY,void(t.type=i.type);if(l==e.MatrixTypes.Translation)return t.offsetX+=i.offsetX,t.offsetY+=i.offsetY,void(r!=e.MatrixTypes.Unknown&&(t.type|=e.MatrixTypes.Translation));if(r!=e.MatrixTypes.Translation){switch(a=r<<4|l){case 34:return t.m11*=i.m11,void(t.m22*=i.m22);case 35:return t.m11*=i.m11,t.m22*=i.m22,t.offsetX=i.offsetX,t.offsetY=i.offsetY,void(t.type=e.MatrixTypes.Translation|e.MatrixTypes.Scaling);case 36:break;default:switch(a){case 50:return t.m11*=i.m11,t.m22*=i.m22,t.offsetX*=i.m11,void(t.offsetY*=i.m22);case 51:return t.m11*=i.m11,t.m22*=i.m22,t.offsetX=i.m11*t.offsetX+i.offsetX,void(t.offsetY=i.m22*t.offsetY+i.offsetY);case 52:break;default:switch(a){case 66:case 67:case 68:break;default:return}}}return n=this.identity(),this._setMatrix(n,t.m11*i.m11+t.m12*i.m21,t.m11*i.m12+t.m12*i.m22,t.m21*i.m11+t.m22*i.m21,t.m21*i.m12+t.m22*i.m22,t.offsetX*i.m11+t.offsetY*i.m21+i.offsetX,t.offsetX*i.m12+t.offsetY*i.m22+i.offsetY),n.m21||n.m12?n.type=e.MatrixTypes.Unknown:((n.m11&&1!=n.m11||n.m22&&1!=n.m22)&&(n.type=e.MatrixTypes.Scaling),(n.offsetX||n.offsetY)&&(n.type|=e.MatrixTypes.Translation),(n.type&(e.MatrixTypes.Translation|e.MatrixTypes.Scaling))==e.MatrixTypes.Identity&&(n.type=e.MatrixTypes.Identity)),t.m11=n.m11,t.m12=n.m12,t.m21=n.m21,t.m22=n.m22,t.offsetX=n.offsetX,t.offsetY=n.offsetY,void(t.type=n.type)}if(o=t.offsetX,s=t.offsetY,t.m11=i.m11,t.m12=i.m12,t.m21=i.m21,t.m22=i.m22,t.offsetX=i.offsetX,t.offsetY=i.offsetY,t.type=i.type,t.offsetX=o*i.m11+s*i.m21+i.offsetX,t.offsetY=o*i.m12+s*i.m22+i.offsetY,l==e.MatrixTypes.Unknown)return void(t.type=e.MatrixTypes.Unknown);t.type=e.MatrixTypes.Translation|e.MatrixTypes.Scaling}},transform:function(t,e){var i=this._multiplyPoint(t,e.x,e.y);return{x:Math.round(100*i.x)/100,y:Math.round(100*i.y)/100}},rotate:function(t,e,i,a){e%=360,this.multiply(t,this._createRotationRadians(.017453292519943295*e,i||0,a||0))},scale:function(t,e,i,a,n){this.multiply(t,this._createScaling(e,i,a||0,n||0))},translate:function(t,i,a){if(t.type&e.MatrixTypes.Identity)this._setMatrix(t,1,0,0,1,i,a,e.MatrixTypes.Translation);else{if(t.type&e.MatrixTypes.Unknown)return t.offsetX+=i,void(t.offsetY+=a);t.offsetX+=i,t.offsetY+=a,t.type|=e.MatrixTypes.Translation}},_createScaling:function(t,i,a,n){var o=this.identity();return this._setMatrix(o,t,0,0,i,a-t*a,n-i*n,a||n?e.MatrixTypes.Scaling|e.MatrixTypes.Translation:e.MatrixTypes.Scaling),o},_createRotationRadians:function(t,i,a){var n=this.identity(),o=Math.sin(t),s=Math.cos(t),r=i*(1-s)+a*o,l=a*(1-s)-i*o;return this._setMatrix(n,s,o,-o,s,r,l,e.MatrixTypes.Unknown),n},_multiplyPoint:function(t,i,a){switch(t.type){case e.MatrixTypes.Identity:break;case e.MatrixTypes.Translation:i+=t.offsetX,a+=t.offsetY;break;case e.MatrixTypes.Scaling:i*=t.m11,a*=t.m22;break;case e.MatrixTypes.Translation|e.MatrixTypes.Scaling:i*=t.m11,i+=t.offsetX,a*=t.m22,a+=t.offsetY;break;default:var n=a*t.m21+t.offsetX,o=i*t.m12+t.offsetY;i*=t.m11,i+=n,a*=t.m22,a+=o}return{x:i,y:a}},_setMatrix:function(t,i,a,n,o,s,r,l){t.m11=i,t.m12=a,t.m21=n,t.m22=o,t.offsetX=s,t.offsetY=r,t.type=l||e.MatrixTypes.Identity}}}(jQuery,Syncfusion),function(t,e){"use strict";e.datavisualization.Diagram.HitTesting={_getResizeHandleCenter:function(t,i,a){var n,o;switch(a||(a=1),n=this.bounds(t),o=e.datavisualization.Diagram.Point(0,0),i){case"topleft":o=n.topLeft;break;case"topcenter":o=n.top;break;case"topright":o=n.topRight;break;case"middleleft":o=n.left;break;case"middleright":o=n.right;break;case"bottomleft":o=n.bottomLeft;break;case"bottomcenter":o=n.bottom;break;case"bottomright":o=n.bottomRight;break;case"pivot":o=e.datavisualization.Diagram.Point(t.offsetX,t.offsetY);break;case"rotate":var s=20/a,r=e.datavisualization.Diagram.Point(t.offsetX,t.offsetY-t.height*t.pivot.y-10-s),l=e.Matrix.identity();e.Matrix.rotate(l,t.rotateAngle,t.offsetX,t.offsetY),o=e.Matrix.transform(l,r)}return o},findResizeHandleAtPoint:function(t,i){var a,n,o,s,r=null;if(t)for(o=0,s=(n=["topleft","topcenter","topright","middleleft","middleright","bottomleft","bottomcenter","bottomright"]).length;o<s;o++)if((a=this._getResizeHandleCenter(t,n[o]))!==e.datavisualization.Diagram.Point(0,0)&&e.datavisualization.Diagram.Geometry.checkPointOnCircle(i,e.datavisualization.Diagram.Point(a.x,a.y),7)){r=n[o];break}return r},findRotationHandleAtPoint:function(t,i,a){var n=this._getResizeHandleCenter(t,"rotate",a);return!!e.datavisualization.Diagram.Geometry.checkPointOnCircle(i,e.datavisualization.Diagram.Point(n.x,n.y),10)},findPivotHandleAtPoint:function(t,i){var a=this._getResizeHandleCenter(t,"pivot");return!!e.datavisualization.Diagram.Geometry.checkPointOnCircle(i,e.datavisualization.Diagram.Point(a.x,a.y),7)},findEndPointHandleAtPoint:function(t,i){var a,n,o,s,r=null;return t&&(o=(n=t.line.points)[n.length-1],(a=e.datavisualization.Diagram.Geometry.checkPointOnCircle(i,e.datavisualization.Diagram.Point(o.x,o.y),7))&&(r="targetEndPoint"),a||(o=n[0],(a=e.datavisualization.Diagram.Geometry.checkPointOnCircle(i,e.datavisualization.Diagram.Point(o.x,o.y),7))&&(r="sourceEndPoint")),a||"bezier"!==t.line.type||(o=t.line._point1,(a=e.datavisualization.Diagram.Geometry.checkPointOnCircle(i,e.datavisualization.Diagram.Point(o.x,o.y),7))&&(r="bezierpoint1"),a||(s=t.line._point2,(a=e.datavisualization.Diagram.Geometry.checkPointOnCircle(i,e.datavisualization.Diagram.Point(s.x,s.y),7))&&(r="bezierpoint2")))),r}},e.datavisualization.Diagram.LayoutUtil={expandSubTree:function(t,i,a,n,o,s,r){var l,d,h,g;t._isAnimating||(l=t.model.scrollSettings.currentZoom,d=i.offsetX*l-t.model.scrollSettings.viewPortWidth/2-t.model.scrollSettings.horizontalOffset,(i.offsetY*l<t.model.scrollSettings.verticalOffset||i.offsetY*l>t.model.scrollSettings.verticalOffset+t.model.scrollSettings.viewPortHeight-3*i.height*l)&&t.update({scrollSettings:{verticalOffset:i.offsetY-t.model.scrollSettings.viewPortHeight/2}}),h=0,0!=d&&s?(t._preventScrollerUpdate=!0,g=setInterval(function(){h<4&&t.update({scrollSettings:{horizontalOffset:t.model.scrollSettings.horizontalOffset+d/4}}),5==++h&&(clearInterval(g),delete t._preventScrollerUpdate,!1===r&&i.isExpanded||!i.outEdges.length?e.datavisualization.Diagram.ScrollUtil._setScrollContentSize(t):e.datavisualization.Diagram.LayoutUtil.expand(t,i,a,n,o))},25)):(delete t._preventScrollerUpdate,!1===r&&i.isExpanded||!i.outEdges.length?e.datavisualization.Diagram.ScrollUtil._setScrollContentSize(t):this.expand(t,i,a,n,o)))},_updateVisiblity:function(t,i,a){for(var n,o,s=0;s<i.outEdges.length;s++)n=i.outEdges[s],n=t.findNode(n),o=t.findNode(n.targetNode),n.opacity=o.opacity=a/100,e.datavisualization.Diagram.DiagramContext.updateNodeStyle(o,t),e.datavisualization.Diagram.DiagramContext.updateConnectorStyle(n,t),o.isExpanded&&o.outEdges.length&&this._updateVisiblity(t,o,a)},expand:function(i,a,n,o,s){var r,l,d,h,g,c,u,m,p;if(void 0===n&&(n=a.name),r=i.model.layout.fixedNode,i.model.layout.fixedNode=n,(l=i.selectionList[0]?i.selectionList[0].name:"")&&i._clearSelection(!0),o){if(!i._isAnimating){if(a._updateExpander=!0,i._updateEdgeCollection(),a.isExpanded?(i._collapseChildren(a),a.isExpanded=!1):(i._expandChildren(a),a.isExpanded=!0),i._isAnimating=!0,d=e.datavisualization.Diagram.Layout.doLayout(i,!1),h=0,d.length)t(".ej-d-connector").attr("opacity",0),t(".ej-d-icon-template").attr("opacity",0),i._layoutInAction=!0,g=setInterval(function(){var a,o,r;if(++h<5)for(a=0;a<d.length;a++)o=i.nameTable[d[a].object],i._disableSegmentChange=!0,i.updateNode(o.name,{offsetX:o.offsetX+d[a].diff/4,offsetY:o.offsetY+d[a].diffy/4}),i._disableSegmentChange=!1;if(5==h){if(clearInterval(g),delete i._layoutInAction,r=i._internalLayout)for(h=0;h<r._firstLevelNodes.length;h++)e.datavisualization.Diagram.HierarchicalLayout._updateConnectors(r,r._firstLevelNodes[h],1);delete i._internalLayout,t(".ej-d-connector").attr("opacity",1),t(".ej-d-icon-template").attr("opacity",1),(l||s)&&i._addSelection(i.findNode(l||n),!s),i._isAnimating=!1,delete i._preventScrollerUpdate,e.datavisualization.Diagram.ScrollUtil._setScrollContentSize(i)}},50);else{if(c=i._internalLayout)for(h=0;h<c._firstLevelNodes.length;h++)e.datavisualization.Diagram.HierarchicalLayout._updateConnectors(c,c._firstLevelNodes[h],1);(l||s)&&i._addSelection(i.findNode(l||n),!s),i._isAnimating=!1,delete i._internalLayout}u=0,m=this,a.isExpanded&&(m._updateVisiblity(i,a,0),p=setInterval(function(){a.isExpanded&&(u<=100&&m._updateVisiblity(i,a,u),120==u&&clearInterval(p),u+=5)},25)),e.datavisualization.Diagram.PageUtil._updatePageSize(i)}}else i.layout();i.model.layout.fixedNode=r}},e.datavisualization.Diagram.Util={convertPathToArray:function(t){var e,i,a,n,o=[],s=this.parsePathData(t);if(s.length>0)for(e=0;e<s.length;e++)switch((a=(i=s[e])[0]).toLowerCase()){case"m":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x:i[n],y:i[n+1]}),n+=1,"m"===a?a="l":"M"===a&&(a="L");break;case"l":case"t":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x:i[n],y:i[n+1]}),n+=1;break;case"h":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x:i[n]});break;case"v":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,y:i[n]});break;case"z":o.push({pathSegTypeAsLetter:a});break;case"c":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x1:i[n],y1:i[n+1],x2:i[n+2],y2:i[n+3],x:i[n+4],y:i[n+5]}),n+=5;break;case"s":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x2:i[n],y2:i[n+1],x:i[n+2],y:i[n+3]}),n+=3;break;case"q":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x1:i[n],y1:i[n+1],x:i[n+2],y:i[n+3]}),n+=3;break;case"a":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,r1:i[n],r2:i[n+1],angle:i[n+2],largeArcFlag:this.parseArcFlag(i[n+3]),sweepFlag:this.parseArcFlag(i[n+4]),x:i[n+5],y:i[n+6]}),n+=6}return o},_getImageAlignment:function(t){if(t)switch(t.toLowerCase()){case"xminymin":return"xMinYMin";case"xminymid":return"xMinYMid";case"xminymax":return"xMinYMax";case"xmidymin":return"xMidYMin";case"xmidymid":return"xMidYMid";case"xmidymax":return"xMidYMax";case"xmaxymin":return"xMaxYMin";case"xmaxymid":return"xMaxYMid";case"xmaxymax":return"xMaxYMax";case"none":return"none"}return"none"},parseArcFlag:function(t){var e;return"0"===t||0===t?e=!1:("1"===t||1===t)&&(e=!0),e},parsePathData:function(t){var e,i,a,n=/([a-z]+)|([+-]?(?:\d+\.?\d*|\.\d+))/gi,o=[];for(n.lastIndex=0,a=!1;e=n.exec(t);)"e"===e[1]?("",a=!0):e[1]?("zm"===e[1].toLowerCase()?(i&&o.push(i),o.push(["Z"]),i=[e[1].substring(1,2)]):(i&&o.push(i),i=[e[1]]),a=!1):(i||(i=[]),a||i.push(Number(e[2])),a=!1);return i&&o.push(i),o},pathSegArrayAsString:function(t){for(var e,i="",a=0;a<t.length;a++)e=t[a],i+=0===a?this.pathToString(e):" "+this.pathToString(e);return i},canEnablePointerEvents:function(t,i){var a,n=t;if(i)for(;n;){if(!(a=n.segments?n.constraints&e.datavisualization.Diagram.ConnectorConstraints.PointerEvents:n.constraints&e.datavisualization.Diagram.NodeConstraints.PointerEvents))return a;n="string"==typeof n.parent?i.nameTable[n.parent]:n}return!0},isClassifier:function(e){var i="string"==typeof e.target.className?e.target.className:e.target.className.baseVal;return!!(t(e.target).hasClass("ej-d-classifier")||i.indexOf("ej-d-classifier")>-1)},pathToString:function(t){var e;switch(t.pathSegTypeAsLetter){case"Z":case"z":e=t.pathSegTypeAsLetter;break;case"M":case"m":case"L":case"l":e=t.pathSegTypeAsLetter+" "+t.x+" "+t.y;break;case"C":case"c":e=t.pathSegTypeAsLetter+" "+t.x1+" "+t.y1+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"Q":case"q":e=t.pathSegTypeAsLetter+" "+t.x1+" "+t.y1+" "+t.x+" "+t.y;break;case"A":case"a":e=t.pathSegTypeAsLetter+" "+t.r1+" "+t.r2+" "+t.angle+" "+(t.largeArcFlag?"1":"0")+" "+(t.sweepFlag?"1":"0")+" "+t.x+" "+t.y;break;case"H":case"h":e=t.pathSegTypeAsLetter+" "+t.x;break;case"V":case"v":e=t.pathSegTypeAsLetter+" "+t.y;break;case"S":case"s":e=t.pathSegTypeAsLetter+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y;break;case"T":case"t":e=t.pathSegTypeAsLetter+" "+t.x+" "+t.y}return e},findPortByName:function(t,e){var i,a,n;if(t){if(t.ports)for(a=0,n=t.ports.length;a<n;a++)if((i=t.ports[a]).name===e)return i;if(t._ports)for(a=0,n=t._ports.length;a<n;a++)if((i=t._ports[a]).name===e)return i}return null},attr:function(t,e){for(var i in e)t.setAttribute(i.toString(),e[i])},removeChildFromGroup:function(t,e){var i,a=t.indexOf(e);if(a<0)for(i=0;i<t.length;i++)if("object"==typeof t[i]&&"string"==typeof e&&t[i].name===e){a=i;break}a>=0&&t.splice(a,1)},removeFromCollection:function(t,e,i){var a;if(t)for(i=t.nameTable[t._getChild(i)],a=0;a<e.length;a++)t.nameTable[t._getChild(e[a])].name===i.name&&e.splice(a,1)},removeItem:function(t,e){var i=t.indexOf(e);i>=0&&t.splice(i,1)},clear:function(t){for(;t.length>0;)t.pop()},getChild:function(t){if(t)return"object"==typeof t?t.name:t},randomId:function(){for(var t,i="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",a="",n=0;n<4;n++)t=e.getRandomValue(0,i.length-1),a+=i.substring(t,t+1);return a},htmlEncode:function(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},canMove:function(t){if(this.canSelect(t))return t.segments?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Drag:"label"==t._type?t.constraints&e.datavisualization.Diagram.LabelConstraints.Draggable:t.constraints&e.datavisualization.Diagram.NodeConstraints.Drag},canRouteDiagram:function(t){return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.Routing},canRouteConnector:function(t,i){return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Routing?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Routing:t.constraints&e.datavisualization.Diagram.ConnectorConstraints.InheritRouting?i.model.constraints&e.datavisualization.Diagram.DiagramConstraints.Routing:void 0},canMoveLabel:function(t){return t.segments?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.DragLabel:t.constraints&e.datavisualization.Diagram.NodeConstraints.DragLabel},canRotate:function(t){return t.segments?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Rotate:"label"==t._type?t.constraints&e.datavisualization.Diagram.LabelConstraints.Rotatable:t.constraints&e.datavisualization.Diagram.NodeConstraints.Rotate},canShowTooltip:function(t,i){return(t.segments?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.InheritTooltip:t.constraints&e.datavisualization.Diagram.NodeConstraints.InheritTooltip)?i.model.tooltip:t.tooltip},canSelect:function(t){return t.segments?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Select:"label"==t._type?t.constraints&e.datavisualization.Diagram.LabelConstraints.Selectable:t.constraints&e.datavisualization.Diagram.NodeConstraints.Select},enableLayerOption:function(t,e,i){var a,n,o,s=0,r=i.model.layers;if(r&&0===r.length)return!0;for(n=0;r&&n<r.length;n++)"active"===e&&r[n][e]?(s++,o=r[n]):(t&&r[n].objects&&r[n].objects.indexOf(t.name)>-1||i._isParent(t,r[n].objects))&&(s++,a=r[n][e],r[n][e]&&0);return"active"===e?1===s&&o:1!==s||("lock"!==e?a:!a)},canBridge:function(t,i){return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Bridging?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Bridging:t.constraints&e.datavisualization.Diagram.ConnectorConstraints.InheritBridging?i.model.constraints&e.datavisualization.Diagram.DiagramConstraints.Bridging:void 0},canBridgeObstacle:function(t){if(t.constraints&e.datavisualization.Diagram.ConnectorConstraints.BridgeObstacle)return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.BridgeObstacle},canCrispEdges:function(t,i){if(t.segments){if(t.constraints&e.datavisualization.Diagram.ConnectorConstraints.CrispEdges)return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.CrispEdges;if(i&&t.constraints&e.datavisualization.Diagram.ConnectorConstraints.InheritCrispEdges)return i.model.constraints&e.datavisualization.Diagram.DiagramConstraints.CrispEdges}else{if(t.constraints&e.datavisualization.Diagram.NodeConstraints.CrispEdges)return t.constraints&e.datavisualization.Diagram.NodeConstraints.CrispEdges;if(i&&t.constraints&e.datavisualization.Diagram.NodeConstraints.InheritCrispEdges)return i.model.constraints&e.datavisualization.Diagram.DiagramConstraints.CrispEdges}},canAllowPan:function(t){return t.constraints&e.datavisualization.Diagram.NodeConstraints.AllowPan},canAllowDrop:function(t){return t.segments?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.AllowDrop:t.constraints&e.datavisualization.Diagram.NodeConstraints.AllowDrop},isAllowDragLimit:function(t){if(t.segments)return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.DragLimit},canDelete:function(t){return t.segments?t.constraints&e.datavisualization.Diagram.ConnectorConstraints.Delete:t.constraints&e.datavisualization.Diagram.NodeConstraints.Delete},isPageEditable:function(t){if(t)return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.UserInteraction},canFloatElements:function(t){if(t)return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.FloatElements},canEnableAPIMethods:function(t){if(t&&t._enableAPIMethods)return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.APIUpdate},canDoMultipleSelection:function(t){if(t&&this.isPageEditable(t))return t.tool()&e.datavisualization.Diagram.Tool.MultipleSelect},canDoSingleSelection:function(t){if(t&&this.isPageEditable(t))return t.tool()&e.datavisualization.Diagram.Tool.SingleSelect},canMoveOutofBoundary:function(t){return"infinity"!=t.model.pageSettings.boundaryConstraints},_getPseudoGroupConstraints:function(i,a,n){var o,s,r,l,d;if(n&&"pseudoGroup"===n.type)if((n.children.indexOf(a.name)>=0||a.name===n.name)&&i.model.selectedItems.getConstraints&&("string"==typeof(s=i.model.selectedItems.getConstraints)&&(s=e.util.getObject(s,window))),s&&t.isFunction(s))o=s();else if(n.children)for(o=e.datavisualization.Diagram.NodeConstraints.Default,r=0;r<n.children.length;r++)(l=i.nameTable[i._getChild(n.children[r])])&&((d=l.constraints)&e.datavisualization.Diagram.NodeConstraints.Resize||(o&=~e.datavisualization.Diagram.NodeConstraints.Resize),d&e.datavisualization.Diagram.NodeConstraints.Rotate||(o&=~e.datavisualization.Diagram.NodeConstraints.Rotate),d&e.datavisualization.Diagram.NodeConstraints.Drag||(o&=~e.datavisualization.Diagram.NodeConstraints.Drag));return o},canPanning:function(t){if(t)return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.PannableX||t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.PannableY},canZooming:function(t){if(t)return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.Zoomable},canUndo:function(t){if(t)return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.Undoable},canZoomTextEditor:function(t){if(t)return t.model.constraints&e.datavisualization.Diagram.DiagramConstraints.ZoomTextEditor},canMultiSelectOnLane:function(t){return t.constraints&e.datavisualization.Diagram.NodeConstraints.MultiSelect},canMultiSelectOnNode:function(t){return t.constraints&e.datavisualization.Diagram.NodeConstraints.PointerEvents},canEnableTooltip:function(t){return!!(t.model.selectedItems.constraints&e.datavisualization.Diagram.SelectorConstraints.Tooltip)},canDragHelper:function(t){return!!(t.model.selectedItems.constraints&e.datavisualization.Diagram.SelectorConstraints.DragOnEmptySpace)},canShowResizeThumbs:function(t){return t.model.selectedItems.constraints&e.datavisualization.Diagram.SelectorConstraints.AutoHideThumbs},canDrawStackHighlighter:function(t,i,a){var n,o,s,r;if(e.datavisualization.Diagram.Util.canMoveOutofBoundary(t)&&t&&i&&a&&((n=t.nameTable[a.parent])&&n.isLaneStack&&((o=t.nameTable[n.parent])&&o.isSwimlane)))if(s=this.bounds(o),r=t.activeTool._getPageBounds(),"horizontal"===o.orientation){if(i.height+s.bottom>=r.height||i.width-o.width+s.right>r.width)return t.activeTool.updateCursor("not-allowed"),t._notAllow=!0,!1}else if(i.width+s.right>=r.width||i.height-o.height+s.bottom>r.height)return t.activeTool.updateCursor("not-allowed"),t._notAllow=!0,!1;return!0},canDragSourceEnd:function(t){return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd},canDragTargetEnd:function(t){return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.DragTargetEnd},canDragSegmentThumbs:function(t){return t.constraints&e.datavisualization.Diagram.ConnectorConstraints.DragSegmentThumb},isTargetConnected:function(t){return!!t.targetNode},isSourceConnected:function(t){return!!t.sourceNode},bounds:function(t,i){var a,n,o,s,r,l,d,h={};if(t)if(t.segments)for(a=0;a<t.segments.length;a++)n=t.segments[a],0==a?n.points&&(h=e.datavisualization.Diagram.Geometry.rect(n.points)):h=e.datavisualization.Diagram.Geometry.union(h,e.datavisualization.Diagram.Geometry.rect(n.points)),0==h.width&&(h.width=t.lineWidth,h.x-=t.lineWidth/2),0==h.height&&(h.height=t.lineWidth,h.y-=t.lineWidth/2);else"node"==t._type||"group"===t._type||"umlclassifier"==t.type||"pseudoGroup"==t._type?(o=t.width?t.width:t._width||0,s=t.height?t.height:t._height||0,h={x:t.offsetX-o*t.pivot.x,y:t.offsetY-s*t.pivot.y,width:o,height:s}):h=t;else h=e.datavisualization.Diagram.Rectangle();return h?(r={},h.x=Math.round(100*h.x)/100,h.y=Math.round(100*h.y)/100,h.width=Math.round(100*h.width)/100,h.height=Math.round(100*h.height)/100,r.width=h.width,r.height=h.height,r.x=r.left=h.x,r.right=h.x+h.width,r.y=r.top=h.y,r.bottom=h.y+h.height,r.center={x:h.x+h.width/2,y:h.y+h.height/2},r.topLeft={x:h.x,y:h.y},r.topCenter={x:h.x+h.width/2,y:h.y},r.topRight={x:h.x+h.width,y:h.y},r.middleLeft={x:h.x,y:h.y+h.height/2},r.middleRight={x:h.x+h.width,y:h.y+h.height/2},r.bottomLeft={x:h.x,y:h.y+h.height},r.bottomCenter={x:h.x+h.width/2,y:h.y+h.height},r.bottomRight={x:h.x+h.width,y:h.y+h.height},t&&t.rotateAngle&&!i&&(l=e.Matrix.identity(),e.Matrix.rotate(l,t.rotateAngle,t.offsetX,t.offsetY),r.topLeft=e.Matrix.transform(l,r.topLeft),r.topCenter=e.Matrix.transform(l,r.topCenter),r.topRight=e.Matrix.transform(l,r.topRight),r.middleLeft=e.Matrix.transform(l,r.middleLeft),r.middleRight=e.Matrix.transform(l,r.middleRight),r.bottomLeft=e.Matrix.transform(l,r.bottomLeft),r.bottomCenter=e.Matrix.transform(l,r.bottomCenter),r.bottomRight=e.Matrix.transform(l,r.bottomRight),d=e.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),r.x=r.left=d.x,r.y=r.top=d.y,r.right=d.x+d.width,r.bottom=d.y+d.height,r.center=e.datavisualization.Diagram.Point(d.x+d.width/2,d.y+d.height/2)),r.points=[r.topLeft,r.topRight,r.bottomRight,r.bottomLeft],r):h},_swapBounds:function(t,i){var a,n;return i=i,t.rotateAngle?(t.rotateAngle<45||(t.rotateAngle<=135?(a=e.Matrix.identity(),e.Matrix.rotate(a,t.rotateAngle,t.offsetX,t.offsetY),n=i.topCenter,i.topCenter=i.middleLeft,i.middleLeft=i.bottomCenter,i.bottomCenter=i.middleRight,i.middleRight=n,n=i.topLeft,i.topLeft=i.bottomLeft,i.bottomLeft=i.bottomRight,i.bottomRight=i.topRight,i.topRight=n):t.rotateAngle<=225?(a=e.Matrix.identity(),e.Matrix.rotate(a,t.rotateAngle,t.offsetX,t.offsetY),n=i.topCenter,i.topCenter=i.bottomCenter,i.bottomCenter=n,n=i.middleLeft,i.middleLeft=i.middleRight,i.middleRight=n,n=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=n,n=i.bottomRight,i.bottomRight=i.topRight,i.topRight=n):t.rotateAngle<=315&&(a=e.Matrix.identity(),e.Matrix.rotate(a,t.rotateAngle,t.offsetX,t.offsetY),n=i.topCenter,i.topCenter=i.middleRight,i.middleRight=i.bottomCenter,i.bottomCenter=i.middleLeft,i.middleLeft=n,n=i.topRight,i.topRight=i.bottomRight,i.bottomRight=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=n)),i.points=[i.topLeft,i.topRight,i.bottomRight,i.bottomLeft],i):void 0},canResize:function(t,i){if("label"===t._type)return t.constraints&e.datavisualization.Diagram.LabelConstraints.Resizable;if(!i)return t.constraints&e.datavisualization.Diagram.NodeConstraints.Resize;switch(i){case"n-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorth;case"s-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouth;case"e-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeEast;case"w-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeWest;case"se-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast;case"ne-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast;case"sw-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest;case"nw-resize":return t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest}},canConnect:function(t,i){var a=null;return t&&(i?a=t.constraints&e.datavisualization.Diagram.PortConstraints.Connect:t.segments||(a=t.constraints&e.datavisualization.Diagram.NodeConstraints.Connect)),a},_initializeSegments:function(t,i){var a,n,o;if(t.segments&&t.segments.length<=1)switch(t.segments.length||t.segments.push(e.datavisualization.Diagram.Segment({type:i||"straight"})),(a=t.segments[0]).type){case"straight":a.point?(a.point.x!=t.targetPoint.x||a.point.y!=t.targetPoint.y)&&t.segments.push({type:a.type||"straight"}):a._point=t.targetPoint;break;case"orthogonal":a.length&&a.direction?(e.datavisualization.Diagram.Util._addOrthogonalPoints(a,null,null,t.sourcePoint,t.targetPoint),(a._endPoint.x!=t.targetPoint.x||a._endPoint.y!=t.targetPoint.y)&&t.segments.push({type:a.type||"straight"})):(a._length=a.length||20,a._direction=a.direction||"auto");break;case"bezier":a.point?(a.point.x!=t.targetPoint.x||a.point.y!=t.targetPoint.y)&&t.segments.push({type:a.type||"straight"}):a._point=t.targetPoint}var s,r=t.sourcePoint,l=null,d=null;for(n=0;n<t.segments.length;n++){if((o=t.segments[n])._startPoint=r,d=t.segments[n+1],"orthogonal"==(o=t.segments[n]=e.datavisualization.Diagram.Segment(t.segments[n])).type){if(o._direction=o.direction||"auto",o._length=o.length||20,s=e.datavisualization.Diagram.Util._addOrthogonalPoints(t.segments[n],l,d,t.sourcePoint,t.targetPoint,s),r=t.segments[n]._endPoint,!o.length||!o.direction)break}else if("straight"==o.type){if(o.points.push(r),o.points.push(t.segments[n].point||t.targetPoint),o._point=o._endPoint=t.segments[n].point||t.targetPoint,s=e.datavisualization.Diagram.Geometry.findAngle(r,o._endPoint),r=t.segments[n]._endPoint,!o.point)break}else{if("bezier"!=o.type){(o=e.datavisualization.Diagram.Segment({type:"orthogonal"}))._direction="auto",o._length=20,o._startPoint=r,o._endPoint=t.targetPoint,t.segments.push(o),e.datavisualization.Diagram.Util._addOrthogonalPoints(o,l,null,t.sourcePoint,t.targetPoint,s);break}if(o._point=o._endPoint=t.segments[n].point||t.targetPoint,o.points.push(r),o.points.push(t.segments[n].point||t.targetPoint),s=e.datavisualization.Diagram.Geometry.findAngle(r,o._endPoint),e.datavisualization.Diagram.Util._updateBezierPoints(o),r=t.segments[n]._endPoint,!o.point)break}l=t.segments[n]}(r.x!=t.targetPoint.x||r.y!=t.targetPoint.y)&&((o=e.datavisualization.Diagram.Segment({type:(l?l.type:i)||"straight"}))._startPoint=r,o._endPoint=t.targetPoint,"orthogonal"==o.type?e.datavisualization.Diagram.Util._addOrthogonalPoints(o,l,null,t.sourcePoint,t.targetPoint,s):(o._point=t.targetPoint,o.points.push(r),o.points.push(t.targetPoint),"bezier"==o.type&&this._updateBezierPoints(o)),t.segments.push(o))},_getDockableBPMNNode:function(t,e,i,a){var n=a?e.segments[e.segments.length-1]:e.segments[0];if(t&&"bpmn"==t.type){if("orthogonal"==n.type)return t;"group"==t._type&&(t="object"==typeof t.children[0]?t.children[0]:i[t.children[0]])}return t},dock:function(t,e,i){var a,n,o,s,r=null,l=null,d=t._srcDecoratorSize,h=t._tarDecoratorSize;t.sourcePadding&&(t._srcDecoratorSize+=t.sourcePadding),t.targetPadding&&(t._tarDecoratorSize+=t.targetPadding),(a=e[t.targetNode])&&(r=t._targetPortLocation||this.findPortByName(a,t.targetPort)),(n=e[t.sourceNode])&&(l=t._sourcePortLocation||this.findPortByName(n,t.sourcePort)),o=this.isSourceConnected(t),s=this.isTargetConnected(t),l?l.connectorPadding&&(t._srcDecoratorSize+=l.connectorPadding):(n=this._getDockableBPMNNode(n,t,e,!1))&&n.connectorPadding&&(t._srcDecoratorSize+=n.connectorPadding),r?r.connectorPadding&&(t._tarDecoratorSize+=r.connectorPadding):(a=this._getDockableBPMNNode(a,t,e,!0))&&a.connectorPadding&&(t._tarDecoratorSize+=a.connectorPadding),s&&o&&r&&l?this._dockPortToPort(t,a,r,n,l):s&&r?o?1==t.segments.length?(this._dockNode(t,n,null,s,o),this._dockPortToNode(t,a,r,n,l,!0)):(this._dockNode(t,n,null,s,o),this._updateIntermediateSegments(t),this._dockPortToPoint(t,a,r,!0),this._updatePreviousSegment(t)):(this._dockPortToPoint(t,a,r,!0),this._updatePreviousSegment(t)):o&&l?s?1==t.segments.length?(this._dockNode(t,a,null,s,o),this._dockPortToNode(t,n,l,a,r,!1)):(this._dockPortToPoint(t,n,l,!1),this._updateIntermediateSegments(t),this._dockNode(t,a,null,s,o),this._updatePreviousSegment(t)):(this._dockPortToPoint(t,n,l,!1),this._updateIntermediateSegments(t)):s&&o?a&&n&&this._dockNode(t,a,n,s,o,i):s?this._dockNode(t,a,null,s,o):o&&this._dockNode(t,n,null,s,o),this._adjustEndPoint(t,n,l,a,r),t._srcDecoratorSize=d,t._tarDecoratorSize=h},_dockPortToPort:function(t,i,a,n,o){var s,r,l;if(1==t.segments.length){i&&(r=this.bounds(i,!0)),n&&(l=this.bounds(n,!0));var d,h=t.segments[0],g=(t.segments[t.segments.length-1],t.segments[0]);if("orthogonal"!==g.type)a&&(s=this._getPortPosition(a,r,void 0,i),i.rotateAngle&&(d=e.Matrix.identity(),e.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),s=e.Matrix.transform(d,s)),this._setLineEndPoint(t,s,!0)),o&&(s=this._getPortPosition(o,l,void 0,n),n.rotateAngle&&(d=e.Matrix.identity(),e.Matrix.rotate(d,n.rotateAngle,n.offsetX,n.offsetY),s=e.Matrix.transform(d,s)),this._setLineEndPoint(t,s,!1)),"bezier"===g.type&&this._updateBezierPoints(g,i,a,r,n,o,l);else{var c=t._targetPortLocation||this._getPortPosition(a,r,void 0,i),u=t._sourcePortLocation||this._getPortPosition(o,l,void 0,n),m=this._swapDirection(i.rotateAngle,this._getDirection(r,c)),p=this._swapDirection(n.rotateAngle,this._getDirection(l,u));n.rotateAngle&&(d=e.Matrix.identity(),e.Matrix.rotate(d,n.rotateAngle,n.offsetX,n.offsetY),u=e.Matrix.transform(d,u)),i.rotateAngle&&(d=e.Matrix.identity(),e.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),c=e.Matrix.transform(d,c)),this._constructSegements(t,h,r,c,m,l,u,p),this._setLineEndPoint(t,h.points[0],!1),this._setLineEndPoint(t,h.points[h.points.length-1],!0)}}else this._dockPortToPoint(t,n,o,!1),this._updateIntermediateSegments(t),this._dockPortToPoint(t,i,a,!0),this._updatePreviousSegment(t)},_dockPortToNode:function(t,i,a,n,o,s){var r,l,d,h,g,c,u,m,p=t.segments[0],f=t.segments[t.segments.length-1];i&&(r=this.bounds(i,!0)),n&&(l=this.bounds(n,!0)),"orthogonal"!==(s?f:p).type?(h=this._getPortPosition(a,r,void 0,i),d=e.Matrix.identity(),e.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),h=e.Matrix.transform(d,h),this._setLineEndPoint(t,h,s)):(g=(s?t._targetPortLocation:t._sourcePortLocation)||this._getPortPosition(a,r,void 0,i),c=this._swapDirection(i.rotateAngle,this._getDirection(r,g)),d=e.Matrix.identity(),e.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),g=e.Matrix.transform(d,g),u=s?t.sourcePoint:t.targetPoint,(m=n?this._getDirection(l,u):"top")&&(r=this.bounds(i),l=n?this.bounds(n):{left:u.x,right:u.x,top:u.y,bottom:u.y},s?(this._setLineEndPoint(t,g,!0),this._constructSegements(t,f,r,g,c,l,u,m)):(this._setLineEndPoint(t,g,!1),this._constructSegements(t,p,l,u,m,r,g,c))))},_dockPortToPoint:function(t,i,a,n){var o,s=t.segments[0],r=t.segments[t.segments.length-1];if("orthogonal"!==(n?r:s).type)this._dockPortToNode(t,i,a,null,null,n);else{var l=this.bounds(i,!0),d=(n?t._targetPortLocation:t._sourcePortLocation)||this._getPortPosition(a,l,void 0,i),h=this._swapDirection(i.rotateAngle,this._getDirection(l,d)),g=e.Matrix.identity();e.Matrix.rotate(g,i.rotateAngle,i.offsetX,i.offsetY),d=e.Matrix.transform(g,d),o=n?r._startPoint:s._endPoint,this.bounds(e.datavisualization.Diagram.Rectangle(o.x,o.y,0,0)),l=this.bounds(i),"top",n?(this._setLineEndPoint(t,d,!0),this._pointsFromNodeToPoint(t,r,h,l,i.rotateAngle,d,o,!0)):(this._setLineEndPoint(t,d,!1),this._pointsFromNodeToPoint(t,s,h,l,i.rotateAngle,d,o,!1))}},_containsminSpaceBetweenNode:function(t,e,i){var a;if(t&&t.minSpaceBetweenNode&&e&&i&&t.minSpaceBetweenNode&&t.minSpaceBetweenNode.length>0)for(a=0;a<t.minSpaceBetweenNode;a++)if(t.minSpaceBetweenNode[a]===e.name||t.minSpaceBetweenNode[a]===i.name)return!0;return!1},_dockNode:function(t,e,i,a,n,o){var s,r,l,d,h,g,c,u,m,p=t._srcDecoratorSize+t._tarDecoratorSize;p=this._containsminSpaceBetweenNode(o,i,e)?0:p,1==t.segments.length?s=r=t.segments[0]:(s=t.segments[0],r=t.segments[t.segments.length-1]),a&&n&&!t.targetPort&&!t.sourcePort?1==t.segments.length?"orthogonal"==t.segments[0].type?(l=this.bounds(i),d=this.bounds(e),this._swapBounds(i,l),this._swapBounds(e,d),l.y-p>=d.bottom?(h=l.topCenter,c="top",g=d.bottomCenter,u="bottom"):l.bottom+p<=d.y&&(g=d.topCenter,u="top",h=l.bottomCenter,c="bottom"),l.bottom+p>d.y&&l.y<d.bottom+p&&(l.right+p<d.x||d.right>=l.x-p&&l.x>d.x?(h=l.middleRight,c="right",g=d.middleLeft,u="left"):d.right+p<l.x||l.right>=d.x-p&&l.x<d.x?(h=l.middleLeft,c="left",g=d.middleRight,u="right"):l.x<=d.x?(h=l.middleLeft,c="left",g=d.middleLeft,u="left"):l.x<=d.right?(h=l.middleRight,c="right",g=d.middleRight,u="right"):(h=l.middleLeft,c="left",g=d.middleRight,u="right")),m=this._findEndPoint(c,h,i)||l.center,h=this._findIntersection(i,l,t,h,m,!1)||h,m=this._findEndPoint(u,g,e)||d.center,g=this._findIntersection(e,d,t,g,m,!0)||g,this._setLineEndPoint(t,h,!1),this._setLineEndPoint(t,g,!0),"orthogonal"==t.segments[0].type&&(this._constructSegements(t,t.segments[0],d,t.targetPoint,u,l,t.sourcePoint,c),t.segments[0]._direction=c)):(e&&(d=this.bounds(e),this._swapBounds(e,d),i&&(l=this.bounds(i),this._swapBounds(i,l),this._setLineEndPoint(t,l.center,!1),this._setLineEndPoint(t,d.center,!0),this._dockBounds(t,i,l,!1)),this._setLineEndPoint(t,d.center,!0),this._dockBounds(t,e,d,!0)),"bezier"==t.segments[0].type&&this._updateBezierPoints(t.segments[0])):(this._dock(t,s,i,null,!1),this._updateIntermediateSegments(t),1==t.segments.length?(this._dock(t,s,i,e,!1),this._dock(t,r,e,i,!0)):(this._dock(t,r,e,null,!0),this._updatePreviousSegment(t))):a&&!t.targetPort?(this._dock(t,r,e,i,!0),this._updatePreviousSegment(t)):n&&!t.sourcePort&&(this._dock(t,s,e,i,!1),this._updateIntermediateSegments(t))},_adjustEndPoint:function(t,e,i,a,n){var o,s,r,l,d;if(t.sourcePadding||t.targetPadding||i&&i.connectorPadding||n&&n.connectorPadding){var h=0,g=a?this.bounds(a):null,c=e?this.bounds(e):null;e&&(o="orthogonal"!==(l=t.segments[0]).type?"bezier"!==l.type?l._endPoint:l._point1:l.points[1],i&&(h=t.sourcePadding+i.connectorPadding),s=this._adjustPoint(l._startPoint,o,!0,h),this._setLineEndPoint(t,s,!1),"bezier"==l.type&&this._updateBezierPoints(l,a,n,g,e,i,c)),a&&(r="orthogonal"!==(l=t.segments[t.segments.length-1]).type?"bezier"!==l.type?l._startPoint:l._point2:l.points[l.points.length-2],n&&(h=t.targetPadding+n.connectorPadding),d=this._adjustPoint(r,l._endPoint,!1,h),this._setLineEndPoint(t,d,!0),"bezier"==l.type&&this._updateBezierPoints(l,a,n,g,e,i,c))}},_findEndPoint:function(t,e,i){var a;switch(t){case"top":a={x:e.x,y:e.y+Math.max(i.width,i.height)};break;case"bottom":a={x:e.x,y:e.y-Math.max(i.width,i.height)};break;case"left":a={y:e.y,x:e.x+Math.max(i.width,i.height)};break;case"right":a={y:e.y,x:e.x-Math.max(i.width,i.height)}}return a},_dock:function(t,i,a,n,o){var s,r,l,d,h,g,c,u,m;if(a)if(r=a,l=o?i._startPoint:i._endPoint,s=this.bounds(a),this._swapBounds(a,s),o)if("orthogonal"==i.type)if((c=t.segments[t.segments.length-2])&&"orthogonal"==c.type)if(i.points.length>2&&e.datavisualization.Diagram.Geometry.containsPoint(s,i.points[i.points.length-2])){if(u=!1,"top"==c.direction||"bottom"==c.direction){if(c._endPoint.x>=s.left&&c._endPoint.x<=s.right)return void this._removeLastSegment(t,i,c,a,n,o);c._length=c.length=Math.abs(c._startPoint.y-s.middleLeft.y),0==c.length?u=!0:(c.length<0&&(c._length=c.length*=-1,c._direction=c.direction="top"==c.direction?"bottom":"top"),t.targetPoint=c._endPoint.x>s.right?s.middleRight:s.middleLeft)}else{if(c._endPoint.y>=s.top&&c._endPoint.y<=s.bottom)return void this._removeLastSegment(t,i,c,a,n,o);c._length=c.length=Math.abs(c._startPoint.x-s.topCenter.x),0==c.length?u=!0:(c.length<0&&(c._length=c.length*=-1,c._direction=c.direction="left"==c.direction?"right":"left"),t.targetPoint=c._endPoint.y>s.bottom?s.bottomCenter:s.topCenter)}if(u)return t.segments.splice(t.segments.length-2,1),void this._dock(t,i,a,n,o);t.targetPoint=this._findIntersection(a,s,t,t.targetPoint,s.center,o)||t.targetPoint,this._updateConnectorSegments(t,t.sourcePort,t.targetPort),i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,c),this._setLineEndPoint(t,t.targetPoint,o)}else if(e.datavisualization.Diagram.Geometry.containsPoint(s,i._startPoint)){if(m="left"==c.direction||"right"==c.direction?r.width/2:r.height/2,c._length=c.length-=m+30,0==c.length)return t.segments.splice(t.segments.length-2,1),void this._dock(t,i,a,n,o);t.targetPoint="left"==c.direction||"right"==c.direction?"right"==c.direction?s.middleLeft:s.middleRight:"bottom"==c.direction?s.topCenter:s.bottomCenter,t.targetPoint=this._findIntersection(a,s,t,t.targetPoint,s.center,o)||t.targetPoint,this._updateConnectorSegments(t,t.sourcePort,t.targetPort),i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,c),this._setLineEndPoint(t,t.targetPoint,o)}else this._dockNodeToPoint(t,l,a,o);else this._dockNodeToPoint(t,l,a,o);else this._dockNodeToPoint(t,l,a,o);else if("orthogonal"==i.type&&t.segments[1]&&"orthogonal"==t.segments[1].type)if(t.segments[0]._isInternal&&e.datavisualization.Diagram.Geometry.containsPoint(s,i._endPoint))this._insertSegmentAtSourceEnd(t,i,s,a,o);else if(e.datavisualization.Diagram.Geometry.containsPoint(s,i._endPoint))this._removeFirstSegment(t,i,s,a,o);else{switch(i.direction){case"left":h="left",d=s.middleLeft;break;case"right":h="right",d=s.middleRight;break;case"top":h="top",d=s.topCenter;break;case"bottom":h="bottom",d=s.bottomCenter}i.points=[],g=this._findEndPoint(h,d,a)||s.center,d=this._findIntersection(a,s,t,d,g,o)||d,i.points.push(d),i.points.push(i._endPoint),this._setLineEndPoint(t,d,o)}else this._dockNodeToPoint(t,i._endPoint,a,o)},_removeLastSegment:function(t,e,i,a,n,o){t.segments.splice(t.segments.length-1,1),i.length=i._length=null,i.direction=null,i._direction=e._direction,this._dock(t,i,a,n,o)},_insertSegmentAtSourceEnd:function(t,e,i,a,n){var o,s,r=t.segments[1],l=t.segments[2];"left"==t.segments[0].direction||"right"==t.segments[0].direction?(o="horizontal",t.sourcePoint="top"==r.direction?i.topCenter:i.bottomCenter,r&&(r.length||0===r.length)&&(r._length=r.length=Math.max(Math.abs(t.sourcePoint.y-r._endPoint.y),25)),l&&(l.length||0===l.length)&&(l.length=l._length=Math.abs(i.topCenter.x-l._endPoint.x))):(o="vertical",t.sourcePoint="left"==r.direction?i.middleLeft:i.middleRight,r&&(r.length||0===r.length)&&(r._length=r.length=Math.max(Math.abs(t.sourcePoint.x-r._endPoint.x),25)),l&&(l.length||0===l.length)&&(l.length=l._length=Math.abs(i.middleRight.y-l._endPoint.y))),t.segments[3]&&(t.segments[3].length||0==t.segments[3].length)&&(s="bottom"==r.direction||"right"==r.direction?r.length:-r.length,t.segments[3].length=t.segments[3]._length="vertical"==o?Math.abs(t.sourcePoint.x+s-t.segments[3]._endPoint.x):Math.abs(t.sourcePoint.y+s-t.segments[3]._endPoint.y),t.segments[3].length<0&&(s="bottom"==r.direction||"right"==r.direction?r.length:-r.length,t.segments[3].length=t.segments[3]._length="vertical"==o?Math.abs(t.sourcePoint.x+s-t.segments[3]._endPoint.x):Math.abs(t.sourcePoint.y+s-t.segments[3]._endPoint.y))),t.segments.splice(0,1),t.sourcePoint=this._findIntersection(a,i,t,t.sourcePoint,i.center,n)||t.sourcePoint,this._updateConnectorSegments(t,t.sourcePort,t.targetPort),this._setLineEndPoint(t,t.sourcePoint,n)},_removeFirstSegment:function(t,i,a,n,o){var s,r,l,d,h,g,c=t.segments[1].direction||this._getBezierDirection(t.segments[1].points[0],t.segments[1].points[1]);"left"==c||"right"==c?(l=i._endPoint.y-a.middleRight.y,t.segments[0].direction=t.segments[0]._direction=l>=0?"bottom":"top",t.segments[0].length=t.segments[0]._length=Math.abs(l),d="right"==c?t.segments[1]._endPoint.x-a.right:a.left-t.segments[1]._endPoint.x,t.sourcePoint="left"==c?a.middleLeft:a.middleRight,s=Math.abs(t.sourcePoint.x-t.segments[0]._startPoint.x),r=Math.abs(t.sourcePoint.y-t.segments[0]._endPoint.y)):((t.segments[0].length||0==t.segments[0].length)&&(l=i._endPoint.x-a.bottomCenter.x,t.segments[0].direction=t.segments[0]._direction=l>=0?"right":"left",t.segments[0].length=t.segments[0]._length=Math.abs(l)),d="bottom"==c?t.segments[1]._endPoint.y-a.bottom:a.top-t.segments[1]._endPoint.y,t.sourcePoint="top"==c?a.topCenter:a.bottomCenter,s=Math.abs(t.sourcePoint.y-t.segments[0]._startPoint.y),r=Math.abs(t.sourcePoint.x-t.segments[0]._endPoint.x)),t.segments[1]&&(t.segments[1].length||0===t.segments[1].length)&&(t.segments[1]._length=t.segments[1].length=d-25,t.segments[1]._length<0&&(t.segments.splice(0,2),(t.segments[0].length||0===t.segments[0].length)&&(t.segments[0].length=t.segments[0]._length=s),h=e.datavisualization.Diagram.Segment({type:"orthogonal",length:r,direction:c}))),h||(h=e.datavisualization.Diagram.Segment({type:"orthogonal",length:25,direction:c})),g=[h],h._isInternal=!0,t.segments=g.concat(t.segments),t.sourcePoint=this._findIntersection(n,a,t,t.sourcePoint,a.center,o)||t.sourcePoint,this._updateConnectorSegments(t,t.sourcePort,t.targetPort),this._setLineEndPoint(t,t.sourcePoint,o)},_dockNodeToPoint:function(t,e,i,a){var n,o,s,r,l,d,h,g,c,u,m;if("orthogonal"!=(n=a?t.segments[t.segments.length-1]:t.segments[0]).type)o=this.bounds(i),this._swapBounds(i,o),this._setLineEndPoint(t,o.center,a),this._dockBounds(t,i,o,a);else{if(o=this.bounds(i),this._swapBounds(i,o),h=e,t.segments.length>1){var p=t.segments[t.segments.length-2],f=Math.abs(h.x-o.left),_=Math.abs(h.x-o.right),v=Math.abs(h.y-o.top),y=Math.abs(h.y-o.bottom);p&&a&&(g="left"==p.direction||"right"==p.direction,c="top"==p.direction||"bottom"==p.direction),2!=(n=a?t.segments[t.segments.length-1]:t.segments[0]).points.length&&p||"orthogonal"!=n.type||(g=c=!1),o.bottom<h.y&&!g?(l="bottom",d="top",r=o.bottomCenter):o.y>h.y&&!g?(l="top",d="bottom",r=o.topCenter):o.right<h.x&&!c?(l="right",d="left",r=o.middleRight):o.x>h.x&&!c?(l="left",d="right",r=o.middleLeft):(m=f,r=o.middleLeft,l="left",d="right",m>=_&&0!=_&&(r=o.middleRight,l="right",d="left",m=_),m>v&&0!=v&&(r=o.topCenter,l="top",d="bottom",m=v),m>y&&0!=y&&(r=o.bottomCenter,l="bottom",d="top",m=y))}else switch(r=o.center,l=this._getBezierDirection(e,r)){case"left":d="right";break;case"right":d="left";break;case"top":d="bottom";break;case"bottom":d="top"}r&&(a||1==t.segments.length?"orthogonal"==(s=t.segments[t.segments.length-1]).type&&(s._direction=a?l:d):s=t.segments[0],u=this._findEndPoint(l,r,i)||o.center,r=this._findIntersection(i,o,t,r,u,a)||r,a?t.targetPoint=r:t.sourcePoint=r,1!=t.segments.length&&this._addOrthogonalPoints(s,a?t.segments[t.segments.length-2]:null,a?null:t.segments[1],t.sourcePoint,t.targetPoint),this._setLineEndPoint(t,r,a))}},_getDockSegment:function(t,i,a,n,o,s){var r,l,d=this._getEdges(a,n),h=(s="",e.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint));return l=o?e.datavisualization.Diagram.LineSegment(i.points[i.points.length-2],i.points[i.points.length-1]):h>5?e.datavisualization.Diagram.LineSegment(i._startPoint,i._endPoint):e.datavisualization.Diagram.LineSegment(i._startPoint,t.segments[1]?t.segments[1]._endPoint:t.targetPoint),e.datavisualization.Diagram.Geometry.intersectSegment(l,d.left)?(r=d.left,s="left"):e.datavisualization.Diagram.Geometry.intersectSegment(l,d.top)?(r=d.top,s="top"):e.datavisualization.Diagram.Geometry.intersectSegment(l,d.right)?(r=d.right,s="right"):e.datavisualization.Diagram.Geometry.intersectSegment(l,d.bottom)&&(r=d.bottom,s="bottom"),s=this._swapDirection(a,s),r?{dockPoint:e.datavisualization.Diagram.Geometry.midPoint(r),direction:s}:null},_dockBounds:function(t,e,i,a){var n,o,s,r;o=(n=a?t.segments[t.segments.length-1]:t.segments[0])._startPoint,s=n._endPoint||n.point,"bezier"==n.type&&(n.point1||n.point2)&&(a?o=n._point2:s=n._point1),(r=this._findIntersection(e,i,t,o,s,a))&&(this._setLineEndPoint(t,r,a),"bezier"===n.type&&this._updateBezierPoints(n))},_findIntersection:function(t,i,a,n,o,s){var r,l,d,h,g,c,u,m,p,f,_,v,y=s?a.segments[a.segments.length-1]:a.segments[0],b=t.connectorPadding;if(b+=s?a.targetPadding:a.sourcePadding,"orthogonal"==y.type&&((n={x:n.x,y:n.y}).x==o.x&&(n.y<o.y?n.y-=b+5:n.y+=b+5),n.y==o.y&&(n.x<o.x?n.x-=b+5:n.x+=b+5)),h=s||"orthogonal"==y.type?n:o,"orthogonal"!=y.type&&(s?(d=e.datavisualization.Diagram.Geometry.findAngle(n,o),o=e.datavisualization.Diagram.Geometry.transform({x:o.x,y:o.y},d,Math.max(t.width/2,t.height/2))):(d=e.datavisualization.Diagram.Geometry.findAngle(o,n),n=e.datavisualization.Diagram.Geometry.transform({x:n.x,y:n.y},d,Math.max(t.width/2,t.height/2)))),"ellipse"===t._shape)return v=e.datavisualization.Diagram.LineSegment(n,o),this._getEllipseIntersectCoords(t,v,a,h,s);if("polygon"!==t._shape||"bpmn"==t.type&&"orthogonal"==y.type)!t.pathData||"path"!==t._shape||"bpmn"==t.type&&"orthogonal"==y.type?((t.connectorPadding||a.sourcePadding||a.targetPadding)&&(_=e.datavisualization.Diagram.Rectangle(i.x-b,i.y-b,t.width+2*b,t.height+2*b),i=this.bounds(_)),(r=i.points)[r.length]=r[0],l=i.points.length):(t._segmentPoints||(f=this._findSegmentPoints(t,a,s)),r=f||t._segmentPoints,t.pathData.split("m").length-1+(t.pathData.split("M").length-1)==1&&(r[r.length]=r[0]),l=r.length);else{for(r=[],r=t._segmentPoints?t._segmentPoints:this._findSegmentPoints(t,a,s),t.rotateAngle&&(g=e.Matrix.identity(),e.Matrix.rotate(g,t.rotateAngle,t.offsetX,t.offsetY)),l=r.length,f=[],c=0;c<l;c++)u=e.datavisualization.Diagram.Point(r[c].x+(t.offsetX-t.width*t.pivot.x),r[c].y+(t.offsetY-t.height*t.pivot.y)),0!=t.rotateAngle&&(u=e.Matrix.transform(g,u)),(t.connectorPadding||a.sourcePadding||a.targetPadding)&&(m=t.offsetX==u.x?0:t.offsetX<u.x?1:-1,p=t.offsetY==u.y?0:t.offsetY<u.y?1:-1,u=b?e.datavisualization.Diagram.Geometry.translate(u,m*b,p*b):u),f[c]=u;r=f}return v=e.datavisualization.Diagram.LineSegment(n,o),this._getIntersectionPoints(v,r,!0,h)},_getIntersectionPoints:function(t,i,a,n){var o,s,r,l,d=i.length,h=e.datavisualization.Diagram.LineSegment(i[0],i[1]),g=e.datavisualization.Diagram.Geometry.intersectSegment(t,h);if(g){if(!a)return g;s=e.datavisualization.Diagram.Geometry.distance(g,n)}if(isNaN(s)||s>0)for(o=1;o<d-1;o++)if(h=e.datavisualization.Diagram.LineSegment(i[o],i[o+1]),r=e.datavisualization.Diagram.Geometry.intersectSegment(t,h)){if(!a)return r;if(l=e.datavisualization.Diagram.Geometry.distance(r,n),(isNaN(s)||s>l)&&(s=l,g=r),s>=0&&s<=1)break}return g},_findSegmentPoints:function(t,i,a){var n,o,s,r,l,d,h,g,c,u,m,p,f=[];if("path"==t._shape){for((n=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(n),(o=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttributeNS(null,"d",t._absolutePath||t.pathData),n.appendChild(o),s=!t._absoluteBounds||t._scaled||t._absolutePath?o.getBBox():t._absoluteBounds,r=t.connectorPadding,i&&(r+=a?i.targetPadding:i.sourcePadding),r||!t._absolutePath||t._scaled?(l=e.datavisualization.Diagram.Geometry.updatePath(-r,-r,t.width+2*r,t.height+2*r,t._absolutePath||t.pathData,null,s,r?null:t),o.setAttributeNS(null,"d",l),(!t._scaled||r)&&t._absolutePath||(t._absolutePath=l,t._scaled=!1)):o.setAttributeNS(null,"d",t._absolutePath),d=e.Matrix.identity(),e.Matrix.rotate(d,t.rotateAngle,t.offsetX,t.offsetY),h=o.getTotalLength(),c=0;c<=h;c+=10)g=o.getPointAtLength(c),u={x:t.offsetX-t.width*t.pivot.x+g.x,y:t.offsetY-t.height*t.pivot.y+g.y},0!=t.rotateAngle&&(u=e.Matrix.transform(d,u)),f.push(u);document.body.removeChild(n)}else{if("polygon"!=t._shape)return null;for(m=t.points.length,p=0;p<m;p++)f[p]=t.points[p];e.datavisualization.Diagram.Geometry.updatePolygonPoints(t,f),f[f.length]=f[0]}return f},_getEdges:function(t,i){var a,n=i.points,o={},s=t%360;return o.left=e.datavisualization.Diagram.LineSegment(n[3],n[0]),o.top=e.datavisualization.Diagram.LineSegment(n[0],n[1]),o.right=e.datavisualization.Diagram.LineSegment(n[1],n[2]),o.bottom=e.datavisualization.Diagram.LineSegment(n[2],n[3]),s<0&&(s+=360),s>315||s<45||(s<135?(a=o.top,o.top=o.left,o.left=o.bottom,o.bottom=o.right,o.right=a):s<225?(a=o.top,o.top=o.bottom,o.bottom=a,a=o.left,o.left=o.right,o.right=a):(a=o.bottom,o.bottom=o.left,o.left=o.top,o.top=o.right,o.right=a)),o},_pointsFromNodeToPoint:function(t,e,i,a,n,o,s,r){var l,d,h=r?t._tarDecoratorSize:t._srcDecoratorSize,g=[];g.push(o),o.y==s.y&&("left"==i&&s.x<o.x||"right"==i&&s.x>o.x)||o.x==s.x&&("top"==i&&s.y<o.y||"bottom"==i&&s.y>o.y)||("top"==i||"bottom"==i?"top"==i&&s.y<o.y&&s.y>o.y-h||"bottom"==i&&s.y>o.y&&s.y<o.y+h?(l="top"==i?a.top-h:a.bottom+h,g.push({x:o.x,y:l}),g.push({x:o.x+(s.x-o.x)/2,y:l}),g.push({x:o.x+(s.x-o.x)/2,y:s.y})):Math.abs(o.x-s.x)>h&&("top"==i&&s.y<o.y||"bottom"==i&&s.y>o.y)?g.push({x:o.x,y:s.y}):"top"==i&&s.y<o.y||"bottom"==i&&s.y>o.y?Math.abs(o.x-s.x)<=h&&e.points.length>2?(l="top"==i?a.top-h:a.bottom+h,g.push({x:o.x,y:l}),g.push({x:s.x,y:l})):s.x=o.x:Math.abs(o.x-s.x)<=h||(s.x<a.left||s.x>a.right)&&s.y!=o.y?(l="top"==i?a.top-h:a.bottom+h,g.push({x:o.x,y:l}),g.push({x:s.x,y:l})):(l="top"==i?a.top-h:a.bottom+h,d=s.x<o.x?a.left-h:a.right+h,g.push({x:o.x,y:l}),g.push({x:d,y:l}),g.push({x:d,y:s.y})):"left"==i&&s.x<o.x&&s.x>o.x-h||"right"==i&&s.x>o.x&&s.x<o.x+h?(d="left"==i?a.left-h:a.right+h,g.push({x:d,y:o.y}),g.push({x:d,y:o.y+(s.y-o.y)/2}),g.push({x:s.x,y:o.y+(s.y-o.y)/2})):Math.abs(o.y-s.y)>h&&("left"==i&&s.x<o.x||"right"==i&&s.x>o.x)?g.push({x:s.x,y:o.y}):"left"==i&&s.x<o.x||"right"==i&&s.x>o.x?Math.abs(o.y-s.y)<=h&&e.points.length>2?(d="left"==i?a.left-h:a.right+h,g.push({x:d,y:o.y}),g.push({x:d,y:s.y})):s.y=o.y:Math.abs(o.y-s.y)<=h||(s.y<a.top||s.y>a.bottom)&&s.x!=o.x?(d="left"==i?a.left-h:a.right+h,g.push({x:d,y:o.y}),g.push({x:d,y:s.y})):(l=s.y<o.y?a.top-h:a.bottom+h,d="left"==i?a.left-h:a.right+h,g.push({x:d,y:o.y}),g.push({x:d,y:l}),g.push({x:s.x,y:l}))),g.push(s),r&&g.reverse(),e._startPoint=g[0],e._endPoint=g[g.length-1],e.points=g,e.direction&&("left"==e.direction||"right"==e.direction?(e.length=e._length=Math.abs(e._startPoint.x-e._endPoint.x),e._direction=e._startPoint.x<e._endPoint.x?e.direction="right":e.direction="left"):(e.length=e._length=Math.abs(e._startPoint.y-e._endPoint.y),e._direction=e._startPoint.y<e._endPoint.y?e.direction="bottom":e.direction="top"))},_constructSegements:function(t,e,i,a,n,o,s,r){var l,d,h,g;for("right"===r&&("left"===n?l=this._rightToLeft(t,e,i,a,o,s,!1):"right"===n?l=this._rightToRight(t,i,a,o,s):"top"===n?l=this._rightToTop(t,i,a,o,s,!1):"bottom"===n&&(l=this._rightToBottom(t,i,a,o,s,!1))),"left"===r&&("right"===n&&(l=this._rightToLeft(t,e,o,s,i,a,!0),d=!0),"left"===n&&(l=this._leftToLeft(t,i,a,o,s)),"top"===n&&(l=this._leftToTop(t,i,a,o,s,!1)),"bottom"===n&&(l=this._leftToBottom(t,i,a,o,s,!1))),"top"===r&&("left"===n&&(l=this._leftToTop(t,o,s,i,a,!0),d=!0),"right"===n&&(l=this._rightToTop(t,o,s,i,a,!0),d=!0),"top"===n&&(l=this._topToTop(t,i,a,o,s)),"bottom"===n&&(l=this._topToBottom(t,e,i,a,o,s,!1))),"bottom"===r&&("left"===n&&(l=this._leftToBottom(t,o,s,i,a,!0),d=!0),"right"===n&&(l=this._rightToBottom(t,o,s,i,a,!0),d=!0),"top"===n&&(l=this._topToBottom(t,e,o,s,i,a,!0),d=!0),"bottom"===n&&(l=this._bottomToBottom(t,i,a,o,s))),d&&l.reverse(),h=l[l.length-1],g=l[l.length-2];l.length>2&&h.x==g.x&&h.y==g.y;)l.splice(l.length-1,1),h=l[l.length-1],g=l[l.length-2];for(h=l[0],g=l[1];l.length>2&&h.x==g.x&&h.y==g.y;)l.splice(0,1),h=l[0],g=l[1];e._startPoint=l[0],e._endPoint=l[l.length-1],e.points=l},_updateIntermediateSegments:function(t){var i,a=t.segments[0]._endPoint,n=t.segments[0];n.points.length;t.segments[1]&&((i=t.segments[1])._startPoint=a,"orthogonal"!=i.type||!i.length&&0!==i.length?"orthogonal"==i.type&&null===i.length?(t.sourcePort&&n.points.length>2&&("left"==i._direction||"right"==i._direction?n.points[n.points.length-1].y==n.points[n.points.length-2].y&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1]):n.points[n.points.length-1].x==n.points[n.points.length-2].x&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1])),i._startPoint=i.points[0]=t.segments[0]._endPoint,this._addOrthogonalPoints(t.segments[1],t.segments[0],null,t.sourcePoint,t.targetPoint)):(i._startPoint=i.points[0]=t.segments[0]._endPoint,"bezier"==i.type&&this._updateBezierPoints(i)):("left"==i.direction||"right"==i.direction?(t.segments[2]&&(t.segments[2].length||0===t.segments[2].length)&&("top"==t.segments[2].direction?t.segments[2].length+=i._startPoint.y-i._endPoint.y:t.segments[2].length-=i._startPoint.y-i._endPoint.y,t.segments[2].length<0&&(t.segments[2].length*=-1,t.segments[2].direction=t.segments[2]._direction="bottom"==t.segments[2]._direction?"top":"bottom"),t.segments[2]._length=t.segments[2].length),i._endPoint.y=i._startPoint.y):(t.segments[2]&&(t.segments[2].length||0===t.segments[2].length)&&("left"==t.segments[2].direction?t.segments[2].length+=i._startPoint.x-i._endPoint.x:t.segments[2].length-=i._startPoint.x-i._endPoint.x,t.segments[2].length<0&&(t.segments[2].length*=-1,t.segments[2].direction=t.segments[2]._direction="right"==t.segments[2]._direction?"left":"right"),t.segments[2]._length=t.segments[2].length),i._endPoint.x=i._startPoint.x),t.sourcePort&&n.points.length>2&&("left"==i.direction||"right"==i.direction?n.points[n.points.length-1].y==n.points[n.points.length-2].y&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1],2==i.points.length&&(i._endPoint.y=i._startPoint.y)):n.points[n.points.length-1].x==n.points[n.points.length-2].x&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1],2==i.points.length&&(i._endPoint.x=i._startPoint.x))),(i.length||0===i.length)&&(i.length=i._length=e.datavisualization.Diagram.Geometry.distance(i._startPoint,i.points[1])),i.length>0&&(i.direction=i._direction=this._getBezierDirection(i._startPoint,i._endPoint)||i._direction),this._addOrthogonalPoints(i,n,t.segments[2],t.sourcePoint,t.targetPoint),t.segments[2]&&this._addOrthogonalPoints(t.segments[2],t.segments[1],t.segments[3],t.sourcePoint,t.targetPoint)))},_updatePreviousSegment:function(t){var i,a,n=t.segments[t.segments.length-2],o=t.segments[t.segments.length-1];n&&("orthogonal"==n.type&&o.points.length>2&&(i=!1,"left"==(a=2==n.points.length?n.direction:e.datavisualization.Diagram.Util._getBezierDirection(n.points[n.points.length-2],n.points[n.points.length-1]))||"right"==a?o.points[0].y==o.points[1].y&&(i=!0,o.points[1].x-o.points[0].x,o.points.splice(0,1),o._startPoint=o.points[0],n._endPoint=o.points[0]):o.points[0].x==o.points[1].x&&(i=!0,o.points.splice(0,1),o._startPoint=o.points[0],n._endPoint=o.points[0])),n._endPoint=o._startPoint,n.points[n.points.length-1]=o._startPoint,"orthogonal"==n.type&&i?(n._length=n.length=e.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),n._length>0&&(n._direction=n.direction=this._getBezierDirection(n._startPoint,n._endPoint)),(t.segments.length>2||!t.sourcePort)&&this._addOrthogonalPoints(n,t.segments[t.segments.length-3],o,t.sourcePoint,t.targetPoint)):n.point=o._startPoint)},_initConnectionEnds:function(t,i){var a,n,o,s;if(t.segments&&t.segments[0]&&"orthogonal"==t.segments[0].type&&t.segments[0].length){if(t.sourceNode&&(o=i.nameTable[t.sourceNode]))if(n=e.datavisualization.Diagram.Util.bounds(o,!0),t.sourcePort)a=e.datavisualization.Diagram.Util.findPortByName(i.nameTable[t.sourceNode],t.sourcePort),t.sourcePoint=e.datavisualization.Diagram.Util._getPortPosition(a,n,void 0,o);else switch(t.segments[0].direction){case"left":t.sourcePoint=n.middleLeft;break;case"right":t.sourcePoint=n.middleRight;break;case"top":t.sourcePoint=n.topCenter;break;case"bottom":t.sourcePoint=n.bottomCenter}if(t.targetNode&&(s=i.nameTable[t.targetNode]))if(n=e.datavisualization.Diagram.Util.bounds(s,!0),t.targetPort)a=e.datavisualization.Diagram.Util.findPortByName(i.nameTable[t.targetNode],t.targetPort),t.targetPoint=e.datavisualization.Diagram.Util._getPortPosition(a,n,void 0,s);else switch(t.segments[0].direction){case"left":t.targetPoint=n.middleLeft;break;case"right":t.targetPoint=n.middleRight;break;case"top":t.targetPoint=n.topCenter;break;case"bottom":t.targetPoint=n.bottomCenter}}else t.sourceNode&&(n=e.datavisualization.Diagram.Util.bounds(i.nameTable[t.sourceNode],!0),t.sourcePort?(a=e.datavisualization.Diagram.Util.findPortByName(i.nameTable[t.sourceNode],t.sourcePort),t.sourcePoint=e.datavisualization.Diagram.Util._getPortPosition(a,n,void 0,i.nameTable[t.sourceNode])):t.sourcePoint=n.center),t.targetNode&&(n=e.datavisualization.Diagram.Util.bounds(i.nameTable[t.targetNode],!0),t.targetPort?(a=e.datavisualization.Diagram.Util.findPortByName(i.nameTable[t.targetNode],t.targetPort),t.targetPoint=e.datavisualization.Diagram.Util._getPortPosition(a,n,void 0,i.nameTable[t.targetNode])):t.targetPoint=n.center)},_swapDirection:function(t,e){var i,a=t%360;return a<0&&(a+=360),a>315||a<45?i=e:a<135?i={left:"top",top:"right",right:"bottom",bottom:"left"}[e]:a<225?i={left:"right",top:"bottom",right:"left",bottom:"top"}[e]:i={left:"bottom",top:"left",right:"top",bottom:"right"}[e],i},_getEllipseIntersectCoords:function(t,i,a,n,o){var s,r,l,d,h,g,c,u=t.connectorPadding;a&&(u+=o?a.targetPadding:a.sourcePadding),u||(u=0);var m=t.width/2,p=t.height/2,f=e.Matrix.identity();for(e.Matrix.rotate(f,t.rotateAngle,t.offsetX,t.offsetY),r="M "+(t.offsetX-t.width*t.pivot.x-u)+", "+t.offsetY+" A "+m+" "+p+" 0 0 1 "+(t.offsetX+t.width*(1-t.pivot.x)+u)+", "+t.offsetY+" A "+m+" "+p+" 0 0 1 "+(t.offsetX-t.width*t.pivot.x-u)+", "+t.offsetY+"z",(l=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttributeNS(null,"d",r),d=l.getTotalLength(),h=[],g=0;g<d;g+=3)c=l.getPointAtLength(g),0!=t.rotateAngle&&(c=e.Matrix.transform(f,c)),h[h.length]=c;return h[h.length-1]!=l.getPointAtLength(d)&&(h[h.length]=l.getPointAtLength(d)),s=h,this._getIntersectionPoints(i,s,!0,n)},_rightToLeft:function(t,i,a,n,o,s,r){var l,d,h,g,c,u=[];return u.push(s),h=t._srcDecoratorSize,g=t._tarDecoratorSize,r&&(g=t._srcDecoratorSize,h=t._tarDecoratorSize),0==o.width&&(h=0),0==a.width&&(g=0),c=h+g,n.x>s.x?s.y!=n.y&&(s.x>a.left?(l=o.right+h,d=s.y,u.push(e.datavisualization.Diagram.Point(l,d)),d=n.y>o.top?n.y:a.bottom+g,u.push(e.datavisualization.Diagram.Point(l,d)),n.y<=o.top&&(l=a.right+g,u.push(e.datavisualization.Diagram.Point(l,d)),d=a.top-g,u.push(e.datavisualization.Diagram.Point(l,d)),l=a.left-g,u.push(e.datavisualization.Diagram.Point(l,d)),d=n.y,u.push(e.datavisualization.Diagram.Point(l,d)))):(l=i.direction||void 0==i.length?a.left-o.right>0?o.right+(a.left-o.right)/2:o.right+h:o.right+i.length,d=s.y,u.push(e.datavisualization.Diagram.Point(l,d)),d=n.y,u.push(e.datavisualization.Diagram.Point(l,d)))):(Math.abs(a.top-o.bottom)<c||Math.abs(a.bottom-o.top)<c?s.x>a.right?(l=s.x+h,d=s.y):(l=a.right+g,d=s.y):(l=o.right+h,d=s.y),u.push(e.datavisualization.Diagram.Point(l,d)),a.top-o.bottom>=c?(d=a.top-g,u.push(e.datavisualization.Diagram.Point(l,d))):s.y>n.y?(d=o.top-a.bottom<c?a.left>o.right?a.bottom+(o.top-a.bottom)/2:Math.min(a.top-g,o.top-h):a.bottom+g,u.push(e.datavisualization.Diagram.Point(l,d))):(d=a.left>o.right?a.bottom+(o.top-a.bottom)/2:Math.max(a.bottom+g,o.bottom+h),u.push(e.datavisualization.Diagram.Point(l,d))),l=a.left-g,u.push(e.datavisualization.Diagram.Point(l,d)),d=n.y,u.push(e.datavisualization.Diagram.Point(l,d))),u.push(n),u},_rightToRight:function(t,i,a,n,o){var s,r,l,d,h=[];return h.push(o),r=o.y,l=t._srcDecoratorSize,d=t._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),i.right>=n.left?o.y>=i.top-d&&o.y<=i.bottom+d?(s=o.x+l,h.push(e.datavisualization.Diagram.Point(s,r)),o.y>=i.center.y?(r=o.x>i.left&&o.y>a.y?i.bottom+d:i.top-d,h.push(e.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(e.datavisualization.Diagram.Point(s,r))):(r=i.bottom+d,h.push(e.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(e.datavisualization.Diagram.Point(s,r)))):i.right<n.right?(s=n.right+l,h.push(e.datavisualization.Diagram.Point(s,r))):(s=a.x+d,h.push(e.datavisualization.Diagram.Point(s,r))):(s=o.x+l,h.push(e.datavisualization.Diagram.Point(s,r)),a.y>=n.top-l&&a.y<=n.bottom+l&&(a.y<=n.center.y?(r=n.top-l,h.push(e.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(e.datavisualization.Diagram.Point(s,r))):(r=n.bottom+l,h.push(e.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(e.datavisualization.Diagram.Point(s,r))))),h.push(e.datavisualization.Diagram.Point(s,a.y)),h.push(a),h},_rightToTop:function(t,i,a,n,o,s){var r,l,d,h,g,c=[];return c.push(o),l=o.y,d=t._srcDecoratorSize,h=t._tarDecoratorSize,s&&(h=t._srcDecoratorSize,d=t._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),g=d+h,a.x>=o.x+d?o.y+d>=a.y&&0!==i.height&&(r=i.left<=n.right?i.right+h:i.left-n.right>g?n.right+d:n.right+(i.left-n.right)/2,c.push(e.datavisualization.Diagram.Point(r,l)),l=i.top-h,c.push(e.datavisualization.Diagram.Point(r,l))):n.bottom+d>i.top-h?(r=o.x+d<=i.right?i.right+h:n.right+d,c.push(e.datavisualization.Diagram.Point(r,l)),l=n.top>=i.top?0!==i.height?i.top-h:a.y:n.top>=i.top-h?i.top-h-d:n.top-d,c.push(e.datavisualization.Diagram.Point(r,l))):(r=o.x+d,c.push(e.datavisualization.Diagram.Point(r,l)),i.top-n.bottom<g&&0!==i.height?n.left-i.right>=g?(l=n.bottom+d,c.push(e.datavisualization.Diagram.Point(r,l)),r=n.left-d,c.push(e.datavisualization.Diagram.Point(r,l)),l=i.top-h,c.push(e.datavisualization.Diagram.Point(r,l))):(l=i.top-(i.top-n.bottom)/2,c.push(e.datavisualization.Diagram.Point(r,l))):(l=0!==i.height?i.top-h:a.y,c.push(e.datavisualization.Diagram.Point(r,l)))),c.push(e.datavisualization.Diagram.Point(a.x,l)),c.push(a),c},_rightToBottom:function(t,i,a,n,o,s){var r,l,d,h,g,c=[];return c.push(o),l=o.y,d=t._srcDecoratorSize,h=t._tarDecoratorSize,s&&(h=t._srcDecoratorSize,d=t._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),g=d+h,a.x>=o.x?o.y<=i.bottom+h?i.left>n.right+d?(r=o.x+d,c.push(e.datavisualization.Diagram.Point(r,l)),l=i.bottom+h,c.push(e.datavisualization.Diagram.Point(r,l))):(r=i.right+h,c.push(e.datavisualization.Diagram.Point(r,l)),l=i.bottom+h,c.push(e.datavisualization.Diagram.Point(r,l))):n.right+d>a.x?(r=o.x+d,c.push(e.datavisualization.Diagram.Point(r,l)),l=n.top-i.bottom>g?i.bottom+h:i.bottom+(n.top-i.bottom)/2,c.push(e.datavisualization.Diagram.Point(r,l))):l=o.y:o.y<=i.bottom?(r=n.right+d>i.right?n.right+d:i.right+h,c.push(e.datavisualization.Diagram.Point(r,l)),(l=i.bottom+h)<=n.bottom+d&&(l=n.bottom+d),c.push(e.datavisualization.Diagram.Point(r,l))):i.bottom+h<n.top-d?(r=n.right+d,c.push(e.datavisualization.Diagram.Point(r,l)),l=n.top-i.bottom<g?i.bottom+(n.top-i.bottom)/2:i.bottom+h,c.push(e.datavisualization.Diagram.Point(r,l))):(r=n.right+d,c.push(e.datavisualization.Diagram.Point(r,l)),l=n.bottom+d,c.push(e.datavisualization.Diagram.Point(r,l))),c.push(e.datavisualization.Diagram.Point(a.x,l)),c.push(a),c},_leftToLeft:function(t,i,a,n,o){var s,r,l,d,h,g=[];return g.push(o),r=o.y,l=t._srcDecoratorSize,d=t._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),h=l+d,a.x-d>=o.x-l?(s=n.left-l,g.push(e.datavisualization.Diagram.Point(s,r)),o.y>a.y?a.y+d>=n.top?(r=n.top-l,g.push(e.datavisualization.Diagram.Point(s,r)),s=i.left-n.right>h?i.left-d:n.right+(i.left-n.right)/2,g.push(e.datavisualization.Diagram.Point(s,r))):(r=a.y,g.push(e.datavisualization.Diagram.Point(s,r)),s=a.x):n.bottom+l<a.y?(r=a.y,g.push(e.datavisualization.Diagram.Point(s,r)),s=a.x):(r=n.bottom+l,g.push(e.datavisualization.Diagram.Point(s,r)),s=i.left-n.right>h?i.left-d:n.right+(i.left-n.right)/2,g.push(e.datavisualization.Diagram.Point(s,r)))):(a.y>o.y?o.y>i.top-d&&(s=n.left-i.right<h?i.right+(n.left-i.right)/2:n.left-l,g.push(e.datavisualization.Diagram.Point(s,r)),r=i.top-d,g.push(e.datavisualization.Diagram.Point(s,r))):i.bottom+d>=o.y&&(s=n.left-i.right<h?i.right+(n.left-i.right)/2:n.left-l,g.push(e.datavisualization.Diagram.Point(s,r)),r=i.bottom+d,g.push(e.datavisualization.Diagram.Point(s,r)),s=i.left-d,g.push(e.datavisualization.Diagram.Point(s,r))),s=i.left-d,g.push(e.datavisualization.Diagram.Point(s,r))),g.push(e.datavisualization.Diagram.Point(s,a.y)),g.push(a),g},_leftToTop:function(t,i,a,n,o,s){var r,l,d,h,g=[];return g.push(o),l=o.y,d=t._srcDecoratorSize,h=t._tarDecoratorSize,s&&(h=t._srcDecoratorSize,d=t._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),o.x<=a.x?(r=o.y>a.y&&i.left<=n.left?i.left-h:n.left-d,g.push(e.datavisualization.Diagram.Point(r,l)),l=n.bottom<=i.top?n.bottom+d<i.top-h?0!==i.height?i.top-h:a.y:a.x<n.right?n.bottom+(i.top-n.bottom)/2:n.top-d:n.top-d>=i.top-h?0!==i.height?i.top-h:a.y:n.top-d,g.push(e.datavisualization.Diagram.Point(r,l))):a.y<=o.y+d&&(r=n.left-d>i.right+h?n.left-d:i.right+h>=n.left-d?i.left-h:i.right+(n.left-i.right)/2,g.push(e.datavisualization.Diagram.Point(r,l)),l=i.top-h,g.push(e.datavisualization.Diagram.Point(r,l))),g.push(e.datavisualization.Diagram.Point(a.x,l)),g.push(a),g},_leftToBottom:function(t,i,a,n,o,s){var r,l,d,h,g,c=[];return c.push(o),l=o.y,d=t._srcDecoratorSize,h=t._tarDecoratorSize,s&&(h=t._srcDecoratorSize,d=t._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),g=d+h,o.x-d<=a.x?(r=i.left<=o.x&&o.y<=i.top?i.left-h:n.left-d,c.push(e.datavisualization.Diagram.Point(r,l)),i.bottom+h<n.top-d?(l=n.top-i.bottom<g?i.bottom+(n.top-i.bottom)/2:i.bottom+h,c.push(e.datavisualization.Diagram.Point(r,l))):(l=i.bottom<n.bottom?n.bottom+d:i.bottom+h,c.push(e.datavisualization.Diagram.Point(r,l)))):o.y-d>a.y||(r=i.right>=n.left?i.left-h:n.left-i.right<g?n.left-(n.left-i.right)/2:n.left-d,c.push(e.datavisualization.Diagram.Point(r,l)),l=i.bottom+h,c.push(e.datavisualization.Diagram.Point(r,l))),c.push(e.datavisualization.Diagram.Point(a.x,l)),c.push(a),c},_topToTop:function(t,i,a,n,o){var s,r,l,d,h,g=[];return g.push(o),s=o.x,l=t._srcDecoratorSize,d=t._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),h=l+d,a.x>=o.x?a.y-d>=o.y-l?(r=n.top-l,g.push(e.datavisualization.Diagram.Point(s,r)),a.x<=n.right&&(s=n.right+l,g.push(e.datavisualization.Diagram.Point(s,r)),r=0!==i.height?i.top-n.bottom>h?i.top-d:n.bottom+(i.top-n.bottom)/2:a.y,g.push(e.datavisualization.Diagram.Point(s,r)))):i.left<=o.x?(r=n.top-i.bottom>h?n.top-l:i.bottom+(n.top-i.bottom)/2,g.push(e.datavisualization.Diagram.Point(s,r)),s=i.left-d,g.push(e.datavisualization.Diagram.Point(s,r)),r=i.top-d,g.push(e.datavisualization.Diagram.Point(s,r))):(r=0!==i.height?i.top-d:a.y,g.push(e.datavisualization.Diagram.Point(s,r))):a.y-d>=o.y-l?(r=n.top-l,g.push(e.datavisualization.Diagram.Point(s,r)),a.x>=n.left&&(s=n.left-l,g.push(e.datavisualization.Diagram.Point(s,r)),r=0!==i.height?i.top-n.bottom>h?i.top-d:n.bottom+(i.top-n.bottom)/2:a.y,g.push(e.datavisualization.Diagram.Point(s,r)))):i.right>=o.x?(r=n.top-i.bottom>h?n.top-l:i.bottom+(n.top-i.bottom)/2,g.push(e.datavisualization.Diagram.Point(s,r)),s=i.right+d,g.push(e.datavisualization.Diagram.Point(s,r)),r=i.top-d,g.push(e.datavisualization.Diagram.Point(s,r))):(r=0!==i.height?i.top-d:a.y,g.push(e.datavisualization.Diagram.Point(s,r))),s=a.x,g.push(e.datavisualization.Diagram.Point(s,r)),g.push(a),g},_topToBottom:function(t,i,a,n,o,s,r){var l,d,h,g,c,u=[];return u.push(s),l=s.x,h=t._srcDecoratorSize,g=t._tarDecoratorSize,r&&(g=t._srcDecoratorSize,h=t._tarDecoratorSize),0==o.width&&(h=0),0==a.width&&(g=0),c=h+g,n.x>s.x?(o.top>=a.bottom?o.top-a.bottom>0?(d=void 0==i.length||i.direction?o.top-a.bottom>0?a.bottom+(o.top-a.bottom)/2:a.bottom+g:a.bottom+i.length,u.push(e.datavisualization.Diagram.Point(l,d))):(d=o.top-h,u.push(e.datavisualization.Diagram.Point(l,d)),l=a.left-o.right>=c?o.right+h:o.right+(a.left-o.right)/2,u.push(e.datavisualization.Diagram.Point(l,d)),d=a.bottom+g,u.push(e.datavisualization.Diagram.Point(l,d))):(d=a.top<o.top?a.left>=o.right+h?o.top-h:a.top-g:o.top-h,u.push(e.datavisualization.Diagram.Point(l,d)),l=a.left>=o.right+h?o.right+h:a.right+g,u.push(e.datavisualization.Diagram.Point(l,d)),d=a.bottom+g,u.push(e.datavisualization.Diagram.Point(l,d))),u.push(e.datavisualization.Diagram.Point(n.x,d))):n.x<s.x&&(o.top>=a.bottom?o.top-a.bottom>0?(d=void 0==i.length||i.direction?o.top-a.bottom>0?a.bottom+(o.top-a.bottom)/2:a.bottom+g:a.bottom+i.length,u.push(e.datavisualization.Diagram.Point(l,d))):(d=o.top-h,u.push(e.datavisualization.Diagram.Point(l,d)),l=o.left-a.right>=c?o.left-h:a.right+(o.left-a.right)/2,u.push(e.datavisualization.Diagram.Point(l,d)),d=a.bottom+g,u.push(e.datavisualization.Diagram.Point(l,d))):(o.left,a.right,d=o.top-h,u.push(e.datavisualization.Diagram.Point(l,d)),l=o.left>=a.right+g||o.right+h<a.right+g?a.right+g:o.right+h,u.push(e.datavisualization.Diagram.Point(l,d)),d=o.left>=a.right+g?a.bottom+g:a.bottom<=o.bottom?o.bottom+h:a.bottom+g,u.push(e.datavisualization.Diagram.Point(l,d))),u.push(e.datavisualization.Diagram.Point(n.x,d))),u.push(n),u},_bottomToBottom:function(t,i,a,n,o){var s,r,l,d,h,g=[];return g.push(o),s=o.x,l=t._srcDecoratorSize,d=t._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),h=l+d,a.x>=o.x?n.bottom+l>=i.bottom+l?(r=n.bottom+l,g.push(e.datavisualization.Diagram.Point(s,r)),a.x<n.right&&(s=n.right+l,g.push(e.datavisualization.Diagram.Point(s,r)),r=n.top-l>=i.bottom+d?n.top-i.bottom>=h?i.bottom+d:i.bottom+(n.top-i.bottom)/2:i.bottom+d,g.push(e.datavisualization.Diagram.Point(s,r)))):o.x>i.left?(r=i.bottom-n.bottom>=h?n.bottom+l:n.bottom+(i.bottom-n.bottom)/2,g.push(e.datavisualization.Diagram.Point(s,r)),s=i.left-d,g.push(e.datavisualization.Diagram.Point(s,r)),r=i.bottom+d,g.push(e.datavisualization.Diagram.Point(s,r))):(r=i.bottom+d,g.push(e.datavisualization.Diagram.Point(s,r))):n.bottom+l>=i.bottom+l?(r=n.bottom+l,g.push(e.datavisualization.Diagram.Point(s,r)),a.x>n.left&&(s=n.left-l,g.push(e.datavisualization.Diagram.Point(s,r)),r=n.top-l>=i.bottom+d?n.top-i.bottom>=h?i.bottom+d:i.bottom+(n.top-i.bottom)/2:i.bottom+d,g.push(e.datavisualization.Diagram.Point(s,r)))):o.x<i.right?(r=i.bottom-n.bottom>=h?n.bottom+l:n.bottom+(i.bottom-n.bottom)/2,g.push(e.datavisualization.Diagram.Point(s,r)),s=i.right+d,g.push(e.datavisualization.Diagram.Point(s,r)),r=i.bottom+d,g.push(e.datavisualization.Diagram.Point(s,r))):(r=i.bottom+d,g.push(e.datavisualization.Diagram.Point(s,r))),g.push(e.datavisualization.Diagram.Point(a.x,r)),g.push(a),g},_addOrthogonalPoints:function(t,i,a,n,o,s){var r,l,d,h,g=[],c=i?i._endPoint:n;g.push(c),t._direction||(t._direction=this._getOrthoDirection(c,o,i)),"auto"!==t._direction||i||a||(t._direction=this._getBezierDirection(c,o));var u,m=s||0==s?s:this._directionToAngle(t._direction||this._getBezierDirection(c,o));if("left"==(u=t._direction)||"right"==u||"top"==u||"bottom"==u)m={right:0,left:180,top:270,bottom:90,auto:90}[u];else switch(u){case"straight":m=0;break;case"clockWise90":m+=90;break;case"opposite":m+=180;break;case"antiClockWise90":m+=270}if((t.length||0==t.length)&&t.direction)(d=e.datavisualization.Diagram.Geometry.transform(c,m||0,t._length)).x=Math.round(100*d.x)/100,d.y=Math.round(100*d.y)/100,g.push(d),t._endPoint=d,a&&(a._startPoint=t._endPoint,a.points&&(a.points[0]=t._endPoint,"bezier"==a.type&&this._updateBezierPoints(a)));else{if(c.x!=o.x&&c.y!=o.y||i&&i._startPoint.x==o.x){var p=20,f=o.x-(d?d.x:c.x),_=o.y-(d?d.y:c.y);switch(f=Math.abs(f)<=1e-4?0:f,_=Math.abs(_)<=1e-4?0:_,m){case 0:if(o.x<c.x)break;l=Math.abs(c.x-o.x)<30;break;case 180:if(o.x>c.x)break;l=Math.abs(c.x-o.x)<30;break;case 90:if(o.y<c.y)break;l=Math.abs(c.y-o.y)<30;break;case 270:if(o.y>c.y)break;l=Math.abs(c.y-o.y)<30}i?r=i&&i._startPoint.x==o.x?3:0==f||0==_?2:3:(l?(r=2,(p=90==m||270==m?Math.abs(c.y-o.y):Math.abs(c.x-o.x))<10&&(p+=20,r=3)):r=3,(2!=r||Math.abs(_)>1&&Math.abs(f)>1)&&(d=e.datavisualization.Diagram.Geometry.transform(c,m,p))),3==r&&("left"==(u="auto"==t._direction?i?"left"==i._direction||"right"==i.direction?"left":"top":"bottom":t._direction)||"right"==u||0==_?(_=_>0?_:-_,h=e.datavisualization.Diagram.Geometry.transform(d||c,90,o.y-(d?d.y:c.y))):(f=f>0?f:-f,h=e.datavisualization.Diagram.Geometry.transform(d||c,0,o.x-(d?d.x:c.x)))),d&&(d.x=Math.round(100*d.x)/100,d.y=Math.round(100*d.y)/100,g.push(d)),h&&(h.x=Math.round(100*h.x)/100,h.y=Math.round(100*h.y)/100,g.push(h))}t._direction=this._getBezierDirection(g[g.length-1],o),g.push(o),t._endPoint=o,a&&(a._startPoint=t._endPoint,a.points||(a.points=[]),a.points[0]=t._endPoint,"bezier"==a.type&&this._updateBezierPoints(a))}return t.points=g,m},_getOrthoDirection:function(t,e,i){if(i){var a=e;return Math.abs(a.x-t.x)>Math.abs(a.y-t.y)&&i&&("left"==i._direction||"right"==i._direction)?t.x<a.x?"right":"left":t.y<a.y?"bottom":"top"}return t.y<e.y?"bottom":t.y>e.y?"top":t.x<e.x?"right":t.x>e.x?"left":void 0},_directionToAngle:function(t){return{right:0,left:180,top:270,bottom:90,auto:90}[t]},_resetOrthogonalPoints:function(t){var e,i=[];i.push(t.sourcePoint),i.push(t.targetPoint),t.points=[],t.sourcePoint=i[0],t.points.push(i[0]),e=this._constructOrthogonalPoints(i[0],i[1]),t.points.push(e[0]),t.points.push(e[1]),t.targetPoint=i[1],t.points.push(i[1])},_updateBezierPoints:function(t,i,a,n,o,s,r){var l,d,h,g,c,u={right:0,left:180,top:270,bottom:90};(t.vector1||t.vector2)&&(t.vector1&&(t._point1=e.datavisualization.Diagram.Geometry.transform(t._startPoint,t.vector1.angle,t.vector1.distance)),t.vector2&&(t._point2=e.datavisualization.Diagram.Geometry.transform(t._endPoint,t.vector2.angle,t.vector2.distance))),(null!=t.point1||t.vector1)&&(null!=t.point2||t.vector2)||(d=t._endPoint,h=t._startPoint,s?(l=r,h=this._getPortPosition(s,l),0!==o.rotateAngle&&(c=e.Matrix.identity(),e.Matrix.rotate(c,o.rotateAngle,o.offsetX,o.offsetY),h=e.Matrix.transform(c,h)),g=this._getDirection(l,h,!0)):g=this._getBezierDirection(h,d),t.vector1||(t._point1=t.point1||this._getBezierAdjPoint(u[g],t._startPoint,t._endPoint)),a?(l=n,d=this._getPortPosition(a,l),0!==i.rotateAngle&&(c=e.Matrix.identity(),e.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),d=e.Matrix.transform(c,d)),g=this._getDirection(l,d,!0)):g=this._getBezierDirection(d,h),t.vector2||(t._point2=t.point2||this._getBezierAdjPoint(u[g],t._endPoint,t._startPoint)))},_getBezierDirection:function(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?t.x<e.x?"right":"left":t.y<e.y?"bottom":"top"},_findDocAngle:function(t,e){var i={x:e.x,y:t.y},a=(this.findLength(t,i),this.findLength(i,e)),n=this.findLength(e,t),o=Math.asin(a/n);return o=180*(o=isNaN(o)?0:o)/Math.PI,t.x<e.x?t.y<e.y||(o=360-o):o=t.y<e.y?180-o:180+o,o},_getDirection:function(t,i,a){var n,o,s,r,l,d,h,g=t.center;return a?(t.points,n=h=a?45:180/(2+2/(t.height/t.width)),s=(o=180-h)+2*h,r=360-h,l=(d=e.datavisualization.Diagram.Geometry.findAngle(i,g))>n&&d<o?"top":d>o&&d<s?"right":d>s&&d<r?"bottom":"left"):(d=this._findDocAngle(g,i),n=this._findDocAngle(g,t.bottomRight),o=this._findDocAngle(g,t.bottomLeft),s=this._findDocAngle(g,t.topLeft),r=this._findDocAngle(g,t.topRight),d>s&&d<r?l="top":d>=n&&d<o?l="bottom":d>=o&&d<=s?l="left":(d>=r||d<n)&&(l="right")),l},_getBezierAdjPoint:function(t,i,a){var n=60,o=e.datavisualization.Diagram.Point(0,0);switch(t>45&&t<135?"Bottom":t>135&&t<225?"Left":t>225&&t<315?"Top":"Right"){case"Right":n=Math.min(.45*Math.abs(i.x-a.x),n),o=e.datavisualization.Diagram.Point(i.x+n,i.y);break;case"Bottom":n=Math.min(.45*Math.abs(i.y-a.y),n),o=e.datavisualization.Diagram.Point(i.x,i.y+n);break;case"Left":n=Math.min(.45*Math.abs(i.x-a.x),n),o=e.datavisualization.Diagram.Point(i.x-n,i.y);break;case"Top":n=Math.min(.45*Math.abs(i.y-a.y),n),o=e.datavisualization.Diagram.Point(i.x,i.y-n)}return o},_setLineEndPoint:function(t,e,i){var a,n,o,s,r=t;e.x=Math.round(100*e.x)/100,e.y=Math.round(100*e.y)/100,i?(a=t.segments[t.segments.length-1],r.targetPoint=e,"orthogonal"!=a.type&&(a.point&&(a.point=e),a._point=e),a.points[a.points.length-1]=e,a._endPoint=e):(r.sourcePoint=e,(n=t.segments[0]).points[0]=e,n._startPoint=e,"orthogonal"!=n.type||t.sourcePort||t._staticLength||(n.length||0===n.length)&&n.direction&&2==n.points.length&&("left"==n._direction||"right"==n._direction?(n._endPoint.y=n._startPoint.y,o=Math.abs(n._startPoint.x-n._endPoint.x)):(n._endPoint.x=n._startPoint.x,o=Math.abs(n._startPoint.y-n._endPoint.y)),t.segments[0]._length=o,t.segments[0].length=t.segments[0]._length,t.segments[0].direction=t.segments[0]._direction)),"orthogonal"!==(s=i?t.segments[t.segments.length-1]:t.segments[0]).type||(i||t.sourcePort)&&(!i||t.targetPort)||t.sourceNode&&t.targetNode&&!(t.segments.length>1)?"bezier"===s.type&&this._updateBezierPoints(s):(s.points=[],this._addOrthogonalPoints(s,i?t.segments[t.segments.length-2]:null,i?null:t.segments[1],t.sourcePoint,t.targetPoint))},_setBezierPoint:function(t,i,a){"bezierpoint1"===a?t.vector1?(t.vector1={distance:e.datavisualization.Diagram.Geometry.distance(t._startPoint,i),angle:e.datavisualization.Diagram.Geometry.findAngle(t._startPoint,i)},t._point1=i):t.point1=t._point1=i:t.vector2?(t.vector2={distance:e.datavisualization.Diagram.Geometry.distance(t._endPoint,i),angle:e.datavisualization.Diagram.Geometry.findAngle(t._endPoint,i)},t._point2=i):t.point2=t._point2=i},_setPoints:function(t,e){t.sourcePoint=t.points[0]=e[0],t.targetPoint=t.points[t.points.length-1]=e[e.length-1],t.points=e,"bezier"===t.type&&(t.point1=e[2]||t.point1,t.point2=e[3]||t.point2,t.point1||(t._point1=t.point1),t.point2||(t._point2=t.point2),this._updateBezierPoints(t))},_updateConnectorSegments:function(t,i,a,n){for(var o,s=t.sourcePoint,r=0;r<t.segments.length;r++){var l=t.segments[r],d=t.segments[r-1],h=t.segments[r+1];l._startPoint=d?d._endPoint:s,0==r&&i||r==t.segments.length-1&&a||("orthogonal"==l.type?o=e.datavisualization.Diagram.Util._addOrthogonalPoints(l,d,h,t.sourcePoint,t.targetPoint,o):(o=e.datavisualization.Diagram.Geometry.findAngle(s,l._endPoint),"bezier"==l.type&&this._updateBezierPoints(l))),s=l._endPoint}n&&n._dock(t,n.nameTable)},_translateLine:function(t,i,a){for(var n,o,s=0;s<t.segments.length;s++){for(n=t.segments[s],o=0;o<n.points.length;o++)0==o?(n._startPoint=n.points[o]=e.datavisualization.Diagram.Geometry.translate(n.points[o],i,a),0==s&&(t.sourcePoint=n._startPoint)):o==n.points.length-1?(n._endPoint=n.points[o]=e.datavisualization.Diagram.Geometry.translate(n.points[o],i,a),s==t.segments.length-1&&(t.targetPoint=n._endPoint)):n.points[o]=e.datavisualization.Diagram.Geometry.translate(n.points[o],i,a);n.type===e.datavisualization.Diagram.Segments.Bezier?(n._point1=e.datavisualization.Diagram.Geometry.translate(n._point1,i,a),n._point2=e.datavisualization.Diagram.Geometry.translate(n._point2,i,a),n.point1&&(n.point1=n._point1),n.point2&&(n.point2=n._point2),n.point&&(n.point=n._endPoint),n._point=n._endPoint):"straight"==n.type&&(n.point&&(n.point=n._endPoint),n._point=n._endPoint)}},_adjustPoint:function(t,i,a,n){var o,s=a?{x:t.x,y:t.y}:{x:i.x,y:i.y};return t.x==i.x?t.y<i.y&&a||t.y>i.y&&!a?s.y+=n:s.y-=n:t.y==i.y?t.x<i.x&&a||t.x>i.x&&!a?s.x+=n:s.x-=n:a?(o=e.datavisualization.Diagram.Geometry.findAngle(t,i),s=e.datavisualization.Diagram.Geometry.transform(t,o,n)):(o=e.datavisualization.Diagram.Geometry.findAngle(i,t),s=e.datavisualization.Diagram.Geometry.transform(i,o,n)),s},_getIconPosition:function(t,i,a){var n,o,s,r,l,d,h;if(t)return n=t.margin.left-t.margin.right,o=t.margin.top-t.margin.bottom,s=t.offset.x,r=t.offset.y,a?(((l=e.datavisualization.Diagram.Point(i.width*s+n,i.height*r+o)).x>i.width||l.y>i.height)&&(l=e.datavisualization.Diagram.Point(i.width*s,i.height*r)),l):(d=i.center.x-i.width/2+i.width*s+n,h=i.center.y-i.height/2+i.height*r+o,e.datavisualization.Diagram.Point(d,h))},_rBounds:function(t,i){var a,n,o,s={};return t?(s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height,s.rotateAngle=i):s=e.datavisualization.Diagram.Rectangle(),s?(a={},s.x=Math.round(100*s.x)/100,s.y=Math.round(100*s.y)/100,s.width=Math.round(100*s.width)/100,s.height=Math.round(100*s.height)/100,a.width=s.width,a.height=s.height,a.x=a.left=s.x,a.right=s.x+s.width,a.y=a.top=s.y,a.bottom=s.y+s.height,a.center={x:s.x+s.width/2,y:s.y+s.height/2},a.topLeft={x:s.x,y:s.y},a.topCenter={x:s.x+s.width/2,y:s.y},a.topRight={x:s.x+s.width,y:s.y},a.middleLeft={x:s.x,y:s.y+s.height/2},a.middleRight={x:s.x+s.width,y:s.y+s.height/2},a.bottomLeft={x:s.x,y:s.y+s.height},a.bottomCenter={x:s.x+s.width/2,y:s.y+s.height},a.bottomRight={x:s.x+s.width,y:s.y+s.height},s&&s.rotateAngle&&(n=e.Matrix.identity(),e.Matrix.rotate(n,s.rotateAngle,s.x+s.width/2,s.y+s.height/2),a.topLeft=e.Matrix.transform(n,a.topLeft),a.topCenter=e.Matrix.transform(n,a.topCenter),a.topRight=e.Matrix.transform(n,a.topRight),a.middleLeft=e.Matrix.transform(n,a.middleLeft),a.middleRight=e.Matrix.transform(n,a.middleRight),a.bottomLeft=e.Matrix.transform(n,a.bottomLeft),a.bottomCenter=e.Matrix.transform(n,a.bottomCenter),a.bottomRight=e.Matrix.transform(n,a.bottomRight),o=e.datavisualization.Diagram.Geometry.rect([a.topLeft,a.topRight,a.bottomRight,a.bottomLeft]),a.x=a.left=o.x,a.y=a.top=o.y,a.right=o.x+o.width,a.bottom=o.y+o.height,a.center=e.datavisualization.Diagram.Point(o.x+o.width/2,o.y+o.height/2),a.width=-a.topLeft.x+a.right,a.height=-a.topRight.y+a.bottom),a.points=[a.topLeft,a.topRight,a.bottomRight,a.bottomLeft],a):s},_getLabelPosition:function(t,i,a,n,o,s){var r,l,d,h;return s&&(r=s.getBBox(),l=this._rBounds(r,t.rotateAngle)),d=i.width*(a?a.x:t.offset.x),h=i.height*(a?a.y:t.offset.y),"left"==t.horizontalAlignment?d+=t.margin.left:"right"==t.horizontalAlignment?d-=t.margin.right:d+=t.margin.left-t.margin.right+(o?-(l?l.width:i.width)/2:0),"top"==t.verticalAlignment?h+=t.margin.top:"bottom"==t.verticalAlignment?h-=t.margin.bottom:h+=t.margin.top-t.margin.bottom+(n?t.fontSize/2:0),e.datavisualization.Diagram.Point(d,h)},_getPortPosition:function(t,i,a,n){var o,s,r;if(t){var l=(t.margin.left?t.margin.left:0)+(t.margin.right?t.margin.right:0),d=(t.margin.top?t.margin.top:0)+(t.margin.bottom?t.margin.bottom:0),h=t.offset.x,g=t.offset.y;return n&&((o="none"!==n.flip?n.flip:n._flip)&&o!==e.datavisualization.Diagram.FlipDirection.None&&(o===e.datavisualization.Diagram.FlipDirection.Horizontal?h=1-t.offset.x:o===e.datavisualization.Diagram.FlipDirection.Vertical?g=1-t.offset.y:o===e.datavisualization.Diagram.FlipDirection.Both&&(h=1-t.offset.x,g=1-t.offset.y))),a?e.datavisualization.Diagram.Point(i.width*t.offset.x+l,i.height*t.offset.y+d):(s=i.center.x-i.width/2+i.width*h+l,r=i.center.y-i.height/2+i.height*g+d,e.datavisualization.Diagram.Point(s,r))}},flipConnector:function(t,i){var a,n;i&&i!==e.datavisualization.Diagram.FlipDirection.None&&(t.sourceNode||t.targetNode||(i==e.datavisualization.Diagram.FlipDirection.Horizontal?(a={x:t.targetPoint.x,y:t.sourcePoint.y},n={x:t.sourcePoint.x,y:t.targetPoint.y}):i==e.datavisualization.Diagram.FlipDirection.Vertical?(a={x:t.sourcePoint.x,y:t.targetPoint.y},n={x:t.targetPoint.x,y:t.sourcePoint.y}):i==e.datavisualization.Diagram.FlipDirection.Both&&(a=t.targetPoint,n=t.sourcePoint),a&&n&&(this._setLineEndPoint(t,a,!1),this._setLineEndPoint(t,n,!0))))},_translate:function(t,i,a,n,o,s){var r,l,d;if(t.segments)e.datavisualization.Diagram.Util._translateLine(t,i,a,t);else if(t.offsetX+=i,t.offsetY+=a,"group"===t._type&&!o){for(r=s._getChildren(t.children),d=0;d<r.length;d++)l=n[r[d]],this._translate(l,i,a,n,null,s),l.parent&&l.parent!=t.name&&"pseudoGroup"!=t.type&&e.datavisualization.Diagram.Util._updateGroupBounds(n[l.parent],s);"group"!=t._type&&t.container&&e.datavisualization.Diagram.Util._updateGroupBounds(t,s)}},scale:function(t,i,a,n,o,s,r,l,d){var h,g,c,u,m,p,f,_,v;if(t.container)switch(t.container.type){case"canvas":p={},v=e.Matrix.identity(),e.Matrix.rotate(v,-t.rotateAngle,n.x,n.y),e.Matrix.scale(v,i,a,n.x,n.y),e.Matrix.rotate(v,t.rotateAngle,n.x,n.y),y=e.Matrix.transform(v,e.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),b=t.width*i,x=t.height*a,r&&(t.minHeight=x,t.minWidth=b),1!=l?p=d._getMinMaxSize(t,b,x):(p.width=b,p.height=x),p&&p.width>1&&(f=t.offsetX-t.width/2,t.width=p.width,t.offsetX=f+t.width/2),p&&p.height>1&&(_=t.offsetY-t.height/2,t.height=p.height,t.offsetY=_+t.height/2);break;case"stack":v=e.Matrix.identity(),e.Matrix.rotate(v,-t.rotateAngle,n.x,n.y),e.Matrix.scale(v,i,a,n.x,n.y),e.Matrix.rotate(v,t.rotateAngle,n.x,n.y),y=e.Matrix.transform(v,e.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),b=t.width*i-(t.marginLeft+t.marginRight),x=t.height*a-(t.marginTop+t.marginBottom),(p=d._getMinMaxSize(t,b,x)).width>1&&(f=t.offsetX-t.width/2,t.width=p.width-t.marginLeft,t.offsetX=f+t.width/2+t.marginLeft),p.height>1&&(_=t.offsetY-t.height/2,t.height=p.height-t.marginTop,t.offsetY=_+t.height/2+t.marginTop),e.datavisualization.Diagram.SvgContext._alignOnStack(t,d)}else if(v=e.Matrix.identity(),t.segments)for(e.Matrix.scale(v,i,a,n.x,n.y),c=0;c<t.segments.length;c++){for(u=t.segments[c],m=0;m<u.points.length;m++)u.points[m]=e.Matrix.transform(v,u.points[m]),0!=c||0!=m||t.sourceNode||(u._startPoint=u.points[0],u._endPoint=u.points[u.points.length-1],e.datavisualization.Diagram.Util._setLineEndPoint(t,e.Matrix.transform(v,t.sourcePoint),!1)),c!=t.segments.length-1||m!=u.points.length-1||t.targetNode||(u._startPoint=u.points[0],u._endPoint=u.points[u.points.length-1],t.targetPoint=u._endPoint);u._startPoint=u.points[0],u._endPoint=u.points[u.points.length-1],"orthogonal"==u.type?u.length||0===u.length?u.length=u._length=e.datavisualization.Diagram.Geometry.distance(u._startPoint,u._endPoint):e.datavisualization.Diagram.Util._addOrthogonalPoints(u,t.segments[c-1],t.segments[c+1],t.sourcePoint,t.targetPoint):(u.point&&(u.point=u._endPoint),u._point=u._endPoint)}else if("group"===t._type){for(h=d._getChildren(t.children),c=0;c<h.length;c++)(g=o[h[c]])&&(this.scale(g,i,a,n,o,void 0,void 0,void 0,d),g.parent&&g.parent!=t.name&&"pseudoGroup"!=t.type&&e.datavisualization.Diagram.Util._updateGroupBounds(o[g.parent],d));e.datavisualization.Diagram.Util._updateGroupBounds(t,d)}else{e.Matrix.rotate(v,-t.rotateAngle,n.x,n.y),e.Matrix.scale(v,i,a,n.x,n.y),e.Matrix.rotate(v,t.rotateAngle,n.x,n.y);var y=e.Matrix.transform(v,e.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),b=t.width*i,x=t.height*a;b>1&&(t.width=b,t.offsetX=y.x),x>1&&(t.height=x,t.offsetY=y.y)}},_getIntersectingElement:function(t,i){for(var a,n,o,s,r=e.datavisualization.Diagram.SpatialUtil.findQuads(t._spatialSearch,i),l=[],d=0;d<r.length;d++)if((a=r[d]).objects.length>0)for(n=0;n<a.objects.length;n++)(o=a.objects[n]).visible&&(s=e.datavisualization.Diagram.Util.bounds(o),e.datavisualization.Diagram.Geometry.intersectsRect(i,s)&&(o=t._sortByZIndex(o,!0),l.push(o)));return l},_getIntersectingNodeElement:function(t,i){for(var a,n,o,s,r=e.datavisualization.Diagram.SpatialUtil.findQuads(t._spatialSearch,i),l=[],d=0;d<r.length;d++)if((a=r[d]).objects.length>0)for(n=0;n<a.objects.length;n++)(o=a.objects[n]).visible&&(s=e.datavisualization.Diagram.Util.bounds(o),e.datavisualization.Diagram.Geometry.intersectsRect(i,s)&&((o=t._sortByZIndex(o,!0)).segments||l.push(o)));return l},_updateChildBounds:function(t,i){var a,n,o,s,r,l,d;o=t.width,s=t.height,a=t.offsetX,n=t.offsetY,r=e.datavisualization.Diagram.Util._getChildrenBounds(t,i),t.offsetX=r.x+r.width/2,t.offsetY=r.y+r.height/2,t.height=r.height,t.width=r.width,l=o/t.width,d=s/t.height,this.scale(t,l,d,t.pivot,i.nameTable,null,null,null,i),this._translate(t,a-t.offsetX,n-t.offsetY,i.nameTable,null,i)},_updateGroupBounds:function(t,i,a,n){var o,s,r,l,d,h,g;if(t&&!t.container&&t&&("pseudoGroup"===t.type||t.children&&t.children.length>0)){o=t.width,s=t.height,r=t.offsetX,l=t.offsetY,n&&this._updateRotateAngle(t,i.nameTable);var c=this._getChildrenBounds(t,i,a),u={x:c.x+c.width*t.pivot.x,y:c.y+c.height*t.pivot.y};if(t.rotateAngle&&(!i._isNodeInitializing||i._isGroupNode)&&(d=e.Matrix.identity(),e.Matrix.rotate(d,t.rotateAngle),u=e.Matrix.transform(d,u)),c&&(t.offsetX=u.x,t.offsetY=u.y,t.width=c.width,t.height=c.height),a){if(h=null,t.children&&t.children.length>0)for(g=0;g<t.children.length;g++)i._getChild(t.children[g])&&(h=i.nameTable[i._getChild(t.children[g])]),h&&("group"===h._type||h.children&&h.children.length>0)&&this._updateGroupBounds(h,i,a);o&&o!=t.width&&i.scale(t,o/t.width,1,new e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),i.nameTable,void 0,void 0,void 0,i),s&&s!=t.height&&i.scale(t,1,s/t.height,new e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),i.nameTable,void 0,void 0,void 0,i),r&&r!=t.offsetX&&i._translate(t,r-t.offsetX,1,i.nameTable,void 0),r&&l!=t.offsetY&&i._translate(t,1,l-t.offsetY,i.nameTable,void 0)}}},_getChildrenBounds:function(t,i,a){var n,o,s,r,l=i._getChildren(t.children),d=e.datavisualization.Diagram.Rectangle();for(l.length>0&&((o=i.nameTable[l[0]])&&(d=this._rotateChildBounds(o,t,i))),s=0,r=l.length;s<r;s++)(o=i.nameTable[l[s]])&&(i.selectedItem||!o._isInternalShape)&&("group"===o._type?(this._updateGroupBounds(o,i,a),n=this._rotateChildBounds(o,t,i)):n=this._rotateChildBounds(o,t,i)),n&&(d=e.datavisualization.Diagram.Geometry.union(d,n));return d},_updateRotateAngle:function(t,e){var i,a;if(0==t.offsetX&&0==t.offsetY&&0==t.width&&0==t.height)for(i=0;i<t.children.length;i++)if((a=e[t.children[i]])&&!a.segments&&!t.rotateAngle)return void(t.rotateAngle=a.rotateAngle)},_rotateChildBounds:function(t,i,a){var n,o;if(t.segments||(i.rotateAngle||t.rotateAngle)&&(!a._isNodeInitializing||a._isGroupNode)){n=this.bounds(t),o=e.Matrix.identity(),e.Matrix.rotate(o,-i.rotateAngle);var s=e.Matrix.transform(o,n.topLeft),r=e.Matrix.transform(o,n.topRight),l=e.Matrix.transform(o,n.bottomLeft),d=e.Matrix.transform(o,n.bottomRight),h=Math.min(s.x,r.x,l.x,d.x),g=Math.min(s.y,r.y,l.y,d.y);return{x:h,width:Math.max(s.x,r.x,l.x,d.x)-h,y:g,height:Math.max(s.y,r.y,l.y,d.y)-g}}return{x:t.offsetX-(t.width||t._width)*t.pivot.x,y:t.offsetY-(t.height||t._height)*t.pivot.y,width:t.width||t._width,height:t.height||t._height}},_emptyBridging:function(t,i){var a,n,o,s,r;if(t&&t.length>0&&i)for(a=0;a<t.length;a++)if(n=i.nameTable[i._getChild(t[a])]){for(o=0;o<n.segments.length;o++)for(s=n.segments[o]._bridges,r=0;r<s.length;r++)s.splice(r,1);e.datavisualization.Diagram.DiagramContext.update(n,i)}},updateBridging:function(i,a,n){var o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C,z,S,P,w,T,j,E,N,L,I,O,M,A,k,R,U,B=[];if(n&&n.length){if(i.segments.length>0)for(S=0;S<i.segments.length;S++)for(w=i.segments[S]._bridges,r=0;r<w.length;r++)w[r]._target==n[0].name?w.splice(r,1):this.findLength(w[r].startPoint,w[r].endPoint)>n[0].bridgeSpace&&(a.nameTable[w[r]._target]&&n.push(a.nameTable[w[r]._target]),w.splice(r,1))}else if(i.segments.length>0)for(S=0;S<i.segments.length;S++)i.segments[S]._bridges=[];if(n||this._emptyBridging(i._intersects,a),i._intersects=[],"ejSymbolPalette"!==a.pluginName&&e.datavisualization.Diagram.Util.canBridge(i,a)){var H=this.getPoints(i),G=i.bridgeSpace,V=a.bridgeDirection(),F=-1;if(o=n&&a.boundaryTable[i.name]?a.boundaryTable[i.name]:e.datavisualization.Diagram.Util.bounds(i),a.boundaryTable[i.name]=o,n&&n.length>0)for(d=[],T=0;T<n.length;T++)(l=a.nameTable[a._getChild(n[T])])&&d.push(l);if((h=d||a._getConnectors()).length>0)for(g=0;g<h.length;g++)if(c=h[g],e.datavisualization.Diagram.Util.canBridgeObstacle(c,a)&&i&&i.segments&&i.segments.length>0&&"bezier"!=i.segments[0].type&&c&&c.segments&&c.segments.length>0&&"bezier"!=c.segments[0].type&&c.segments&&c.visible&&i.name!==c.name&&(s=a.boundaryTable[c.name]?a.boundaryTable[c.name]:e.datavisualization.Diagram.Util.bounds(c),a.boundaryTable[c.name]=s,e.datavisualization.Diagram.Geometry.intersectsRect(o,s)&&(u=this.getPoints(c),m=this.interSect(H,u,!1,a,!0),i._intersects.push(c.name),m.length>0)))for(T=0;T<m.length;T++){var W,Y,X,Z=0,$=this.getLengthAtFractionPoint(i,m[T]);if(Y=$.lengthAtFractionPt,W=$.fullLength,Z=$.segmentIndex,X=$.pointIndex,!(Z<0)&&i.segments[0])if((Y-G/2)/W,p=this.getPointAtLength(Y-G/2,H),(Y+G/2)/W,f=this.getPointAtLength(Y+G/2,H),e.datavisualization.Diagram.Geometry.isEmptyPoint(f)&&(f=p),_=0===Z?i.sourcePoint:i.segments[Z-1]._endPoint,A="straight"===i.segments[Z].type?i.segments[Z]._point:i.segments[Z].points[X],v=this._findAngle(_,A),B.length>Z&&null!=B[Z]){y=0===Z?i.sourcePoint:i.segments[Z-1]._endPoint;var Q=Math.abs(this.findLength(y,f)),q=-1;for(F=-1,M=0;M<B[Z].bridges.length;M++)if(F++,b=B[Z].bridges[M],Q<Math.abs(this.findLength(y,b.endPoint))){q=F;break}q>=0?((x=this.createSegment(p,f,v,V,X,i,a))._target=c.name,B[Z].bridges.splice(q,0,x),B[Z].bridges.join(),B[Z].bridgeStartPoint.splice(q,0,p),B[Z].bridgeStartPoint.join(),B[Z].segmentIndex=Z):((x=this.createSegment(p,f,v,V,X,i,a))._target=c.name,B[Z].bridges.push(x),B[Z].bridgeStartPoint.push(p),B[Z].segmentIndex=Z)}else isNaN(p.x)||isNaN(p.y)||e.datavisualization.Diagram.Geometry.isEmptyPoint(f)||((D=this.createSegment(p,f,v,V,X,i,a))._target=c.name,z=[],(C=[]).push(p),z.push(f),B.length,B[Z]=t.extend(!0,{},e.datavisualization.Diagram.BridgeSegments,{}),B[Z].bridges.push(D),B[Z].bridgeStartPoint=C,B[Z].segmentIndex=Z)}if(n&&n.length&&i.segments.length>0)for(S=0;S<i.segments.length;S++)P=i.segments[S],w=i.segments[S]._bridges,B[S]||(B[S]=t.extend(!1,{},e.datavisualization.Diagram.BridgeSegments),B[S].segmentIndex=S),B[S].bridges=B[S].bridges.concat(w).sort(function(t,e){return P._startPoint.x!=P._endPoint.x?P._startPoint.x<P._endPoint.x?t.startPoint.x-e.startPoint.x:e.startPoint.x-t.startPoint.x:P._startPoint.y<P._endPoint.y?t.startPoint.y-e.startPoint.y:e.startPoint.y-t.startPoint.y}),B[S].bridgeStartPoint=B[S].bridges.map(function(t){return t.startPoint}),i.segments[S]._bridges=[];if(0!=B.length)for(T=0;T<B.length;T++)if(j=B[T]){for(M=1;M<j.bridges.length;M++)this.findLength(j.bridges[M].endPoint,j.bridges[M-1].endPoint)<G&&(j.bridges[M-1].endPoint=j.bridges[M].endPoint,I=j.bridges[M-1],E=a.getBridgeSegment(I.startPoint,I.endPoint,I.angle,G,I.sweep),j.bridges[M-1].path=E,n&&n.length&&j.bridges[M-1]._target==n[0].name&&(j.bridges[M-1]._target=j.bridges[M]._target),j.bridges.splice(M,1),j.bridgeStartPoint.splice(M,1),M--);for(N=i.sourcePoint,L=0;L<j.bridges.length;L++){for(I=j.bridges[L],O=!0,M=0;n&&M<n.length;M++)I._target==n[M].name&&(O=!1);O?(i.segments[j.segmentIndex]._bridges.push(I),N=I.endPoint):("straight"===i.segments[j.segmentIndex].type?A=i.segments[j.segmentIndex]._endPoint:"orthogonal"===i.segments[j.segmentIndex].type&&(A=i.segments[j.segmentIndex].points[I.segmentPointIndex]),0!=Z&&(N=i.segments[j.segmentIndex]._endPoint),(k=[]).push(e.datavisualization.Diagram.Point(A.x-G,A.y-G)),k.push(e.datavisualization.Diagram.Point(A.x+G,A.y+G)),R=e.datavisualization.Diagram.Geometry.rect(k),(k=[]).push(e.datavisualization.Diagram.Point(N.x-G,N.y-G)),k.push(e.datavisualization.Diagram.Point(N.x+G,N.y+G)),U=e.datavisualization.Diagram.Geometry.rect(k),e.datavisualization.Diagram.Geometry.containsPoint(R,j.bridgeStartPoint[L])||e.datavisualization.Diagram.Geometry.containsPoint(U,I.endPoint)||(i.segments[j.segmentIndex]._bridges.push(I),N=I.endPoint))}}}},createSegment:function(i,a,n,o,s,r,l){var d,h,g=t.extend(!1,{},e.datavisualization.Diagram.PathSegment);return h=this.sweepDirection(n,o,r,l),d=l.getBridgeSegment(i,a,n,r.bridgeSpace,h),g.path=d,g.startPoint=i,g.endPoint=a,g.angle=n,g.segmentPointIndex=s,g.sweep=h,g},sweepDirection:function(t,e){var i,a=Math.abs(t);return"top"===e||"bottom"===e?(i=1,a>=0&&a<=90&&(i=0)):("right"===e||"left"===e)&&(i=1,t<0&&t>=-180&&(i=0)),("right"===e||"bottom"===e)&&(i=0===i?1:0),i},getPointAtLength:function(t,i){for(var a,n,o=0,s=null,r=e.datavisualization.Diagram.Point(0,0),l=0;l<i.length;l++)if(a=i[l],s){if(o+(n=this.findLength(s,a))>t){var d=t-o,h=this.findAngle(s,a),g=d*Math.cos(h*Math.PI/180),c=d*Math.sin(h*Math.PI/180);r=e.datavisualization.Diagram.Point(s.x+g,s.y+c);break}o+=n,s=a}else s=a;return r},getLengthAtFractionPoint:function(t,e){var i,a,n,o,s,r,l,d=100,h=0,g=-1,c=0,u=0,m=-1;if(null===t.segments)return 0;t.segments;var p=t.sourcePoint,f=p;for(i=0;i<t.segments.length;i++){for(a=[],n=t.segments[i],s=0;s<n.points.length;s++)o=n.points[s],a.push(o);for(s=0;s<a.length;s++)r=a[s],(l=this.getSlope(r,p,e,t))<d&&(d=l,u=h+this.findLength(e,f),g=c,m=s),h+=this.findLength(r,p),p=r,f=r;c++}return{lengthAtFractionPt:u,fullLength:h,segmentIndex:g,pointIndex:m}},getSlope:function(t,e,i,a){var n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),s=(i.y-t.y)/(e.y-t.y),r=(i.x-t.x)/(e.x-t.x);return!isFinite(s)||!isFinite(r)||isNaN(s)||isNaN(r)?t.x===e.x?t.y===e.y?1e4:t.y>i.y&&i.y>e.y||t.y<i.y&&i.y<e.y?Math.abs(t.x-i.x):1e4:t.y==e.y&&(t.x>i.x&&i.x>e.x||t.x<i.x&&i.x<e.x)?Math.abs(t.y-i.y):1e4:a.segments.length>0&&(t.x>=i.x&&i.x>=e.x||t.x<=i.x&&i.x<=e.x||n<3)&&(t.y>=i.y&&i.y>=e.y||t.y<=i.y&&i.y<=e.y||o<3)?Math.abs(s-r):1e4},getPoints:function(t){var e,i,a,n=[];if(t.segments.length>0)for(e=0;e<t.segments.length;e++)if("straight"===(i=t.segments[e]).type||"bezier"===i.type)0===e&&n.push(t.sourcePoint),i._point&&n.push(i._point);else if("orthogonal"===i.type)for(a=0;a<t.segments[e].points.length;a++)n.push(t.segments[e].points[a]);return n},interSect:function(t,e,i,a,n){var o,s,r,l,d;for(i&&e.length>=2&&(e.splice(0,1),e.splice(0,1)),o=[],s=a.bridgeDirection(),r=0;r<t.length-1;r++){if((l=this.interSect1(t[r],t[r+1],e,a,n,s)).length>0)for(d=0;d<l.length;d++)o.push(l[d]);i&&e.length>=1&&e.splice(0,1)}return o},checkforHorizontalLine:function(t){var e=Math.abs(t);return e>90?180-e:e},interSect1:function(t,i,a,n,o,s){for(var r,l,d,h=[],g=0;g<a.length-1;g++)r=this.interSect2(t,i,a[g],a[g+1]),e.datavisualization.Diagram.Geometry.isEmptyPoint(r)||(l=this._findAngle(t,i),d=this._findAngle(a[g],a[g+1]),l=this.checkforHorizontalLine(l),d=this.checkforHorizontalLine(d),"left"===s||"right"===s?l>d&&h.push(r):("top"===s||"bottom"===s)&&l<d&&h.push(r),(l===d&&o||n._autoConnectEndPoint)&&h.push(r));return h},interSect2:function(t,i,a,n){var o=e.datavisualization.Diagram.LineUtil(t.x,t.y,i.x,i.y),s=e.datavisualization.Diagram.LineUtil(a.x,a.y,n.x,n.y),r=this.interSect3(o,s);return r.enabled?r.intersectPt:e.datavisualization.Diagram.Point(0,0)},interSect3:function(t,i){var a,n,o=e.datavisualization.Diagram.Point(0,0),s=t,r=i,l=(r.y2-r.y1)*(s.x2-s.x1)-(r.x2-r.x1)*(s.y2-s.y1),d=(r.x2-r.x1)*(s.y1-r.y1)-(r.y2-r.y1)*(s.x1-r.x1),h=(s.x2-s.x1)*(s.y1-r.y1)-(s.y2-s.y1)*(s.x1-r.x1);return 0==l?{enabled:!1,intersectPt:o}:(n=h/l,(a=d/l)>=0&&a<=1&&n>=0&&n<=1?(o.x=s.x1+a*(s.x2-s.x1),o.y=s.y1+a*(s.y2-s.y1),{enabled:!0,intersectPt:o}):{enabled:!1,intersectPt:o})},findLength:function(t,e){try{return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}catch(t){throw t}},_findAngle:function(t,e){var i=t.x-e.x,a=t.y-e.y;return Math.atan2(a,i)*(180/Math.PI)},findAngle:function(t,i){if(e.datavisualization.Diagram.Geometry.isEqualPoint(t,i))return 0;var a=e.datavisualization.Diagram.Point(i.x,t.y),n=(this.findLength(t,a),this.findLength(a,i)),o=this.findLength(i,t),s=Math.asin(n/o);return s=180*s/Math.PI,t.x<i.x?t.y<i.y||(s=360-s):s=t.y<i.y?180-s:180+s,s},_mapPalettePhase:function(t){var i,a;return t.orientation&&"horizontal"==t.orientation?(i={x:0,y:0},a={x:40,y:0}):(i={x:0,y:0},a={x:0,y:40}),e.datavisualization.Diagram.Connector({name:t?t.name:e.datavisualization.Diagram.Util.randomId(),segments:[{type:"straight"}],sourcePoint:{x:i.x,y:i.y},targetPoint:{x:a.x,y:a.y},lineWidth:t.lineWidth?t.lineWidth:1,lineDashArray:t.lineDashArray?t.lineDashArray:null,lineColor:t.lineColor?t.lineColor:"#606060",targetDecorator:{shape:"none"},isPhase:!0,orientation:t.orientation?t.orientation:"horizontal",labels:t.label?[t.label]:[],paletteItem:t.paletteItem?t.paletteItem:null})},_updateShapeProperties:function(t){switch(t._type="node",t.shape.type||(t.shape.type="rectangle"),t.shape.type){case"rectangle":t.type="basic",t._shape=t.shape.type,t.shape.cornerRadius&&(t.cornerRadius=t.shape.cornerRadius);break;case"ellipse":t.type="basic",t._shape=t.shape.type;break;case"path":t.type="basic",t._shape=t.shape.type,t.pathData=t.shape.pathData;break;case"polygon":t.type="basic",t._shape=t.shape.type,t.points=t.shape.points;break;case"image":t.type="image",t._shape=t.shape.type,t.source=t.shape.src;break;case"native":t.type="native",t._shape=t.shape.type,t.templateId=t.shape.templateId;break;case"text":t.type="text",t._shape=t.shape.type,t.textBlock=t.shape.textBlock;break;case"html":t.type="html",t._shape=t.shape.type,t.templateId=t.shape.templateId}},_refreshParentGroup:function(t,i){var a,n=i.nameTable[t.parent];n&&(this._updateGroupBounds(n,i),n.parent?document.getElementById(n.parent):i._diagramLayer,e.datavisualization.Diagram.DiagramContext.renderGroup(n,i),a=i._isUndo?e.datavisualization.Diagram.GroupChangeCause.HistoryChange:e.datavisualization.Diagram.GroupChangeCause.Unknown,i._raiseGroupChangeEvent(t,void 0,n,a))},intersectsWith:function(t,e){var i=e;return t.x<i.x&&i.x<t.x+t.width&&t.y<i.y&&i.y<t.y+t.height},_findOffsetOnConnector:function(t,i,a,n){for(var o,s,r,l,d=0,h=[],g=0;g<t.segments.length;g++)for(h[g]=[],o=0;o<t.segments[g].points.length-1;o++)d+=e.datavisualization.Diagram.Geometry.distance(t.segments[g].points[o],t.segments[g].points[o+1]),h[g][o]=d;var c,u,m,p,f=t.sourceNode&&0==i.offset&&n.nameTable[t.sourceNode]||t.targetNode&&1==i.offset&&n.nameTable[t.targetNode],_=f?this.bounds(f):null,v=d*(i.segmentOffset||0);for(g=0;g<h.length;g++)for(o=0;o<h[g].length;o++){if(h[g][o]>=v){if(u=t.segments[g],m=e.datavisualization.Diagram.Geometry.findAngle(u.points[o],t.segments[g].points[o+1]),p=e.datavisualization.Diagram.Geometry.transform(u.points[o],m,v-(c||0)),f){if(this.intersectsWith(_,p)&&!e.datavisualization.Diagram.Geometry.containsRect(_,this.bounds(t))){switch(r=0==i.offset?this._getBezierDirection(u.points[o],t.segments[g].points[o+1]):this._getBezierDirection(u.points[o+1],t.segments[g].points[o]),s=0==i.offset?u.points[o+1]:u.points[o],l=!1,r){case"top":_.y>s.y?p.y=_.top:l=!0;break;case"bottom":_.bottom<s.y?p.y=_.bottom:l=!0;break;case"right":_.right<s.x?p.x=_.right:l=!0;break;case"left":_.left>s.x?p.x=_.left:l=!0}if(l){v=1==i.offset?c||0:h[g][o],c=0==i.offset?h[g][o]:h[g][o-2]||(h[g-1]&&h[g-1].length>1?h[g-1][h[g-1].length-1]:h[g-2]&&h[g-2][h[g-2].length-1])||0,0==i.offset?g=g:o?o-=2:g-=2;continue}}return{segment:g,point:o,offset:{x:p.x,y:p.y}}}return{segment:g,point:o,offset:{x:p.x,y:p.y}}}c=h[g][o]}},_alignLabelOnSegments:function(t,i,a,n){var o,s,r,l,d,h,g;n.angle;n.angle%=360;var c,u=45,m=135,p=225,f=315;switch((0==i.segmentOffset&&t.sourceNode||1==i.segmentOffset&&t.targetNode)&&((o=0==i.segmentOffset&&t.sourceNode?a.nameTable[t.sourceNode]:a.nameTable[t.targetNode])&&(c=this.bounds(o)),c&&(u=s=180/(2+2/(c.height/c.width)),p=(m=180-s)+2*s,f=360-s)),i.alignment){case"before":n.angle>=u&&n.angle<=m?(r="right",l=.5==i.segmentOffset?"center":"top"):n.angle>=p&&n.angle<=f?(r="left",l=.5==i.segmentOffset?"center":"bottom"):n.angle>u&&n.angle<p?(l="top",r=.5==i.segmentOffset?"center":"right"):(l="bottom",r=.5==i.segmentOffset?"center":"left");break;case"after":n.angle>=u&&n.angle<=m?(r="left",l=.5==i.segmentOffset?"center":"top"):n.angle>=p&&n.angle<=f?(r="right",l=.5==i.segmentOffset?"center":"bottom"):n.angle>u&&n.angle<p?(l="bottom",r=.5==i.segmentOffset?"center":"right"):(l="top",r=.5==i.segmentOffset?"center":"left");break;case"center":r="center",l="center"}if(i.boundaryConstraints&&(0==i.segmentOffset||1==i.segmentOffset))switch(t.segments.length>1&&(g=t.segments[t.segments.length-1]),d=g?g.points.length:t.segments[0].points.length,t.labels[0].name==i.name?h=e.datavisualization.Diagram.Util._getBezierDirection(t.segments[0].points[0],t.segments[0].points[1]):(g=g||t.segments[0],h=e.datavisualization.Diagram.Util._getBezierDirection(g.points[d-2],g.points[d-1])),h){case"left":r=0==i.segmentOffset?"right":"left";break;case"right":r=0==i.segmentOffset?"left":"right";break;case"bottom":l=0==i.segmentOffset?"top":"bottom";break;case"top":l=0==i.segmentOffset?"bottom":"top"}return{hAlign:r,vAlign:l}},getObjectType:function(t){return t?t.segments?"connector":"bpmn"==t.type&&t.container?"group":"node"===t._type||"bpmn"==t.type||"basic"==t.type||"flow"==t.type||"arrow"==t.type?"node":"text"===t.type||"image"===t.type||"native"===t.type||"html"===t.type?"node":"group"!=t._type&&"pseudoGroup"==t.type?"pseudoGroup":"group"===t._type||t.isLane||t.isSwimlane?"group":t.isSwimlane?"swimlane":null:null},_canBeTarget:function(t,e){return!(e&&t.activeTool.helper&&t.activeTool.helper._name&&t.activeTool.helper._name===e.name)},getLabelbounds:function(i,a,n){var o,s,r;if(n)if("svg"===i.model.labelRenderingMode){if(i._svg&&(o=i._svg.document.getElementById(a.name+"_"+n.name),l=i._svg.document.getBoundingClientRect(),o))return s={x:(c=o.getBoundingClientRect()).left,y:c.top,width:c.width,height:c.height},r=i.tools.labelMove.getCenterOfLabel(n,n.segmentOffset,s),{x:c.left-l.left,y:c.top-l.top,width:c.right-c.left,height:c.bottom-c.top,centerX:r.x,centerY:r.y}}else if(i._svg){var l,d=i._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],h=(l=d.getBoundingClientRect()).left,g=l.top;if(o=t(d).find("#"+a.name+"_"+n.name)[0]){var c,u=((c=o.getBoundingClientRect()).left-h)/i.model.scrollSettings.currentZoom+(h+i.model.scrollSettings.horizontalOffset),m=(c.top-g)/i.model.scrollSettings.currentZoom+(g+i.model.scrollSettings.verticalOffset),p=c.width/i.model.scrollSettings.currentZoom,f=c.height/i.model.scrollSettings.currentZoom;return h+=i.model.scrollSettings.horizontalOffset,g+=i.model.scrollSettings.verticalOffset,e.datavisualization.Diagram.Rectangle(u-h,m-g,p,f)}}},_updateBpmnChild:function(t,i){switch(t.shape){case"event":t=e.datavisualization.Diagram.DefautShapes._getBPMNEventShape(t,i);break;case"gateway":t=e.datavisualization.Diagram.DefautShapes._getBPMNGatewayShape(t,i);break;case"dataobject":t=e.datavisualization.Diagram.DefautShapes._getBPMNDataShape(t,i);break;case"activity":t=e.datavisualization.Diagram.DefautShapes._getBPMNActivityShape(t,i);break;case"group":t=e.datavisualization.Diagram.DefautShapes._getBPMNGroupShape(t,i)}return e.datavisualization.Diagram.DefautShapes.initBPMNAnnotationShape(t,i)},_getUndoObject:function(e,i){var a={};a=e._getChildTable(i,a);e.activeTool._undoObject=t.extend(!0,{},{node:i,childTable:a})},_getRedoObject:function(e,i){var a={};a=e._getChildTable(i,a);e.activeTool._redoObject=t.extend(!0,{},{node:i,childTable:a})},_collectionContains:function(t,e){for(var i=0;i<e.length;i++)if("string"==typeof e[i]&&e[i]===t||e[i].name===t)return!0},_updateActivityChildOffset:function(t,e,i){if(t.children&&t.children.length>0)for(var a=0;a<t.children.length;a++)t.children[a].offsetX=e.x,t.children[a].offsetY=e.y,this._updateActivityChildOffset(t.children[a],e,i)},_updateBPMNProperties:function(t,i,a,n){var o,s,r,l,d,h,g,c;switch(t.shape){case"activity":var u=e.datavisualization.Diagram.Util.bounds(t,!0),m=t.offsetX,p=t.offsetY,f=i._getChildren(t.children);for(l=0;l<f.length;l++)d="object"==typeof f[l]?f[l]:a[f[l]],n&&0==l&&(u=e.datavisualization.Diagram.Util.bounds(d,!0),m=d.offsetX,p=d.offsetY),0==l&&(d.pathData=d._absolutePath=e.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(t,12),"transaction"==t.subProcess.type&&(o={x:3,y:3,width:t.width-3,height:t.height-3},d.pathData=d._absolutePath+=e.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(o,12)),delete d._absoluteBounds),n&&e.datavisualization.Diagram.Util.canResize(d)||(h=d.addInfo)&&h.offset&&(g=e.datavisualization.Diagram.Point(u.x+u.width*h.offset.x,u.y+u.height*h.offset.y),h.margin=e.datavisualization.Diagram.Margin(h.margin?h.margin:{}),h.hAlign&&(g.x+=h.margin.left-h.margin.right,g.x="left"==h.hAlign?g.x+h.margin.right:"right"==h.hAlign?g.x-h.margin.left:g.x),h.vAlign&&(g.y+=h.margin.top-h.margin.bottom,g.y="top"==h.vAlign?g.y+h.margin.bottom:"bottom"==h.vAlign?g.y-h.margin.top:g.y),t.rotateAngle&&(c=e.Matrix.identity(),e.Matrix.rotate(c,t.rotateAngle,m,p),g=e.Matrix.transform(c,g)),d.offsetX=g.x,d.offsetY=g.y,this._updateActivityChildOffset(d,g,i));break;case"group":t.pathData=t._absolutePath=e.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(t,15),t._scaled=!1;break;case"annotation":for(l=0;l<t.outEdges.length;l++)if((r=i.nameTable[t.outEdges[l]])._isAnnotationLine){s=r;break}s&&e.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(s,t,null,null,i);break;case"dataobject":u=e.datavisualization.Diagram.Util.bounds(t,!0),m=t.offsetX,p=t.offsetY,f=i._getChildren(t.children);var _=t.pivot||{x:.5,y:.5},v=t.offsetX?t.offsetX-t.width*_.x:t.width*_.x,y=t.offsetY?t.offsetY-t.height*_.y:t.height*_.y;for(l=0;l<f.length;l++)d="object"==typeof f[l]?f[l]:a[f[l]],n&&e.datavisualization.Diagram.Util.canResize(d)||((h=d.addInfo).margin=e.datavisualization.Diagram.Margin(h.margin?h.margin:{}),h.offset&&((g=e.datavisualization.Diagram.Point({})).x=v+h.offset.x*t.width+h.margin.left-h.margin.right,g.y=y+h.offset.y*t.height+h.margin.top-h.margin.bottom,t.rotateAngle&&(c=e.Matrix.identity(),e.Matrix.rotate(c,t.rotateAngle,m,p),g=e.Matrix.transform(c,g)),d.offsetX=g.x,d.offsetY=g.y))}},indexOf:function(t,e){if(null!=t&&null!=e)for(var i=0;i<t.length;i++)if(t[i]==e)return i;return-1}},e.datavisualization.Diagram.BridgeSegments={bridges:[],bridgeStartPoint:[],segmentIndex:-1},e.datavisualization.Diagram.PathSegment={path:"",startPoint:{x:0,y:0},endPoint:{x:0,y:0},angle:0,segmentPointIndex:-1,sweep:1},e.datavisualization.Diagram.LineUtil=function(t,e,i,a){return{x1:Number(t)||0,y1:Number(e)||0,x2:Number(i)||0,y2:Number(a)||0}},e.datavisualization.Diagram.Geometry={checkPointOnCircle:function(t,e,i){var a=Math.pow(i,2);return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=a},rect:function(t){var i,a,n,o,s=e.datavisualization.Diagram.Rectangle();if(1===arguments.length){var r,l,d=Number.MAX_VALUE,h=Number.MAX_VALUE,g=-Number.MAX_VALUE,c=-Number.MAX_VALUE,u=t.length;for(i=0;i<u;i++)r=t[i].x,l=t[i].y,r<d&&(d=r),r>g&&(g=r),l<h&&(h=l),l>c&&(c=l);s=e.datavisualization.Diagram.Rectangle(d,h,g-d,c-h)}else 2===arguments.length&&(a=e.datavisualization.Diagram.Point(arguments[0]),n=e.datavisualization.Diagram.Point(arguments[1]),a.x>n.x&&(o=a.x,a.x=n.x,n.x=o),a.y>n.y&&(o=a.y,a.y=n.y,n.y=o),s=e.datavisualization.Diagram.Rectangle(a.x,a.y,n.x-a.x,n.y-a.y));return s},union:function(t,i){var a=Math.min(t.x,i.x),n=Math.min(t.y,i.y),o=Math.max(t.x+t.width,i.x+i.width),s=Math.max(t.y+t.height,i.y+i.height);return e.datavisualization.Diagram.Rectangle(a,n,o-a,s-n)},distance:function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},translate:function(t,i,a){return e.datavisualization.Diagram.Point(t.x+i,t.y+a)},intersectsRect:function(t,e){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height&&t.y<e.y+e.height},findAngle:function(t,e){var i=Math.atan2(e.y-t.y,e.x-t.x);return i=180*i/Math.PI,(i%=360)<0&&(i+=360),i},intersectSegment:function(t,i){var a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v=t.point1.x,y=t.point1.y,b=t.point2.x,x=t.point2.y,D=i.point1.x,C=i.point1.y,z=i.point2.x,S=i.point2.y;return m=(a=x-y)*z+(o=v-b)*S+(r=b*y-v*x),0!==(u=a*D+o*C+r)&&0!==m&&this.sameSign(u,m)?null:(c=(n=S-C)*b+(s=D-z)*x+(l=z*C-D*S),0!==(g=n*v+s*y+l)&&0!==c&&this.sameSign(g,c)?null:0===(p=a*s-n*o)?null:(f=p<0?-p/2:p/2,f=0,d=(_=o*l-s*r)<0?(_-f)/p:(_+f)/p,h=(_=n*r-a*l)<0?(_-f)/p:(_+f)/p,e.datavisualization.Diagram.Point(d,h)))},updatePath:function(t,i,a,n,o,s,r,l){var d,h;s&&s.pathBounds?(h=!0,d=r||s.pathBounds(o)):(h=!(!l||l._absolutePath),d=r),l&&(l._absoluteBounds=d);var g=0,c=0,u=!1;return(t.toString()!==d.x||i.toString()!==d.y)&&(g=t-Number(d.x),c=i-Number(d.y)),(a!==d.width||n!==d.height)&&(g=a/Number(d.width?d.width:1),c=n/Number(d.height?d.height:1),u=!0),e.datavisualization.Diagram.Geometry.processPathData(o,g,c,u,d.x,d.y,t,i,h,s)},processPathData:function(t,i,a,n,o,s,r,l,d,h){var g,c,u,m,p,f,_,v,y,b,x,D,C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("d",t),d&&(t=(h=h||new e.datavisualization.Diagram.Svg({})).absolutePath(C).getAttribute("d"),C.setAttribute("d",t));for(var z=0,S=0,P=0,w=(_=e.datavisualization.Diagram.Util.convertPathToArray(t)).length;P<w;++P){switch(y=(v=_[P]).pathSegTypeAsLetter,"x1"in v&&(u=v.x1),"x2"in v&&(p=v.x2),"y1"in v&&(m=v.y1),"y2"in v&&(f=v.y2),"x"in v&&(z=v.x),"y"in v&&(S=v.y),n?(void 0!=z&&(z=e.datavisualization.Diagram.Geometry.scalePathData(z,i,o,r),z=Number(z.toFixed(2))),void 0!=S&&(S=e.datavisualization.Diagram.Geometry.scalePathData(S,a,s,l),S=Number(S.toFixed(2))),void 0!=u&&(u=e.datavisualization.Diagram.Geometry.scalePathData(u,i,o,r),u=Number(u.toFixed(2))),void 0!=m&&(m=e.datavisualization.Diagram.Geometry.scalePathData(m,a,s,l),m=Number(m.toFixed(2))),void 0!=p&&(p=e.datavisualization.Diagram.Geometry.scalePathData(p,i,o,r),p=Number(p.toFixed(2))),void 0!=f&&(f=e.datavisualization.Diagram.Geometry.scalePathData(f,a,s,l),f=Number(f.toFixed(2)))):(void 0!=z&&(z+=i),void 0!=S&&(S+=a),void 0!=u&&(u+=i),void 0!=m&&(m+=a),void 0!=p&&(p+=i),void 0!=f&&(f+=a)),y){case"M":b={pathSegTypeAsLetter:"M",x:z,y:S};break;case"L":b={pathSegTypeAsLetter:"L",x:z,y:S};break;case"H":b={pathSegTypeAsLetter:"H",x:z};break;case"V":b={pathSegTypeAsLetter:"V",y:S};break;case"C":b={pathSegTypeAsLetter:"C",x:z,y:S,x1:u,y1:m,x2:p,y2:f};break;case"S":b={pathSegTypeAsLetter:"S",x:z,y:S,x2:p,y2:f};break;case"Q":b={pathSegTypeAsLetter:"Q",x:z,y:S,x1:u,y1:m};break;case"T":b={pathSegTypeAsLetter:"T",x:z,y:S};break;case"A":x=v.r1,D=v.r2,n&&(x*=i,D*=a),b={pathSegTypeAsLetter:"A",x:z,y:S,r1:x,r2:D,angle:v.angle,largeArcFlag:v.largeArcFlag,sweepFlag:v.sweepFlag};break;case"z":case"Z":z=g,S=c,b=_[P]}b&&(_[P]=b),("M"===y||"m"===y)&&(g=z,c=S)}return e.datavisualization.Diagram.Util.pathSegArrayAsString(_)},scalePathData:function(t,e,i,a){return t!==i?t=a!==i?t*e-(Number(i)*e-Number(i))+(a-Number(i)):Number(t)*e-(Number(i)*e-Number(i)):a!==i&&(t=a),t},updatePolygonPoints:function(t,i){var a,n,o,s;if(t.points)for(i||(i=t.points),e.datavisualization.Diagram.Geometry.scalePoints(i,t),a=e.datavisualization.Diagram.Geometry.rect(t.points),n=0,o=t.points.length;n<o;++n)s=e.datavisualization.Diagram.Geometry.translate(i[n],-a.x,-a.y),s=e.datavisualization.Diagram.Geometry.translate(s,0,0),i[n]=s},scalePoints:function(t,i){var a,n,o,s,r=e.datavisualization.Diagram.Geometry.rect(i.points);if(r.width>0&&r.height>0)for(a=i.width/r.width,n=i.height/r.height,o=0,s=i.points.length;o<s;++o)t[o].x=t[o].x*a,t[o].y=t[o].y*n},sameSign:function(t,e){return t*e>=0},containsPoint:function(t,e){return t.x<=e.x&&e.x<=t.x+t.width&&t.y<=e.y&&e.y<=t.y+t.height},containsRect:function(t,e){return t.x<=e.x&&e.x+e.width<=t.x+t.width&&t.y<=e.y&&e.y+e.height<=t.y+t.height},inflate:function(t,e,i){t.x-=e,t.y-=i,t.width+=2*e,t.height+=2*i},isEmptyRect:function(t){return 0===t.x&&0===t.y&&0===t.width&&0===t.height},isEmptyPoint:function(t){return 0===t.x&&0===t.y},isEqualPoint:function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},isEmptySize:function(t){return 0===t.width&&0===t.height},length:function(t){return e.datavisualization.Diagram.Geometry.distance(t.point1,t.point2)},midPoint:function(t){return e.datavisualization.Diagram.Point((t.point1.x+t.point2.x)/2,(t.point1.y+t.point2.y)/2)},transform:function(t,e,i){var a={};return a.x=Math.round(100*(t.x+i*Math.cos(e*Math.PI/180)))/100,a.y=Math.round(100*(t.y+i*Math.sin(e*Math.PI/180)))/100,a}},e.datavisualization.Diagram.LineSegment=function(t,e){return{point1:t,point2:e}},e.datavisualization.Diagram.Point=function(t,e){return{x:Number(t)||0,y:Number(e)||0}},e.datavisualization.Diagram.Size=function(t,e){return{width:Number(t)||0,height:Number(e)||0}},e.datavisualization.Diagram.Rectangle=function(t,e,i,a){return{x:Number(t)||0,y:Number(e)||0,width:Number(i)||0,height:Number(a)||0}},e.datavisualization.Diagram.ImageAlignment={None:"none",XMinYMin:"xminymin",XMinYMid:"xminymid",XMinYMax:"xminymax",XMidYMin:"xmidymin",XMidYMid:"xmidymid",XMidYMax:"xmidymax",XMaxYMin:"xmaxymin",XMaxYMid:"xmaxymid",XMaxYMax:"xmaxymax"},e.datavisualization.Diagram.ActiveTool={None:"none",Drag:"drag",Draw:"draw"},e.datavisualization.Diagram.ScaleConstraints={None:"none",Stretch:"stretch",Meet:"meet",Slice:"slice"},e.datavisualization.Diagram.KeyModifiers={None:0,Control:1,Meta:1,Alt:2,Shift:4},e.datavisualization.Diagram.Keys={None:"",Number0:0,Number1:1,Number2:2,Number3:3,Number4:4,Number5:5,Number6:6,Number7:7,Number8:8,Number9:9,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Left:37,Up:38,Right:39,Down:40,Escape:27,Delete:46,Tab:9,Enter:13},e.datavisualization.Diagram.LabelRenderingMode={Html:"html",Svg:"svg"},e.datavisualization.Diagram.TemplateType={Html:"html",Svg:"svg"},e.datavisualization.Diagram.DecoratorShapes={None:"none",Arrow:"arrow",OpenArrow:"openarrow",Circle:"circle",Diamond:"diamond",Path:"path"},e.datavisualization.Diagram.ConnectorType={StraightLine:"straightLine",OrthogonalLine:"orthogonalLine",Polyline:"polyline"},e.datavisualization.Diagram.ActionType={Unknown:"unknown",Nudge:"nudge",Touch:"touch",Mouse:"mouse",Order:"order",Align:"align",Size:"size",HistoryChange:"historyChange"},e.datavisualization.Diagram.dependentconnector={dependent:1,independent:2},e.datavisualization.Diagram.ContainerType={Canvas:"canvas",Stack:"stack"},e.datavisualization.Diagram.IconShapes={Minus:"minus",Plus:"plus",ArrowUp:"arrowup",ArrowDown:"arrowdown",Template:"template",Path:"path",Image:"image",None:"none"},e.datavisualization.Diagram.PortShapes={X:"x",Circle:"circle",Square:"square",Path:"path"},e.datavisualization.Diagram.TickAlignment={LeftOrTop:"leftortop",RightOrBottom:"rightorbottom"},e.datavisualization.Diagram.PortVisibility={Visible:1,Hidden:2,Hover:4,Connect:8,Default:8},e.datavisualization.Diagram.TextAlign={Left:"left",Center:"center",Right:"right",Justify:"justify"},e.datavisualization.Diagram.HorizontalAlignment={Left:"left",Center:"center",Right:"right",Stretch:"stretch"},e.datavisualization.Diagram.Alignment={Before:"before",After:"after",Center:"center"},e.datavisualization.Diagram.LabelRelativeMode={SegmentBounds:"segmentbounds",SegmentPath:"segmentpath"},e.datavisualization.Diagram.LabelEditMode={Edit:"edit",View:"view"},e.datavisualization.Diagram.RelativeMode={Object:"object",Mouse:"mouse"},e.datavisualization.Diagram.TextWrapping={NoWrap:"nowrap",Wrap:"wrap",WrapWithOverflow:"wrapwithoverflow"},e.datavisualization.Diagram.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom",Stretch:"stretch"},e.datavisualization.Diagram.TextDecorations={Underline:"underline",Overline:"overline",LineThrough:"line-through",None:"none"},e.datavisualization.Diagram.PaletteConstraints={HeaderVisibility:2,Visible:4,Expandable:8,Default:14},e.datavisualization.Diagram.NodeConstraints={None:1,Select:2,Delete:4,Drag:8,Rotate:16,Connect:32,ResizeNorthEast:64,ResizeEast:128,ResizeSouthEast:256,ResizeSouth:512,ResizeSouthWest:1024,ResizeWest:2048,ResizeNorthWest:4096,ResizeNorth:8192,Resize:16320,Shadow:16384,DragLabel:32768,AllowPan:65536,AspectRatio:131072,AllowDrop:262144,InheritTooltip:524288,MultiSelect:1048576,PointerEvents:2097152,PointerVisibility:2097152,CrispEdges:4194304,InheritCrispEdges:8388608,Interaction:16347,Default:11026430},e.datavisualization.Diagram.LabelConstraints={None:1,Selectable:2,Draggable:4,Resizable:8,Rotatable:16,All:30},e.datavisualization.Diagram.HistoryChangeCause={Undo:"undo",Redo:"redo",CustomAction:"customAction"},e.datavisualization.Diagram.CollectionChangeCause={ClipBoard:"clipBoard",Drop:"drop",HistoryChange:"historyChange",Unknown:"unknown"},e.datavisualization.Diagram.GroupChangeCause={Group:"group",Ungroup:"ungroup",Drop:"drop",HistoryChange:"historyChange",Unknown:"unknown"},e.datavisualization.Diagram.SelectionChangeCause={Keydown:"keydown",RubberBand:"rubberBand",Mouse:"mouse",Touch:"touch",Unknown:"unknown"},e.datavisualization.Diagram.ScrollChangeCause={Zoom:"zoom",Pan:"pan",Unknown:"unknown"},e.datavisualization.Diagram.ConnectorConstraints={None:1,Select:2,Delete:4,Drag:8,DragSourceEnd:16,DragTargetEnd:32,DragSegmentThumb:64,Bridging:128,DragLabel:256,InheritBridging:512,AllowDrop:1024,InheritTooltip:2048,PointerEvents:4096,PointerVisibility:4096,CrispEdges:8192,InheritCrispEdges:16384,DragLimit:32768,BridgeObstacle:65536,Routing:131072,InheritRouting:262144,Interaction:122,Default:350846},e.datavisualization.Diagram.PortConstraints={None:1,Connect:2,ConnectOnDrag:4},e.datavisualization.Diagram.SelectorConstraints={None:1,Rotator:2,Resizer:4,UserHandles:8,Tooltip:16,DragOnEmptySpace:32,AutoHideThumbs:64,All:30},e.datavisualization.Diagram.UserHandlePositions={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",MiddleLeft:"middleleft",MiddleRight:"middleright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"},e.datavisualization.Diagram.SnapConstraints={None:0,SnapToHorizontalLines:1,SnapToVerticalLines:2,SnapToLines:3,ShowHorizontalLines:4,ShowVerticalLines:8,ShowLines:12,All:15},e.datavisualization.Diagram.PageOrientations={Landscape:"landscape",Portrait:"portrait"},e.datavisualization.Diagram.ScrollLimit={Infinity:"infinity",Diagram:"diagram",Limited:"limited"},e.datavisualization.Diagram.BoundaryConstraints={Infinity:"infinity",Diagram:"diagram",Page:"page"},e.datavisualization.Diagram.LayoutOrientations={TopToBottom:"toptobottom",BottomToTop:"bottomtotop",LeftToRight:"lefttoright",RightToLeft:"righttoleft"},e.datavisualization.Diagram.ObjectTypes={Diagram:"diagram",Palette:"palette",Lane:"lane",Group:"group"},e.datavisualization.Diagram.PaletteDefaults={name:"",expanded:!1,subControlId:null,items:[],constraints:e.datavisualization.Diagram.PaletteConstraints.Default},e.datavisualization.Diagram.Palette=function(i){return i.items=i.items?i.items.slice():[],t.extend(!1,{},e.datavisualization.Diagram.PaletteDefaults,i)},e.datavisualization.Diagram.Shapes={Image:"image",Text:"text",Html:"html",Native:"native",Basic:"basic",Flow:"flow",Arrow:"arrow",BPMN:"bpmn"},e.datavisualization.Diagram.ClipBoardChangeType={All:"all",None:"none",Specific:"specific"},e.datavisualization.Diagram.OverflowType={Clip:"clip",Ellipsis:"ellipsis"},e.datavisualization.Diagram.ShapeDefaults={shape:"",source:"",pathData:"",textBlock:null,points:[],templateId:null,scale:"meet",contentAlignment:"xmidymid"},e.datavisualization.Diagram.Shape=function(i){return i&&(i.points=i.points?i.points.slice():[],"html"===i.type&&"string"==typeof i.html&&(i.html=e.datavisualization.Diagram.Util.htmlEncode(i.html)),"text"===i.type&&(i.textBlock=e.datavisualization.Diagram.TextBlock(i.textBlock?i.textBlock:{}),i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",i.borderWidth=i.borderWidth?i.borderWidth:0),("image"==i.type||"native"==i.type||"text"===i.type||"html"===i.type)&&(i._shape=i.type),i._type||(i._type=i.type?i.type:"node"),i._shape||(i._shape=i.shape?i.shape:"rectangle"),i.points=i.points?i.points.slice():[]),t.extend(!1,{},e.datavisualization.Diagram.ShapeDefaults,i)},e.datavisualization.Diagram.Segments={Straight:"straight",Orthogonal:"orthogonal",Bezier:"bezier"},e.datavisualization.Diagram.SegmentDefaults={type:e.datavisualization.Diagram.Segments.Straight,point:null,point1:null,point2:null,vector1:null,vector2:null,_point1:e.datavisualization.Diagram.Point(),_point2:e.datavisualization.Diagram.Point(),length:null,_length:null,_bridges:[],direction:null,_direction:null},e.datavisualization.Diagram.Segment=function(i){var a,n=t.extend(!0,{},e.datavisualization.Diagram.SegmentDefaults,i);return n._bridges=n._bridges?n._bridges.slice():[],a=[],n.points=a,"orthogonal"==n.type?(n._length=n.length,n._direction=n.direction):("bezier"==n.type&&(n._point1=n.point1,n._point2=n.point2),n.point&&(n._point=n.point)),n},e.datavisualization.Diagram.DragLimitDefaults={top:10,left:10,right:10,bottom:10},e.datavisualization.Diagram.DragLimit=function(i){return t.extend(!0,{},e.datavisualization.Diagram.DragLimitDefaults,i)},e.datavisualization.Diagram.MarginDefaults={top:0,left:0,right:0,bottom:0},e.datavisualization.Diagram.Margin=function(i){return i=i||{},t.extend(!1,{},e.datavisualization.Diagram.MarginDefaults,i)},e.datavisualization.Diagram.PaddingDefaults={top:0,left:0,right:0,bottom:0},e.datavisualization.Diagram.Padding=function(i){return i=i||{},t.extend(!1,{},e.datavisualization.Diagram.PaddingDefaults,i)},e.datavisualization.Diagram.EndPointHitPaddingDefaults={top:0,left:0,right:0,bottom:0},e.datavisualization.Diagram.EndPointHitPadding=function(t){return(t=t||{}).top=t.top||0,t.left=t.left||0,t.right=t.right||0,t.bottom=t.bottom||0,t},e.datavisualization.Diagram.GestureDefaults={key:e.datavisualization.Diagram.Keys.None,keyModifiers:e.datavisualization.Diagram.KeyModifiers.None},e.datavisualization.Diagram.Gesture=function(i){return t.extend(!0,{},e.datavisualization.Diagram.GestureDefaults,i)},e.datavisualization.Diagram.CommandDefaults={gesture:e.datavisualization.Diagram.Gesture(),execute:null,canExecute:null,parameter:null},e.datavisualization.Diagram.Command=function(i){return i.gesture&&(i.gesture=e.datavisualization.Diagram.Gesture(i.gesture)),i.canExecute||(i.canExecute=function(){return!0}),i.execute||(i.execute=function(){}),t.extend(!0,{},e.datavisualization.Diagram.CommandDefaults,i)},e.datavisualization.Diagram.TooltipDefaults={templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5},offset:null,delay:0},e.datavisualization.Diagram.Tooltip=function(i){return i.margin=i.margin||{},i.margin.top=void 0!==i.margin.top?i.margin.top:5,i.margin.left=void 0!==i.margin.left?i.margin.left:5,i.margin.right=void 0!==i.margin.right?i.margin.right:5,i.margin.bottom=void 0!==i.margin.bottom?i.margin.bottom:5,i.margin=e.datavisualization.Diagram.Margin(i.margin),i.alignment=i.alignment||{},i.alignment&&(i.alignment.horizontal=i.alignment.horizontal?i.alignment.horizontal:"center",i.alignment.vertical=i.alignment.vertical?i.alignment.vertical:"bottom"),t.extend(!1,{},e.datavisualization.Diagram.TooltipDefaults,i)},e.datavisualization.Diagram.BackgroundImageDefaults={source:"",alignment:"xmidymid",scale:"meet"},e.datavisualization.Diagram.BackgroundImage=function(i){return t.extend(!1,{},e.datavisualization.Diagram.BackgroundImageDefaults,i)},e.datavisualization.Diagram.Path=function(){this._path=""},e.datavisualization.Diagram.Path.prototype={moveTo:function(t,e){return this._path+="M"+t+","+e,this},lineTo:function(t,e){return this._path+="L"+t+","+e,this},cubicBezierTo:function(t,e){return this._path+=e?"S":"C",this._addPoints(t),this},quadraticBezierTo:function(t,e){return this._path+=e?"T":"Q",this._addPoints(t),this},ellipticalArcTo:function(t,e,i,a,n,o,s){return this._path+="A"+t+","+e+" "+i+" "+a+","+n+" "+o+","+s,this},close:function(){return this._path+="Z",this},toString:function(){return this._path},_addPoints:function(t){for(var e,i=0;i<t.length;i++)e=t[i],this._path+=e.x+", "+e.y,i!==t.length-1&&(this._path+=" ")}},e.datavisualization.Diagram.DecoratorDefaults={shape:e.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",borderWidth:1,fillColor:"black",pathData:"",cssClass:""},e.datavisualization.Diagram.Decorator=function(i){return t.extend(!1,{},e.datavisualization.Diagram.DecoratorDefaults,i)},e.datavisualization.Diagram.TextBlockDefaults={readOnly:!1,bold:!1,italic:!1,text:"",textDecoration:e.datavisualization.Diagram.TextDecorations.None,fontSize:12,fontFamily:"Arial",fontColor:"black",boundaryConstraints:!0,segmentOffset:.5,offset:e.datavisualization.Diagram.Point(.5,.5),textAlign:e.datavisualization.Diagram.TextAlign.Center,alignment:e.datavisualization.Diagram.Alignment.Center,relativeMode:e.datavisualization.Diagram.LabelRelativeMode.SegmentPath,horizontalAlignment:e.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:e.datavisualization.Diagram.VerticalAlignment.Center,wrapping:e.datavisualization.Diagram.TextWrapping.WrapWithOverflow,margin:e.datavisualization.Diagram.Margin(),padding:e.datavisualization.Diagram.Padding(),textOverflow:!1,overflowType:e.datavisualization.Diagram.OverflowType.Ellipsis,mode:e.datavisualization.Diagram.LabelEditMode.Edit,width:50,rotateAngle:0,opacity:1,templateId:"",templateType:"html"},e.datavisualization.Diagram.TextBlock=function(i){return i.offset=i.offset||{},i.offset=e.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:.5),i.margin=e.datavisualization.Diagram.Margin(i.margin),void 0!==i.wrapText&&(i.wrapping=i.wrapText?"wrapwithoverflow":"nowrap"),t.extend(!1,{},e.datavisualization.Diagram.TextBlockDefaults,i)},e.datavisualization.Diagram.LabelDefaults=t.extend(!1,{},e.datavisualization.Diagram.TextBlockDefaults,{name:"",visible:!0,borderColor:"transparent",borderWidth:0,fillColor:"transparent",cssClass:"",hyperlink:"",dragLimit:e.datavisualization.Diagram.DragLimit(),height:0,constraints:e.datavisualization.Diagram.LabelConstraints.None,_type:"label"}),e.datavisualization.Diagram.Label=function(i){i.offset=i.offset||{},i.offset=e.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:.5),i.dragLimit=e.datavisualization.Diagram.DragLimit(i.dragLimit),i.margin=e.datavisualization.Diagram.Margin(i.margin),i.padding=e.datavisualization.Diagram.Margin(i.padding);var a=t.extend(!1,{},e.datavisualization.Diagram.LabelDefaults,i);return a.name||(a.name="label_"+e.datavisualization.Diagram.Util.randomId()),a},e.datavisualization.Diagram.serializationSettingsDefaults={preventDefaultValues:!1},e.datavisualization.Diagram.serializationSettings=function(i){return t.extend(!1,{},e.datavisualization.Diagram.serializationSettingsDefaults,i)},e.datavisualization.Diagram.ExportSettingsDefaults={multiplePage:!1,pageWidth:null,pageHeight:null,pageOrientation:"portrait",stretch:"none"},e.datavisualization.Diagram.ExportSettings=function(i){return t.extend(!1,{},e.datavisualization.Diagram.ExportSettingsDefaults,i)},e.datavisualization.Diagram.LayersDefaults={name:"",visible:!0,print:!0,active:!1,lock:!1,snap:!1,objects:[]},e.datavisualization.Diagram.Layers=function(i){return t.extend(!1,{},e.datavisualization.Diagram.LayersDefaults,i)},e.datavisualization.Diagram.PrintSettingsDefaults={multiplePage:!1,pageWidth:null,pageHeight:null,pageOrientation:"portrait",margin:{left:0,top:0,right:0,bottom:0},region:"pageSettings"},e.datavisualization.Diagram.PrintSettings=function(i){return(i=i||{}).margin=e.datavisualization.Diagram.Margin(i.margin),t.extend(!1,{},e.datavisualization.Diagram.PrintSettingsDefaults,i)},e.datavisualization.Diagram.FlipDirection={Horizontal:"horizontal",Vertical:"vertical",Both:"both",None:"none"},e.datavisualization.Diagram.IconDefaults={shape:e.datavisualization.Diagram.IconShapes.None,width:15,height:15,offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,margin:e.datavisualization.Diagram.Margin(),horizontalAlignment:e.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:e.datavisualization.Diagram.VerticalAlignment.Center,cornerRadius:0,fillColor:"white",source:"",pathData:"",templateId:""},e.datavisualization.Diagram.expandIcon=function(i){return i.offset=i.offset||{},i.offset=e.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:1),i.margin=e.datavisualization.Diagram.Margin(i.margin),t.extend(!1,{},e.datavisualization.Diagram.IconDefaults,i)},e.datavisualization.Diagram.collapseIcon=function(i){return i.offset=i.offset||{},i.offset=e.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:1),i.margin=e.datavisualization.Diagram.Margin(i.margin),t.extend(!1,{},e.datavisualization.Diagram.IconDefaults,i)},e.datavisualization.Diagram.PortDefaults={name:"",visibility:e.datavisualization.Diagram.PortVisibility.Default,constraints:e.datavisualization.Diagram.PortConstraints.Connect,size:8,offset:e.datavisualization.Diagram.Point(0,0),borderColor:"#1a1a1a",borderWidth:1,fillColor:"white",shape:e.datavisualization.Diagram.PortShapes.Square,pathData:"",connectorPadding:0,cssClass:"",margin:e.datavisualization.Diagram.Margin(),parent:""},e.datavisualization.Diagram.ShadowDefaults={distance:5,angle:45,opacity:.7},e.datavisualization.Diagram.Shadow=function(i){return t.extend(!1,{},e.datavisualization.Diagram.ShadowDefaults,i)},e.datavisualization.Diagram.Port=function(i){i.offset=i.offset||{},i.offset=e.datavisualization.Diagram.Point(i.offset.x?i.offset.x:0,i.offset.y?i.offset.y:0),i.margin=e.datavisualization.Diagram.Margin(i.margin);var a=t.extend(!1,{},e.datavisualization.Diagram.PortDefaults,i);return a.name||(a.name="port_"+e.datavisualization.Diagram.Util.randomId()),a},e.datavisualization.Diagram.StopDefaults={color:"",offset:0,opacity:1},e.datavisualization.Diagram.Stop=function(i){return t.extend(!1,{},e.datavisualization.Diagram.StopDefaults,i)},e.datavisualization.Diagram.LinearGradientDefaults={type:"linear",x1:0,x2:0,y1:0,y2:0,stops:[]},e.datavisualization.Diagram.LinearGradient=function(i){i.stops=i.stops?i.stops.slice():[];for(var a=0;i.stops&&a<i.stops.length;a++)i.stops[a]=e.datavisualization.Diagram.Stop(i.stops[a]);return t.extend(!1,{},e.datavisualization.Diagram.LinearGradientDefaults,i)},e.datavisualization.Diagram.RadialGradientDefaults={type:"radial",cx:0,cy:0,fx:0,fy:0,r:50,stops:[]},e.datavisualization.Diagram.RadialGradient=function(i){i.stops=i.stops?i.stops.slice():[];for(var a=0;a<i.stops.length;a++)i.stops[a]=e.datavisualization.Diagram.Stop(i.stops[a]);return t.extend(!1,{},e.datavisualization.Diagram.RadialGradientDefaults,i)},e.datavisualization.Diagram.NodeBaseDefaults={name:"",width:0,height:0,offsetX:0,offsetY:0,visible:!0,zOrder:-1,excludeFromLayout:!1,constraints:e.datavisualization.Diagram.NodeConstraints.Default,parent:"",labels:[],expandIcon:{shape:e.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:e.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},collapseIcon:{shape:e.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:e.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},ports:[],inEdges:[],outEdges:[],rotateAngle:0,pivot:e.datavisualization.Diagram.Point(.5,.5),addInfo:{},marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:e.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:e.datavisualization.Diagram.VerticalAlignment.Top,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,connectorPadding:0,cornerRadius:0,paletteItem:null},e.datavisualization.Diagram.NodeBase=function(i){var a;if(i.labels=i.labels?i.labels.slice():[],i.ports=i.ports?i.ports.slice():[],i.inEdges=i.inEdges?i.inEdges.slice():[],i.outEdges=i.outEdges?i.outEdges.slice():[],i.expandIcon&&(i.expandIcon=e.datavisualization.Diagram.expandIcon(i.expandIcon?i.expandIcon:{})),i.collapseIcon&&(i.collapseIcon=e.datavisualization.Diagram.collapseIcon(i.collapseIcon?i.collapseIcon:{})),i.labels)for(a=0;a<i.labels.length;a++)i.labels[a]=e.datavisualization.Diagram.Label(i.labels[a]),e.datavisualization.Diagram.Util.canMoveLabel(i)&&(i.labels[a].constraints=e.datavisualization.Diagram.LabelConstraints.All&~e.datavisualization.Diagram.LabelConstraints.Selectable),i.labels[a]._parent=i.name;if(i.ports)for(a=0;a<i.ports.length;a++)i.ports[a].parent=i.name,i.ports[a]=e.datavisualization.Diagram.Port(i.ports[a]);return i.paletteItem=e.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),t.extend(!1,{},e.datavisualization.Diagram.NodeBaseDefaults,i)},e.datavisualization.Diagram.NodeDefaults={fillColor:"white",borderColor:"black",borderWidth:1,borderDashArray:"",opacity:1,gradient:null,borderGradient:null,type:e.datavisualization.Diagram.Shapes.Basic,flip:e.datavisualization.Diagram.FlipDirection.None,isExpanded:!0,shadow:e.datavisualization.Diagram.Shadow(),cssClass:""},e.datavisualization.Diagram.Node=function(i){return(i=i||{}).pivot=i.pivot||{},i.pivot=e.datavisualization.Diagram.Point(void 0!==i.pivot.x?i.pivot.x:.5,void 0!==i.pivot.y?i.pivot.y:.5),i.container&&t.isEmptyObject(i.container)&&(i.container=null),(i.linearGradient||i.radialGradient)&&(i.gradient=i.linearGradient||i.radialGradient),i.gradient&&("linear"===i.gradient.type?i.gradient=e.datavisualization.Diagram.LinearGradient(i.gradient):"radial"===i.gradient.type&&(i.gradient=e.datavisualization.Diagram.RadialGradient(i.gradient))),i.borderGradient&&("linear"===i.borderGradient.type?i.borderGradient=e.datavisualization.Diagram.LinearGradient(i.borderGradient):"radial"===i.borderGradient.type&&(i.borderGradient=e.datavisualization.Diagram.RadialGradient(i.borderGradient))),i.shadow&&(i.shadow=e.datavisualization.Diagram.Shadow(i.shadow)),i.tooltip&&(i.tooltip=e.datavisualization.Diagram.Tooltip(i.tooltip)),i&&!i.name&&(i.name="node_"+e.datavisualization.Diagram.Util.randomId()),i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,i.width||i._width||(i._width=i.minWidth?i.minWidth:i.maxWidth),i.height||i._height||(i._height=i.minHeight?i.minHeight:i.maxHeight),i._hidePorts&&(i.ports=[]),t.extend(!1,{},e.datavisualization.Diagram.NodeDefaults,e.datavisualization.Diagram.NodeBase(i),e.datavisualization.Diagram.Shape(i))},e.datavisualization.Diagram.ConnectorDefaults={name:"",visible:!0,lineDashArray:"",targetDecorator:{shape:e.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},sourceDecorator:{shape:e.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},shape:void 0,segments:[e.datavisualization.Diagram.Segment({type:"straight"})],sourcePoint:e.datavisualization.Diagram.Point(),targetPoint:e.datavisualization.Diagram.Point(),lineColor:"black",lineWidth:1,flip:e.datavisualization.Diagram.FlipDirection.None,constraints:e.datavisualization.Diagram.ConnectorConstraints.Default,opacity:1,parent:"",labels:[],zOrder:-1,lineHitPadding:10,addInfo:{},targetNode:null,targetPort:null,sourceNode:null,sourcePort:null,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:e.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:e.datavisualization.Diagram.VerticalAlignment.Top,cornerRadius:0,bridgeSpace:10,sourcePadding:0,targetPadding:0,type:"connector",cssClass:"",_endPointHitPadding:e.datavisualization.Diagram.EndPointHitPadding()},e.datavisualization.Diagram.Connector=function(i){if((i=i||{}).labels=i.labels?i.labels.slice():[],i.segments=i.segments?i.segments.slice():[],i._endPointHitPadding=e.datavisualization.Diagram.EndPointHitPadding(i.endPointHitPadding),i.sourcePoint=i.sourcePoint||{},i.sourcePoint=e.datavisualization.Diagram.Point(void 0!==i.sourcePoint.x?i.sourcePoint.x:.5,void 0!==i.sourcePoint.y?i.sourcePoint.y:.5),i.targetPoint=i.targetPoint||{},i.targetPoint=e.datavisualization.Diagram.Point(void 0!==i.targetPoint.x?i.targetPoint.x:.5,void 0!==i.targetPoint.y?i.targetPoint.y:.5),i.name=i.name?i.name:e.datavisualization.Diagram.Util.randomId(),i.targetDecorator=e.datavisualization.Diagram.Decorator(i.targetDecorator||{}),i.sourceDecorator=e.datavisualization.Diagram.Decorator(i.sourceDecorator&&!t.isEmptyObject(i.sourceDecorator)?i.sourceDecorator:{shape:e.datavisualization.Diagram.DecoratorShapes.None}),i.segments=i.segments||[e.datavisualization.Diagram.Segment({type:"straight"})],i._srcDecoratorSize=Math.max(parseInt(i.sourceDecorator.height),parseInt(i.sourceDecorator.width))+5*i.sourceDecorator.borderWidth,i._tarDecoratorSize=Math.max(parseInt(i.targetDecorator.height),parseInt(i.targetDecorator.width))+5*i.targetDecorator.borderWidth,i._inlineDecorators=[],i.segments&&(i.sourcePoint=i.sourcePoint||e.datavisualization.Diagram.Point(),i.targetPoint=i.targetPoint||e.datavisualization.Diagram.Point(),e.datavisualization.Diagram.Util._initializeSegments(i,i.defaultType),e.datavisualization.Diagram.Util.flipConnector(i,i.flip)),i.labels)for(var a=0;a<i.labels.length;a++)i.labels[a]=e.datavisualization.Diagram.Label(i.labels[a]),e.datavisualization.Diagram.Util.canMoveLabel(i)&&(i.labels[a].constraints=e.datavisualization.Diagram.LabelConstraints.All&~e.datavisualization.Diagram.LabelConstraints.Selectable),i.labels[a]._parent=i.name;return i.tooltip&&(i.tooltip=e.datavisualization.Diagram.Tooltip(i.tooltip)),i.paletteItem=e.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),t.extend(!1,{},e.datavisualization.Diagram.ConnectorDefaults,i)},e.datavisualization.Diagram.ContainerDefaults={type:e.datavisualization.Diagram.ContainerType.Canvas,orientation:"vertical"},e.datavisualization.Diagram.Container=function(i){return t.extend(!1,{},e.datavisualization.Diagram.ContainerDefaults,i)},e.datavisualization.Diagram.GroupDefaults={children:[],canUngroup:!0,allowDrop:!0,container:null,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,type:"group"},e.datavisualization.Diagram.Group=function(i){return(i=i||{}).children=i.children?i.children.slice():[],"bpmn"==i.type&&(i=e.datavisualization.Diagram.Node(i)),i.minWidth=i.minWidth?i.minWidth:100,i.minHeight=i.minHeight?i.minHeight:100,i.maxWidth=i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,i.maxHeight=i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,i.container=i.container?e.datavisualization.Diagram.Container(i.container):null,i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",(i=i||{}).container&&t.isEmptyObject(i.container)&&(i.container=null),i&&!i.name&&(i.name="group_"+e.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=e.datavisualization.Diagram.Tooltip(i.tooltip)),"pseudoGroup"===i.type&&(i.minWidth=0,i.minHeight=0,i.maxHeight=0,i.maxWidth=0),i._type||"umlclassifier"==i.type||(i._type=i.type?i.type:"group"),t.extend(!0,{},e.datavisualization.Diagram.NodeDefaults,e.datavisualization.Diagram.GroupDefaults,e.datavisualization.Diagram.NodeBase(i))},e.datavisualization.Diagram.ZoomCommand={ZoomIn:1,ZoomOut:2},e.datavisualization.Diagram.Zoom=function(i){return t.extend(!0,{},{zoomFactor:.2,focusPoint:null,zoomCommand:e.datavisualization.Diagram.ZoomCommand.ZoomIn},i)},e.datavisualization.Diagram.DragState={Starting:"starting",Dragging:"dragging",Completed:"completed"},e.datavisualization.Diagram.ResizeState={Starting:"starting",Resizing:"resizing",Completed:"completed"},e.datavisualization.Diagram.DiagramConstraints={None:1,UserInteraction:2,APIUpdate:4,PageEditable:6,Bridging:8,Zoomable:16,PannableX:32,PannableY:64,Pannable:96,Undoable:128,Resizable:256,ZoomTextEditor:512,FloatElements:1024,CrispEdges:2048,Routing:4096,Default:502},e.datavisualization.Diagram.BridgeDirection={Top:"top",Bottom:"bottom",Left:"left",Right:"right"},e.datavisualization.Diagram.Tool={None:1,SingleSelect:2,MultipleSelect:4,ZoomPan:8,DrawOnce:16,ContinuesDraw:32},e.datavisualization.Diagram.Region={Content:"content",PageSettings:"pageSettings"},e.datavisualization.Diagram.FileFormats={JPG:"jpg",PNG:"png",BMP:"bmp",SVG:"svg"},e.datavisualization.Diagram.ExportModes={Download:"download",Data:"data"},e.datavisualization.Diagram.FitMode={Page:"page",Width:"width",Height:"height"},e.datavisualization.Diagram.Stretch={None:"none",Fill:"fill",Uniform:"uniform",UniformToFill:"uniformtofill"},e.datavisualization.Diagram.shapeType={Image:"image",Path:"path",Native:"native"},e.datavisualization.Diagram.UserHandleDefaults={name:"",pathData:"",templateId:"",source:"",shape:e.datavisualization.Diagram.shapeType.Path,borderColor:"",backgroundColor:"#2382c3",position:"",offset:e.datavisualization.Diagram.Point(.5,1),margin:{left:0,right:0,top:0,bottom:-25},horizontalAlignment:e.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:e.datavisualization.Diagram.VerticalAlignment.Center,pathColor:"white",tool:"",size:20,visible:!0,enableMultiSelection:!1},e.datavisualization.Diagram.UserHandle=function(i){return t.extend(!0,{},e.datavisualization.Diagram.UserHandleDefaults,i)},e.datavisualization.Diagram.SwimLaneDefaults={header:t.extend(!0,{},e.datavisualization.Diagram.LabelDefaults,{text:"Title",borderColor:"black",fillColor:"#C7D4DF",horizontalAlignment:e.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:e.datavisualization.Diagram.VerticalAlignment.Stretch,width:50,height:50}),fillColor:"transparent",orientation:"vertical",type:"group",isSwimlane:!0,offsetX:100,offsetY:100,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,height:100,width:100,lanes:[],phases:[],phaseSize:20,constraints:e.datavisualization.Diagram.NodeConstraints.Default|e.datavisualization.Diagram.NodeConstraints.AllowDrop&~(e.datavisualization.Diagram.NodeConstraints.ResizeNorth|e.datavisualization.Diagram.NodeConstraints.ResizeWest|e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest),addInfo:{},cssClass:""},e.datavisualization.Diagram.SwimLane=function(i){return(i=i||{}).lanes=i.lanes?i.lanes.slice():[],i.phases=i.phases?i.phases.slice():[],i&&!i.name&&(i.name="swimlane_"+e.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=e.datavisualization.Diagram.Tooltip(i.tooltip)),i.header||(i.header={}),i.header.height=void 0!=i.header.height?i.header.height:50,i.header.width=void 0!=i.header.width?i.header.width:50,t.extend(!0,{},e.datavisualization.Diagram.SwimLaneDefaults,i)},e.datavisualization.Diagram.LaneDefaults={header:t.extend(!0,{},e.datavisualization.Diagram.LabelDefaults,{text:"Function",borderColor:"black",fillColor:"#C7D4DF",horizontalAlignment:e.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:e.datavisualization.Diagram.VerticalAlignment.Stretch,width:50,height:50}),name:"",children:[],isLane:!0,orientation:"horizontal",fillColor:"#f5f5f5",labels:[],addInfo:{},minHeight:100,minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,constraints:e.datavisualization.Diagram.NodeConstraints.Default|e.datavisualization.Diagram.NodeConstraints.AllowDrop&~e.datavisualization.Diagram.NodeConstraints.Connect,cssClass:""},e.datavisualization.Diagram.Lane=function(i){return(i=i||{}).labels=i.labels?i.labels.slice():[],i.children=i.children?i.children.slice():[],i&&!i.name&&(i.name="lane_"+e.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=e.datavisualization.Diagram.Tooltip(i.tooltip)),t.extend(!0,{},e.datavisualization.Diagram.LaneDefaults,i)},e.datavisualization.Diagram.PhaseDefaults={name:"",type:"phase",offset:100,lineWidth:1,lineDashArray:"3,3",lineColor:"#606060",parent:"",fillColor:"white",orientation:"horizontal",label:{text:"Phase"}},e.datavisualization.Diagram.Phase=function(i){return i.label&&(i.label=e.datavisualization.Diagram.Label(i.label),i._UndoRedo||i._isUndo||(i.label.text=i.label.text?i.label.text:"Phase")),t.extend(!0,{},e.datavisualization.Diagram.PhaseDefaults,i)},e.datavisualization.Diagram.PaletteItemDefaults={width:void 0,height:void 0,enableScale:!0,previewHeight:void 0,previewWidth:void 0,wrapping:e.datavisualization.Diagram.TextWrapping.NoWrap,label:null,margin:e.datavisualization.Diagram.Margin({left:4,right:4,top:4,bottom:4})},e.datavisualization.Diagram.PaletteItem=function(i){return i.margin=i.margin||{},i.margin.left=void 0!==i.margin.left?i.margin.left:4,i.margin.right=void 0!==i.margin.right?i.margin.right:4,i.margin.top=void 0!==i.margin.top?i.margin.top:4,i.margin.bottom=void 0!==i.margin.bottom?i.margin.bottom:4,i.margin=e.datavisualization.Diagram.Margin(i.margin),t.extend(!1,{},e.datavisualization.Diagram.PaletteItemDefaults,i)},e.datavisualization.Diagram.SwimLaneHelper={_initSwimLane:function(i,a,n){var o,s,r,l,d,h,g,c=null;(i=e.datavisualization.Diagram.SwimLane(i)).orientation=i.orientation?i.orientation:"vertical",s=this._initphases(i,a),o=this._initLanes(i,a,n),r=[],l=null,i.header||(i.header={text:"",height:0,fillColor:"white"}),"horizontal"===i.orientation?d=i.header.height:h=i.header.width,i.header&&(l=e.datavisualization.Diagram.Node({_type:"node",_isHeader:!0,name:i.name+"_header_swimlane",labels:[i.header],height:d||50,width:h||50,fillColor:i.header.fillColor?i.header.fillColor:"white",rotateAngle:0,constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name})),l&&(a.nodes().push(l),a._nodes=t.extend(!0,[],a.nodes()),a.nameTable[l.name]=l,r.push(l.name)),g=0==i.phaseSize?.001:i.phaseSize?i.phaseSize:20;this._initPhaseStack(i,a,r,g);i.orientation;var u,m=0,p=0,f=0;"horizontal"==i.orientation?(u="vertical",p=(i.header?i.header.height:50)+g,f=0):(u="horizontal",p=i.header?i.header.height:50,m=i.phaseSize?i.phaseSize:g,f=(i.header?i.header.height:50)+g);var _=e.datavisualization.Diagram.Group({name:i.name+"_stack",children:o,parent:i.name,container:{type:e.datavisualization.Diagram.ContainerType.Stack,orientation:u},horizontalAlign:"stretch",verticalAlign:"stretch",marginTop:p,width:10,height:10,marginLeft:m,minHeight:f,constraints:e.datavisualization.Diagram.NodeConstraints.Default&~(e.datavisualization.Diagram.NodeConstraints.Select|e.datavisualization.Diagram.NodeConstraints.Connect)}),v=0,y=0;return"horizontal"==i.orientation?(v=i.width,y=100):"vertical"==i.orientation&&(v=100,y=i.height-l.height),a.nodes().push(_),a._nodes=t.extend(!0,[],a.nodes()),a.nameTable[_.name]=_,r.push(_.name),(c=e.datavisualization.Diagram.Group({name:i.name?i.name:"",type:"group",addInfo:i.addInfo?i.addInfo:{},parent:"",offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,children:r,zOrder:i.zOrder||0===i.zOrder?i.zOrder:-1,fillColor:"transparent",labels:[{mode:e.datavisualization.Diagram.LabelEditMode.View}],container:{type:e.datavisualization.Diagram.ContainerType.Canvas},minHeight:y||100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:v||100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,constraints:i.constraints?i.constraints|e.datavisualization.Diagram.NodeConstraints.AllowDrop:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.AllowDrop^e.datavisualization.Diagram.NodeConstraints.ResizeNorth^e.datavisualization.Diagram.NodeConstraints.ResizeWest^e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest,phaseSize:g,cssClass:i.cssClass})).isSwimlane=!0,c.phases=s,c.orientation=i.orientation,c.constraints="horizontal"==c.orientation?c.constraints^e.datavisualization.Diagram.NodeConstraints.ResizeEast^e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast:c.constraints^e.datavisualization.Diagram.NodeConstraints.ResizeSouth^e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast,c},_initPhaseStack:function(i,a,n,o){var s,r,l,d,h,g="horizontal";g&&("horizontal"==i.orientation?(g="horizontal","stretch",s=!0):(g="vertical","stretch",s=!1));var c=e.datavisualization.Diagram.Group({name:i.name+"phaseStack",container:{type:"stack",orientation:g},type:"group",parent:i.name,offsetX:0,offsetY:0,minHeight:o,maxHeight:o,minWidth:o,maxWidth:o,marginTop:i.header?i.header.height:50,isPhaseStack:!0,constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect}),u=0;for(i.phaseSize&&(i.phaseSize=i.phaseSize<1?20:i.phaseSize),d=0;d<i.phases.length;d++)s?(r=i.phaseSize?i.phaseSize:20,l=i.phases[d].offset-u):(r=i.phases[d].offset-u,0==d&&(r-=i.header?i.header.height:50),l=i.phaseSize?i.phaseSize:20,i.phases[d].label&&(i.phases[d].label.rotateAngle=270)),(h=e.datavisualization.Diagram.Node({parent:i.name+"phaseStack",_isHeader:!0,name:"phaseStack"+i.phases[d].name,height:r,width:l,labels:[i.phases[d].label],constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect})).labels[0].name="phaseStack"+i.phases[d].name+"label",h.labels[0].mode=e.datavisualization.Diagram.LabelEditMode.View,h.isPhase=!0,u=i.phases[d].offset,a.nameTable[h.name]=h,c.children.push(h.name),a.nodes().push(h),a._nodes=t.extend(!0,[],a.nodes());a.nodes().push(c),a._nodes=t.extend(!0,[],a.nodes()),n.push(c),a.nameTable[c.name]=c},_setDefaultLaneProperties:function(t){t.lanes=t.lanes?t.lanes:[],t.lanes.push(e.datavisualization.Diagram.Lane({}))},_initLanes:function(i,a,n){var o,s=[],r=null;if(i.lanes&&0!==i.lanes.length||this._setDefaultLaneProperties(i),i.lanes)for(o=0;o<i.lanes.length;o++)jQuery.isEmptyObject(i.lanes[o])&&(i.lanes[o]=e.datavisualization.Diagram.Lane()),i.lanes[o]._laneHeader=i.lanes[o]._laneHeader?i.lanes[o]._laneHeader:i.lanes[o].header,r=this._initLane(i.lanes[o],i,a,n),s.push(r.name),a.nodes().push(r),a._nodes=t.extend(!0,[],a.nodes()),a.nameTable[r.name]=r;return s},_initLane:function(i,a,n,o){var s,r,l,d,h,g,c=null,u=null;if("horizontal"==a.orientation?c="stretch":u="stretch",!1,s=e.datavisualization.Diagram.Group({name:i.name,addInfo:i.addInfo?i.addInfo:{},type:"group",isLane:!0,parent:a.name+"_stack",offsetX:0,offsetY:0,borderColor:i.borderColor?i.borderColor:"black",orientation:a.orientation?a.orientation:"horizontal",fillColor:i.fillColor,container:{type:e.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:c||"left",verticalAlign:u||"top",minHeight:i.height?i.height:100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:i.width?i.width:100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:i.constraints?i.constraints|e.datavisualization.Diagram.NodeConstraints.AllowDrop:e.datavisualization.Diagram.NodeConstraints.Default|e.datavisualization.Diagram.NodeConstraints.AllowDrop&~e.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass}),i.labels&&i.labels.length>0){for(r=0;r<i.labels.length;r++)i.labels[r]=e.datavisualization.Diagram.Label(i.labels[r]);s.labels=i.labels}for(o||(l=i._laneHeader?i._laneHeader:null,(d=this._iniLaneHeader(i,s.name,a,n,l))&&(n.nodes().push(d),n._nodes=t.extend(!0,[],n.nodes()),n.nameTable[d.name]=d,s.children.push(d.name))),h=this._initChildren(i,s.name,n),g=0;g<h.length;g++)s.children.push(h[g]);return s},_iniLaneHeader:function(t,i,a,n,o){var s=null;return t.header&&(s=e.datavisualization.Diagram.Node({_isHeader:!0,name:i+"_Headerr_",type:"node",labels:[a.header],height:o.height?o.height:50,width:o.width?o.width:50,fillColor:t.header.fillColor?t.header.fillColor:"white",rotateAngle:0,constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20,parent:i}),a.orientation&&"horizontal"==a.orientation?(s.verticalAlign="stretch",s.height=1,s.width=o.width?o.width:50):a.orientation&&"vertical"==a.orientation&&(s.horizontalAlign="stretch",s.labels[0].rotateAngle=0,s.height=o.width?o.width:50,s.width=1)),s},_initChildren:function(e,i,a){var n,o,s=[],r=null;if(e.children)for(n=0;n<e.children.length;n++)(r="object"==typeof e.children[n]?e.type&&"bpmn"===e.type?e.children[n]:this._initChild(e.children[n],i,a):a.nameTable[a._getChild(e.children[n])])&&(r.segments?(a.connectors().push(r),a._connectors=t.extend(!0,[],a.connectors())):(r.children&&(o=this._initChildren(r,r.name,a)),o&&(r.children=o),a.nodes().push(r),a._nodes=t.extend(!0,[],a.nodes())),s.push(r.name),a.nameTable[r.name]=r);return s},_initChild:function(t,i,a){var n=null;return(n=t&&t.children&&t.children.length>0?a._getNewGroup(e.datavisualization.Diagram.NodeType(t,a)):a._getNewNode(e.datavisualization.Diagram.NodeType(t,a))).parent=i,n},_swapPhaseSize:function(t){if(t.phases.length>0)for(var e,i,a=t.phases,n=0;n<a.length;n++)for(e=0;e<a.length-n-1;e++)a[e].offset>a[e+1].offset&&(i=a[e],a[e]=a[e+1],a[e+1]=i)},_setSwimlaneSize:function(t){var e,i;if(t.phases.length>0)for(i in t.phases)e=t.phases[i],"horizontal"===t.orientation?e.offset>t.width&&(t.width=e.offset):e.offset>t.height&&(t.height=e.offset)},_setLastPhaseSize:function(t){t.phases.length>0&&(t.phases[t.phases.length-1].offset="horizontal"===t.orientation?t.width:t.height)},_NeedDefaultPhase:function(t){return!(t.phases.length>0)},_checkForDefPhase:function(t){return!(t.phases.length>0)},_initphases:function(t,i){var a,n,o=[],s=null,r=0,l=0;if("vertical"===t.orientation?(l=t.height,r=270):l=t.width,a=e.datavisualization.Diagram.Phase({name:t.name+"defPhase",offset:l,label:t._lastPhase?t._lastPhase.labels[0]:{text:"Phase",rotateAngle:r}}),this._NeedDefaultPhase(t)?t.phases.push(a):(this._swapPhaseSize(t),this._setSwimlaneSize(t),this._setLastPhaseSize(t)),t.phases&&t.phases.length>0)for(n=0;n<t.phases.length;n++)(s=e.datavisualization.Diagram.Phase(t.phases[n])).parent=t.name,s.orientation=t.orientation,i.nameTable[s.name]=s,o.push(s.name);return o},_createSwimlane:function(t,i,a,n,o){var s,r,l,d=[],h=a?a.childTable:i.nameTable,g=500,c=500,u=null,m=t.constraints?t.constraints:e.datavisualization.Diagram.NodeConstraints.Default;return t.children[0]?((s=n?t.children[0]:h[i._getChild(t.children[0])])||(s=o),"string"==typeof s&&(s=h[s]),u={text:"Title",width:50,fillColor:s.fillColor?s.fillColor:t.fillColor,height:50}):u={text:"Title",width:50,fillColor:"white",height:50},t.orientation||t.container&&(t.orientation=t.container.orientation),r=0,"horizontal"==t.orientation&&i._selectedSymbol?(g=t.height?t.height:100,c=t.width?t.width:650,r=g):(g=t.height?t.height:650,c=t.width?t.width:100,r=t.height+u.height),t.children.length>1&&(t.children.splice(0,1),d=t.children),l={name:t.name+e.datavisualization.Diagram.Util.randomId(),header:u,fillColor:"white",isSwimlane:!0,minWidth:c,minHeight:g,height:r+1,width:c+1,maxHeight:g+Number.POSITIVE_INFINITY,maxWidth:c+Number.POSITIVE_INFINITY,offsetX:t.offsetX,offsetY:t.offsetY,orientation:t.orientation?t.orientation:"horizontal",addInfo:t.addInfo?t.addInfo:null,paletteItem:t.paletteItem?t.paletteItem:null,lanes:[{name:t.name,addInfo:t.addInfo?t.addInfo:{},constraints:m,header:{text:s.labels[0].text||""===s.labels[0].text?s.labels[0].text:"HEADER",fontSize:s.labels[0].fontSize?s.labels[0].fontSize:11,width:s.width?s.width:50,height:s.height?s.height:50,fillColor:s.fillColor,bold:!!s.labels[0].bold,italic:!!s.labels[0].italic,fontFamily:s.labels[0].fontFamily?s.labels[0].fontFamily:"Arial",fontColor:s.labels[0].fontColor?s.labels[0].fontColor:"black"},fillColor:t.fillColor?t.fillColor:"white",height:g,width:c,minHeight:g,minWidth:c,children:d||[],_laneHeader:t._laneHeader?t._laneHeader:null}]},e.datavisualization.Diagram.ContainerHelper._initContainer(i,l)},_createDiagramLane:function(t){var i=t._lane?t._lane:null,a=t.orientation,n=t.constraints?t.constraints:e.datavisualization.Diagram.NodeConstraints.Default,o={children:[{name:t.name+"_Headerr_",height:i.header?i.header.height:50,width:i.header?i.header.width:50,fillColor:i.header?i.header.fillColor:50,labels:i.header?[i.header]:[],horizontalAlign:"vertical"===a?"stretch":"left",verticalAlign:"vertical"===a?"top":"stretch"}],container:{type:"canvas"},name:t.name?t.name:e.datavisualization.Diagram.Util.randomId(),minHeight:i.minHeight?i.minHeight:100,minWidth:i.minWidth?i.minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,borderColor:"black",constraints:n|e.datavisualization.Diagram.NodeConstraints.AllowDrop&~e.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass?i.cssClass:"",addInfo:i.addInfo?i.addInfo:null,paletteItem:t.paletteItem?t.paletteItem:null,fillColor:i.fillColor?i.fillColor:"white",isLane:!0,offsetX:t.offsetX?t.offsetX:100,offsetY:t.offsetY?t.offsetY:100,orientation:a||"horizontal"};return o.children[0].labels[0].rotateAngle="horizontal"===a?270:0,o},_createPaletteLane:function(t,i){var a,n,o,s,r,l=0,d=0,h=0,g=0,c=0,u=0;return a=(t=e.datavisualization.Diagram.Lane(t)).constraints?t.constraints:e.datavisualization.Diagram.NodeConstraints.Default,!t.paletteItem||t.paletteItem.enableScale||t.paletteItem.width||"horizontal"===t.orientation&&(u+=2),"horizontal"==t.orientation?(d=25,h=14+u,g=(l=t.height?t.height:50)/2+1,c=270,"left"):"vertical"==t.orientation&&(l=25,h=(d=t.width?t.width:50)/2,g=15,"left"),n=t.header.text?t.header.text:"",i[(o=e.datavisualization.Diagram.Node({name:t.name+"_"+n,_type:"node",labels:[{text:t.header.text?t.header.text:"Function",fontSize:t.header.fontSize?t.header.fontSize:11,offset:{x:.5,y:.5},width:100,rotateAngle:c}],height:l,width:d,fillColor:t.header.fillColor?t.header.fillColor:"white",parent:t.name,offsetX:h,offsetY:g,constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Connect})).name]=o,"horizontal"==t.orientation?(l=t.height,h=25+(d=t.width-25)/2+u,g=l/2+1):"vertical"==t.orientation&&(l=t.height-25,h=(d=t.width)/2,g=25+l/2),(s=e.datavisualization.Diagram.Node({name:t.name+"content",_type:"node",height:l,width:d,fillColor:t.fillColor?t.fillColor:"white",parent:t.name,offsetX:h,offsetY:g}))._laneHeader=t.header,i[s.name]=s,(r=e.datavisualization.Diagram.Group({name:t.name+"_group",addInfo:t.addInfo?t.addInfo:{},height:t.height,width:t.width,header:t.header?t.header:null,offsetX:t.offsetX,offsetY:t.offsetY,children:[o.name,s.name],paletteItem:t.paletteItem?t.paletteItem:null}))._lane=t,r.constraints=a,r.isLane=!0,r.orientation=t.orientation,r},_mapObject:function(t,e,i,a){var n;switch(i){case"lane":n=this._mapLane(t,e);break;case"phase":n=this._mapPhase(t,e);break;case"swimlane":n=this._mapSwimlane(t,e,a)}return n},_mapLane:function(t,i,a){var n=e.datavisualization.Diagram.Lane();return this._mapLaneHeader(t,i,n,a),this._mapChildren(t,i,n,a),n.name=i.name,n.labels=i.labels,n.fillColor=i.fillColor,n.orientation=i.orientation,n.maxHeight=i.maxHeight,n.maxWidth=i.maxWidth,n.minHeight=i.height>i.minHeight?i.height:i.minHeight,n.minWidth=i.width>i.minWidth?i.width:i.minWidth,n.constraints=i.constraints,n.addInfo=i.addInfo?i.addInfo:{},"horizontal"===i.orientation?(n.height=i.height,n.width=null):(n.height=null,n.width=i.width),n},_mapLaneHeader:function(t,e,i,a){var n;e.children[0]&&(n=t.nameTable[t._getChild(e.children[0])]),!n&&a&&(n=a[t._getChild(e.children[0])]),n&&(n.labels&&n.labels[0]&&(n.name&&(i.header.name=n.name),i.header.text=n.labels[0].text,i.header.fontColor=n.labels[0].fontColor,i.header.fontSize=n.labels[0].fontSize,i.header.fontFamily=n.labels[0].fontFamily,i.header.bold=n.labels[0].bold,i.header.italic=n.labels[0].italic,i.header.textDecoration=n.labels[0].textDecoration,i.header.rotateAngle=n.labels[0].rotateAngle,i.header.textOverflow=n.labels[0].textOverflow,i.header.overflowType=n.labels[0].overflowType,n.labels[0].name&&(i.header._labelName=n.labels[0].name)),i.header.fillColor=n.fillColor,"vertical"===e.orientation?(i.header.height=n.height,i.header.width=null):(i.header.height=null,i.header.width=n.width))},_mapChildren:function(t,e,i,a){var n,o;if(e.children&&e.children.length>=2)for(o=1;o<e.children.length;o++)t._getChild(e.children[o])&&(n=t.nameTable[t._getChild(e.children[o])]),a&&!n&&(n=a[t._getChild(e.children[o])]),n&&(n.marginRight=0,n.marginBottom=0,i.children.push(n))},_mapSwimlane:function(t,i,a){var n=e.datavisualization.Diagram.SwimLane();return this._mapSwimlaneHeader(t,i,n,a),this._mapLanes(t,i,n,a),this._mapPhases(t,i,n,a),n.name=i.name,n.orientation=i.orientation,n.offsetX=i.offsetX,n.offsetY=i.offsetY,n.maxHeight=i.maxHeight,n.maxWidth=i.maxWidth,n.minHeight=i.minHeight,n.minWidth=i.minWidth,n.minWidth="horizontal"===n.orientation&&i.width&&i.minWidth&&i.width>i.minWidth?i.width:i.minWidth,n.phaseSize=i.phaseSize,n.constraints=i.constraints,n.zOrder=i.zOrder,n.addInfo=i.addInfo?i.addInfo:{},n.height=i.height,n.width=i.width,n},_mapSwimlaneHeader:function(t,e,i,a){if(e.children[0])var n=t.nameTable[t._getChild(e.children[0])];!n&&a&&(n=a[t._getChild(e.children[0])]),n&&(n.labels&&n.labels[0]&&(i.header.text=n.labels[0].text,i.header.fontColor=n.labels[0].fontColor,i.header.fontSize=n.labels[0].fontSize,i.header.fontFamily=n.labels[0].fontFamily,i.header.bold=n.labels[0].bold,i.header.italic=n.labels[0].italic,i.header.textDecoration=n.labels[0].textDecoration,i.header.textOverflow=n.labels[0].textOverflow,i.header.overflowType=n.labels[0].overflowType),i.header.fillColor=n.fillColor,i.header.height=n.height,i.header.width=n.width)},_mapLanes:function(t,e,i,a){var n,o,s,r;if(e.children[2]&&t._getChild(e.children[2])&&(n=a?a[t._getChild(e.children[2])]:t.nameTable[t._getChild(e.children[2])]),n&&n.children&&n.children.length>0)for(r=0;r<n.children.length;r++)t._getChild(n.children[r])&&(o=a?a[t._getChild(n.children[r])]:t.nameTable[t._getChild(n.children[r])]),o&&((s=this._mapLane(t,o,a))&&i.lanes.push(s))},_mapPhases:function(t,i,a,n){var o,s,r,l,d,h=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,i,n);if(h&&h.length>0){for(o=h.length,s=n||t.nameTable,h[h.length-1]&&s[h[h.length-1]]&&((r=s[h[h.length-1]]).name.split("defPhase").length>1||r.offset==i.width||o++),l=0;l<o;l++)(d=this._mapPhase(t,s[t._getChild(h[l])],n))&&a.phases.push(d);s["phaseStack"+h[h.length-1]]&&(a._lastPhase=this._mapPhase(t,s["phaseStack"+h[h.length-1]],n))}},_mapPhase:function(t,e,i){var a;return e&&(a=i?i[e.name]:t.nameTable[e.name]),a||null},_getSwimLaneNode:function(t,e,i,a){if(t.isSwimlane)if(i){if(a.nameTable[a._getChild(t.children[2])].container.orientation==e.orientation)return t}else if(a.nameTable[a._getChild(t.children[2])].container.orientation!=e.orientation)return t;if(t.parent){var n=a.nameTable[t.parent];if(n)return this._getSwimLaneNode(n,e,void 0,a)}return null}}}(jQuery,Syncfusion),function(t,e){"use strict";e.datavisualization.Diagram.BasicShapes={Rectangle:"rectangle",Ellipse:"ellipse",Path:"path",Polygon:"polygon",Triangle:"triangle",Plus:"plus",Star:"star",Pentagon:"pentagon",Heptagon:"heptagon",Octagon:"octagon",Trapezoid:"trapezoid",Decagon:"decagon",RightTriangle:"righttriangle",Cylinder:"cylinder"},e.datavisualization.Diagram.FlowShapes={Process:"process",Decision:"decision",Document:"document",PreDefinedProcess:"predefinedprocess",Terminator:"terminator",PaperTap:"papertap",DirectData:"directdata",SequentialData:"sequentialdata",Sort:"sort",MultiDocument:"multidocument",Collate:"collate",SummingJunction:"summingjunction",Or:"or",InternalStorage:"internalstorage",Extract:"extract",ManualOperation:"manualoperation",Merge:"merge",OffPageReference:"offpagereference",SequentialAccessStorage:"sequentialaccessstorage",Annotation1:"annotation1",Annotation2:"annotation2",Data:"data",Card:"card"},e.datavisualization.Diagram.ArrowShapes={None:"none",CircularArrow:"circulararrow",CurvedRightArrow:"curvedrightarrow",CurvedUpArrow:"curveduparrow",CurvedLeftArrow:"curvedleftarrow",CurvedDownArrow:"curveddownarrow",JumpingRightArrow:"jumpingrightarrow",JumpingLeftArrow:"jumpingleftarrow"},e.datavisualization.Diagram.BPMNShapes={Event:"event",Gateway:"gateway",Message:"message",DataObject:"dataobject",DataSource:"datasource",Activity:"activity",Group:"group"},e.datavisualization.Diagram.BPMNEvents={Start:"start",Intermediate:"intermediate",End:"end",NonInterruptingStart:"noninterruptingstart",NonInterruptingIntermediate:"noninterruptingintermediate",ThrowingIntermediate:"throwingintermediate"},e.datavisualization.Diagram.BPMNTriggers={None:"none",Message:"message",Timer:"timer",Escalation:"escalation",Link:"link",Error:"error",Compensation:"compensation",Signal:"signal",Multiple:"multiple",Parallel:"parallel",Cancel:"cancel",Conditional:"conditional",Terminate:"terminate"},e.datavisualization.Diagram.BPMNGateways={None:"none",Exclusive:"exclusive",Inclusive:"inclusive",Parallel:"parallel",Complex:"complex",EventBased:"eventbased",ExclusiveEventBased:"exclusiveeventbased",ParallelEventBased:"paralleleventbased"},e.datavisualization.Diagram.BPMNDataObjects={None:"none",Input:"input",Output:"output"},e.datavisualization.Diagram.BPMNActivity={None:"none",Task:"task",SubProcess:"subprocess"},e.datavisualization.Diagram.BPMNLoops={None:"none",Standard:"standard",ParallelMultiInstance:"parallelmultiinstance",SequenceMultiInstance:"sequencemultiinstance"},e.datavisualization.Diagram.BPMNTasks={None:"none",Service:"service",Receive:"receive",Send:"send",InstantiatingReceive:"instantiatingreceive",Manual:"manual",BusinessRule:"businessrule",User:"user",Script:"script",Parallel:"parallel"},e.datavisualization.Diagram.BPMNSubProcessTypes={None:"none",Transaction:"transaction",Event:"event"},e.datavisualization.Diagram.BPMNBoundary={Default:"default",Call:"call",Event:"event"},e.datavisualization.Diagram.BPMNAnnotationDirections={Top:"top",Left:"left",Right:"right",Bottom:"bottom"},e.datavisualization.Diagram.BPMNFlows={Sequence:"sequence",Association:"association",Message:"message"},e.datavisualization.Diagram.BPMNSequenceFlows={Normal:"normal",Conditional:"conditional",Default:"default"},e.datavisualization.Diagram.BPMNMessageFlows={Default:"default",InitiatingMessage:"initiatingmessage",NonInitiatingMessage:"noninitiatingmessage"},e.datavisualization.Diagram.ClassifierShapes={Package:"package",Class:"class",Interface:"interface",Enumeration:"enumeration",CollapsedPackage:"collapsedpackage",Inheritance:"inheritance",Association:"association",Aggregation:"aggregation",Composition:"composition",Realization:"realization",DirectedAssociation:"directedassociation",Dependency:"dependency"},e.datavisualization.Diagram.AssociationFlows={Default:"default",Directional:"directional",BiDirectional:"bidirectional"},e.datavisualization.Diagram.UMLActivityShapes={Action:"action",Decision:"decision",MergeNode:"mergenode",InitialNode:"initialnode",FinalNode:"finalnode",ForkNode:"forknode",JoinNode:"joinnode",TimeEvent:"timeevent",AcceptingEvent:"acceptingevent",SendSignal:"sendsignal",ReceiveSignal:"receivesignal",StructuredNode:"structurednode",Note:"note"},e.datavisualization.Diagram.UMLActivityFlow={Object:"object",Control:"control",Exception:"exception"},e.datavisualization.Diagram.BPMNEventDefaults={event:e.datavisualization.Diagram.BPMNEvents.Start,trigger:e.datavisualization.Diagram.BPMNTriggers.None,name:null,offset:e.datavisualization.Diagram.Point(),ports:[],labels:[]},e.datavisualization.Diagram.BPMNGatewayDefaults={gateway:e.datavisualization.Diagram.BPMNGateways.None},e.datavisualization.Diagram.BPMNDataObject=function(i){return t.extend(!1,{},{type:e.datavisualization.Diagram.BPMNDataObjects.None,collection:!1},i)},e.datavisualization.Diagram.BPMNDataObjectDefaults={data:e.datavisualization.Diagram.BPMNDataObject()},e.datavisualization.Diagram.BPMNTaskDefaults={loop:e.datavisualization.Diagram.BPMNLoops.None,type:e.datavisualization.Diagram.BPMNTasks.None,call:!1,compensation:!1,events:[]},e.datavisualization.Diagram.BPMNTask=function(i){return i&&(i.events=i.events?i.events.slice():[]),t.extend(!1,{},e.datavisualization.Diagram.BPMNTaskDefaults,i)},e.datavisualization.Diagram.BPMNSubProcessDefaults={type:e.datavisualization.Diagram.BPMNSubProcessTypes.None,event:e.datavisualization.Diagram.BPMNEvents.Start,trigger:e.datavisualization.Diagram.BPMNTriggers.Message,boundary:e.datavisualization.Diagram.BPMNBoundary.Default,loop:e.datavisualization.Diagram.BPMNLoops.None,adhoc:!1,compensation:!1,collapsed:!0,events:[],processes:[]},e.datavisualization.Diagram.BPMNSubProcess=function(i){return(i=i||{}).events=i.events?i.events.slice():[],i.processes=i.processes?i.processes.slice():[],t.extend(!1,{},e.datavisualization.Diagram.BPMNSubProcessDefaults,i)},e.datavisualization.Diagram.BPMNActivityDefaults={activity:e.datavisualization.Diagram.BPMNActivity.Task,task:e.datavisualization.Diagram.BPMNTask(),subProcess:e.datavisualization.Diagram.BPMNSubProcess()},e.datavisualization.Diagram.BPMNTextAnnotationDefaults={annotation:{width:20,height:20,angle:0,length:0,text:"",direction:e.datavisualization.Diagram.BPMNAnnotationDirections.Left}},e.datavisualization.Diagram.ConnectorShapeDefaults={type:"bpmn",flow:e.datavisualization.Diagram.BPMNFlows.Sequence,sequence:e.datavisualization.Diagram.BPMNSequenceFlows.Normal,association:e.datavisualization.Diagram.AssociationFlows.Default,message:e.datavisualization.Diagram.BPMNMessageFlows.Default},e.datavisualization.Diagram.Multiplicity={OneToOne:"onetoone",OneToMany:"onetomany",ManyToOne:"manytoone",ManyToMany:"manytomany"},e.datavisualization.Diagram.ClassifierMultiplicityDefault={type:e.datavisualization.Diagram.Multiplicity.OneToOne,source:{optional:!0,lowerBounds:null,upperBounds:null},target:{optional:!0,lowerBounds:null,upperBounds:null}},e.datavisualization.Diagram.UMLActivityFlowDefaults={type:"umlactivity",activityFlow:e.datavisualization.Diagram.UMLActivityFlow.Control},e.datavisualization.Diagram.AssociationDefaults={type:"classifier",association:e.datavisualization.Diagram.AssociationFlows.BiDirectional,multiplicity:e.datavisualization.Diagram.ClassifierMultiplicityDefault},e.datavisualization.Diagram.AggregationDefaults={type:"classifier",multiplicity:e.datavisualization.Diagram.ClassifierMultiplicityDefault},e.datavisualization.Diagram.CompositionDefaults={type:"classifier",multiplicity:e.datavisualization.Diagram.ClassifierMultiplicityDefault},e.datavisualization.Diagram.DependencyDefaults={type:"classifier",multiplicity:e.datavisualization.Diagram.ClassifierMultiplicityDefault},e.datavisualization.Diagram.RealizationDefaults={type:"classifier",multiplicity:e.datavisualization.Diagram.ClassifierMultiplicityDefault},e.datavisualization.Diagram.InheritanceDefaults={type:"classifier",multiplicity:e.datavisualization.Diagram.ClassifierMultiplicityDefault},e.datavisualization.Diagram.ScopeValueDefaults={Public:"public",Protected:"",Private:"",Package:""},e.datavisualization.Diagram.ClassMemberDefaults={name:"",value:""},e.datavisualization.Diagram.ClassAttributeDefaults={name:"",type:"",scope:e.datavisualization.Diagram.ScopeValueDefaults.Public},e.datavisualization.Diagram.ClassMethodsArgumentsDefault={name:"",type:""},e.datavisualization.Diagram.ClassMethodsDefaults={name:"",type:"",arguments:e.datavisualization.Diagram.ClassMethodsArgumentsDefault,scope:e.datavisualization.Diagram.ScopeValueDefaults.Public},e.datavisualization.Diagram.ClassmethodArguments=function(i){return t.extend(!1,{},e.datavisualization.Diagram.ClassMethodsArgumentsDefault,i)},e.datavisualization.Diagram.ClassMethod=function(i){return t.extend(!1,{},e.datavisualization.Diagram.ClassMethodsDefaults,i)},e.datavisualization.Diagram.ClassMember=function(i){return t.extend(!1,{},e.datavisualization.Diagram.ClassMemberDefaults,i)},e.datavisualization.Diagram.ClassAttribute=function(i){return t.extend(!1,{},e.datavisualization.Diagram.ClassAttributeDefaults,i)},e.datavisualization.Diagram.ClassifierClass=function(i){return i.attributes=i.attributes?i.attributes.slice():[],i.methods=i.methods?i.methods.slice():[],t.extend(!1,{},e.datavisualization.Diagram.ClassDefaults,i)},e.datavisualization.Diagram.ClassifierInterface=function(i){return i.attributes=i.attributes?i.attributes.slice():[],i.methods=i.methods?i.methods.slice():[],t.extend(!1,{},e.datavisualization.Diagram.InterfaceDefaults,i)},e.datavisualization.Diagram.ClassifierEnumeration=function(i){return i.members=i.members?i.members.slice():[],t.extend(!1,{},e.datavisualization.Diagram.EnumerationDefaults,i)},e.datavisualization.Diagram.UMLConnector=function(i){return t.extend(!1,{},e.datavisualization.Diagram.UMLConnectorDefaults,i)},e.datavisualization.Diagram.UMLConnectorAssociation=function(i){return t.extend(!1,{},e.datavisualization.Diagram.AssociationDefaults,i)},e.datavisualization.Diagram.UMLConnectorAggregation=function(i){return t.extend(!1,{},e.datavisualization.Diagram.AggregationDefaults,i)},e.datavisualization.Diagram.UMLConnectorComposition=function(i){return t.extend(!1,{},e.datavisualization.Diagram.CompositionDefaults,i)},e.datavisualization.Diagram.UMLConnectorDependency=function(i){return t.extend(!1,{},e.datavisualization.Diagram.DependencyDefaults,i)},e.datavisualization.Diagram.UMLConnectorRealization=function(i){return t.extend(!1,{},e.datavisualization.Diagram.RealizationDefaults,i)},e.datavisualization.Diagram.UMLConnectorInheritance=function(i){return t.extend(!1,{},e.datavisualization.Diagram.InheritanceDefaults,i)},e.datavisualization.Diagram.UMLConnectorMultiplicity=function(i){return i.source&&(i.source.optional=!i.source.optional||i.source.optional,i.source.lowerBounds=i.source.lowerBounds?i.source.lowerBounds:null,i.source.upperBounds=i.source.upperBounds?i.source.upperBounds:null),i.target&&(i.target.optional=!i.target.optional||i.target.optional,i.target.lowerBounds=i.target.lowerBounds?i.target.lowerBounds:null,i.target.upperBounds=i.target.upperBounds?i.target.upperBounds:null),t.extend(!1,{},e.datavisualization.Diagram.ClassifierMultiplicityDefault,i)},e.datavisualization.Diagram.UMLActivityFlow=function(i){return t.extend(!1,{},e.datavisualization.Diagram.UMLActivityFlowDefaults,i)},e.datavisualization.Diagram.ClassDefaults={name:" ",attributes:[e.datavisualization.Diagram.ClassAttribute()],methods:[e.datavisualization.Diagram.ClassMethod()]},e.datavisualization.Diagram.InterfaceDefaults={name:" ",attributes:[e.datavisualization.Diagram.ClassAttribute()],methods:[e.datavisualization.Diagram.ClassMethod()]},e.datavisualization.Diagram.EnumerationDefaults={name:" ",members:[e.datavisualization.Diagram.ClassMember()]},e.datavisualization.Diagram.NodeType=function(i,a){if(!i._isInternalShape){var n=a.model.defaultSettings&&a.model.defaultSettings.node&&a.model.defaultSettings.node.type?a.model.defaultSettings.node.type:"",o=!i.isPhase&&a.model.defaultSettings&&a.model.defaultSettings.node?a.model.defaultSettings.node:{};i.type||i.children||i.isLane||i.isSwimlane||i.isPhase||i.isPhaseStack||(i.type=i.segments||i.sourceNode||i.sourcePort||i.sourcePoint||i.targetNode||i.targetPort||i.targetPoint?"connector":n||"basic"),(i.isSwimlane||"swimlane"==i.type)&&(i._type="group"),("basic"==i.type||"flow"==i.type||"arrow"==i.type||"bpmn"==i.type||"image"==i.type||"native"==i.type||"html"===i.type||"text"===i.type||"umlactivity"==i.type)&&(a._isLoad&&(!a._isLoad||i._type)||(i._type="node"),i=t.extend(!0,{},o,i)),(!a._isLoad||a.model.nodeTemplate||a._isOptimize)&&("basic"==i.type?i=e.datavisualization.Diagram.BasicShape(i):"flow"==i.type?i=e.datavisualization.Diagram.FlowShape(i):"arrow"==i.type?i=e.datavisualization.Diagram.ArrowShape(i):"bpmn"==i.type?i=e.datavisualization.Diagram.BPMNShape(i):"umlclassifier"==i.type?i=e.datavisualization.Diagram.ClassifierShape(i,a):"umlactivity"==i.type&&(i=e.datavisualization.Diagram.UMLActivityShape(i,a)))}return i},e.datavisualization.Diagram.BasicShape=function(t){switch(t._shape="path",t.shape||(t.shape="rectangle"),t.shape){case"rectangle":t._shape="rectangle";break;case"ellipse":t._shape="ellipse";break;case"path":t._shape="path";break;case"polygon":t._shape="polygon";break;case"triangle":t.pathData="M81.1582,85.8677L111.1582,33.9067L141.1582,85.8677L81.1582,85.8677z";break;case"plus":t.pathData="M696.6084,158.2656L674.8074,158.2656L674.8074,136.4656L658.4084,136.4656L658.4084,158.2656L636.6084,158.2656L636.6084,174.6646L658.4084,174.6646L658.4084,196.4656L674.8074,196.4656L674.8074,174.6646L696.6084,174.6646L696.6084,158.2656z";break;case"star":t.pathData="M540.3643,137.9336L546.7973,159.7016L570.3633,159.7296L550.7723,171.9366L558.9053,194.9966L540.3643,179.4996L521.8223,194.9966L529.9553,171.9366L510.3633,159.7296L533.9313,159.7016L540.3643,137.9336z";break;case"pentagon":t.pathData="M370.9702,194.9961L359.5112,159.7291L389.5112,137.9341L419.5112,159.7291L408.0522,194.9961L370.9702,194.9961z";break;case"heptagon":t.pathData="M223.7783,195.7134L207.1303,174.8364L213.0713,148.8034L237.1303,137.2174L261.1883,148.8034L267.1303,174.8364L250.4813,195.7134L223.7783,195.7134z";break;case"octagon":t.pathData="M98.7319,196.4653L81.1579,178.8923L81.1579,154.0393L98.7319,136.4653L123.5849,136.4653L141.1579,154.0393L141.1579,178.8923L123.5849,196.4653L98.7319,196.4653z";break;case"trapezoid":t.pathData="M127.2842,291.4492L95.0322,291.4492L81.1582,256.3152L141.1582,256.3152L127.2842,291.4492z";break;case"decagon":t.pathData="M657.3379,302.4141L642.3369,291.5161L636.6089,273.8821L642.3369,256.2481L657.3379,245.3511L675.8789,245.3511L690.8789,256.2481L696.6089,273.8821L690.8789,291.5161L675.8789,302.4141L657.3379,302.4141z";break;case"righttriangle":t.pathData="M836.293,292.9238L776.293,292.9238L776.293,254.8408L836.293,292.9238z";break;case"cylinder":t.pathData="M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016"}return t},e.datavisualization.Diagram.FlowShape=function(t){t._shape="path",t.shape||(t.shape="process");var i=t.constraints?t.constraints:e.datavisualization.Diagram.NodeConstraints.Default;switch(t.constraints&e.datavisualization.Diagram.NodeConstraints.AspectRatio||(i|=e.datavisualization.Diagram.NodeConstraints.AspectRatio),t.shape){case"process":t.pathData="M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z";break;case"decision":t.pathData="M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z";break;case"document":t.pathData="M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z";break;case"predefinedprocess":t.pathData="M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.333333333333334,0 L 8.333333333333334,50 M 41.66666666666667,0 L 41.66666666666667,50";break;case"terminator":t.pathData="M 269.711,29.3333C 269.711,44.061 257.772,56 243.044,56L 158.058,56C 143.33,56 131.391,44.061 131.391,29.3333L 131.391,29.3333C 131.391,14.6057 143.33,2.66669 158.058,2.66669L 243.044,2.66669C 257.772,2.66669 269.711,14.6057 269.711,29.3333 Z";break;case"papertap":t.pathData="M0.000976562,17.2042 L0.000976562,47.1654 C0.000976562,47.1654 14.403,53.5455 25.001,47.1654 C35.599,40.7852 44.403,43.5087 50.001,47.1654 L50.001,17.2042 M50.001,32.7987 L50.001,2.84052 C50.001,2.84052 35.599,-3.54271 25.001,2.84052 C14.403,9.22376 5.599,6.49418 0.000976562,2.84052 L0.000976562,32.7987";break;case"directdata":t.pathData="M 1477 613 L 1619 613 C 1627 613 1634 636 1634 665 C 1634 694 1627 717 1619 717 L 1477 717 C 1469 717 1461 694 1461 665 C 1461 636 1469 613 1477 613 ZM 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717M 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717";break;case"sequentialdata":t.pathData="M0.00297546,24.999 C0.00297546,11.1922 10.433,0.00216177 23.295,0.00216177 C36.159,0.00216177 46.585,11.1922 46.585,24.999 C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.00297546,38.8057 0.00297546,24.999 z M23.294,49.999 L50.002,49.999";break;case"sort":t.pathData="M50.001,24.9971 L25.001,49.9971 L0.000976562,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971";break;case"multidocument":t.pathData="M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.1437 C48.027,35.7653 49.025,36.6042 50.003,37.3695 L50.003,0.0021928 L6.26497,0.0021928 L6.26497,4.74451 M43.6826,47.1132 L43.6826,10.7652 L0.00257874,10.7652 L0.00257874,47.1132 C0.00257874,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.7926,43.3935 43.6826,47.1132 z";break;case"collate":t.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"summingjunction":t.constraints=i,t.pathData="M7.3252,42.6768 L42.6772,7.32477 M42.6768,42.6768 L7.3248,7.32477 M0.000976562,25.001 C0.000976562,11.193 11.197,0.000976562 25.001,0.000976562 C38.809,0.000976562 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.001 0.000976562,38.809 0.000976562,25.001 z";break;case"or":t.pathData="M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z";break;case"internalstorage":t.pathData="M 0 3.8194444444444446A 2.5,3.8194444444444446 0 0,1 2.5,0L 47.5 0A 2.5,3.8194444444444446 0 0,1 50,3.8194444444444446L 50 45.833333333333336A 2.5,3.8194444444444446 0 0,1 47.5,49.65277777777778L 2.5 49.65277777777778A 2.5,3.8194444444444446 0 0,1 0,45.833333333333336L 0 3.8194444444444446ZM 0 11.458333333333334L 50 11.458333333333334M 12.5 0L 12.5 49.65277777777778";break;case"extract":t._shape="polygon",t.constraints=i,t.points=[{x:0,y:35},{x:30,y:0},{x:60,y:35}];break;case"manualoperation":t._shape="polygon",t.points=[{x:46.4,y:28.8},{x:14.8,y:28.8},{x:0,y:0},{x:60,y:0}];break;case"merge":t._shape="polygon",t.constraints=i,t.points=[{x:60,y:0},{x:30,y:35},{x:0,y:0}];break;case"offpagereference":t._shape="polygon",t.points=[{x:60,y:33.3},{x:30.1,y:39},{x:0,y:33.3},{x:0,y:0},{x:60,y:0}];break;case"sequentialaccessstorage":t.constraints=i,t.pathData="M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9 C 55.5 48 60 39.5 60 30 Z";break;case"annotation1":t.pathData="M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865";break;case"annotation2":t.pathData="M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029";break;case"card":t._shape="polygon",t.points=[{x:275,y:60},{x:400,y:60},{x:400,y:110},{x:260,y:110},{x:260,y:75}];break;case"data":t.pathData="M 10 0 L 40 0 L 30 40 L 0 40 Z "}return t},e.datavisualization.Diagram.ArrowShape=function(t){switch(t._shape="path",t.shape||(t.shape="circulararrow"),t.shape){case"circulararrow":t.pathData="M433.4624,503.8848C429.4244,493.2388,419.1354,485.6678,407.0734,485.6678C391.4884,485.6678,378.8544,498.3018,378.8544,513.8868L384.4984,513.8868C384.4984,501.4178,394.6054,491.3108,407.0734,491.3108C415.9494,491.3108,423.6264,496.4338,427.3144,503.8848L422.9114,503.8848L426.8974,508.8848L430.8824,513.8868L434.8684,508.8848L438.8544,503.8848L433.4624,503.8848z";break;case"curvedrightarrow":t.pathData="M0.83006144,28.226993 C2.4030598,37.092016 9.5750604,44.49601 19.365042,48.044014 L19.365042,43.129004 25.376032,47.706001 31.386044,52.282999 25.376032,56.858988 19.365042,61.436991 19.365042,55.399027 C8.24608,51.372995 0.50004381,42.368995 0.50004357,31.905003 0.50004381,30.65601 0.6160717,29.429996 0.83006144,28.226993 z M31.402985,0.5 L31.402985,7.4419994 C15.834992,7.4419994 2.9619988,16.497999 0.81800008,28.275999 0.61199981,27.139999 0.49999988,25.981999 0.5,24.803999 0.49999988,11.379999 14.334993,0.5 31.402985,0.5 z";break;case"curveduparrow":t.pathData="M52.283021,0.51798058 L56.859025,6.5279841 61.436024,12.537989 55.399022,12.537989 C51.373021,23.656996 42.369015,31.403002 31.905011,31.403002 30.65601,31.403002 29.430011,31.288002 28.22701,31.073002 37.092015,29.500999 44.496018,22.328995 48.044018,12.537989 L43.129018,12.537989 47.706021,6.5279841 z M0.5,0.5 L7.4420163,0.5 C7.4420163,16.067989 16.497985,28.940971 28.276,31.083977 27.140013,31.290977 25.981993,31.402 24.804015,31.402 11.380005,31.402 0.5,17.567989 0.5,0.5 z";break;case"curvedleftarrow":t.pathData="M31.073116,28.227982 C31.287107,29.429977 31.403074,30.65599 31.403074,31.905989 31.403074,42.368966 23.657099,51.372959 12.538074,55.399935 L12.538074,61.436979 6.5270846,56.85898 0.51707193,52.282993 6.5270846,47.706976 12.538074,43.129983 12.538074,48.044958 C22.328056,44.496956 29.500118,37.091961 31.073116,28.227982 z M0.5,0.5 C17.568025,0.5 31.403045,11.380997 31.403045,24.803993 31.403045,25.981992 31.291046,27.139992 31.085045,28.276992 28.941042,16.497995 16.068023,7.442997 0.5,7.442997 z";break;case"curveddownarrow":t.pathData="M24.804015,0.50000453 C25.981993,0.50000453 27.140013,0.61301103 28.276,0.8180277 16.498045,2.9630154 7.4420161,15.836023 7.4420156,31.404005 L0.5,31.404005 C0.5,14.336024 11.380004,0.50000453 24.804015,0.50000453 z M31.90502,0.5 C42.369025,0.49999976 51.37303,8.2460016 55.399031,19.365004 L61.436034,19.365004 56.859034,25.377005 52.28303,31.387007 47.70603,25.377005 43.129027,19.365004 48.044028,19.365004 C44.496027,9.5760015 37.092024,2.4040001 28.227019,0.82999995 29.43002,0.61699978 30.65602,0.49999976 31.90502,0.5 z";break;case"jumpingrightarrow":t.pathData="M571.7207,727.7451L563.4507,716.8841L572.3297,716.8841C565.9217,699.1961,552.5427,686.2371,536.5277,683.3951C538.6997,683.0091,540.9157,682.8001,543.1717,682.8001C562.0777,682.8001,578.3457,696.7961,585.6187,716.8841L596.5277,716.8841L588.2577,727.7451L579.9907,738.6041L571.7207,727.7451z";break;case"jumpingleftarrow":t.pathData="M688.4209,727.7441L696.6889,716.8851L687.8119,716.8851C694.2179,699.1971,707.5989,686.2381,723.6119,683.3941C721.4409,683.0101,719.2259,682.8011,716.9679,682.8011C698.0639,682.8011,681.7959,696.7951,674.5209,716.8851L663.6119,716.8851L671.8839,727.7441L680.1509,738.6031L688.4209,727.7441z"}return t},e.datavisualization.Diagram.UMLConnectorShape=function(i){var a,n;switch(i.shape.relationship||(i.shape.relationship="association"),i.shape.relationship){case"association":i.shape=e.datavisualization.Diagram.UMLConnectorAssociation(i.shape);break;case"aggregation":i.shape=e.datavisualization.Diagram.UMLConnectorAggregation(i.shape);break;case"composition":i.shape=e.datavisualization.Diagram.UMLConnectorComposition(i.shape);break;case"realization":i.shape=e.datavisualization.Diagram.UMLConnectorRealization(i.shape);break;case"dependency":i.shape=e.datavisualization.Diagram.UMLConnectorDependency(i.shape);break;case"inheritance":i.shape=e.datavisualization.Diagram.UMLConnectorInheritance(i.shape)}if("umlactivity"==i.shape.type)if(i.shape=e.datavisualization.Diagram.UMLActivityFlow(i.shape),"object"==i.shape.activityFlow){if((i=t.extend(!0,i,{lineDashArray:"8 4",targetDecorator:{shape:"openarrow"},lineWidth:2})).labels)for(n=0;n<i.labels.length;n++)i.labels[n]=e.datavisualization.Diagram.Label(i.labels[n]),i.labels[n].text="["+i.labels[n].text+"]"}else"control"==i.shape.activityFlow?i=t.extend(!0,i,{sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow"},lineWidth:2}):"exception"==i.shape.activityFlow&&(i=t.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow"}}));else if(i.shape.multiplicity)if(a=[],a=e.datavisualization.Diagram.ClassifierHelper.umlConnectorMultiplicity(i),i.labels)for(n=0;n<a.length;n++)i.labels.push(a[n]);else i=t.extend(!1,{},{labels:a},i);return"umlclassifier"==i.shape.type&&("association"==i.shape.relationship&&("bidirectional"==i.shape.association?i=t.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"none"},lineWidth:2}):"directional"==i.shape.association&&(i=t.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow"},lineWidth:2}))),"inheritance"==i.shape.relationship&&(i=t.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),"composition"==i.shape.relationship&&(i=t.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"black"},targetDecorator:{shape:"none"},lineWidth:2})),"aggregation"==i.shape.relationship&&(i=t.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"white"},targetDecorator:{shape:"none"},lineWidth:2})),"dependency"==i.shape.relationship&&(i=t.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),"realization"==i.shape.relationship&&(i=t.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2}))),i},e.datavisualization.Diagram.BPMNShape=function(e){switch(e.shape||(e.shape="event"),("sequentialflow"!=e.shape||"associationflow"!=e.shape||"messageflow"!=e.shape)&&(e.labels&&e.labels.length||(e.labels=[{}]),e.labels.length&&e.labels[0].offset||(e.labels[0]=t.extend(!1,{},e.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}}))),e.shape){case"event":case"gateway":case"dataobject":case"activity":e._type="group",e._isBpmn=!0,void 0==e.children&&(e.children=[]),"activity"==e.shape&&"subprocess"==e.activity&&e.subProcess&&0==e.subProcess.collapsed&&(e=t.extend(!0,{container:{type:"canvas"},paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:10},e));break;case"message":e=t.extend(!0,e,{_shape:"path",pathData:"M0,0L19.8,12.8L40,0L0,0L0,25.5L40,25.5L40,0z"});break;case"datasource":e=t.extend(!0,e,{_shape:"path",pathData:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2 S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8"});break;case"group":e=t.extend(!0,e,{_type:"group",_isBpmn:!0,minWidth:e.width,minHeight:e.height,cornerRadius:10,container:{type:"canvas"},paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:10,borderDashArray:"2 2 6 2"})}return e},e.datavisualization.Diagram.ClassifierShape=function(i,a){var n,o;switch(i.classifier||(i.classifier="class"),i.labels||(i.labels=[{}]),i.fillColor||(i.fillColor="transparent"),i.borderColor||(i.borderColor="transparent"),i.borderWidth||(i.borderWidth=1),i.opacity||(i.opacity=1),i.classifier){case"class":for(i.class=e.datavisualization.Diagram.ClassifierClass(i.class),n=0;n<i.class.attributes.length;n++)i.class.attributes[n]=e.datavisualization.Diagram.ClassAttribute(i.class.attributes[n]);for(o=0;o<i.class.methods.length;o++)i.class.methods[o]=e.datavisualization.Diagram.ClassMethod(i.class.methods[o]);i=e.datavisualization.Diagram.DefautShapes._getClassShape(i,a);break;case"interface":for(i.interface=e.datavisualization.Diagram.ClassifierInterface(i.interface),n=0;n<i.interface.attributes.length;n++)i.interface.attributes[n]=e.datavisualization.Diagram.ClassAttribute(i.interface.attributes[n]);for(o=0;o<i.interface.methods.length;o++)i.interface.methods[o]=e.datavisualization.Diagram.ClassMethod(i.interface.methods[o]);i=e.datavisualization.Diagram.DefautShapes._getClassShape(i,a);break;case"enumeration":i.enumeration=e.datavisualization.Diagram.ClassifierEnumeration(i.enumeration),i=e.datavisualization.Diagram.DefautShapes._getClassShape(i,a);break;case"member":i.labels[0]=t.extend(!1,{},{name:i.name+"_member",horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5},text:"Member"},i.labels[0]),i=t.extend(!1,{},{borderColor:"transparent",fillColor:"transparent",_shape:"rectangle",horizontalAlign:"stretch",verticalAlign:"bottom",_isClassMember:!0},i)}return i},e.datavisualization.Diagram.UMLActivityShape=function(t){switch(t.type="umlactivity",t.shape||(t.shape="action"),t._shape="path",t.shape){case"action":t.pathData="M 90 82.895 C 90 86.819 86.776 90 82.8 90 H 7.2 C 3.224 90 0 86.819 0 82.895 V 7.105 C 0 3.181 3.224 0 7.2 0 h 75.6 C 86.776 0 90 3.181 90 7.105 V 82.895 Z";break;case"decision":case"mergenode":t.pathData="M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z";break;case"initialnode":t.pathData="M10,19.5c-5.238,0-9.5-4.262-9.5-9.5S4.762,0.5,10,0.5s9.5,4.262,9.5,9.5S15.238,19.5,10,19.5z";break;case"finalnode":t.borderColor="transparent",t._type="group";var i=[],a=0,n=e.datavisualization.Diagram.NodeConstraints.Default&~(e.datavisualization.Diagram.NodeConstraints.PointerEvents|e.datavisualization.Diagram.NodeConstraints.Connect|e.datavisualization.Diagram.NodeConstraints.Resize);for(i.push({name:t.name+"_activity_final_1",width:t.width,height:t.height,offsetX:t.offsetX,offsetY:t.offsetY,constraints:n|e.datavisualization.Diagram.NodeConstraints.Resize,type:"node",shape:"path",pathData:"M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001"}),i.push({name:t.name+"_activity_final_2",width:t.width/2,height:t.height/2,fillColor:"black",offsetX:t.offsetX,offsetY:t.offsetY,constraints:n|e.datavisualization.Diagram.NodeConstraints.Resize,type:"node",shape:"path",pathData:"M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50"}),a=0;a<i.length;a++)i[a]=e.datavisualization.Diagram.Node(i[a]);t.elementType="group",t.children=i;break;case"forknode":case"joinnode":t.width=t.width?t.width:40,t.height=5,t.fillColor="black",t.pathData="m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",t.labels=[{readOnly:!0}];break;case"timeevent":t.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"acceptingevent":t.pathData="M17.8336 32.164 L29.64 24 L17.32 16 L48.1664 16 L48.5 32 Z";break;case"sendsignal":t.pathData="M48.164 31.8336 L56 23.832 L47.836 16 L16.168 16 L16.1668 31.8336 Z";break;case"receivesignal":t.pathData="M48.1664 31.8336 L39.836 24 L47.836 16 L16.168 16 L16.168 31.836 Z";break;case"structurednode":t._shape="rectangle",t.borderDashArray="2 3",t.labels&&t.labels.length>0&&(t.labels=[{text:"<<"+t.labels[0].text+">>",wrapText:"nowrap",fillColor:"white"}]);break;case"note":t.pathData="M20 12 L4 12 L4 22 L22 22 L22 14 L20 14 L20 12 L22 14 Z"}return t},e.datavisualization.Diagram.DefautShapes={_getBPMNEventShape:function(i,a){var n,o,s,r=[];for(void 0==i.children&&(i.children=[]),i._type="group",i.canUngroup=!1,i.offset=i.offset||{},i.offset=e.datavisualization.Diagram.Point(i.offset.x?i.offset.x:null,i.offset.y?i.offset.y:null),i=t.extend(!1,{},e.datavisualization.Diagram.BPMNEventDefaults,i),n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(r.push(a.nameTable[i.children[n].name||i.children[n]]),r[n].rotateAngle=i.rotateAngle);var l=i.pivot||{x:.5,y:.5},d=i.offsetX?i.offsetX-i.width*l.x+i.width/2:i.width*l.x+i.width/2,h=i.offsetY?i.offsetY-i.height*l.y+i.height/2:i.height*l.y+i.height/2;if(!r.length)for(o=e.datavisualization.Diagram.NodeConstraints.Default&~(e.datavisualization.Diagram.NodeConstraints.PointerEvents|e.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:d,offsetY:h,ports:[],rotateAngle:i.rotateAngle,constraints:o,_isDisabled:!0,_isInternalShape:!0},r.push({name:i.name+"_0",width:i.width,height:i.height}),r.push({name:i.name+"_1",width:.85*i.width,height:.85*i.height}),r.push({name:i.name+"_2",width:.5*i.width,height:.5*i.height}),n=0;n<r.length;n++)r[n]=e.datavisualization.Diagram.Node(t.extend(!1,{},s,r[n]));return i.constraints=i.constraints?i.constraints:e.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNEventShape(i,r,i.event,i.trigger),i},_getBPMNGatewayShape:function(i,a){var n,o,s,r=[];for(void 0==i.children&&(i.children=[]),i._type="group",i.canUngroup=!1,i=t.extend(!1,{},e.datavisualization.Diagram.BPMNGatewayDefaults,i),n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(r.push(a.nameTable[i.children[n].name||i.children[n]]),r[n].rotateAngle=i.rotateAngle);var l=i.pivot||{x:.5,y:.5},d=i.offsetX?i.offsetX-i.width*l.x+i.width/2:i.width*l.x+i.width/2,h=i.offsetY?i.offsetY-i.height*l.y+i.height/2:i.height*l.y+i.height/2;if(!r.length)for(o=e.datavisualization.Diagram.NodeConstraints.Default^(e.datavisualization.Diagram.NodeConstraints.PointerEvents|e.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:d,offsetY:h,ports:[],rotateAngle:i.rotateAngle,constraints:o,_isDisabled:!0,_isInternalShape:!0},r.push({name:i.name+"_0",width:i.width,height:i.height,pathData:"M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z"}),r.push({name:i.name+"_1",width:.45*i.width,height:.45*i.height}),n=0;n<r.length;n++)r[n]=e.datavisualization.Diagram.Node(t.extend(!1,{},s,r[n]));switch(r&&r[0]&&(o=r[0].constraints?r[0].constraints:e.datavisualization.Diagram.NodeConstraints.Default,i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(o|=e.datavisualization.Diagram.NodeConstraints.Shadow)),i.children=r,i.constraints=i.constraints?i.constraints:e.datavisualization.Diagram.NodeConstraints.Default,t.extend(!0,r,[{fillColor:i.fillColor,constraints:o,shadow:i.shadow,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,fillColor:"black",visible:!0}]),r[1].fillColor=i.borderColor,r[1].borderColor=i.borderColor,i.gateway){case"none":r[1].visible=!1;break;case"exclusive":r[1].pathData="M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039 l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z";break;case"inclusive":r[1].pathData="M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z";break;case"parallel":r[1].pathData="M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z";break;case"complex":r[1].pathData="M29.198,19.063L23.089,19.063L27.794,14.358L26.38,12.944L21.223,18.101L21.223,10.443L19.223,10.443L19.223,17.976L14.022,12.776L12.608,14.19L17.48,19.063L10.365,19.063L10.365,21.063L18.261,21.063L12.392,26.932L13.806,28.346L19.223,22.929L19.223,30.225L21.223,30.225L21.223,22.805L25.925,27.507L27.339,26.093L22.309,21.063L29.198,21.063z";break;case"eventbased":r[1].fillColor="white",r[1].pathData="M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z";break;case"exclusiveeventbased":r[1].fillColor="white",r[1].pathData="M 30 15 C 30 23.28 23.28 30 15 30 S 0 23.28 0 15 S 6.72 0 15 0 S 30 6.72 30 15 z M 15 5 L 5 12.5 L 8 22.5 H 22 L 25 12.5 z";break;case"paralleleventbased":r[1].fillColor="white",r[1].pathData="M 35 17.5 C 35 27.16 27.16 35 17.5 35 S 0 27.16 0 17.5 S 7.84 0 17.5 0 S 35 7.84 35 17.5 z M 14.58 5.83 V 14.58 H 5.83 V 20.42 H 14.58 V 29.17 H 20.42 V 20.42 H 29.17 V 14.58 H 20.42 V 5.83 z"}return i},_getClassShape:function(i,a){var n,o,s,r,l,d,h,g,c,u,m=[],p="",f="",_="",v="";if(i.children){for(c=0;c<i.children.length;c++)a.nameTable[i.children[c].name||i.children[c]]&&m.push(a.nameTable[i.children[c].name||i.children[c]]);if(m.length<=0&&i.children.length>0)for(u=0;u<i.children.length;u++)m.push(i.children[u])}else{if(s=e.datavisualization.Diagram.NodeConstraints.Default&~(e.datavisualization.Diagram.NodeConstraints.Select|e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|e.datavisualization.Diagram.NodeConstraints.ResizeWest|e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|e.datavisualization.Diagram.NodeConstraints.ResizeNorth|e.datavisualization.Diagram.NodeConstraints.ResizeSouth|e.datavisualization.Diagram.NodeConstraints.Connect|e.datavisualization.Diagram.NodeConstraints.Rotate|e.datavisualization.Diagram.NodeConstraints.ResizeEast|e.datavisualization.Diagram.NodeConstraints.Drag),r={width:i.width,offsetX:i.offsetX,parent:i.name,ports:[],fillColor:"transparent",borderColor:i.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0},i.fillColor&&(r.fillColor=i.fillColor),i.borderColor&&(r.borderColor=i.borderColor),i.borderWidth&&(r.borderWidth=i.borderWidth),i.labels)for(c=0;c<i.labels.length;c++)r.labels[c]=t.extend(!1,{},r.labels[c],i.labels[c]);switch(i.classifier){case"class":m.push({ports:[],name:i.name+"_header_classifier",minHeight:30,labels:[{name:"title",offset:{x:.5,y:.65},text:i.class.name,bold:!0,fontSize:14},{name:"class",offset:{x:.5,y:.25},text:"<<Class>>"}],constraints:s});break;case"interface":m.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:"title",offset:{x:.5,y:.65},text:i.interface.name,bold:!0,fontSize:14},{name:"interface",offset:{x:.5,y:.25},text:"<<Interface>>"}],constraints:s});break;case"enumeration":m.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:i.name+"Label1",offset:{x:.5,y:.65},text:i.enumeration.name,bold:!0,fontSize:14},{name:i.name+"enumeration",offset:{x:.5,y:.25},text:"<<Enumeration>>"}],constraints:s})}if((l=i.class?i.class:i.interface)&&l.attributes&&l.attributes.length){for(c=0;c<l.attributes.length;c++)l.attributes[c]=e.datavisualization.Diagram.ClassAttribute(l.attributes[c]),i.Interface&&(l.attributes[c].scope=e.datavisualization.Diagram.ScopeValueDefaults.Public),l.attributes[c].scope&&"public"==l.attributes[c].scope&&(g="+"),l.attributes[c].scope&&"private"==l.attributes[c].scope&&(g="-"),l.attributes[c].scope&&"protected"==l.attributes[c].scope&&(g="#"),l.attributes[c].scope&&"package"==l.attributes[c].scope&&(g="~"),""!=l.attributes[c].name&&(p+=g?g+" "+l.attributes[c].name+" : "+l.attributes[c].type:l.attributes[c].name+": "+l.attributes[c].type),c!=l.attributes.length-1&&(p+="\n");p&&m.push({name:i.name+"_attribute_classifier",labels:[{text:p,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:s})}if((d=i.enumeration)&&d.members&&d.members.length){for(c=0;c<d.members.length;c++)d.members[c]=e.datavisualization.Diagram.ClassMember(d.members[c]),""!=d.members[c].name&&(_+=d.members[c].name),c!=d.members.length-1&&(_+="\n");_&&m.push({name:i.name+"_member_classifier",labels:[{text:_,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:s})}if((h=i.class?i.class:i.interface)&&h.methods&&h.methods.length){for(c=0;c<h.methods.length;c++){if(h.methods[c]=e.datavisualization.Diagram.ClassMethod(h.methods[c]),h.methods[c].scope&&"public"==h.methods[c].scope&&(g="+"),h.methods[c].scope&&"private"==h.methods[c].scope&&(g="-"),h.methods[c].scope&&"protected"==h.methods[c].scope&&(g="#"),h.methods[c].scope&&"package"==h.methods[c].scope&&(g="~"),h.methods[c].arguments)for(u=0;u<h.methods[c].arguments.length;u++)v+=h.methods[c].arguments[u].type?h.methods[c].arguments[u].name+":"+h.methods[c].arguments[u].type:h.methods[c].arguments[u].name,u!=h.methods[c].arguments.length-1&&(v+=",");""!=h.methods[c].name&&(f+=g?g+" "+h.methods[c].name+"("+v+") : "+h.methods[c].type:h.methods[c].name+"("+v+") :"+h.methods[c].type),c!=h.methods.length-1&&(f+="\n")}f&&m.push({name:i.name+"_method_classifier",labels:[{text:f,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:s})}for(c=0;c<m.length;c++)for(m[c]=e.datavisualization.Diagram.Node(t.extend(!1,{},r,m[c])),u=0;u<m[c].labels.length;u++)m[c].labels[u]=t.extend(!1,{},m[c].labels[u],r.labels[0]);for(i.children=m,i._type="group",i.constraints=i.constraints?i.constraints:e.datavisualization.Diagram.NodeConstraints.Default,i.constraints=i.constraints&~(e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|e.datavisualization.Diagram.NodeConstraints.ResizeWest|e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|e.datavisualization.Diagram.NodeConstraints.ResizeNorth|e.datavisualization.Diagram.NodeConstraints.ResizeSouth|e.datavisualization.Diagram.NodeConstraints.Rotate|e.datavisualization.Diagram.NodeConstraints.ResizeEast),c=0;c<m.length;c++)1==m.length&&(i.class&&(delete i.class.attributes,delete i.class.methods),i.interface&&(delete i.interface.attributes,delete i.interface.methods),i.enumeration&&delete i.enumeration.members),2==m.length&&(i.children[c]="string"==typeof i.children[c]?a.nameTable[i.children[c]]:i.children[c],i.class&&(i.children[c].name.match("attribute")&&delete i.class.methods,i.children[c].name.match("method")&&delete i.class.attributes),i.interface&&(i.children[c].name.match("attribute")&&delete i.interface.methods,i.children[c].name.match("method")&&delete i.interface.attributes))}for(i._height=0,c=0;c<m.length;c++)a._getNodeDimension(m[c],m[c].labels[0]),n=m[c].height?m[c].height:m[c]._height,m[c].offsetY=i._height+n/2,i._height+=n;for(o=m[0]._width,m[1]&&(o=m[0]._width>m[1]._width?m[0]._width:m[1]._width),m[2]&&(o=m[2]._width>o?m[2]._width:o),m[0].width=o,m[1]&&(m[1].width=o),m[2]&&(m[2].width=o),i._width=o,i.width=i._width,i.height=i._height,c=0;c<m.length;c++)m[c].offsetY+=i.offsetY-i.height/2;return i},_updateClassNode:function(t,i){if(t.name.match("_header"))"class"==i.type?i.className=t.labels[0].text:"interface"==i.type?i.interfaceName=t.labels[0].text:i.enumerationName=t.labels[0].text;else{for(var a,n=t.name.match("_attribute")?"attribute":t.name.match("_method")?"method":"member",o=t.labels[0].text.split("\n"),s=[],r=0;r<o.length;r++)switch(i.Class?i.Class:i.Interface,n){case"attribute":a=o[r].split(/:[ ]*/g),s.push(e.datavisualization.Diagram.ClassMember({name:a[0],type:a[1]}));break;case"method":a=o[r].replace(")","").replace("(",":").split(/:[ ]*/g),s.push(e.datavisualization.Diagram.ClassMember({name:a[0],returnType:a[1],parameter:a[2]}));break;case"member":s.push(e.datavisualization.Diagram.ClassMember({name:o[r]}))}"attribute"==n?i.attributes=s:"method"==n?i.methods=s:i.members=s}},_getBPMNDataShape:function(i,a){var n,o,s,r,l,d,h,g=[];for(void 0==i.children&&(i.children=[]),i._type="group",o=i.pivot||{x:.5,y:.5},i.canUngroup=!1,i.data=e.datavisualization.Diagram.BPMNDataObject(i.data),s=(i=t.extend(!1,{},e.datavisualization.Diagram.BPMNDataObjectDefaults,i)).offsetX?i.offsetX-i.width*o.x:i.width*o.x,r=i.offsetY?i.offsetY-i.height*o.y:i.height*o.y,n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(g.push(a.nameTable[i.children[n].name||i.children[n]]),g[n].rotateAngle=i.rotateAngle);if(l=i.offsetX?i.offsetX-i.width*o.x+i.width/2:i.width*o.x+i.width/2,!g.length)for(d=e.datavisualization.Diagram.NodeConstraints.Default^(e.datavisualization.Diagram.NodeConstraints.PointerEvents|e.datavisualization.Diagram.NodeConstraints.Connect),h={parent:i.name,type:"node",shape:"path",offsetX:l,ports:[],rotateAngle:i.rotateAngle,constraints:d,_isDisabled:!0,_isInternalShape:!0},g.push({name:i.name+"_0",width:i.width,height:i.height,offsetY:r+i.height/2,addInfo:{offset:{x:.5,y:.5}},constraints:d,shape:"polygon",points:[{x:29.904,y:5},{x:7.853,y:5},{x:7.853,y:45},{x:42.147,y:45},{x:42.147,y:17.242},{x:29.932,y:5},{x:29.932,y:17.242},{x:42.147,y:17.242}]}),g.push({name:i.name+"_1",width:7.5,height:15,offsetY:85+r,addInfo:{offset:{x:.5,y:1},margin:{bottom:15}},constraints:d&~e.datavisualization.Diagram.NodeConstraints.Resize,fillColor:"black",pathData:"M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z "}),g.push({name:i.name+"_2",width:25,height:20,offsetX:s+15,offsetY:r+15,addInfo:{offset:{x:0,y:0},margin:{left:17.5,top:15}},constraints:d&~e.datavisualization.Diagram.NodeConstraints.Resize,borderColor:"black",fillColor:"white",pathData:"M 3 9.4 l 6 0 v 2.4 l 3.6 -4 L 9 4 v 2.5 H 3 V 9.4 Z"}),n=0;n<g.length;n++)g[n]=e.datavisualization.Diagram.Node(t.extend(!1,{},h,g[n]));switch(i.children=g,i.constraints=i.constraints?i.constraints:e.datavisualization.Diagram.NodeConstraints.Default,i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(d|=e.datavisualization.Diagram.NodeConstraints.Shadow),t.extend(!0,g,[{fillColor:i.fillColor,constraints:d,shadow:i.shadow,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,visible:i.data.collection},{opacity:i.opacity,visible:!0}]),i.data.type){case"none":g[2].visible=!1;break;case"input":g[2].fillColor="white";break;case"output":g[2].fillColor="black"}return i},_getBPMNActivityShape:function(i,a){var n,o,s,r,l,d=[],h={};for(void 0==i.children&&(i.children=[]),i._type="group",i.canUngroup=!1,i.task=e.datavisualization.Diagram.BPMNTask(i.task),i.subProcess=e.datavisualization.Diagram.BPMNSubProcess(i.subProcess),i=t.extend(!1,{},e.datavisualization.Diagram.BPMNActivityDefaults,i),n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(d.push(a.nameTable[i.children[n].name||i.children[n]]),d[n].rotateAngle=i.rotateAngle);if(!d.length){for(o=e.datavisualization.Diagram.NodeConstraints.Default&~(e.datavisualization.Diagram.NodeConstraints.PointerEvents|e.datavisualization.Diagram.NodeConstraints.Connect|e.datavisualization.Diagram.NodeConstraints.Resize),s={parent:i.name,type:"node",shape:"path",ports:[],labels:[],constraints:o,rotateAngle:i.rotateAngle,_isDisabled:!0,_isInternalShape:!0},d.push({name:i.name+"_activity",width:i.width,height:i.height,addInfo:{offset:{x:.5,y:.5}},constraints:o|e.datavisualization.Diagram.NodeConstraints.Resize}),d.push({name:i.name+"_taskType",width:14,height:14,borderColor:"black",addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:14,top:14}},pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_loop",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_compensation",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_expanded",width:12,height:12,constraints:o,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_adhoc",width:12,height:8,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_event_1",width:24,height:24,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),d.push({name:i.name+"_event_2",width:20.4,height:20.4,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),d.push({name:i.name+"_event_3",width:12,height:12,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),n=0;n<d.length;n++)d[n]=e.datavisualization.Diagram.Node(t.extend(!0,{},s,d[n]));if("subprocess"==i.activity&&!i.subProcess.collapsed&&i.subProcess.processes&&i.subProcess.processes.length)for(r=0,l=i.subProcess.processes;r<i.subProcess.processes.length;r++)l[r]=e.datavisualization.Diagram.Node(e.datavisualization.Diagram.NodeType(l[r],a)),d.push(l[r])}for(i.constraints=i.constraints?i.constraints:e.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNActivityShape(i,d),n=0;n<i.children.length;n++)h[i.children[n].name]=i.children[n];return e.datavisualization.Diagram.Util._updateBPMNProperties(i,a,h),i},_getBPMNGroupShape:function(t,i){var a,n=[],o=0;for(void 0==t.children&&(t.children=[]),o=0;o<t.children.length;o++)i.nameTable[t.children[o].name||t.children[o]]&&n.push(i.nameTable[t.children[o].name||t.children[o]]);if(!n.length)for(o=0;o<t.children.length;o++)"bpmn"==(a=e.datavisualization.Diagram.Node(e.datavisualization.Diagram.NodeType(t.children[o],i))).type&&n.push(a);return t.ports=[],t.children=n,t.constraints=t.constraints?t.constraints:e.datavisualization.Diagram.NodeConstraints.Default,t.constraints=t.constraints&~e.datavisualization.Diagram.NodeConstraints.Connect|e.datavisualization.Diagram.NodeConstraints.AllowDrop,t},_updateBPMNEventShape:function(i,a,n,o){var s,r,l;switch(a&&a[0]&&(s=a[0].constraints?a[0].constraints:e.datavisualization.Diagram.NodeConstraints.Default,i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(s|=e.datavisualization.Diagram.NodeConstraints.Shadow)),l=[{pathData:r="M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",fillColor:i.fillColor,constraints:s,shadow:i.shadow,borderWidth:i.borderWidth,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:r,fillColor:i.fillColor,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:r,fillColor:"white",borderColor:i.borderColor,opacity:i.opacity,height:.5*a[0].height,visible:!0}],t.extend(!0,a,l),n){case"start":a[1].visible=!1;break;case"noninterruptingstart":a[0].borderDashArray="2 3",a[1].visible=!1;break;case"intermediate":a[0].fillColor="white",a[0].gradient=null;break;case"noninterruptingintermediate":a[0].fillColor="white",a[0].gradient=null,a[0].borderDashArray="2 3",a[1].borderDashArray="2 3";break;case"throwingintermediate":case"end":a[0].fillColor="end"!=n?"white":i.borderColor,a[0].gradient=null,a[2].fillColor="black",a[2].borderColor=i.fillColor}switch(o){case e.datavisualization.Diagram.BPMNTriggers.None:a[2].visible=!1;break;case e.datavisualization.Diagram.BPMNTriggers.Message:a[2].pathData="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",a[2].height=3*a[2].width/4;break;case e.datavisualization.Diagram.BPMNTriggers.Timer:a[2].pathData="M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681 L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617 M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z";break;case e.datavisualization.Diagram.BPMNTriggers.Error:a[2].pathData="M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z";break;case e.datavisualization.Diagram.BPMNTriggers.Escalation:a[2].pathData="M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ";break;case e.datavisualization.Diagram.BPMNTriggers.Cancel:a[2].pathData="M 3.5 16 L 0 12.6 L 4.6 8 L 0 3.5 L 3.4 0 L 8 4.6 l 4.5 -4.5 L 16 3.5 L 11.5 8 l 4.5 4.5 l -3.4 3.5 L 8 11.4 L 3.5 16 Z";break;case e.datavisualization.Diagram.BPMNTriggers.Compensation:a[2].pathData="M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ";break;case e.datavisualization.Diagram.BPMNTriggers.Conditional:a[2].pathData="M 0 0 H 16 V 16 H 0 z M 1.14 3.2 H 14.85 M 1.14 6.4 H 14.85 M 1.14 9.6 H 14.85 M 1.14 12.8 H 14.85";break;case e.datavisualization.Diagram.BPMNTriggers.Link:a[2].pathData="M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z";break;case e.datavisualization.Diagram.BPMNTriggers.Signal:a[2].pathData="M 50 50 H 0 L 25.0025 0 L 50 50 Z";break;case e.datavisualization.Diagram.BPMNTriggers.Terminate:a[2].pathData="M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50";break;case e.datavisualization.Diagram.BPMNTriggers.Multiple:a[2].pathData="M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z";break;case e.datavisualization.Diagram.BPMNTriggers.Parallel:a[2].pathData="M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"}return a},_updateBPMNActivityShape:function(i,a){var n,o,s,r,l,d,h,g,c;a&&a[0]&&(d=a[0].constraints?a[0].constraints:e.datavisualization.Diagram.NodeConstraints.Default,i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(d|=e.datavisualization.Diagram.NodeConstraints.Shadow));var u=[{fillColor:i.fillColor,borderWidth:i.borderWidth,constraints:d,shadow:i.shadow,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,pathData:this._updateRoundedRectanglePath(i,12)},{fillColor:"white",borderColor:"black",width:14,height:14,opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1}],m=[],p=0;switch(t.extend(!0,a,u),"subprocess"==i.activity&&!i.subProcess.collapsed&&a.length>9&&i.subProcess.processes.length&&(m=a.splice(a.length-i.subProcess.processes.length,i.subProcess.processes.length)),n="task"==i.activity?i.task.loop:i.subProcess.loop,o="task"==i.activity?i.task.compensation:i.subProcess.compensation,n){case"none":a[2].visible=!1;break;case"standard":a[2].pathData="M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314 c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685 c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z";break;case"parallelmultiinstance":a[2].pathData="M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ";break;case"sequencemultiinstance":a[2].pathData="M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5 L 55.375,82.5 L 40.375,82.5 Z"}if(o?a[3].pathData="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z":a[3].visible=!1,(s=i.activity==e.datavisualization.Diagram.BPMNActivity.Task?i.task.events:i.subProcess.events)&&s.length){for(r=0;r<s.length;r++){if(!(l=a.slice(9+3*r,12+3*r)).length||l.length<3){for(d=e.datavisualization.Diagram.NodeConstraints.Default&~(e.datavisualization.Diagram.NodeConstraints.PointerEvents|e.datavisualization.Diagram.NodeConstraints.Connect|e.datavisualization.Diagram.NodeConstraints.Resize),h={parent:i.name,type:"group",constraints:d,rotateAngle:i.rotateAngle,_isInternalShape:!0,opacity:i.opacity,addInfo:{offset:s[r].offset},borderColor:"transparent",labels:[{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}}]},s[r].offset=s[r].offset||{},s[r].fillColor="transparent",s[r].offset=e.datavisualization.Diagram.Point(s[r].offset.x?s[r].offset.x:null,s[r].offset.y?s[r].offset.y:null),s[r]=e.datavisualization.Diagram.Node(t.extend(!0,{name:i.name+"_"+e.datavisualization.Diagram.Util.randomId()},e.datavisualization.Diagram.BPMNEventDefaults,h,s[r])),s[r].ports=s[r].ports.length>0?s[r].ports:i.ports,l=[{width:24,height:24},{width:20.4,height:20.4},{width:12,height:12}],p=0;p<l.length;p++)g={parent:s[r].name,type:"node",shape:"path",rotateAngle:s[r].rotateAngle,constraints:d,_isInternalShape:!0,opacity:i.opacity,addInfo:{offset:s[r].offset}},l[p]=e.datavisualization.Diagram.Node(t.extend(!0,{name:s[r].name+"_"+e.datavisualization.Diagram.Util.randomId()},g,l[p]));s[r].children=l}this._updateBPMNEventShape(i,l,s[r].event,s[r].trigger)}a=a.concat(s)}else a.splice(9,a.length-1);if(i.activity==e.datavisualization.Diagram.BPMNActivity.Task){switch(a[1].visible=!0,delete a[1]._isService,i.task.type){case"none":a[1].visible=!1;break;case"service":a[1].pathData="M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.89 0.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535 -1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z",a[1]._isService=!0;break;case"receive":a[1].pathData="M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z",a[1].height=12;break;case"send":a[1].pathData="M 45.7256 3.16055 L 25 23.4017 L 4.27442 3.16055 H 45.7256 Z M 47.8963 46.8413 H 2.10375 V 4.80813 L 25 27.1709 L 47.8963 4.80813 V 46.8413 Z",a[1].height=12,a[1].fillColor="black",a[1].borderColor="white";break;case"instantiatingreceive":a[1].pathData="M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785 c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z",a[1].width=20,a[1].height=20;break;case"manual":a[1].pathData="M 13.183 15.325 h 2.911 c 0.105 0 0.207 -0.043 0.281 -0.117 c 0.078 -0.074 0.117 -0.176 0.117 -0.281 c 0 -0.753 0.718 -1.362 1.596 -1.362 h 2.579 c -0.117 0.227 -0.191 0.48 -0.195 0.757 c 0 0.433 0.168 0.851 0.46 1.144 c 0.008 0.004 0.015 0.011 0.019 0.015 c -0.289 0.285 -0.475 0.691 -0.479 1.148 c 0 0.433 0.168 0.846 0.46 1.139 c 0.011 0.012 0.023 0.02 0.035 0.032 c -0.301 0.281 -0.491 0.694 -0.495 1.155 c 0 0.432 0.168 0.847 0.46 1.143 c 0.265 0.266 0.612 0.414 0.975 0.414 h 0.839 c 0.027 0.004 0.051 0.012 0.074 0.012 h 8.443 c 0.352 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.285 0.753 -0.636 0.753 h -6.687 c -0.019 0 -0.035 -0.008 -0.051 -0.008 h -2.27 c -0.121 -0.835 -0.667 -1.187 -1.795 -1.187 h -2.158 c -0.223 0 -0.402 0.18 -0.402 0.403 c 0 0.219 0.179 0.398 0.402 0.398 h 2.158 c 0.972 0 1.019 0.203 1.019 0.784 c 0 0.219 0.179 0.399 0.402 0.399 c 0.008 0 0.016 -0.004 0.027 -0.004 c 0.028 0.004 0.055 0.016 0.082 0.016 h 2.56 c 0.34 0.015 0.616 0.343 0.616 0.752 c 0 0.418 -0.285 0.757 -0.636 0.761 h -0.004 h -6.442 c -0.878 0 -1.595 -0.639 -1.595 -1.427 v -0.683 c 0 -0.109 -0.043 -0.211 -0.114 -0.285 c -0.078 -0.074 -0.179 -0.117 -0.285 -0.117 h -0.004 l -2.989 0.027 c -0.223 0 -0.398 0.184 -0.398 0.402 c 0 0.219 0.179 0.395 0.398 0.395 h 0.004 l 2.591 -0.02 v 0.282 c 0 1.229 1.073 2.223 2.391 2.223 h 3.895 c 0.004 0 0.007 0.004 0.011 0.004 h 2.536 c 0.792 0 1.436 -0.698 1.436 -1.561 c 0 -0.273 -0.07 -0.53 -0.188 -0.752 h 5.49 c 0.792 0 1.436 -0.695 1.436 -1.553 c 0 -0.858 -0.644 -1.557 -1.436 -1.557 h -3.566 c 0.121 -0.226 0.199 -0.487 0.199 -0.768 c 0 -0.468 -0.195 -0.882 -0.495 -1.167 c 0.301 -0.285 0.495 -0.698 0.495 -1.163 c 0 -0.456 -0.191 -0.866 -0.483 -1.152 c 0.293 -0.285 0.483 -0.694 0.483 -1.151 c 0 -0.858 -0.647 -1.557 -1.439 -1.557 h -8.373 c -1.167 0 -2.142 0.757 -2.352 1.76 l -2.548 -0.004 c -0.219 0 -0.399 0.18 -0.399 0.403 C 12.784 15.145 12.964 15.325 13.183 15.325 L 13.183 15.325 Z M 21.907 19.707 c -0.191 0 -0.328 -0.094 -0.41 -0.176 c -0.144 -0.145 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.418 0.289 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.008 h 0.051 c 0.351 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.286 0.753 -0.636 0.753 H 21.907 Z M 27.097 16.629 c 0 0.414 -0.286 0.753 -0.64 0.753 h -4.464 c -0.004 0 -0.004 0 -0.004 0 h -0.082 c -0.191 0 -0.328 -0.098 -0.414 -0.18 c -0.14 -0.145 -0.222 -0.352 -0.222 -0.573 c 0 -0.413 0.285 -0.749 0.631 -0.753 h 3.434 c 0 0 0 0 0.004 0 h 1.116 c 0.008 0 0.012 -0.004 0.02 -0.004 C 26.819 15.887 27.097 16.215 27.097 16.629 L 27.097 16.629 Z M 27.097 14.322 c 0 0.41 -0.278 0.737 -0.62 0.749 c -0.008 0 -0.012 0 -0.016 0 h -3.637 c -0.008 0 -0.015 0.004 -0.023 0.004 h -0.886 c -0.004 0 -0.008 0 -0.012 0 c -0.187 0 -0.324 -0.094 -0.406 -0.176 c -0.144 -0.144 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.414 0.293 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.004 h 0.051 C 26.811 13.565 27.097 13.905 27.097 14.322 L 27.097 14.322 Z M 27.097 14.322",a[1].width=20;break;case"businessrule":a[1].pathData="M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322 v -4.923 h 12.667 v 4.923 H 19.177 Z";break;case"user":a[1].pathData="M 21.762 21.935 c 2.584 0 4.687 -2.561 4.687 -5.703 c 0 -3.147 -2.103 -5.703 -4.687 -5.703 c -1.279 0 -2.475 0.61 -3.363 1.721 c -0.855 1.071 -1.327 2.484 -1.324 3.983 C 17.075 19.374 19.178 21.935 21.762 21.935 L 21.762 21.935 Z M 21.762 11.779 c 1.894 0 3.436 1.995 3.436 4.452 c 0 2.453 -1.541 4.452 -3.436 4.452 c -1.895 0 -3.44 -1.999 -3.44 -4.452 C 18.323 13.774 19.864 11.779 21.762 11.779 L 21.762 11.779 Z M 25.699 21.309 c -0.348 0 -0.626 0.277 -0.626 0.626 c 0 0.344 0.277 0.622 0.626 0.622 c 2.136 0 3.875 1.74 3.875 3.879 c 0 0.272 -0.227 0.498 -0.501 0.498 H 14.447 c -0.274 0 -0.497 -0.223 -0.497 -0.498 c 0 -2.139 1.736 -3.879 3.872 -3.879 c 0.344 0 0.625 -0.277 0.625 -0.622 c 0 -0.348 -0.28 -0.626 -0.625 -0.626 c -2.826 0 -5.124 2.297 -5.124 5.126 c 0 0.965 0.784 1.749 1.748 1.749 h 14.626 c 0.964 0 1.748 -0.784 1.748 -1.749 C 30.822 23.606 28.524 21.309 25.699 21.309 L 25.699 21.309 Z M 22.217 9.832 c 0.448 -0.263 0.924 -0.396 1.419 -0.396 c 1.895 0 3.436 1.995 3.436 4.452 c 0 0.439 -0.048 0.873 -0.143 1.284 c -0.08 0.336 0.128 0.672 0.464 0.751 c 0.048 0.012 0.098 0.019 0.143 0.019 c 0.284 0 0.541 -0.195 0.608 -0.483 c 0.119 -0.506 0.18 -1.034 0.18 -1.571 c 0 -3.147 -2.102 -5.703 -4.687 -5.703 c -0.711 0 -1.419 0.198 -2.054 0.573 c -0.296 0.174 -0.397 0.559 -0.219 0.855 C 21.536 9.911 21.921 10.009 22.217 9.832 L 22.217 9.832 Z M 27.697 18.81 c -0.345 0 -0.626 0.277 -0.626 0.622 c 0 0.348 0.281 0.626 0.626 0.626 c 2.137 0 3.75 1.782 3.75 3.918 c 0 0.07 -0.013 0.141 -0.043 0.205 c -0.14 0.314 0.003 0.684 0.318 0.823 c 0.082 0.037 0.167 0.055 0.253 0.055 c 0.241 0 0.466 -0.141 0.57 -0.373 c 0.101 -0.226 0.153 -0.464 0.153 -0.714 C 32.699 21.15 30.523 18.81 27.697 18.81 L 27.697 18.81 Z M 27.697 18.81";break;case"script":a[1].pathData="M 22.453 15.04 c 0 0 -1.194 -3.741 2.548 -3.774 c 0 0 2.497 0.126 1.766 4.321 c -0.008 0.043 -0.015 0.086 -0.024 0.13 c -0.806 4.323 -2.516 8.42 -3.193 10.581 h 3.904 c 0 0 0.983 4.581 -2.549 4.968 H 13.292 c 0 0 -3.097 -1.42 -1.517 -5.323 l 3 -10.839 H 11.84 c 0 0 -1.129 -2.902 1.709 -3.806 l 11.425 -0.032 l -0.73 0.355 l -1.193 1.726 L 22.453 15.04 Z M 22.409 12.597 c 0 0 -0.242 0.483 -0.278 0.98 h -9.098 c 0 0 -0.06 -0.871 0.714 -1.041 L 22.409 12.597 Z M 26.341 27.734 c 0 0 -0.13 2.678 -2.226 1.871 c 0 0 -0.823 -0.565 -0.758 -1.855 L 26.341 27.734 Z M 22.905 15.008 c 0 0 0.653 -0.258 0.709 -1.501 c 0 0 0.145 -1.144 1.483 -0.693 c 0 0 0.808 0.355 0.259 2.404 c 0 0 -2.226 8.5 -3.032 10.339 c 0 0 -1.064 2.646 0.096 4.226 h -8.581 c 0 0 -1.806 -0.452 -0.741 -3.613 c 0 0 2.935 -9.549 3.193 -11.162 L 22.905 15.008 Z"}i.task.call&&(a[0].borderWidth=4),i.task.compensation&&"none"!=i.task.loop&&(a[2].addInfo.margin.left-=a[2].width/2+2,a[3].addInfo.margin.left+=a[3].width/2+2)}else if(i.activity==e.datavisualization.Diagram.BPMNActivity.SubProcess){var f,_=0,v=2;if(i.subProcess.collapsed)a[4].constraints=a[4].constraints|e.datavisualization.Diagram.NodeConstraints.PointerEvents,a[4].visible=!0,a[4].pathData="M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z";else{for(a[4].constraints=a[4].constraints|e.datavisualization.Diagram.NodeConstraints.PointerEvents,a[4].visible=!0,a[4].pathData="M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z",a[0]=t.extend(!0,a[0],{marginLeft:-i.paddingLeft,marginRight:-i.paddingRight,marginTop:-i.paddingTop,marginBottom:-i.paddingBottom,minWidth:i.width,minHeight:i.height}),i.constraints=i.constraints|e.datavisualization.Diagram.NodeConstraints.AllowDrop,i.minWidth=i.width,i.minHeight=i.height;p<m.length;)"bpmn"!=m[p].type&&m.splice(p,1),p++;a=a.concat(m)}switch(i.subProcess.boundary){case"default":a[0].borderWidth=i.borderWidth,a[0].borderDashArray="1 0";break;case"call":a[0].borderWidth=i.borderWidth<4?4:i.borderWidth,a[0].borderDashArray="1 0";break;case"event":a[0].borderWidth=i.borderWidth,a[0].borderDashArray="2 2"}i.subProcess.adhoc?(a[5].visible=!0,a[5].pathData="M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z"):"event"==i.subProcess.type?(a[0].borderWidth=i.borderWidth,a[0].borderDashArray="2 2",this._updateBPMNEventShape(i,a.slice(6,9),i.subProcess.event,i.subProcess.trigger)):"transaction"==i.subProcess.type&&(c={x:3,y:3,width:i.width-3,height:i.height-3},a[0].pathData+=e.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(c,12));do{a[v].visible&&(a[v].addInfo.margin.left=_+a[v].width/2,_+=a[v].width+2),v++}while(v<6);v=2,f=(_-=2)/2;do{a[v].visible&&(a[v].addInfo.margin.left-=f),v++}while(v<6)}return a},_updateRoundedRectanglePath:function(t,e){var i="",a=0,n=[{x:t.x||0,y:t.y||0},{x:t.x||0,y:t.height},{x:t.width,y:t.height},{x:t.width,y:t.y||0}],o=[{x:e,y:e},{x:e,y:-e},{x:-e,y:-e},{x:-e,y:e}];for(a=0;a<n.length;a++)i+=i?"L":"M",i+=n[a].x+(a%2==0?o[a].x:0)+","+(n[a].y+(a%2!=0?o[a].y:0)),i+="C"+n[a].x+","+n[a].y+" "+n[a].x+","+n[a].y,i+=" "+(n[a].x+(a%2!=0?o[a].x:0))+","+(n[a].y+(a%2==0?o[a].y:0));return(i+="L"+(n[0].x+o[0].x)+","+n[0].y)+"Z"},initBPMNAnnotationShape:function(i,a){var n,o,s,r,l=[],d=0;if(i._annotation&&i._annotation.length)for(;d<i._annotation.length;)if((n=a.nameTable[i._annotation[d++]])&&n.name.split("annotation_")[0]!=i.name)i._annotation.splice(--d,1);else{if(!n)break;l.push(n)}if(i.annotation&&i.annotation.text){if(i=t.extend(!1,{},e.datavisualization.Diagram.BPMNTextAnnotationDefaults,i),!l.length){var h=e.datavisualization.Diagram.PortVisibility.Hidden,g=e.datavisualization.Diagram.PortConstraints.None,c=[{offset:{x:0,y:.5},name:"left",visibility:h,constraints:g},{offset:{x:.5,y:0},name:"top",visibility:h,constraints:g},{offset:{x:1,y:.5},name:"right",visibility:h,constraints:g},{offset:{x:.5,y:1},name:"bottom",visibility:h,constraints:g}],u=i.name+"annotation_"+e.datavisualization.Diagram.Util.randomId(),m=i.name+"annotation_"+e.datavisualization.Diagram.Util.randomId(),p=e.datavisualization.Diagram.NodeConstraints.Default&~e.datavisualization.Diagram.NodeConstraints.Connect,f=e.datavisualization.Diagram.ConnectorConstraints.Default&~(e.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd|e.datavisualization.Diagram.ConnectorConstraints.Drag);i._annotation&&i._annotation.length?(u="string"==typeof i._annotation[0]?i._annotation[0]:i._annotation[0].name,m="string"==typeof i._annotation[1]?i._annotation[1]:i._annotation[1].name):i._annotation=[],l.push({name:u,labels:[{text:i.annotation.text}],annotation:i.annotation,type:"bpmn",shape:"annotation",_type:"node",_shape:"path",ports:c,constraints:p,width:i.annotation.width,height:i.annotation.height,_preventStretch:!0}),l.push({name:m,labels:[{readOnly:!0}],type:"connector",segments:[{type:"straight"}],targetDecorator:{shape:"none"},sourceNode:l[0].name,targetNode:i.name,constraints:f,annotation:i.annotation,_isAnnotationLine:!0})}l[0].offsetX=i.offsetX+i.annotation.length*Math.cos(-i.annotation.angle*(Math.PI/180)),l[0].offsetY=i.offsetY+i.annotation.length*Math.sin(-i.annotation.angle*(Math.PI/180)),o=[{fillColor:"transparent",borderColor:i.borderColor,rotateAngle:i.rotateAngle,opacity:i.opacity,ports:[]},{lineColor:i.borderColor,opacity:i.opacity}],t.extend(!0,l,o),s=a.nameTable[l[0].name],r=a.nameTable[l[1].name],s||(s=a._getNewNode(l[0]),a.nameTable[s.name]=s,i._annotation.splice(0,1,s.name)),r||(r=a._getNewConnector(l[1]),a.nameTable[r.name]=r,i._annotation.splice(1,1,r.name)),this.updateBPMNAnnotationShape(r,s,null,i,a)}return i},renderBPMNAnnotationShape:function(t,i){var a,n,o,s;if(t._annotation&&t._annotation.length)for(a=0;a<t._annotation.length;a++)(n="string"==typeof t._annotation[a]?i.nameTable[t._annotation[a]]:t._annotation[a])&&(i.nameTable[n.name]=n,"node"==(o=i.getObjectType(n))?e.datavisualization.Diagram.DiagramContext.renderNode(n,i):"connector"==o&&(s=i._disableSegmentChange,i._disableSegmentChange=!1,i._updateEdges(n),i._dock(n,i.nameTable),e.datavisualization.Diagram.DiagramContext.renderConnector(n,i),i._disableSegmentChange=s))},updateBPMNAnnotationShape:function(i,a,n,o,s){var r,l,d;if("connector"==s.getObjectType(i)&&i._isAnnotationLine){n&&s.nameTable[n]&&(r=s.nameTable[n],t.extend(!0,r,e.datavisualization.Diagram.BPMNTextAnnotationDefaults),delete r._annotation),o||(o=s.nameTable[i.targetNode]);var h,g=e.datavisualization.Diagram.Util.bounds(a),c=20,u=20;switch(h=o?e.datavisualization.Diagram.Util.bounds(o):{x:i.targetPoint.x,y:i.targetPoint.y,width:i.lineWidth,height:i.lineWidth},l="",g.x<=h.x+h.width&&g.x+g.width>=h.x&&(g.y+g.height<h.y&&(l="bottom"),g.y>h.y+h.height&&(l="top")),l||(g.x>h.x+h.width&&(l="left"),g.x+g.width<h.x&&(l="right")),l||i.annotation.direction||(l="left"),i.annotation.direction=l,a.labels[0].horizontalAlignment=a.labels[0].verticalAlignment=a.labels[0].textAlign="center",i.annotation.direction){case"left":u=g.height,a.pathData="M"+c+","+u+" L0,"+u+" L0,0 L"+c+",0",a.labels[0].horizontalAlignment="left",a.labels[0].textAlign="left",a.labels[0].offset=e.datavisualization.Diagram.Point(.05,.5);break;case"right":u=g.height,c=g.width-20,a.pathData="M"+c+","+u+" L"+(c+20)+","+u+" L"+(c+20)+",0 L"+c+",0",a.labels[0].horizontalAlignment="right",a.labels[0].textAlign="right",a.labels[0].offset=e.datavisualization.Diagram.Point(.95,.5);break;case"top":c=g.width,a.pathData="M"+c+","+u+" L"+c+",0 L0,0 L0,"+u,a.labels[0].verticalAlignment="top",a.labels[0].offset=e.datavisualization.Diagram.Point(.5,0);break;case"bottom":u=g.height-20,c=g.width,a.pathData="M"+c+","+u+" L"+c+","+(u+20)+" L0,"+(u+20)+" L0,"+u,a.labels[0].verticalAlignment="bottom",a.labels[0].offset=e.datavisualization.Diagram.Point(.5,1)}s.nameTable[i.name]&&(d=s._disableSegmentChange,s._disableSegmentChange=!1,i.annotation.direction=i.sourcePort=l,s._updateEdges(i),s._dock(i,s.nameTable),s._disableSegmentChange=d),e.datavisualization.Diagram.DiagramContext.update(a,s)}},translateBPMNAnnotationShape:function(i,a,n,o,s){var r,l,d,h,g,c;if(i.annotation&&"annotation"!=i.shape){if(r=[],i.annotation&&i.annotation.text&&((i=t.extend(!1,{},e.datavisualization.Diagram.BPMNTextAnnotationDefaults,i))._annotation&&i._annotation.length)){for(l=0;l<i._annotation.length;l++)s.nameTable[i._annotation[l]]&&r.push(s.nameTable[i._annotation[l]]);if(r.length){if(u=a,m=n,o){var u=0,m=0,p=e.Matrix.identity();i.rotateAngle?(e.Matrix.rotate(p,-i.rotateAngle,o.x,o.y),e.Matrix.scale(p,a,n,o.x,o.y),e.Matrix.rotate(p,i.rotateAngle,o.x,o.y)):e.Matrix.scale(p,a,n,o.x,o.y);var f=e.datavisualization.Diagram.Util.bounds(i),_=i.offsetX-o.x,v=i.offsetY-o.y,y={bottom:{x:i.offsetX,y:f.y},left:{x:f.x+f.width,y:i.offsetY},top:{x:i.offsetX,y:f.y+f.height},right:{x:f.x,y:i.offsetY}}[r[0].annotation.direction],b=e.Matrix.transform(p,{x:y.x-_,y:y.y-v});b.x!=y.x&&(u=y.x-b.x),b.y!=y.y&&(m=y.y-b.y)}s._translate(r[0],u,m,s.nameTable)}}}else if(i.annotation&&"annotation"==i.shape){for(h=0;h<i.outEdges.length;h++)if((g=s.nameTable[i.outEdges[h]])._isAnnotationLine){d=g;break}d&&(c=i.targetNode?s.nameTable[i.targetNode]:null,this.updateBPMNAnnotationShape(d,s.nameTable[d.sourceNode],null,c,s))}},updateAnnotationProperties:function(i,a){"node"==a.getObjectType(i)&&(i=a.nameTable[i.outEdges[0]]);var n=a.nameTable[i.targetNode],o=a.nameTable[i.sourceNode];n&&o?(i.annotation.angle=-1*e.datavisualization.Diagram.Util._findAngle({x:o.offsetX,y:o.offsetY},{x:n.offsetX,y:n.offsetY}),i.annotation.length=e.datavisualization.Diagram.Util.findLength({x:n.offsetX,y:n.offsetY},{x:o.offsetX,y:o.offsetY}),o.annotation=n.annotation=t.extend(!1,{},i.annotation),n._annotation=[i.sourceNode,i.name],a.nodes().indexOf(o)>-1&&(e.datavisualization.Diagram.Util.removeItem(a.nodes(),o),e.datavisualization.Diagram.Util.removeItem(a.connectors(),i),a._nodes=t.extend(!0,[],a.nodes()))):o&&(i.annotation.angle=-1*e.datavisualization.Diagram.Util._findAngle({x:o.offsetX,y:o.offsetY},i.targetPoint),i.annotation.length=e.datavisualization.Diagram.Util.findLength(i.targetPoint,{x:o.offsetX,y:o.offsetY}),o.annotation=t.extend(!1,{},i.annotation),a.nodes().push(o),a.connectors().push(i),a._nodes=t.extend(!0,[],a.nodes()))},updateInlineDecoratorsShape:function(t,i){var a,n,o,s;return t.shape&&"bpmn"==t.shape.type&&"message"==t.shape.flow&&(t._inlineDecorators.length&&((n=t._inlineDecorators.filter(function(e){if(e.name==t.name+"_"+t.shape.message)return e})).length&&(a=n[0])),t._inlineDecorators=[],("initiatingmessage"==t.shape.message||"noninitiatingmessage"==t.shape.message)&&(o=e.datavisualization.Diagram.Util._findOffsetOnConnector(t,{segmentOffset:.5},.5,i),s="noninitiatingmessage"==t.shape.message?"lightgrey":"white",a?(a.offsetX=o.offset.x,a.offsetY=o.offset.y,a.fillColor=s):a=e.datavisualization.Diagram.Node({name:t.name+"_"+t.shape.message,width:25,height:15,offsetX:o.offset.x,offsetY:o.offset.y,fillColor:s,shape:"path",pathData:"M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",constraints:e.datavisualization.Diagram.NodeConstraints.Delete}),t._inlineDecorators.push(a))),t}},e.datavisualization.Diagram.bpmnHelper={resetNodeMargin:function(t,i,a){var n,o,s,r={marginLeft:t.marginLeft,marginRight:t.marginRight,marginTop:t.marginTop,marginBottom:t.marginBottom};if(e.datavisualization.Diagram.canvasHelper._updateNodeMargin(a,t,i),i&&"group"==i._type)for(n=0;n<i.children.length;n++)for(s in o="string"==typeof i.children[n]?a.nameTable[i.children[n]]:i.children[n],r)0==r[s]&&(o[s]=0)},updateCanvas:function(t,i){var a,n;i._isUndo||e.datavisualization.Diagram.canvasHelper._updateNodeMargin(i,t,i.nameTable[t.parent]),t.container&&"canvas"===t.container.type&&(e.datavisualization.Diagram.canvasHelper._setSize(i,t,!0),this.updateProcessCollection(t,i),t.parent&&i.nameTable[t.parent]?(a=i.nameTable[t.parent],this.resetNodeMargin(t,a,i),this.updateCanvas(a,i)):e.datavisualization.Diagram.canvasHelper._updateNodeMargin(i,t,i.nameTable[t.parent]),i.nameTable[t.name]&&(n=i._disableSegmentChange,i._disableSegmentChange=!1,i._updateAssociatedConnectorEnds(t,i.nameTable),e.datavisualization.Diagram.DiagramContext.update(t,i),i._disableSegmentChange=n))},updateProcessCollection:function(t,i){var a;if("activity"==t.shape&&"subprocess"==t.activity){for(var n=t.subProcess.processes,o=0,s=i._getChildren(t.children);n&&n.length&&o<n.length;)-1==s.indexOf(n[o].name)?e.datavisualization.Diagram.Util.removeItem(n,n[o]):n[o]=i.nameTable[n[o++].name];for(o=0;o<t.children.length;o++)(a="string"==typeof t.children[o]?i.nameTable[t.children[o]]:t.children[o])._isInternalShape||-1!=n.indexOf(a)||n.push(a)}},isBPMNContainerChild:function(t,e){if(t&&t.parent){var i=e.nameTable[t.parent];return!(!i||"bpmn"!=i.type||"group"==i.shape||!i.container||"subprocess"===i.activity)}},canMoveOutofBounds:function(t,i,a,n){var o,s,r;return"connector"!=t.getObjectType(i)||!i.sourceNode&&!i.targetNode||(!(o=t.nameTable[i.sourceNode||i.targetNode])||!this.isBPMNContainerChild(o,t))||(s=t.nameTable[o.parent],r=e.datavisualization.Diagram.Util.bounds(s),!(a>=(r=e.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft])).x+r.width||a<=r.x||n>=r.y+r.height||n<=r.y))},canAllowConnection:function(t,e,i){var a=null;if(e&&i&&"bpmn"==i.type){if(i.parent&&(a=t.nameTable[i.parent]),a&&"bpmn"==a.type&&"group"!=a.shape&&e.parent!=i.parent)return a;if(t._containsChild(i,e)||t._containsChild(e,i))return null}return i},canAllowDropOnContainer:function(t,e){return"bpmn"!=e.type||"bpmn"==t.type&&"annotation"!=t.shape}}}(jQuery,Syncfusion),function(t,e){"use strict";var i=function(){function t(t){return this.xmlns="http://www.w3.org/2000/svg",this.document=document.createElementNS(this.xmlns,"svg"),this.id=t.id,t&&e.datavisualization.Diagram.Util.attr(this.document,t),this}return t.prototype.element=function(t,i){var a;return t&&t.id&&(a=this.document.getElementById(t.id)),a||(a=document.createElementNS(this.xmlns,i)),t&&e.datavisualization.Diagram.Util.attr(a,t),a},t.prototype.g=function(t){return this.element(t,"g")},t.prototype.defs=function(t){return this.element(t,"defs")},t.prototype.image=function(t){return this.element(t,"image")},t.prototype.path=function(t){return this.element(t,"path")},t.prototype.text=function(t){return this.element(t,"text")},t.prototype.textPath=function(t){return this.element(t,"textPath")},t.prototype.tspan=function(t){return this.element(t,"tspan")},t.prototype.rect=function(t){return this.element(t,"rect")},t.prototype.ellipse=function(t){return this.element(t,"ellipse")},t.prototype.circle=function(t){return this.element(t,"circle")},t.prototype.title=function(t){return this.element(t,"title")},t.prototype.line=function(t){return this.element(t,"line")},t.prototype.polyline=function(t){return this.element(t,"polyline")},t.prototype.polygon=function(t){return this.element(t,"polygon")},t.prototype.foreignObject=function(t){return this.element(t,"foreignObject")},t.prototype.linearGradient=function(t){return this.element(t,"linearGradient")},t.prototype.radialGradient=function(t){return this.element(t,"radialGradient")},t.prototype.stop=function(t){return this.element(t,"stop")},t.prototype.pattern=function(t){return this.element(t,"pattern")},t.prototype.appendChild=function(t){this.document.appendChild(t)},t.prototype.removeChild=function(t,e){e?e.removeChild(t):this.document.removeChild(t)},t.prototype.getElementById=function(t){return this.document.getElementById(t)},t.prototype.getElementsByClassName=function(t){return this.document.getElementsByClassName(t)},t.prototype.getElementsByTagName=function(t){return this.document.getElementsByTagName(t)},t.prototype.pathBounds=function(t){var i,a={d:t},n=this.path(a),o=new e.datavisualization.Diagram.Svg({id:"TempSvg"});return document.body.appendChild(o.document),o.document.appendChild(n),i=n.getBBox(),document.body.removeChild(o.document),i},t.prototype.textBounds=function(t,e,i){var a,n=null;return t&&e?((a=this.text(e)).appendChild(document.createTextNode(t)),this.document.appendChild(a),n=a.getBBox(),this.document.removeChild(a)):i&&(this.document.appendChild(i),n=i.getBBox(),this.document.removeChild(i)),n},t.prototype.absolutePath=function(t){for(var i,a,n,o,s,r,l,d,h,g=e.datavisualization.Diagram.Util.convertPathToArray(t.getAttribute("d")),c=0,u=0,m=0,p=g.length;m<p;++m){if(a=(i=g[m]).pathSegTypeAsLetter,/[MLHVCSQTA]/.test(a))"x"in i&&(c=i.x),"y"in i&&(u=i.y);else{switch("x1"in i&&(r=c+i.x1),"x2"in i&&(d=c+i.x2),"y1"in i&&(l=u+i.y1),"y2"in i&&(h=u+i.y2),"x"in i&&(c+=i.x),"y"in i&&(u+=i.y),a){case"m":n={pathSegTypeAsLetter:"M",x:c,y:u};break;case"l":n={pathSegTypeAsLetter:"L",x:c,y:u};break;case"h":n={pathSegTypeAsLetter:"H",x:c};break;case"v":n={pathSegTypeAsLetter:"V",y:u};break;case"c":n={pathSegTypeAsLetter:"C",x:c,y:u,x1:r,y1:l,x2:d,y2:h};break;case"s":n={pathSegTypeAsLetter:"S",x:c,y:u,x2:d,y2:h};break;case"q":n={pathSegTypeAsLetter:"Q",x:c,y:u,x1:r,y1:l};break;case"t":n={pathSegTypeAsLetter:"T",x:c,y:u};break;case"a":n={pathSegTypeAsLetter:"A",x:c,y:u,r1:i.r1,r2:i.r2,angle:i.angle,largeArcFlag:i.largeArcFlag,sweepFlag:i.sweepFlag};break;case"z":case"Z":c=o,u=s,n=g[m]}n&&(g[m]=n)}("M"===a||"m"===a)&&(o=c,s=u)}return t.setAttribute("d",e.datavisualization.Diagram.Util.pathSegArrayAsString(g)),t},t}();e.datavisualization.Diagram.Svg=i,e.datavisualization.Diagram.SvgContext={_renderDocument:function(i,a,n){var o,s,r,l;window.SVGSVGElement&&((o=t("#"+i.canvas.id+"_svgParent")[0])||(o=document.createElement("div")),s=e.datavisualization.Diagram.ScrollUtil._getRulerSize(a),r={id:i.canvas.id+"_svgParent",style:"height:auto;width:auto;position:absolute;overflow:hidden;left:"+s.left+"px;top:"+s.top+"px;bottom:0px;"},e.datavisualization.Diagram.Util.attr(o,r),i.canvas.appendChild(o),a._svgParent=o,r={id:i.canvas.id+"_svg",version:"1.1",style:"position:absolute;",class:"mainview_svg",role:"img"},e.isMobile()&&(r.style="position: inherit"),l=n?a._svg:new e.datavisualization.Diagram.Svg(r),i.svg=l,a&&(this._renderRulers(a,i.canvas,i.svg,n),a._svg=l,n||document.getElementById(l.document.id)||a._svgParent.appendChild(l.document),a._view=this._renderView(i.canvas,i.svg,n),a._page=this._renderPage(i.canvas,i.svg,a._view,n),this._renderBackground(a,i.canvas,i.svg,a._page,a.model,n),a._pageBackgroundLayer=this._renderBackgroundLayer(i.canvas,i.svg,a._page,n),this._renderGrid(i.canvas,i.svg,a._page,a),a._diagramLayer=i.diagramLayer=this._renderDiagramLayer(i.canvas,i.svg,a._page),a._htmlLayer=this._renderHtmlLayer(i.canvas,n,a),this._renderAdornerLayer(a,i.canvas,n,i)))},_renderRulers:function(t,e,i,a){var n;t.model.rulerSettings.showRulers?(this._renderOverLappingElement(t,e,i,a),this._renderRuler(t,e,i,!1,a),this._renderRuler(t,e,i,!0,a)):((n=document.getElementById(e.id+"_hRuler"))&&n.parentNode.removeChild(n),(n=document.getElementById(e.id+"_vRuler"))&&n.parentNode.removeChild(n),(n=document.getElementById(e.id+"_overlap-Ruler"))&&n.parentNode.removeChild(n))},_renderOverLappingElement:function(t,i){var a,n,o=document.getElementById(i.id+"_overlap-Ruler");o||(o=document.createElement("div"),a=e.datavisualization.Diagram.ScrollUtil._getRulerSize(t),o.setAttribute("id",i.id+"_overlap-Ruler"),n="height: "+a.top+"px;width:"+a.left+"px;position:absolute;left:0;top:0",o.setAttribute("style",n),o.setAttribute("class","sf-diagram_overlap")),i.insertBefore(o,i.firstChild)},_updateRulerSpace:function(t,e,i){var a=document.getElementById(t._canvas.id+(i?"_hRuler":"_vRuler")),n=i?t._hRulerInstance:t._vRulerInstance;a&&t&&e&&(i?(a.style.width=e.width+2*t._hRulerInstance.model.segmentWidth+"px",a.style.height=n.model.thickness+"px",(a=document.getElementById(t._canvas.id+"_overlap-Ruler"))&&(a.style.height=n.model.thickness+"px")):(a.style.height=e.height+2*t._vRulerInstance.model.segmentWidth+"px",a.style.width=n.model.thickness+"px",(a=document.getElementById(t._canvas.id+"_overlap-Ruler"))&&(a.style.width=n.model.thickness+"px")))},_renderRuler:function(i,a,n,o){var s,r,l,d,h=document.getElementById(a.id+(o?"_hRuler":"_vRuler")),g=e.datavisualization.Diagram.ScrollUtil._getRulerSize(i),c=e.datavisualization.Diagram.ScrollUtil._getRulerGeometry(i);h||(h=document.createElement("div"),s=o?"height: "+g.top+"px;width:"+c.width+"px;margin-left:"+g.left+"px;":"height:"+c.height+"px;width: "+g.left+"px;float:left;top:"+g.top+"px;",h.setAttribute("id",a.id+(o?"_hRuler":"_vRuler")),h.setAttribute("style",s),h.setAttribute("class","sf-diagram_hRuler")),a.insertBefore(h,a.firstChild),r=o?i.model.rulerSettings.horizontalRuler:i.model.rulerSettings.verticalRuler,(r=t.extend(!0,{},r)).length=(o?c.width:c.height)+r.segmentWidth,r.orientation=o?"horizontal":"vertical",l=t("#"+h.id).ejRuler(r),d=t("#"+h.id).ejRuler("instance"),o?(i._hRuler=l,i._hRulerInstance=d):(i._vRuler=l,i._vRulerInstance=d)},_renderView:function(t,e,i){var a,n=e.document.getElementById(t.id+"_view");return n||(a={id:t.id+"_view"},n=e.g(a)),i||e.appendChild(n),n},_renderHtmlLayer:function(t,i,a){var n,o,s=document.getElementById(t.id+"_htmlLayer");return s||(s=document.createElement("div")),n={id:t.id+"_htmlLayer",class:"htmlLayer"},e.datavisualization.Diagram.Util.attr(s,n),o=s,s.style.pointerEvents="none",i||a._svgParent.appendChild(o),o},_renderAdornerLayer:function(t,i,a,n){var o,s=document.getElementById(i.id+"_adorner");s||(s=document.createElement("div")),o={id:i.id+"_adorner",class:"adornerLayer_parent_div",style:"position:absolute;left:0px;top:0px"},e.datavisualization.Diagram.Util.attr(s,o),t._adornerLayer=this._renderAdornerSvg(t,i,s,a,n),t._tooltipLayer=this._renderTooltipLayer(i,s,a),a||t._svgParent.appendChild(s)},_renderTooltipLayer:function(t,i,a){var n,o,s=document.getElementById(t.id+"_tooltip");return s||(s=document.createElement("div")),n={id:t.id+"_tooltip",class:"diagram_tooltip"},e.datavisualization.Diagram.Util.attr(s,n),o=s,s.style.pointerEvents="none",a||i.appendChild(o),o},_renderPage:function(t,e,i,a){var n,o=e.document.getElementById(t.id+"_page");return o||(n={id:t.id+"_page",class:"page"},o=e.g(n)),a||i.appendChild(o),o},_renderDiagramLayer:function(t,e,i){var a,n=e.document.getElementById(t.id+"_diagramLayer");return n||(a={id:t.id+"_diagramLayer",class:"DiagramLayer"},n=e.g(a),i.appendChild(n)),n},_renderAdornerSvg:function(t,i,a,n,o){var s,r,l,d,h;if(window.SVGSVGElement)return h={id:i.id+"_svg_adorner",version:"1.1",style:"position:absolute",fill:"none","pointer-events":"none"},s=n?t._adornerSvg:new e.datavisualization.Diagram.Svg(h),n||document.getElementById(s.document.id)||a.appendChild(s.document),(r=s.document.getElementById(i.id+"_expander"))||(h={id:i.id+"_expander",class:"ExpanderLayer","pointer-events":"all"},r=s.g(h),s.document.appendChild(r)),o._expander=t._expander=r,(l=s.document.getElementById(i.id+"_adornerLayer"))||(h={id:i.id+"_adornerLayer",class:"AdornerLayer","pointer-events":"none"},l=s.g(h),s.document.appendChild(l)),(d=s.document.getElementById(i.id+"_portLayer"))||(h={id:i.id+"_portLayer",class:"portLayer","pointer-events":"none"},d=s.g(h),l.appendChild(d)),t._adornerSvg=s,l},_renderBackgroundLayer:function(t,e,i,a){var n,o=e.document.getElementById(t.id+"_pageBackground");return o||(n={id:t.id+"_pageBackground",class:"PageBackgroundLayer",style:"pointer-events:none;"},o=e.g(n)),a||i.appendChild(o),o},_renderBackground:function(t,i,a,n){var o,s,r;a.document.style.msTouchAction="none",a.document.style.display="block",a.document.style.backgroundColor="white";var l={id:i.id+"_backgroundLayer"},d=a.g(l),h=t._getDigramBounds();if(t._backgroundImage()){var g=t._backgroundImage(),c=e.datavisualization.Diagram.Util._getImageAlignment(g.alignment),u="none "+c!="none"&&"none"!=g.scale?c+" "+g.scale:"none";l={id:i.id+"_backgroundImage",x:h.x,y:h.y,width:h.width,height:h.height,preserveAspectRatio:u,"pointer-events":"none"},(o=a.image(l)).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g.source),a.getElementById(i.id+"_backgroundImage")||d.appendChild(o)}s=t._backgroundColor(),r=a.rect({id:i.id+"_backgroundColor",width:"100%",height:"100%",fill:s,"pointer-events":"none"}),s?a.getElementById(i.id+"_backgroundColor")||d.appendChild(r):a.getElementById(r.id)&&d.removeChild(a.getElementById(r.id)),a.getElementById(d.id)||n.appendChild(d)},_renderGrid:function(t,i,a,n){var o,s,r,l,d,h=n._svg.document.getElementById(t.id+"patterndefinition");if(h||(h=i.defs({id:t.id+"patterndefinition"}),i.appendChild(h)),n._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines||n._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.ShowVerticalLines){var g,c=document.getElementById(t.id+"_grid"),u=document.getElementById(t.id+"pattern_gridline");(g=document.getElementById(t.id+"pattern_grid"))&&g.parentNode&&g.parentNode.removeChild(g),s={id:t.id+"_grid","pointer-events":"none"},o=i.g(s),r=0,n.model.snapSettings.horizontalGridLines.linesInterval&&n.model.snapSettings.horizontalGridLines.linesInterval.forEach(function(t){r+=t}),l=0,n.model.snapSettings.verticalGridLines.linesInterval&&n.model.snapSettings.verticalGridLines.linesInterval.forEach(function(t){l+=t}),d=this._scaleSnapInterval(n.model,n._currZoom),s={id:t.id+"pattern_grid",x:0,y:0,width:l*d,height:r*d,patternUnits:"userSpaceOnUse"},g=i.pattern(s),d=this._scaleSnapInterval(n.model,d),this._renderHorizontalGridlines(d,g,l,n,i),this._renderVerticalGridlines(d,g,r,n,i),h.appendChild(g),u=i.rect({id:t.id+"pattern_gridline",x:n._hScrollOffset,y:n._vScrollOffset,width:"100%",height:"100%",fill:"url(#"+t.id+"pattern_grid)"}),o.appendChild(u),c||(n._diagramLayer?a.insertBefore(o,n._diagramLayer):a.appendChild(o))}else(o=document.getElementById(t.id+"_grid"))&&((c=document.getElementById(t.id+"pattern_gridline"))&&c.parentNode&&c.parentNode.removeChild(c))},_updateBackground:function(t,i,a,n){var o,s,r={x:t,y:i},l=document.getElementById(n._id+"_canvas_backgroundColor");l&&e.datavisualization.Diagram.Util.attr(l,r),o=document.getElementById(n._id+"_canvas_backgroundImage"),s=n._getDigramBounds(),o&&e.datavisualization.Diagram.Util.attr(o,{transform:"scale("+a+")",x:s.x,y:s.y,width:s.width,height:s.height})},_updateGrid:function(t,i,a,n){var o,s,r,l,d,h,g=document.getElementById(n._canvas.id+"pattern_gridline");if(g){if(s=document.getElementById(n._canvas.id+"pattern_grid"),r=0,n.model.snapSettings.horizontalGridLines.linesInterval)for(o=0;o<n.model.snapSettings.horizontalGridLines.linesInterval.length;o++)r+=n.model.snapSettings.horizontalGridLines.linesInterval[o];if(l=0,n.model.snapSettings.verticalGridLines.linesInterval)for(o=0;o<n.model.snapSettings.verticalGridLines.linesInterval.length;o++)l+=n.model.snapSettings.verticalGridLines.linesInterval[o];h={x:t,y:i},e.datavisualization.Diagram.Util.attr(g,h),a=this._scaleSnapInterval(n.model,a),d=n._svg.defs({id:n._canvas.id+"patterndefinition"}),s&&d.removeChild(s),h={id:n._canvas.id+"pattern_grid",x:0,y:0,width:l*a,height:r*a,patternUnits:"userSpaceOnUse"},s=n._svg.pattern(h),this._renderHorizontalGridlines(a,s,l,n,n._svg),this._renderVerticalGridlines(a,s,r,n,n._svg),d.appendChild(s)}},_scaleSnapInterval:function(t,e){if(e>=2)for(;e>=2;)e/=2;else if(e<=.5)for(;e<=.5;)e*=2;var i;if(1!==e){for(t.snapSettings.horizontalGridLines._snapinterval=[],i=0;i<t.snapSettings.horizontalGridLines.snapInterval.length;i++)t.snapSettings.horizontalGridLines._snapinterval[i]=t.snapSettings.horizontalGridLines.snapInterval[i]*e;for(t.snapSettings.verticalGridLines._snapinterval=[],i=0;i<t.snapSettings.verticalGridLines.snapInterval.length;i++)t.snapSettings.verticalGridLines._snapinterval[i]=t.snapSettings.verticalGridLines.snapInterval[i]*e}return e},_updateRulerSegment:function(e,i,a,n,o,s){if(n.model.rulerSettings.showRulers){for(var r,l,d,h=n.model.snapSettings,g=t("#"+(s?n._hRuler[0].id:n._vRuler[0].id)).ejRuler("instance"),c=t("#"+(s?n._vRuler[0].id:n._hRuler[0].id)).ejRuler("instance"),u=g._updateSegmentWidth(n._currZoom),m=c._updateSegmentWidth(n._currZoom),p=u/g.model.interval,f=0,_=s?h.verticalGridLines:h.horizontalGridLines,v=0;v<g.model.interval;v++)l=0==v?1.25:.25,d=Number(f+l/2),f+=p+l/2,(r=s?o.path({d:"M "+d+" 0 L "+d+" "+m+" Z",stroke:_.lineColor,"stroke-width":l,"stroke-dasharray":_.lineDashArray}):o.path({d:"M 0 "+d+" L "+m+" "+d+" Z",stroke:_.lineColor,"stroke-width":l,"stroke-dasharray":_.lineDashArray}))&&i.appendChild(r);s?i.setAttribute("width",u):i.setAttribute("height",u)}},_checkForDefaultGridlines:function(t){var e,i=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75];if(t){if(t.length>0&&i.length>0&&t.length!=i.length)return!1;for(e=0;e<i.length;e++)if(i[e]!=t[e])return!1}return!0},_renderHorizontalGridlines:function(t,i,a,n,o){var s,r,l,d,h,g=n.model.snapSettings;if(n._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines)if(n.model.rulerSettings.showRulers&&this._checkForDefaultGridlines(n.model.snapSettings.horizontalGridLines.linesInterval))this._updateRulerSegment(t,i,a,n,o);else for(s=0,0,l=0;l<g.horizontalGridLines.linesInterval.length;l+=2)d=g.horizontalGridLines.linesInterval[l],r=Number(s+d/2),h=o.path({d:"M 0 "+r*t+" L "+a*t+" "+r*t+" Z",stroke:g.horizontalGridLines.lineColor,"stroke-width":d,"stroke-dasharray":g.horizontalGridLines.lineDashArray}),s+=g.horizontalGridLines.linesInterval[l+1]+d,i.appendChild(h),0},_renderVerticalGridlines:function(t,i,a,n,o){var s,r,l,d,h,g=n.model,c=g.snapSettings;if(c.snapConstraints&e.datavisualization.Diagram.SnapConstraints.ShowVerticalLines)if(n.model.rulerSettings.showRulers&&this._checkForDefaultGridlines(n.model.snapSettings.verticalGridLines.linesInterval))this._updateRulerSegment(t,i,a,n,o,!0);else for(s=0,0,l=0;l<c.verticalGridLines.linesInterval.length;l+=2)d=g.snapSettings.verticalGridLines.linesInterval[l],r=Number(s+d/2),h=o.path({d:"M "+r*t+" 0 L "+r*t+" "+a*t+" Z",stroke:c.verticalGridLines.lineColor,"stroke-width":d,"stroke-dasharray":c.verticalGridLines.lineDashArray}),s+=c.verticalGridLines.linesInterval[l+1]+d,i.appendChild(h),0},transformView:function(t,i,a){e.datavisualization.Diagram.ScrollUtil._getRulerSize(t);var n=t._view,o={transform:"translate("+i+","+a+")"};e.datavisualization.Diagram.Util.attr(n,o),e.datavisualization.Diagram.Util.attr(t._adornerLayer,o),e.datavisualization.Diagram.Util.attr(t._expander,{transform:"translate("+i+","+a+"),scale("+t.model.scrollSettings.currentZoom+")"}),t._htmlLayer&&(t._htmlLayer.style.left=i+"px",t._htmlLayer.style.top=a+"px",t._htmlLayer.style.position="absolute")},scaleContent:function(t,i){var a,n,o,s,r,l,d=t._diagramLayer;for(e.datavisualization.Diagram.Util.attr(d,{transform:"scale("+i+")"}),a="function"==typeof t.model.scrollSettings.horizontalOffset?t.model.scrollSettings.horizontalOffset():t.model.scrollSettings.horizontalOffset,n="function"==typeof t.model.scrollSettings.verticalOffset?t.model.scrollSettings.verticalOffset():t.model.scrollSettings.verticalOffset,e.datavisualization.Diagram.Util.attr(t._expander,{transform:"translate("+-a+","+-n+"),scale("+i+")"}),t._htmlLayer&&(t._htmlLayer.style.webkitTransform="scale("+i+")",t._htmlLayer.style.MozTransform="scale("+i+")",t._htmlLayer.style.OTransform="scale("+i+")",t._htmlLayer.style.msTransform="scale("+i+")",t._htmlLayer.style.transform="scale("+i+")"),t.selectionList.length>0&&this.updateSelector(t.selectionList[0],t._adornerSvg,i,t,t.model.selectedItems.constraints),t.selectionList[0]&&t.model.selectedItems.userHandles&&t.model.selectedItems.userHandles.length>0&&(o=!1,"pseudoGroup"==t.selectionList[0].type&&(o=!0),t.model.selectedItems.constraints&e.datavisualization.Diagram.SelectorConstraints.UserHandles&&e.datavisualization.Diagram.SvgContext.updateUserHandles(t.model.selectedItems.userHandles,t.selectionList[0],t._adornerSvg,o,!1,i,t)),r=0,l=(s=t.nodes()).length;r<l;++r)this._updatePortScale(s[r],t)},_updatePortScale:function(t,e){var i,a,n;if(t=e.nameTable[e._getChild(t)],this._updatePorts(t,e._adornerSvg,e),"pseudoGroup"!=t.type&&((i=t.children)&&i.length>0))for(a=0,n=i.length;a<n;++a)this._updatePortScale(i[a],e)},setSize:function(i,a,n){if(e.datavisualization.Diagram.Util.attr(i._svg.document,{width:a+"px",height:n+"px"}),!i._svgParentDimention||i._svgParentDimention.width!==a||i._svgParentDimention.height!==n){var o=e.datavisualization.Diagram.ScrollUtil._getRulerSize(i);i._svgParentDimention={},i._svgParentDimention.width=i.element.width()-o.left,i._svgParentDimention.height=i.element.height()-o.top}t(i._svgParent).css("width",i._svgParentDimention.width+"px").css("height",i._svgParentDimention.height+"px"),e.datavisualization.Diagram.Util.attr(i._adornerSvg.document,{width:a+"px",height:n+"px"})},renderNode:function(t,i,a,n,o,s){var r,l,d,h,g=t.width?t.width:t._width||0,c=t.height?t.height:t._height||0,u=t.name,m=0,p=0,f=0,_=0,v=0,y=t.visible&&e.datavisualization.Diagram.Util.enableLayerOption(t,"visible",o)?"visible":"hidden";return n||(f=t.offsetX-g*t.pivot.x,_=t.offsetY-c*t.pivot.y,m=t.offsetX,p=t.offsetY,v=t.rotateAngle),e.datavisualization.Diagram.Util.canCrispEdges(t,o)&&(f=Math.floor(f)+.5,_=Math.floor(_)+.5),l={id:u,class:"ej-d-node",transform:"rotate("+v+","+m+","+p+"),translate("+f+","+_+")",visibility:y},e.datavisualization.Diagram.Util.canEnablePointerEvents(t,o)||(l.style="pointer-events:none"),t._isClassifier&&(l.class+=" ej-d-classifier"),r=i.g(l),a?a.appendChild(r):i.appendChild(r),(d="none"!==t.flip?t.flip:t._flip)&&d!==e.datavisualization.Diagram.FlipDirection.None&&((h=this.renderflipElement(t,o))&&(l.transform="rotate("+v+","+m+","+p+")"+h),i.g(l)),t._isDisabled&&e.datavisualization.Diagram.Util.attr(r,{style:"pointer-events:none;"}),this._renderNode(t,i,r,o,n,s),t&&t.annotation&&e.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(t,o),t._isClassifier&&delete t._isClassifier,r},renderflipElement:function(t,i){var a,n=null,o=t.offsetX+t.width*t.pivot.x,s=t.offsetY+t.height*t.pivot.y,r=t.offsetX-t.width*t.pivot.x,l=t.offsetY-t.height*t.pivot.y,d="none"!==t.flip?t.flip:t._flip;return t.parent&&(a=i.nameTable[t.parent]),a&&a.flip===t.flip||(d==e.datavisualization.Diagram.FlipDirection.Horizontal?n="translate("+o+","+l+") scale(-1,1)":d==e.datavisualization.Diagram.FlipDirection.Vertical?n="translate("+r+","+s+") scale(1,-1)":d==e.datavisualization.Diagram.FlipDirection.Both&&(n="translate("+o+","+s+") scale(-1,-1)")),n},_renderNode:function(t,e,i,a,n,o){this._renderShape(t,e,i,a),this._renderLabels(t,e,a,n),this._renderPorts(t,a._adornerSvg&&!o?a._adornerSvg:e,a,o),t.outEdges.length>0&&this._renderIcons(t,a)},_renderShadow:function(t,i){var a,n,o,s,r,l;t.segments||(a=i.document.getElementById(t.name),t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(n=t.fillColor,"image"===t.type||"text"===t.type||"html"===t.type?o=i.document.getElementById(t.name+"_backRect"):"text"!=t.type&&"image"!=t.type&&(o=i.document.getElementById(t.name+"_shape")),o&&(s=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),r={id:t.name+"_shadow",width:t.width,height:t.height,stroke:"none"!=t.borderColor||"transparent"!=t.borderColor?"lightgrey":"none",fill:"none"!=n||"transparent"!=n?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:t.shadow.opacity,"stroke-dasharray":""},"native"===t.type||"html"===t.type?a.insertBefore(i.rect(r),o):(l=o.cloneNode(!0),a.insertBefore(l,o),e.datavisualization.Diagram.Util.attr(l,r)))))},_updateShadow:function(t,i){i.document.getElementById(t.name);var a=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),n={id:t.name+"_shadow",transform:"translate("+a.x+","+a.y+")",opacity:t.shadow.opacity};i.g(n)},_deleteLabel:function(t,e,i,a,n){var o,s,r,l;if("html"===i.model.labelRenderingMode){if(o=n.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=this._findChild(o.childNodes,t))for(r=s.childNodes.length,l=0;l<r;l++)s.childNodes[l].id==t.name+"_"+e.name+"_lblbg"&&s.childNodes[l].parentNode.removeChild(s.childNodes[l])}else(e=a.document.getElementById(t.name+"_"+e.name))&&e.parentNode.removeChild(e)},_deletePort:function(t,e,i,a){t&&((e=a.document.getElementById(t.name+"_"+e.name))&&e.parentNode.removeChild(e))},_removeShadow:function(t,e){if("text"!=t.type){var i,a,n=t.name;"bpmn"===t.type&&t.children&&"group"!=t.shape&&(n=t.children[0].name),i=e.document.getElementById(n),a=e.document.getElementById(n+"_shadow"),i&&a&&i.removeChild(a)}},_renderphase:function(t,i,a,n,o){var s,r,l,d,h;s=i.g({id:t.name+"_phase_g",class:"ej-d-seperator"}),t.parent?a.appendChild(s):i.appendChild(s);var g=0,c=0;if(o){(r=n._getChildren(o.children)).length>1&&(l=n.nameTable[r[0]]);var u,m=e.datavisualization.Diagram.Util.bounds(o),p=[],f=m.top+50,_=m.left+50;"vertical"==t.orientation?(p.push({x:0,y:0}),p.push({x:m.width,y:0}),u=this._convertToSVGPoints(p),g=m.x,c=m.y+t.offset+l.height,l&&(f+=l.height),c<m.bottom&&c>f||"hidden"):(p.push({x:0,y:l.height?l.height:0}),p.push({x:0,y:m.height}),u=this._convertToSVGPoints(p),g=m.x+t.offset,c=m.y,g<m.right&&g>_||"hidden"),d={id:t.name+"_phase",stroke:t.lineColor,"stroke-width":t.lineWidth,"stroke-dasharray":t.lineDashArray,points:u},h=i.polyline(d),s.appendChild(h),d={id:t.name+"_phase_hitTest",class:"hitTest","stroke-width":10,points:u,stroke:"transparent"},h=i.polyline(d),s.appendChild(h),s.setAttribute("transform","translate("+g+","+c+")")}},renderphase:function(t,e,i,a,n){var o,s;a._views.forEach(function(e){o=a._views[e],s=o.svg||o._canvas,i&&(i=s.document.getElementById(i.id)),o.context._renderphase(t,s,i||o.diagramLayer,a,n)})},_renderGroupBackground:function(t,i,a,n){var o,s,r,l;if("none"!=t.fillColor){var d=t.offsetX-t.width*t.pivot.x,h=t.offsetY-t.height*t.pivot.y,g=t.fillColor,c=t.borderColor;("bpmn"==t.type&&"group"!=t.shape||t.classifier&&"package"==t.classifier)&&(g="transparent",c="transparent"),e.datavisualization.Diagram.Util.canCrispEdges(t,n)&&(d=Math.floor(d)+.5,h=Math.floor(h)+.5);var u=t.rotateAngle,m=new e.datavisualization.Diagram.Point(d+t.width*t.pivot.x,h+t.height*t.pivot.y),p={id:t.name+"_shape",rx:t.cornerRadius,ry:t.cornerRadius,width:Math.round(t.width<0?0:t.width),height:Math.round(t.height<0?0:t.height),fill:g,stroke:c,"stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray,transform:"rotate("+u+","+m.x+","+m.y+"),translate("+d+","+h+")"};("umlclassifier"==t.type||t._isClassifier)&&(p.class="ej-d-group ej-d-classifier"),t.gradient&&"bpmn"!=t.type&&(p.fill=this._renderGradient(t.name,t.gradient,a)),this._addCssClass(t,p),o=a.rect(p),i.appendChild(o),"bpmn"===t.type&&"group"===t.shape&&t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(s=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),"group"===t.shape&&0===t.children.length&&(s.x=t.offsetX-t.width*t.pivot.x+s.x,s.y=t.offsetY-t.height*t.pivot.y+s.y),r={id:t.name+"_shadow",width:t.width,height:t.height,stroke:"none"!=t.borderColor||"transparent"!=t.borderColor?"lightgrey":"none",fill:"none"!=g||"transparent"!=g?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:t.shadow.opacity,"stroke-dasharray":""},l=o.cloneNode(!0),i.insertBefore(l,o),e.datavisualization.Diagram.Util.attr(l,r))}},renderGroup:function(i,a,n,o,s,r,l){var d,h,g,c,u,m,p,f,_,v=i.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",s)?"visible":"hidden",y={id:i.name,class:"ej-d-group",visibility:v};if(e.datavisualization.Diagram.Util.canEnablePointerEvents(i,s)||(y.style="pointer-events:none"),("umlclassifier"==i.type||i._isClassifier)&&(y.class+=" ej-d-classifier"),d=a.g(y),n?n.appendChild(d):a.appendChild(d),""==i.parent&&i.container&&(r&&(i.height=0,i.width=0),l||s._updateChildAdjacentConnectors(i)),this._renderGroupBackground(i,d,a,s),i.isSwimlane&&(s._disableSwimlaneUptate=!0),(h=i.children)&&h.length>0)for(g=0,c=h.length;g<c;g++)(u=o[e.datavisualization.Diagram.Util.getChild(h[g])])&&("group"===u._type?("umlclassifier"==i.type&&(u._isClassifier=!0),this.renderGroup(u,a,d,o,s,r,l),e.datavisualization.Diagram.Util._updateGroupBounds(u,s,!0),e.datavisualization.Diagram.DiagramContext.update(u,s)):u.segments?(e.datavisualization.Diagram.Util.updateBridging(u,s),this.renderConnector(u,a,d,s)):("umlclassifier"==i.type&&(u._isClassifier=!0),this.renderNode(u,a,d,void 0,s,l),u._isService&&((m=t.extend(!0,{},u)).name=u.name+"service",m.offsetX=u.offsetX+7,m.offsetY=u.offsetY+5,this.renderNode(m,a,d,void 0,s,l))));return this._renderLabels(i,a,s),this._renderPorts(i,s._adornerSvg&&!l?s._adornerSvg:a,s,l),i.isSwimlane&&delete s._disableSwimlaneUptate,i&&i.annotation&&e.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(i,s),i&&i.isSwimlane&&(_=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(s,i),s._views.forEach(function(t){var e,a;for(p=s._views[t],f=p.svg||p._canvas,n&&(n=f.document.getElementById(n.id)),e=0;_&&e<_.length;e++)(a=s.nameTable[s._getChild(_[e])])&&p.context._renderphase(a,f,n||p.diagramLayer,s,i)})),i._isClassifier&&delete i._isClassifier,d},_renderGradient:function(t,e,i){var a;return"linear"===e.type?a="url(#"+this._renderLinearGradient(i.id+"_"+t,e,i)+")":"radial"===e.type&&(a="url(#"+this._renderRadialGradient(i.id+"_"+t,e,i)+")"),a},_checkGradientTag:function(t,e,i){if(e.getElementById(t+"_gradient")){var a=e.getElementById(t+"_gradient");(i&&"radialGradient"===a.localName||!i&&"linearGradient"===a.localName)&&a.parentNode.removeChild(a)}},_renderLinearGradient:function(t,e,i){var a,n,o=i.document.getElementById(i.document.parentNode.parentNode.id+"patterndefinition")||i.document.getElementById(t+"patterndefinition");return o?(this._checkGradientTag(t,i,!0),a={id:t+"_gradient",x1:e.x1+"%",y1:e.y1+"%",x2:e.x2+"%",y2:e.y2+"%"},n=i.linearGradient(a),this._renderStops(e,i,n),o.appendChild(n),n.id):null},_renderRadialGradient:function(e,i,a){var n,o,s=a.document.getElementById(t(a.document).parents()[1].id+"patterndefinition")||a.document.getElementById(e+"patterndefinition");return s?(this._checkGradientTag(e,a,!1),n={id:e+"_gradient",cx:i.cx+"%",cy:i.cy+"%",fx:i.fx+"%",fy:i.fy+"%",r:i.r+"%"},o=a.radialGradient(n),this._renderStops(i,a,o),s.appendChild(o),o.id):null},_renderStops:function(t,e,i){var a,n,o,s;if(e.getElementById(i.getAttribute("id"))===i)for(;i.firstChild;)i.removeChild(i.firstChild);for(o=0,s=(a=t.stops).length;o<s;o++)n=a[o],i.appendChild(e.stop({offset:n.offset+"%","stop-color":n.color,"stop-opacity":n.opacity}))},_renderShape:function(t,e,i,a){switch(t._shape?t._shape:t.type){case"rectangle":this._renderRect(t,e,i);break;case"ellipse":this._renderEllipse(t,e,i);break;case"image":this._renderImage(t,e,i);break;case"path":this._renderPath(t,e,i);break;case"polygon":this._renderPolygon(t,e,i);break;case"text":this._renderTextElement(t,e,i,a);break;case"html":this._renderHtmlElement(t,e,i,a);break;case"native":this._rendercontent(t,e,i,a)}},_renderHTMLTemplate:function(e,i){if(e.templateId&&t.templates)return i._renderEjTemplate("#"+e.templateId,e)},_renderSvgTemplate:function(t,e,i,a){var n,o,s,r,l=document.createElement("div");l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+a+"</g></svg>",document.body.appendChild(l),(o=(n=document.getElementById("tempNative")).cloneNode(!0)).id=t.name+"_shape",i.appendChild(o),s={id:t.name+"_shape",fill:t.fillColor,stroke:t.borderColor,"stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray},this._addCssClass(t,s),t.gradient&&(s.fill=this._renderGradient(t.name,t.gradient,e)),e.g(s),(r=this._scaleNodeContent(t,n))&&o.setAttribute("transform","translate("+r.x+","+r.y+"),scale("+r.sx+","+r.sy+")"),o.setAttribute("id",t.name+"_shape"),l.parentNode.removeChild(l)},_scaleNodeContent:function(t,e){var i,a,n,o;if("none"!=t.scale){e&&(n="html"==t.type?e.getBoundingClientRect():e.getBBox()),"html"==t.type&&(n.x=n.left,n.y=n.top),i=t.width?t.width:t._width,a=t.height?t.height:t._height,e||(n={x:t.offsetX-t.width*t.pivot.x,y:t.offsetY-t.height*t.pivot.y,width:i,height:a});var s=n.width?i/n.width:1,r=n.height?a/n.height:1,l=n.x*s*-1,d=n.y*r*-1;return"stretch"!=t.scale&&"none"!=t.contentAlignment?(o="meet"==t.scale?Math.min(s,r):Math.max(s,r),t.contentAlignment.indexOf("xmid")>-1?l=i/2-n.width*o/2:t.contentAlignment.indexOf("xmax")>-1&&(l=n.x+i-n.width*o),t.contentAlignment.indexOf("ymid")>-1?d=n.y+a/2-n.height*o/2:t.contentAlignment.indexOf("ymax")>-1&&(d=n.y+a-n.height*o),{x:l,y:d,sx:o,sy:o}):{x:l,y:d,sx:s,sy:r}}return null},_rendercontent:function(i,a,n,o){var s,r,l;if(i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow){var d=i.fillColor,h=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},i.shadow.angle,i.shadow.distance),g={id:i.name+"_shadow",width:i.width,height:i.height,stroke:"none"!=i.borderColor||"transparent"!=i.borderColor?"lightgrey":"none",fill:"none"!=d||"transparent"!=d?"lightgrey":"none",transform:"translate("+h.x+","+h.y+")",opacity:i.shadow.opacity};n.appendChild(a.rect(g))}!i.segments&&i.templateId&&t.templates&&(s=i.width,r=i.height,"node"!==i._type||i.height||i.width||(i.width=i._width,i.height=i._height),l=o._renderEjTemplate("#"+i.templateId,i),i.width=s,i.height=r,this._renderSvgTemplate(i,a,n,l))},_fill:function(t,e){var i;return t.gradient&&(i=this._renderGradient(t.name,t.gradient,e)),i||(i=t.fillColor),i},_fillBorder:function(t,e){var i;return t.borderGradient&&(i=this._renderGradient(t.name,t.borderGradient,e)),i||(i=t.borderColor),i},_addCssClass:function(t,e){return t.cssClass&&e&&(e.class=e.class?e.class+" "+t.cssClass:t.cssClass),t._cssClass=t.cssClass,e},_updateCssClass:function(t,e){if((""!=t._cssClass||""===t._cssClass&&""!==t.cssClass)&&void 0!==t._cssClass&&t.cssClass!=t._cssClass){var i=e.class;return i&&(e.class=i.replace(t._cssClass,"").trim()),this._addCssClass(t,e)}return e},_renderRect:function(t,i,a){var n,o,s,r=this._fill(t,i),l=this._fillBorder(t,i),d=t.width?t.width:t._width,h=t.height?t.height:t._height,g={id:t.name+"_shape",rx:t.cornerRadius,ry:t.cornerRadius,role:"presentation",width:d,height:h,fill:r,stroke:l,"stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray};t._isClassifier&&(n="ej-d-node ej-d-classifier"),g.class=n,this._addCssClass(t,g),t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(o=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),s={id:t.name+"_shadow",rx:t.cornerRadius,ry:t.cornerRadius,width:t.width,height:t.height,stroke:"none"!=t.borderColor||"transparent"!=t.borderColor?"lightgrey":"none",fill:"none"!=r||"transparent"!=r?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:t.shadow.opacity},a.appendChild(i.rect(s))),a.appendChild(i.rect(g))},_renderEllipse:function(t,i,a){var n,o,s=t.width?t.width:t._width,r=t.height?t.height:t._height,l=this._fill(t,i),d=this._fillBorder(t,i),h={id:t.name+"_shape",rx:s/2,ry:r/2,role:"presentation",cx:s/2,cy:r/2,fill:l,stroke:d,"stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray};this._addCssClass(t,h),t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(n=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),o={id:t.name+"_shadow",rx:t.width/2,ry:t.height/2,cx:t.width/2,cy:t.height/2,stroke:"none"!=t.borderColor||"transparent"!=t.borderColor?"lightgrey":"none",fill:"none"!=l||"transparent"!=l?"lightgrey":"none",transform:"translate("+n.x+","+n.y+")",opacity:t.shadow.opacity},a.appendChild(i.ellipse(o))),a.appendChild(i.ellipse(h))},_renderImage:function(t,i,a){t.fillColor,this._renderBackgroundRect(t,i,a);var n,o=t.width?t.width:t._width,s=t.height?t.height:t._height,r=e.datavisualization.Diagram.Util._getImageAlignment(t.contentAlignment),l="none"==t.scale?"meet":t.scale,d={id:t.name+"_shape",opacity:t.opacity,preserveAspectRatio:"stretch"!=l&&"none"!=r?r+" "+l:"none",width:o,height:s,role:"img"},h=new Image;h.src=t.source,"none"==t.scale&&(d.width=h.width||o,d.height=h.height||s),(n=i.image(d)).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),a.appendChild(n)},_renderPolygon:function(t,i,a){var n,o,s,r,l=this._fill(t,i),d=this._fillBorder(t,i);e.datavisualization.Diagram.Geometry.updatePolygonPoints(t),n=this._convertToSVGPoints(t.points),o={id:t.name+"_shape",fill:l,stroke:d,role:"presentation","stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray,points:n},this._addCssClass(t,o),t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(s=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),r={id:t.name+"_shadow",points:n,stroke:"none"!=t.borderColor||"transparent"!=t.borderColor?"lightgrey":"none",fill:"none"!=l||"transparent"!=l?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:t.shadow.opacity},a.appendChild(i.polygon(r))),a.appendChild(i.polygon(o))},_renderPath:function(t,i,a){var n,o,s,r,l=this._fill(t,i),d=this._fillBorder(t,i),h=t.width?t.width:t._width,g=t.height?t.height:t._height;t._absolutePath=n=t._preventStretch||t._polyline?t.pathData:e.datavisualization.Diagram.Geometry.updatePath(0,0,h,g,t.pathData,i,null,t),o={id:t.name+"_shape",d:n,opacity:t.opacity,role:"presentation","stroke-dasharray":t.borderDashArray,stroke:d,"stroke-width":t.borderWidth,fill:l},t._isClassifier&&(o.class="ej-d-node ej-d-classifier"),this._addCssClass(t,o),t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(s=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),r={id:t.name+"_shadow",width:t.width,height:t.height,d:n,stroke:"none"!=t.borderColor||"transparent"!=t.borderColor?"lightgrey":"none",fill:"none"!=l||"transparent"!=l?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:t.shadow.opacity},a.appendChild(i.path(r))),a.appendChild(i.path(o))},_renderHtmlElement:function(i,a,n,o){var s,r,l,d,h,g,c,u;this._renderBackgroundRect(i,a,n);if(!i.segments&&i.templateId){u=a.document.parentNode.getElementsByClassName("htmlLayer")[0],(s=t(u).children("#"+i.name+"_parentdiv")[0])&&u.removeChild(s);var m,p=i.width?i.width:i._width,f=i.height?i.height:i._height,_=i.offsetX-p*i.pivot.x,v=i.offsetY-f*i.pivot.y;(m=a.document.getElementById(i.name+"_html"))||(m=document.createElement("div")),r="width:"+p+"px;height:"+f+"px;padding:1px; left:"+_+"px; top:"+v+"px;position:absolute;",r+="display: block; border:0px; pointer-events: all; opacity:"+i.opacity+";",r+="transform:rotate("+i.rotateAngle+"deg)",l={id:i.name+"_html",class:"foreignObject",style:r},this._addCssClass(i,l),e.datavisualization.Diagram.Util.attr(m,l),!i.segments&&i.templateId&&(d=this._renderHTMLTemplate(i,o),m.innerHTML=d),h=document.createElement("div"),g={id:i.name+"_parentdiv",class:"ej-d-node"},e.datavisualization.Diagram.Util.attr(h,g),h.appendChild(m),c=i.visible?"visible":"hidden",h.style.visibility=c,(u=a.document.parentNode.getElementsByClassName("htmlLayer")[0])?u.appendChild(h):a.document.parentNode.appendChild(m)}},_initializeGuidelines:function(t,e,i){var a=t.g(e);return i.appendChild(a),a},_renderSideAlignmentLines:function(t,e,i,a,n){var o=a.line({x1:t.x*n,y1:t.y*n,x2:e.x*n,y2:e.y*n,stroke:"#07EDE1","stroke-width":1});i.appendChild(o)},_renderCenterAlignmentLines:function(t,e,i,a,n){var o=a.line({x1:t.x*n,y1:t.y*n,x2:e.x*n,y2:e.y*n,stroke:"#07EDE1","stroke-width":1});i.appendChild(o)},_renderSpacingLines:function(t,e,i,a,n){var o,s,r,l;i&&(r=a.g({}),t.x==e.x?(o="M"+(t.x*n-5)+" "+(t.y*n+5)+" L"+t.x*n+" "+t.y*n+" L"+(t.x*n+5)+" "+(t.y*n+5)+"z",s="M"+(e.x*n-5)+" "+(e.y*n-5)+" L"+e.x*n+" "+e.y*n+" L"+(e.x*n+5)+" "+(e.y*n-5)+"z",r.appendChild(a.line({x1:t.x*n-8,x2:t.x*n+8,y1:t.y*n-1,y2:t.y*n-1,stroke:"#07EDE1","stroke-width":1})),r.appendChild(a.line({x1:e.x*n-8,x2:e.x*n+8,y1:e.y*n+1,y2:e.y*n+1,stroke:"#07EDE1","stroke-width":1}))):(o="M"+(t.x*n+5)+" "+(t.y*n+5)+" L"+t.x*n+" "+t.y*n+" L"+(t.x*n+5)+" "+(t.y*n-5)+"z",s="M"+(e.x*n-5)+" "+(e.y*n-5)+" L"+e.x*n+" "+e.y*n+" L"+(e.x*n-5)+" "+(e.y*n+5)+"z",r.appendChild(a.line({x1:t.x*n-1,x2:t.x*n-1,y1:t.y*n-8,y2:t.y*n+8,stroke:"#07EDE1","stroke-width":1})),r.appendChild(a.line({x1:e.x*n+1,x2:e.x*n+1,y1:e.y*n-8,y2:e.y*n+8,stroke:"#07EDE1","stroke-width":1}))),r.appendChild(a.path({d:o,fill:"#07EDE1"})),l=a.line({x1:t.x*n,y1:t.y*n,x2:e.x*n,y2:e.y*n,stroke:"#07EDE1","stroke-width":.6,fill:"#07EDE1"}),r.appendChild(l),r.appendChild(a.path({d:s,fill:"#07EDE1"})),i.appendChild(r))},_removeGuidelines:function(t,e){null!=e&&t.removeChild(e)},update:function(t,e){e&&!e._isInit&&"new"!==t._status&&(t._status="update");var i=e._svg;"group"===t._type?this.updateGroup(t,i,e):t.segments?this.updateConnector(t,i,e):this.updateNode(t,i,e)},_updateGoupBackground:function(t,i,a){var n,o,s,r,l,d=t.offsetX-t.width*t.pivot.x,h=t.offsetY-t.height*t.pivot.y,g=t.rotateAngle,c=new e.datavisualization.Diagram.Point(d+t.width*t.pivot.x,h+t.height*t.pivot.y),u=t.fillColor,m=t.borderColor,p=e.datavisualization.Diagram.NodeConstraints;("bpmn"==t.type&&"group"!=t.shape||t.classifier&&"package"==t.classifier)&&(u="transparent",m="transparent"),e.datavisualization.Diagram.Util.canCrispEdges(t,a)&&(d=Math.floor(d)+.5,h=Math.floor(h)+.5),n={id:t.name+"_shape",rx:t.cornerRadius,ry:t.cornerRadius,width:Math.round(t.width<0?0:t.width),height:Math.round(t.height<0?0:t.height),fill:u,stroke:m,"stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray,transform:"rotate("+g+","+c.x+","+c.y+"),translate("+d+","+h+")"},"group"===t.shape&&t.constraints&p.Shadow&&(o=i.document.getElementById(t.name+"_shadow"),s=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),d=t.offsetX-t.width*t.pivot.x+s.x,h=t.offsetY-t.height*t.pivot.y+s.y,r={id:t.name+"_shadow",width:t.width,height:t.height,stroke:"none"!=t.borderColor||"transparent"!=t.borderColor?"lightgrey":"none",transform:"translate("+d+","+h+")",opacity:t.shadow.opacity,"stroke-dasharray":""},o&&e.datavisualization.Diagram.Util.attr(o,r)),t.gradient&&"bpmn"!=t.type&&(n.fill=this._renderGradient(t.name,t.gradient,i)),(l=i.getElementById(t.name+"_shape"))&&(n.class=l.getAttribute("class"),this._updateCssClass(t,n),e.datavisualization.Diagram.Util.attr(l,n))},updateGroup:function(i,a,n,o,s){var r,l,d,h,g,c,u,m=n._getChildren(i.children),p=i.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden",f="display:block;";for(i.visible||(f="display:none;"),e.datavisualization.Diagram.Util.canEnablePointerEvents(i,n)||(f="pointer-events:none"),a.g({id:i.name,visibility:p,style:f}),r=0,l=m.length;r<l;r++)(d=n.nameTable[m[r]])&&("group"===d._type?this.updateGroup(d,a,n,o,s):d.segments?(e.datavisualization.Diagram.Util.updateBridging(d,n),this.updateConnector(d,a,n,s)):(this.updateNode(d,a,n,o,s),d._isService&&((h=t.extend(!0,{},d)).name=d.name+"service",h.offsetX=d.offsetX+7,h.offsetY=d.offsetY+5,this.updateNode(h,a,n,o,s))));if(a.g({id:i.name,visibility:p,style:f}),this._updateGoupBackground(i,a,n),this._updateAssociatedConnector(i,a,n),this._updateLabels(i,a,n,s),this._updatePorts(i,n._adornerSvg&&!s?n._adornerSvg:a,n,s),i.isSwimlane&&(c=null,(g=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i))&&g.length>0))for(u=0;u<g.length;u++)(c=n.nameTable[n._getChild(g[u])])&&this._updatephase(c,n,i),this._updatePhaseStyle(c,{},n)},_removephases:function(t,i){var a,n,o;if(t.isSwimlane&&(a=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(i,t)))for(n=a.length;n>=0;n--)o=i.nameTable[i._getChild(a[n])],this._removePhase(i,o)},_removePhase:function(t,e){e&&t._views.forEach(function(i){var a=t._views[i],n=(a.svg||a._canvas).document.getElementById(e.name+"_phase_g");n&&n.parentNode.removeChild(n)})},_updatePhaseStyle:function(t,i,a){if(t&&i){var n=t.visible&&e.datavisualization.Diagram.Util.enableLayerOption(t,"visible",a)?"visible":"hidden";a._svg.g({id:t.name+"_phase_g",visibility:n}),i.id=t.name+"_phase",a._svg.g(i)}},_updatephase:function(t,e,i){var a,n;e._views.forEach(function(o){a=e._views[o],n=a.svg||a._canvas,a.context._updatephase1(t,e,n,i)})},_updatephase1:function(i,a,n,o){var s,r;if(n=n||a._svg,o){var l,d=0,h=0,g=null,c=[],u=e.datavisualization.Diagram.Util.bounds(o),m=a._getChildren(o.children);m.length>1&&(s=a.nameTable[m[0]]);var p=u.top+50,f=u.left+50;"vertical"==i.orientation?(d=u.x,h=u.y+s.height+i.offset,s&&(p+=s.height),h-.1<=u.bottom&&h-.1>=p&&(g="translate("+d+","+h+")"),c.push({x:0,y:0}),c.push({x:u.width,y:0}),l=this._convertToSVGPoints(c)):(d=u.x+i.offset,h=u.y,d-.1<=u.right&&d-.1>f&&(g="translate("+d+","+h+")"),s&&(c.push({x:0,y:s.height}),c.push({x:0,y:u.height})),l=this._convertToSVGPoints(c)),r={points:l,id:i.name+"_phase"},n.polyline(r),r={points:l,id:i.name+"_phase_hitTest"},n.polyline(r),g&&(r={id:i.name+"_phase_g",transform:g}),i.label&&a.model.labelRenderingMode!=e.datavisualization.Diagram.LabelRenderingMode.Svg&&this._updatePhaseLabel(i,i.label,a),n.g(r),n.getElementById(r.id)&&t("#"+r.id).insertAfter(t("#"+r.id)[0].parentNode.lastChild)}},_updatePhaseLabel:function(t,i,a){var n=a._svg,o=a._getPhaseBounds(t),s=n.getElementById(t.name+"_"+i.name);if(s){if(s.setAttribute("fill",i.fontColor),!i.text)return;s.textContent=i.text,o=e.datavisualization.Diagram.Util.bounds(t),this._wrapText(t,o,s,i,n),this._alignTextOnPhase(t,o,s,i,n)}},updateLabelStyle:function(i,a,n,o){var s,r,l;a.templateId?o&&o.model.labelRenderingMode!==e.datavisualization.Diagram.LabelRenderingMode.Svg&&(r=n.document.parentNode.getElementsByClassName("htmlLayer")[0],l=t(r).find("#"+i.name+"_"+a.name)[0],i&&l&&a&&(l.style.opacity=a.opacity,l.style.visibility=a.visible?"":"hidden")):o&&o.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg?(s={id:i.name+"_"+a.name+"_lblbg",fill:i._isHeader?"transparent":a.fillColor,stroke:i._isHeader?"transparent":a.borderColor,"stroke-width":a.borderWidth,"pointer-events":"none",visibility:a.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",o)?"visible":"hidden","fill-opacity":a.opacity,"stroke-opacity":a.opacity},n.rect(s),s={id:i.name+"_"+a.name,class:"ej-d-label","font-family":a.fontFamily,"font-size":a.fontSize,fill:a.fontColor,"text-decoration":a.textDecoration,"font-weight":a.bold?"bold":"normal","font-style":a.italic?"italic":"normal",visibility:a.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",o)?"visible":"hidden","fill-opacity":a.opacity,"stroke-opacity":a.opacity},l=n.text(s),s.class=l.getAttribute("class"),this._updateCssClass(a,s),e.datavisualization.Diagram.Util.attr(l,s)):(r=n.document.parentNode.getElementsByClassName("htmlLayer")[0],l=t(r).find("#"+i.name+"_"+a.name)[0],i&&l&&a&&!a.templateId&&(l.style.fontWeight=a.bold?"bold":"",l.style.fontStyle=a.italic?"italic":"",l.style.visibility=a.visible?"":"hidden",l.style.opacity=a.opacity,l.style.textDecoration=a.textDecoration,l.style.fontFamily=a.fontFamily,l.style.fontSize=a.fontSize+"px",l.style.color=a.fontColor,l.style.backgroundColor=a.fillColor,l.style.borderColor=a.borderColor,l.style.borderWidth=a.borderWidth+"px",l.style.borderStyle="solid",i._isHeader&&(l.style.borderWidth="0px",l.style.backgroundColor="transparent"),(s=this._updateCssClass(a,{class:l.className}))&&(l.className=s.class)))},updatePort:function(t,i,a,n){var o,s=a.getElementById(t.name+"_"+i.name);s&&(s&&s.parentNode&&s.parentNode.removeChild(s),o=a.getElementById(t.name+"_ej_ports"),s=e.datavisualization.Diagram.SvgContext._renderPort(t,i,n._adornerSvg,n),o.appendChild(s))},_updateNodeStyle:function(i,a){var n,o,s,r,l;i&&a&&((n={}).opacity=i.opacity,n.fill=i.fillColor,n.stroke=i.borderColor,n["stroke-width"]=i.borderWidth,n["stroke-dasharray"]=i.borderDashArray,i.gradient&&(n.fill=this._renderGradient(i.name,i.gradient,a)),i.borderGradient&&(n.stroke=this._renderGradient(i.name,i.borderGradient,a)),"node"==i._type&&(o="text"==i.type||"html"==i.type?"_backRect":"_shape","html"==i.type&&(s=a.document.parentNode.getElementsByClassName("htmlLayer")[0],(r=t(s).children("#"+i.name+"_parentdiv")[0].childNodes[0])&&(r.style.opacity=i.opacity)),(r=a.getElementById(i.name+o))&&(n.class=r.getAttribute("class"),this._updateCssClass(i,n),e.datavisualization.Diagram.Util.attr(r,n)),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&((l=a.document.getElementById(i.name+"_shadow"))&&e.datavisualization.Diagram.Util.attr(l,{fill:"none"!=i.fillColor||"transparent"!=i.fillColor?"lightgrey":"none"}))))},_updateConnectorStyle:function(t,i){var a,n;t&&i&&((a={}).opacity=t.opacity,a.stroke=t.lineColor,a["stroke-width"]=t.lineWidth,a["stroke-dasharray"]=t.lineDashArray,(n=i.getElementById(t.name+"_segments"))&&(a.class=n.getAttribute("class"),this._updateCssClass(t,a),e.datavisualization.Diagram.Util.attr(n,a)))},updateTargetDecoratorStyle:function(t,i){var a,n;i&&((a={}).stroke=t.targetDecorator.borderColor,a.fill=t.targetDecorator.fillColor,(n=i.getElementById(t.name+"_targetDecorator"))&&(a.class=n.getAttribute("class"),this._updateCssClass(t.targetDecorator,a),e.datavisualization.Diagram.Util.attr(n,a)))},updateSourceDecoratorStyle:function(t,i){var a,n;i&&((a={}).stroke=t.sourceDecorator.borderColor,a.fill=t.sourceDecorator.fillColor,(n=i.getElementById(t.name+"_sourceDecorator"))&&(a.class=n.getAttribute("class"),this._updateCssClass(t.sourceDecorator,a),e.datavisualization.Diagram.Util.attr(n,a)))},updateNode:function(t,e,i,a,n){if(e){if(i&&!i._isInit&&"new"!==t._status&&(t._status="update"),this._updateLabels(t,e,i,n),this._updateNode(t,e,i),t.outEdges.length&&this._updateIcons(t,e,i),t._scaled=!1,this._updatePorts(t,i._adornerSvg&&!n?i._adornerSvg:e,i,n),i._layoutInAction)return;this._updateAssociatedConnector(t,e,i)}},updateTextBlock:function(e,i,a,n){var o=a.document.parentNode.getElementsByClassName("htmlLayer")[0],s=t(o).children("#"+e.name+"_label")[0],r=t(s).children("#"+e.name+"_shape_lblbg")[0].childNodes[0];e&&r&&i&&(r.style.fontWeight=i.bold?"bold":"",r.style.fontStyle=i.italic?"italic":"",r.style.textDecoration=i.textDecoration,r.style.fontFamily=i.fontFamily,r.style.fontSize=i.fontSize+"px",r.style.color=i.fontColor),this._updateTextElement(e,a,n)},_updateAssociatedConnector:function(t,i,a){var n,o;if(!a._associatedConnectorsUpdate){if(t.inEdges&&t.inEdges.length>0)for(n=0,o=t.inEdges.length;n<o;n++)a.nameTable[t.inEdges[n]]&&(a.nameTable[t.inEdges[n]]&&e.datavisualization.Diagram.Util.canBridge(a.nameTable[t.inEdges[n]],a)&&(e.datavisualization.Diagram.Util.updateBridging(a.nameTable[t.inEdges[n]],a),a._updateConnectorBridging(a.nameTable[t.inEdges[n]])),a._disableSegmentChange||e.datavisualization.Diagram.DiagramContext.update(a.nameTable[t.inEdges[n]],a));if(t.outEdges&&t.outEdges.length>0)for(n=0,o=t.outEdges.length;n<o;n++)a.nameTable[t.outEdges[n]]&&(a.nameTable[t.outEdges[n]]&&e.datavisualization.Diagram.Util.canBridge(a.nameTable[t.outEdges[n]],a)&&(e.datavisualization.Diagram.Util.updateBridging(a.nameTable[t.outEdges[n]],a),a._updateConnectorBridging(a.nameTable[t.outEdges[n]])),a._disableSegmentChange||e.datavisualization.Diagram.DiagramContext.update(a.nameTable[t.outEdges[n]],a))}},_updateNode:function(i,a,n){var o,s,r,l=i.width?i.width:i._width,d=i.height?i.height:i._height,h=i.offsetX-l*i.pivot.x,g=i.offsetY-d*i.pivot.y,c=i.rotateAngle,u=e.datavisualization.Diagram.Point(i.offsetX,i.offsetY),m=i.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden";switch(e.datavisualization.Diagram.Util.canCrispEdges(i,n)&&(h=Math.floor(h)+.5,g=Math.floor(g)+.5),(_={id:i.name,transform:"rotate("+c+","+u.x+","+u.y+"),translate("+h+","+g+")",visibility:m}).style=e.datavisualization.Diagram.Util.canEnablePointerEvents(i,n)?"":"pointer-events:none",(o="none"!==i.flip?i.flip:i._flip)&&o!==e.datavisualization.Diagram.FlipDirection.None&&(this.renderflipElement(i,n)&&(_.transform="rotate("+c+","+u.x+","+u.y+")"+this.renderflipElement(i,n))),a.g(_),i._shape?i._shape:i.type){case"rectangle":a.rect({id:i.name+"_shape",width:l<0?0:l,height:d<0?0:d}),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"ellipse":a.ellipse({id:i.name+"_shape",rx:l/2,ry:d/2,cx:l/2,cy:d/2}),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&a.ellipse({id:i.name+"_shadow",rx:i.width/2,ry:i.height/2,cx:i.width/2,cy:i.height/2});break;case"image":this._updateBackgroundRect(i,a);var p=e.datavisualization.Diagram.Util._getImageAlignment(i.contentAlignment),f="none"==i.scale?"meet":i.scale,_={id:i.name+"_shape",preserveAspectRatio:"stretch"!=f&&"none"!=p?p+" "+f:"none"};"none"!=i.scale&&(_.width=l,_.height=d),a.image(_),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"path":i._preventStretch?s=i._absolutePath=i.pathData:i._scaled||!i._absolutePath?(s=e.datavisualization.Diagram.Geometry.updatePath(0,0,l,d,i.pathData,a,i._absoluteBounds),i._absolutePath=s,i._scaled=!1):s=i._absolutePath,a.path({id:i.name+"_shape",d:s}),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&a.path({id:i.name+"_shadow",d:s});break;case"polygon":this._updatePolygon(i,a);break;case"text":this._updateTextElement(i,a,n),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"html":this._updateHtmlElement(i,a,n),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"native":r=this._scaleNodeContent(i,t("#"+i.name+"_shape")[0]),_={id:i.name+"_shape"},i.width&&(_.width=i.width),i.height&&(_.height=i.height),r&&(_.transform="translate("+r.x+","+r.y+"),scale("+r.sx+","+r.sy+")"),a.g(_),i.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height})}},_updateHtmlElement:function(i,a,n){this._updateBackgroundRect(i,a);var o,s=i.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden",r=i.width?i.width:i._width,l=i.height?i.height:i._height,d=i.offsetX-r*i.pivot.x,h=i.offsetY-l*i.pivot.y,g=a.document.parentNode.getElementsByClassName("htmlLayer")[0],c=t(g).children("#"+i.name+"_parentdiv");c&&((o=t(c).children("#"+i.name+"_html")[0])&&(o.style.left=d+"px",o.style.top=h+"px",o.style.webkitTransform="rotate("+i.rotateAngle+"deg)",o.style.MozTransform="rotate("+i.rotateAngle+"deg)",o.style.OTransform="rotate("+i.rotateAngle+"deg)",o.style.msTransform="rotate("+i.rotateAngle+"deg)",o.style.transform="rotate("+i.rotateAngle+"deg)",o.style.opacity=i.opacity,o.style.visibility=s)),o&&(o.style.width=i.width.toString()+"px",o.style.height=i.height.toString()+"px")},_updatePolygon:function(t,i){e.datavisualization.Diagram.Geometry.updatePolygonPoints(t),i.polygon({id:t.name+"_shape",points:this._convertToSVGPoints(t.points)}),t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&i.polygon({id:t.name+"_shadow",points:this._convertToSVGPoints(t.points)})},_convertToSVGPoints:function(t){for(var e="",i=0,a=t.length;i<a;i++)e+=t[i].x+","+t[i].y+" ";return e.trim()},_renderTextElement:function(i,a,n,o){var s,r,l,d,h;if(o.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg){this._renderBackgroundRect(i,a,n);var g=i.textBlock,c=a.getElementById(i.name),u={id:i.name+"_shape_lblbg",class:"ej-d-label","font-family":g.fontFamily,"font-size":g.fontSize,fill:g.fontColor,"text-decoration":g.textDecoration,"font-weight":g.bold?"bold":"normal","font-style":g.italic?"italic":"normal"},m=a.text(u);c.appendChild(m),this._renderLabelSpanElement(m,i,g,a,o,!1)}else if(m=i.textBlock){s=a.document.parentNode.getElementsByClassName("htmlLayer")[0],this._renderBackgroundRect(i,a,n),r=document.createElement("div"),l=document.createElement("span"),e.datavisualization.Diagram.Util.attr(l,{id:i.name+"_label_lblbg",class:"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal; alignment-baseline:middle"}),m.bold&&(l.style.fontWeight="bold"),m.italic&&(l.style.fontStyle="italic"),l.style.textDecoration=m.textDecoration,l.style.fontFamily=m.fontFamily,l.style.fontSize=m.fontSize+"px",l.style.color=m.fontColor,l.textContent=m.text,_="display: inline-block; position: absolute; width: inherit; height: inherit; pointer-events: none; ",e.datavisualization.Diagram.Util.attr(r,{id:i.name+"_shape_lblbg",style:_}),r.appendChild(l),(d=t(s).children("#"+i.name+"_label")[0])&&s.removeChild(d),d=document.createElement("div");var p=i.width?i.width:i._width,f=i.height?i.height:i._height,_="width:"+p+"px; height:"+f+"px; left:"+(i.offsetX-p*i.pivot.x)+"px; top:"+(i.offsetY-f*i.pivot.y)+"px; display: block; position: absolute; pointer-events: none; ";e.datavisualization.Diagram.Util.attr(d,{id:i.name+"_label",class:"ej-d-node",style:_}),d.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",d.style.MozTransform="rotate("+i.rotateAngle+"deg) ",d.style.OTransform="rotate("+i.rotateAngle+"deg) ",d.style.msTransform="rotate("+i.rotateAngle+"deg)",d.style.transform="rotate("+i.rotateAngle+"deg) ",d.appendChild(r),s&&s.appendChild(d),h=e.datavisualization.Diagram.Util.bounds(i),this._alignTextOnLabel(i,h,l,r,i.textBlock)}},_updateTextElement:function(i,a,n){var o,s,r;if(n.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg){this._updateBackgroundRect(i,a);var l=i.textBlock,d=(a.getElementById(i.name),{id:i.name+"_shape_lblbg",class:"ej-d-label","font-family":l.fontFamily,"font-size":l.fontSize,fill:l.fontColor,"text-decoration":l.textDecoration,"font-weight":l.bold?"bold":"normal","font-style":l.italic?"italic":"normal"});a.text(d);this._updateLabelSpanElement(i,l,a,n,!1)}else if(this._updateBackgroundRect(i,a),o=a.document.parentNode.getElementsByClassName("htmlLayer")[0]){var h,g,c,u,m=this._findChild(o.childNodes,i),p=i.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden",f=e.datavisualization.Diagram.Util.bounds(i);m&&(h=f.width,g=f.height,c=i.offsetX-i.width*i.pivot.x,u=i.offsetY-i.height*i.pivot.y,m.style.width=h+"px",m.style.height=g+"px",m.style.left=c+"px",m.style.top=u+"px",m.style.visibility=p,m.style.webkitTransform="rotate("+i.rotateAngle+"deg)",m.style.MozTransform="rotate("+i.rotateAngle+"deg)",m.style.OTransform="rotate("+i.rotateAngle+"deg)",m.style.msTransform="rotate("+i.rotateAngle+"deg)",m.style.transform="rotate("+i.rotateAngle+"deg)"),(s=t(m).children("#"+i.name+"_shape_lblbg")[0])&&((r=s.childNodes[0]).textContent=i.textBlock.text,this._alignTextOnLabel(i,f,r,s,i.textBlock,n))}},_renderBackgroundRect:function(t,i,a){var n,o,s=this._fill(t,i),r=this._fillBorder(t,i),l={id:t.name+"_backRect",class:"backrect",x:0,y:0,width:t.width,height:t.height,fill:s,stroke:r,"stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray};this._addCssClass(t,l),t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow&&(n=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),o={id:t.name+"_shadow",class:"backrect",width:t.width,height:t.height,stroke:"lightgrey",fill:"none"!=s||"transparent"!=s?"lightgrey":"none",transform:"translate("+n.x+","+n.y+")",opacity:t.shadow.opacity},a.appendChild(i.rect(o))),a.appendChild(i.rect(l))},_updateBackgroundRect:function(t,e){var i=this._fill(t,e),a=this._fillBorder(t,e),n={id:t.name+"_backRect",x:0,y:0,width:t.width,height:t.height,fill:i,stroke:a,"stroke-width":t.borderWidth,opacity:t.opacity,"stroke-dasharray":t.borderDashArray,class:t.cssClass};e.rect(n)},_hideNode:function(t,e){var i={id:t.name,style:"pointer-events:none;"};e.rect(i)},_showNode:function(t,e){var i={id:t.name,style:"pointer-events:auto;"};e.rect(i)},_removePhasehelper:function(t){t._adornerSvg.getElementById("phase_helper")&&t._adornerSvg.removeChild(t._adornerSvg.getElementById("phase_helper"),t._adornerLayer)},_updatePhaseHelper:function(t,e,i){if(e){t._adornerSvg;var a,n=t._currZoom;i.width=i.width<0?1:i.width,i.height=i.height<0?1:i.height,a={id:"phase_helper",class:"helper","pointer-events":"none",width:i.width*n,height:i.height*n},t._adornerSvg.rect(a)}},_phasehelper:function(t,e,i){if(e){var a=t._adornerSvg,n=t._currZoom,o=i.x+i.width/2,s=i.y+i.height/2,r=a.rect({id:"phase_helper",class:"helper","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:i.width*n,height:i.height*n,fill:"transparent",stroke:"green",transform:"translate("+(o-i.width/2)*n+","+(s-i.height/2)*n+"),rotate(0,"+i.width/2*n+","+i.height/2*n+")"});t._adornerLayer.appendChild(r)}},_drawContainerHelper:function(t){var i,a,n,o,s,r,l=t.activeTool.helper,d=t._adornerSvg,h=t._currZoom;l&&(i=e.datavisualization.Diagram.Util.bounds(l,!0)),a=i.height,n=i.width,o=l.pivot?{x:i.width*l.pivot.x,y:i.height*l.pivot.y}:{x:n/2,y:a/2},s=l.rotateAngle?l.rotateAngle:0,r=d.rect({id:"helper",class:"helper","stroke-width":1,"stroke-dasharray":"3,3","pointer-events":"none",width:n*h,height:a*h,fill:"transparent",stroke:"red",transform:"translate("+i.x*h+","+i.y*h+"),rotate("+s+","+o.x*h+","+o.y*h+")"}),t._adornerLayer.appendChild(r)},_updateContainerHelper:function(t){var i,a,n,o,s,r,l=t.activeTool.helper,d=t._currZoom;l&&(a=e.datavisualization.Diagram.Util.bounds(l,!0)),n=a.height,o=a.width,s=l.pivot?{x:a.width*l.pivot.x,y:a.height*l.pivot.y}:{x:o/2,y:n/2},t._raiseOffsetPropertyChange(l,a.center.x,a.center.y,!0),t._raiseSizePropertyChange(l,a.width/l.width,a.height/l.height,!0),r=l.rotateAngle?l.rotateAngle:0,i={id:"helper",class:"helper",width:o*d,height:n*d,fill:"transparent",stroke:"red",transform:"translate("+a.x*d+","+a.y*d+"),rotate("+r+","+s.x*d+","+s.y*d+")"},t._adornerSvg.rect(i)},_removeContainerHelper:function(t,e,i){e.getElementById("helper")&&e.removeChild(e.getElementById("helper"),i)},setNodeShape:function(e,i,a,n){var o,s;a?(s=i.getElementById(a.name),o=t(s).find("#"+e.name)[0]):o=i.getElementById(e.name),o&&(t(o).empty(),this._renderNode(e,i,o,n))},setLine:function(e,i,a,n){var o,s;a?(s=i.getElementById(a.name),o=t(s).find("#"+e.name)[0]):o=i.getElementById(e.name),t(o).empty(),this.renderConnector(e,i,o,n)},addNodeLabel:function(t,e,i,a,n){this._renderLabels(t,i,n)},renderConnector:function(t,i,a,n){var o,s,r,l,d=t.visible&&e.datavisualization.Diagram.Util.enableLayerOption(t,"visible",n)?"visible":"hidden";if(s=e.datavisualization.Diagram.Util.canCrispEdges(t,n)?{id:t.name,class:"ej-d-connector",visibility:d,opacity:t.opacity,transform:"translate(0.5,0.5)"}:{id:t.name,class:"ej-d-connector",visibility:d,opacity:t.opacity},e.datavisualization.Diagram.Util.canEnablePointerEvents(t,n)||(s.style="pointer-events:none"),o=i.g(s),a?a.id!==o.id&&a.appendChild(o):i.appendChild(o),r=i.g({id:t.name+"segments"}),this._renderSegments(t,i,r,n),o.appendChild(r),this._renderLabels(t,i,n),this._renderDecorators(t,i,o,n),t.shape)for(e.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(t,n),l=0;l<t._inlineDecorators.length;l++)this.renderNode(t._inlineDecorators[l],i,o,void 0,n);return o},_renderSegments:function(t,i,a,n){t.visible&&(n&&n._browserInfo?n._browserInfo.name:e.browserInfo().name);var o,s,r=this._findPath(t,n),l={id:t.name+"_hitTest",class:"hitTest","stroke-width":t.lineHitPadding,d:r,stroke:"transparent",visibility:"hidden"};l["pointer-events"]=e.datavisualization.Diagram.Util.canEnablePointerEvents(t,n)&&t.visible?"stroke":"none",o=i.path(l),a.appendChild(o),l={id:t.name+"_segments",d:r,fill:"none",stroke:t.lineColor,"stroke-width":t.lineWidth,"stroke-dasharray":t.lineDashArray,opacity:t.opacity},this._addCssClass(t,l),o=i.path(l),a.appendChild(o),t.shape&&"umlactivity"==t.shape.type&&"exception"==t.shape.activityFlow&&(l={id:t.name+"_Activityflow",class:"umlactivityflow",fill:"none",stroke:t.lineColor,"pointer-events":"none","stroke-width":t.lineWidth,"stroke-dasharray":t.lineDashArray,opacity:t.opacity,d:t._temppath},s=i.path(l),this._addCssClass(t,l),a.appendChild(s))},_findPath:function(t,i){for(var a,n,o,s,r,l,d,h,g,c,u,m,p,f,_=0;_<t.segments.length;_++){if((a=t.segments[_])._bridges.length>0)for(n=0;n<a._bridges.length;n++)a._bridges[n]._rendered=!1;if(o=a.points,t.shape&&"sequence"==t.shape.flow&&"default"==t.shape.sequence&&0==_){s={x:a.points[0].x,y:a.points[0].y},r=e.datavisualization.Diagram.Geometry.distance(a.points[0],a.points[1]),r=Math.min(30,r/2);var v=e.datavisualization.Diagram.Geometry.findAngle(a.points[0],a.points[1]),y=e.datavisualization.Diagram.Geometry.transform({x:s.x,y:s.y},v,r),b=e.datavisualization.Diagram.Geometry.transform({x:y.x,y:y.y},v+45,-12),x=e.datavisualization.Diagram.Geometry.transform({x:b.x,y:b.y},v+45,24);l=e.datavisualization.Diagram.Util.canCrispEdges(t,i)?"M"+Math.floor(b.x)+" "+Math.floor(b.y)+" L"+Math.floor(x.x)+" "+Math.floor(x.y):"M"+b.x+" "+b.y+" L"+x.x+" "+x.y}if(t.shape&&"umlactivity"==t.shape.type&&"exception"==t.shape.activityFlow&&0==_){s={x:a.points[0].x,y:a.points[0].y},r=e.datavisualization.Diagram.Geometry.distance(a.points[0],a.points[1]),r=Math.max(30,r/2);v=e.datavisualization.Diagram.Geometry.findAngle(a.points[0],a.points[1]),y=e.datavisualization.Diagram.Geometry.transform({x:s.x,y:s.y},v,r),b=e.datavisualization.Diagram.Geometry.transform({x:y.x,y:y.y},v+145,9),x=e.datavisualization.Diagram.Geometry.transform({x:b.x,y:b.y},v+225,14);l=e.datavisualization.Diagram.Util.canCrispEdges(t,i)?"M"+Math.floor(b.x)+" "+Math.floor(b.y)+" L"+Math.floor(x.x)+" "+Math.floor(x.y):"M"+x.x+" "+b.y+"L"+x.x+" "+x.y+" L"+b.x+" "+b.y+" L"+b.x+" "+x.y}if(0==_&&(i&&t.sourceNode&&(d=i._findNode(t.sourceNode)),o=this._clipDecorators(t,a,!0,d),"bezier"==a.type&&t.sourceDecorator&&t.sourceDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(o[0]=e.datavisualization.Diagram.Util._adjustPoint(o[0],a._point1,!0,t.lineWidth)),f=e.datavisualization.Diagram.Util.canCrispEdges(t,i)?"M"+Math.floor(o[0].x)+" "+Math.floor(o[0].y):"M"+o[0].x+" "+o[0].y),_==t.segments.length-1&&(i&&t.targetNode&&(d=i._findNode(t.targetNode)),o=this._clipDecorators(t,a,!1,d)),"bezier"!=a.type)if(t.cornerRadius>0)for(g=0;g<o.length-1;g++)(h=e.datavisualization.Diagram.Geometry.distance(o[g],o[g+1]))>0&&(p=_<t.segments.length-1||g<o.length-2?h<2*t.cornerRadius?e.datavisualization.Diagram.Util._adjustPoint(o[g],o[g+1],!1,h/2):e.datavisualization.Diagram.Util._adjustPoint(o[g],o[g+1],!1,t.cornerRadius):o[g+1],(_>0||g>0)&&(h<2*t.cornerRadius?(m=e.datavisualization.Diagram.Util._adjustPoint(o[g],o[g+1],!0,h/2),(_<t.segments.length-1||g<o.length-2)&&(p=null)):m=e.datavisualization.Diagram.Util._adjustPoint(o[g],o[g+1],!0,t.cornerRadius)),m&&(f+=e.datavisualization.Diagram.Util.canCrispEdges(t,i)?" Q"+Math.floor(o[g].x)+" "+Math.floor(o[g].y)+" "+Math.floor(m.x)+" "+Math.floor(m.y):" Q"+o[g].x+" "+o[g].y+" "+m.x+" "+m.y),p&&(a._bridges.length>0&&(f=this._updateBridging(a,f,g),"orthogonal"===a.type&&(f=this._updateBridging(a,f,g+1))),f+=e.datavisualization.Diagram.Util.canCrispEdges(t,i)?" L"+Math.floor(p.x)+" "+Math.floor(p.y):" L"+p.x+" "+p.y));else for(g=0;g<o.length;g++)g>0&&(f=this._updateBridging(a,f,g)+(e.datavisualization.Diagram.Util.canCrispEdges(t,i)?" L"+Math.floor(o[g].x)+" "+Math.floor(o[g].y):" L"+o[g].x+" "+o[g].y));else c=a._endPoint,t.targetDecorator&&t.targetDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(c=e.datavisualization.Diagram.Util._adjustPoint(a._endPoint,a._point2,!0,t.lineWidth)),t.targetNode&&i&&(u=i._findNode(t.targetNode),"none"!=d.borderColor&&(c=e.datavisualization.Diagram.Util._adjustPoint(c,a._point2,!0,u.borderWidth/2))),f+=e.datavisualization.Diagram.Util.canCrispEdges(t,i)?" C"+Math.floor(a._point1.x)+" "+Math.floor(a._point1.y)+" "+Math.floor(a._point2.x)+" "+Math.floor(a._point2.y)+" "+Math.floor(c.x)+" "+Math.floor(c.y):" C"+a._point1.x+" "+a._point1.y+" "+a._point2.x+" "+a._point2.y+" "+c.x+" "+c.y}return t.shape&&"sequence"==t.shape.flow&&"default"==t.shape.sequence&&(f+=l),t.shape&&"exception"==t.shape.activityFlow&&"umlactivity"==t.shape.type&&(f=f,t._temppath=l),f},_updateBridging:function(t,e,i){var a,n,o=e;if(t._bridges.length>0)if("straight"===t.type)for(a=0;a<t._bridges.length;a++)(n=t._bridges[a])._rendered||(o+=" L"+n.startPoint.x+" "+n.startPoint.y,o+=n.path);else if("orthogonal"===t.type)for(a=0;a<t._bridges.length;a++)(n=t._bridges[a]).segmentPointIndex!==i||n._rendered||(o+=" L"+n.startPoint.x+" "+n.startPoint.y,o+=n.path,n._rendered=!0);return o},_refreshSegments:function(t,e,i){this._updateConnector(t,e,i),this._updateDecorators(t,e,i)},_refreshOnlySegments:function(t,e,i){var a=this._findPath(t,i),n=e.document.getElementById(t.name+"_segments");n&&(n.setAttribute("d",a),(n=e.document.getElementById(t.name+"_hitTest")).setAttribute("d",a))},_clipDecorators:function(t,i,a,n){var o,s,r,l,d,h,g=[];if(!a&&t.targetDecorator&&t.targetDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None){for(h=0;h<i.points.length;h++)g[h]=i.points[h];o=g[g.length-1],s=g[g.length-2],r=0==(r=e.datavisualization.Diagram.Geometry.distance(o,s))?1:r,l=t.lineWidth,(d=e.datavisualization.Diagram.Point()).x=o.x+l*(s.x-o.x)/r,d.y=o.y+l*(s.y-o.y)/r,n&&"none"!=n.borderColor&&(d=e.datavisualization.Diagram.Util._adjustPoint(d,s,!0,n.borderWidth/2)),g[g.length-1]=d}else if(a&&t.sourceDecorator&&t.sourceDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None){for(h=0;h<i.points.length;h++)g[h]=i.points[h];o=g[0],s=g[1],r=0==(r=e.datavisualization.Diagram.Geometry.distance(o,s))?1:r,l=t.lineWidth,(d=e.datavisualization.Diagram.Point()).x=o.x+l*(s.x-o.x)/r,d.y=o.y+l*(s.y-o.y)/r,"bezier"==i.type&&(d.x=o.x+(i._point1.x-o.x)/r,d.y=o.y+(i._point1.y-o.y)/r),n&&"none"!=n.borderColor&&(d=e.datavisualization.Diagram.Util._adjustPoint(d,"bezier"!=i.type?s:i._point1,!0,n.borderWidth/2)),g[0]=d}else if(a){for(h=0;h<i.points.length;h++)g[h]=i.points[h];n&&"none"!=n.borderColor&&(g[0]=e.datavisualization.Diagram.Util._adjustPoint(g[0],g[1],!0,n.borderWidth/2))}else{for(h=0;h<i.points.length;h++)g[h]=i.points[h];n&&"none"!=n.borderColor&&(g[g.length-1]=e.datavisualization.Diagram.Util._adjustPoint(g[g.length-1],g[g.length-2],!0,n.borderWidth/2))}return g},_updateConnector:function(t,i,a){var n,o;a&&!a._isInit&&"new"!==t._status&&(t._status="update"),n=this._findPath(t,a),i.path({id:t.name+"_segments",d:n}),(o={id:t.name+"_hitTest",d:n,"stroke-width":t.lineHitPadding})["pointer-events"]=e.datavisualization.Diagram.Util.canEnablePointerEvents(t,a)?t.isPhase||"move"===a.activeTool.name&&a.activeTool.inAction||a._selectedSymbol&&a.selectionList[0]&&a.selectionList[0].name==t.name?"none":t.visible?"stroke":"none":"none",i.path(o),t.shape&&"umlactivity"==t.shape.type&&"exception"==t.shape.activityFlow&&(o={id:t.name+"_Activityflow",class:"umlactivityflow",fill:"none",stroke:t.lineColor,"pointer-events":"none","stroke-width":t.lineWidth,"stroke-dasharray":t.lineDashArray,opacity:t.opacity,d:t._temppath},i.path(o))},updateConnector:function(t,i,a,n){var o,s,r;if(i&&(o=t.visible&&e.datavisualization.Diagram.Util.enableLayerOption(t,"visible",a)?"visible":"hidden",(s=e.datavisualization.Diagram.Util.canCrispEdges(t,a)?{id:t.name,visibility:o,opacity:t.opacity,transform:"translate(0.5,0.5)"}:{id:t.name,visibility:o,opacity:t.opacity}).style=e.datavisualization.Diagram.Util.canEnablePointerEvents(t,a)?"":"pointer-events:none",a._animatingLayout||i.g(s),this._updateConnector(t,i,a),this._updateLabels(t,i,a,n),this._updateDecorators(t,i,a),t.shape))for(e.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(t,a),r=0;r<t._inlineDecorators.length;r++)this.updateNode(t._inlineDecorators[r],i,a)},renderDecorators:function(t,e,i){var a=e.getElementById(t.name);this._renderDecorators(t,e,a,i)},clearDecorators:function(t,e,i){this._updateConnector(t,e,i);var a=e.getElementById(t.name),n=e.getElementById(t.name+"_targetDecorator");n&&e.removeChild(n,a),(n=e.getElementById(t.name+"_sourceDecorator"))&&e.removeChild(n,a)},_renderDecorators:function(t,i,a,n){var o,s,r,l,d;t.targetDecorator&&t.targetDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(o=(l=t.segments[t.segments.length-1]).points[l.points.length-2],s=t.targetPoint,"bezier"==l.type&&(o=l._point2),t.targetNode&&n&&((r=n._findNode(t.targetNode))&&"none"!=r.borderColor&&(s=e.datavisualization.Diagram.Util._adjustPoint(s,o,!0,r.borderWidth/2))),this._renderDecorator(t.name+"_targetDecorator",s,o,t,t.targetDecorator,i,a)),t.sourceDecorator&&t.sourceDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(l=t.segments[0],o=t.sourcePoint,s=l.points[1],"bezier"==l.type&&(s=l._point1),t.sourceNode&&n&&((d=n._findNode(t.sourceNode))&&"none"!=d.borderColor&&(o=e.datavisualization.Diagram.Util._adjustPoint(o,s,!0,d.borderWidth/2))),this._renderDecorator(t.name+"_sourceDecorator",o,s,t,t.sourceDecorator,i,a))},_renderIcons:function(t,e){var i,a,n=t.expandIcon,o=t.collapseIcon;if("none"!=n.shape||"none"!=o.shape){var s,r,l,d,h,g=t.width?t.width:t._width||0,c=t.height?t.height:t._height||0,u=t.name,m=t.visible?"visible":"hidden";d=t.offsetX-g*t.pivot.x,h=t.offsetY-c*t.pivot.y,r=t.offsetX,l=t.offsetY,i={id:u,transform:"rotate("+t.rotateAngle+","+r+","+l+"),translate("+d+","+h+")",visibility:m},s=(a=e._adornerSvg).g(i),(a.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||e._expander).appendChild(s),void 0!=n&&t.isExpanded&&this._renderIcon(t,a,n,s,e),void 0==o||t.isExpanded||this._renderIcon(t,a,o,s,e)}},_renderIcon:function(t,i,a,n,o){var s,r,l,d,h,g,c;if(void 0!=a){if(r=e.datavisualization.Diagram.Util._getIconPosition(a,e.datavisualization.Diagram.Util.bounds(t,!0),!0),"path"!=a.shape)this._renderExpanderTemplate(t,i,a,n,o,r);else if("path"==a.shape)return(n=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.name+"_expander"),n.setAttribute("class","ej-d-icon-template"),l=e.datavisualization.Diagram.Geometry.updatePath(r.x-a.width/2,r.y-a.height/2,a.width,a.height,a.pathData,i),d=t.visible?"visible":"hidden",a._absolutePath=l,a.margin.left&&a.margin.right&&(a.width-=(a.margin.left||0)+(a.margin.right||0)),a.margin.top&&a.margin.bottom&&(a.height-=(a.margin.top||0)+(a.margin.bottom||0)),s={id:t.name+"_pathexpander",x:r.x,y:r.y,width:a.width,height:a.height,fill:a.borderColor,stroke:a.borderColor,"stroke-width":a.borderWidth,visibility:d,d:l},this._addCssClass(n,s),h=i.path(s),n.appendChild(h),n;return"image"==a.shape&&((g=new Image).src=a.source,(c=i.image(s)).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g.src),n.appendChild(c)),c}},_renderExpanderTemplate:function(t,e,i,a,n,o,s){var r,l,d,h=this.construct_template_iconshape(i,t.isExpanded,n);if("undefined"!=h){s&&a.removeChild(e.document.getElementById(t.name+"_expander")),(r=document.createElement("div")).innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+h+"</g></svg>",document.body.appendChild(r),(d=(l=document.getElementById("tempNative")).cloneNode(!0)).id=t.name+"_expander";var g=l.getBBox(),c=i.width,u=i.height,m=g.width?c/g.width:1,p=g.height?u/g.height:1;if(r.parentNode.removeChild(r),a.appendChild(d),Math.min(m,p),t.visible?"visible":"hidden",i.horizontalAlignment||i.verticalAlignment){i.offset.x,i.offset.y;switch(i.horizontalAlignment){case"left":o.x+=0;break;case"center":o.x-=i.width/2;break;case"right":o.x-=i.width}switch(i.verticalAlignment){case"top":o.y+=0;break;case"center":o.y-=i.height/2;break;case"bottom":o.y-=i.height}var f=o.x-g.x*m,_=o.y-g.y*p,v={id:t.name+"_expander",class:"ej-d-icon-template",transform:"translate("+f+","+_+"),scale("+m+","+p+")",x:o.x,y:o.y,width:i.width,height:i.height,fill:i.borderColor,stroke:i.borderColor,"stroke-width":i.borderWidth};e.g(v)}}},construct_template_iconshape:function(t,e,i){var a;if(t.shape){switch(t.shape){case"arrowup":a='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M8.7,7.2L8.9,7h2.2l0.2,0.2l0,0l4.8,4.8h-2.5L10,8.4L6.4,12H3.9L8.7,7.2L8.7,7.2z"/></path></rect>';break;case"arrowdown":a='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M9,12.2l0.1,0.1h1.7l0.1-0.1l0,0l3.8-3.8h-2L10,11.2L7.2,8.4h-2L9,12.2L9,12.2z"/></path></rect>';break;case"plus":a='<rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/></line><line style=" fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="10" y1="6.1" x2="10" y2="13.9"/></line></rect>';break;case"minus":a=' <rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/></line></rect>';break;case"template":a=i._renderEjTemplate("#"+t.templateId,t)}return a}},_updateIcons:function(t,e,i){var a,n=t.expandIcon,o=t.collapseIcon;if("none"!=n.shape||"none"!=o.shape){var s,r,l,d,h,g=t.width?t.width:t._width||0,c=t.height?t.height:t._height||0,u=t.name,m=t.visible?"visible":"hidden";d=t.offsetX-g*t.pivot.x,h=t.offsetY-c*t.pivot.y,r=t.offsetX,l=t.offsetY,a={id:u,transform:"rotate("+t.rotateAngle+","+r+","+l+"),translate("+d+","+h+")",visibility:m},s=(e=i._adornerSvg).g(a),e.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||i._expander,void 0!=n&&t.isExpanded&&this._updateIcon(t,i._adornerSvg,s,n,i),void 0==o||t.isExpanded||this._updateIcon(t,i._adornerSvg,s,o,i)}},_updateIcon:function(t,i,a,n,o){var s,r,l,d,h,g;void 0!=n&&(t._scaled||t._updateExpander)&&(r=e.datavisualization.Diagram.Util._getIconPosition(n,e.datavisualization.Diagram.Util.bounds(t,!0),!0),"path"!=n.shape?(t._scaled||t._updateExpander)&&this._renderExpanderTemplate(t,i,n,a,o,r,!0):"path"==n.shape&&(l=e.datavisualization.Diagram.Geometry.updatePath(r.x-n.width/2,r.y-n.height/2,n.width,n.height,n.pathData,i),d=t.visible?"visible":"hidden",n._absolutePath=l,n.margin.left&&n.margin.right&&(n.width-=(n.margin.left||0)+(n.margin.right||0)),n.margin.top&&n.margin.bottom&&(n.height-=(n.margin.top||0)+(n.margin.bottom||0)),s={id:t.name+"_pathexpander",x:r.x,y:r.y,width:n.width,height:n.height,fill:n.borderColor,stroke:n.borderColor,"stroke-width":n.borderWidth,visibility:d,d:l},i.path(s)),"image"==n.shape&&((h=new Image).src=n.source,(g=i.image(s)).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),a.appendChild(g)),t._updateExpander=!1)},_renderDecorator:function(t,i,a,n,o,s,r){var l,d,h,g,c,u,m=e.datavisualization.Diagram.Size(o.width,o.height);switch(o.shape){case"arrow":d={id:t,class:"decorator",d:h=this._constructArrow(i,m),fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),g=1.1*o.borderWidth;break;case"openarrow":d={id:t,class:"decorator",d:h=this._constructArrow(i,m,!0),fill:"transparent",stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),g=1.1*o.borderWidth;break;case"circle":d={id:t,class:"decorator",rx:m.width/2,ry:m.height/2,cx:i.x+m.width/2,cy:i.y,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.ellipse(d),g=.5*o.borderWidth;break;case"diamond":h=this._constructDiamond(i,m,s),d={id:t,class:"decorator",x:i.x,y:i.y,width:m.width,height:m.height,d:h,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),g=.7*o.borderWidth;break;case"path":h=e.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-m.height/2,m.width,m.height,o.pathData,s),o._absolutePath=h,d={id:t,class:"decorator",x:i.x,y:i.y,width:m.width,height:m.height,d:h,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),g=.5*o.borderWidth}l&&("none"!=o.borderColor?(c=e.datavisualization.Diagram.Geometry.findAngle(i,a),u=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},c,g),l.setAttribute("transform","translate("+u.x+","+u.y+"),rotate("+c+" "+i.x+" "+i.y+")")):l.setAttribute("transform","rotate("+e.datavisualization.Diagram.Geometry.findAngle(i,a)+" "+i.x+" "+i.y+")"),r.appendChild(l))},_updateDecorators:function(t,i,a){var n,o,s,r,l,d;t.targetDecorator&&t.targetDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(n=(l=(r=t.segments[t.segments.length-1]).points)[l.length-2],o=t.targetPoint,"bezier"==r.type&&(n=r._point2),t.targetNode&&a&&((s=a._findNode(t.targetNode))&&"none"!=s.borderColor&&(o=e.datavisualization.Diagram.Util._adjustPoint(t.targetPoint,n,!0,s.borderWidth/2))),this._updateDecorator(t.name+"_targetDecorator",o,n,t,t.targetDecorator,i)),t.sourceDecorator&&t.sourceDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(l=(r=t.segments[0]).points,n=t.sourcePoint,o=l[1],"bezier"==r.type&&(o=r._point1),t.sourceNode&&a&&("none"!=(d=a._findNode(t.sourceNode)).borderColor&&(n=e.datavisualization.Diagram.Util._adjustPoint(t.sourcePoint,o,!0,d.borderWidth/2))),this._updateDecorator(t.name+"_sourceDecorator",n,o,t,t.sourceDecorator,i))},_updateDecorator:function(t,i,a,n,o,s){var r,l,d,h,g,c,u=e.datavisualization.Diagram.Size(o.width,o.height);switch(o.shape){case"arrow":l={id:t,d:d=this._constructArrow(i,u)},r=s.path(l),h=1.1*o.borderWidth;break;case"openarrow":l={id:t,d:d=this._constructArrow(i,u,!0),fill:"transparent",stroke:o.borderColor,"stroke-width":o.borderWidth},r=s.path(l),h=1.1*o.borderWidth;break;case"circle":l={id:t,rx:u.width/2,ry:u.height/2,cx:i.x+u.width/2,cy:i.y,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},r=s.ellipse(l),h=.5*o.borderWidth;break;case"diamond":d=this._constructDiamond(i,u,s),l={id:t,x:i.x,y:i.y,width:u.width,height:u.height,d:d,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},r=s.path(l),h=.7*o.borderWidth;break;case"path":d=e.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-u.height/2,u.width,u.height,o.pathData,s),o._absolutePath=d,l={id:t,d:d},r=s.path(l),h=.5*o.borderWidth}r&&("none"!=o.borderColor?(g=e.datavisualization.Diagram.Geometry.findAngle(i,a),c=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},g,h),r.setAttribute("transform","translate("+c.x+","+c.y+"),rotate("+g+" "+i.x+" "+i.y+")")):r.setAttribute("transform","rotate("+e.datavisualization.Diagram.Geometry.findAngle(i,a)+" "+i.x+" "+i.y+")"))},_constructArrow:function(t,i,a){var n=new e.datavisualization.Diagram.Path;return n.moveTo(t.x+i.width,t.y+i.height/2),n.lineTo(t.x,t.y),n.lineTo(t.x+i.width,t.y-i.height/2),a||n.close(),n.toString()},_constructDiamond:function(t,i){var a=new e.datavisualization.Diagram.Path;return a.moveTo(t.x+i.width,t.y),a.lineTo(t.x+i.width/2,t.y+i.height/2),a.lineTo(t.x,t.y),a.lineTo(t.x+i.width/2,t.y-i.height/2),a.lineTo(t.x+i.width,t.y),a.toString()},_addLabel:function(i,a,n,o,s){var r,l,d,h,g,c,u,m,p,f,_,v;if(o&&o.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg){if(v=this._renderSVGLabel(i,a,n,o),void 0!=s&&s!=i.labels.length-1&&!(s>i.labels.length-1)&&(r=i.labels[s])){var y=o._svg.document.getElementById(i.name+"_"+r.name+"_lblbg"),b=o._svg.document.getElementById(i.name+"_"+a.name+"_lblbg"),x=o._svg.document.getElementById(i.name+"_"+a.name);y&&b&&y.parentNode.insertBefore(b,y),x&&x&&y.parentNode.insertBefore(x,y)}}else l=(c=e.datavisualization.Diagram.Util.bounds(i)).width,d=c.height,h=c.x,g=c.y,m=n.document.parentNode.getElementsByClassName("htmlLayer")[0],u=t(m).children("#"+i.name+"_label")[0],p="node"===i._type?"ej-d-node":"group"===i._type?"ej-d-group":"ej-d-connector",u||(u=document.createElement("div"),f="width:"+l+"px; height:"+d+"px; left:"+h+"px; top:"+g+"px; display: block; position: absolute; pointer-events: none; ; padding: inherit;",_="node"===i._type?"ej-d-node":"group"===i._type?"ej-d-group":"ej-d-connector",i._isClassifier&&(_+=" ej-d-classifier"),e.datavisualization.Diagram.Util.attr(u,{id:i.name,class:_,style:f}),i.rotateAngle&&(u.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",u.style.MozTransform="rotate("+i.rotateAngle+"deg) ",u.style.OTransform="rotate("+i.rotateAngle+"deg) ",u.style.msTransform="rotate("+i.rotateAngle+"deg)",u.style.transform="rotate("+i.rotateAngle+"deg) ",u.style["transform-origin"]=100*i.pivot.x+"% "+100*i.pivot.y+"%"),m&&m.appendChild(u)),e.datavisualization.Diagram.Util.attr(u,{id:i.name+"_label",class:p}),v=this._renderLabel(i,c,a,u,m,n,l,d,o),void 0!=s&&u.insertBefore(v,u.childNodes[s])},_getCharBoundsValues:function(t,e,i,a,n){var o,s,r,l,d,h,g,c={id:a.name+"_"+e.name+"temp",class:"ej-d-label","font-family":e.fontFamily,"font-size":e.fontSize},u=i.text(c);if(i.document.appendChild(u),(o=i.tspan({id:a.name+"_"+e.name+"temp_snap"})).textContent=t,u.appendChild(o),s=u.childNodes[0].getComputedTextLength(),c["font-style"]="normal",c["font-weight"]="bold",i.text(c),r=u.childNodes[0].getComputedTextLength(),c["font-style"]="italic",c["font-weight"]="normal",i.text(c),l=u.childNodes[0].getComputedTextLength(),c["font-style"]="italic",c["font-weight"]="bold",i.text(c),d=u.childNodes[0].getComputedTextLength(),i.document.removeChild(u)," "==t){e.text&&(h=e.text[n-1]&&"\n"!=e.text[n-1]?e.text[n-1]:"W",g=e.text[n+1]&&"\n"!=e.text[n+1]?e.text[n+1]:"W");var m=this._getCharBoundsValues(h,e,i,a,n),p=this._getCharBoundsValues(g,e,i,a,n),f=this._getCharBoundsValues(h+" "+g,e,i,a,n);return{normal:f.normal-(m.normal+p.normal),bold:f.bold-(m.bold+p.bold),italic:f.italic-(m.italic+p.italic),boldItalic:f.boldItalic-(m.boldItalic+p.boldItalic)}}return{normal:s,bold:r,italic:l,boldItalic:d}},_updateHashTableValues:function(t,e,i,a,n){for(var o=0;o<t.length;o++)e[t[o]]||(e["\n"==t[o]?"new_space_line":t[o]]=this._getCharBoundsValues(t[o],i,n,a,o))},_updateHashTable:function(t,i,a,n,o){var s,r,l;if(t&&a&&n)if(t.wrapping==e.datavisualization.Diagram.TextWrapping.Wrap||o)(""!=t.text||""!=t.hyperlink)&&(s=t.text?t.text:t.hyperlink,(d=n._labelHashTable[t.fontFamily+"_"+t.fontSize])||(d=n._labelHashTable[t.fontFamily+"_"+t.fontSize]={}),this._updateHashTableValues(s,d,t,i,a,n));else if(t.wrapping==e.datavisualization.Diagram.TextWrapping.WrapWithOverflow&&(""!=t.text||""!=t.hyperlink)){for(r=(s=t.text?t.text:t.hyperlink).split("\n"),l=0;l<r.length;l++){var d,h=r[l].split(" ");(d=n._labelHashTable[t.fontFamily+"_"+t.fontSize])||(d=n._labelHashTable[t.fontFamily+"_"+t.fontSize]={}),this._updateHashTableValues(h,d,t,i,a,n),this._updateHashTableValues([" "],d,t,i,a,n)}d.new_space_line=this._getCharBoundsValues(" ",t,a,i)}},_getSuitableLabelSize:function(t,e,i){if(""!=(e="\n"==e||"."===e?"new_space_line":e)){var a=i._labelHashTable[t.fontFamily+"_"+t.fontSize][e];return t.bold&&t.italic?a.boldItalic:t.bold?a.bold:t.italic?a.italic:a.normal}},_postionConnectorTextElement:function(t,i,a,n,o){var s,r,l,d=0,h=0,g=e.datavisualization.Diagram.Util.bounds(t),c=a.getBBox(),u=(this._getCharBoundsValues("W",i,n,t),i.horizontalAlignment),m=i.verticalAlignment;if(t.segments&&"segmentpath"==i.relativeMode){switch(d=(r=(s=this._getConnectorHandlePosition(i,t,1,o)).position).x,h=r.y,m=(l=e.datavisualization.Diagram.Util._alignLabelOnSegments(t,i,o,s)).vAlign,!0,u=l.hAlign){case"left":d=0+i.margin.left;break;case"right":d=-c.width-i.margin.right;break;case"center":d=d+-c.width/2+(i.margin.left-i.margin.right);break;case"stretch":d=c.width/2}switch(m){case"top":h=0+i.margin.top;break;case"bottom":h=-c.height-i.margin.bottom;break;case"center":h=h+-c.height/2+(i.margin.top-i.margin.bottom);break;case"stretch":h=c.height/2}}else{switch(u){case"left":d=c.width/2;break;case"right":d=-c.width/2}switch(m){case"top":h=c.height/2;break;case"bottom":h=-c.height/2}t.segments&&(d+=g.left,h+=g.top),d+=g.width*i.offset.x,h=h+g.height*i.offset.y-2}"segmentpath"==!i.relativeMode&&(d*=i.offset.x?i.offset.x/.5:0,h=h*(i.offset.y?i.offset.y/.5:0)+i.fontSize,d+=g.center.x-g.width/2,h+=g.center.y-g.height/2),this._updateLabelBackground(d,h+i.fontSize,c,t,i,a,n,o),t.segments&&t.segments.length,a.setAttribute("transform","translate("+d+","+(h-2)+") rotate("+i.rotateAngle+" "+(c.x+c.width/2)+" "+(c.y+c.height/2)+")")},_postionNodeTextElement:function(t,i,a,n,o){var s=0,r=0,l=e.datavisualization.Diagram.Util.bounds(t),d=a.getBBox(),h=e.datavisualization.Diagram.Rectangle(d.x,d.y,d.width,d.height);switch(h.height>=2&&(h.height-=2),this._getCharBoundsValues("W",i,n,t),i.horizontalAlignment){case"left":s=0+i.margin.left;break;case"right":s=-h.width-i.margin.right;break;case"center":s=-h.width/2+(i.margin.left-i.margin.right);break;case"stretch":s=-h.width/2}switch(i.verticalAlignment){case"top":r=0+i.margin.top;break;case"bottom":r=-h.height-i.margin.bottom;break;case"center":r=-h.height/2+(i.margin.top-i.margin.bottom);break;case"stretch":r=-h.height/2}if(s+=l.width*i.offset.x,r=r+l.height*i.offset.y-2,this._updateLabelBackground(s,r+i.fontSize,h,t,i,a,n,o),t.segments&&t.segments.length>0)a.setAttribute("transform","translate("+(l.center.x-h.width/2)+","+(l.center.y-h.height/2+i.fontSize)+")");else if("group"===t.type||t.children&&t.children.length>0){var g=e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),c=(t.width?t.width:t._width,t.height?t.height:t._height,s=s+(t.offsetX-t.width/2),r=r+(t.offsetY-t.height/2),t.rotateAngle+i.rotateAngle);a.setAttribute("transform","rotate("+c+","+g.x+","+g.y+"),translate("+s+","+r+")")}else a.setAttribute("transform","translate("+s+","+r+") rotate("+i.rotateAngle+" "+(h.x+h.width/2)+" "+(h.y+h.height/2)+")")},_postionSpanElement:function(t,e,i,a,n){for(var o,s,r=0;r<i.childNodes.length;r++)(o=i.childNodes[r])&&(s=this._getSVGTextAlignPosition(o,t,e,i,a,n),o.setAttribute("x",s.x))},_getSVGTextAlignPosition:function(t,e,i,a){var n,o,s=0;if(t&&i)switch(n=(n=t.getAttribute("totalWidth"))?Number(n):t.getComputedTextLength(),o=a.getBBox(),i.textAlign){case"left":s=o.x;break;case"right":s=o.x+o.width-n;break;case"center":case"justify":s=o.x+o.width/2-n/2}return{x:s,y:0}},_updateTspanElement:function(t,e,i,a,n){this._postionSpanElement(t,e,i,a,n),t.segments&&t.segments.length>0?this._postionConnectorTextElement(t,e,i,a,n):this._postionNodeTextElement(t,e,i,a,n)},_updateLabelBackground:function(i,a,n,o,s,r,l){var d,h="stretch"===s.verticalAlignment?o.height-2:n.height,g="stretch"===s.horizontalAlignment?o.width-2:n.width;if(i="stretch"===s.horizontalAlignment?1:i,a="stretch"===s.verticalAlignment?1:a-s.fontSize,t("#"+o.name+"_"+s.name+"_lblbg")[0],d={id:o.name+"_"+s.name+"_lblbg",height:h,width:g,x:i,y:a,transform:"rotate("+s.rotateAngle+" "+(i+g/2)+" "+(a+h/2)+")"},"group"===o.type||o.children&&o.children.length>0){var c=e.datavisualization.Diagram.Point(o.offsetX,o.offsetY),u=(i=i+(o.offsetX-o.width/2),a=a+(o.offsetY-o.height/2),o.rotateAngle+s.rotateAngle);d.x=0,d.y=0,d.transform="rotate("+u+","+c.x+","+c.y+"),translate("+i+","+a+")"}l.rect(d)},_renderLabelSpanElement:function(t,i,a,n,o,s){var r,l;a.templateId||(this._updateHashTable(a,i,n,o),t&&t.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),a.wrapping==e.datavisualization.Diagram.TextWrapping.Wrap?this._svgTextWrapping(t,i,a,n,o,s):a.wrapping==e.datavisualization.Diagram.TextWrapping.WrapWithOverflow?this._svgWordWrapping(t,i,a,n,o,s):(r=n.tspan(),t.appendChild(r),r.setAttribute("x","0px"),r.setAttribute("y","0px"),a.textOverflow?(l=this._getLabelSize(a,i,o),this._updateOverFlowTspan(t,i,a,n,o,s,a.text,r,l)):r.textContent=a.text),this._updateTspanElement(i,a,t,n,o))},_getLabelSize:function(t,i){var a=e.datavisualization.Diagram.Util.bounds(i);return Math.max(t.width,a.width)},_svgTextWrapping:function(t,i,a,n,o){e.datavisualization.Diagram.Util.bounds(i);var s,r,l,d,h=a.fontSize+2,g=n.tspan();for(g.setAttribute("x","0px"),t.childNodes&&0===t.childNodes.length?g.setAttribute("dy",h-2):g.setAttribute("dy",h),t.appendChild(g),s=0,r=a.text?a.text:a.hyperlink,g.textContent+=r[0],l=this._getLabelSize(a,i,o),s+=this._getSuitableLabelSize(a,r[0],o)*(a.fontSize/a.fontSize),d=1;d<r.length;d++)if("\n"==r[d]||s+this._getSuitableLabelSize(a,r[d],o)*(a.fontSize/a.fontSize)>=l){if(a.textOverflow)return"ellipsis"==a.overflowType&&(g.textContent=g.textContent.substr(0,g.textContent.length-3),g.textContent+="..."),!1;(textSeries.length-1>j||s>0)&&(g.setAttribute("totalWidth",s),g=n.tspan(),t.appendChild(g),t.getBBox(),g.setAttribute("x","0px"),g.setAttribute("y",h)),"\n"!=r[d]?(g.textContent+=r[d],s=this._getSuitableLabelSize(a,r[d],o)*(a.fontSize/a.fontSize)):s=0}else g.textContent+=r[d],s+=this._getSuitableLabelSize(a,r[d],o)*(a.fontSize/a.fontSize)},_updateOverFlowTspan:function(t,e,i,a,n,o,s,r,l){var d,h=s;this._updateHashTable(i,e,a,n,!0);var g=0,c="",u="",m=0;for("ellipsis"==i.overflowType&&(m=this._getSuitableLabelSize(i,".",n)*(i.fontSize/12)*3),d=0;d<h.length&&(c=h[d],!((g+=this._getSuitableLabelSize(i,c,n)*(i.fontSize/12))+m>=l));d++)u+=c;r.textContent=u+("ellipsis"==i.overflowType?"...":"")},_svgWordWrapping:function(t,i,a,n,o,s){var r,l,d,h,g,c,u,m,p,f,_,v,y=0;for(r=e.datavisualization.Diagram.Util.bounds(i),l=a.text?a.text.split("\n"):a.hyperlink.split("\n"),d=a.fontSize+2,h=0;h<l.length;h++)if(t.getBBox(),(v=n.tspan()).setAttribute("x","0px"),t.childNodes&&0===t.childNodes.length?v.setAttribute("dy",d-2):v.setAttribute("dy",d),t.appendChild(v),g=l[h],y=0,c=this._getLabelSize(a,i,o),i._isHeader&&a.rotateAngle&&(u=!1,o&&((m=o.nameTable[i.parent])&&m.isLane&&(u=!0),(p=o.nameTable[i.parent])&&p.isPhaseStack&&"vertical"==!i.orientation&&(u=!0)),u&&(c=r.height))," "===g)v.textContent=" ";else for(f=g.split(" "),_=0;_<f.length;_++)if(y+this._getSuitableLabelSize(a,f[_],o)*(a.fontSize/a.fontSize)>=c){if(a.textOverflow){this._updateOverFlowTspan(t,i,a,n,o,s,g,v,c);break}(f.length-1>_||y>0)&&(v.setAttribute("totalWidth",y),v=n.tspan(),t.appendChild(v),t.getBBox(),v.setAttribute("x","0"),v.setAttribute("dy",d)),"\n"!=f[_]?(v.textContent+=f[_],y=this._getSuitableLabelSize(a,f[_],o)*(a.fontSize/a.fontSize)):y=0}else y&&(v.textContent+=" ",y+=this._getSuitableLabelSize(a," ",o)*(a.fontSize/a.fontSize)),v.textContent+=f[_],y+=this._getSuitableLabelSize(a,f[_],o)*(a.fontSize/a.fontSize)},_renderLabelSVG:function(t,e,i,a){var n,o=i.getElementById(t.name),s=a._renderEjTemplate("#"+e.templateId,e),r=document.createElement("div");return r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g class="ej-label-template" id='+t.name+"_"+e.name+">"+s+"</g></svg>",document.body.appendChild(r),n=document.getElementById(t.name+"_"+e.name).cloneNode(!0),o.appendChild(n),r.parentNode.removeChild(r),n},_renderSVGLabel:function(t,i,a,n,o){var s,r,l,d,h=a.getElementById(t.name);return i.templateId&&i.templateType===e.datavisualization.Diagram.TemplateType.Svg?(this._renderLabelSVG(t,i,a,n,o),this._updateSVGTemplate(t,i,a,n,o)):(s={id:t.name+"_"+i.name+"_lblbg",fill:t._isHeader?"transparent":i.fillColor,stroke:t._isHeader?"transparent":i.borderColor,"stroke-width":i.borderWidth,"pointer-events":"none",visibility:i.visible?"visible":"hidden","fill-opacity":i.opacity,"stroke-opacity":i.opacity},r=a.rect(s),h.appendChild(r),s={id:t.name+"_"+i.name,class:"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:""!==i.hyperlink?"blue":i.fontColor,"text-decoration":""!==i.hyperlink?"underline":i.textDecoration,"font-weight":i.bold?"bold":"normal","font-style":i.italic?"italic":"normal",visibility:i.visible?"visible":"hidden","fill-opacity":i.opacity,"stroke-opacity":i.opacity},this._addCssClass(i,s),i.hyperlink?((l=document.createElementNS("http://www.w3.org/2000/svg","a")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i.hyperlink),l.setAttribute("target","_blank"),l.setAttribute("class","ej-d-anchor"),d=a.text(s),l.appendChild(d),h.appendChild(l)):(d=a.text(s),h.appendChild(d)),this._renderLabelSpanElement(d,t,i,a,n,o)),h},_renderSVGLabels:function(t,e,i,a){var n,o;if(t.labels.length&&"text"!=t.type)for(n=t.labels,o=0;o<n.length;o++)this._renderSVGLabel(t,n[o],e,i,a)},_updateLabelSpanElement:function(i,a,n,o,s){var r,l,d=n.getElementById(i.name+"_"+a.name);i.textBlock&&(d=n.getElementById(i.name+"_shape_lblbg")),d&&(t(d).empty(),this._updateHashTable(a,i,n,o),a.wrapping==e.datavisualization.Diagram.TextWrapping.Wrap?this._svgTextWrapping(d,i,a,n,o,s):a.wrapping==e.datavisualization.Diagram.TextWrapping.WrapWithOverflow?this._svgWordWrapping(d,i,a,n,o,s):(r=n.tspan(),d.appendChild(r),r.setAttribute("x","0px"),r.setAttribute("y",a.fontSize),a.textOverflow?(l=this._getLabelSize(a,i,o),this._updateOverFlowTspan(d,i,a,n,o,s,a.text,r,l)):r.textContent=a.text),this._updateTspanElement(i,a,d,n,o))},_updateSVGTemplate:function(t,i,a,n){var o,s,r,l=0,d=0,h=e.datavisualization.Diagram.Util.bounds(t),g=a.document.getElementById(t.name+"_"+i.name);if(g){if(o=g.getBBox(),t.segments&&"segmentpath"==i.relativeMode){l=(r=(s=this._getConnectorHandlePosition(i,t,1,n)).position).x,d=r.y;var c=e.datavisualization.Diagram.Util._alignLabelOnSegments(t,i,n,s),u=c.vAlign;switch(c.hAlign){case"left":l=l-o.x+i.margin.left;break;case"right":l=l-o.width-i.margin.right;break;case"stretch":case"center":l=l-o.width/2+i.margin.left-i.margin.right}switch(u){case"top":d=d-o.y+i.margin.top;break;case"bottom":d=d-o.height+i.margin.bottom;break;case"stretch":case"center":d=d-o.height/2+i.margin.top-i.margin.bottom}}else{switch(i.horizontalAlignment){case"left":l=h.width/2+i.margin.left;break;case"right":l=h.width/2-o.width;break;case"stretch":l=h.width/2-o.width/2;break;case"center":l=h.width/2-o.width/2}switch(i.verticalAlignment){case"top":d=h.height/2;break;case"bottom":d=h.height/2-o.height;break;case"stretch":d=h.height/2-o.height/2;break;case"center":d=h.height/2-o.height/2}l=l*(i.offset.x?i.offset.x/.5:0)+i.margin.left-i.margin.right,d=d*(i.offset.y?i.offset.y/.5:0)+i.margin.top-i.margin.bottom,t.segments&&(l+=h.left,d+=h.top)}g.setAttribute("transform","translate("+l+","+d+") rotate("+i.rotateAngle+" "+(o.x+o.width/2)+" "+(o.y+o.height/2)+")")}},_updateLabelTemplate:function(i,a,n,o,s){var r,l,d;if(a.templateId)if(o&&o.model.labelRenderingMode===e.datavisualization.Diagram.LabelRenderingMode.Svg)(r=n.document.getElementById(i.name+"_"+a.name)).parentNode.removeChild(r),l=this._renderLabelSVG(i,a,n,o,s),d={visibility:a.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",o)?"visible":"hidden",style:"opacity:"+a.opacity},e.datavisualization.Diagram.Util.attr(l,d);else{var h=n.document.parentNode.getElementsByClassName("htmlLayer")[0]||o._htmlLayer,g=this._findChild(h.childNodes,i),c=t(g).children("#"+i.name+"_"+a.name+"_lblbg")[0],u=o._renderEjTemplate("#"+a.templateId,a);c.childNodes[0].innerHTML=u}},_updateSVGLabel:function(t,i,a,n,o){var s,r;i.templateId?((s=document.getElementById(t.name+"_"+i.name))&&(r={visibility:i.visible?"visible":"hidden",style:"opacity:"+i.opacity}),e.datavisualization.Diagram.Util.attr(s,r),this._updateSVGTemplate(t,i,a,n,o)):(r={id:t.name+"_"+i.name,class:"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:""!==i.hyperlink?"blue":i.fontColor,"text-decoration":""!==i.hyperlink?"underline":i.textDecoration},a.text(r),this._updateLabelSpanElement(t,i,a,n,o))},_updateSVGLabels:function(t,e,i,a){var n,o;if(t.labels.length&&"text"!=t.type)for(n=t.labels,o=0;o<n.length;o++)this._updateSVGLabel(t,n[o],e,i,a)},_renderLabels:function(i,a,n,o){var s,r;if(n&&n.model.labelRenderingMode!=e.datavisualization.Diagram.LabelRenderingMode.Svg){if(i.labels.length&&"text"!=i.type){var l,d,h,g,c,u=i.labels,m=e.datavisualization.Diagram.Util.bounds(i),p=!1;for(s=0;s<u.length;s++)if(i.labels[s].hyperlink)this._renderSVGLabel(i,i.labels[s],a,n,o);else{if(!p){p=!0,r=a.document.parentNode.getElementsByClassName("htmlLayer")[0],(c=t(r).children("#"+i.name+"_label")[0])&&r.removeChild(c),c=document.createElement("div"),i.segments?(l=m.width,d=m.height,h=m.x,g=m.y):(l=i.width?i.width:i._width,d=i.height?i.height:i._height,h=i.offsetX-l*i.pivot.x,g=i.offsetY-d*i.pivot.y),o&&(h=0,g=0);var f="width:"+l+"px; height:"+d+"px; left:"+h+"px; top:"+g+"px; display: block; position: absolute; pointer-events: none; visibility:"+(i.visible&&e.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden")+"; padding: inherit;",_="node"===i._type?"ej-d-node":"group"===i._type?"ej-d-group":"ej-d-connector";i._isClassifier&&(_+=" ej-d-classifier"),e.datavisualization.Diagram.Util.attr(c,{id:i.name+"_label",class:_,style:f}),i.rotateAngle&&(c.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",c.style.MozTransform="rotate("+i.rotateAngle+"deg) ",c.style.OTransform="rotate("+i.rotateAngle+"deg) ",c.style.msTransform="rotate("+i.rotateAngle+"deg)",c.style.transform="rotate("+i.rotateAngle+"deg) ",c.style["transform-origin"]=100*i.pivot.x+"% "+100*i.pivot.y+"%"),r&&r.appendChild(c)}this._renderLabel(i,m,u[s],c,r,a,l,d,n)}}}else this._renderSVGLabels(i,a,n,o)},_isParentVisible:function(t,e){for(var i=e.document.getElementById(t);i&&("DiagramLayer"!=i.getAttribute("class")||i.localName&&"svg"!==i.localName)&&(!i.localName||"svg"===i.localName);){if(i&&"visible"!==i.getAttribute("visibility"))return!0;i=i.parentNode}},_renderLabel:function(t,i,a,n,o,s,r,l,d){var h,g,c,u,m,p,f=document.createElement("div"),_=document.createElement("span");return a.templateId&&(h=d._renderEjTemplate("#"+a.templateId,a)),s.document&&"overview_svg"===s.document.getAttribute("class")?e.datavisualization.Diagram.Util.attr(_,this._addCssClass(a,{id:t.name+"_"+a.name,class:"ej-d-label",style:"display: inline-block; position: absolute; line-height: normal; pointer-events: none"})):(g=e.datavisualization.Diagram.Util.canEnablePointerEvents(t,d),c="ej-d-label",t._isClassifier&&(c+=" ej-d-classifier"),e.datavisualization.Diagram.Util.attr(_,this._addCssClass(a,{id:t.name+"_"+a.name,class:c,style:"display: inline-block; position: absolute; line-height: normal; pointer-events:"+(g?"all":"none")}))),("stretch"==a.horizontalAlignment||"stretch"==a.verticalAlignment)&&(u=this._rotateLabel(r,l,a),"stretch"==a.horizontalAlignment&&(_.style.width=Math.abs(u.x)+"px"),"stretch"==a.verticalAlignment&&(_.style.alignItems="center",_.style.display="flex",_.style.justifyContent="center",_.style.height=Math.abs(u.y)+"px"),a.textOverflow&&(_.style.display="inline-block",0==a.rotateAngle&&t._isHeader?(_.style.top=Math.abs(u.y)/2-a.fontSize/2+"px",_.style.left="0px"):t._isHeader&&(_.style.left=Math.abs(u.y)/2-a.fontSize/2+"px",_.style.top="0px"))),a.bold&&(_.style.fontWeight="bold"),a.italic&&(_.style.fontStyle="italic"),(!a.visible||this._isParentVisible(t.name,s))&&(_.style.visibility="hidden"),_.style.opacity=a.opacity,_.style.textDecoration=a.textDecoration,_.style.fontFamily=a.fontFamily,_.style.fontSize=a.fontSize+"px",_.style.color=a.fontColor,_.style.backgroundColor=a.fillColor,_.style.borderColor=a.borderColor,_.style.borderWidth=a.borderWidth+"px",t._isHeader&&(_.style.borderWidth="0px",_.style.backgroundColor="transparent"),_.style.borderStyle="solid",_.textContent=a.text,r=r>a.width?r:a.width,r-=a.padding.left+a.padding.right,l=l>a.height?l:a.height,a.margin.left&&a.margin.right&&(r-=(a.margin.left||0)+(a.margin.right||0)),a.margin.top&&a.margin.bottom&&(l-=(a.margin.top||0)+(a.margin.bottom||0)),m="display: inline-block; position: absolute; pointer-events: none; width:"+r+"px;height:"+l+"px;",e.datavisualization.Diagram.Util.attr(f,{id:t.name+"_"+a.name+"_lblbg",style:m}),a.templateId||(f.appendChild(_),n.appendChild(f),this._alignTextOnLabel(t,i,_,f,a,d,p)),a.templateId&&((p=document.createElement("div")).setAttribute("class","ej-label-template"),p.setAttribute("id",t.name+"_"+a.name),p.innerHTML=h,f.appendChild(p),n.appendChild(f),p.style.position="absolute",this._alignTextOnLabel(t,i,p,f,a,d)),f},_findChild:function(t,e){for(var i=t.length,a=0;a<i;a++)if(t[a].id==e.name+"_label")return t[a]},_updateLabels:function(t,i,a,n){var o,s,r,l,d,h,g,c,u,m,p,f;if(a.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg)a._isSelectMode||this._updateSVGLabels(t,i,a);else if(t.labels&&"text"!=t.type){var _,v,y,b,x=t.labels,D=e.datavisualization.Diagram.Util.bounds(t),C=n?i._htmlLayer:a._htmlLayer;for(C||(C=i.document.parentNode.getElementsByClassName("htmlLayer")[0]),C&&((o=C.childNodes[t.zOrder])&&o.id==t.name||(s=C.childNodes,o=this._findChild(s,t,i))),o&&(t.segments?(_=D.width,v=D.height,y=D.x,b=D.y):(_=t.width?t.width:t._width,v=t.height?t.height:t._height,y=t.offsetX-_*t.pivot.x,b=t.offsetY-v*t.pivot.y),r=t.visible&&e.datavisualization.Diagram.Util.enableLayerOption(t,"visible",a)?"visible":"hidden",o.style.width=_+"px",o.style.height=v+"px",o.style.left=y+"px",o.style.top=b+"px",o.style.opacity=t.opacity,l="rotate("+t.rotateAngle+"deg) ",d=t.pivot?100*t.pivot.x+"% "+100*t.pivot.y+"%":"50% 50%",o.style.webkitTransform=l,o.style.MozTransform=l,o.style.OTransform=l,o.style.msTransform=l,o.style.transform=l,o.style["transform-origin"]=o.style["ms-transform-origin"]=o.style["webkit-transform-origin"]=o.style["o-transform-origin"]=o.style["moz-transform-origin"]=d,o.style.visibility=r),u=0;u<x.length;u++)t.labels[u].hyperlink?this._updateSVGLabel(t,t.labels[u],i,a):o&&(m=x[u],(h=o.childNodes[u])&&(p=h.childNodes[0],m.text||p.textContent?(c=_>m.width?_:m.width,m.margin.left&&m.margin.right&&(c-=(m.margin.left||0)+(m.margin.right||0)),m.margin.top&&m.margin.bottom&&(g-=(m.margin.top||0)+(m.margin.bottom||0)),c-=m.padding.left+m.padding.right,h.style.height=g+"px",h.style.width=c+"px",m.templateId||(p.textContent=m.text),("stretch"==m.horizontalAlignment||"stretch"==m.verticalAlignment)&&(f=this._rotateLabel(_,v,m),"stretch"==m.horizontalAlignment&&(p.style.width=Math.abs(f.x)+"px"),"stretch"==m.verticalAlignment&&(p.style.alignItems="center",p.style.display="flex",p.style.justifyContent="center",p.style.height=Math.abs(f.y)+"px"),m.textOverflow&&(p.style.display="inline-block")),this._alignTextOnLabel(t,D,p,h,m,a)):t._isHeader&&(p.style["pointer-events"]=a&&a.activeTool&&"move"===a.activeTool.name&&a.activeTool.inAction?"none":"all")))}},_alignTextOnPhase:function(t,i,a,n,o){var s,r,l,d;o.getElementById(t.name)&&(s=o.getElementById(t.name).getBoundingClientRect()),s&&(r=a.getBBox(),l=o.getElementById(t.name+"_"+n.name+"_lblbg"),a.setAttribute("transform","translate("+-r.width/2+",50), rotate(0,0,0)"),a.setAttribute("pointer-events","auto"),l&&(d={width:r.width,height:r.height,fill:n.fillColor,stroke:n.borderColor,"stroke-width":n.borderWidth,transform:"translate("+-r.width+","+s.top+"), rotate(0,0,0)"},e.datavisualization.Diagram.Util.attr(l,d)))},updateLabel:function(i,a,n,o){var s,r;if("string"==typeof a.text){var l,d,h,g,c,u=e.datavisualization.Diagram.Util.bounds(i),m=o._htmlLayer||n.document.parentNode.getElementsByClassName("htmlLayer")[0],p=t(m).children("#"+i.name+"_label")[0];i.segments?(g=u.width,c=u.height):(g=i.width?i.width:i._width,c=i.height?i.height:i._height),(l=t(p).children("#"+i.name+"_"+a.name+"_lblbg")[0])?(s=l.childNodes[0],h=g>a.width?g:a.width,a.margin.left&&a.margin.right&&(h-=(a.margin.left||0)+(a.margin.right||0)),a.margin.top&&a.margin.bottom&&(d-=(a.margin.top||0)+(a.margin.bottom||0)),h-=a.padding.left+a.padding.right,l.style.height=d+"px",l.style.width=h+"px",l.style.opacity=i.opacity,a.templateId||(s.textContent=a.text),s.style.opacity=a.opacity,("stretch"==a.horizontalAlignment||"stretch"==a.verticalAlignment)&&(r=this._rotateLabel(g,c,a),"stretch"==a.horizontalAlignment&&(s.style.width=Math.abs(r.x)+"px"),"stretch"==a.verticalAlignment&&(s.style.alignItems="center",s.style.display="flex",s.style.justifyContent="center",s.style.height=Math.abs(r.y)+"px"),a.textOverflow&&(s.style.display="inline-block")),"node"!=i.type||i.width||i.height||this.updateNode(i,n,o),this._alignTextOnLabel(i,u,s,l,a,o)):this._updateLabelSpanElement(i,a,n,o)}},_alignTextOnLabel:function(t,i,a,n,o,s){var r,l,d,h,g,c,u,m=s&&s.getNode?s.getNode(t.parent):null;if(t.segments&&"segmentpath"==o.relativeMode){var p=(h=this._getConnectorHandlePosition(o,t,1,s)).position,f={x:(p.x-i.x)/i.width,y:(p.y-i.y)/i.height},_=e.datavisualization.Diagram.Util._alignLabelOnSegments(t,o,s,h);d=_.vAlign,l=_.hAlign}else f={x:o.offset.x,y:o.offset.y},l=o.horizontalAlignment,d=o.verticalAlignment;a.style["pointer-events"]=e.datavisualization.Diagram.Util.canEnablePointerEvents(t,s)?s&&s.activeTool&&"move"===s.activeTool.name&&s.activeTool.inAction?"none":"all":"none",g=t.width?t.width:t._width,c=t.height?t.height:t._height,r={x:g-=o.margin.left+o.margin.right,y:c-=o.margin.top+o.margin.bottom},o.textOverflow&&(a.style.textOverflow=o.overflowType,a.style.overflow="hidden",a.style.whiteSpace="nowrap",t.isPhase&&"vertical"===t.orientation||m&&m.isLane&&"horizontal"===m.orientation&&t._isHeader?(a.style.width=c+"px",a.style.height=g+"px"):a.style.width=g+"px"),o.rotateAngle&&(u=e.Matrix.identity(),e.Matrix.rotate(u,o.rotateAngle,f.x,f.y),r=e.Matrix.transform(u,{x:g,y:c}));var v,y,b=0,x=0;e.datavisualization.Diagram.Util.canMoveLabel(t);switch(o.wrapping==e.datavisualization.Diagram.TextWrapping.NoWrap?(a.style.whiteSpace="nowrap",a.style.wordWrap="normal",a.style.maxWidth="",a.style.maxHeight=""):o.templateId||(o.textOverflow||(a.style.whiteSpace="justify"!=o.textAlign?"pre-wrap":"pre-line"),o.wrapping==e.datavisualization.Diagram.TextWrapping.Wrap?(a.style.wordBreak="break-all",a.style.wordWrap="break-word",t.segments?o.textOverflow&&(a.style.maxWidth=(i.width>o.width?i.width:o.width)+"px"):(Math.abs(r.x)<o.width&&(r.x=o.width),o.textOverflow&&(a.style.maxWidth=Math.abs(r.x)+"px",a.style.maxHeight=Math.abs(r.y)+"px"))):(a.style.wordWrap="break-word",a.style.maxWidth="",a.style.maxHeight="")),l){case e.datavisualization.Diagram.HorizontalAlignment.Left:b="0%",v=o.margin.left+"px";break;case e.datavisualization.Diagram.HorizontalAlignment.Center:b="-50%",v=o.margin.left-o.margin.right+"px";break;case e.datavisualization.Diagram.HorizontalAlignment.Right:b="-100%",v=-o.margin.right+"px";break;case e.datavisualization.Diagram.HorizontalAlignment.Stretch:b="-50%"}switch(d){case e.datavisualization.Diagram.VerticalAlignment.Top:x="0%",y=o.margin.top+"px";break;case e.datavisualization.Diagram.VerticalAlignment.Center:x="-50%",y=o.margin.top-o.margin.bottom+"px";break;case e.datavisualization.Diagram.VerticalAlignment.Bottom:x="-100%",y=-o.margin.bottom+"px";break;case e.datavisualization.Diagram.VerticalAlignment.Stretch:x="-50%"}o.margin.left&&o.margin.right&&o.margin.top&&o.margin.bottom&&!t._isClassifier&&!t._isClassMember?(a.style.marginLeft=v,a.style.marginTop=y):(n.style.marginLeft=v,n.style.marginTop=y),f.x*=100,f.y*=100,a.style.textAlign=o.textAlign,a.style.webkitTransform="translate("+b+", "+x+") rotate("+o.rotateAngle+"deg)",a.style.MozTransform="translate("+b+", "+x+") rotate("+o.rotateAngle+"deg)",a.style.OTransform="translate("+b+", "+x+") rotate("+o.rotateAngle+"deg)",a.style.msTransform="translate("+b+", "+x+") rotate("+o.rotateAngle+"deg)",a.style.transform="translate("+b+", "+x+") rotate("+o.rotateAngle+"deg)","stretch"==o.horizontalAlignment||"stretch"==o.verticalAlignment||o.templateId||(a.style.left="0px",a.style.top="0px"),n&&(n.style.left=f.x+"%",n.style.top=f.y+"%")},_rotateLabel:function(t,i,a){var n,o={x:t,y:i};return a.rotateAngle&&(n=e.Matrix.identity(),e.Matrix.rotate(n,a.rotateAngle,0,0),o=e.Matrix.transform(n,{x:t,y:i})),o},_renderLabelGroup:function(t,e,i){var a,n;if("group"==t._type){for(a=0;a<t.children.length;a++)"group"==(n=i.nameTable[i._getChild(t.children[a])])._type?this._renderLabelGroup(n,e,i):this._renderLabelsAsSvg(n,e,i);this._renderLabelsAsSvg(t,e,i)}},_renderLabelsAsSvg:function(t,e,i){var a,n=e.document.getElementById(t.name);if("text"===t.type)this._renderTextElementAsSvg(t,t.textBlock,n,e,i);else for(a=0;a<t.labels.length;a++)this._renderTextElementAsSvg(t,t.labels[a],n,e,i)},_renderTextElementAsSvg:function(t,i,a,n,o){var s,r,l,d,h,g,c={id:t.name+"_"+i.name,class:"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.fontColor,"text-decoration":i.textDecoration,visibility:i.visible||"text"===t.type?"visible":"hidden","pointer-events":"none"};i.bold&&(c["font-weight"]="bold"),i.italic&&(c["font-style"]="italic"),(s=n.text(c)).setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),s.textContent=i.text,c={id:t.name+"_"+i.name+"_lblbg",fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,transform:"translate(0,0)"},r=n.rect(c),i.text&&(a.appendChild(s),a.insertBefore(r,s),l=e.datavisualization.Diagram.Util.bounds(t),d=!1,t._isHeader&&i.rotateAngle&&o&&((h=o.nameTable[t.parent])&&h.isLane&&(d=!0),(g=o.nameTable[t.parent])&&g.isPhaseStack&&"vertical"==!t.orientation&&(d=!0)),this._wrapText(t,l,s,i,n,d),this._alignTextOnSvgLabel(t,l,s,i,n,o,d))},_alignTextOnSvgLabel:function(t,i,a,n,o,s,r){var l,d,h,g,c,u,m=a.getBBox(),p=e.datavisualization.Diagram.Util._getLabelPosition(n,i);r&&(m=e.datavisualization.Diagram.Util._rBounds(m,n.rotateAngle),p=e.datavisualization.Diagram.Util._getLabelPosition(n,i,null,null,r,a)),l=r?p:this._adjustOffsetWithTextBounds(t,n,a,p,m,i,s),d=n.borderWidth||0,a.setAttribute("transform","translate("+(l.x+d)+","+(l.y+d)+"), rotate("+n.rotateAngle+","+(p.x-l.x)+","+(p.y-l.y)+")"),(h=o.getElementById(t.name+"_"+n.name+"_lblbg"))&&(g=l.x+m.x,c=l.y,g+=d/2,c+=d/2,u={width:m.width+d,height:m.height+d,transform:"translate("+g+","+c+"), rotate("+n.rotateAngle+","+(p.x-g)+","+(p.y-c)+")",fill:n.fillColor?n.fillColor:"transparent",stroke:n.borderColor,"stroke-width":n.borderWidth},r&&(u.fill="transparent"),e.datavisualization.Diagram.Util.attr(h,u))},_adjustOffsetWithTextBounds:function(t,i,a,n,o,s,r){var l,d,h,g={x:0,y:0},c=0;if(t.segments&&"segmentpath"===i.relativeMode){var u=this._getConnectorHandlePosition(i,t,1,r),m=u.position,p={x:(m.x-s.x)/s.width,y:(m.y-s.y)/s.height};p=e.datavisualization.Diagram.Util._getLabelPosition(i,s,p),n.x=p.x,n.y=p.y,d=(h=e.datavisualization.Diagram.Util._alignLabelOnSegments(t,i,r,u)).hAlign,l=h.vAlign}else d=i.horizontalAlignment,l=i.verticalAlignment;if(l==e.datavisualization.Diagram.VerticalAlignment.Top?c=n.y:l==e.datavisualization.Diagram.VerticalAlignment.Center?c=n.y-o.height/2:l==e.datavisualization.Diagram.VerticalAlignment.Bottom?c=n.y-o.height:l==e.datavisualization.Diagram.VerticalAlignment.Stretch&&(c=n.y-o.height/2),g.y=c,"justify"==i.textAlign)g.x=a.childNodes.length>1?n.x-t.width/2:n.x;else switch(d){case e.datavisualization.Diagram.HorizontalAlignment.Left:switch(i.textAlign){case e.datavisualization.Diagram.TextAlign.Left:g.x=n.x;break;case e.datavisualization.Diagram.TextAlign.Center:g.x=n.x+o.width/2;break;case e.datavisualization.Diagram.TextAlign.Right:g.x=n.x+o.width}break;case e.datavisualization.Diagram.HorizontalAlignment.Center:switch(i.textAlign){case e.datavisualization.Diagram.TextAlign.Left:g.x=n.x-o.width/2;break;case e.datavisualization.Diagram.TextAlign.Center:g.x=n.x;break;case e.datavisualization.Diagram.TextAlign.Right:g.x=n.x+o.width/2}break;case e.datavisualization.Diagram.HorizontalAlignment.Right:switch(i.textAlign){case e.datavisualization.Diagram.TextAlign.Left:g.x=n.x-o.width;break;case e.datavisualization.Diagram.TextAlign.Center:g.x=n.x-o.width/2;break;case e.datavisualization.Diagram.TextAlign.Right:g.x=n.x}break;case e.datavisualization.Diagram.HorizontalAlignment.Stretch:switch(i.textAlign){case e.datavisualization.Diagram.TextAlign.Left:g.x=n.x-s.width/2;break;case e.datavisualization.Diagram.TextAlign.Center:g.x=n.x;break;case e.datavisualization.Diagram.TextAlign.Right:g.x=n.x+s.width/2}}return(t.segments||"group"==t._type)&&(g.x=g.x+s.x,g.y=g.y+s.y,n.x+=s.x,n.y+=s.y),g},_wrapText:function(t,e,i,a,n,o){for(var s,r,l,d,h,g,c,u=a.text;i.hasChildNodes();)i.removeChild(i.lastChild);t.segments?(s=e.width,r=e.height):(s=e.width-a.margin.left-a.margin.right,r=e.height-a.margin.top-a.margin.bottom),o&&(l=s,s=r,r=l),s=(s-=2*(a.borderWidth?a.borderWidth:1))<a.width?a.width:s;var m,p,f,_,v,y=u.split("\n");if(n.getElementById(i.id)&&(f=n.getElementById(i.id).childNodes),f){for(d="wrapwithoverflow"==a.wrapping,p=0;p<y.length;p++)if((m=n.tspan()).style.fontSize=a.fontSize,i.appendChild(m),"nowrap"!=a.wrapping)if(" "===y[p])m.textContent=" ";else for(h="wrapwithoverflow"==a.wrapping?y[p].split(" "):y[p],v=0;v<h.length;v++)(g=h[v]).indexOf("-")>=0&&d?(m=this._splitHyphenWord(m,g,i,a,s,n),v==h.length-1?v==h.length-1||(m=n.tspan(),i.appendChild(m)):this._getTextLength(n,i,m.textContent+" "+(h[v+1]||"")).width>s&&(m=n.tspan(),i.appendChild(m))):(m.textContent+=(m.textContent&&d?" ":"")+h[v],(_=f[f.length-1].getComputedTextLength())>=s?v==h.length-1||(m=n.tspan(),i.appendChild(m)):(d||a&&"wrap"===a.wrapping)&&(c=m.textContent,v<h.length-1&&(h[v+1].indexOf("-")>=0&&d?(m=this._splitHyphenWord(m,h[v+1],i,a,s,n),this._getTextLength(n,i,m.textContent+" "+(h[v+1]||"")).width>s&&(m=n.tspan(),i.appendChild(m)),v++):(m.textContent+=(d?" ":"")+(h[v+1]||""),_=f[f.length-1].getComputedTextLength(),m.textContent=c,_>s&&(m=n.tspan(),i.appendChild(m))))));else m.textContent+=y[p];this._wrapTextAlign(i,f,a.fontSize,a.textAlign,t,a,n)}},_splitHyphenWord:function(t,e,i,a,n,o){for(var s=t.textContent,r="wrapwithoverflow"==a.wrapping,l=t.textContent?t.textContent+" ":"",d=e.split("-"),h=0;h<d.length;h++)l+=d[h],this._getTextLength(o,i,l)>=n?(t.textContent=s,t=o.tspan(),i.appendChild(t),s=l=h<d.length-1?d[h]+"-":d[h]):(r||a&&"wrap"===a.wrapping)&&(s=l,h<d.length-1&&(l+="-",this._getTextLength(o,i,l)>n?(t.textContent=s,t=o.tspan(),i.appendChild(t),l="-"):s=l));return t.textContent=s,t},_getTextLength:function(t,e,i){var a,n=t.tspan();return e.appendChild(n),n.textContent=i,a=n.getComputedTextLength(),e.removeChild(n),a},_getTSpanLength:function(t,e,i,a){var n,o=0;if(t&&t.textContent)for(n=0;n<t.textContent.length;n++)o+=this._getCharBoundsValues(t.textContent[n],e,i,a).bold;return o},_wrapTextAlign:function(t,i,a,n,o,s,r){for(var l,d,h,g,c,u=2,m=0;m<i.length;m++){switch(l=i[m],"justify"==n&&m!=i.length-1?(" "==(c=l.textContent)[c.length-1]&&(c=c.slice(0,c.length-1))," "==c[0]&&(c=c.slice(1,c.length)),l.textContent=c,h=l.getComputedTextLength(),g=(o.width-h)/(c.split(" ").length-1),l.setAttribute("word-spacing",g+"px"),h=l.getComputedTextLength()):h=this._getTSpanLength(l,s,r,o)||l.getComputedTextLength(),"justify"==n&&(n=i.length>1?"left":"center"),n){case"left":h=0;break;case"center":h=-h/2;break;case"right":h=-h}d={x:Number(h),dy:u>2?a*u:a},0==h&&""==l.textContent?u++:u=2,e.datavisualization.Diagram.Util.attr(l,d)}},_renderPorts:function(t,i,a,n){var o,s,r,l,d,h,g,c,u,m,p,f=t.width?t.width:t._width||0,_=t.height?t.height:t._height||0,v=t.offsetX-f*t.pivot.x,y=t.offsetY-_*t.pivot.y,b=t.ports||[];for(t._ports&&t._ports.length>0&&(b=b.concat(t._ports)),g=a._currZoom,a.model.palettes||n?r=i.getElementById(t.name):(h={id:t.name+"_ej_ports","pointer-events":"all",padding:"inherit"},"group"!==t._type&&((c="none"!==t.flip?t.flip:t._flip)&&c!==e.datavisualization.Diagram.FlipDirection.None?(u=this.renderflipElement(t,a))&&(h.transform="rotate("+t.rotateAngle+","+t.offsetX*g+","+t.offsetY*g+")"+u):h.transform="rotate("+t.rotateAngle+","+t.offsetX*g+","+t.offsetY*g+"), translate("+v*g+","+y*g+")"),r=i.g(h)),m=0,p=b.length;m<p;++m)o=b[m],s=this._renderPort(t,o,i,a),r.appendChild(s);d=i.getElementById(t.parent+"_ej_ports"),""!=t.parent&&(d||(l=i.g({id:t.parent+"_ej_ports","pointer-events":"all",padding:"inherit"}),a.model.palettes||n?i.getElementById(t.name).appendChild(l):i.getElementById(a._canvas.id+"_portLayer").appendChild(l),d=l)),a.model.palettes||n||(d?d.appendChild(r):i.getElementById(a._canvas.id+"_portLayer").appendChild(r))},_renderPort:function(t,i,a,n){var o,s,r,l,d,h,g,c=e.datavisualization.Diagram.Size(i.size,i.size),u=n._currZoom?n._currZoom:1;switch(r=i.visibility&e.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&e.datavisualization.Diagram.PortVisibility.Hover||i.visibility&e.datavisualization.Diagram.PortVisibility.Connect?"hidden":e.datavisualization.Diagram.Util.enableLayerOption(t,"visible",n)?"visible":"hidden",l="group"===t._type?e.datavisualization.Diagram.Util._getPortPosition(i,e.datavisualization.Diagram.Util.bounds(t,!0),!1):e.datavisualization.Diagram.Util._getPortPosition(i,e.datavisualization.Diagram.Util.bounds(t,!0),!0),"group"===t._type&&t.rotateAngle&&(d=e.Matrix.identity(),e.Matrix.rotate(d,t.rotateAngle,t.offsetX,t.offsetY),l=e.Matrix.transform(d,l),i._absolutePoint=l),i.shape){case"x":f=this._constructX(l,i.size,u),s={id:t.name+"_"+i.name,class:"ej-d-port",fill:i.fillColor,visibility:r,stroke:i.borderColor,"stroke-width":i.borderWidth,d:f},this._addCssClass(i,s),o=a.path(s);break;case"circle":h=c.width/2,g=c.height/2,s={id:t.name+"_"+i.name,class:"ej-d-port",rx:h,ry:g,visibility:r,cx:l.x*u,cy:l.y*u,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth},this._addCssClass(i,s),o=a.ellipse(s);break;case"square":s={id:t.name+"_"+i.name,class:"ej-d-port",x:l.x*u-i.size/2,visibility:r,y:l.y*u-i.size/2,width:c.width,height:c.height,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth},this._addCssClass(i,s),o=a.rect(s);break;case"path":var m=c.width,p=c.height,f=i._absolutePath=e.datavisualization.Diagram.Geometry.updatePath(l.x*u-i.size/2,l.y*u-i.size/2,m,p,i.pathData,a);s={id:t.name+"_"+i.name,class:"ej-d-port",width:m,height:p,d:f,stroke:i.borderColor,"stroke-width":i.borderWidth,fill:i.fillColor,visibility:r},this._addCssClass(i,s),o=a.path(s)}return o},deleteLabel:function(t,e,i){i._views.forEach(function(a){var n=i._views[a],o=n.svg||n._canvas;n.context._deleteLabel(t,e,i,o,n)})},deletePort:function(t,e,i){i._views.forEach(function(a){var n=i._views[a],o=n.svg||n._canvas;n.context._deletePort(t,e,i,"overview"!==n.type?i._adornerSvg:o,n)})},_insertPort:function(t,i,a,n,o,s){var r,l,d,h;for(r=s?a.getElementById(t.name):a.getElementById(t.name+"_ej_ports"),l=e.datavisualization.Diagram.SvgContext._renderPort(t,i,a,o),d=[],h=0;h<r.childNodes.length;h++)"ej-d-port"==r.childNodes[h].className.animVal&&d.push(r.childNodes[h]);void 0!=n?0==d.length?r.appendChild(l):r.insertBefore(l,d[n]?d[n]:d[d.length]):r.appendChild(l),(i.visibility&e.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&e.datavisualization.Diagram.PortVisibility.Hover||i.visibility&e.datavisualization.Diagram.PortVisibility.Connect)&&l.setAttribute("visibility","hidden")},_updatePort:function(t,i,a,n,o){var s,r,l,d,h,g=e.datavisualization.Diagram.Size(i.size,i.size),c=null,u=o?1:n._currZoom;switch(c="group"===t._type?e.datavisualization.Diagram.Util._getPortPosition(i,e.datavisualization.Diagram.Util.bounds(t,!0),!1):e.datavisualization.Diagram.Util._getPortPosition(i,e.datavisualization.Diagram.Util.bounds(t,!0),!0),r=t.name+"_"+i.name,"group"===t._type&&t.rotateAngle&&(l=e.Matrix.identity(),e.Matrix.rotate(l,t.rotateAngle,t.offsetX,t.offsetY),c=e.Matrix.transform(l,c),i._absolutePoint=c),s=i.visibility&e.datavisualization.Diagram.PortVisibility.Visible&&e.datavisualization.Diagram.Util.enableLayerOption(t,"visible",n)?"visible":"hidden",i.shape){case"x":m=this._constructX(c,i.size,u),a.path({id:r,d:m,visibility:s});break;case"circle":d=g.width/2,h=g.height/2,"group"===t.type?a.ellipse({id:r,rx:d,ry:h,cx:0,cy:0,visibility:s,transform:"rotate("+t.rotateAngle+","+c.x*u+","+c.y*u+"),translate("+c.x*u+","+c.y*u+")"}):a.ellipse({id:r,rx:d,ry:h,visibility:s,cx:c.x*u,cy:c.y*u});break;case"square":"group"===t.type?a.rect({id:r,x:0,y:0,visibility:s,transform:"rotate("+t.rotateAngle+","+c.x*u+","+c.y*u+"),translate("+(c.x*u-i.size/2)+","+(c.y*u-i.size/2)+")"}):a.rect({id:r,visibility:s,x:c.x*u-i.size/2,y:c.y*u-i.size/2});break;case"path":var m,p=g.width,f=g.height,_={id:r,visibility:s,d:m=i._absolutePath=e.datavisualization.Diagram.Geometry.updatePath(c.x*u-i.size/2,c.y*u-i.size/2,p,f,i.pathData,a)};"group"===t.type&&(_={id:r,d:m,visibility:s,transform:"rotate("+t.rotateAngle+","+c.x*u+","+c.y*u+")"}),a.path(_)}},_updatePorts:function(t,i,a,n){var o,s,r,l,d;if(t.ports||t._ports){o=t.ports||[],t._ports&&t._ports.length>0&&(o=o.concat(t._ports));var h,g,c=a._currZoom,u=t.width?t.width:t._width,m=t.height?t.height:t._height,p=t.offsetX-u*t.pivot.x,f=t.offsetY-m*t.pivot.y;for(g=n?i.getElementById(t.name):i.getElementById(t.name+"_ej_ports"),s=0,r=o.length;s<r;++s)h=o[s],this._updatePort(t,h,i,a);g&&"group"!==t._type&&(n||(l=t.rotateAngle,(d="none"!==t.flip?t.flip:t._flip)&&d!==e.datavisualization.Diagram.FlipDirection.None?this.renderflipElement(t,a)&&g.setAttribute("transform","rotate("+l+","+t.offsetX*c+","+t.offsetY*c+")"+this.renderflipElement(t,a)):g.setAttribute("transform","rotate("+t.rotateAngle+","+t.offsetX*c+","+t.offsetY*c+"), translate("+p*c+","+f*c+")")))}},_constructX:function(t,i,a){var n=new e.datavisualization.Diagram.Path;return n.moveTo(t.x*a-i/2,t.y*a-i/2),n.lineTo(t.x*a+i/2,t.y*a+i/2),n.moveTo(t.x*a+i/2,t.y*a-i/2),n.lineTo(t.x*a-i/2,t.y*a+i/2),n.toString()},_enableSelectedNode:function(e,i,a){var n,o,s,r,l,d,h,g,c,u;if(e){if("pseudoGroup"==e.type)for(o=0,s=(n=e.children).length;o<s;o++)(r=a.nameTable[a._getChild(n[o])])&&this._enableSelectedNode(r,i,a);else l={id:e.name,"pointer-events":"auto",style:"pointer-events:block"},e.segments&&((d=i.document.getElementById(e.name+"_hitTest"))&&d.setAttribute("pointer-events",e.visible?"stroke":"none")),i.g(l);e&&"html"===e.type&&((h=a._svg.document.parentNode.getElementsByClassName("htmlLayer")[0])&&(g=t(h).find("#"+e.name+"_parentdiv")[0]),g&&(g.style.pointerEvents="all",(c=g.children[0])&&(c.style.pointerEvents="all"))),a._adornerSvg&&((u=a._adornerSvg.document.getElementById(a._adornerSvg.document.id+"handle_g"))&&u.setAttribute("pointer-events","visible")),e.isLane&&(t("#diagram").find(".s-resize").css("pointer-events","visible"),t("#diagram").find(".e-resize").css("pointer-events","visible")),t("#diagram").find(".ej-d-seperator").css("pointer-events","visible")}},_disableSelectedNode:function(e,i,a){var n,o,s,r,l,d,h,g,c;if(e){if("pseudoGroup"==e.type)for(o=0,s=(n=e.children).length;o<s;o++)(r=a.nameTable[a._getChild(n[o])])&&this._disableSelectedNode(r,i,a);else l={id:e.name,style:"pointer-events:none","pointer-events":"none"},e.segments&&i.document.getElementById(e.name+"_hitTest").setAttribute("pointer-events","none"),i.g(l);a._adornerSvg&&((d=a._adornerSvg.document.getElementById(a._adornerSvg.document.id+"handle_g"))&&d.setAttribute("pointer-events","none")),e&&"html"===e.type&&((h=a._svg.document.parentNode.getElementsByClassName("htmlLayer")[0])&&(g=t(h).find("#"+e.name+"_parentdiv")[0]),g&&(g.style.pointerEvents="none",(c=g.children[0])&&(c.style.pointerEvents="none"))),e.isLane&&(t("#diagram").find(".s-resize").css("pointer-events","none"),t("#diagram").find(".e-resize").css("pointer-events","none")),t("#diagram").find(".ej-d-seperator").css("pointer-events","none")}},_drawStackHighlighter:function(t,i,a,n,o,s){var r=[],l=e.datavisualization.Diagram.Util.bounds(t);s?o.y>=l.y&&o.y<l.center.y?(r.push({x:l.topLeft.x*n-5,y:l.topLeft.y*n-5}),r.push({x:l.topLeft.x*n,y:l.topLeft.y*n}),r.push({x:l.topLeft.x*n-5,y:l.topLeft.y*n+5}),r.push({x:l.topLeft.x*n,y:l.topLeft.y*n}),r.push({x:l.topRight.x*n,y:l.topRight.y*n}),r.push({x:l.topRight.x*n+5,y:l.topRight.y*n-5}),r.push({x:l.topRight.x*n,y:l.topRight.y*n}),r.push({x:l.topRight.x*n+5,y:l.topRight.y*n+5}),r.push({x:l.topRight.x*n,y:l.topRight.y*n})):(r.push({x:l.bottomLeft.x*n-5,y:l.bottomLeft.y*n-5}),r.push({x:l.bottomLeft.x*n,y:l.bottomLeft.y*n}),r.push({x:l.bottomLeft.x*n-5,y:l.bottomLeft.y*n+5}),r.push({x:l.bottomLeft.x*n,y:l.bottomLeft.y*n}),r.push({x:l.bottomRight.x*n,y:l.bottomRight.y*n}),r.push({x:l.bottomRight.x*n+5,y:l.bottomRight.y*n-5}),r.push({x:l.bottomRight.x*n,y:l.bottomRight.y*n}),r.push({x:l.bottomRight.x*n+5,y:l.bottomRight.y*n+5}),r.push({x:l.bottomRight.x*n,y:l.bottomRight.y*n})):o.x>=l.x&&o.x<l.center.x?(r.push({x:l.topLeft.x*n-5,y:l.topLeft.y*n-5}),r.push({x:l.topLeft.x*n,y:l.topLeft.y*n}),r.push({x:l.topLeft.x*n+5,y:l.topLeft.y*n-5}),r.push({x:l.topLeft.x*n,y:l.topLeft.y*n}),r.push({x:l.bottomLeft.x*n,y:l.bottomLeft.y*n}),r.push({x:l.bottomLeft.x*n-5,y:l.bottomLeft.y*n+5}),r.push({x:l.bottomLeft.x*n,y:l.bottomLeft.y*n}),r.push({x:l.bottomLeft.x*n+5,y:l.bottomLeft.y*n+5}),r.push({x:l.bottomLeft.x*n,y:l.bottomLeft.y*n}),r.push({x:l.bottomLeft.x*n,y:l.bottomLeft.y*n})):(r.push({x:l.topRight.x*n-5,y:l.topRight.y*n-5}),r.push({x:l.topRight.x*n,y:l.topRight.y*n}),r.push({x:l.topRight.x*n+5,y:l.topRight.y*n-5}),r.push({x:l.topRight.x*n,y:l.topRight.y*n}),r.push({x:l.bottomRight.x*n,y:l.bottomRight.y*n}),r.push({x:l.bottomRight.x*n-5,y:l.bottomRight.y*n+5}),r.push({x:l.bottomRight.x*n,y:l.bottomRight.y*n}),r.push({x:l.bottomRight.x*n+5,y:l.bottomRight.y*n+5}),r.push({x:l.bottomRight.x*n,y:l.bottomRight.y*n}),r.push({x:l.bottomRight.x*n,y:l.bottomRight.y*n}));var d={id:"nodeHighlighter",points:this._convertToSVGPoints(r),fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none",style:"pointer-events: none"},h=i.polyline(d);return a.appendChild(h),h},_drawNodeHighlighter:function(t,i,a,n){var o,s=t.width?t.width:t._width,r=t.height?t.height:t._height,l=t.offsetX-s*t.pivot.x,d=t.offsetY-r*t.pivot.y,h=e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),g="rotate("+t.rotateAngle+","+h.x*n+","+h.y*n+")",c={id:"nodeHighlighter",class:"ej-d-node",x:l*n,y:d*n,width:s*n,height:r*n,fill:"transparent",stroke:t.isLane||t.isSwimlane?"red":"#0dc923","stroke-width":2,"pointer-events":"none",transform:g,style:"pointer-events: none"};return o=i.rect(c),a.appendChild(o),o},_drawNavigationHighlighter:function(t,e,i,a){var n={id:"nodeHighlighter",x:t.x*a,y:t.y*a,width:t.width*a,height:t.height*a,fill:"transparent",stroke:"black","stroke-dasharray":"2 2","shape-rendering":"crispEdges",style:"pointer-events: none"};i.appendChild(e.rect(n))},_removeNodeHighlighter:function(t,e){var i=t.getElementById("nodeHighlighter");i&&t.removeChild(i,e)},_drawPortHighlighter:function(t,i,a,n,o,s){i.width?i.width:i._width,i.height?i.height:i._height;var r,l,d,h,g,c,u,m,p,f,_="#8CC63F",v="#1A1A1A",y=.5;return t?(l=e.datavisualization.Diagram.Size(2*t.size,2*t.size),d=e.datavisualization.Diagram.Util._getPortPosition(t,e.datavisualization.Diagram.Util.bounds(i,!0)),p=e.Matrix.identity(),e.Matrix.rotate(p,i.rotateAngle,i.offsetX,i.offsetY),h=((d=e.Matrix.transform(p,d)).x-t.size)*o,g=(d.y-t.size)*o,c="rotate(0,"+(h+l.width/2)+","+(g+l.height/2)+")",s&&(s.portHighlight=!0)):(u=e.datavisualization.Diagram.Util.bounds(i,!0),l=e.datavisualization.Diagram.Size(u.width,u.height),h=(d=e.datavisualization.Diagram.Point(u.x,u.y)).x*o,g=d.y*o,v=_,_="transparent",y=2,m=e.datavisualization.Diagram.Point(i.offsetX,i.offsetY),c="rotate("+i.rotateAngle+","+m.x*o+","+m.y*o+")"),f={id:"portHighlighter",class:"ej-d-port",x:h,y:g,width:l.width*o,height:l.height*o,fill:_,stroke:v,"stroke-width":y,"pointer-events":"none",transform:c},r=a.rect(f),n.appendChild(r),r},_drawConnectorHighlighter:function(t,e,i){var a=e._adornerSvg,n=a.g({id:"connector_highlighter",visibility:"visible",transform:"scale("+i+")"});e._adornerLayer.appendChild(n);var o={id:"highlighter_segments",d:this._findPath(t,e),fill:"none",stroke:"#0dc923","stroke-width":t.lineWidth,"pointer-events":"none"},s=a.path(o);return n.appendChild(s),n},_removeConnectorHighlighter:function(t,e){var i=e.getElementById("connector_highlighter");i&&t.removeChild(i)},_removePortHighlighter:function(t,e){var i=t.getElementById("portHighlighter");i&&t.removeChild(i,e)},_renderPhaseResize:function(t,i,a,n,o){var s,r,l,d=[],h="",g=!1,c=!1,u=e.datavisualization.Diagram.Util.bounds(t);(d=[]).push({x:u.topLeft.x*a,y:u.topLeft.y*a}),d.push({x:u.bottomLeft.x*a,y:u.bottomLeft.y*a}),l={id:"w-resize",points:s=this._convertToSVGPoints(d),"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"},r=i.polyline(l),o.appendChild(r),(d=[]).push({x:u.topLeft.x*a,y:u.topLeft.y*a}),d.push({x:u.topRight.x*a,y:u.topRight.y*a}),l={id:"n-resize",points:s=this._convertToSVGPoints(d),"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"},r=i.polyline(l),o.appendChild(r),h="","vertical"==t.orientation&&(h="e-resize",c=!0),(d=[]).push({x:u.topRight.x*a,y:u.topRight.y*a}),d.push({x:u.bottomRight.x*a,y:u.bottomRight.y*a}),s=this._convertToSVGPoints(d),c&&(l={id:"e-resize-hitTest",class:h,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":c?"stroke":"none"},r=i.polyline(l),o.appendChild(r)),l={id:"e-resize",class:h,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":c?"stroke":"none"},r=i.polyline(l),o.appendChild(r),h="","horizontal"==t.orientation&&(h="s-resize",g=!0),(d=[]).push({x:u.bottomLeft.x*a,y:u.bottomLeft.y*a}),d.push({x:u.bottomRight.x*a,y:u.bottomRight.y*a}),s=this._convertToSVGPoints(d),g&&(l={id:"s-resize-hitTest",class:h,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":g?"stroke":"none"},r=i.polyline(l),o.appendChild(r)),l={id:"s-resize",class:h,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":g?"stroke":"none"},r=i.polyline(l),o.appendChild(r)},renderSelector:function(e,i,a,n,o,s,r){var l,d,h;t(".phaseSelector").remove(),e.width?e.width:e._width,e.height?e.height:e._height,e.segments?(d=i.g({id:i.document.id+"handle_g",class:"handle","pointer-events":"visible"}),a.appendChild(d),this._renderEndPointHandle(e,i,n)):"phase"!=e.type?e.isLane||e.isSwimlane?(d=i.g({id:i.document.id+"handle_g",class:"handle","pointer-events":"visible"}),a.appendChild(d),this._renderPhaseResize(e,i,n,o,d,s)):(l=this._selectorLocation(e,n,r),d=i.g({id:i.document.id+"handle_g",class:"handle","pointer-events":"visible",transform:l}),a.appendChild(d),this._updateMultiSelectHandle(e,n,o,r),this._renderResizeHandle(e,i,n,o,r)):"phase"==e.type&&s&&(d=i.g({id:i.document.id+"handle_g",class:"handle","pointer-events":"visible",transform:"translate("+s.x*n+","+s.y*n+"),rotate(0,"+s.width/2*n+","+s.height/2*n+")"}),i.document.getElementById(i.document.id+"handle_g")||a.appendChild(d),h=i.rect({id:"phaseSelector",class:"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:s.width<0?1:s.width*n,height:s.height<0?1:s.height*n,fill:"transparent",stroke:"red"}),d.appendChild(h))},_updateMultiSelectHandle:function(t,i,a,n){var o,s,r;if("pseudoGroup"===t.type&&e.datavisualization.Diagram.Util.canDragHelper(n)){var l=t.width?t.width:t._width,d=t.height?t.height:t._height,h=e.datavisualization.Diagram.Point(t.offsetX,t.offsetY);n._svg.getElementById(n.element[0].id+"_multiselector")?(o={id:n.element[0].id+"_multiselector",width:l,height:d,transform:"rotate("+t.rotateAngle+","+h.x+","+h.y+"),translate("+(t.offsetX-l*t.pivot.x)+","+(t.offsetY-d*t.pivot.y)+")"},n._svg.rect(o)):(o={id:n.element[0].id+"_multiselector",class:"ej-d-multiselector",width:l,height:d,transform:"rotate("+t.rotateAngle+","+h.x+","+h.y+"),translate("+(t.offsetX-l*t.pivot.x)+","+(t.offsetY-d*t.pivot.y)+")",fill:"transparent",opacity:".5"},s=n._svg.getElementById(n.element[0].id+"_canvas_diagramLayer"),r=n._svg.rect(o),s.insertBefore(r,s.firstChild))}},_renderResizeHandle:function(t,i,a,n,o){var s,r,l=t.width?t.width:t._width,d=t.height?t.height:t._height,h=t.pivot?t.pivot:{x:.5,y:.5},g=e.datavisualization.Diagram.Point(l*h.x,-20/a),c="visible";if("label"!==t._type&&e.datavisualization.Diagram.Util.canShowResizeThumbs(o)){var u=e.datavisualization.Diagram.Rectangle(0,0,14,14),m=e.datavisualization.Diagram.Rectangle(l/2*a,0,14,14),p=e.datavisualization.Diagram.Rectangle(0,d/2*a,14,14);c=this._resizeHandleVisiblity(u,m,p)}n&e.datavisualization.Diagram.SelectorConstraints.Rotator&&"umlclassifier"!=t.type&&(r=0,"hidden"==c&&(r=-20),this._renderPivotLine(t,i,a,r),this._renderRotateThumb("rotateHandle",t,g.x,g.y+r,a,i)),n&e.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._renderResizeBorder("resizeBorder",t,i,a),"umlclassifier"!=t.type&&("label"==t._type&&(s=!(t.constraints&e.datavisualization.Diagram.LabelConstraints.Resizable)),this._renderResizeCorner("nw-resize",t,0,0,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest),void 0,c),this._renderResizeCorner("ne-resize",t,l*a,0,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast),void 0,c),this._renderResizeCorner("sw-resize",t,0,d*a,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest),void 0,c),this._renderResizeCorner("se-resize",t,l*a,d*a,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast),void 0,c),this._renderResizeCorner("n-resize",t,l/2*a,0,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorth),void 0,c),this._renderResizeCorner("w-resize",t,0,d/2*a,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeWest),void 0,c),this._renderResizeCorner("e-resize",t,l*a,d/2*a,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeEast),void 0,c),this._renderResizeCorner("s-resize",t,l/2*a,d*a,i,"label"==t._type?s:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouth),void 0,c)))},renderUserHandles:function(t,e,i,a,n,o,s){var r,l,d;if(e&&("phase"===e.type&&s&&(r=s._getPhaseBounds(e)),t.length))for(l=i.g({id:i.document.id+"userHandle_g",class:"userHandle","pointer-events":"visible"}),o.appendChild(l),d=0;d<t.length;d++)(a&&t[d].enableMultiSelection||!a)&&this._renderUserHandle(t[d],e,i,n,l,r,s)},_renderUserHandle:function(t,i,a,n,o,s,r){var l,d,h,g,c,u,m,p,f=this._getHandlePosition(t,i,n,s,r),_=f.x*n,v=f.y*n,y=this._getHandleShape(t,_,v);t._size=t.size;var b=o.appendChild(a.circle(y)),x={id:t.name+"_title"},D=a.title(x);switch(D.innerHTML=t.name,b.appendChild(D),t.shape){case"path":d=t._absolutePath=e.datavisualization.Diagram.Geometry.updatePath(0,0,t.size/2,t.size/2,t.pathData,a),(l=this._getHandleIcon(t,_-t.size/4,v-t.size/4)).d=d,o.appendChild(a.path(l));break;case"image":(l=this._getHandleIcon(t,_-t.size/4,v-t.size/4)).preserveAspectRatio="none",(h=new Image).src=t.source,(g=a.image(l)).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),o.appendChild(g);break;case"native":t.visible?"visible":"hidden",l=this._getHandleIcon(t,_-t.size/4,v-t.size/4),c=r._renderEjTemplate("#"+t.templateId,t),(u=document.createElement("div")).innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+c+"</g></svg>",document.body.appendChild(u),(m=document.getElementById("tempNative").cloneNode(!0)).id=t.name+"_shape",o.appendChild(m);s=m.getBBox();var C=l.width,z=l.height,S=s.width?C/s.width:1,P=s.height?z/s.height:1;m.setAttribute("transform","scale("+S+","+P+")"),u.parentNode.removeChild(u),(p=a.g(l)).appendChild(m),o.appendChild(p)}},_getHandleIcon:function(t,e,i){var a=t.visible?"visible":"hidden";return{id:t.name+"_icon",class:"userHandle-icon",fill:t.pathColor,transform:"translate("+e+","+i+")",visibility:a,width:t.size/2,height:t.size/2}},_getHandlePosition:function(t,i,a,n){var o,s,r;if(i&&(!i.segments||t.offset)){o=e.datavisualization.Diagram.Point(),s="phase"===i.type&&n?e.datavisualization.Diagram.Util.bounds(n):e.datavisualization.Diagram.Util.bounds(i,!0);var l=t.offset,d=t.size,h=t.margin,g=e.datavisualization.Diagram.Point(0,0),c=e.Matrix.identity();switch(e.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),t.position){case"topleft":l={x:0,y:0},h={left:-25,top:-25,bottom:0,right:0};break;case"topcenter":l={x:.5,y:0},h={left:0,top:-25,bottom:0,right:0};break;case"topright":l={x:1,y:0},h={left:0,top:-25,bottom:0,right:-25};break;case"middleleft":l={x:0,y:.5},h={left:-25,top:0,bottom:0,right:0};break;case"middleright":l={x:1,y:.5},h={left:0,top:0,bottom:0,right:-25};break;case"bottomleft":h={left:-25,top:0,bottom:-25,right:0},l={x:0,y:1};break;case"bottomcenter":l={x:.5,y:1},h={left:0,top:0,bottom:-25,right:0};break;case"bottomright":l={x:1,y:1},h={left:0,top:0,bottom:-25,right:-25}}switch(g.x+=h.left-h.right,g.y+=h.top-h.bottom,t.horizontalAlignment){case e.datavisualization.Diagram.HorizontalAlignment.Left:g.x+=d/2;break;case e.datavisualization.Diagram.HorizontalAlignment.Right:g.x-=d/2}switch(t.verticalAlignment){case e.datavisualization.Diagram.VerticalAlignment.Top:g.y+=d/2;break;case e.datavisualization.Diagram.VerticalAlignment.Bottom:g.y-=d/2}return o.x+=s.x+s.width*l.x+g.x/a,o.y+=s.y+s.height*l.y+g.y/a,i.segments||(r=e.datavisualization.Diagram.Point(o.x,o.y),o=e.Matrix.transform(c,r)),o}},_getConnectorHandlePosition:function(t,i,a,n){var o,s=e.datavisualization.Diagram.Util._findOffsetOnConnector(i,t,t.segmentOffset,n),r=s.segment,l=s.point,d=(s.offset,i.segments[r],i.segments[r].points[l]),h=e.datavisualization.Diagram.Geometry.findAngle(d,i.segments[r].points[l+1]);return t.alignment&&"auto"!=t.alignment?(1==t.offset&&(h+=180),{position:e.datavisualization.Diagram.Geometry.transform(s.offset,0!=t.offset&&1!=t.offset?h+45:h,this._getAlignedPosition(i,t)),angle:h}):{position:(o=this._avoidOverlapWithSourceAndTarget(i,t.offset,t.size,s.offset,h,r,l,n)).position,angle:1==t.offset?(180+h)%360:h,direction:o.direction}},_getAlignedPosition:function(t,e){var i=void 0===e.text?10:0;switch(e.alignment){case"center":return 0;case"before":return-((e.size||0)/2+i);case"after":return(e.size||0)/2+i}return 0},_avoidOverlapWithSourceAndTarget:function(t,i,a,n,o,s,r,l){var d,h,g,c,u,m=n,p=(t.segments[s],90);if(0==i?((d=t.segments[s].points[r+2]?t.segments[s].points[r+2]:t.segments[s+1]?t.segments[s+1].points[1]:null)&&(h=e.datavisualization.Diagram.Geometry.findAngle(t.segments[s].points[r],d)),t.sourceNode&&(p=45)):1==i&&((d=t.segments[s].points[r-1]?t.segments[s].points[r-1]:t.segments[s-1]?t.segments[s-1][t.segments[s].points.length-2]:null)&&(h=e.datavisualization.Diagram.Geometry.findAngle(t.segments[s].points[r+1],d)),o+=180,o%=360,t.targetNode&&(p=45)),d)if(o%90==0)h>270&&0==o&&(o=360),90==o?h<o?(o+=p,g="right"):(o-=p,g="left"):270==o?h<o?(o+=p,g="left"):(o-=p,g="right"):180==o?h<o?(o+=p,g="bottom"):(o-=p,g="top"):h<o?(o+=p,g="top"):(o-=p,g="bottom"),m=e.datavisualization.Diagram.Geometry.transform(m,o,void 0!=a?Math.max(5,a/2+10):0);else{var f=45,_=135,v=225,y=315;(0==i&&t.sourceNode||1==i&&t.targetNode)&&((c=0==i&&t.sourceNode?l.nameTable[t.sourceNode]:l.nameTable[t.targetNode])&&(b=e.datavisualization.Diagram.Util.bounds(c)),b&&(f=u=180/(2+2/(b.height/b.width)),v=(_=180-u)+2*u,y=360-u)),p=o>=f&&o<=_||o>=v&&o<=y?o%180>90?-p:p:o>_&&o<v?o>180?-45:45:o>0?-45:45,m=e.datavisualization.Diagram.Geometry.transform(m,o+p,void 0!=a?Math.max(5,a/2+10):0)}else{var b;f=45,_=135,v=225,y=315;(0==i&&t.sourceNode||1==i&&t.targetNode)&&((c=0==i&&t.sourceNode?l.nameTable[t.sourceNode]:l.nameTable[t.targetNode])&&(b=e.datavisualization.Diagram.Util.bounds(c)),b&&(f=u=180/(2+2/(b.height/b.width)),v=(_=180-u)+2*u,y=360-u)),p=o>=f&&o<=_||o>=v&&o<=y?o%180>90?-p:p:o>_&&o<v?o>180?-45:45:o<=f?-45:45,o+=360,o%=360,m=e.datavisualization.Diagram.Geometry.transform(m,o+p,void 0!=a?Math.max(5,a/2+(Math.abs(p%45)>0?13:10)):0)}return{position:m,direction:g}},_getHandleShape:function(t,e,i){var a=t.visible?"visible":"hidden";return{id:t.name+"_shape",class:"userHandle",cx:e,cy:i,r:t.size/2,fill:t.backgroundColor,stroke:t.borderColor,"stroke-width":t.borderWidth||0,visibility:a}},_updateHandleShape:function(t,e,i,a){var n=t.visible?"visible":"hidden",o={id:t.name+"_shape",cx:e,cy:i,r:t.size/2,fill:t.backgroundColor,stroke:t.borderColor,"stroke-width":t.borderWidth||0,visibility:n};a.circle(o)},_updateHanleIcon:function(t,e,i,a,n){var o=t.visible?"visible":"hidden",s={id:t.name+"_icon",d:e,fill:t.pathColor,transform:"translate("+a+","+n+")",visibility:o};i.path(s)},_getHanleIcon:function(t,e){return{id:t.name,d:e,stroke:t.borderColor,"stroke-width":t.borderWidth,fill:t.fillColor}},renderPivotPoint:function(t,i,a,n,o,s){var r=t.width*(t.pivot?t.pivot.x:.5),l=t.height*(t.pivot?t.pivot.y:.5),d="visible";if(e.datavisualization.Diagram.Util.canShowResizeThumbs(s)){var h=t.width?t.width:t._width,g=t.height?t.height:t._height,c=e.datavisualization.Diagram.Rectangle(0,0,14,14),u=e.datavisualization.Diagram.Rectangle(h/2*i,0,14,14),m=e.datavisualization.Diagram.Rectangle(0,g/2*i,14,14);d=this._resizeHandleVisiblity(c,u,m)}a.getElementById("pivot")?e.datavisualization.Diagram.SvgContext._updateResizeCorner("pivot",r*i,l*i,a,d,n,o,s,void 0):e.datavisualization.Diagram.SvgContext._renderResizeCorner("pivot",t,r*i,l*i,a,void 0,4,d),this._updatePivotLine(t,a,i,!0)},_removePivotPoint:function(t,e,i){var a=e.getElementById("pivot");a&&(a.parentNode.removeChild(a),this._updatePivotLine(t,e,i,!1))},_renderPivotLine:function(t,i,a,n){if(!t.container){var o=t.width?t.width:t._width,s=(t.height?t.height:t._height,t.pivot?t.pivot:{x:.5,y:.5}),r=e.datavisualization.Diagram.Point(o*s.x,-20/a);n&&(r.y+=n);var l=e.datavisualization.Diagram.Point(o*s.x,0),d=i.getElementById(i.document.id+"handle_g"),h=i.line({id:"pivotLine",x1:r.x*a,y1:r.y*a,x2:l.x*a,y2:l.y*a,stroke:"label"==t._type?"red":"black","stroke-width":1,"stroke-dasharray":"2,3",fill:"none"});d.appendChild(h)}},_renderResizeBorder:function(t,i,a,n){var o,s=a.getElementById(a.document.id+"handle_g"),r=i.width?i.width:i._width,l=i.height?i.height:i._height;o="umlclassifier"==i.type?e.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(t,i,a,n):a.rect({id:t,class:"resizeRect",width:r*n,height:l*n,stroke:"label"==i._type?"red":"#097F7F","stroke-width":.6,"stroke-dasharray":"6,3",fill:"none","pointer-events":"none"}),s.appendChild(o)},_renderResizeCorner:function(t,i,a,n,o,s,r,l){var d,h,g=o.getElementById(o.document.id+"handle_g"),c="white";e.datavisualization.Diagram.Util.canResize(i)||(c="darkgray"),s&&(c="darkgray",d="none"),h={id:t,class:"resizeCorners",fill:c,stroke:"label"==i._type?"#097F7F":"black","stroke-width":1,cx:a,cy:n,r:r||7,visibility:l},h=this._setPadding(h),g.appendChild(o.circle(h)),h={id:t+"_transparent",class:t,fill:"transparent",cx:h.cx,cy:h.cy,r:r||10,visibility:h.visibility},d&&(h["pointer-events"]=d),g.appendChild(o.circle(h))},_setPadding:function(t){if(("n-resize"===t.id||"w-resize"===t.id||"e-resize"===t.id||"s-resize"===t.id)&&"hidden"===t.visibility){"n-resize"===t.id&&(t.cy=t.cy-20),"w-resize"===t.id&&(t.cx=t.cx-20),"e-resize"===t.id&&(t.cx=t.cx+20),"s-resize"===t.id&&(t.cy=t.cy+20),t.visibility="visible"}return t},_renderRotateThumb:function(t,i,a,n,o,s){if(!i.container){var r=s.getElementById(s.document.id+"handle_g"),l="#231f20";e.datavisualization.Diagram.Util.canRotate(i)||(l="darkgray");var d={id:"rotatehandle",class:t,fill:l,stroke:"black","stroke-width":.5,width:20,height:20,d:"M 16.856 10.239 L 18 3.438 l -2.189 0.817 c -0.974 -1.694 -2.482 -2.995 -4.326 -3.696 C 9.375 -0.245 7.071-0.18 5.01 0.744 C 2.942 1.668 1.365 3.342 0.558 5.453 c -0.803 2.115 -0.738 4.414 0.185 6.478 c 0.925 2.064 2.6 3.645 4.714 4.45 c 0.969 0.371 1.993 0.554 3.013 0.554 c 1.345 0 2.685 -0.317 3.897 -0.948 l -1.016 -1.962 c -1.584 0.822-3.445 0.929 -5.114 0.293 c -1.56 -0.596 -2.793 -1.762 -3.479 -3.289 C 2.078 9.502 2.031 7.803 2.622 6.244 C 3.216 4.68 4.387 3.443 5.914 2.761 C 7.437 2.079 9.137 2.03 10.7 2.626 c 1.246 0.475 2.271 1.328 2.986 2.424 L 11.54 5.851 L 16.856 10.239 Z",transform:"translate("+(a*o-10)+","+(n*o-20)+")"},h=s.path(d),g=s.circle({id:"rotate",class:t,fill:"transparent",stroke:"none",cx:10,cy:10,r:13,transform:"translate("+(a*o-10)+","+(n*o-20)+")"});r.appendChild(h),r.appendChild(g)}},_refreshEndPointHandles:function(t,e,i){var a,n,o;if(t&&t.segments){if((a=e.getElementById(e.document.id+"handle_g"))&&a.childNodes.length>0)for(n=a.childNodes.length-1;n>=0;n--)"sourceEndPoint"!==(o=a.childNodes[n]).id&&"targetEndPoint"!==o.id&&o.parentNode.removeChild(o);this._renderEndPointHandle(t,e,i)}},_renderEndPointHandle:function(t,i,a){var n,o,s;if(!t.isPhase)for(n=e.datavisualization.Diagram.Util.canDragSegmentThumbs(t),o=0;o<t.segments.length;o++)"bezier"==(s=t.segments[o]).type&&(this._renderBezierLine("bezierline1_"+o,s._startPoint,s._point1,a,i,n),this._renderBezierLine("bezierline2_"+o,s._endPoint,s._point2,a,i,n),this._renderEndPointCorner("bezierpoint1_"+o,s._point1.x*a,s._point1.y*a,!1,i,n),this._renderEndPointCorner("bezierpoint2_"+o,s._point2.x*a,s._point2.y*a,!1,i,n)),s.points,0==o&&this._renderEndPointCorner("sourceEndPoint",s._startPoint.x*a,s._startPoint.y*a,e.datavisualization.Diagram.Util.isSourceConnected(t),i,e.datavisualization.Diagram.Util.canDragSourceEnd(t)),o==t.segments.length-1?(this._renderEndPointCorner("targetEndPoint",s._endPoint.x*a,s._endPoint.y*a,e.datavisualization.Diagram.Util.isTargetConnected(t),i,e.datavisualization.Diagram.Util.canDragTargetEnd(t)),"orthogonal"==s.type&&this._renderTerminalOrthoThumbs(s,i,a,o,n)):"orthogonal"!=s.type?this._renderSegmentEndThumb("segmentEnd_"+o,s._endPoint.x*a,s._endPoint.y*a,e.datavisualization.Diagram.Util.isSourceConnected(t),i,e.datavisualization.Diagram.Util.canDragSourceEnd(t)):this._renderTerminalOrthoThumbs(s,i,a,o,n)},_renderTerminalOrthoThumbs:function(t,i,a,n,o){var s,r,l,d;if(t.points.length>2)for(r=0;r<t.points.length-1;r++)d=e.datavisualization.Diagram.Geometry.distance(t.points[r],t.points[r+1]),s=t.points[r].y.toFixed(2)==t.points[r+1].y.toFixed(2)?"horizontal":"vertical",l=d>=50?"visible":"hidden",this._renderOrthogonalThumb("OrthoThumb_"+r+"_"+n,(t.points[r].x+t.points[r+1].x)/2*a,(t.points[r].y+t.points[r+1].y)/2*a,i,l,s,o);else l=(d=t.length||e.datavisualization.Diagram.Geometry.distance(t._startPoint,t._endPoint))>=50?"visible":"hidden",s=t._startPoint.y.toFixed(2)==t._endPoint.y.toFixed(2)?"horizontal":"vertical",this._renderOrthogonalThumb("OrthoThumb_"+n,(t._endPoint.x+t._startPoint.x)/2*a,(t._endPoint.y+t._startPoint.y)/2*a,i,l,s,o)},_renderEndPointCorner:function(t,e,i,a,n,o){var s,r=n.getElementById(n.document.id+"handle_g"),l=a?"#8CC63F":"white";o||(l="darkgray"),s={id:t,class:t,opacity:.75,fill:l,stroke:"black","stroke-width":2,cx:e,cy:i,r:7},n.getElementById(t)?n.circle(s):r.appendChild(n.circle(s))},_renderSegmentEndThumb:function(t,e,i,a,n,o){var s,r=n.getElementById(n.document.id+"handle_g"),l="#e2e2e2";o||(l="darkgray"),s={id:t,class:"segmentEnd",fill:l,stroke:"black","stroke-width":2,cx:e,cy:i,r:5},r.appendChild(n.circle(s))},_renderOrthogonalThumb:function(t,e,i,a,n,o,s){var r,l,d,h,g,c;"horizontal"==o?(r="M0,7 L15,0 L30,7 L15,14 z",l=-15,d=-7):(r="M7,0 L0,15 L7,30 L14,15 z",l=-7,d=-15),h=a.getElementById(a.document.id+"handle_g"),g="#e2e2e2",s||(g="darkgray"),c={id:t,class:"segmentEnd",fill:g,stroke:"black","stroke-width":1,d:r,transform:"translate("+(e+l)+","+(i+d)+")",visibility:n},h.appendChild(a.path(c))},_renderBezierLine:function(t,e,i,a,n){var o=n.line({id:t,x1:e.x*a,y1:e.y*a,x2:i.x*a,y2:i.y*a,stroke:"black","stroke-width":1,"stroke-dasharray":"3,3",fill:"none"});n.getElementById(n.document.id+"handle_g").appendChild(o)},_renderControlPointCorner:function(t,e,i,a){var n,o=a.g({class:t});a.getElementById(a.document.id+"handle_g").appendChild(o),n={id:t+"_"+i,fill:"white",stroke:"black","stroke-width":2,cx:e.x,cy:e.y,r:5},o.appendChild(a.circle(n))},_selectorLocation:function(t,i,a){var n,o,s,r=t.width,l=t.height;return"label"!==t._type?n="translate("+(t.offsetX-r*t.pivot.x)*i+","+(t.offsetY-l*t.pivot.y)*i+"),rotate("+t.rotateAngle+","+r*t.pivot.x*i+","+l*t.pivot.y*i+")":(o=a.findNode(t._parent),l=l||o.height,s=a.activeTool._findLabelAtNode(o,t),o.segments?o.segments&&"segmentpath"!==t.relativeMode?n="translate("+s.x*i+","+s.y*i+"),rotate("+t.rotateAngle+","+r/2*i+","+l/2*i+")":((s=e.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(t,o,i,a)).position.x=s.position.x+t.margin.left-t.margin.right,s.position.y=s.position.y+t.margin.top-t.margin.bottom,n="translate("+(s.position.x-r/2)*i+","+(s.position.y-l/2)*i+"),rotate("+t.rotateAngle+","+r/2*i+","+l/2*i+")"):n="translate("+s.x*i+","+s.y*i+"),rotate("+o.rotateAngle+"),rotate("+t.rotateAngle+","+r/2*i+","+l/2*i+")"),n},updateSelector:function(t,i,a,n,o,s,r){var l,d,h,g,c;if(t)if(t.width?t.width:t._width,t.height?t.height:t._height,t.segments)this._updateEndPointHandle(t,i,a),o&e.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(n.model.selectedItems.userHandles,t,i,!1,!1,a,n);else if("phase"===t.type)d=n._getPhaseBounds(t),i.g({id:i.document.id+"handle_g",class:"handle","pointer-events":"visible",transform:"translate("+d.x*a+","+d.y*a+"),rotate(0,"+d.width/2*a+","+d.height/2*a+")"}),i.rect({id:"phaseSelector",class:"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:d.width<0?1:d.width*a,height:d.height<0?1:d.height*a,fill:"transparent",stroke:"red"});else{if(t.isSwimlane||t.isLane||(l=this._selectorLocation(t,a,n),i.g({id:i.document.id+"handle_g",transform:l})),e.datavisualization.Diagram.Util.canShowResizeThumbs(n)){var u=i.document.parentNode.getElementsByClassName("resizeCorners"),m=i.document.getElementById("rotatehandle"),p=r?"hidden":"visible";for(h=0;h<u.length;h++)u[h].setAttribute("visibility",p);null!=m&&(g=i.document.getElementById("pivotLine"),m.setAttribute("visibility",p),g.setAttribute("visibility",p))}if("group"!==n.getObjectType(t)&&"pseudoGroup"!==t.type&&("move"==n.activeTool.name||"rotate"==n.activeTool.name||"labelMove"==n.activeTool.name||"labelRotate"==n.activeTool.name)&&n.activeTool.inAction||(this._updateMultiSelectHandle(t,a,o,n),this._updateResizeHandle(t,i,a,o,s,r,n)),("rotatetool"==n.activeTool.name||"labelRotate"==n.activeTool.name)&&n.activeTool.inAction&&this.renderPivotPoint(t,a,i,s,r,n),n.model.selectedItems.userHandles&&n.model.selectedItems.userHandles.length>0&&(c=!1,n.selectionList[0]&&"multipleSelection"==n.selectionList[0].name&&(c=!0),o&e.datavisualization.Diagram.SelectorConstraints.UserHandles))return this.updateUserHandles(n.model.selectedItems.userHandles,t,i,c,!1,a,n),!0}},_updatePhaseResize:function(t,i,a){var n,o,s=[],r=e.datavisualization.Diagram.Util.bounds(t);(s=[]).push({x:r.topLeft.x*a,y:r.topLeft.y*a}),s.push({x:r.bottomLeft.x*a,y:r.bottomLeft.y*a}),o={id:"w-resize",points:n=this._convertToSVGPoints(s)},i.polyline(o),(s=[]).push({x:r.topLeft.x*a,y:r.topLeft.y*a}),s.push({x:r.topRight.x*a,y:r.topRight.y*a}),o={id:"n-resize",points:n=this._convertToSVGPoints(s)},i.polyline(o),(s=[]).push({x:r.topRight.x*a,y:r.topRight.y*a}),s.push({x:r.bottomRight.x*a,y:r.bottomRight.y*a}),o={id:"e-resize-hitTest",points:n=this._convertToSVGPoints(s)},i.polyline(o),o={id:"e-resize",points:n},i.polyline(o),(s=[]).push({x:r.bottomLeft.x*a,y:r.bottomLeft.y*a}),s.push({x:r.bottomRight.x*a,y:r.bottomRight.y*a}),o={id:"s-resize-hitTest",points:n=this._convertToSVGPoints(s)},i.polyline(o),o={id:"s-resize",points:n},i.polyline(o)},_updateResizeHandle:function(t,i,a,n,o,s,r){var l,d;if(t.isSwimlane||t.isLane)this._updatePhaseResize(t,i,a,n);else{var h,g=t.width?t.width:t._width,c=t.height?t.height:t._height,u=t.pivot?t.pivot:{x:.5,y:.5},m=(t._corners,"visible");if(e.datavisualization.Diagram.Util.canShowResizeThumbs(r)){var p=e.datavisualization.Diagram.Rectangle(0,0,14,14),f=e.datavisualization.Diagram.Rectangle(g/2*a,0,14,14),_=e.datavisualization.Diagram.Rectangle(0,c/2*a,14,14);m=this._resizeHandleVisiblity(p,f,_)}l=e.datavisualization.Diagram.Point(g*u.x,-20/a),n&e.datavisualization.Diagram.SelectorConstraints.Rotator&&"umlclassifier"!=t.type&&(d=0,"hidden"==m&&(d=-20),this._updateRotateHandle("rotate",l.x,l.y+d,a,i,t),this._updatePivotLine(t,i,a,void 0,d)),n&e.datavisualization.Diagram.SelectorConstraints.Resizer&&("umlclassifier"!=t.type&&("label"==t._type&&(h=!(t.constraints&e.datavisualization.Diagram.LabelConstraints.Resizable)),this._updateResizeCorner("nw-resize",0,0,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest)),this._updateResizeCorner("n-resize",g/2*a,0,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorth)),this._updateResizeCorner("ne-resize",g*a,0,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast)),this._updateResizeCorner("w-resize",0,c/2*a,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeWest)),this._updateResizeCorner("e-resize",g*a,c/2*a,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeEast)),this._updateResizeCorner("sw-resize",0,c*a,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest)),this._updateResizeCorner("s-resize",g/2*a,c*a,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouth)),this._updateResizeCorner("se-resize",g*a,c*a,i,m,o,s,r,"label"==t._type?h:!(t.constraints&e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast))),this._updateResizeBorder("resizeBorder",t,i,a))}},_resizeHandleVisiblity:function(t,i,a){var n=e.datavisualization.Diagram.Geometry.intersectsRect(t,i),o=e.datavisualization.Diagram.Geometry.intersectsRect(t,a),s="visible";return(!0===n||!0===o)&&(s="hidden"),s},_updateRotateHandle:function(t,e,i,a,n){var o={id:"rotatehandle",transform:"translate("+(e*a-10)+","+(i*a-20)+")"};n.path(o),n.circle({id:"rotate",transform:"translate("+(e*a-10)+","+(i*a-20)+")"})},_updatePivotLine:function(t,i,a,n,o){var s,r=t.width?t.width:t._width,l=t.height?t.height:t._height,d=t.pivot?t.pivot:{x:.5,y:.5},h=e.datavisualization.Diagram.Point(r*d.x,-20/a);o&&(h.y+=o),s=n?e.datavisualization.Diagram.Point(r*d.x,l*d.y):e.datavisualization.Diagram.Point(r*d.x,0),i.line({id:"pivotLine",x1:h.x*a,y1:h.y*a,x2:s.x*a,y2:s.y*a})},_updateResizeBorder:function(t,i,a,n){var o=i.width?i.width:i._width,s=i.height?i.height:i._height;"umlclassifier"==i.type?e.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(t,i,a,n):a.rect({id:t,width:o*n,height:s*n})},_updateResizeCorner:function(t,i,a,n,o,s,r,l,d){var h={id:t,cx:i,cy:a,visibility:o};h=this._setPadding(h),e.datavisualization.Diagram.Util.canShowResizeThumbs(l)&&(r&&s!=t?h.visibility="hidden":("visible"==h.visibility||r)&&(h.visibility="visible")),n.circle(h),(h={id:t+"_transparent",cx:h.cx,cy:h.cy,visibility:h.visibility})["pointer-events"]="hidden"===h.visibility||d?"none":"all",n.circle(h)},_updateEndPointHandle:function(t,i,a){for(var n,o,s=e.datavisualization.Diagram.Util.canDragSegmentThumbs(t),r=0;r<t.segments.length;r++)o=(n=t.segments[r]).points,r==t.segments.length-1?(this._updateEndPointCorner("targetEndPoint",o[o.length-1].x*a,o[o.length-1].y*a,e.datavisualization.Diagram.Util.isTargetConnected(t),i,e.datavisualization.Diagram.Util.canDragTargetEnd(t)),"orthogonal"==n.type&&this._updateTerminalOrthoThumbs(n,i,a,r,s)):"orthogonal"!=n.type?this._updateSegmentEndThumb("segmentEnd_"+r,n._endPoint.x*a,n._endPoint.y*a,e.datavisualization.Diagram.Util.isSourceConnected(t),i,e.datavisualization.Diagram.Util.canDragSourceEnd(t)):this._updateTerminalOrthoThumbs(n,i,a,r,s),0==r&&this._updateEndPointCorner("sourceEndPoint",o[0].x*a,o[0].y*a,e.datavisualization.Diagram.Util.isSourceConnected(t),i,e.datavisualization.Diagram.Util.canDragSourceEnd(t)),"bezier"==n.type&&(this._updateEndPointCorner("bezierpoint1_"+r,n._point1.x*a,n._point1.y*a,!1,i,s),this._updateEndPointCorner("bezierpoint2_"+r,n._point2.x*a,n._point2.y*a,!1,i,s),this._updateBezierLine("bezierline1_"+r,n._startPoint,n._point1,a,i),this._updateBezierLine("bezierline2_"+r,n._endPoint,n._point2,a,i))},_updateEndPointCorner:function(t,e,i,a,n,o){var s,r=a?"#8CC63F":"white";o||(r="darkgray"),s={id:t,fill:r,cx:e,cy:i},n.circle(s)},_updateSegmentEndThumb:function(t,e,i,a,n){var o={id:t,cx:e,cy:i};n.circle(o)},_updateOrthoThumb:function(t,e,i,a,n,o,s){var r,l,d,h,g="#e2e2e2";s||(g="darkgray"),"horizontal"==o?(r="M0,7 L15,0 L30,7 L15,14 z",l=-15,d=-7):(r="M7,0 L0,15 L7,30 L14,15 z",l=-7,d=-15),h={id:t,visibility:n,transform:"translate("+(e+l)+","+(i+d)+")",d:r,fill:g},a.path(h)},_updateTerminalOrthoThumbs:function(t,i,a,n,o){var s,r,l,d;if(t.points.length>2)for(r=0;r<t.points.length-1;r++)d=e.datavisualization.Diagram.Geometry.distance(t.points[r],t.points[r+1]),s=t.points[r].y.toFixed(2)==t.points[r+1].y.toFixed(2)?"horizontal":"vertical",l=d>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+r+"_"+n,(t.points[r].x+t.points[r+1].x)/2*a,(t.points[r].y+t.points[r+1].y)/2*a,i,l,s,o);else d=t.length||e.datavisualization.Diagram.Geometry.distance(t._startPoint,t._endPoint),s=t._startPoint.y.toFixed(2)==t._endPoint.y.toFixed(2)?"horizontal":"vertical",l=d>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+n,(t._endPoint.x+t._startPoint.x)/2*a,(t._endPoint.y+t._startPoint.y)/2*a,i,l,s,o)},_updateBezierLine:function(t,e,i,a,n){n.line({id:t,x1:e.x*a,y1:e.y*a,x2:i.x*a,y2:i.y*a})},_updateControlPointCorner:function(t,e,i,a){a.circle({id:t+"_"+i,cx:e.x,cy:e.y})},updateUserHandles:function(t,i,a,n,o,s,r){var l,d=a.document.getElementById(a.document.id+"userHandle_g");if(r.model.selectedItems.constraints&e.datavisualization.Diagram.SelectorConstraints.UserHandles)if(d){if(t&&t.length>0)for(l=0;l<t.length;l++)(n&&t[l].enableMultiSelection||!n)&&this._updateHandle(t[l],i,a,o,s,r)}else this.renderUserHandles(t,i,a,n,s,r._adornerLayer,r)},_updateHandle:function(t,i,a,n,o,s){var r,l,d,h;!n&&i&&t.visible?(r=this._getHandlePosition(t,i,o,null,s),(l=t._absolutePath)&&t.size==t._size||(l=t._absolutePath=e.datavisualization.Diagram.Geometry.updatePath(0,0,t.size/2,t.size/2,t.pathData,a)),t._size=t._size,d=r.x*o,h=r.y*o,this._updateHandleShape(t,d,h,a),this._updateHanleIcon(t,l,a,d-t.size/4,h-t.size/4),a.getElementById(t.name+"_shape")&&t.visible&&(a.getElementById(t.name+"_shape").style.display="block",a.getElementById(t.name+"_icon").style.display="block")):a.getElementById(t.name+"_shape")&&(a.getElementById(t.name+"_shape").style.display="none",a.getElementById(t.name+"_icon").style.display="none")},clearSelector:function(t,e,i){var a=t.getElementById(t.document.id+"handle_g");a&&e.removeChild(a),(a=t.getElementById(t.document.id+"userHandle_g"))&&e.removeChild(a),i&&((a=i._svg.getElementById(i.element[0].id+"_multiselector"))&&a.parentNode.removeChild(a))},clearSegments:function(e){var i=e.getElementById(e.document.id+"handle_g");t(i).find(".segmentEnd").remove()},addSegments:function(t,e,i){t.getElementById(t.document.id+"handle_g");this._renderSegmentHandle(e,t,i)},_renderSegmentHandle:function(t,i,a){var n,o,s;if(!t.isPhase)for(n=e.datavisualization.Diagram.Util.canDragSegmentThumbs(t),o=0;o<t.segments.length;o++)"bezier"==(s=t.segments[o]).type&&(this._renderBezierLine("bezierline1_"+o,s._startPoint,s._point1,a,i,n),this._renderBezierLine("bezierline2_"+o,s._endPoint,s._point2,a,i,n),this._renderEndPointCorner("bezierpoint1_"+o,s._point1.x*a,s._point1.y*a,!1,i,n),this._renderEndPointCorner("bezierpoint2_"+o,s._point2.x*a,s._point2.y*a,!1,i,n)),s.points,0===o||o===t.segments.length-1||("orthogonal"!=s.type?this._renderSegmentEndThumb("segmentEnd_"+o,s._endPoint.x*a,s._endPoint.y*a,e.datavisualization.Diagram.Util.isSourceConnected(t),i,e.datavisualization.Diagram.Util.canDragSourceEnd(t)):this._renderTerminalOrthoThumbs(s,i,a,o,n))},_initializePageBreaks:function(t,e,i){var a=t.g(e);return i.appendChild(a),a},_renderVPageBreakLine:function(t,e,i,a){var n=i.line({x1:t.x,y1:t.y,x2:e.x,y2:e.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});a.appendChild(n)},_renderPageSettingsRect:function(t,e,i,a,n,o,s){var r=i.rect({id:"pageback",x:t.x,y:t.y,width:e.x,height:e.y,style:"fill:"+o+";stroke:"+n+";stroke-width:"+s});a.appendChild(r)},_updatePageBakground:function(t,i,a,n,o,s,r){var l=a.document.getElementById("pageback"),d={x:t.x,y:t.y,width:i.x<0?0:i.x,height:i.y<0?0:i.y,style:"fill:"+s+";stroke:"+o+";stroke-width:"+r};l&&e.datavisualization.Diagram.Util.attr(l,d)},_renderHPageBreakLine:function(t,e,i,a){var n=i.line({x1:t.x,y1:t.y,x2:e.x,y2:e.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});a.appendChild(n)},_removePageBreaks:function(t,e,i){null!=e&&null!=i&&i.removeChild(e)},removeChild:function(t,e){var i,a,n=e.svg.document.getElementById(t.name),o=e.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=this._findChild(o.childNodes,t),r=e.svg.document.parentNode.getElementsByClassName("AdornerLayer")[0];r&&(i=r.parentNode.getElementById(t.name+"_ej_ports")),n&&n.parentNode.removeChild(n),i&&i.parentNode.removeChild(i),s&&o.removeChild(s),"node"===t._type&&"html"===t.type&&((a=o.children[t.name+"_parentdiv"])&&a.parentNode&&a.parentNode.removeChild(a))}},e.datavisualization.Diagram.DiagramContext={_renderNodes:function(t,e,i,a){var n,o,s,r;if(a.nodes())for(o=0,s=(n=a.nodes()).length;o<s;++o)r=a.nameTable[n[o].name],t.svg||t._canvas,this._renderNodeObject(r,t,e,i,a)},_renderNodeObject:function(t,i,a,n,o){var s=i.svg||i._canvas;"group"!==t._type||t.parent?t.parent||i.context.renderNode(t,s,i.diagramLayer,null,o):(t.container,i.context.renderGroup(t,s,i.diagramLayer,o.nameTable,o,a,n),e.datavisualization.Diagram.DiagramContext.update(t,o))},_renderConnectors:function(t,e){var i,a,n,o;if(e.connectors()){for(i=e.connectors(),t.svg||t._canvas,n=0,o=i.length;n<o;++n)a=i[n],e._setZorder(a);for(n=0,o=i.length;n<o;++n)a=i[n],this._renderConnectorObject(a,t,e)}},_renderConnectorObject:function(t,i,a){var n=i.svg||i._canvas;e.datavisualization.Diagram.Util.updateBridging(t,a),t.parent||i.context.renderConnector(t,n,i.diagramLayer,a)},updateViewPort:function(t){var i;t._svgParentDimention=null,t._views.forEach(function(a){(i=t._views[a]).context==e.datavisualization.Diagram.SvgContext&&"mainview"==i.type&&e.datavisualization.Diagram.PageUtil._updatePageSize(t)})},renderNode:function(t,e,i){var a,n;e._views.forEach(function(o){a=e._views[o],n=a.svg||a._canvas,i&&(i=n.document.getElementById(i.id));var s="overview"==a.type;a.context.renderNode(t,n,i||a.diagramLayer,void 0,e,s)})},addLabel:function(t,e,i,a){var n,o;i._views&&i._views.forEach(function(s){n=i._views[s],o=n.svg||n.canvas,n.context._addLabel(t,e,o,i,a)})},renderPort:function(t,e,i,a){var n,o,s;i._views.forEach(function(r){n=i._views[r],s="overview"===n.type,o=n.svg||n._canvas,n.context._insertPort(t,e,s?o:i._adornerSvg,a,i,s)})},renderConnector:function(t,e,i){var a,n;e._views.forEach(function(o){a=e._views[o],n=a.svg||a._canvas,a.context.renderConnector(t,n,i||a.diagramLayer,e)})},renderGroup:function(t,e,i){var a,n;e._views.forEach(function(o){var s;a=e._views[o],n=a.svg||a._canvas,i=a.svg.getElementById(t.parent),"overview"==a.type&&(s=!0),a.context.renderGroup(t,n,i||a.diagramLayer,e.nameTable,e,null,s)})},update:function(t,e,i){var a,n,o=!0;t.isSwimlane&&e._disableSwimlaneUptate&&(o=!1),o&&e._views&&e._views.forEach(function(o){var s,r;a=e._views[o],n=a.svg||a._canvas,e&&!e._isInit&&"new"!==t._status&&(t._status="update"),s="overview"==a.type,"group"===t._type||"pseudoGroup"===t.type?a.context.updateGroup(t,n,e,i,s):t.segments?a.context.updateConnector(t,n,e,s):"label"==t._type?(r=e.findNode(t._parent),a.context.updateLabel(r,t,n,e)):a.context.updateNode(t,n,e,i,s)})},_refreshSegments:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,t.segments&&i.context._refreshSegments(t,a,e)})},_refreshOnlySegments:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,t.segments&&i.context._refreshOnlySegments(t,a,e)})},renderShadow:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i._canvas,i.context._renderShadow(t,a)})},updateShadow:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i._canvas,i.context._updateShadow(t,a)})},removeShadow:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i._canvas,i.context._removeShadow(t,a)})},addNodeLabel:function(t,e,i,a){var n,o;a._views&&a._views.forEach(function(s){n=a._views[s],o=n.svg||n.canvas,n.context.addNodeLabel(t,e,o,i,a)})},updateLabel:function(t,i,a){var n,o;a._views.forEach(function(s){n=a._views[s],o=n.svg||n.canvas,a.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg?n.context._updateSVGLabel(t,i,o,a):n.context.updateLabel(t,i,o,a)})},updatePort:function(t,e,i){var a,n;i._views.forEach(function(o){var s="overview"===(a=i._views[o]).type;n=s?a.svg||a.canvas:i._adornerSvg,a.context.updatePort(t,e,n,i)})},setLabelTemplate:function(t,e,i){var a,n;i._views.forEach(function(o){a=i._views[o],n=a.svg||a.canvas,a.context._updateLabelTemplate(t,e,n,i)})},setNodeShape:function(t,e,i){var a,n;e._views.forEach(function(o){a=e._views[o],n=a.svg||a.canvas,a.context.setNodeShape(t,n,i,e)})},setLine:function(t,e,i){var a,n;e._views.forEach(function(o){a=e._views[o],n=a.svg||a.canvas,a.context.setLine(t,n,i,e)})},renderDecorators:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,i.context.renderDecorators(t,a,e)})},clearDecorators:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,i.context.clearDecorators(t,a,e)})},updateTargetDecoratorStyle:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,i.context.updateTargetDecoratorStyle(t,a)})},updateSourceDecoratorStyle:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,i.context.updateSourceDecoratorStyle(t,a)})},updateNodeStyle:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,i.context._updateNodeStyle(t,a)})},updateLabelStyle:function(t,e,i){i._views.forEach(function(a){var n=i._views[a],o=n.svg||n.canvas;n.context.updateLabelStyle(t,e,o,i)})},updateConnectorStyle:function(t,e){var i,a;e._views.forEach(function(n){i=e._views[n],a=i.svg||i.canvas,i.context._updateConnectorStyle(t,a)})},updateTextBlock:function(t,e,i){var a,n;i._views.forEach(function(o){a=i._views[o],n=a.svg||a.canvas,a.context.updateTextBlock(t,e,n,i)})},updateBPMNNodeStyle:function(t,i){var a,n,o=0;if((t=e.datavisualization.Diagram.Util._updateBpmnChild(t,i)).children)for(n=i._getChildren(t.children),o=0;o<n.length;o++)a=i.nameTable[n[o]],e.datavisualization.Diagram.DiagramContext.updateNodeStyle(a,i,t);else e.datavisualization.Diagram.DiagramContext.updateNodeStyle(t,i)},updateBPMNNodeShape:function(t,i){var a,n,o,s=0;if(t=e.datavisualization.Diagram.Util._updateBpmnChild(t,i),(n=i._getChildren(t.children)).length>0&&i.nameTable[n[0]])for(s=0;s<n.length;s++)(a=i.nameTable[n[s]])&&e.datavisualization.Diagram.DiagramContext.setNodeShape(a,i,t);else(o=i._svg.getElementById(t.name)).parentNode.removeChild(o),i.add(t)}}}(jQuery,Syncfusion),function(t,e,i){"use strict";e.widget("ejSymbolPalette","ej.datavisualization.SymbolPalette",{element:null,model:null,_requiresID:!0,validTags:["div"],nameTable:{},defaults:{width:"250px",height:"400px",labelRenderingMode:"html",paletteItemWidth:i,paletteItemHeight:i,previewWidth:i,previewHeight:i,previewOffset:{x:110,y:110},diagramId:"",headerHeight:30,selectedPaletteName:"",cssClass:"e-datavisualization-symbolpalette",showPaletteItemText:!0,allowDrag:!0,palettes:[],defaultSettings:{connector:null,node:null},selectionChange:null,create:null,destroy:null},_oldItem:null,_labelHashTable:{},dataTypes:{paletteItemWidth:"number",paletteItemHeight:"number",previewWidth:"number",previewHeight:"number",headerHeight:"number",showPaletteItemText:"boolean",allowDrag:"boolean",palettes:"array"},_canvas:null,_init:function(){"msie"===e.browserInfo().name&&Number(e.browserInfo().version)<9||(this.nameTable={},this.selectedItem=null,this.activePalette=null,this._selectedElement=null,this._renderSymbolPalette(),this._wireEvents(),this.updateScrollerViewport())},_setModel:function(e){var i,a;for(i in e)switch(i){case"width":this._setWidth(e[i]);break;case"height":this._setHeight(e[i]);break;case"paletteItemWidth":this.model.paletteItemWidth=e[i],this._redrawContent();break;case"paletteItemHeight":this.model.paletteItemHeight=e[i],this._redrawContent();break;case"headerHeight":this._setHeaderHeight(e[i]);break;case"cssClass":this._setCssClass(e[i]);break;case"showPaletteItemText":this._showItemText(e[i]);break;case"allowDrag":this._setAllowDrag(e[i]);break;case"palettes":this._updatePalettes(e[i]);break;case"selectedPaletteName":(a=this._getPalette(e.selectedPaletteName))&&a!==this.activePalette&&(t(this._getPaletteHeaderDiv(this.activePalette.name)).removeClass("selected"),this.activePalette=a,t(this._getPaletteHeaderDiv(this.activePalette.name)).addClass("selected"))}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_renderSymbolPalette:function(){this._canvas=document.createElement("div"),this._canvas.setAttribute("class","e-scanvas"),this._canvas.setAttribute("id",this.element[0].id+"_canvas"),this.element[0].setAttribute("style","height:"+this.model.height+"; width:"+this.model.width+";"),this.element.append(this._canvas),this.element.ejScroller({width:this._setViewPortWidth(),height:this._setViewPortHeight(),enableTouchScroll:!1}),this._renderPalettes()},_updatePalettes:function(e){this.model.palettes=e,t("#"+this.element[0].id+"_canvas").empty(),this._renderPalettes(),this.updateScrollerViewport()},_renderPalettes:function(){var t,i,a=this.model.palettes;if(a)for(t=0,i=a.length;t<i;t++)a[t]=e.datavisualization.Diagram.Palette(a[t]),this._initPaletteitems(a[t]),this._renderPalette(a[t])},_updatePaletteItemWidth:function(t){var i=e.datavisualization.Diagram.Util.bounds(t);t.segments?i.width>this.element.width()-40&&!t.paletteItem&&e.datavisualization.Diagram.Util.scale(t,(this.element.width()-45)/i.width,1,i.center):t.width>this.element.width()-40?t.width=this.element.width()-40:t.paletteItem&&t.paletteItem.width&&t.paletteItem.width>this.element.width()-40&&(t.paletteItem.width=this.element.width()-40)},_renderHtmlLayer:function(t,i){var a,n=document.createElement("div"),o={id:t.id+"_htmlLayer",class:"htmlLayer"};return e.datavisualization.Diagram.Util.attr(n,o),a=n,n.style.pointerEvents="none",n.style.position="absolute",n.style.left=i?i.style.paddingLeft:"0px",n.style.top=i?i.style.paddingTop:"0px",t.appendChild(a),a},_initPaletteitems:function(t){if(t.items)for(var e=0;e<t.items.length;e++)t.items[e]=this._extendPaletteItem(t.items[e])},_initGroupNode:function(i){for(var a=null,n=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,o=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null,s=0;s<i.children.length;s++)"object"==typeof(a=i.children[s])&&("group"==a._type?(a=e.datavisualization.Diagram.Group(t.extend(!0,{},n,a)),a=e.datavisualization.Diagram.Util._updateBpmnChild(a,this),this._initGroupNode(a)):a=a.segments?e.datavisualization.Diagram.Connector(t.extend(!0,{},o,a)):e.datavisualization.Diagram.Node(t.extend(!0,{},n,a)),(a=e.datavisualization.Diagram.NodeType(a,this)).parent=i.name,i.children[s]=a,this.nameTable[a.name]=a)},_setViewPortWidth:function(){this.element[0].setAttribute("style","width:"+this.model.width+";");var t=this.element.width();return Math.abs(t)},_setViewPortHeight:function(){this.element[0].setAttribute("style","height:"+this.model.height+";");var t=this.element.height();return Math.abs(t)},_renderPalette:function(t){this._renderHeader(t),this._updateHeaderWrapper(t,this.model.headerHeight),this._renderContent(t),this._collapse(t),this._updatePaletteVisibility(t)},_renderHeader:function(i){var a=document.createElement("div"),n={id:i.name.replace(/\s/gi,"_")+"_header",class:"e-header",style:"height:"+this.model.headerHeight+"px;"};i.constraints&this._canHeaderVisible(i)||(n.style+="display:none"),e.datavisualization.Diagram.Util.attr(a,n),this._renderHeaderArrow(a,i.expanded,i.name,this._canExpand(i)),i.templateId&&t.templates?this._renderHeaderTemplate(a,i):this._renderHeaderText(a,i.name),this._addExpandedClass(a,i.expanded),this._disableClickClass(a,this._canExpand(i)),this.model.selectedPaletteName===i.name&&(t(a).addClass("selected"),this.activePalette=i),this._canvas.appendChild(a)},_renderHeaderText:function(t,e){var i=document.createElement("span");i.setAttribute("class","e-header-text"),i.innerHTML=e,t.appendChild(i)},_renderHeaderTemplate:function(t,i){var a=this._renderEjTemplate("#"+i.templateId,i),n=document.createElement("div"),o={id:i.name+"_Wrapper",class:"e-header-wrapper"};e.datavisualization.Diagram.Util.attr(n,o),this._renderTemplateContent(i,n,a),t.appendChild(n)},_renderTemplateContent:function(i,a,n){var o,s=document.createElement("div");s.innerHTML=n,s.style.display="inline-block",document.body.appendChild(s),(o=s.cloneNode(!0)).id=i.name+"_templateHeader";var r=s.offsetWidth,l=s.offsetHeight,d=t("#"+this._id).width()-18/r,h=this.model.headerHeight/l,g=Math.min(d,h),c=(g-1)*r/2;e.datavisualization.Diagram.Util.attr(o,{style:"position: relative; left: "+c+"px; transform: scale("+g+")"}),a.appendChild(o),s.parentNode.removeChild(s)},_renderHeaderArrow:function(e,i,a,n){var o,s;n?(o=e.getElementsByClassName("e-header-arrow e-icon")[0])||((o=document.createElement("span")).setAttribute("class","e-header-arrow e-icon"),o.setAttribute("style","top:"+(this.model.headerHeight-16)/2+"px;"),this._addExpandedClass(o,i),this.model.selectedPaletteName===name&&t(o).addClass("selected"),e.appendChild(o)):(s=e.getElementsByClassName("e-header-arrow e-icon")[0])&&s.parentNode.removeChild(s)},_renderContent:function(t){var e,i,a,n=this._getPaletteContentDiv(t.name);if(n||(n=document.createElement("div"),this._canvas.appendChild(n)),n.setAttribute("id",t.name.replace(/\s/gi,"_")+"_content"),n.setAttribute("class","e-scontent"),this.model.palettes.length-1===this.model.palettes.indexOf(t)&&n.setAttribute("style","border-bottom-width: 0px;"),(e=t.items)&&e.length>0)for(i=0,a=e.length;i<a;i++)e[i].parent?this.nameTable[e[i].name]=e[i]:(this._renderItem(e[i],n),this.nameTable[e[i].name]=e[i])},_getPaletteContentDiv:function(e){return t(this.element).find("#"+e.replace(/\s/gi,"_")+"_content")[0]},_getPaletteHeaderDiv:function(e){return t(this.element).find("#"+e.replace(/\s/gi,"_")+"_header")[0]},_updateRenderSize:function(t,i,a){var n,o;if(!t.paletteItem||"group"===t.type&&!t.isLane||"group"===t._type&&"bpmn"===t.type)t.segments?(s=e.datavisualization.Diagram.Util.bounds(t),e.datavisualization.Diagram.Util._translate(t,i.width/2-s.center.x,i.height/2-s.center.y,this.nameTable)):"group"==t._type?this._checkItemUpdate(t)?(n=i.width/t.width,o=i.height/t.height,this.scale(t,n,o,t.pivot,a,null,null,null,this),e.datavisualization.Diagram.Util._translate(t,i.width/2-t.offsetX,i.height/2-t.offsetY,a,null,this)):e.datavisualization.Diagram.Util._translate(t,t.width/2-t.offsetX,t.height/2-t.offsetY,a,null,this):(t.width=i.width,t.height=i.height,t.offsetX=i.width/2,t.offsetY=i.height/2);else if(t.segments&&t.paletteItem&&t.paletteItem.enableScale&&!t.isPhase){var s=e.datavisualization.Diagram.Util.bounds(t),r=(t.paletteItem.width?t.paletteItem.width:this.model.paletteItemWidth)/s.width,l=(t.paletteItem.height?t.paletteItem.height:this.model.paletteItemHeight)/s.height;e.datavisualization.Diagram.Util.scale(t,r,l,{x:.5,y:.5}),this._updatePaletteItemWidth(t)}else if(t.segments&&t.paletteItem&&t.paletteItem.enableScale&&!t.isPhase||t.isPhase&&t.paletteItem.width!=t.paletteItem.height){s=e.datavisualization.Diagram.Util.bounds(t),r=(t.paletteItem.width?t.paletteItem.width:this.model.paletteItemWidth)/s.width,l=(t.paletteItem.height?t.paletteItem.height:this.model.paletteItemHeight)/s.height;e.datavisualization.Diagram.Util.scale(t,r,l,{x:.5,y:.5}),this._updatePaletteItemWidth(t)}else"node"==t._type&&this._checkItemUpdate(t)&&(t.width=i.width,t.height=i.height,t.offsetX=i.width/2,t.offsetY=i.height/2)},_checkItemUpdate:function(t){return!t.paletteItem||!t.paletteItem.enableScale},_updatePreviewSize:function(t,i){var a,n;if(t.paletteItem&&("group"!==t.type||t.isLane))if(t.segments&&t.paletteItem&&t.paletteItem.enableScale&&!t.isPhase){var o=e.datavisualization.Diagram.Util.bounds(t),s=(t.paletteItem.previewWidth?t.paletteItem.previewWidth:this.model.previewWidth)/o.width,r=(t.paletteItem.previewHeight?t.paletteItem.previewHeight:this.model.previewHeight)/o.height;e.datavisualization.Diagram.Util.scale(t,s,r,{x:.5,y:.5}),this._updatePaletteItemWidth(t)}else if(t.segments&&t.paletteItem&&t.paletteItem.enableScale&&!t.isPhase||t.isPhase&&t.paletteItem.previewWidth!=t.paletteItem.previewHeight){o=e.datavisualization.Diagram.Util.bounds(t),s=(t.paletteItem.previewWidth?t.paletteItem.previewWidth:this.model.previewWidth)/o.width,r=(t.paletteItem.previewHeight?t.paletteItem.previewHeight:this.model.previewHeight)/o.height;e.datavisualization.Diagram.Util.scale(t,s,r,{x:.5,y:.5}),this._updatePaletteItemWidth(t)}else("node"==t._type||"group"==t._type)&&(t.width=i.width,t.height=i.height,t.offsetX=i.width/2,t.offsetY=i.height/2);else t.segments?(o=e.datavisualization.Diagram.Util.bounds(t),e.datavisualization.Diagram.Util._translate(t,i.width/2-o.center.x,i.height/2-o.center.y,this.nameTable)):t.container&&!t.isLane?(a=i.width/t.width,n=i.height/t.height,this.scale(t,a,n,t.pivot,this.nameTable,null,null,null,this),e.datavisualization.Diagram.Util._translate(t,i.width/2-t.offsetX,i.height/2-t.offsetY,this.nameTable,null,this)):(t.width=i.width,t.height=i.height,t.offsetX=i.width/2,t.offsetY=i.height/2)},_getRenderItemSize:function(t){var i,a,n,o,s,r=this.model.paletteItemWidth,l=this.model.paletteItemHeight;return t.segments?(s=e.datavisualization.Diagram.Util.bounds(t),t.paletteItem?(r=t.paletteItem.width?t.paletteItem.width:r,l=t.paletteItem.height?t.paletteItem.height:l,r=r||t.width,l=l||t.height,t.paletteItem.width=r,t.paletteItem.height=l):(s=e.datavisualization.Diagram.Util.bounds(t),r=r||s.width,l=l||s.height)):"group"===t.type?(s=e.datavisualization.Diagram.Util._getChildrenBounds(t,this),t.paletteItem&&!t.isLane?(r=t.paletteItem.width?t.paletteItem.width:r,l=t.paletteItem.height?t.paletteItem.height:l,r=r||s.width,l=l||s.height,t.paletteItem.width=r,t.paletteItem.height=l):t.paletteItem&&t.isLane?t.paletteItem.enableScale?(r=t.paletteItem.width?t.paletteItem.width:r,l=t.paletteItem.height?t.paletteItem.height:l,r=r||s.width,l=l||s.height,t.paletteItem.width=r,t.paletteItem.height=l):(i=(t.paletteItem.width?t.paletteItem.width:this.model.paletteItemWidth)/t.width,a=(t.paletteItem.height?t.paletteItem.height:this.model.paletteItemHeight)/t.height,e.datavisualization.Diagram.Util.scale(t,i,a,{x:.5,y:.5},this.nameTable,!1,!1,!1,this),n=1e-4,o=.001,t.isLane&&t.paletteItem&&!t.paletteItem.enableScale&&("horizontal"===t.orientation?n-=2.2:n+=.8,o-=1),e.datavisualization.Diagram.Util._translate(t,n,o,this.nameTable,!1,this),r=t.width?t.width:r,l=t.height?t.height:l):(r=r||s.width,l=l||s.height)):t.paletteItem?(r=t.paletteItem.width?t.paletteItem.width:r,l=t.paletteItem.height?t.paletteItem.height:l,r=r||t.width,l=l||t.height,t.paletteItem.width=r,t.paletteItem.height=l):(r=(s=e.datavisualization.Diagram.Util.bounds(t)).width?s.width:r,l=s.height?s.height:l),{width:r,height:l}},_renderPetternDefinition:function(t,e){if(t&&e){var i=e.document.getElementById(t+"patterndefinition");i||(i=e.defs({id:t+"patterndefinition"}),e.appendChild(i))}},_cloneFromChildTable:function(i,a){for(var n,o=0;i.children&&o<i.children.length;o++)(n=t.extend(!0,{},this.nameTable[e.datavisualization.Diagram.Util.getChild(i.children[o])]))&&(a[e.datavisualization.Diagram.Util.getChild(i.children[o])]=n,n.children&&n.children.length>0&&this._cloneFromChildTable(n,a));return a},_renderItem:function(e,i){var a,n=t.extend(!0,{},e),o=this._getRenderItemSize(n),s=this._cloneFromChildTable(e,{});return this._updateRenderSize(n,o,s),a=this._renderItemContainer(n.name,i,null,o,n),n.segments?this._renderConnector(n,a,o):"node"!=n._type||n.children&&n.children.length>0?this._renderGroup(n,a,o,s):this._renderNode(n,a,o),n.isLane&&n.paletteItem&&!n.paletteItem.enableScale&&"vertical"===n.orientation&&a.document.setAttribute("height",o.height+2),n},_getPreviewItemSize:function(t){var i,a=this.model.previewWidth,n=this.model.previewHeight;return t.segments?(i=e.datavisualization.Diagram.Util.bounds(t),t.paletteItem?(a=t.paletteItem.previewWidth?t.paletteItem.previewWidth:a,n=t.paletteItem.previewHeight?t.paletteItem.previewHeight:n,a=a||t.width,n=n||t.height,a=a||i.width,n=n||i.height,t.paletteItem.previewWidth=a,t.paletteItem.previewHeight=n):(i=e.datavisualization.Diagram.Util.bounds(t),a=a||i.width,n=n||i.height)):"group"===t.type?(i=e.datavisualization.Diagram.Util._getChildrenBounds(t,this),t.paletteItem&&!t.isLane?(a=t.paletteItem.previewWidth?t.paletteItem.previewWidth:a,n=t.paletteItem.previewHeight?t.paletteItem.previewHeight:n,a=a||i.width,n=n||i.height,t.paletteItem.previewWidth=a,t.paletteItem.previewHeight=n):t.paletteItem&&t.isLane?t.paletteItem.enableScale?(a=t.paletteItem.previewWidth?t.paletteItem.previewWidth:a,n=t.paletteItem.previewHeight?t.paletteItem.previewHeight:n,a=a||i.width,n=n||i.height,t.paletteItem.previewWidth=a,t.paletteItem.previewHeight=n):(a=t.paletteItem.previewWidth?t.paletteItem.previewWidth:a,n=t.paletteItem.previewHeight?t.paletteItem.previewHeight:n):(a=a||i.width,n=n||i.height)):t.paletteItem?(a=t.paletteItem.previewWidth?t.paletteItem.previewWidth:a,n=t.paletteItem.previewHeight?t.paletteItem.previewHeight:n,a=a||t.width,n=n||t.height,t.paletteItem.previewWidth=a,t.paletteItem.previewHeight=n):(a=(i=e.datavisualization.Diagram.Util.bounds(t)).width?i.width:a,n=i.height?i.height:n),{width:a,height:n}},_renderItemContainer:function(t,i,a,n,o){var s=document.createElement("div"),r=this.model.showPaletteItemText?n.height+18:n.height,l=n.width,d=o&&o.paletteItem?o.paletteItem.margin.left:4,h=o&&o.paletteItem?o.paletteItem.margin.top:4,g={id:t+"_paletteItem",draggable:"true",height:r+"px",width:l+"px",class:"e-paletteItem",style:"padding-left:"+d+"px;padding-right:"+((o&&o.paletteItem?o.paletteItem.margin.right:4)+2)+"px;padding-top:"+(h+1)+"px;padding-bottom:"+((o&&o.paletteItem?o.paletteItem.margin.bottom:4)+1)+"px;height:"+(r+1)+"px;width:"+(l+1)+"px;-ms-touch-action: none;touch-action: none;"};return e.datavisualization.Diagram.Util.attr(s,g),i.appendChild(s),this.model.allowDrag&&this._setItemDraggable(s),this._renderAnchor(s,t,n,o)},_renderAnchor:function(t,i,a,n){var o,s=document.createElement("div"),r={id:i+"_anchor",height:a.height+"px",class:"e-anchor"};return e.datavisualization.Diagram.Util.attr(s,r),t.appendChild(s),o=this._renderSvg(s,i,a),this._renderText(s,i,a,n),o},_renderSvg:function(i,a,n){var o,s,r=document.createElement("div"),l={id:a+"_svgWrapper",width:this.model.paletteItemWidth+"px;",height:+this.model.paletteItemHeight+"px;",class:"e-svg-container",style:"width:"+n.width+"px;height:"+n.height+"px;"};return e.datavisualization.Diagram.Util.attr(r,l),l={id:a+"_svg",width:n.width,height:n.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},s=new e.datavisualization.Diagram.Svg(l),r.appendChild(s.document),i.id.split("_clone").length>1&&(o=t(i).parents(".e-paletteItem")[0]),this._renderHtmlLayer(r,o),i.appendChild(r),s},_renderText:function(t,i,a,n){var o,s,r,l=document.createElement("div");l.setAttribute("class","e-text-container"),l.setAttribute("style","width:"+a.width+"px; text-align : center;overflow: hidden;text-overflow: ellipsis;font-size: 12px;"),(o=document.createElement("span")).setAttribute("class","e-paletteItemText"),n&&n.paletteItem&&(i=n.paletteItem.label?n.paletteItem.label:i),o.innerHTML=i.split("_clone").length>1?i.split("_clone")[0]:i,n&&n.paletteItem.wrapping==e.datavisualization.Diagram.TextWrapping.NoWrap&&(o.style.whiteSpace="nowrap",o.style.wordWrap="normal"),n&&n.paletteItem.wrapping==e.datavisualization.Diagram.TextWrapping.Wrap&&(o.style.whiteSpace="pre-wrap",o.style.wordBreak="break-all",o.style.wordWrap="break-word"),n&&n.paletteItem.wrapping==e.datavisualization.Diagram.TextWrapping.WrapWithOverflow&&(o.style.whiteSpace="pre-wrap",o.style.wordWrap="break-word"),l.appendChild(o),this.model.showPaletteItemText||(l.style.display="none"),t.appendChild(l),n&&!n.paletteItem.enableScale&&(s=document.getElementById(n.name+"_paletteItem"),r=document.getElementById(n.name+"_anchor").lastChild.getBoundingClientRect(),s.style.height=a.height+r.height+"px")},_renderNode:function(t,i,a){this._renderPetternDefinition(i.id+"_"+t.name,i);var n=e.datavisualization.Diagram.SvgContext.renderNode(t,i,null,!0,this),o=!1;null!=i.document.getAttribute("drag")&&(o=!0),this._transformItem(n,t.width,t.height,t,o,a)},_updateChildBounds:function(t,i){var a,n,o=null;if("group"==t._type){for(a=this._getChildren(t.children),n=0;n<a.length;n++)"group"==(o=i[a[n]]).shape&&this._updateChildBounds(o,i);e.datavisualization.Diagram.Util._updateChildBounds(t,this)}},_getChild:function(t){return e.datavisualization.Diagram.Util.getChild(t)},_getChildren:function(t){var e,i,a;if(t){for(e=[],i=0;i<t.length;i++)(a=t[i])&&("object"==typeof a?e.push(a.name):"string"==typeof a&&e.push(a));return e}},_renderGroup:function(t,i,a,n){this._renderPetternDefinition(i.id+"_"+t.name,i),n||(n=this.nameTable),(!t.container||t.isLane)&&this._updateChildBounds(t,n);var o=e.datavisualization.Diagram.SvgContext.renderGroup(t,i,null,n,this,!1,!0),s=!1;null!=i.document.getAttribute("drag")&&(s=!0),this._transformItem(o,t.width,t.height,t,s,a)},_renderConnector:function(t,i,a){var n=e.datavisualization.Diagram.SvgContext.renderConnector(t,i,null,this),o=e.datavisualization.Diagram.Util.bounds(t),s=!1;null!=i.document.getAttribute("drag")&&(s=!0),this._transformItem(n,o.width,o.height,t,s,a)},_wireEvents:function(){this._on(this.element,e.eventType.click,".e-header",this._headerClick),this._on(this.element,e.eventType.mouseDown,".e-header",this._headerMouseDown),this._on(this.element,"mouseover",".e-header",this._headerMouseOver),this._on(this.element,"mouseout",".e-header",this._headerMouseOut),this._on(this.element,e.eventType.mouseDown,".e-paletteItem",this._itemMouseDown),this._on(this.element,"mouseover",".e-paletteItem",this._itemMouseOver),this._on(this.element,"mouseout",".e-paletteItem",this._itemMouseOut),this._on(this.element,e.eventType.click,".e-anchor",this._itemClick)},_headerClick:function(t){this._expandOrCollapsePalette("",t.currentTarget);var e=this._getActivePalette(t.currentTarget.id);e&&e!==this.activePalette&&(this.activePalette=e)},_headerMouseDown:function(t){t.preventDefault(),t.stopPropagation()},_headerMouseOver:function(e){var i=this._getActivePalette(e.currentTarget.id);i&&this._canExpand(i)&&(t(e.currentTarget).addClass("hover"),t(e.currentTarget).find(".e-header-arrow").addClass("hover"))},_headerMouseOut:function(e){t(e.currentTarget).removeClass("hover"),t(e.currentTarget).find(".e-header-arrow").removeClass("hover")},_itemMouseDown:function(i){var a,n,o,s,r,l,d;if(this.model.diagramId&&((a=t("#"+this.model.diagramId).ejDiagram("instance")).activeTool instanceof e.datavisualization.Diagram.LineTool&&(a.activeTool._showAllPorts(!0),a.deactivateTool())),this.model.allowDrag||(i.preventDefault(),i.stopPropagation()),this._selectedElement?this._selectedElement!==i.currentTarget&&(t(this._selectedElement).removeClass("selected"),this._selectedElement=i.currentTarget):this._selectedElement=i.currentTarget,t(i.currentTarget).hasClass("selected")||t(i.currentTarget).addClass("selected"),(n=this._getActivePalette(i.currentTarget.parentElement.id))&&n!==this.activePalette&&(this._clearHeaderSelection(),this._updateHeaderSelection(t(i.currentTarget.parentElement).prev()),this.activePalette=n),this.activePalette&&this._selectedElement)for(o=this._selectedElement.id.slice(0,this._selectedElement.id.lastIndexOf("_")),r=0,l=(s=this.activePalette.items).length;r<l;r++)(d=s[r]).name===o&&(this.selectedItem=d)},_itemMouseOver:function(e){t(e.currentTarget).addClass("hover")},_itemMouseOut:function(e){t(e.currentTarget).removeClass("hover")},_itemDraStart:function(t){var e=t.originalEvent.dataTransfer;e.setData("Text",this.element[0].id),e.effectAllowed="copy"},_itemClick:function(i){var a,n,o,s,r,l,d,h,g,c,u;if(("click"===i.type||"touchend"===i.type&&!t(".dragClone")[0])&&this.model.diagramId){if(a=t("#"+this.model.diagramId).ejDiagram("instance"),(n=t.extend(!0,{},this.selectedItem)).name+=e.datavisualization.Diagram.Util.randomId(),"bpmn"==n.type&&(n.children=[]),"group"==a.getObjectType(n)){for(o=this._getChildren(n.children),s=0;s<o.length;s++)(r=t.extend(!0,{},this.nameTable[o[s]])).parent=n.name,r.name=n.name+r.name,n.children[s]=r.name,a.nameTable[r.name]=r,a.nodes().push(r),a._nodes=t.extend(!0,[],a.nodes()),a.nameTable[r]&&a._updateQuad(a.nameTable[r]);n.isLane||(n.height=n.width=0,a._updateChildBounds(n,a.nameTable))}n&&n.isLane&&(l=e.datavisualization.Diagram.Util.randomId(),a._cloneGroupNode(n,l),(d=e.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(n,a.nameTable)).isLane=n.isLane,d.orientation=n.orientation,d.height=120,d=e.datavisualization.Diagram.Lane(d),(h=e.datavisualization.Diagram.SwimLaneHelper._createSwimlane(d,a,null,!0))&&(h.offsetX+=10,h.offsetY+=40)),g=t.extend(!0,{},this._oldItem),c=h||n,this._oldItem=t.extend(!0,{},c),u={oldElement:g,newElement:c},this._trigger("selectionChange",u)}},_updatePaletteVisibility:function(t){this._canHeaderVisible(t)&&(this._canPaletteVisible(t)?(this._getPaletteHeaderDiv(t.name).style.display="",this._getPaletteContentDiv(t.name).style.display=""):(this._getPaletteHeaderDiv(t.name).style.display="none",this._getPaletteContentDiv(t.name).style.display="none"))},_collectionChanged:function(t){var e,i,a;"insert"==t.changeType?this._renderPalette(t.element):"remove"==t.changeType&&(null!=(e=t.element)&&((i=this._getPaletteHeaderDiv(e.name))&&i.parentNode.removeChild(i),(a=this._getPaletteContentDiv(e.name))&&a.parentNode.removeChild(a)))},_extendPaletteItem:function(i){var a=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,n=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null;return i.shape&&"object"==typeof i.shape?e.datavisualization.Diagram.Util._updateShapeProperties(i):i=e.datavisualization.Diagram.NodeType(i,this),"connector"==i.type?i=e.datavisualization.Diagram.Connector(t.extend(!0,{},n,i)):i.isLane?i=e.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(i,this.nameTable):"phase"==i.type?i=e.datavisualization.Diagram.Util._mapPalettePhase(i):i.container?i=e.datavisualization.Diagram.ContainerHelper._initContainer(this,i):"group"===i._type||i.children&&i.children.length>0?(i=e.datavisualization.Diagram.Group(t.extend(!0,{},a,i)),i=e.datavisualization.Diagram.Util._updateBpmnChild(i,this),this._getNewGroup(i),this._initGroupNode(i,this),e.datavisualization.Diagram.Util._updateGroupBounds(i,this)):i=e.datavisualization.Diagram.Node(t.extend(!0,{},a,i)),i},addPaletteItem:function(t,e){for(var i,a,n,o,s,r=0;r<this.model.palettes.length;r++)for(i=[],e.length?i=e:i.push(e),a=0;a<i.length;a++)(s=this.model.palettes[r]).name===t&&(n=this._extendPaletteItem(i[a]),s.items.push(n),o=this._getPaletteContentDiv(t),this.nameTable[n.name]=n,this._renderItem(n,o))},removePaletteItem:function(i,a){for(var n,o,s,r,l,d,h,g,c=0;c<this.model.palettes.length;c++)for(n=[],a.length?n=a:n.push(a),o=0;o<n.length;o++)if((g=this.model.palettes[c]).name===i){if(s=n[o],e.datavisualization.Diagram.Util.removeItem(g.items,s),delete this.nameTable[s.name],s.children&&s.children.length)for(r=0;r<s.children.length;r++)(l=s.children[r])&&("object"==typeof l?delete this.nameTable[l.name]:delete this.nameTable[l]);h=this._getPaletteContentDiv(i),(d=t(h).find("#"+s.name+"_paletteItem")[0])&&(h.removeChild(d),this.selectedItem=null)}},expandPalette:function(t){var e=this._findPalette(t);e&&!e.expanded&&this._canExpand(e)&&(e.expanded=!0,this._expandOrCollapsePalette(t))},collapsePalette:function(t){var e=this._findPalette(t);e&&e.expanded&&this._canExpand(e)&&(e.expanded=!1,this._expandOrCollapsePalette(t))},addPalette:function(t){this.model.palettes.push(t),this._renderPalette(t)},removePalette:function(t){for(var i,a,n,o=0;o<this.model.palettes.length;o++)(n=this.model.palettes[o]).name===t&&(e.datavisualization.Diagram.Util.removeItem(this.model.palettes,n),(i=this._getPaletteHeaderDiv(n.name))&&i.parentNode.removeChild(i),(a=this._getPaletteContentDiv(n.name))&&a.parentNode.removeChild(a))},setWidth:function(t){this.model.width=t,this._setWidth(t)},setHeight:function(t){this.model.height=t,this._setHeight(t)},setPaletteItemWidth:function(t){this.model.paletteItemWidth=t,this._redrawContent()},setPaletteItemHeight:function(t){this.model.paletteItemHeight=t,this._redrawContent()},setHeaderHeight:function(t){this.model.headerHeight=t,this._setHeaderHeight(t)},setCssClass:function(t){this._setCssClass(t),this.model.cssClass=t},showPaletteItemText:function(t){this._showItemText(t),this.model.showPaletteItemText=t},searchPalette:function(t,i){var a=new e.datavisualization.Diagram.Collection;return""!=i&&(t=this._getSearchPaletteItems(i),a.add(t)),a},updatePalette:function(t,e){var a,n=this._findPalette(t);n&&e&&(e.constraints&&n.constraints!=e.constraints&&(n.constraints=e.constraints,a=this._getPaletteHeaderDiv(n.name),this._renderHeaderArrow(a,n.expanded,n.name,this._canExpand(n)),this._disableClickClass(a,this._canExpand(n)),this._updatePaletteVisibility(n),a.style.display=this._canHeaderVisible(n)&&this._canPaletteVisible(n)?"":"none"),e.expanded!=i&&this._canExpand(n)&&(n.expanded=e.expanded,this._expandOrCollapsePalette(t)),e.items&&e.items.length>0&&(this._getPaletteContentDiv(n.name).innerHTML="",n.items=e.items,this._initPaletteitems(n),this._renderContent(n))),this.updateScrollerViewport()},_findPalette:function(t){for(var e,i=0;i<this.model.palettes.length;i++)if(this.model.palettes[i].name==t||this.model.palettes[i].name==t.replace(/\_/gi," ")){e=this.model.palettes[i];break}return e},_canExpand:function(t){return t.constraints&e.datavisualization.Diagram.PaletteConstraints.Expandable},_canHeaderVisible:function(t){return t.constraints&e.datavisualization.Diagram.PaletteConstraints.HeaderVisibility},_canPaletteVisible:function(t){return t.constraints&e.datavisualization.Diagram.PaletteConstraints.Visible},_canClick:function(t){var e,i;if(t&&((e=t.id.split("_header")[0])&&(i=this._findPalette(e),this._canExpand(i))))return!0},_expandOrCollapsePalette:function(e,i){var a;if(i=i||(e?this._getPaletteHeaderDiv(e):null)){if(!this._canClick(i))return!1;a=this,t(i).next(".e-scontent").slideToggle(200,function(){a._refresh()}),this._updateHeaderState(i)}},_getSearchPaletteItems:function(t){for(var i,a=new e.datavisualization.Diagram.Palette,n=this.model.palettes,o=0;o<n.length;o++)if(n[o].name.toLocaleLowerCase().search(t.toLocaleLowerCase())>=0)for(i=0;i<n[o].items.length;i++)this.element.find("#"+n[o].items[i].name+"_paletteItem")[0].style.display="block";else for(i=0;i<n[o].items.length;i++)this.element.find("#"+n[o].items[i].name+"_paletteItem")[0].style.display=n[o].items[i].name.toLocaleLowerCase().search(t.toLocaleLowerCase())>=0?"block":"none";return a},_disableClickClass:function(e,i){i?t(e).removeClass("e-disableclick"):t(e).addClass("e-disableclick")},_addExpandedClass:function(e,i){i?t(e).addClass("expanded"):t(e).addClass("collapsed")},_collapse:function(e){e.expanded||t(this._getPaletteHeaderDiv(e.name)).next(".e-scontent").slideToggle(10)},_transformItem:function(t,i,a,n,o,s){var r;if(!o)if(s&&!n.segments&&n.paletteItem&&n.paletteItem.width&&n.paletteItem.height&&n.paletteItem.enableScale){var l=30*s.width/100,d=30*s.height/100,h=(s.width-l)/n.width,g=(s.height-d)/n.height;h=(h=g=Math.min(h,g))>1?1:h,g=g>1?1:g;var c="";c+="translate("+(u=s.width/2-i*h/2)+","+(m=s.height/2-a*g/2)+")",c+="scale("+h+","+g+")",t.setAttribute("transform",c),(r=t.parentNode.nextSibling)||(r=document.getElementById(t.id+"_svgWrapper_htmlLayer")),r.style.webkitTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.MozTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.OTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.msTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.transform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",n&&"msie"===e.browserInfo().name&&"group"==n._type&&"html"===n.type&&document.getElementById(n.name+"_html").setAttribute("style","zoom:"+scale+";")}else if(n.segments){if(s&&n.paletteItem&&n.paletteItem.width&&n.paletteItem.height||n.isPhase&&n.paletteItem&&n.paletteItem.enableScale){l=s.width/10,d=s.height/10,h=(s.width-l)/i,g=(s.height-d)/a;h=(h=g=Math.min(h,g))>1?1:h,g=g>1?1:g;var u,m;c="";c+="translate("+(u=s.width/2-i*h/2)+","+(m=s.height/2-a*g/2)+")",c+="scale("+h+","+g+")",t.setAttribute("transform",c),(r=document.getElementById(t.id+"_svgWrapper_htmlLayer")).style.webkitTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.MozTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.OTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.msTransform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",r.style.transform="translate("+u+"px,"+m+"px) scale("+h+", "+g+")",n&&"msie"===e.browserInfo().name&&"group"==n._type&&"html"===n.type&&document.getElementById(n.name+"_html").setAttribute("style","zoom:"+scale+";")}}else{var p=i/(i+3*n.borderWidth),f=a/(a+3*n.borderWidth),_=(i-i*p)/2,v=(a-a*f)/2;t.childNodes[0].setAttribute("transform","scale("+p+","+f+") translate("+_+","+v+")"),n&&"image"===n.type&&t.childNodes[1]?t.childNodes[1].setAttribute("transform","scale("+p+","+f+") translate("+_+","+v+")"):n&&"group"===n._type&&t.setAttribute("transform","scale("+p+","+f+") translate("+_+","+v+")")}},_getScaleFactor:function(t,e){var i=30*this.model.paletteItemWidth/100,a=30*this.model.paletteItemHeight/100,n=(this.model.paletteItemWidth-i)/t,o=(this.model.paletteItemHeight-a)/e;return n=n>1?1:n,o=o>1?1:o,Math.min(n,o)},_getTranslateFactor:function(){var t=.15*this.model.paletteItemWidth,e=.15*this.model.paletteItemHeight;return Math.min(t,e)},_setWidth:function(t){this.element.css("width",t)},_setHeight:function(t){this.element.css("height",t)},_setHeaderHeight:function(t){var e,i;for(this.element.find(".e-header").css("height",t),this.element.find(".e-header-arrow").css("top",(t-16)/2),e=0;e<this.model.palettes.length;e++)(i=this.model.palettes[e])&&this._updateHeaderWrapper(i,t);this.updateScrollerViewport()},_updateHeaderWrapper:function(t,e){var i,a=document.getElementById(t.name+"_Wrapper");a&&((i=a.getBoundingClientRect()).height>0&&(a.style.marginTop=e/2-i.height/2+"px"))},_setCssClass:function(t){this.element.removeClass(this.model.cssClass).addClass(t)},_showItemText:function(t){t!==this.model.showPaletteItemText&&(t?this.element.find(".e-text-container").show():this.element.find(".e-text-container").hide())},_setAllowDrag:function(e){var i,a,n,o,s;if(this.model.allowDrag=e,i=this.model.palettes)for(n=0;n<i.length;n++)if(o=i[n].items)for(s=0;s<o.length;s++)a=document.getElementById(o[s].name+"_paletteItem"),this.model.allowDrag?this._setItemDraggable(a):t(a).ejDraggable("instance").destroy()},_cloneNode:function(t){var i,a,n=e.datavisualization.Diagram.Util.randomId();if(t.children&&t.children.length>0)for(a=0;a<t.children.length;a++)i=this._cloneChildren(t.children[a],n),this.nameTable[i.name]=i,t.children[a]=i.name;return t.name+=n,t},_cloneChildren:function(e,i){if("object"==typeof e)return(a=t.extend(!0,{},e)).parent+=i,a.name+=i,a;if("string"==typeof e){var a=this.nameTable[e];if(a)return this._cloneChildren(a,i)}},_setItemDraggable:function(i){var a=this.element[0].id,n=this;t(i).ejDraggable({clone:!0,cursorAt:{top:n.model.previewOffset.y,left:n.model.previewOffset.x},helper:function(){var i,a,o,s,r,l,d=t("#"+n.model.diagramId).ejDiagram("instance");if(i=n.model.paletteItemWidth,a=n.model.paletteItemHeight,d._selectedSymbol=n.selectedItem,d._symbolPalette=n.model,o=t.extend(!0,{},n.selectedItem),(o=n._cloneNode(o)).isLane&&(n.model.paletteItemWidth=o.paletteItem&&o.paletteItem.previewWidth?o.paletteItem.previewWidth:n.model.previewWidth,n.model.paletteItemHeight=o.paletteItem&&o.paletteItem.previewHeight?o.paletteItem.previewHeight:n.model.previewHeight),s=n._getPreviewItemSize(n.selectedItem),(r=n._renderItemContainer(n.selectedItem.name+"_clone",document.body,!0,s)).document.setAttribute("drag","true"),d._paletteTable=n.nameTable,d._palNameTable=t.extend(!0,{},n.nameTable),o.segments){var h=e.datavisualization.Diagram.Util.bounds(o),g=(s.width-10)/h.width,c=(s.height-10)/h.height;e.datavisualization.Diagram.Util.scale(o,g,c,h.topLeft,d.nameTable),n._renderConnector(o,r,s)}else{if(o.isLane&&o.paletteItem&&!o.paletteItem.enableScale)o.width=s.width,o.height=s.height,o.offsetX=o.width/2,o.offsetY=o.height/2;else if("group"==o._type){var u=s.width/o.width,m=s.height/o.height;n.scale(o,u,m,o.pivot,n.nameTable,null,null,null,n),e.datavisualization.Diagram.Util._translate(o,o.width/2-o.offsetX,o.height/2-o.offsetY,n.nameTable,null,n)}else o.width=s.width-10,o.height=s.height-10,s&&(s.width=s.width-10,s.height=s.height-10),o.offsetX=o.width/2+10,o.offsetY=o.height/2+1;n._updatePreviewSize(o,s),"node"==o._type?n._renderNode(o,r,s):n._renderGroup(o,r)}return l=document.getElementById(n.selectedItem.name+"_clone_paletteItem"),t(l).addClass("dragClone"),n.model.paletteItemWidth=i,n.model.paletteItemHeight=a,t(l)},drag:function(){var e=this.helper[0];t("#"+n.selectedItem.name+"_clone_svg").css("padding","2px"),t("#"+n.selectedItem.name+"_clone_svg").siblings(".htmlLayer").css("padding","2px"),e&&e.setAttribute("paletteId",a)},dragStop:function(e){var i,a=!1;e.event&&e.event.originalEvent&&e.event.originalEvent.changedTouches?a=!0:e.event&&e.event.changedTouches&&(a=!0),i=t("#"+n.model.diagramId).ejDiagram("instance"),a&&i._isDropOver&&(i._svgdrop(e.event,this),i._isDropped=!0),i._selectedSymbol=null,t(this.helper).remove()}})},_redrawContent:function(){for(var e,i,a,n,o=this.element.find(".e-scontent"),s=0,r=o.length;s<r;++s)if(e=o[s],t(e).empty(),(i=this.model.palettes[s].items)&&i.length>0)for(a=0,n=i.length;a<n;a++)this._renderItem(i[a],e)},_getPalette:function(t){for(var e,i=this.model.palettes,a=0,n=i.length;a<n;a++)if(((e=i[a]).name===t||e.name===t.replace(/\_/gi," "))&&e!==this.activePalette)return e;return null},_getActivePalette:function(t){var e=t.slice(0,t.lastIndexOf("_"));return this._getPalette(e)},_updateHeaderState:function(t){this._clearHeaderSelection(),this._updateExpandState(t),this._updateHeaderSelection(t)},_updateExpandState:function(e){t(e).hasClass("expanded")?(t(e).removeClass("expanded").addClass("collapsed"),t(e).find(".e-header-arrow").removeClass("expanded").addClass("collapsed"),t(e).attr("aria-expanded","false"),t(e).attr("aria-selected","false")):(t(e).removeClass("collapsed").addClass("expanded"),t(e).find(".e-header-arrow").removeClass("collapsed").addClass("expanded"),t(e).attr("aria-selected","true"),t(e).attr("aria-expanded","true"))},_updateHeaderSelection:function(e){t(e).hasClass("selected")||(t(e).addClass("selected"),t(e).find(".e-header-arrow").addClass("selected"))},_clearHeaderSelection:function(){this.element.find(".e-header").removeClass("selected"),this.element.find(".e-header-arrow").removeClass("selected")},_addItem:function(t,e){var i=this._getPaletteContentDiv(t.name);this._renderItem(e,i)},_removeItem:function(t,e){this._getPaletteContentDiv(t.name).removeChild(document.getElementById(e.name+"_paletteItem")),e===this._selectedElement&&(this._selectedElement=null)},updateScrollerViewport:function(){var t=this.element.ejScroller("instance");t.model.touchScroll=!1,t.model.width=this._setViewPortWidth(),t.model.height=this._setViewPortHeight(),this._refresh()},_refresh:function(){this.element.ejScroller("refresh")},_getNodeDimension:function(t){var i,a,n=t._width,o=t._height,s=t.width?t.width:t.maxWidth?t.maxWidth:t.minWidth,r=document.createElement("span"),l=0,d=0;if(t.labels.length){for(e.datavisualization.Diagram.Util.attr(r,{id:t.name+"_label",class:"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(r),a=0;a<t.labels.length;a++)(i=t.labels[a]).bold&&(r.style.fontWeight="bold"),i.italic&&(r.style.fontStyle="italic"),r.style.textDecoration=i.textDecoration,r.style.fontFamily=i.fontFamily,r.style.fontSize=i.fontSize+"px",r.style.color=i.fontColor,r.style.backgroundColor=i.fillColor,r.style.borderColor=i.borderColor,r.style.borderWidth=i.borderWidth,r.textContent=i.text,r.style.wordWrap="break-word",r.style.whiteSpace="pre",s&&(r.style.maxWidth=s-(i.margin.left+i.margin.right)-i.fontSize+"px"),l+=r.offsetWidth+i.margin.left+i.margin.right,d+=r.offsetHeight+i.margin.top+i.margin.bottom;t._width=l,t._height=d,t.minWidth&&(t.minWidth>t._width||!t._width)&&(t._width=t.minWidth),t.maxWidth&&(t.maxWidth<t._width||!t._width)&&(t._width=t.maxWidth),t.minHeight&&(t.minHeight>t._height||!t._height)&&(t._height=t.minHeight),t.maxHeight&&(t.maxHeight<t._height||!t._height)&&(t._height=t.maxHeight),t.width||"left"!=t.labels[0].horizontalAlignment||(t.offsetX+=(t._width-n)*(1-t.pivot.x)),t.width||"right"!=t.labels[0].horizontalAlignment||(t.offsetX-=(t._width-n)*t.pivot.x),t.height||"top"!=t.labels[0].verticalAlignment||(t.offsetY+=(t._height-o)*(1-t.pivot.y)),t.height||"bottom"!=t.labels[0].verticalAlignment||(t.offsetY-=(t._height-o)*t.pivot.y),this.element[0].removeChild(r)}},_getNewNode:function(i){return i.shape&&"object"==typeof i.shape&&e.datavisualization.Diagram.Util._updateShapeProperties(i),e.datavisualization.Diagram.Node(t.extend(!0,{},this.model.defaultSettings.node,i))},_getNewGroup:function(i){var a,n;if("bpmn"==i.type&&(i=e.datavisualization.Diagram.Util._updateBpmnChild(e.datavisualization.Diagram.Node(i),this)),i.children&&i.children.length>0)for(a=0;a<i.children.length;a++)(n=i.children[a])&&(i.children[a]="bpmn"===n.type||"group"===n.type?this.nameTable[n.name]=this._getNewGroup(n):this.nameTable[n.name]=this._getNewNode(n));return e.datavisualization.Diagram.Group(t.extend(!0,{},this.model.defaultSettings.group,i))},scale:function(t,a,n,o,s,r,l,d,h){var g,c,u,m,p,f=e.Matrix.identity();if(t.segments)for(e.Matrix.scale(f,a,n,o.x,o.y),u=0;u<t.segments.length;u++){for(m=t.segments[u],p=0;p<m.points.length;p++)m.points[p]=e.Matrix.transform(f,m.points[p]),0!=u||0!=p||t.sourceNode||(m._startPoint=m.points[0],m._endPoint=m.points[m.points.length-1],e.datavisualization.Diagram.Util._setLineEndPoint(t,e.Matrix.transform(f,t.sourcePoint),!1)),u!=t.segments.length-1||p!=m.points.length-1||t.targetNode||(m._startPoint=m.points[0],m._endPoint=m.points[m.points.length-1],t.targetPoint=m._endPoint);m._startPoint=m.points[0],m._endPoint=m.points[m.points.length-1],"orthogonal"==m.type?m.length||0===m.length?m.length=m._length=e.datavisualization.Diagram.Geometry.distance(m._startPoint,m._endPoint):e.datavisualization.Diagram.Util._addOrthogonalPoints(m,t.segments[u-1],t.segments[u+1],t.sourcePoint,t.targetPoint):(m.point&&(m.point=m._endPoint),m._point=m._endPoint)}else{if("group"===t._type){for(g=t.children,u=0;u<g.length;u++)(c=s["string"==typeof g[u]?g[u]:g[u].name])&&(this.scale(c,a,n,o,s,i,i,i,h),c.parent&&c.parent!=t.name&&"pseudoGroup"!=t.type&&e.datavisualization.Diagram.Util._updateGroupBounds(s[c.parent],h));e.datavisualization.Diagram.Util._updateGroupBounds(t,h)}e.Matrix.rotate(f,-t.rotateAngle,o.x,o.y),e.Matrix.scale(f,a,n,o.x,o.y),e.Matrix.rotate(f,t.rotateAngle,o.x,o.y);var _=e.Matrix.transform(f,e.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),v=t.width*a,y=t.height*n;v>1&&(t.width=v,t.offsetX=_.x),y>1&&(t.height=y,t.offsetY=_.y)}},_translate:function(t,i,a,n,o,s){var r,l,d;if(t.segments)e.datavisualization.Diagram.Util._translateLine(t,i,a,t);else if(t.offsetX+=i,t.offsetY+=a,"group"===t._type&&!o){for(r=s._getChildren(t.children),d=0;d<r.length;d++)l=n[r[d]],this._translate(l,i,a,n,null,s),l.parent&&l.parent!=t.name&&"pseudoGroup"!=t.type&&e.datavisualization.Diagram.Util._updateGroupBounds(n[l.parent],s);"group"!=t._type&&t.container&&e.datavisualization.Diagram.Util._updateGroupBounds(t,s)}}})}(jQuery,Syncfusion),function(t,e){"use strict";var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x;e.datavisualization.Diagram.extend=function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},i=function(){function i(t,i){this.name=t,this.diagram=i,this.helper=null,this.inAction=!1,this.selectedObject=null,this.startPoint=e.datavisualization.Diagram.Point(0,0),this.currentPoint=e.datavisualization.Diagram.Point(0,0),this.previousPoint=e.datavisualization.Diagram.Point(0,0),this.cursor="default",this._currentPossibleConnection=null,this._previousPossibleConnection=null,this._possibleConnectionPort=null,this.singleAction=!1,this.svgHelper=null,this.single=null,this._centralPoint=e.datavisualization.Diagram.Point(0,0),this._enableAutoNode=null,this._prevTool=null,this.activeLabel=null,this._adjustLines={lines:[]}}return i.prototype.abort=function(){this._endAction(),this.diagram.selectionList&&this.diagram.selectionList[0]&&e.datavisualization.Diagram.SvgContext.updateSelector(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints),this.diagram._removeTooltip()},i.prototype._snapTop=function(t,i,a,n,o,s){var r,l,d,h=n;if(i.top=!0,t.left=t.right=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.y-this.initialBounds.height*o.pivot.y+n-(o.offsetY-o.height*o.pivot.y),e.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,t,i,a,d,this.selectedObject,s)),i.snapped)h=n-d+i.offset;else if(r.snapConstraints&e.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var g=this.initialBounds.y-this.initialBounds.height*o.pivot.y,c=g+n;h=e.datavisualization.Diagram.SnapUtil._round(c,e.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),l)-g}return h},i.prototype._checkGroupChildren=function(t,i,a){for(var n,o,s=this.diagram._getChildren(i.children),r=0;r<s.length;r++)(n=this.diagram.nameTable[s[r]])&&e.datavisualization.Diagram.Util.canSelect(n)&&e.datavisualization.Diagram.Util.enableLayerOption(n,"lock",this.diagram)&&(o=e.datavisualization.Diagram.Util.bounds(n),e.datavisualization.Diagram.Geometry.containsRect(a,o)&&t.indexOf(n)<0?t.push(n):"group"===n._type&&this._checkGroupChildren(t,n,a))},i.prototype._getSwimLaneStackIndex=function(t){var i,a,n=null;return"canvas"==t.container.type&&(t.parent&&(i=this.diagram.nameTable[t.parent]),i&&(a=e.datavisualization.Diagram.Util.bounds(t),n="vertical"===i.container.orientation?this.currentPoint.y>=a.y&&this.currentPoint.y<a.center.y?this._getIndex(i.children,t):this._getIndex(i.children,t)+1:this.currentPoint.x>=a.x&&this.currentPoint.x<a.center.x?this._getIndex(i.children,t):this._getIndex(i.children,t)+1)),n},i.prototype._getIndex=function(t,e){var i,a;if(!t||!e)return-1;for(i=null,a=0;a<t.length;a++)if((i=this.diagram.nameTable[this.diagram._getChild(t[a])])&&i.name==e.name)return a},i.prototype._snapLeft=function(t,i,a,n,o,s){var r,l,d,h=a;if(t.left=!0,i.top=i.bottom=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.x-this.initialBounds.width*o.pivot.x+a-(o.offsetX-o.width*o.pivot.x),e.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,t,i,d,n,this.selectedObject,s)),e.datavisualization.Diagram.Util.bounds(o),t.snapped)h=a-d+t.offset;else if(r.snapConstraints&e.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var g=this.initialBounds.x-this.initialBounds.width*o.pivot.x,c=g+a;h=e.datavisualization.Diagram.SnapUtil._round(c,e.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),l)-g}return h},i.prototype._snapBottom=function(t,i,a,n,o,s){var r,l,d,h=n;if(!this.diagram._disableSnap)if(i.bottom=!0,t.left=t.right=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.y+this.initialBounds.height*(1-o.pivot.y)+n-(o.offsetY+o.height*(1-o.pivot.y)),e.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,t,i,a,d,this.selectedObject,s)),e.datavisualization.Diagram.Util.bounds(o),i.snapped)h=n-d+i.offset;else if(r.snapConstraints&e.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var g=this.initialBounds.y+this.initialBounds.height*(1-o.pivot.y),c=g+n;h=e.datavisualization.Diagram.SnapUtil._round(c,e.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),l)-g}return h},i.prototype._snapRight=function(t,i,a,n,o,s){var r,l,d,h=a;if(!this.diagram._disableSnap)if(t.right=!0,i.top=i.bottom=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.x+this.initialBounds.width*(1-o.pivot.x)+a-(o.offsetX+o.width*(1-o.pivot.x)),e.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,t,i,d,n,this.selectedObject,s)),t.snapped)h=a-d+t.offset;else if(r.snapConstraints&e.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var g=this.initialBounds.x+this.initialBounds.width*(1-o.pivot.x),c=g+a;h=e.datavisualization.Diagram.SnapUtil._round(c,e.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!0),l)-g}return h},i.prototype.keydown=function(t){var i=t.keyCode?t.keyCode:t.which;27===i&&this.inAction?(this.diagram._selectedSymbol?(this.diagram._documentmouseup(t),this._removeHighLighter(),e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._selectedSymbol=null):(this.seletedObject||this.selectedObject)&&(this.selectedObject&&(e.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this.seletedObject&&(e.datavisualization.Diagram.SvgContext._enableSelectedNode(this.seletedObject,this.diagram._svg,this.diagram),e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.seletedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this._removeHighLighter(),e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram)),this.abort()):46===i&&this.inAction?(this.diagram._selectedSymbol&&(this.diagram._documentmouseup(t),this.diagram._selectedSymbol=null),this.abort()):this.inAction||27!=i||this.diagram._clearSelection()},i.prototype._getSwimlaneHeader=function(t){var e;return t&&t.isSwimlane&&t.children&&t.children.length>0&&(e=this.diagram.nameTable[this.diagram._getChild(t.children[0])]),e},i.prototype._removeHelpers=function(){e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),e.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg),this._removeHighLighter()},i.prototype._cloneGroupNode=function(e,i){var a,n,o,s,r=null;if((n=t.extend(!0,{},e)).name+=i,e&&"group"===e._type)for(n.children=[],o=this.diagram._getChildren(e.children),s=0;s<o.length;s++)r=this.diagram.nameTable[this.diagram._getChild(o[s])],(a=t.extend(!0,{},r)).name+=i,a.parent&&(a.parent+=i),"group"===a._type&&this._cloneGroupNode(a,i),this.diagram.nameTable[a.name]=a,n.children.push(a);return n},i.prototype._updateNextPhases=function(t,i,a){var n,o,s,r,l;for(n="horizontal"==t.orientation?i:a,o=this.diagram._getPhaseIndex(t.name),r=this.diagram.nameTable[t.parent],l=o+1;l<r.phases.length;l++)(s=this.diagram.nameTable[this.diagram._getChild(r.phases[l])])&&(s.offset+=n),e.datavisualization.Diagram.SvgContext._updatephase(s,this.diagram)},i.prototype._getphase=function(t){return this.diagram.nameTable[t]},i.prototype._containsSwimlane=function(t){for(var e,i=0;i<t.length;i++)if((e=this.diagram.nameTable[this.diagram._getChild(t[i])]).isSwimlane||e.isLane)return!0;return!1},i.prototype._raiseEndPointDrag=function(t,e,i,a){var n,o,s,r;if(e||i)return o=this._currentPossibleConnection?this._currentPossibleConnection:null,s=this._possibleConnectionPort?this._possibleConnectionPort:null,r=this.currentPoint,n=e?"Target":"Source",this._raiseEvent("connector"+n+"Change",{element:t,node:o,port:s,point:r,dragState:a,cancel:!1})},i.prototype._decideSelectedItem=function(t,e,i){var a,n,o=null;return e?(e.parent?this.diagram.selectionList&&this.diagram.selectionList[0]&&e.parent==this.diagram.selectionList[0].name&&!i?(o=e,"bpmn"==this.diagram.selectionList[0].type&&(o=this.diagram.selectionList[0])):i&&this.diagram.selectionList[0]&&this.diagram.selectionList[0].name==e.name?o=e:(a=this.diagram.nameTable[e.parent],e.isPhase?((n=e.name.split("phaseStack")[1])&&(e=this.diagram.nameTable[n]),o=e):(o=this._decideSelectedItem(t,a,i),this.diagram.selectionList&&this.diagram.selectionList[0]&&o&&this.diagram.selectionList[0].name==o.name&&!i&&(o=e))):o=e,o):null},i.prototype._isParentAsLane=function(t){for(var e,i,a,n=0;t.children&&n<t.children.length>0;n++)if((e=this.diagram.nameTable[this.diagram._getChild(t.children[n])])&&((i=this.diagram.nameTable[e.parent])&&i.isLane))return a=this.diagram.nameTable[i.parent],this.diagram._activeSwimLane=this.diagram.nameTable[a.parent],!0;return null},i.prototype._getAdjustjecentLines=function(t){if(!t.segments){for(var e=0;t.inEdges&&t.inEdges.length>0&&e<t.inEdges.length;e++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[t.inEdges[e]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[t.inEdges[e]]));for(e=0;t.outEdges&&t.outEdges.length>0&&e<t.outEdges.length;e++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[t.outEdges[e]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[t.outEdges[e]]))}},i.prototype._containsCollection=function(t,e){for(var i=0;t&&t.length>0&&i<t.length;i++)if(e&&t[i].name===e.name)return!0},i.prototype._updateMultipleUndoObject=function(t){for(var e,i=[],a=0;t.children&&t.children.length>0&&a<t.children.length;a++)(e=this.diagram.nameTable[this.diagram._getChild(t.children[a])])&&(i.push(jQuery.extend(!0,{},e)),this._getAdjustjecentLines(e));this._undoObject||(this._undoObject={collection:i,adjustLines:jQuery.extend(!0,{},this._adjustLines)})},i.prototype._updateNameTable=function(t){this.diagram._updateNameTable(t)},i.prototype._getParentSwimlane=function(t){var e;return t&&t.isLane?(e=this.diagram.nameTable[t.parent],this.diagram.nameTable[e.parent]):null},i.prototype._removeHighLighter=function(){e.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer)},i.prototype._getPadding=function(t){var e,i=0,a=0;return t&&t.parent&&((e=this.diagram.nameTable[t.parent])&&(i=e.paddingRight,a=e.paddingBottom)),{x:i,y:a}},i.prototype._findStackOverNode=function(t,i){var a,n,o,s,r,l,d,h;if(t&&(n=null,a=this.diagram.nameTable[t.parent]))for(r=a.children.length,l=0;l<r;l++)if(n=this.diagram.nameTable[this.diagram._getChild(a.children[l])],o=this.mousePosition(i),s=e.datavisualization.Diagram.Util.bounds(n),d=this.diagram.nameTable[this.diagram._getChild(a.children[r-1])],h=this.diagram.nameTable[this.diagram._getChild(a.children[0])],"vertical"==a.container.orientation){if(o.y>=s.y&&o.y<=s.bottom)return n;if(o.y<=h.offsetY-h.height/2)return h;if(o.y>=d.offsetY+d.height/2)return d}else{if(o.x>=s.x&&o.x<=s.right)return n;if(o.x<=h.offsetX-h.width/2)return h;if(o.x>=d.offsetX+d.width/2)return d}},i.prototype._getPageBounds=function(){var t=e.datavisualization.Diagram.Rectangle(0,0,0,0),i=this.diagram.model.pageSettings;return t.x="diagram"===i.boundaryConstraints?Math.min(this.diagram._getDigramBounds().x,0):0,t.y="diagram"===i.boundaryConstraints?Math.min(this.diagram._getDigramBounds().y,0):0,t.width="page"===i.boundaryConstraints&&i.pageWidth?i.pageWidth:this.diagram.element.width(),t.height="page"===i.boundaryConstraints&&i.pageHeight?i.pageHeight:this.diagram.element.height(),t},i.prototype._nodeHighLighter=function(t){var i,a,n,o=null,s=null,r=null;t&&this.selectedObject.parent?(i=this.diagram.nameTable[this.selectedObject.parent])&&(i.container&&"stack"==i.container.type&&this.selectedObject.name!=t.name?(a=this._stackOverNode,e.datavisualization.Diagram.SvgContext._drawStackHighlighter(a,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,"vertical"===i.container.orientation)):i.container&&"canvas"==i.container.type&&this.selectedObject.parent!=t.name&&!t.isPhase&&e.datavisualization.Diagram.Util.canAllowDrop(t)?e.datavisualization.Diagram.Util._canBeTarget(this.diagram,t)&&e.datavisualization.Diagram.SvgContext._drawNodeHighlighter(t,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter()):t&&t.container&&!t.isSwimlane?this.selectedObject.isLane?(i=this.diagram.nameTable[t.parent])&&-1===t.name.indexOf("phaseStack")&&e.datavisualization.Diagram.Util.canDrawStackHighlighter(this.diagram,this.selectedObject,t)&&e.datavisualization.Diagram.SvgContext._drawStackHighlighter(t,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,"vertical"===i.container.orientation):e.datavisualization.Diagram.SvgContext._drawNodeHighlighter(t,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):t.segments?this._removeHighLighter():e.datavisualization.Diagram.SvgContext._drawNodeHighlighter(t,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom),this._nodeToHit&&t&&t.name!=this._nodeToHit.name&&(s=e.datavisualization.Diagram.Util.bounds(this._nodeToHit),r=this._getTargetNode(this._nodeToHit,s),this._raiseEvent("mouseLeave",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(this._nodeToHit),target:this.diagram.getNode(r)})),t?(this._nodeToHit&&this._nodeToHit.name!==t.name||!this._nodeToHit)&&(this._nodeToHit=t,this.selectedObject.parent&&(o=this.diagram.nameTable[this.selectedObject.parent]),"pseudoGroup"==this.selectedObject.type&&((n=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])])&&n.parent&&(o=this.diagram.nameTable[n.parent])),s=e.datavisualization.Diagram.Util.bounds(t),r=this._getTargetNode(t,s),this._raiseEvent("mouseEnter",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(o),target:this.diagram.getNode(r)})):this._nodeToHit=null,t&&(this.selectedObject.parent&&(o=this.diagram.nameTable[this.selectedObject.parent]),s=e.datavisualization.Diagram.Util.bounds(t),r=this._getTargetNode(t,s),this._raiseEvent("mouseOver",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(o),target:this.diagram.getNode(r)}))},i.prototype._doubleClick=function(t){var e,i;t&&t.parent&&((e=this.diagram.nameTable[t.parent])&&(i=t.name,this.diagram.updateSelectedObject(i),e.isLane||e.isSwimlane||e.isPhaseStack||(this.diagram._clearSelection(!0),this.diagram.addSelection(t,!0))))},i.prototype._itemClick=function(t,e,i,a){var n,o,s,r,l;if(e&&e.parent){if(n=this.diagram.nameTable[e.parent])if(n.container)e&&!this.diagram._selectedSymbol&&(-1!=(o=e.name).indexOf("_header_swimlane")?t&&this.diagram.updateSelectedObject(t.parent,n):-1!=o.indexOf("_Headerr_")?this.diagram.updateSelectedObject(e.parent):e&&e.isPhase?t.isPhase&&((l=this.diagram.nameTable[t.parent])&&(0===this.diagram.selectionList.length||this.diagram.selectionList[0].name!=l.name)&&(this.diagram._clearSelection(!0),this.diagram.addSelection(t,!0),this.selectedObject=null)):this.diagram.updateSelectedObject(o)),this.diagram._selectedGNode=null;else if("group"===n.type){if(n.parent){if(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)s=this.diagram.nameTable[n.parent];else for(;n.parent&&(!(s=this.diagram.nameTable[n.parent])||!s.isLane);)if(r=this.diagram.nameTable[n.parent],this.diagram._selectedGNode&&r){if(r.name===this.diagram._selectedGNode.name){this.diagram.updateSelectedObject(n.name);break}n=r}else n=r;s&&s.isLane&&((l=this._getSelectedItem(e,a))&&this.diagram.updateSelectedObject(l.name))}this.selectedObject&&this.selectedObject.parent&&(this.diagram._selectedGNode=this.selectedObject)}}else e?this.diagram._selectedSymbol||this.diagram.updateSelectedObject(e.name):this.diagram._selectedGNode=null;t&&("pseudoGroup"==t.type||"multipleSelection"==t.name)&&e&&!this._containsChild(t,e.name)&&this.diagram.updateSelectedObject(t.name)},i.prototype._getSelectedItem=function(t,e){var i;if(t&&t.parent)return i=this.diagram.nameTable[t.parent],e&&e.name==i.name?t:i.isLane?t:this._getSelectedItem(i)},i.prototype._getTargetNode=function(t,i){for(var a,n,o,s,r=null,l=[],d=e.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,i),h=0;h<d.length;h++)if((a=d[h]).objects.length>0)for(n=0;n<a.objects.length;n++)!(o=a.objects[n]).segments&&o.visible&&(r=e.datavisualization.Diagram.Util.bounds(o),-1==l.indexOf(o)&&e.datavisualization.Diagram.Geometry.intersectsRect(i,r)&&l.push(o));for((s=[]).push(t),h=0;h<l.length;h++)l[h].name!=t.name&&s.push(l[h]);return s},i.prototype._updateMargin=function(t,i){var a,n,o,s,r;if("pseudoGroup"==t.type)for(a=null,n=this.diagram._getChildren(t.children),o=0;o<n.length;o++)a=this.diagram.nameTable[n[o]],this._updateMargin(a,i);else if(i&&i.container&&"canvas"==i.container.type){var l=e.datavisualization.Diagram.Util.bounds(i),d=e.datavisualization.Diagram.Util.bounds(t),h=e.datavisualization.Diagram.Geometry.rect([d.topLeft,d.topRight,d.bottomRight,d.bottomLeft]);t.marginLeft=h.x-(l.x+i.paddingLeft),t.marginTop=h.y-(l.y+i.paddingTop),i.isLane&&(s=0,r=0,"horizontal"===i.orientation?(s=50,r=0):(s=0,r=50),t.marginLeft=t.marginLeft>=s?t.marginLeft:s,t.marginTop=t.marginTop>=r?t.marginTop:r)}},i.prototype._getNodeUnderMouse=function(){var t,i,a,n,o=this.diagram._nodeUnderMouse;if(this.diagram._focusedElement&&(this.diagram._focusedElement.isPhase||this.diagram._focusedElement.isLane||this.diagram._focusedElement.isSwimlane)&&(i=!0),this.diagram._focusedElement&&o&&this._containsChild(this.diagram._focusedElement,o.name)&&o&&(i||!e.datavisualization.Diagram.Util.canAllowDrop(o)))if("connector"==(a=this.diagram.getObjectType(o))||"group"===a)t=o;else if(o.parent){if((n=this.diagram.nameTable[o.parent])&&n.container&&"stack"==n.container.type&&e.datavisualization.Diagram.Util.canAllowDrop(o))return o;a=this.diagram.getObjectType(n),n&&"node"!=a&&(t=n)}if(t){if(this.selectedObject!=t&&e.datavisualization.Diagram.Util.canAllowDrop(t)&&("bpmn"!=t.type||"bpmn"==this.selectedObject.type))return t}else if(o&&this.selectedObject!=o&&e.datavisualization.Diagram.Util.canAllowDrop(o))return o},i.prototype._isChange=function(t,e){var i=null;return"group"===t._type||"pseudoGroup"===t.type||"group"===e._type||"pseudoGroup"===e.type?("group"!==t._type&&"pseudoGroup"!==t.type||"group"===e._type||"pseudoGroup"===e.type||(i=!this._containsChild(t,e.name)),"group"===t._type||"pseudoGroup"===t.type||"group"!==e._type&&"pseudoGroup"!==e.type?("group"===t._type||"pseudoGroup"===t.type)&&("group"===e._type||"pseudoGroup"===e.type)&&t.name==e.name&&(i=!0):i=!this._containsChild(e,t.name)):t.name==e.name&&(i=!0),i},i.prototype._containsChild=function(t,e){var i,a,n=!0,o=null;if(t.children)for(i=this.diagram._getChildren(t.children),a=0;a<i.length;a++)o=this.diagram.nameTable[i[a]],"group"===this.diagram.getObjectType(o)?n=this._containsChild(o,e):o&&o.name==e&&(n=!1);return n},i.prototype._findNodeUnderMouse=function(i,a){var n,o,s,r,l=null,d=null,h=this.diagram._isForeignObject(i.target);return h&&(i.target=h),o=t(i.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],s=i.target.className,o&&(h||"div"!=i.target.localName)?(n="object"==typeof o.className?o.className.baseVal:o.className)&&("ej-d-node"===n||"ej-d-group"===n||e.datavisualization.Diagram.Util.isClassifier(i))?((d=this.diagram._findNode(o.id))||(d=this.diagram._findNode(o.id.split("_label")[0])),d||(d=this.diagram._findNode(o.id.split("_parentdiv")[0]))):"ej-d-connector"===n?(d=this.diagram._findConnector(o.id))||(d=this.diagram._findConnector(o.id.split("_label")[0])):"ej-d-multiselector"===s.animVal&&(d=this.diagram.selectionList[0]):!d&&i.target&&i.target.parentNode?(r=i.target.parentNode.id.split("_ej_ports"),d=this.diagram.findNode(r[0])):this.diagram._isLabelTemplate(i)&&((d=this.diagram._findNode(o.id))||(d=this.diagram._findConnector(o.id))),l=d&&!d.parent?d:this._decideSelectedItem(i,d,a),this.prevSelectObject=l,a&&this.diagram.selectionList[0]&&(l&&"group"===l._type&&!this._containsChild(l,this.diagram.selectionList[0].name)?l=l:l&&this.diagram.selectionList[0].name!=l.name&&this._isChange(this.diagram.selectionList[0],l)?l=this.diagram.selectionList[0]:d&&d.name==this.diagram.selectionList[0].name&&!this._isChange(this.diagram.selectionList[0],l)&&(l=this.diagram.selectionList[0])),this.actualObject=d&&this.diagram._selectedSymbol&&d.name!=this.diagram._selectedSymbol.name&&this.diagram._symbolDrop?this.diagram._selectedSymbol:d,l},i.prototype._findLabelUnderMouse=function(i,a,n,o){var s,r,l,d,h,g,c,u,m,p,f,_,v=t(i.target),y=v[0].getAttribute("class");if(this.diagram.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg){if(!y||"ej-d-label"==!y)if(v[0].parentNode&&(r=v[0].parentNode.getAttribute("class")),"ej-d-label"===r){for(l=v[0].parentNode.id.split("_"),d="",_=1;_<l.length;_++)d+=l[_],_!=l.length-1&&(d+="_");if((h=this.diagram.nameTable[l[0]])&&h.labels.length>0)for(_=0;_<h.labels.length;_++)if(h.labels[_].name===d)return this.activeLabel=h.labels[_],h.labels[_]}else for(g=i.target.parentNode;g;){if(g&&(y=g.getAttribute("class")),"ej-label-template"===y)for(f=g.id.split("_"),(s=this.diagram._findNode(f[0]))||(s=this.diagram._findConnector(f[0])),_=0;s&&_<s.labels.length;_++)if(m=s.labels[_].name.split("_"),f[f.length-1]==m[m.length-1])return u=s.labels[_],this.diagram._selectedSymbol||(this.activeLabel=u),u;if(g&&g.id===this.diagram.element[0].id+"_canvas_svg")break;g=g.parentNode}}else if("ej-d-label"==y){if((p=t(i.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"))&&(f=p[0].getAttribute("id"),c=p[0].getAttribute("class")))if("ej-d-node"===c||"ej-d-group"===c)(s=this.diagram._findNode(f))||(s=this.diagram._findNode(f.split("_label")[0])),u=this.diagram._findLabelAtPoint(n||this.currentPoint,s),this.diagram._selectedSymbol||(this.activeLabel=u);else if("ej-d-connector"===c){if((s=this.diagram._findConnector(f))||(s=this.diagram._findConnector(f.split("_label")[0])),u=this.diagram._findLabelAtPoint(n||this.currentPoint,s),e.datavisualization.Diagram.Util.canMoveLabel(s)||o){if(null==u&&"ej-d-label"==(y=(v=t(i.target))[0].getAttribute("class")))for(f=i.target.id.split("_"),_=0;_<s.labels.length;_++)m=s.labels[_].name.split("_"),f[f.length-1]==m[m.length-1]&&(u=s.labels[_])}else u=null;this.diagram._selectedSymbol||(this.activeLabel=u)}}else if(this.diagram._isLabelTemplate(i)){if(p=t(i.target).parents(".ej-label-template")[0]){if(f=p.parentNode.id.split("_"),(s=this.diagram._findNode(f[0]))||(s=this.diagram._findConnector(f[0])),s)for(_=0;_<s.labels.length;_++)m=s.labels[_].name.split("_"),f[2]==m[m.length-1]&&(u=s.labels[_]);this.diagram._selectedSymbol||(this.activeLabel=u)}}else this.activeLabel=null;return s},i.prototype._findLabelAtNode=function(i,a){var n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y=null;if(i&&i.labels.length>0)for(l=e.datavisualization.Diagram.Util.bounds(i,!0),g=0,c=(n=i.labels).length;g<c;g++)(y=n[g]).name==a.name&&((o=e.datavisualization.Diagram.Util._getLabelPosition(y,l)).x=l.x+o.x,o.y=l.y+o.y,this.diagram.model.labelRenderingMode==e.datavisualization.Diagram.LabelRenderingMode.Svg?(u=(f=document.getElementById(i.name+"_"+y.name).getBBox()).width?f.width:0,m=f.height?f.height:0):(p=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],u=(f=t(p).find("#"+i.name+"_"+y.name)[0])?f.offsetWidth:0,m=f?f.offsetHeight:0),u||(u=i.width),m||(m=y.fontSize),_=e.datavisualization.Diagram.Size(u,m),y.verticalAlignment==e.datavisualization.Diagram.VerticalAlignment.Top?o.y+=_.height/2:y.verticalAlignment==e.datavisualization.Diagram.VerticalAlignment.Bottom&&(o.y-=_.height/2),y.horizontalAlignment==e.datavisualization.Diagram.HorizontalAlignment.Left?o.x+=_.width/2:y.horizontalAlignment==e.datavisualization.Diagram.HorizontalAlignment.Right&&(o.x-=_.width/2),s=o.x-(y.width?y.width/2:i.width/2),r=o.y-(y.height?y.height/2:i.height/2),h=e.datavisualization.Diagram.Point(s,r),i.segments||(d=e.Matrix.identity(),e.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),h=e.Matrix.transform(d,h)),v={x:h.x,y:h.y,width:_.width,height:_.height});return v},i.prototype._getLabelCenter=function(t){var i,a,n=this.diagram.findNode(t._parent),o=this._findLabelAtNode(n,t);if(n.segments)"segmentpath"==t.relativeMode?(o=e.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(t,n,1,this.diagram),a=e.datavisualization.Diagram.Point(o.position.x+t.margin.left-t.margin.right,o.position.y+t.margin.top-t.margin.bottom)):a=e.datavisualization.Diagram.Point(o.x+t.width/2,o.y+t.height/2);else{i=e.Matrix.identity(),e.Matrix.rotate(i,-n.rotateAngle,n.offsetX,n.offsetY);var s=e.Matrix.transform(i,e.datavisualization.Diagram.Point(o.x,o.y)),r=e.datavisualization.Diagram.Point(s.x+t.width/2,s.y+t.height/2),l=e.Matrix.identity();e.Matrix.rotate(l,n.rotateAngle,n.offsetX,n.offsetY),a=e.Matrix.transform(l,e.datavisualization.Diagram.Point(r.x,r.y))}return a},i.prototype._resizeObject=function(t,i,a,n,o){var s,r,l,d,h,g,c,u,m,p,f,_={snapped:!1,offset:0,left:!1,right:!1},v={snapped:!1,offset:0,top:!1,bottom:!1},y=this.previousPoint,b=this.currentPoint,x=e.datavisualization.Diagram.Point(0,0);switch(l="label"!==t._type?t.rotateAngle:this.diagram._findLabelRotateAngle(t),c=e.Matrix.identity(),e.Matrix.rotate(c,-l),u=e.Matrix.identity(),d=t.text?this._getLabelCenter(t):e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),e.Matrix.rotate(u,l,d.x,d.y),m=t.width,p=t.height,"label"!==t._type?(h=t.offsetX-m*t.pivot.x,g=t.offsetY-p*t.pivot.y):(h=d.x-t.width/2,g=d.y-t.height/2),this._resizeDirection){case"n-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h+m/2,g+p)),f=1,i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(a=this._snapTop(_,v,i,a,t,b==y)),s=(this.initialBounds.height-a)/t.height;break;case"e-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h,g+p/2)),i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(i=this._snapRight(_,v,i,a,t,b==y,o)),a=0,f=(this.initialBounds.width+i)/t.width,s=1;break;case"w-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h+m,g+p/2)),i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(i=this._snapLeft(_,v,i,a,t,b==y)),a=0,f=(this.initialBounds.width-i)/t.width,s=1;break;case"s-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h+m/2,g)),f=1,i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(a=this._snapBottom(_,v,r.x,r.y,t,!(!b||!y||b!=y))),s=(this.initialBounds.height+a)/t.height;break;case"ne-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h,g+p)),i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(i=this._snapRight(_,v,i,a,t,b==y,o),a=this._snapTop(_,v,i,a,t,b==y)),f=(this.initialBounds.width+i)/t.width,s=(this.initialBounds.height-a)/t.height;break;case"nw-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h+m,g+p)),i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(a=this._snapTop(_,v,i,a,t,b==y),i=this._snapLeft(_,v,i,a,t,b==y)),f=(this.initialBounds.width-i)/t.width,s=(this.initialBounds.height-a)/t.height;break;case"se-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h,g)),i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(a=this._snapBottom(_,v,i,a,t,b==y,o),i=n?i:this._snapRight(_,v,i,a,t,b==y)),f=(this.initialBounds.width+i)/t.width,s=(this.initialBounds.height+a)/t.height;break;case"sw-resize":x=e.Matrix.transform(u,e.datavisualization.Diagram.Point(h+m,g)),i=(r=e.Matrix.transform(c,e.datavisualization.Diagram.Point(i,a))).x,a=r.y,"label"!==t._type&&(a=this._snapBottom(_,v,i,a,t,b==y,o),i=this._snapLeft(_,v,i,a,t,b==y)),f=(this.initialBounds.width-i)/t.width,s=(this.initialBounds.height+a)/t.height}return e.datavisualization.Diagram.Rectangle(x.x,x.y,f,s)},i.prototype._selectionContainsChild=function(t){var e,i,a,n,o;if(this.diagram.selectionList[0].children){for(e=this.diagram._getChildren(this.diagram.selectionList[0].children),i=null,a=0;a<e.length;a++)if((i=this.diagram.nameTable[e[a]])&&i.name==t)return!0}else if("group"===this.diagram.selectionList[0]._type&&"pseudoGroup"!=this.diagram.selectionList[0].type){if(this.diagram.selectionList[0].name==t)return!0}else if(this.diagram.nameTable[t]&&"group"===this.diagram.nameTable[t]._type){for(e=this.diagram._getChildren(this.diagram.nameTable[t].children),n=0;n<e.length;n++)if((i=this.diagram.nameTable[e[n]])&&(o=this._selectionContainsChild(i.name)),o)return o}else if(this.diagram.selectionList[0].name==t)return!0;return!1},i.prototype._isSelected=function(t){var e,i,a=null,n=this.diagram.nameTable[t];if(this._selectionContainsChild(n.name))return!0;if("group"===n._type)for(e=this.diagram._getChildren(n.children),i=0;i<e.length;i++)if(a=e[i],this._selectionContainsChild(a))return!0;return!1},i.prototype._isColleagueSelected=function(t){var e,i,a,n=this.diagram.nameTable[t],o=null;if(n.parent&&(e=this.diagram.nameTable[n.parent]))for(i=this.diagram._getChildren(e.children),a=0;a<i.length;a++)if(o=i[a],this._isSelected(o))return!0;return!1},i.prototype._isInSelection=function(t){var e,i;if("pseudoGroup"==this.diagram.selectionList[0].type&&this.diagram.selectionList[0].children)for(e=this.diagram._getChildren(this.diagram.selectionList[0].children),null,i=0;i<e.length;i++)if(this.diagram.nameTable[e[i]].name==t)return!0},i.prototype._getCloneNode=function(t){var e=null;return(e=jQuery.extend(!0,{},t)).children=[],e.minHeight=0,e.minWidth=0,e.maxHeight=0,e.maxWidth=0,e},i.prototype._getProcessedObject=function(t){var e,i=this.diagram.nameTable[t];if(i){if(this._isInSelection(t))return null;if(this._selectionContainsChild(i.name))return{add:i,remove:null};if(!i.parent)return{add:i,remove:null};if(!this._selectionContainsChild(i.parent))return this._isColleagueSelected(i.parent)&&!this._selectionContainsChild(i.parent)?this._isSelected(i.parent)?{add:i,remove:null}:{add:this.diagram.nameTable[i.parent],remove:null}:this.diagram.selectionList[0]&&this._isInSelection(i.parent)?{add:this.diagram.nameTable[i.name],remove:this.diagram.nameTable[i.parent]}:this._getProcessedObject(i.parent);if(this._isInSelection(i.parent))return{add:i,remove:this.diagram.nameTable[i.parent]};if(e=this.diagram.nameTable[i.parent])return{add:e,remove:this.diagram.nameTable[e.parent]}}},i.prototype.hasSameParent=function(){var t,e,i,a,n;if("pseudoGroup"==this.selectedObject.type){if(t=this.selectedObject,e=null,this.diagram.nameTable[this.diagram._getChild(t.children[0])])for(i=this.diagram.nameTable[this.diagram._getChild(t.children[0])].parent,a=this.diagram._getChildren(t.children),n=0;n<a.length;n++)if((e=this.diagram.nameTable[a[n]]).parent!=i||""==e.parent)return!1;return!0}return!1},i.prototype._fromDiagram=function(t){for(var e=!0,i=null,a=0;a<t.length;a++)if((i=this.diagram.nameTable[this.diagram._getChild(t[a])])&&i.parent){e=!1;break}return e},i.prototype._fromContainer=function(t){for(var e=null,i=null,a=0;a<t.length;a++)if((e=this.diagram.nameTable[this.diagram._getChild(t[a])]).parent&&((i=this.diagram.nameTable[e.parent])&&i.container))return!0},i.prototype._fromSameContainer=function(t){for(var e=null,i=null,a=0;a<t.length;a++)if(e=this.diagram.nameTable[this.diagram._getChild(t[a])],!i&&e.parent&&(i=e.parent),e.parent&&e.parent!=i)return!1;return!0},i.prototype._anyFromContainer=function(t){for(var e=null,i=null,a=0;a<t.length;a++)if((e=this.diagram.nameTable[this.diagram._getChild(t[a])]).parent&&(i=this.diagram.nameTable[e.parent]),i&&i.container&&"canvas"===i.container.type)return!0;return!1},i.prototype._processCtrlKey=function(i){var a,n,o,s,r,l;if(this.diagram.selectionList.length>0&&e.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)){var d,h,g,c=this.diagram.selectionList,u=[],m=[],p=[];"pseudoGroup"==c[0].type?(d=!0,a=this._findNodeUnderMouse(i)):a=this._findNodeUnderMouse(i);var f=this._findNodeUnderMouse(i,!0),_=this.selectedObject,v=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:f,cancel:!1,event:i});if(this._itemClick(this.selectedObject,this.actualObject,f),v.cancel&&(this.selectedObject=_),this.actualObject)if(this.actualObject.parent)d?(n=c[0],(o=this._getProcessedObject(this.actualObject.name))?(this.selectedObject?(n.children=this.diagram._getChildren(n.children),e.datavisualization.Diagram.Util.removeItem(n.children,this.selectedObject.name)):o.remove&&(n.children=this.diagram._getChildren(n.children),e.datavisualization.Diagram.Util.removeItem(n.children,o.remove.name)),this.selectedObject?this._hasMultipleSelection(this.selectedObject)||n.children.push(this.selectedObject.name):o.add&&(this._hasMultipleSelection(o.add)||n.children.push(o.add.name))):(h=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?(n.children=this.diagram._getChildren(n.children),e.datavisualization.Diagram.Util.removeItem(n.children,this.selectedObject.name)):n.children.push(this.selectedObject.name):this._hasMultipleSelection(h)?(n.children=this.diagram._getChildren(n.children),e.datavisualization.Diagram.Util.removeItem(n.children,h.name)):n.children.push(h.name)),e.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram),n.children.length<=1?(s=this.diagram.nameTable[this.diagram._getChild(n.children[0])],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.selectedObject=s,this.diagram._addSelection(this.selectedObject)):(this.selectedObject=c[0],this.diagram.updateSelection())):("group"===this.diagram.selectionList[0]._type&&"bpmn"!==this.diagram.selectionList[0].type?(c=this.diagram.selectionList[0],h=(o=this._getProcessedObject(this.actualObject.name)).add,o&&this.diagram._hasSelection()&&this.diagram._clearSelection()):(o=null,"group"===a._type&&(o=this._getProcessedObject(this.actualObject.name)),h=o?o.add:a,c=this.diagram.selectionList[0],this.diagram._hasSelection()&&this.diagram._clearSelection()),this.diagram._eventCause.selectionChange=e.datavisualization.Diagram.SelectionChangeCause.Keydown,l=e.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),c.name!=h.name&&l.children.push(c.name),this.selectedObject?l.children.push(this.selectedObject.name):this._containsChild(l,h.name)&&l.children.push(h.name),this._checkRepeatedChild(l.children),this.diagram.nodes().push(l),this.diagram._nodes=t.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[l.name]=l,e.datavisualization.Diagram.Util._updateGroupBounds(l,this.diagram),this.selectedObject=l,this.diagram._addSelection(this.selectedObject));else if(d){for(n=c[0],h=this.selectedObject?this.selectedObject:this.actualObject,"insert"==(g=this._hasMultipleSelection(h)?"remove":"insert")?(n.children.push(h.name),u.push(h)):(e.datavisualization.Diagram.Util.removeItem(n.children,h.name),m.push(h)),r=0;r<n.children.length;r++)p.push(this.diagram.nameTable[this.diagram._getChild(n.children[r])]);v={changeType:g,state:"changing",element:this.diagram.nameTable.multipleSelection,selectedItems:p,oldItems:m,newItems:u,cancel:!1},this._raiseEvent("selectionChange",v),v.cancel||("remove"==g&&e.datavisualization.Diagram.Util.removeItem(this.diagram.model.selectedItems.children,h),this.diagram.updateSelection(this.selectedObject),e.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram),this.selectedObject=c[0],this.diagram.model.selectedItems.children.length?e.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints):(e.datavisualization.Diagram.Util.clear(this.diagram.selectionList),e.datavisualization.Diagram.SvgContext.clearSelector(this.diagram._adornerSvg,this.diagram._adornerLayer,this)),v={changeType:g,state:"changed",element:this.diagram.nameTable.multipleSelection,selectedItems:p,oldItems:m,newItems:u,cancel:!1},this._raiseEvent("selectionChange",v))}else h=this.actualObject,this.diagram._eventCause.selectionChange=e.datavisualization.Diagram.SelectionChangeCause.Keydown,h!=(c=this.diagram.selectionList[0])&&(this.diagram._hasSelection()&&this.diagram._clearSelection(!0),(l=e.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"})).children.push(c.name),this.selectedObject?l.children.push(this.selectedObject.name):l.children.push(h.name),this.diagram.nodes().push(l),this.diagram._nodes=t.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[l.name]=l,e.datavisualization.Diagram.Util._updateGroupBounds(l,this.diagram,null,!0),this.selectedObject=l,this.diagram._addSelection(this.selectedObject));this.selectedObject=this.diagram.selectionList[0]}else a=this._findNodeUnderMouse(i),e.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(this.selectedObject=a);return a},i.prototype._checkRepeatedChild=function(i){for(var a,n=null,o=t.extend(!0,{},i),s=(o=this.diagram._getChildren(o),0);s<o.length;s++)if("group"===(n=this.diagram.nameTable[o.children[s]])._type)for(a=0;a<o.children.length;a++)this._containsChild(n,o.children[a])||(i.children=this.diagram._getChildren(i.children),e.datavisualization.Diagram.Util.removeItem(i.children,o.children[a]))},i.prototype._hasMultipleSelection=function(t){for(var e=this.diagram._getChildren(this.diagram.selectionList[0].children),i=0;i<e.length;i++)if(t.name==e[i])return!0;return!1},i.prototype._getNextParent=function(t){if(t.parent){var e=this.diagram.nameTable[t.parent];return this._hasMultipleSelection(e)?t:this._getNextParent(e)}return t},i.prototype._findObj=function(t,e){var i,a,n=t.getAttribute("id");return e?i=this.diagram._findChildren(e,n):(a=t.getAttribute("class"))&&("ej-d-node"===a||"ej-d-group"===a?i=this.diagram._findNode(n):"ej-d-connector"===a&&(i=this.diagram._findConnector(n))),i},i.prototype.mousedown=function(t){this.startPoint=this.mousePosition(t),this.currentPoint=this.startPoint,this.previousPoint=this.startPoint,this.diagramBounds=this.diagram._getDigramBounds()},i.prototype._isPolyline=function(){if("connector"===this.diagram.model.drawType.type&&this.diagram.model.drawType.segments&&this.diagram.model.drawType.segments.length>0&&"polyline"===this.diagram.model.drawType.segments[0].type)return!0},i.prototype.mousemove=function(t){(!e.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this instanceof e.datavisualization.Diagram.LineTool||this._isPolyline()||this.diagram.model.rulerSettings.showRulers)&&(this.currentPoint=this.mousePosition(t)),this._drawRulerMarkers(t)},i.prototype._removeRulerMarkers=function(){var t,e,i=document.getElementsByClassName("ej-d-ruler-marker");if(i&&i.length>0)for(e=i.length-1;e>=0;e--)(t=i[e])&&t.parentNode.removeChild(t)},i.prototype._drawRulerMarker=function(t,i,a,n){var o,s,r,l,d,h,g,c,u,m;if(t){if((c=i[0].getElementsByTagName("svg")).length>0)for(d in c){o=c[d];break}o&&(s=e.datavisualization.Diagram.ScrollUtil._getRulerSize(this.diagram),h=n?{id:i[0].id+"_marker",x1:0,y1:0,x2:s.left,y2:0,stroke:t.markerColor,"stroke-width":1.5,class:"ej-d-ruler-marker"}:{id:i[0].id+"_marker",x1:0,y1:0,x2:0,y2:s.top,stroke:t.markerColor,"stroke-width":1.5,class:"ej-d-ruler-marker"},g=this._createMarkarLine(i,h),r=this.diagram._currZoom,l=a.model.offset-a._starValue,n?(m=this.currentPoint.y*r-this.diagram._vScrollOffset+l,g.setAttribute("transform","translate(0 "+m+")")):(u=this.currentPoint.x*r-this.diagram._hScrollOffset+l,g.setAttribute("transform","translate("+u+" 0)")),o.appendChild(g))}},i.prototype._createMarkarLine=function(t,i){if(t){var a=document.getElementById(t[0].id+"_marker");return a&&a.parentNode.removeChild(a),a=document.createElementNS("http://www.w3.org/2000/svg","line"),e.datavisualization.Diagram.Util.attr(a,i),a}},i.prototype._drawRulerMarkers=function(){this.diagram.model.rulerSettings.showRulers&&(this._drawRulerMarker(this.diagram.model.rulerSettings.horizontalRuler,this.diagram._hRuler,this.diagram._hRulerInstance,!1),this._drawRulerMarker(this.diagram.model.rulerSettings.verticalRuler,this.diagram._vRuler,this.diagram._vRulerInstance,!0))},i.prototype.mouseup=function(){this._endAction(),this.diagram._pageBackgroundLayer&&e.datavisualization.Diagram.PageUtil._updatePageSize(this.diagram),this.singleAction&&this.diagram.activateTool("select"),delete this.diagramBounds,this._adjustLines={lines:[]},this._undoObject=null,this._redoObject=null},i.prototype.mousePosition=function(t){return this.diagram._mousePosition(t)},i.prototype.updateCursor=function(t){this.diagram._currentCursor=t,this.diagram._updateCursor()},i.prototype.nearestGridPoint=function(t){var i=e.datavisualization.Diagram.Point();if(this.diagram.model.snap&e.datavisualization.Diagram.Snap.Grid){var a=this.diagram.model.magnification/100,n=this.diagram.model.grid.horizontalSpacing*a,o=this.diagram.model.grid.verticalSpacing*a,s=t.x%n,r=t.y%o;i.x=s>=n/2?t.x+n-s:t.x-s,i.y=r>=o/2?t.y+o-r:t.y-r}return i},i.prototype.snap=function(t){var i=this.diagram.model.snapSettings,a=this.diagram._currZoom;return i.snapConstraints&e.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(t.x=e.datavisualization.Diagram.SnapUtil._round(t.x,e.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!0),a)),i.snapConstraints&e.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(t.y=e.datavisualization.Diagram.SnapUtil._round(t.y,e.datavisualization.Diagram.SnapUtil._getSnapIntervals(this.diagram,!1),a)),t},i.prototype._endAction=function(){var i,a,n,o,s,r,l,d;if(this.inAction=!1,this.svgHelper)if(i=this.helper,a=this.diagram._spatialSearch,"group"!=i._type)e.datavisualization.Diagram.SpatialUtil._removeFromaQuad(a,a.quadTable[i.name],i);else for(n=this.helper.children.length-1;n>=0;n--)e.datavisualization.Diagram.SpatialUtil._removeFromaQuad(a,a.quadTable[i.children[n].name],i.children[n]);this.helper&&(this.svgHelper&&(o=this.diagram,s=this,this.diagram._views.forEach(function(e){var i=o._views[e];if(s.helper)var a=i.svg.getElementById(s.helper.name),n=i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],r=t(n).find("#"+s.helper.name)[0];a&&a.parentNode&&a.parentNode.removeChild(a),r&&n.removeChild(r)})),this.helper.gradient&&(r=this.diagram._svg.getElementsByTagName("defs")[0],l=this.diagram._svg.getElementById(this.helper.name+"_gradient"),r&&l&&r.removeChild(this.diagram._svg.getElementById(this.helper.name+"_gradient"))),(d=document.getElementById(this.helper.name+"_parentdiv"))&&d.parentNode.removeChild(d)),this._previousPossibleConnection&&(this._previousPossibleConnection=null,e.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer)),this._currentPossibleConnection=null,this._possibleConnectionPort=null,this.helper=null,this.svgHelper=null,this.selectedObject=null,this.startPoint=e.datavisualization.Diagram.Point(0,0),this.currentPoint=e.datavisualization.Diagram.Point(0,0),this.previousPoint=e.datavisualization.Diagram.Point(0,0)},i.prototype._isResizeCorner=function(t){var e=!1;switch(t){case"n-resize":case"e-resize":case"w-resize":case"s-resize":case"ne-resize":case"nw-resize":case"se-resize":case"sw-resize":case"targetEndPoint":case"sourceEndPoint":e=!0}return e},i.prototype._initHelper=function(){this.selectedObject&&(this.helper=t.extend(!0,{},this.selectedObject),this._updateHelperName(this.helper))},i.prototype._updateHelperName=function(t,e){var i,a,n,o,s;for(e?t.name+="helper":t.name="helper",t.opacity=.5,a=0,n=(i=t.labels).length;a<n;++a)i[a].name+="helper";if(t.ports)for(a=0,n=(o=t.ports).length;a<n;++a)o[a].name+="helper";if("group"===t._type)for(a=0,n=(s=this.diagram._getChildren(t.children)).length;a<n;a++)this._updateHelperName(s[a],!0)},i.prototype._raiseEvent=function(t,e){return this.diagram.model[t]&&(e.elementType=this.diagram.getObjectType(e.element),e.diagramId=this.diagram.element[0].id,this.diagram._trigger(t,e)),e},i.prototype._findPort=function(t,e){var i,a,n,o,s=this.diagram._findPortAtPoint(t,e);if(!s&&"group"===e._type)for(a=this.diagram._getChildren(e.children),n=0;n<a.length;n++)if((o=this.diagram.nameTable[a[n]])&&!o.segments&&!o._isInternalShape)if((i=this._findPort(t,o))&&"group"!=this.diagram.getObjectType(o))this._currentPossibleConnection=o,s=i;else if(i)return i;return s},i.prototype._checkConnectionPossible=function(t){var i,a,n,o,s,r,l,d,h=null,g=null,c=this._sourcePossibleConnection,u=e.datavisualization.Diagram.Point(this.currentPoint.x,this.currentPoint.y),m=this.diagram._findConnectableNodeUnderMouse(t);if(m&&(this._sourcePossibleConnection||this.selectedObject)&&(this.selectedObject&&("targetEndPoint"==this._endPoint&&this.selectedObject.sourceNode&&(c=this.diagram.nameTable[this.selectedObject.sourceNode]),"sourceEndPoint"==this._endPoint&&this.selectedObject.targetNode&&(c=this.diagram.nameTable[this.selectedObject.targetNode])),this.selectedObject&&!this.selectedObject._isAnnotationLine&&(m=e.datavisualization.Diagram.bpmnHelper.canAllowConnection(this.diagram,c,m))),m&&!m.segments)"pseudoGroup"==m.type||m.isLane||m.isSwimlane?(this._currentPossibleConnection=null,this._possibleConnectionPort=null):(this._showPorts(m),this._currentPossibleConnection=m,(null==this._previousPossibleConnection||this._previousPossibleConnection.name!==this._currentPossibleConnection.name)&&(this._previousPossibleConnection=this._currentPossibleConnection));else if(this.diagram.activeTool instanceof e.datavisualization.Diagram.LineTool)this._showPorts(),this._currentPossibleConnection=null,this._possibleConnectionPort=null;else{for(i=e.datavisualization.Diagram.Point(0,0),"targetEndPoint"==this._endPoint?(i.x=this.selectedObject.targetPoint.x-25,i.y=this.selectedObject.targetPoint.y-25):"sourceEndPoint"==this._endPoint&&(i.x=this.selectedObject.sourcePoint.x-25,i.y=this.selectedObject.sourcePoint.y-25),a=e.datavisualization.Diagram.Rectangle(i.x,i.y,50,50),n=e.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,a),o=0;this._nearestNodes&&o<this._nearestNodes.length;o++)this._showPort(this._nearestNodes[o],!0);for(this._nearestNodes=[],o=0;o<n.length;o++)if((s=n[o]).objects.length>0)for(r=0;r<s.objects.length;r++)l=s.objects[r],d=e.datavisualization.Diagram.Util.bounds(l),e.datavisualization.Diagram.Geometry.intersectsRect(a,d)?!l.segments&&l.visible&&(this._showPort(l),this._nearestNodes.push(l)):l.segments||this._showPort(l,!0);this._currentPossibleConnection=null,this._possibleConnectionPort=null}if(this._currentPossibleConnection){if(h=this._findPort(u,this._currentPossibleConnection),this._currentPossibleConnection&&(this._sourcePossibleConnection||this.selectedObject)&&this.selectedObject&&!this.selectedObject._isAnnotationLine&&(g=e.datavisualization.Diagram.bpmnHelper.canAllowConnection(this.diagram,c,this._currentPossibleConnection),this._currentPossibleConnection!=g&&(this._showPort(this._currentPossibleConnection,!0),g&&this._showPort(g),h=null),this._currentPossibleConnection=g),h&&e.datavisualization.Diagram.Util.canConnect(h,!0)||e.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)?e.datavisualization.Diagram.SvgContext._drawPortHighlighter(h,this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.diagram):e.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=h,h&&e.datavisualization.Diagram.Util.canConnect(h,!0)){var p=this._currentPossibleConnection,f=e.datavisualization.Diagram.Util._getPortPosition(this._possibleConnectionPort,e.datavisualization.Diagram.Util.bounds(p,!0)),_=e.Matrix.identity();e.Matrix.rotate(_,p.rotateAngle,p.offsetX,p.offsetY),f=e.Matrix.transform(_,f),this.currentPoint=f}}else this._previousPossibleConnection&&(this._previousPossibleConnection=null,e.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=null)},i.prototype._showPorts=function(t){t?(this._currentPossibleConnection&&this._currentPossibleConnection.name!==t.name&&this._showPort(this._currentPossibleConnection,!0),this._showPort(t)):null!=this._currentPossibleConnection&&this._showPort(this._currentPossibleConnection,!0)},i.prototype._showPort=function(t,i){var a,n,o,s,r;if(i){if(a=t.ports)for(s=0,r=a.length;s<r;++s)((n=a[s]).visibility&e.datavisualization.Diagram.PortVisibility.Hover||n.visibility&e.datavisualization.Diagram.PortVisibility.Connect&&("endPoint"==this.name||this instanceof e.datavisualization.Diagram.LineTool))&&((o=this.diagram._adornerSvg.getElementById(t.name+"_"+n.name))&&o.setAttribute("visibility","hidden"))}else if(t.visible&&(a=t.ports))for(s=0,r=a.length;s<r;++s)((n=a[s]).visibility&e.datavisualization.Diagram.PortVisibility.Hover||n.visibility&e.datavisualization.Diagram.PortVisibility.Connect&&("endPoint"==this.name&&this.inAction||this instanceof e.datavisualization.Diagram.LineTool))&&((o=this.diagram._adornerSvg.getElementById(t.name+"_"+n.name))&&o.setAttribute("visibility","visible"))},i.prototype._getAllLaneChildren=function(t,e){var i,a,n=this.diagram.getNode(t.name);if(n&&n.lanes&&n.lanes.length>0)for(i=0;i<n.lanes.length;i++)for(a=0;a<n.lanes[i].children.length;a++)e.push(n.lanes[i].children[a]);return e},i.prototype._getAllChildren=function(t){for(var e=0;e<t.length;e++)t[e].isSwimlane&&t.concat(this._getAllLaneChildren(t[e],t));return t},i.prototype._showAllPorts=function(t){var i,a,n=this.diagram.nodes();if(n=n.slice(),n=this._getAllChildren(n),e.datavisualization.Diagram.Util.isPageEditable(this.diagram)||(t=!0),t)for(i=0,a=n.length;i<a;i++)this._showPort(n[i],t);else for(i=0,a=n.length;i<a;++i)this._showPort(n[i])},i.prototype._disconnect=function(t){var i,a=this.diagram.nameTable[t.targetNode];a&&(e.datavisualization.Diagram.Util.findPortByName(a,t.targetPort),i=this._raiseEvent("connectionChange",{element:t,connection:null,port:null,cancel:!1}),e.datavisualization.Diagram.Util.removeItem(a.inEdges,t.name),i.cancel||(t.targetNode=null,t.targetPort=null)),(a=this.diagram.nameTable[t.sourceNode])&&(e.datavisualization.Diagram.Util.findPortByName(a,t.sourcePort),i=this._raiseEvent("connectionChange",{element:t,connection:null,port:null,cancel:!1}),e.datavisualization.Diagram.Util.removeItem(a.outEdges,t.name),i.cancel||(t.sourceNode=null,t.sourcePort=null))},i.prototype.getLabelUnderMouse=function(){return this.diagram._findLabelEditing?null:this.activeLabel},i.prototype._getNodesfrombounds=function(t,i){for(var a,n,o,s,r,l,d=[],h=this.diagram._sortByZIndex(this.diagram.nodes()),g=0,c=h.length;g<c;g++)o=this.diagram.nameTable[h[g].name],e.datavisualization.Diagram.Util.canConnect(o)&&(s=[(a=e.datavisualization.Diagram.Util.bounds(o,!1)).points[0],a.points[1],a.points[2],a.points[3],a.points[0]],r=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom},{x:t.left,y:t.top}],this.diagram._autoConnectEndPoint=!0,n=e.datavisualization.Diagram.Util.interSect(s,r,null,this.diagram),delete this.diagram._autoConnectEndPoint,l=!1,0==n.length&&(l=e.datavisualization.Diagram.Geometry.containsPoint(a,i)),(n&&n.length||l)&&d.push(o));return this._getAllChildren(d)},i.prototype._slopDistance=function(t,e,i){var a,n,o,s,r,l,d,h,g,c;r=i.x,l=i.y,a=t.x,n=t.y;var u=(o=e.x)-a,m=(s=e.y)-n,p=u*u+m*m,f=-1;return 0!=p&&(f=((r-a)*u+(l-n)*m)/p),f<0?(d=a,h=n):f>1?(d=o,h=s):(d=a+f*u,h=n+f*m),g=r-d,c=l-h,Math.sqrt(g*g+c*c)},i.prototype._getNearestNodePorts=function(t,i,a,n){var o,s,r,l,d,h,g,c,u,m=null,p=null;for(n.x=n.left,n.y=n.top,n.width=n.right-n.left,n.height=n.bottom-n.top,o=0;o<i.length;o++)for(r=this.diagram.nameTable[i[o].name],g=e.datavisualization.Diagram.Util.bounds(r),s=0;r.ports&&r.ports.length>0&&s<r.ports.length;s++)l=r.ports[s],h=e.datavisualization.Diagram.Util._getPortPosition(l,g),u=e.Matrix.identity(),e.Matrix.rotate(u,r.rotateAngle,r.offsetX,r.offsetY),h=e.Matrix.transform(u,h),c=e.datavisualization.Diagram.Geometry.distance(h,this.currentPoint),(!d||d&&d>c)&&(d=c,e.datavisualization.Diagram.Geometry.containsPoint(n,h)&&(m=l,p=r));return{nearestNode:p,nearestPort:m}},i.prototype._updateConnectionTarget=function(t,i){this._endPoint;if(t=i?t:this.diagram.nameTable[this.diagram._getChild(t)]){var a=this.currentPoint,n={left:a.x-t._endPointHitPadding.left,top:a.y-t._endPointHitPadding.top,right:t._endPointHitPadding.right+a.x,bottom:t._endPointHitPadding.bottom+a.y},o=this._getNodesfrombounds(n,a),s=this._getNearestNodePorts(t,o,a,n);s.nearestNode&&(this._currentPossibleConnection=s.nearestNode,s.nearestPort&&(e.datavisualization.Diagram.Util.canConnect(s.nearestPort,!0)||e.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection))&&(this._possibleConnectionPort=s.nearestPort)),this._removeHighLighter(),e.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort&&e.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?e.datavisualization.Diagram.SvgContext._drawPortHighlighter(this._possibleConnectionPort,this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):this._currentPossibleConnection&&e.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&e.datavisualization.Diagram.SvgContext._drawNodeHighlighter(this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom),this.diagram._dock(t,this.diagram.nameTable,!0)}},i.prototype._raiseConnectionChangeEvent=function(t,i){var a,n={element:t,endPoint:this._endPoint,connection:this._currentPossibleConnection,port:this._possibleConnectionPort,cancel:!1},o=n.connection?n.connection.name:null,s=n.port?n.port.name:null;return i?(o!=t.targetNode||s!=t.targetPort)&&(n=this._raiseEvent("connectionChange",n)):(o!=t.sourceNode||s!=t.sourcePort)&&(n=this._raiseEvent("connectionChange",n)),n.cancel?void 0:(i?(this._currentPossibleConnection&&t.targetNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.inEdges.push(t.name),t.targetNode&&((a=this.diagram.nameTable[t.targetNode])&&e.datavisualization.Diagram.Util.removeItem(a.inEdges,t.name))),a=this.diagram.nameTable[t.targetNode],this.diagram._comparePropertyValues(t,"targetNode",{targetNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),t.targetNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,a&&a._ports&&this._updateInternalPorts(a,t,!0),this.diagram._comparePropertyValues(t,"targetPort",{targetPort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),t.targetPort=this._possibleConnectionPort?this._possibleConnectionPort.name:null):(this._currentPossibleConnection&&t.sourceNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.outEdges.push(t.name),t.sourceNode&&((a=this.diagram.nameTable[t.sourceNode])&&e.datavisualization.Diagram.Util.removeItem(a.outEdges,t.name))),a=this.diagram.nameTable[t.sourceNode],this.diagram._comparePropertyValues(t,"sourceNode",{sourceNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),t.sourceNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,a&&a._ports&&this._updateInternalPorts(a,t,!1),this.diagram._comparePropertyValues(t,"sourcePort",{sourcePort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),t.sourcePort=this._possibleConnectionPort?this._possibleConnectionPort.name:null),!0)},i.prototype._updateInternalPorts=function(t,i,a){var n,o,s,r=e.datavisualization.Diagram.Util.findPortByName(t,a?i.targetPort:i.sourcePort);r&&"internal"===r.type&&r.name===(a?i.targetPort:i.sourcePort)&&(n=t._ports.indexOf(r),t._ports.splice(n,1),a?(i._removeTargetPort=r,i.targetPort=null):(i._removeSourcePort=r,i.sourcePort=null),o=e.datavisualization.Diagram.Util.getPoints(i),(s=[]).push({points:o,type:"orthogonal"}),this.diagram._isUndo=!0,this.diagram.updateConnector(i.name,{segments:s}),delete this.diagram._isUndo)},i}(),e.datavisualization.Diagram.ToolBase=i,a=function(i){function a(t){i.call(this,"select",t),this.cursor="default",this._svgHelper=null}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){i.prototype.mousedown.call(this,t);var a=this._findNodeUnderMouse(t);this.selectedObject=a&&e.datavisualization.Diagram.Util.canSelect(a)&&e.datavisualization.Diagram.Util.enableLayerOption(a,"lock",this.diagram)?a:null,this._itemClick(this.selectedObject,this.actualObject,this.selectedObject),this._nodeUnderMouseDown=this.diagram._findNodeUnderMouse(t)},a.prototype.mousemove=function(t){i.prototype.mousemove.call(this,t);var a=this._nodeUnderMouseDown;(!this.selectedObject&&!e.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||a&&a.isLane&&e.datavisualization.Diagram.Util.canMultiSelectOnLane(a)||a&&"connector"!=a._type&&e.datavisualization.Diagram.Util.canMultiSelectOnNode(a))&&e.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y?this._updateHelper():(this.inAction=!0,this._initHelper()))},a.prototype.mouseup=function(a){var n,o,s,r,l,d,h,g;if(this.diagram._eventCause.selectionChange=e.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction)if(this.currentPoint=this.mousePosition(a),0!==(n=e.datavisualization.Diagram.Geometry.rect([{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPoint.x,y:this.currentPoint.y}])).width||0!==n.height){if(o=[],o=this.diagram._getNodesfrombounds(n),this.diagram._hasSelection()&&(o=this.diagram._getChildren(o),e.datavisualization.Diagram.Util.removeItem(o,"multipleSelection"),this.diagram._clearSelection(!!o.length)),o.length>0){if(s=o,this.diagram._eventCause.selectionChange=e.datavisualization.Diagram.SelectionChangeCause.RubberBand,s.length>1){for(l=e.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),d=0;d<s.length;d++)l.children.push(this.diagram._getChild(s[d]));this.diagram.nodes().push(l),this.diagram._nodes=t.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[l.name]=l,r=l}else e.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(r=o[0]);r&&(("group"===r._type||"pseudoGroup"===r.type)&&e.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),this.diagram._addSelection(r))}}else this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();else this.selectedObject||this.diagram._hasSelection()?(a.ctrlKey||a.shiftKey?e.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&this._processCtrlKey(a):this.diagram._hasSelection()&&(!this.selectedObject||this.diagram.selectionList[0].name!=this.selectedObject.name)&&this.diagram._clearSelection(!!this.selectedObject),this.diagram._enableAPIMethods=!1,this.diagram._addSelection(this.selectedObject),this.diagram._enableAPIMethods=!0):this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();this.diagram._isDropped=!1,this._nodeUnderMouseDown=null,(this.selectedObject||this.actualObject)&&(h=this._findNodeUnderMouse(a),g=this.diagram._mousePosition(a.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(h),actualObject:this.actualObject,count:this.diagram._getEventDetail(a),offsetX:g.x,offsetY:g.y,event:a})),i.prototype.mouseup.call(this,a)},a.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this.selectedObject=null,this._svgHelper=null),i.prototype._endAction.apply(this)},a.prototype._initHelper=function(){var t,e,i;this._svgHelper||(t=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(t),e=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",class:"rubberBandSelection",x:this.startPoint.x*e,y:this.startPoint.y*e,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),t.appendChild(i),t.setAttribute("pointer-events","none"),this._svgHelper=t)},a.prototype._updateHelper=function(){var t=this.diagram._adornerSvg.getElementById("helper"),e=Math.abs(this.startPoint.x-this.currentPoint.x),i=Math.abs(this.startPoint.y-this.currentPoint.y),a=this.diagram._currZoom,n=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*a,o=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*a;t&&this.diagram._adornerSvg.rect({id:t.id,x:n,y:o,width:e*a,height:i*a})},a}(i),e.datavisualization.Diagram.SelectTool=a,n=function(i){function a(t){i.call(this,"move",t),this.cursor="move",this._isMouseDown=!1,this.diffx=0,this.diffy=0,this.helper=null,this.hoverNode=null,this.stackOverNode=null,this.undoObject=[],this.activeLabel=null,this._canMoveLabel=!1,this.dragState=""}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){if(e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diffx=0,this.diffy=0,this._allowPan(this.selectedObject,"mousedown",t),i.prototype.mousedown.call(this,t),this._isMouseDown=!0,this._canMoveLabel=!1,this.activeLabel=null,t)var a=this._findNodeUnderMouse(t);a&&!e.datavisualization.Diagram.Util.canSelect(a)&&e.datavisualization.Diagram.Util.enableLayerOption(a,"lock",this.diagram)?this.updateCursor("default"):"pointer"!=this.diagram._currentCursor&&this.updateCursor(this.cursor),this.dragState=e.datavisualization.Diagram.DragState.Starting},a.prototype.mousemove=function(a){var n,o,s,r,l,d,h;this.diagram._eventCause.selectionChange=e.datavisualization.Diagram.SelectionChangeCause.Mouse,this._allowPan(this.selectedObject,"mousemove",a),i.prototype.mousemove.call(this,a),e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),n=!this.inAction,this._isMouseDown&&!this.inAction&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y||this.diagram._selectedSymbol)&&!this.selectedObject&&(this.diagram.selectionList&&this.diagram.selectionList[0]&&"pseudoGroup"===this.diagram.selectionList[0].type||this.diagram._selectedSymbol||e.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram))&&(this._updateSelectedObject(),this._itemClick(this.selectedObject,this.actualObject,this.diagram.model),null!=this.selectedObject&&(o=s=e.datavisualization.Diagram.Util.bounds(this.selectedObject),r={bounds:{x:s.x,y:s.y,width:s.width,height:s.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},l={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection(!0),this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:r,newValue:l,cancel:!1}),d={},this.selectedObject&&("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(d=this.diagram._getChildTable(this.selectedObject,d)),h=t.extend(!0,{},{childTable:d,node:this.selectedObject}),this.undoObject=jQuery.extend(!0,{},h))),this._isMouseDown&&this.selectedObject&&e.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&!this.diagram._isEditing&&e.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&(this.dragState=e.datavisualization.Diagram.DragState.Dragging,this.inAction||(this.inAction=!0,this.updateCursor("move"),this._updateSelection(),this.selectedObject.segments&&(e.datavisualization.Diagram.Util.isTargetConnected(this.selectedObject)||e.datavisualization.Diagram.Util.isSourceConnected(this.selectedObject))&&this._disconnect(this.selectedObject),e.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram)),this.diagram&&!this.diagram._isEditing&&(this._containerMouseMove(a),this.helper||this._updateObject(),this.selectedObject.segments||this.selectedObject.isLane||this.diagram._renderTooltip(this.selectedObject,n),this.diagram._updateSelectionHandle(!0))),this.previousPoint=this.currentPoint,this._stackOverNode=this._findStackOverNode(this.helper,a),delete this.diagram._notAllow},a.prototype._updateSelectedObject=function(){var t=this.diagram._focusedElement;t&&(this.diagram.selectionList[0]&&"pseudoGroup"==this.diagram.selectionList[0].type?this.selectedObject=this.diagram.selectionList[0]:this.diagram.selectionList[0]!=t?(this.diagram._clearSelection(!0),this.selectedObject=this.diagram.nameTable[t.name]):this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name])},a.prototype._nodeCanHighlight=function(t){var e=!1;return-1==this.diagram._getChildren(t.children).indexOf(this.selectedObject.name)&&("group"!=this.selectedObject._type?e=!0:"group"===t._type&&(this._containsChild(this.selectedObject,t.name)||(e=!0))),e},a.prototype._swimlanPhaseDrag=function(){if(this.selectedObject&&this.selectedObject.isPhase){var t=null,i=this._getNodeUnderMouse();i&&(t=this._getSwimLaneNode(i,this.selectedObject,!0)),t&&e.datavisualization.Diagram.SvgContext._drawNodeHighlighter(t,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom)}},a.prototype._containerMouseMove=function(t){var i,a,n=this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent];n&&n.container?("canvas"==(a=n.container).type||"stack"==a.type)&&(e.datavisualization.Diagram.canvasHelper._updateHelper(this.diagram),e.datavisualization.Diagram.canvasHelper._updateHighlighter(this.diagram,t)):(this.selectedObject.isSwimlane||("pseudoGroup"==this.selectedObject.type&&this._isParentAsLane(this.selectedObject)?this._removeHighLighter():this.isDiagram(t)||this.selectedObject.segments?!this.isDiagram(t)&&this.selectedObject.isPhase?e.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram):this._removeHighLighter():(i=this._getNodeUnderMouse())&&i.container&&(this.selectedObject.isSwimlane||this.selectedObject.isLane)?this._getSwimLaneNode(i,this.selectedObject)&&this._nodeHighLighter(i):i&&i.container&&"stack"!=i.container.type?(this.selectedObject.name!=i.name&&"pseudoGroup"!=this.selectedObject.type&&e.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.selectedObject,i)&&this._nodeHighLighter(i),i&&("pseudoGroup"==this.selectedObject.type||"multipleSelection"==this.selectedObject.name)&&this._fromDiagram(this.selectedObject.children)&&this._nodeHighLighter(i)):i&&(this._removeHighLighter(),i.segments?e.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(i,this.diagram,this.diagram._currZoom):this._nodeHighLighter(i))),"pseudoGroup"==this.selectedObject.type?this._fromDiagram(this.diagram._getChildren(this.selectedObject.children))?(this._undoObject||e.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)):(this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()||this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children)))&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint):e.datavisualization.Diagram.Util.canMove(this.selectedObject)&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)),this._swimlanPhaseDrag(t)},a.prototype.isDiagram=function(t){return!(t.target.id!=this.diagram._id+"_canvas_svg"&&!t.target.id.match(this.selectedObject.name))},a.prototype._allowPan=function(t,i,a){"mousedown"===i&&this.diagram.tools.panTool.mousedown(a),t&&("group"===t._type||"node"==t._type)&&t.constraints&e.datavisualization.Diagram.NodeConstraints.AllowPan&&("mousemove"===i?this.diagram.tools.panTool.mousemove(a):"mouseup"===i&&this.diagram.tools.panTool.mouseup(a))},a.prototype._checkForDropEvent=function(t,i){if(!this.diagram._selectedSymbol){var a=this.diagram,n=t,o=null,s=e.datavisualization.Diagram.ObjectTypes.Diagram;this.selectedObject&&this.selectedObject.parent&&((a=this.diagram.nameTable[this.selectedObject.parent]).isLane?s=e.datavisualization.Diagram.ObjectTypes.Lane:"group"==a._type&&(s=e.datavisualization.Diagram.ObjectTypes.Group)),t&&!i&&(o=e.datavisualization.Diagram.Util.bounds(t),n=this._getTargetNode(t,o));do{if(!t||e.datavisualization.Diagram.Util.canAllowDrop(t))break;if(t.parent)t=this.diagram.nameTable[t.parent];else{if(t.container)break;t=null}}while(t);if(t)return this._raiseEvent("drop",{cancel:!1,element:this.selectedObject,source:this.diagram.getNode(a),target:this.diagram.getNode(n),sourceType:s}).cancel}return!1},a.prototype._getSwimLaneNode=function(t,e,i){if(t.isSwimlane)if(i){if(this.diagram.nameTable[this.diagram._getChild(t.children[2])].container.orientation==e.orientation)return t}else if(this.diagram.nameTable[this.diagram._getChild(t.children[2])].container.orientation!=e.orientation)return t;if(t.parent){var a=this.diagram.nameTable[t.parent];if(a)return this._getSwimLaneNode(a,e,i)}return null},a.prototype._cloneGroupNode=function(e,i){var a,n,o,s,r=null;if((n=t.extend(!0,{},e)).name+=i,e&&"group"===e._type)for(n.children=[],o=this.diagram._getChildren(e.children),s=0;s<o.length;s++)r=this.diagram.nameTable[o[s]],(a=t.extend(!0,{},r)).name+=i,a.parent&&(a.parent+=i),"group"===a._type&&this._cloneGroupNode(a,i),this.diagram.nameTable[a.name]=a,n.children.push(a);return n},a.prototype._outOfBoundsLaneDrop=function(t,i){var a,n,o;if(t&&t.isLane&&e.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){e.datavisualization.Diagram.Util.bounds(t);var s=this._getPageBounds(),r=i.offsetX,l=i.offsetY,d=0,h=0,g=0,c=0,u=this.diagram.nameTable[this.diagram._getChild(i.children[2])],m=this.diagram.nameTable[this.diagram._getChild(i.children[0])];if(c=m?m.height:c,g=i.phaseSize?i.phaseSize:g,u&&((a=this.diagram.nameTable[this.diagram._getChild(u.children[0])])&&(d=a.minHeight>100?a.minHeight:100,h=a.minWidth>100?a.minWidth:100)),"horizontal"===t.orientation?(n=h,o=d+m.height+g):(n=h+g,o=d+m.height),r+n/2+5>=s.width||r-n/2-5<=s.x||l+o/2+5>=s.height||l-o/2-5<=s.y)return!1}return!0},a.prototype._getMouseOverElement=function(e,i){var a,n,o=null;if(e&&e.target)for(var s=t(e.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group,.ej-d-group ej-d-classifier,.ej-d-node ej-d-classifier,.ej-d-label ej-d-classifier"),r=s[0],l=1;r;)if(this.diagram._isForeignObject(e.target)?o=this.diagram._findNode(r.getAttribute("id").split("_parentdiv")[0]):(o=this.diagram._findNode(r.getAttribute("id")))||(o=this.diagram._findNode(r.getAttribute("id").split("_label")[0])),o&&o.container)r=null;else{if(o&&i&&o._isHeader&&o.parent&&((a=this.diagram.nameTable[o.parent])&&a.isSwimlane))break;!(r=s[l])&&o&&o.parent&&((n=this.diagram.nameTable[o.parent])&&n.isLane&&(o=n)),l++}return o},a.prototype._multiNodedrag=function(t){e.datavisualization.Diagram.canvasHelper&&!this._containsSwimlane(this.selectedObject.children)&&e.datavisualization.Diagram.canvasHelper._multiNodedrag(this.diagram,t,this.selectedObject)},a.prototype._changeNodeState=function(t,i,a){var n,o,s,r,l,d,h,g=null,c=this._getMouseOverElement(t,a);return c&&(c=this.selectedObject&&!this.selectedObject.isLane||c.isLane?c:null),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isLane&&!i?(this.diagram._isDragg=!0,c&&(g=this._getSwimLaneNode(c,this.selectedObject)),c&&g?e.datavisualization.Diagram.canvasHelper._addNewLane(this.diagram,c,g):(n=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],this.diagram._isUndo=!0,this.diagram.remove(this.selectedObject),e.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.selectedObject),this.diagram._selectedSymbol&&e.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.diagram._selectedSymbol),this.diagram._isUndo=!1,(o=e.datavisualization.Diagram.SwimLaneHelper._createSwimlane(this.selectedObject,this.diagram,null,null,n))&&(s={element:this.diagram.getNode(this.selectedObject),cancel:!1},this.diagram._selectedSymbol=null,this._outOfBoundsLaneDrop(this.selectedObject,o)?(this.diagram._raiseDropEvent(s),s.cancel?this.selectedObject=null:(this.diagram._eventCause.nodeCollectionChange=e.datavisualization.Diagram.CollectionChangeCause.Drop,this.diagram.add(o)?(o=this.diagram.nameTable[o.name]||o,this.diagram._selectedSymbol=o,this.diagram._updateDroppedSymbol(o),this.selectedObject=o):this.selectedObject=null)):this.selectedObject=null))):this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container?(r=this.diagram.nameTable[this.selectedObject.parent])&&(l=r.container,this._removeHelpers(),l&&"canvas"==l.type?(e.datavisualization.Diagram.SvgContext._showNode(this.selectedObject,this.diagram._svg),"pseudoGroup"==this.selectedObject.type||this.diagram._isDragg||(this._swimlaneNodeDragged=e.datavisualization.Diagram.canvasHelper._singleNodedrag(this.diagram,t,c))):"stack"==l.type?e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer):(this.isDiagram(t)&&this._addToDiagram(),this.diffx=this.diffy=0)):this.selectedObject&&!this.selectedObject.isSwimlane&&("pseudoGroup"==this.selectedObject.type&&this.hasSameParent()?(this.currentPoint=this.previousPoint,this.diffx=0,this.diffy=0,this._removeHelpers(),this._multiNodedrag(t,c)):"connector"==this.selectedObject.type&&!this.selectedObject.isPhase||this.isDiagram(t)||"pseudoGroup"==this.selectedObject.type?"connector"!=this.selectedObject.type||this.selectedObject.isPhase?("","pseudoGroup"!=this.selectedObject.type&&"multipleSelection"!=this.selectedObject.name||!this.diagram._activeSwimLane?!this.diagram._activeSwimLane&&c&&c.isLane?(this.diagram._activeSwimLane=this._getParentSwimlane(c),this._multiNodedrag(t,c),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,c,"group"),this.selectedObject=null):c&&("bpmn"==c.type||c.container)&&(this._multiNodedrag(t,c),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,c,"group"),this.selectedObject=null):(this._multiNodedrag(t,c),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,this.diagram._activeSwimLane,"group"),this.selectedObject=null)):c&&("pseudoGroup"==this.selectedObject.type||"multipleSelection"==this.selectedObject.name)&&this._fromDiagram(this.selectedObject.children)&&e.datavisualization.Diagram.Util.canAllowDrop(c)&&(e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),e.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._multiNodedrag(t,c)):(c=this._getMouseOverElement(t),this.diagram._isDragg||(c&&c.container&&e.datavisualization.Diagram.Util.canAllowDrop(c)&&!this._checkForDropEvent(c)&&!c.isSwimlane&&e.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.selectedObject,c)?(d=this.helper?this.helper:this.selectedObject,e.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,d,c)?(e.datavisualization.Diagram.canvasHelper._addNodeToContainer(this.diagram,this.selectedObject,c),h=this.diagram._isUndo?e.datavisualization.Diagram.GroupChangeCause.HistoryChange:e.datavisualization.Diagram.GroupChangeCause.Drop,this.diagram._raiseGroupChangeEvent(this.selectedObject,null,c,h)):(this.diagram._translate(this.selectedObject,this.undoObject.node.offsetX-this.selectedObject.offsetX,this.undoObject.node.offsetY-this.selectedObject.offsetY,this.diagram.nameTable),this.diagram._updateAssociatedConnectorEnds(this.selectedObject,this.diagram.nameTable))):c&&this.selectedObject.name!=c.name&&this._checkForDropEvent(c,!0)))),this._removeHelpers(),void this._checkPhaseDrop(t)},a.prototype._checkPhaseDrop=function(t){var i,a,n,o,s,r=null;this.selectedObject&&this.selectedObject.isPhase&&((n=this._findNodeUnderMouse(t))&&(r=this._getSwimLaneNode(n,this.selectedObject,!0)),r?(e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),e.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),o=this._getSwimlaneHeader(r),"vertical"==this.selectedObject.orientation?(i=this.currentPoint.x-(r.offsetX-r.width/2),a="horizontal"):(i=this.currentPoint.y-(r.offsetY-r.height/2),i-=o?o.height:0,a="vertical"),{element:this.selectedObject,cancel:!1,target:r},this.diagram._dropPhase=!0,this.diagram.remove(this.selectedObject),delete this.diagram._dropPhase,this.diagram._selectedSymbol=null,this.inAction=!1,s=this.selectedObject.labels&&this.selectedObject.labels.length>0?this.selectedObject.labels[0]:{text:"Phase"},this.diagram._addPhase(r.name,{name:e.datavisualization.Diagram.Util.randomId(),offset:i,orientation:a,label:s,lineColor:this.selectedObject.lineColor,lineDashArray:this.selectedObject.lineDashArray,lineWidth:this.selectedObject.lineWidth}),this.diagram._selectedSymbol=null):(this.diagram._remove(this.selectedObject),this.diagram._clearSelection(!0),this.selectedObject=null,this.diagram._selectedSymbol=null))},a.prototype._removeHelpers=function(){e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),e.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg),this._removeHighLighter(),this.diffx=0,this.diffy=0},a.prototype._updateNodeState=function(t,i){var a,n,o,s,r,l,d,h,g;if(this.diagram.nameTable[this.selectedObject.parent]&&(a=this.diagram.nameTable[this.selectedObject.parent].container),(n=this._getNodeUnderMouse())&&(n=!this.selectedObject.isLane||n.isLane?n:null),a){if("canvas"==a.type)n&&i&&(o=this.selectedObject.parent,(s=this.diagram._getSwimlane(o))&&this.diagram._updateChildAdjacentConnectors(s,!0),e.datavisualization.Diagram.DiagramContext.update(i,this.diagram));else if("stack"==a.type&&!this._checkForDropEvent(n))if(r=this._stackOverNode){if((l=this.diagram.nameTable[r.parent])||(l=n),e.datavisualization.Diagram.Util.bounds(l),d=l.rotateAngle,0==l.rotateAngle||0!=d||this.diagram._rotate(l,-l.rotateAngle,this.diagram.nameTable),l.children=this.diagram._getChildren(l.children),this.selectedObject.name!=r.name&&(e.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),e.datavisualization.Diagram.canvasHelper._swapLane(this.diagram,l.children,this.selectedObject.name,r.name,"vertical"===l.container.orientation,l),l.children&&l.children.length>0))for(h=0;h<l.children.length;h++)l.children[h]=this.diagram.nameTable[l.children[h]]}else this.diffx=this.diffy=0}else"pseudoGroup"==this.selectedObject.type&&((g=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])])&&g.parent&&(a=this.diagram.nameTable[g.parent].container),a&&"canvas"==a.type&&n&&i&&(o=this.selectedObject.parent,this.diagram._updateChildAdjacentConnectors(o,!0),e.datavisualization.Diagram.DiagramContext.update(i,this.diagram)));this.selectedObject&&this.selectedObject.lebels&&this.selectedObject.lebels.length>0&&this.diagram.nameTable[this.selectedObject.name]&&this.diagram._updateQuad(this.selectedObject)},a.prototype.mouseup=function(a,n){var o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x=this.inAction;if(e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._eventCause.selectionChange=e.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction?(this.dragState=e.datavisualization.Diagram.DragState.Completed,e.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),s=this._changeNodeState(a,n,!0),this.inAction=!1,this.selectedObject&&(r=l=e.datavisualization.Diagram.Util.bounds(this.selectedObject),d={bounds:{x:l.x,y:l.y,width:l.width,height:l.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},h={bounds:{x:r.x,y:r.y,width:r.width,height:r.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this.selectedObject.isLane||(this._swimlaneNodedragged||(g=this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)),this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container&&s||(this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:d,newValue:h,cancel:!1}),this.dragState=""),e.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&(this.undoObject.connectors={},this._redoConnectors={},this.diagram._updateAllEdges(this.selectedObject))),n||this._updateNodeState(a,s),this._updateObject(),u={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(u=this.diagram._getChildTable(this.selectedObject,u)),this.diagram._selectedSymbol||this.selectedObject.isPhase||this.selectedObject.isLane||this._isLane||this.diagram._isDragg||(m={childTable:u,node:this.selectedObject},e.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&this._redoConnectors&&(m.connectors=this._redoConnectors),c=t.extend(!0,{},m),p={type:"positionchanged",undoObject:jQuery.extend(!0,{},this.undoObject),redoObject:jQuery.extend(!0,{},c),isMultipleNode:"group"===this.selectedObject._type,category:"internal",activeLabel:this.activeLabel},this._multipleUndo||this.diagram.addHistoryEntry(p),this.selectedObject.parent&&"bpmn"==this.diagram.nameTable[this.selectedObject.parent].type&&this.diagram._isGroupActionEnabled&&(this.diagram._closeGroupAction(),delete this.diagram._isGroupActionEnabled)),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isSwimlane&&(this.diagram._selectedSymbol=null),this.diagram._updateSelectionHandle(),o=this.selectedObject,this._isLane=!1,this._multipleUndo=!1)):this.selectedObject?o=this._findNodeUnderMouse(a):(a.ctrlKey||a.shiftKey?o=this._processCtrlKey(a):(f=!0,a.target.className,_=e.datavisualization.Diagram.Util.isClassifier(a)?e.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(a,this.diagram):this._findNodeUnderMouse(a),3===a.which&&this.diagram.selectionList[0]&&("pseudoGroup"===this.diagram.selectionList[0].type||"group"===this.diagram.selectionList[0]._type)&&this._hasMultipleSelection(_)&&(f=!1),e.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&this._isMouseDown&&(this.selectedObject=f?_:this.diagram.selectionList[0]),o=this.selectedObject),v=this.diagram.selectionList.length>0?this.diagram.selectionList[0]:null,this.selectedObject&&!this.diagram._selectionContains(this.selectedObject)&&this.diagram._clearSelection(!0)),!g&&this.selectedObject){if(this.selectedObject&&"pseudoGroup"!=this.selectedObject.type&&!x){var D=this._findNodeUnderMouse(a,!0),C=this.selectedObject,z=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:D,model:this.diagram.model,cancel:!1,event:a});this._itemClick(this.selectedObject,this.actualObject,D,v),z.cancel&&(this.selectedObject=C)}this.selectedObject&&(this._allowPan(this.selectedObject,"mouseup",a),this.selectedObject.isPhase||this._updateSelection(),this._enableLabel(this.selectedObject,this.activeLabel),this.selectedObject&&""===this.selectedObject.parent&&(this.selectedObject.isSwimlane?(e.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):this.diagram._isHyperLink(a)||e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),y=this.selectedObject,this.diagram._isDragg&&!this.diagram._selectionContains(y)&&(this.diagram._clearSelection(),y.isPhase||this.diagram._addSelection(y)))),o&&!x&&(b=this.diagram._mousePosition(a.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(o),actualObject:this.diagram.getNode(this.actualObject),count:this.diagram._getEventDetail(a),offsetX:b.x,offsetY:b.y,event:a}))}this._multipleUndo=!1,delete this.diffx,delete this.diffy,delete this._isMouseDown,delete this.actualObject,delete this._swimlaneNodedragged,this.diagram._removeTooltip(),this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit(),delete this.hoverNode,e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._activeSwimLane=null,i.prototype.mouseup.call(this,a)},a.prototype._updateObject=function(){var t,i,a,n;if(this.selectedObject)if("pseudoGroup"==this.selectedObject.type)for(a=0,n=(i=this.diagram._getChildren(this.selectedObject.children)).length;a<n;a++)(t=this.diagram.nameTable[i[a]])&&e.datavisualization.Diagram.DiagramContext.update(t,this.diagram);else this.selectedObject.parent&&(e.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this.diagram._updateParentBounds(this.diagram.nameTable[this.selectedObject.parent])),this.selectedObject.isSwimlane?(e.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)},a.prototype._endAction=function(){i.prototype._endAction.apply(this),this._isMouseDown=!1,this._mouseOffset=e.datavisualization.Diagram.Size(0,0)},a.prototype._updateHelperXY=function(t,i,a){var n,o,s,r,l,d,h=a.x<i.x,g=a.y<i.y,c=this.diffx+(a.x-i.x),u=this.diffy+(a.y-i.y);(this.diagram._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines)&&this.diagram._enableSnapToObject()&&(n=e.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.helper,h,g,e.datavisualization.Diagram.Point(c,u),a,i)),n||(n=e.datavisualization.Diagram.Point(c,u)),this.diffx=c-n.x,this.diffy=u-n.y,e.datavisualization.Diagram.Geometry.isEmptyPoint(n)||(o=e.datavisualization.Diagram.Util.bounds(t),s={bounds:{x:(o=e.datavisualization.Diagram.Rectangle(o.left,o.top,o.right-o.left,o.bottom-o.top)).x,y:o.y,width:o.width,height:o.height},offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},this._outOfBoundsDrag(t,n.x,n.y)&&this.diagram._translate(t,n.x,n.y,this.diagram.nameTable),r=e.datavisualization.Diagram.Util.bounds(t),l={bounds:{x:(r=e.datavisualization.Diagram.Rectangle(r.left,r.top,r.right-r.left,r.bottom-r.top)).x,y:r.y,width:r.width,height:r.height},offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},(d=this._raiseDragEvent({element:this.diagram.getNode(this.helper),offset:n,oldValue:s,newValue:l,cancel:!1}))&&!d.cancel?this.inAction||"group"===t._type&&e.datavisualization.Diagram.Util._updateGroupBounds(t,this.diagram):this.diagram._translate(t,-n.x,-n.y,this.diagram.nameTable))},a.prototype._outOfBoundsDrag=function(t,i,a,n){var o,s,r;if(i=i||0,a=a||0,t&&e.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)&&(o=e.datavisualization.Diagram.Util.bounds(t),s=this._getPageBounds(),n&&(i="horizontal"===n?0:i,a="vertical"===n?0:a),o)){if(r=this._getPadding(t),t.isPhase)return!0;if((!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(o.right+i+r.x>s.width||o.left+i-r.x<s.x)||(!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(o.bottom+a+r.y>s.height||o.top+a-r.y<s.y))return this.updateCursor("not-allowed"),!1}return this.diagram._notAllow||this.updateCursor("move"),!0},a.prototype._updateXY=function(t,i,a,n){var o,s,r,l,d,h,g=a.x<i.x,c=a.y<i.y,u=this.diffx+(a.x-i.x),m=this.diffy+(a.y-i.y);if((this.diagram._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines||this.diagram._enableSnapToObject())&&(o=e.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.selectedObject,g,c,e.datavisualization.Diagram.Point(u,m),a,i)),o||(o=e.datavisualization.Diagram.Point(u,m)),this.diffx=u-o.x,this.diffy=m-o.y,(!e.datavisualization.Diagram.Geometry.isEmptyPoint(o)||this.diagram._selectedSymbol&&!this.inAction)&&(r=e.datavisualization.Diagram.Util.bounds(t),l={bounds:{x:(r=e.datavisualization.Diagram.Rectangle(r.left,r.top,r.right-r.left,r.bottom-r.top)).x,y:r.y,width:r.width,height:r.height},offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},t.segments||e.datavisualization.Diagram.Util.canAllowPan(t)&&(0===this.diagram._hScrollOffset&&(o.x=0),0===this.diagram._vScrollOffset&&(o.y=0)),n&&!t.isSwimlane&&"pseudoGroup"!=t.type&&(this.diagram._preventDocking=!0),this._outOfBoundsDrag(t,o.x,o.y))){if(this.diagram._raiseOffsetPropertyChange(t,o.x,o.y,!0),this.diagram._translate(t,o.x,o.y,this.diagram.nameTable),delete this.diagram._preventDocking,d=e.datavisualization.Diagram.Util.bounds(t),h={bounds:{x:(d=e.datavisualization.Diagram.Rectangle(d.left,d.top,d.right-d.left,d.bottom-d.top)).x,y:d.y,width:d.width,height:d.height},offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},this.diagram._selectedSymbol){if((s={element:this.diagram.getNode(this.selectedObject),allowDrop:!0,target:this._getNodeUnderMouse(),oldValue:l,newValue:h,cancel:!1}).target&&s.target.segments&&e.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(s.target,this.diagram,this.diagram._currZoom),this._raiseEvent("dragOver",s),s.allowDrop)this.diagram._notAllow||this.updateCursor("move");else if(this.updateCursor("not-allowed"),!this.inAction)return this.diagram._removeSymbolFromDiagram(),!0}else s=this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:o,oldValue:l,newValue:h,cancel:!1});s&&!s.cancel||this.diagram._selectedSymbol?("group"===t._type&&"bpmn"!=t.type||"pseudoGroup"===t.type)&&(e.datavisualization.Diagram.Util._updateGroupBounds(t,this.diagram),(this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()||this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children)))&&e.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject)):s&&s.cancel&&this.diagram._translate(t,-o.x,-o.y,this.diagram.nameTable)}},a.prototype._boundsInterSects=function(t,e){var i,a=[];return e&&(i=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height},{x:e.x,y:e.y}],a=this._intersect(t,i,a)),a},a.prototype._intersect=function(t,i,a){for(var n,o,s=[],r=0;r<t.length-1;r++){for(n=0;n<i.length-1;n++)o=e.datavisualization.Diagram.Util.interSect2(t[r],t[r+1],i[n],i[n+1]),e.datavisualization.Diagram.Geometry.isEqualPoint(e.datavisualization.Diagram.Point(0,0),o)||s.push(o);a&&i.length}return s},a.prototype._getInterceptWithSegment=function(t,i){for(var a,n,o,s,r,l,d,h=[],g=e.datavisualization.Diagram.Util.findLength(e.datavisualization.Diagram.Point(0,0),e.datavisualization.Diagram.Point(this.diagram._viewPort.width,this.diagram._viewPort.height)),c=1;c<i.length;c++)for(s=[i[c-1],i[c]],o=[],n=Math.round(e.datavisualization.Diagram.Util.findAngle(s[0],s[1])%360,2),a=Math.round(e.datavisualization.Diagram.Util.findAngle(s[1],s[0])%360,2),r=n>0&&n<=90||n>180&&n<=270?90:-90,o.push(e.datavisualization.Diagram.Geometry.transform(t,n+r,g)),o.push(e.datavisualization.Diagram.Geometry.transform(t,a+r,g)),l=this._intersect(s,o,!1),d=0;d<l.length;d++)h.push(l[d]);return h},a.prototype._raiseDragEvent=function(t){if(!this.diagram._selectedSymbol&&!this.diagram._isDragg)return t.dragState=this.dragState,this._raiseEvent("drag",t)},a.prototype._updateSelection=function(){this.diagram._selectionContains(this.selectedObject)||(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject))},a.prototype._disableLabel=function(e,i){if(e&&i){var a=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],n="text"==e._shape?e.name:e.name+"_"+i.name,o=t(a).find("#"+n+".ej-d-label")[0];o&&(o.style.pointerEvents="none")}},a.prototype._enableLabel=function(e,i){if(e&&i){var a=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],n="text"==e._shape?e.name:e.name+"_"+i.name,o=t(a).find("#"+n+".ej-d-label")[0];o&&(o.style.pointerEvents="all")}},a}(i),e.datavisualization.Diagram.MoveTool=n,o=function(t){function i(e){t.call(this,"Port",e),this.cursor="pointer",this._isMouseDown=!1}return e.datavisualization.Diagram.extend(i,t),i.prototype.mousedown=function(e){this._isMouseDown=!0,t.prototype.mousedown.call(this,e),this.activePort=this.diagram._getvalues(e)},i.prototype.mousemove=function(e){this.activePort&&(t.prototype.mousemove.call(this,e),this.inAction||(this.inAction=!0,this.selectedObject=this.diagram.nameTable[this.diagram._getChild(this.activePort.source.parent)],this.undoObject=jQuery.extend(!0,{},{node:this.selectedObject})),this._updatePortXY(this.activePort.source,this.previousPoint,this.currentPoint)),this.previousPoint=this.currentPoint},i.prototype.mouseup=function(t){if(this._isMouseDown=!1,this.diagram.deactivateTool(t),this.inAction){this.inAction=!1;var e={type:"portpositionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},{node:this.selectedObject}),category:"internal",activePort:this.activePort.source};this._multipleUndo||this.diagram.addHistoryEntry(e)}},i.prototype._updatePortXY=function(t,e,i){var a=i.x-e.x,n=i.y-e.y;this.activePort&&(this.selectedObject||(this.selectedObject=this.diagram.nameTable[this.diagram._getChild(this.activePort.source.parent)]),this.diagram._translatePort(this.selectedObject,t,a,n))},i}(i),e.datavisualization.Diagram.PortTool=o,s=function(i){function a(t){i.call(this,"resize",t),this.cursor="default",this._resizeDirection=null,this._mouseOffset=e.datavisualization.Diagram.Size(0,0),this.diffx=0,this.diffy=0,this._startPoint=e.datavisualization.Diagram.Size(0,0),this.undoObject=null,this.pseudoGroupConstraints=null,this._mouseDown=!1,this.resizeState=""}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),i.prototype.mousedown.call(this,t),this._mouseDown=!0,this.resizeState=e.datavisualization.Diagram.ResizeState.Starting},a.prototype.mousemove=function(a){var n,o,s,r,l,d,h,g,c,u;i.prototype.mousemove.call(this,a),n=!this.inAction,e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),!this.inAction&&this.diagram.selectionList[0]&&this._mouseDown&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name],s={},r=l=e.datavisualization.Diagram.Util.bounds(this.selectedObject),d={bounds:{x:l.x,y:l.y,width:l.width,height:l.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},h={bounds:{x:r.x,y:r.y,width:r.width,height:r.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:d,newValue:h,cancel:!1,direction:this._resizeDirection}),("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(s=this.diagram._getChildTable(this.selectedObject,s)),g={childTable:s,node:this.selectedObject},this.selectedObject&&"pseudoGroup"===this.selectedObject.type&&(this.pseudoGroupConstraints=this.diagram.model.selectedItems.getConstraints&&t.isFunction(this.diagram.model.selectedItems.getConstraints)?this.diagram.model.selectedItems.getConstraints():e.datavisualization.Diagram.Util._getPseudoGroupConstraints(this.diagram,this.selectedObject,this.selectedObject)),o=t.extend(!0,{},g),this.undoObject=jQuery.extend(!0,{},o),this._resizeDirection=a.target.getAttribute("class"),this.selectedObject.width||(this.selectedObject.width=this.selectedObject._width),this.selectedObject.height||(this.selectedObject.height=this.selectedObject._height),this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX},e.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._svg,this.diagram._currZoom),this.inAction=!0),this.selectedObject&&(this.resizeState=e.datavisualization.Diagram.DragState.Resizing,c=!1,this.selectedObject&&this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent]).container&&("canvas"==u.container.type||"stack"==u.container.type)&&(c=!0):"pseudoGroup"==this.selectedObject.type&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(c=!0),this.selectedObject&&c||"pseudoGroup"===this.selectedObject.type&&this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children))?"pseudoGroup"===this.selectedObject.type&&this._isParentAsLane(this.selectedObject)?e.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject):e.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?e.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&"stack"==this.diagram.nameTable[this.selectedObject.parent].container.type?(this.helper||(this.helper=this._getCloneNode(this.selectedObject)),e.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateSize(this.helper,this.previousPoint,this.currentPoint),e.datavisualization.Diagram.DiagramContext.update(this.helper,this.diagram)):"pseudoGroup"!=this.selectedObject.type?this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint):"pseudoGroup"==this.selectedObject.type&&!this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._undoObject||e.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint)),this.helper||(this.selectedObject.isSwimlane?this._isMouseDown||(e.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)),this.diagram._renderTooltip(this.selectedObject,n),this.diagram._updateSelectionHandle(!0)),this.previousPoint=this.currentPoint},a.prototype.mouseup=function(a){var n,o,s,r,l,d,h,g,c,u,m,p,f=null;this._mouseDown=!1,this.inAction&&(this.resizeState=e.datavisualization.Diagram.ResizeState.Completed,e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.inAction=!1,n=!1,r={bounds:{x:(s=e.datavisualization.Diagram.Util.bounds(this.undoObject.node)).x,y:s.y,width:s.width,height:s.height},offsetX:this.undoObject.node.offsetX,offsetY:this.undoObject.node.offsetY,width:this.undoObject.node.width,height:this.undoObject.node.height},o=e.datavisualization.Diagram.Util.bounds(this.selectedObject),this.selectedObject.parent&&((l=this.diagram.nameTable[this.selectedObject.parent])&&l.container&&(o=e.datavisualization.Diagram.Util.bounds(this.helper))),d={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:o.x+o.width/2,offsetY:o.y+o.height/2,width:o.width,height:o.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:r,newValue:d,cancel:!1,direction:this._resizeDirection}),this.resizeState="",h=!0,(this.selectedObject.isLane||this.selectedObject.isSwimlane)&&(u={},u=this.diagram._getChildTable(this.selectedObject,u),f=t.extend(!0,{},{childTable:u,node:this.selectedObject})),this.selectedObject&&this.selectedObject.parent?(g=this.diagram.nameTable[this.selectedObject.parent]).container&&("canvas"==g.container.type||"stack"==g.container.type)&&(n=!0):"pseudoGroup"==this.selectedObject.type&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(n=!0),this.selectedObject&&n&&!g.isLaneStack?(e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),e.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,g)&&(this.selectedObject.isLane?e.datavisualization.Diagram.canvasHelper._resizeLane(this.diagram,this.selectedObject):e.datavisualization.Diagram.canvasHelper._singleNodeResize(this.diagram,a,this.selectedObject),e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram))):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?(e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),e.datavisualization.Diagram.canvasHelper._resizeLane(this.diagram,this.selectedObject),h=!1):("pseudoGroup"==this.selectedObject.type||"multipleSelection"==this.selectedObject.name)&&this.diagram._activeSwimLane&&e.datavisualization.Diagram.canvasHelper._multiNodeResize(this.diagram,a,this.selectedObject),this.selectedObject.parent&&e.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this.diagram.nameTable[this.selectedObject.name].container||e.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&(this.undoObject.connectors={},this._redoConnectors={},this.diagram._updateAllEdges(this.selectedObject)),h&&e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(),u={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(u=this.diagram._getChildTable(this.selectedObject,u)),m={childTable:u,node:this.selectedObject},e.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&this._redoConnectors&&(m.connectors=this._redoConnectors),c=t.extend(!0,{},m),p={type:"sizechanged",undoObject:f||this.undoObject,redoObject:jQuery.extend(!0,{},c),isMultipleNode:"group"===this.selectedObject._type,category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(p),this.diagram._removeTooltip(),this._multipleUndo=!1),i.prototype.mouseup.call(this,a)},a.prototype._updateSize=function(t,i,a,n,o,s,r,l,d){var h,g,c,u,m,p,f,_,v,y=n||this.currentPoint.x-this.startPoint.x,b=o||this.currentPoint.y-this.startPoint.y,x=this._resizeObject(t,y,b,l,d),D=e.datavisualization.Diagram.Point(x.x,x.y),C=x.width,z=x.height;if(t&&(this.pseudoGroupConstraints||(this.pseudoGroupConstraints=t.constraints)),this.pseudoGroupConstraints&e.datavisualization.Diagram.NodeConstraints.AspectRatio&&("n-resize"==this._resizeDirection||"s-resize"==this._resizeDirection||"w-resize"==this._resizeDirection||"e-resize"==this._resizeDirection?(h=e.Matrix.identity(),g=e.Matrix.transform(h,e.datavisualization.Diagram.Point(i.x-a.x,i.y-a.y)),Math.abs(g.x)>Math.abs(g.y)?z=C:C=z):z=C=i!=a?Math.max(z,C):0),c=e.datavisualization.Diagram.Size(),C<0&&(C=1),z<0&&(z=1),c.width=C,c.height=z,u=e.datavisualization.Diagram.Util.bounds(t),m={bounds:{x:(u=e.datavisualization.Diagram.Rectangle(u.left,u.top,u.right-u.left,u.bottom-u.top)).x,y:u.y,width:u.width,height:u.height},offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},!e.datavisualization.Diagram.Geometry.isEmptySize(c)){if(this.resizeState=e.datavisualization.Diagram.ResizeState.Resizing,!this._outOfBoundsDrag(t,C,z,D))return!0;this.diagram._raiseSizePropertyChange(t,C,z,!0),this.diagram.scale(t,C,z,D,this.diagram.nameTable,null,s,r),p=e.datavisualization.Diagram.Util.bounds(t),f={bounds:{x:(p=e.datavisualization.Diagram.Rectangle(p.left,p.top,p.right-p.left,p.bottom-p.top)).x,y:p.y,width:p.width,height:p.height},offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},_=t.pathData,(u.width!=p.width||u.height!=p.height)&&(v=this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:c,oldValue:m,newValue:f,direction:this._resizeDirection})),_&&t.pathData!=_&&(t._absoluteBounds=null,t._scaled=!0),v&&v.cancel&&!r&&this.diagram.scale(t,1/C,1/z,D,this.diagram.nameTable),"group"===t._type&&e.datavisualization.Diagram.Util._updateGroupBounds(t,this.diagram),this.diagram._updateAssociatedConnectorEnds(t,this.diagram.nameTable)}this.pseudoGroupConstraints=null},a.prototype._getSwimLaneNode=function(t){var e,i,a,n;if(t&&(e=t.parent,(i=this.diagram.nameTable[e])&&((a=i.parent)&&(n=this.diagram.nameTable[a]))))return n},a.prototype._outOfBoundsDrag=function(t,i,a,n){var o;if(!this.diagram._skipoutOfBounds&&t&&e.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var s=this._getPageBounds(),r=t.height*a-t.height,l=t.width*i-t.width;if(!this.inAction&&t.isLane){var d=this._getSwimLaneNode(t),h=e.datavisualization.Diagram.Util.bounds(d),g=this._getPadding(t);if(!this.diagram._selectedSymbol&&h.right+l+g.x>s.width||!this.diagram._selectedSymbol&&h.bottom+r+g.y>s.height)return this.updateCursor("not-allowed"),!1}else{h=e.datavisualization.Diagram.Util.bounds(t),g=this._getPadding(t);var c=e.Matrix.identity();if(e.Matrix.rotate(c,-t.rotateAngle,n.x,n.y),e.Matrix.scale(c,i,a,n.x,n.y),e.Matrix.rotate(c,t.rotateAngle,n.x,n.y),o=e.Matrix.transform(c,e.datavisualization.Diagram.Point(t.offsetX,t.offsetY)),!this.diagram._selectedSymbol&&(o.x+(h.width+l)/2+g.x>s.width||o.x-(h.width+l)/2<s.x)||!this.diagram._selectedSymbol&&(o.y+(h.height+r)/2+g.y>s.height||o.y-(h.height+r)/2<s.y))return this.updateCursor("not-allowed"),!1}this.updateCursor(this._resizeDirection)}return!0},a}(i),e.datavisualization.Diagram.ResizeTool=s,r=function(i){function a(t){i.call(this,"endPoint",t),this.cursor="move",this._endPoint=null,this._undoObject=null}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(a){var n;if(!this.inAction){i.prototype.mousedown.call(this,a),a.ctrlKey&&a.shiftKey&&((n=t(a.target).parents(".ej-d-connector")).length>0&&(this.selectedObject=this.diagram.nameTable[n[0].id],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject))),this._initialValue=null,this.diagram.selectionList[0]&&!this.selectedObject&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name]),this.undoObject=this._getClonedObject(this.selectedObject),this._endPoint=a.target.getAttribute("class"),this.targetid=a.target.id,this._selectedSegment="",this._nearestNodes=[];var o="targetEndPoint"==this._endPoint,s="sourceEndPoint"==this._endPoint;this._raiseEndPointDrag(this.selectedObject,o,s,e.datavisualization.Diagram.DragState.Starting)}},a.prototype.mousemove=function(a){var n,o,s,r,l,d,h,g,c,u,m,p,f;if(i.prototype.mousemove.call(this,a),!this.inAction,this.selectedObject&&(!a.ctrlKey||!a.shiftKey)){n=!1,2==this.selectedObject.segments.length&&(n=!0);var _=this.currentPoint.x-this.previousPoint.x,v=this.currentPoint.y-this.previousPoint.y,y=t.extend(!0,{},this.selectedObject.sourcePoint),b=t.extend(!0,{},this.selectedObject.targetPoint),x=t.extend(!0,{},this.selectedObject.segments);if(this._outOfBoundsDrag(this.selectedObject,this.currentPoint.x,this.currentPoint.y))if(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y)this.inAction&&(this.selectedSegment&&"segmentEnd"==this._endPoint?this._raiseSegmentEditEvent(e.datavisualization.Diagram.DragState.Dragging).cancel||0==_&&0==v||(m=this.currentPoint.x-this.startPoint.x,p=this.currentPoint.y-this.startPoint.y,this._initialValue&&(m=this._initialValue.x+m-this.selectedSegment._endPoint.x,p=this._initialValue.y+p-this.selectedSegment._endPoint.y),_=_*m<0?0:m,v=v*p<0?0:p,this._updateAdjacentSegments(_,v)):"segmentEnd"!=this._endPoint&&(("targetEndPoint"==this._endPoint||"sourceEndPoint"==this._endPoint)&&this._checkConnectionPossible(a),(f=this._updatePoints(this.selectedObject,e.datavisualization.Diagram.DragState.Dragging)).cancel||(this._disconnect(this.selectedObject),this._updateConnection(this.selectedObject,f.updateSelection))),this.diagram._updateSelectionHandle(!0),this.diagram._updateQuad(this.selectedObject),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram));else{if(this.inAction=!0,this.selectedObject.segments.length>0)for(o=0;o<this.selectedObject.segments.length;o++)this.selectedObject.segments[o]._bridges=[];(s=this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest"))&&s.setAttribute("pointer-events","none"),(r=this.diagram._svg.getElementById(this.selectedObject.name))&&r.setAttribute("pointer-events","none"),(l=this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g"))&&l.setAttribute("pointer-events","none"),(d=this.targetid.split("_")).reverse(),h=Number(d[0]),this.selectedSegment=this.selectedObject.segments[h],g=this.selectedSegment,this.selectedSegment&&"orthogonal"==this.selectedSegment.type?(c=!1,0===h&&(u=!0),this.selectedSegment.length&&this.selectedSegment.direction?0==h?(this.insertFirstSegment(_,v,d),c=!0):this.nextSegment=this.selectedObject.segments[h+1]:(this._addTerminalSegment(_,v,d),c=!0)):this.nextSegment=this.selectedObject.segments[h+1],c&&(e.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,!(n||u||!this.selectedObject.sourcePort),!(n||!g.length&&0!==g.length||!this.selectedObject.targetPort),this.diagram),e.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),e.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)),this.selectedSegment||"targetEndPoint"!=this._endPoint||(this.selectedSegment=this.selectedObject.segments[this.selectedObject.segments.length-1]),this.selectedSegment||"sourceEndPoint"!=this._endPoint||(this.selectedSegment=this.selectedObject.segments[0],this.nextSegment=this.selectedObject.segments[1]),this.selectedSegment&&(this._initialValue={x:this.selectedSegment._endPoint.x,y:this.selectedSegment._endPoint.y}),this.diagram._updateSelectionHandle(!0),this._raiseSegmentEditEvent(e.datavisualization.Diagram.DragState.Starting)}this.diagram._comparePropertyValues(this.selectedObject,"sourcePoint",{sourcePoint:y},!0),this.diagram._comparePropertyValues(this.selectedObject,"targetPoint",{targetPoint:b},!0),this.diagram._comparePropertyValues(this.selectedObject,"segments",{segments:x},!0)}this.previousPoint=this.currentPoint},a.prototype._raiseSegmentEditEvent=function(t){return this._raiseEvent("segmentChange",{element:this.selectedObject,dragState:t,point:this.currentPoint,cancel:!1})},a.prototype._updateAdjacentSegments=function(t,i){var a,n,o=this.selectedSegment,s={x:t+o._endPoint.x,y:i+o._endPoint.y};s=this.snap(s),"orthogonal"==o.type?("left"==o._direction||"right"==o._direction?(i=s.y-o._endPoint.y,o._startPoint.y+=i,o._endPoint.y=o._startPoint.y):(t=s.x-o._endPoint.x,o._startPoint.x+=t,o._endPoint.x=o._startPoint.x),o.points[0]=o._startPoint,o.points[o.points.length-1]=o._endPoint,a=this.selectedObject.segments.indexOf(this.selectedSegment),(n=this.selectedObject.segments[a-1])&&this.updatePreviousSegment(o,n,t,i)):"straight"==o.type?(o.points[o.points.length-1]=o._endPoint=s,o._point=o.point=s):(o.points[o.points.length-1]=o._endPoint=s,o._point=o.point=s,e.datavisualization.Diagram.Util._updateBezierPoints(o)),this.nextSegment&&this.updateNextSegment(o,this.nextSegment,t,i)},a.prototype._addTerminalSegment=function(t,i,a){var n,o,s,r,l,d,h=this.selectedSegment;for(this.selectedObject.segments.pop(),n=this.selectedObject.segments[this.selectedObject.segments.length-1]&&"orthogonal"==this.selectedObject.segments[this.selectedObject.segments.length-1].type?this.selectedObject.segments[this.selectedObject.segments.length-1]:null,o=0;o<h.points.length-2;o++)0==(s=e.datavisualization.Diagram.Segment({type:"orthogonal",length:e.datavisualization.Diagram.Geometry.distance(h.points[o],h.points[o+1]),direction:e.datavisualization.Diagram.Util._getBezierDirection(h.points[o],h.points[o+1])})).length&&(s._direction="top"==n.direction||"bottom"==n.direction?s.direction=t>0?"right":"left":s.direction=i>0?"bottom":"top"),n=s,this.selectedObject.segments.push(s);if(r=Number(a[1]),(2==h.points.length||r==h.points.length-2)&&(n&&(n.length+=5,n._length=n.length),0!=r)){var g=e.datavisualization.Diagram.Geometry.distance(h.points[h.points.length-2],h._endPoint),c=e.datavisualization.Diagram.Util._getBezierDirection(h.points[h.points.length-2],h._endPoint),u=e.datavisualization.Diagram.Segment({type:"orthogonal",length:2*g/3,direction:c});this.selectedObject.segments.push(u)}l=e.datavisualization.Diagram.Segment({type:"orthogonal"}),this.selectedObject.segments.push(l),d=Number(a[0])+(Number(a[1])||0),this.selectedSegment=this.selectedObject.segments[d],this.nextSegment=this.selectedObject.segments[d+1],d==this.selectedObject.segments.length-2?this.nextSegment._direction=0==Number(a[0])?e.datavisualization.Diagram.Util._getBezierDirection(h.points[h.points.length-2],h._endPoint):h._direction:l._direction=e.datavisualization.Diagram.Util._getBezierDirection(h.points[h.points.length-2],h._endPoint),0==d&&this.insertFirstSegment(t,i,a)},a.prototype.insertFirstSegment=function(t,i,a){var n,o,s,r,l,d,h,g=this.selectedSegment;if(this.selectedObject.sourcePort&&g.length&&this.selectedObject.segments[0].points.length>2){for(this.selectedObject.segments.splice(0,1),r=[],o=0;o<g.points.length-1;o++)0==(s=e.datavisualization.Diagram.Segment({type:"orthogonal",length:e.datavisualization.Diagram.Geometry.distance(g.points[o],g.points[o+1]),direction:e.datavisualization.Diagram.Util._getBezierDirection(g.points[o],g.points[o+1])})).length&&(s._direction=!n||"top"!=n.direction&&"bottom"!=n.direction?s.direction=i>0?"bottom":"top":s.direction=t>0?"right":"left"),n=s,r.push(s);this.selectedObject.segments=r.concat(this.selectedObject.segments),this.selectedSegment=this.selectedObject.segments[Number(a[1])],this.nextSegment=this.selectedObject.segments[Number(a[1])+1]}else g=this.selectedObject.segments[0],(r=[]).push(e.datavisualization.Diagram.Segment({type:"orthogonal",direction:g.direction,length:g.length/3})),"bottom"==g.direction||"top"==g.direction?(l=Math.max(5,Math.abs(t)),d=t>0?"right":"left"):(l=Math.max(5,Math.abs(i)),d=i>0?"bottom":"top"),r.push(e.datavisualization.Diagram.Segment({type:"orthogonal",direction:d,length:l})),(h=this.selectedObject.segments[1])&&h.length&&(d!=h.direction&&(l*=-1),h.length-=l,h._length=h.length),g.length=g._length=2*g._length/3,this.selectedObject.segments=r.concat(this.selectedObject.segments),Number(a[0])+Number(a[1]),this.selectedSegment=this.selectedObject.segments[2],this.nextSegment=this.selectedObject.segments[3]},a.prototype.updatePreviousSegment=function(t,i,a,n){i._endPoint=i.points[i.points.length-1]=t._startPoint,"orthogonal"==i.type?("bottom"==i.direction?(i.length+=n,i.length<0&&(i._direction=i.direction="top",i.length*=-1)):"top"==i.direction?(i.length-=n,i.length<0&&(i._direction=i.direction="bottom",i.length*=-1)):"right"==i.direction?(i.length+=a,i.length<0&&(i._direction=i.direction="left",i.length*=-1)):"left"==i.direction&&(i.length-=a,i.length<0&&(i._direction=i.direction="right",i.length*=-1)),i._length=i.length):"bezier"==i.type&&e.datavisualization.Diagram.Util._updateBezierPoints(i)},a.prototype.updateNextSegment=function(t,i,a,n){var o,s,r=t._endPoint;i._startPoint=i.points[0]=this.selectedSegment._endPoint,i&&("orthogonal"==i.type?(i.length||0===i.length)&&("left"==i._direction||"right"==i._direction?(0!=a&&("right"==i._direction?i._length-=a:i._length+=a,(i.length||0===i.length)&&(i.length=i._length,i.length<0&&("left"==i.direction?i.direction="right":"right"==i.direction&&(i.direction="left"),i.length*=-1,i._direction=i.direction,i._length=i.length))),0!=n&&"orthogonal"!=t.type&&(i._startPoint.y=i.points[0].y=i._endPoint.y=i.points[i.points.length-1].y=r.y,o=this.selectedObject.segments.indexOf(i),(s=this.selectedObject.segments[o+1])._startPoint.y=s.points[0].y=i._endPoint.y,s.length&&("bottom"==s.direction?(s.length-=n,s.length<0&&(s.direction="top",s.length*=-1)):(s.length+=n,s.length<0&&(s.direction="bottom",s.length*=-1))))):(0!=n&&("bottom"==i._direction?i._length-=n:i._length+=n,(i.length||0===i.length)&&(i.length=i._length,i.length<0&&("top"==i.direction?i.direction="bottom":"bottom"==i.direction&&(i.direction="top"),i.length*=-1,i._length=i.length,i._direction=i.direction))),0!=a&&"orthogonal"!=t.type&&(i._startPoint.x=i.points[0].x=i._endPoint.x=i.points[i.points.length-1].x=r.x,o=this.selectedObject.segments.indexOf(i),(s=this.selectedObject.segments[o+1]).length&&("right"==s.direction?(s.length+=a,s.length<0&&(s.direction="left",s.length*=-1)):(s.length-=a,s.length<0&&(s.direction="right",s.length*=-1)))))):"bezier"==i.type&&e.datavisualization.Diagram.Util._updateBezierPoints(i))},a.prototype.mouseup=function(t){var a,n,o,s,r,l,d;if(t.shiftKey&&t.ctrlKey)this._addOrRemoveStraightSegments(t);else if(this.inAction){if(this.inAction=!1,"segmentEnd"==this._endPoint&&"orthogonal"==this.selectedSegment.type){if(!this._raiseSegmentEditEvent(e.datavisualization.Diagram.DragState.Completed).cancel){var h=this.selectedObject.segments.indexOf(this.selectedSegment),g=this.selectedObject.segments[h-1],c=this.selectedObject.segments[h+1],u=!1;g&&"orthogonal"==g.type&&Math.abs(g.length)<5?1!=h&&(u=this._removePrevSegment(h)):c&&"orthogonal"==c.type&&(a=c.length||0===c.length?c.length:e.datavisualization.Diagram.Geometry.distance(c.points[0],c.points[1]),Math.abs(a<=5)&&(u=this._removeNextSegment(h))),u&&(e.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),e.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),e.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))}}else"segmentEnd"!=this._endPoint&&(n=this._updatePoints(this.selectedObject,e.datavisualization.Diagram.DragState.Completed),this.diagram.nameTable[this.selectedObject.name]||(this.selectedObject=null),this.selectedObject&&(n.cancel?n&&n.cancel&&n.eventType&&("connectorSourceChange"===n.eventType&&(this.undoObject.sourceNode?(this.selectedObject.sourceNode=this.undoObject.sourceNode,this.diagram.nameTable[this.undoObject.sourceNode].outEdges.push(this.selectedObject.name),this.selectedObject.sourcePort=this.undoObject.sourcePort):null==this.undoObject.sourceNode&&this.selectedObject.sourceNode?(this.selectedObject.sourceNode=this.undoObject.sourceNode,this.selectedObject.sourcePort=this.undoObject.sourcePort,this.selectedObject.sourcePoint=this.undoObject.sourcePoint,this.selectedObject.segments=this.undoObject.segments):(this.selectedObject.sourcePoint=this.undoObject.sourcePoint,this.selectedObject.segments=this.undoObject.segments)),"connectorTargetChange"===n.eventType&&(this.undoObject.targetNode?(this.selectedObject.targetNode=this.undoObject.targetNode,this.diagram.nameTable[this.undoObject.targetNode].inEdges.push(this.selectedObject.name),this.selectedObject.targetPort=this.undoObject.targetPort):null==this.undoObject.targetNode&&this.selectedObject.targetNode?(this.selectedObject.targetNode=this.undoObject.targetNode,this.selectedObject.targetPort=this.undoObject.targetPort,this.selectedObject.targetPoint=this.undoObject.targetPoint,this.selectedObject.segments=this.undoObject.segments):(this.selectedObject.segments=this.undoObject.segments,this.selectedObject.targetPoint=this.undoObject.targetPoint))):(this._disconnect(this.selectedObject),this._currentPossibleConnection&&!this.inAction?this._updateConnection(this.selectedObject):(this.selectedObject.sourceNode||this.selectedObject.targetNode)&&this._updateConnection(this.selectedObject),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.selectedObject.parent&&e.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this._removeHighLighter(),e.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer))));this.selectedObject&&(this.selectedObject.annotation&&(o=this.diagram.nameTable[this.selectedObject.targetNode],e.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(this.selectedObject,this.undoObject.targetNode,o,null,this.diagram)),this.diagram._dock(this.selectedObject,this.diagram.nameTable,!0),e.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),e.datavisualization.Diagram.SvgContext.update(this.selectedObject,this.diagram),this.diagram._updateConnectorBridging(this.selectedObject),this.diagram._updateQuad(this.selectedObject),this.diagram._updateSelectionHandle(),this.selectedObject.annotation&&e.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(this.selectedObject,this.diagram),this.selectedObject&&(this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").setAttribute("pointer-events","stroke"),this.diagram._svg.getElementById(this.selectedObject.name).setAttribute("pointer-events","auto")),this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g").setAttribute("pointer-events","visible"),this._initialValue=null)}if(this.selectedObject)for(r=null,s="",this.selectedObject._removeTargetPort&&this.selectedObject._removeTargetPort.type&&"internal"==this.selectedObject._removeTargetPort.type&&(r=this.selectedObject._removeTargetPort,s="targetpoint",delete this.selectedObject._removeTargetPort),this.selectedObject._removeSourcePort&&this.selectedObject._removeSourcePort.type&&"internal"==this.selectedObject._removeSourcePort.type&&(r=this.selectedObject._removeSourcePort,s="sourcepoint",delete this.selectedObject._removeSourcePort),l={type:"endpointchanged",undoObject:this.undoObject,redoObject:this._getClonedObject(this.selectedObject),removedPort:""==s?null:r,removePortType:s,isMultipleNode:"group"===this.selectedObject._type,category:"internal"},this.diagram.addHistoryEntry(l),d=0;d<this._nearestNodes.length;d++)this._showPort(this._nearestNodes[d],!0);delete this._nearestNodes,i.prototype.mouseup.call(this,t)},a.prototype._addOrRemoveStraightSegments=function(t){var i,a,n,o;if("segmentEnd"==this._endPoint)(i=t.target.id.split("_")).reverse(),r=Number(i[0]),(n=this.selectedObject.segments[r])&&"straight"==n.type&&((a=this.selectedObject.segments[r+1])&&(this.selectedObject.segments.splice(r,1),a._startPoint=a.points[0]=n._startPoint,s=!0));else{t.target.getAttribute("class"),t.target.id;var s=!1,r=this._findIndex();this.selectedObject.segments&&this.selectedObject.segments[r]&&"straight"==this.selectedObject.segments[r].type&&(n=this.selectedObject.segments[r],o=e.datavisualization.Diagram.Segment({type:"straight",_point:n._endPoint}),this.selectedObject.segments.splice(r+1,0,o),r+1!=this.selectedObject.segments.length-1&&(o.point=o._point),n._point=n.point=n.points[1]=n._endPoint=this.currentPoint,o.points[0]=o._startPoint=this.currentPoint,o.points[1]=o._endPoint=o._point,s=!0)}s&&(e.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),e.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),e.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),e.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))},a.prototype._findIndex=function(){for(var t,i,a,n,o,s,r,l,d,h=[],g=0;g<this.selectedObject.segments.length;g++)t=this.selectedObject.segments[g],i={x:Math.min(t._startPoint.x,t._endPoint.x),y:Math.min(t._startPoint.y,t._endPoint.y),width:Math.abs(t._startPoint.x-t._endPoint.x),height:Math.abs(t._startPoint.y-t._endPoint.y)},e.datavisualization.Diagram.Geometry.inflate(i,this.selectedObject.lineHitPadding/2,this.selectedObject.lineHitPadding/2),e.datavisualization.Diagram.Geometry.containsPoint(i,this.currentPoint)&&h.push(t);if(1==h.length)return this.selectedObject.segments.indexOf(h[0]);for(g=0;g<h.length;g++)s=h[g],r=((d=this.currentPoint).y-s._startPoint.y)/(s._endPoint.y-d.y),l=(d.x-s._startPoint.x)/(s._endPoint.x-d.x),a=Math.abs(r-l),0==g&&(n=a,o=0),a<n&&(n=a,o=g);return this.selectedObject.segments.indexOf(h[o])},a.prototype._removeNextSegment=function(t){var i=this.selectedObject.segments[t-1],a=this.selectedObject.segments[t+2],n=this.selectedObject.segments[t+1];return n.length||0===n.length?(this.selectedObject.segments.splice(t,2),"top"==this.selectedSegment.direction||"bottom"==this.selectedSegment.direction?(a._startPoint.y=this.selectedSegment._startPoint.y,i._endPoint.x=a._startPoint.x):(a._startPoint.x=this.selectedSegment._startPoint.x,i._endPoint.y=a._startPoint.y)):(this.selectedObject.segments.splice(t+1,1),"top"==this.selectedSegment.direction||"bottom"==this.selectedSegment.direction?i._endPoint.x=n._endPoint.x:i._endPoint.y=n._endPoint.y,i._length=i.length=e.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=e.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)),this.selectedSegment.length=this.selectedSegment._length=this.selectedSegment.direction=null),i&&a&&(i._length=i.length=e.datavisualization.Diagram.Geometry.distance(i._startPoint,a._startPoint),i.length&&(i._direction=i.direction=e.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,a._startPoint)),(a.length||0===a.length)&&(a._length=a.length=e.datavisualization.Diagram.Geometry.distance(i._endPoint,a._endPoint),a.length&&(a._direction=a.direction=e.datavisualization.Diagram.Util._getBezierDirection(i._endPoint,a._endPoint)))),!0},a.prototype._removePrevSegment=function(t){var i,a,n,o=this.selectedObject.segments[t-2],s=this.selectedObject.segments[t+1],r=s.length||0===s.length?s.length:e.datavisualization.Diagram.Geometry.distance(s.points[0],s.points[1]);return r<=5?(i=this.selectedObject.segments[t+2],s.length===r?this.selectedObject.segments.splice(t-1,4):this.selectedObject.segments.splice(t-1,3),i?("top"==o.direction||"bottom"==o.direction?(o._endPoint.y=i._endPoint.y,i._startPoint.x=o._endPoint.x):(o._endPoint.x=i._endPoint.x,i._startPoint.y=o._endPoint.y),(o.length||0===o.length)&&(o._length=o.length=e.datavisualization.Diagram.Geometry.distance(o._startPoint,o._endPoint),o.length&&(o._direction=o.direction=e.datavisualization.Diagram.Util._getBezierDirection(o._startPoint,o._endPoint))),(i.length||0===i.length)&&(i._length=i.length=e.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length&&(i._direction=i.direction=e.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)))):(o._endPoint=this.selectedObject.endPoint,o.direction=o.length=o._length=null,o._direction=s._direction)):(a=this.selectedObject.segments[t+1],this.selectedObject.segments.splice(t-1,2),"left"==(n=this.selectedSegment).direction||"right"==n.direction?(o._endPoint.x=a._startPoint.x,a._startPoint.y=o._endPoint.y):(o._endPoint.y=a._startPoint.y,a._startPoint.x=o._endPoint.x),(this.selectedSegment.length||0===this.selectedSegment.length)&&(o._length=o.length=e.datavisualization.Diagram.Geometry.distance(o._startPoint,o._endPoint),o._length&&(o._direction=o.direction=e.datavisualization.Diagram.Util._getBezierDirection(o._startPoint,o._endPoint))),(a.length||0===a.length)&&(a._length=a.length=e.datavisualization.Diagram.Geometry.distance(a._startPoint,a._endPoint),a.length&&(a._direction=a.direction=e.datavisualization.Diagram.Util._getBezierDirection(a._startPoint,a._endPoint)))),!0},a.prototype._getClonedObject=function(e){if(e){var i=t.extend(!0,{},e);return i.targetNode=e.targetNode,i.sourceNode=e.sourceNode,i.targetPort=e.targetPort,i.sourcePort=e.sourcePort,i}},a.prototype._updateConnection=function(t,i){var a,n;this._updateConnectionTarget(t),"targetEndPoint"==this._endPoint?(this._currentPossibleConnection?this._possibleConnectionPort&&e.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(t.targetNode!=this._currentPossibleConnection.name||t.targetPort!=this._possibleConnectionPort.name)&&(a=this._raiseConnectionChangeEvent(t,!0)):e.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(t.targetNode!=this._currentPossibleConnection.name||t.targetPort)&&(a=this._raiseConnectionChangeEvent(t,!0)):this.selectedObject.targetNode&&(a=this._raiseConnectionChangeEvent(t,!0)),a&&(e.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),e.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),(t.segments.length>2||2==t.segments[0].points.length)&&e.datavisualization.Diagram.Util._updatePreviousSegment(t),e.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))):"sourceEndPoint"==this._endPoint&&(this._currentPossibleConnection?this._possibleConnectionPort&&e.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(t.sourceNode!=this._currentPossibleConnection.name||t.sourcePort!=this._possibleConnectionPort.name)&&(a=this._raiseConnectionChangeEvent(t)):e.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(t.sourceNode!=this._currentPossibleConnection.name||t.sourcePort)&&(a=this._raiseConnectionChangeEvent(t)):(this.selectedObject.sourceNode&&(a=this._raiseConnectionChangeEvent(t),e.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),e.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram)),a&&e.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))),n=this.selectedSegment._endPoint,this.diagram._dock(t,this.diagram.nameTable,i),a&&"sourceEndPoint"==this._endPoint&&this.selectedObject.segments.length>1&&(2==this.selectedSegment.points.length&&!this.selectedObject.sourcePort&&this.selectedSegment.length?("right"==this.selectedSegment.direction||"left"==this.selectedSegment.direction?(this.selectedSegment.direction=this.selectedSegment._startPoint.x<n.x?this.selectedSegment._direction="right":this.selectedSegment._direction="left",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.x-n.x)):(this.selectedSegment.direction=this.selectedSegment._startPoint.y<n.y?this.selectedSegment._direction="bottom":this.selectedSegment._direction="top",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.y-n.y)),e.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),e.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),e.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)):a&&(e.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),e.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),e.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)))},a.prototype._disconnect=function(){},a.prototype._endAction=function(){var t;this._showPorts(),this._currentPossibleConnection&&!this._possibleConnectionPort&&(t=this._currentPossibleConnection),i.prototype._endAction.apply(this),this._endPoint&&(this._endPoint=null,t&&(this.diagram._checkToolToActivate(t,this.currentPoint),this.diagram._updateCursor()))},a.prototype._outOfBoundsDrag=function(t,i,a){if(i=i||0,a=a||0,t&&e.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var n=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=n.width||i<=n.x)||!this.diagram._selectedSymbol&&(a>=n.height||a<=n.y))return this.updateCursor("not-allowed"),!1}else if(!e.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,t,i,a))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},a.prototype._updatePoints=function(t,i){var a,n,o,s,r,l,d,h,g,c,u,m,p,f,_=!1,v="";if(this._endPoint&&"segmentEnd"!=this._endPoint&&this.selectedSegment&&(a="targetEndPoint"==this._endPoint,n="sourceEndPoint"==this._endPoint,this._endPoint)){switch(s=this._endPoint.match("bezierpoint1")?"bezierpoint1":this._endPoint.match("bezierpoint2")?"bezierpoint2":this._endPoint){case"targetEndPoint":o=this.selectedSegment._endPoint;break;case"sourceEndPoint":o=this.selectedSegment._startPoint;break;case"bezierpoint1":o=this.selectedSegment._point1;break;case"bezierpoint2":o=this.selectedSegment._point2}if(r=this.currentPoint,null==this._possibleConnectionPort&&(r=this.snap(r)),l=e.datavisualization.Diagram.Point(o.x-r.x,o.y-r.y),(d=this._raiseEndPointDrag(t,a,n,i))&&(_=d.cancel,v=d.type),!e.datavisualization.Diagram.Geometry.isEmptyPoint(l)&&!_)if(a||n){if(h=!!this._currentPossibleConnection&&e.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection,!1),this._outOfBoundsDrag(this.selectedObject,r.x,r.y,a)&&(this.selectedObject.segments.length>1&&(a||h||"orthogonal"!=this.selectedSegment.type||!this.selectedSegment.length&&0!==this.selectedSegment.length?a&&!h&&"orthogonal"==this.selectedSegment.type&&2==this.selectedSegment.points.length&&(u=r.x-this.selectedSegment._endPoint.x,m=r.y-this.selectedSegment._endPoint.y,"left"==this.selectedSegment._direction||"right"==this.selectedSegment._direction?(this.selectedSegment._startPoint.y=this.selectedSegment.points[0].y+=m,this.selectedSegment._endPoint.y=this.selectedSegment.points[1].y=this.selectedSegment._startPoint.y):(this.selectedSegment._startPoint.x=this.selectedSegment.points[0].x+=u,this.selectedSegment._endPoint.x=this.selectedSegment.points[1].x=this.selectedSegment._startPoint.x),p=this.selectedObject.segments.length-1,this.selectedObject.segments[p-1]&&this.updatePreviousSegment(this.selectedObject.segments[p],this.selectedObject.segments[p-1],u,m)):(this.selectedObject.sourcePoint=r,u=r.x-this.selectedSegment._startPoint.x,m=r.y-this.selectedSegment._startPoint.y,"left"==this.selectedSegment.direction||"right"==this.selectedSegment.direction?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._length=this.selectedSegment.length=e.datavisualization.Diagram.Geometry.distance(r,this.selectedSegment._endPoint),this.selectedSegment._length&&(this.selectedSegment._direction=this.selectedSegment.direction=e.datavisualization.Diagram.Util._getBezierDirection(r,this.selectedSegment._endPoint)),this.updateNextSegment(this.selectedObject.segments[0],this.selectedObject.segments[1],u,m),g=!1,(c=this.selectedObject.segments[1])&&c.length&&(c.length=c._length=e.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,c._endPoint),c.length&&(c.direction=c._direction=e.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,c._endPoint))),0==this.selectedSegment.length||0===c.length?(0==c.length&&this.selectedObject.segments.length>2?this.selectedObject.segments.splice(0,2):this.selectedObject.segments.length>1&&this.selectedObject.segments.splice(0,1),this.selectedSegment=this.selectedObject.segments[0],this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,"left"==this.selectedSegment._direction||"right"==this.selectedSegment._direction?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,c=this.selectedObject.segments[1],this.selectedObject.segments.length>1?(this.selectedSegment._length=this.selectedSegment.length=e.datavisualization.Diagram.Geometry.distance(r,c._startPoint),e.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,t.segments[1],t.sourcePoint,t.targetPoint),e.datavisualization.Diagram.Util._addOrthogonalPoints(t.segments[1],t.segments[0],t.segments[2],t.sourcePoint,t.targetPoint),c._startPoint=c.points[0]=t.segments[0]._endPoint):e.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,t.segments[1],t.sourcePoint,t.targetPoint),g=!0):e.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,t.segments[1],t.sourcePoint,t.targetPoint),c&&c.length&&(c.length=c._length=e.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,c._endPoint),c.length&&(c.direction=c._direction=e.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,c._endPoint))))),(n||a)&&!h&&(f=this.selectedSegment.points.length,this.diagram._setEndPoint(t,e.datavisualization.Diagram.Point(r.x,r.y),a),f!=this.selectedSegment.points.length||g)))return{updateSelection:!0,cancel:_}}else e.datavisualization.Diagram.Util._setBezierPoint(this.selectedSegment,e.datavisualization.Diagram.Point(r.x,r.y),s)}return{cancel:_,eventType:v}},a}(i),e.datavisualization.Diagram.ConnectionEditTool=r,l=function(i){function a(t){i.call(this,"shapeTool",t),this.cursor="crosshair",this._drawingPolygon=!1,this._points=[]}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){var e,a;i.prototype.mousedown.call(this,t),this._isPolyline()&&t&&!this._sourcePossibleConnection&&(this._currentPossibleConnection&&(e=this.mousePosition(t),this._possibleConnectionPort=this.diagram._findPortAtPoint(e,this._currentPossibleConnection)),this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort)),this._drawingPolygon?(a={x:(a=this.helper.points[this.helper.points.length-1]).x,y:a.y},this.helper.points.push(a),this._points.push(this.snap(this.currentPoint))):(this.selectedObject=this.createNode(),"bpmn"==this.selectedObject.type&&this.diagram._initGroupNode(this.selectedObject),this.selectedObject._type="node"),this._prevPoint=this.currentPoint},a.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?e.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,e.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},a.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?e.datavisualization.Diagram.Util._getPortPosition(this._targetPort,e.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},a.prototype.createNode=function(){var i,a,n,o;return this._isPolyline()?((i=t.extend(!0,{},this.diagram.model.drawType)).sourcePoint=this.currentPoint,i.targetPoint=this.currentPoint,i.segments=[{type:"straight"}],a=this.diagram._getNewConnector(i)):a=this.diagram._getNewNode(this.diagram.model.drawType),a.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+e.datavisualization.Diagram.Util.randomId():"node"+e.datavisualization.Diagram.Util.randomId(),n=this.snap(this.currentPoint),this._isPolyline()||(a.offsetX=n.x,a.offsetY=n.y,a.width=5,a.height=5),"text"==a.type||this._isPolyline()||(a.shape=this.diagram.model.drawType.shape?this.diagram.model.drawType.shape:a.shape),"polygon"!=this.diagram.model.drawType.shape&&!this._isPolyline()||this.diagram.model.drawType.points&&this.diagram.model.drawType.points.length||(this._drawingPolygon=!0,o=this.snap(this.startPoint),a.points=[{x:o.x,y:o.y},{x:n.x,y:n.y}],this._points=[{x:o.x,y:o.y},{x:n.x,y:n.y}]),e.datavisualization.Diagram.NodeType(a,this.diagram)},a.prototype.mousemove=function(t){if(i.prototype.mousemove.call(this,t),this.selectedObject)if(this.inAction)this._updateHelper();else{if(this.inAction=!0,!("polygon"!==this.selectedObject.shape||this.diagram.model.drawType.points&&this.diagram.model.drawType.points.length||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y)){var e=this.snap(this.startPoint),a=this.snap(this.currentPoint);this.selectedObject.points=[{x:e.x,y:e.y},{x:a.x,y:a.y}],this._points=[{x:e.x,y:e.y},{x:a.x,y:a.y}]}this._initHelper(),this._renderHelper()}this._isPolyline()&&t&&this._checkConnectionPossible(t),this.previousPoint=this.currentPoint},a.prototype._addPolyline=function(t){var e,i,a,n;for(this._currentPossibleConnection&&(e=this.mousePosition(t),this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this.diagram._findPortAtPoint(e,this._currentPossibleConnection)),i=[],this._currentPossibleConnection&&this._sourcePossibleConnection&&(this._sourcePossibleConnection=this._sourcePossibleConnection.name===this._currentPossibleConnection.name?null:this._sourcePossibleConnection),a=1;a<this.selectedObject.points.length-2;a++)i.push({type:"straight",point:this.selectedObject.points[a]});(n=this.diagram._getNewConnector(this.selectedObject)).name=this.selectedObject.name,n.sourcePoint=this.selectedObject.points[0],n.targetPoint=this.selectedObject.points[this.selectedObject.points.length-1],n.segments=i,n.sourceNode=this._sourcePossibleConnection?this._sourcePossibleConnection.name:null,n.targetNode=this._targetPossibleConnection?this._targetPossibleConnection.name:null,n.sourcePort=this._sourcePort?this._sourcePort.name:null,n.targetPort=this._targetPort?this._targetPort.name:null,this.diagram.add(n),this._sourcePossibleConnection=null,this._targetPossibleConnection=null,this._sourcePort=null,this._targetPort=null},a.prototype.mouseup=function(t){var e=!1;!this._drawingPolygon||2==t.button||2==this.diagram._getEventDetail(t)||this._sourcePossibleConnection&&this._currentPossibleConnection&&this._sourcePossibleConnection.name!=this._currentPossibleConnection.name||this._sourcePort&&this._targetPort&&this._sourcePort.name!==this._targetPort.name?(this.inAction&&(this.inAction=!1,this._drawingPolygon&&(this.selectedObject.points=this.helper.points),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this._isPolyline()?this._addPolyline(t):this.diagram.add(this.selectedObject)),e=!0):this._currentPossibleConnection&&this.helper&&(this.selectedObject.points.length>0&&(this._drawingPolygon&&(this.selectedObject.points=this.helper.points),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this._isPolyline()&&this._addPolyline(t)),e=!0),e&&(this.diagram._toolToActivate="selectTool",this.diagram._drawingTool=!1,i.prototype.mouseup.call(this,t),this._drawingPolygon&&(this.diagram._disableDefaultContextMenu=!0,delete this._drawingPolygon,delete this._points))},a.prototype._renderHelper=function(){this.svgHelper||(this._isPolyline()?this.svgHelper=e.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram):"bpmn"!=this.helper.type?this.svgHelper=e.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer,void 0,this.diagram):(this.helper._type="group",this.diagram._initGroupNode(this.helper),this.svgHelper=e.datavisualization.Diagram.SvgContext.renderGroup(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram.nameTable,this.diagram)),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},a.prototype._outOfBoundsDrag=function(t,i,a){if(i=i||0,a=a||0,t&&e.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var n=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=n.width||i<=n.x)||!this.diagram._selectedSymbol&&(a>=n.height||a<=n.y))return this.updateCursor("not-allowed"),!1}else if(null!=t.sourceNode&&!e.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,t,i,a))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},a.prototype._updateHelper=function(){var i,a,n,o=this._getStartPoint(),s=this._getCurrentPoint();if(this._drawingPolygon&&this._outOfBoundsDrag(this.helper,s.x,s.y)&&this._outOfBoundsDrag(this.helper,o.x,o.y)){var r=this.snap(this.currentPoint),l=this.snap(this.previousPoint),d={x:r.x-l.x,y:r.y-l.y};if(this.helper.points[this.helper.points.length-1].x+=d.x,this.helper.points[this.helper.points.length-1].y+=d.y,this._points[this._points.length-1].x+=d.x,this._points[this._points.length-1].y+=d.y,this._isPolyline()){for(i=[],a=0;a<this.helper.points.length-1;a++)i.push({type:"straight",point:this.helper.points[a]});this.helper.sourcePoint=this.helper.points[0],this.helper.targetPoint=this.helper.points[this.helper.points.length-1],this.helper.segments=i,this.helper=this.diagram._getNewConnector(this.helper),this.diagram._dock(this.helper,this.diagram.nameTable)}}n=t.extend(!0,{},this.helper),this._updateSize(this.helper,this.snap(this.startPoint),this.snap(this.currentPoint)),this.diagram._comparePropertyValues(this.helper,"height",{height:n.height},!0),this.diagram._comparePropertyValues(this.helper,"width",{width:n.width},!0),this.diagram._comparePropertyValues(this.helper,"offsetX",{offsetX:n.offsetX},!0),this.diagram._comparePropertyValues(this.helper,"offsetY",{offsetY:n.offsetY},!0),"polygon"!=this.helper.shape||this._drawingPolygon||(this.helper.width=0!=this.helper.width?this.helper.width:5,this.helper.height=0!=this.helper.height?this.helper.height:5),e.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},a.prototype._updateSize=function(t,i,a){if(this._outOfBoundsDrag(this.helper,a.x,a.y)&&this._outOfBoundsDrag(this.helper,i.x,i.y)){var n=this._drawingPolygon?this._points:[i,a],o=e.datavisualization.Diagram.Geometry.rect(n),s={width:o.width,height:o.height},r={x:o.x,y:o.y};e.datavisualization.Diagram.Geometry.isEmptySize(s)||("bpmn"!=this.helper.type?(t.offsetX=r.x+s.width/2,t.offsetY=r.y+s.height/2,t.width=s.width,t.height=s.height,"path"===t._shape&&(t._scaled=!0)):(t._type="group",this.diagram._translate(t,r.x+s.width/2-t.offsetX,r.y+s.height/2-t.offsetY,this.diagram.nameTable),this.diagram.scale(t,s.width/this.helper.width,s.height/this.helper.height,new e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),this.diagram.nameTable),e.datavisualization.Diagram.Util._updateGroupBounds(t,this.diagram)))}},a}(i),e.datavisualization.Diagram.ShapeTool=l,d=function(i){function a(t,e){i.call(this,t,e),this.cursor="crosshair",this._isMouseDown=!1,this._targetPossibleConnection=null,this._sourcePossibleConnection=null,this._targetPort=null,this._sourcePort=null}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){if(i.prototype.mousedown.call(this,t),e.datavisualization.Diagram.Util.isPageEditable(this.diagram)){if(this._isMouseDown=!0,this.diagram._hasSelection()&&this.diagram._clearSelection(),t&&"touchstart"===t.type&&(this._currentPossibleConnection=this.diagram._findConnectableNodeUnderMouse(t),this._currentPossibleConnection)){var a=this.mousePosition(t);this._possibleConnectionPort=this.diagram._findPortAtPoint(a,this._currentPossibleConnection)}this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort),this._raiseEndPointDrag(this.helper,!0,!1,e.datavisualization.Diagram.DragState.Starting)}},a.prototype._updateConnection=function(t){t&&(this._updateConnectionTarget(this.helper,!0),this._raiseConnectionChangeEvent(t,"sourceEndPoint"!=this._endPoint))},a.prototype.mousemove=function(a){if(i.prototype.mousemove.call(this,a),this._checkConnectionPossible(a),this._isMouseDown)if(this.inAction){if(this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this._possibleConnectionPort,this._updateConnection(this.helper),this.helper){var n=this._raiseEndPointDrag(this.helper,!0,!1,e.datavisualization.Diagram.DragState.Dragging),o=t.extend(!0,{},this.helper);n.cancel||this._updateHelper(),this.diagram._comparePropertyValues(this.helper,"sourcePoint",{sourcePoint:o.sourcePoint},!0),this.diagram._comparePropertyValues(this.helper,"targetPoint",{targetPoint:o.targetPoint},!0),this.diagram._comparePropertyValues(this.helper,"segments",{segments:o.segments},!0),this.diagram._comparePropertyValues(this.helper,"targetNode",{targetNode:this._targetPossibleConnection},!0),this.diagram._comparePropertyValues(this.helper,"targetPort",{targetPort:this._targetPort},!0)}}else this.inAction=!0,this._initHelper(),this._renderHelper();this.previousPoint=this.currentPoint},a.prototype.mouseup=function(t){var a,n,o;if(this._targetPort=this._possibleConnectionPort||this._targetPort,this._targetPossibleConnection=this._targetPossibleConnection?this._targetPossibleConnection:this._currentPossibleConnection,this._removeHighLighter(),e.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._isMouseDown=!1,this.inAction){this.inAction=!1;var s=this._getStartPoint(),r=this._getCurrentPoint(),l=e.datavisualization.Diagram.Geometry.distance(s,r);this._outOfBoundsDrag(this.helper,r.x,r.y)&&this._outOfBoundsDrag(this.helper,s.x,s.y)&&(l>0?((a=this.createConnector(s,r)).name="connector"+e.datavisualization.Diagram.Util.randomId(),this._sourcePossibleConnection&&(this._sourcePort&&e.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(n=this._raiseEvent("connectionChange",{element:a,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),e.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,e.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.sourceNode=this._sourcePossibleConnection.name,a.sourcePort=this._sourcePort.name)):e.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(n=this._raiseEvent("connectionChange",{element:a,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),e.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,e.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.sourceNode=this._sourcePossibleConnection.name))),this._targetPossibleConnection&&(this._targetPort&&e.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(n=this._raiseEvent("connectionChange",{element:a,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),e.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,e.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.targetNode=this._targetPossibleConnection.name,a.targetPort=this._targetPort.name)):e.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(n=this._raiseEvent("connectionChange",{element:a,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),e.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,e.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.targetNode=this._targetPossibleConnection.name))),this.diagram.add(a)&&(a=this.diagram.nameTable[a.name],e.datavisualization.Diagram.Util.updateBridging(a,this.diagram),e.datavisualization.Diagram.SvgContext.update(a,this.diagram),this.diagram._updateConnectorBridging(a))):(this._sourcePossibleConnection&&(this._sourcePort&&e.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)||e.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection))&&e.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),this._targetPossibleConnection&&(this._targetPort&&e.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)||e.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection))&&e.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name)))}this.singleAction&&this.diagram.deactivateTool(),this._prevTool&&(this._prevTool.inAction=!1),this._showPorts(),i.prototype.mouseup.call(this,t)},a.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?e.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,e.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},a.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?e.datavisualization.Diagram.Util._getPortPosition(this._targetPort,e.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},a.prototype._initHelper=function(){this.helper=this.createConnector(e.datavisualization.Diagram.Point(0,0),e.datavisualization.Diagram.Point(0,0)),this.diagram._setZorder(this.helper),this.helper.name="helper",this.helper._connectorType="helper"},a.prototype.createConnector=function(){return null},a.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=e.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram),this.svgHelper=this.diagram._svg.document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"),t(this.diagram._svg.getElementById(this.svgHelper.id)).attr("pointer-events","none"),t(this.diagram._svg.getElementById(this.svgHelper.id+"_hitTest")).attr("pointer-events","none"))},a.prototype._outOfBoundsDrag=function(t,i,a){if(i=i||0,a=a||0,t&&e.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var n=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=n.width||i<=n.x)||!this.diagram._selectedSymbol&&(a>=n.height||a<=n.y))return this.updateCursor("not-allowed"),!1}else if(null!=t.sourceNode&&!e.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,t,i,a))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},a.prototype._updateHelper=function(){var t=[],i=this._getStartPoint(),a=this._getCurrentPoint();t.push(i),t.push(a),this._outOfBoundsDrag(this.helper,a.x,a.y)&&this._outOfBoundsDrag(this.helper,i.x,i.y)&&(this.diagram._setEndPoint(this.helper,i,!1),this.diagram._setEndPoint(this.helper,a,!0),this._disconnect(this.helper),this._sourcePossibleConnection&&(this._sourcePort&&e.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(this.helper.sourceNode=this._sourcePossibleConnection.name,this.helper.sourcePort=this._sourcePort.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)):e.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(this.helper.sourceNode=this._sourcePossibleConnection.name,this._sourcePossibleConnection.outEdges.push(this.helper.name))),this._targetPossibleConnection&&(this._targetPort&&e.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(this.helper.targetNode=this._targetPossibleConnection.name,this.helper.targetPort=this._targetPort.name,this._targetPossibleConnection.inEdges.push(this.helper.name)):e.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(this.helper.targetNode=this._targetPossibleConnection.name,this._targetPossibleConnection.inEdges.push(this.helper.name))),this.diagram._dock(this.helper,this.diagram.nameTable)),e.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},a.prototype._endAction=function(){i.prototype._endAction.apply(this),this._targetPossibleConnection=null,this._sourcePossibleConnection=null,this._targetPort=null,this._sourcePort=null,this._isMouseDown=!1},a.prototype._showPorts=function(){},a.prototype._showAllPorts=function(t){i.prototype._showAllPorts.call(this,t)},a}(i),e.datavisualization.Diagram.LineTool=d,h=function(i){function a(t){i.call(this,"straightLine",t)}return e.datavisualization.Diagram.extend(a,i),a.prototype.createConnector=function(e,i){var a={segments:[{type:"straight"}],sourcePoint:e,targetPoint:i};return this.diagram._getNewConnector(t.extend(!0,{},a,this.diagram.model.drawType))},a}(d),e.datavisualization.Diagram.StraightLineTool=h,g=function(i){function a(t){i.call(this,"orthogonalLine",t)}return e.datavisualization.Diagram.extend(a,i),a.prototype.createConnector=function(e,i){var a={segments:[{type:"orthogonal"}],sourcePoint:e,targetPoint:i};return this.diagram._getNewConnector(t.extend(!0,{},a,this.diagram.model.drawType))},a}(d),e.datavisualization.Diagram.OrthogonalLineTool=g,c=function(i){function a(t){i.call(this,"bezierLine",t)}return e.datavisualization.Diagram.extend(a,i),a.prototype.createConnector=function(e,i){var a={segments:[{type:"bezier"}],sourcePoint:e,targetPoint:i};return this.diagram._getNewConnector(t.extend(!0,{},a,this.diagram.model.drawType))},a}(d),e.datavisualization.Diagram.BezierLineTool=c,u=function(i){function a(t){i.call(this,"rotatetool",t),this._mouseOffset=e.datavisualization.Diagram.Size(0,0),this.undoObject=null}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){var a,n,o;i.prototype.mousedown.call(this,e),this.selectedObject=this.diagram.selectionList[0],n={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(n=this.diagram._getChildTable(this.selectedObject,n)),o={childTable:n,node:this.selectedObject},a=t.extend(!0,{},o),this.undoObject=jQuery.extend(!0,{},a),this.diagram._currZoom},a.prototype.mousemove=function(t){var a,n,o,s,r;if(i.prototype.mousemove.call(this,t),a=!this.inAction,this.selectedObject){if(!this.inAction){if("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)for(n=this.diagram._getChildren(this.selectedObject.children),o=0;o<n.length;o++)if(!(s=this.diagram.nameTable[n[o]]).segments&&!e.datavisualization.Diagram.Util.canRotate(s))return;this._initialValue=this.selectedObject.rotateAngle,this.inAction=!0}r=!1,this.selectedObject.parent?this.diagram.nameTable[this.selectedObject.parent].container&&(r=!0):"pseudoGroup"==this.selectedObject.type&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(r=!0),r?"pseudoGroup"==this.selectedObject.type&&this._isParentAsLane(this.selectedObject)?(e.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&e.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram)):(this.helper||(this.helper=this._getCloneNode(this.selectedObject),this.helper.inEdges=this.helper.outEdges=[],this.helper.type=null,this.helper.name="helper"),this._rotate(this.helper),e.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this.diagram._renderTooltip(this.selectedObject,a)):"pseudoGroup"==this.selectedObject.type&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))?this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._rotate(this.selectedObject),this.selectedObject.parent&&e.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,a)):("pseudoGroup"===this.selectedObject.type&&this._updateMultipleUndoObject(this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&e.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,a))}this.previousPoint=this.currentPoint},a.prototype._rotate=function(t){var i,a,n,o=e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),s=this.currentPoint,r=e.datavisualization.Diagram.Geometry.findAngle(e.datavisualization.Diagram.Point(o.x,o.y),s)+90;r=e.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,r)-t.rotateAngle,i=e.datavisualization.Diagram.Util.bounds(t),a={bounds:e.datavisualization.Diagram.Rectangle(i.left,i.top,i.right-i.left,i.bottom-i.top),offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},this.diagram._comparePropertyValues(t,"rotateAngle",{rotateAngle:r},!0),this.diagram._rotate(t,r,this.diagram.nameTable),i=e.datavisualization.Diagram.Util.bounds(t),n={bounds:e.datavisualization.Diagram.Rectangle(i.left,i.top,i.right-i.left,i.bottom-i.top),offsetX:t.offsetX,offsetY:t.offsetY,width:t.width,height:t.height},this._raiseEvent("rotationChange",{element:this.diagram.getNode(t),angle:t.rotateAngle,oldValue:a,newValue:n,cancel:!1}).cancel&&this.diagram._rotate(t,-r,this.diagram.nameTable)},a.prototype.mouseup=function(a){var n,o,s,r,l,d;if(this.inAction){this.inAction=!1;var h=!1,g=!0,c=!1;this.selectedObject.parent?(n=this.diagram.nameTable[this.selectedObject.parent]).container&&(h=!0):"pseudoGroup"==this.selectedObject.type&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(o=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],(n=this.diagram.nameTable[o.parent]).container&&(h=!0)),"pseudoGroup"!=this.selectedObject.type&&"multipleSelection"!=this.selectedObject.name||!this.diagram._activeSwimLane?h&&(e.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),this._removeHighLighter(),"canvas"==n.container.type&&(c=!0),c&&(e.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,n)?e.datavisualization.Diagram.canvasHelper._singleNodeRotate(this.diagram,a,this.selectedObject):g=!1)):e.datavisualization.Diagram.canvasHelper._multiNodeRotate(this.diagram,a,this.selectedObject),"pseudoGroup"!=this.selectedObject.type?g&&this._rotate(this.selectedObject):this._fromContainer(this.diagram._getChildren(this.selectedObject.children))||this._rotate(this.selectedObject),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),e.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&(this.undoObject.connectors={},this._redoConnectors={},this.diagram._updateAllEdges(this.selectedObject)),r={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(r=this.diagram._getChildTable(this.selectedObject,r)),l={childTable:r,node:this.selectedObject},e.datavisualization.Diagram.Util.canRouteDiagram(this.diagram)&&this._redoConnectors&&(l.connectors=this._redoConnectors),s=t.extend(!0,{},l),d={type:"rotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},s),isMultipleNode:"group"===this.selectedObject._type,category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(d),this.selectedObject&&e.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom),this.diagram._updateSelectionHandle(),this.diagram._removeTooltip()}this._multipleUndo=!1,i.prototype.mouseup.call(this,a)},a}(i),e.datavisualization.Diagram.RotateTool=u,m=function(t){function i(i){t.call(this,"PivotTool",i),this._mouseOffset=e.datavisualization.Diagram.Size(0,0)}return e.datavisualization.Diagram.extend(i,t),i.prototype.mousedown=function(e){t.prototype.mousedown.call(this,e),this.selectedObject=this.diagram.selectionList[0]},i.prototype.mousemove=function(i){if(t.prototype.mousemove.call(this,i),this.selectedObject)if(this.inAction){var a=this.currentPoint.x-this.previousPoint.x,n=this.currentPoint.y-this.previousPoint.y,o=e.Matrix.identity();e.Matrix.rotate(o,-this.selectedObject.rotateAngle);var s=e.Matrix.transform(o,e.datavisualization.Diagram.Point(a,n)),r=(this.selectedObject.width*this.selectedObject.pivot.x+s.x)/this.selectedObject.width,l=(this.selectedObject.height*this.selectedObject.pivot.y+s.y)/this.selectedObject.height;this.selectedObject.pivot.x=r,this.selectedObject.pivot.y=l,this.selectedObject.offsetX+=a,this.selectedObject.offsetY+=n,this.diagram._updateSelectionHandle()}else this.inAction=!0;this.previousPoint=this.currentPoint},i.prototype._rotate=function(t){var i=e.datavisualization.Diagram.Point(t.offsetX,t.offsetY),a=this.currentPoint,n=this.FindAngle(i,a);this.diagram._rotate(t,n-t.rotateAngle,i,this.diagram.nameTable)},i.prototype.mouseup=function(e){this.inAction&&(this.inAction=!1,this.diagram._updateSelectionHandle()),t.prototype.mouseup.call(this,e)},i}(i),e.datavisualization.Diagram.PivotTool=m,p=function(t){function i(e){t.call(this,"panTool",e),this.diagram=e,this._isMouseDown=!1,this.cursor="pointer"}return e.datavisualization.Diagram.extend(i,t),i.prototype.mousedown=function(e){var i;t.prototype.mousedown.call(this,e);var a=this.diagram._svg.document,n=this.diagram._svg.document.createSVGPoint(),o=this.diagram._isTouchEvent(e);return n.x=o.clientX,n.y=o.clientY,i=n.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),a.lastMouseX=i.x,a.lastMouseY=i.y,this._isMouseDown=!0,!1},i.prototype.mousemove=function(i){if(t.prototype.mousemove.call(this,i),this._isMouseDown&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)){this.inAction=!0;var a=this.diagram._svg.document,n=this.diagram._svg.document.createSVGPoint(),o=this.diagram._isTouchEvent(i);n.x=o.clientX,n.y=o.clientY;var s,r,l=n.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),d=l.x,h=l.y;return s=d-a.lastMouseX,r=h-a.lastMouseY,this.diagram.model.constraints&e.datavisualization.Diagram.DiagramConstraints.PannableX||(s=0),this.diagram.model.constraints&e.datavisualization.Diagram.DiagramConstraints.PannableY||(r=0),e.datavisualization.Diagram.ZoomUtil.zoomPan(this.diagram,1,s,r,e.datavisualization.Diagram.Point(d,h)),a.lastMouseX=d,a.lastMouseY=h,!1}},i.prototype.mouseup=function(i){this.inAction=!1,document.onmousemove=null,document.onmouseup=null,this._isMouseDown=!1,this.diagram._removeTooltip(),this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit(),delete this.hoverNode,e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),t.prototype.mouseup.call(this,i)},i}(i),e.datavisualization.Diagram.PanTool=p,f=function(i){function a(t,a){i.call(this,t,a),this.boundingRect=e.datavisualization.Diagram.Rectangle(),this.activeLabel=null,this._overNode="",this.cursor="crosshair"}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){i.prototype.mousedown.call(this,t),this._findNodeUnderMouse(t);var e=this._getNodeUnderMouse();e&&(this._overNode=this.selectedObject&&!this.selectedObject.isLane||e.isLane?e.name:""),this.diagram._isEditing&&this.diagram._endEdit()},a.prototype.createNode=function(){},a.prototype.mousemove=function(t){i.prototype.mousemove.call(this,t),e.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(this.selectedObject||e.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this.diagram._isEditing||(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper())))},a.prototype.mouseup=function(t){var i,a;this.activeLabel=null,this.inAction?(a=this.getBoundingRect(this.startPoint,this.currentPoint),this._endAction(),(0===a.width||0===a.height)&&(a.width=90,a.height=12),this.selectedObject=this.createNode(a.x+a.width/2,a.y+a.height/2,a.width,a.height),this.diagram._startEdit(this.selectedObject)):(i=this._findNodeUnderMouse(t),e.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(null==i||i.isSwimlane||i.isLane?(a=e.datavisualization.Diagram.Rectangle(this.currentPoint.x-45,this.currentPoint.y-6,90,12),this._endAction(),this.selectedObject=this.createNode(a.x+a.width/2,a.y+a.height/2,a.width,12),this.diagram._startEdit(this.selectedObject)):(this.selectedObject=i,this.diagram._startEdit(this.selectedObject)))),this._overNode=""},a.prototype.getBoundingRect=function(t,e){t=this.snap(this.startPoint),e=this.snap(this.currentPoint);var i=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return{x:t.x>e.x?e.x:t.x,y:t.y>e.y?e.y:t.y,width:i,height:a}},a.prototype._initHelper=function(){var t,e,i;this._svgHelper||(t=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(t),e=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*e,y:this.startPoint.y*e,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),t.appendChild(i),t.setAttribute("pointer-events","none"),this._svgHelper=t)},a.prototype._updateHelper=function(){var t=this.snap(this.startPoint),e=this.snap(this.currentPoint),i=this.diagram._adornerSvg.getElementById("helper"),a=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),o=this.diagram._currZoom,s=(t.x>e.x?e.x:t.x)*o,r=(t.y>e.y?e.y:t.y)*o;i&&this.diagram._adornerSvg.rect({id:i.id,x:s,y:r,width:a*o,height:n*o})},a.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this._svgHelper=null),i.prototype._endAction.apply(this)},a.prototype._findNodeUnderMouse=function(e){var i,a,n,o,s,r=this.diagram._isForeignObject(e.target);if(r&&(e.target=r),"ej-d-label"==(a=e.target).getAttribute("class"))n=t(a).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],i=this._findObj(n),this.activeLabel=this.diagram._findLabelAtPoint(this.currentPoint,i);else if((o=t(e.target).parents("g")).length>3){var l=o[o.length-4],d=l.getAttribute("id"),h=l.getAttribute("class");h&&("ej-d-node"===h||"ej-d-group"===h?(i=this.diagram._findNode(d),s=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=s):"ej-d-connector"===h&&(i=this.diagram._findConnector(d),s=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=s))}return i},a}(e.datavisualization.Diagram.ToolBase),e.datavisualization.Diagram.TextToolBase=f,_=function(i){function a(t){i.call(this,"textTool",t)}return e.datavisualization.Diagram.extend(a,i),a.prototype.createNode=function(i,a,n,o){var s,r={offsetX:i,offsetY:a,width:n,height:o,parent:this._overNode,labels:[],ports:[],type:"text"},l=this.diagram._getNewNode(t.extend(!0,{},r,this.diagram.model.drawType));return l.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+e.datavisualization.Diagram.Util.randomId():"text"+e.datavisualization.Diagram.Util.randomId(),(l._type="text")&&(l._type="node"),(s=this.diagram.nameTable[l.parent])&&s.container&&this._updateMargin(l,s),l},a}(e.datavisualization.Diagram.TextToolBase),e.datavisualization.Diagram.TextTool=function(t){return new _(t)},v=function(i){function a(t){i.call(this,"phase",t),this.selectedSeperator=null,this._svgHelper=null}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){i.prototype.mousedown.call(this,t),this.inAction=!0,this.diagram._selectedGNode=null},a.prototype._getSeperator=function(e){if(t(e.target).parents("g").first()[0]){var i=t(e.target).parents("g").first()[0].id;if(i)return this._getphase(i.split("_phase_g")[0])}},a.prototype._removePhasehelper=function(){e.datavisualization.Diagram.SvgContext._removePhasehelper(this.diagram)},a.prototype._outOfBoundsDrag=function(t){var i,a,n,o=this.currentPoint.x-this.startPoint.x,s=this.currentPoint.y-this.startPoint.y;if(t&&e.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){if(i=this._getPageBounds(),(a=this.diagram.nameTable[t.parent])&&(n=e.datavisualization.Diagram.Util.bounds(a),!this.diagram._selectedSymbol&&(n.right+o>=i.width||t.offset+o<i.x)||!this.diagram._selectedSymbol&&(n.bottom+s>=i.height||t.offset+s<i.y)))return this.updateCursor("not-allowed"),!1;"horizontal"==t.orientation?this.updateCursor("e-resize"):this.updateCursor("n-resize")}return!0},a.prototype._updatePhasehelper=function(i){var a,n,o=this._bounds?jQuery.extend(!0,{},this._bounds):this.diagram._getPhaseBounds(i),s=this.startPoint,r=this.currentPoint,l={snapped:!1,offset:0,left:!1,right:!1},d={snapped:!1,offset:0,top:!1,bottom:!1};this.selectedObject=this.diagram.nameTable[this.selectedSeperator.parent],this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX},"horizontal"===i.orientation?(a=r.x-s.x,a=this._snapRight(l,d,a,0,this.selectedObject,!1),n=0,this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+a},!0)):(a=0,n=r.y-s.y,n=this._snapBottom(l,d,0,n,this.selectedObject,!1),this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+n},!0)),o&&(o.width+=a,o.height+=n,this._helperBounds=t.extend(!0,{},o),e.datavisualization.Diagram.SvgContext._updatePhaseHelper(this.diagram,i,o))},a.prototype._drawPhasehelper=function(t){var i=this.diagram._getPhaseBounds(t);t&&i&&e.datavisualization.Diagram.SvgContext._phasehelper(this.diagram,t,i)},a.prototype.mousemove=function(t){if(i.prototype.mousemove.call(this,t),e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this._outOfBoundsDrag(this.selectedSeperator)){if(this.selectedSeperator)this.selectedSeperator&&(this._bounds||(this._bounds=this.diagram._getPhaseBounds(this.selectedSeperator)),this._updatePhasehelper(this.selectedSeperator));else{if(this.inAction){var a=this._getSeperator(t);a&&!this.selectedSeperator&&(this.selectedSeperator=a)}this._drawPhasehelper(this.selectedSeperator),this.diagram.selectionList[0]&&"phase"!=this.diagram.selectionList[0].type?(this.diagram._clearSelection(!0),this.diagram.addSelection(this.selectedSeperator,!0)):this.diagram.addSelection(this.selectedSeperator,!0)}this.previousPoint=this.currentPoint}},a.prototype._getPadding=function(t){var e,i,a=20,n=20,o=this.diagram.nameTable[this.diagram._getChild(t.children[t.children.length-1])];return o&&((e=o.children).length>0&&((i=this.diagram.nameTable[this.diagram._getChild(e[0])])&&i.isLane&&(a=i.paddingRight,n=i.paddingBottom))),{x:a,y:n}},a.prototype.mouseup=function(t){var a,n,o,s,r=this._getSeperator(t);if(this.diagram.selectionList.length>0&&r&&this.diagram.selectionList[0].name!=r.name&&this.diagram._clearSelection(!0),r&&!this.selectedSeperator)this.selectedSeperator=r,this.diagram.addSelection(this.selectedSeperator,!0);else if(this.selectedSeperator&&((a=this.selectedSeperator.parent.split("phaseStack")[0])&&((n=this.diagram.nameTable[a])&&this._helperBounds&&n.isSwimlane))){var l=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this.diagram,n),d=0,h=l.indexOf(this.selectedSeperator.name);h>0?d=this.diagram.nameTable[this.diagram._getChild(l[h-1])].offset:"horizontal"===n.orientation&&(d=50),o=jQuery.extend(!0,{},this.selectedSeperator),"horizontal"===n.orientation?this.diagram._updatePhase({name:this.selectedSeperator.name,offset:d+this._helperBounds.width}):this.diagram._updatePhase({name:this.selectedSeperator.name,offset:d+this._helperBounds.height}),s={type:"phasepositionchanged",undoObject:jQuery.extend(!0,{},o),redoObject:jQuery.extend(!0,{},jQuery.extend(!0,{},this.selectedSeperator)),category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(s),this.diagram.addSelection(this.selectedSeperator,!0)}this._removePhasehelper(),this._bounds=null,this.inAction=!1,this.selectedSeperator=null,e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),i.prototype.mouseup.call(this,t)},a.prototype._getOuterPhaseNodes=function(t,i){var a,n,o;if(t){var s=this.diagram.nameTable[this.diagram._getChild(t.children[2])],r=[],l=null,d=null;for(a=0;s&&a<s.children.length;a++)if((n=this.diagram.nameTable[this.diagram._getChild(s.children[a])])&&n.children&&n.children.length>1)for(o=0;o<n.children.length;o++)(d=this.diagram.nameTable[this.diagram._getChild(n.children[o])])&&(l=e.datavisualization.Diagram.Util.bounds(d),i?l.y>t.offsetY-t.height/2+this.selectedSeperator.offset&&r.push(d):l.x>t.offsetX-t.width/2+this.selectedSeperator.offset&&r.push(d))}return r},a}(i),e.datavisualization.Diagram.PhaseTool=v,y=function(i){function a(t){i.call(this,"labelMove",t),this._isMouseDown=!1,this.undoObject=[],this.inAction=!1}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){var a,n,o,s,r,l,d;if(i.prototype.mousedown.call(this,t),this._isMouseDown=!0,t&&("ej-d-label"==t.target.className||"ej-d-label"===t.target.parentNode.getAttribute("class"))){for(a=this.diagram._nodeUnderMouse,(n=t.target.id)||(n=t.target.parentNode.id),o=n.split("_"),s="",r=1;r<o.length;r++)s+=o[r],r!=o.length-1&&(s+="_");(l=this.diagram._findLabel(a,s))||(l=a.labels[0]),this.selectedObject=l,a.segments||(this.selectedObject.width=this.selectedObject.width>a.width?this.selectedObject.width:a.width,this.selectedObject.height=this.selectedObject.height>a.height?this.selectedObject.height:a.height),a.segments&&(d=e.datavisualization.Diagram.Util.getLabelbounds(this.diagram,a,this.selectedObject),this.selectedObject.width=this.selectedObject.width?this.selectedObject.width:d.width,this.selectedObject.height=this.selectedObject.height?this.selectedObject.height:d.height)}},a.prototype.mousemove=function(a){var n,o,s;i.prototype.mousemove.call(this,a),this.selectedObject&&this.selectedObject._parent&&(n=this.diagram.findNode(this.selectedObject._parent),this._isMouseDown&&!this.inAction&&!this.inAction&&this.selectedObject&&(this.inAction=!0,o={},s=t.extend(!0,{},{childTable:o,node:n,activeLabel:this.selectedObject}),this.undoObject=jQuery.extend(!0,{},s)),this._isMouseDown&&this.selectedObject&&e.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&(e.datavisualization.Diagram.Util.canMove(this.selectedObject)||e.datavisualization.Diagram.Util.canMoveLabel(n))&&!this.diagram._isEditing&&(this.inAction||(this.inAction=!0),this.updateCursor("move"),"label"===this.selectedObject._type&&this._updateSelection(),this._updateLabelXY(this.selectedObject,this.previousPoint,this.currentPoint),"label"===this.selectedObject._type&&this.diagram._updateSelectionHandle(!0))),this.previousPoint=this.currentPoint},a.prototype.mouseup=function(a){var n,o,s;if(this.selectedObject&&this.selectedObject._parent&&(o=this.diagram.findNode(this.selectedObject._parent),(e.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&e.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&e.datavisualization.Diagram.Util.canMove(this.selectedObject)||e.datavisualization.Diagram.Util.canMoveLabel(o))&&(e.datavisualization.Diagram.Util.canMoveLabel(o)&&!e.datavisualization.Diagram.Util.canSelect(this.selectedObject)?this.diagram._selectionContains(this.node)||(this.diagram._clearSelection(!0),this.diagram._addSelection(o,!1)):this.diagram._selectionContains(this.selectedObject)||(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject,!1)),"label"===this.selectedObject._type&&this.diagram._updateSelectionHandle(!1),n=o,this.inAction))){this.inAction=!1;var r=t.extend(!0,{},{childTable:{},node:o,label:this.selectedObject}),l={type:"labelpositionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},r),category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(l)}n&&(s=this.diagram._mousePosition(a.originalEvent),this._raiseEvent("click",{element:n,actualObject:null,count:this.diagram._getEventDetail(a),offsetX:s.x,offsetY:s.y,event:a})),delete this._isMouseDown,i.prototype.mouseup.call(this,a)},a.prototype._updateLabelXY=function(t,i,a){var n,o,s=a.x-i.x,r=a.y-i.y,l=this.diagram.findNode(t._parent);l.segments||(n=e.Matrix.identity(),e.Matrix.rotate(n,-l.rotateAngle),s=(o=e.Matrix.transform(n,e.datavisualization.Diagram.Point(s,r))).x,r=o.y),l.segments&&"segmentpath"==t.relativeMode&&e.datavisualization.Diagram.Util.isAllowDragLimit(l)?this._updateLabelOffset(l,t,s,r):this.diagram.translateLabel(l,t,s,r)},a.prototype._updateSelection=function(){"label"===this.selectedObject._type&&(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject,!0))},a.prototype._updateLabelOffset=function(i,a,n,o,s,r,l){var d,h,g,c,u,m,p,f,_,v,y,b,x,D={minDistance:null},C=null,z=0;if(i.segments&&"segmentpath"===a.relativeMode){if(d=t.extend(!0,{},a),h={x:0,y:0,width:0,height:0,centerX:0,centerY:0},s?u=s:(h=e.datavisualization.Diagram.Util.getLabelbounds(this.diagram,i,a),this.diagram._currZoom,h.x=h.x+n,h.y=h.y+o,g="svg"===this.diagram.model.labelRenderingMode?{x:h.centerX+n,y:h.centerY+o}:{x:h.x+h.width/2,y:h.y+h.height/2},c={x:this.currentPoint.x-g.x,y:this.currentPoint.y-g.y},u={x:this.currentPoint.x-c.x,y:this.currentPoint.y-c.y}),m=e.datavisualization.Diagram.Util.getPoints(i),p=this._getInterceptWithSegment(u,m),s=this._getRelativeOffset(u,m,D),f=this._getLengthFromListOfPoints(m),e.datavisualization.Diagram.Util.bounds(i),p.length>0){if(v={minDistance:null},_=this._getRelativeOffset(u,p,v),null!=D.minDistance&&v.minDistance<D.minDistance&&(s=_),s){for(y=0;y<m.length;y++){if(null!=C){if(b=e.datavisualization.Diagram.Geometry.rect([C,m[y]]),e.datavisualization.Diagram.Geometry.containsPoint(b,s)){z+=e.datavisualization.Diagram.Util.findLength(C,s);break}z+=e.datavisualization.Diagram.Util.findLength(C,m[y])}C=m[y]}x=e.datavisualization.Diagram.Point(z/f,0)}this._updateLabelMargin(i,a,x,u,n,o,r,l)}else this._updateLabelMargin(i,a,null,u,n,o);this.diagram._comparePropertyValues(i,"labels",d,!0)}},a.prototype._updateLabelMargin=function(t,i,a,n,o,s,r,l){var d,h,g,c,u,m,p,f,_,v;if(a=a||{x:i.segmentOffset,y:0},i&&a&&(m=i.dragLimit,u=e.datavisualization.Diagram.Util.getPoints(t),c=this._getLengthFromListOfPoints(u),a.x>0&&a.x<1)){h={angle:null},g=this._getPointAtLength(c*a.x,u,h);var y=this.diagram._currZoom,b=(e.datavisualization.Diagram.Util.getLabelbounds(this.diagram,t,i),{x:0,y:0,width:0,height:0});if((b=e.datavisualization.Diagram.Util.getLabelbounds(this.diagram,t,i,!0)).x=b.x/y+o,b.y=b.y/y+s,b.width=b.width/y,b.height=b.height/y,d={x:g.x-m.left-b.width/2,y:g.y-m.top-b.height/2,width:m.left+m.right+b.width,height:m.top+m.bottom+b.height},e.datavisualization.Diagram.Geometry.containsPoint(d,n))n=n;else for(p=[g,n],f=this._boundsInterSects(p,d,!1),_=0;_<f.length;_++)n=f[_];v=this._checkCursorLimit(i,g,n,b),i.margin={left:v.x?n.x-g.x:i.margin.left,top:v.y?n.y-g.y:i.margin.top,right:0,bottom:0},i.segmentOffset=a.x,r&&l&&(i.width=r,i.height=l),e.datavisualization.Diagram.DiagramContext.updateLabel(t,i,this.diagram)}},a.prototype._getInterceptWithSegment=function(t,i){for(var a,n,o,s,r,l,d,h=[],g=e.datavisualization.Diagram.Util.findLength(e.datavisualization.Diagram.Point(0,0),e.datavisualization.Diagram.Point(this.diagram._viewPort.width,this.diagram._viewPort.height)),c=1;c<i.length;c++)for(s=[i[c-1],i[c]],o=[],n=Math.round(e.datavisualization.Diagram.Util.findAngle(s[0],s[1])%360,2),a=Math.round(e.datavisualization.Diagram.Util.findAngle(s[1],s[0])%360,2),r=n>0&&n<=90||n>180&&n<=270?90:-90,o.push(e.datavisualization.Diagram.Geometry.transform(t,n+r,g)),o.push(e.datavisualization.Diagram.Geometry.transform(t,a+r,g)),l=this._intersect(s,o,!1),d=0;d<l.length;d++)h.push(l[d]);return h},a.prototype._getRelativeOffset=function(t,e,i){for(var a,n,o,s=0;s<e.length;s++)o=e[s],n=Math.round(Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2))),(null==i.minDistance||Math.min(Math.abs(i.minDistance),Math.abs(n))==Math.abs(n))&&(a=o,i.minDistance=n);return a},a.prototype._getLengthFromListOfPoints=function(t){for(var i=0,a=t[0],n=0;n<t.length;n++)i+=e.datavisualization.Diagram.Util.findLength(a,t[n]),a=t[n];return i},a.prototype._getPointAtLength=function(t,i,a){var n,o,s,r,l;a.angle=0;for(var d,h=0,g=null,c=e.datavisualization.Diagram.Point(0,0),u=0;u<i.length;u++)if(d=i[u],g){if(h+(n=e.datavisualization.Diagram.Util.findLength(g,d))>=t){o=t-h,s=e.datavisualization.Diagram.Util.findAngle(g,d),r=o*Math.cos(s*Math.PI/180),l=o*Math.sin(s*Math.PI/180),c=e.datavisualization.Diagram.Point(g.x+r,g.y+l),a.angle=s;break}h+=n,g=d}else g=d;return c},a.prototype._checkCursorLimit=function(t,e,i,a){var n=!1,o=!1;return i.x>=e.x-t.dragLimit.left-a.width/2&&i.x<=e.x+t.dragLimit.right+a.width/2&&(n=!0),i.y>=e.y-t.dragLimit.top-a.height/2&&i.y<=e.y+t.dragLimit.bottom+a.height/2&&(o=!0),{x:n,y:o}},a.prototype._boundsInterSects=function(t,e){var i,a=[];return e&&(i=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height},{x:e.x,y:e.y}],a=this._intersect(t,i,a)),a},a.prototype._intersect=function(t,i,a){for(var n,o,s=[],r=0;r<t.length-1;r++){for(n=0;n<i.length-1;n++)o=e.datavisualization.Diagram.Util.interSect2(t[r],t[r+1],i[n],i[n+1]),e.datavisualization.Diagram.Geometry.isEqualPoint(e.datavisualization.Diagram.Point(0,0),o)||s.push(o);a&&i.length}return s},a.prototype.getCenterOfLabel=function(t,i){var a=e.datavisualization.Diagram.Point(0,0);if(this.selectedObject&&this.selectedObject._parent){var n=e.datavisualization.Diagram.Util.getPoints(this.diagram.findNode(this.selectedObject._parent)),o=this._getLengthFromListOfPoints(n);(a=this._getPointAtLength(o*i,n,{})).x+=t.margin.left-t.margin.right,a.y+=t.margin.top-t.margin.bottom}return a},a}(i),e.datavisualization.Diagram.LabelMoveTool=y,b=function(i){function a(t){i.call(this,"labelResize",t),this._resizeDirection=null,this.undoObject=null,this._mouseDown=!1}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){e.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),i.prototype.mousedown.call(this,t),this._mouseDown=!0,this.selectedObject=this.diagram.selectionList[0]},a.prototype.mousemove=function(a){var n;if(i.prototype.mousemove.call(this,a),!this.inAction&&this.diagram.selectionList[0]&&this._mouseDown){this.selectedObject=this.diagram.selectionList[0];var o=this.diagram.findNode(this.selectedObject._parent),s=t.extend(!0,{},{childTable:{},node:o,activeLabel:this.selectedObject});this.undoObject=jQuery.extend(!0,{},s),this._resizeDirection=a.target.getAttribute("class"),n=this._getLabelCenter(this.selectedObject),this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:n.y,x:n.x},this.inAction=!0}this.selectedObject&&this.inAction&&e.datavisualization.Diagram.Util.canResize(this.selectedObject)&&(this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0)),this.previousPoint=this.currentPoint},a.prototype.mouseup=function(a){if(this._mouseDown=!1,this.inAction&&this.selectedObject){this.inAction=!1;var n=t.extend(!0,{},{childTable:{},node:this.diagram.findNode(this.selectedObject._parent),label:this.selectedObject}),o={type:"labelsizechanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},n),isMultipleNode:"group"===this.selectedObject._type,category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(o),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!1)}i.prototype.mouseup.call(this,a)},a.prototype._updateSize=function(t){var i,a,n,o,s,r,l,d=this.diagram.findNode(t._parent),h=e.Matrix.identity(),g=this.currentPoint.x-this.startPoint.x,c=this.currentPoint.y-this.startPoint.y,u=this.diagram._findLabelRotateAngle(t),m=this._getLabelCenter(t),p=this._resizeObject(t,g,c);if(i=p.width,a=p.height,i<0&&(i=1),a<0&&(a=1),i&&1!=i||a&&1!=a){n=e.Matrix.identity(),e.Matrix.rotate(n,-d.rotateAngle,d.offsetX,d.offsetY),o=e.datavisualization.Diagram.Util.bounds(d,!0),e.Matrix.rotate(h,-u,p.x,p.y),e.Matrix.scale(h,i,a,p.x,p.y),e.Matrix.rotate(h,u,p.x,p.y);var f=e.Matrix.transform(h,e.datavisualization.Diagram.Point(m.x,m.y)),_=t.height*a,v=t.width*i;d.segments&&"segmentpath"==t.relativeMode?this.diagram.tools.labelMove._updateLabelOffset(d,t,0,0,f,v,_):(d.segments||(f=e.Matrix.transform(n,f)),f.x=f.x-t.margin.left+t.margin.right,f.y=f.y-t.margin.top+t.margin.bottom,s=this._findLabelAtNode(d,t),t.verticalAlignment==e.datavisualization.Diagram.VerticalAlignment.Top?f.y-=s.height/2:t.verticalAlignment==e.datavisualization.Diagram.VerticalAlignment.Bottom&&(f.y+=s.height/2),t.horizontalAlignment==e.datavisualization.Diagram.HorizontalAlignment.Left?f.x-=s.width/2:t.horizontalAlignment==e.datavisualization.Diagram.HorizontalAlignment.Right&&(f.x+=s.width/2),r=o.width/(f.x-o.x),l=o.height/(f.y-o.y),v>1&&(t.width=v,t.offset.x=1/r),_>1&&(t.height=_,t.offset.y=1/l))}},a}(i),e.datavisualization.Diagram.LabelResizeTool=b,x=function(i){function a(t){i.call(this,"labelRotate",t),this.inAction=!1,this.undoObject=null}return e.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){i.prototype.mousedown.call(this,e),this.selectedObject=this.diagram.selectionList[0];var a=this.diagram.findNode(this.selectedObject._parent),n=t.extend(!0,{},{childTable:{},node:a,activeLabel:this.selectedObject});this.undoObject=jQuery.extend(!0,{},n)},a.prototype.mousemove=function(t){i.prototype.mousemove.call(this,t),this.selectedObject&&e.datavisualization.Diagram.Util.canRotate(this.selectedObject)&&(this.inAction||(this.inAction=!0),this._rotate(this.selectedObject),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0)),this.previousPoint=this.currentPoint},a.prototype._rotate=function(t){var i,a,n;e.Matrix.identity();i=this.diagram._findLabelRotateAngle(t),a=this._getLabelCenter(t),n=e.datavisualization.Diagram.Geometry.findAngle(e.datavisualization.Diagram.Point(a.x,a.y),this.currentPoint)+90,n=e.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,n)-i,t.rotateAngle+=n,t.rotateAngle%=360,t.rotateAngle<0&&(t.rotateAngle+=360)},a.prototype.mouseup=function(a){if(this.inAction){this.inAction=!1,this._rotate(this.selectedObject),e.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);var n=t.extend(!0,{},{childTable:{},node:this.diagram.findNode(this.selectedObject._parent),activeLabel:this.selectedObject}),o={type:"labelrotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},n),category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(o),this.selectedObject&&e.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom),this.diagram._updateSelectionHandle()}i.prototype.mouseup.call(this,a)},a}(i),e.datavisualization.Diagram.LabelRotateTool=x}(jQuery,Syncfusion),function(t,e){"use strict";var i,a,n;e.datavisualization.Diagram.LayoutTypes={None:"none",HierarchicalTree:"hierarchicaltree",OrganizationalChart:"organizationalchart",RadialTree:"radialtree",SymmetricLayout:"symmetriclayout"},e.datavisualization.Diagram.ChartOrientations={Horizontal:"horizontal",Vertical:"vertical"},e.datavisualization.Diagram.ChartTypes={Left:"left",Right:"right",Alternate:"alternate",Center:"center"},e.datavisualization.Diagram.Layout={doLayout:function(i,a){var n,o,s=i.model,r={diagram:i,_anchorX:0,_anchorY:0,_graphNodes:{},_firstLevelNodes:[],_centerNode:null,levels:[],maxLevel:0,layoutNodes:[]};for(n in s.layout)"type"==n?r.type=i._layoutType():"orientation"==n?r.orientation=i._layoutOrientation():"fixedNode"==n?r.fixedNode=i._fixedNode():"horizontalSpacing"==n?r.horizontalSpacing=Number(i._horizontalSpacing()):"verticalSpacing"==n?r.verticalSpacing=Number(i._verticalSpacing()):"marginX"==n?r.marginX=Number(i._layoutMarginX()):"marginY"==n?r.marginY=Number(i._layoutMarginY()):"getLayoutInfo"==n?"string"==typeof s.layout.getLayoutInfo?r.getLayoutInfo=e.util.getObject(s.layout.getLayoutInfo,window):t.isFunction(s.layout.getLayoutInfo)&&(r.getLayoutInfo=s.layout.getLayoutInfo):"getConnectorSegments"==n?"string"==typeof s.layout.getConnectorSegments?r.getConnectorSegments=e.util.getObject(s.layout.getConnectorSegments,window):t.isFunction(s.layout.getConnectorSegments)&&(r.getConnectorSegments=s.layout.getConnectorSegments):r[n]=s.layout[n];return r.updateView=void 0===a||r.updateView,r.objects=[],"symmetriclayout"===r.type?((o=new SymmetricLayoutManager(r.diagram,50)).MaxIteration=r.maxIteration,o.SpringLength=r.springLength,o.SpringFactor=r.springFactor,(new GraphLayoutManager).updateLayout(r.diagram,o)):"radialtree"!=r.type?e.datavisualization.Diagram.HierarchicalLayout.doLayout(r):e.datavisualization.Diagram.RadialTreeLayout.doLayout(r),r.updateView?void 0:r.objects}},e.datavisualization.Diagram.HierarchicalLayout={doLayout:function(t){var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v;if((i=t.diagram).model,a=i.nodes(),this._checkMultiparent(a,t))o=new e.datavisualization.Diagram.LineDistribution(this),t.avoidSegmentOverlapping&&o._initLineDistribution(t),e.datavisualization.Diagram.MultipleParentHierarchicalLayout.doLayout(t);else if(a.length>0){for(d=0;d<a.length;d++)(n=a[d]).excludeFromLayout||((t._graphNodes[n.name]=this._setUpLayoutInfo(t,n)).tree.hasSubTree=!1,n.inEdges&&n.inEdges.length&&!this._isAnnotationShape(n,!1)||t._firstLevelNodes.push(n));if(t.root||i.model.dataSourceSettings.root){if(t.root)t.rootNode=s=i.nameTable[i._getChild(t.root)];else for(r=i.model.dataSourceSettings.root,l=i.model.dataSourceSettings.id,d=0;d<a.length;d++)a[d][l]===r&&(t.rootNode=s=i.nameTable[i._getChild(a[d].name)]);if(s&&0===t._firstLevelNodes.length)return void e.datavisualization.Diagram.MultipleParentHierarchicalLayout.doLayout(t)}for(d=0;d<t._firstLevelNodes.length;d++)n=t._firstLevelNodes[d],this._updateEdges(t,n,1);if(t._firstLevelNodes.length>0){for(t._rootNode=t._firstLevelNodes[0],g=0,c=0,d=0;d<t._firstLevelNodes.length;d++)h=this._updateTree(t,g,c,t._firstLevelNodes[d],0,t._firstLevelNodes[d-1]),(_=t._graphNodes[t._firstLevelNodes[d].name]).y<h.y&&(h.y=_.y),_.x<h.x&&(h.x=_.x),"lefttoright"==t.orientation||"righttoleft"==t.orientation?c=h.right+t.horizontalSpacing:g=h.right+t.horizontalSpacing,0==d?(u=h.x,p=h.y,m=h.right,f=h.bottom):(u=Math.min(u,h.x),p=Math.min(p,h.y),m=Math.max(m,h.right),f=Math.max(f,h.bottom));for(this._updateAnchor(t,{x:u,y:p,right:m,bottom:f}),i._layoutInAction=!0,d=0;d<t._firstLevelNodes.length;d++)this._updateNodes(t,t._firstLevelNodes[d],0);if(i._layoutInAction=!1,t.updateView||(i._internalLayout=t),t.updateView)for(d=0;d<t._firstLevelNodes.length;d++)this._updateConnectors(t,t._firstLevelNodes[d],1);for(v=0;v<t.diagram.model.connectors.length;v++)delete t.diagram.model.connectors[v]._visited;for(v=0;v<t.diagram.model.nodes.length;v++)delete t.diagram.model.nodes[v]._visited1,delete t.diagram.model.nodes[v]._isRightAdded}}t.avoidSegmentOverlapping&&o._distributeLines(t),delete t.diagram.minSpaceBetweenNode},_checkMultiparent:function(t,e){var i,a;if(t&&t.length>0)for(i=0;i<t.length;i++)if(a=t[i],e._processedNodes=[],a&&(a.inEdges&&a.inEdges.length>1&&!this._isAnnotationShape(a,!0)||this._checkCyclicNodes(a,e,a.name)))return delete e._processedNodes,!0;return delete e._processedNodes,!1},_checkCyclicNodes:function(t,e,i){var a,n,o;if(t.outEdges&&t.outEdges.length>0&&!this._isLoopProcessed(e,t.name))for(e._processedNodes.push(t.name),a=0;a<t.outEdges.length;a++)if((n=e.diagram.nameTable[t.outEdges[a]])&&(n.targetNode===i||(o=e.diagram.nameTable[n.targetNode])&&o.outEdges&&o.outEdges.length>0&&this._checkCyclicNodes(o,e,i)))return!0;return!1},_isLoopProcessed:function(t,e){for(var i=t._processedNodes,a=0;a<i.length;a++)if(i[a]===e)return!0;return!1},_isAnnotationShape:function(t,e){if(t&&"bpmn"===t.type&&"group"===t._type&&t.annotation&&t.annotation.text)if(e){if(t.inEdges.length<=2)return!0}else if(t.inEdges.length<=1)return!0;return!1},_updateTree:function(t,e,i,a,n,o,s){var r,l,d,h,g,c,u,m,p,f,_,v;return a._visited1?a._treeBounds:(a._visited1=!0,r=this._getDimensions(t,a,e,i,n),l=t._graphNodes[a.name],t.maxLevel=Math.max(t.maxLevel,n),d=n,(g=this._hasChild(t,a))||l.tree.assistants.length?(v=r.y+r.height+t.verticalSpacing,l.tree.assistants.length&&(d=(h=this._setDepthSpaceForAssistants(t,a,v,r.height,n,t.verticalSpacing)).level,v=h.bottom),l.tree.assistants.length||"horizontal"==l.tree.orientation||(v=r.y+r.height+t.verticalSpacing/2),l.tree.children.length&&(c="horizontal"!=l.tree.orientation||"balanced"==l.tree.type&&1!=l.tree.children.length?"balanced"==l.tree.type?this._updateHorizontalTreeWithMultipleRows(t,a,o,r.x,v,d):this._updateVerticalTree(t,a,r.x,v,d,s):this._updateHorizontalTree(t,a,o,r.x,v,d)),l.y&&l.y>r.y||(l.y=r.y),l.mid&&(e=l.mid),l.tree.assistants.length&&(_=void 0!==e?e:r.x,f=this._setBreadthSpaceForAssistants(t,a,r,_,v,n),g||(e=((m=c=f).x+m.right)/2-r.width/2,c=m),p=f?f.canMoveBy:void 0),l.x=e,l.translate||(l._treeWidth=c.right-c.x),u={x:e,y:r.y,right:e+r.width,bottom:r.y+r.height},this._translateSubTree(t,a,u,c,r,n,p,void 0!=o,s),"string"!=typeof l.firstChild&&(l.firstChild.x+=l.subTreeTranslation),a._treeBounds=c,c):(a._treeBounds=this._updateLeafNode(t,a,o,r,n,s),a._treeBounds))},_updateLeafNode:function(t,e,i,a,n,o){var s,r;return(s=t._graphNodes[e.name]).x&&s.x>a.x||(s.x=a.x),s.y&&s.y>a.y||(s.y=a.y),s.maxLevel=Math.max(n,s.maxLevel||0),r={x:a.x,y:a.y,right:a.x+a.width,bottom:a.y+a.height},s.maxLevel=Math.max(s.maxLevel||0,n),this._translateSubTree(t,e,r,r,a,n,void 0,void 0!=i,o),{x:s.x,y:s.y,right:s.x+a.width,bottom:s.y+a.height}},_translateSubTree:function(t,e,i,a,n,o,s,r,l){var d=t._graphNodes[e.name],h=t.diagram.nameTable[d.firstChild?d.firstChild.child:d.tree.children[0]],g=h?t._graphNodes[h.name]:null,c=this._hasChild(t,e),u=this._findIntersectingLevels(t,i,o,d.actualLevel),m=this._findIntersectingLevels(t,a,o,d.actualLevel),p=[];u.length&&d.translate?(d.intersect=u,this._spaceLeftFromPrevSubTree(t,e,i),d.canMoveBy=d.diff,void 0!==s&&(d.canMoveBy=Math.min(s,d.canMoveBy)),h&&void 0!==g.canMoveBy&&(g.canMoveBy>=d.canMoveBy&&(d.translated=!0),d.canMoveBy=Math.min(d.canMoveBy,g.canMoveBy)),r&&(d.x-=d.canMoveBy,d.subTreeTranslation-=d.canMoveBy,c&&(this._shiftSubordinates(t,m,d.canMoveBy),a.x=Math.min(a.x,d.x),a.right=Math.max(a.right,d.x+n.width),a.bottom=Math.max(a.bottom,d.y+n.height),a.x-=d.canMoveBy,a.right-=d.canMoveBy),h&&g.canMoveBy>d.canMoveBy?d.canMoveBy=g.canMoveBy-d.canMoveBy:h&&void 0!==d.canMoveBy&&(d.canMoveBy=0))):(c&&(a.x=Math.min(a.x,i.x),a.right=Math.max(a.right,i.x+n.width),a.bottom=Math.max(a.bottom,d.y+n.height)),d.translate||(d.canMoveBy=0,d.subTreeTranslation=0)),l||(i={x:d.x,y:n.y,right:d.x+n.width,bottom:n.y+n.height},p.push({rBounds:i}),this._updateRearBounds(t,e,p,o))},_updateRearBounds:function(t,e,i,a,n){var o,s,r,l,d,h,g,c=!0;if(e&&(n=(d=t._graphNodes[e.name]).intersect,c=!d.tree.children.length&&!d.tree.assistants.length),r=i[0].rBounds,l=i[i.length-1].rBounds,n&&n.length){for(h=(o=t.levels[n[0]].rBounds).bottom,o.y<r.y&&(o.bottom=r.y,i.splice(0,0,{rBounds:o})),h>l.bottom?i.push({rBounds:{x:o.x,right:o.right,y:r.bottom,bottom:h}}):(o=t.levels[n[n.length-1]].rBounds,c&&o.bottom>l.bottom&&(o.y=l.bottom,i.push({rBounds:o}))),s=n[0],g=i.length-1;g>=0;g--)t.levels.splice(s,0,i[g]);s+=i.length,t.levels.splice(s,n.length)}else for(s=this._findLevel(t,i[i.length-1].rBounds,a),g=i.length-1;g>=0;g--)t.levels.splice(s,0,i[g])},_shiftSubordinates:function(t,e,i){var a;if(0!=i)for(a=0;a<e.length;a++)t.levels[e[a]].rBounds&&(t.levels[e[a]].rBounds.x-=i,t.levels[e[a]].rBounds.right-=i)},_setDepthSpaceForAssistants:function(t,e,i,a,n,o){for(var s,r,l,d=t._graphNodes[e.name],h=i,g=0;g<d.tree.assistants.length;g++)(s=t._graphNodes[d.tree.assistants[g]])&&(s.tree.children=s.tree.assistants=[],s.y=i,r=(l=t.diagram.nameTable[d.tree.assistants[g]]).height?l.height:l._height,("lefttoright"==t.orientation||"righttoleft"==t.orientation)&&(r=l.width?l.width:l._width),h=i+r+o/2,t.maxLevel=n+1,g%2==1&&g!=d.tree.assistants.length-1&&(i=h,n++));return{level:t.maxLevel,bottom:i+r+o}},_setBreadthSpaceForAssistants:function(t,e,i,a,n,o){for(var s,r,l,d,h,g,c,u,m=t._graphNodes[e.name],p=o,f=0;f<m.tree.assistants.length;f++)(s=t._graphNodes[m.tree.assistants[f]])&&(r=(d=t.diagram.nameTable[m.tree.assistants[f]]).width?d.width:d._width,("lefttoright"==t.orientation||"righttoleft"==t.orientation)&&(r=d.height?d.height:d._height),h=f%2==0?a+i.width/2-20-r:a+i.width/2+20,l=this._updateTree(t,h,s.y,t.diagram.nameTable[m.tree.assistants[f]],p+1),this._hasChild(t,e)||(0==f?c=l:this._uniteRects(c,l)),f%2==0&&s.prevBounds&&(g=void 0===g?s.canMoveBy:Math.min(g,s.canMoveBy)),(f%2==1||f==m.tree.assistants.length-1)&&(u=this._findIntersectingLevels(t,l,p+1),this._updateRearBounds(t,null,[{rBounds:l}],p+1,u),p++));return c&&(c.canMoveBy=g),c},_updateHorizontalTree:function(t,e,i,a,n,o){var s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x=this._getDimensions(t,e,a,n,o),D=t._graphNodes[e.name],C=D.tree.type,z=o,S=a,P=n;t.levels.slice(0,t.levels.length);if(this._hasChild(t,e)){for(_="lefttoright"==t.orientation||"righttoleft"==t.orientation,v=0;v<D.tree.children.length;v++)p=(s=t.diagram.nameTable[D.tree.children[v]]).width?s.width:s._width,f=s.height?s.height:s._height,d=_?f:p,h=_?p:f,t.levels[z+1]?t.levels[z+1].rBounds:null,l=this._updateTree(t,S,P,s,z+1,t.diagram.nameTable[D.tree.children[v-1]]),r=t._graphNodes[s.name],D.maxLevel=Math.max(D.maxLevel||0,r.maxLevel||0),u={x:r.x,y:r.y,right:r.x+d,bottom:r.y+h},0==v&&(c={x:Math.min(r.x,l.x),y:Math.min(r.y,l.y),right:l.right,bottom:l.bottom},g=r),y?(y.x=u.x,y.y=u.y,u.right>y.right&&(y.right=u.right),y.bottom=u.bottom):y=u,0==v&&(D.firstChild={x:r.x,canMoveBy:r.canMoveBy,child:s.name}),this._hasChild(t,s)&&(!D.firstChild||D.firstChild.x>=r.firstChild.x?(r.firstChild&&D.firstChild.canMoveBy<r.canMoveBy&&(b=D.firstChild.canMoveBy,r.canMoveBy=b,t._graphNodes[D.firstChild.child].canMoveBy=b,D.firstChild.canMoveBy=b),D.firstChild={x:r.firstChild.x,canMoveBy:void 0!==b?b:r.canMoveBy,child:s.name}):r.firstChild&&r.translated&&D.firstChild.canMoveBy>r.canMoveBy&&(D.firstChild.canMoveBy=t._graphNodes[D.firstChild.child].canMoveBy=r.canMoveBy)),m=m?Math.max(r.maxLevel,m):r.maxLevel,s._isRightAdded||(this._uniteRects(c,l),S=0!=v&&!this._hasChild(t,s)&&r.subTreeTranslation<0?l.right-r.subTreeTranslation+t.horizontalSpacing:l.right+t.horizontalSpacing),s._isRightAdded=!0;isNaN(void 0)||(g.canMoveBy=void 0),D.mid=(g.x+y.right)/2-x.width/2,"left"==C?D.mid=u.right-x.width:"right"==C&&(D.mid=a)}return c},_updateHorizontalTreeWithMultipleRows:function(t,e,i,a,n,o,s){var r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C,z,S,P,w=this._getDimensions(t,e,a,n,o),T=t._graphNodes[e.name],j=(T.tree.type,o),E=a,N=n,L=(t.levels.slice(0,t.levels.length),s=[],0);if(this._hasChild(t,e)){var I="lefttoright"==t.orientation||"righttoleft"==t.orientation,O=this._splitChildrenInRows(t,e),M=5==T.tree.children.length&&3==O[0].length,A=[],k=[];if(M)k=O;else for(x=0;x<O.length;x++){if(A[x]=[],k[x]=[],u=O[x].length,O[x].length%2!=1)for(u=Math.ceil(O[x].length/2),m=0;m<u;m++)A[x].push(O[x][m]);for(P=A[x].length;P<O[x].length;P++)k[x].push(O[x][P])}for(p=[],L=0,x=0;x<A.length&&A[x].length;x++){for(E=a,p[x-1]&&(N=p[x-1].bottom+t.verticalSpacing),P=0;P<A[x].length;P++)g=(B=t.diagram.nameTable[A[x][P]]).width?B.width:B._width,c=B.height?B.height:B._height,d=I?c:g,I?g:c,t.levels[j+1]?t.levels[j+1].rBounds:null,(r=t._graphNodes[B.name]).actualLevel=j+1+x,l=this._updateTree(t,E,N,B,j+1,t.diagram.nameTable[A[x][P-1]]),0==P?p[x]={x:l.x,y:l.y,right:l.right,bottom:l.bottom}:this._uniteRects(p[x],l),0==x&&0==P?(L=r.canMoveBy,T.firstChild={x:r.x,child:B.name,canMoveBy:r.canMoveBy}):0==P&&void 0!==r.canMoveBy&&L>r.canMoveBy&&(L=Math.min(L,r.canMoveBy||0),T.firstChild={x:r.x,child:B.name,canMoveBy:r.canMoveBy}),E=l.right+t.horizontalSpacing;f=0==x?p[x].right:Math.max(f,p[x].right),void 0}for(x=0;x<A.length&&A[x].length;x++){if(f!=p[x].right)for(_=f-p[x].right,P=0;P<A[x].length;P++)t.diagram.nameTable[A[x][P]],t._graphNodes[A[x][P]].x+=_;0==x?h={x:p[0].x,y:p[0].y,right:p[0].right,bottom:p[0].bottom}:this._uniteRects(h,p[x]),l}for(v=(f||0)+(void 0!==f?t.horizontalSpacing/2:0),void 0!==f&&(T.mid=v-w.width/2,y=f+t.horizontalSpacing),N=n,b=[],x=0;x<k.length;x++){for(E=O[x].length%2==1&&x==k.length-1||M?a:y||a,0!=x&&(N=b[x-1].bottom+t.verticalSpacing),P=0;P<k[x].length;P++)g=(B=t.diagram.nameTable[k[x][P]]).width?B.width:B._width,c=B.height?B.height:B._height,d=I?c:g,I?g:c,t.levels[j+1]?t.levels[j+1].rBounds:null,(r=t._graphNodes[B.name]).actualLevel=j+1+x,0==P&&A[x]&&A[x].length&&(r.translate=!1),M&&1==x&&(0==P&&C+d+t.horizontalSpacing<=z&&(D=!0,E=C-d/2),D&&1==P&&(E=z-d/2)),l=this._updateTree(t,E,N,B,j+1,t.diagram.nameTable[k[x][P-1]]),M&&P<=2&&0==x&&1==P&&(C=l.x-t.horizontalSpacing/2,z=l.x+d+t.horizontalSpacing/2),0==P?b[x]={x:l.x,y:l.y,right:l.right,bottom:l.bottom}:this._uniteRects(b[x],l),h||(h={x:b[x].x,y:b[x].y,right:b[x].right,bottom:b[x].bottom}),this._uniteRects(h,b[x]),E=l.right+t.horizontalSpacing,l,(!T.firstChild||(x==k.length-1&&O[x].length%2==1||M)&&0==P&&void 0!==r.canMoveBy&&L>r.canMoveBy)&&(L=Math.min(L,r.canMoveBy||0),T.firstChild={x:r.x,child:B.name,canMoveBy:r.canMoveBy});if(M&&1==x&&(S=b[0].right-b[0].x>=b[1].right-b[1].x?0:1),x==O.length-1&&(O[x].length%2==1||M&&1==x)){s=k[x][Math.floor(k[x].length/2)];var R=t.diagram.nameTable[s],U=this._getDimensions(t,R,t._graphNodes[s].x,t._graphNodes[s].y,j+1);if(_=void 0,!D&&M?(1==S&&(x=0),_=(b[S].x+b[S].right)/2-(b[x].x+b[x].right)/2,0==x&&(T.mid+=_)):M||void 0===y||(_=y-t.horizontalSpacing/2-(t._graphNodes[s].x+U.width/2)),void 0!==_)for(P=0;P<k[x].length;P++)if(t._graphNodes[k[x][P]].x+=_,t._graphNodes[k[x][P]].canMoveBy+=_,P==k[x].length-1){this._getDimensions(t,t.diagram.nameTable[k[x][P]],t._graphNodes[k[x][P]].x,t._graphNodes[k[x][P]].y,t._graphNodes[k[x][P]].actualLevel);var B=t._graphNodes[k[x][P]],H=this._findIntersectingLevels(t,{x:B.x,y:B.y,right:B.x+w.width,bottom:B.y+w.height},t._graphNodes[k[x][P]].actualLevel);this._updateRearBounds(t,null,[{rBounds:{x:B.x,y:B.y,right:B.x+w.width,bottom:B.y+w.height}}],t._graphNodes[k[x][P]].actualLevel,H)}M&&(T.mid=(z+C)/2+(0==x?_:0)-w.width/2),void 0==T.mid&&t._graphNodes[s]&&(T.mid=t._graphNodes[s].x),D=!1,x++}}}return h},_updateVerticalTree:function(t,e,i,a,n,o){var s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C,z,S,P,w,T,j=[],E=[];for(this._getDimensions(t,e,i,a,n),f=t._graphNodes[e.name],_=t.diagram.nameTable[f.tree.children[0]],v="lefttoright"==t.orientation||"righttoleft"==t.orientation,y="left"==f.tree.type||"leftoffset"==f.tree.type?-1:0,b=i,x=a,D=n,C=0;C<f.tree.children.length;C++)"alternate"==f.tree.type&&(z=C%2==0&&f.tree.children.length>2?"left":"right",y=C%2==0&&f.tree.children.length>2?-1:0),b=i+this._findOffset(t,e,f,z),P=(s=t.diagram.nameTable[f.tree.children[C]]).width?s.width:s._width,w=s.height?s.height:s._height,d=v?w:P,h=v?P:w,l=this._updateTree(t,b+y*d,x,s,n+1,void 0,!0),u={x:(r=t._graphNodes[s.name]).x,y:r.y,right:r.x+d,bottom:r.y+h},0==C?(this._uniteRects(l,u),c=l):this._uniteRects(c,l),!r.prevBounds||"alternate"==f.tree.type&&C%2==1&&f.tree.children.length>2||(T=void 0!==T?Math.min(r.canMoveBy,T):r.canMoveBy),f.maxLevel=Math.max(f.maxLevel||0,r.maxLevel||0),"alternate"==f.tree.type&&f.tree.children.length>2&&C%2==0?(0!=C&&(x=g.bottom+t.verticalSpacing/2),E.push({rBounds:u}),r.levelBounds&&(E=E.concat(r.levelBounds))):(x="alternate"==f.tree.type&&f.tree.children.length>2?Math.max(l.bottom,g.bottom)+t.verticalSpacing/2:l.bottom+t.verticalSpacing/2,n=f.maxLevel,j.push({rBounds:u}),p?this._uniteRects(p,u):p={x:r.x,y:r.y,right:r.x+d,bottom:r.y+h},r.levelBounds&&(j=j.concat(r.levelBounds))),0==C&&(f.firstChild={x:r.x,canMoveBy:r.canMoveBy,child:s.name}),this._hasChild(t,s)&&(!f.firstChild||f.firstChild.x>=r.firstChild.x?(r.firstChild&&f.firstChild.canMoveBy<r.canMoveBy&&(T=f.firstChild.canMoveBy,r.canMoveBy=T,t._graphNodes[f.firstChild.child].canMoveBy=T,f.firstChild.canMoveBy=T),f.firstChild={x:r.firstChild.x,canMoveBy:void 0!==T?T:r.canMoveBy,child:s.name}):r.firstChild&&r.translated&&f.firstChild.canMoveBy>r.canMoveBy&&(f.firstChild.canMoveBy=t._graphNodes[f.firstChild.child].canMoveBy=r.canMoveBy)),g=u;return o?f.levelBounds=j:("alternate"==f.tree.type&&f.tree.children.length>2&&(m={x:E[0].rBounds.x,y:E[0].rBounds.y,right:E[E.length-1].rBounds.right,bottom:E[E.length-1].rBounds.bottom},S=this._findIntersectingLevels(t,m,D+1),this._updateRearBounds(t,null,E,D+1,S)),S=this._findIntersectingLevels(t,p||c,D+1),this._updateRearBounds(t,null,p?j:[{rBounds:c}],D+1,S)),isNaN(T)||(t._graphNodes[_.name].canMoveBy=T),f.childBounds=c,f.mid=i,c},_splitChildrenInRows:function(e,i){var a,n,o=e._graphNodes[i.name],s=4,r=[],l=o.tree.children.length,d=t.extend([],!0,o.tree.children);for(o.tree.rows?(a=o.tree.children.length,s=(n=Math.ceil(a/o.tree.rows))%2==0?n:n+1):3==o.tree.children.length||4==o.tree.children.length?s=2:5==o.tree.children.length&&(s=3);l>0;)r[r.length]=d.splice(0,s),(l-=s)<s&&(s=l);return r},_findOffset:function(t,e,i,a){var n=0,o="lefttoright"==t.orientation||"righttoleft"==t.orientation?e.height?e.height:e._height:e.width?e.width:e._width,s=a||i.tree.type;switch(n=i.tree.offset||(0===i.tree.offset?0:20),"alternate"==i.tree.type&&n>=t.horizontalSpacing&&(n=t.horizontalSpacing/2),s){case"left":n=o/2-n;break;case"right":n+=o/2}return n},_translateSiblings:function(t,e,i){var a,n,o;for(n=t._graphNodes[e.name],o=t._graphNodes[i.name].diff-t._graphNodes[i.name].canMoveBy,a=0;a<n.tree.children.length&&i.name!=n.tree.children[a];a++)t._graphNodes[n.tree.children[a]].x+=o},_uniteRects:function(t,e){t.x=Math.min(t.x,e.x),t.right=Math.max(t.right,e.right),t.bottom=Math.max(t.bottom,e.bottom)},_spaceLeftFromPrevSubTree:function(t,e,i){for(var a,n,o=t._graphNodes[e.name],s=t.horizontalSpacing,r=0;r<o.intersect.length;r++)n=t.levels[o.intersect[r]].rBounds,a=i.x-(n.right+s),(void 0==o.diff||a<o.diff)&&(o.diff=a,o.prevBounds=t.levels[o.intersect[r]])},_findIntersectingLevels:function(t,e,i,a){var n,o,s,r={x:e.x,y:e.y,right:e.right,bottom:e.bottom};r.y-=t.verticalSpacing/2,r.bottom+=t.verticalSpacing/2,n=[],s=void 0!==a?a:i,o=t.levels[s]?t.levels[s].rBounds:null;do{if(o&&(r.y<o.y&&r.bottom>o.y||r.y<o.bottom&&o.bottom<r.bottom||r.y>=o.y&&r.bottom<=o.bottom||r.y<o.y&&r.bottom>o.bottom))n.splice(0,0,s);else if(o&&o.bottom<r.y)break;s--,o=t.levels[s]?t.levels[s].rBounds:null}while(s>=0);s=(void 0!==a?a:i)+1,o=t.levels[s]?t.levels[s].rBounds:null;do{if(o&&(r.y<o.y&&r.bottom>o.y||r.y<o.bottom&&o.bottom<r.bottom||r.y>=o.y&&r.bottom<=o.bottom||r.y<o.y&&r.bottom>o.bottom))n.push(s);else if(o&&o.y>r.bottom)break;s++,o=t.levels[s]?t.levels[s].rBounds:null}while(s<=t.levels.length);return n},_findLevel:function(t,e){for(var i=e,a=0,n=t.levels[a]?t.levels[a].rBounds:null;a<t.levels.length;){if(n&&i.bottom<n.y)return a;a++,n=t.levels[a]?t.levels[a].rBounds:null}return a},_updateEdges:function(t,i,a){var n,o,s=t._graphNodes[i.name];if(i.outEdges&&i.outEdges.length&&i.isExpanded)for(n=0;n<i.outEdges.length;n++)(o=t.diagram.nameTable[t.diagram.nameTable[i.outEdges[n]].targetNode]).excludeFromLayout||(e.datavisualization.Diagram.Util._collectionContains(o.name,s.tree.children)||s.tree.children.push(o.name),o.outEdges&&o.outEdges.length&&o.isExpanded&&(s.tree.hasSubTree=!0),this._updateEdges(t,o,a+1));s.tree.level=a,s.tree.hasSubTree&&(s.tree.orientation="horizontal"),t.getLayoutInfo&&"organizationalchart"==t.type&&(t.getLayoutInfo(t.diagram,i,s.tree),"balanced"==s.tree.type&&s.tree.hasSubTree&&(s.tree.type="center",s.tree.orientation="horizontal")),t.level&&"alternate"!=s.tree.type&&a>=t.level&&(s.tree.hasSubTree=!1)},_updateAnchor:function(t,i){var a,n,o,s,r,l,d,h,g,c,u,m,p;if(t.diagram.viewPort=n=e.datavisualization.Diagram.ScrollUtil._viewPort(t.diagram,!0),n.x=0,n.y=0,d=t.bounds?t.bounds:n,"toptobottom"==(h=t.diagram._layoutOrientation())||"bottomtotop"==h){switch(t.horizontalAlignment){case"left":t._anchorX=d.x-i.x+t.margin.left;break;case"right":t._anchorX=d.x+d.width-t.margin.right-i.right;break;case"center":t._anchorX=d.x+d.width/2-(i.x+i.right)/2}switch(t.verticalAlignment){case"top":g=d.y+t.margin.top,t._anchorY="toptobottom"==h?g:i.bottom+g;break;case"bottom":c=d.y+d.height-t.margin.bottom,t._anchorY="toptobottom"==h?c-i.bottom:c;break;case"center":p=d.y+d.height/2,t._anchorY="toptobottom"==t.orientation?p-(i.y+i.bottom)/2:p+(i.y+i.bottom)/2}}else if("lefttoright"==h||"righttoleft"==h){switch(t.horizontalAlignment){case"left":u=d.x+t.margin.left,t._anchorX="lefttoright"==h?u:i.bottom+u;break;case"right":m=d.x+d.width-t.margin.right,t._anchorX="lefttoright"==h?m-i.bottom:m;break;case"center":p=d.width/2+d.x,t._anchorX="lefttoright"==t.orientation?p-(i.y+i.bottom)/2:p+(i.y+i.bottom)/2}switch(t.verticalAlignment){case"top":t._anchorY=d.y+t.margin.top-i.x;break;case"center":t._anchorY=d.y+d.height/2-(i.right+i.x)/2;break;case"bottom":t._anchorY=d.y+d.height-t.margin.bottom-i.right}}if(t.fixedNode){for(s=(o=t.diagram.nameTable[t.fixedNode]).width?o.width:o._width,r=o.height?o.height:o._height,t._anchorX=o.offsetX,t._anchorY=o.offsetY,t._anchorX+="righttoleft"==t.orientation?s*o.pivot.x:-s*o.pivot.x,t._anchorY+="bottomtotop"==t.orientation?r*o.pivot.y:-r*o.pivot.y,a=o,l=0;a.inEdges.length;)a=this._getParentNode(t,a),l+=t._graphNodes[a.name].subTreeTranslation||0;"lefttoright"==t.orientation||"righttoleft"==t.orientation?(t._anchorX-=t._graphNodes[o.name].y,t._anchorY-=t._graphNodes[o.name].x+l):(t._anchorX-=t._graphNodes[o.name].x+l,t._anchorY-=t._graphNodes[o.name].y)}},_updateConnectors:function(t,i,a){var n,o,s,r,l,d,h,g,c,u,m=0,p=0,f=0,_=0;if(r=t._graphNodes[i.name],i.outEdges.length)for(n=0;n<i.outEdges.length;n++)if(o=t.diagram.nameTable[i.outEdges[n]],s=t.diagram.nameTable[o.targetNode],o.visible&&!o._visited){if(o._visited=!0,t.getConnectorSegments)h=t.getConnectorSegments(t.diagram,o);else if(r&&-1!=r.tree.children.indexOf(o.targetNode)){var v=i.width?i.width:i._width,y=i.height?i.height:i._height,b=s.width?s.width:s._width,x=s.height?s.height:s._height;"organizationalchart"==t.type&&("toptobottom"==t.orientation||"bottomtotop"==t.orientation?(p="toptobottom"==t.orientation?y:-y,_="toptobottom"==t.orientation?-x:x,l="toptobottom"==t.orientation?"bottom":"top",r.tree.assistants.length?h=[{type:"orthogonal",length:Math.abs(s.offsetY+_/2-(i.offsetY+p/2))-t.verticalSpacing/2,direction:l}]:"horizontal"!=r.tree.orientation||1!=o.segments.length&&"balanced"!=r.tree.type?"horizontal"==r.tree.orientation?h=[{type:"orthogonal"}]:r.tree.enableRouting&&(h=[{type:"orthogonal",length:Math.abs(s.offsetY-(i.offsetY+p/2)),direction:l}],r.tree.offset<5&&(d="left"==r.tree.type?"right":"left",h=[{type:"orthogonal",length:t.verticalSpacing/4,direction:l},{type:"orthogonal",length:Math.abs(r.tree.offset)+t.horizontalSpacing/2,direction:d}])):"balanced"==r.tree.type?5==r.tree.children.length&&n>2?(g=r.tree.children[1],isNaN(t._graphNodes[g]._treeWidth)&&(t._graphNodes[g]._treeWidth=t.diagram.nameTable[g].width),c=3==n?t.diagram.nameTable[g].offsetX-t._graphNodes[g]._treeWidth/2-t.horizontalSpacing/2:t.diagram.nameTable[g].offsetX+t._graphNodes[g]._treeWidth/2+t.horizontalSpacing/2,h=[{type:"orthogonal",length:t.verticalSpacing/2,direction:"bottom"},{type:"orthogonal",length:i.offsetX-c,direction:"left"},{type:"orthogonal",length:s.offsetY+_/2-(i.offsetY+p/2)-t.verticalSpacing,direction:"bottom"}]):(u=Math.min(30,t.verticalSpacing/2)*("bottom"==l?1:-1),h=[{type:"orthogonal",length:Math.abs(s.offsetY+_*s.pivot.y-u-(i.offsetY+p*(1-s.pivot.y))),direction:l}]):t.diagram._dock(o,t.diagram.nameTable)):(m="lefttoright"==t.orientation?v:-v,f="lefttoright"==t.orientation?-b:b,l="lefttoright"==t.orientation?"right":"left",r.tree.assistants.length?h=[{type:"orthogonal",length:Math.abs(s.offsetX+f/2-(i.offsetX+m/2))-t.verticalSpacing/2,direction:l}]:"horizontal"!=r.tree.orientation||1!=o.segments.length&&"balanced"!=r.tree.type?"horizontal"==r.tree.orientation?h=[{type:"orthogonal"}]:(h=[{type:"orthogonal",length:Math.abs(s.offsetX-(i.offsetX+m/2)),direction:l}],r.tree.offset<5&&(d="left"==r.tree.type?"bottom":"top",h=[{type:"orthogonal",length:t.verticalSpacing/4,direction:l},{type:"orthogonal",length:Math.abs(r.tree.offset)+10,direction:d}])):"balanced"==r.tree.type?5==r.tree.children.length&&n>2?(g=r.tree.children[1],isNaN(t._graphNodes[g]._treeWidth)&&(t._graphNodes[g]._treeWidth=t.diagram.nameTable[g].width),c=3==n?t.diagram.nameTable[g].offsetY-t._graphNodes[g]._treeWidth/2-t.verticalSpacing/2:t.diagram.nameTable[g].offsetY+t._graphNodes[g]._treeWidth/2+t.verticalSpacing/2,h=[{type:"orthogonal",length:t.horizontalSpacing/2,direction:"right"},{type:"orthogonal",length:i.offsetY-c,direction:"top"},{type:"orthogonal",length:s.offsetX+f/2-(i.offsetX+m/2)-t.horizontalSpacing,direction:"right"}]):(u=Math.min(30,t.horizontalSpacing/2)*("right"==l?1:-1),h=[{type:"orthogonal",length:Math.abs(s.offsetX+f*s.pivot.x-u-(i.offsetX+m*(1-s.pivot.x))),direction:l}]):t.diagram._dock(o,t.diagram.nameTable)))}h?t.diagram.updateConnector(o.name,{segments:h}):t.diagram._dock(o,t.diagram.nameTable),t.diagram._svg&&e.datavisualization.Diagram.DiagramContext.update(o,t.diagram),s&&!s.excludeFromLayout&&(s.isExpanded||this._hasChild(t,s))&&this._updateConnectors(t,s,a+1)}if(r&&r.tree.assistants.length)for(n=0;n<r.tree.assistants.length;n++)s=t.diagram.nameTable[r.tree.assistants[n]],o=t.diagram.nameTable[s.inEdges[0]],(h=[{type:"orthogonal",length:Math.abs(s.offsetY-(i.offsetY+p/2)),direction:l}])&&t.diagram.updateConnector(o.name,{segments:h}),t.diagram._svg&&e.datavisualization.Diagram.DiagramContext.update(o,t.diagram),(s.isExpanded||this._hasChild(t,s))&&this._updateConnectors(t,s,a+1)},_updateNodes:function(t,i,a,n,o,s){var r,l,d,h;i._visited=!0;var g=i.width?i.width:i._width,c=i.height?i.height:i._height,u=i.offsetX,m=i.offsetY;if(i.excludeFromLayout||(u=t._anchorX,m=t._anchorY,"lefttoright"==t.orientation?(u+=t._graphNodes[i.name].y+g/2,m+=t._graphNodes[i.name].x+a+c/2):"righttoleft"==t.orientation?(u-=t._graphNodes[i.name].y+g/2,m+=t._graphNodes[i.name].x+a+c/2):"toptobottom"==t.orientation?(u+=t._graphNodes[i.name].x+a+g/2,m+=t._graphNodes[i.name].y+c/2):(u+=t._graphNodes[i.name].x+a+g/2,m-=t._graphNodes[i.name].y+c/2),t._graphNodes&&((d=t._graphNodes[i.name])&&(d.tree.enableRouting||(t.diagram.minSpaceBetweenNode||(t.diagram.minSpaceBetweenNode=[]),t.diagram.minSpaceBetweenNode.push(i.name)))),u+=o=o||0,m+=s=s||0,t.updateView?t.diagram._translate(i,u-(i.offsetX||0),m-(i.offsetY||0),t.diagram.nameTable):!(n=i.name==t.fixedNode||n)&&this._withinView(u,m,g,c,i,t)?(u!=i.offsetX||m!=i.offsetY)&&t.objects.push({object:i.name,diff:u-i.offsetX,diffy:m-i.offsetY}):t.diagram._translate(i,u-(i.offsetX||0),m-(i.offsetY||0),t.diagram.nameTable)),h=[],this._hasChild(t,i))for(l=0;l<t._graphNodes[i.name].tree.children.length;l++)r=t.diagram.nameTable[t._graphNodes[i.name].tree.children[l]],this._updateNodes(t,r,a+(t._graphNodes[i.name].subTreeTranslation||0),n,o,s),h.push(r);if(t._graphNodes[i.name].tree.assistants.length)for(l=0;l<t._graphNodes[i.name].tree.assistants.length;l++)r=t.diagram.nameTable[t._graphNodes[i.name].tree.assistants[l]],this._updateNodes(t,r,a+(t._graphNodes[i.name].subTreeTranslation||0),null,o,s);t.diagram._updateQuad(t.diagram.nameTable[i.name]),t.diagram._setBounds(i),t.diagram._svg&&e.datavisualization.Diagram.DiagramContext.update(i,t.diagram)},_withinView:function(t,e,i,a,n,o){var s=o.diagram.model.scrollSettings.horizontalOffset/o.diagram.model.scrollSettings.currentZoom,r=o.diagram.model.scrollSettings.verticalOffset/o.diagram.model.scrollSettings.currentZoom,l=o.diagram.model.scrollSettings.viewPortWidth/o.diagram.model.scrollSettings.currentZoom+s,d=o.diagram.model.scrollSettings.viewPortHeight/o.diagram.model.scrollSettings.currentZoom+r;return(t+i/2>s||n.offsetX+i/2>s)&&(t-i/2<l||n.offsetX-i/2<l)&&(e+a/2>r||n.offsetY+a/2>r)&&(e-a/2<d||n.offsetY-a/2<d)},_getDimensions:function(t,e,i,a,n){var o,s=e.width?e.width:e._width,r=e.height?e.height:e._height;return("lefttoright"==t.orientation||"righttoleft"==t.orientation)&&(n||(o=i,i=a,a=o),r=e.width?e.width:e._width,s=e.height?e.height:e._height),{x:i,y:a,width:s,height:r}},_getParentNode:function(t,e){if(e.inEdges&&e.inEdges.length)return t.diagram.nameTable[t.diagram.nameTable[e.inEdges[0]].sourceNode]},_hasChild:function(t,e){return(e=t._graphNodes[e.name]).tree.children&&e.tree.children.length},_setUpLayoutInfo:function(t){var e={subTreeTranslation:0};return"organizationalchart"==t.type?e.tree={orientation:"vertical",type:"alternate",offset:20,enableRouting:!0}:"hierarchicaltree"==t.type&&(e.tree={orientation:"horizontal",type:"center",enableRouting:!0}),e.tree.children=[],e.tree.assistants=[],e.tree.level=0,e.translate=!0,e}},e.datavisualization.Diagram.RadialTreeLayout={doLayout:function(t){var e,i,a;for(i=(e=t.diagram).nodes(),a=0;a<i.length;a++)i[a].excludeFromLayout||(t._graphNodes[i[a].name]=this._setUpLayoutInfo(t,i[a]),i[a].inEdges&&i[a].inEdges.length||t._firstLevelNodes.push(i[a]));t.rootNode&&e.nameTable[t.rootNode]?t._centerNode=e.nameTable[t.rootNode]:t._firstLevelNodes.length&&(t._centerNode=t._firstLevelNodes[0],e.model.layout.rootNode=t._centerNode.name),t._centerNode&&(this._updateEdges(t,t._centerNode,0),this._depthFirstAllignment(t,t._centerNode,0,0),this._populateLevels(t),this._transformToCircleLayout(t),this._updateAnchor(t),this._updateNodes(t,t._centerNode))},_updateEdges:function(t,e,i){var a,n,o=t._graphNodes[e.name];for(t.layoutNodes.push(o),o.level=i,o.visited=!0,t.maxLevel=Math.max(t.maxLevel,i),a=0;a<e.outEdges.length;a++)(n=t.diagram.nameTable[t.diagram.nameTable[e.outEdges[a]].targetNode]).excludeFromLayout||n.visited||(o.children.push(n),this._updateEdges(t,n,i+1))},_depthFirstAllignment:function(t,e,i,a){var n,o,s,r,l;if(e){if((o=t._graphNodes[e.name]).children.length){for(a+=300,l=0;l<o.children.length;l++)i=(n=this._depthFirstAllignment(t,o.children[l],i,a)).x,a=n.y;if(o.children=o.children.sort(function(e,i){return t._graphNodes[e.name].x-t._graphNodes[i.name].x}),s=t._graphNodes[o.children[0].name].min,r=t._graphNodes[o.children[o.children.length-1].name].max,o.x=s+(r-s)/2,i=r+t.horizontalSpacing,o.segmentOffset=r+t.horizontalSpacing,o.x-=o.width/2,o.y-=o.height/2,o.min=s,o.max=r,o.x<s&&o.visited){for(o.x=s,i=o.x+o.width/2-(r-s)/2,o.visited=!1,l=0;l<o.children.length;l++)n=this._depthFirstAllignment(t,o.children[l],i,a);o.visited=!0,i=o.x+o.width+t.horizontalSpacing}i=i<(r=t._graphNodes[o.children[o.children.length-1].name].segmentOffset)?r:i,a-=300,o.y=a}else o.x=i,o.y=a,o.min=i,o.max=i+o.width,i+=o.width+t.horizontalSpacing;return{x:i,y:a}}},_populateLevels:function(t){var e,i,a,n,o=[],s=Math.min.apply(Math,t.layoutNodes.map(function(t){return t.x})),r=Math.max.apply(Math,t.layoutNodes.map(function(e){return e.x+e.width+t.horizontalSpacing}))-s;for(t.levels=[],e=0;e<=t.maxLevel;e++){for(i={},o=(o=t.layoutNodes.filter(function(t){if(t.level==e)return t})).sort(function(t,e){return t.x-e.x}),i.min=o[0].x,i.max=o[o.length-1].x+o[o.length-1].width+t.horizontalSpacing,i._actualCircumference=0,i.height=0,a=0;a<o.length;a++)o[a].height>i.height&&(i.height=o[a].height),i._actualCircumference+=Math.max(o[a].width,o[a].height),a!=o.length-1&&(i._actualCircumference+=t.horizontalSpacing);for(i.circumference=i.max-i.min,i._actualCircumference<i.circumference&&(i.circumference=(i.circumference+i._actualCircumference)/2),i.radius=i.circumference/(2*Math.PI)+i.height,i.nodes=[],e>1&&t.levels[e-1].radius+t.levels[e-1].height>=i.radius&&(i.radius=t.levels[e-1].radius+t.levels[e-1].height),n=0;n<o.length;n++)o[n].ratio=Math.abs(o[n].x+o[n].width/2-s)/r,i.nodes.push(o[n]);t.levels.push(i)}},_transformToCircleLayout:function(t){var e,i,a,n=t._graphNodes[t._centerNode.name];for(n.x=0,n.y=0,e=1;e<t.levels.length;e++)for(i=0;i<t.levels[e].nodes.length;i++)(a=t.levels[e].nodes[i]).x=Math.cos(360*a.ratio*Math.PI/180)*(t.levels[e].radius+t.verticalSpacing*e),a.y=Math.sin(360*a.ratio*Math.PI/180)*(t.levels[e].radius+t.verticalSpacing*e),t._anchorX=Math.min(t._anchorX,a.x),t._anchorY=Math.min(t._anchorY,a.y)},_updateAnchor:function(t){var i=e.datavisualization.Diagram.ScrollUtil._viewPort(t.diagram);t._centerNode?(t._anchorX=t._centerNode.offsetX||i.width/2,t._anchorY=t._centerNode.offsetY||i.height/2):(t._anchorX=i.width/2,t._anchorY=i.height/2)},_updateNodes:function(t,i){var a,n,o=t._graphNodes[i.name],s=o.x+t._anchorX,r=o.y+t._anchorY;for(t.diagram._translate(i,s-i.offsetX||0,r-i.offsetY||0,t.diagram.nameTable),a=0;a<o.children.length;a++)n=o.children[a],this._updateNodes(t,t.diagram.nameTable[n.name]);t.diagram._svg&&e.datavisualization.Diagram.DiagramContext.update(i,t.diagram)},_isValidLayout:function(t){if(t._centerNode&&Math.max.apply(Math,t.diagram.nodes().map(function(t){return t.inEdges.length}))<2)return!0;return!1},_setUpLayoutInfo:function(t,e){var i={};return i.name=e.name,i.x=0,i.y=0,i.min=0,i.max=0,i.width=e.width?e.width:e._width,i.height=e.height?e.height:e._height,i.children=[],i.level=0,i.ratio=0,i.visited=!1,i}},e.datavisualization.Diagram.MultipleParentHierarchicalLayout={doLayout:function(t){var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C,z,S,P,w,T,j;for(this.diagram=t.diagram,a=this.diagram.nodes(),this.nodes=[],n={},(o=new e.datavisualization.Diagram.LineDistribution(this)).edgeMapper=[],b=0;b<a.length;b++){for(x=this._createVertex(a[b],a[b].name,0,0,a[b].width,a[b].height),s=a[b].outEdges.slice(),C=0;C<s.length;C++)r=t.diagram.nameTable[s[C]],o._setEdgeMapper({key:r,value:[]});this.nodes.push(x),n[x.name]=x}if(l=[],null==this.roots&&null!=parent)for(d=this._findRoots(n,t),b=0;b<d.length;b++)h=Object(),l.push(h),this._traverse(d[b],!0,null,h,l,n);for({marginX:0,marginY:0},b=0;b<l.length;b++){for(H in g=[],h=l[b])g.push(h[H]);c=new e.datavisualization.Diagram.MultiParentModel(this,g,d,t),this._cycleStage(c),this._layeringStage(c,d),this._crossingStage(c),u=new e.datavisualization.Diagram.MatrixModel({model:c,matrix:[],rowOffset:[]}),o._arrangeElements(u)}var E=this._getModelBounds(this.nodes),N=e.datavisualization.Diagram.ScrollUtil._viewPort(t.diagram,!0),L=(N.width-E.width)/2-E.x,I=(N.height-E.height)/2-E.y;L=Math.round(L),I=Math.round(I),(m=t.margin||{}).left=m.left||0,m.right=m.right||0,m.top=m.top||0,m.bottom=m.bottom||0;var O="lefttoright"==t.orientation||"righttoleft"==t.orientation?t.horizontalSpacing:t.verticalSpacing,M=[];for(b=0;b<this.nodes.length;b++)if((p=this.nodes[b])&&!p.source&&!p.target){var A=this.diagram.nameTable[p.name],k=p.geometry.x+p.geometry.width/2,R=p.geometry.y+p.geometry.height/2,U=k,B=R;"bottomtotop"===t.orientation?B=E.height-R:"righttoleft"===t.orientation&&(U=E.width-k),U+=m.left,B+=m.top,U+=L,B+=I,null!=A&&(this.diagram._translate(A,U-A.offsetX,B-A.offsetY,t.diagram.nameTable),this.diagram._isInit||e.datavisualization.Diagram.DiagramContext.update(A,this.diagram),(p.inEdges.length>0||p.outEdges.length>0)&&M.push(A))}if(t.updateView&&!t.avoidSegmentOverlapping)for(f=t.diagram.connectors(),b=0;b<f.length;b++)_=f[b],t.getConnectorSegments&&(i=t.getConnectorSegments(t.diagram,_)),i&&t.diagram.updateConnector(_.name,{segments:i});if(t.avoidSegmentOverlapping)for(v=[],y=new e.datavisualization.Diagram.Rectangle(E.x+L,E.y+I,E.width,E.height),b=0;b<M.length;b++){if(null!=(x=M[b]).outEdges&&x.outEdges.length>0)for(D=x.outEdges.length,C=0;C<D;C++){if((z=t.diagram.nameTable[x.outEdges[C]])._pointCollection=[],D>1){var H,G=O/2,V=null,F=o._getEdgeMapper();for(S=0;S<F.length;S++)if(F[S].key==z){H=S;break}if(F[H].value.length>0){var W=Z=(X=F[H].value[0]).x+m.left,Y=$=X.y+m.top;"bottomtotop"==t.orientation?Y=E.height-$:"righttoleft"==t.orientation&&(W=E.width-Z),W+=L,Y+=I,V=new e.datavisualization.Diagram.Point(W,Y)}for(P=[],w=0;w<z.segments.length;w++)for(T in j=z.segments[w].points)P.push(j[T]);for(P=o._updateConnectorPoints(P,G,V,y),w=0;w<P.length;w++)j=P[w],z._pointCollection.push(new e.datavisualization.Diagram.Point(j.x,j.y));o._resetConnectorPoints(z,t.diagram)}v.push(z)}if(null!=x.inEdges&&x.inEdges.length>1)for(D=x.inEdges.length,F=o._getEdgeMapper(),C=0;C<D;C++)if(z=t.diagram.nameTable[x.inEdges[C]],o._containsValue(v,z)||(z._pointCollection=[]),D>1){for(G=O/2,V=null,S=0;S<F.length;S++)if(F[S].key==z){H=S;break}if(F[H].value.length>0&&!o._containsValue(v,z)){var X,Z,$;W=Z=(X=F[S].value[0]).x+m.left,Y=$=X.y+m.top;"bottomtotop"==t.orientation?Y=E.height-$:"righttoleft"==t.orientation&&(W=E.width-Z),W+=L,Y+=I,V=new e.datavisualization.Diagram.Point(W,Y)}for(P=[],w=0;w<z.segments.length;w++)for(T in j=z.segments[w].points)P.push(j[T]);for(P.reverse(),(P=o._updateConnectorPoints(P,G,V,y)).reverse(),z._pointCollection=[],w=0;w<P.length;w++)j=P[w],z._pointCollection.push(new e.datavisualization.Diagram.Point(j.x,j.y));o._resetConnectorPoints(z,t.diagram)}}},_getModelBounds:function(t){var i,a,n;for(t=t.slice(),i=null,a=null,n=0;n<t.length;n++)i=t[n].geometry,a=a?e.datavisualization.Diagram.Geometry.union(a,i):i;return a},_placementStage:function(t,e,i,a){var n=this._coordinateAssignment(e,i,a,t);return n.model=t,n.widestRankValue=null,this._placementStageExecute(n,a),{marginX:n.marginX+t.layout.horizontalSpacing,marginY:n.marginY+t.layout.verticalSpacing}},_calculateWidestRank:function(t,i,a){var n,o,s,r,l,d,h,g,c,u,m=!1;for(("lefttoright"===t.model.layout.orientation||"righttoleft"===t.model.layout.orientation)&&(m=!0),n=-t.verticalSpacing,o=0,t.rankSizes=[],t.rankOffset=[],s=a.maxRank;s>=0;s--){var p=0,f=a.ranks[s],_=m?t.marginY:t.marginX;for(g=0;g<f.length;g++)(r=f[g]).cell&&(r.cell.inEdges||r.cell.outEdges)?(null!=(l=e.datavisualization.Diagram.Util.bounds(this.diagram.nameTable[r.cell.name]))&&(r.width=l.width,r.height=l.height),p=Math.max(p,m?r.width:r.height)):e.datavisualization.Diagram.CrossReduction.prototype._isVertex(r)||(d=1,null!=r.edges&&(d=r.edges.length),r.width=10*(d-1)),m&&(r.height||(r.height=0)),_+=(m?r.height:r.width)/2,this._setXY(r,s,_,!!m),this._setTempVariable(r,s,_),(_+=(m?r.height:r.width)/2+t.horizontalSpacing)>t.widestRankValue&&(t.widestRankValue=_,t.widestRank=s),t.rankSizes[s]=_;for(t.rankOffset[s]=n,h=p/2+o/2+t.verticalSpacing,o=p,"north"==t.orientation||"west"==t.orientation?n+=h:n-=h,g=0;g<f.length;g++)c=f[g],u=this._getOffset(c,n,p,!m),this._setXY(c,s,u,!m)}},_getOffset:function(t,e,i,a){return e-(a?(i-t.height)/2:(i-t.width)/2)},_setTempVariable:function(t,i,a){e.datavisualization.Diagram.CrossReduction.prototype._isVertex(t)?t.temp[0]=a:t.temp[i-t.minRank-1]=a},_coordinateAssignment:function(t,e,i,a){var n={};return n.horizontalSpacing=a.layout.horizontalSpacing,n.verticalSpacing=a.layout.verticalSpacing,n.orientation="north",n.marginX=n.marginX=t||0,n.marginY=n.marginY=e||0,n},_getXY:function(t,i,a){return e.datavisualization.Diagram.CrossReduction.prototype._isVertex(t)?a?t.y[0]:t.x[0]:a?t.y[i-this.minRank-1]:t.x[i-this.minRank-1]},_setXY:function(t,e,i,a){t&&t.cell&&(t.cell.inEdges||t.cell.outEdges?a?t.y[0]=i:t.x[0]=i:a?t.y[e-t.minRank-1]=i:t.x[e-t.minRank-1]=i)},_rankCoordinates:function(t,i,a,n){var o,s,r,l,d,h=!1;("lefttoright"===t.model.layout.orientation||"righttoleft"===t.model.layout.orientation)&&(h=!0);var g=n.ranks[i],c=0,u=(h?t.marginY:t.marginX)+(t.widestRankValue-t.rankSizes[i])/2;for(o=0;o<g.length;o++)s=g[o],e.datavisualization.Diagram.CrossReduction.prototype._isVertex(s)?(null!=(r=e.datavisualization.Diagram.Util.bounds(this.diagram.nameTable[s.cell.name]))&&(s.width=r.width,s.height=r.height),c=Math.max(c,s.height)):e.datavisualization.Diagram.CrossReduction.prototype._isVertex(s)||(l=1,null!=s.edges&&(l=s.edges.length),h?s.height=10*(l-1):s.width=10*(l-1)),u+=d=(h?s.height:s.width)/2,this._setXY(s,i,u,!!h),this._setTempVariable(s,i,u),u+=d+t.horizontalSpacing},_initialCoords:function(t,e,i){var a;for(this._calculateWidestRank(t,e,i),a=t.widestRank;a>=0;a--)a<i.maxRank&&this._rankCoordinates(t,a,e,i);for(a=t.widestRank+1;a<=i.maxRank;a++)a>0&&this._rankCoordinates(t,a,e,i)},_isAncestor:function(t,e){if(null!=e&&null!=t.hashCode&&null!=e.hashCode&&t.hashCode.length<e.hashCode.length){if(t.hashCode==e.hashCode)return!0;if(null==t.hashCode||null==t.hashCode)return!1;for(var i=0;i<t.hashCode.length;i++)if(t.hashCode[i]!=e.hashCode[i])return!1;return!0}return!1},_weightedCellSorter:function(t,e){var i={};return i.cell=t||null,i.weightedValue=e||0,i.visited=!1,i.rankIndex=null,i},_minNode:function(t,i){for(var a,n,o,s,r,l,d,h,g,c=[],u={map:{}},m=[],p=0;p<=i.maxRank;p++)for(m[p]=i.ranks[p],a=0;a<m[p].length;a++)n=m[p][a],(o=this._weightedCellSorter(n,p)).rankIndex=a,o.visited=!0,c.push(o),e.datavisualization.Diagram.MultiParentModel.prototype._setDictionary(u,n,o,!0);for(var f=10*c.length,_=0;c.length>0&&_<=f;){var v=c.shift(),y=v.cell,b=v.weightedValue,x=parseInt(v.rankIndex),D=e.datavisualization.Diagram.CrossReduction.prototype._getConnectedCellsOnLayer(y,b),C=e.datavisualization.Diagram.CrossReduction.prototype._getConnectedCellsOnLayer(y,b,!0),z=D.length,S=C.length,P=this._medianXValue(t,D,b+1),w=this._medianXValue(t,C,b-1),T=z+S,j=e.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(y,b),E=j;T>0&&(E=(P*z+w*S)/T),s=!1,r=null,E<j-1?0==x?(r=E,s=!0):(l=m[b][x-1],(d=(d=e.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(l,b))+l.width/2+t.intraCellSpacing+y.width/2)<E?(r=E,s=!0):d<e.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(y,b)-1&&(r=d,s=!0)):E>j+1&&(x==m[b].length-1?(r=E,s=!0):(h=m[b][x+1],(g=(g=e.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(h,b))-h.width/2-t.intraCellSpacing-y.width/2)>E?(r=E,s=!0):g>e.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(y,b)+1&&(r=g,s=!0))),s&&(this._setTempVariable(y,b,r),this._updateNodeList(c,u,D),this._updateNodeList(c,u,C)),e.datavisualization.Diagram.CrossReduction.prototype._isVertex(v.cell)&&(v.visited=!1),_++}},_updateNodeList:function(t,i,a){for(var n,o,s=0;s<a.length;s++)n=a[s],null!=(o=e.datavisualization.Diagram.MultiParentModel.prototype._getDictionary(i,n))&&0==o.visited&&(o.visited=!0,t.push(o))},_medianXValue:function(t,i,a){var n,o;if(0==i.length)return 0;for(n=[],o=0;o<i.length;o++)n[o]=e.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(i[o],a);if(n.sort(function(t,e){return t-e}),i.length%2==1)return n[Math.floor(i.length/2)];var s=i.length/2;return(n[s-1]+n[s])/2},_placementStageExecute:function(t){var i,a,n,o,s,r,l,d=!1;for(("lefttoright"===t.model.layout.orientation||"righttoleft"===t.model.layout.orientation)&&(d=!0),t.jettyPositions=Object(),i=t.model,d?t.currentYDelta=0:t.currentXDelta=0,this._initialCoords(t,{model:i},i),this._minNode(t,i),a=1e8,t.maxIterations||(t.maxIterations=8),n=0;n<t.maxIterations;n++){if((d?t.currentYDelta:t.currentXDelta)<a){for(o=0;o<i.ranks.length;o++)for(s=i.ranks[o],r=0;r<s.length;r++)l=s[r],this._setXY(l,o,e.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(l,o),!!d);a=d?t.currentYDelta:t.currentXDelta}d?t.currentYDelta=0:t.currentXDelta=0}this._setCellLocations(t,i)},_setCellLocations:function(t,e){for(var i=this._getValues(e.vertexMapper),a=0;a<i.length;a++)this._setVertexLocation(t,i[a])},_garphModelsetVertexLocation:function(i,a,n,o){i.model;var s=a.geometry,r=null;return null!=s&&(r=new e.datavisualization.Diagram.Rectangle(n,o,s.width,s.height),(s.x!=n||s.y!=o)&&((s=t.extend(!0,{},s)).x=n,s.y=o,a.geometry=s)),r},_setVertexLocation:function(t,e){var i=!1;("lefttoright"===t.model.layout.orientation||"righttoleft"===t.model.layout.orientation)&&(i=!0);var a=e.cell,n=e.x[0]-e.width/2,o=e.y[0]-e.height/2;this._garphModelsetVertexLocation(t,a,n,o),i?(t.marginY||(t.marginY=null),t.marginY=Math.max(t.marginY,o+e.height)):(t.marginX||(t.marginX=null),t.marginX=Math.max(t.marginX,n+e.width))},_getValues:function(t){var e,i=[];if(t.map)for(e in t.map)i.push(t.map[e]);return i},_createVertex:function(t,i,a,n,o,s){var r=new e.datavisualization.Diagram.Rectangle(a,n,o,s);return r.relative=!0,{value:i,geometry:r,name:i,vertex:!0,inEdges:t.inEdges.slice(),outEdges:t.outEdges.slice()}},_crossingStage:function(t){new e.datavisualization.Diagram.CrossReduction(this)._execute(t)},_layeringStage:function(t){this._initialRank(t),this._fixRanks(t)},_initialRank:function(t){for(var i,a,n,o,s,r=t._startNodes,l=e.datavisualization.Diagram.MultiParentModel.prototype._getDictionaryValues(t.vertexMapper),d=r.slice();r.length>0;){var h=(m=r[0]).connectsAsTarget,g=m.connectsAsSource,c=!0,u=1e8;for(a=0;a<h.length;a++){if(5270620!=(o=h[a]).temp[0]){c=!1;break}s=o.source,u=Math.min(u,s.temp[0]-1)}if(c){if(m.temp[0]=u,t.maxRank||(t.maxRank=1e8),t.maxRank=Math.min(t.maxRank,u),null!=g)for(a=0;a<g.length;a++)(o=g[a]).temp[0]=5270620,-1==(s=o.target).temp[0]&&(r.push(s),s.temp[0]=-2);r.shift()}else if(i=r.shift(),r.push(m),i==m&&1==r.length)break}for(a=0;a<l.length;a++)l[a].temp[0]-=t.maxRank;for(a=0;a<d.length;a++){var m,p=0;h=(m=d[a]).connectsAsSource;for(n=0;n<h.length;n++)s=(o=h[n]).target,m.temp[0]=Math.max(p,s.temp[0]+1),p=m.temp[0]}t.maxRank=1e8-t.maxRank},_fixRanks:function(t){t._fixRanks()},_cycleStage:function(t){var i,a,n,o,s,r,l={};for(t._startNodes=[],i=e.datavisualization.Diagram.MultiParentModel.prototype._getDictionaryValues(t.vertexMapper),a={},s=0;s<i.length;s++)i[s].temp[0]=-1,a[i[s].id]=i[s];if(window.model=t,window.objLayout=this,n=null,null!=t.roots)for(o=t.roots,n=[],s=0;s<o.length;s++)n[s]=e.datavisualization.Diagram.MultiParentModel.prototype._getDictionary(t.vertexMapper,o[s]),null!=n[s]&&t._startNodes.push(n[s]);t._visit("removeParentConnection",n,!0,null,l,a),r=e.datavisualization.Diagram.MultiParentModel.prototype._clone(l,null,!0),t._visit("removeNodeConnection",a,!0,r,l,a)},_remove:function(t,i){var a,n,o=null;if("object"==typeof i)for(a=e.datavisualization.Diagram.Util.indexOf(i,t);a>=0;)i.splice(a,1),o=t,a=e.datavisualization.Diagram.Util.indexOf(i,t);for(n=0;n<i.length;n++)i[n]==t&&(delete i[n],o=t);return o},_invert:function(t){var e=t.source;t.source=t.target,t.target=e,t.isReversed=!t.isReversed},_traverse:function(t,e,i,a,n,o){var s,r,l,d,h,g,c,u,m,p;if(null!=t)if(s=t.name,null==o||null!=o[s]){for(null==a[s]&&(a[s]=t),null!==o&&delete o[s],r=this._getEdges(t),l=[],u=0;u<r.length;u++)l[u]=this._getVisibleTerminal(r[u],!0)==t;for(u=0;u<r.length;u++)if(!e||l[u]){for(d=this._getVisibleTerminal(r[u],!l[u]),h=1,g=0;g<r.length;g++){if(g==u)continue;c=l[g],this._getVisibleTerminal(r[g],!c)==d&&(c?h++:h--)}h>=0&&(a=this._traverse(d,e,r[u],a,n,o))}}else if(null==a[s])for(u=0;u<n.length;u++)if(null!=(m=n[u])[s]){for(p in m)a[p]=m[p];return n.splice(u,1),a}return a},_findRoots:function(t,e){var i,a,n,o,s=[],r=null,l=-1e5;for(a in t){var d=t[a],h=this._getEdges(d),g=0,c=0;for(n=0;n<h.length;n++)this._getVisibleTerminal(h[n],!0).name==d.name?g++:c++;0==c&&g>0&&s.push(d),(o=g-c)>l&&(l=o,r=d),e.rootNode&&t[a].name===e.rootNode.name&&(i=d)}return 0==s.length&&null!=r&&(e&&e.rootNode?s.push(i):s.push(r)),s},_getEdges:function(t){var e,i=[];if(t){for(e=0;t.inEdges.length>0&&e<t.inEdges.length;e++)i.push(this.diagram.nameTable[t.inEdges[e]]);for(e=0;t.outEdges.length>0&&e<t.outEdges.length;e++)this.diagram.nameTable[t.outEdges[e]].visible&&i.push(this.diagram.nameTable[t.outEdges[e]])}return i},_getVisibleTerminal:function(t,e){var i,a=this.diagram.nameTable[t.targetNode];for(e&&(a=this.diagram.nameTable[t.sourceNode]),i=0;i<this.nodes.length;i++)if(this.nodes[i].name===a.name)return this.nodes[i]},_getEdgesBetween:function(t,e,i){var a,n,o,s,r;for(i=null!=i&&i,a=this._getEdges(t),n=[],o=0;o<a.length;o++)s=this._getVisibleTerminal(a[o],!0),r=this._getVisibleTerminal(a[o],!1),(s!=t||r!=e)&&(i||s!=e||r!=t)||n.push(a[o]);return n}},i=function(){function i(t,i,a,n){var o,s,r,l,d,h;for(this.roots=a,this.vertexMapper={map:{}},o=[],this.layout=n,this.maxRank=1e8,this._createInternalCells(t,i,o),s=0;s<i.length;s++){for(r=o[s].connectsAsSource,l=0;l<r.length;l++)if(null!=(h=(d=r[l]).edges)&&h.length>0){var g=h[0],c=t._getVisibleTerminal(g,!1),u=this._getDictionary(this.vertexMapper,c);o[s]==u&&(c=t._getVisibleTerminal(g,!0),u=this._getDictionary(this.vertexMapper,c)),null!=u&&o[s]!=u&&(d.target=u,0==u.connectsAsTarget.length&&(u.connectsAsTarget=[]),e.datavisualization.Diagram.Util.indexOf(u.connectsAsTarget,d)<0&&u.connectsAsTarget.push(d))}o[s].temp[0]=1}}return i.prototype.dfsCount=0,i.prototype._createInternalCells=function(t,i,a){for(var n,o,s,r,l,d,h,g=0;g<i.length;g++){for(a[g]={x:[],y:[],temp:[],cell:i[g],id:i[g].name,connectsAsTarget:[],connectsAsSource:[],identicalSibilings:null,type:"internalVertex"},this._setDictionary(this.vertexMapper,i[g],a[g]),n=e.datavisualization.Diagram.MultipleParentHierarchicalLayout._getEdges(i[g]),a[g].connectsAsSource=[],o=0;o<n.length;o++)if((s=t._getVisibleTerminal(n[o],!1))!=i[g]&&(r=t._getEdgesBetween(i[g],s,!1),l=t._getEdgesBetween(i[g],s,!0),null!=r&&r.length>0&&2*l.length>=r.length)){for(d={x:[],y:[],temp:[],edges:r,ids:[],identicalSibilings:null,type:"internalEdge"},h=0;h<r.length;h++)d.ids.push(r[h].name);d.source=a[g],a[g].connectsAsSource||(a[g].connectsAsSource=[]),e.datavisualization.Diagram.Util.indexOf(a[g].connectsAsSource,d)<0&&a[g].connectsAsSource.push(d)}a[g].temp[0]=0}},i.prototype._getType=function(t){return"internalVertex"===t?"internalVertex":"internalEdge"},i.prototype._fixRanks=function(){var t,e,i,a,n,o=[];for(this.ranks=[],i=0;i<this.maxRank+1;i++)o[i]=[],this.ranks[i]=o[i];if(t=null,null!=this.roots)for(e=this.roots,t=[],i=0;i<e.length;i++)a=e[i],n=this._getDictionary(this.vertexMapper,a),t[i]=n;this._visit("updateMinMaxRank",t,!1,null,null,null,o)},i.prototype._updateMinMaxRank=function(t,i,a,n,o,s,r,l){var d;if(i.maxRank||0==i.maxRank||(i.maxRank=-1),i.minRank||0==i.minRank||(i.minRank=-1),0==o&&i.maxRank<0&&i.minRank<0&&(l[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=l[i.maxRank].length-1),null!=t&&null!=a&&t.maxRank-i.maxRank>1)for(a.maxRank=t.maxRank,a.minRank=i.maxRank,a.temp=[],a.x=[],a.y=[],d=a.minRank+1;d<a.maxRank;d++)l[d].push(a),e.datavisualization.Diagram.MultipleParentHierarchicalLayout._setTempVariable(a,d,l[d].length-1)},i.prototype._setDictionary=function(t,e,i){var a,n=e.name;return n||(n=this._getDictionary(t,e)),a=t.map[n],t.map[n]=i,a},i.prototype._getDictionary=function(t,e){this.multiObjectIdentityCounter||0==this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=e.name;return i?t.map[i]:e.layoutObjectId?t.map[e.layoutObjectId]:(e.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,e.layoutObjectId)},i.prototype._getDictionaryValues=function(t,e){var i=[];for(var e in t.map)i.push(t.map[e]);return i},i.prototype._visit=function(t,e,i,a,n,o,s){var r,l;if(null!=e){for(r=0;r<e.length;r++)null!=(l=e[r])&&(null==a&&(a={}),i?(l.hashCode=[],l.hashCode[0]=this.dfsCount,l.hashCode[1]=r,this._extendedDfs(null,l,null,t,a,l.hashCode,r,0,n,o,s)):this._depthFirstSearch(null,l,null,t,a,0,n,o,s));this.dfsCount++}},i.prototype._depthFirstSearch=function(t,e,i,a,n,o,s,r,l){var d,h,g,c,u;if(null!=e)if(null==n[d=e.id])for(n[d]=e,this._updateConnectionRank(a,t,e,i,o,0,s,r,l),h=e.connectsAsSource.slice(),g=0;g<h.length;g++)u=(c=h[g]).target,this._depthFirstSearch(e,u,c,a,n,o+1,s,r,l);else this._updateConnectionRank(a,t,e,i,o,1,s,r,l)},i.prototype._updateConnectionRank=function(t,e,i,a,n,o,s,r,l){("removeParentConnection"===t||"removeNodeConnection"===t)&&this._removeConnectionEdge(e,i,a,n,o,s,r,l,"removeNodeConnection"===t),"updateMinMaxRank"===t&&this._updateMinMaxRank(e,i,a,n,o,s,r,l)},i.prototype._removeConnectionEdge=function(t,e,i,a,n,o,s,r){window.objLayout._isAncestor(e,t)&&(window.objLayout._invert(i),window.objLayout._remove(i,t.connectsAsSource),r?(e.connectsAsSource.push(i),t.connectsAsTarget.push(i),window.objLayout._remove(i,e.connectsAsTarget)):(t.connectsAsTarget.push(i),window.objLayout._remove(i,e.connectsAsTarget),e.connectsAsSource.push(i))),o[e.id]=e,delete s[e.id]},i.prototype._extendedDfs=function(t,e,i,a,n,o,s,r,l,d,h){var g,c,u,m,p,f;if(null!=e)if(null!=t&&(null==e.hashCode||e.hashCode[0]!=t.hashCode[0])&&(g=t.hashCode.length+1,e.hashCode=t.hashCode.slice(),e.hashCode[g-1]=s),null==n[c=e.id])for(n[c]=e,this._updateConnectionRank(a,t,e,i,r,0,l,d,h),u=e.connectsAsSource.slice(),m=0;m<u.length;m++)f=(p=u[m]).target,this._extendedDfs(e,f,p,a,n,e.hashCode,m,r+1,l,d,h);else this._updateConnectionRank(a,t,e,i,r,1,l,d,h)},i.prototype._clone=function(i,a,n){var o,s;if(n=null!=n&&n,null!=i&&"function"==typeof i.constructor)for(s in o=new i.constructor,i)"layoutObjectId"!=s&&(null==a||e.datavisualization.Diagram.Util.indexOf(a,s)<0)&&(o[s]=n||"object"!=typeof i[s]?i[s]:t.extend(!0,{},i[s]));return o},i}(),e.datavisualization.Diagram.MultiParentModel=i,a=function(){function t(){}return t.prototype._calculateCrossings=function(t){for(var e=t.ranks.length,i=0,a=1;a<e;a++)i+=this._calculateRankCrossing(a,t);return i},t.prototype._getTempVariable=function(t,e){if(t)return this._isVertex(t)?t.temp[0]:t.temp[e-t.minRank-1]},t.prototype._calculateRankCrossing=function(t,e){for(var i,a,n,o,s,r,l,d,h=0,g=e.ranks[t],c=e.ranks[t-1],u=[],m=0;m<g.length;m++){var p=g[m],f=this._getTempVariable(p,t),_=this._getConnectedCellsOnLayer(p,t,!0),v=[];for(i=0;i<_.length;i++)a=_[i],n=this._getTempVariable(a,t-1),v.push(n);v.sort(function(t,e){return t-e}),u[f]=v}for(o=[],m=0;m<u.length;m++)o=o.concat(u[m]);for(s=1;s<c.length;)s<<=1;for(r=2*s-1,s-=1,l=[],m=0;m<r;++m)l[m]=0;for(m=0;m<o.length;m++)for(++l[d=o[m]+s];d>0;)d%2&&(h+=l[d+1]),++l[d=d-1>>1];return h},t.prototype._execute=function(t){var e,i,a,n,o,s,r,l,d,h;for(this.nestedBestRanks=[],d=0;d<t.ranks.length;d++)this.nestedBestRanks[d]=t.ranks[d].slice();for(e=0,i=this._calculateCrossings(t),d=0;d<24&&e<2;d++){if(this._weightedMedian(d,t),(a=this._calculateCrossings(t))<i)i=a,e=0;else for(e++,h=0;h<this.nestedBestRanks.length;h++)for(n=t.ranks[h],o=0;o<n.length;o++)s=n[o],this._setTempVariable(s,h,o);if(0==i)break}for(r=[],l=[],d=0;d<t.maxRank+1;d++)l[d]=[],r[d]=l[d];for(d=0;d<this.nestedBestRanks.length;d++)for(h=0;h<this.nestedBestRanks[d].length;h++)l[d].push(this.nestedBestRanks[d][h]);t.ranks=r},t.prototype._isVertex=function(t){return!(!t||!t.cell||!t.cell.inEdges&&!t.cell.outEdges)},t.prototype._weightedMedian=function(t,e){var i,a=t%2==0;if(a)for(i=e.maxRank-1;i>=0;i--)this._medianRank(i,a);else for(i=1;i<e.maxRank;i++)this._medianRank(i,a)},t.prototype._getConnectedCellsOnLayer=function(t,e,i){var a,n,o="nextLayerConnectedCells",s="connectsAsTarget";if(i&&(o="previousLayerConnectedCells",s="connectsAsSource"),t){if(this._isVertex(t)){if(null==t[o])for(t[o]=[],t[o][0]=[],n=0;n<t[s].length;n++)void 0==(a=t[s][n]).maxRank&&(a.maxRank=-1),-1==a.maxRank||(i?a.minRank==e-1:a.maxRank==e+1)?t[o][0].push(i?a.target:a.source):t[o][0].push(a);return t[o][0]}if(null==t[o])for(t[o]=[],n=0;n<t.temp.length;n++)t[o][n]=[],n==(i?0:t.temp.length-1)?t[o][n].push(i?t.target:t.source):t[o][n].push(t);return t[o][e-t.minRank-1]}},t.prototype._medianValue=function(t,e){for(var i,a=[],n=0,o=0;o<t.length;o++)i=t[o],a[n++]=this._getTempVariable(i,e);if(a.sort(function(t,e){return t-e}),n%2==1)return a[Math.floor(n/2)];if(2==n)return(a[0]+a[1])/2;var s=n/2,r=a[s-1]-a[0],l=a[n-1]-a[s];return(a[s-1]*l+a[s]*r)/(r+l)},t.prototype._setTempVariable=function(t,e,i){t&&(t.temp[0]=i)},t.prototype._medianRank=function(t,e){for(var i,a,n,o,s=this.nestedBestRanks[t].length,r=[],l=[],d=0;d<s;d++)o=this.nestedBestRanks[t][d],(i={_medianValue:0,cell:!1}).cell=o,a=e?this._getConnectedCellsOnLayer(o,t):this._getConnectedCellsOnLayer(o,t,!0),n=e?t+1:t-1,null!=a&&0!=a.length?(i._medianValue=this._medianValue(a,n),r.push(i)):l[this._getTempVariable(o,t)]=!0;for(r.sort(this._compare),d=0;d<s;d++)null==l[d]&&(o=r.shift().cell,this._setTempVariable(o,t,d))},t.prototype._compare=function(t,e){if(null!=t&&null!=e){if(e._medianValue>t._medianValue)return-1;if(e._medianValue<t._medianValue)return 1}return 0},t}(),e.datavisualization.Diagram.CrossReduction=a,n=function(){function t(){this.edgeMapper=[]}return t.prototype._setEdgeMapper=function(t){this.edgeMapper.push(t)},t.prototype._getEdgeMapper=function(){return this.edgeMapper},t.prototype._initLineDistribution=function(t){var i,a,n,o="bottom",s="top";if(t.orientation==e.datavisualization.Diagram.LayoutOrientations.BottomToTop?(o="top",s="bottom"):t.orientation==e.datavisualization.Diagram.LayoutOrientations.RightToLeft?(o="left",s="right"):t.orientation==e.datavisualization.Diagram.LayoutOrientations.LeftToRight&&(o="right",s="left"),(i=t.diagram._spatialSearch.parentQuad.objects).length>0)for(a=0;a<i.length;a++)n=i[a],this._addDynamicPortandDistrrbuteLine(t,n,o,s)},t.prototype._addDynamicPortandDistrrbuteLine=function(t,i,a,n){var o,s,r,l,d;i._ports&&null==i._ports||(i._ports=[]);i._ports;var h=[],g=i.outEdges,c=i.inEdges;for(o in g){var u=t.diagram.nameTable[g[o]],m=e.datavisualization.Diagram.Util.findPortByName(i,u.sourcePort),p=a;null==m&&((m=e.datavisualization.Diagram.Port({})).type="internal",i._ports.push(m),t.diagram.updateConnector(u.name,{sourcePort:m.name})),null==p&&(s=u.segments[0].points,p=e.datavisualization.Diagram.Util._getBezierDirection(s[0],s[1])),h.push({port:m,direction:p})}for(o in c){u=t.diagram.nameTable[c[o]];var f=e.datavisualization.Diagram.Util.findPortByName(i,u.targetPort);p=n;null==f&&((f=e.datavisualization.Diagram.Port({})).type="internal",i._ports.push(f),t.diagram.updateConnector(u.name,{targetPort:f.name})),null==p&&(s=u.segments[0].points,p=e.datavisualization.Diagram.Util._getBezierDirection(s[s.length-2],s[s.length-1])),h.push({port:f,direction:p})}var _=[],v=[],y=[],b=[];for(r in h)"top"==(l=h[r]).direction?_.push(l):"left"==l.direction?v.push(l):"bottom"==l.direction?y.push(l):b.push(l);if(_.length>0)for(d=0;d<_.length;d++)_[d].port.offset={x:(d+1)*(1/(_.length+1)),y:0};if(y.length>0)for(d=0;d<y.length;d++)y[d].port.offset={x:(d+1)*(1/(y.length+1)),y:1};if(v.length>0)for(d=0;d<v.length;d++)v[d].port.offset={x:0,y:(d+1)*(1/(v.length+1))};if(b.length>0)for(d=0;d<b.length;d++)b[d].port.offset={x:1,y:(d+1)*(1/(b.length+1))}},t.prototype._containsValue=function(t,e){for(var i=0;i<t.length;i++)if(t[i].key==e||t[i]==e)return!0;return!1},t.prototype._distributeLines=function(t){for(var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C,z,S,P,w,T,j,E,N,L,I,O,M,A="lefttoright"==t.orientation||"righttoleft"==t.orientation,k=(A?t.horizontalSpacing:t.verticalSpacing)-18,R=[],U=[],B=t.diagram.connectors(),H=0;H<B.length;H++){for(N in O=[],(i=B[H]).segments)for(E in(a=i.segments[N]).points)n=a.points[E],0!=O.length&&e.datavisualization.Diagram.Geometry.isEqualPoint(n,O[O.length-1])||O.push(n);for(o=[],C=1;C<O.length;C++)r=e.datavisualization.Diagram.ObstacleSegment({startpt:O[C-1],endpt:O[C],id:i.id}),o.push(r);if(I={wrapper:i,segments:o},s=[],A)for(N in I.segments)"vertical"==(r=I.segments[N]).orientation&&s.push(r);else for(N in I.segments)"horizontal"==(r=I.segments[N]).orientation&&s.push(r);for(C=0;C<s.length;C++){for(E in j=s[C],this._containsValue(R,j.coord)||R.push({key:j.coord,value:[]}),R)if((N=R[E].key)==j.coord){V=E;break}R[V].value.push(j)}U.push(I)}for(l=[],L=0;L<R.length;L++){(h=(d=R[L]).value).sort(function(t,e){return t.start-e.start});var G=[],V=0,F=Number.MIN_VALUE;for(G.push([]),g=0;g<h.length;g++)j=h[g],!(G[V].length>0)||F>=j.start?(G[V].push(j),F=Math.max(F,G[V][G[V].length-1].end)):(V++,G.push([]),G[V].push(j),F=G[V][G[V].length-1].end);for(g=0;g<G.length;g++){for(c=G[g],u=[],C=0;C<c.length;C++)(_=c[C]).start&&u.push(_);for(m=A?"bottom":"right",p=[],C=0;C<u.length;C++)(_=u[C]).direction==m&&p.push(_);for(f=[],C=0;C<u.length;C++)(_=u[C]).direction!=m&&f.push(_);if(v=[],p.length>0)for(y=p[0].start,C=0;C<f.length;)for(f[C].end>y?(v.push(f[C]),f.splice(C,1)):C++,H=0;H<t.diagram.model.connectors.length;H++){for(delete t.diagram.model.connectors[H]._visited,C=0;C<t.diagram.model.connectors.length;C++)delete t.diagram.model.connectors[C]._visited;for(C=0;C<t.diagram.model.nodes.length;C++)delete t.diagram.model.nodes[C]._visited1,delete t.diagram.model.nodes[C]._isRightAdded}if(b=[],b=this._updateSegmentRow(v,b),x=[],x=this._updateSegmentRow(f,x),p.reverse(),x=this._updateSegmentRow(p,x),!b[b.length-1].length>0&&b.splice(b.length-1,1),!x[x.length-1].length>0&&x.splice(x.length-1,1),D=[],v.length>0&&(u[0].direction==v[0].direction||u[u.length-1].direction==v[v.length-1].direction)){for(D=x,M=0;M<b.length;M++)z=b[M],D[D.length]=z;for(C=0;C<t.diagram.model.nodes.length;C++)delete t.diagram.model.nodes[C]._visited1,delete t.diagram.model.nodes[C]._isRightAdded}else for(D=b,M=0;M<x.length;M++)z=x[M],D[D.length]=z;if(D.length>1)for(S=1,("bottomtotop"==t.orientation||"righttoleft"==t.orientation)&&(S=-1),P=d.key-S*k/2,w=k/D.length,H=0;H<D.length;H++)for(T=P+H*w*S,M=0;M<D[H].length;M++){for(E in(j=D[H][M]).coord=T,this._containsValue(l,j.coord)||l.push({key:j.coord,value:[]}),l)if((N=l[E].key)==j.coord){V=E;break}l[V].value.push(j)}}}for(L=0;L<U.length;L++){for(I=U[L],O=[],H=0;H<I.segments.length;H++)0==H?O.push(this._getObstacleStartPoint(I.segments[H])):A?"vertical"==I.segments[H].orientation&&(O[O.length-1]=this._getObstacleStartPoint(I.segments[H])):A||"horizontal"==I.segments[H].orientation&&(O[O.length-1]=this._getObstacleStartPoint(I.segments[H])),O.push(this._getObstacleEndPoint(I.segments[H]));for(I.wrapper._pointCollection=[],C=0;C<O.length;C++)M=O[C],(0==C||C>0&&!e.datavisualization.Diagram.Geometry.isEqualPoint(M,O[C-1]))&&I.wrapper._pointCollection.push(new e.datavisualization.Diagram.Point(M.x,M.y));this._resetConnectorPoints(I.wrapper,t.diagram),delete I.wrapper._pointCollection}},t.prototype._getObstacleStartPoint=function(t){return"horizontal"==t.orientation?"left"==t.direction?new e.datavisualization.Diagram.Point(t.end,t.coord):new e.datavisualization.Diagram.Point(t.start,t.coord):"top"==t.direction?new e.datavisualization.Diagram.Point(t.coord,t.end):new e.datavisualization.Diagram.Point(t.coord,t.start)},t.prototype._getObstacleEndPoint=function(t){return"horizontal"==t.orientation?"left"==t.direction?new e.datavisualization.Diagram.Point(t.start,t.coord):new e.datavisualization.Diagram.Point(t.end,t.coord):"top"==t.direction?new e.datavisualization.Diagram.Point(t.coord,t.start):new e.datavisualization.Diagram.Point(t.coord,t.end)},t.prototype._updateSegmentRow=function(t,e){var i,a,n=0;for(e.length>0||(e[0]=[]),i=0;i<t.length;i++)for(a=t[i];n<e.length;){if(n==e.length-1&&(e[n+1]=[]),!(e[n].length>0)||e[n][e[n].length-1].end<a.start){e[n].push(a);break}n++}return e},t.prototype._resetConnectorPoints=function(t,i){var a,n,o;if(t._pointCollection&&t._pointCollection.length>0){for((a=t).segments=[],a.sourcePoint=t._pointCollection[0],a.targetPoint=t._pointCollection[t._pointCollection.length-1],[],n=[],o=0;o<t._pointCollection.length-1;o++){var s=t._pointCollection[o],r=t._pointCollection[o+1],l=e.datavisualization.Diagram.Geometry.distance(s,r),d=e.datavisualization.Diagram.Util._getBezierDirection(s,r);n.push({length:l,direction:d,type:"orthogonal"})}i.updateConnector(a.name,{segments:n})}},t.prototype._updateConnectorPoints=function(t,i,a,n){var o,s,r,l,d,h,g,c,u,m="lefttoright"==this.orientation||"righttoleft"==this.orientation,p=t;if(p.length>2&&(o=e.datavisualization.Diagram.Geometry.transform(p[0],e.datavisualization.Diagram.Util.findAngle(p[0],p[1]),i),s=e.datavisualization.Diagram.Geometry.transform(o,e.datavisualization.Diagram.Util.findAngle(p[1],p[2]),e.datavisualization.Diagram.Util.findLength(p[1],p[2])),p.splice(1,2,o,s),null!=a)){var f=p.length,_=e.datavisualization.Diagram.Geometry.transform(p[f-1],e.datavisualization.Diagram.Util.findAngle(p[f-1],p[f-2]),i);for(p.splice(f-1,0,_);2<p.length-2;)p.splice(2,1);r=a,e.datavisualization.Diagram.Geometry.inflate(n,n.width,n.height),(l=[])[0]=new e.datavisualization.Diagram.Point(r.x,n.y),l[1]=new e.datavisualization.Diagram.Point(r.x,n.y+n.height),(d=[])[0]=new e.datavisualization.Diagram.Point(n.x,p[1].y),d[1]=new e.datavisualization.Diagram.Point(n.x+n.width,p[1].y),(h=[])[0]=new e.datavisualization.Diagram.Point(n.x,_.y),h[1]=new e.datavisualization.Diagram.Point(n.x+n.width,_.y),m&&(l[0]=new e.datavisualization.Diagram.Point(n.x,r.y),l[1]=new e.datavisualization.Diagram.Point(n.x+n.width,r.y),d[0]=new e.datavisualization.Diagram.Point(p[1].x,n.y),d[1]=new e.datavisualization.Diagram.Point(p[1].x,n.y+n.height),h[0]=new e.datavisualization.Diagram.Point(_.x,n.y),d[1]=new e.datavisualization.Diagram.Point(_.x,n.y+n.height)),g=[e.datavisualization.Diagram.Util.interSect2(l[0],l[1],d[0],d[1])],(c=[e.datavisualization.Diagram.Util.interSect2(l[0],l[1],h[0],h[1])]).length>0&&p.splice(2,0,c[0]),g.length>0&&p.splice(2,0,g[0])}for(u=1;u<p.length-1;)e.datavisualization.Diagram.Geometry.isEqualPoint(p[u-1],p[u])?p.splice(u,1):e.datavisualization.Diagram.Util.findAngle(p[u-1],p[u])==e.datavisualization.Diagram.Util.findAngle(p[u],p[u+1])?p.splice(u,1):u++;return p},t.prototype._updateMutualSharing=function(t,e){null!=t.identicalSibilings?t.identicalSibilings.push(e):(t.identicalSibilings=[],t.identicalSibilings.push(e))},t.prototype._groupLayoutCells=function(t){for(var i,a,n,o,s,r,l,d,h,g=t.model.ranks,c=g.length-1;c>=0;c--){for(i=[],a=0;a<g[c].length;a++)s=g[c][a],"internalVertex"===e.datavisualization.Diagram.MultiParentModel.prototype._getType(s.type)&&i.push(g[c][a]);for(n=[],o=0;o<g[c].length;o++)s=g[c][o],"internalEdge"===e.datavisualization.Diagram.MultiParentModel.prototype._getType(s.type)&&n.push(s);for(;i.length>1;){for(var u=i[0],m=this._selectIds(u.connectsAsTarget,!0),p=this._selectIds(u.connectsAsSource,!1);i.length>1;){var f=i[1],_=this._selectIds(f.connectsAsTarget,!0),v=this._selectIds(f.connectsAsSource,!1),y=this._compareLists(m,_),b=this._compareLists(p,v);if(!y||!b)break;this._updateMutualSharing(i[0],f.id),this._updateMutualSharing(i[1],u.id),i.splice(1,1)}i.splice(0,1)}for(;n.length>1;){var x=n[0],D=x.source,C=x.target;if(null!=D.identicalSibilings){for(r=[],d=0;d<n.length;d++)(l=n[d]).target==C&&r.push(l);for(d=0;d<r.length;d++)h=r[d],this._containsValue(D.identicalSibilings,h.source.id)&&(h.source.identicalSibilings=null);x.source.identicalSibilings=null}n.splice(0,1)}}},t.prototype._selectIds=function(t,e){for(var i,a=[],n=0;n<t.length;n++)i=t[n],e?a.push(i.source.id):a.push(i.target.id);return a},t.prototype._createMatrixCells=function(t){for(var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v=t.model.layout,y="lefttoright"==v.orientation||"righttoleft"==v.orientation,b=y?v.verticalSpacing:v.horizontalSpacing,x=y?v.horizontalSpacing:v.verticalSpacing,D=t.model.ranks,C=[],z=-x,S=D.length-1;S>=0;S--){var P=0,w=D.length-1-S,T=D[S].slice(),j=[];for(t.matrix.push({key:w,value:j}),i=[],C.push({index:w,value:i});T.length>0;)if(a=T[0],n=e.datavisualization.Diagram.MatrixCellGroup({level:w,parents:[],children:[],visitedParents:[],visitedChildren:[],ignoredChildren:[],cells:[],size:0,offset:0,initialOffset:0}),j.push(n),"internalVertex"===(s=e.datavisualization.Diagram.MultiParentModel.prototype._getType(a.type))){if(n.cells.push(a),null!=a.identicalSibilings)for(d=0;d<T.length&&(o=T[d],!("internalVertex"===(s=e.datavisualization.Diagram.MultiParentModel.prototype._getType(o.type))&&this._containsValue(a.identicalSibilings,o.id)&&(n.cells.push(o),n.cells.length>a.identicalSibilings.length)));d++);for(d=0;d<n.cells.length;d++)if(o=n.cells[d],"internalVertex"===(s=e.datavisualization.Diagram.MultiParentModel.prototype._getType(o.type))){if(r=o.cell.geometry,n.size+=y?r.height:r.width,P=Math.max(P,y?r.width:r.height),i.push({key:o.id,value:n}),o.connectsAsTarget.length>0)for(u=0;u<o.connectsAsTarget.length;u++)if(l=o.connectsAsTarget[u],m=null,this._containsValue(C[w-1].value,l.ids)?m=l.ids:this._containsValue(C[w-1].value,l.source.id)&&(m=l.source.id),null!=m){for(p=C[w-1].value,_=0;_<p.length;_++)if(p[_].key==m){f=p[_].value;break}this._containsValue(n.parents,f)||n.parents.push(f),this._containsValue(f.children,n)||f.children.push(n)}T.reverse(),T.pop(),T.reverse()}n.size+=(n.cells.length-1)*b}else if("internalEdge"===s){for(n.cells.push(a),d=0;d<n.cells.length;d++){if(h=n.cells[d],"internalEdge"===e.datavisualization.Diagram.MultiParentModel.prototype._getType(h.type)&&null!=h.edges){for(c=-(g=5),u=0;u<h.edges.length;u++)h.edges[u],c+=1+g;n.size+=c}if(i.push({key:h.ids,value:n}),m=null,this._containsValue(C[w-1].value,h.ids)?m=h.ids:this._containsValue(C[w-1].value,h.source.id)&&(m=h.source.id),null!=m){for(p=C[w-1].value,_=0;_<p.length;_++)if(p[_].key==m){f=p[_].value;break}this._containsValue(n.parents,f)||n.parents.push(f),this._containsValue(f.children,n)||f.children.push(n)}T.reverse(),T.pop(),T.reverse()}n.size+=(n.cells.length-1)*b}t.rowOffset.push(z+P/2+x),z+=P+x}},t.prototype._setXYforMatrixCell=function(t){for(var i,a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v=t.model.layout,y="lefttoright"==v.orientation||"righttoleft"==v.orientation,b=y?v.verticalSpacing:v.horizontalSpacing,x=0;x<t.matrix.length;x++)for(i=t.matrix[x].value,a=0;a<i.length;a++)for(o=(n=i[a]).offset-n.size/2,s=0;s<n.cells.length;s++)if(d=n.cells[s],"internalVertex"===(h=e.datavisualization.Diagram.MultiParentModel.prototype._getType(d.type))){var D=d,C=D.cell.geometry.width,z=D.cell.geometry.height;D.cell.geometry=y?new e.datavisualization.Diagram.Rectangle(t.rowOffset[n.level]-C/2,o,C,z):new e.datavisualization.Diagram.Rectangle(o,t.rowOffset[n.level]-z/2,C,z),o+=(y?z:C)+b}else if("internalEdge"===h){var S=d,P=n.visitedParents[0];for(_=0;_<P.visitedChildren.length;_++){for(r=P.visitedChildren[_],l=[],u=0;u<r.cells.length;u++)d=r.cells[u],"internalVertex"===(h=e.datavisualization.Diagram.MultiParentModel.prototype._getType(d.type))&&l.push(d);if(l.length>0){!0;break}}for(g=1,c=5,u=0;u<S.edges.length;u++){if(m=S.edges[u],p=new e.datavisualization.Diagram.Point(o+g/2,t.rowOffset[n.Level]),y&&(p=new e.datavisualization.Diagram.Point(t.rowOffset[n.level],o+g/2)),this._containsValue(this._getEdgeMapper(),m)){for(_=0;_<this._getEdgeMapper().length;_++)if(this._getEdgeMapper()[_].key==m){f=_;break}this._getEdgeMapper()[f].value.push(p)}o+=g+c}o+=b}},t.prototype._arrangeElements=function(t){var i,a,n,o,s,r,l,d,h,g=t.model.layout,c=g.orientation==e.datavisualization.Diagram.LayoutOrientations.LeftToRight||g.orientation==e.datavisualization.Diagram.LayoutOrientations.RightToLeft,u=c?g.verticalSpacing:g.horizontalSpacing;c?g.horizontalSpacing:g.verticalSpacing;for(this._groupLayoutCells(t),this._createMatrixCells(t),o=0;o<t.matrix.length;o++)for(i=t.matrix[o].key,a=t.matrix[i].value,d=1;d<a.length;d++)h=a[d],n=a[d-1],h.offset+=n.offset+n.size/2+u+h.size/2;for(o=0;o<t.matrix[0].value.length;o++)s=t.matrix[0].value[o],this._arrangeMatrix(s,null,t);for(r=0;r<t.matrix.length;r++)for(l=t.matrix[r].value,d=0;d<l.length;d++)if((h=l[d]).visitedParents.length>1){var m=h.visitedParents[0],p=h.visitedParents[h.visitedParents.length-1],f=this._findParentVertexCellGroup(m),_=this._findParentVertexCellGroup(p);m!=f&&f.offset<m.offset&&(m=f),p!=_&&_.offset>p.offset&&(p=f);var v=(m.offset+p.offset)/2,y=h.initialOffset,b=h.offset;b==y||(v>=y&&v<=b?this._translateMatrixCells(v-h.offset,h):v<y&&this._translateMatrixCells(y-h.offset,h))}this._setXYforMatrixCell(t)},t.prototype._findParentVertexCellGroup=function(t){return t.cells[0]?t:t.parents.length>0?this._findParentVertexCellGroup(t.parents[0]):t},t.prototype._translateMatrixCells=function(t,e){var i,a;if(0!=t&&(e.offset+=t,e.visitedChildren.length>0))for(i=0;i<e.visitedChildren.length;i++)a=e.visitedChildren[i],this._translateMatrixCells(t,a)},t.prototype._arrangeMatrix=function(t,e,i){var a,n,o,s,r,l,d=i.model.layout,h="lefttoright"==d.orientation||"righttoleft"==d.orientation?d.verticalSpacing:d.horizontalSpacing,g=i.matrix[t.level].value,c=g.indexOf(t);if(t.visitedParents.length>0&&(1==t.visitedParents.length&&(t.initialOffset=t.offset),c+1<g.length&&(g[c+1].visitedParents.length>0&&!this._containsValue(t.visitedParents,e))))return t.visitedParents.push(e),void e.ignoredChildren.push(t);if(t.children.length>0){for(r=0;r<t.children.length;r++)o=t.children[r],this._containsValue(t.visitedChildren,o)||(this._arrangeMatrix(o,t,i),t.visitedChildren.push(o));if(t.visitedChildren.length>0){for(s=t.visitedChildren.slice(),r=0;r<t.ignoredChildren.length;r++)l=t.ignoredChildren[r],s.splice(r,1,l);if(s.length>0){var u=t.visitedChildren[0],m=t.visitedChildren[t.visitedChildren.length-1],p=(u.offset-u.size/2+(m.offset+m.size/2))/2;p<t.offset?this._shiftMatrixCells(t.offset-p,u,!0,t,i):p>t.offset&&this._shiftMatrixCells(p-t.offset,t,!1,null,i)}}}else a=t.offset,c>0&&(a=(n=g[c-1]).offset+n.size/2+h+t.size/2),this._shiftMatrixCells(a-t.offset,t,!1,null,i);this._containsValue(t.visitedParents,e)||t.visitedParents.push(e)},t.prototype._shiftMatrixCells=function(t,e,i,a,n){var o,s,r;if(0!=t){var l=n.matrix[e.level].value,d=l.indexOf(e);for(o=d;o<l.length;o++)l[o].offset+=t;if(i)if(e.visitedChildren.length>0)this._shiftMatrixCells(t,e.visitedChildren[0],!0,e,n);else{for(o=1,s=null;d+o<l.length;){if(r=l[d+o],null!=a&&this._containsValue(r.visitedParents,a)){if(!(r.visitedChildren.length>0)){o++;continue}s=r}break}null!=s&&this._shiftMatrixCells(t,s.visitedChildren[0],!0,s,n)}}},t.prototype._compareLists=function(t,e){var i,a,n,o,s=t.slice(),r=e.slice();if(s.length==r.length){if(0==s.length)return!0;for(i=!0,a=0;a<r.length;a++)for(n=r[a],o=a;o<s.length;o++)if(s[o]!=n){i=!1;break}return i}return!1},t}(),e.datavisualization.Diagram.LineDistribution=n,e.datavisualization.Diagram.ConnectorObstacleDefaults={wrapper:null,segments:[]},e.datavisualization.Diagram.ConnectorObstacle=function(i){return i.wrapper=i.wrapper,i.segments=i.segments,t.extend(!1,{},e.datavisualization.Diagram.ConnectorObstacleDefaults,i)},e.datavisualization.Diagram.ObstacleSegmentDefaults={start:Number,end:Number,coord:Number,direction:null,distance:Number,orientation:null,id:Number,startpoint:e.datavisualization.Diagram.Point,endpoint:e.datavisualization.Diagram.Point},e.datavisualization.Diagram.ObstacleSegment=function(i){return i.direction=e.datavisualization.Diagram.Util._getBezierDirection(i.startpt,i.endpt),i.distance=e.datavisualization.Diagram.Util.findLength(i.startpt,i.endpt),i.orientation="left"==i.direction||"right"==i.direction?"horizontal":"vertical",i.id=i.id,"horizontal"==i.orientation?(i.coord=i.startpt.y,"left"==i.direction?(i.start=i.endpt.x,i.end=i.startpt.x):(i.start=i.startpt.x,i.end=i.endpt.x)):(i.coord=i.startpt.x,"top"==i.direction?(i.start=i.endpt.y,i.end=i.startpt.y):(i.start=i.startpt.y,i.end=i.endpt.y)),t.extend(!1,{},e.datavisualization.Diagram.ObstacleSegmentDefaults,i)},e.datavisualization.Diagram.MatrixModelDefaults={model:null,matrix:[],rowOffset:[]},e.datavisualization.Diagram.MatrixModel=function(i){return i.model=i.model,i.matrix=i.matrix||[],i.rowOffset=i.rowOffset||[],t.extend(!1,{},e.datavisualization.Diagram.MatrixModelDefaults,i)},e.datavisualization.Diagram.MatrixCellGroupDefaults={parents:[],children:[],visitedParents:[],visitedChildren:[],ignoredChildren:[],cells:[],size:Number,offset:Number,level:Number,initialOffset:Number},e.datavisualization.Diagram.MatrixCellGroup=function(i){return i.level=i.level,i.parents=i.parents,i.children=i.children,i.visitedChildren=i.visitedChildren,i.visitedParents=i.visitedParents,i.ignoredChildren=i.ignoredChildren,i.cells=i.cells,i.offset=i.offset,i.initialOffset=i.initialOffset,t.extend(!1,{},e.datavisualization.Diagram.MatrixCellGroupDefaults,i)}}(jQuery,Syncfusion);var SizeF=function(){return function(t,e){this.width=t,this.height=e}}(),GraphForceNode=function(){function t(t){this.m_fVelocityX=0,this.m_fVelocityY=0,this.nodes=[],this.velocityX=this.m_fVelocityX,this.velocityY=this.m_fVelocityY,this.graphNode=t;var e=ej.datavisualization.Diagram.Util.bounds(t);this.location=e._center,this.nodes=[],t._parents||(t._parents=[]),t._children||(t._children=[]),this.nodes=t._parents.concat(t._children)}return t.prototype.ApplyChanges=function(){this.graphNode._center=this.location},t}(),SymmetricLayoutManager=function(){function t(e){this.m_szMaxForceVelocity=new SizeF(t.c_fMAX_VELOCITY,t.c_fMAX_VELOCITY),this.m_fVertexDistance=0,this.m_dSpringFactor=t.c_dCOEF,this.m_nMaxIteraction=t.c_nMAX_ITERACTION,this.SpringLength=this.m_fVertexDistance,this.SpringFactor=this.m_dSpringFactor,this.MaxIteraction=this.m_nMaxIteraction,this.selectedNode=this.m_objSelectedNode,this.m_fVertexDistance=e.model.layout.springLength,this.m_dSpringFactor=e.model.layout.springFactor,this.m_nMaxIteraction=e.model.layout.maxIteration}return t.prototype.doGraphLayout=function(t){var e,i,a=this.selectedNode;this.diagram=t.diagram,a.Bounds=t._getModelBounds(this.diagram.nodes());var n=a.GraphNodes,o=this._convertGraphNodes(n),s=o.length;for(s=Math.min(this.m_nMaxIteraction,s*s*s),this._preLayoutNodes(o,a.Bounds),e=0,i=s;e<i;e++)this._makeSymmetricLayout(o),this._appendForces(o);this._resetGraphPosition(o,a)},t.prototype._preLayoutNodes=function(t,e){for(var i,a=Math.max(e?e.width:25,e?e.height:25),n={x:a/2,y:a/2},o=2*Math.PI/t.length,s=o,r=0;r<t.length;r++)i=t[r],this._getForceNode(i).location={x:n.x+a*Number(Math.cos(s).toFixed(2)),y:n.y+a*Number(Math.sin(s).toFixed(2))},s-=o},t.prototype.DoLayout=function(t){this.selectedNode=t.selectedNode,this.doGraphLayout(t)},t.prototype._collectionContains=function(t,e){for(var i=0;i<e.length;i++)if(e[i].name===t)return!0},t.prototype._makeSymmetricLayout=function(t){for(var e,i,a,n,o,s,r,l,d,h=0;h<t.length;h++){for(e=t[h],i=(l=this._getForceNode(e)).nodes,a=0;a<i.length;a++)r=i[a],this._collectionContains(r.name,t)&&this._calcNodesForce(l,this._getForceNode(r));for(n=0,o=i.length;n<o&&!(o<2);n++){var g=this._getForceNode(i[n]),c=n+1>=o?this._getForceNode(i[0]):this._getForceNode(i[n+1]),u=180/i.length*Math.PI/180,m=2*this.m_fVertexDistance*Math.sin(u);this._calcRelatesForce(g,c,m)}for(s=0;s<t.length;s++)r=t[s],this._collectionContains(r.name,i)||r.name===e.name||(d=this._getForceNode(r),this._updateNeigbour(l,d))}},t.prototype._appendForces=function(t){for(var e,i,a=null,n=0;n<t.length;n++)e=t[n],(i=(a=this._getForceNode(e)).location).x+=Math.min(a.velocityX,this.m_szMaxForceVelocity.width),i.y+=Math.min(a.velocityY,this.m_szMaxForceVelocity.height),a.velocityX=0,a.velocityY=0,a.location=i},t.prototype._resetGraphPosition=function(t,e){for(var i,a,n=new SizeF(Number.MAX_VALUE,Number.MAX_VALUE),o=null,s=0;s<t.length;s++)i=t[s],a={x:(o=this._getForceNode(i)).location.x-i.width/2,y:o.location.y-i.height/2},n.width=Math.min(n.width,a.x),n.height=Math.min(n.height,a.y);for(s=0;s<t.length;s++)i=t[s],(a=(o=this._getForceNode(i)).location).x-=n.width-e.location?e.location.x:0,a.y-=n.height-e.location?e.location.y:0,o.location=a,o.ApplyChanges()},t.prototype._convertGraphNodes=function(t){var e,i,a,n=[];for(e in t)t[e]&&(i=t[e],a=new GraphForceNode(i),i._tag=a,n.push(i));return n},t.prototype._getForceNode=function(t){return t._tag},t.prototype._updateNeigbour=function(t,e){if(null!=e&&null!=t){var i=this._pointDistance(t.location,e.location),a=this._lineAngle(t.location,e.location),n=.9*this.m_fVertexDistance;i<n&&this._calcForce(i,n,a,e)}},t.prototype._lineAngle=function(t,e){var i=0,a=e.x-t.x,n=e.y-t.y;return 0===a?i=n<=0?3*Math.PI/2:Math.PI/2:0===n?i=a<0?Math.PI:0:(i=Math.atan(n/a),a<0&&n>0?i=Math.PI+i:a<0&&n<0?i=Math.PI+i:a>0&&n<0&&(i=2*Math.PI+i)),i},t.prototype._pointDistance=function(t,e){var i=0,a=e.x-t.x,n=e.y-t.y,o=a*a+n*n;return o>0&&(i=Math.sqrt(o)),i},t.prototype._calcRelatesForce=function(t,e,i){var a=this._pointDistance(t.location,e.location),n=this._lineAngle(t.location,e.location);a<i&&this._calcForce(a,i,n,e)},t.prototype._calcNodesForce=function(t,e){var i=this._pointDistance(t.location,e.location),a=this._lineAngle(t.location,e.location);(i>this.m_fVertexDistance||i<this.m_fVertexDistance)&&this._calcForce(i,this.m_fVertexDistance,a,e)},t.prototype._calcForce=function(t,e,i,a){var n=a.nodes.length,o=t-e,s=this.m_dSpringFactor/(n*n)*Math.sqrt(n);if(0!==o){var r=o*s,l=Math.cos(i)*r,d=Math.sin(i)*r;a.velocityX-=l,a.velocityY-=d}},t.c_dCOEF=.442,t.c_fMAX_VELOCITY=50,t.c_nMAX_ITERACTION=1e3,t.c_nSPRING_LENGTH=100,t}(),GraphLayoutManager=function(){function t(){this.visitedStack=[],this.cycleEdgesCollection=[],this.passedNodes={}}return t.prototype.updateLayout=function(t,e){var i,a,n,o,s,r,l;for(this.diagram=t,(i=t.nodes()).length>0&&(this.m_helperSelectedNode=$.extend(!0,{},i[0])),a=[],n=0;n<t.nodes().length;n++)a.push(t.nodes()[n]);for(n=0;n<t.connectors().length;n++)a.push(t.connectors()[n]);for(this._updateLayout1(a,e),o=this._getModelBounds(t.nodes()),s=ej.datavisualization.Diagram.ScrollUtil._viewPort(t,!0),n=0;n<t.nodes().length;n++){var d=t.nodes()[n],h=(s.width-o.width)/2,g=t.model.layout.margin||{};g.left=g.left||0,g.right=g.right||0,g.top=g.top||0,g.bottom=g.bottom||0,t.model.layout.marginX&&(g.left=t.model.layout.marginX),t.model.layout.marginY&&(g.top=t.model.layout.marginY),r=d._tag.location.x-(d.offsetX-d.width/2)-o.x+h+g.left,l=d._tag.location.y-(d.offsetY-d.height/2)-o.y+g.top,this.diagram._translate(d,r,l,t.nameTable),delete d._tag,delete d._center,delete d._children,delete d._isCycleEdge,delete d._parents,this.diagram._isInit||ej.datavisualization.Diagram.DiagramContext.update(d,this.diagram)}},t.prototype._getModelBounds=function(t){var e,i,a,n,o;for(t=t.slice(),e=null,i=null,n=0;n<t.length;n++)a=t[n],o=ej.datavisualization.Diagram.Util.bounds(a),e={x:a._tag?a._tag.location.x:o.x,y:a._tag?a._tag.location.y:o.y,width:a.width,height:a.height},i=i?ej.datavisualization.Diagram.Geometry.union(i,e):e;return i},t.prototype._updateLayout1=function(t,e){var i,a,n;if(this._detectCyclesInGraph(t),(i=t.length)>0){var o=[],s=[],r=[];for(a=0;a<t.length;a++)void 0===(n=t[a])._isCycleEdge&&(n._isCycleEdge=!1),n.segments&&!n._isCycleEdge?s.push(n):n.segments?o.push(n):r.push(n);for(s=s.concat(r),s=o.concat(s);i>this._dictionaryLength(this.passedNodes);)this._getNodesToPosition(s),null!=this.selectedNode&&(e.DoLayout(this),this.selectedNode=null,this.visitedStack=[],this.cycleEdgesCollection.forEach(function(t){t._isCycleEdge=!1}));this.passedNodes=null,this.selectedNode=null}return!1},t.prototype._getNodesToPosition=function(t){for(var e,i=0;i<t.length;i++)if(e=t[i],!this._collectionContains(e.name,this.passedNodes)){e&&this._selectNodes(e);break}},t.prototype._selectNodes=function(t){var e=t;t.segments?this._exploreGraphEdge(t):null!=e&&this._addNode(t,"passed")&&(this._addNode(t,"selected"),this._isConnectedToAnotherNode(e)?(this.selectedNode={},this.selectedNode.LeftMargin=10,this.selectedNode.TopMargin=10,this._selectConnectedNodes(e)):this.selectedNode=t)},t.prototype._selectConnectedNodes=function(t){var e,i,a,n,o=this.selectedNode;o.GraphNodes||(o.GraphNodes={}),null!=(e=t)&&this._addNode(e,"passed")&&(i=e.name,this._dictionaryContains(o.GraphNodes,e)?(n=o.GraphNodes[i]).Added&&(n.Added=!1,this._getConnectedRelatives(n),this._exploreRelatives(t)):(a=this._addGraphNode(e),this._getConnectedRelatives(a),this._exploreRelatives(t)))},t.prototype._exploreRelatives=function(t){this._exploreRelatives1(t,"Parents"),this._exploreRelatives1(t,"Children")},t.prototype._exploreRelatives1=function(t,e){var i,a,n,o,s=[];for("Parents"===e?s=t.inEdges:"Children"===e&&(s=t.outEdges),i=0;i<s.length;i++)a=this.diagram.nameTable[s[i]],this._addNode(a,"passed")&&(n=this.diagram.nameTable[a.sourceNode],o=this.diagram.nameTable[a.targetNode],"Parents"===e&&null!=n&&this._collectionContains(n.name,this.diagram.nodes())?this._selectConnectedNodes(this.diagram.nameTable[a.sourceNode]):"Children"===e&&null!=o&&this._collectionContains(o.name,this.diagram.nodes())&&this._selectConnectedNodes(this.diagram.nameTable[a.targetNode]))},t.prototype._getConnectedRelatives=function(t){this._getConnectedParents(t),this._getConnectedChildren(t)},t.prototype._dictionaryContains=function(t,e){for(var i=Object.keys(t),a=0;a<i.length;a++)if(t[i[a]].name===e.name)return!0;return!1},t.prototype._dictionaryLength=function(t){return Object.keys(t).length},t.prototype._getConnectedChildren=function(t){for(var e,i,a,n=this.selectedNode,o=t,s=0;s<o.outEdges.length;s++)(e=this.diagram.nameTable[o.outEdges[s]])._isCycleEdge||(i=this.diagram.nameTable[e.targetNode],this._collectionContains(i.name,this.diagram.nodes())&&null!=i&&i.visible&&(this._dictionaryContains(n.GraphNodes,i)?a=n.GraphNodes[i.name]:(a=this._addGraphNode(i)).Added=!0,t._children||(t._children=[]),a._parents||(a._parents=[]),this._setNode(a._parents,t),this._findNode(t._children,a.name)<0&&t._children.push(a)))},t.prototype._getConnectedParents=function(t){for(var e,i,a,n=this.selectedNode,o=t,s=0;s<o.inEdges.length;s++)(e=this.diagram.nameTable[o.inEdges[s]])._isCycleEdge||(i=this.diagram.nameTable[e.sourceNode],this._collectionContains(i.name,this.diagram.nodes())&&null!=i&&i.visible&&(this._dictionaryContains(n.GraphNodes,i)?a=n.GraphNodes[i.name]:(a=this._addGraphNode(i)).Added=!0,t._parents||(t._parents=[]),a._children||(a._children=[]),this._setNode(a._children,t),this._findNode(t._parents,a.name)<0&&t._parents.push(a)))},t.prototype._setNode=function(t,e){var i=this._findNode(t,e.name);i>=0&&i<t.length?t[i]=e:t.push(e)},t.prototype._findNode=function(t,e){var i,a,n,o=-1;if(null!=t&&""!==e)for(i=0,a=t.length;i<a;i++){if("string"==typeof(n=t[i])&&n===e){o=i;break}if(null!=n&&n.name===e){o=i;break}}return o},t.prototype._addGraphNode=function(t){var e,i,a=this.selectedNode;return a.GraphNodes||(a.GraphNodes={}),e=t,null!=a&&(a.GraphNodes[e.name]=e,null!=(i=this.m_helperSelectedNode)&&t.name===i.name&&(this.m_helperSelectedNode=e)),e},t.prototype._isConnectedToAnotherNode=function(t){var e=!1;return t.inEdges.concat(t.outEdges).length>0&&(null!=t.inEdges&&t.inEdges.length>0&&(e=this._searchEdgeCollection(t.inEdges,"FromNode")),!e&&null!=t.outEdges&&t.outEdges.length>0&&(e=this._searchEdgeCollection(t.outEdges,"ToNode"))),e},t.prototype._searchEdgeCollection=function(t,e){for(var i,a=!1,n=0;n<t.length-1;n++)if(i=this.diagram.nameTable[t[n]],this._addNode(i,"passed")&&!i._isCycleEdge&&("FromNode"===e&&null!=this.diagram.nameTable[i.sourceNode]||"ToNode"===e&&null!=this.diagram.nameTable[i.targetNode])){a=!0;break}return a},t.prototype._exploreGraphEdge=function(t){var e,i,a=t;null!=a&&!a._isCycleEdge&&this._addNode(t,"passed")&&(this._addNode(t,"selected"),e=this.diagram.nameTable[a.sourceNode],i=this.diagram.nameTable[a.targetNode],null!=e?this._selectNodes(e):null!=i?this._selectNodes(i):this.selectedNode=t)},t.prototype._addNode=function(t,e){var i=t;return"passed"!==e&&i.visible||this._dictionaryContains(this.passedNodes,i)||(this.passedNodes[i.name]=i),!!i.visible},t.prototype._detectCyclesInGraph=function(t){for(var e,i,a,n,o=[],s=[],r=0;r<t.length;r++)t[r].segments||o.push(t[r]);if(o.length>0)for(s.push(o[0]),this.visitedStack.push(o[0]);s.length>0;)e=s[s.length-1],(i=this._getUnVisitedChildNodes(e)).length>0?(a=i[0],n=i[i.length-1],this._collectionContains(a.name,this.visitedStack)?(n._isCycleEdge=!0,this.cycleEdgesCollection.push(n)):(s.push(a),this.visitedStack.splice(0,0,a))):s.pop()},t.prototype._getUnVisitedChildNodes=function(t){var e,i,a,n=[];if(t.outEdges.length>0){for(e=0;e<t.outEdges.length;e++)if(i=this.diagram.nameTable[t.outEdges[e]],!this._collectionContains(i.name,this.visitedStack))return null!=(a=this.diagram.nameTable[i.targetNode])&&n.push(a),n.push(i),this.visitedStack.splice(0,0,i),n;return n}return n},t.prototype._collectionContains=function(t,e){for(var i=0;i<e.length;i++)if(e[i].name===t)return!0},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ConnectionEnd;(function(t){t[t.Source=0]="Source",t[t.Target=1]="Target"})(ConnectionEnd||(ConnectionEnd={})),function(t){t[t.ImmediateLoading=0]="ImmediateLoading",t[t.DelayedDiagramLoading=1]="DelayedDiagramLoading",t[t.DelayedConnectorLoading=2]="DelayedConnectorLoading"}(LoadingPriority||(LoadingPriority={})),function(t){t[t.Routing=0]="Routing",t[t.Performance=1]="Performance",t[t.Default=2]="Default"}(RoutingPriority||(RoutingPriority={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(SegmentOrientation||(SegmentOrientation={})),function(t){t[t.Low=0]="Low",t[t.High=1]="High"}(ObstacleSideType||(ObstacleSideType={})),function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Top=3]="Top",t[t.Bottom=4]="Bottom"}(PortDirection||(PortDirection={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(Orientation||(Orientation={})),function(t){t[t.Right=0]="Right",t[t.Top=1]="Top"}(ScanDirection||(ScanDirection={})),function(t){t[t.Quick=0]="Quick",t[t.Best=1]="Best"}(RoutingSolution||(RoutingSolution={})),function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.East=2]="East",t[t.South=4]="South",t[t.West=8]="West"}(Directions||(Directions={}));var Utility=function(){function t(){}return t.ToRoundedInt=function(t){return Math.round(t)},t.IntersectionWithRectangleBorder=function(e,i,a){switch(a){case Directions.North:case Directions.South:return new Point(t.ToRoundedInt(i.x),this.GetRectangleEdge(e,a));case Directions.East:case Directions.West:return new Point(this.GetRectangleEdge(e,a),t.ToRoundedInt(i.y))}return new Point},t.GetRectangleEdge=function(t,e){switch(e){case Directions.East:return t.right();case Directions.West:return t.left();case Directions.North:return t.bottom();case Directions.South:return t.top()}return 0},t.GetLengthFromListOfPoints=function(t){for(var e,i=0,a=t.get(0),n=0;n<t.size();n++)e=t.get(n),i+=Extensions.FindDistance(a,e,Extensions.GetOrientation(a.FindDirection(e))),a=e;return Number(i.toFixed(4))},t.GetIntersections=function(t,e){for(var i,a,n,o=new PointList,s=new Point,r=e,l=!1;null!=r&&0==l;r=r.getNext())i=(n=this.CrossTwoLineSegs(t.StartPoint,t.EndPoint,r.Point,r.getNext().Point,0,1,0,1,i,a,s)).aSolution,a=n.bSolution,s=n.x,n.crossToLines&&(this.OldIntersection(s,o)||o.add(s)),0,r.getNext()==e&&(l=!0);return o},t.OldIntersection=function(t,e){for(var i=0;i<e.size();i++)if(t.equals(e.get(i)))return!0;return!1},t.CrossTwoLineSegs=function(t,e,i,a,n,o,s,r,l,d,h){var g,c=e.subtract(t),u=i.subtract(a),m=i.subtract(t),p=this.Solve(c.x,u.x,m.x,c.y,u.y,m.y,l,d),f=p.solve;return l=p.x,d=p.y,g=!1,h=t.add(c.multiplyFactor(l)),f&&(l<n&&(g=!1),(l=Math.max(l,n))>o&&(g=!1),l=Math.min(l,o),d<s&&(g=!1),(d=Math.max(d,s))>r&&(g=!1),d=Math.min(d,r),g=!0),{crossToLines:g,aSolution:l,bSolution:d,x:h}},t.Solve=function(t,e,i,a,n,o,s,r){var l=t*n-a*e;return Math.abs(l)<1e-5?{solve:!1,x:r=0,y:r}:{solve:!0,x:(i*n-o*e)/l,y:r=(t*o-a*i)/l}},t.CheckWithScanDirection=function(t,e,i){return t==ScanDirection.Right?e.FindDirection(i)==Directions.East:e.FindDirection(i)==Directions.North},t.SegmentIntersects=function(t,e,i){var a=this.IntervalsIntersects(t,e,i);return{isInterSect:a.isInterSect,intersect:a.intersect}},t.IntervalsIntersects=function(t,e,i){return i=this.FindIntersection(t.StartPoint,t.EndPoint,e.StartPoint),{isInterSect:t.Contains(i)&&e.Contains(i),intersect:i}},t.FindIntersection=function(t,e,i){var a=t.FindDirection(e);return Extensions.IsVertical(a)?new Point(t.x,i.y):new Point(i.x,t.y)},t.AreEquivalentLines=function(t,e){return!!(t.StartPoint.equals(e.StartPoint)&&t.EndPoint.equals(e.EndPoint)||t.StartPoint.equals(e.EndPoint)&&t.EndPoint.equals(e.StartPoint))},t.ListOrderBy=function(t,e){return t.sort(function(t,i){return t.key>i.key||t[e]<i[e]?1:t[e]<i[e]||t[e]>i[e]?-1:0})},t.OrderBy=function(t,e){return t.items.sort(function(t,i){return t._outerBounds[e]()<i._outerBounds[e]()?-1:t._outerBounds[e]()>i._outerBounds[e]()?1:0})},t.OrderByDescending=function(t,e){return t.items.sort(function(t,i){return t._outerBounds[e]()>i._outerBounds[e]()?-1:t._outerBounds[e]()<i._outerBounds[e]()?1:0})},t.ToList=function(t){var e,i=new List,a=Object.keys(t);for(a.sort(function(t,e){return t-e}),e=0;e<a.length;e++)i.add(t[a[e]]);return i},t}(),Extensions=function(){function t(){}return t.Left=function(t){switch(t){case Directions.None:return Directions.None;case Directions.North:return Directions.West;case Directions.East:return Directions.North;case Directions.South:return Directions.East;case Directions.West:return Directions.South}},t.Right=function(t){switch(t){case Directions.None:return Directions.None;case Directions.North:return Directions.East;case Directions.East:return Directions.South;case Directions.South:return Directions.West;case Directions.West:return Directions.North;default:return Directions.None}},t.Contains=function(t,e){return 0!=(e&t)},t.ToIndex=function(t){switch(t){case Directions.North:return 0;case Directions.East:return 1;case Directions.South:return 2;case Directions.West:return 3}},t.IsAscending=function(t){return t!=Directions.South&&t!=Directions.West},t.IsAscending_Direction=function(t){return t!=PortDirection.Left&&t!=PortDirection.Top},t.IsVertical=function(t){return t!=Directions.East&&t!=Directions.West},t.GetOrientation_PortDirection=function(t){switch(t){case PortDirection.Right:case PortDirection.Left:return Orientation.Horizontal;case PortDirection.Top:case PortDirection.Bottom:return Orientation.Vertical}return Orientation.None},t.GetOrientation=function(t){switch(t){case Directions.East:case Directions.West:return Orientation.Horizontal;case Directions.North:case Directions.South:return Orientation.Vertical}return Orientation.None},t.OppositeDirection_Port=function(t){switch(t){case PortDirection.Right:return PortDirection.Left;case PortDirection.Left:return PortDirection.Right;case PortDirection.Top:return PortDirection.Bottom;case PortDirection.Bottom:return PortDirection.Top}return PortDirection.None},t.OppositeDirection=function(t){switch(t){case Directions.North:return Directions.South;case Directions.West:return Directions.East;case Directions.South:return Directions.North;case Directions.East:return Directions.West;default:return Directions.None}},t.IsPureDirection=function(t){switch(t){case Directions.North:case Directions.East:case Directions.South:case Directions.West:return!0;default:return!1}},t.OppositeDirection_Direction=function(t){switch(t){case Directions.North:return Directions.South;case Directions.West:return Directions.East;case Directions.South:return Directions.North;case Directions.East:return Directions.West;default:return Directions.None}},t.OppositeOrientation=function(t){return t==Orientation.Horizontal?Orientation.Vertical:Orientation.Horizontal},t.ToAngle=function(t){switch(t){case Directions.East:return 0;case Directions.North:return 90;case Directions.West:return 180;case Directions.South:return 270}return 0},t.GetEquivalentDirection=function(t){switch(t){case PortDirection.Right:return Directions.East;case PortDirection.Left:return Directions.West;case PortDirection.Bottom:return Directions.North;case PortDirection.Top:return Directions.South}return Directions.None},t.FindDirection=function(t,e){var i=Directions.None,a=t.x,n=t.y,o=e.x,s=e.y;return a!=o&&(i=o>a?Directions.East:Directions.West),n!=s&&(i=s>n?i|Directions.North:i|Directions.South),i},t.FindDirection_orientation=function(t,e,i){var a,n,o=Directions.None;return i==Orientation.Horizontal?(a=e.x-t.x)>0?o=Directions.East:a<0&&(o=Directions.West):(n=e.y-t.y)>0?o|=Directions.North:n<0&&(o|=Directions.South),o},t.ManhattanDistance=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},t.FindDistance=function(t,e,i){return i==Orientation.Horizontal?Math.abs(t.x-e.x):Math.abs(t.y-e.y)},t.Transform=function(t,e,i){var a=this.ToAngle(i);return new Point(Number(Math.round(t.x+e*Math.cos(a*Math.PI/180)).toFixed(4)),Number(Math.round(t.y+e*Math.sin(a*Math.PI/180)).toFixed(4)))},t.VectorDirection=function(t){var e=1e-4,i=Directions.None;return t.x>e?i=Directions.East:t.x<-e&&(i=Directions.West),t.y>e?i|=Directions.North:t.y<-e&&(i|=Directions.South),i},t.GetLengthFromListOfPoints=function(e){for(var i,a=0,n=e.get(0),o=0;o<e.size();o++)i=e.get(Number(o)),a+=t.FindDistance(n,i,t.GetOrientation(t.FindDirection(n,i))),n=i;return Number(a.toFixed(4))},t.CompareTo=function(t,e){if(t<e)return-1;if(t>e)return 1;if(t!=e){if(!isNaN(t))return 1;if(!isNaN(e))return-1}return 0},t.FindDirectionOrientation=function(t,e,i){var a,n,o=Directions.None;return i==Orientation.Horizontal?(a=e.x-t.x)>0?o=Directions.East:a<0&&(o=Directions.West):(n=e.y-t.y)>0?o=o||Directions.North:n<0&&(o=o||Directions.South),o},t.add=function(t,e,i,a){var n={key:e,value:i};return t[Object.keys(t).length]=n,a||"object"==typeof t[0].key||this.sortOnKeys(t),t},t.sortOnKeys=function(e){var i,a,n,o,s,r,l,d,h=[];for(o in e)h[h.length]=e[o].key;for(h.sort(function(t,e){return t-e}),i=$.extend(!1,{},e),a=Object.keys(e),n=0;n<a.length;n++)e[o=a[n]]&&delete e[o];for(s=0;s<h.length;s++)for(r=Object.keys(i),l=0;l<r.length;l++)(d=i[r[l]]).key==h[s]&&t.add(e,h[s],d.value,!0);return e},t.getFromDictionary123=function(t,e){for(var i,a=Object.keys(t),n=0;n<a.length;n++)if("object"===typeof(i=t[a[n]]).key)if(i.key&&i.key.x&&i.key.y){if(i.key.x===e.x&&i.key.y===e.y)return i.value}else if(i.key.name&&e.name&&i.key.name===e.name)return i.value;return null},t.getFromDictionary=function(t,e,i){var a,n,o;if("number"!==(i||typeof e))return this.getFromDictionary123(t,e);for(a=Object.keys(t),n=0;n<a.length;n++)if((o=t[a[n]]).key==e)return o.value;return null},t.ElementAt=function(t,e){var i=Object.keys(t),a=t[i[e]];return a?a.value?t[i[e]].value:t[i[e]]:null},t.KeytAt=function(t,e){var i=Object.keys(t);return t[i[e]]?t[i[e]].key:null},t.Clear=function(){return{}},t.IndexOfKey=function(t,e){for(var i,a,n=Object.keys(t),o=-1,s=0;s<n.length;s++)if(o++,"string"==(i=typeof e)||"number"==i){if(t[n[s]].key===e)return o}else if("object"===typeof(a=t[n[s]]).key&&a.key&&a.key.x&&a.key.y&&a.key.x===e.x&&a.key.y===e.y)return o;return-1},t.Count=function(t){return Object.keys(t).length},t.ContainsKey=function(t,e){var i,a,n,o=typeof e;if("string"==o||"number"==o){for(i=Object.keys(t),a=0;a<i.length;a++)if((n=t[i[a]]).key==e)return!0}else if("object"==o&&e&&e.x&&e.y)for(i=Object.keys(t),a=0;a<i.length;a++)if("object"==typeof(n=t[i[a]]).key&&n.key&&n.key.x&&n.key.y&&n.key.x===e.x&&n.key.y===e.y)return!0;return!1},t.ReAlignDictionary=function(e){var i,a,n,o,s,r,l=Object.keys(e);if(l.length>0&&("string"==(i=typeof e[l[0]].key)||"number"==i)){for(a=$.extend(!1,{},e),n=0;n<l.length;n++)e[o=l[n]]&&delete e[o];for(s=Object.keys(a),r=0;r<s.length;r++)t.add(e,a[s[r]].key,a[s[r]].value,!0)}return e},t.Remove=function(t,e,i){var a,n,o,s;if(void 0!=i){if(t[i])return delete t[i],this.ReAlignDictionary(t),!0}else for(n=Object.keys(t),o=0;o<n.length;o++)if(s=t[n[o]],"string"==(a=typeof e)||"number"==a){if(s.key==e)return delete t[n[o]],this.ReAlignDictionary(t),!0}else if(e&&e.x&&e.y)for(n=Object.keys(t),o=0;o<n.length;o++)if("object"==typeof(s=t[n[o]]).key&&s.key&&s.key.x&&s.key.y&&s.key.x===e.x&&s.key.y===e.y)return delete t[n[o]],t[n[o]],this.ReAlignDictionary(t),!0;return!1},t}(),Point=function(){function t(t,e){this.x=0,this.y=0,this.x=t||0,this.y=e||0}return t.equals=function(t,e){return t===e||!(!t||!e)&&(!t||!e||t.x===e.x&&t.y===e.y)},t.prototype.equals=function(t){return t===this||!(!t||!this)&&(!t||!this||t.x===this.x&&t.y===this.y)},t.prototype.OperatorNotEqual=function(t){return 0!=this.CompareTo(t)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.multiplyFactor=function(e){return new t(this.x*e,this.y*e)},t.prototype.distance=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.transform=function(t,e,i){var a={x:0,y:0};return a.x=Number(((t.x+i*Math.cos(e*Math.PI/180))/1).toFixed(4)),a.y=Number(((t.y+i*Math.sin(e*Math.PI/180))/1).toFixed(4)),a},t.findLength=function(t,e){var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));return Number(i.toFixed(4))},t.findAngle=function(t,e){var i=Math.atan2(e.y-t.y,e.x-t.x);return i=180*i/Math.PI,(i%=360)<0&&(i+=360),i},t.distancePoints=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},t.prototype.OperatorLessThan=function(t){return this.CompareTo(t)<0},t.prototype.OperatorGreaterThan=function(t){return this.CompareTo(t)>0},t.prototype.CompareTo=function(t){var e=this.CompareTo_Number(this.x,t.x);return 0!=e?e:this.CompareTo_Number(this.y,t.y)},t.prototype.CompareTo_Number=function(t,e){if(t<e)return-1;if(t>e)return 1;if(t!=e){if(!isNaN(t))return 1;if(!isNaN(e))return-1}return 0},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.FindDirection=function(t){var e=Directions.None,i=this.x,a=this.y,n=t.x,o=t.y;return i!=n&&(e=n>i?Directions.East:Directions.West),a!=o&&(e=o>a?e|Directions.North:e|Directions.South),e},t.prototype.ManhattanDistance=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},t}(),List=function(){function t(){this._size=0,this.items=[]}return t.prototype.List=function(t){for(var e=0;e<t.size();e++)this.items.push(t.get(e))},t.prototype.size=function(){return this.items.length},t.prototype.sortByKey=function(t){return this.items.sort(function(e,i){var a=e[t],n=i[t];return a<n?-1:a>n?1:0})},t.prototype.Concat=function(e){for(var i=new t,a=0;a<this.items.length;a++)i.add(this.items[a]);for(a=0;a<e.size();a++)i.add(e.get(a));return i},t.prototype.GetRange=function(e,i){for(var a=new t,n=e;n<e+i;n++)a.add(this.items[n]);return a},t.prototype.AddRange=function(t){for(var e=0;e<t.size();e++)this.items.push(t.get(e))},t.prototype.Insert=function(t,e){void 0===t&&(t=this.size()+1),this.items.splice(t,0,e),this._size++},t.prototype.add=function(t){this.items.push(t),this._size++},t.prototype.get=function(t){return this.items[Number(t)]},t.prototype.Remove=function(t){var e=this.IndexOf(t);return e>=0&&(this.RemoveAt(e),!0)},t.prototype.RemoveAt=function(t){this._size,this._size--,this.items.splice(t,1)},t.prototype.Last=function(){return this.items[this.size()-1]},t.prototype.IndexOf=function(t){return this.items.indexOf(t)},t.prototype.Clear=function(){for(;this.items.length>0;)this.items.pop(),this._size=0},t.prototype.ElementAt=function(t){return this.items[t]},t.prototype.UpdateListValue=function(t,e){return!(!e||!e)&&(this.items[t]=e,!0)},t.prototype.contains=function(t){var e;if(null==t){for(e=0;e<this._size;e++)if(null==this.items[e])return!0;return!1}for(e=0;e<this._size;e++)if(this.items[e]==t)return!0},t}(),PointList=function(){function t(){this._size=0,this.items=[]}return t.prototype.PointList=function(t){for(var e=0;e<t.length;e++)this.items.push(t[e]);return this},t.prototype.size=function(){return this.items.length},t.prototype.Insert=function(t,e){void 0===t&&(t=this.size()+1),this.items.splice(t,0,e),this._size++},t.prototype.AddRange=function(t){for(var e=0;e<t.size();e++)this.items.push(t.get(e))},t.prototype.Concat=function(e){for(var i=new t,a=0;a<this.items.length;a++)i.add(this.items[a]);for(a=0;a<e.size();a++)i.add(e.get(a));return i},t.prototype.add=function(t){this.items.push(t),this._size++},t.prototype.get=function(t){return this.items[t]},t.prototype.RemoveAt=function(t){this._size,this._size--,this.items.splice(t,1)},t.prototype.Last=function(){return this.items[this.size()-1]},t.prototype.IndexOf=function(t){return this.items.indexOf(t)},t.prototype.Clear=function(){for(;this.items.length>0;)this.items.pop()},t.prototype.ElementAt=function(t){return this.items[t]},t.prototype.contains=function(t){var e;if(null==t){for(e=0;e<this._size;e++)if(null==this.items[e])return!0;return!1}for(e=0;e<this._size;e++)if(this.items[e]==t)return!0},t}(),Rect=function(){function t(t,e,i,a){this.x=Number.MAX_VALUE,this.y=Number.MAX_VALUE,this.width=0,this.height=0,void 0===t||void 0===e?(t=e=Number.MAX_VALUE,i=a=0):(void 0===i&&(i=0),void 0===a&&(a=0)),this.x=void 0!==t?t:Number.MAX_VALUE,this.y=void 0!==e?e:Number.MAX_VALUE,this.width=void 0!==i?i:0,this.height=void 0!==a?a:0}return t.prototype.Rect=function(t,e){return this.x=Math.min(t.x,e.x),this.y=Math.min(t.y,e.y),this.width=Number(Math.max(t.x,e.x))-Number(this.x),this.height=Number(Math.max(t.y,e.y))-Number(this.y),this},t.Rect=function(t,e){return this.Rect(t,e)},t.prototype.left=function(){return this.x},t.prototype.right=function(){return this.x+this.width},t.prototype.top=function(){return this.y},t.prototype.bottom=function(){return Number((this.y+this.height).toFixed(4))},t.prototype.topLeft=function(){return new Point(this.left(),this.top())},t.prototype.topRight=function(){return new Point(this.right(),this.top())},t.prototype.bottomLeft=function(){return new Point(this.left(),this.bottom())},t.prototype.bottomRight=function(){return new Point(this.right(),this.bottom())},t.prototype.middleLeft=function(){return new Point(this.left(),this.y+this.height/2)},t.prototype.middleRight=function(){return new Point(this.right(),this.y+this.height/2)},t.prototype.topCenter=function(){return new Point(this.x+this.width/2,this.top())},t.prototype.bottomCenter=function(){return new Point(this.x+this.width/2,this.bottom())},t.prototype.center=function(){return new Point(this.x+this.width/2,this.y+this.height/2)},t.prototype.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},t.prototype.uniteRect=function(t){var e=Math.max(Number.NaN===this.right()||this.x===Number.MAX_VALUE?t.right():this.right(),t.right()),i=Math.max(Number.NaN===this.bottom()||this.y===Number.MAX_VALUE?t.bottom():this.bottom(),t.bottom());return this.x=Math.min(this.left(),t.left()),this.y=Math.min(this.top(),t.top()),this.width=e-this.x,this.height=i-this.y,this},t.prototype.unitePoint=function(t){if(this.x===Number.MAX_VALUE)return this.x=t.x,void(this.y=t.y);var e=Math.min(this.left(),t.x),i=Math.min(this.top(),t.y),a=Math.max(this.right(),t.x),n=Math.max(this.bottom(),t.y);this.x=e,this.y=i,this.width=a-this.x,this.height=n-this.y},t.prototype.Inflate=function(t){return this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t,this},t.prototype.intersects=function(t){return!(this.right()<t.left()||this.left()>t.right()||this.top()>t.bottom()||this.bottom()<t.top())},t.prototype.containsRect=function(t){return this.left()<=t.left()&&this.right>=t.right&&this.top()<=t.top()&&this.bottom>=t.bottom},t.prototype.containsPoint=function(t){return this.left()<=t.x&&this.right()>=t.x&&this.top()<=t.y&&this.bottom()>=t.y},t.toBounds=function(e){for(var i,a=new t,n=0,o=e;n<o.length;n++)i=o[n],a.unitePoint(i);return a},t.prototype.round=function(){return this.x=Math.round(this.x),this.width=Math.round(this.width),this.y=Math.round(this.y),this.height=Math.round(this.height),this},t.empty=new t(Number.MAX_VALUE,Number.MIN_VALUE,0,0),t}(),Stack=function(){function t(){this.items=[]}return t.prototype.Push=function(t){this.items.push(t)},t.prototype.Pop=function(){return this.items.pop()},t.prototype.Peek=function(){return this.items[this.items.length-1]},t.prototype.Clear=function(){this.items=[]},t.prototype.Count=function(){return this.items.length},t.prototype.get=function(t){return this.items[Number(t)]},t}(),Dictionary=function(){function t(){this.keys=[],this.items={},this.count=0}return t.prototype.Items=function(){return this.items},t.prototype.Dictionary=function(e,i,a){var n=new t;return n.items=$.extend(!1,{},e),n.count=i,n.keys=a,n},t.prototype.Add=function(t,e){if(void 0!=e&&void 0!=t){var i={key:e,value:t};this.items[this.count]=i,this.keys.push(e),this.count++}},t.prototype.Remove=function(t){if(this.ContainsKey(t)){var e=this.IndexOfKey(t);delete this.items[e],this.keys.splice(e,1),this.count--,this.updateDic()}},t.prototype.updateDic=function(){for(var t={},e=Object.keys(this.items),i=0;i<this.count;i++)t[i]=this.items[e[i]];this.items=t},t.prototype.Update=function(t,e){if(this.ContainsKey(t)){var i=this.IndexOfKey(t);this.items[i].value=e}},t.prototype.Clear=function(){this.items={},this.count=0,this.keys=[]},t.prototype.ContainsKey=function(t){return-1!=this.keys.indexOf(t)},t.prototype.GetValue=function(t){if(void 0!=t&&this.ContainsKey(t)){var e=this.IndexOfKey(t);if(-1!=e)return this.items[e].value}return null},t.prototype.IndexOfKey=function(t){return this.keys.indexOf(t)},t.prototype.ElementAt=function(t){return t<this.keys.length&&this.items[t].value,null},t.prototype.KeyAt=function(t){return this.keys[t]},t.prototype.GetLength=function(){return this.keys.length},t.prototype.Count=function(){return this.keys.length},t.prototype.Clone=function(){return this.Dictionary(this.items,this.count,this.keys)},t}(),SortedList=function(){function t(){this.keys=[],this.items={},this.count=0}return t.prototype.Items=function(){return this.items},t.prototype.SortedList=function(e,i,a){var n=new t;return n.items=$.extend(!1,{},e),n.count=i,n.keys=a,n},t.prototype.Add=function(t,e){if(void 0!=e&&void 0!=t){var i={key:e,value:t};this.items[e]=i,this.keys=Object.keys(this.items),this.keys.sort(function(t,e){return t-e}),this.count++}},t.prototype.Remove=function(t){this.ContainsKey(t)&&(delete this.items[t],this.keys=Object.keys(this.items),this.keys.sort(function(t,e){return t-e}),this.count--)},t.prototype.Update=function(t,e){this.ContainsKey(t)&&(this.items[t].value=e)},t.prototype.Clear=function(){this.items={},this.count=0,this.keys=[]},t.prototype.sortOnKeys=function(){var t,e,i,a=[];for(t in this.items)a[a.length]=t;for(a.sort(function(t,e){return t-e}),e={},i=0;i<a.length;i++)e[a[i]]=this.items[a[i]];this.items=e},t.prototype.ContainsKey=function(t){if(this.items.hasOwnProperty(t))return!0},t.prototype.GetValue=function(t){if(void 0!=t&&this.items.hasOwnProperty(t))return this.items[t].value},t.prototype.IndexOfKey=function(t){var e,i=0;for(e in this.keys.indexOf(t),this.keys){if(this.keys[e]==t)return i;i++}return-1},t.prototype.ElementAt=function(t){var e=0;for(var i in this.items){if(e===t||t===i)return this.items[i].value;e++}return null},t.prototype.KeyAt=function(t){return Number(this.keys[t])},t.prototype.GetLength=function(){return this.keys.length},t.prototype.Count=function(){return this.keys.length},t.prototype.Clone=function(){return this.SortedList(this.items,this.count,this.keys)},t}(),Tuple=function(){function t(t,e){this._mT1=t,this._mT2=e}return t.prototype.Item11=function(){return this._mT1},t.prototype.Item2=function(){return this._mT2},t}(),PolylinePoint=function(){function t(t){this.Point=t}return t.prototype.getPrev=function(){return this._mPrev},t.prototype.setPrev=function(t){this._mPrev=t},t.prototype.getNext=function(){return this._mNext},t.prototype.setNext=function(t){this._mNext=t},t}(),Segment=function(){function t(t,e){this.StartPoint=t,this.EndPoint=e}return t.prototype.Bounds=function(){return(new Rect).Rect(this.StartPoint,this.EndPoint)},t.prototype.Contains=function(t){switch(this.StartPoint.FindDirection(this.EndPoint)){case Directions.East:return this.StartPoint.x<=t.x&&t.x<=this.EndPoint.x;case Directions.West:return this.StartPoint.x>=t.x&&t.x>=this.EndPoint.x;case Directions.North:return this.StartPoint.y<=t.y&&t.y<=this.EndPoint.y;case Directions.South:return this.StartPoint.y>=t.y&&t.y>=this.EndPoint.y}return!1},t}(),SharedData=function(){return function(){}}(),ICoreGroupableInfo=function(){return function(){}}(),IObstacle=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ICoreGroupableInfo),SpatialSearching=function(){function t(){this._pageLeft=0,this._pageRight=0,this._pageTop=0,this._pageBottom=0,this.childLeft=0,this.childTop=0,this.childRight=0,this.childBottom=0}return t.quadSize=500,t}(),ObstacleTree=function(){function t(){this.Rectangle=new Rect,this.ObstaclePadding=0,this.startNode=null,this.endNode=null,this.lookupSegment=null,this.canRoute=!0,this.hit=null}return t.prototype.InitObstacles=function(t,e,i){var a,n,o;for(this.spatialSearch=i,this.ObstaclePadding=e,a=0,o=0;o<t.size();o++)(n=t.get(a))._obstacle=(new Obstacle)._obstacle(n._outerBounds,e),this.Rectangle=0==o?n._obstacle.getPaddedBounds():this.Rectangle.uniteRect(n._obstacle.getPaddedBounds()),n._obstacle.CenterPort=new CenterPort(n._obstacle.getPaddedBounds().center()),a++},t.prototype.DisposeObstacles=function(t){var e,i;for(e in t)null!=(i=t.get(e))._obstacle&&(i._obstacle=null);this.spatialSearch=null},t.prototype.RestrictSegmentWithinFreeSpace=function(t,e,i,a){return void 0===a&&(a=null),this.FindMaximumVisibility(e,i,a)},t.prototype.FindNodesWhere=function(t,e){for(var i,a,n=new List,o=0;o<t.length;o++)(a=t[o])&&null!=a._obstacle&&(null!=(i=a._obstacle.getPaddedBounds?a._obstacle.getPaddedBounds():null)&&i.intersects(e)&&n.add(a));return n},t.prototype.FindNodes=function(t){for(var e,i=new List,a=new List,n=ej.datavisualization.Diagram.SpatialUtil.findQuads(this.spatialSearch,t),o=0;o<n.length;o++)(e=n[o]).objects.length>0&&(a=this.FindNodesWhere(e.objects,t)),i=i.Concat(a);return i},t.prototype.FindMaximumVisibility=function(t,e,i){var a,n;return void 0===i&&(i=null),this.canRoute=!0,a=(n=this.FindMaximumVisibility_hitNode(t,e,i,a)).hitNode,n.canRoute},t.prototype.FindMaximumVisibility_hitNode=function(t,e,i,a,n){var o,s;return void 0===n&&(n=!1),a=null,n||(this.lookupSegment=t),this.startNode=e,this.endNode=i,(o=Extensions.FindDirection(t.StartPoint,t.EndPoint))!=Directions.None&&(null!=(s=this.FindFirstHit(this.spatialSearch.parentQuad,o,t.Bounds()))&&s&&(a=s,this.GetSegmentEnd(t,o,s._obstacle))),this.startNode=null,this.lookupSegment=null,{canRoute:this.canRoute,hitNode:a}},t.prototype.GetSegmentEnd=function(t,e,i){var a=t.EndPoint;if(null!=i)switch(e){case Directions.East:a=new Point(i.getPaddedBounds().left(),a.y);break;case Directions.West:a=new Point(i.getPaddedBounds().right(),a.y);break;case Directions.North:a=new Point(a.x,i.getPaddedBounds().top());break;case Directions.South:a=new Point(a.x,i.getPaddedBounds().bottom())}t.EndPoint=a.round()},t.prototype.FindFirstHit=function(t,e,i){var a=null,n=t;switch(e){case Directions.East:a=this.FindIntersectingObjectsAtRight(n,i);break;case Directions.West:a=this.FindIntersectingObjectsAtLeft(n,i);break;case Directions.North:a=this.FindIntersectingObjectsAtBottom(n,i);break;case Directions.South:a=this.FindIntersectingObjectsAtTop(n,i)}return null!=a&&a.size()>0?this.FirstHitNode(a,e):null},t.prototype.FirstHitNode=function(t,e){var i=null;switch(e){case Directions.East:i=Utility.OrderBy(t,"left");break;case Directions.West:i=Utility.OrderByDescending(t,"right");break;case Directions.South:i=Utility.OrderByDescending(t,"bottom");break;case Directions.North:i=Utility.OrderBy(t,"top")}return Extensions.ElementAt(i,0)},t.prototype.FindIntersectingObjectsAtRight=function(t,e,i){void 0===i&&(i=null);var a=null!=i?i.size():0,n=!1;return null!=t.first&&this.IsIntersects(t.first,e)&&(i=this.FindIntersectingObjectsAtRight(t.first,e,i)),null!=t.third&&this.IsIntersects(t.third,e)&&(i=this.FindIntersectingObjectsAtRight(t.third,e,i)),null!=i&&i.size()>0&&a!=i.size()&&(n=!0),null!=(i=this.GetIntersectingNodesInaQuad(t,e,i))&&i.size()>0&&(n||this.CheckForObjectsOnCenterline(t,i,Directions.East))?i:(null!=t.second&&this.IsIntersects(t.second,e)&&(i=this.FindIntersectingObjectsAtRight(t.second,e,i)),null!=t.fourth&&this.IsIntersects(t.fourth,e)&&(i=this.FindIntersectingObjectsAtRight(t.fourth,e,i)),null!=i&&i.size()>0?i:null)},t.prototype.FindIntersectingObjectsAtLeft=function(t,e,i){void 0===i&&(i=null);var a=!1,n=null!=i?i.size():0;return null!=t.second&&this.IsIntersects(t.second,e)&&(i=this.FindIntersectingObjectsAtLeft(t.second,e,i)),null!=t.fourth&&this.IsIntersects(t.fourth,e)&&(i=this.FindIntersectingObjectsAtLeft(t.fourth,e,i)),null!=i&&i.size()>0&&n!=i.size()&&(a=!0),null!=(i=this.GetIntersectingNodesInaQuad(t,e,i))&&i.size()>0&&(a||this.CheckForObjectsOnCenterline(t,i,Directions.West))?i:(null!=t.first&&this.IsIntersects(t.first,e)&&(i=this.FindIntersectingObjectsAtLeft(t.first,e,i)),null!=t.third&&this.IsIntersects(t.third,e)&&(i=this.FindIntersectingObjectsAtLeft(t.third,e,i)),null!=i&&i.size()>0?i:null)},t.prototype.FindIntersectingObjectsAtBottom=function(t,e,i){void 0===i&&(i=null);var a=!1,n=null!=i?i.size():0;return null!=t.first&&this.IsIntersects(t.first,e)&&(i=this.FindIntersectingObjectsAtBottom(t.first,e,i)),null!=t.second&&this.IsIntersects(t.second,e)&&(i=this.FindIntersectingObjectsAtBottom(t.second,e,i)),null!=i&&i.size()>0&&n!=i.size()&&(a=!0),null!=(i=this.GetIntersectingNodesInaQuad(t,e,i))&&i.size()>0&&(a||this.CheckForObjectsOnCenterline(t,i,Directions.North))?i:(null!=t.third&&this.IsIntersects(t.third,e)&&(i=this.FindIntersectingObjectsAtBottom(t.third,e,i)),null!=t.fourth&&this.IsIntersects(t.fourth,e)&&(i=this.FindIntersectingObjectsAtBottom(t.fourth,e,i)),null!=i&&i.size()>0?i:null)},t.prototype.FindIntersectingObjectsAtTop=function(t,e,i){void 0===i&&(i=null);var a=null!=i?i.size():0,n=!1;return null!=t.third&&this.IsIntersects(t.third,e)&&(i=this.FindIntersectingObjectsAtTop(t.third,e,i)),null!=t.fourth&&this.IsIntersects(t.fourth,e)&&(i=this.FindIntersectingObjectsAtTop(t.fourth,e,i)),null!=i&&i.size()>0&&(n=!0),null!=(i=this.GetIntersectingNodesInaQuad(t,e,i))&&i.size()>0&&a!=i.size()&&(n||this.CheckForObjectsOnCenterline(t,i,Directions.South))?i:(null!=t.first&&this.IsIntersects(t.first,e)&&(i=this.FindIntersectingObjectsAtTop(t.first,e,i)),null!=t.second&&this.IsIntersects(t.second,e)&&(i=this.FindIntersectingObjectsAtTop(t.second,e,i)),null!=i&&i.size()>0?i:null)},t.prototype.CheckForObjectsOnCenterline=function(t,e,i){var a,n,o,s,r,l;if(i==Directions.North){for(n=t.top+t.height/2,s=0;s<e.size();s++)if((a=e.get(s))&&(r=ej.datavisualization.Diagram.Util.bounds(a),l=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a._obstacle?a._obstacle._outerBounds=l:a._obstacle={OuterBounds:l}),e.get(s)._obstacle._outerBounds.top()<=n)return!0}else if(i==Directions.South){for(n=t.top+t.height/2,s=0;s<e.size();s++)if((a=e.get(s))&&(r=ej.datavisualization.Diagram.Util.bounds(a),l=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a._obstacle?a._obstacle._outerBounds=l:a._obstacle={OuterBounds:l}),e.get(s)._obstacle._outerBounds.bottom>=n)return!0}else if(i==Directions.East){for(o=t.left+t.width/2,s=0;s<e.size();s++)if((a=e.get(s))&&(r=ej.datavisualization.Diagram.Util.bounds(a),l=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a._obstacle?a._obstacle._outerBounds=l:a._obstacle={OuterBounds:l}),e.get(s)._obstacle._outerBounds.left<=o)return!0}else for(o=t.left+t.width/2,s=0;s<e.size();s++)if((a=e.get(s))&&(r=ej.datavisualization.Diagram.Util.bounds(a),l=new Rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a._obstacle?a._obstacle._outerBounds=l:a._obstacle={OuterBounds:l}),e.get(s)._obstacle._outerBounds.right>=o)return!0;return!1},t.prototype.GetIntersectingNodesInaQuad=function(t,e,i){var a,n,o;for(a in void 0===i&&(i=null),null==i&&(i=new List),t.objects)if((n=t.objects[a])&&null!=n._obstacle&&(null!=(o=n._obstacle.getPaddedBounds?n._obstacle.getPaddedBounds():null)&&n!=this.startNode&&n!=this.endNode&&n._obstacle.getPaddedBounds().intersects(e))){if(null!=this.lookupSegment&&o.containsPoint(this.lookupSegment.StartPoint)){this.canRoute=!1,i=null;break}i.add(n)}return i},t.prototype.IsIntersects=function(t,e){return!(t.left>e.right||t.left+t.width<e.left||t.top>e.bottom||t.top+t.height<e.top())},t}(),LineRouting=function(){function t(){this.KnownObstacles=null,this.VisibleConnectors=null,this.consideredRegion=Rect.empty,this.IsDirt=!1,this.firstLoad=!1,this.ObstaclePadding=0,this.BendEquivalence=0,this.Priority=RoutingPriority.Routing,this.loadingPriority=LoadingPriority.ImmediateLoading,this.visibleVertices=new List,this.visibleEdges=new List,this.selectorBounds=Rect.empty}return t.prototype.SetLineRoutingSettings=function(){var t=null!=this._mSharedData.lineRoutingSettings?this._mSharedData.lineRoutingSettings:new LineRoutingSettings;(this.ObstaclePadding!=t.obstaclePadding||this.Priority!=t.priority||this.BendEquivalence!=t.bendEquivalence||this.loadingPriority!=t.loadingPriority)&&(this.IsDirt=!0),this.ObstaclePadding=t.obstaclePadding,this.BendEquivalence=t.bendEquivalence,this.Priority=t.priority,this.loadingPriority=t.loadingPriority},t.prototype.RerouteConnectors=function(t,e){var i,a,n,o;if(t.nodes().length>0&&t.connectors().length>0){var s,r,l=null!=e?e:t.activeTool.selectedObject,d=ej.datavisualization.Diagram.Util.bounds(l),h=new Rect(d.left,d.top,d.right-d.left,d.bottom-d.top),g="";for(i=0;i<t.connectors().length;i++){if((r=t.connectors()[i])&&g!=r.name){for(s=ej.datavisualization.Diagram.Util.getPoints(r),a=[],o=0;o<s.length;o++)(o>0&&(a[a.length-1].x!=s[o].x||a[a.length-1].y!=s[o].y)||0==o)&&a.push(new Point(Math.round(s[o].x),Math.round(s[o].y)));if(r=t.connectors()[i],a.length>1)for(n=a[0],o=1;o<a.length;o++)if((new Rect).Rect(n,a[o]).intersects(h)&&this.router.CanRoute(r)){this.routeEdge(r,t),g=r.name;break}}null!=this.router&&this.router.ForceInvalidateRouter()}}},t.prototype.Init=function(t){this._mSharedData=t,this.SetLineRoutingSettings()},t.prototype.cloneConnector=function(t,e){return this._mSharedData=e,t.sourceNode&&!t._sourceNodeInfo&&(t._sourceNodeInfo=e.nameTable[t.sourceNode]),t.targetNode&&!t._targetNodeInfo&&(t._targetNodeInfo=e.nameTable[t.targetNode]),t},t.prototype.updateAllQuadObjects=function(t){for(var e,i=0;i<t.objects.length;i++)if(e=t.objects[i]){var a=ej.datavisualization.Diagram.Util.bounds(e),n=new Rect(a.left,a.top,a.right-a.left,a.bottom-a.top),o=new Rect(a.x-this.ObstaclePadding,a.y-this.ObstaclePadding,a.width+2*this.ObstaclePadding,a.height+2*this.ObstaclePadding);e.segments||(e._obstacle?e._obstacle._outerBounds=n:e._obstacle={OuterBounds:n},e._outerBounds=n,e._obstacle.CenterPort||(e._obstacle.CenterPort=new CenterPort(o.center())))}},t.prototype.routeEdge=function(t,e){t=this.cloneConnector(t,e),this.updateParentQuad(e,!0,t),this.router.RouteEdge(t,e),e._resetConnectorPoints(t,e)},t.prototype._checkFromSwimlane=function(t,e){return e._checkFromSwimlane(t)},t.prototype._removeGroupChild=function(t,e){for(var i,a=[],n=0;n<t.length;n++)(i=e.nameTable[e._getChild(t[n])])&&!this._checkFromSwimlane(i,e)&&a.push(i);return a},t.prototype.GenerateVisibilityGraph=function(t,e){var i,a;this.router=(new Router).Router(this.Priority,this.BendEquivalence,this.ObstaclePadding,t),i=e?t.nodes():t._spatialSearch.parentQuad.objects,this.updateParentQuad(t),i.length>0&&(a=this._removeGroupChild(i,t),this.router.GenerateVisibilityGraph(a,t._spatialSearch)),VisibilityGraphGeneration.setRouter(this.router)},t.prototype.updateParentQuad=function(t,e,i){this._mSharedData;var a,n,o,s,r,l,d,h,g=$.extend(!1,[],t._spatialSearch.parentQuad);if(0==g.objects.length&&(g.objects=t.nodes()),e){if(i){i.targetNode&&(a=t.nameTable[i.targetNode],n=ej.datavisualization.Diagram.Util.bounds(a,!0)),i.sourceNode&&(o=t.nameTable[i.sourceNode],s=ej.datavisualization.Diagram.Util.bounds(o,!0));var c=ej.datavisualization.Diagram.Util.findPortByName(o,i.sourcePort),u=ej.datavisualization.Diagram.Util.findPortByName(a,i.targetPort),m=ej.datavisualization.Diagram.Util._getPortPosition(u,n),p=ej.datavisualization.Diagram.Util._getPortPosition(c,s)}c&&(r=ej.datavisualization.Diagram.Util._swapDirection(o.rotateAngle,ej.datavisualization.Diagram.Util._getDirection(s,p||s.center)),i._sourcePortInfo=new IObstaclePort,"left"===r?i._sourcePortInfo.Direction=PortDirection.Left:"right"===r?i._sourcePortInfo.Direction=PortDirection.Right:"bottom"===r?i._sourcePortInfo.Direction=PortDirection.Bottom:"top"===r&&(i._sourcePortInfo.Direction=PortDirection.Top),i._sourcePortInfo.Location=new Point(Number(p.x.toFixed(4)),Number(p.y.toFixed(4)))),u&&(l=ej.datavisualization.Diagram.Util._swapDirection(a.rotateAngle,ej.datavisualization.Diagram.Util._getDirection(n,m||n.center)),i._targetPortInfo=new IObstaclePort,"left"===l?i._targetPortInfo.Direction=PortDirection.Left:"right"===l?i._targetPortInfo.Direction=PortDirection.Right:"bottom"===l?i._targetPortInfo.Direction=PortDirection.Bottom:"top"===l&&(i._targetPortInfo.Direction=PortDirection.Top),i._targetPortInfo.Location=new Point(Number(m.x.toFixed(4)),Number(m.y.toFixed(4))))}else for(d=0;d<g.objects.length;d++)if(h=g.objects[d]){var f=ej.datavisualization.Diagram.Util.bounds(h),_=new Rect(f.left,f.top,f.right-f.left,f.bottom-f.top),v=new Rect(f.left-this.ObstaclePadding,f.top-this.ObstaclePadding,f.right-f.left+2*this.ObstaclePadding,f.bottom-f.top+2*this.ObstaclePadding);h._obstacle?h._obstacle._outerBounds=_:h._obstacle={OuterBounds:_},h._outerBounds=_,h._obstacle.CenterPort=new CenterPort(v.center())}},t.prototype.AddNode=function(t){null!=this.router&&this.router.AddNode(t)},t.prototype.RemoveNode=function(t){null!=this.router&&this.router.RemoveNode(t)},t.prototype.SetObstacles=function(t,e){this.KnownObstacles=t,this.VisibleConnectors=e},t}(),LineRoutingSettings=function(){return function(){this.bendEquivalence=0,this.obstaclePadding=0,this.bendEquivalence=5,this.priority=RoutingPriority.Routing,this.obstaclePadding=12,this.loadingPriority=LoadingPriority.DelayedDiagramLoading}}(),VertexQueue=function(){function t(){this.vertexQueue=new List,this.timeStamp=0}return t.prototype.getnextTimeStamp=function(){return++this.timeStamp},t.prototype.Enqueue=function(t){t.TimeStamp=this.getnextTimeStamp(),this.Sort(t)},t.prototype.Sort=function(t){var e,i,a=this.vertexQueue.size();if(this.vertexQueue.add(t),a>0)for(;a>0&&this.vertexQueue.get(a>>1).CompareTo(this.vertexQueue.get(a))>0;)e=a>>1,i=this.vertexQueue.get(e),this.vertexQueue.UpdateListValue(e,this.vertexQueue.get(a)),this.vertexQueue.UpdateListValue(a,i),a>>=1},t.prototype.Dequeue=function(){var t=this.vertexQueue.get(0);return this.MoveQueueOneStepForward(t),t},t.prototype.MoveQueueOneStepForward=function(){var t,e,i,a,n,o=this.vertexQueue.size()-2;if(this.vertexQueue.size()>1)for(t=this.vertexQueue.Last(),this.vertexQueue.RemoveAt(this.vertexQueue.size()-1),this.vertexQueue.UpdateListValue(0,t),e=0;i=e,(a=e<<1)<=o&&this.vertexQueue.get(a).CompareTo(this.vertexQueue.get(e))<0&&(i=a),(n=a+1)<=o&&this.vertexQueue.get(n).CompareTo(this.vertexQueue.get(i))<0&&(i=n),i!=e;)this.SwapWithParent(i),e=i;else this.vertexQueue.RemoveAt(0)},t.prototype.DecreasePriority=function(t,e){var i,a;if(e=Math.round(e),-1!=(i=this.vertexQueue.IndexOf(t)))for(this.vertexQueue.get(i).Cost=e,a=i;a>0&&this.vertexQueue.get(a).CompareTo(this.vertexQueue.get(a>>1))<0;)this.SwapWithParent(a),a>>=1},t.prototype.SwapWithParent=function(t){var e=this.vertexQueue.get(t>>1);this.vertexQueue.UpdateListValue(t>>1,this.vertexQueue.get(t)),this.vertexQueue.UpdateListValue(t,e)},t.prototype.Count=function(){return this.vertexQueue.size()},t.prototype.ToString=function(){for(var t="",e=0;e<this.vertexQueue.size();e++)t+=this.vertexQueue[e];return t},t}(),Neighbor=function(){function t(){this.Weight=0,this.Clear()}return t.prototype.Set=function(t,e){this.Vertex=t,this.Weight=e},t.prototype.Clear=function(){this.Vertex=null,this.Weight=Number.NaN},t}(),NeighborSides=function(){return function(){}}(),ShortestPath=function(){function t(t,e,i){this.cancel=!1,this.upperBoundCost=Number.MAX_VALUE,this.targetConnector=null,this.bendEquivalence=0,this.bendsImportance=1,this.lengthImportance=1,this.visitedVertices=new List,this.queue=new VertexQueue,this.mode=RoutingSolution.Quick,this.neighbors=[new Neighbor,new Neighbor,new Neighbor],this.visibilityGraph=t,this.targetConnector=i,this.bendEquivalence=e}return t.prototype.GetSingleStagePath=function(t){var e=this.FindPath(t),i=this.GetEntries(e);return this.GetPoints(i)},t.prototype.GetEntries=function(t){var e=new List,i=Directions.None,a=!1;if(null!=t)for(;null!=t;){if(t.Direction!=i?(e.Insert(0,t),i=t.Direction,a=!1):a=!0,null==t.PreviousEntry){a&&e.Insert(0,t);break}t=t.PreviousEntry}return e},t.prototype.GetPoints=function(t){var e,i,a,n,o,s,r,l=new PointList;if(t.size()>0){if(e=t.size()-1,t.size()>4&&(i=t.size(),t.get(i-2).Direction==t.get(i-4).Direction)){for(var d=t.get(i-4).Vertex,h=null,g=d.FindNextVertex(t.get(i-4).Direction);null!=g;)h=g,g=g.FindNextVertex(t.get(i-4).Direction);null!=h&&null!=this.targetConnector.TargetEntrance&&(a=new Segment(d.Point,h.Point),null!=(n=this.targetConnector.TargetEntrance.MaxVisibilitySegment)&&(o=(s=Utility.SegmentIntersects(a,n,o)).intersect,s.isInterSect&&(l.add(o),l.add(t.get(i-1).Vertex.Point),e=i-5)))}for(r=e;r>=0;r--)l.Insert(0,t.get(r).Vertex.Point)}return l},t.prototype.FindPath=function(t){for(var e,i,a,n,o=Number.POSITIVE_INFINITY,s=null,r=0;r<t.size()&&(e=t.get(r),!this.cancel&&(null==s||e.getMinimalBend()<s.NumberOfBends||e.getIsPreferred()&&e.getMinimalBend()==s.NumberOfBends));r++)i=e.getSourceEntry().Point,a=e.getTargetEntry().Point,this.bendsImportance=Math.max(.01,i.ManhattanDistance(a)*this.bendEquivalence*.01),this.mode=RoutingSolution.Best,null!=(n=this.FindPath_Point(i,a))&&(null==s||o>n.Cost)&&(s=n,o=n.Cost);return s},t.prototype.FindPath_Point=function(t,e){var i,a,n,o,s,r;for(t.round(),e.round(),this.InitializePath(t,e),i=this.visibilityGraph.FindVertex(e),0;this.queue.Count()>0&&!this.cancel;){if(0,i==(a=this.queue.Dequeue()).Vertex)return this.Cleanup(),a;for(a.Closed=!0,o=0;o<this.neighbors.length;o++)(n=this.neighbors[o]).Clear();if((s=Extensions.Right(a.Direction))!=Directions.None)for(this.ExtendPathAlongInEdges(a,s),this.ExtendPathAlongOutEdges(a,s),r=0;r<this.neighbors.length;r++)null!=(n=this.neighbors[r]).Vertex&&this.ExtendPathToNeighborVertex(a,n.Vertex,n.Weight)}return this.Cleanup(),null},t.prototype.InitializePath=function(t,e){var i,a,n;this.queue=new VertexQueue,i=this.visibilityGraph.FindVertex(t),a=this.visibilityGraph.FindVertex(e),this.Source=i,this.InitEntryDirectionsAtTarget(a),null!=i&&((n=new VertexEntry(i,null,0,0,0)).Closed=!0,this.EnqueueOutEdges(n),this.EnqueueInEdges(n))},t.prototype.ExtendPathAlongInEdges=function(t,e){var i=t.Vertex.getWestEdge();null!=i&&this.ExtendPathAlongEdge(t,i.getSource(),i,e),null!=(i=t.Vertex.getSouthEdge())&&this.ExtendPathAlongEdge(t,i.getSource(),i,e)},t.prototype.ExtendPathAlongOutEdges=function(t,e){var i=t.Vertex.getEastEdge();null!=i&&this.ExtendPathAlongEdge(t,i.getTarget(),i,e),null!=(i=t.Vertex.getNorthEdge())&&this.ExtendPathAlongEdge(t,i.getTarget(),i,e)},t.prototype.ExtendPathAlongEdge=function(t,e,i,a){if(null==t.PreviousEntry||e!=t.PreviousEntry.Vertex){var n=this.neighbors[2],o=t.Vertex.Point.FindDirection(e.Point);o!=t.Direction&&(n=this.neighbors[o==a?1:0]),n.Set(e,i.getWeight())}else e==t.PreviousEntry.Vertex&&(t.Vertex.getDegree()>1||t.Vertex!=this.Source)&&this.ExtendPathToNeighborVertex(t,e,i.getWeight())},t.prototype.EnqueueEdges=function(t,e,i){var a,n=e.getWeight();switch(0==(this.EntryDirectionsToTarget&e.getSourcePoint().FindDirection(e.getTargetPoint()))&&(n=1.5),a=null,i){case Directions.East:case Directions.North:a=e.getTarget();break;case Directions.West:case Directions.South:a=e.getSource()}this.ExtendPathToNeighborVertex(t,a,n)},t.prototype.EnqueueOutEdges=function(t){var e=t.Vertex;null!=e.getEastEdge()&&this.EnqueueEdges(t,e.getEastEdge(),Directions.East),null!=e.getNorthEdge()&&this.EnqueueEdges(t,e.getNorthEdge(),Directions.North)},t.prototype.EnqueueInEdges=function(t){var e=t.Vertex;null!=e.getWestEdge()&&(null==t.PreviousEntry||e.getWestEdge().getSource()!=t.PreviousEntry.Vertex)&&this.EnqueueEdges(t,e.getWestEdge(),Directions.West),null!=e.getSouthEdge()&&(null==t.PreviousEntry||e.getSouthEdge().getSource()!=t.PreviousEntry.Vertex)&&this.EnqueueEdges(t,e.getSouthEdge(),Directions.South)},t.prototype.ExtendPathToNeighborVertex=function(t,e,i){var a=t.Vertex.Point.FindDirection(e.Point),n=null;null!=e.VertexEntries&&(n=e.VertexEntries[Extensions.ToIndex(a)]),null==n?this.CheckExistingReverseEntry(t,e,i)||this.CreateAndEnqueueEntryToNeighborVertex(t,e,i):n.Closed||this.mode==RoutingSolution.Quick||(i=this.UpdateEntryToNeighborVertexIfNeeded(t,n,i).weight)},t.prototype.UpdateEntryToNeighborVertexIfNeeded=function(t,e,i){var a,n=0,o=0,s=this.UpdatePathLength(t,e.Vertex,i,n,o),r=s.direction;return i=s.weight,n=s.bends,o=s.length,this.CombinedCost(o,n)<this.CombinedCost(e.Length,e.NumberOfBends)&&(a=this.CombinedCost(o,n)+this.HeuristicDistanceFromVertexToTarget(e.Vertex.Point,r),e.ResetEntry(t,a,n,o),this.queue.DecreasePriority(e,a)),{weight:i}},t.prototype.CreateAndEnqueueEntryToNeighborVertex=function(t,e,i){var a,n=0,o=0,s=this.UpdatePathLength(t,e,i,o,n),r=s.direction;i=s.weight,o=s.bends,n=s.length,(a=this.CombinedCost(n,o)+this.HeuristicDistanceFromVertexToTarget(e.Point,r))<this.upperBoundCost&&(null==e.VertexEntries&&this.visitedVertices.add(e),this.EnqueueVertex(e,t,n,a,o))},t.prototype.ToIndex=function(t){switch(t){case Directions.North:return 0;case Directions.East:return 1;case Directions.South:return 2;case Directions.West:return 3}},t.prototype.CheckExistingReverseEntry=function(t,e,i){var a,n;return null!=t.Vertex.VertexEntries&&((a=e.Point.FindDirection(t.Vertex.Point))!=Directions.None&&null!=(n=t.Vertex.VertexEntries[this.ToIndex(a)]))&&(this.CheckTheNeedOfReverseEntry(t,n,i),!0)},t.prototype.CheckTheNeedOfReverseEntry=function(t,e,i){var a,n=0,o=0,s=e.PreviousEntry.Vertex,r=this.UpdatePathLength(t,s,i,n,o),l=r.direction;i=r.weight,n=r.bends,o=r.length,l!=Directions.None&&this.CombinedCost(o,n)<this.CombinedCost(e.Length,e.NumberOfBends)&&(a=this.CombinedCost(o,n)+this.HeuristicDistanceFromVertexToTarget(s.Point,l),this.EnqueueVertex(s,t,o,a,n))},t.prototype.CombinedCost=function(t,e){return Number((this.bendsImportance*e+this.lengthImportance*t).toFixed(4))},t.prototype.UpdatePathLength=function(t,e,i,a,n){var o,s,r=t.Vertex.Point.FindDirection(e.Point);return this.mode==RoutingSolution.Quick?(n=0,a=t.NumberOfBends,o=e.Point.FindDirection(this.Target.Point),s=0,t.Direction!=Directions.None&&(s=(r&o)!=Directions.None?(t.Direction,0):2),a+=s):(n=t.Length+t.Vertex.Point.ManhattanDistance(e.Point)*i,a=t.NumberOfBends,t.Direction!=Directions.None&&t.Direction!=r&&a++),{direction:r,weight:i,bends:a,length:n}},t.prototype.EnqueueVertex=function(t,e,i,a,n){var o=new VertexEntry(t,e,i,n,a);return this.queue.Enqueue(o),t.SetVertexEntry(o),o},t.prototype.InitEntryDirectionsAtTarget=function(t){return this.Target=t,this.EntryDirectionsToTarget=Directions.None,null!=t.getEastEdge()&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.East),null!=t.getNorthEdge()&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.North),null!=t.getWestEdge()&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.West),null!=t.getSouthEdge()&&(this.EntryDirectionsToTarget=this.EntryDirectionsToTarget||Directions.South),this.EntryDirectionsToTarget!=Directions.None},t.prototype.HeuristicDistanceFromVertexToTarget=function(t,e){var i,a=this.Target.Point.subtract(t),n=Extensions.VectorDirection(a);return a.equals(new Point(0,0))?0:(i=0,e==Directions.None?(e=Directions.East|Directions.North|Directions.West|Directions.South,i=this.GetNumberOfBends(e,n)):i=this.GetNumberOfBends(e,n),this.CombinedCost(t.ManhattanDistance(this.Target.Point),i))},t.prototype.GetNumberOfBends=function(e,i){return Extensions.IsPureDirection(i)?this.GetNumberOfBendsForPureDirection(e,i):t.GetBendsForNotPureDirection(i,e,this.EntryDirectionsToTarget)},t.prototype.GetNumberOfBendsForPureDirection=function(e,i){return(i&e)==i?Extensions.Contains(this.EntryDirectionsToTarget,i)?0:Extensions.Contains(this.EntryDirectionsToTarget,Extensions.Left(i))||Extensions.Contains(this.EntryDirectionsToTarget,Extensions.Right(i))?2:4:this.GetNumberOfBendsForPureDirection(t.AddOneTurn[e],i)+1},t.GetBendsForNotPureDirection=function(e,i,a){var n=e&i;return i!=Directions.None?n==Directions.None?1:(e&a)==Directions.None?2:n==e?1:2:this.GetBendsForNotPureDirection(e,t.AddOneTurn[i],t.AddOneTurn[a])+1},t.prototype.Cleanup=function(){for(var t=0;t<this.visitedVertices.size();t++)this.visitedVertices.get(t).RemoveVertexEntries();this.visitedVertices.Clear(),this.queue=null},t.prototype.CancelRouting=function(){this.cancel=!0},t.AddOneTurn=[Directions.None,Directions.North|Directions.East|Directions.West,Directions.North|Directions.East|Directions.South,15,Directions.East|Directions.South|Directions.West,15,15,15,13,15,15,15,15,15,15,15],t}(),Router=function(){function t(){this.obstaclesToAdd=new List,this.obstaclesToRemove=new List,this.BendEquivalence=0,this.ObstaclePadding=0,this.cancel=!1,this.graph=null,this.obstacleTree=null,this.portManager=null,this.isAddingObstacle=!1,this.isRemovingObstacle=!1,this.Priority=RoutingPriority.Default,this.BendEquivalence=5,this.ObstaclePadding=12,this.horizontalSegmentTree=new SegmentTree(!1,this),this.verticalSegmentTree=new SegmentTree(!0,this),this.horizontalSegmentTree.setPerpendicularTree(this.verticalSegmentTree),this.verticalSegmentTree.setPerpendicularTree(this.horizontalSegmentTree),this.vertexToRemove={}}return t.prototype.getHorizontalSegmentTree=function(){return this.horizontalSegmentTree},t.prototype.getVerticalSegmentTree=function(){return this.verticalSegmentTree},t.prototype.Router=function(t,e,i,a){return this.diagram=a,this.Priority=t,this.BendEquivalence=e,this.ObstaclePadding=i,this.horizontalSegmentTree=new SegmentTree(!1,this),this.verticalSegmentTree=new SegmentTree(!0,this),this.horizontalSegmentTree.setPerpendicularTree(this.verticalSegmentTree),this.verticalSegmentTree.setPerpendicularTree(this.horizontalSegmentTree),this},t.prototype.MinimumSegmentLength=function(t){if(t.size()>1){var e=t.ElementAt(0),i=t.ElementAt(t.size()-2),a=t.ElementAt(1),n=t.ElementAt(t.size()-1),o=Extensions.FindDistance(e,a,Extensions.GetOrientation(Extensions.FindDirection(e,a))),s=Extensions.FindDistance(i,n,Extensions.GetOrientation(Extensions.FindDirection(i,n)));return Math.min(Number(Math.round(o).toFixed(4)),Number(Math.round(s).toFixed(4)))}return 0},t.prototype.IsMinimalPointCollection=function(t){if(t.size()>1){var e=t.ElementAt(0),i=t.ElementAt(t.size()-2),a=t.ElementAt(1),n=t.ElementAt(t.size()-1),o=Extensions.GetOrientation(e.FindDirection(a)),s=Extensions.GetOrientation(i.FindDirection(n));if(o==s&&t.size()<=4||o!=s&&3==t.size())return!0}return!1},t.prototype.GenerateVisibilityGraph=function(t,e){var i,a,n;if(this.currentBounds=Rect.empty,i=new List,this.obstacleTree=new ObstacleTree,this.obstacleTree.InitObstacles(i,this.ObstaclePadding,e),this.graph=new VisibilityGraph,a=new EdgeGeometry,this.portManager=new PortManager(this.horizontalSegmentTree,this.verticalSegmentTree,this.obstacleTree,this.graph,a,this.ObstaclePadding),this.pathfinder=new ShortestPath(this.graph,this.BendEquivalence,a),t.length>0){for(n=0;n<t.length;n++)t[n]._obstacle=null,this.AddNode(t[n]);this.InvalidateRouter()}},t.prototype.RouteEdge=function(t,e){var i,a,n,o,s,r,l,d,h,g,c,u;this.diagram=e,i=new PointList,a=new PointList,this.InvalidateRouter(),i=this.portManager.IsCurrentConnectionSegmentsValid(t,i).points,this.CanRoute(t)&&null!=t._sourceNodeInfo&&null!=t._targetNodeInfo?(this.portManager.temporaryAddition=!0,null!=(n=this.portManager.GetPortVisibilityIntersection(t))&&n.size()>0?0==(a=n).size()&&(t._points=a):this.portManager.AddControlPointsToGraph(t)&&(o=t._sourcePortInfo?t._sourcePortInfo:t._sourceNodeInfo._obstacle.CenterPort,s=t._targetPortInfo?t._targetPortInfo:t._targetNodeInfo._obstacle.CenterPort,a=this.pathfinder.GetSingleStagePath(this.GetPossibleEntries(o,s))),a.size()>0&&(i.size()>0?a.size()<i.size()?t._points=a:a.size()>i.size()?t._points=i:(r=this.MinimumSegmentLength(i),l=this.MinimumSegmentLength(a),r<this.ObstaclePadding&&r<l?t._points=a:(d=Extensions.GetLengthFromListOfPoints(a),h=Extensions.GetLengthFromListOfPoints(i),t._points=d<=h?a:i)):t._points=a)):!this.CanRoute(t)||null==t._sourceNodeInfo&&null==t._targetNodeInfo?t._points=new PointList:(this.portManager.temporaryAddition=!0,g=t._sourcePortInfo,c=t._targetPortInfo,g=null==g&&t._sourceNodeInfo instanceof IObstacle?t._sourceNodeInfo._obstacle.CenterPort:t._sourcePointInfo,u=(c=null==c&&t._targetNodeInfo instanceof IObstacle?t._targetNodeInfo._obstacle.CenterPort:t._targetPointInfo).getLocation(),c.setLocation(this.portManager.GetValidPortLocation(u)),this.portManager.AddControlPointsToGraph(t)?(t._points=this.pathfinder.GetSingleStagePath(this.GetPossibleEntries(g,c)),null!=t._points&&t._points.Count>0&&(t._points.RemoveAt(t._points.Count-1),t._points.Insert(t._points.Count,u))):t._points=i),this.portManager.RemoveEdgeGeometryFromGraph(),this.portManager.temporaryAddition=!1},t.prototype.CanRoute=function(t){if(ej.datavisualization.Diagram.Util.canRouteConnector(t,this.diagram)){if(null!=t.sourcePort&&null!=t.targetPort){t.sourcePort,t.sourcePort;var e=new Point(t.sourcePoint.x,t.sourcePoint.y),i=new Point(t.targetPoint.x,t.targetPoint.y),a=(new Rect).Rect(new Point(e.x,e.y),new Point(e.x,e.y)),n=(new Rect).Rect(new Point(i.x,i.y),new Point(i.x,i.y));if(a=a.Inflate(this.ObstaclePadding),n=n.Inflate(this.ObstaclePadding),a.intersects(n))return!1}return!0}},t.prototype.AddVertex=function(t){var e=this.graph.AddVertex(t);return 0!=Extensions.Count(this.vertexToRemove)&&Extensions.ContainsKey(this.vertexToRemove,e.Point)&&Extensions.Remove(this.vertexToRemove,e.Point),e},t.prototype.GetMaximumVisibility=function(t,e){var i,a;return e!=Directions.None&&(i=e==Directions.West?new Point(this.currentBounds.x,t.y):e==Directions.East?new Point(this.currentBounds.right(),t.y):e==Directions.South?new Point(t.x,this.currentBounds.top()):new Point(t.x,this.currentBounds.bottom()),a=new Segment(t,i),this.obstacleTree.FindMaximumVisibility(a,this.currentNode))?Extensions.IsAscending(e)?new Segment(a.StartPoint,a.EndPoint):new Segment(a.EndPoint,a.StartPoint):null},t.prototype.ResetDependentCollection=function(){var t,e;for(t in this.vertexToRemove)e=Extensions.ElementAt(this.vertexToRemove,t),this.graph.RemoveVertex(e);this.vertexToRemove=Extensions.Clear(this.vertexToRemove),this.horizontalSegmentTree.getCoordsToReconstruct().Clear(),this.verticalSegmentTree.getCoordsToReconstruct().Clear()},t.prototype.InvalidateRouter=function(){for(var t;this.obstaclesToRemove.size();)t=this.obstaclesToRemove.get(0),this.obstaclesToRemove.RemoveAt(0),this.RemoveObstacleforNode(t);for(;this.obstaclesToAdd.size();)t=this.obstaclesToAdd.get(0),this.obstaclesToAdd.RemoveAt(0),this.AddObstacleforNode(t)},t.prototype.ForceInvalidateRouter=function(){this.InvalidateRouter()},t.prototype.AddNode=function(t){this.obstaclesToAdd.contains(t)||(null==t._obstacle||this.obstaclesToRemove.contains(t))&&this.obstaclesToAdd.add(t)},t.prototype.RemoveNode=function(t){null==t._obstacle||this.obstaclesToRemove.contains(t)||this.obstaclesToRemove.add(t)},t.prototype.AddObstacleforNode=function(t){var e;this.portManager.temporaryAddition=!1,this.isAddingObstacle=!0,this.ResetDependentCollection();var i=ej.datavisualization.Diagram.Util.bounds(t),a=new Rect(i.left,i.top,i.right-i.left,i.bottom-i.top),n=this.obstacleTree.Rectangle;if(null==t._obstacle&&0!=a.width&&0!=a.height){this.currentNode=t,t._obstacle=(new Obstacle)._obstacle(a,this.ObstaclePadding);var o=0,s=0,r=0,l=0;null!=t._obstacle.getPaddedBounds()&&(a=t._obstacle.getPaddedBounds().round(),o=Utility.ToRoundedInt(a.left()),s=Utility.ToRoundedInt(a.top()),r=Utility.ToRoundedInt(a.right()),l=Utility.ToRoundedInt(a.bottom()),0!=(e=0)&&(a=new Rect(o+=o%e!=0?e-o%e:0,s+=s%e!=0?e-s%e:0,(r-=r%e!=0?r%e:0)-o,(l-=l%e!=0?l%e:0)-s),t._obstacle.setPaddedBounds(a)),t._outerBounds=a,t._obstacle.CenterPort=new CenterPort(t._obstacle.getPaddedBounds().center())),0!=this.verticalSegmentTree.getVectors().Count()&&0!=this.horizontalSegmentTree.getVectors().Count()&&(o=Math.min(this.horizontalSegmentTree.getStart(),o),s=Math.min(this.verticalSegmentTree.getStart(),s),r=Math.max(this.horizontalSegmentTree.getEnd(),r),l=Math.max(this.verticalSegmentTree.getEnd(),l)),(o<n.left()||r>n.right())&&this.horizontalSegmentTree.ExpandOrCollapseSegmentTree(o,r,!0),(s<n.top()||l>n.bottom())&&this.verticalSegmentTree.ExpandOrCollapseSegmentTree(s,l,!0),this.obstacleTree.Rectangle=new Rect(o,s,r-o,l-s),this.currentBounds=this.obstacleTree.Rectangle,this.horizontalSegmentTree.InitializeVectorCoordinate(a),this.verticalSegmentTree.InitializeVectorCoordinate(a),this.horizontalSegmentTree.InsertObstacle(a),this.verticalSegmentTree.InsertObstacle(a),this.horizontalSegmentTree.SplitSegments(a),this.verticalSegmentTree.SplitSegments(a),this.horizontalSegmentTree.RemoveUnUsedVector(),this.verticalSegmentTree.RemoveUnUsedVector(),this.ResetDependentCollection()}this.isAddingObstacle=!1,this.portManager.temporaryAddition=!0},t.prototype.RemoveObstacleforNode=function(t){var e,i,a,n;if(null!=t._obstacle){for(a in e={},i=t._obstacle.getPaddedBounds()&&t._obstacle?t._obstacle.getPaddedBounds().round():new Rect(0,0,0,0),e=Extensions.add(e,t,i),t._obstacle=null,this.GetIntersectionObstacle(i,e),e)this.RemoveObstacle(Extensions.getFromDictionary(e,Extensions.KeytAt(e,a))),delete t._obstacle;for(a in e)(n=Extensions.KeytAt(e,a)).name!==t.name&&this.AddNode(n)}},t.prototype.RemoveObstacle=function(t){var e;if(this.portManager.temporaryAddition=!1,this.isRemovingObstacle=!0,this.vertexToRemove={},this.horizontalSegmentTree.getCoordsToReconstruct().Clear(),this.verticalSegmentTree.getCoordsToReconstruct().Clear(),this.horizontalSegmentTree.InitializeVectorCoordinate(t),this.verticalSegmentTree.InitializeVectorCoordinate(t),this.ConnectSegmentDelegate(t,!0),this.ConnectSegmentDelegate(t,!1),this.horizontalSegmentTree.RemoveObstacle(t,this),this.verticalSegmentTree.RemoveObstacle(t,this),this.DisconnectVertexandEdges(this.horizontalSegmentTree),this.DisconnectVertexandEdges(this.verticalSegmentTree),this.horizontalSegmentTree.RemoveUnUsedVector(),this.verticalSegmentTree.RemoveUnUsedVector(),0!=this.verticalSegmentTree.getVectors().Count()){var i=this.verticalSegmentTree.getVectors().Count(),a=this.horizontalSegmentTree.getVectors().Count(),n=i>0?Number(this.verticalSegmentTree.getVectors().KeyAt(0)):0,o=a>0?Number(this.horizontalSegmentTree.getVectors().KeyAt(0)):0,s=i>0?Number(this.verticalSegmentTree.getVectors().KeyAt(this.verticalSegmentTree.getVectors().Count()-1)):0,r=a>0?Number(this.horizontalSegmentTree.getVectors().KeyAt(this.horizontalSegmentTree.getVectors().Count()-1)):0;this.obstacleTree.Rectangle=new Rect(n,o,s-n,r-o),this.horizontalSegmentTree.ExpandOrCollapseSegmentTree(n,s),this.verticalSegmentTree.ExpandOrCollapseSegmentTree(o,r)}else this.obstacleTree.Rectangle=Rect.empty;if(this.currentBounds=this.obstacleTree.Rectangle,0!=Extensions.Count(this.vertexToRemove)){for(e in this.vertexToRemove)this.graph.RemoveVertex(Extensions.getFromDictionary(this.vertexToRemove,Extensions.KeytAt(this.vertexToRemove,e)));this.vertexToRemove=Extensions.Clear(this.vertexToRemove)}this.isRemovingObstacle=!1,this.portManager.temporaryAddition=!0},t.prototype.GetIntersectionObstacle=function(t,e){for(var i,a,n=this.obstacleTree.FindNodes(t),o=0;o<n.size();o++)null!=(i=n.get(Number(o)))._obstacle&&(a=i._obstacle.getPaddedBounds().round(),e=Extensions.add(e,i,a),i._obstacle=null,this.GetIntersectionObstacle(a,e))},t.prototype.SplitSegment=function(t,e){var i,a,n=Utility.ToRoundedInt(t.top()),o=Utility.ToRoundedInt(t.bottom()),s=Utility.ToRoundedInt(t.left()),r=Utility.ToRoundedInt(t.right()),l=e.getParentTree().getPerpendicularTree(),d=e.FindSegment(e.getIsVertical()?n:s),h=e.FindSegment(e.getIsVertical()?o:r),g=e.getIsVertical()?new Point(e.getCoord(),n):new Point(s,e.getCoord()),c=e.getIsVertical()?new Point(e.getCoord(),o):new Point(r,e.getCoord());if(null!=d){var u=l.getVectors().GetValue(e.getIsVertical()?n:s).FindSegment(e.getCoord()),m=e.getIsVertical()?Directions.North:Directions.East;if(null!=u)this.RemoveEdgesBetween(g,c,m);else for(i=this.graph.FindVertex(d.getStartPoint());null!=i;){if(!(a=i.FindNextVertex(m))||!a.Point.OperatorLessThan(g)){this.RemoveEdgesBetween(i.Point,c,m),d.UpdateSegmentPoint(i.Point,!1),d.RemoveNotInRangeSharedCoordinates();break}i=a}}if(null!=h){var p=l.getVectors().GetValue(e.getIsVertical()?o:r).FindSegment(e.getCoord());m=e.getIsVertical()?Directions.South:Directions.West;if(null!=p)this.RemoveEdgesBetween(c,g,m);else for(i=this.graph.FindVertex(h.getEndPoint());null!=i;){if(null==(a=i.FindNextVertex(m))||!a.Point.OperatorGreaterThan(c)){this.RemoveEdgesBetween(i.Point,g,m),h.UpdateSegmentPoint(i.Point,!0),h.RemoveNotInRangeSharedCoordinates();break}i=a}}this.RemoveUnsharedSegmentsFromVector(e)},t.prototype.RemoveEdgesBetween=function(t,e,i){var a,n,o=this.graph.FindVertex(t);if(null!=o){for(a=o.FindNextVertex(i),n=!!t.OperatorLessThan(e);null!=a&&(n&&a.Point.OperatorLessThan(e)||!n&&a.Point.OperatorGreaterThan(e));)Extensions.ContainsKey(this.vertexToRemove,a.Point)||(this.vertexToRemove=Extensions.add(this.vertexToRemove,a.Point,a)),this.graph.RemoveEdge(o,a),a=(o=a).FindNextVertex(i);null!=a&&this.graph.RemoveEdge(o,a)}},t.prototype.ConnectSegmentDelegate=function(t,e){for(var i,a,n,o,s,r,l,d,h,g,c,u,m=e?this.verticalSegmentTree:this.horizontalSegmentTree,p=Utility.ToRoundedInt(t.top()),f=Utility.ToRoundedInt(t.bottom()),_=Utility.ToRoundedInt(t.left()),v=Utility.ToRoundedInt(t.right()),y=m.getIsVertical()?Utility.ToRoundedInt(t.left()):Utility.ToRoundedInt(t.top()),b=m.getIsVertical()?Utility.ToRoundedInt(t.right()):Utility.ToRoundedInt(t.bottom()),x=m.getVectors().IndexOfKey(y),D=m.getVectors().IndexOfKey(b),C=x+1;C<D;){var z=m.getVectors().GetValue(m.getVectors().KeyAt(C)),S=z.FindSegment(e?p:_),P=z.FindSegment(e?f:v),w=e?Directions.North:Directions.East;if(S!=P)if(null!=S&&(i=S.getEndPoint(),n=e?Utility.ToRoundedInt(i.y):Utility.ToRoundedInt(i.x),S.RemoveSharedCoordinates(n)),null!=P&&(a=P.getStartPoint(),n=e?Utility.ToRoundedInt(a.y):Utility.ToRoundedInt(a.x),P.RemoveSharedCoordinates(n)),null!=S&&null!=P){for(S.UpdateSegmentPoint(P.getEndPoint(),!1),u=0;u<P.getSharedCoordinates().Count();u++)o=P.getSharedCoordinates().KeyAt(u),s=P.getSharedCoordinates().GetValue(o),S.getSharedCoordinates().Add(s,o);P.getSharedCoordinates().Clear(),this.RefreshSegmentEgdes(S),z.RemoveSegmentFromVector(P)}else if(null!=S){if(null==(l=this.GetMaximumVisibility(S.getEndPoint(),w))&&(d=w==Directions.East?new Point(v,S.getEndPoint().y):new Point(S.getEndPoint().x,f),null!=(l=this.GetMaximumVisibility(d,Extensions.OppositeDirection(w)))&&(l.StartPoint.equals(S.getStartPoint())||l.StartPoint.equals(S.getEndPoint()))?null==(h=this.GetMaximumVisibility(d,w))||h.StartPoint.equals(h.EndPoint)?l=null:l.EndPoint=h.EndPoint:l=null),null!=l)if(r=null,(g=z.getSegments().IndexOf(S))<z.getSegments().size()-1&&(r=z.getSegments().get(g+1)),null!=r&&r.getStartPoint().OperatorLessThan(l.EndPoint)){for(S.UpdateSegmentPoint(r.getEndPoint(),!1),u=0;u<r.getSharedCoordinates().Count();u++)o=r.getSharedCoordinates().KeyAt(u),S.getSharedCoordinates().Add(r.getSharedCoordinates().GetValue(o),o);r.getSharedCoordinates().Clear(),this.RefreshSegmentEgdes(S),z.RemoveSegmentFromVector(r)}else S.UpdateSegmentPoint(l.EndPoint,!1),this.RefreshSegmentEgdes(S)}else if(null!=P&&(null==(l=this.GetMaximumVisibility(P.getStartPoint(),Extensions.OppositeDirection(w)))&&(d=w==Directions.East?new Point(_,P.getEndPoint().y):new Point(P.getEndPoint().x,p),null!=(l=this.GetMaximumVisibility(d,Extensions.OppositeDirection(w)))&&(l.EndPoint.equals(P.getStartPoint())||l.EndPoint.equals(P.getEndPoint()))?null==(h=this.GetMaximumVisibility(d,w))||h.StartPoint.equals(h.EndPoint)?l=null:l.StartPoint=h.StartPoint:l=null),null!=l))if(c=null,(g=z.getSegments().IndexOf(P))>0&&(c=z.getSegments().get(g-1)),null!=c&&c.getEndPoint().OperatorGreaterThan(l.StartPoint)){for(c.UpdateSegmentPoint(P.getEndPoint(),!1),u=0;u<P.getSharedCoordinates().Count();u++)o=P.getSharedCoordinates().KeyAt(u),c.getSharedCoordinates().Add(P.getSharedCoordinates().GetValue(o),o);P.getSharedCoordinates().Clear(),this.RefreshSegmentEgdes(c),z.RemoveSegmentFromVector(P)}else P.UpdateSegmentPoint(l.StartPoint,!0),this.RefreshSegmentEgdes(P);C++}},t.prototype.ExtendScanSegment=function(t,e,i){var a=i?this.graph.FindVertex(t.getStartPoint()):this.graph.FindVertex(t.getEndPoint());null!=a&&(i?this.portManager.ConnectVertices_vertex(this.AddVertex(e),a):this.portManager.ConnectVertices_vertex(a,this.AddVertex(e)))},t.prototype.ConstructVertexandEdges=function(t){for(var e=0;e<t.size();e++)this.RefreshSegmentEgdes(t.get(e))},t.prototype.DisconnectVertexandEdges=function(t){for(var e=0;e<t.getCoordsToReconstruct().size();e++)this.RemoveUnsharedSegmentsFromVector(t.getVectors().GetValue(t.getCoordsToReconstruct().get(e)));t.getCoordsToReconstruct().Clear()},t.prototype.RemoveUnsharedSegmentsFromVector=function(t){for(var e,i,a,n,o,s,r=t.getIsVertical()?this.horizontalSegmentTree:this.verticalSegmentTree,l=0;l<t.getSegments().size();){if(0!=(e=t.getSegments().get(l)).getSharedCoordinates().Count()){l++;continue}for(var d=new List,h=this.graph.FindVertex(e.getStartPoint()),g=null,c=t.getIsVertical()?Directions.North:Directions.East;null!=h;)h.Point,i=t.getIsVertical()?Utility.ToRoundedInt(h.Point.y):Utility.ToRoundedInt(h.Point.x),0!=r.getVectors().Count()&&r.getVectors().ContainsKey(i)&&(a=t.getIsVertical()?Directions.East:Directions.North,this.portManager.DisconnectVertexInDirection(h,a)?d.add(i):null!=(n=r.getVectors().GetValue(i).FindSegment(t.getCoord()))&&(this.portManager.RemoveVertexFromSegment_vertex(n,h),d.add(i))),Extensions.ContainsKey(this.vertexToRemove,h.Point)||(this.vertexToRemove=Extensions.add(this.vertexToRemove,h.Point,h)),null!=g&&this.graph.RemoveEdge(g,h),(g=h)==(h=h.FindNextVertex(c))&&(h=null);for(t.RemoveSegmentFromVector(e),o=0;o<d.size();o++)s=d.get(o),r.getVectors().ContainsKey(s)&&!r.getCoordsToReconstruct().contains(s)&&this.RemoveUnsharedSegmentsFromVector(r.getVectors().GetValue(s))}},t.prototype.RefreshSegmentEgdes=function(t){var e,i,a,n,o,s,r;if(null!=t&&0!=t.getSharedCoordinates().Count()){var l=t.getIsVertical(),d=l?Directions.North:Directions.East,h=l?this.horizontalSegmentTree:this.verticalSegmentTree,g=h.FindIndexNumber(t.getStart()),c=h.FindIndexNumber(t.getEnd()),u=t.getParentVector().getCoord();if(g!=c)for(e=this.AddVertex(t.getStartPoint()),i=Utility.ToList(h.getVectors().Items()).GetRange(g,c-g+1),a=0;a<i.size();a++)null!=(o=(n=i.get(a).value).FindSegment(u))?(r=l?new Point(u,n.getCoord()):new Point(n.getCoord(),u),s=this.AddVertex(r),this.portManager.AddVertexToSegment(o,s),0!=a&&this.portManager.ConnectVertices_vertex(e,s,1,d),e=s):a==i.size()-1&&(r=l?new Point(u,n.getCoord()):new Point(n.getCoord(),u),this.portManager.ConnectVertices_vertex(e,this.AddVertex(r),1,d))}},t.prototype.GetScanSegmentsFromBounds=function(t,e){var i,a,n,o,s,r,l=new List,d=e.getIsVertical()?this.horizontalSegmentTree:this.verticalSegmentTree,h=d.FindIndex(t.topLeft().round()),g=d.FindIndex(t.bottomRight().round()),c=Utility.ToRoundedInt(t.left()),u=e.getCoord()===c?t.topLeft():t.topRight(),m=e.getCoord()===c?t.bottomLeft():t.bottomRight();if(e.getIsVertical()||(c=Utility.ToRoundedInt(t.top()),u=e.getCoord()===c?t.topLeft():t.bottomLeft(),m=e.getCoord()===c?t.topRight():t.bottomRight()),u=u.round(),m=m.round(),h!=g)for(i=h,a=new Point;i<g;){if(null!=(n=d.getVectors().GetValue(d.getVectors().KeyAt(i))).FindSegment(e.getCoord())){var p=e.FindSegment(e.getIsVertical()?u.y:u.x),f=e.FindSegment(e.getIsVertical()?m.y:m.x),_=new Point(n.Coord,e.getCoord());e.getIsVertical()&&(_=new Point(e.getCoord(),n.Coord)),null!=p&&p.Contains(_)||null!=f&&f.Contains(_)||(o=new Point(n.Coord+1,e.getCoord()),e.getIsVertical()&&(o=new Point(e.getCoord(),n.Coord+1)),null!=p&&p.Contains(o)||null!=f&&f.Contains(o)||(null==(s=e.GetScanSegment(o))||l.contains(s)?null==s&&i>h&&(r=new Point(n.Coord-1,e.getCoord()),e.getIsVertical()&&(r=new Point(e.getCoord(),n.Coord-1)),r.equals(a)&&e.GetScanSegment_startPoint(r,_)):s.getStartPoint().equals(_)?l.add(s):e.RemoveSegmentFromVector(s))),a=_}i++}return l},t.prototype.GetPossibleEntries=function(t,e){var i,a,n,o,s,r=2,l=new List,d=new List,h=new List,g=this.portManager.FindEntrances(t),c=this.portManager.FindEntrances(e),u=t.getLocation(),m=e.getLocation();for(d.add(Extensions.FindDirection_orientation(u,m,Orientation.Horizontal)),d.add(Extensions.FindDirection_orientation(u,m,Orientation.Vertical)),a=0;a<d.size();a++)i=d.get(a),h.add(Extensions.OppositeDirection(i));for(a=0;a<g.size();a++)for(n=g.get(a),o=0;o<c.size();o++){var p=c.get(o),f=n.Point.y>p.Point.y,_=n.Point.x>p.Point.x;null!=n.getEastEdge()&&(s=d.contains(Directions.East),null!=p.getEastEdge()&&l.add(new ConnectablePath(r,n,p)),null!=p.getWestEdge()&&(s=s&&h.contains(Directions.West),r=_?4:2,l.add(new ConnectablePath(r,n,p,s))),null!=p.getSouthEdge()&&(s=s&&h.contains(Directions.South),r=f||_?3:1,l.add(new ConnectablePath(r,n,p,s))),null!=p.getNorthEdge()&&(s=s&&h.contains(Directions.North),r=f&&!_?1:3,l.add(new ConnectablePath(r,n,p,s)))),null!=n.getWestEdge()&&(s=d.contains(Directions.West),null!=p.getWestEdge()&&l.add(new ConnectablePath(r,n,p)),null!=p.getEastEdge()&&(s=s&&h.contains(Directions.East),r=_?2:4,l.add(new ConnectablePath(r,n,p,s))),null!=p.getSouthEdge()&&(s=s&&h.contains(Directions.South),r=!f&&_?1:3,l.add(new ConnectablePath(r,n,p,s))),null!=p.getNorthEdge()&&(s=s&&h.contains(Directions.North),r=f&&_?1:3,l.add(new ConnectablePath(r,n,p,s)))),null!=n.getNorthEdge()&&(s=d.contains(Directions.North),null!=p.getNorthEdge()&&l.add(new ConnectablePath(r,n,p)),null!=p.getSouthEdge()&&(s=s&&h.contains(Directions.South),r=f?4:2,l.add(new ConnectablePath(r,n,p,s))),null!=p.getEastEdge()&&(s=s&&h.contains(Directions.East),r=!f&&_?1:3,l.add(new ConnectablePath(r,n,p,s))),null!=p.getWestEdge()&&(s=s&&h.contains(Directions.West),r=f||_?3:1,l.add(new ConnectablePath(r,n,p,s)))),null!=n.getSouthEdge()&&(s=d.contains(Directions.South),null!=p.getSouthEdge()&&l.add(new ConnectablePath(r,n,p)),null!=p.getNorthEdge()&&(s=s&&h.contains(Directions.North),r=f?2:4,l.add(new ConnectablePath(r,n,p,s))),null!=p.getEastEdge()&&(s=s&&h.contains(Directions.East),r=_&&f?1:3,l.add(new ConnectablePath(r,n,p,s))),null!=p.getWestEdge()&&(s=s&&h.contains(Directions.West),r=f&&!_?1:3,l.add(new ConnectablePath(r,n,p,s))))}return this.sortPossibleEntries(l)},t.prototype.sortPossibleEntries=function(t){for(var e,i=new List,a=new List,n=0;n<t.size();n++)(e=t.get(n)).getIsPreferred()?a.add(e):i.add(e);return i.sortByKey("MinimalBend"),a.sortByKey("MinimalBend"),t.Clear(),t.AddRange(a),t.AddRange(i),t},t}(),ConnectablePath=function(){function t(t,e,i,a){void 0===a&&(a=!1),this.m_MinimalBend=t,this.m_SourceEntry=e,this.m_TargetEntry=i,this.m_IsPreferred=a}return t.prototype.getMinimalBend=function(){return this.m_MinimalBend},t.prototype.getIsPreferred=function(){return this.m_IsPreferred},t.prototype.getSourceEntry=function(){return this.m_SourceEntry},t.prototype.getTargetEntry=function(){return this.m_TargetEntry},t}(),SegmentTree=function(){function t(t,e){this._mStart=Number.MAX_VALUE,this._mEnd=Number.MIN_VALUE,this._mIsVertical=!1,this.unUsedVectors=new List,this._mIsVertical=t,this._mOrientation=t?SegmentOrientation.Vertical:SegmentOrientation.Horizontal,this._mRouter=e,this._mVectors=new SortedList,this._mCoordsToReconstruct=new List}return t.prototype.getStart=function(){return this._mStart},t.prototype.setStart=function(t){this._mStart=Math.floor(t)},t.prototype.getEnd=function(){return this._mEnd},t.prototype.setEnd=function(t){this._mEnd=Math.floor(t)},t.prototype.getIsVertical=function(){return this._mIsVertical},t.prototype.getOrientation=function(){return this._mOrientation},t.prototype.getCoordsToReconstruct=function(){return this._mCoordsToReconstruct},t.prototype.setCoordsToReconstruct=function(t){this._mCoordsToReconstruct=null!=t?t:new List},t.prototype.getVectors=function(){return this._mVectors},t.prototype.setVectors=function(t){this._mVectors=null!=t?t:new SortedList},t.prototype.getPerpendicularTree=function(){return this._mPerpendicularTree},t.prototype.setPerpendicularTree=function(t){this._mPerpendicularTree=t},t.prototype.getRouter=function(){return this._mRouter},t.prototype.setRouter=function(t){this._mRouter=t},t.prototype.UpdateTreePoints=function(){if(0!=this._mVectors.Count()){var t=this._mVectors.GetValue(this._mVectors.KeyAt(0)),e=this._mVectors.GetValue(this._mVectors.KeyAt(this._mVectors.Count()-1));this.UpdateTreePoint(t.getStart(),!0),this.UpdateTreePoint(e.getEnd(),!1)}else this.UpdateTreePoint(Number.MAX_VALUE,!0),this.UpdateTreePoint(Number.MIN_VALUE,!1)},t.prototype.UpdateTreePoint=function(t,e,i){void 0===i&&(i=!1),e&&this._mStart!=t?this._mStart=t:e||this._mEnd==t||(this._mEnd=t),i||0!=this._mVectors.Count()||(e?this._mStart=Number.MAX_VALUE:this._mEnd=Number.MIN_VALUE)},t.prototype.ExpandOrCollapseSegmentTree=function(t,e,i){var a,n;if(void 0===i&&(i=!1),i)for(a in this._mVectors.Items())n=this._mVectors.ElementAt(a),this._mStart!=t&&n.ExpandSegmentVector(t,this._mStart,!0),this._mEnd!=e&&n.ExpandSegmentVector(e,this._mEnd,!1);this.UpdateTreePoint(t,!0,i),this.UpdateTreePoint(e,!1,i)},t.prototype.InitializeVectorCoordinate=function(t){var e,i=this._mIsVertical?Utility.ToRoundedInt(t.left()):Utility.ToRoundedInt(t.top());this._mVectors.ContainsKey(i)||(this._mVectors.Add(new SegmentVector(i,this._mStart,this._mEnd,this._mOrientation,this),i),this.unUsedVectors.add(i)),e=this._mIsVertical?Utility.ToRoundedInt(t.right()):Utility.ToRoundedInt(t.bottom()),this._mVectors.ContainsKey(e)||(this._mVectors.Add(new SegmentVector(e,this._mStart,this._mEnd,this._mOrientation,this),e),this.unUsedVectors.add(e))},t.prototype.RemoveVectorCoordinate=function(t,e){void 0===e&&(e=!1),0==t.getSegments().size()&&(this._mVectors.Remove(t.getCoord()),t=null,e&&this.UpdateTreePoints())},t.prototype.InsertObstacle=function(t){var e,i,a=new List;for(a.add(this._mIsVertical?Utility.ToRoundedInt(t.left()):Utility.ToRoundedInt(t.top())),a.add(this._mIsVertical?Utility.ToRoundedInt(t.right()):Utility.ToRoundedInt(t.bottom())),e=0;e<a.size();e++){var n=a.get(e),o=this._mVectors.GetValue(n),s=o.InsertObstacle(t);if(o.UpdateVectorPoints(),0!=s.size()){for(i=0;i<s.size();i++)this._mRouter.RefreshSegmentEgdes(s.get(i));this.unUsedVectors.contains(n)&&this.unUsedVectors.Remove(n)}}},t.prototype.RemoveObstacle=function(t){var e=new List,i=new List,a=Math.floor(this._mIsVertical?t.left():t.top()),n=Math.floor(this._mIsVertical?t.right():t.bottom());return this._mVectors.ContainsKey(a)&&(this._mCoordsToReconstruct.add(Math.floor(a)),e=this._mVectors.GetValue(a).RemoveObstacle(t,e).SegCollection),this._mVectors.ContainsKey(n)&&(this._mCoordsToReconstruct.add(Math.floor(n)),i=this._mVectors.GetValue(n).RemoveObstacle(t,i).SegCollection),null},t.prototype.SplitSegments=function(t){for(var e,i=this._mIsVertical?Utility.ToRoundedInt(t.left()):Utility.ToRoundedInt(t.top()),a=this._mIsVertical?Utility.ToRoundedInt(t.right()):Utility.ToRoundedInt(t.bottom()),n=this._mVectors.IndexOfKey(i),o=this._mVectors.IndexOfKey(a),s=n+1;s<o;s++)(e=this._mVectors.GetValue(this._mVectors.KeyAt(s))).SplitSegment(t),this._mRouter.SplitSegment(t,e)},t.prototype.RemoveUnUsedVector=function(){for(var t=0;t<this.unUsedVectors.size();t++)this.RemoveVectorCoordinate(this._mVectors.GetValue(this.unUsedVectors.get(t)),null);this.unUsedVectors.Clear()},t.prototype.UpdateUnUsedVector=function(t){this.unUsedVectors.contains(t)||this.unUsedVectors.add(t)},t.prototype.FindLast=function(t){var e,i,a,n,o,s,r,l=0,d=0,h=this._mVectors.Count()-1,g=null;if(this._mIsVertical){for(i=t.x-1e-5;h-d>1;)l=Math.floor((d+h)/2),(a=this._mVectors.ElementAt(l))&&a.getCoord()<i?d=l:h=l;if((n=this._mVectors.ElementAt(h))&&i>n.getCoord()&&(d=h),(o=this._mVectors.ElementAt(d))&&i>o.getCoord()){for(;d>-1&&(this._mVectors.ElementAt(d).GetStart().y>t.y||this._mVectors.ElementAt(d).GetEnd().y<t.y);)d--;d>-1&&(g=this._mVectors.ElementAt(d))}if(null!=g)for(s=d;s>=0;){if(null!=(r=this._mVectors.ElementAt(s).FindSegment(Utility.ToRoundedInt(t.y))))return r;s--}}else{for(i=t.y-1e-5;h-d>1;)l=Math.floor((d+h)/2),(e=this._mVectors.ElementAt(l))&&e.getCoord()<i?d=Math.floor(l):h=Math.floor(l);if((e=this._mVectors.ElementAt(h))&&i>e.getCoord()&&(d=Math.floor(h)),(e=this._mVectors.ElementAt(d))&&i>e.getCoord()){for(;d>-1&&(this._mVectors.ElementAt(d).GetStart().x>t.x||this._mVectors.ElementAt(d).GetEnd().x<t.x);)d--;d>-1&&(g=this._mVectors.ElementAt(d))}if(null!=g)for(s=d;s>=0;){if(null!=(r=this._mVectors.ElementAt(s).FindSegment(Utility.ToRoundedInt(t.x))))return r;s--}}return null},t.prototype.FindFirst=function(t){var e,i,a,n,o=0,s=0,r=this._mVectors.Count()-1,l=null;if(this._mIsVertical){for(e=t.x+1e-4;r-s>1;)o=Math.floor((s+r)/2),(i=this._mVectors.ElementAt(o))&&i.getCoord()<e?s=o:r=o;if((i=this._mVectors.ElementAt(s))&&e<=i.getCoord()&&(r=s),(i=this._mVectors.ElementAt(r))&&e<=i.getCoord()){for(;r<this._mVectors.Count()&&(this._mVectors.ElementAt(r).GetStart().y>t.y||this._mVectors.ElementAt(r).GetEnd().y<t.y);)r++;r<this._mVectors.Count()&&(l=this._mVectors.ElementAt(r))}if(null!=l)for(a=r;a<this._mVectors.Count();){if(null!=(n=this._mVectors.ElementAt(a).FindSegment(Utility.ToRoundedInt(t.y))))return n;a++}}else{for(e=t.y+1e-5;r-s>1;)o=Math.floor((s+r)/2),(i=this._mVectors.ElementAt(o))&&i.getCoord()<e?s=Math.floor(o):r=Math.floor(o);if((i=this._mVectors.ElementAt(s))&&e<=i.getCoord()&&(r=Math.floor(s)),(i=this._mVectors.ElementAt(r))&&e<i.getCoord()){for(;r<this._mVectors.Count()&&(this._mVectors.ElementAt(r).GetStart().x>t.x||this._mVectors.ElementAt(r).GetEnd().x<t.x);)r++;r<this._mVectors.Count()&&(l=this._mVectors.ElementAt(r))}if(null!=l)for(a=r;a<this._mVectors.Count();){if(null!=(n=this._mVectors.ElementAt(a).FindSegment(Utility.ToRoundedInt(t.x))))return n;a++}}return null},t.prototype.FindIndex=function(t){if(this._mIsVertical){if(this._mVectors.ContainsKey(Utility.ToRoundedInt(t.x)))return this._mVectors.IndexOfKey(Utility.ToRoundedInt(t.x))}else if(this._mVectors.ContainsKey(Utility.ToRoundedInt(t.y)))return this._mVectors.IndexOfKey(Utility.ToRoundedInt(t.y));return-1},t.prototype.FindIndexNumber=function(t){return this._mVectors.ContainsKey(t)?this._mVectors.IndexOfKey(t):0},t.prototype.FindFirstIndex=function(t){var e,i=0,a=0,n=this._mVectors.Count()-1;if(this._mIsVertical){for(e=t.x+1e-4;n-a>1;)i=Math.floor((a+n)/2),this._mVectors.ElementAt(i).Coord<e?a=Math.floor(i):n=Math.floor(i);if(e<=this._mVectors.ElementAt(a).Coord&&(n=Math.floor(a)),e<=this._mVectors.ElementAt(n).Coord){for(;n<this._mVectors.Count()&&(this._mVectors.ElementAt(n).GetStart().y>t.y||this._mVectors.ElementAt(n).GetEnd().y<t.y);)n++;if(n<this._mVectors.Count())return n}}else{for(e=t.y+1e-5;n-a>1;)i=Math.floor((a+n)/2),this._mVectors.ElementAt(i).Coord<e?a=Math.floor(i):n=Math.floor(i);if(e<=this._mVectors.ElementAt(a).Coord&&(n=a),e<this._mVectors.ElementAt(n).Coord){for(;n<this._mVectors.Count()&&(this._mVectors.ElementAt(n).GetStart().x>t.x||this._mVectors.ElementAt(n).GetEnd().x<t.x);)n++;if(n<this._mVectors.Count())return n}}return-1},t.prototype.FindSegment=function(t,e,i){if(t<this._mVectors.Count()&&t>=0){var a=Utility.ToRoundedInt(e.y);return this._mIsVertical||(a=Utility.ToRoundedInt(e.x)),i=this._mVectors.ElementAt(t),this._mVectors[i].FindSegment(a)}return null},t.prototype.FindScanSegment=function(t){if(this._mIsVertical){if(this._mVectors.ContainsKey(Utility.ToRoundedInt(t.y)))return this._mVectors[Utility.ToRoundedInt(t.y)].FindSegment(Utility.ToRoundedInt(t.x))}else if(this._mVectors.ContainsKey(Utility.ToRoundedInt(t.x)))return this._mVectors[Utility.ToRoundedInt(t.x)].FindSegment(Utility.ToRoundedInt(t.y));return null},t.prototype.GetEdgePassingThroughVertex=function(t,e){var i,a,n=t.Point,o=this._mVectors.IndexOfKey(this._mIsVertical?Utility.ToRoundedInt(n.x):Utility.ToRoundedInt(n.y));if(-1!=o){var s=this._mIsVertical?Directions.East:Directions.North,r=null,l=null,d=this._mRouter.graph;for(i=o-1;i>=0;i--)if(a=Number(this._mVectors.KeyAt(i)),null!=(r=this._mIsVertical?d.FindVertexNumber(a,e):d.FindVertexNumber(e,a))&&null!=(l=r.FindNextVertex(s)))return this._mIsVertical?r.getEastEdge():r.getNorthEdge();for(i=o+1;i<=this._mVectors.Count()-1;i++)if(a=Number(this._mVectors.KeyAt(i)),null!=(l=this._mIsVertical?d.FindVertexNumber(a,e):d.FindVertexNumber(e,a))&&null!=(r=l.FindNextVertex(Extensions.OppositeDirection(s))))return this._mIsVertical?r.getEastEdge():r.getNorthEdge()}return null},t}(),SegmentVector=function(){function t(t,e,i,a,n){this._mStart=0,this._mEnd=0,this._mCoord=0,this._mIsVertical=!1,this._mCoord=t,this._mStart=e,this._mEnd=i,this._mParentTree=n,this._mOrientation=a,this._mIsVertical=this._mOrientation==SegmentOrientation.Vertical,this._mSegments=new List}return t.prototype.getStart=function(){return this._mStart},t.prototype.setStart=function(t){this._mStart=t},t.prototype.getEnd=function(){return this._mEnd},t.prototype.setEnd=function(t){this._mEnd=t},t.prototype.getCoord=function(){return this._mCoord},t.prototype.setCoord=function(t){this._mCoord=Math.floor(t)},t.prototype.getSegments=function(){return this._mSegments},t.prototype.setSegments=function(t){this._mSegments=t},t.prototype.getOrientation=function(){return this._mOrientation},t.prototype.getIsVertical=function(){return this._mIsVertical},t.prototype.getParentTree=function(){return this._mParentTree},t.prototype.UpdateVectorPoints=function(t){if(void 0===t&&(t=!1),0!=this._mSegments.size()){var e=this._mSegments.get(0),i=this._mSegments.get(this._mSegments.size()-1);this.UpdateVectorPoint(e.getStart(),!0,t),this.UpdateVectorPoint(i.getEnd(),!1,t)}},t.prototype.UpdateVectorPoint=function(t,e,i){void 0===i&&(i=!1);var a=!1;e&&this._mStart!=t?(this._mStart=t,a=!0):e||this._mEnd==t||(this._mEnd=t,a=!0),a&&null!=this._mParentTree&&!i&&this._mParentTree.UpdateTreePoints()},t.prototype.AddSegmentToVector=function(t,e){var i,a,n;if(void 0===e&&(e=-1),-1==e){e=0;var o=0,s=this._mSegments.size()-1,r=t.getStart();if(1==this._mSegments.size())r>=this._mSegments.get(0).getStart()&&e++;else if(this._mSegments.size()>1){for(;s-o>1;)i=Math.floor((o+s)/2),r>=this._mSegments.get(i).getStart()?o=Math.floor(i):s=Math.floor(i);a=this._mSegments.get(o),n=this._mSegments.get(s),e=r<a.getStart()?Math.floor(o):r>n.getStart()?s+1:s}}this._mSegments.Insert(e,t),this.UpdateVectorPoints()},t.prototype.RemoveSegmentFromVector=function(t){0!=this._mSegments.size()&&(0==t.getSharedCoordinates().Count()||t.getStart()===t.getEnd())&&(this._mSegments.Remove(t),t=null,this.UpdateVectorPoints()),0==this._mSegments.size()&&this._mParentTree.UpdateUnUsedVector(this._mCoord)},t.prototype.ExpandSegmentVector=function(t,e,i){var a;if(0!=this._mSegments.size()){var n=i?this._mSegments.get(0):this._mSegments.get(this._mSegments.size()-1),o=i?n.getStartPoint():n.getEndPoint(),s=i?n.getStart():n.getEnd();s===e&&s!==t&&(a=this._mIsVertical?new Point(o.x,t):new Point(t,o.y),this._mParentTree.getRouter().ExtendScanSegment(n,a,i),n.UpdateSegmentPoint(a,i,!0))}},t.prototype.InsertObstacle=function(t){var e,i,a,n=Utility.ToRoundedInt(t.top()),o=Utility.ToRoundedInt(t.bottom()),s=Utility.ToRoundedInt(t.left()),r=Utility.ToRoundedInt(t.right()),l=null,d=null,h=this._mIsVertical?new Point(this._mCoord,n):new Point(s,this._mCoord),g=this._mIsVertical?new Point(this._mCoord,o):new Point(r,this._mCoord),c=this._mIsVertical?n:s,u=this._mIsVertical?o:r;if((null==(l=d=this.GetScanSegment(h))||l.getEnd()<u)&&(d=this.GetScanSegment(g)),null!=l&&(l.UpdateSharedCoordinates(c),(l.getEnd()<u||null==d&&l.getEnd()==u)&&l.UpdateSharedCoordinates(l.getEnd())),null!=d&&(d.UpdateSharedCoordinates(u),(d.getStart()>c||null==l&&d.getStart()==c)&&d.UpdateSharedCoordinates(d.getStart())),0!=(e=this.GetScanSegmentsFromBounds(t,l,d)).size())for(i=0;i<e.size();i++)(a=e.get(i))!=l&&a!=d&&(a.UpdateSharedCoordinates(a.getStart()),a.UpdateSharedCoordinates(a.getEnd()));return null!=l&&e.Insert(0,l),l!=d&&e.Insert(e.size(),d),e},t.prototype.RemoveObstacle_Where=function(t,e,i){for(var a,n,o=[],s=this._mSegments.size(),r=0;r<s;r++)a=t.get(r),o.push(a);for(o.sort(function(t){return t.getStart()>e&&t.getEnd()<i?1:-1}),n=new List,r=0;r<o.length;r++)n.add(o[r]);return n},t.prototype.RemoveObstacle=function(t,e){var i,a,n,o=Utility.ToRoundedInt(t.top()),s=Utility.ToRoundedInt(t.bottom()),r=Utility.ToRoundedInt(t.left()),l=Utility.ToRoundedInt(t.right());e=new List;var d=this._mIsVertical?o:r,h=this._mIsVertical?s:l,g=this.FindSegment(d),c=this.FindSegment(h);if(null!=g&&(e.add(g),g.RemoveSharedCoordinates(d),g.getEnd()<h&&g.RemoveSharedCoordinates(g.getEnd())),null!=c&&(e.contains(c)||e.add(c),c.RemoveSharedCoordinates(h),c.getStart()>d&&c.RemoveSharedCoordinates(c.getStart())),0!=(i=this.RemoveObstacle_Where(this._mSegments,d,h)).size())for(a=0;a<i.size();a++)for(var u=i.get(a),m=0,p=Object.keys(u.getSharedCoordinates());m<p.length;)n=Number(p[m]),u.RemoveSharedCoordinates(n),m++;return{isRemove:!1,SegCollection:e}},t.prototype.SplitSegment=function(t){var e,i,a,n;if(0!=this._mSegments.size()){var o=Utility.ToRoundedInt(t.top()),s=Utility.ToRoundedInt(t.bottom()),r=Utility.ToRoundedInt(t.left()),l=Utility.ToRoundedInt(t.right()),d=this._mIsVertical?o:r,h=this._mIsVertical?s:l,g=null,c=null;if((null==(g=c=this.FindSegment(d))||g.getEnd()<h)&&(c=this.FindSegment(h)),e=this._mIsVertical?new Point(this._mCoord,o):new Point(r,this._mCoord),i=this._mIsVertical?new Point(this._mCoord,s):new Point(l,this._mCoord),null!=g&&null!=c&&g==c?((c=this.GetScanSegment_startPoint(i,g.getEndPoint(),this._mSegments.IndexOf(g)+1)).setSharedCoordinates(g.getSharedCoordinates().Clone()),g.UpdateSegmentPoint(e,!1)):(null!=g&&g.UpdateSegmentPoint(e,!1),null!=c&&c.UpdateSegmentPoint(i,!0)),null!=g&&g.RemoveNotInRangeSharedCoordinates(),null!=c&&c.RemoveNotInRangeSharedCoordinates(),0!=(a=this.SplitSegment_Where(d,h)).size())for(n=0;n<a.size();n++)a.get(n).getSharedCoordinates().Clear()}},t.prototype.SplitSegment_Where=function(t,e){for(var i,a=new List,n=0;n<this._mSegments.size();n++)(i=this._mSegments.get(n)).getStart()>t&&i.getEnd()<e&&a.add(i);return a},t.prototype.GetScanSegmentsFromBounds=function(t,e,i){var a,n,o,s,r,l,d=new List;if(null!=e&&null!=i&&e==i)return d;if(0!=(a=this._mParentTree.getPerpendicularTree()).getVectors().Count())for(var h=a.FindIndex(t.topLeft().round()),g=a.FindIndex(t.bottomRight().round()),c=h,u=null;c<g;)n=Number(a.getVectors().KeyAt(c)),o=this._mIsVertical?new Point(this._mCoord,n):new Point(n,this._mCoord),null!=e&&e.Contains(o)||null!=i&&i.Contains(o)||null!=a.getVectors().GetValue(n).FindSegment(this._mCoord)&&(s=this._mIsVertical?new Point(this._mCoord,n+1):new Point(n+1,this._mCoord),null!=e&&e.Contains(s)||null!=i&&i.Contains(s)||(null==(r=this.GetScanSegment(s))||d.contains(r)?null==r&&c>h&&(l=this._mIsVertical?new Point(this._mCoord,n-1):new Point(n-1,this._mCoord),null!=u&&l.equals(u)&&this.GetScanSegment_startPoint(l,o)):r.getStartPoint().equals(o)?d.add(r):this.RemoveSegmentFromVector(r)),u=o),c++;return d},t.prototype.GetScanSegment=function(t){var e,i,a,n,o=null;return 0!=this._mSegments.size()&&(e=this._mIsVertical?Utility.ToRoundedInt(t.y):Utility.ToRoundedInt(t.x),o=this.FindSegment(e)),null==o&&null!=this._mParentTree&&(i=this._mIsVertical?Directions.South:Directions.West,null!=(a=this._mParentTree.getRouter().GetMaximumVisibility(t,i))&&(null!=(n=this._mParentTree.getRouter().GetMaximumVisibility(t,Extensions.OppositeDirection(i)))&&(a.EndPoint=n.EndPoint),a.StartPoint.OperatorNotEqual(a.EndPoint)&&(o=new ScanSegment(a.StartPoint,a.EndPoint,this._mOrientation,this),this.AddSegmentToVector(o)))),o},t.prototype.GetScanSegment_startPoint=function(t,e,i){void 0===i&&(i=-1);var a=null;return-1==i&&0!=this._mSegments.size()&&(null==(a=this.FindSegment(this._mIsVertical?Utility.ToRoundedInt(t.y):Utility.ToRoundedInt(t.x)))&&(a=this.FindSegment(this._mIsVertical?Utility.ToRoundedInt(e.y):Utility.ToRoundedInt(e.x)))),null==a&&null!=this._mParentTree&&(a=new ScanSegment(t,e,this._mOrientation,this),this.AddSegmentToVector(a,i)),a},t.prototype.FindSegment=function(t){var e=null;return 0!=this._mSegments.size()&&(e=this.GetSegmentIndex(t,e).segment),e},t.prototype.GetSegmentIndex=function(t,e){if(e=null,this._mStart<=t&&this._mEnd>=t){for(var i=0,a=this._mSegments.size()-1,n=-1;a-i>1;)n=Math.floor((i+a)/2),t>=this._mSegments.get(n).getStart()?i=n:a=n;if(i>=0&&a>=0){if(this._mSegments.get(i).getEnd()>=t)return{index:i,segment:e=this._mSegments.get(i)};if(this._mSegments.get(a).getStart()<=t)return{index:a,segment:e=this._mSegments.get(a)}}}return{index:-1,segment:e}},t.prototype.GetStart=function(){return this._mIsVertical?new Point(this._mCoord,this._mStart):new Point(this._mStart,this._mCoord)},t.prototype.GetEnd=function(){return this._mIsVertical?new Point(this._mCoord,this._mEnd):new Point(this._mEnd,this._mCoord)},t}(),ScanSegment=function(){function t(t,e,i,a){this._mIsVertical=!1,this._mStart=0,this._mEnd=0,this._mStartPoint=t.round(),this._mEndPoint=e.round(),this._mSharedCoordinates=new SortedList,this._mParentVector=a,this._mOrientation=i,this._mIsVertical=this._mOrientation==SegmentOrientation.Vertical,this._mStart=this._mIsVertical?this._mStartPoint.y:this._mStartPoint.x,this._mEnd=this._mIsVertical?this._mEndPoint.y:this._mEndPoint.x}return t.prototype.getStart=function(){return Math.floor(this._mStart)},t.prototype.getEnd=function(){return Math.floor(this._mEnd)},t.prototype.getStartPoint=function(){return this._mStartPoint},t.prototype.getEndPoint=function(){return this._mEndPoint},t.prototype.getOrientation=function(){return this._mOrientation},t.prototype.getIsVertical=function(){return this._mIsVertical},t.prototype.getSharedCoordinates=function(){return this._mSharedCoordinates},t.prototype.setSharedCoordinates=function(t){this._mSharedCoordinates=null!=t?t:new SortedList},t.prototype.getParentVector=function(){return this._mParentVector},t.prototype.Contains=function(t){var e=this._mIsVertical?Utility.ToRoundedInt(t.y):Utility.ToRoundedInt(t.x);return e>=this._mStart&&e<=this._mEnd},t.prototype.UpdateSegmentPoint=function(t,e,i){void 0===i&&(i=!1);var a=!1;t=t.round(),e&&!this._mStartPoint.equals(t)?(this._mStartPoint=t,this._mStart=this._mIsVertical?this._mStartPoint.y:this._mStartPoint.x,a=!0):e||this._mEndPoint.equals(t)||(this._mEndPoint=t,this._mEnd=this._mIsVertical?this._mEndPoint.y:this._mEndPoint.x,a=!0),a&&null!=this._mParentVector&&this._mParentVector.UpdateVectorPoints(i)},t.prototype.UpdateSharedCoordinates=function(t){this._mSharedCoordinates.ContainsKey(t)?this._mSharedCoordinates.Update(t,this._mSharedCoordinates.GetValue(t)+1):this._mSharedCoordinates.Add(1,t)},t.prototype.RemoveSharedCoordinates=function(t){this._mSharedCoordinates.ContainsKey(t)&&(this._mSharedCoordinates.Update(t,this._mSharedCoordinates.GetValue(t)-1),0==this._mSharedCoordinates.GetValue(t)&&this._mSharedCoordinates.Remove(t))},t.prototype.RemoveNotInRangeSharedCoordinates=function(){var t,e,i,a;if(0!=this._mSharedCoordinates.Count()){var n=this._mStart,o=this._mEnd,s=null,r=null;if(n===o)this._mSharedCoordinates.Clear();else{for(t=0;t<this._mSharedCoordinates.Count();)(e=Number(this._mSharedCoordinates.KeyAt(t)))<n||e>o?(this._mSharedCoordinates.ContainsKey(e)&&this._mSharedCoordinates.Remove(e),e<n?s=e:null==r&&(r=e)):t++;this._mSharedCoordinates.Count()%2!=0&&(null!=s&&((i=Number(this._mSharedCoordinates.KeyAt(0)))>n?this.UpdateSharedCoordinates(n):i==n&&this.RemoveSharedCoordinates(n)),null!=r&&((a=Number(this._mSharedCoordinates.KeyAt(this._mSharedCoordinates.Count()-1)))<o?this.UpdateSharedCoordinates(o):a==o&&this.RemoveSharedCoordinates(o)))}}},t}(),VisibilityGraphGeneration=function(){function t(){}return t.getRouter=function(){return this.router},t.setRouter=function(t){this.router=t},t.GetVertices=function(){var t,e,i=[];if(this.router.graph)for(t=this.router.graph.getVertices(),e=0;e<t.length;e++)i.push(new Point(t[e].Point.x,t[e].Point.y));return i},t.GetSegmentTree=function(){new Point(this.router.getHorizontalSegmentTree().getStart(),this.router.getVerticalSegmentTree().getStart());for(var t,e,i=ej.util.getObject("drawLine",window),a=0;a<this.router.getHorizontalSegmentTree().getVectors().Count();a++)for(t=this.router.getHorizontalSegmentTree().getVectors().GetValue(this.router.getHorizontalSegmentTree().getVectors().KeyAt(a)),e=0;e<t.getSegments().size();e++){var n=t.getSegments().get(e),o=n.getStartPoint(),s=n.getEndPoint();i(new Tuple(new Point(o.x,o.y),new Point(s.x,s.y)))}for(a=0;a<this.router.getVerticalSegmentTree().getVectors().Count();a++)for(t=this.router.getVerticalSegmentTree().getVectors().GetValue(this.router.getVerticalSegmentTree().getVectors().KeyAt(a)),e=0;e<t.getSegments().size();e++)o=(n=t.getSegments().get(e)).getStartPoint(),s=n.getEndPoint(),i(new Tuple(new Point(o.x,o.y),new Point(s.x,s.y)));return[]},t.GetEdges=function(){var t,e,i,a=[];if(this.router.graph)for(t=this.router.graph.getEdges(),e=0;e<t.size();e++)i=t.get(e),a.push(new Tuple(new Point(i.getSource().Point.x,i.getSource().Point.y),new Point(i.getTarget().Point.x,i.getTarget().Point.y)));return a},t.router=new Router,t}(),IObstaclePort=function(){function t(){}return t.prototype.getLocation=function(){return this.Location},t.prototype.setLocation=function(t){this.Location=t},t.prototype.getDirection=function(){return this.Direction},t.prototype.setDirection=function(t){this.Direction=t},t}(),Obstacle=function(){function t(){this.isBorder=!1}return t.prototype.getPaddedBounds=function(){return this._mPaddedRegion},t.prototype.setPaddedBounds=function(t){var e,i;this._mPaddedRegion=t,null!=this._mPaddedRegion&&this._mPaddedRegion!=Rect.empty&&(e=this._mPaddedRegion,this.topLeft=new PolylinePoint(e.topLeft()),this.topRight=new PolylinePoint(e.topRight()),this.bottomLeft=new PolylinePoint(e.bottomLeft()),this.bottomRight=new PolylinePoint(e.bottomRight()),null!=this._mActualBounds&&(0==(i=this._mActualBounds).width?(this.topLeft.setNext(this.bottomLeft),this.topLeft.setPrev(this.bottomLeft),this.topRight.setNext(this.bottomLeft),this.topRight.setPrev(this.bottomLeft),this.bottomLeft.setNext(this.topLeft),this.bottomLeft.setPrev(this.topLeft),this.bottomRight.setNext(this.topLeft),this.bottomRight.setPrev(this.topLeft)):0==i.height?(this.topLeft.setNext(this.topRight),this.topLeft.setPrev(this.topRight),this.bottomLeft.setNext(this.topRight),this.bottomLeft.setPrev(this.topRight),this.topRight.setNext(this.topLeft),this.topRight.setPrev(this.topLeft),this.bottomRight.setNext(this.topLeft),this.bottomRight.setPrev(this.topLeft)):(this.topLeft.setPrev(this.topRight),this.topRight.setPrev(this.bottomRight),this.bottomRight.setPrev(this.bottomLeft),this.bottomLeft.setPrev(this.topLeft),this.topLeft.setNext(this.bottomLeft),this.bottomLeft.setNext(this.bottomRight),this.bottomRight.setNext(this.topRight),this.topRight.setNext(this.topLeft)),this.StartVertex=this.topLeft))},t.prototype.getActualBounds=function(){return this._mActualBounds},t.prototype.setActualBounds=function(t){this._mActualBounds=t},t.prototype._obstacle=function(t,e,i){return void 0===e&&(e=12),void 0===i&&(i=!0),0==i&&(this.isBorder=!0),this.SetRegion(t,e),this},t.prototype.CreateInitialSides=function(t,e){this.LowSide=new ObstacleSide(this,t,e,ScanDirection.Right==e),this.LowSide.SideType=ObstacleSideType.Low,this.HighSide=new ObstacleSide(this,t,e,ScanDirection.Top==e),this.HighSide.SideType=ObstacleSideType.High,Utility.CheckWithScanDirection(e,this.HighSide.getStart(),this.HighSide.getEnd())&&(this.HighSide=new ObstacleSide(this,e==ScanDirection.Right?this.topRight:this.bottomLeft,e,ScanDirection.Top==e),this.HighSide.SideType=ObstacleSideType.High)},t.prototype.SetRegion=function(t,e){void 0===e&&(e=12),this.setActualBounds(t),0==this.isBorder&&t.Inflate(e).round(),this.setPaddedBounds(new Rect(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height)))},t}(),ObstacleSide=function(){function t(t,e,i,a){this.StartVertex=e,this._obstacle=t,this._mEndVertex=a?e.getNext():e.getPrev()}return t.prototype.getEndVertex=function(){return this._mEndVertex},t.prototype.setEndVertex=function(t){this._mEndVertex=t},t.prototype.getStart=function(){return this.StartVertex.Point},t.prototype.getEnd=function(){return this.getEndVertex().Point},t}(),CenterPort=function(){function t(t){this.Entrances=new List,this.VisibilityRectangle=Rect.empty,this.Location=t,this._mLocation=t}return t.prototype.AddPortEntrance=function(t,e,i,a){var n=new PortEntrance(this,e,i,a,t);n.getCanExtend()&&(this.Entrances.add(n),this.VisibilityRectangle.unitePoint(n.MaxVisibilitySegment.EndPoint))},t.prototype.getLocation=function(){return this.Location.round()},t.prototype.setLocation=function(t){this.Location=t},t.prototype.getDirection=function(){return this.Direction},t.prototype.setDirection=function(t){this.Direction=t},t}(),ObstaclePort=function(){function t(t,e){this.Location=this._mLocation=t,this.Direction=this._mPortDirection=e}return t.prototype.getLocation=function(){return this.Location.round()},t.prototype.setLocation=function(t){this.Location=t},t.prototype.getDirection=function(){return this.Direction},t.prototype.setDirection=function(t){this.Direction=t},t}(),PortEntrance=function(){function t(t,e,i,a,n){this.Port=t,this.Location=e,this.Direction=a;var o,s=Extensions.GetEquivalentDirection(a),r=(n.ObstaclePadding,e),l=Utility.IntersectionWithRectangleBorder(n.Rectangle,e,Extensions.GetEquivalentDirection(a)),d=new Segment(r,l);o=n.FindMaximumVisibility_hitNode(d,i,null,o,!0).hitNode,s!=d.StartPoint.FindDirection(d.EndPoint)&&(d.EndPoint=e),this.FirstHit=o,this.MaxVisibilitySegment=d}return t.prototype.getCanExtend=function(){return Extensions.FindDirection(this.MaxVisibilitySegment.StartPoint,this.MaxVisibilitySegment.EndPoint)!=Directions.None},t.prototype.getWantVisibilityIntersection=function(){return this.getCanExtend()},t.prototype.getIsVertical=function(){return this.Direction==PortDirection.Top||this.Direction==PortDirection.Bottom},t}(),PortManager=function(){function t(t,e,i,a,n,o){this.visibilityGraph=null,this.padding=0,this.canRoute=!1,this.temporaryAddition=!0,this.InitialWeight=1,this.NormalWeight=1,this.edgesToRestore=new List,this.addedEdges=new List,this.addedVertices=new List,this.lastExtendedVertex=null,this.HorizontalScanSegmentTree=t,this.VerticalScanSegmentTree=e,this.visibilityGraph=a,this.targetGeometry=n,this.padding=o,this.ObstacleTree=i}return t.prototype.AddControlPointsToGraph=function(t){return this.addedEdges=new List,this.addedVertices=new List,this.canRoute=!0,this.targetGeometry.Connector=t,this.targetGeometry.CurrentEnd=ConnectionEnd.Source,null!=t._sourceNodeInfo?this.AddEndPointToGraph(t._sourcePortInfo,t._sourceNodeInfo):this.AddEndPointToGraph(t._sourcePointInfo,t._sourceNodeInfo),this.canRoute&&(this.targetGeometry.CurrentEnd=ConnectionEnd.Target,null!=t._targetNodeInfo?this.AddEndPointToGraph(t._targetPortInfo,t._targetNodeInfo):this.AddEndPointToGraph(t._targetPointInfo,t._targetNodeInfo)),this.canRoute},t.prototype.AddEndPointToGraph=function(t,e){(null==t||t instanceof IObstaclePort)&&(e instanceof IObstacle||e&&("node"===e._type||"bpmn"===e.type))?null==t?this.AddFreePointToGraph(e):this.canRoute=this.AddPortToGraph(t,e):null!=t&&(this.canRoute=this.AddPortToGraph(t,e))},t.prototype.AddPortToGraph=function(t,e){return this.AddPortToGraph_portDirection(t.getLocation(),t.getDirection(),e)},t.prototype.AddPortToGraph_portDirection=function(t,e,i){var a,n,o,s,r,l,d,h=new Point(Utility.ToRoundedInt(t.x),Utility.ToRoundedInt(t.y));if(this.ObstacleTree.Rectangle.containsPoint(h)){a=this.AddVertex(h);var g,c=e,u=!1;if(Extensions.GetOrientation_PortDirection(c)==Orientation.Horizontal&&(u=!0),g=this.FindTheClosestPerpendicularEdge(h,e),n=new Segment(h,Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,h,Extensions.GetEquivalentDirection(e))),this.ObstacleTree.RestrictSegmentWithinFreeSpace(this.targetGeometry.Connector,n,i)&&null!=g){if(s=this.GetIntersectingPoint(g,h,!u),n.Contains(s))return o=s,d=this.AddVertex(s),a.Point.OperatorNotEqual(s)&&this.ConnectVertices_vertex(a,d,this.InitialWeight),this.AddEdgeToClosestPerpSegment(g,s,!0),this.ExtendTheEdgeToAdjacentEdges(o,e,n,!u),!0;if(null!=i&&(r=Utility.IntersectionWithRectangleBorder(i._outerBounds,h,Extensions.GetEquivalentDirection(e)),l=Math.abs(r.distance(n.EndPoint)),n.Contains(r)&&l<2*this.padding&&l>=4))return o=Extensions.Transform(r,l/2,Extensions.GetEquivalentDirection(e)),d=this.AddVertex(o),a.Point.OperatorNotEqual(o)&&this.ConnectVertices_vertex(a,d,this.InitialWeight),this.AddEdgesToParallelSegments(o,Extensions.GetOrientation_PortDirection(e),n,i),!0}}return!1},t.prototype.AddCornerToVisibilityGraph=function(t,e,i){var a,n,o,s;void 0===i&&(i=null),this.lastExtendedVertex=null;var r,l=t.getLocation(),d=t.getDirection(),h=l;if(this.ObstacleTree.Rectangle.containsPoint(l)){this.SegmentStartPoint=this.SegmentEndPoint=l,r=this.AddVertex(l);var g,c=d,u=!1;if(Extensions.GetOrientation_PortDirection(c)==Orientation.Horizontal&&(u=!0),g=this.FindTheClosestPerpendicularEdge(l,d),a=new Segment(l,Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,l,Extensions.GetEquivalentDirection(d))),this.ObstacleTree.RestrictSegmentWithinFreeSpace(this.targetGeometry.Connector,a,e)){if(null!=g&&(o=this.GetIntersectingPoint(g,l,!u),a.Contains(o)))return n=o,s=this.AddVertex(o),this.lastExtendedVertex=s,r.Point.OperatorNotEqual(o)&&this.ConnectVertices_vertex(r,s,this.InitialWeight),this.AddEdgeToClosestPerpSegment(g,o,!0),this.ExtendTheEdgeToAdjacentEdges(n,d,a,!u,i),void(null!=this.lastExtendedVertex&&(this.SegmentEndPoint=this.lastExtendedVertex.Point));this.ExtendTheEdgeToAdjacentEdges(h,d,a,!u,i),null!=this.lastExtendedVertex&&(this.SegmentEndPoint=this.lastExtendedVertex.Point)}}},t.prototype.GetStartVertexPoint=function(t,e){if(e){if(t.x==this.ObstacleTree.Rectangle.x-1)return new Point(t.x+1,t.y)}else if(t.y==this.ObstacleTree.Rectangle.y-1)return new Point(t.x,t.y+1);return t},t.prototype.GetEndVertexPoint=function(t,e){if(e){if(t.x==this.ObstacleTree.Rectangle.right()+1)return new Point(t.x-1,t.y)}else if(t.y==this.ObstacleTree.Rectangle.bottom()+1)return new Point(t.x,t.y-1);return t},t.prototype.GetStartSegmentPoint=function(t,e,i){if(void 0===i&&(i=!1),e){if(t.x==this.ObstacleTree.Rectangle.x||i)return new Point(t.x-1,t.y)}else if(t.y==this.ObstacleTree.Rectangle.y||i)return new Point(t.x,t.y-1);return t},t.prototype.GetEndSegmentPoint=function(t,e,i){if(void 0===i&&(i=!1),e){if(t.x==this.ObstacleTree.Rectangle.right()||i)return new Point(t.x+1,t.y)}else if(t.y==this.ObstacleTree.Rectangle.bottom()||i)return new Point(t.x,t.y+1);return t},t.prototype.FindTheClosestPerpendicularEdge=function(t,e){var i=null,a=Extensions.GetOrientation_PortDirection(e)==Orientation.Horizontal?this.VerticalScanSegmentTree:this.HorizontalScanSegmentTree;switch(e){case PortDirection.Bottom:case PortDirection.Right:i=a.FindFirst(t)||a.FindScanSegment(t);break;case PortDirection.Left:case PortDirection.Top:i=a.FindLast(t)||a.FindScanSegment(t)}return i},t.prototype.AddFreePointToGraph=function(t){var e,i,a=t._obstacle.CenterPort;for((null==a.Entrances||0==a.Entrances.size())&&this.CreatePortEntrances(t,a,t._obstacle),this.canRoute=!1,e=0;e<a.Entrances.size();e++)i=a.Entrances.get(Number(e)),this.AddPortToGraph_portDirection(i.Location,i.Direction,t)&&(this.canRoute=!0)},t.prototype.AddEdgesToParallelSegments=function(t,e,i,a){var n,o,s,r,l=!1,d=e==Orientation.Horizontal?this.HorizontalScanSegmentTree:this.VerticalScanSegmentTree;n=d.FindLast(t),o=d.FindFirst(t),e==Orientation.Horizontal?(l=!0,s=PortDirection.Top,r=PortDirection.Bottom):(l=!1,s=PortDirection.Left,r=PortDirection.Right),null!=n&&this.ConnectToParallelEdge(n,t,s,l,a),null!=o&&this.ConnectToParallelEdge(o,t,r,l,a)},t.prototype.ConnectToParallelEdge=function(t,e,i,a,n){var o=this.GetIntersectingPoint(t,e,a),s=Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,o,Extensions.GetEquivalentDirection(i)),r=new Segment(e,s),l=this.targetGeometry.GetCurrentEntrance();null!=l&&this.ObstacleTree.RestrictSegmentWithinFreeSpace(this.targetGeometry.Connector,r,n,l.FirstHit)&&r.Contains(o)&&(this.AddVertexAndEdges(e,o,1),this.AddEdgeToClosestPerpSegment(t,o,!0),this.ExtendTheEdgeToAdjacentEdges(o,i,r,!1))},t.prototype.AddEdgeToClosestPerpSegment=function(t,e,i){var a,n;if(!t.getStartPoint().equals(e)&&!t.getEndPoint().equals(e))if(e.FindDirection(t.getStartPoint())==t.getStartPoint().FindDirection(t.getEndPoint()))this.AddVertexAndEdges(e,t.getStartPoint(),i?this.InitialWeight:this.NormalWeight);else if(t.getEndPoint().FindDirection(e)==t.getStartPoint().FindDirection(t.getEndPoint()))this.AddVertexAndEdges(t.getEndPoint(),e,i?this.InitialWeight:this.NormalWeight);else{for(var o=t.getIsVertical()?Directions.North:Directions.East,s=this.visibilityGraph.FindVertex(t.getStartPoint()),r=null;null!=s&&!s.Point.equals(e);){if(null!=r&&r.Point.FindDirection(e)==e.FindDirection(s.Point))return null!=(a=this.visibilityGraph.FindEdge(r.Point,s.Point))&&(a instanceof DynamicEdge||!this.temporaryAddition||this.edgesToRestore.add(a),this.visibilityGraph.RemoveEdge_edge(a,!0)),n=this.AddVertex(e),this.ConnectVertices_vertex(r,n,1),void this.ConnectVertices_vertex(n,s,1);r=s,s=s.FindNextVertex(o)}this.AddVertexAndEdges(t.getStartPoint(),e,i?this.InitialWeight:this.NormalWeight)}},t.prototype.AddVertexToSegment=function(t,e){var i,a,n;if(!e.Point.equals(t.getStartPoint())&&!e.Point.equals(t.getEndPoint())&&(i=t.getIsVertical()?Directions.North:Directions.East,null==(a=e.FindNextVertex(i))&&null==(n=e.FindNextVertex(Extensions.OppositeDirection(i))))){var o=t.getParentVector(),s=o.getParentTree().getPerpendicularTree().GetEdgePassingThroughVertex(e,o.getCoord());null!=s&&(n=s.getSource(),a=s.getTarget(),s.ResetFields(n,e,i,1),this.visibilityGraph.CreateEdge(e,a,i,1))}},t.prototype.RemoveVertexFromSegment=function(t,e){var i,a,n,o,s=t.getIsVertical()?Directions.North:Directions.East;if(e.equals(t.getStartPoint()))null!=(n=this.visibilityGraph.FindVertex(t.getStartPoint()))&&(null!=(o=n.FindNextVertex(s))&&(this.visibilityGraph.RemoveEdge(n,o),t.UpdateSegmentPoint(o.Point,!0)));else if(e.equals(t.getEndPoint()))null!=(n=this.visibilityGraph.FindVertex(t.getEndPoint()))&&(null!=(i=n.FindNextVertex(Extensions.OppositeDirection(s)))&&(this.visibilityGraph.RemoveEdge(i,n),t.UpdateSegmentPoint(i.Point,!1)));else for(a=null,n=this.visibilityGraph.FindVertex(t.getStartPoint());null!=n;){if(o=n.FindNextVertex(s),null!=a&&null!=o&&n.Point.equals(e)){this.visibilityGraph.RemoveEdge(a,n),this.visibilityGraph.RemoveEdge(n,o),this.ConnectVertices_vertex(a,o);break}a=n,n=o}},t.prototype.RemoveVertexFromSegment_vertex=function(t,e){var i,a,n;null!=e&&(i=t.getIsVertical()?Directions.North:Directions.East,e.Point.equals(t.getStartPoint())?null!=(a=e.FindNextVertex(i))&&(this.visibilityGraph.RemoveEdge(e,a),t.UpdateSegmentPoint(a.Point,!0),t.RemoveNotInRangeSharedCoordinates()):e.Point.equals(t.getEndPoint())?null!=(n=e.FindNextVertex(Extensions.OppositeDirection(i)))&&(this.visibilityGraph.RemoveEdge(n,e),t.UpdateSegmentPoint(n.Point,!1),t.RemoveNotInRangeSharedCoordinates()):this.DisconnectVertexInDirection(e,i))},t.prototype.DisconnectVertexInDirection=function(t,e){var i,a=t.FindNextVertex(e),n=t.FindNextVertex(Extensions.OppositeDirection(e));return!(null==a||null==n||(this.visibilityGraph.RemoveEdge(n,t),i=this.visibilityGraph.FindEdge_vertex(t,a),!i))&&(i.ClearProperties(),i.ResetFields(n,a,e),!0)},t.prototype.ExtendTheEdgeToAdjacentEdges=function(t,e,i,a,n){var o,s,r,l;void 0===n&&(n=null),null!=(o=this.visibilityGraph.FindVertex(t))&&(s=Extensions.GetEquivalentDirection(e),r=null!=n?n:Extensions.Left(s),null==o.FindNextVertex(r)&&(r=Extensions.OppositeDirection(r)),l=Extensions.OppositeDirection(r),this.ExtendEdge(o,s,r,l,a,i)||this.ExtendEdge(o,s,l,r,a,i))},t.prototype.AddVertexAndEdges=function(t,e,i){this.ConnectVertices_vertex(this.AddVertex(t),this.AddVertex(e),i)},t.prototype.ConnectVertices=function(t,e,i){void 0===i&&(i=1),this.ConnectVertices_vertex(this.AddVertex(t),this.AddVertex(e),1)},t.prototype.ExtendEdge=function(t,e,i,a,n,o){var s,r,l;var d=e==Directions.East||e==Directions.West,h=t.FindNextVertex(i),g=null,c=null;if(null!=h)for(;(h=(s=this.GetNextSource(h,e,h)).source,s.nextSource)&&(r=this.FindBendPoint(t,h,d),c=null,o.StartPoint.FindDirection(r)==r.FindDirection(o.EndPoint)||o.StartPoint.equals(r)||o.EndPoint.equals(r)?(c=this.AddVertex(r),this.lastExtendedVertex=c):e==Directions.East?null!=(l=this.VerticalScanSegmentTree.FindLast(o.EndPoint))&&(r=new Point(l.getStartPoint().x,r.y),c=this.AddVertex(r),this.lastExtendedVertex=c):e==Directions.West?null!=(l=this.VerticalScanSegmentTree.FindFirst(o.EndPoint))&&(r=new Point(l.getStartPoint().x,r.y),c=this.AddVertex(r),this.lastExtendedVertex=c):e==Directions.South?null!=(l=this.HorizontalScanSegmentTree.FindFirst(o.EndPoint))&&(r=new Point(r.x,l.getStartPoint().y),c=this.AddVertex(r),this.lastExtendedVertex=c):e==Directions.North&&(null!=(l=this.HorizontalScanSegmentTree.FindLast(o.EndPoint))&&(r=new Point(r.x,l.getStartPoint().y),c=this.AddVertex(r),this.lastExtendedVertex=c)),g=this.GetNextTarget(h,a,r),null!=c);)null!=h.FindNextVertex(h.Point.FindDirection(r))&&this.ConnectVertices_vertex(h,c,this.NormalWeight),this.ConnectVertices_vertex(t,c,1),t=c,0;return null!=g},t.prototype.GetNextSource=function(t,e,i){return{nextSource:null!=(i=t.FindNextVertex(e)),source:i}},t.prototype.GetNextTarget=function(t,e,i){for(var a=e,n=t;a==e&&null!=(n=(t=n).FindNextVertex(e));){if(n.Point.equals(i))return n.FindNextVertex(e);a=n.Point.FindDirection(i)}return n},t.prototype.FindBendPoint=function(t,e,i){return i?new Point(e.Point.x,t.Point.y):new Point(t.Point.x,e.Point.y)},t.prototype.AddEdgeToClosestPerpSegments=function(t,e){for(var i,a=t.getIsVertical()?Directions.North:Directions.East,n=this.visibilityGraph.FindVertex(t.getStartPoint()),o=null;null!=n&&!n.Point.equals(e);){if(null!=o&&o.Point.FindDirection(e)==e.FindDirection(n.Point))return void(null!=(i=this.visibilityGraph.FindEdge(o.Point,n.Point))&&(i instanceof DynamicEdge||!this.temporaryAddition||this.edgesToRestore.add(i),this.visibilityGraph.RemoveEdge_edge(i,!0)));o=n,n=n.FindNextVertex(a)}},t.prototype.FindOrAddEdge=function(t,e,i,a){var n,o,s,r,l,d,h=t.Point.FindDirection(e.Point),g=!1;if(null==t.FindNextVertex(h)&&(a=!0,g=!1),r=(s=this.FindExistingEdgeEnds(t,e,h,n,o,g,a)).isBracketTarget,n=s.bracketSource,o=s.bracketTarget,g=s.sourceEnd,a=s.swap,r||g||(r=(s=this.FindExistingEdgeEnds(null!=n?n:t,null!=o?o:e,h,n,o,g,!0)).isBracketTarget,n=s.bracketSource,o=s.bracketTarget,g=s.sourceEnd,a=s.swap),r){if(null!=(l=this.visibilityGraph.FindEdge(n.Point,o.Point))&&l.getSource()==t&&l.getTarget()==e)return;null!=l?(l.getSourcePoint().OperatorLessThan(t.Point)&&l.getTargetPoint().OperatorGreaterThan(e.Point),d=g?t:e,this.SplitEdge(d,l)):this.CreateEdge(t,e,i)}else null!=n&&n!=t&&n.Point.FindDirection(e.Point)==h?this.CreateEdge(n,e,i):null!=o&&o!=e&&o.Point.FindDirection(t.Point)==Extensions.OppositeDirection(h)?this.CreateEdge(t,o,i):this.CreateEdge(t,e,i)},t.prototype.InsertEdge=function(t,e){this.InsertEdge_vertex(this.AddVertex(t),this.AddVertex(e))},t.prototype.InsertEdge_vertex=function(t,e){var i,a=t.Point.FindDirection(e.Point),n=t.FindNextVertex(a),o=t;if(null!=n)for(;null!=n&&n!=e&&n!=e;){if(!n.Point.OperatorLessThan(e.Point)){i=this.visibilityGraph.FindEdge(o.Point,n.Point),this.SplitEdge(e,i);break}o=n,n=(o=n).FindNextVertex(a)}else this.CreateEdge(t,e,1)},t.prototype.GetIntersectingPoint=function(t,e,i){return i?new Point(Utility.ToRoundedInt(e.x),t.getStartPoint().y):new Point(t.getStartPoint().x,Utility.ToRoundedInt(e.y))},t.prototype.CreatePortEntrances=function(t,e,i){var a,n,o,s,r,l,d=new List;if(null!=e){if(a=e.getLocation(),n=this.ObstacleTree.Rectangle,e.Entrances.Clear(),o=new Segment(new Point(n.left(),a.y),new Point(n.right(),a.y)),(s=Utility.GetIntersections(o,i.StartVertex)).size()>0)for(r=0;r<s.size();r++)(l=s.get(r)).x<a.x?e.AddPortEntrance(this.ObstacleTree,new Point(l.x+this.ObstacleTree.ObstaclePadding,l.y),t,PortDirection.Left):e.AddPortEntrance(this.ObstacleTree,new Point(l.x-this.ObstacleTree.ObstaclePadding,l.y),t,PortDirection.Right);if(o=new Segment(new Point(a.x,n.top()),new Point(a.x,n.bottom())),(s=Utility.GetIntersections(o,i.StartVertex)).size()>0)for(r=0;r<s.size();r++)(l=s.get(r)).y<a.y?e.AddPortEntrance(this.ObstacleTree,new Point(l.x,l.y+this.ObstacleTree.ObstaclePadding),t,PortDirection.Top):e.AddPortEntrance(this.ObstacleTree,new Point(l.x,l.y-this.ObstacleTree.ObstaclePadding),t,PortDirection.Bottom);return e.Entrances}return d},t.prototype.FindEntrances=function(t){var e,i,a,n,o=new List;if(t instanceof CenterPort)for(e=t,n=0;n<e.Entrances.size();n++)i=e.Entrances.get(n),a=this.visibilityGraph.FindVertex(i.Location),o.add(a);else a=this.visibilityGraph.FindVertex(t.getLocation()),o.add(a);for(n=0;n<o.size();)0!=o.get(n).getDegree()?n++:o.RemoveAt(n);return o},t.prototype.GetPortVisibilityIntersection=function(t){var e,i,a,n,o,s=t._sourcePortInfo,r=t._targetPortInfo,l=t._sourceNodeInfo,d=t._targetNodeInfo;if(null!=s&&null!=r)return e=new PortEntrance(s,s.getLocation(),l,s.getDirection(),this.ObstacleTree),i=new PortEntrance(r,r.getLocation(),d,r.getDirection(),this.ObstacleTree),this.targetGeometry.SourceEntrance=e,this.targetGeometry.TargetEntrance=i,null!=(o=this.GetPathPoints(t,e,i))?o:this.CheckForLessDistanceBetweenSourceAndTarget(l,d,s,r);if(null!=l&&null!=l._obstacle&&null!=d&&null!=d._obstacle){var h=l._obstacle.CenterPort,g=d._obstacle.CenterPort,c=this.CreatePortEntrances(l,h,l._obstacle),u=this.CreatePortEntrances(d,g,d._obstacle);if(!h.VisibilityRectangle.intersects(g.VisibilityRectangle))return null;for(a=0;a<c.size();a++)if((e=c.get(Number(a))).getWantVisibilityIntersection())for(n=0;n<u.size();n++)if((i=u.get(Number(n))).getWantVisibilityIntersection()&&null!=(o=this.GetPathPoints(t,e,i)))return o}return null},t.prototype.CheckForLessDistanceBetweenSourceAndTarget=function(t,e,i,a){var n;if(i.getDirection()==Extensions.OppositeDirection_Port(a.getDirection())){var o=Utility.IntersectionWithRectangleBorder(t._outerBounds,i.getLocation(),Extensions.GetEquivalentDirection(i.getDirection())),s=Utility.IntersectionWithRectangleBorder(e._outerBounds,a.getLocation(),Extensions.GetEquivalentDirection(a.getDirection())),r=Extensions.FindDistance(o,s,Extensions.GetOrientation_PortDirection(a.getDirection()));if(r<2*this.padding&&r>4){Extensions.GetOrientation_PortDirection(i.getDirection());var l=Extensions.Transform(o,r/2,Extensions.GetEquivalentDirection(i.getDirection())),d=Extensions.GetOrientation_PortDirection(i.getDirection()),h=new Segment(l,Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,l,Extensions.FindDirectionOrientation(i.getLocation(),a.getLocation(),Extensions.OppositeOrientation(d)))),g=Extensions.Transform(s,r/2,Extensions.GetEquivalentDirection(Extensions.OppositeDirection_Port(i.getDirection())));if(this.ObstacleTree.FindMaximumVisibility(h,t)&&h.Contains(g))return(n=new PointList).add(i.getLocation()),n.add(l),n.add(g),n.add(a.getLocation()),n}}return null},t.prototype.GetPathPoints=function(t,e,i){return e.Direction==Extensions.OppositeDirection_Port(i.Direction)&&e.FirstHit==t._targetNodeInfo&&i.FirstHit==t._sourceNodeInfo?new PointList:e.getIsVertical()==i.getIsVertical()?this.GetPathPointsFromCollinearPorts(e,i):this.GetPathPointsFromIntersectingPorts(e,i)},t.prototype.GetPathPointsFromCollinearPorts=function(t,e){if(!Utility.AreEquivalentLines(t.MaxVisibilitySegment,e.MaxVisibilitySegment)||t.MaxVisibilitySegment.StartPoint.equals(t.MaxVisibilitySegment.EndPoint))return null;var i=new PointList;return i.add(t.Location),i.add(e.Location),i},t.prototype.GetPathPointsFromIntersectingPorts=function(t,e){var i,a,n=Utility.SegmentIntersects(t.MaxVisibilitySegment,e.MaxVisibilitySegment,i);return i=n.intersect,n.isInterSect?((a=new PointList).add(t.Location),a.add(i),a.add(e.Location),a):null},t.prototype.CreateEdge=function(t,e,i,a){var n,o;void 0===a&&(a=Directions.None),this.temporaryAddition?(t.Point.OperatorGreaterThan(e.Point)&&(n=t,t=e,e=n),null==(o=this.visibilityGraph.FindEdge_vertex(t,e))&&(o=new DynamicEdge(t,e,i),this.addedEdges.add(o),VisibilityGraph.AddEdge(o))):this.visibilityGraph.AddEdge(t,e,a,i)},t.prototype.SplitEdge=function(t,e){t.Point.equals(e.getSourcePoint())||t.Point.equals(e.getTargetPoint())||(e instanceof DynamicEdge||!this.temporaryAddition||this.edgesToRestore.add(e),this.visibilityGraph.RemoveEdge_edge(e,!0),this.CreateEdge(t,e.getTarget(),e.getWeight()),this.CreateEdge(e.getSource(),t,e.getWeight()))},t.prototype.FindExistingEdgeEnds=function(t,e,i,a,n,o,s){var r;for(o=!1,s&&(o=!0,r=t,t=e,e=r,i=Extensions.OppositeDirection(i)),a=t;null!=(n=a.FindNextVertex(i))&&!n.Point.equals(e.Point)&&i!=e.Point.FindDirection(n.Point);)a=n;return s?(r=a,{isBracketTarget:null!=(a=n),bracketSource:a,bracketTarget:n=r,sourceEnd:o,swap:s}):{isBracketTarget:null!=n,bracketSource:a,bracketTarget:n,sourceEnd:o,swap:s}},t.prototype.AddVertex=function(t){var e=this.visibilityGraph.FindVertex(t);return null==e&&(e=this.visibilityGraph.AddVertex(t),this.temporaryAddition&&this.addedVertices.add(e)),e},t.prototype.RestoreEdges=function(){for(var t=0;t<this.edgesToRestore.size();t++)VisibilityGraph.AddEdge(this.edgesToRestore.get(t));this.edgesToRestore.Clear()},t.prototype.RemoveAddedEdges=function(){for(var t=0;t<this.addedEdges.size();t++)this.visibilityGraph.RemoveEdge_edge(this.addedEdges.get(t));this.addedEdges.Clear()},t.prototype.RemoveAddedVertices=function(){for(var t=0;t<this.addedVertices.size();t++)this.visibilityGraph.RemoveVertex(this.addedVertices.get(t));this.addedVertices.Clear()},t.prototype.RemoveEdgeGeometryFromGraph=function(){this.RemoveAddedVertices(),this.RemoveAddedEdges(),this.RestoreEdges()},t.prototype.GetValidPortLocation=function(t){var e,i,a,n,o;if(!this.ObstacleTree.Rectangle.containsPoint(t)){var s=this.ObstacleTree.Rectangle,r=s.left(),l=s.right(),d=s.top(),h=s.bottom(),g=(new PointList).PointList([new Point(r,d),new Point(l,d),new Point(l,h),new Point(r,h),new Point(r,d)]),c=(new PointList).PointList([t,new Point(r,t.y)]),u=(new PointList).PointList([t,new Point(t.x,d)]),m=LineExtensions.Intersect_PointCollection(c,g,!1);for(0==(m=m.Concat(LineExtensions.Intersect_PointCollection(u,g,!1))).size()&&(m=(new PointList).PointList([s.topLeft,s.topRight,s.bottomLeft,s.bottomRight])),e=t,i=null,a=0;a<m.size();a++)n=m.get(a),o=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),o=Math.round(o),(null==i||Math.min(i,o)===o)&&(i=o,e=n);t=e}return t},t.prototype.IsCurrentConnectionSegmentsValid=function(t,e){var i,a,n,o=t;if(null!=o){for(i=ej.datavisualization.Diagram.Util.getPoints(o),a=0;a<i.length;a++)a>0&&e.get(e.size()-1)==i[a]&&0!=a||e.add(i[a]);o._outerBounds;var s=(new Rect).Rect(i[0],i[i.length-1]),r=this.ObstacleTree.FindNodes(s);if(r&&r.size()>0&&e.size()>0)for(a=0;a<r.size();a++){var l=r.get(a),d=l._obstacle.getPaddedBounds()?l._obstacle.getPaddedBounds():new Rect,h=new PointList;if(h.add(new Point(d.left(),d.top())),h.add(new Point(d.right(),d.top())),h.add(new Point(d.right(),d.bottom())),h.add(new Point(d.left(),d.bottom())),h.add(new Point(d.left(),d.top())),(n=new PointList).AddRange(LineExtensions.Intersect_PointCollection(h,e,!1)),n.size()>0){if(o._sourceNodeInfo==l||o._targetNodeInfo==l)for(var g=0,c=e.size(),u=(new Rect).Rect(e.get(c-1),e.get(c-2)),m=(new Rect).Rect(e.get(0),e.get(1));g<n.size();)u.containsPoint(n.get(g))||m.containsPoint(n.get(g))?n.RemoveAt(g):g++;if(n.size()>0)return{canValid:!1,points:new PointList}}}return{canValid:!0,points:e}}return{canValid:!1,points:new PointList}},t.prototype.GetLineSegment=function(t,e,i,a,n){var o,s,r,l;void 0===n&&(n=!0);var d,h=Utility.IntersectionWithRectangleBorder(this.ObstacleTree.Rectangle,t,e),g=new Segment(t,h);return d=this.ObstacleTree.FindMaximumVisibility_hitNode(g,i,a,d).hitNode,n&&(o=0,s=0,Extensions.GetOrientation(e)==Orientation.Horizontal?s=5:o=5,r=this.GetLineSegment(new Point(t.x+o,t.y+s),e,i,a,!1),l=this.GetLineSegment(new Point(t.x-o,t.y-s),e,i,a,!1),Extensions.GetOrientation(e)==Orientation.Horizontal?(g.Bounds.width>r.Bounds().width&&(g=new Segment(t,new Point(r.EndPoint.x,g.EndPoint.y))),g.Bounds.width>l.Bounds().width&&(g=new Segment(t,new Point(l.EndPoint.x,g.EndPoint.y)))):(g.Bounds.height>r.Bounds().height&&(g=new Segment(t,new Point(g.EndPoint.x,r.EndPoint.y))),g.Bounds.height>l.Bounds().height&&(g=new Segment(t,new Point(g.EndPoint.x,l.EndPoint.y))))),g},t.prototype.IsEndPointChanged=function(t){var e,i,a=!0;return null!=t._points&&t._points.size()>0&&(t._points=t._points,e=new Point,i=new Point,t.sourcePoint&&(e=t.sourcePoint),t.targetPoint&&(i=t.targetPoint),t._points.ElementAt(0).equals(e)&&t._points.ElementAt(t._points.size()-1).equals(i)&&(a=!1)),a},t.prototype.ConnectVertices_vertex=function(t,e,i,a){var n,o;void 0===i&&(i=1),void 0===a&&(a=Directions.None),t!=e&&(this.temporaryAddition?(n=!1,t.Point.OperatorGreaterThan(e.Point)&&(o=e,e=t,t=o,n=!0),this.FindOrAddEdge(t,e,i,n)):this.CreateEdge(t,e,i,a))},t}(),LineUtil=function(){return function(t,e,i,a){this.X1=0,this.Y1=0,this.X2=0,this.Y2=0,this.X1=t,this.X2=i,this.Y1=e,this.Y2=a}}(),LineExtensions=function(){function t(){}return t.Intersect=function(t,e,i){var a,n,o=!1;i=new Point(0,0);var s=t,r=e,l=(r.Y2-r.Y1)*(s.X2-s.X1)-(r.X2-r.X1)*(s.Y2-s.Y1),d=(r.X2-r.X1)*(s.Y1-r.Y1)-(r.Y2-r.Y1)*(s.X1-r.X1),h=(s.X2-s.X1)*(s.Y1-r.Y1)-(s.Y2-s.Y1)*(s.X1-r.X1);return 0==l&&(o=!1),n=h/l,(a=d/l)>=0&&a<=1&&n>=0&&n<=1&&(i.x=s.X1+a*(s.X2-s.X1),i.y=s.Y1+a*(s.Y2-s.Y1),o=!0),{isInterSect:o,POI:i}},t.Intersect_PointCollection=function(t,e,i){var a,n;for(i&&e.size()>=2&&(e.RemoveAt(0),e.RemoveAt(0)),a=new PointList,n=0;n<t.size()-1;n++)a.AddRange(this.Intersect_PointList(t.get(n),t.get(n+1),e)),i&&e.size()>=1&&e.RemoveAt(0);return a},t.Intersect_PointList=function(t,e,i){for(var a,n=new PointList,o=0;o<i.size()-1;o++)(a=this.Intersect_Points(t,e,i.get(o),i.get(o+1))).equals(new Point(0,0))||n.add(a);return n},t.Intersect_Points=function(t,e,i,a){var n=new LineUtil(t.x,t.y,e.x,e.y),o=new LineUtil(i.x,i.y,a.x,a.y),s=this.Intersect(n,o,a);return a=s.POI,s.isInterSect?a:new Point(0,0)},t}(),Vertex=function(){function t(t){this._mEastEdge=null,this._mWestEdge=null,this._mSouthEdge=null,this._mNorthEdge=null,this.Point=t}return t.prototype.getEastEdge=function(){return this._mEastEdge},t.prototype.setEastEdge=function(t){this._mEastEdge=t},t.prototype.getWestEdge=function(){return this._mWestEdge},t.prototype.setWestEdge=function(t){this._mWestEdge=t},t.prototype.getSouthEdge=function(){return this._mSouthEdge},t.prototype.setSouthEdge=function(t){this._mSouthEdge=t},t.prototype.getNorthEdge=function(){return this._mNorthEdge},t.prototype.setNorthEdge=function(t){this._mNorthEdge=t},t.prototype.getDegree=function(){var t=0;return null!=this._mEastEdge&&t++,null!=this._mWestEdge&&t++,null!=this._mNorthEdge&&t++,null!=this._mSouthEdge&&t++,t},t.prototype.RemoveEdgeAt=function(t){switch(t){case Directions.East:this._mEastEdge=null;break;case Directions.West:this._mWestEdge=null;break;case Directions.North:this._mNorthEdge=null;break;case Directions.South:this._mSouthEdge=null}},t.prototype.TryGetOutEdge=function(t,e){return e=null,null!=this._mEastEdge&&this._mEastEdge.getTarget()==t?e=this._mEastEdge:null!=this._mNorthEdge&&this._mNorthEdge.getTarget()==t&&(e=this._mNorthEdge),{edge:e,canOut:null!=e}},t.prototype.TryGetInEdge=function(t,e){return e=null,null!=this._mWestEdge&&this._mWestEdge.getTarget()==t?e=this._mWestEdge:null!=this._mSouthEdge&&this._mSouthEdge.getTarget()==t&&(e=this._mSouthEdge),{edge:e,canIn:null!=e}},t.prototype.ClearEdges=function(){this._mEastEdge=null,this._mNorthEdge=null,this._mSouthEdge=null,this._mWestEdge=null},t.prototype.SetVertexEntry=function(t){null==this.VertexEntries&&(this.VertexEntries=new Array(4)),this.VertexEntries[Extensions.ToIndex(t.Direction)]=t},t.prototype.RemoveVertexEntries=function(){this.VertexEntries=null},t.prototype.FindNextVertex=function(t){var e=null;return t==Directions.East?e=this._mEastEdge:t==Directions.West?e=this._mWestEdge:t==Directions.North?e=this._mNorthEdge:t==Directions.South&&(e=this._mSouthEdge),null!=e?t==Directions.East||t==Directions.North?e.getTarget():e.getSource():null},t.prototype.DisconnectEdges=function(){null!=this._mEastEdge&&this._mEastEdge.getTarget().RemoveEdgeAt(Directions.West),null!=this._mNorthEdge&&this._mNorthEdge.getTarget().RemoveEdgeAt(Directions.South),null!=this._mWestEdge&&this._mWestEdge.getSource().RemoveEdgeAt(Directions.East),null!=this._mSouthEdge&&this._mSouthEdge.getSource().RemoveEdgeAt(Directions.North)},t}(),Edge=function(){function t(t,e,i){switch(this._mSource=null,this._mTarget=null,this._mSourcePoint=new Point,this._mTargetPoint=new Point,this._mLength=0,this._mWeight=0,this._mEdgeDirection=Directions.None,this.Edge(t,e),this._mWeight=i,this.SetEdgeDirection(),this._mEdgeDirection){case Directions.East:this._mSource.setEastEdge(this),this._mTarget.setWestEdge(this);break;case Directions.North:this._mSource.setNorthEdge(this),this._mTarget.setSouthEdge(this);break;case Directions.West:this._mSource.setWestEdge(this),this._mTarget.setEastEdge(this);break;case Directions.South:this._mSource.setSouthEdge(this),this._mTarget.setNorthEdge(this)}}return t.prototype.getSource=function(){return this._mSource},t.prototype.getTarget=function(){return this._mTarget},t.prototype.getSourcePoint=function(){return this._mSourcePoint},t.prototype.getTargetPoint=function(){return this._mTargetPoint},t.prototype.getLength=function(){return this._mLength},t.prototype.getWeight=function(){return this._mWeight},t.prototype.getEdgeDirection=function(){return this._mEdgeDirection},t.prototype.Edge=function(t,e){this._mSource=t,this._mTarget=e,this._mSourcePoint=null!=this._mSource?this._mSource.Point:new Point,this._mTargetPoint=null!=this._mTarget?this._mTarget.Point:new Point},t.prototype.EdgeWeight=function(t,e,i,a){switch(this.Edge(t,e),this._mWeight=a,this._mEdgeDirection=i,this._mEdgeDirection){case Directions.East:this._mSource.setEastEdge(this),this._mTarget.setWestEdge(this);break;case Directions.North:this._mSource.setNorthEdge(this),this._mTarget.setSouthEdge(this);break;case Directions.West:this._mSource.setWestEdge(this),this._mTarget.setEastEdge(this);break;case Directions.South:this._mSource.setSouthEdge(this),this._mTarget.setNorthEdge(this)}return this},t.prototype.ResetFields=function(t,e,i,a){switch(void 0===i&&(i=Directions.None),void 0===a&&(a=1),this._mSource!=t&&(this._mSource=t,this._mSourcePoint=null!=this._mSource?this._mSource.Point:new Point),this._mTarget!=e&&(this._mTarget=e,this._mTargetPoint=null!=this._mTarget?this._mTarget.Point:new Point),this._mWeight=a,i==Directions.None?this.SetEdgeDirection():this._mEdgeDirection=i,this._mEdgeDirection){case Directions.East:this._mSource.setEastEdge(this),this._mTarget.setWestEdge(this);break;case Directions.North:this._mSource.setNorthEdge(this),this._mTarget.setSouthEdge(this);break;case Directions.West:this._mSource.setWestEdge(this),this._mTarget.setEastEdge(this);break;case Directions.South:this._mSource.setSouthEdge(this),this._mTarget.setNorthEdge(this)}},t.prototype.ReversedClone=function(){return new this.Edge(this.getTarget(),this.getSource())},t.prototype.Clone=function(){return new this.Edge(this.getSource(),this.getTarget())},t.prototype.ClearProperties=function(){null!=this._mSource&&null!=this._mTarget&&(this._mSource.RemoveEdgeAt(this._mEdgeDirection),this._mTarget.RemoveEdgeAt(Extensions.OppositeDirection(this._mEdgeDirection)))},t.prototype.SetEdgeDirection=function(){var t,e,i=this._mSourcePoint.x,a=this._mTargetPoint.x;i!=a?this._mEdgeDirection=a>i?Directions.East:Directions.West:(t=this._mSourcePoint.y)!=(e=this._mTargetPoint.y)&&(this._mEdgeDirection=e>t?Directions.North:Directions.South)},t}(),DynamicEdge=function(t){function e(e,i,a){t.call(this,e,i,a)}return __extends(e,t),e}(Edge),VertexEntry=function(){function t(t,e,i,a,n){this.TimeStamp=0,this.Length=0,this.Cost=0,this.NumberOfBends=0,this.Closed=!1,this.Vertex=t,this.PreviousEntry=e,this.Length=i,this.NumberOfBends=a,n=Math.round(n),this.Cost=n,this.Direction=null!=e?e.Vertex.Point.FindDirection(t.Point):Directions.None}return t.prototype.ResetEntry=function(t,e,i,a){this.PreviousEntry=t,e=Math.round(e),this.Cost=e,this.NumberOfBends=i,this.Length=a},t.prototype.CompareTo=function(t){var e=Extensions.CompareTo(this.Cost,t.Cost);return 0!=e?e:Extensions.CompareTo(t.TimeStamp,this.TimeStamp)},t.prototype.ToString=function(){return null!=this.PreviousEntry?this.PreviousEntry.ToString()+" -> ("+this.Vertex.Point.x+", "+this.Vertex.Point.y+")":"("+this.Vertex.Point.x+", "+this.Vertex.Point.y+")"},t}(),VisibilityGraph=function(){function t(){this.Graph=new Dictionary,this.EdgesCache=new Stack,this.VertexFactory=function(t){return new Vertex(t)}}return t.prototype.getEdges=function(){var t=new List;return this.getVertices().forEach(function(e){null!=e.EastEdge&&t.add(e.EastEdge),null!=e.NorthEdge&&t.add(e.NorthEdge)}),t},t.prototype.getVertices=function(){var t,e,i,a,n,o,s=[];if(this.Graph)for(t=this.Graph.Count(),e=0;e<t;e++)for(a=(i=this.Graph.GetValue(this.Graph.KeyAt(e))).Count(),n=0;n<a;n++)o=i.GetValue(i.KeyAt(n)),s.push(o);return s},t.prototype.FindVertex=function(t){return this.FindVertexNumber(Utility.ToRoundedInt(t.x),Utility.ToRoundedInt(t.y))},t.prototype.FindVertexNumber=function(t,e){if(this.Graph.ContainsKey(t)){var i=this.Graph.GetValue(t);if(i.ContainsKey(e))return i.GetValue(e)}return null},t.prototype.FindEdge=function(t,e){return this.FindEdge_vertex(this.FindVertex(t),this.FindVertex(e))},t.prototype.FindEdge_vertex=function(t,e){var i=null;return null!=t&&null!=e&&(i=t.TryGetOutEdge(e,i).edge),i},t.prototype.AddVertex=function(t){var e,i,a=null,n=Utility.ToRoundedInt(t.x),o=Utility.ToRoundedInt(t.y);return this.Graph.ContainsKey(n)?(e=this.Graph.GetValue(n)).ContainsKey(o)?a=e.GetValue(o):(a=new Vertex(t),e.Add(a,o)):(a=new Vertex(t),(i=new Dictionary).Add(a,o),this.Graph.Add(i,n)),a},t.prototype.ContainsVertex=function(t){var e=Utility.ToRoundedInt(t.x),i=Utility.ToRoundedInt(t.y);return!!this.Graph.ContainsKey(e)&&this.Graph[this.Graph.IndexOfKey(e)].ContainsKey(i)},t.prototype.CreateEdge=function(t,e,i,a){void 0===i&&(i=Directions.None),void 0===a&&(a=1);var n=null;return 0!=this.EdgesCache.Count()?(n=this.EdgesCache.Pop()).ResetFields(t,e,i,a):n=i!=Directions.None?new Edge(t,e,a).EdgeWeight(t,e,i,a):new Edge(t,e,a),n},t.prototype.AddEdge_Point=function(t,e){var i=this.FindVertex(t),a=this.FindVertex(e);return null==i&&(i=this.AddVertex(t)),null==a&&(a=this.AddVertex(e)),this.AddEdge(i,a)},t.prototype.AddEdge=function(t,e,i,a){void 0===i&&(i=Directions.None),void 0===a&&(a=1);var n=this.FindEdge_vertex(t,e);return n||this.CreateEdge(t,e,i,a)},t.AddEdge=function(t){if(null!=t.getSource()&&null!=t.getTarget())switch(t.getEdgeDirection()){case Directions.East:t.getSource().setEastEdge(t),t.getTarget().setWestEdge(t);break;case Directions.North:t.getSource().setNorthEdge(t),t.getTarget().setSouthEdge(t);break;case Directions.West:t.getSource().setWestEdge(t),t.getTarget().setEastEdge(t);break;case Directions.South:t.getSource().setSouthEdge(t),t.getTarget().setNorthEdge(t)}},t.prototype.RemoveVertex=function(t){var e,i,a;null!=t&&(t.DisconnectEdges(),e=Utility.ToRoundedInt(t.Point.x),i=Utility.ToRoundedInt(t.Point.y),this.Graph.ContainsKey(e)&&((a=this.Graph.GetValue(e)).ContainsKey(i)&&a.Remove(i),0==a.Count()&&this.Graph.Remove(e)),t=null)},t.prototype.RemoveEdge=function(t,e){var i=this.FindEdge_vertex(t,e);return null!=i&&this.RemoveEdge_edge(i),i},t.prototype.RemoveEdge_point=function(t,e){var i=this.FindEdge(t,e);null!=i&&this.RemoveEdge_edge(i)},t.prototype.RemoveEdge_edge=function(t,e){void 0===e&&(e=!1),t.ClearProperties(),e||t instanceof DynamicEdge||this.EdgesCache.Push(t),t=null},t.prototype.ClearEdges=function(){this.getVertices().forEach(function(t){t.ClearEdges()})},t.stackCapacity=1e3,t}(),EdgeGeometry=function(){function t(){}return t.prototype.GetCurrentEnd=function(){return this.CurrentEnd==ConnectionEnd.Source?this.SourceEntrance.Location:this.TargetEntrance.Location},t.prototype.GetOppositeEnd=function(){return this.CurrentEnd==ConnectionEnd.Target?null!=this.Connector._sourceNodeInfo?null!=this.Connector._sourcePortInfo?this.Connector._sourcePortInfo.getLocation():this.Connector._sourceNodeInfo._outerBounds.center():this.Connector._sourcePointInfo.getLocation():null!=this.Connector._targetNodeInfo?null!=this.Connector._targetPortInfo?this.Connector._targetPortInfo.getLocation():this.Connector._targetNodeInfo._outerBounds.center():this.Connector._targetPointInfo.getLocation()},t.prototype.GetCurrentEntrance=function(){return this.CurrentEnd==ConnectionEnd.Source?this.SourceEntrance:this.TargetEntrance},t}();(function(t,e){"use strict";e.datavisualization.Diagram.ZoomUtil={zoomPan:function(i,a,n,o,s,r){var l,d,h,g,c;if(r&&e.datavisualization.Diagram.Util.canZooming(i)||!r&&e.datavisualization.Diagram.Util.canPanning(i)){var u=e.datavisualization.Diagram.ScrollUtil._viewPort(i,!0),m={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:u},p=e.Matrix.identity();e.Matrix.scale(p,i._currZoom,i._currZoom),e.Matrix.translate(p,-i._hScrollOffset,-i._vScrollOffset),(l=i._currZoom*a)>i.model.scrollSettings.maxZoom?a=i.model.scrollSettings.maxZoom/i._currZoom:l<i.model.scrollSettings.minZoom&&(a=i.model.scrollSettings.minZoom/i._currZoom),d=e.Matrix.identity(),h=s?e.Matrix.transform(p,s):e.datavisualization.Diagram.Point(t(i.element).width()/2,t(i.element).height()/2),e.Matrix.scale(d,a,a,h.x,h.y),l=i._currZoom*a,e.Matrix.translate(d,n,o),e.Matrix.multiply(p,d),g=e.Matrix.transform(p,e.datavisualization.Diagram.Point(0,0)),i._compareModelProperty("scrollSettings",!0),this._applyTransform(i,l,g,r,u),c={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:u},i._eventCause.scrollChange=e.datavisualization.Diagram.ScrollChangeCause.Zoom,r||(i._eventCause.scrollChange=e.datavisualization.Diagram.ScrollChangeCause.Pan),i._raiseEvent("scrollChange",{newValues:c,oldValues:m})}},_applyTransform:function(t,i,a,n,o){t._currZoom=i;var s=-1*a.x,r=-1*a.y,l=t._getDigramBounds();if(!n&&t._scrollLimit()!==e.datavisualization.Diagram.ScrollLimit.Infinity)if(t._scrollLimit()===e.datavisualization.Diagram.ScrollLimit.Diagram){l.x-=t.model.scrollSettings.padding.left,l.y-=t.model.scrollSettings.padding.top,l.width+=t.model.scrollSettings.padding.left+t.model.scrollSettings.padding.right,l.height+=t.model.scrollSettings.padding.top+t.model.scrollSettings.padding.bottom;var d=l.width*t._currZoom>o.width,h=l.height*t._currZoom>o.height,g=(l.width+l.x)*t._currZoom-o.width,c=(l.height+l.y)*t._currZoom-o.height;!d&&s>t._hScrollOffset&&s>l.x*t._currZoom||d&&s<t._hScrollOffset&&s<l.x*t._currZoom?s=t._hScrollOffset:(!d&&s<t._hScrollOffset&&s<g||d&&s>t._hScrollOffset&&s>g)&&(s=t._hScrollOffset),!h&&r>t._vScrollOffset&&r>l.y*t._currZoom||h&&r<t._vScrollOffset&&r<l.y*t._currZoom?r=t._vScrollOffset:(!h&&r<t._vScrollOffset&&r<c||h&&r>t._vScrollOffset&&r>c)&&(r=t._vScrollOffset)}else s<t._hScrollbar.model.minimum&&!(0==t._hScrollbar.model.minimum&&-t._hScrollOffset>a.x)?s=t._hScrollOffset:s>t._hScrollbar.model.maximum&&(s=t._hScrollbar.model.maximum),r<t._vScrollbar.model.minimum&&!(0==t._vScrollbar.model.minimum&&-t._vScrollOffset>a.y)?r=t._vScrollOffset:r>t._vScrollbar.model.maximum&&(r=t._vScrollbar.model.maximum);t._updateScrollOffset(s,r,!0,n)}},e.datavisualization.Diagram.PageUtil={_createPageBreaks:function(t){this._removePageBreaks(t);var i={id:t._canvas.id+"pagebreaks","pointer-events":"none"},a=e.datavisualization.Diagram.SvgContext._initializePageBreaks(t._svg,i,t._pageBackgroundLayer);this._updatePageBreaks(a,t)},_removePageBreaks:function(t){var i=t._svg.getElementById(t._canvas.id+"pagebreaks");i&&e.datavisualization.Diagram.SvgContext._removePageBreaks(t._svg,i,t._pageBackgroundLayer)},_updatePageBreaks:function(t,i){var a,n,o,s,r=i._getDigramBounds(),l=(i.model.pageSettings,r.x),d=r.width+r.x,h=r.y,g=r.height+r.y,c=i._currZoom,u=i._pageHeight(),m=i._pageWidth(),p=i._pageMargin(),f=parseInt(Math.ceil((d-l)/m)),_=parseInt(Math.ceil((g-h)/u));for(l=-i._canvas.clientLeft+(p+l)*c,h=-i._canvas.clientTop+(p+h)*c,a=(m*f-2*p)*c,n=(u*_-2*p)*c,e.datavisualization.Diagram.SvgContext._renderVPageBreakLine(e.datavisualization.Diagram.Point(l,h),e.datavisualization.Diagram.Point(l+a,h),i._svg,t),e.datavisualization.Diagram.SvgContext._renderHPageBreakLine(e.datavisualization.Diagram.Point(l,h),e.datavisualization.Diagram.Point(l,h+n),i._svg,t),o=1;o<f;o++)e.datavisualization.Diagram.SvgContext._renderVPageBreakLine(e.datavisualization.Diagram.Point(l+(m*o-p)*c,h),e.datavisualization.Diagram.Point(l+(m*o-p)*c,h+n),i._svg,t);for(s=1;s<_;s++)e.datavisualization.Diagram.SvgContext._renderHPageBreakLine(e.datavisualization.Diagram.Point(l,h+(u*s-p)*c),e.datavisualization.Diagram.Point(l+a,h+(u*s-p)*c),i._svg,t);e.datavisualization.Diagram.SvgContext._renderVPageBreakLine(e.datavisualization.Diagram.Point(l+a,h),e.datavisualization.Diagram.Point(l+a,h+n),i._svg,t),e.datavisualization.Diagram.SvgContext._renderHPageBreakLine(e.datavisualization.Diagram.Point(l,h+n),e.datavisualization.Diagram.Point(l+a,h+n),i._svg,t)},_updatePageSize:function(t,i){var a,n=!1,o="string"==typeof t.model.pageSettings.pageOrientation?t.model.pageSettings.pageOrientation:t._pageOrientation(),s="string"==typeof t.model.pageSettings.pageWidth?t.model.pageSettings.pageWidth:t._pageWidth(),r="string"==typeof t.model.pageSettings.pageHeight?t.model.pageSettings.pageHeight:t._pageHeight();o==e.datavisualization.Diagram.PageOrientations.Landscape?r>s&&(n=!0):s>r&&(n=!0),n&&(a=s,t._pageWidth(r),t._pageHeight(a));var l=t._getDigramBounds(),d=t._currZoom,h=l.x*d,g=l.y*d,c=l.width*d,u=l.height*d,m=t.model.pageSettings;t._pageBackgroundLayer&&t._pageBackgroundLayer.firstChild?e.datavisualization.Diagram.SvgContext._updatePageBakground(e.datavisualization.Diagram.Point(h,g),e.datavisualization.Diagram.Point(c,u),t._svg,t._pageBackgroundLayer,t._pageBorderColor(),t._pageBackgroundColor(),t._pageBorderWidth()):e.datavisualization.Diagram.SvgContext._renderPageSettingsRect(e.datavisualization.Diagram.Point(h,g),e.datavisualization.Diagram.Point(c,u),t._svg,t._pageBackgroundLayer,t._pageBorderColor(),t._pageBackgroundColor(),t._pageBorderWidth()),("transparent"!==t.model.backgroundColor||t.model.backgroundImage&&t.model.backgroundImage.source)&&e.datavisualization.Diagram.SvgContext._updateBackground(t._hScrollOffset,t._vScrollOffset,t._currZoom,t),t._svg.document.style.left=0,t._svg.document.style.top=0,m.pageWidth&&r&&(t._showPageBreak()?this._createPageBreaks(t):this._removePageBreaks(t)),i||e.datavisualization.Diagram.ScrollUtil._setScrollContentSize(t)}},e.datavisualization.Diagram.ScrollUtil={_transform:function(t,i,a,n){e.datavisualization.Diagram.SvgContext.transformView(t,-i,-a),n&&e.datavisualization.Diagram.SvgContext.scaleContent(t,t._currZoom),this._updateRuler(t,i,a),e.datavisualization.Diagram.PageUtil._updatePageSize(t),e.datavisualization.Diagram.SvgContext._updateGrid(i,a,t._currZoom,t)},_updateRuler:function(i,a,n){if(i&&i.model.rulerSettings.showRulers){var o=this._getRulerSize(i),s=e.datavisualization.Diagram.ScrollUtil._getRulerGeometry(i,!0);void 0!=a&&i._hRuler&&(e.datavisualization.Diagram.SvgContext._updateRulerSpace(i,s,!0),t("#"+i._hRuler[0].id).ejRuler({offset:a,scale:i._currZoom,length:s.width+100}),i._hRuler[0].style.marginLeft=o.left-i._hRulerInstance._hRulerDiff+"px"),void 0!=n&&i._vRuler&&(e.datavisualization.Diagram.SvgContext._updateRulerSpace(i,s,!1),t("#"+i._vRuler[0].id).ejRuler({offset:n,scale:i._currZoom,length:s.height+100}),i._vRuler[0].style.marginTop=-i._vRulerInstance._vRulerDiff+"px")}},_viewPort:function(t,i){var a,n;if(t._viewPort&&!i)return t._viewPort;t.element[0];var o=t.element[0].getBoundingClientRect(),s=o.width,r=o.height,l=window.screenX<0?-1*window.screenX:window.screenX;return 0===s&&(s=Math.floor(window.innerWidth-l-Math.floor(o.left))),a=window.screenY<0?-1*window.screenY:window.screenY,0===r&&(r=Math.floor(window.innerHeight-a-Math.floor(o.window))),n=this._getRulerSize(t),e.datavisualization.Diagram.Size(s-n.left,r-n.top)},_getRulerSize:function(t){var e=0,i=0;return t.model.rulerSettings.showRulers&&(t.model.rulerSettings.horizontalRuler.thickness&&(i=t.model.rulerSettings.horizontalRuler.thickness),t.model.rulerSettings.verticalRuler.thickness&&(e=t.model.rulerSettings.verticalRuler.thickness)),{left:e,top:i}},_getRulerGeometry:function(t){var e=this._getRulerSize(t),i=t._viewPort.height,a=t._viewPort.width;return a<t._canvas.clientWidth-e.left&&(a=t._canvas.clientWidth-e.left),i<t._canvas.clientHeight-e.top&&(i=t._canvas.clientHeight-e.top),t.model.rulerSettings.horizontalRuler.length&&(a=t.model.rulerSettings.horizontalRuler.length),t.model.rulerSettings.verticalRuler.length&&(i=t.model.rulerSettings.verticalRuler.length),{width:a,height:i}},_union:function(t,e){var i,a,n,o;return t.width<=0?e:t.width>0?(i=Math.min(t.x,e.x),a=Math.min(t.y,e.y),e.width===1/0||t.width===1/0?t.width=1/0:(n=Math.max(t.x+t.width,e.x+e.width),t.width=Math.max(n-i,0)),e.height===1/0||t.height===1/0?t.height=1/0:(o=Math.max(t.y+t.height,e.y+e.height),t.height=Math.max(o-a,0)),t.x=i,t.y=a,t):void 0},_setScrollContentSize:function(i){var a,n,o,s,r,l,d,h,g,c,u,m,p,f,_,v=i._currZoom,y=this._viewPort(i);y=e.datavisualization.Diagram.Rectangle(i._hScrollOffset,i._vScrollOffset,y.width,y.height);var b=i.model.scrollSettings.padding,x=i._spatialSearch.pageLeft,D=i._spatialSearch.pageRight,C=i._spatialSearch.pageTop,z=i._spatialSearch.pageBottom,S=x,P=C;x>D&&(x=D=0),C>z&&(C=z=0),i.model.pageSettings&&(a=Number(i._pageWidth()),n=Number(i._pageHeight()),a>0&&n>0?(i._multiplePage()?(x=Math.floor(x/a)*a,C=Math.floor(C/n)*n,D=Math.ceil(D/a)*a,z=Math.ceil(z/n)*n):(x=0,C=0,D=a,z=n),x-=b.left,D+=b.right,C-=b.top,z+=b.bottom,S=x,P=C):(x=x<0?x:0,C=C<0?C:0,i._spatialSearch.pageLeft-x<b.left&&(x+=i._spatialSearch.pageLeft-x-b.left),i._spatialSearch.pageTop-C<b.top&&(C+=i._spatialSearch.pageTop-C-b.top),i._spatialSearch.pageRight+b.right>y.width&&i._spatialSearch.pageRight<y.width?D+=b.right+i._spatialSearch.pageRight-y.width:i._spatialSearch.pageRight>y.width&&(D+=b.right),i._spatialSearch.pageBottom+b.bottom>y.height&&i._spatialSearch.pageBottom<y.height?z+=b.bottom+i._spatialSearch.pageBottom-y.height:i._spatialSearch.pageBottom>y.height&&(z+=b.bottom),S-=b.left,P-=b.top)),x*=v,C*=v,D*=v,z*=v,o=e.datavisualization.Diagram.Rectangle(0,0,0,0),o=this._union(o,e.datavisualization.Diagram.Rectangle(0,0,y.width,y.height)),(o=this._union(o,e.datavisualization.Diagram.Geometry.rect([{x:x,y:C},{x:D,y:z}]))).width-=y.width-18,o.height-=y.height-18,o.x>i._hScrollOffset&&(l=o.x-i._hScrollOffset,o.x-=l,o.width+=l),i._hScrollOffset>o.x+o.width&&(o.width=i._hScrollOffset-o.x),s=o.x,r=Math.max(0,o.x+o.width),o.y>i._vScrollOffset&&(l=o.y-i._vScrollOffset,o.y-=l,o.height+=l),i._vScrollOffset>o.y+o.height&&(o.height=i._vScrollOffset-o.y),d=o.y,h=Math.max(0,o.y+o.height),o.width=y.width,o.height=y.height,i._scrollLimit()===e.datavisualization.Diagram.ScrollLimit.Limited&&(s=(g=i.model.pageSettings.scrollableArea).x*v,d=g.y*v,r=(g.x+g.width)*v-y.width,h=(g.y+g.height)*v-y.height,z=(g.y+g.height)*v,D=(g.x+g.width)*v,C=g.y*v,x=g.x*v),c=!0,u=!0,x>=i._hScrollOffset&&D<=y.width+i._hScrollOffset&&(c=!1,i._hScrollbar._remove(),i._hScrollbar.model.width=0,i._hScrollbar.model.minimum=i._scrollLimit()===e.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,s):0,i._hScrollbar.model.maximum=0),C>=i._vScrollOffset&&z<=y.height+i._vScrollOffset&&(u=!1,i._vScrollbar._remove(),i._vScrollbar.model.height=0,i._vScrollbar.model.minimum=i._scrollLimit()===e.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,d):0,i._vScrollbar.model.maximum=0),c&&(m=u?y.width-18:y.width,r=u?r:r-18,i._preventScrollerUpdate?(i._hScrollbar.model.minimum=s,i._hScrollbar.model.maximum=r):(t("#"+i._canvas.id+"_hScrollbar").ejScrollBar({width:m,viewportSize:m,maximum:r,minimum:s}),t("#"+i._canvas.id+"_hScrollbar").ejScrollBar("scroll",i._hScrollOffset)),(p=document.getElementById(i._canvas.id+"_hScrollbar")).style.marginTop=y.height-18+"px",Math.round(S*v)>=Math.round(i._hScrollOffset)&&Math.round(D)<=Math.round(y.width+i._hScrollOffset)?p.style.visibility="hidden":(p.style.visibility="visible",o.height>=18&&(o.height-=18))),u&&(f=c?y.height-18:y.height,h=c?h:h-18,i._preventScrollerUpdate?(i._vScrollbar.model.minimum=d,i._vScrollbar.model.maximum=h):(t("#"+i._canvas.id+"_vScrollbar").ejScrollBar({height:f,viewportSize:f,maximum:h,minimum:d}),t("#"+i._canvas.id+"_vScrollbar").ejScrollBar("scroll",i._vScrollOffset)),_=document.getElementById(i._canvas.id+"_vScrollbar"),Math.round(P*v)>=Math.round(i._vScrollOffset)&&Math.round(z)<=Math.round(y.height+i._vScrollOffset)?_.style.visibility="hidden":(_.style.visibility="visible",o.width>=18&&(o.width-=18))),i._isMobile&&i._disableScrollbar(),e.datavisualization.Diagram.SvgContext.setSize(i,o.width,o.height)},_setMinMaxValues:function(t,e,i,a,n,o,s){var r=t.model.pageSettings.scrollableArea;return e=Math.max(e,r.x*s),i=Math.max(i,r.y*s),a=Math.min((r.x+r.width)*s-o.width,a),n=Math.min((r.y+r.height)*s-o.height,n),{minX:e,minY:i,maxX:a=a>0?a:0,maxY:n=n>0?n:0}},_initScrollbar:function(i){var a=i._canvas,n=document.getElementById(a.id+"_hScrollbar"),o=document.getElementById(a.id+"_vScrollbar"),s=this._viewPort(i);t(n).ejScrollBar({orientation:e.ScrollBar.Orientation.Horizontal,width:s.width-18,viewportSize:s.width-18,scroll:function(t){var a,n;null!=t.source&&("thumb"==t.source||"button"==t.source||"key"==t.source)&&null!=t.scrollData&&(a={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(t.scrollLeft,i._vScrollOffset),n={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=e.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:n,oldValues:a}))}}),i._hScrollbar=t(n).ejScrollBar("instance"),t(o).ejScrollBar({orientation:e.ScrollBar.Orientation.Vertical,height:s.height-18,viewportSize:s.height-18,scroll:function(t){var a,n;null!=t.source&&("thumb"==t.source||"button"==t.source||"key"==t.source)&&null!=t.scrollData&&(a={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(i._hScrollOffset,t.scrollTop),n={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=e.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:n,oldValues:a}))}}),i._vScrollbar=t(o).ejScrollBar("instance")}},e.datavisualization.Diagram.SnapUtil={_canConsider:function(t,e,i){var a=!1;return e!=i&&("group"==e._type||"pseudoGroup"==e._type?a=!(i.isSwimlane&&!e.isSwimlane)&&!this._contains(t,e,i):"group"==i._type&&"bpmn"!=i.type||"pseudoGroup"==i.type?a=!(i.isSwimlane&&!e.isSwimlane)&&!this._contains(t,i,e):e.segments||(a=!(e==i))),a},_contains:function(t,e,i){var a,n,o,s=i.name;if(e.children.indexOf(s)>=0){if(t[s]==i)return!0}else if(e.children.indexOf(i)>=0)return!0;if("group"==e._type||"pseudoGroup"==e._type){for(a=!1,n=0;n<e.children.length;n++)if(this.diagram&&((o="string"==typeof e.children[n]?t[e.children[n]]:t[e.children[n].name])&&("string"==typeof o&&(o=t[o]),"group"==o._type&&(a=this._contains(t,o,i)),a)))return a;return a}return!1},_getSnapIntervals:function(t,e){var i,a,n,o=[];return t.model.rulerSettings.showRulers?(a=(i=e?t.model.rulerSettings.horizontalRuler:t.model.rulerSettings.verticalRuler).segmentWidth/i.interval,o.push(Math.round(100*a)/100)):(n=t.model.snapSettings,o=e?n.verticalGridLines.snapInterval:n.horizontalGridLines.snapInterval),o},_round:function(t,e,i){var a,n;for(i=i>1?Math.pow(2,Math.floor(Math.log(i)/Math.log(2))):Math.pow(2,Math.ceil(Math.log(i)/Math.log(2))),a=0,n=0;n<e.length;n++)a+=e[n];var o=t%(a/=i),s=Math.floor(Math.abs(t)/a)*a;if(s!=t)if(t>=0)for(n=0;n<e.length;n++){if(o<=e[n]/i)return s+(o<e[n]/(2*i)?0:e[n]/i);s+=e[n]/i,o-=e[n]/i}else for(s*=-1,n=e.length-1;n>=0;n--){if(Math.abs(o)<=e[n]/i)return s-(Math.abs(o)<e[n]/(2*i)?0:e[n]/i);s-=e[n]/i,o+=e[n]/i}return t},_findNodes:function(t,i,a,n,o){for(var s,r,l,d,h=[],g=e.datavisualization.Diagram.SpatialUtil.findQuads(t,o?n:a),c=0;c<g.length;c++)if((s=g[c]).objects.length>0)for(d=0;d<s.objects.length;d++)!(r=s.objects[d]).segments&&r.visible&&(l=e.datavisualization.Diagram.Util.bounds(r),-1==h.indexOf(r)&&e.datavisualization.Diagram.Geometry.intersectsRect(a,l)&&h.push(r),o&&o.indexOf(r)&&e.datavisualization.Diagram.Geometry.intersectsRect(n,l)&&o.push(r));return h},_snapAngle:function(t,e){var i=t._snapAngle(),a=e%i;return a>=i/2?e+i-a:e-a},_snapPoint:function(t,i,a,n,o,s,r){t.model.snapSettings;var l=t._currZoom,d=e.datavisualization.Diagram.Point(),h=e.datavisualization.Diagram.Util.bounds(i),g={snapped:!1,offset:0},c={snapped:!1,offset:0};this.diagram=t,t._enableSnapToObject()&&this._snapObject(t,i,g,c,o,r==s);var u=h.x+o.x,m=h.y+o.y,p=h.x+h.width+o.x,f=h.y+h.height+o.y,_=this._round(p,this._getSnapIntervals(t,!0),l),v=this._round(u,this._getSnapIntervals(t,!0),l),y=this._round(m,this._getSnapIntervals(t,!1),l),b=this._round(f,this._getSnapIntervals(t,!1),l),x=h.x+h.width,D=h.y+h.height;return g.snapped?d.x=t._enableSnapToObject()?g.offset:s.x-r.x:t._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines?Math.abs(o.x)>=1&&(d.x+=a?Math.abs(_-x)>Math.abs(v-h.x)?v-h.x:_-x:Math.abs(_-x)<Math.abs(v-h.x)?_-x:v-h.x):d.x=s.x-r.x,c.snapped?d.y=c.offset:t._snapConstraints()&e.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines?Math.abs(o.y)>=1&&(d.y+=n?Math.abs(b-D)>Math.abs(y-h.y)?y-h.y:b-D:Math.abs(b-D)<Math.abs(y-h.y)?b-D:y-h.y):d.y=s.y-r.y,d},_snapObject:function(t,i,a,n,o,s){var r,l,d,h,g,c,u,m,p=null,f=null,_=[],v=[],y=[],b=[],x=e.datavisualization.Diagram.Util.bounds(i),D=t._currZoom,C=t._hScrollOffset,z=t._vScrollOffset,S=t._snapObjectDistance(),P=t._viewPort,w=e.datavisualization.Diagram.Rectangle(C/D,x.y-S-5,P.width/D,x.height+2*S+10),T=e.datavisualization.Diagram.Rectangle(x.x-S-5,z/D,x.width+2*S+10,P.height/D);for(P=e.datavisualization.Diagram.Rectangle(C/D,z/D,P.width/D,P.height/D),d=this._findNodes(t._spatialSearch,i,T,P),u=t.nameTable,h=0;h<d.length;h++)g=d[h],e.datavisualization.Diagram.Util._canBeTarget(t,g)&&!g.segments&&this._canConsider(u,i,g)&&((c=e.datavisualization.Diagram.Util.bounds(g)).y+c.height<x.y+o.y?y.push({object:g,distance:Math.abs(x.y+o.y-c.y-c.height)}):c.y>x.y+o.y+x.height&&b.push({object:g,distance:Math.abs(x.y+o.y+x.height-c.y)}),(null==p||p>Math.abs(c.y-x.y-o.y))&&(Math.abs(c.x+c.width/2-(x.x+x.width/2+o.x))<=S?(r=this._createSnapObject(c,x,"centerX"),p=Math.abs(c.y-x.y)):Math.abs(c.x-(x.x+o.x))<=S?(r=this._createSnapObject(c,x,"left"),p=Math.abs(c.y-x.y)):Math.abs(c.x+c.width-(x.x+x.width+o.x))<=S?(r=this._createSnapObject(c,x,"right"),p=Math.abs(c.y-x.y)):Math.abs(c.x+c.width-(x.x+o.x))<=S?(r=this._createSnapObject(c,x,"leftRight"),p=Math.abs(c.y-x.y)):Math.abs(c.x-(x.x+x.width+o.x))<=S&&(r=this._createSnapObject(c,x,"rightLeft"),p=Math.abs(c.y-x.y))));for(d=this._findNodes(t._spatialSearch,i,w,P),h=0;h<d.length;h++)g=d[h],e.datavisualization.Diagram.Util._canBeTarget(t,g)&&!g.segments&&this._canConsider(u,i,g)&&((c=e.datavisualization.Diagram.Util.bounds(g)).x+c.width<x.x+o.x&&(_[_.length]={object:g,distance:Math.abs(x.x+o.x-c.x-c.width)}),c.x>x.x+o.x+x.width&&(v[v.length]={object:g,distance:Math.abs(x.x+o.x+x.width-c.x)}),(null==f||f>Math.abs(c.x-x.x-o.x))&&(Math.abs(c.y+c.height/2-(x.y+x.height/2+o.y))<=S?(l=this._createSnapObject(c,x,"centerY"),f=Math.abs(c.x-x.x)):Math.abs(c.y-x.y-o.y)<=S?(l=this._createSnapObject(c,x,"top"),f=Math.abs(c.x-x.x)):Math.abs(c.y+c.height-(x.y+x.height+o.y))<=S?(l=this._createSnapObject(c,x,"bottom"),f=Math.abs(c.x-x.x)):Math.abs(c.y+c.height-x.y-o.y)<=S?(l=this._createSnapObject(c,x,"topBottom"),f=Math.abs(c.x-x.x)):Math.abs(c.y-(x.y+x.height+o.y))<=S&&(l=this._createSnapObject(c,x,"bottomTop"),f=Math.abs(c.x-x.x))));m=this._createGuidelines(t,r,l,a,n,s),a.snapped||this._createHSpacingLines(t,i,_,v,a,n,s,m,o,S),n.snapped||this._createVSpacingLines(t,i,y,b,a,n,s,m,o,S)},_snapSize:function(t,i,a,n,o,s,r){var l,d,h,g,c,u,m,p,f,_=null,v=null,y=e.datavisualization.Diagram.Util.bounds(s),b=t.nameTable,x=[],D=[],C=t._currZoom,z=t._hScrollOffset,S=t._vScrollOffset,P=t._snapObjectDistance(),w=t._viewPort,T=e.datavisualization.Diagram.Rectangle(z/C,(y.y-5)/C,w.width/C,(y.height+10)/C),j=e.datavisualization.Diagram.Rectangle((y.x-5)/C,S/C,(y.width+10)/C,w.height/C);for(w=e.datavisualization.Diagram.Rectangle(z/C,S/C,w.width/C,w.height/C),h=[],g=this._findNodes(t._spatialSearch,s,j,w,h),c=0;c<g.length;c++)u=g[c],this._canConsider(b,s,u)&&!u.segments&&(m=e.datavisualization.Diagram.Util.bounds(u),(null==_||_>Math.abs(m.y-y.y))&&(i.left?Math.abs(y.x+n-m.x)<=P?(l=this._createSnapObject(m,y,"left"),_=Math.abs(m.y-y.y)):Math.abs(y.x+n-m.x-m.width)<=P&&(l=this._createSnapObject(m,y,"leftRight"),_=Math.abs(m.y-y.y)):i.right&&(Math.abs(y.x+n+y.width-m.x-m.width)<=P?(l=this._createSnapObject(m,y,"right"),_=Math.abs(m.y-y.y)):Math.abs(y.x+n+y.width-m.x)<=P&&(l=this._createSnapObject(m,y,"rightLeft"),_=Math.abs(m.y-y.y)))));for(g=this._findNodes(t._spatialSearch,s,T,w),c=0;c<g.length;c++)u=g[c],this._canConsider(b,s,u)&&!u.segments&&(m=e.datavisualization.Diagram.Util.bounds(u),(null==v||v>Math.abs(m.x-y.x))&&(a.top?Math.abs(y.y+o-m.y)<=P?(d=this._createSnapObject(m,y,"top"),v=Math.abs(m.x-y.x)):Math.abs(y.y+o-m.y-m.height)<=P&&(d=this._createSnapObject(m,y,"topBottom"),v=Math.abs(m.x-y.x)):a.bottom&&(Math.abs(y.y+y.height+o-m.y-m.height)<=P?(d=this._createSnapObject(m,y,"bottom"),v=Math.abs(m.x-y.x)):Math.abs(y.y+y.height+o-m.y)<=P&&(d=this._createSnapObject(m,y,"bottomTop"),v=Math.abs(m.x-y.x)))));for(c=0;c<h.length;c++)if(u=h[c],this._canConsider(b,s,u)){var E,N=e.datavisualization.Diagram.Util.bounds(u),L=i.left?-n:n,I=Math.abs(y.width+L-N.width);I<=P&&(E=i.left?-N.width+y.width:N.width-y.width,x[x.length]={source:u,diff:I,offset:E}),L=a.top?-o:o,(p=Math.abs(y.height+L-N.height))<=P&&(E=a.top?-N.height+y.height:N.height-y.height,D[D.length]={source:u,diff:p,offset:E})}t.activeTool.selectedSeperator||(f=this._createGuidelines(t,l,d,i,a,r)),!i.snapped&&x.length>0&&(i.left||i.right)&&this._addSameWidthLines(t,x,i,r,f,s),!a.snapped&&D.length>0&&(a.top||a.bottom)&&this._addSameHeightLines(t,D,a,r,f,s)},_createSnapObject:function(t,i,a){var n;switch(a){case"left":n={start:e.datavisualization.Diagram.Point(t.x,Math.min(t.y,i.y)),end:e.datavisualization.Diagram.Point(t.x,Math.max(t.y+t.height,i.y+i.height)),offsetX:t.x-i.x,offsetY:0,type:"sideAlign"};break;case"right":n={start:e.datavisualization.Diagram.Point(t.x+t.width,Math.min(t.y,i.y)),end:e.datavisualization.Diagram.Point(t.x+t.width,Math.max(t.y+t.height,i.y+i.height)),offsetX:t.x+t.width-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"top":n={start:e.datavisualization.Diagram.Point(Math.min(t.x,i.x),t.y),end:e.datavisualization.Diagram.Point(Math.max(t.x+t.width,i.x+i.width),t.y),offsetY:t.y-i.y,offsetX:0,type:"sideAlign"};break;case"bottom":n={start:e.datavisualization.Diagram.Point(Math.min(t.x,i.x),t.y+t.height),end:e.datavisualization.Diagram.Point(Math.max(t.x+t.width,i.x+i.width),t.y+t.height),offsetY:t.y+t.height-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"topBottom":n={start:e.datavisualization.Diagram.Point(Math.min(t.x,i.x),t.y+t.height),end:e.datavisualization.Diagram.Point(Math.max(t.x+t.width,i.x+i.width),t.y+t.height),offsetY:t.y+t.height-i.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":n={start:e.datavisualization.Diagram.Point(Math.min(t.x,i.x),t.y),end:e.datavisualization.Diagram.Point(Math.max(t.x+t.width,i.x+i.width),t.y),offsetY:t.y-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"leftRight":n={start:e.datavisualization.Diagram.Point(t.x+t.width,Math.min(t.y,i.y)),end:e.datavisualization.Diagram.Point(t.x+t.width,Math.max(t.y+t.height,i.y+i.height)),offsetX:t.x+t.width-i.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":n={start:e.datavisualization.Diagram.Point(t.x,Math.min(t.y,i.y)),end:e.datavisualization.Diagram.Point(t.x,Math.max(t.y+t.height,i.y+i.height)),offsetX:t.x-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"centerX":n={start:e.datavisualization.Diagram.Point(t.x+t.width/2,Math.min(t.y,i.y)),end:e.datavisualization.Diagram.Point(t.x+t.width/2,Math.max(t.y+t.height,i.y+i.height)),offsetX:t.x+t.width/2-(i.x+i.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":n={start:e.datavisualization.Diagram.Point(Math.min(t.x,i.x),t.y+t.height/2),end:e.datavisualization.Diagram.Point(Math.max(t.x+t.width,i.x+i.width),t.y+t.height/2),offsetY:t.y+t.height/2-(i.y+i.height/2),offsetX:0,type:"centerAlign"}}return n},_createGuidelines:function(t,i,a,n,o,s){var r={id:t._canvas.id+"guideline",style:"pointer-events:none;"},l=e.datavisualization.Diagram.SvgContext._initializeGuidelines(t._adornerSvg,r,t._adornerLayer),d=t._currZoom,h=t._hScrollOffset,g=t._vScrollOffset;return i&&(n.offset=i.offsetX,n.snapped=!0,s||("sideAlign"==i.type?e.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(i.start,i.end,l,t._adornerSvg,d,h,g):"centerAlign"==i.type&&e.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(i.start,i.end,l,t._adornerSvg,d,h,g))),a&&(o.offset=a.offsetY,o.snapped=!0,s||("sideAlign"==a.type?e.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(a.start,a.end,l,t._adornerSvg,d,h,g):"centerAlign"==a.type&&e.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(a.start,a.end,l,t._adornerSvg,d,h,g))),t._guideline=l,l},_removeGuidelines:function(t){var i=t._guideline?t._guideline:t._adornerSvg.getElementById(t._canvas.id+"guideline");null!=i&&(e.datavisualization.Diagram.SvgContext._removeGuidelines(t._adornerLayer,i),delete t._guideline)},_sortByDistance:function(t,e,i){var a,n,o;if(i)for(a=0;a<t.length;a++)for(n=a+1;n<t.length;n++)t[a][e]>t[n][e]&&(o=t[a],t[a]=t[n],t[n]=o);else for(a=0;a<t.length;a++)for(n=a+1;n<t.length;n++)t[a][e]<t[n][e]&&(o=t[a],t[a]=t[n],t[n]=o)},_createHSpacingLines:function(t,i,a,n,o,s,r,l,d,h){var g,c,u,m,p,f,_,v,y,b=null;this._sortByDistance(a,"distance",!0),this._sortByDistance(n,"distance",!0),g=[],c=e.datavisualization.Diagram.Util.bounds(i),a.length>0&&(g[g.length]=a[0],b=(u=e.datavisualization.Diagram.Util.bounds(a[0].object)).y,a.length>1?(p=e.datavisualization.Diagram.Util.bounds(a[1].object),f=u.x-p.x-p.width,Math.abs(f-a[0].distance)<=h?b=this._findEquallySpacedNodesAtLeft(a,f,b,g):f=a[0].distance):f=a[0].distance),this._sortByDistance(g,"distance"),g[g.length]={object:i,distance:0},b=c.y<b||!b?c.y:b,n.length>0&&(b=(m=e.datavisualization.Diagram.Util.bounds(n[0].object)).y<b?m.y:b,n.length>1&&(_=(p=e.datavisualization.Diagram.Util.bounds(n[1].object)).x-m.x-m.width),a.length>0?Math.abs(n[0].distance-a[0].distance)<=h?(v=Math.abs(n[0].distance-a[0].distance)/2,n[0].distance<a[0].distance?f-=v:f+=v,g[g.length]=n[0]):1==a.length&&(u=void 0,g.splice(0,1),g[g.length]=n[0],f=_):(f=_,g[g.length]=n[0]),n.length>1&&m.x+m.width<p.x&&(b=this._findEquallySpacedNodesAtRight(n,_,b,g,h))),g.length>2&&(this._addHSpacingLines(t,g,r,l,b),y=0,r&&(y=d.x),u?o.offset=f-Math.abs(c.x+y-u.x-u.width)+y:m&&(o.offset=Math.abs(c.x+c.width+y-m.x)-f+y),o.snapped=!0)},_createVSpacingLines:function(t,i,a,n,o,s,r,l,d,h){var g,c,u,m,p,f,_,v,y,b=null;this._sortByDistance(a,"distance",!0),this._sortByDistance(n,"distance",!0),g=[],c=e.datavisualization.Diagram.Util.bounds(i),a.length>0&&(g[g.length]=a[0],b=(u=e.datavisualization.Diagram.Util.bounds(a[0].object)).x+u.width,a.length>1?(p=e.datavisualization.Diagram.Util.bounds(a[1].object),f=u.y-p.y-p.height,Math.abs(f-a[0].distance)<=h?b=this._findEquallySpacedNodesAtTop(a,f,b,g):f=a[0].distance):f=a[0].distance),this._sortByDistance(g,"distance"),g[g.length]={object:i,distance:0},b=c.x+c.width>b||!b?c.x+c.width:b,n.length>0&&(b=(m=e.datavisualization.Diagram.Util.bounds(n[0].object)).x+m.width>b?m.x+m.width:b,n.length>1&&(_=(p=e.datavisualization.Diagram.Util.bounds(n[1].object)).y-m.y-m.height),a.length>0?Math.abs(n[0].distance-a[0].distance)<=h?(v=Math.abs(n[0].distance-a[0].distance)/2,n[0].distance<a[0].distance?f-=v:f+=v,g[g.length]=n[0]):1==a.length&&(u=void 0,g.splice(0,1),g[g.length]=n[0],f=_):(f=_,g[g.length]=n[0]),n.length>1&&p.y>m.y+m.height&&(b=this._findEquallySpacedNodesAtBottom(n,_,b,g,h))),g.length>2&&(this._addVSpacingLine(t,g,r,l,b),y=0,r&&(y=d.y),u?s.offset=f-Math.abs(c.y+y-u.y-u.height)+y:m&&(s.offset=Math.abs(c.y+c.height+y-m.y)-f+y),s.snapped=!0)},_addHSpacingLines:function(t,i,a,n,o){var s,r,l,d=t._currZoom,h=t._hScrollOffset,g=t._vScrollOffset;if(i.length>2&&!a)for(s=0;s<i.length-1;s++)r=e.datavisualization.Diagram.Util.bounds(i[s].object),l=e.datavisualization.Diagram.Util.bounds(i[s+1].object),e.datavisualization.Diagram.SvgContext._renderSpacingLines(e.datavisualization.Diagram.Point(r.x+r.width,o-15),e.datavisualization.Diagram.Point(l.x,o-15),n,t._adornerSvg,d,h,g)},_addVSpacingLine:function(t,i,a,n,o){var s,r,l,d=t._currZoom,h=t._hScrollOffset,g=t._vScrollOffset;if(i.length>2&&!a)for(l=0;l<i.length-1;l++)s=e.datavisualization.Diagram.Util.bounds(i[l].object),r=e.datavisualization.Diagram.Util.bounds(i[l+1].object),e.datavisualization.Diagram.SvgContext._renderSpacingLines(e.datavisualization.Diagram.Point(o+15,s.y+s.height),e.datavisualization.Diagram.Point(o+15,r.y),n,t._adornerSvg,d,h,g)},_addSameWidthLines:function(t,i,a,n,o,s){var r,l=t._currZoom,d=t._hScrollOffset,h=t._vScrollOffset;this._sortByDistance(i,"offset");var g=e.datavisualization.Diagram.Util.bounds(s),c=i[0],u=e.datavisualization.Diagram.Util.bounds(c.source),m=[];for(m.push(i[0]),r=1;r<i.length;r++)e.datavisualization.Diagram.Util.bounds(i[r].source).width==u.width&&m.push(i[r]);if(m.length>0&&!n)for(e.datavisualization.Diagram.SvgContext._renderSpacingLines(e.datavisualization.Diagram.Point(g.x+c.offset,g.y-15),e.datavisualization.Diagram.Point(g.x+g.width+c.offset,g.y-15),o,t._adornerSvg,l,d,h),r=0;r<m.length;r++)g=e.datavisualization.Diagram.Util.bounds(m[r].source),e.datavisualization.Diagram.SvgContext._renderSpacingLines(e.datavisualization.Diagram.Point(g.x,g.y-15),e.datavisualization.Diagram.Point(g.x+g.width,g.y-15),o,t._adornerSvg,l,d,h);a.offset=c.offset,a.snapped=!0},_addSameHeightLines:function(t,i,a,n,o,s){var r,l=t._currZoom,d=t._hScrollOffset,h=t._vScrollOffset;this._sortByDistance(i,"offset");var g=e.datavisualization.Diagram.Util.bounds(s),c=i[0],u=e.datavisualization.Diagram.Util.bounds(c.source),m=[];for(m.push(i[0]),r=0;r<i.length;r++)e.datavisualization.Diagram.Util.bounds(i[r].source).height==u.height&&m.push(i[r]);if(m.length>0){if(!n)for(e.datavisualization.Diagram.SvgContext._renderSpacingLines(e.datavisualization.Diagram.Point(g.x+g.width+15,g.y+c.offset),e.datavisualization.Diagram.Point(g.x+g.width+15,g.y+g.height+c.offset),o,t._adornerSvg,l,d,h),r=0;r<m.length;r++)g=e.datavisualization.Diagram.Util.bounds(m[r].source),e.datavisualization.Diagram.SvgContext._renderSpacingLines(e.datavisualization.Diagram.Point(g.x+g.width+15,g.y),e.datavisualization.Diagram.Point(g.x+g.width+15,g.y+g.height),o,t._adornerSvg,l,d,h);a.offset=c.offset,a.snapped=!0}},_findEquallySpacedNodesAtLeft:function(t,i,a,n){for(var o,s,r,l=1;l<t.length&&(o=e.datavisualization.Diagram.Util.bounds(t[l-1].object),s=e.datavisualization.Diagram.Util.bounds(t[l].object),r=o.x-s.x-s.width,Math.abs(r-i)<=1);l++)n[n.length]=t[l],s.y<a&&(a=s.y);return a},_findEquallySpacedNodesAtRight:function(t,i,a,n,o){var s,r,l,d,h,g=t[0].distance;if(Math.abs(i-g)<=o)for(h=0;h<t.length-1&&(s=t[h].object,r=e.datavisualization.Diagram.Util.bounds(t[h+1].object),l=e.datavisualization.Diagram.Util.bounds(s),d=r.x-l.x-l.width,Math.abs(d-i)<=1);h++)n[n.length]=t[h+1],l.y<a&&(a=l.y);return a},_findEquallySpacedNodesAtTop:function(t,i,a,n){for(var o,s,r,l=1;l<t.length&&(o=e.datavisualization.Diagram.Util.bounds(t[l-1].object),s=e.datavisualization.Diagram.Util.bounds(t[l].object),r=o.y-s.y-s.height,Math.abs(r-i)<=1);l++)n[n.length]=t[l],s.x+s.width>a&&(a=s.x+s.width);return a},_findEquallySpacedNodesAtBottom:function(t,i,a,n,o){var s,r,l,d,h,g=t[0].distance;if(Math.abs(i-g)<=o)for(h=0;h<t.length-1&&(s=t[h].object,r=e.datavisualization.Diagram.Util.bounds(t[h+1].object),l=e.datavisualization.Diagram.Util.bounds(s),d=r.y-l.y-l.height,Math.abs(d-i)<=1);h++)n[n.length]=t[h+1],l.x+l.width>a&&(a=l.x+l.width);return a}},e.datavisualization.Diagram.SpatialUtil={findQuads:function(t,e){t.quads=[];var i=t.parentQuad;return this._findQuads(t,i,e),t.quads},_addIntoAQuad:function(t){for(var e=!1;!e;)e=this._add(t,t.parentQuad)},_setCurrentNode:function(t,i,a){var n,o,s,r,l;if(t.childnode=i,n=e.datavisualization.Diagram.Util.bounds(i),t.childLeft=n.left,t.childTop=n.top,t.childRight=n.right,t.childBottom=n.bottom,a)for(o=i.labels,s=0;s<o.length;s++)(r=o[s])&&r.visible&&!a.activeTool.inAction&&!a._isLayoutExecute&&((l=e.datavisualization.Diagram.Util.getLabelbounds(a,i,r))&&(n=a._union(l,n),n=e.datavisualization.Diagram.Util.bounds(n),t.childLeft=n.left,t.childTop=n.top,t.childRight=n.right,t.childBottom=n.bottom))},_add:function(t,i){if(this._isContained(t,i))return this._selectQuad(t,i),!0;var a,n=!i.objects.length&&null==i.first&&null==i.second&&null==i.third&&null==i.fourth;return t.childLeft<i.left?t.childTop<i.top?(a=e.datavisualization.Diagram.Quad(i.left-i.width,i.top-i.height,2*i.width,2*i.height),n||(a.fourth=i)):(a=e.datavisualization.Diagram.Quad(i.left-i.width,i.top,2*i.width,2*i.height),n||(a.second=i)):t.childTop<i.top?(a=e.datavisualization.Diagram.Quad(i.left,i.top-i.height,2*i.width,2*i.height),n||(a.third=i)):(a=e.datavisualization.Diagram.Quad(i.left,i.top,2*i.width,2*i.height),n||(a.first=i)),i.parent=a,t.parentQuad=a,!1},_isContained:function(t,e){return t.childLeft>=e.left&&t.childRight<=e.left+e.width&&t.childTop>=e.top&&t.childBottom<=e.top+e.height},_selectQuad:function(t,e){for(var i=e;null!==i;)i=this._getQuad(t,i)},_getQuad:function(t,i){var a,n,o=i.width/2,s=i.height/2,r=t._isRouting&&t._viewPortHeight>0?t._viewPortHeight:100;if(o>=(t._isRouting&&t._viewPortWidth>0?t._viewPortWidth:100)&&s>=r)if(a=i.left+o,n=i.top+s,t.childRight<=a){if(t.childBottom<=n)return i.first?i.first:i.first=e.datavisualization.Diagram.Quad(i.left,i.top,o,s,i);if(t.childTop>=n)return i.third?i.third:i.third=e.datavisualization.Diagram.Quad(i.left,n,o,s,i)}else if(t.childLeft>=a){if(t.childBottom<=n)return i.second?i.second:i.second=e.datavisualization.Diagram.Quad(a,i.top,o,s,i);if(t.childTop>=n)return i.fourth?i.fourth:i.fourth=e.datavisualization.Diagram.Quad(a,n,o,s,i)}return i.objects.push(t.childnode),t.quadTable[t.childnode.name]=i,null},_findQuads:function(t,e,i){e.first&&this._isIntersect(e.first,i)&&this._findQuads(t,e.first,i),e.second&&this._isIntersect(e.second,i)&&this._findQuads(t,e.second,i),e.third&&this._isIntersect(e.third,i)&&this._findQuads(t,e.third,i),e.fourth&&this._isIntersect(e.fourth,i)&&this._findQuads(t,e.fourth,i),e.objects.length>0&&t.quads.push(e)},_isIntersect:function(t,e){return!(t.left+t.width<e.x||t.top+t.height<e.y||t.left>e.x+e.width||t.top>e.y+e.height)},_update:function(t){if(null!=t.parent&&0==t.objects.length&&null==t.first&&null==t.second&&null==t.third&&null==t.fourth){var e=t.parent;e.first==t?e.first=null:e.second==t?e.second=null:e.third==t?e.third=null:e.fourth==t&&(e.fourth=null),this._update(t.parent)}},_isWithinPageBounds:function(t,e){return e.left>=t.pageLeft&&e.right<=t.pageRight&&e.top>=t.pageTop&&e.bottom<=t.pageBottom},_updateBounds:function(t,i,a,n){var o=!1;i.topElement&&a.name==i.topElement.name&&(o=!0,i.pageTop=null,this._findQuadElement(i,i.parentQuad,"top")),i.leftElement&&a.name==i.leftElement.name&&(o=!0,i.pageLeft=null,this._findQuadElement(i,i.parentQuad,"left")),i.rightElement&&a.name==i.rightElement.name&&(o=!0,i.pageRight=null,this._findQuadElement(i,i.parentQuad,"right")),i.bottomElement&&a.name==i.bottomElement.name&&(o=!0,i.pageBottom=null,this._findQuadElement(i,i.parentQuad,"bottom")),o&&t._pageBackgroundLayer&&e.datavisualization.Diagram.PageUtil._updatePageSize(t,void 0===n||n)},_findQuadElement:function(t,i,a){var n,o;switch(a){case"bottom":null!=i.third||null!=i.fourth?(null!=i.third&&this._findQuadElement(t,i.third,a),null!=i.fourth&&this._findQuadElement(t,i.fourth,a)):(null!=i.first&&this._findQuadElement(t,i.first,a),null!=i.second&&this._findQuadElement(t,i.second,a));break;case"top":null!=i.first||null!=i.second?(null!=i.first&&this._findQuadElement(t,i.first,a),null!=i.second&&this._findQuadElement(t,i.second,a)):(null!=i.third&&this._findQuadElement(t,i.third,a),null!=i.fourth&&this._findQuadElement(t,i.fourth,a));break;case"left":null!=i.first||null!=i.third?(null!=i.first&&this._findQuadElement(t,i.first,a),null!=i.third&&this._findQuadElement(t,i.third,a)):(null!=i.second&&this._findQuadElement(t,i.second,a),null!=i.fourth&&this._findQuadElement(t,i.fourth,a));break;case"right":null!=i.second||null!=i.fourth?(null!=i.second&&this._findQuadElement(t,i.second,a),null!=i.fourth&&this._findQuadElement(t,i.fourth,a)):(null!=i.third&&this._findQuadElement(t,i.third,a),null!=i.first&&this._findQuadElement(t,i.first,a))}for(o=0;o<i.objects.length;o++)n=e.datavisualization.Diagram.Util.bounds(i.objects[o]),"bottom"===a&&(t.pageBottom<=n.bottom||null==t.pageBottom)?(t.pageBottom=n.bottom,t.bottomElement=i.objects[o]):"top"===a&&(t.pageTop>=n.top||null==t.pageTop)?(t.pageTop=n.top,t.topElement=i.objects[o]):"left"===a&&(t.pageLeft>=n.left||null==t.pageLeft)?(t.pageLeft=n.left,t.leftElement=i.objects[o]):"right"===a&&(t.pageRight<=n.right||null==t.pageRight)&&(t.pageRight=n.right,t.rightElement=i.objects[o])},_initializeNodes:function(t,e){for(var i,a=t.nodes(),n=0;n<a.length;n++)i=a[n],"group"!=this.getObjectType(i)&&this._updateQuad(t,e,i)},_initializeConnectors:function(t,e){for(var i=t.connectors(),a=0;a<i.length;a++)this._updateQuad(t,e,i[a])},_updateQuad:function(i,a,n){var o,s,r,l,d;this._setCurrentNode(a,n,i),o=e.datavisualization.Diagram.Util.bounds(n),(s=a.quadTable[n.name])?this._isContained(a,s)||(this._removeFromaQuad(a,s,n),this._addIntoAQuad(a)):(a.parentQuad||(a.parentQuad=e.datavisualization.Diagram.Quad(0,0,200,200)),this._addIntoAQuad(a)),this._isWithinPageBounds(a,o)&&a.leftElement!=n&&a.topElement!=n&&a.rightElement!=n&&a.bottomElement!=n||(r=!1,l=!1,a.pageLeft>=a.childLeft||null==a.pageLeft?(a.pageLeft=a.childLeft,a.leftElement=n,r=!0):n==a.leftElement&&(a.pageLeft=null,this._findQuadElement(a,a.parentQuad,"left"),l=r=!0),a.pageTop>=a.childTop||null==a.pageTop?(a.pageTop=a.childTop,a.topElement=n,r=!0):n==a.topElement&&(a.pageTop=null,this._findQuadElement(a,a.parentQuad,"top"),l=r=!0),a.pageBottom<=a.childBottom||null==a.pageBottom?(r=!0,a.pageBottom=a.childBottom,a.bottomElement=n):n==a.bottomElement&&(a.pageBottom=null,this._findQuadElement(a,a.parentQuad,"bottom"),l=r=!0),a.pageRight<=a.childRight||null==a.pageRight?(a.pageRight=a.childRight,a.rightElement=n,r=!0):n==a.rightElement&&(a.pageRight=null,this._findQuadElement(a,a.parentQuad,"right"),l=r=!0)),d=i.activeTool.diagramBounds,r&&i.model.pageSettings.multiplePage&&(i.model.pageSettings.pageWidth||i.model.pageSettings.pageHeight)&&d&&(r=!1,(l||a.pageLeft<d.x||a.pageTop<d.y||a.pageRight>d.x+d.width||a.pageBottom>d.y+d.height)&&(r=!0,i.activeTool.diagramBounds=i._getDigramBounds())),r&&(i._views.forEach(function(e){var a,n=i._views[e];"overview"==n.type&&((a=t("#"+e).ejOverview("instance"))&&a._updateOverview(n))}),!i._layoutInAction&&i._pageBackgroundLayer&&e.datavisualization.Diagram.PageUtil._updatePageSize(i,i.activeTool.inAction||i._selectedSymbol))},_removeFromaQuad:function(t,e,i){if(e){var a=e.objects.indexOf(i);e.objects.splice(a,1),this._update(e),delete t.quadTable[i.name]}}},e.datavisualization.Diagram.Quad=function(t,e,i,a,n){return{left:t,top:e,width:i,height:a,parent:n,first:null,second:null,third:null,fourth:null,objects:[]}},e.datavisualization.Diagram.SpatialSearch=function(t){var i=e.datavisualization.Diagram.ScrollUtil._viewPort(t),a=0,n=0,o=200,s=200;return e.datavisualization.Diagram.Util.canRouteDiagram(t)&&(a=-100,n=-100,o=i.height>0?i.height:1e3,s=i.width>0?i.width:1e3),{pageLeft:null,pageRight:null,pageTop:null,pageBottom:null,topElement:null,bottomElement:null,rightElement:null,leftElement:null,childLeft:null,childTop:null,childRight:null,childBottom:null,childNode:null,quads:null,parentQuad:e.datavisualization.Diagram.Quad(a,n,s,o),quadTable:{}}},e.datavisualization.Diagram.ClassifierHelper={getEditableElementUnderMouse:function(t,e){var i=e._findNodeUnderMouse(t);return i&&((i.name.match("_attribute")?"attribute":i.name.match("_method")?"method":i.name.match("_member")?"member":"header")&&i.parent&&(i=e.nameTable[i.parent])),i},getMovableElementUnderMouse:function(t,e){var i=e._findNodeUnderMouse(t);t.target.className;return!i||!i.parent||"umlclassifier"==i.type||(i=e.nameTable[i.parent]),i},getSelectableElementUnderMouse:function(t,e){var i=e._findNodeUnderMouse(t);return!i||!i.parent||"umlclassifier"==i.type||(i=e.nameTable[i.parent]),i},getDropableElementUnderMouse:function(t,i){var a=i._findNodeUnderMouse(t);return i._nodeUnderMouse||(i._nodeUnderMouse=a),!a||!e.datavisualization.Diagram.Util.canAllowDrop(a)||a},renderResizeBorder:function(t,e,i,a){var n=e.width?e.width:e._width,o=e.height?e.height:e._height;return i.rect({id:t,width:n*a+e.borderWidth+4,height:o*a+e.borderWidth+4,x:-(e.borderWidth/2+2),y:-(e.borderWidth/2+2),stroke:"#f93732","stroke-width":2,"stroke-dasharray":"0",fill:"none","pointer-events":"none"})},getEditboxValue:function(i,a,n){for(var o,s,r,l,d,h,g,c,u,m=0;m<a.children.length;m++)"string"==typeof a.children[m]&&(a.children[m]=n.nameTable[n._getChild(a.children[m])]),o=a.children[m].name.match("_attribute")?"attribute":a.children[m].name.match("_method")?"method":a.children[m].name.match("_member")?"member":"header";for(s=i.split("\n"),u=0;u<s.length;u++)s[u]=s[u].trim().replace(/\s+/g," "),!s[u].indexOf("---")>-1&&"+"==s[u].charAt(0)||"-"==s[u].charAt(0)||"#"==s[u].charAt(0)||"~"==s[u].charAt(0)?s[u]=s[u]:u!=s[u].length-s[u].length&&!s[u].indexOf("---")>-1&&s[u].length>0&&"member"!=o&&!a.enumeration&&(s[u]="+ "+s[u]),s[u].indexOf("---")>-1&&s[u].match(/\w|\d|\D|\s/g)&&(r=s[u].match(/---/g),s[u]=r[0]);for(l=(i=s.join("\n")).split("\n---\n"),u=0;u<l.length;u++)l[u]=l[u].replace(/^\n+/g,"");for(l[0].indexOf("+")>-1&&(l[0]=l[0].replace(/[+]/g,"")),l[0].length>0&&(a.children[0].labels[0].text=l[0]),a.children[1]&&!l[2]?a.children[1].labels[0].text=l[1]:a.children[1]&&l[2]&&(a.children[1].name.indexOf("method")>-1?a.children[1].labels[0].text.indexOf(l[1])>-1?(a.children[1].labels[0].text=l[1],l.pop()):a.children[1].labels[0].text=l[2]:(d=a.children[1].name.indexOf("attribute")>-1?l[1]:a.children[1].name.indexOf("member")>-1?l[1]:l[2],a.children[1].labels[0].text=d)),a.children[2]&&(a.children[2].labels[0].text=l[2]),m=0;m<a.children.length;m++)(h=a.children[m].labels[0].text)&&h.indexOf("--")>-1&&(h=h.replace(/---\n*/g,""),a.children[m].labels[0].text=h),h&&h.endsWith("\n")&&(g=h.replace(/\n+$/g,""),a.children[m].labels[0].text=g),!(c=a.children[m].labels[0].text?a.children[m].labels[0].text.length:null)&&c<=0&&(n._remove(a.children[m]),m--),n.nameTable[a.children[m].name]=a.children[m];if(l[2]&&!a.children[2]||l[1]&&!a.children[1]){var p=[],f=e.datavisualization.Diagram.NodeConstraints.Default&~(e.datavisualization.Diagram.NodeConstraints.Select|e.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|e.datavisualization.Diagram.NodeConstraints.ResizeWest|e.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|e.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|e.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|e.datavisualization.Diagram.NodeConstraints.ResizeNorth|e.datavisualization.Diagram.NodeConstraints.ResizeSouth|e.datavisualization.Diagram.NodeConstraints.Connect|e.datavisualization.Diagram.NodeConstraints.Rotate|e.datavisualization.Diagram.NodeConstraints.ResizeEast),_={width:a.width,offsetX:a.offsetX,parent:a.name,ports:[],fillColor:"transparent",borderColor:a.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0};for(m=0;m<a.children.length;m++)0!=m&&a.children[m].name.indexOf("_attribute")>-1&&l[2].length>0?p.push({name:a.name+"_method_classifier",labels:[{text:l[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f}):0!=m&&a.children[m].name.indexOf("_method")>-1&&l[1].length>0&&p.push({name:a.name+"_attribute_classifier",labels:[{text:l[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f});for(a.children.length<2&&(l[1]&&p.push({name:a.name+"_attribute_classifier",labels:[{text:l[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f}),l[2]&&p.push({name:a.name+"_method_classifier",labels:[{text:l[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f})),u=0;u<p.length;u++)p[u].labels[0]=t.extend(!0,{},a.labels[0],p[u].labels[0]),p[u]=e.datavisualization.Diagram.Node(t.extend(!0,{},_,p[u])),n._getNodeDimension(p[u],p[u].labels[0]),p[u].offsetY+=a.offsetY-a.height/2,n.add(p[u]),n.nameTable[p[u].name]=p[u];a.children[2]&&a.children[2].match("_attribute")&&(a.children.splice(1,0,a.children[2]),a.children.pop()),"string"==typeof a.children[1]&&(a.children[1]=n.nameTable[a.children[1]]),"string"==typeof a.children[2]&&(a.children[2]=n.nameTable[a.children[2]])}for(m=0;m<a.children.length;m++)1==a.children.length&&(a.class&&(delete a.class.attributes,delete a.class.methods),a.interface&&(delete a.interface.attributes,delete a.interface.methods),a.enumeration&&delete a.enumeration.members),2==a.children.length&&(a.class&&(a.children[m].name.match("attribute")&&delete a.class.methods,a.children[m].name.match("method")&&delete a.class.attributes),a.interface&&(a.children[m].name.match("attribute")&&delete a.interface.methods,a.children[m].name.match("method")&&delete a.interface.attributes)),this._updateClassNode(a.children[m],a);return i},getUMLConnectorValue:function(e,i,a){var n,o,s,r;return(a.name===e.name+"_sourcelabel"||a.name===e.name+"_targetlabel")&&(("onetoone"==e.shape.multiplicity.type||"manytoone"==e.shape.multiplicity.type||"onetomany"==e.shape.multiplicity.type)&&(1==i.length&&(i.indexOf("1")>-1||i.indexOf("*")>-1)&&(n=!0),o=!1,a.name!==e.name+"_sourcelabel"||"onetoone"!=e.shape.multiplicity.type&&"onetomany"!=e.shape.multiplicity.type?a.name===e.name+"_targetlabel"&&("manytoone"==e.shape.multiplicity.type||"onetoone"==e.shape.multiplicity.type)&&(i="1",e.shape.multiplicity=t.extend(!0,{},e.shape.multiplicity,{target:{optional:o,lowerBounds:null,upperBounds:null}})):(i="1",e.shape.multiplicity=t.extend(!0,{},e.shape.multiplicity,{source:{optional:o,lowerBounds:null,upperBounds:null}}))),(i=this.umlConnectorEditBox(i)).match(/\d\.{3}\d/g)?r=i.split("..."):n||(s=this.umlConnectorMultiplicity(e),a.name==e.name+"_sourcelabel"?(r=s[0].text.split("..."),i=s[0].text):(r=s[1].text.split("..."),i=s[1].text)),r&&(e.shape.multiplicity=a.name==e.name+"_sourcelabel"?t.extend(!0,{},e.shape.multiplicity,{source:{optional:o,lowerBounds:r[0],upperBounds:r[1]}}):t.extend(!0,{},e.shape.multiplicity,{target:{optional:o,lowerBounds:r[0],upperBounds:r[1]}}))),a.text=i,e},umlConnectorMultiplicity:function(t){var e,i,a,n,o,s,r=[];return t.shape.multiplicity.source&&(t.shape.multiplicity.source.lowerBounds=this.umlConnectorEditBox(t.shape.multiplicity.source.lowerBounds),t.shape.multiplicity.source.upperBounds=this.umlConnectorEditBox(t.shape.multiplicity.source.upperBounds)),t.shape.multiplicity.target&&(t.shape.multiplicity.target.lowerBounds=this.umlConnectorEditBox(t.shape.multiplicity.target.lowerBounds),t.shape.multiplicity.target.upperBounds=this.umlConnectorEditBox(t.shape.multiplicity.target.upperBounds)),o=t.shape.multiplicity.source,s=t.shape.multiplicity.target,e=o.upperBounds?o.lowerBounds+"..."+o.upperBounds:o.lowerBounds,i=s.upperBounds?s.lowerBounds+"..."+s.upperBounds:s.lowerBounds,"manytoone"==t.shape.multiplicity.type&&(t.shape.multiplicity.target.optional=!1,a=e||"*",n="1"),"onetomany"==t.shape.multiplicity.type&&(t.shape.multiplicity.source.optional=!1,n=i||"*",a="1"),"manytomany"==t.shape.multiplicity.type&&(a=e||"*",n=i||"*"),"onetoone"==t.shape.multiplicity.type&&(t.shape.multiplicity.target.optional=!1,t.shape.multiplicity.source.optional=!1,a="1",n="1"),r.push({name:t.name+"_sourcelabel",text:a,segmentOffset:0,alignment:"before",margin:{left:5,top:5}},{name:t.name+"_targetlabel",text:n,segmentOffset:1,alignment:"before",margin:{right:5,bottom:5}}),r},umlConnectorEditBox:function(t){return"string"==typeof t&&t.match(/[a-zA-Z]/g)&&(t=t.replace(/[a-zA-Z]/g,"")),t},EnableorDisableConnection:function(t,e,i){return i.shape&&"umlclassifier"==i.shape.type&&"association"!=i.shape.relationship&&("dependency"!=i.shape.relationship&&"inheritance"!=i.shape.relationship&&"realization"!=i.shape.relationship&&e&&t&&t.interface&&e.class&&(t=null),"dependency"==i.shape.relationship&&e&&t&&t.class&&e.interface&&(t=null)),t},getClassifierNodeDimension:function(t,e){for(var i,a,n,o=0;o<t.children.length;o++)e._getNodeDimension(t.children[o]);for(t._height=0,o=0;o<t.children.length;o++)i=t.children[o].height?t.children[o].height:t.children[o]._height,t.children[o].offsetY=t._height+i/2,t._height+=i,t.height=t._height;for(a=t.children[0]._width,t.children[1]&&(a=t.children[0]._width>t.children[1]._width?t.children[0]._width:t.children[1]._width),t.children[2]&&(a=t.children[2]._width>a?t.children[2]._width:a),t.children[0].width=a,t.children[1]&&(t.children[1].width=a),t.children[2]&&(t.children[2].width=a),t.width=a,n=0;n<t.children.length;n++)t.children[n].offsetY+=t.offsetY-t.height/2;return e._updateAssociatedConnectorEnds(t,e.nameTable),t},_updateClassNode:function(t,i){var a,n;if(t.name.match("_header"))i.class?i.class.name=t.labels[0].text:i.interface?i.interface.name=t.labels[0].text:i.enumeration.name=t.labels[0].text;else{for(var o,s,r,l,d=t.name.match("_attribute")?"attribute":t.name.match("_method")?"method":"member",h=[],g=t.labels[0].text.split("\n"),c=[],u=0;u<g.length;u++)switch(g[u].indexOf("+")>-1?o="public":g[u].indexOf("-")>-1?o="private":g[u].indexOf("#")>-1?o="protected":g[u].indexOf("~")>-1&&(o="package"),(g[u].indexOf("+")>-1||g[u].indexOf("-")>-1||g[u].indexOf("#")>-1||g[u].indexOf("~")>-1)&&(g[u]=g[u].replace(/[+|~|#|-]\s/g,"")),d){case"attribute":l=g[u].split(/:[ ]*/g),c.push(e.datavisualization.Diagram.ClassAttribute({name:l[0],type:l[1],scope:o}));break;case"method":for(s=g[u].split(/["("|")"]/g),a=0;a<s.length;a++)s[a].indexOf(",")>-1&&(l=s[a].split(",")),a==s.length-1&&(s[a]=s[a].replace(/[:\s]|:/g,""));if(l)for(n=0;n<l.length;n++)r=l[n].split(":"),h.push(e.datavisualization.Diagram.ClassmethodArguments({name:r[0],type:r[1]}));3!=s.length||l||(s[1].indexOf(":")>-1?(r=s[1].split(":"),h.push(e.datavisualization.Diagram.ClassmethodArguments({name:r[0],type:r[1]}))):h.push(e.datavisualization.Diagram.ClassmethodArguments({name:s[1]}))),c.push(e.datavisualization.Diagram.ClassMethod({name:s[0],arguments:h,type:s[s.length-1],scope:o}));break;case"member":c.push(e.datavisualization.Diagram.ClassMember({name:g[u]}))}"attribute"==d?i.class?i.class.attributes=c:i.interface&&(i.interface.attributes=c):"method"==d?i.class?i.class.methods=c:i.interface&&(i.interface.methods=c):i.enumeration.members=c}}},e.datavisualization.Diagram.SwimLaneContainerHelper={_initSwimLane:function(t,i){i=e.datavisualization.Diagram.SwimLane(i);return i=this._initLaneCollection(t,i),this._swapPhaseSize(i),i=this._setPhaseMinValues(t,i),this._initPhaseCollection(t,i)},_initLaneCollection:function(t,i){var a,n,o,s;for(0===i.lanes.length&&(i.lanes=[e.datavisualization.Diagram.Lane({orientation:i.orientation})]),a=0;a<i.lanes.length;a++){if(i.lanes[a]=e.datavisualization.Diagram.Lane(i.lanes[a]),i.lanes[a].container={type:"canvas",orientation:i.orientation},i.lanes[a].borderColor=i.lanes[a].borderColor?i.lanes[a].borderColor:"black",i.lanes[a].orientation=i.orientation?i.orientation:"horizontal",i.lanes[a].horizontalAlign="horizontal"===i.orientation?"stretch":"left",i.lanes[a].verticalAlign="vertical"===i.orientation?"stretch":"top",i.lanes[a].addInfo=i.lanes[a].addInfo?i.lanes[a].addInfo:{},i.lanes[a].fillColor=i.lanes[a].fillColor,i.lanes[a].paddingTop=20,i.lanes[a].paddingRight=20,i.lanes[a].paddingBottom=20,i.lanes[a].paddingLeft=20,i.lanes[a].constraints=i.lanes[a].constraints?i.lanes[a].constraints|e.datavisualization.Diagram.NodeConstraints.AllowDrop:e.datavisualization.Diagram.NodeConstraints.Default|e.datavisualization.Diagram.NodeConstraints.AllowDrop&~e.datavisualization.Diagram.NodeConstraints.Connect,i.lanes[a].cssClass=i.lanes[a].cssClass,i.lanes[a]._laneHeader=i.lanes[a]._laneHeader?i.lanes[a]._laneHeader:null,i.lanes[a].labels&&i.lanes[a].labels.length>0)for(n=0;n<i.lanes[a].labels.length;n++)i.lanes[a].labels[n]=e.datavisualization.Diagram.Label(i.lanes[a].labels[n]);o=i.lanes[a]._laneHeader=i.lanes[a]._laneHeader?i.lanes[a]._laneHeader:i.lanes[a].header,s=this._initLaneHeader(t,i.lanes[a],o,i),i.lanes[a].children.splice(0,0,s)}return i},_initLaneHeader:function(t,i,a,n){var o,s,r=i.header;return"horizontal"===n.orientation?(o="left",s="stretch",r.rotateAngle=270):(o="stretch",s="top",r.rotateAngle=0),(n=e.datavisualization.Diagram.Node({_hidePorts:!0,_isHeader:!0,name:t._isUndo&&a.name?a.name:i.name+"_Headerr_",type:"node",labels:[r],height:a.height?a.height:50,width:a.width?a.width:50,fillColor:r.fillColor?r.fillColor:"white",rotateAngle:0,horizontalAlign:o,verticalAlign:s,constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20})).labels[0].name=r&&r._labelName&&t._isUndo?r._labelName:n.name+"_label",n},_initPhaseCollection:function(t,i){var a,n=0,o=0;for(0===i.phases.length&&(i.phases=[e.datavisualization.Diagram.Phase({orientation:i.orientation})]),a=0;a<i.phases.length;a++)i.phases[a]._UndoRedo=t._UndoRedo,i.phases[a]._isUndo=t._isUndo,i.phases[a]=e.datavisualization.Diagram.Phase(i.phases[a]),i.phases[a].isPhase=!0,i.phases[a]._hidePorts=!0,i.phases[a].constraints=e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect,i.phases[a].parent="",i.phases[a]._isHeader=!0,i.phases[a]._type="node",i.phases[a].orientation=i.orientation,t._isLoad?i.phases[a].labels&&i.phases[a].labels.length>0&&(i.phases[a].label=[i.phases[a].labels[0]]):i.phases[a].label&&0!=i.phaseSize&&(i.phases[a].label.rotateAngle="vertical"===i.orientation?270:0,i.phases[a].labels=[i.phases[a].label]),"horizontal"===i.orientation?(i.phases[a].width=i.phases[a].offset-o,i.phases[a].height=i.phaseSize,o=i.phases[a].offset):(i.phases[a].height=i.phases[a].offset-n,i.phases[a].width=i.phaseSize,n=i.phases[a].offset);return i},_setPhaseMinValues:function(t,e){var i,a,n;if(a=e.phases[0])for(a.offset<70&&(a.offset=70),n=1;n<e.phases.length;n++)i=e.phases[n],(a=e.phases[n-1]).offset+20>=i.offset&&(i.offset=a.offset+20);return e},_swapPhaseSize:function(t){if(t.phases.length>0)for(var e,i,a=t.phases,n=0;n<a.length;n++)for(e=0;e<a.length-n-1;e++)a[e].offset>a[e+1].offset&&(i=a[e],a[e]=a[e+1],a[e+1]=i)},_setLastPhaseSize:function(t){t.phases.length>0&&(t.phases[t.phases.length-1].offset="horizontal"===t.orientation?t.width:t.height)},_createSwimlane:function(t,i){var a,n,o,s,r=this._createSwimlaneHeader(t,i),l="horizontal"===i.orientation?"vertical":"horizontal",d=i.orientation;"horizontal"===d?(a=Math.round(r.height+i.phaseSize),n=0):(a=r.height,n=Math.round(i.phaseSize));var h={name:i.name+"phaseStack",isPhaseStack:!0,container:{type:"stack",orientation:d},minHeight:10,minWidth:10,children:i.phases,marginTop:r.height,constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect&~e.datavisualization.Diagram.NodeConstraints.AllowDrop},g={name:i.name+"laneStack",isLaneStack:!0,container:{type:"stack",orientation:l},children:i.lanes,marginTop:a,marginLeft:n,verticalAlign:"stretch",horizontalAlign:"stretch",constraints:(e.datavisualization.Diagram.NodeConstraints.Default|e.datavisualization.Diagram.NodeConstraints.AllowDrop)&~e.datavisualization.Diagram.NodeConstraints.Connect},c={_hidePorts:!0,name:i.name,container:{type:"canvas"},children:[r,g],addInfo:i.addInfo?i.addInfo:null,paletteItem:i.paletteItem?i.paletteItem:null,constraints:i.constraints,cssClass:i.cssClass,offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,orientation:i.orientation,phaseSize:i.phaseSize,isSwimlane:!0,height:i.height?i.height:100,width:i.width?i.width:100};return c.offsetX=i.offsetX?i.offsetX:100,c.offsetY=i.offsetY?i.offsetY:100,o=e.datavisualization.Diagram.containerCommon._cloneObject(t,c,e.datavisualization.Diagram.Util.randomId()),o=e.datavisualization.Diagram.ContainerHelper._initContainer(t,o),s=e.datavisualization.Diagram.Util.bounds(o),s=this._setSwimlaneSize(t,c,s),e.datavisualization.Diagram.containerCommon._removeObject(t,o),"horizontal"===d?(h.maxHeight=i.phaseSize,h.minWidth=10):(h.minHeight=10,h.maxWidth=i.phaseSize),c.children.splice(1,0,h),this._setPhaseValues(t,c,s),e.datavisualization.Diagram.ContainerHelper._initContainer(t,c)},_setSwimlaneSize:function(t,e,i){var a,n;if("horizontal"===e.orientation){if(e.width>i.width){for(a=e.children[1].children,n=0;n<a.length;n++)a[n].minWidth=e.width;i.width=e.width}e.height>i.height&&((a=e.children[1].children)[a.length-1].minHeight+=e.height-i.height,i.height=e.height)}else if(e.width>i.width&&((a=e.children[1].children)[a.length-1].minWidth+=e.width-i.width,i.height=e.height),e.height>i.height){for(a=e.children[1].children,n=0;n<a.length;n++)a[n].minHeight=e.height-2*e.children[0].height;i.height=e.height}return i},_setPhaseValues:function(t,e,i){var a,n,o,s,r,l=e.children[1].children,d=l[l.length-1];if("horizontal"===e.orientation)if(d.offset<=i.width)for(1==l.length?(d.offset=i.width,d.width=i.width):(n=l[l.indexOf(d)-1],d.offset=i.width,d.width=i.width-n.offset),s=e.children[2].children,r=0;r<s.length;r++)s[r].minWidth=d.offset;else{for(o=0,r=0;r<l.length;r++)l[r].offset>=o&&(o=l[r].offset);for(s=e.children[2].children,r=0;r<s.length;r++)s[r].minWidth=o}else if(a=e.children[0],d.offset<=i.height-a.height)for(1==l.length?(d.offset=i.height-a.height,d.height=d.offset):(n=l[l.indexOf(d)-1],d.offset=i.height-a.height,d.height=i.height-n.offset-a.height),s=e.children[2].children,r=0;r<s.length;r++)s[r].minHeight=d.offset;else{for(o=0,r=0;r<l.length;r++)l[r].offset>=o&&(o=l[r].offset);for(s=e.children[2].children,r=0;r<s.length;r++)s[r].minHeight=o}},_createSwimlaneHeader:function(t,i){var a,n=i.header,o=i.lanes[0]._laneHeader?i.lanes[0]._laneHeader:null;return n.name=i.name+"_header_swimlane_label",(a=e.datavisualization.Diagram.Node({_type:"node",_hidePorts:!0,_isHeader:!0,name:i.name+"_header_swimlane",labels:[n],height:void 0!=n.height?n.height:50,width:void 0!=n.width?n.width:50,fillColor:i.header.fillColor?i.header.fillColor:o?o.fillColor:"white",rotateAngle:0,constraints:e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name})).labels[0].fillColor="transparent",t._isLoad&&(a.fillColor=i.header.fillColor),a},_updateSwimlane:function(t,i){this._updateLaneStack(t,i),this._updatePhaseStack(t,i),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,i)},_updateLaneStack:function(t,e){for(var i,a,n,o=this.getLanes(t,e),s=0;s<o.length;s++)if(n=t.nameTable[t._getChild(o[s])]){for(i=1;i<n.children.length;i++)(a="string"==typeof n.children[i]?t.nameTable[n.children[i]]:n.children[i]).marginBottom=a.marginRight=0;this._updateLane(t,n)}},_updatePhaseStack:function(t,i){var a=t.nameTable[t._getChild(i.children[1])];e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,a)},_updateLane:function(t,i){e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,i)},getPhases:function(t,e,i){var a,n;if(e&&(e.children[1]&&(a=i?i[t._getChild(e.children[1])]:t.nameTable[t._getChild(e.children[1])]),a&&((n=t._getChildren(a.children))&&n.length>0)))return n},getLanes:function(t,e){var i,a;return e&&e.isSwimlane&&e.children[2]&&(i=t.nameTable[t._getChild(e.children[2])]),i&&((a=i.children)&&a.length>0)?a:void 0},_updateLanesMinValue:function(t,e,i,a){for(var n,o=this.getLanes(t,e),s=0;s<o.length;s++)(n=t.nameTable[t._getChild(o[s])])&&(n[i]=a)},_resizeLastPhase:function(){},_getPhaseBounds:function(t,i){var a,n,o,s,r,l,d,h=null,g=0,c=0,u=0,m=0;return i&&"phase"==i.type&&i.parent&&(s=this._getPrevPhase(t,i),r=this._getNextPhase(t,i),(a=t.nameTable[i.parent.split("phaseStack")[0]])&&a.orientation&&(h=e.datavisualization.Diagram.Util.bounds(a),"horizontal"==a.orientation?(o=this._getPrevOffset(t,i,s,r,a,h),s&&s.name===i.name?c=(g=o.left+h.left)+(i.offset-g-o.left):(s&&(g=h.left+s.offset),c=i.offset-g+h.left),u=o.top+h.top,m=h.bottom-u,n=e.datavisualization.Diagram.Rectangle(g,u,c,m)):(o=this._getPrevOffset(t,i,s,r,a,h),s===i?(g=o.left+h.left,m=i.offset+u,u=o.top+h.top):(d=(l=t.nameTable[t._getChild(a.children[0])])?l.height:0,g=o.left+h.left,s&&(u=s.offset+h.top+d),m=h.top+i.offset-u+d),c=h.right-g,n=e.datavisualization.Diagram.Rectangle(g,u,c,m)))),n},_getPrevPhase:function(t,i){var a,n=null,o=t.nameTable[i.parent.split("phaseStack")[0]],s=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,o);return o&&s&&s.length>0&&(n=0===(a=this._getPhaseIndex(t,i.name))?t.nameTable[t._getChild(s[0])]:t.nameTable[t._getChild(s[a-1])]),n},_getPrevOffset:function(t,e,i,a,n){var o,s,r,l,d=0,h=0;return n.children[0]&&((r=t.nameTable[t._getChild(n.children[0])])&&(h=r.height)),"horizontal"==n.orientation&&(n.children[2]&&(o=t.nameTable[t._getChild(n.children[2])]),o&&o.children&&o.children.length>0&&((s=t.nameTable[t._getChild(o.children[0])])&&s.children&&s.children.length>0&&((l=t.nameTable[t._getChild(s.children[0])])&&-1!=l.name.indexOf("_Headerr")&&(d=l.width)))),{left:d,top:h}},_getNextPhase:function(t,i){var a,n=null,o=t.nameTable[i.parent.split("phaseStack")[0]],s=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,o);return o&&s&&s.length>0&&(n=(a=t._getPhaseIndex(i.name))===s.length-1?t.nameTable[t._getChild(s[a])]:t.nameTable[t._getChild(s[a+1])]),n},_getPhaseIndex:function(t,i){var a,n,o,s=-1;return(a=t.nameTable[i])&&a.parent&&(n=t.nameTable[a.parent.split("phaseStack")[0]],(o=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,n))&&o.length>0&&(s=o.indexOf(i))),s},_cloneLaneObj:function(e,i,a,n){var o,s,r,l=n||e.nameTable;if((o=(i=t.extend(!0,{},i)).children)&&o.length>0)for(s=0;s<o.length;s++)(r=l[e._getChild(o[s])])&&((r=jQuery.extend(!0,{},r))&&r.children&&r.children.length&&(r=e._cloneLaneObj(r,a,n)),r.name+=a,r.parent=a,i.children[s]=r,n&&e._preserveConnection(n,r));return i&&i.header&&(i.header.name+=a),i.name+=a,i},_cloneSwimlaneObj:function(e,i,a,n){var o;if((i=t.extend(!0,{},i))&&i.isSwimlane){if((i=jQuery.extend(!0,{},i)).name+=a,i.lanes&&i.lanes.length>0)for(o=0;o<i.lanes.length;o++)i.lanes[o]&&(i.lanes[o]=e._cloneLaneObj(i.lanes[o],a,n&&n.childTable?n.childTable:null));if(i.phases&&i.phases.length>0)for(o=0;o<i.phases.length;o++)i.phases[o]&&(i.phases[o].name+=a,i.phases[o].parent="")}return i},_pasteSwimlaneObj:function(t,i,a){if(i=t._pasteSwimlane(i,a)){var n=t._isUndo?0:10*t._pasteIndex;t._translate(i,n,n,t.nameTable),e.datavisualization.Diagram.DiagramContext.update(i,t)}return i},_pasteSwimlane:function(t,i,a){if(t._pasteObj=!0,i&&i.isSwimlane){var n=t._isUndo?0:10*t._pasteIndex,o=t._cloneSwimlaneObj(t._getNode(i.name,a?a.childTable:null),t._swimlanePaste?"":e.datavisualization.Diagram.Util.randomId(),a);return o=e.datavisualization.Diagram.ContainerHelper._initContainer(t,o,a),t._outOfBoundsOnNudge(o,n,n)?(t.add(o),t._pasteObj=!1,o):(e.datavisualization.Diagram.containerCommon._removeObject(t,o),null)}},_updateNextPhase:function(t,i,a,n){for(var o,s=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,i),r=n+1;r<s.length;r++)(o=t.nameTable[t._getChild(s[r])])&&(o.offset+=a)},_getOuterNodes:function(t,i,a,n){for(var o,s,r,l=[],d=e.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(t,i),h="horizontal"===i.orientation?"left":"top",g="horizontal"===i.orientation?a:n,c=0;c<d.length;c++)if((o=t.nameTable[t._getChild(d[c])])&&o.children.length>1)for(s=0;s<o.children.length;s++)(r=t.nameTable[t._getChild(o.children[s])])&&(e.datavisualization.Diagram.Util.bounds(r)[h]>g&&l.push(r));return l},_getInnerNodes:function(t,i,a,n){for(var o,s,r,l,d=[],h=e.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(t,i),g="horizontal"===i.orientation?"left":"top",c="horizontal"===i.orientation?"right":"bottom",u=0;u<h.length;u++)if((o=t.nameTable[t._getChild(h[u])])&&o.children.length>1)for(s=0;s<o.children.length;s++)(r=t.nameTable[t._getChild(o.children[s])])&&((l=e.datavisualization.Diagram.Util.bounds(r))[g]>=a&&l[c]<=n&&d.push(r));return d},_moveOuterNodes:function(t,i,a,n){var o,s,r=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,i),l=t.nameTable[t._getChild(r[n])],d=e.datavisualization.Diagram.Util.bounds(i),h=t.nameTable[t._getChild(i.children[0])],g=d.left+l.offset,c=d.top+l.offset+h.height,u="horizontal"===i.orientation?"offsetX":"offsetY",m=(i.orientation,"horizontal"===i.orientation?"marginLeft":"marginTop"),p=t._getOuterNodes(i,g,c);if(p&&p.length>0)for(o=0;o<p.length;o++)s=t.nameTable[t._getChild(p[o])],t._translate(s,"offsetX"===u?a:0,"offsetY"===u?a:0,t.nameTable),s[m]+=a},_moveOnPhaseChange:function(t,i,a){var n,o,s,r,l=i.parent.split("phaseStack")[0];if(l&&(o=t.nameTable[l]),o){for(s=e.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(t,o),t.nameTable[t._getChild(o.children[0])],r=0;r<s.length;r++)(n=t.nameTable[t._getChild(s[r])])&&("horizontal"===i.orientation?(n.width+=a,n.minWidth=n.width):(n.height+=a,n.minHeight=n.height));"horizontal"===i.orientation?o.minWidth+=a:o.minHeight=n.height,e.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(t,o)}},_getPhaseDifferece:function(t,i,a,n){var o,s,r,l,d=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,i),h=t.nameTable[t._getChild(d[a])],g=e.datavisualization.Diagram.Util.bounds(i),c="horizontal"===i.orientation?"left":"top",u=t.nameTable[t._getChild(i.children[0])],m=0;return"vertical"===i.orientation&&(m=u.height),0===a?((s=t._getInnerNodes(i,g[c]+m,g[c]+h.offset+m))&&s.length>0?(r=e.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),e.datavisualization.Diagram.Util._updateGroupBounds(r,t),l=e.datavisualization.Diagram.Util.bounds(r)):(l=e.datavisualization.Diagram.Util.bounds()).right=g.left+50,"horizontal"===i.orientation?(g.left+(h.offset+n)>=l.right+20||(n+=l.right+20-(g.left+(h.offset+n))),h.offset+n<100&&(n=0)):(g.top+u.height+(h.offset+n)>=l.bottom+20||(n+=l.bottom+20-(g.top+m+(h.offset+n))),h.offset+n<100&&(n=0))):(o=t.nameTable[t._getChild(d[a-1])],(s=t._getInnerNodes(i,g[c]+o.offset+m,g[c]+h.offset+m))&&s.length>0?(r=e.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),e.datavisualization.Diagram.Util._updateGroupBounds(r,t),l=e.datavisualization.Diagram.Util.bounds(r)):(l=e.datavisualization.Diagram.Util.bounds()).bottom=g.top+u.height+o.offset,"horizontal"===i.orientation?g.left+(h.offset+n)>=l.right+20||(n+=l.right+20-(g.left+(h.offset+n))):g.top+u.height+(h.offset+n)>=l.bottom+20||(n+=l.bottom+20-(g.top+u.height+(h.offset+n)))),o&&h.offset-o.offset+n<20&&(n-=h.offset-o.offset+n-20),n}},e.datavisualization.Diagram.ContainerHelper={_initContainer:function(t,i){if(i.container)switch(i.container.type){default:case"canvas":if("bpmn"==(i=e.datavisualization.Diagram.canvasHelper._initCanvas(t,i)).type)e.datavisualization.Diagram.ContainerHelper.updateparent(i,t)||e.datavisualization.Diagram.bpmnHelper.updateCanvas(i,t);break;case"stack":i=e.datavisualization.Diagram.stackHelper._initStack(t,i)}else("swimlane"===i.type||i.isSwimlane)&&(i=e.datavisualization.Diagram.SwimLaneContainerHelper._initSwimLane(t,i),i=e.datavisualization.Diagram.SwimLaneContainerHelper._createSwimlane(t,i));return i},_add:function(i,a){var n,o,s,r,l;if("connector"!==i.getObjectType(a)&&((n=a.parent?i.nameTable[a.parent]:null)&&n.container)){for(o=n.children.length-1;o>=0;o--)i.nameTable[i._getChild(n.children[o])].name===a.name&&e.datavisualization.Diagram.Util.removeChildFromGroup(n.children,n.children[o]);s=i._isUndo?e.datavisualization.Diagram.GroupChangeCause.HistoryChange:e.datavisualization.Diagram.GroupChangeCause.Drop,i._isLaneApi&&(s=e.datavisualization.Diagram.GroupChangeCause.Unknown),i._raiseGroupChangeEvent(a,null,n,s),n.children.push(a),i._disableSwimlaneUptate=!0,e.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(i),r=t.extend(!0,{},n),this._updateCollectionChange(i,n,!0),e.datavisualization.Diagram.canvasHelper._updateAddRemoveNodeConnectors(i,n,r),delete i._disableSwimlaneUptate,e.datavisualization.Diagram.canvasHelper._updateLastSwimlanePhase(i,a),l=i._svg.document.getElementById(a.parent),"group"===a._type?e.datavisualization.Diagram.DiagramContext.renderGroup(a,i,l):e.datavisualization.Diagram.DiagramContext.renderNode(a,i,l),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdateNode(i,a)}},updateparent:function(t,e){var i=t;if(e)for(;i&&i.parent;)if((i=e.nameTable[i.parent])&&i.isLane)return i;return!1},_updateCollectionChange:function(t,i,a,n){var o,s,r,l,d;t._diagramClear||(r=!0,i&&(o={x:(l=e.datavisualization.Diagram.Util.bounds(i)).x,y:l.y},i.container&&("canvas"===i.container.type?i._isBpmn?(n=this.updateparent(i,t))?e.datavisualization.Diagram.canvasHelper._updateCollectionChange(t,i):e.datavisualization.Diagram.bpmnHelper.updateCanvas(i,t):e.datavisualization.Diagram.canvasHelper._updateCollectionChange(t,i):e.datavisualization.Diagram.stackHelper._updateCollectionChange(t,i,null,n)),(a&&!i.isLane&&!i._isBpmn||i.isSwimlane)&&(t._disableSwimlaneUptate&&(r=!1),s={x:(d=e.datavisualization.Diagram.Util.bounds(i)).x,y:d.y},t._translate(i,o.x-s.x,o.y-s.y,t.nameTable),r&&e.datavisualization.Diagram.DiagramContext.update(i,t))),!i||!i.container||i.isLane||i.isSwimlane||i.isLaneStack||i.isPhaseStack||e.datavisualization.Diagram.DiagramContext.update(i,t))}},e.datavisualization.Diagram.stackHelper={_initStack:function(t,i){return i=e.datavisualization.Diagram.Group(i),i=this._initGroupNode(t,i),i=this._initChildren(t,i),this._setSize(t,i),this._alignChildren(t,i),i},_initGroupNode:function(t,i){return e.datavisualization.Diagram.containerCommon._initGroupNode(t,i)},_initChildren:function(t,i){return e.datavisualization.Diagram.containerCommon._initChildren(t,i)},_setSize:function(t,e){var i=this._getStackBoundsBounds(t,e);i.width>=e.minWidth&&i.width<=e.maxWidth?e.width=i.width:i.width<=e.minWidth?e.width=e.minWidth:i.width>=e.maxWidth&&(e.width=e.maxWidth),i.height>=e.minHeight&&i.height<=e.maxHeight?e.height=i.height:i.height<=e.minHeight?e.height=e.minHeight:i.height>=e.maxHeight&&(e.height=e.maxHeight)},_getStackBoundsBounds:function(t,i){var a,n,o,s,r=e.datavisualization.Diagram.Rectangle(),l=0,d=0,h=0,g=0,c=i.container.orientation?i.container.orientation:"vertical";if(i.children&&i.children.length>0)for(s=i.children,a=0;a<s.length;a++)(n="string"==typeof s[a]?t.nameTable[s[a]]:s[a])&&(o=e.datavisualization.Diagram.Util.bounds(n),(o=e.datavisualization.Diagram.Geometry.rect([o.topLeft,o.topRight,o.bottomRight,o.bottomLeft]))&&("vertical"===c?((d=o.width+=n.marginLeft+n.marginRight)>h&&(h=o.width=d),o.width="stretch"===n.horizontalAlign&&o.width>n.minWidth?o.width:h,o.height+=n.marginTop+n.marginBottom,o.height+=r.height):((l=o.height+=n.marginTop+n.marginBottom)>g&&(g=o.height=l),o.height="stretch"===n.verticalAlign&&o.height>n.minHeight?o.height:g,o.width+=n.marginLeft+n.marginRight,o.width+=r.width),o.x=0,o.y=0),r=t._union(r,o));return r.width+=i.paddingLeft+i.paddingRight,r.height+=i.paddingTop+i.paddingBottom,r},_alignChildren:function(t,e){for(var i,a,n=0,o=0,s=e.children,r=0;r<s.length;r++)(a="string"==typeof s[r]?t.nameTable[s[r]]:s[r])&&(i=this._getStackPosition(t,a,e,n,o),this._translate(t,a,i.x,i.y),"vertical"==e.container.orientation?o+=(a.height?a.height:a._height)+a.marginTop+a.marginBottom:n+=(a.width?a.width:a._width)+a.marginLeft+a.marginRight)},_getStackPosition:function(t,i,a,n,o){var s,r,l=0,d=0,h=e.datavisualization.Diagram.Util.bounds(a),g=e.datavisualization.Diagram.Util.bounds(i),c=(a.container.orientation&&a.container.orientation,i.width?i.width:i._width),u=i.height?i.height:i._height;if("vertical"==a.container.orientation)switch(d=h.y-g.y+o+i.marginTop+a.paddingTop,i.horizontalAlign){case"left":l=h.x-g.x+i.marginLeft+a.paddingLeft;break;case"center":l=h.center.x-g.center.x;break;case"right":l=h.x+h.width-(g.x+g.width+a.paddingRight);break;case"stretch":s=(a.width-(a.paddingLeft+a.paddingRight)-(i.marginLeft+i.marginRight))/c,t.scale(i,s,1,a.pivot,t.nameTable),h=e.datavisualization.Diagram.Util.bounds(a),g=e.datavisualization.Diagram.Util.bounds(i,t),l=h.x+a.paddingLeft+i.marginLeft-g.x}else switch(l=h.x-g.x+n+i.marginLeft+a.paddingLeft,i.verticalAlign){case"top":d=h.y-g.y+i.marginTop+a.paddingTop;break;case"center":d=h.center.y-g.center.y;break;case"bottom":d=h.y+h.height-(g.y+g.height+a.paddingBottom);break;case"stretch":r=(a.height-(a.paddingTop+a.paddingBottom)-(i.marginTop+i.marginBottom))/u,t.scale(i,1,r,a.pivot,t.nameTable),h=e.datavisualization.Diagram.Util.bounds(a),g=e.datavisualization.Diagram.Util.bounds(i,t),d=h.y+a.paddingTop+i.marginTop-g.y}return{x:l,y:d}},_translate:function(t,i,a,n){var o,s,r;if(a||n)if(i.segments)e.datavisualization.Diagram.Util._translateLine(i,a,n,i);else{if(i.offsetX+=a,i.offsetY+=n,"group"===i._type||"pseudoGroup"===i.type||"umlclassifier"==i.type)for(o=i.children,r=0;o&&r<o.length;r++)(s=t.nameTable[t._getChild(o[r])])&&this._translate(t,s,a,n);e.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,a,n,null,t)}},_updateCollectionChange:function(t,i,a,n){if(this._setSize(t,i),this._alignChildren(t,i),i.parent){var o=t.nameTable[i.parent];o||n&&i.isPhaseStack&&(o=n),o&&o.container&&!a&&e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,o)}}},e.datavisualization.Diagram.canvasHelper={_initCanvas:function(t,i){return i._type="group",i.type||(i.type="group"),i=e.datavisualization.Diagram.Group(i),i=this._initGroupNode(t,i),i=this._initChildren(t,i),this._setSize(t,i),this._alignChildren(t,i),i},_initGroupNode:function(t,i){return e.datavisualization.Diagram.containerCommon._initGroupNode(t,i)},_initChildren:function(t,i){return e.datavisualization.Diagram.containerCommon._initChildren(t,i)},_setSize:function(i,a,n,o){var s,r,l,d=this._getCanvasBounds(i,a,o),h=e.datavisualization.Diagram.Util.bounds(a);if(h=e.datavisualization.Diagram.Geometry.rect([h.topLeft,h.topRight,h.bottomRight,h.bottomLeft]),d.width>=a.minWidth&&d.width<=a.maxWidth?d.width=d.width:d.width<=a.minWidth?d.width=a.minWidth:d.width>=a.maxWidth&&(d.width=a.maxWidth),d.height>=a.minHeight&&d.height<=a.maxHeight?d.height=d.height:d.height<=a.minHeight?d.height=a.minHeight:d.height>=a.maxHeight&&(d.height=a.maxHeight),n){var g=d.width/h.width,c=d.height/h.height,u=d.x+d.width/2-(h.x+h.width/2),m=d.y+d.height/2-(h.y+h.height/2),p=e.datavisualization.Diagram.Point(a.offsetX,a.offsetY);if(i._translate(a,u,m,i.nameTable,!0),i.scale(a,g,c,e.datavisualization.Diagram.Point(a.offsetX,a.offsetY),i.nameTable),a._isBpmn){for(s=i._getChildren(a.children),r=0;r<s.length;r++)(l=i.nameTable[s[r]])&&l._isInternalShape&&e.datavisualization.Diagram.Util.canResize(l)&&(l=t.extend(!0,l,{offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height}));e.datavisualization.Diagram.Util._updateBPMNProperties(a,i,i.nameTable,!0)}e.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(a,1/g,1/c,p,i)}else a.width=d.width,a.height=d.height},_alignChildren:function(i,a){for(var n,o,s=!0,r=a.children,l=0;l<r.length;l++)(o="string"==typeof r[l]?i.nameTable[r[l]]:r[l])&&!o._isInternalShape&&(i._disablePhaseUpdate&&o.isPhaseStack&&(s=!1),s&&(n=this._getCanvasPosition(i,o,a),this._translate(i,o,n.x,n.y))),o&&o._isInternalShape&&e.datavisualization.Diagram.Util.canResize(o)&&(o=t.extend(!0,o,{offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height}),e.datavisualization.Diagram.Util._updateBPMNProperties(a,i,i.nameTable,!0))},_translate:function(t,i,a,n){var o,s,r;if(a||n)if(i.segments)e.datavisualization.Diagram.Util._translateLine(i,a,n,i);else{if(i.offsetX+=a,i.offsetY+=n,"group"===i._type||"pseudoGroup"===i.type)for(o=i.children,r=0;r<o.length;r++)(s=t.nameTable[t._getChild(o[r])])&&(this._translate(t,s,a,n),t._updateQuad(s));e.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,a,n,null,t)}},_getCanvasPosition:function(t,i,a){var n,o,s=0,r=0,l=e.datavisualization.Diagram.Util.bounds(a),d=e.datavisualization.Diagram.Util.bounds(i);switch(i.horizontalAlign){case"left":s=l.x-d.x+i.marginLeft+a.paddingLeft;break;case"center":s=l.x+l.width/2-(d.x+d.width/2)+i.marginLeft+a.paddingLeft;break;case"right":s=l.x+l.width-i.marginRight-(d.x+d.width+a.paddingRight);break;case"stretch":n=(l.width-a.paddingLeft-a.paddingRight-i.marginLeft-i.marginRight)/i.width,t.scale(i,n,0,a.pivot,t.nameTable),d=e.datavisualization.Diagram.Util.bounds(i,t),s=l.x+a.paddingLeft-d.x+i.marginLeft}switch(i.verticalAlign){case"top":r=l.y-d.y+i.marginTop+a.paddingTop;break;case"center":r=l.y+l.height/2-(d.y+d.height/2)+i.marginTop+a.paddingTop;break;case"bottom":r=l.y+l.height-i.marginBottom-(d.y+d.height+a.paddingBottom);break;case"stretch":o=(l.height-a.paddingTop-a.paddingBottom-i.marginTop-i.marginBottom)/i.height,t.scale(i,0,o,a.pivot,t.nameTable),d=e.datavisualization.Diagram.Util.bounds(i,t),r=l.y+a.paddingTop-d.y+i.marginTop}return{x:s,y:r}},_getCanvasBounds:function(t,i,a){var n,o,s,r,l,d,h,g=e.datavisualization.Diagram.Rectangle(),c=0;if(i.children&&i.children.length>0)for(h=i.children;c<h.length;c++)(n="string"==typeof h[c]?t.nameTable[h[c]]:h[c])&&!n._isInternalShape&&(o=e.datavisualization.Diagram.Util.bounds(n),o=e.datavisualization.Diagram.Geometry.rect([o.topLeft,o.topRight,o.bottomRight,o.bottomLeft]),"stretch"===n.horizontalAlign&&(o.width=o.width>=i.minWidth?o.width:1,(i.isLane||i.isSwimlane)&&0==c&&(o.width=1)),"stretch"===n.verticalAlign&&(o.height=o.height>=i.minHeight?o.height:1,i.isLane&&0==c&&(o.height=1)),o&&(l=n.marginLeft>0?o.x-n.marginLeft:o.x,d=n.marginTop>0?o.y-n.marginTop:o.y,s=void 0==s?l:Math.min(s,l),r=void 0==r?d:Math.min(r,d),o.width+=n.marginLeft+(a?0:n.marginRight),o.height+=n.marginTop+(a?0:n.marginBottom),o.x=0,o.y=0,"bpmn"==i.type&&(n.marginLeft<0&&(o.width-=n.marginLeft),n.marginTop<0&&(o.height-=n.marginTop))),g=e.datavisualization.Diagram.Geometry.union(g,o));return"bpmn"==i.type&&e.datavisualization.Diagram.Geometry.isEmptyRect(g)?(g=e.datavisualization.Diagram.Util.bounds(i),g=e.datavisualization.Diagram.Geometry.rect([g.topLeft,g.topRight,g.bottomRight,g.bottomLeft])):(g.width+=i.paddingLeft+i.paddingRight,g.height+=i.paddingTop+i.paddingBottom,g.x=s-i.paddingLeft,g.y=r-i.paddingTop),g},_updateCollectionChange:function(t,i){var a,n=!1;"resize"===t.activeTool.name&&i.container&&(n=!0),this._setSize(t,i,null,n),this._alignChildren(t,i),i.parent&&((a=t.nameTable[i.parent])&&a.container&&e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,a))},_getSwimlane:function(t,e){var i,a,n=t.nameTable[t._getChild(e)];if(n&&n.isLane&&((i=t.nameTable[n.parent])&&(a=t.nameTable[i.parent])))return t.getNode(a.name)},_laneConnectors:function(t,e,i){var a,n,o;if(e&&e.isLane)for(n=0;n<e.children.length;n++)if(o=t.nameTable[t._getChild(e.children[n])]){if(o.inEdges&&o.inEdges.length>0)for(a=0;a<e.children.length;a++)t._collectionContains(o.inEdges[a],i)||i.push(o.inEdges[a]);if(o.outEdges&&o.outEdges.length>0)for(a=0;a<e.children.length;a++)t._collectionContains(o.outEdges[a],i)||i.push(o.outEdges[a])}},_connectorRelateTolaneCollection:function(t,e,i){if(e){var a,n,o,s,r;if(s=e.sourceNode?t.nameTable[e.sourceNode]:null,o=e.targetNode?t.nameTable[e.targetNode]:null,s&&s.parent&&(a=t.nameTable[s.parent]),o&&o.parent&&(n=t.nameTable[o.parent]),a&&n&&n.name===a.name)return!1;for(r=0;r<i.length;r++)if(a&&a.name===i[r]||n&&n.name===i[r])return!0}return!1},_recreateConnectorSegments:function(t,i,a,n,o){if(t&&i){var s,r,l,d,h,g=[],c=[];if(((i=t.nameTable[t._getChild(i)])&&i.isLane||i.isSwimlane)&&i.isLane&&Array.isArray(a)){for(h=this._getIntermediateLanes(t,a,n,o),r=0;r<h.length;r++)l=t.nameTable[t._getChild(h[r])],this._laneConnectors(t,l,g);for(d=this._getSwimlane(t,i.name).lanes,r=0;r<d.length;r++)l=t.nameTable[t._getChild(d[r])],this._laneConnectors(t,l,c);for(r=0;r<g.length;r++)(s=t.nameTable[t._getChild(g[r])])&&this._connectorRelateTolaneCollection(t,s,[n,o])&&(s.segments=[],e.datavisualization.Diagram.Util._initializeSegments(s,"orthogonal"));for(r=0;r<c.length;r++)(s=t.nameTable[t._getChild(c[r])])&&this._updateConnectorEndPoints(t,s)}}},_isLineInterSectingNode:function(t,i,a){var n,o,s,r,l,d,h,g,c,u,m,p,f=!1;if(i&&a&&(o=[{x:(n=e.datavisualization.Diagram.Util.bounds(a)).topLeft.x,y:n.topLeft.y},{x:n.topRight.x,y:n.topRight.y},{x:n.bottomRight.x,y:n.bottomRight.y},{x:n.bottomLeft.x,y:n.bottomLeft.y},{x:n.topLeft.x,y:n.topLeft.y}]),(s=i.segments)&&s.length>0)for(r=0;!f&&r<s.length;r++)if((l=s[r])&&l.points.length>0)for(d=l.points,m=0;!f&&m<d.length-1;m++)for(h=d[m],g=d[m+1],p=0;!f&&p<o.length-1;p++)if(c=o[p],u=o[p+1],this._isInterSecting(h.x,h.y,g.x,g.y,c.x,c.y,u.x,u.y,!0)){f=!0;break}return f},_updateConnectorEndPoints:function(t,i){var a,n,o;t&&i&&(a=!1,i.sourcePoint=e.datavisualization.Diagram.Point(),i.targetPoint=e.datavisualization.Diagram.Point(),e.datavisualization.Diagram.Util._initConnectionEnds(i,t),e.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),t._dock(i,t.nameTable),i.sourceNode&&(n=t.nameTable[i.sourceNode]),n&&this._isLineInterSectingNode(t,i,n)&&(a=!0),i.targetNode&&(o=t.nameTable[i.targetNode]),o&&this._isLineInterSectingNode(t,i,o)&&(a=!this._anySegmentOrtho(i)),a&&(i.segments=[],e.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),t._dock(i,t.nameTable)),e.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),t._dock(i,t.nameTable))},_anySegmentOrtho:function(t){var e,i,a=!1;if(t&&t.segments&&t.segments.length>0)for(i=0;i<t.segments.length;i++)if((e=t.segments[i])&&"orthogonal"!==e.type){a=!0;break}return a},_getIntermediateLanes:function(t,e,i,a){var n,o=[];if(e){var s=e.indexOf(i),r=e.indexOf(a),l=Math.min(s,r),d=Math.max(s,r);for(n=l;n<=d;n++)o.push(e[n])}return o},_swapLane:function(i,a,n,o,s,r){var l,d,h=i.nameTable[o],g=a.slice(),c=i.tools.move,u=this._getSwimlane(i,n);if(c._undoObject=t.extend(!0,{},{name1:n,name2:o}),h){var m=e.datavisualization.Diagram.Util.bounds(h),p=a.indexOf(n),f=a.indexOf(o);a.splice(a.indexOf(n),1),f+=p>f?0:-1,f+=s?c.currentPoint.y>=m.y&&c.currentPoint.y<m.center.y?0:1:c.currentPoint.x>=m.x&&c.currentPoint.x<m.center.x?0:1,a.splice(f,0,n)}c._redoObject=t.extend(!0,{},{name1:o,name2:n}),l={type:"swapLane",undoObject:jQuery.extend(!0,{},c._undoObject),redoObject:jQuery.extend(!0,{},c._redoObject),currentIndex:p,moveIndex:f,category:"internal"},d=this._getSwimlane(i,n),u&&i._comparePropertyValues(d,"lanes",{lanes:u.lanes},!0),i.addHistoryEntry(l),c._multipleUndo=!0,r&&e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,r,!1),i.activeTool.selectedObject&&(e.datavisualization.Diagram.canvasHelper._recreateConnectorSegments(i,i.activeTool.selectedObject.name,g,n,o),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(i,i.activeTool.selectedObject))},_updateHelper:function(t){t.activeTool.helper?(this._updateHelperXY(t,t.activeTool.helper,t.activeTool.previousPoint,t.activeTool.currentPoint),e.datavisualization.Diagram.SvgContext._updateContainerHelper(t)):this._initHelper(t)},_updateHelperXY:function(t,i,a,n){var o,s,r=n.x<a.x,l=n.y<a.y,d=t.activeTool.diffx+(n.x-a.x),h=t.activeTool.diffy+(n.y-a.y),g=t.activeTool.diagram._enableSnapToObject();t.activeTool.diagram._enableSnapToObject(!0),o=e.datavisualization.Diagram.SnapUtil._snapPoint(t,t.activeTool.helper,r,l,e.datavisualization.Diagram.Point(d,h),n,a),t.activeTool.diagram._enableSnapToObject(g),o||(o=e.datavisualization.Diagram.Point(d,h)),t.activeTool.diffx=d-o.x,t.activeTool.diffy=h-o.y,e.datavisualization.Diagram.Geometry.isEmptyPoint(o)||(s=t.activeTool._raiseDragEvent({element:t.getNode(t.activeTool.helper),offset:o,cancel:!1}))&&!s.cancel&&(t.activeTool._outOfBoundsDrag(i,o.x,o.y)&&t._translate(i,o.x,o.y,t.nameTable),"group"===i._type&&e.datavisualization.Diagram.Util._updateGroupBounds(i,t))},_initHelper:function(t){t.activeTool.helper=this._getCloneNode(t.activeTool.selectedObject),t.activeTool.helper._name=t.activeTool.selectedObject.name,t.activeTool.helper.name="helper",t.activeTool.startPoint=t.activeTool.currentPoint,e.datavisualization.Diagram.SvgContext._drawContainerHelper(t)},_getCloneNode:function(t){var e=null;return(e=jQuery.extend(!0,{},t)).children=[],e.minHeight=0,e.minWidth=0,e.maxHeight=0,e.maxWidth=0,e},_updateHighlighter:function(t,e){var i=t.activeTool._getMouseOverElement(e);!i||i.segments||t.activeTool.selectedObject.isLane&&!i.isLane?t.activeTool._removeHighLighter():t.activeTool._nodeHighLighter(i,e)},_updateNodeMargin:function(i,a,n){var o,s,r,l,d;if("group"==a._type)for(o=0;o<a.children.length;o++)s=a.children[o],this._updateNodeMargin(i,"string"==typeof s?i.nameTable[s]:s,a);if(a&&n){var h=t.extend(!1,{},a),g=e.datavisualization.Diagram.Util.bounds(a),c=e.datavisualization.Diagram.Util.bounds(n);!(!n.container||!n.container.type||"stack"!=n.container.type)?"horizontal"===n.container.orientation?a.marginTop=g.top-c.top-n.paddingTop:a.marginLeft=g.left-c.left-n.paddingLeft:(a.marginLeft=g.left-c.left-n.paddingLeft,a.marginTop=g.top-c.top-n.paddingTop);var u=g.right-g.left,m=g.bottom-g.top,p=c.x+c.width-(g.x+u)-n.paddingRight;a.marginRight=p<0?0:p,r=c.y+c.height-(g.y+m)-n.paddingBottom,a.marginBottom=r<0?0:r,n.isLane&&(l=0,d=0,"horizontal"===n.orientation?(l=50,d=0):(l=0,d=50),a.marginLeft=a.marginLeft>=l?a.marginLeft:l,a.marginTop=a.marginTop>=d?a.marginTop:d,i._comparePropertyValues(a,"marginLeft",{marginLeft:h.marginLeft},!0),i._comparePropertyValues(a,"marginRight",{marginLeft:h.marginRight},!0),i._comparePropertyValues(a,"marginBottom",{marginLeft:h.marginBottom},!0),i._comparePropertyValues(a,"marginRight",{marginLeft:h.marginRight},!0))}},_singleNodedrag:function(i,a,n){var o,s,r,l;if(!i.activeTool._checkForDropEvent(n))if(n){if((e.datavisualization.Diagram.Util.canAllowDrop(n)||n.name==i.activeTool.selectedObject.parent)&&n.container&&"canvas"==n.container.type)if(s=!(n._isBpmn&&(!n._isBpmn||i.activeTool.selectedObject.parent==n.name)),e.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(i,i.activeTool.helper,n)&&s)(n.isLane||"canvas"==n.container.type)&&this._disableConnectorUpdate(i),i.activeTool.seletedObject=i.nameTable[i.activeTool.selectedObject.name],i.activeTool.selectedObject.parent&&(o=i.nameTable[i.activeTool.selectedObject.parent]),i._disablePhaseUpdate=!0,i._disableSwimlaneUptate=!0,this._removeNodeFromContainer(i,i.activeTool.selectedObject),this._addNodeToContainer(i,i.activeTool.selectedObject,n,null,!0),r=i._isUndo?e.datavisualization.Diagram.GroupChangeCause.HistoryChange:e.datavisualization.Diagram.GroupChangeCause.Drop,i._raiseGroupChangeEvent(i.activeTool.selectedObject,o,n,r),i._comparePropertyValues(i.activeTool.selectedObject,"parent",{parent:o.name},!0),delete i._disablePhaseUpdate,delete i._disableSwimlaneUptate,this._updateLastSwimlanePhase(i,i.activeTool.selectedObject),(n.isLane||"canvas"==n.container.type)&&this._enableConnectorUpdateNode(i,i.activeTool.selectedObject);else if(n._isBpmn){var d=i.nameTable[i.activeTool.selectedObject.parent];d.width,d.height,d.offsetX,d.offsetY;i._translate(i.activeTool.selectedObject,i.activeTool.helper.offsetX-i.activeTool.selectedObject.offsetX,i.activeTool.helper.offsetY-i.activeTool.selectedObject.offsetY,i.nameTable),i._updateAssociatedConnectorEnds(i.activeTool.selectedObject,i.nameTable),e.datavisualization.Diagram.ContainerHelper.updateparent(n,i)?(this._removeNodeFromContainer(i,i.activeTool.selectedObject),this._addNodeToContainer(i,i.activeTool.selectedObject,n,null,!0)):e.datavisualization.Diagram.bpmnHelper.updateCanvas(d,i)}else i._translate(i.activeTool.selectedObject,i.activeTool.undoObject.node.offsetX-i.activeTool.selectedObject.offsetX,i.activeTool.undoObject.node.offsetY-i.activeTool.selectedObject.offsetY,i.nameTable),i._updateAssociatedConnectorEnds(i.activeTool.selectedObject,i.nameTable),this._updateLastSwimlanePhase(i,n)}else l=t.extend(!0,{},i.activeTool.selectedObject),"pseudoGroup"!=i.activeTool.selectedObject.type&&this._disableConnectorUpdate(i),i.activeTool.selectedObject.parent&&(o=i.nameTable[i.activeTool.selectedObject.parent]),this._removeNodeFromContainer(i,i.activeTool.selectedObject),i._raiseGroupChangeEvent(i.activeTool.selectedObject,o,null,"group"),this._addMultiNodeToDiagram(i,i.activeTool.selectedObject),this._enableConnectorUpdateNode(i,l),i._updateAssociatedConnectorEnds(l,i.nameTable);return!0},_updateLastSwimlanePhase:function(t,i){var a,n,o=e.datavisualization.Diagram.ContainerHelper.updateparent(i,t);o&&o.isLane&&((a=t.nameTable[o.parent])&&((n=t.nameTable[a.parent])&&this._updateLastPhase(t,n)))},_updateLastPhase:function(t,i){var a,n;if(i&&i.isSwimlane){var o,s=t.nameTable[t._getChild(i.children[2])],r=t.nameTable[t._getChild(i.children[1])],l=e.datavisualization.Diagram.stackHelper._getStackBoundsBounds(t,s),d=e.datavisualization.Diagram.stackHelper._getStackBoundsBounds(t,r),h=e.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(t,i),g=e.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(t,i);o=t.nameTable[t._getChild(g[0])],h.length>0&&((a=t.nameTable[h[h.length-1]])&&("horizontal"===i.orientation?(n=l.width-d.width,a.width+=n,a.offset+=n,o&&o.isLane&&(o.minWidth+=n)):(n=l.height-d.height,a.height+=n,a.offset+=n,o&&o.isLane&&(o.minHeight+=n))),e.datavisualization.Diagram.SwimLaneContainerHelper._updatePhaseStack(t,i))}},_disableConnectorUpdate:function(t){t._disableSegmentChange=!0},_enableConnectorUpdate:function(t,e,i){delete t._disableSegmentChange,e&&(t._updateChildAdjacentConnectors(e,!0),i||(t._disableSegmentChange=!0,this._updateSwimalneAssociatedConnectors(t,e,t._svg),delete t._disableSegmentChange),this._updateChildAdjacentConnectors(t,e))},_updateChildAdjacentConnectors:function(t,i){var a,n,o=t._getChildTable(i,{});for(a in o)(n=t.nameTable[t._getChild(a)])&&n.segments&&-1==i.children.indexOf(a)&&e.datavisualization.Diagram.DiagramContext.update(n,t)},_updateSwimalneAssociatedConnectors:function(t,i,a,n){var o,s,r,l=t._getChildren(i.children);if(l&&l.length>0)for(o=0,s=l.length;o<s;o++)(r=t.nameTable[l[o]])&&(r._type,this._updateSwimalneAssociatedConnectors(t,r,a,n));"group"!=i.type&&e.datavisualization.Diagram.SvgContext._updateAssociatedConnector(i,a,t)},_enableConnectorUpdateNode:function(t,e){var i,a=null;e&&e.parent&&(a=t.nameTable[e.parent]),a&&(a.isLane?(i=t.nameTable[a.parent.split("laneStack")[0]])&&i.isSwimlane&&this._enableConnectorUpdate(t,i):"bpmn"==a.type?this._enableConnectorUpdate(t,a):a.container&&"canvas"===a.container.type&&this._enableConnectorUpdate(t,a))},_enableConnectorUpdatePhase:function(t,e){if(e&&(e.isPhase||"phase"===e.type)){var i=t.nameTable[e.parent.split("phaseStack")[0]];i&&i.isSwimlane&&this._enableConnectorUpdate(t,i)}},_enableConnectorUpdateLane:function(t,e){if(e&&e.isLane){var i=t.nameTable[e.parent.split("laneStack")[0]];i&&i.isSwimlane&&this._enableConnectorUpdate(t,i)}},_outOfBoundaryMultiNodeDrop:function(t,i){var a,n,o,s,r;if(e.datavisualization.Diagram.Util.canMoveOutofBoundary(t)&&i&&"pseudoGroup"===i.type)for(s=i.children,r=0;r<s.length;r++)if(a=t.nameTable[t._getChild(s[r])],(n=this._getTargets(t,a))&&n.length>0&&!a.segments&&((o=this._getContainerFromTarget(t,n,a))&&!this._isExeedBounds(t,a,o)))return!1;return!0},_multiNodedrag:function(t,i,a){var n,o,s,r,l,d,h,g,c;if(this._outOfBoundaryMultiNodeDrop(t,a)){if(a){if(t._disableSwimlaneUptate=!0,this._disableConnectorUpdate(t),a.children.length>0)for(r=a.children,l=0;l<r.length;l++)!(n=t.nameTable[t._getChild(r[l])])||"connector"===n.type||n.segments||((o=this._getTargets(t,n))&&o.length>0?(s=this._getContainerFromTarget(t,o,n))?this._addNodeToContainer(t,n,s):this._addMultiNodeToDiagram(t,n):this._addMultiNodeToDiagram(t,n)),n.parent&&((d=t.nameTable[n.parent])&&d.isLane&&((h=t.nameTable[d.parent.split("laneStack")[0]])&&(t._updateSwimlanes||(t._updateSwimlanes=[]),t._collectionContains(h.name,t._updateSwimlanes)||t._updateSwimlanes.push(h.name))));if(delete t._disableSwimlaneUptate,t._updateSwimlanes&&t._updateSwimlanes.length>0)for(g=0;g<t._updateSwimlanes.length;g++)e.datavisualization.Diagram.DiagramContext.update(t.nameTable[t._updateSwimlanes[g]],t),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(t,t.nameTable[t._updateSwimlanes[g]]);else delete t._disableSegmentChange;delete t._updateSwimlanes,this._getRedoObject(t,a),c={type:"positionchanged",node:jQuery.extend(!0,{},a),undoObject:jQuery.extend(!0,{},t.activeTool._undoObject),redoObject:jQuery.extend(!0,{},t.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0},t.addHistoryEntry(c),t.activeTool._multipleUndo=!0,e.datavisualization.Diagram.Util._updateGroupBounds(a,t),t.updateSelection()}}else this._updateBoundsExceedNodes(t,a,"move")},_updateBoundsExceedNodes:function(t,i,a){var n,o,s,r,l,d=t.tools[a].undoObject,h=i.children;for(i.rotateAngle=d.node.rotateAngle,n=0;n<h.length;n++)o=d.childTable[h[n]],s=t.nameTable[t._getChild(h[n])],o&&s&&("move"===a?t._translate(s,o.offsetX-s.offsetX,o.offsetY-s.offsetY,t.nameTable):"resize"===a?(t._translate(s,o.offsetX-s.offsetX,o.offsetY-s.offsetY,t.nameTable),t.scale(s,o.width/s.width,o.height/s.height,e.datavisualization.Diagram.Point(s.offsetX,s.offsetY),t.nameTable)):"rotate"===a&&(t._translate(s,o.offsetX-s.offsetX,o.offsetY-s.offsetY,t.nameTable),r=o.rotateAngle-s.rotateAngle,s.rotateAngle+=r),"group"===s._type&&e.datavisualization.Diagram.Util._updateGroupBounds(s,t),t._updateAssociatedConnectorEnds(o,t.nameTable),o.parent&&((l=t.nameTable[o.parent])&&l.children.length>0&&(l.children.push(o.name),s.parent=o.parent)),e.datavisualization.Diagram.DiagramContext.update(o,t));e.datavisualization.Diagram.Util._updateGroupBounds(i,t),t.updateSelection()},_getContainerFromTarget:function(t,i,a){for(var n,o,s=0;s<i.length;s++)if(i[s].container&&"canvas"===i[s].container.type&&(n=e.datavisualization.Diagram.Util.bounds(a),o=e.datavisualization.Diagram.Util.bounds(i[s]),n.center.x>o.left&&n.center.x<o.right&&n.center.y>o.top&&n.center.y<o.bottom))return i[s]},_getTargets:function(t,i){var a,n,o,s,r,l,d,h,g,c=null,u=[];if(i)for(a=e.datavisualization.Diagram.Util.bounds(i),o=e.datavisualization.Diagram.SpatialUtil.findQuads(t._spatialSearch,a),s=0;s<o.length;s++)if((r=o[s]).objects.length>0)for(l=0;l<r.objects.length;l++)if(!(d=r.objects[l]).segments&&d.visible&&(c=e.datavisualization.Diagram.Util.bounds(d),-1==u.indexOf(d)&&e.datavisualization.Diagram.Geometry.intersectsRect(a,c)))if(d.isSwimlane)for(g in h=e.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(t,d))(n=t.nameTable[t._getChild(h[g])])&&u.splice(0,0,n);else u.push(d);return u},_removeFromParentContainer:function(t,e){this._removeNodeFromContainer(t,e)},_removeNodeFromContainer:function(t,i,a){var n,o,s,r,l,d;if(t._removedFromContiner=!0,"pseudoGroup"!==i.type){if(d=t.nameTable[i.parent]){for(n=(n=s=d.children).slice(0),r=0;r<s.length;r++)(l=t.nameTable[t._getChild(s[r])]).name===i.name&&e.datavisualization.Diagram.Util.removeChildFromGroup(d.children,s[r]);e.datavisualization.Diagram.SpatialUtil._removeFromaQuad(t._spatialSearch,t._spatialSearch.quadTable[l.name],l),o={element:d,cause:t.activeTool.inAction?e.datavisualization.Diagram.ActionType.Mouse:e.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:n,newValue:s},t._raisePropertyChange(o),t._comparePropertyValues(i,"parent",{parent:""},o.cause),i.parent="","group"===l._type?e.datavisualization.Diagram.SvgContext.renderGroup(l,t._svg,t._diagramLayer,t.nameTable,t):l.segments?e.datavisualization.Diagram.SvgContext.renderConnector(l,t._svg,t._diagramLayer):e.datavisualization.Diagram.SvgContext.renderNode(l,t._svg,t._diagramLayer,void 0,t),a||e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,d,!0)}}else if((s=i.children).length>0){for(this._getUndoObject(t,i),r=0;r<s.length;r++)(l=t.nameTable[t._getChild(s[r])])&&this._removeNodeFromContainer(t,l,!0);l.parent&&(d=t.nameTable[l.parent]),d&&e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,d,!0)}},_addDrgaHistoryEntry:function(t,e){var i,a={};a=t._getChildTable(e,a);t.activeTool._multipleUndo=!0,i={type:"positionchanged",node:jQuery.extend(!0,{},e),childTable:a,category:"internal",swimlaneMultiSelection:!0},t.addHistoryEntry(i)},_cloneNode:function(e,i,a){var n,o,s;if(i){if((i=t.extend(!0,{},i)).name+=a,i.parent+=a,i.children&&i.children.length>0)for(o=i.children,s=0;s<o.length;s++)(n=e.nameTable[e._getChild(o[s])])&&(i.children[s]=this._cloneNode(e,n,a));return i}},_isExeedBounds:function(t,i,a){var n,o,s,r,l,d,h;if(t._disableUpdateQuad=!0,i&&a&&a.isLane&&(n=t.nameTable[a.parent.split("laneStack")[0]])){if(o=e.datavisualization.Diagram.Util.randomId(),s=t._cloneSwimlaneObj(t._getNode(n.name),o),s=e.datavisualization.Diagram.ContainerHelper._initContainer(t,s),r=this._cloneNode(t,i,o),t.nameTable[r.name]=r,l=t.nameTable[a.name+o]){if(l.children.push(r.name),this._updateNodeMargin(t,r,t.nameTable[a.name+o]),t._disableSwimlaneUptate=!0,this._disableConnectorUpdate(t),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,l),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,s),delete t._disableSegmentChange,delete t._disableSwimlaneUptate,d=e.datavisualization.Diagram.Util.bounds(s),e.datavisualization.Diagram.containerCommon._removeObject(t,l),e.datavisualization.Diagram.containerCommon._removeObject(t,s),delete t._disableUpdateQuad,h=t.activeTool._getPageBounds(),d.bottom>h.height||d.right>h.width)return!1;l.children.pop(r.name)}t.nameTable[r.name]}return delete t._disableUpdateQuad,!0},_outOfBoundaryNodeDrop:function(t,i,a){return!e.datavisualization.Diagram.Util.canMoveOutofBoundary(t)||this._isExeedBounds(t,i,a)},_getAssociatedConnectors:function(e,i,a){a=a||[];var n,o=0;if(i&&!i.segments){if(i.children&&i.children.length>0)for(o=0;o<i.children.length;o++)this._getAssociatedConnectors(e,e.nameTable[e._getChild(i.children[o])],a);for(o=0;o<i.inEdges.length;o++)(n=e.nameTable[e._getChild(i.inEdges[o])])&&a.push(t.extend(!0,{},n));for(o=0;o<i.outEdges.length;o++)(n=e.nameTable[e._getChild(i.outEdges[o])])&&a.push(t.extend(!0,{},n))}return a},_addNodeToContainer:function(i,a,n,o,s){var r,l,d,h,g,c,u,m,p,f,_,v,y,b,x;if("connector"!==i.getObjectType(a)&&a&&n&&!a.isPhase)if(a.parent&&((r=i.nameTable[a.parent]).container||(l=r.children,e.datavisualization.Diagram.Util.removeFromCollection(i,l,a),e.datavisualization.Diagram.Util._updateGroupBounds(r,i))),"pseudoGroup"!==a.type){var D=e.datavisualization.Diagram.Util.bounds(i.activeTool.helper),C=e.datavisualization.Diagram.Util.bounds(i.activeTool.selectedObject),z=i.activeTool.helper?D.x-C.x:0,S=i.activeTool.helper?D.y-C.y:0;if(i._raiseOffsetPropertyChange(a,a.offsetX+z,a.offsetY+S,!0),i._translate(a,z,S,i.activeTool.diagram.nameTable),d=(d=n.children).slice(0),n.children.push(a),e.datavisualization.Diagram.Util.removeItem(i.nodes(),a),h={element:n,cause:i.activeTool.inAction?e.datavisualization.Diagram.ActionType.Mouse:e.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:d,newValue:n.children},i._raisePropertyChange(h),i._comparePropertyValues(a,"parent",{parent:n.name},h.cause),a.parent=n.name,this._updateNodeMargin(i,a,n),i._isDragg&&((g=i._historyList)&&g.currentEntry&&g.currentEntry.object&&""===g.currentEntry.object.parent&&(g.currentEntry.object=t.extend(!0,{},a))),c=i._svg.getElementById(n.name),"group"===a._type?e.datavisualization.Diagram.DiagramContext.renderGroup(a,i,c):a.segments||e.datavisualization.Diagram.DiagramContext.renderNode(a,i,c),this._disableConnectorUpdate(i),o||("bpmn"==n.type&&(u=t.extend(!0,{},{node:n})),m=jQuery.extend(!0,{},n),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,n,!0),this._updateAddRemoveNodeConnectors(i,n,m),"bpmn"==n.type&&(i._isGroupActionEnabled=!0,i._startGroupAction(),p={type:"sizechanged",node:jQuery.extend(!0,{},n),undoObject:u,redoObject:t.extend(!0,{},{node:n}),category:"internal"},i.addHistoryEntry(p))),(f=this._getAssociatedConnectors(i,a)).length>0)for(y=0;y<f.length;y++)_=f[y],i._svg.getElementById(_.name),i._removeElement(_),i._zOrder++,i.nameTable[_.name]&&(i.nameTable[_.name].zOrder=i._zOrder),e.datavisualization.Diagram.DiagramContext.renderConnector(_,i);this._updateLastSwimlanePhase(i,a),s||this._enableConnectorUpdateNode(i,a),i._findLabelEditing&&n.children.splice(n.children.indexOf(a.name),1)}else if((v=a.children).length>0){for(y=0;y<v.length;y++)(b=i.nameTable[i._getChild(v[y])])&&this._addNodeToContainer(i,b,n,!0);b&&b.parent&&(x=i.nameTable[b.parent]),x&&(e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,x,!0),e.datavisualization.Diagram.Util._updateGroupBounds(a,i),e.datavisualization.Diagram.SvgContext.updateSelector(a,i._adornerSvg,i._currZoom,i,i.model.selectedItems.constraints))}},_addMultiNodeToDiagram:function(t,i){var a,n,o;if(t.activeTool.helper){var s=e.datavisualization.Diagram.Util.bounds(t.activeTool.helper),r=e.datavisualization.Diagram.Util.bounds(i),l=t.activeTool.helper?s.x-r.x:0,d=t.activeTool.helper?s.y-r.y:0;t._translate(i,l,d,t.nameTable)}for(n=(a=t.nodes()).length-1;n>=0;n--)o=t.nameTable[t._getChild(a[n])],i.name===o.name&&e.datavisualization.Diagram.Util.removeItem(a,a[n]);t.nodes().push(i),t._removedFromContiner&&("group"===i._type?e.datavisualization.Diagram.SvgContext.renderGroup(i,t._svg,t._diagramLayer,t.nameTable,t):i.segments?e.datavisualization.Diagram.SvgContext.renderConnector(i,t._svg,t._diagramLayer):e.datavisualization.Diagram.SvgContext.renderNode(i,t._svg,t._diagramLayer,void 0,t)),delete t._removedFromContiner,t.activeTool.helper&&this._updateLastSwimlanePhase(t,t.activeTool.helper)},_singleNodeResize:function(t,e,i){t.activeTool.selectedObject&&this._resizeNode(t,i)},_resizeNode:function(t,i){var a;if(i){e.datavisualization.Diagram.Util.bounds(i),e.datavisualization.Diagram.Util.bounds(t.activeTool.helper);var n=!0;i.isLane||(""==i.parent&&i._parent&&(i.parent=i._parent,delete i._parent,n=!1),i.segments||(i.parent&&(a=t.nameTable[i.parent]),a&&a.isLane&&this._disableConnectorUpdate(t),n&&t.activeTool._updateSize(i,t.activeTool.startPoint,t.activeTool.currentPoint),a&&(this._updateNodeMargin(t,i,a),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,a,!0),this._updateLastSwimlanePhase(t,i)),this._enableConnectorUpdateNode(t,i)))}},_updateResizeHelper:function(t){var i,a;t.activeTool.helper?(i=e.datavisualization.Diagram.Util.bounds(t.activeTool.helper),t._resizeStack=!0,t.activeTool._updateSize(t.activeTool.helper,t.activeTool.previousPoint,t.activeTool.currentPoint,null,null,null,!0),delete t._resizeStack,a=e.datavisualization.Diagram.Util.bounds(t.activeTool.helper),t.activeTool.selectedObject.container&&!t.activeTool.helper._isBpmn&&t._translate(t.activeTool.helper,i.topLeft.x-a.topLeft.x,i.topLeft.y-a.topLeft.y,t.nameTable),e.datavisualization.Diagram.SvgContext._updateContainerHelper(t)):(t.activeTool.helper=t.activeTool._getCloneNode(t.activeTool.selectedObject),t.activeTool.helper.inEdges=t.activeTool.helper.outEdges=[],t.activeTool.helper.type=null,t.activeTool.helper.name="helper",e.datavisualization.Diagram.SvgContext._drawContainerHelper(t),t.activeTool._startPoint=t.activeTool.currentPoint,t._resizeStack=!0,t.activeTool._updateSize(t.activeTool.helper,t.activeTool.previousPoint,t.activeTool.currentPoint,null,null,null,!0),delete t._resizeStack)},_multiNodeResize:function(t,i,a){var n,o,s,r,l,d;if(a)if(this._outOfBoundaryMultiNodeDrop(t,a)){if(a.children.length>0)for(r=a.children,l=0;l<r.length;l++)n=t.nameTable[t._getChild(r[l])],(o=this._getTargets(t,n))&&o.length>0?(s=this._getContainerFromTarget(t,o,n))?this._addNodeToContainer(t,n,s):this._addMultiNodeToDiagram(t,n):this._addMultiNodeToDiagram(t,n);this._getRedoObject(t,a),d={type:"sizechanged",node:jQuery.extend(!0,{},a),undoObject:jQuery.extend(!0,{},t.activeTool._undoObject),redoObject:jQuery.extend(!0,{},t.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0},t.addHistoryEntry(d),t.activeTool._multipleUndo=!0,e.datavisualization.Diagram.Util._updateGroupBounds(a,t),t.updateSelection()}else this._updateBoundsExceedNodes(t,a,"resize")},_singleNodeRotate:function(t,e,i){t.activeTool.selectedObject&&this._rotateNode(t,i)},_rotateNode:function(t,i){var a,n,o;i&&(a=!0,i.container||(""==i.parent&&i._parent&&(i.parent=i._parent,delete i._parent,a=!1),i.parent&&(n=t.nameTable[i.parent]),n&&n.isLane&&this._disableConnectorUpdate(t),i.segments||(a&&(t.nameTable[t.activeTool.selectedObject.name],t.activeTool.helper&&(o=t.activeTool.helper.rotateAngle-t.nameTable[t.activeTool.selectedObject.name].rotateAngle,t._comparePropertyValues(i,"rotateAngle",{rotateAngle:t.activeTool.helper.rotateAngle},!0),t._rotate(t.activeTool.selectedObject,o,t.nameTable))),n&&(this._updateNodeMargin(t,i,n),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,n,!0),this._updateLastSwimlanePhase(t,i)),this._enableConnectorUpdateNode(t,i))))},_multiNodeRotate:function(t,i,a){var n,o,s,r,l,d;if(a)if(this._outOfBoundaryMultiNodeDrop(t,a)){if(a.children.length>0)for(r=a.children,l=0;l<r.length;l++)n=t.nameTable[t._getChild(r[l])],(o=this._getTargets(t,n))&&o.length>0?(s=this._getContainerFromTarget(t,o,n))?this._addNodeToContainer(t,n,s):this._addMultiNodeToDiagram(t,n):this._addMultiNodeToDiagram(t,n);this._getRedoObject(t,a),d={type:"rotationchanged",node:jQuery.extend(!0,{},a),undoObject:jQuery.extend(!0,{},t.activeTool._undoObject),redoObject:jQuery.extend(!0,{},t.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0},t.addHistoryEntry(d),t.activeTool._multipleUndo=!0,e.datavisualization.Diagram.Util._updateGroupBounds(a,t),t.updateSelection()}else this._updateBoundsExceedNodes(t,a,"rotate")},_updateDropLaneProperties:function(t,i,a){if(i&&a){i.orientation=a.orientation,i.horizontalAlign="horizontal"===a.orientation?"stretch":"left",i.verticalAlign="vertical"===a.orientation?"stretch":"top",i.paddingBottom=20,i.paddingTop=20,i.paddingLeft=20,i.paddingRight=20;var n=t.nameTable[t._getChild(i.children[0])];n&&(n.marginLeft=-20,n.marginTop=-20,n.marginRight=-20,n.marginBottom=-20,n.constraints=e.datavisualization.Diagram.NodeConstraints.Default^e.datavisualization.Diagram.NodeConstraints.Select^e.datavisualization.Diagram.NodeConstraints.Connect,n._isHeader=!0)}return i},_updateAddRemoveNodeConnectors:function(t,e,i){if(e&&e.isLane&&i&&i.isLane){var a,n;a=e.width-i.width,n=e.height-i.height,(a||n)&&this._updateOverlappedConnectorSegment(t,i,a,n)}},_updateAddRemoveLaneConnectors:function(t,e){if(e&&e.isLane){var i,a,n,o=[];for(a=this._getSwimlane(t,e.name).lanes,n=0;n<a.length;n++)e=t.nameTable[t._getChild(a[n])],this._laneConnectors(t,e,o);for(n=0;n<o.length;n++)(i=t.nameTable[t._getChild(o[n])])&&this._updateConnectorEndPoints(t,i)}},_outOfBoundaryAddLane:function(i,a,n,o){var s,r,l,d,h;return!(e.datavisualization.Diagram.Util.canMoveOutofBoundary(i)&&(s=i._cloneSwimlaneObj(i._getNode(a.name),e.datavisualization.Diagram.Util.randomId()),s=e.datavisualization.Diagram.ContainerHelper._initContainer(i,s),r=i.activeTool._cloneGroupNode(t.extend(!0,{},n),e.datavisualization.Diagram.Util.randomId()),i.nameTable[r.name]=r,l=i.nameTable[i._getChild(s.children[2])],o||0===o?l.children.splice(o,0,r.name):l.children.push(r.name),r.parent=l.name,i._disableSwimlaneUptate=!0,this._disableConnectorUpdate(i),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,r),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,s),this._enableConnectorUpdate(i,s),delete i._disableSwimlaneUptate,d=e.datavisualization.Diagram.Util.bounds(s),e.datavisualization.Diagram.containerCommon._removeObject(i,r),e.datavisualization.Diagram.containerCommon._removeObject(i,s),h=i.activeTool._getPageBounds(),d.bottom>h.height||d.right>h.width))},_addNewLane:function(t,i,a,n,o){var s,r,l,d,h,g,c,u,m,p,f;if(t.activeTool._removeHelpers(),r=t.nameTable[t._getChild(a.children[2])]){if(l=t.activeTool._cloneGroupNode(t.activeTool.selectedObject,n?"":e.datavisualization.Diagram.Util.randomId()),l=this._updateDropLaneProperties(t,l,a),d=t._isUndo,t._isUndo=!0,t.activeTool.selectedObject=null,t.remove(t.activeTool.selectedObject),t._isUndo=d,t._isUndo||this._outOfBoundaryAddLane(t,a,l,o)){if(h=!1,f={element:t.getNode(l),cancel:!1,target:i},i&&(o=void 0!==o?o:t.activeTool._getSwimLaneStackIndex(i)),o||0===o?r.children.splice(o,0,l):r.children.push(l),l.parent=r.name,t._isUndo||t._raiseDropEvent(f),t.remove(l),!f.cancel){if(t.activeTool._isLane=!0,l.isLane&&((g=t.nameTable[t._getChild(l.children[0])])&&l.labels&&g.labels.length>0))for(c=0;c<g.labels.length;c++)g.labels[c].visible=!0;t._isUndo||(u=t._getChildTable(l,{}),m={type:"collectionchanged",object:jQuery.extend(!0,{},l),childTable:jQuery.extend(!0,{},u),index:o,changeType:"insert",category:"internal"},t.addHistoryEntry(m)),t._preventHistoryEntry=!0,t.add(l)&&(h=!0,t._updateDroppedSymbol(l)),delete t._preventHistoryEntry}this._disableConnectorUpdate(t),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,r),this._updateAddRemoveLaneConnectors(t,l),e.datavisualization.Diagram.canvasHelper._updateLastPhase(t,a),this._enableConnectorUpdateLane(t,l),h&&(p=t._isUndo?e.datavisualization.Diagram.GroupChangeCause.HistoryChange:e.datavisualization.Diagram.GroupChangeCause.Drop,f={changeType:"insert",element:t.getNode(l),state:"changed",cause:p},t._raiseEvent("nodeCollectionChange",f)),s=!0}t._clearSelection(!0),s&&t._addSelection(a,!0),t.activeTool.selectedObject=null}},_outOfBoundsOnLaneResize:function(t,i,a){var n,o;if(e.datavisualization.Diagram.Util.canMoveOutofBoundary(t)&&(n=a?t.nameTable[i.parent.split("laneStack")[0]]:i,e.datavisualization.Diagram.Util.randomId(),n)){var s=e.datavisualization.Diagram.Util.bounds(n),r=0,l=0;if(i.height!=t.activeTool.helper.height&&(l=t.activeTool.helper.height-i.height),i.width!=t.activeTool.helper.width&&(r=t.activeTool.helper.width-i.width),o=t.activeTool._getPageBounds(),s.bottom+l>o.height||s.right+r>o.width)return!1}return!0},_getLaneIndex:function(t,e){for(var i=t.lanes,a=0;a<i.length;a++)if(e.name===i[a].name)return a;return null},_isCanAddNodeToSegmentUpdate:function(t,e,i){if(i){if(!i||!i.parent)return!1;var a,n=t.nameTable[i.parent];if(!n||!n.isLane)return!1;if(a=this._getSwimlane(t,n.name),this._getLaneIndex(a,n)>e)return!0}return!1},_getUpdateConnectorByEdges:function(t,e,i,a){e&&(this._getUpdateSegmentConnectors(t,e,i,a,e.inEdges),this._getUpdateSegmentConnectors(t,e,i,a,e.outEdges))},_getUpdateSegmentConnectors:function(t,e,i,a,n){var o,s,r,l;if(n&&n.length>0)for(l=0;l<n.length;l++)(o=t.nameTable[n[l]]).sourceNode&&(s=t.nameTable[o.sourceNode]),o.targetNode&&(r=t.nameTable[o.targetNode]),s&&r&&this._isCanAddNodeToSegmentUpdate(t,i,s)&&this._isCanAddNodeToSegmentUpdate(t,i,r)&&!t._collectionContains(o.name,a)&&a.push(o)},_updateConnectorSegments:function(t,i,a,n){var o,s,r,l,d,h,g=this._getSwimlane(t,i.name);if(null!=(o=this._getLaneIndex(g,i)))for(s=[],r=g.lanes,l=o+1;l<r.length;l++)for(d=r[l].children,h=0;h<d.length;h++)this._getUpdateConnectorByEdges(t,d[h],o,s);if(s&&s.length>0&&null!=a&&null!=n)for(l=0;l<s.length;l++)e.datavisualization.Diagram.Util._translateLine(s[l],a,n,s[l])},_resizeLane:function(i,a){var n,o,s,r,l,d,h,g,c=i.nameTable[a.name],u=!0;if(c)if(c.isLane||c._isBpmn){if(this._outOfBoundsOnLaneResize(i,c,!0)){if("bpmn"==c.type&&c.container){var m=i.activeTool.helper,p=m.width/a.width,f=m.height/a.height,_={x:a.offsetX,y:a.offsetY};i._raiseSizePropertyChange(a,m.width/a.width,m.height/a.height,!0),i.activeTool._undoObject=t.extend(!0,{},{node:c}),(c=t.extend(!0,c,{width:m.width,height:m.height,offsetX:m.offsetX,offsetY:m.offsetY,minWidth:m.width,minHeight:m.height})).parent?e.datavisualization.Diagram.ContainerHelper.updateparent(c,i)?(c.minWidth=i.activeTool.helper.width,c.minHeight=i.activeTool.helper.height,e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,c,!0),this._updateLastSwimlanePhase(i,c)):e.datavisualization.Diagram.bpmnHelper.updateCanvas(c,i):e.datavisualization.Diagram.bpmnHelper.updateCanvas(c,i),e.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(c,1/p,1/f,_,i),i.activeTool._redoObject=t.extend(!0,{},{node:c})}else c.container&&(i._raiseSizePropertyChange(a,i.activeTool.helper.width/a.width,i.activeTool.helper.height/a.height,!0),i.activeTool._undoObject=t.extend(!0,{},{node:c}),i._comparePropertyValues(a,"minWidth",{minWidth:i.activeTool.helper.width},!0),i._comparePropertyValues(a,"offsetX",{offsetX:a.offsetX+i.activeTool.helper.width/2},!0),c.minWidth=i.activeTool.helper.width<=100?100:i.activeTool.helper.width,i._comparePropertyValues(a,"minHeight",{minHeight:i.activeTool.helper.height},!0),i._comparePropertyValues(a,"offsetY",{offsetY:a.offsetY+i.activeTool.helper.height/2},!0),c.minHeight=i.activeTool.helper.height<=100?100:i.activeTool.helper.height,i.activeTool._redoObject=t.extend(!0,{},{node:c}));g={type:"sizechanged",node:jQuery.extend(!0,{},c),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"},i.addHistoryEntry(g),i.activeTool._multipleUndo=!0,c.isLane&&(this._disableConnectorUpdate(i),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,c,!0),n=c.width-i.activeTool._undoObject.node.width,o=c.height-i.activeTool._undoObject.node.height,s=i._preventDocking,r=i._disableSegmentChange,delete i._preventDocking,delete i._disableSegmentChange,this._updateOverlappedConnectorSegment(i,i.activeTool._undoObject.node,n,o),i._preventDocking=s,i._disableSegmentChange=r,this._updateConnectorSegments(i,c,n,o),this._enableConnectorUpdateLane(i,c))}}else c.isSwimlane?(l=e.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,c)).length>0&&((h=i.nameTable[i._getChild(l[l.length-1])])&&(i.activeTool._undoObject=t.extend(!0,{},{node:h}),i._raiseSizePropertyChange(c,i.activeTool.helper.width/c.width,i.activeTool.helper.height/c.height,!0),"vertical"===c.orientation?(d=h.width+i.activeTool.helper.width-c.width,i._comparePropertyValues(h,"minWidth",{minWidth:d},!0),i._comparePropertyValues(h,"offsetX",{offsetX:a.offsetX+d/2},!0),h.minWidth=d<=100?100:d):(d=h.height+i.activeTool.helper.height-c.height)==h.minHeight?u=!1:(i._comparePropertyValues(h,"minHeight",{minHeight:d},!0),i._comparePropertyValues(h,"offsetY",{offsetY:a.offsetY+d/2},!0),h.minHeight=d<=100?100:d),u&&(this._disableConnectorUpdate(i),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,h,!0),this._enableConnectorUpdateLane(i,c),i.activeTool._redoObject=t.extend(!0,{},{node:h}),g={type:"sizechanged",node:jQuery.extend(!0,{},c),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"},i.addHistoryEntry(g),i.activeTool._multipleUndo=!0,this._disableConnectorUpdate(i),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,c,!0),this._enableConnectorUpdateLane(i,c)))):c.container&&(c.minWidth=i.activeTool.helper.width,c.minHeight=i.activeTool.helper.height,e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,c,!0))},_updateOverlappedConnectorSegment:function(t,i,a,n){var o,s,r,l,d,h,g,c,u,m,p;if(i&&(void 0!=a&&void 0!=n&&(m=this._overLappedConnectros(t,i)),m&&m.length>0))for(p=e.datavisualization.Diagram.Util.bounds(i),"horizontal"===i.orientation?(o=p.bottomLeft,s=p.bottomRight):(o=p.topRight,s=p.bottomRight),[],r=0;r<m.length;r++)if((l=this._lineSegmentsIntersect(t,i,m[r],{start:o,end:s}))&&l.length>0)for(d=0;d<l.length;d++)h=Object.keys(l[d])[0],g=l[d][h].index,l[d][h].point,(c=t.nameTable[t._getChild(h)])&&c.segments&&c.segments.length>0&&("horizontal"===i.orientation?(c.segments[g]&&(u=c.segments[g].length),u&&(c.segments[g].length+=n)):(u=c.segments[g].length)&&(c.segments[g].length+=a),this._updateConnectorEndPoints(t,c))},_lineSegmentsIntersect:function(t,e,i,a){var n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b;if(n=a.start.x,o=a.start.y,s=a.end.x,r=a.end.y,v=[],y=e&&e.orientation?e.orientation:"horizontal",(i=t.nameTable[t._getChild(i)])&&i.segments&&i.segments.length>0&&1!==i.segments.length)for(l=0;l<i.segments.length;l++)if((d=i.segments[l])&&d.points.length>0)for(h=0;h<d.points.length-1;h++)g=d.points[h],c=d.points[h+1],g&&c&&(u=g.x,m=g.y,p=c.x,f=c.y,this._isInterSecting(n,o,s,r,u,m,p,f)&&(_={},b=h,"horizontal"===y?g.y>o&&(b=-1):g.x>n&&(b=-1),_[i.name]={index:l,point:b},v.push(_)));return v},_isInterSecting:function(t,e,i,a,n,o,s,r,l){var d=i-t,h=a-e,g=s-n,c=r-o,u=(-h*(t-n)+d*(e-o))/(-g*h+d*c),m=(+g*(e-o)-c*(t-n))/(-g*h+d*c);return l?u>0&&u<1&&m>0&&m<1:u>=0&&u<=1&&m>=0&&m<=1},_overLappedConnectros:function(t,e){var i,a,n,o,s,r=this._getSwimlane(t,e.name);if(r&&r.isSwimlane&&(i=this._getLaneIndex(r,e),n=[],(a=t.nameTable[e.parent])&&a.isLaneStack&&a&&a.children.length>0))for(o=i;o>=0;o--)(s=t.nameTable[t._getChild(a.children[o])])&&s.isLane&&this._laneConnectors(t,s,n);return n},_getUndoObject:function(e,i){var a={};a=e._getChildTable(i,a);e.activeTool._undoObject=t.extend(!0,{},{node:i,childTable:a})},_getRedoObject:function(e,i){var a={};a=e._getChildTable(i,a);e.activeTool._redoObject=t.extend(!0,{},{node:i,childTable:a})},_undoRemoveNodeFromContainer:function(t,i){var a,n,o,s;if("pseudoGroup"!==i.type&&(a=t.nameTable[i.parent])){for(i.parent="",n=a.children,s=0;s<n.length;s++)(o=t.nameTable[t._getChild(n[s])])&&o.name===i.name&&(t.nodes().push(n[s]),e.datavisualization.Diagram.Util.removeChildFromGroup(a.children,n[s]));e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,a,!0)}},_undoAddNodeToContainer:function(i,a,n){var o,s,r,l;a&&"pseudoGroup"!==a.type&&(o=i.nameTable[n.parent],n.segments?a.sourceNode||a.targetNode||(r=e.datavisualization.Diagram.Util.bounds(a,!0),l=e.datavisualization.Diagram.Util.bounds(n,!0),e.datavisualization.Diagram.Util._translateLine(a,l.center.x-r.center.x,l.center.y-r.center.y)):i._translate(a,n.offsetX-a.offsetX,n.offsetY-a.offsetY,i.nameTable),o?(a.parent=o.name,o.children.push(a),e.datavisualization.Diagram.Util.removeItem(i.nodes(),a),s=i._svg.getElementById(o.name),o._isBpmn?(e.datavisualization.Diagram.bpmnHelper.resetNodeMargin(a,o,i),a=t.extend(!0,a,{marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom})):this._updateNodeMargin(i,a,o),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,o,!0)):(i._swimlaneOuterNodes||(i._swimlaneOuterNodes=[]),i._swimlaneOuterNodes.push(a)),"group"===a._type?e.datavisualization.Diagram.DiagramContext.renderGroup(a,i,s):a.segments?e.datavisualization.Diagram.DiagramContext.renderConnector(a,i,s):e.datavisualization.Diagram.DiagramContext.renderNode(a,i,s))},_undoDragNode:function(e,i,a,n){if(a=t.extend(!0,{},a),i&&a&&"pseudoGroup"!==i.type){var o=t.extend(!0,{},a),s=t.extend(!0,{},i);n||(this._disableConnectorUpdate(e),e._disableSwimlaneUptate=!0),this._undoRemoveNodeFromContainer(e,i),this._undoAddNodeToContainer(e,i,a),n||delete e._disableSwimlaneUptate,e._clearSelection(!0),e._addSelection(i,!0),this._updateLastSwimlanePhase(e,i),n||(s.parent?(this._enableConnectorUpdateNode(e,s),i.parent&&i.parent!==s.parent&&(this._enableConnectorUpdateNode(e,i),this._updateLastSwimlanePhase(e,s))):this._enableConnectorUpdateNode(e,o)),i.parent||this._updateAssociatedConnectorEnds(e,i,e.nameTable)}},_undoMultiDragNode:function(i,a){var n,o,s,r,l,d,h,g,c,u,m,p=t.extend(!0,{},a.node);if(p&&"pseudoGroup"===p.type){for(o=p.children,i._disableSwimlaneUptate=!0,c=0;c<o.length;c++)this._disableConnectorUpdate(i),r=(s=i.nameTable[i._getChild(o[c])]).parent,n=a.undo&&s?a.undoObject.childTable?a.undoObject.childTable[s.name]:null:a.redoObject.childTable?a.redoObject.childTable[s.name]:null,this._undoDragNode(i,s,n,!0),r||n.parent&&(r=n.parent),r?(l=i.nameTable[r])&&l.isLane&&((d=i.nameTable[l.parent.split("laneStack")[0]])&&(i._updateSwimlanes||(i._updateSwimlanes=[]),i._collectionContains(d.name,i._updateSwimlanes)||i._updateSwimlanes.push(d.name))):(delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,s,i.nameTable)),delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,s,i.nameTable);if(delete i._disableSwimlaneUptate,i._updateSwimlanes&&i._updateSwimlanes.length>0)for(h=0;h<i._updateSwimlanes.length;h++)e.datavisualization.Diagram.DiagramContext.update(i.nameTable[i._updateSwimlanes[h]],i),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(i,i.nameTable[i._updateSwimlanes[h]]);if(i._swimlaneOuterNodes&&i._swimlaneOuterNodes.length>0){for(h=0;h<i._swimlaneOuterNodes.length;h++)if((g=i._swimlaneOuterNodes[h])&&"connector"!==g.type){for(c=0,u=g.inEdges.length;c<u;c++)(m=i.nameTable[g.inEdges[c]])&&(i._dock(m,i.nameTable),e.datavisualization.Diagram.DiagramContext.update(m,i));for(c=0,u=g.outEdges.length;c<u;c++)(m=i.nameTable[g.outEdges[c]])&&(i._dock(m,i.nameTable),e.datavisualization.Diagram.DiagramContext.update(m,i))}delete i._swimlaneOuterNodes}delete i._updateSwimlanes,i._clearSelection(!0),e.datavisualization.Diagram.Util._updateGroupBounds(p,i),i._addSelection(p,!0),delete i.nameTable[p.name],i.nameTable[p.name]=p}},_updateAssociatedConnectorEnds:function(t,i,a){var n,o,s,r,l,d,h;if("connector"!==t.getObjectType(i)&&(i.inEdges.length||i.outEdges.length)){for(r=t._isNodeToNodeConnection(i),l=i,"bpmn"==i.type&&"group"==i._type&&(l="object"==typeof i.children[0]?i.children[0]:t.nameTable[i.children[0]]),r&&(d=e.datavisualization.Diagram.Util._findSegmentPoints(l)),h={},t._parentNode&&(h=t._getChildTable(t._parentNode,{})),n=0,o=i.inEdges.length;n<o;n++)!(s=a[i.inEdges[n]])||t._parentNode&&h[s.sourceNode]||(s.targetPadding?delete l._segmentPoints:l._segmentPoints=d,t._dock(s,a),e.datavisualization.Diagram.DiagramContext.update(s,t));for(n=0,o=i.outEdges.length;n<o;n++)!(s=a[i.outEdges[n]])||t._parentNode&&h[s.targetNode]||(s.sourcePadding?delete l._segmentPoints:l._segmentPoints=d,t._dock(s,a));delete l._segmentPoints}},_undoRemoveResizeNodeFromContainer:function(t,i){var a,n,o,s;if("pseudoGroup"!==i.type&&(a=t.nameTable[i.parent])){for(i.parent="",n=a.children,s=0;s<n.length;s++)(o=t.nameTable[t._getChild(n[s])])&&o.name===i.name&&e.datavisualization.Diagram.Util.removeChildFromGroup(a.children,n[s]);e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,a,!0)}},_undoAddResizeNodeToContainer:function(i,a,n){if("pseudoGroup"!==a.type){var o,s=i.nameTable[n.parent];a.segments||(i._translate(a,n.offsetX-a.offsetX,n.offsetY-a.offsetY,i.nameTable),i.scale(a,n.width/a.width,n.height/a.height,e.datavisualization.Diagram.Point(a.offsetX,a.offsetY),i.nameTable),"group"===a._type&&e.datavisualization.Diagram.Util._updateGroupBounds(a,i),a.container&&e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,a,!0)),s&&(a.parent=s.name,s.children.push(a.name),o=i._svg.getElementById(s.name),s._isBpmn?(e.datavisualization.Diagram.bpmnHelper.resetNodeMargin(a,s,i),a=t.extend(!0,a,{marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom})):this._updateNodeMargin(i,a,s),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,s,!0)),"group"===a._type?e.datavisualization.Diagram.DiagramContext.renderGroup(a,i,o):a.segments?e.datavisualization.Diagram.DiagramContext.renderConnector(a,i,o):e.datavisualization.Diagram.DiagramContext.renderNode(a,i,o)}},_undoResizeNode:function(e,i,a,n){a=t.extend(!0,{},a),i&&a&&"pseudoGroup"!==i.type&&(n||this._disableConnectorUpdate(e),this._undoRemoveResizeNodeFromContainer(e,i),this._undoAddResizeNodeToContainer(e,i,a),e._clearSelection(!0),e._addSelection(i,!0),this._updateLastSwimlanePhase(e,i),n||this._enableConnectorUpdateNode(e,i))},_undoMultiResizeNode:function(i,a){var n,o,s,r,l=t.extend(!0,{},a.node);if(l&&"pseudoGroup"===l.type){for(o=l.children,s=0;s<o.length;s++)r=i.nameTable[i._getChild(o[s])],n=a.undo&&r?a.undoObject.childTable?a.undoObject.childTable[r.name]:null:a.redoObject.childTable?a.redoObject.childTable[r.name]:null,this._undoResizeNode(i,r,n);i._clearSelection(!0),e.datavisualization.Diagram.Util._updateGroupBounds(l,i),i._addSelection(l,!0),delete i.nameTable[l.name],i.nameTable[l.name]=l}},_undoResizeLane:function(i,a,n){var o,s,r,l,d,h,g=i.nameTable[a.name];g&&(n&&n.node&&n.node.isSwimlane?(o=e.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,n.node)).length>0&&((s=i.nameTable[i._getChild(o[o.length-1])])&&(a=n.undo?n.undoObject&&n.undoObject.node?n.undoObject.node:s:n.undoObject&&n.redoObject.node?n.redoObject.node:s,i._comparePropertyValues(s,"minWidth",{minWidth:a.minWidth}),s.minWidth=a.minWidth,i._comparePropertyValues(s,"minHeight",{minHeight:a.minHeight}),s.minHeight=a.minHeight,this._disableConnectorUpdate(i),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,g,!0),this._enableConnectorUpdateLane(i,g))):g.isLane&&(g.container&&(i.activeTool._undonode=t.extend(!0,{},{node:g}),i._comparePropertyValues(g,"minWidth",{minWidth:a.minWidth}),g.minWidth=a.minWidth,i._comparePropertyValues(g,"minHeight",{minHeight:a.minHeight}),g.minHeight=a.minHeight),this._disableConnectorUpdate(i),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,g,!0),r=g.width-i.activeTool._undonode.node.width,l=g.height-i.activeTool._undonode.node.height,d=i._preventDocking,h=i._disableSegmentChange,delete i._preventDocking,delete i._disableSegmentChange,this._updateOverlappedConnectorSegment(i,i.activeTool._undonode.node,r,l),i._preventDocking=d,i._disableSegmentChange=h,this._updateConnectorSegments(i,g,r,l),this._enableConnectorUpdateLane(i,g)))},_undoRemoveRotateNodeFromContainer:function(t,i){var a,n,o,s;if("pseudoGroup"!==i.type&&(a=t.nameTable[i.parent])){for(i.parent="",n=a.children,s=0;s<n.length;s++)(o=t.nameTable[t._getChild(n[s])])&&o.name===i.name&&e.datavisualization.Diagram.Util.removeChildFromGroup(a.children,n[s]);e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,a,!0)}},_undoAddRotateNodeToContainer:function(i,a,n){var o,s,r;"pseudoGroup"!==a.type&&(o=i.nameTable[n.parent],a.segments||(r=n.rotateAngle-a.rotateAngle,i._rotate(a,r,i.nameTable)),o&&(a.parent=o.name,o.children.push(a.name),s=i._svg.getElementById(o.name),o._isBpmn?(e.datavisualization.Diagram.bpmnHelper.resetNodeMargin(a,o,i),a=t.extend(!0,a,{marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom})):this._updateNodeMargin(i,a,o),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,o,!0)),"group"===a._type?e.datavisualization.Diagram.DiagramContext.renderGroup(a,i,s):a.segments?e.datavisualization.Diagram.DiagramContext.renderConnector(a,i,s):e.datavisualization.Diagram.DiagramContext.renderNode(a,i,s))},_undoRotateNode:function(e,i,a,n){a=t.extend(!0,{},a),i&&a&&"pseudoGroup"!==i.type&&(n||this._disableConnectorUpdate(e),this._undoRemoveRotateNodeFromContainer(e,i),this._undoAddRotateNodeToContainer(e,i,a),e._clearSelection(!0),e._addSelection(i,!0),this._updateLastSwimlanePhase(e,i),n||this._enableConnectorUpdateNode(e,i))},_undoMultiRotateNode:function(i,a){var n,o,s,r,l=t.extend(!0,{},a.node);if(l&&"pseudoGroup"===l.type){for(o=l.children,s=0;s<o.length;s++)r=i.nameTable[i._getChild(o[s])],n=a.undo&&r?a.undoObject.childTable?a.undoObject.childTable[r.name]:null:a.redoObject.childTable?a.redoObject.childTable[r.name]:null,this._undoRotateNode(i,r,n,!0);i._clearSelection(!0),l.rotateAngle=n.rotateAngle,e.datavisualization.Diagram.Util._updateGroupBounds(l,i),i._addSelection(l,!0),delete i.nameTable[l.name],i.nameTable[l.name]=l}},_undoSwap:function(t,i){var a,n,o,s;t.activeTool._removeHelpers(),t._clearSelection(!0);var r=i.undo?i.insertIndex:i.moveIndex,l=t.nameTable[i.undoObject.name1],d=l&&l.parent?t.nameTable[l.parent]:null;d&&d.children.length>0&&(a=d.children),n=a.slice(),o=this._getSwimlane(t,a[0]),a&&a.length>0&&(e.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(t),this._undoSwapLane(t,a,r,l,null),e.datavisualization.Diagram.ContainerHelper._updateCollectionChange(t,d,!1),e.datavisualization.Diagram.canvasHelper._recreateConnectorSegments(t,l.name,n,i.undoObject.name2,i.undoObject.name1),e.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(t,l)),s=this._getSwimlane(t,a[0]),t._comparePropertyValues(s,"lanes",{lanes:o.lanes})},_undoSwapLane:function(t,e,i,a){e&&e.length>0&&(e.splice(e.indexOf(a),1),e.splice(i,0,a))}},e.datavisualization.Diagram.containerCommon={_initGroupNode:function(t,i){var a,n=null;for(i=t._getNewGroup(i),a=0;a<i.children.length;a++)(n=i.children[a])&&"object"==typeof n&&("object"!=typeof n.shape&&(n=e.datavisualization.Diagram.NodeType(n,t)),"group"==n._type||n.children||n.segments||"connector"==n.type?n.segments||"connector"==n.type?""==(n=t._getNewConnector(n)).name&&(n.name=e.datavisualization.Diagram.Util.randomId()):(""==(n=t._getNewGroup(n)).name&&(n.name=e.datavisualization.Diagram.Util.randomId()),n=this._initGroupNode(t,n)):("bpmn"!=i.type&&(n=t._getNewNode(n)),""==n.name&&(n.name=e.datavisualization.Diagram.Util.randomId()),"node"==n._type&&n.labels.length&&(0==n.width||0==n.height)&&t._getNodeDimension(n)),i.children[a]=n,n.parent=i.name);return i},_initChildren:function(t,i){var a,n,o;if(i.children&&i.children.length>0)for(a=i.children,n=0;n<a.length;n++)(o="string"==typeof a[n]?t.nameTable[a[n]]:a[n])&&((!o._isInternalShape||o._isInternalShape&&"group"===o.type)&&(o.container?o=e.datavisualization.Diagram.ContainerHelper._initContainer(t,o):o.children?(o=e.datavisualization.Diagram.Group(o),o=this._initGroupNode(t,a[n]),o=t._getNewGroup(a[n]),o=this._initChildren(t,a[n]),t._isLoad&&"bpmn"!==a[n].type&&this._updateGroupBounds(t,a[n])):o.segments?(o=e.datavisualization.Diagram.Connector(o),o=t._getNewConnector(o)):(o=e.datavisualization.Diagram.NodeType(o,t),o=t._getNewNode(o)),i.container&&"bpmn"===o.type&&"group"!==i.shape&&t._translate(o,0-o.offsetX,0-o.offsetY,t.nameTable)),t.nameTable[o.name]=o,i.children[n]=o,t._spatialSearch&&t._updateQuad(o));return i},_getChildrenBounds:function(t,i){var a,n,o,s,r=i.children,l=e.datavisualization.Diagram.Rectangle();for(r.length>0&&((n=t.nameTable[t._getChild(r[0])])&&(l=e.datavisualization.Diagram.Util._rotateChildBounds(n,i,t))),o=0,s=r.length;o<s;o++)(n=t.nameTable[t._getChild(r[o])])&&("group"===n._type?(e.datavisualization.Diagram.Util._updateGroupBounds(n,t),a=e.datavisualization.Diagram.Util._rotateChildBounds(n,i,t)):a=e.datavisualization.Diagram.Util._rotateChildBounds(n,i,t)),a&&(l=e.datavisualization.Diagram.Geometry.union(l,a));return l},_updateGroupBounds:function(t,i,a){var n;if(i&&!i.container&&i&&("pseudoGroup"===i.type||i.children&&i.children.length>0)){i.width,i.height,i.offsetX,i.offsetY,a&&e.datavisualization.Diagram.Util._updateRotateAngle(i,t.nameTable);var o=this._getChildrenBounds(t,i),s={x:o.x+o.width*i.pivot.x,y:o.y+o.height*i.pivot.y};i.rotateAngle&&(n=e.Matrix.identity(),e.Matrix.rotate(n,i.rotateAngle),s=e.Matrix.transform(n,s)),o&&(i.offsetX=s.x,i.offsetY=s.y,i.width=o.width,i.height=o.height)}},_cloneObject:function(e,i,a){var n,o;if(i){if((n=t.extend(!0,{},i)).children&&n.children.length>0)for(o=0;o<n.children.length;o++)n.children[o]=this._cloneObject(e,n.children[o],a);n.name+=a}return n},_removeObject:function(t,e){var i;if(e){if("string"==typeof e&&(e=t.nameTable[e]),e&&e.children&&e.children.length>0)for(i=0;i<e.children.length;i++)this._removeObject(t,e.children[i]);e&&delete t.nameTable[e.name]}}}})(jQuery,Syncfusion),function(t,e){"use strict";e.widget("ejRuler","ej.datavisualization.ejRuler",{element:null,validTags:["div"],model:null,defaults:{offset:0,orientation:"horizontal",scale:1,interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25},_init:function(){"msie"===e.browserInfo().name&&Number(e.browserInfo().version)<9||(this._wireEvents(),this._renderRuler())},_renderRuler:function(){this._updateRulerGeometry()},_updateRulerGeometry:function(){var e=this.model.length;e||(e="horizontal"===this.orientation?t(this.element[0]).width():t(this.element[0]).height()),this.element[0].style.height=("horizontal"===this.model.orientation?this.model.thickness:e)+"px",this.element[0].style.width=("horizontal"===this.model.orientation?e:this.model.thickness)+"px",this.element[0].style.textAlign="left",this._renderRulerSpace(),this._updateRuler()},_renderRulerSpace:function(){var t=this._getRulerGeometry(),e=document.getElementById(this.element[0].id+"_ruler_space");return e||((e=document.createElement("div")).setAttribute("id",this.element[0].id+"_ruler_space"),e.setAttribute("class","ej-ruler-space"),e.style.height=t.height+"px",e.style.width=t.width+"px",e.style.float="left",this.element[0].appendChild(e)),e},_updateRuler:function(){var t,e,i=this._getRulerSize(),a=this._getRulerGeometry(),n=0,o=0,s=this._getRulerSVG(a);s&&(n=this.model.length,o=this.model.offset,n&&n!=1/0&&(t=n+this.model.segmentWidth,e=o,this._updateSegments(e,t+Math.abs(e),s,i)))},_updateSegments:function(t,e,i,a){for(var n,o=t,s={trans:0};o<e;)(n=this._getNewSegment(o,i))&&(i.document.appendChild(n.segment),o=this._updateSegment(t,e,n,o,s,i,a))},_updateSegment:function(t,e,i,a,n,o,s){var r=this._updateSegmentWidth(this.model.scale);return a==t?(this.model.startValue=Math.floor(t/r)*r/this.model.scale,this.model.startValue=this.model.startValue%1!=0?Number(this.model.startValue.toFixed(1)):this.model.startValue,i.label.textContent=this.model.startValue,this._starValue=a=this.model.startValue*this.model.scale,"horizontal"===this.model.orientation?this._hRulerDiff=t-a:this._vRulerDiff=t-a):a>e||a>e||(this.model.startValue=a/this.model.scale,this.model.startValue=this.model.startValue%1!=0?Number(this.model.startValue.toFixed(1)):this.model.startValue,i.label.textContent=this.model.startValue),this._updateTickLabel(i,s),"horizontal"===this.model.orientation?i.segment.setAttribute("transform","translate("+n.trans+" 0)"):i.segment.setAttribute("transform","translate(0 "+n.trans+")"),n.trans+=r,a+r},_updateTickLabel:function(t,i){var a,n;"horizontal"===this.model.orientation?a="rightorbottom"===this.model.tickAlignment?{x:2,y:i/2+5.5-5.5}:{x:2,y:i/2+5.5}:(n=t.segment.lastChild.getBBox(),a="rightorbottom"===this.model.tickAlignment?{x:0,y:n.height,"font-size":"11",transform:"rotate(270)translate("+-(n.width+2)+" "+(i/2-n.height)+")"}:{x:0,y:n.height,"font-size":"11",transform:"rotate(270)translate("+-(n.width+2)+" "+(i/2-n.height/2)+")"}),e.datavisualization.Diagram.Util.attr(t.segment.lastChild,a)},_getNewSegment:function(t,e){var i=this._createNewTicks(t,e);return{segment:i,label:this._createTickLabel(e,i)}},_createNewTicks:function(t,e){for(var i,a,n=this._updateSegmentWidth(this.model.scale),o=e.g({class:"ej-ruler-segment"}),s=0;s<this.model.interval;s++)a=n/this.model.interval,i=this._createTick(e,a,s+1,t),o.appendChild(i);return o},_getLinePoint:function(t,e,i){var a=this._updateSegmentWidth(this.model.scale),n=this._getRulerSize();return(e*=i-1)%a==0?n:.3*n},_createTick:function(i,a,n,o){var s,r,l,d,h,g=this._getLinePoint(i,a,n),c=this._getRulerSize(),u=this.model.arrangeTick;return"string"==typeof u&&(u=e.util.getObject(u,window)),t.isFunction(u)&&(u(r={ruler:void 0,tickLength:g,tickInterval:Number((o+a*(n-1)).toFixed(1))}),g=r.tickLength),"horizontal"===this.model.orientation?(d=a*(n-1),l="rightorbottom"===this.model.tickAlignment?{x1:d,y1:c,x2:d,y2:c-g,"stroke-width":"1"}:{x1:d,y1:c-(c-g),x2:d,y2:0,"stroke-width":"1"},s=i.line(l)):(h=a*(n-1),l="rightorbottom"===this.model.tickAlignment?{x1:c,y1:h,x2:c-g,y2:h,"stroke-width":"1"}:{x1:0,y1:h,x2:c-(c-g),y2:h,"stroke-width":"1"},s=i.line(l)),s.setAttribute("class","ej-ruler-tick"),s},_createTickLabel:function(t,e){if(e){var i=t.text({class:"ej-ruler-tick-label"});e.appendChild(i)}return i},_updateSegmentWidth:function(t){if(100!=this.model.segmentWidth)return this.model.segmentWidth;var e,i=1;for(e=100,e=100/Math.pow(2,Math.round(Math.log(t)/Math.log(2)));e>100;)i/=10,e/=10;for(;e<25;)i*=10,e*=10;return e>=25&&e%25!=0&&(e=25*Math.round(e/25)),e*t/i},_getRulerGeometry:function(){return{width:t(this.element[0]).width(),height:t(this.element[0]).height()}},_getRulerSize:function(){return this.model.thickness},_getRulerSVG:function(t){var i,a,n,o=this._getRulerSize();if(i=document.getElementById(this.element[0].id+"_ruler_space")){if(n=new e.datavisualization.Diagram.Svg({id:this.element[0].id+"_Ruler_svg",width:"horizontal"===this.model.orientation?t.width:o,height:"horizontal"===this.model.orientation?o:t.height,style:"position:inherit;"}),i.childNodes.length>0)for(a=i.childNodes.length-1;a>=0;a--)i.childNodes[a].parentNode.removeChild(i.childNodes[a]);i.appendChild(n.document)}return n},_setModel:function(t){for(var e in t)switch(e){case"offset":case"length":case"interval":case"segmentWidth":case"tickAlignment":case"markerColor":case"thickness":this._updateRuler();break;case"arrangeTick":this._updateRuler(),this.model.arrangeTick=t.arrangeTick}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){}})}(jQuery,Syncfusion),function(t,e){"use strict";e.widget("ejOverview","ej.datavisualization.Overview",{element:null,validTags:["div"],model:null,defaults:{sourceID:"",width:null,height:null},_canvas:null,_actionName:"",_startPoint:null,_currentPoint:null,_prevPoint:null,_helper:null,_viewPortRatio:1,_resizeDirection:"",_inAction:!1,_init:function(){"msie"===e.browserInfo().name&&Number(e.browserInfo().version)<9||(this._wireEvents(),this._renderCanvas(),this._setParent(this.model.sourceID))},_renderCanvas:function(){var e=t("#"+this.element[0].id+"_canvas")[0];e||(e=document.createElement("div"),this.element.append(e)),e.setAttribute("id",this.element[0].id+"_canvas"),e.setAttribute("class","drawing"),e.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";style:-ms-touch-action: none;touch-action: none;"),this.element[0].setAttribute("tabindex","0"),this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width}),this._canvas=e},_renderDocument:function(i){var a,n,o,s;if(i.canvas=this._canvas,window.SVGSVGElement){(n=t("#"+this._canvas.id+"_svg")[0])&&n.parentNode.removeChild(n),a={id:this._canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:i.style,class:"overview_svg"},n=new e.datavisualization.Diagram.Svg(a),this._svg=n,i.svg=n;var r=document.getElementById(this._id),l=t(r).width(),d=t(r).height(),h=r.getBoundingClientRect(),g=window.screenX<0?-1*window.screenX:window.screenX;0===l&&(l=Math.floor(window.innerWidth-g-Math.floor(h.left))),o=window.screenY<0?-1*window.screenY:window.screenY,0===d&&(d=Math.floor(window.innerHeight-o-Math.floor(h.top))),n.document.setAttribute("width",l),n.document.setAttribute("height",d),this.width=l,this.height=d,i.diagramLayer=e.datavisualization.Diagram.SvgContext._renderDiagramLayer(i.canvas,i.svg,i.svg),s=n.defs({id:i.canvas.id+"patterndefinition"}),n.appendChild(s),i.canvas.appendChild(n.document),n._htmlLayer=this._renderHtmlLayer(i.canvas),this._addOverviewRectPanel(i)}},_removeDocument:function(){var t,e=document.getElementById(this._canvas.id+"_svg");this._canvas.removeChild(e),t=document.getElementById(this._canvas.id+"_htmlLayer"),this._canvas.removeChild(t)},_renderHtmlLayer:function(t){var i,a=document.createElement("div"),n={id:t.id+"_htmlLayer",class:"htmlLayer"};return e.datavisualization.Diagram.Util.attr(a,n),i=a,a.style.pointerEvents="none",a.style.position="absolute",a.style.left="0px",a.style.top="0px",t.appendChild(i),i},_setModel:function(t){var e=!1;for(var i in t)switch(i){case"sourceID":this._setParent(t[i]);break;case"width":case"height":e||(this._renderCanvas(),this._setParent(this.model.sourceID)),e=!0}},_setParent:function(e){if(this._parent){var i=t("#"+this._parent._id).ejDiagram("instance");this._parent=null,i._setOverview(null,this._id)}e&&(this.model.sourceID=e,this._parent=t("#"+e).ejDiagram("instance"),this._parent&&this._parent._setOverview(this))},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){var i=t(this._canvas);this._on(i,e.eventType.mouseDown,this._mousedown),this._on(i,e.eventType.mouseMove,this._mousemove),this._on(i,e.eventType.mouseUp,this._mouseup),this._on(i,e.eventType.mouseLeave,this._documentmouseup),this._on(i,"touchstart",this.handleTouchStart),this._on(i,"touchmove",this.handleTouchMove),this._on(i,"touchend",this.handleTouchEnd)},_mouseup:function(t){if(this._currentPoint=this._mouseposition(t),this.width,this.height,this._actionName)if(this._startPoint.x!=this._currentPoint.x||this._startPoint.y!=this._currentPoint.y){if("pan"!=this._actionName&&this._helper){o=this._helper.getBBox(),this._resizeDirection=this._resizeDirection||"";var e=o.x,i=o.y,a=o.width,n=o.height;"topleft"==this._resizeDirection||"topright"==this._resizeDirection||"bottomleft"==this._resizeDirection||this._resizeDirection;this._renderOverviewRect(e,i,a,n)}}else if((t.target.id==this._canvas.id+"overviewbackrect"||"helper"==t.target.id)&&this._startPoint.x==this._currentPoint.x&&this._startPoint.y==this._currentPoint.y){var o;a=(o=document.getElementById(this._canvas.id+"overviewrect").getBBox()).width||100,n=o.height||100/this._viewPortRatio;this.inAction=!0,this._actionName="pan",this._renderOverviewRect(this._currentPoint.x-a/2,this._currentPoint.y-n/2,a,n),this.inAction=!1}this._helper&&(document.getElementById(this._canvas.id+"overviewhandle").removeChild(this._helper),this._helper=null),this._actionName="",this._startPoint=null,this._currentPoint=null,this._prevPoint=null,this._helper=null,this._viewPortRatio=1,this._resizeDirection="",this._inAction=!1},_mousedown:function(t){if("overviewbackrect"==t.target.className.animVal&&(this._actionName="draw"),t.target.id==this._canvas.id+"overviewrect"&&(this._actionName="pan"),"overviewresizer"==t.target.className.animVal)switch(this._actionName="scale",t.target.id){case this._canvas.id+"left":this._resizeDirection="left";break;case this._canvas.id+"right":this._resizeDirection="right";break;case this._canvas.id+"top":this._resizeDirection="top";break;case this._canvas.id+"bottom":this._resizeDirection="bottom";break;case this._canvas.id+"topleft":this._resizeDirection="topleft";break;case this._canvas.id+"topright":this._resizeDirection="topright";break;case this._canvas.id+"bottomleft":this._resizeDirection="bottomleft";break;case this._canvas.id+"bottomright":this._resizeDirection="bottomright"}this._startPoint=this._prevPoint=this._mouseposition(t);var i=e.datavisualization.Diagram.ScrollUtil._viewPort(this._parent);this._viewPortRatio=i.width/i.height},_mouseposition:function(t){var i=this._parent._isTouchEvent(t);i||(i=t);var a=this._canvas.scrollLeft,n=this._canvas.scrollTop,o=this._canvas.getBoundingClientRect(),s=i.clientX+a-o.left,r=n+i.clientY-o.top;return new e.datavisualization.Diagram.Point(s,r)},_updateCursor:function(t){if("overviewresizer"==t.target.className.animVal)switch(t.target.id){case this._canvas.id+"left":this._canvas.style.cursor="w-resize";break;case this._canvas.id+"right":this._canvas.style.cursor="e-resize";break;case this._canvas.id+"top":this._canvas.style.cursor="n-resize";break;case this._canvas.id+"bottom":this._canvas.style.cursor="s-resize";break;case this._canvas.id+"topleft":this._canvas.style.cursor="nw-resize";break;case this._canvas.id+"topright":this._canvas.style.cursor="ne-resize";break;case this._canvas.id+"bottomleft":this._canvas.style.cursor="sw-resize";break;case this._canvas.id+"bottomright":this._canvas.style.cursor="se-resize"}else this._canvas.style.cursor="default"},_mousemove:function(t){if(this._updateCursor(t),this._currentPoint=this._mouseposition(t),this._actionName)switch(this._actionName){case"draw":this._inAction||this._startPoint.x==this._currentPoint.x&&this._startPoint.y!=this._currentPoint.y||(this._initHelper(),this._inAction=!0),this._inAction&&this._updateHelper();break;case"scale":this._inAction||(this._initHelper(),this._inAction=!0),this._updateOverviewRectangle();break;case"pan":(this._startPoint.x!=this._currentPoint.x||this._startPoint.y==this._currentPoint.y||this._inAction)&&(this._inAction=!0,this._translateOverviewRectangle())}this._prevPoint=this._currentPoint},_documentmouseup:function(){(this._inAction=!1,this._actionName="",this._helper)&&(document.getElementById(this._canvas.id+"overviewhandle").removeChild(this._helper),this._helper=null)},_addOverviewRectPanel:function(){var i,a,n,o,s,r=t("#"+this._canvas.id+"_overviewsvg")[0];r&&r.parentNode.removeChild(r),r=new e.datavisualization.Diagram.Svg({id:this._canvas.id+"_overviewsvg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute;left:0px;top:0px",width:this.width,height:this.height}),this._canvas.appendChild(r.document),i=r.g({id:this._id+"_overviewlayer"}),r.appendChild(i),a=r.rect({fill:"transparent",width:"100%",height:"100%",class:"overviewbackrect",id:this._canvas.id+"overviewbackrect"}),i.appendChild(a),n=t(i),this._on(n,e.eventType.mouseDown,this._mousedown),this._on(n,e.eventType.mouseMove,this._mousemove),this._on(n,e.eventType.mouseUp,this._mouseup),this._on(n,e.eventType.mouseLeave,this._documentmouseup),this._on(n,"touchstart",this.handleTouchStart),this._on(n,"touchmove",this.handleTouchMove),this._on(n,"touchend",this.handleTouchEnd),o=r.g({id:this._canvas.id+"overviewhandle"}),i.appendChild(o),s=r.rect({id:this._canvas.id+"overviewrect",fill:"transparent"}),o.appendChild(s),this._renderOverviewCorner("left",o),this._renderOverviewCorner("right",o),this._renderOverviewCorner("top",o),this._renderOverviewCorner("bottom",o),this._renderOverviewCorner("topleft",o),this._renderOverviewCorner("topright",o),this._renderOverviewCorner("bottomleft",o),this._renderOverviewCorner("bottomright",o)},_updateOverview:function(t){var i,a,n,o,s,r,l,d,h;t=t||this._parent._views[this._id],i=(n=this._parent._getDigramBounds()).width,a=n.height;var g=e.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),c=this.width,u=this.height;t.context==e.datavisualization.Diagram.SvgContext?(o=Math.max(i,g.width),s=Math.max(a,g.height),this.contentWidth=o=Math.max(o,c/u*s),this.contentHeight=s=Math.max(s,u/c*o),r=document.getElementById(this._canvas.id+"_diagramLayer"),l=Math.min(c/o,u/s),this.scale=l,r.setAttribute("transform","scale("+l+","+l+"),translate("+-n.x+","+-n.y+")"),(d=document.getElementById(this._canvas.id+"_htmlLayer")).style.webkitTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.MozTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.OTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.msTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.transform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",document.getElementById(this._id+"_overviewlayer").setAttribute("transform","translate("+-n.x*l+","+-n.y*l+")")):(h=t._canvas.document.getContext("2d"),t.scale&&h.scale(1/t.scale.x,1/t.scale.y),t.scale={x:l,y:l},h.scale(l,l),e.datavisualization.Diagram.CanvasContext.refreshCanvas(this._parent.model,t)),this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom)},_updateOverviewRectangle:function(){var t=this._currentPoint.x-this._prevPoint.x,e=this._currentPoint.y-this._prevPoint.y;if("scale"==this._actionName){var i={width:0,height:0},a=0,n=0;switch(this._resizeDirection){case"left":i.width-=t,i.height-=t/this._viewPortRatio,a=t,n=t/this._viewPortRatio/2;break;case"right":i.width+=t,i.height+=t/this._viewPortRatio,n=t/this._viewPortRatio/-2;break;case"top":i.height-=e,i.width-=e*this._viewPortRatio,n=e,a=e*this._viewPortRatio/2;break;case"bottom":i.height+=e,i.width+=e*this._viewPortRatio,a=e*this._viewPortRatio/-2;break;case"topleft":Math.abs(e)>Math.abs(t)?t=e*this._viewPortRatio:e=t/this._viewPortRatio,i.width-=t,i.height-=e,a=t,n=e;break;case"topright":Math.abs(e)>Math.abs(t)?t=-e*this._viewPortRatio:e=-t/this._viewPortRatio,n=e,i.width+=t,i.height-=e;break;case"bottomleft":Math.abs(e)>Math.abs(t)?t=-e*this._viewPortRatio:e=-t/this._viewPortRatio,a=t,i.width-=t,i.height+=e;break;case"bottomright":Math.abs(e)>Math.abs(t)?t=e*this._viewPortRatio:e=t/this._viewPortRatio,i.width+=t,i.height+=e}this._updateHelper(a,n,i,void 0,void 0)}},_initHelper:function(){var t,e;if(!this._helper){var i=this._svg,a=document.getElementById(this._canvas.id+"overviewhandle"),n=(this._parent._currZoom,this._startPoint.x),o=this._startPoint.y,s=1,r=1;"scale"==this._actionName&&(n=(t=document.getElementById(this._canvas.id+"overviewrect").getBBox()).x,o=t.y,s=t.width,r=t.height),e=i.rect({id:"helper",x:n,y:o,width:s,height:r,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),a.appendChild(e),this._helper=e}},_updateHelper:function(t,i,a){if(a)var n=(l=this._helper.getBBox()).x+t,o=l.y+i,s=l.width+a.width,r=l.height+a.height;else{t=this._currentPoint.x>this._startPoint.x?this._currentPoint.x-this._prevPoint.x:this._prevPoint.x-this._currentPoint.x,i=this._currentPoint.y>this._startPoint.y?this._currentPoint.y-this._prevPoint.y:this._prevPoint.y-this._currentPoint.y,Math.abs(i)>Math.abs(t)?(t=this._viewPortRatio*i,!0,!1):(i=t/this._viewPortRatio,!0,!1);var l=this._helper.getBBox();n=this._startPoint.x>this._currentPoint.x?l.x-t:l.x,o=this._startPoint.y>this._currentPoint.y?l.y-i:l.y,s=l.width+t,r=l.height+i}this._helper&&e.datavisualization.Diagram.Util.attr(this._helper,{id:this._helper.id,x:n,y:o,width:s<0?0:s,height:r<0?0:r})},_renderOverviewCorner:function(t,e){var i,a,n=this._svg;"top"==t||"bottom"==t||"right"==t||"left"==t?(i=n.rect({id:this._canvas.id+"visible"+t}),e.appendChild(i),a=n.rect({id:this._canvas.id+t,class:"overviewresizer",fill:"transparent"}),e.appendChild(a)):(i=n.circle({id:this._canvas.id+"visible"+t}),e.appendChild(i),a=n.circle({id:this._canvas.id+t,class:"overviewresizer",fill:"transparent"}),e.appendChild(a))},_updateOverviewrect:function(t,i,a,n){if(a&&n){var o=document.getElementById(this._canvas.id+"overviewrect"),s={x:t,y:i,width:Math.max(1,a),height:Math.max(1,n)};e.datavisualization.Diagram.Util.attr(o,s),this._updateOverviewCorner("top",t+8,i-2,Math.max(0,a-16),2),this._updateOverviewCorner("bottom",t+8,i+n,Math.max(0,a-16),2),this._updateOverviewCorner("left",t-2,i+8,2,Math.max(0,n-16)),this._updateOverviewCorner("right",t+a,i+8,2,Math.max(0,n-16)),this._updateOverviewCorner("topleft",t,i,5,5),this._updateOverviewCorner("topright",t+a,i,5,5),this._updateOverviewCorner("bottomleft",t,i+n,5,5),this._updateOverviewCorner("bottomright",t+a,i+n,5,5)}},_scrollOverviewRect:function(t,i,a,n){if(!this._actionName||n){var o=this.width,s=this.height,r=Math.min(this.contentWidth/o,this.contentHeight/s),l={},d=l.x=t/a/r,h=l.y=i/a/r,g=e.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),c=l.width=g.width/a/r,u=l.height=g.height/a/r;g.width,g.height;if(n)return{x:d,y:h,width:c,height:u};this._updateOverviewrect(d,h,c,u)}},_updateOverviewCorner:function(t,i,a,n,o){var s,r,l,d="visible"+t,h=document.getElementById(this._canvas.id+d);"top"==t||"bottom"==t||"right"==t||"left"==t?(s={x:i,y:a,width:n,height:o,fill:"#ED1C24"},r={x:i-2,y:a-2,width:2==n?4:n,height:2==o?4:o}):(s={cx:i,cy:a,r:4,fill:"#ED1C24"},r={cx:i,cy:a,r:6,fill:"transparent"}),e.datavisualization.Diagram.Util.attr(h,s),l=document.getElementById(this._canvas.id+t),e.datavisualization.Diagram.Util.attr(l,r)},_translateOverviewRectangle:function(){var t=this.width,i=this.height,a=this._currentPoint.x-this._prevPoint.x,n=this._currentPoint.y-this._prevPoint.y,o=e.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),s=(Math.min(o.width/t,o.height/i),document.getElementById(this._canvas.id+"overviewrect").getBBox()),r=s.x+a,l=s.y+n,d=s.width,h=s.height;this._updateOverviewrect(r,l,d,h),this._updateView(this._parent._currZoom,r,l,d,h,null)},_updateView:function(i,a,n,o,s,r){var l,d,h=this.width,g=this.height,c=a*(this.contentWidth/h)*i,u=n*(this.contentHeight/g)*i,m=this._parent._getDigramBounds();if(1!=i||"pan"==this._actionName){var p=t("#"+this._parent._canvas.id+"_hScrollbar").ejScrollBar("instance").model,f=-c+p.maximum,_=-c+this._parent._hScrollOffset,v=-u+this._parent._vScrollOffset;m.width*i<f&&(d=m.width*i-f,Math.abs(d)<Math.abs(_)&&(_-=d)),l=-u+(p=t("#"+this._parent._canvas.id+"_vScrollbar").ejScrollBar("instance").model).maximum,m.height*i<l&&(d=m.height*i-l,Math.abs(d)<Math.abs(v)&&(v-=d))}e.datavisualization.Diagram.ZoomUtil.zoomPan(this._parent,i/this._parent._currZoom,_,v,r,!1)},_renderOverviewRect:function(t,i,a,n){var o,s=this.width,r=this.height,l=e.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),d=a/s*this.contentWidth,h=n/r*this.contentHeight,g=Math.max(l.width/d,l.height/h);g>=.25&&g<=30&&(this._updateView(g,t,i,a,n,new e.datavisualization.Diagram.Point(0,0)),o=this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom,!0),this._updateOverviewrect(o.x,o.y,o.width,o.height))},handleTouchStart:function(t){t.preventDefault()},handleTouchMove:function(t){t.preventDefault()},handleTouchEnd:function(t){t.preventDefault()},handleTouchLeave:function(t){t.preventDefault()}})}(jQuery,Syncfusion),function(t,e){"use strict";var i=function(){function i(t){return this.document=document.createElement("canvas"),this.id=t.id,this._scaleX=1,this._scaleY=1,t&&e.datavisualization.Diagram.Util.attr(this.document,t),this}return i.prototype.rect=function(t,e,i,a,n,o){var s=this.document.getContext("2d");s.beginPath(),n&&n.angle&&this.rotateContext(n,s),o&&(this.setStyle(o,s),o.dashArray&&this.dashedRectangle(t,e,i,a,o.dashArray)),s.fillRect(t,e,i,a),s.strokeRect(t,e,i,a),s.closePath(),n&&n.angle&&s.restore()},i.prototype.roundedRect=function(t,e,i,a,n,o,s){var r,l=this.document.getContext("2d");l.beginPath(),o&&o.angle&&this.rotateContext(o,l);var d,h,g=[{x:t+n,y:e},{x:t+i-n,y:e},{x:t+i,y:e+n},{x:t+i,y:e+a-n},{x:t+i-n,y:e+a},{x:t+n,y:e+a},{x:t,y:e+a-n},{x:t,y:e+n}],c=[{x:t+i,y:e},{x:t+i,y:e+a},{x:t,y:e+a},{x:t,y:e}],u=0;for(s&&this.setStyle(s,l),l.moveTo(g[0].x,g[0].y),r=0;r<g.length;r+=2)d=g[r+1],l.lineTo(d.x,d.y),h=g[r+2]||g[0],l.quadraticCurveTo(c[u].x,c[u].y,h.x,h.y),u++;if(l.fill(),s&&s.dashArray)for(u=0,r=0;r<g.length;r+=2)this.dashedLine(g[r].x,g[r].y,g[r+1].x,g[r+1].y,s.dashArray),this.quadraticCurve(g[r+1],c[u],g[r+2]||g[0],s),u++;l.stroke(),l.closePath(),o&&o.angle&&l.restore()},i.prototype.ellipse=function(t,i,a,n,o,s){var r,l=this.document.getContext("2d");s&&this.setStyle(s,l),r=(Math.sqrt(2)-1)/3*4,l.beginPath(),o&&o.angle&&this.rotateContext(o,l),l.moveTo(t,i-n),l.bezierCurveTo(t+r*a,i-n,t+a,i-r*n,t+a,i),l.bezierCurveTo(t+a,i+r*n,t+r*a,i+n,t,i+n),l.bezierCurveTo(t-r*a,i+n,t-a,i+r*n,t-a,i),l.bezierCurveTo(t-a,i-r*n,t-r*a,i-n,t,i-n),l.fill(),s&&s.dashArray&&(this.bezierCurve(e.datavisualization.Diagram.Point(t,i-n),new e.datavisualization.Diagram.Point(t+r*a,i-n),new e.datavisualization.Diagram.Point(t+a,i-r*n),new e.datavisualization.Diagram.Point(t+a,i),s),this.bezierCurve(e.datavisualization.Diagram.Point(t+a,i),new e.datavisualization.Diagram.Point(t+a,i+r*n),new e.datavisualization.Diagram.Point(t+r*a,i+n),new e.datavisualization.Diagram.Point(t,i+n),s),this.bezierCurve(e.datavisualization.Diagram.Point(t,i+n),new e.datavisualization.Diagram.Point(t-r*a,i+n),new e.datavisualization.Diagram.Point(t-a,i+r*n),new e.datavisualization.Diagram.Point(t-a,i),s),this.bezierCurve(e.datavisualization.Diagram.Point(t-a,i),new e.datavisualization.Diagram.Point(t-a,i-r*n),new e.datavisualization.Diagram.Point(t-r*a,i-n),new e.datavisualization.Diagram.Point(t,i-n),s)),l.stroke(),l.closePath(),o&&o.angle&&l.restore()},i.prototype.circle=function(t,e,i,a,n){var o=this.document.getContext("2d");n&&this.setStyle(n,o),a&&a.angle&&this.rotateContext(a,o),n&&n.dashArray?(o.beginPath(),o.arc(t,e,i,0,2*Math.PI),o.fill(),o.stroke(),o.closePath()):this.ellipse(t,e,2*i,2*i,a,n),a&&a.angle&&o.restore()},i.prototype.arc=function(t,e,i,a,n,o){var s,r,l={angle:a,x:t,y:e},d=this.document.getContext("2d");o&&this.setStyle(o,d),l&&l.angle&&this.rotateContext(l,d),d.beginPath(),s=0,r=Math.PI,n||(s=Math.PI,r=0),o&&o.dashArray,d.arc(t,e,i,s,r),d.stroke(),d.closePath(),l&&l.angle&&d.restore()},i.prototype.path=function(t,i,a,n,o,s,r){var l,d,h,g,c,u,m=this.document.getContext("2d");r&&this.setStyle(r,m),m.beginPath(),l=i,d=a,m.translate(l,d),s&&s.angle&&this.rotateContext(s,m),(h=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",t),this.document.appendChild(h);for(var p,f,_,v,y,b,x=this.getSegments(h),D=(i=0,a=0,0),C=x.length;D<C;++D){switch(c=(g=x[D]).command,"x1"in g&&(_=g.x1),"x2"in g&&(y=g.x2),"y1"in g&&(v=g.y1),"y2"in g&&(b=g.y2),"x"in g&&(i=g.x),"y"in g&&(a=g.y),c){case"M":m.moveTo(i,a),g.x=i,g.y=a;break;case"L":m.lineTo(i,a),g.x=i,g.y=a;break;case"C":m.bezierCurveTo(_,v,y,b,i,a),g.x=i,g.y=a,g.x1=_,g.y1=v,g.x2=y,g.y2=b;break;case"Q":m.quadraticCurveTo(_,v,i,a),g.x=i,g.y=a,g.x1=_,g.y1=v;break;case"A":var z=new e.datavisualization.Diagram.Point(p,f),S=g.r1,P=g.r2,w=g.angle*(Math.PI/180),T=g.largeArcFlag,j=g.sweepFlag,E=new e.datavisualization.Diagram.Point(i,a),N=new e.datavisualization.Diagram.Point(Math.cos(w)*(z.x-E.x)/2+Math.sin(w)*(z.y-E.y)/2,-Math.sin(w)*(z.x-E.x)/2+Math.cos(w)*(z.y-E.y)/2),L=Math.pow(N.x,2)/Math.pow(S,2)+Math.pow(N.y,2)/Math.pow(P,2);L>1&&(S*=Math.sqrt(L),P*=Math.sqrt(L)),u=(T==j?-1:1)*Math.sqrt((Math.pow(S,2)*Math.pow(P,2)-Math.pow(S,2)*Math.pow(N.y,2)-Math.pow(P,2)*Math.pow(N.x,2))/(Math.pow(S,2)*Math.pow(N.y,2)+Math.pow(P,2)*Math.pow(N.x,2))),isNaN(u)&&(u=0);var I=new e.datavisualization.Diagram.Point(u*S*N.y/P,u*-P*N.x/S),O=new e.datavisualization.Diagram.Point((z.x+E.x)/2+Math.cos(w)*I.x-Math.sin(w)*I.y,(z.y+E.y)/2+Math.sin(w)*I.x+Math.cos(w)*I.y),M=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},A=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(M(t)*M(e))},k=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(A(t,e))},R=k([1,0],[(N.x-I.x)/S,(N.y-I.y)/P]),U=[(N.x-I.x)/S,(N.y-I.y)/P],B=[(-N.x-I.x)/S,(-N.y-I.y)/P],H=k(U,B);A(U,B)<=-1&&(H=Math.PI),A(U,B)>=1&&(H=0);var G=R+(1-j?1:-1)*(H/2);new e.datavisualization.Diagram.Point(O.x+S*Math.cos(G),O.y+P*Math.sin(G));if(g.centp=O,g.xAxisRotation=w,g.rx=S,g.ry=P,g.a1=R,g.ad=H,g.sweepFlag=j,null!=m){A=S>P?S:P;var V=S>P?1:S/P,F=S>P?P/S:1;m.save(),m.translate(O.x,O.y),m.rotate(w),m.scale(V,F),m.arc(0,0,A,R,R+H,1-j),m.scale(1/V,1/F),m.rotate(-w),m.translate(-O.x,-O.y),m.restore()}break;case"Z":case"z":m.closePath(),i=p,a=f}p=i,f=a}m.fill(),r&&r.dashArray?this.drawDashedPath(x,r):m.stroke(),m.translate(-d,-d),s&&s.angle&&m.restore()},i.prototype.getSegments=function(i){for(var a,n,o,s,r,l,d,h,g,c,u,m,p,f,_=e.datavisualization.Diagram.Util.convertPathToArray(i.getAttribute("d")),v=[],y=0,b=0,x=0,D=_.length;x<D;++x){switch(n=(a=_[x]).pathSegTypeAsLetter,"x1"in a&&(g=a.x1),"x2"in a&&(u=a.x2),"y1"in a&&(c=a.y1),"y2"in a&&(m=a.y2),"x"in a&&(y=a.x),"y"in a&&(b=a.y),n){case"M":v.push({command:"M",x:y,y:b});break;case"L":v.push({command:"L",x0:d,y0:h,x:y,y:b});break;case"H":v.push({command:"L",x0:d,y0:h,x:y,y:h});break;case"V":v.push({command:"L",x0:d,y0:h,x:d,y:b});break;case"C":v.push({command:"C",x0:d,y0:h,x1:g,y1:c,x2:u,y2:m,x:y,y:b});break;case"S":l&&(o="C"==l.command||"S"==l.command?{x:l.x2,y:l.y2}:{x:l.x0,y:l.y0},s=new e.datavisualization.Diagram.Point(2*d-o.x,2*h-o.y),v.push({command:"C",x0:d,y0:h,x1:s.x,y1:s.y,x2:u,y2:m,x:y,y:b}));break;case"Q":v.push({command:"Q",x0:d,y0:h,x1:g,y1:c,x:y,y:b});break;case"T":l&&(o="Q"==l.command?{x:l.x1,y:l.y1}:{x:l.x0,y:l.y0},s=new e.datavisualization.Diagram.Point(2*d-o.x,2*h-o.y),v.push({command:"Q",x0:d,y0:h,x1:s.x,y1:s.y,x:y,y:b}));break;case"A":(r=t.extend(!0,{},a)).command="A",v.push(r);break;case"Z":case"z":v.push({command:"L",x0:y,y0:b,x:p,y:f}),y=d,b=h}l=v[v.length-1],("M"===n||"m"===n)&&(p=y,f=b),d=y,h=b}return v},i.prototype.drawDashedPath=function(t,i){for(var a,n,o,s,r,l,d,h,g,c,u=0,m=0,p=0,f=t.length;p<f;++p){switch(n=(a=t[p]).command,"x1"in a&&(s=a.x1),"x2"in a&&(l=a.x2),"y1"in a&&(r=a.y1),"y2"in a&&(d=a.y2),"x"in a&&(u=a.x),"y"in a&&(m=a.y),n){case"M":c={x:u,y:m};break;case"L":this.dashedLine(h,g,u,m,i.dashArray);break;case"H":this.dashedLine(h,g,u,g,i.dashArray);break;case"V":this.dashedLine(h,g,h,m,i.dashArray);break;case"C":this.bezierCurve(e.datavisualization.Diagram.Point(h,g),e.datavisualization.Diagram.Point(s,r),e.datavisualization.Diagram.Point(l,d),e.datavisualization.Diagram.Point(u,m),i);break;case"Q":this.quadraticCurve(e.datavisualization.Diagram.Point(h,g),e.datavisualization.Diagram.Point(s,r),e.datavisualization.Diagram.Point(u,m),i);break;case"A":if(null!=(o=this.document.getContext("2d"))){var _=a.rx>a.ry?a.rx:a.ry,v=a.rx>a.ry?1:a.rx/a.ry,y=a.rx>a.ry?a.ry/a.rx:1;o.save(),o.translate(a.centp.x,a.centp.y),o.rotate(a.xAxisRotation),o.scale(v,y),this.dashedArc(_,0,0,a.a1,a.a1+a.ad,1-a.sweepFlag,i.dashArray),o.scale(1/v,1/y),o.rotate(-a.xAxisRotation),o.translate(-a.centp.x,-a.centp.y),o.restore()}break;case"Z":case"z":this.dashedLine(u,m,c.x,c.y,i.dashArray),u=h,m=g}h=u,g=m}},i.prototype.calculateCirclePoints=function(t,i,a,n,o,s){var r,l,d,h;for(n=180*n/Math.PI,o=180*o/Math.PI,r=2*Math.PI*t*(Math.abs(n-o)/360)*.7,l=Math.abs(n-o)/r,l=s?-1*l:l,d=0,h=[];d<r;)h.push(e.datavisualization.Diagram.Geometry.transform({x:i,y:a},n+l*d,t)),d++;return h},i.prototype.polygon=function(t,e,i){var a,n=this.document.getContext("2d");for(n.beginPath(),e&&e.angle&&this.rotateContext(e,n),i&&this.setStyle(i,n),n.moveTo(t[0].x,t[0].y),a=1;a<t.length;a++)n.lineTo(t[a].x,t[a].y);if(n.lineTo(t[0].x,t[0].y),n.fill(),i&&i.dashArray){for(a=1;a<t.length;a++)this.line(t[a-1],t[a],i);this.line(t[a-1],t[0],i)}n.stroke(),n.closePath(),e&&e.angle&&n.restore()},i.prototype.image=function(t,e,i,a,n,o,s,r){var l,d,h,g,c=this.document.getContext("2d");if(c.beginPath(),o&&o.angle&&this.rotateContext(o,c),s&&this.setStyle(s,c),a&&n){var u=t.width,m=t.height,p=a,f=n;if(r&&"none"!==r.alignment)if(l=r.alignment.substr(1,3),d=r.alignment.substr(5,3),"slice"===r.scale){h=function(){C=p,z=m*p/u},g=function(){C=u*f/m,z=f},p>f?(h(),f>z&&g()):p===f?u>m?g():h():(g(),p>C&&h());var _=this.getSliceOffset(l,C,p,u),v=this.getSliceOffset(d,z,f,m),y={sx:_,sy:v,swidth:u-_,sheight:m-v,dx:0,dy:0,dwidth:C-_*(C/u),dheight:z-v*(z/m)},b=document.createElement("canvas");b.setAttribute("width",a),b.setAttribute("height",n),b.getContext("2d").drawImage(t,y.sx,y.sy,y.swidth,y.sheight,y.dx,y.dy,y.dwidth,y.dheight),c.drawImage(b,e,i,a,n)}else if("meet"===r.scale){var x=m/u,D=f/p,C=D>x?p:f/x,z=D>x?p*x:f;e+=this.getMeetOffset(l,C,p),i+=this.getMeetOffset(d,z,f),c.drawImage(t,0,0,u,m,e,i,C,z)}else c.drawImage(t,e,i,a,n);else c.drawImage(t,e,i,a,n)}else c.drawImage(t,e,i);c.closePath(),o&&o.angle&&c.restore()},i.prototype.getSliceOffset=function(t,e,i,a){switch(t){case"min":return 0;case"mid":return(e-i)/2*a/e;case"max":return(e-i)*a/e;default:return"invalid"}},i.prototype.getMeetOffset=function(t,e,i){var a=Math.max(e,i),n=Math.min(e,i);switch(t){case"min":return 0;case"mid":return(a-n)/2;case"max":return a-n;default:return"invalid"}},i.prototype.text=function(t,e,i,a,n){var o=this.document.getContext("2d");o.beginPath(),a&&a.angle&&this.rotateContext(a,o),n&&this.setStyle(n,o),o.fillText(t.text,e,i),o.closePath(),a&&a.angle&&o.restore()},i.prototype.line=function(t,e,i,a,n){var o=this.document.getContext("2d");a||(o.beginPath(),i&&this.setStyle(i,o)),i&&i.dashArray?this.dashedLine(t.x,t.y,e.x,e.y,i.dashArray):(a||o.moveTo(t.x,t.y),o.lineTo(e.x,e.y),o.stroke()),n||o.closePath()},i.prototype.polyline=function(t,e){var i,a=this.document.getContext("2d");for(a.beginPath(),e&&this.setStyle(e,a),i=1;i<t.length;i++)this.line(t[i-1],t[i],e);a.stroke()},i.prototype.bezierCurve=function(t,e,i,a,n){var o,s,r,l,d=this.document.getContext("2d");if(d.beginPath(),d.moveTo(t.x,t.y),n&&this.setStyle(n,d),n&&n.dashArray){for(o=[],this.flattenCubicBezier(o,t,e,i,a),s=0,r=0;r<n.dashArray.length;r++)s+=Number(n.dashArray[r]);var h=o.length/s,g=!0,c=0;for(r=0;r<h;r++)for(l=0;l<n.dashArray.length;l++)(c+=Number(n.dashArray[l]))<o.length&&(g?d.lineTo(o[c].x,o[c].y):d.moveTo(o[c].x,o[c].y)),g=!g}else d.moveTo(t.x,t.y),d.bezierCurveTo(e.x,e.y,i.x,i.y,a.x,a.y);d.stroke()},i.prototype.quadraticCurve=function(t,e,i,a){var n,o,s,r,l=this.document.getContext("2d");if(l.beginPath(),l.moveTo(t.x,t.y),a&&this.setStyle(a,l),a&&a.dashArray){for(n=[],this.flattenQuadraticBezier(n,t,e,i),o=0,s=0;s<a.dashArray.length;s++)o+=Number(a.dashArray[s]);var d=n.length/o,h=!0,g=0;for(s=0;s<d;s++)for(r=0;r<a.dashArray.length;r++)(g+=Number(a.dashArray[r]))<n.length&&(h?l.lineTo(n[g].x,n[g].y):l.moveTo(n[g].x,n[g].y)),h=!h}else l.moveTo(t.x,t.y),l.quadraticCurveTo(e.x,e.y,i.x,i.y);l.stroke()},i.prototype.arrow=function(t,e,i,a,n){var o=this.document.getContext("2d");o.beginPath(),n&&this.setStyle(n,o),e&&e.angle&&this.rotateContext(e,o),o.moveTo(t.x+i.width,t.y+i.height/2),o.lineTo(t.x,t.y),o.lineTo(t.x+i.width,t.y-i.height/2),a||(o.closePath(),o.fill()),o.stroke(),e&&e.angle&&o.restore()},i.prototype.diamond=function(t,e,i,a){var n=this.document.getContext("2d");n.beginPath(),a&&this.setStyle(a,n),e&&e.angle&&this.rotateContext(e,n),n.moveTo(t.x+i.width,t.y),n.lineTo(t.x+i.width/2,t.y+i.height/2),n.lineTo(t.x,t.y),n.lineTo(t.x+i.width/2,t.y-i.height/2),n.lineTo(t.x+i.width,t.y),n.stroke(),n.fill(),n.closePath(),e&&e.angle&&n.restore()},i.prototype.dashedLine=function(t,e,i,a,n){var o=this.document.getContext("2d");o.save();var s=i-t,r=a-e,l=Math.sqrt(s*s+r*r),d=Math.atan2(r,s);o.beginPath(),o.translate(t,e),o.moveTo(0,0),o.rotate(d);for(var h=n.length,g=0,c=!0,u=0;l>u;)(u+=Number(n[g++%h]))>l&&(u=l),c?o.lineTo(u,0):o.moveTo(u,0),c=!c,o.stroke();o.restore()},i.prototype.dashedRectangle=function(t,e,i,a,n){this.dashedLine(t,e,t+i,e,n),this.dashedLine(t+i,e,t+i,e+a,n),this.dashedLine(t+i,e+a,t,e+a,n),this.dashedLine(t,e+a,t,e,n)},i.prototype.dashedArc=function(t,e,i,a,n,o,s){for(var r,l,d,h=0,g=0;g<s.length;g++)h+=Number(s[g]);r=this.calculateCirclePoints(t,e,i,a,n,o,h),(l=this.document.getContext("2d")).beginPath();var c=r.length/h,u=!0,m=0;for(g=0;g<c;g++)for(d=0;d<s.length;d++)(m+=Number(s[d]))<r.length&&(u?(l.lineTo(r[m].x,r[m].y),l.stroke()):l.moveTo(r[m].x,r[m].y)),u=!u;l.closePath()},i.prototype.absolutePath=function(t){for(var a,n,o,s,r,l,d,h,g,c=e.datavisualization.Diagram.Util.convertPathToArray(t.getAttribute("d")),u=0,m=0,p=0,f=c.length;p<f;++p){if(n=(a=c[p]).pathSegTypeAsLetter,/[MLHVCSQTA]/.test(n))"x"in a&&(u=a.x),"y"in a&&(m=a.y);else{switch("x1"in a&&(l=u+a.x1),"x2"in a&&(h=u+a.x2),"y1"in a&&(d=m+a.y1),"y2"in a&&(g=m+a.y2),"x"in a&&(u+=a.x),"y"in a&&(m+=a.y),n){case"m":o={pathSegTypeAsLetter:"M",x:u,y:m};break;case"l":o={pathSegTypeAsLetter:"L",x:u,y:m};break;case"h":o={pathSegTypeAsLetter:"H",x:u};break;case"v":o={pathSegTypeAsLetter:"V",y:m};break;case"c":o={pathSegTypeAsLetter:"C",x:u,y:m,x1:l,y1:d,x2:h,y2:g};break;case"s":o={pathSegTypeAsLetter:"S",x:u,y:m,x2:h,y2:g};break;case"q":o={pathSegTypeAsLetter:"Q",x:u,y:m,x1:l,y1:d};break;case"t":o={pathSegTypeAsLetter:"T",x:u,y:m};break;case"a":o={pathSegTypeAsLetter:"A",x:u,y:m,r1:r1,r2:r2,angle:angle,largeArcFlag:largeArcFlag,sweepFlag:sweepFlag};break;case"z":case"Z":u=s,m=r,o=c[p]}o&&(c[p]=o)}("M"===n||"m"===n)&&(s=u,r=m)}return t.setAttribute("d",e.datavisualization.Diagram.Util.pathSegArrayAsString(c)),i.prototype._scalePathData=function(t,e,i,a){return t!==i?t=a!==i?t*e-(Number(i)*e-Number(i))+(a-Number(i)):Number(t)*e-(Number(i)*e-Number(i)):a!==i&&(t=a),t},t},i.prototype.setStyle=function(t,e){t.fill&&(e.fillStyle=t.fill),t.stroke&&(e.strokeStyle="none"==t.stroke?"transparent":t.stroke),t.font&&(e.font=t.font),t.lineWidth&&(e.lineWidth=t.lineWidth)},i.prototype.rotateContext=function(t,e){e.save(),e.translate(t.x,t.y),e.rotate(t.angle*Math.PI/180),e.translate(-t.x,-t.y)},i.prototype.pathBounds=function(t){for(var i,a,n,o,s,r,l,d,h,g,c,u,m,p=0,f=0,_=0,v=t.length;_<v;++_)switch(a=(i=t[_]).command,0==_&&i.x&&i.y&&(g=u=i.x,c=m=i.y),"x1"in i&&(o=i.x1),"x2"in i&&(r=i.x2),"y1"in i&&(s=i.y1),"y2"in i&&(l=i.y2),"x"in i&&(p=i.x),"y"in i&&(f=i.y),a){case"M":d=p,h=f;case"L":case"H":case"V":p&&(g=Math.min(p,g),u=Math.max(p,u)),f&&(c=Math.min(f,c),m=Math.max(f,m));break;case"C":case"S":n=this.getBezierBounds(e.datavisualization.Diagram.Point(d,h),e.datavisualization.Diagram.Point(o,s),e.datavisualization.Diagram.Point(r,l),e.datavisualization.Diagram.Point(p,f)),g=Math.min(n.x,g),u=Math.max(n.x+n.width,u),c=Math.min(n.y,c),m=Math.max(n.y+n.height,m);break;case"Q":case"q":case"T":n=this.getQuadraticBounds(e.datavisualization.Diagram.Point(d,h),e.datavisualization.Diagram.Point(o,s),e.datavisualization.Diagram.Point(p,f)),g=Math.min(n.x,g),u=Math.max(n.x+n.width,u),c=Math.min(n.y,c),m=Math.max(n.y+n.height,m);break;case"Z":case"z":p=d,f=h}return{x:g,y:c,width:u-g,height:m-c}},i.prototype.flattenCubicBezier=function(t,i,a,n,o,s){for(var r=Number((e.datavisualization.Diagram.Geometry.distance(a,i)+e.datavisualization.Diagram.Geometry.distance(n,a)+e.datavisualization.Diagram.Geometry.distance(o,n))/1.5),l=0;l<=r;l++){var d=l/r,h=(1-d)*(1-d)*(1-d)*i.x+3*d*(1-d)*(1-d)*a.x+3*d*d*(1-d)*n.x+d*d*d*o.x,g=(1-d)*(1-d)*(1-d)*i.y+3*d*(1-d)*(1-d)*a.y+3*d*d*(1-d)*n.y+d*d*d*o.y;t.push(new e.datavisualization.Diagram.Point(h,g))}},i.prototype.flattenQuadraticBezier=function(t,i,a,n,o){for(var s=Number((e.datavisualization.Diagram.Geometry.distance(a,i)+e.datavisualization.Diagram.Geometry.distance(n,a))/1.5),r=0;r<=s;r++){var l=r/s,d=(1-l)*(1-l)*i.x+2*l*(1-l)*a.x+l*l*n.x,h=(1-l)*(1-l)*i.y+2*l*(1-l)*a.y+l*l*n.y;t.push(new e.datavisualization.Diagram.Point(d,h))}},i.prototype.getBezierBounds=function(t,i,a,n,o){for(var s,r,l,d,h=Number((e.datavisualization.Diagram.Geometry.distance(i,t)+e.datavisualization.Diagram.Geometry.distance(a,i)+e.datavisualization.Diagram.Geometry.distance(n,a))/3),g=0;g<=h;g++){var c=g/h,u=(1-c)*(1-c)*(1-c)*t.x+3*c*(1-c)*(1-c)*i.x+3*c*c*(1-c)*a.x+c*c*c*n.x,m=(1-c)*(1-c)*(1-c)*t.y+3*c*(1-c)*(1-c)*i.y+3*c*c*(1-c)*a.y+c*c*c*n.y;0==g?(s=l=u,r=d=m):(s=Math.min(u,s),r=Math.min(m,r),l=Math.max(u,l),d=Math.max(m,d))}return{x:s,y:r,width:l-s,height:d-r}},i.prototype.getQuadraticBounds=function(t,i,a,n){for(var o,s,r,l,d=Number((e.datavisualization.Diagram.Geometry.distance(i,t)+e.datavisualization.Diagram.Geometry.distance(a,i))/3),h=0;h<=d;h++){var g=h/d,c=(1-g)*(1-g)*t.x+2*g*(1-g)*i.x+g*g*a.x,u=(1-g)*(1-g)*t.y+2*g*(1-g)*i.y+g*g*a.y;0==h?(o=r=c,s=l=u):(o=Math.min(c,o),s=Math.min(u,s),r=Math.max(c,r),l=Math.max(u,l))}return{x:o,y:s,width:r-o,height:l-s}},i}();e.datavisualization.Diagram.Canvas=i,e.datavisualization.Diagram.CanvasContext={_renderDocument:function(t,i){var a={id:t.canvas.id+"_canvas",width:i._canvas.clientWidth,height:i._canvas.clientHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:t.style,"pointer-events":"none"};t._canvas=new e.datavisualization.Diagram.Canvas(a),i._view=t.canvas,t.canvas.appendChild(t._canvas.document),"mainview"==t.type&&(this._canvas=t.canvas,i._svg=this._svg=t._canvas)},_renderGroupBackground:function(t,i,a){var n,o,s,r,l,d;t.pivot||(t.pivot={},t.pivot.x=.5,t.pivot.y=.5),n=i.document.getContext("2d"),t.visible&&(o={angle:t.rotateAngle,x:t.offsetX*i._scaleX,y:t.offsetY*i._scaleY},n.save(),n.translate(o.x,o.y),n.rotate(o.angle*Math.PI/180),n.translate(-o.x,-o.y),n.fillStyle="bpmn"!=t.type?t.fillColor:"transparent",n.strokeStyle="bpmn"!=t.type?t.borderColor:"transparent",n.lineWidth=t.borderWidth,t.borderDashArray&&(-1!=t.borderDashArray.indexOf("[")||t.borderDashArray instanceof Array?s=t.borderDashArray:-1!=t.borderDashArray.indexOf(",")?s=t.borderDashArray.split(","):-1!=t.borderDashArray.indexOf(" ")&&(s=t.borderDashArray.split(" ")),n.setLineDash?n.setLineDash(s):n.mozDash?n.mozDash=s:r={dashArray:s})),l=t.offsetX*i._scaleX-t.width*i._scaleX*t.pivot.x,d=t.offsetY*i._scaleY-t.height*i._scaleY*t.pivot.y,e.datavisualization.Diagram.Util.canCrispEdges(t,a)&&(l=Math.floor(l)+.5,d=Math.floor(d)+.5),i.rect(l,d,t.width*i._scaleX,t.height*i._scaleY,null,r),n.restore()},renderGroup:function(t,e,i){var a,n,o,s,r,l,d,h,g;if(t.visible){for(a=e.document.getContext("2d"),n={angle:t.rotateAngle,x:t.offsetX*e._scaleX,y:t.offsetY*e._scaleY},a.save(),this._renderGroupBackground(t,e,i),o=0;o<t.children.length;o++)(s=i.nameTable[i._getChild(t.children[o])])&&("group"===s._type?this.renderGroup(s,e,i):"node"===s._type?this.renderNode(s,e):s.segments&&this.renderConnector(s,e));if(a.translate(n.x,n.y),a.rotate(n.angle*Math.PI/180),a.translate(-n.x,-n.y),r=t.offsetX*e._scaleX-t.width*e._scaleX*t.pivot.x,l=t.offsetY*e._scaleY-t.height*e._scaleY*t.pivot.y,t.isLane||(this.renderLabels(t,e),this.renderPorts(t,e,r,l)),t.isSwimlane&&i._renderCanvasPhase(t,e),t.annotation&&t._annotation&&t._annotation.length)for(d=0;d<t._annotation.length;d++)i.nameTable[t._annotation[d]]&&(h=i.nameTable[t._annotation[d]],"node"==(g=i.getObjectType(h))?this.renderNode(h,e):"connector"==g&&this.renderConnector(h,e));a.restore()}},_isExportable:function(t,i){var a,n,o=!0;if("image"===t.type)try{(a=(i=new e.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100})).document.getContext("2d")).save(),i.rect(0,0,t.width*i._scaleX,t.height*i._scaleY),(n=new Image).src=t.source,i.image(n,0,0,t.width*i._scaleX,t.height*i._scaleY,void 0,void 0,{scale:t.scale,alignment:t.contentAlignment}),a.restore(),i.document.toDataURL()}catch(t){o=!1}return o},_isImageExportable:function(t){var i,a,n,o=!0;if(t.source)try{(a=(i=new e.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100})).document.getContext("2d")).save(),(n=new Image).src=t.source,i.image(n,0,0,100,100,void 0,void 0,{scale:t.scale,alignment:t.alignment}),a.restore(),i.document.toDataURL()}catch(t){o=!1}return o},renderNode:function(t,i,a){var n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b=i.document.getContext("2d");if(t.visible&&this._isExportable(t,i)){n=t.width||t._width||0,o=t.height||t._height||0,n*=i._scaleX,o*=i._scaleY;var x=t.offsetX*i._scaleX,D=t.offsetY*i._scaleY,C={angle:t.rotateAngle,x:x,y:D};if(b.save(),b.translate(C.x,C.y),b.rotate(C.angle*Math.PI/180),b.translate(-C.x,-C.y),(s="none"!==t.flip?t.flip:t._flip)&&s!==e.datavisualization.Diagram.FlipDirection.None&&t.flip!==t._flip&&(b.translate(C.x,C.y),s===e.datavisualization.Diagram.FlipDirection.Horizontal?b.scale(-1,1):s===e.datavisualization.Diagram.FlipDirection.Vertical?b.scale(1,-1):s===e.datavisualization.Diagram.FlipDirection.Both&&b.scale(-1,-1),b.translate(-C.x,-C.y)),b.save(),b.fillStyle=t.fillColor,b.strokeStyle="none"!=t.borderColor&&t.borderWidth?t.borderColor:"transparent",b.lineWidth=t.borderWidth,b.globalAlpha=t.opacity,r=x-n*t.pivot.x,l=D-o*t.pivot.y,e.datavisualization.Diagram.Util.canCrispEdges(t,i._diagram)&&(r=Math.floor(r)+.5,l=Math.floor(l)+.5),"path"==t._shape?this._renderGradient(t,b,0,0):this._renderGradient(t,b,r,l),d=t.fillColor,t.constraints&e.datavisualization.Diagram.NodeConstraints.Shadow){switch(b.save(),b.strokeStyle="lightgrey",h=e.datavisualization.Diagram.Geometry.transform({x:0,y:0},t.shadow.angle,t.shadow.distance),b.fillStyle="none"!=d||"transparent"!=d?"lightgrey":"none",t._shape){case"image":case"rectangle":t.cornerRadius?i.roundedRect(r+h.x,l+h.y,n,o,t.cornerRadius,null):i.rect(r+h.x,l+h.y,n,o,null);break;case"ellipse":i.ellipse(r+n/2+h.x,l+o/2+h.y,n/2,o/2,null);break;case"path":u=t._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(u=e.datavisualization.Diagram.Geometry.updatePath(r,l,n,o,u,i._diagram._svg,null,null)),i.path(u,r+h.x,l+h.y,n,o,null);break;case"polygon":f=this._updatePolygonPoints(t,i),b.translate(h.x,h.y),i.polygon(f,null,c)}b.restore()}switch(t.borderDashArray&&(-1!=t.borderDashArray.indexOf("[")||t.borderDashArray instanceof Array?g=t.borderDashArray:-1!=t.borderDashArray.indexOf(",")?g=t.borderDashArray.split(","):-1!=t.borderDashArray.indexOf(" ")&&(g=t.borderDashArray.split(" ")),b.setLineDash?b.setLineDash(g):b.mozDash?b.mozDash=g:c={dashArray:g}),t._shape){case"rectangle":t.cornerRadius?i.roundedRect(r,l,n,o,t.cornerRadius,null,c):i.rect(r,l,n,o,null,c);break;case"ellipse":i.ellipse(r+n/2,l+o/2,n/2,o/2,null,c);break;case"path":u=t._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(u=e.datavisualization.Diagram.Geometry.updatePath(0,0,n,o,u,i._diagram._svg,null,null)),i.path(u,r,l,n,o,null,c);break;case"image":C={angle:t.rotateAngle,x:x,y:D},i.rect(r,l,n,o,null,c),(m=new Image).src=t.source,i.image(m,r,l,n,o,void 0,void 0,{scale:t.scale,alignment:t.contentAlignment});break;case"text":i.rect(r,l,n,o,null,c),t.textBlock&&(p="",t.textBlock.italic&&(p+="italic "),t.textBlock.bold&&(p+="bold "),p+=t.textBlock.fontSize+" ",p+=t.textBlock.fontFamily,b.font=p,this._renderTextElement(t,t.textBlock,i));break;case"polygon":f=this._updatePolygonPoints(t,i),i.polygon(f,null,c);break;case"native":case"html":a._raiseEvent("templateNodeRendering",{element:t,canvas:i})}if(b.restore(),this.renderPorts(t,i,r,l),"text"!=t.type&&this.renderLabels(t,i),t.annotation&&t._annotation&&t._annotation.length)for(_=0;_<t._annotation.length;_++)a.nameTable[t._annotation[_]]&&(v=a.nameTable[t._annotation[_]],"node"==(y=a.getObjectType(v))?this.renderNode(v,i):"connector"==y&&this.renderConnector(v,i));b.restore()}},renderPhases:function(t,e,i){var a,n,o;t&&e&&((n=e.document.getContext("2d")).save(),n.strokeStyle=t.lineColor?t.lineColor:"black",n.lineWidth=t.lineWidth?t.lineWidth:1,t.lineDashArray&&(-1!=t.lineDashArray.indexOf("[")||t.lineDashArray instanceof Array?o=t.lineDashArray:-1!=t.lineDashArray.indexOf(",")?o=t.lineDashArray.split(","):-1!=t.lineDashArray.indexOf(" ")&&(o=t.lineDashArray.split(" ")),n.setLineDash?n.setLineDash(o):n.mozDash?n.mozDash=o:a={dashArray:o}),i&&i.length>0&&e.line(i[0],i[1],a)),n.restore()},renderConnector:function(t,e){var i,a,n,o;if(t.visible&&((i=e.document.getContext("2d")).save(),i.strokeStyle=t.lineColor,i.lineWidth=t.lineWidth,t.lineDashArray&&(-1!=t.lineDashArray.indexOf("[")||t.lineDashArray instanceof Array?a=t.lineDashArray:-1!=t.lineDashArray.indexOf(",")?a=t.lineDashArray.split(","):-1!=t.lineDashArray.indexOf(" ")&&(a=t.lineDashArray.split(" ")),i.setLineDash?i.setLineDash(a):i.mozDash?i.mozDash=a:n={dashArray:a}),t.segments&&this._renderSegments(t,e,n),i.restore(),this._renderDecorators(t,e),this.renderLabels(t,e),t.shape))for(o=0;o<t._inlineDecorators.length;o++)this.renderNode(t._inlineDecorators[o],e)},_renderSegments:function(t,i,a){for(var n,o,s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x=0;x<t.segments.length;x++){if((n=t.segments[x])._bridges.length>0)for(o=0;o<n._bridges.length;o++)n._bridges[o]._rendered=!1;if(s=n.points,r=i._diagram,0==x?(r&&t.sourceNode&&(d=r._findNode(t.sourceNode)),s=e.datavisualization.Diagram.SvgContext._clipDecorators(t,n,!0,d),"bezier"==n.type&&t.sourceDecorator&&t.sourceDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(s[0]=e.datavisualization.Diagram.Util._adjustPoint(s[0],n._point1,!0,t.lineWidth)),u=s[0],l=!0):l=!1,x==t.segments.length-1&&(r&&t.targetNode&&(d=r._findNode(t.targetNode)),s=e.datavisualization.Diagram.SvgContext._clipDecorators(t,n,!1,d),u&&t.segments.length<2&&(s[0]=u,u=null),h=!0),t.shape&&"sequence"==t.shape.flow&&"default"==t.shape.sequence&&0==x){g={x:n.points[0].x,y:n.points[0].y},c=e.datavisualization.Diagram.Geometry.distance(n.points[0],n.points[1]),c=Math.min(30,c/2);var D=e.datavisualization.Diagram.Geometry.findAngle(n.points[0],n.points[1]),C=e.datavisualization.Diagram.Geometry.transform({x:g.x,y:g.y},D,c),z=e.datavisualization.Diagram.Geometry.transform({x:C.x,y:C.y},D+135,-12),S=e.datavisualization.Diagram.Geometry.transform({x:z.x,y:z.y},D+135,24)}if(t.shape&&"sequence"==t.shape.flow&&"default"==t.shape.sequence&&0==x){g={x:n.points[0].x,y:n.points[0].y},c=e.datavisualization.Diagram.Geometry.distance(n.points[0],n.points[1]),c=Math.min(30,c/2);D=e.datavisualization.Diagram.Geometry.findAngle(n.points[0],n.points[1]),C=e.datavisualization.Diagram.Geometry.transform({x:g.x,y:g.y},D,c),z=e.datavisualization.Diagram.Geometry.transform({x:C.x,y:C.y},D+135,-12),S=e.datavisualization.Diagram.Geometry.transform({x:z.x,y:z.y},D+135,24)}if("bezier"==n.type)u=s[0],m=n._endPoint,t.targetDecorator&&t.targetDecorator.shape!==e.datavisualization.Diagram.DecoratorShapes.None&&(m=e.datavisualization.Diagram.Util._adjustPoint(n._endPoint,n._point2,!0,t.lineWidth)),i.bezierCurve(u,n._point1,n._point2,m,a);else if(t.cornerRadius>0)for(_=0;_<s.length-1;_++)(v=e.datavisualization.Diagram.Geometry.distance(s[_],s[_+1]))>0&&(y=f||p,f=x<t.segments.length-1||_<s.length-2?v<2*t.cornerRadius?this._adjustPoint(s[_],s[_+1],!1,v/2):this._adjustPoint(s[_],s[_+1],!1,t.cornerRadius):s[_+1],(x>0||_>0)&&(v<2*t.cornerRadius?(p=this._adjustPoint(s[_],s[_+1],!0,v/2),(x<t.segments.length-1||_<s.length-2)&&(f=null)):p=this._adjustPoint(s[_],s[_+1],!0,t.cornerRadius)),y&&p?i.quadraticCurve(y,s[_],p,a):p=s[_],n._bridges.length>0&&this._updateBridging(n,i,_+1,p||s[_],f||s[_+1],t.bridgeSpace,a,!(!l||1!=b),!(!h||b!=s.length-1)),f&&(n._bridges.length>0||i.line(p,f,a)));else for(b=1;b<s.length;b++)n._bridges.length>0?this._updateBridging(n,i,b,s[b-1],s[b],t.bridgeSpace,a,!(!l||1!=b),!(!h||b!=s.length-1)):i.line(this._scalePointforStretch(s[b-1],i,t),this._scalePointforStretch(s[b],i,t),a,!l||1!=b,!h||b!=s.length-1)}t.shape&&"sequence"==t.shape.flow&&"default"==t.shape.sequence&&i.line(this._scalePointforStretch(z,i,t),this._scalePointforStretch(S,i,t),a)},_scalePointforStretch:function(t,i,a){var n={x:t.x,y:t.y};return a&&e.datavisualization.Diagram.Util.canCrispEdges(a,i._diagram)&&(n.x=Math.floor(n.x),n.y=Math.floor(n.y)),n.x*=i._scaleX,n.y*=i._scaleY,n},_updateBridging:function(t,i,a,n,o,s,r,l,d){var h,g,c,u,m=this._findAngle(n,o),p=i._diagram.bridgeDirection();if(t._bridges.length>0)if("straight"===t.type){for(c=0;c<t._bridges.length;c++)if(!(u=t._bridges[c])._rendered){h=null!=t._bridges[c-1]&&t._bridges[c-1].segmentPointIndex==u.segmentPointIndex?t._bridges[c-1].endPoint:n,i.line(h,u.startPoint,r,!(l||0==c),!0);var f=u.startPoint.x+(u.endPoint.x-u.startPoint.x)/2,_=u.startPoint.y+(u.endPoint.y-u.startPoint.y)/2,v=e.datavisualization.Diagram.Util.sweepDirection(m,p,null,i._diagram);i.arc(f,_,s/2,m,v,r),null!=t._bridges[c+1]&&t._bridges[c+1].segmentPointIndex==u.segmentPointIndex?i.line(u.endPoint,t._bridges[c+1].startPoint,r,!1):i.line(u.endPoint,o,r,!1,!d),u._rendered=!0}}else if("orthogonal"===t.type){for(g=n,c=0;c<t._bridges.length;c++)if((u=t._bridges[c]).segmentPointIndex===a&&!u._rendered){h=null!=t._bridges[c-1]&&t._bridges[c-1].segmentPointIndex==u.segmentPointIndex?t._bridges[c-1].endPoint:n,i.line(h,u.startPoint,r,!(l||0==c),!0);f=u.startPoint.x+(u.endPoint.x-u.startPoint.x)/2,_=u.startPoint.y+(u.endPoint.y-u.startPoint.y)/2,v=e.datavisualization.Diagram.Util.sweepDirection(m,p,null,i._diagram);i.arc(f,_,s/2,m,v,r),null!=t._bridges[c+1]&&t._bridges[c+1].segmentPointIndex==u.segmentPointIndex?i.line(u.endPoint,t._bridges[c+1].startPoint,r,!1):g=u.endPoint,u._rendered=!0}i.line(g,o,r,!1,!d)}},_findAngle:function(t,e){var i=t.x-e.x,a=t.y-e.y;return Math.atan2(a,i)*(180/Math.PI)},_adjustPoint:function(t,i,a,n){var o,s=a?{x:t.x,y:t.y}:{x:i.x,y:i.y};return t.x==i.x?t.y<i.y&&a||t.y>i.y&&!a?s.y+=n:s.y-=n:t.y==i.y?t.x<i.x&&a||t.x>i.x&&!a?s.x+=n:s.x-=n:a?(o=e.datavisualization.Diagram.Geometry.findAngle(t,i),s=e.datavisualization.Diagram.Geometry.transform(t,o,n)):(o=e.datavisualization.Diagram.Geometry.findAngle(i,t),s=e.datavisualization.Diagram.Geometry.transform(i,o,n)),s},renderLabels:function(t,e){for(var i,a,n=0;n<t.labels.length;n++)i=t.labels[n],(a=e.document.getContext("2d")).save(),a.globalAlpha=i.opacity,a.lineWidth=i.borderWidth,a.strokeStyle=i.borderColor,i.text&&i.visible&&this._renderTextElement(t,i,e),a.restore()},renderPorts:function(t,i,a,n){for(var o,s,r,l,d,h,g,c=i.document.getContext("2d"),u=0;u<t.ports.length;u++)if(!((o=t.ports[u]).visibility&e.datavisualization.Diagram.PortVisibility.Hidden||o.visibility&e.datavisualization.Diagram.PortVisibility.Hover||o.visibility&e.datavisualization.Diagram.PortVisibility.Connect))switch(s=e.datavisualization.Diagram.Util._getPortPosition(o,e.datavisualization.Diagram.Util.bounds(t,!0)),s=this._scalePointforStretch(s,i),r=o.size*i._scaleY,c.fillStyle=o.fillColor,c.strokeStyle=o.borderColor,c.lineWidth=o.borderWidth,o.shape){case"x":c.beginPath(),c.moveTo(s.x-r/2,s.y-r/2),c.lineTo(s.x+r/2,s.y+r/2),c.moveTo(s.x+r/2,s.y-r/2),c.lineTo(s.x-r/2,s.y+r/2),c.stroke(),c.fill(),c.closePath();break;case"circle":l=r/2,d=r/2,i.ellipse(s.x,s.y,l,d);break;case"square":i.rect(s.x-r/2,s.y-r/2,r,r);break;case"path":c.save(),"group"==t._type?(c.translate(offsetX,t.offsetY),c.rotate(-t.rotateAngle*Math.PI/180),c.translate(-offsetX,-t.offsetY),t.rotateAngle&&(h={angle:t.rotateAngle,x:o._absolutePoint.x,y:o._absolutePoint.y}),g=o._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(g=e.datavisualization.Diagram.Geometry.updatePath(o._absolutePoint.x,o._absolutePoint.y,r,r,g,i._diagram._svg,null,null)),i.path(g,0,0,r,r,h)):(a=s.x-t.width*o.offset.x,n=s.y-t.height*o.offset.y,g=o._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(g=e.datavisualization.Diagram.Geometry.updatePath(a,n,r,r,g,i._diagram._svg,null,null)),i.path(g,a,n,r,r,h)),c.restore()}},_renderTextElement:function(t,e,i){var a,n,o,s;e&&(a={childNodes:[]},(n=i.document.getContext("2d")).save(),o="",e.italic&&(o+="italic "),e.bold&&(o+="bold "),o+=e.fontSize*i._scaleY+"px ",o+=e.fontFamily,n.font=o,s=this._wrapText(t,a,e,i),this._alignTextOnLabel(e,t,a,i,s),n.restore())},_alignTextOnLabel:function(t,i,a,n,o){var s,r,l,d,h,g,c,u,m,p,f,_,v,y,b,x,D,C,z,S,P,w=i.width||i._width||0,T=i.height||i._height||0;w*=n._scaleX,T*=n._scaleY,s={width:o&&o.width||t.width,height:a.childNodes.length*t.fontSize*n._scaleY},(r=e.datavisualization.Diagram.Util.bounds(i)).width*=n._scaleX,r.height*=n._scaleY,r.x*=n._scaleX,r.y*=n._scaleY,g=n._diagram,i.segments&&"segmentpath"==t.relativeMode?(c=e.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(t,i,1,g),l={x:((u=this._scalePointforStretch(c.position,n)).x-r.x)/r.width,y:(u.y-r.y)/r.height},h=(m=e.datavisualization.Diagram.Util._alignLabelOnSegments(i,t,g,c)).vAlign,d=m.hAlign):(d=t.horizontalAlignment,h=t.verticalAlignment);var j={x:0,y:0},E={x:(l=e.datavisualization.Diagram.Util._getLabelPosition(t,r,l)).x,y:l.y},N=0;switch(N=h==e.datavisualization.Diagram.VerticalAlignment.Top?l.y+s.height/2:h==e.datavisualization.Diagram.VerticalAlignment.Center||h==e.datavisualization.Diagram.VerticalAlignment.Stretch?l.y:l.y-s.height/2,j.y=N,j.x=l.x,E.y=N,p=n.document.getContext("2d"),"justify"==t.textAlign?a.childNodes.length>1?(p.textAlign="left",s.width=w-2*t.borderWidth):p.textAlign="center":p.textAlign=t.textAlign,d){case e.datavisualization.Diagram.HorizontalAlignment.Left:switch(E.x=l.x+s.width/2,p.textAlign){case e.datavisualization.Diagram.TextAlign.Left:j.x=l.x;break;case e.datavisualization.Diagram.TextAlign.Center:j.x=l.x+s.width/2;break;case e.datavisualization.Diagram.TextAlign.Right:j.x=l.x+s.width}break;case e.datavisualization.Diagram.HorizontalAlignment.Center:switch(E.x=l.x,p.textAlign){case e.datavisualization.Diagram.TextAlign.Left:j.x=l.x-s.width/2;break;case e.datavisualization.Diagram.TextAlign.Center:j.x=l.x;break;case e.datavisualization.Diagram.TextAlign.Right:j.x=l.x+s.width/2}break;case e.datavisualization.Diagram.HorizontalAlignment.Right:switch(E.x=l.x-s.width/2,p.textAlign){case e.datavisualization.Diagram.TextAlign.Left:j.x=l.x-s.width;break;case e.datavisualization.Diagram.TextAlign.Center:j.x=l.x-s.width/2;break;case e.datavisualization.Diagram.TextAlign.Right:j.x=l.x}break;case e.datavisualization.Diagram.HorizontalAlignment.Stretch:E.x=l.x,j.x=l.x}_=r.x,v=r.y,i.segments||(_=i.offsetX*n._scaleX-w*i.pivot.x,v=i.offsetY*n._scaleY-T*i.pivot.y);var L=t.borderWidth||0,I=_+j.x+(o?o.x:0)-L/2;N=v+j.y-s.height/2-L/2;for("stretch"==t.verticalAlignment?n.rect(I,r.y,s.width+L,r.height+L,null,{fill:t.fillColor&&!i._isHeader?t.fillColor:"transparent",stroke:L&&!i._isHeader&&t.borderColor||"transparent",lineWidth:L}):n.rect(I,N,s.width+L,s.height+L,null,{fill:t.fillColor?t.fillColor:"transparent",stroke:L&&t.borderColor||"transparent",lineWidth:L}),f={angle:t.rotateAngle,x:_+E.x,y:v+E.y},"justify"==t.textAlign&&(y=Math.max(w,t.width)-2*t.borderWidth),p.save(),p.translate(f.x,f.y),p.rotate(f.angle*Math.PI/180),p.translate(-f.x,-f.y),(b="none"!==i.flip?i.flip:i._flip)&&b!==e.datavisualization.Diagram.FlipDirection.None&&i.flip!==i._flip&&(p.translate(f.x,f.y),b===e.datavisualization.Diagram.FlipDirection.Horizontal?p.scale(-1,1):b===e.datavisualization.Diagram.FlipDirection.Vertical?p.scale(1,-1):b===e.datavisualization.Diagram.FlipDirection.Both&&p.scale(-1,-1),p.translate(-f.x,-f.y)),x=0;x<a.childNodes.length;x++){var O=a.childNodes[x],M=I+O.x-o.x+L/2,A=N+O.dy*x+t.fontSize*n._scaleY*.8+L/2,k=p.measureText(O.text).width;if(y>k&&x<a.childNodes.length-1&&(" "==(D=O.text)[D.length-1]&&(D=D.slice(0,D.length-1))," "==D[0]&&(D=D.slice(1,D.length)),k=p.measureText(D).width,(C=D.split(" ")).length>1)){for(z=(y-k)/p.measureText(" ").width/(C.length-1),z=Math.round(z),S="",P=0;P<z;P++)S+=" ";O.text=D.replace(" ",S)}if("stretch"==t.horizontalAlignment)switch(t.textAlign){case"left":O.x=l.x-s.width/2;break;case"center":O.x=-s.width/2;break;case"right":O.x=-l.x-s.width/2}n.text({text:O.text},M-O.x,A,null,{fill:t.fontColor}),"none"!=t.textDecoration&&this._renderTextDecoration(M-O.x,A,p.measureText(O.text).width,t,n)}p.restore()},_wrapText:function(t,i,a,n){var o,s,r,l,d,h,g,c,u,m=a.text;void 0!=a.rotateAngle&&n&&n._diagram?(o=n._diagram.nameTable[t.parent])&&o.isLane&&0!==a.rotateAngle?(c=(s=e.datavisualization.Diagram.Util.bounds(t)).width,s.width=s.height,s.height=c):s=e.datavisualization.Diagram.Util.bounds(t):s=e.datavisualization.Diagram.Util.bounds(t),s.width*=n._scaleX,s.height*=n._scaleY,s.x*=n._scaleX,s.y*=n._scaleY,t.segments?(r=s.width,s.height):(r=s.width-a.margin.left-a.margin.right,s.height,a.margin.top,a.margin.bottom),r=(r-=2*(a.borderWidth?a.borderWidth:1))<a.width?a.width:r;for(var p,f=m.split("\n"),_=n.document.getContext("2d"),v="wrapwithoverflow"==a.wrapping,y=0;y<f.length;y++)if(l="","nowrap"==a.wrapping||a.textOverflow)a.textOverflow?(u=diagram&&diagram.getNode?diagram.getNode(t.parent):null,c=t.isPhase&&"vertical"===t.orientation||u&&u.isLane&&"horizontal"===u.orientation&&t._isHeader?t.height:t.width,l+=this._getOverflowTypeText(_,f[y],c,a.overflowType)):l+=f[y],i.childNodes[i.childNodes.length]={text:l};else for(d="wrapwithoverflow"==a.wrapping?f[y].split(" "):f[y],p=0;p<d.length;p++)(h=d[p]).indexOf("-")>=0&&v?(l=this._splitHyphenWord(l,h,i,a,_,r),p==d.length-1?(i.childNodes[i.childNodes.length]={text:l},l=""):_.measureText(l+" "+(d[p+1]||"")).width>r&&(i.childNodes[i.childNodes.length]={text:l},l="")):(l+=(l&&v?" ":"")+d[p],_.measureText(l).width>=r?(i.childNodes[i.childNodes.length]={text:l},l=""):((v||a&&"wrap"===a.wrapping)&&(g=l,p<d.length-1&&(d[p+1].indexOf("-")>=0&&v?(l=this._splitHyphenWord(l,d[p+1],i,a,_,r),_.measureText(l+" "+(d[p+1]||"")).width>r&&(i.childNodes[i.childNodes.length]={text:l},l=""),p++):(g+=(v?" ":"")+(d[p+1]||""),_.measureText(g).width>r&&(i.childNodes[i.childNodes.length]={text:l},l="")))),p==d.length-1&&(i.childNodes[i.childNodes.length]={text:l},l="")));return this._wrapTextAlign(i,i.childNodes,a.fontSize*n._scaleY,a.textAlign,_,t,a,n)},_getOverflowTypeText:function(t,e,i,a){var n,o,s=t.measureText(e).width,r=t.measureText("…").width;if(s<=i)return e;for(n=e.length,o="ellipsis"===a?i-r:i;s>=o&&n-- >0;)e=e.substring(0,n),s=t.measureText(e).width;return"ellipsis"===a?e+"…":e},_splitHyphenWord:function(t,e,i,a,n,o){for(var s="wrapwithoverflow"==a.wrapping,r=t?t+" ":"",l=e.split("-"),d=0;d<l.length;d++)r+=l[d],n.measureText(r).width>=o?(i.childNodes[i.childNodes.length]={text:t},t=r=d<l.length-1?l[d]+"-":l[d]):(s||a&&"wrap"===a.wrapping)&&(t=r,d<l.length-1&&(r+="-",n.measureText(r).width>o?(i.childNodes[i.childNodes.length]={text:t},r="-"):t=r));return t},_wrapTextAlign:function(t,i,a,n,o,s,r,l){var d,h,g,c,u=e.datavisualization.Diagram.Util.bounds(s);for(u.width*=l._scaleX,u.height*=l._scaleY,u.x*=l._scaleX,u.y*=l._scaleY,g=0;g<i.length;g++){if(d=c=o.measureText(i[g].text).width,"stretch"==r.horizontalAlignment)c=-(d=u.width)/2;else switch(n){case"left":c=0;break;case"center":c=-c/2;break;case"right":c=-c;break;case"justify":c=i.length>1?0:-c/2}i[g].x=Number(c),i[g].dy=a,h?(h.x=Math.min(h.x,c),h.width=Math.max(h.width,d)):h={x:c,width:d}}return h},_renderTextDecoration:function(t,e,i,a,n){var o,s,r=n.document.getContext("2d");switch(r.save(),r.strokeStyle=a.fontColor,r.lineWidth=1,r.textAlign){case"center":t-=i/2;break;case"right":t-=i}switch(e+=2,a.textDecoration){case"overline":e-=a.fontSize*n._scaleY;break;case"line-through":e-=a.fontSize/2*n._scaleY}o={x:t,y:e},s={x:t+i,y:e},n.line(o,s,null),r.restore()},_renderGradient:function(t,e,i,a){var n,o,s,r,l,d;if(t.gradient){for(r=0;r<t.gradient.stops.length;r++)n=n?Math.max(n,t.gradient.stops[r].offset):t.gradient.stops[r].offset,o=o?Math.min(o,t.gradient.stops[r].offset):t.gradient.stops[r].offset;if("linear"==t.gradient.type)for(s=e.createLinearGradient(i+t.gradient.x1,a+t.gradient.y1,i+t.gradient.x2,a+t.gradient.y2),r=0;r<t.gradient.stops.length;r++)l=t.gradient.stops[r],d=o<0?(n+l.offset)/(2*n):l.offset/n,s.addColorStop(d,l.color);else if("radial"==t.gradient.type)for(s=e.createRadialGradient(i+t.gradient.fx,a+t.gradient.fy,0,i+t.gradient.cx,a+t.gradient.cy,t.gradient.r),r=0;r<t.gradient.stops.length;r++)l=t.gradient.stops[r],d=o<0?(n+l.offset)/(2*n):l.offset/n,s.addColorStop(d,l.color);e.fillStyle=s}},_renderDecorators:function(t,i){var a,n,o,s,r,l=i._diagram;t.targetDecorator&&t.targetDecorator.shape&&(a=(s=t.segments[t.segments.length-1]).points[s.points.length-2],n=t.targetPoint,"bezier"==s.type&&(a=s._point2),t.targetNode&&l&&((o=l._findNode(t.targetNode))&&"none"!=o.borderColor&&(n=e.datavisualization.Diagram.Util._adjustPoint(n,a,!0,o.borderWidth/2))),this._renderDecorator(t.name+"_targetDecorator",n,a,t.targetDecorator,i)),t.sourceDecorator&&t.sourceDecorator.shape&&(s=t.segments[0],a=t.sourcePoint,n=s.points[1],"bezier"==s.type&&(n=s._point1),t.sourceNode&&l&&((r=l._findNode(t.sourceNode))&&"none"!=r.borderColor&&(a=e.datavisualization.Diagram.Util._adjustPoint(a,n,!0,r.borderWidth/2))),this._renderDecorator(t.name+"_sourceDecorator",a,n,t.sourceDecorator,i))},_renderDecorator:function(t,i,a,n,o){var s,r,l,d=this._scalePointforStretch(i,o),h=this._scalePointforStretch(a,o),g=new e.datavisualization.Diagram.Size(Number(n.width*o._scaleY),Number(n.height*o._scaleY)),c=o.document.getContext("2d");switch(c.fillStyle=n.fillColor,c.strokeStyle="none"==n.borderColor?"transparent":n.borderColor,c.lineWidth=n.borderWidth,s={angle:e.datavisualization.Diagram.Geometry.findAngle(d,h),x:d.x,y:d.y},n.shape){case"arrow":o.arrow(d,s,g);break;case"openarrow":o.arrow(d,s,g,!0);break;case"circle":r=g.width/2,l=g.height/2,o.ellipse(d.x+g.width/2,d.y,r,l,s);break;case"diamond":o.diamond(d,s,g);break;case"path":o.path(n._absolutePath,0,0,g.width,g.height,s)}},_updatePolygonPoints:function(t,i){var a,n,o,s,r,l,d=[];if(t.points){for(a=t.width||t._width||0,n=t.height||t._height||0,a*=i._scaleX,n*=i._scaleY,s=0;s<t.points.length;s++)o=t.points[s],d.push({x:o.x,y:o.y});if(d.length){this._scalePoints(d,t,i);var h=e.datavisualization.Diagram.Geometry.rect(d),g=t.offsetX*i._scaleX-a*t.pivot.x-h.x,c=t.offsetY*i._scaleY-n*t.pivot.y-h.y;for(s=0,r=d.length;s<r;++s)l=e.datavisualization.Diagram.Geometry.translate(d[s],g,c),d[s]=l}}return d},_scalePoints:function(t,i,a){var n,o,s,r,l,d,h=e.datavisualization.Diagram.Geometry.rect(t);if(h.width>0&&h.height>0)for(n=i.width||i._width||0,o=i.height||i._height||0,n*=a._scaleX,o*=a._scaleY,s=n/h.width,r=o/h.height,l=0,d=t.length;l<d;++l)t[l].x=t[l].x*s,t[l].y=t[l].y*r},updateNode:function(t,e){this.refreshCanvas(t,e)},updateConnector:function(t,e){this.refreshCanvas(t,e)},updateGroup:function(t,e){this.refreshCanvas(t,e)},refreshCanvas:function(t,e){var i,a,n=e.document.getContext("2d");for(n.save(),view.scale&&n.scale(1/view.scale.x,1/view.scale.y),i={x:e.document.offsetLeft,y:e.document.offsetTop,width:e.document.offsetWidth,height:e.document.offsetHeight},n.clearRect(i.x,i.y,i.width,i.height),view.scale&&n.scale(view.scale.x,view.scale.y),n.restore(),a=0;a<t.nodes.length;a++)"node"===t.nodes[a]._type?this.renderNode(t.nodes[a],e):"group"===t.nodes[a]._type&&this.renderGroup(t.nodes[a],e);for(a=0;a<t.connectors.length;a++)this.renderConnector(t.connectors[a],e)},updateViewport:function(){},addNodeLabel:function(t,e){this.refreshCanvas(t,e)},updateLabel:function(t,e){this.refreshCanvas(t,e)},setNodeShape:function(t,e){this.refreshCanvas(t,e)},setLine:function(t,e){this.refreshCanvas(t,e)},renderDecorators:function(t,e){this.refreshCanvas(t,e)},clearDecorators:function(t,e){this.refreshCanvas(t,e)},updateTargetDecoratorStyle:function(t,e){this.refreshCanvas(t,e)},updateSourceDecoratorStyle:function(t,e){this.refreshCanvas(t,e)},_updateNodeStyle:function(t,e){this.refreshCanvas(t,e)},updateLabelStyle:function(t,e){this.refreshCanvas(t,e)},updateConnectorStyle:function(t,e){this.refreshCanvas(t,e)},updateTextBlock:function(t,e,i){this.refreshCanvas(t,i)},removeChild:function(){this.refreshCanvas(model,canvas)}}}(jQuery,Syncfusion)})},1234:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=function(){function t(){this.pageSettings={scrollLimit:"diagram"},this.enableContextMenu=!1,this.margin={left:25,right:25}}return t=a([o.Component({selector:"ej-app",template:i(1733)}),n("design:paramtypes",[])],t)}();e.DefaultComponent=s},1235:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=function(){function t(){this.defaultSettings={node:{width:100,height:40,borderColor:"black",borderWidth:1,fillColor:"#88C65C",labels:[{name:"label1",fontColor:"white",fontSize:12,margin:{left:10,right:10}}]},connector:{lineColor:"#000000",segments:[{type:"orthogonal"}]}},this.layout={type:"hierarchicaltree",horizontalSpacing:25,verticalSpacing:35,marginX:3,marginY:30},this.tool=ej.datavisualization.Diagram.Tool.SingleSelect,this.nodeTemplate=function(t,e){e.labels[0].text=e.Name},this.dataSourceSettings={id:"Name",parent:"Category",dataSource:[{Name:"Diagram",fillColor:"#916DAF"},{Name:"Layout",Category:"Diagram"},{Name:"Tree Layout",Category:"Layout"},{Name:"Organizational Chart",Category:"Layout"},{Name:"Hierarchical Tree",Category:"Tree Layout"},{Name:"Radial Tree",Category:"Tree Layout"},{Name:"Mind Map",Category:"Hierarchical Tree"},{Name:"Family Tree",Category:"Hierarchical Tree"},{Name:"Management",Category:"Organizational Chart"},{Name:"Human Resource",Category:"Management"},{Name:"University",Category:"Management"},{Name:"Business",Category:"Management"}]},this.snapSettings={snapConstraints:"none"},this.pageSettings={scrollLimit:"diagram"}}return t=a([o.Component({selector:"ej-app",template:i(1734)}),n("design:paramtypes",[])],t)}();e.HierarchicalLayoutComponent=s},1236:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=function(){function t(){this.dataSourceSettings={id:"Id",parent:"TeamLead",dataSource:[{Id:"parent",Role:"Marketing Director",Color:"#f79663"},{Id:"1",Role:"Manager",TeamLead:"parent",Color:"#f79663"},{Id:"3",Role:"Fundraiser",TeamLead:"1",Color:"#5cc3b5"},{Id:"4",Role:"Programmer",TeamLead:"1",Color:"#5cc3b5"},{Id:"6",Role:"Communicator",TeamLead:"3",Color:"#67a961"},{Id:"7",Role:"Advertisor",TeamLead:"3",Color:"#67a961"},{Id:"8",Role:"Funding Officer",TeamLead:"3",Color:"#67a961"},{Id:"9",Role:"Inter",TeamLead:"6",Color:"#67a961"},{Id:"10",Role:"Officer",TeamLead:"7",Color:"#67a961"},{Id:"11",Role:"Officer",TeamLead:"7",Color:"#67a961"},{Id:"12",Role:"Asst.Director",TeamLead:"4",Color:"#e9b833"},{Id:"13",Role:"Asst.Director",TeamLead:"4",Color:"#e9b833"},{Id:"14",Role:"Asst.Director",TeamLead:"4",Color:"#e9b833"}]},this.defaultSettings={node:{width:110,height:40,shape:"rectangle",borderColor:"transparent",fillColor:"#253737",labels:[{name:"label1",fontColor:"#ffffff",margin:{left:5,right:5}}]},connector:{segments:[{type:"orthogonal"}],targetDecorator:{fillColor:"#4F4F4F",borderColor:"#4F4F4F"},lineColor:"#003D3D"}},this.layout={type:"hierarchicaltree",marginX:50,marginY:50,horizontalSpacing:30,verticalSpacing:40},this.nodeTemplate=function(t,e){e.labels[0].text=e.Role,e.fillColor=e.Color},this.pageSettings={scrollLimit:"diagram"},this.snapSettings={snapConstraints:"none"},this.tools=ej.datavisualization.Diagram.Tool.ZoomPan,this.enableContextMenu=!1}return t=a([o.Component({selector:"ej-app",template:i(1735)}),n("design:paramtypes",[])],t)}();e.LocalDataBindingComponent=s},1237:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=function(){function t(){this.dataSourceSettings={id:"Id",parent:"Phase",dataSource:[{Id:"parent",Function:"Project Management"},{Id:"1",Function:"R&D Team",Phase:"parent"},{Id:"2",Function:"HR Team",Phase:"parent"},{Id:"3",Function:"Sales Team",Phase:"parent"},{Id:"4",Function:"Philosophy",Phase:"1"},{Id:"5",Function:"Organization",Phase:"1"},{Id:"6",Function:"Technology",Phase:"1"},{Id:"7",Function:"Funding",Phase:"1"},{Id:"8",Function:"Resource",Phase:"1"},{Id:"9",Function:"Targeting",Phase:"1"},{Id:"10",Function:"Evaluation",Phase:"1"},{Id:"11",Function:"Recruitment",Phase:"2"},{Id:"12",Function:"Relation",Phase:"2"},{Id:"13",Function:"Design",Phase:"3"},{Id:"14",Function:"Operation",Phase:"3"},{Id:"15",Function:"Support",Phase:"3"},{Id:"16",Function:"Quality",Phase:"3"},{Id:"17",Function:"Interaction",Phase:"3"},{Id:"18",Function:"Support",Phase:"3"},{Id:"19",Function:"Coordination",Phase:"3"}]},this.defaultSettings={node:{width:100,height:40,borderColor:"black",labels:[{name:"label1",fontColor:"#ffffff"}]},connector:{lineColor:"#000000",segments:[{type:"orthogonal"}],targetDecorator:{shape:"none"}}},this.layout={type:"organizationalchart",marginX:50,marginY:50,horizontalSpacing:30,verticalSpacing:30},this.tool=ej.datavisualization.Diagram.Tool.ZoomPan,this.nodeTemplate=function(t,e){e.labels[0].text=e.Function,e.fillColor=e.Color,"parent"==e.Id&&(e.fillColor="#3484bb"),"parent"==e.Phase&&(e.fillColor="#9ace7f"),"1"==e.Phase&&(e.fillColor="#9264aa"),"2"==e.Phase&&(e.fillColor="#9264aa"),"3"==e.Phase&&(e.fillColor="#9264aa")},this.pageSettings={muliplePages:!1,scrollLimit:"diagram"},this.snapSettings={snapConstraints:"none"}}return t=a([o.Component({selector:"ej-app",template:i(1736)}),n("design:paramtypes",[])],t)}();e.OrganizationalChartComponent=s},1238:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=function(){function t(){var t=[];function e(e,i,a,n){e+=51,i+=71,t.push({name:"node_"+t.length,offsetX:e,offsetY:i,rotateAngle:a,width:102,height:142,type:"image",source:n,borderColor:"none"})}e(24,23,20,"/app/content/images/overviewcontrol/cards_05.png"),e(555,48,41,"/app/content/images/overviewcontrol/cards_03.png"),e(461,174,-64,"/app/content/images/overviewcontrol/cards_07.png"),e(455,634,0,"/app/content/images/overviewcontrol/cards_09.png"),e(81,583,0,"/app/content/images/overviewcontrol/cards_11.png"),e(861,449,-24,"/app/content/images/overviewcontrol/cards_14.png"),e(34,417,20,"/app/content/images/overviewcontrol/cards_16.png"),e(674,418,37,"/app/content/images/overviewcontrol/cards_18.png"),e(1181,921,-75,"/app/content/images/overviewcontrol/cards_23.png"),e(159,125,-9,"/app/content/images/overviewcontrol/cards_25.png"),e(776,249,0,"/app/content/images/overviewcontrol/cards_100.png"),e(776,27,0,"/app/content/images/overviewcontrol/cards_101.png"),e(634,149,-79,"/app/content/images/overviewcontrol/cards_102.png"),e(287,159,0,"/app/content/images/overviewcontrol/cards_103.png"),e(223,584,-20,"/app/content/images/overviewcontrol/cards_104.png"),e(294,8,-52,"/app/content/images/overviewcontrol/cards_105.png"),e(388,296,59,"/app/content/images/overviewcontrol/cards_106.png"),e(102,267,0,"/app/content/images/overviewcontrol/cards_107.png"),e(380,452,0,"/app/content/images/overviewcontrol/cards_108.png"),e(683,550,31,"/app/content/images/overviewcontrol/cards_109.png"),e(1038,567,20,"/app/content/images/overviewcontrol/cards_05.png"),e(849,115,41,"/app/content/images/overviewcontrol/cards_03.png"),e(1165,144,-64,"/app/content/images/overviewcontrol/cards_07.png"),e(497,815,0,"/app/content/images/overviewcontrol/cards_09.png"),e(993,480,0,"/app/content/images/overviewcontrol/cards_100.png"),e(1240,582,-38,"/app/content/images/overviewcontrol/cards_101.png"),e(941,249,0,"/app/content/images/overviewcontrol/cards_102.png"),e(674,921,-41,"/app/content/images/overviewcontrol/cards_104.png"),e(296,816,-20,"/app/content/images/overviewcontrol/cards_104.png"),e(1025,45,-52,"/app/content/images/overviewcontrol/cards_105.png"),e(962,943,59,"/app/content/images/overviewcontrol/cards_106.png"),e(1093,409,-42,"/app/content/images/overviewcontrol/cards_107.png"),e(445,939,33,"/app/content/images/overviewcontrol/cards_108.png"),e(756,783,31,"/app/content/images/overviewcontrol/cards_109.png"),e(15,1047,0,"/app/content/images/overviewcontrol/cards_05.png"),e(1072,102,41,"/app/content/images/overviewcontrol/cards_03.png"),e(417,1198,-64,"/app/content/images/overviewcontrol/cards_07.png"),e(1148,815,0,"/app/content/images/overviewcontrol/cards_09.png"),e(1322,310,-34,"/app/content/images/overviewcontrol/cards_11.png"),e(833,1442,-36,"/app/content/images/overviewcontrol/cards_14.png"),e(25,1441,31,"/app/content/images/overviewcontrol/cards_16.png"),e(630,1442,0,"/app/content/images/overviewcontrol/cards_18.png"),e(1454,102,37,"/app/content/images/overviewcontrol/cards_20.png"),e(1253,1306,-75,"/app/content/images/overviewcontrol/cards_23.png"),e(115,1148,-9,"/app/content/images/overviewcontrol/cards_25.png"),e(993,480,0,"/app/content/images/overviewcontrol/cards_11.png"),e(115,815,-24,"/app/content/images/overviewcontrol/cards_14.png"),e(913,676,31,"/app/content/images/overviewcontrol/cards_16.png"),e(1216,310,0,"/app/content/images/overviewcontrol/cards_18.png"),e(590,614,-16,"/app/content/images/overviewcontrol/cards_20.png"),e(285,685,-75,"/app/content/images/overviewcontrol/cards_23.png"),e(232,357,-9,"/app/content/images/overviewcontrol/cards_25.png"),e(733,1273,0,"/app/content/images/overviewcontrol/cards_100.png"),e(733,1051,0,"/app/content/images/overviewcontrol/cards_101.png"),e(590,1273,-79,"/app/content/images/overviewcontrol/cards_102.png"),e(244,1212,0,"/app/content/images/overviewcontrol/cards_103.png"),e(1547,9,-20,"/app/content/images/overviewcontrol/cards_104.png"),e(251,1031,-52,"/app/content/images/overviewcontrol/cards_105.png"),e(344,1320,59,"/app/content/images/overviewcontrol/cards_106.png"),e(58,1291,0,"/app/content/images/overviewcontrol/cards_107.png"),e(287,1442,0,"/app/content/images/overviewcontrol/cards_108.png"),e(1499,733,31,"/app/content/images/overviewcontrol/cards_109.png"),e(1566,726,20,"/app/content/images/overviewcontrol/cards_05.png"),e(805,1138,41,"/app/content/images/overviewcontrol/cards_03.png"),e(1122,1168,-64,"/app/content/images/overviewcontrol/cards_07.png"),e(1216,0,0,"/app/content/images/overviewcontrol/cards_09.png"),e(1326,534,0,"/app/content/images/overviewcontrol/cards_11.png"),e(1514,930,-24,"/app/content/images/overviewcontrol/cards_14.png"),e(1622,473,31,"/app/content/images/overviewcontrol/cards_16.png"),e(1498,1124,0,"/app/content/images/overviewcontrol/cards_18.png"),e(1668,228,0,"/app/content/images/overviewcontrol/cards_20.png"),this.nodes=t,this.snapSettings={snapConstraints:"none"},this.pageSettings={scrollLimit:"diagram"},this.tool=ej.datavisualization.Diagram.Tool.ZoomPan,this.enableContextMenu=!1}return t=a([o.Component({selector:"ej-app",template:i(1737)}),n("design:paramtypes",[])],t)}();e.OverviewComponent=s},1239:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=i(12),r=function(){function t(){this.pageSettings={pageHeight:500,pageWidth:500,pageBorderWidth:2,pageBackgroundColor:"white",pageOrientation:"landscape",boundaryConstraints:"diagram",showPageBreak:!0,pageBorderColor:"lightgray",pageMargin:25,scrollLimit:"diagram"},this.gradient={type:"radial",cx:50,cy:50,fx:50,fy:50,stops:[{offset:0,color:"white",opacity:0},{offset:100,color:"#FBB040",opacity:1}]},this.gradient1={type:"radial",cx:50,cy:50,fx:50,fy:50,stops:[{offset:0,color:"white",opacity:0},{offset:100,color:"#A0D05F",opacity:1}]},this.gradient2={type:"radial",cx:50,cy:50,fx:50,fy:50,stops:[{offset:0,color:"white",opacity:0},{offset:100,color:"#7FDEFF",opacity:1}]}}return t.prototype.ngAfterViewInit=function(){this.diagram.widget.fitToPage()},a([o.ViewChild("diagram"),n("design:type",s.EJComponents)],t.prototype,"diagram",void 0),t=a([o.Component({selector:"ej-app",template:i(1738)}),n("design:paramtypes",[])],t)}();e.PageSettingsComponent=r},1240:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=i(12),r=function(){function t(){this.dataSourceSettings={id:"Id",parent:"ReportingPerson",dataSource:[{Id:"parent",Name:"Maria Anders",Designation:"Managing Director",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"true",RatingColor:"#C34444"},{Id:1,Name:"Ana Trujillo",Designation:"Project Manager",ImageUrl:"/app/content/images/radialtree/Thomas.PNG",IsExpand:"false",RatingColor:"#68C2DE",ReportingPerson:"parent"},{Id:2,Name:"Lino Rodri",Designation:"Project Manager",ImageUrl:"/app/content/images/radialtree/Robin.PNG",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:"parent"},{Id:3,Name:"Philip Cramer",Designation:"Project Manager",ImageUrl:"/app/content/images/radialtree/Robin.PNG",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:"parent"},{Id:4,Name:"Pedro Afonso",Designation:"Project Manager",ImageUrl:"/app/content/images/radialtree/Paul.png",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:"parent"},{Id:5,Name:"Anto Moreno",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:1},{Id:6,Name:"Elizabeth Roel",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Maria.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:1},{Id:7,Name:"Aria Cruz",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Jenny.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:1},{Id:8,Name:"Eduardo Roel",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"true",RatingColor:"#93B85A",ReportingPerson:1},{Id:9,Name:"Howard Snyd",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Jenny.png",IsExpand:"false",RatingColor:"#68C2DE",ReportingPerson:2},{Id:10,Name:"Daniel Tonini",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"true",RatingColor:"#93B85A",ReportingPerson:2},{Id:11,Name:"Nardo Batista",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Maria.PNG",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:89},{Id:12,Name:"Michael Holz",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Thomas.PNG",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:89},{Id:13,Name:"Kloss Perrier",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:90},{Id:14,Name:"Liz Nixon",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Jenny.png",IsExpand:"false",RatingColor:"#68C2DE",ReportingPerson:3},{Id:15,Name:"Paul Henriot",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"false",RatingColor:"#D46E89",ReportingPerson:3},{Id:16,Name:"Paula Parente",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/John.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:90},{Id:17,Name:"Matti Kenna",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Jenny.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:4},{Id:18,Name:"Laura Callahan",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"false",RatingColor:"#D46E89",ReportingPerson:4},{Id:19,Name:"Simon Roel",Designation:"Project Lead",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"true",RatingColor:"#93B85A",ReportingPerson:4},{Id:20,Name:"Thomas Hardy",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"false",RatingColor:"#68C2DE",ReportingPerson:12},{Id:21,Name:"Martín Kloss",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:5},{Id:22,Name:"Maria Larsson",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image51.png",IsExpand:"false",RatingColor:"#EBB92E",ReportingPerson:6},{Id:23,Name:"Diego Roel",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"false",RatingColor:"#D46E89",ReportingPerson:7},{Id:24,Name:"José Pedro ",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"true",RatingColor:"#D46E89",ReportingPerson:8},{Id:25,Name:"Manu Pereira",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image56.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:8},{Id:26,Name:"Annette Roel",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:25},{Id:27,Name:"Catherine Kaff",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:8},{Id:28,Name:"Lúcia Carvalho",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Robin.PNG",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:12},{Id:29,Name:"Alej Camino",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Thomas.PNG",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:13},{Id:30,Name:"Liu Wong",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:14},{Id:31,Name:"Karin Josephs",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:14},{Id:32,Name:"Ruby Anabela ",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:16},{Id:33,Name:"Pirkko King",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:17},{Id:34,Name:"Karl Jablonski",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:18},{Id:35,Name:"Zbyszek Yang",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:19},{Id:36,Name:"Nancy",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image56.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:5},{Id:37,Name:"Anne",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"false",RatingColor:"#68C2DE",ReportingPerson:6},{Id:38,Name:"Isabel Castro",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:7},{Id:39,Name:"Nardo Batista",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:9},{Id:40,Name:"Rene Phillips",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"false",RatingColor:"#68C2DE",ReportingPerson:16},{Id:41,Name:"Rita Pfalzheim",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"false",RatingColor:"#D46E89",ReportingPerson:9},{Id:42,Name:"Janete Limeira",Designation:"Senior S/w Engg",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:11},{Id:43,Name:"Christina kaff",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:20},{Id:44,Name:"Peter Franken",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:21},{Id:45,Name:"Carlos Schmitt",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:23},{Id:46,Name:"Yoshi Wilson",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"false",RatingColor:"#EBB92E",ReportingPerson:23},{Id:47,Name:"Jean Fresnière",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"false",RatingColor:"#D46E89",ReportingPerson:24},{Id:48,Name:"Simon Roel",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:25},{Id:49,Name:"Rene Phillips",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/Jenny.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:55},{Id:50,Name:"Paula Wilson",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/eric.PNG",IsExpand:"None",RatingColor:"#68C2DE",ReportingPerson:43},{Id:51,Name:"Jose Pavarotti",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/Maria.PNG",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:43},{Id:52,Name:"Palle Ibsen",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/image51.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:29},{Id:53,Name:"Lúcia Carvalho",Designation:"S/w Engg",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:30},{Id:54,Name:"Hanna Moos",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"true",RatingColor:"#D46E89",ReportingPerson:30},{Id:55,Name:"Peter Citeaux",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:33},{Id:56,Name:"Elizabeth Mary",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:33},{Id:57,Name:"Victoria Ash",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:34},{Id:58,Name:"Janine Labrune",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:35},{Id:59,Name:"Martine Rancé",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:11},{Id:60,Name:"Carine Schmitt",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:11},{Id:61,Name:"Paolo Accorti",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:38},{Id:62,Name:"André Fonseca",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/John.png",IsExpand:"true",RatingColor:"#EBB92E",ReportingPerson:41},{Id:63,Name:"Mario Pontes",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:6},{Id:64,Name:"John Steel",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Maria.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:7},{Id:65,Name:"Renate Jose",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image51.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:42},{Id:66,Name:"Jaime Yorres",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:20},{Id:67,Name:"Alex Feuer",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:21},{Id:68,Name:"Yvonne Wong",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:6},{Id:69,Name:"Yoshi Kenna",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"false",RatingColor:"#EBB92E",ReportingPerson:40},{Id:70,Name:"Helen Marie",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image51.png",IsExpand:"true",RatingColor:"#EBB92E",ReportingPerson:24},{Id:71,Name:"Joseph Kaff",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:70},{Id:72,Name:"Horst Kloss",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Clayton.PNG",IsExpand:"None",RatingColor:"#68C2DE",ReportingPerson:70},{Id:73,Name:"Sergio roel",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image55.PNG",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:37},{Id:74,Name:"Mauri Moroni",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.PNG",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:60},{Id:75,Name:"Janete Limeira",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image51.PNG",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:29},{Id:76,Name:"Jonas Bergsen",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.PNG",IsExpand:"None",RatingColor:"#68C2DE",ReportingPerson:18},{Id:77,Name:"Miguel Angel",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/eric.PNG",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:18},{Id:78,Name:"Art Nancy",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"true",RatingColor:"#D46E89",ReportingPerson:88},{Id:79,Name:"Pascal Cartrain",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/John.png",IsExpand:"true",RatingColor:"#EBB92E",ReportingPerson:88},{Id:80,Name:"Helvetis Nagy",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:34},{Id:81,Name:"Rita Müller",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Paul.png",IsExpand:"None",RatingColor:"#68C2DE",ReportingPerson:35},{Id:82,Name:"Georg Pipps",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:36},{Id:83,Name:"Horst Kloss",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Paul.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:37},{Id:84,Name:"Paula Wilson",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/Jenny.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:38},{Id:85,Name:" Jose Michael",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/eric.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:37},{Id:86,Name:"Mauri Moroni",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:40},{Id:87,Name:"Michael Holz",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:41},{Id:88,Name:"Alej Camino",Designation:"Project Trainee",ImageUrl:"/app/content/images/radialtree/image51.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:42},{Id:89,Name:"Jytte Petersen",Designation:"Project Manager",ImageUrl:"/app/content/images/radialtree/image55.PNG",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:"parent"},{Id:90,Name:"Mary Saveley",Designation:"Project Manager",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"false",RatingColor:"#93B85A",ReportingPerson:"parent"},{Id:91,Name:"Robert King",Designation:"Project Manager",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"true",RatingColor:"#D46E89",ReportingPerson:"parent"},{Id:92,Name:"Francisco Yang",Designation:"CSR",ImageUrl:"/app/content/images/radialtree/image55.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:100},{Id:93,Name:"Yang Wang",Designation:"CSR",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:80},{Id:94,Name:"Ann Devon",Designation:"CSR",ImageUrl:"/app/content/images/radialtree/Robin.png",IsExpand:"false",RatingColor:"#68C2DE",ReportingPerson:80},{Id:95,Name:"Roland Mendel",Designation:"CSR",ImageUrl:"/app/content/images/radialtree/image57.png",IsExpand:"true",RatingColor:"#68C2DE",ReportingPerson:19},{Id:96,Name:"Yoshi Latimer",Designation:"SR",ImageUrl:"/app/content/images/radialtree/eric.png",IsExpand:"true",RatingColor:"#D46E89",ReportingPerson:13},{Id:97,Name:"Patricia Kenna",Designation:"SR",ImageUrl:"/app/content/images/radialtree/Maria.png",IsExpand:"true",RatingColor:"#EBB92E",ReportingPerson:100},{Id:98,Name:"Helen Bennett",Designation:"SR",ImageUrl:"/app/content/images/radialtree/image51.png",IsExpand:"None",RatingColor:"#D46E89",ReportingPerson:42},{Id:99,Name:"Carlos Nagy",Designation:"SR",ImageUrl:"/app/content/images/radialtree/Clayton.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:42},{Id:100,Name:"Felipe Kloss",Designation:"SR",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"false",RatingColor:"#EBB92E",ReportingPerson:77},{Id:101,Name:"Fran Wilson",Designation:"SR",ImageUrl:"/app/content/images/radialtree/image53.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:46},{Id:102,Name:"John Rovelli",Designation:"SR",ImageUrl:"/app/content/images/radialtree/Jenny.png",IsExpand:"None",RatingColor:"#93B85A",ReportingPerson:46},{Id:103,Name:"Georg Pipps",Designation:"SR",ImageUrl:"/app/content/images/radialtree/Thomas.png",IsExpand:"None",RatingColor:"#EBB92E",ReportingPerson:55}]},this.defaultSettings={node:{width:50,height:50,borderColor:"transparent",type:"image",constraints:"ej.datavisualization.Diagram.NodeConstraints.InheritTooltip | ej.datavisualization.Diagram.NodeConstraints.PointerEvents",labels:[{name:"label1",fontColor:"#ffffff"}]}},this.layout={type:"radialtree",horizontalSpacing:30,verticalSpacing:30},this.nodeTemplate=function(t,e){e.source=e.ImageUrl},this.tool=ej.datavisualization.Diagram.Tool.ZoomPan,this.pageSettings={scrollLimit:"diagram"},this.snapSettings={snapConstraints:"none"}}return t.prototype.ngAfterViewInit=function(){this.diagram.widget.fitToPage()},a([o.ViewChild("diagram"),n("design:type",s.EJComponents)],t.prototype,"diagram",void 0),t=a([o.Component({selector:"ej-app",template:i(1739)}),n("design:paramtypes",[])],t)}();e.RadialTreeComponent=r},1241:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=function(){function t(){this.palettes=[{name:"Flow Shapes",expanded:!0,items:[{name:"Rectangle",height:45,width:70,offsetX:35,offsetY:22.5,fillColor:"white",borderWidth:1.5,type:"basic",shape:"rectangle"},{name:"Ellipse",width:70,height:70,offsetX:20,offsetY:20,fillColor:"white",borderWidth:1.5,type:"basic",shape:"ellipse"},{name:"Parallelogram",width:70,height:70,offsetX:20,offsetY:30,fillColor:"white",borderWidth:1.8,shape:"polygon",points:[{x:25,y:1},{x:99,y:1},{x:75,y:99},{x:1,y:99}]},{name:"Dimond",width:70,height:70,offsetX:20,offsetY:20,fillColor:"white",borderWidth:1.8,shape:"polygon",points:[{x:50,y:1},{x:100,y:50},{x:50,y:100},{x:1,y:50}]}]},{name:"Swimlane Shapes",expanded:!0,items:[{name:"stackCanvas1",header:{width:50,height:50,fillColor:"#C7D4DF",fontSize:11},height:60,width:140,fillColor:"#f5f5f5",offsetX:70,offsetY:30,orientation:"horizontal",isLane:!0},{name:"stackCanvas2",header:{width:50,height:50,fillColor:"#C7D4DF",fontSize:11},height:140,width:60,fillColor:"#f5f5f5",offsetX:30,offsetY:70,orientation:"vertical",isLane:!0},{name:"verticalPhase",type:"phase",lineWidth:1,lineDashArray:"3,3",lineColor:"#A9A9A9",parent:"",orientation:"vertical",label:{text:""}},{name:"horizontalPhase",type:"phase",lineWidth:1,lineDashArray:"3,3",lineColor:"#A9A9A9",parent:"",orientation:"horizontal",label:{text:""}}]},{name:"Connectors",expanded:!0,items:[{name:"Link1",segments:[{type:"orthogonal"}],sourcePoint:{x:0,y:0},targetPoint:{x:40,y:40},targetDecorator:{shape:"arrow",borderColor:"#A9A9A9",fillColor:"#A9A9A9"},lineWidth:2,lineColor:"#A9A9A9"},{name:"Link21",segments:[{type:"straight"}],sourcePoint:{x:0,y:0},targetPoint:{x:40,y:40},targetDecorator:{shape:"arrow",borderColor:"#A9A9A9",fillColor:"#A9A9A9"},lineWidth:2,lineColor:"#A9A9A9"}]}],this.nodes=[{type:"swimlane",name:"swimlane",header:{text:"ONLINE PURCHASE STATUS",height:50,fillColor:"#C7D4DF",fontSize:11},fillColor:"#f5f5f5",orientation:"horizontal",offsetX:350,offsetY:290,height:100,width:650,lanes:[{name:"stackCanvas1",header:{text:"CUSTOMER",width:50,fillColor:"#C7D4DF",fontSize:11},fillColor:"#f5f5f5",height:120,children:[{shape:"path",pathData:"M 120 24.9999 C 120 38.8072 109.642 50 96.8653 50 L 23.135 50 C 10.3578 50 0 38.8072 0 24.9999 L 0 24.9999 C0 11.1928 10.3578 0 23.135 0 L 96.8653 0 C 109.642 0 120 11.1928 120 24.9999 Z",name:"Order",width:100,height:40,labels:[{text:"ORDER",fontSize:11}],marginLeft:60,marginTop:20}]},{name:"stackCanvas2",header:{text:"ONLINE",width:50,fillColor:"#C7D4DF",fontSize:11},fillColor:"#f5f5f5",height:120,children:[{name:"selectItemaddcart",width:100,height:40,labels:[{text:"Select item\nAdd cart"}],marginLeft:190,marginTop:20},{name:"paymentondebitcreditcard",labels:[{text:"Payment on\nDebit/Credit Card"}],width:100,height:40,marginLeft:350,marginTop:20}]},{name:"stackCanvas3",header:{text:"SHOP",width:50,fillColor:"#C7D4DF",fontSize:11},fillColor:"#f5f5f5",height:120,children:[{name:"getmaildetailaboutorder",width:100,height:40,labels:[{text:"Get mail detail\nabout order"}],marginLeft:190,marginTop:20},{name:"pakingitem",width:100,height:40,labels:[{text:"Paking item"}],marginLeft:350,marginTop:20}]},{name:"stackCanvas4",header:{text:"DELIVERY",width:50,fillColor:"#C7D4DF",fontSize:11},fillColor:"#f5f5f5",height:120,children:[{name:"sendcourieraboutaddress",width:100,height:40,labels:[{text:"Send Courier\n about Address"}],marginLeft:190,marginTop:20},{name:"deliveryonthataddress",width:100,height:40,labels:[{text:"Delivery on that\n Address"}],marginLeft:350,marginTop:20},{name:"getitItem",width:100,height:40,shape:"path",pathData:"M 120 24.9999 C 120 38.8072 109.642 50 96.8653 50 L 23.135 50 C 10.3578 50 0 38.8072 0 24.9999 L 0 24.9999 C0 11.1928 10.3578 0 23.135 0 L 96.8653 0 C 109.642 0 120 11.1928 120 24.9999 Z",labels:[{text:"GET IT ITEM",fontSize:11}],marginLeft:500,marginTop:20}]}],phases:[{name:"phase1",offset:200,lineWidth:1,lineDashArray:"3,3",lineColor:"#606060",label:{text:"Phase"}},{name:"phase2",offset:500,lineWidth:1,lineDashArray:"3,3",lineColor:"#606060",label:{text:"Phase"}}],phaseSize:20}],this.connectors=[{name:"connector1",sourceNode:"Order",targetNode:"selectItemaddcart",targetDecorator:{shape:"arrow",borderColor:"#606060",width:"10",height:"10"},lineColor:"#606060",segments:[{type:"orthogonal",length:null}]},{name:"connector2",sourceNode:"selectItemaddcart",targetNode:"paymentondebitcreditcard",targetDecorator:{shape:"arrow",borderColor:"#606060",width:"10",height:"10"},lineColor:"#606060",segments:[{type:"orthogonal",length:null}]},{name:"connector3",sourceNode:"paymentondebitcreditcard",targetNode:"getmaildetailaboutorder",targetDecorator:{shape:"arrow",borderColor:"#606060",width:"10",height:"10"},lineColor:"#606060",segments:[{type:"orthogonal",length:null}]},{name:"connector4",sourceNode:"getmaildetailaboutorder",targetNode:"pakingitem",targetDecorator:{shape:"arrow",borderColor:"#606060",width:"10",height:"10"},lineColor:"#606060",segments:[{type:"orthogonal",length:null}]},{name:"connector5",sourceNode:"pakingitem",targetNode:"sendcourieraboutaddress",targetDecorator:{shape:"arrow",borderColor:"#606060",width:"10",height:"10"},lineColor:"#606060",segments:[{type:"orthogonal",length:null}]},{name:"connector6",sourceNode:"sendcourieraboutaddress",targetNode:"deliveryonthataddress",targetDecorator:{shape:"arrow",borderColor:"#606060",width:"10",height:"10"},lineColor:"#606060",segments:[{type:"orthogonal",length:null}]},{name:"connector7",sourceNode:"deliveryonthataddress",targetNode:"getitItem",targetDecorator:{shape:"arrow",borderColor:"#606060",width:"10",height:"10"},lineColor:"#606060",segments:[{type:"orthogonal",length:null}]}],this.pageSettings={scrollLimit:"diagram"},this.showPaletteItemText=!1,this.snapSettings={snapConstraints:"none"}}return t=a([o.Component({selector:"ej-app",template:i(1740)}),n("design:paramtypes",[])],t)}();e.SwimlaneComponent=s},1242:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=function(){function t(){this.nodes=[{name:"Patient",type:"umlclassifier",class:{name:"Patient",attributes:[{name:"accepted",type:"Date"},{name:"sickness",type:"History"},{name:"prescription",type:"String[*]"},{name:"allergies",type:"String[*]"}],methods:[{name:"getHistory",arguments:[{name:"Date"}],type:"History"}]},fillColor:"#26A0DA",borderColor:"white",offsetX:85,offsetY:250,labels:[{fontColor:"white"}]},{name:"Doctor",type:"umlclassifier",class:{name:"Doctor",attributes:[{name:"specialist",type:"String[*]"},{name:"locations",type:"String[*]"}]},offsetX:125,offsetY:545,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Person",type:"umlclassifier",class:{name:"Person",attributes:[{name:"name",type:"Name"},{name:"title",type:"String[*]"},{name:"gender",type:"Gender"}]},offsetX:290,offsetY:105,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Hospital",type:"umlclassifier",class:{name:"Hospital",attributes:[{name:"name",type:"Name"},{name:"address",type:"Address"},{name:"phone",type:"Phone"}],methods:[{name:"getDepartment",type:"String"}]},offsetX:523,offsetY:100,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Department",type:"umlclassifier",class:{name:"Department",methods:[{name:"getStaffCount",type:"Int"}]},offsetX:523,offsetY:280,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Staff",type:"umlclassifier",class:{name:"Staff",attributes:[{name:"joined",type:"Date"},{name:"education",type:"string[*]"},{name:"certification",type:"String[*]"},{name:"languages",type:"String[*]"}],methods:[{name:"isDoctor",type:"bool"},{name:"getHistory",type:"bool"}]},offsetX:520,offsetY:455,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"OperationStaff",type:"umlclassifier",class:{name:"OperationStaff"},offsetX:295,offsetY:455,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Nurse",type:"umlclassifier",class:{name:"Nurse"},offsetX:295,offsetY:545,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Surgeon",type:"umlclassifier",class:{name:"Surgeon"},offsetX:125,offsetY:665,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"AdministrativeStaff",type:"umlclassifier",class:{name:"AdministrativeStaff"},offsetX:517,offsetY:605,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"FrontDeskStaff",type:"umlclassifier",class:{name:"FrontDeskStaff"},offsetX:515,offsetY:695,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"TechnicalStaff",type:"umlclassifier",class:{name:"TechnicalStaff"},offsetX:813,offsetY:445,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Technician",type:"umlclassifier",class:{name:"Technician"},offsetX:700,offsetY:535,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"Technologist",type:"umlclassifier",class:{name:"Technologist"},offsetX:900,offsetY:535,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]},{name:"SurgicalTechnologist",type:"umlclassifier",class:{name:"SurgicalTechnologist"},offsetX:900,offsetY:630,fillColor:"#26A0DA",borderColor:"white",labels:[{fontColor:"white"}]}],this.connectors=[{name:"connect1",sourceNode:"Patient",targetNode:"Person",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect2",sourceNode:"Person",targetNode:"Hospital",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association"}},{name:"connect3",sourceNode:"Department",targetNode:"Hospital",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"composition"}},{name:"connect4",sourceNode:"OperationStaff",targetNode:"Patient",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association"}},{name:"connect5",sourceNode:"Doctor",targetNode:"OperationStaff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect6",sourceNode:"Nurse",targetNode:"OperationStaff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect7",sourceNode:"Surgeon",targetNode:"Doctor",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect8",sourceNode:"FrontDeskStaff",targetNode:"AdministrativeStaff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect9",sourceNode:"Technician",targetNode:"TechnicalStaff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect10",sourceNode:"Technologist",targetNode:"TechnicalStaff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect11",sourceNode:"SurgicalTechnologist",targetNode:"Technologist",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect12",sourceNode:"Staff",targetNode:"Department",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect13",sourceNode:"Staff",targetNode:"Person",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect14",sourceNode:"OperationStaff",targetNode:"Staff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect15",sourceNode:"AdministrativeStaff",targetNode:"Staff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}},{name:"connect16",sourceNode:"TechnicalStaff",targetNode:"Staff",segments:[{type:"straight"}],shape:{type:"umlclassifier",relationship:"association",association:"default"}}],this.pageSettings={scrollLimit:"diagram"},this.enableContextMenu=!1,this.snapSettings={snapConstraints:"none"}}return t=a([o.Component({selector:"ej-app",template:i(1741)}),n("design:paramtypes",[])],t)}();e.UMLDiagramComponent=s},1483:function(t,e,i){"use strict";var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();Object.defineProperty(e,"__esModule",{value:!0}),i(1036);var n=i(12),o=i(5),s=function(t){function e(e){var i=t.call(this,[])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-commandmanager-commands>e-commandmanager-command"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={canExecute:[{type:o.Input,args:["canExecute"]}],execute:[{type:o.Input,args:["execute"]}],gesture:[{type:o.Input,args:["gesture"]}],gesture_key:[{type:o.Input,args:["gesture.key"]}],gesture_keyModifiers:[{type:o.Input,args:["gesture.keyModifiers"]}],parameter:[{type:o.Input,args:["parameter"]}]},e}(n.ComplexTagElement);e.DiagramCommandManagerCommandDirective=s;var r=function(t){function e(e){return t.call(this,"commandManager.commands")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"ej-diagram>e-commandmanager-commands",queries:{children:new o.ContentChildren(s)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramCommandManagerCommandsDirective=r;var l=function(t){function e(e){var i=t.call(this,[])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-segments>e-segment"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={direction:[{type:o.Input,args:["direction"]}],length:[{type:o.Input,args:["length"]}],point:[{type:o.Input,args:["point"]}],point1:[{type:o.Input,args:["point1"]}],point2:[{type:o.Input,args:["point2"]}],type:[{type:o.Input,args:["type"]}],vector1:[{type:o.Input,args:["vector1"]}],vector2:[{type:o.Input,args:["vector2"]}]},e}(n.ComplexTagElement);e.DiagramSegmentDirective=l;var d=function(t){function e(e){return t.call(this,"segments")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-connectors>e-segments",queries:{children:new o.ContentChildren(l)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramSegmentsDirective=d;var h=function(t){function e(e){var i=t.call(this,[])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-connectorlabels>e-connectorlabel"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={alignment:[{type:o.Input,args:["alignment"]}],bold:[{type:o.Input,args:["bold"]}],borderColor:[{type:o.Input,args:["borderColor"]}],borderWidth:[{type:o.Input,args:["borderWidth"]}],boundaryConstraints:[{type:o.Input,args:["boundaryConstraints"]}],constraints:[{type:o.Input,args:["constraints"]}],fillColor:[{type:o.Input,args:["fillColor"]}],fontColor:[{type:o.Input,args:["fontColor"]}],fontFamily:[{type:o.Input,args:["fontFamily"]}],fontSize:[{type:o.Input,args:["fontSize"]}],height:[{type:o.Input,args:["height"]}],horizontalAlignment:[{type:o.Input,args:["horizontalAlignment"]}],hyperlink:[{type:o.Input,args:["hyperlink"]}],italic:[{type:o.Input,args:["italic"]}],mode:[{type:o.Input,args:["mode"]}],name:[{type:o.Input,args:["name"]}],offset:[{type:o.Input,args:["offset"]}],margin:[{type:o.Input,args:["margin"]}],margin_right:[{type:o.Input,args:["margin.right"]}],margin_left:[{type:o.Input,args:["margin.left"]}],margin_top:[{type:o.Input,args:["margin.top"]}],margin_bottom:[{type:o.Input,args:["margin.bottom"]}],padding:[{type:o.Input,args:["padding"]}],dragLimit:[{type:o.Input,args:["dragLimit"]}],dragLimit_right:[{type:o.Input,args:["dragLimit.right"]}],dragLimit_left:[{type:o.Input,args:["dragLimit.left"]}],dragLimit_top:[{type:o.Input,args:["dragLimit.top"]}],dragLimit_bottom:[{type:o.Input,args:["dragLimit.bottom"]}],opacity:[{type:o.Input,args:["opacity"]}],readOnly:[{type:o.Input,args:["readOnly"]}],relativeMode:[{type:o.Input,args:["relativeMode"]}],rotateAngle:[{type:o.Input,args:["rotateAngle"]}],segmentOffset:[{type:o.Input,args:["segmentOffset"]}],text:[{type:o.Input,args:["text"]}],textAlign:[{type:o.Input,args:["textAlign"]}],textDecoration:[{type:o.Input,args:["textDecoration"]}],verticalAlignment:[{type:o.Input,args:["verticalAlignment"]}],visible:[{type:o.Input,args:["visible"]}],width:[{type:o.Input,args:["width"]}],wrapping:[{type:o.Input,args:["wrapping"]}]},e}(n.ComplexTagElement);e.DiagramConnectorLabelDirective=h;var g=function(t){function e(e){return t.call(this,"labels")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-connectors>e-connectorlabels",queries:{children:new o.ContentChildren(h)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramConnectorLabelsDirective=g;var c=function(t){function e(e){var i=t.call(this,["segments","labels"])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-connectors>e-connector"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={addInfo:[{type:o.Input,args:["addInfo"]}],bridgeSpace:[{type:o.Input,args:["bridgeSpace"]}],constraints:[{type:o.Input,args:["constraints"]}],cornerRadius:[{type:o.Input,args:["cornerRadius"]}],cssClass:[{type:o.Input,args:["cssClass"]}],horizontalAlign:[{type:o.Input,args:["horizontalAlign"]}],labels:[{type:o.Input,args:["labels"]}],lineColor:[{type:o.Input,args:["lineColor"]}],lineDashArray:[{type:o.Input,args:["lineDashArray"]}],lineHitPadding:[{type:o.Input,args:["lineHitPadding"]}],lineWidth:[{type:o.Input,args:["lineWidth"]}],marginBottom:[{type:o.Input,args:["marginBottom"]}],marginLeft:[{type:o.Input,args:["marginLeft"]}],marginRight:[{type:o.Input,args:["marginRight"]}],marginTop:[{type:o.Input,args:["marginTop"]}],name:[{type:o.Input,args:["name"]}],opacity:[{type:o.Input,args:["opacity"]}],paletteItem:[{type:o.Input,args:["paletteItem"]}],parent:[{type:o.Input,args:["parent"]}],segments:[{type:o.Input,args:["segments"]}],shape:[{type:o.Input,args:["shape"]}],shape_type:[{type:o.Input,args:["shape.type"]}],shape_flow:[{type:o.Input,args:["shape.flow"]}],shape_association:[{type:o.Input,args:["shape.association"]}],shape_message:[{type:o.Input,args:["shape.message"]}],shape_sequence:[{type:o.Input,args:["shape.sequence"]}],shape_relationship:[{type:o.Input,args:["shape.relationship"]}],shape_multiplicity:[{type:o.Input,args:["shape.multiplicity"]}],shape_multiplicity_type:[{type:o.Input,args:["shape.multiplicity.type"]}],shape_multiplicity_source:[{type:o.Input,args:["shape.multiplicity.source"]}],shape_multiplicity_source_optional:[{type:o.Input,args:["shape.multiplicity.source.optional"]}],shape_multiplicity_source_lowerBounds:[{type:o.Input,args:["shape.multiplicity.source.lowerBounds"]}],shape_multiplicity_source_upperBounds:[{type:o.Input,args:["shape.multiplicity.source.upperBounds"]}],shape_multiplicity_target:[{type:o.Input,args:["shape.multiplicity.target"]}],shape_ActivityFlow:[{type:o.Input,args:["shape.ActivityFlow"]}],sourceDecorator:[{type:o.Input,args:["sourceDecorator"]}],sourceDecorator_borderColor:[{type:o.Input,args:["sourceDecorator.borderColor"]}],sourceDecorator_borderWidth:[{type:o.Input,args:["sourceDecorator.borderWidth"]}],sourceDecorator_cssClass:[{type:o.Input,args:["sourceDecorator.cssClass"]}],sourceDecorator_fillColor:[{type:o.Input,args:["sourceDecorator.fillColor"]}],sourceDecorator_height:[{type:o.Input,args:["sourceDecorator.height"]}],sourceDecorator_pathData:[{type:o.Input,args:["sourceDecorator.pathData"]}],sourceDecorator_shape:[{type:o.Input,args:["sourceDecorator.shape"]}],sourceDecorator_width:[{type:o.Input,args:["sourceDecorator.width"]}],sourceNode:[{type:o.Input,args:["sourceNode"]}],sourcePadding:[{type:o.Input,args:["sourcePadding"]}],sourcePoint:[{type:o.Input,args:["sourcePoint"]}],sourcePoint_x:[{type:o.Input,args:["sourcePoint.x"]}],sourcePoint_y:[{type:o.Input,args:["sourcePoint.y"]}],sourcePort:[{type:o.Input,args:["sourcePort"]}],targetDecorator:[{type:o.Input,args:["targetDecorator"]}],targetDecorator_borderColor:[{type:o.Input,args:["targetDecorator.borderColor"]}],targetDecorator_cssClass:[{type:o.Input,args:["targetDecorator.cssClass"]}],targetDecorator_fillColor:[{type:o.Input,args:["targetDecorator.fillColor"]}],targetDecorator_height:[{type:o.Input,args:["targetDecorator.height"]}],targetDecorator_pathData:[{type:o.Input,args:["targetDecorator.pathData"]}],targetDecorator_shape:[{type:o.Input,args:["targetDecorator.shape"]}],targetDecorator_width:[{type:o.Input,args:["targetDecorator.width"]}],targetNode:[{type:o.Input,args:["targetNode"]}],targetPadding:[{type:o.Input,args:["targetPadding"]}],targetPoint:[{type:o.Input,args:["targetPoint"]}],targetPort:[{type:o.Input,args:["targetPort"]}],tooltip:[{type:o.Input,args:["tooltip"]}],verticalAlign:[{type:o.Input,args:["verticalAlign"]}],visible:[{type:o.Input,args:["visible"]}],zOrder:[{type:o.Input,args:["zOrder"]}],tag_segments:[{type:o.ContentChild,args:[d]}],tag_labels:[{type:o.ContentChild,args:[g]}]},e}(n.ComplexTagElement);e.DiagramConnectorDirective=c;var u=function(t){function e(e){return t.call(this,"connectors")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"ej-diagram>e-connectors",queries:{children:new o.ContentChildren(c)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramConnectorsDirective=u;var m=function(t){function e(e){var i=t.call(this,[])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-nodelabels>e-nodelabel"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={bold:[{type:o.Input,args:["bold"]}],borderColor:[{type:o.Input,args:["borderColor"]}],borderWidth:[{type:o.Input,args:["borderWidth"]}],cssClass:[{type:o.Input,args:["cssClass"]}],constraints:[{type:o.Input,args:["constraints"]}],fillColor:[{type:o.Input,args:["fillColor"]}],fontColor:[{type:o.Input,args:["fontColor"]}],fontFamily:[{type:o.Input,args:["fontFamily"]}],fontSize:[{type:o.Input,args:["fontSize"]}],height:[{type:o.Input,args:["height"]}],horizontalAlignment:[{type:o.Input,args:["horizontalAlignment"]}],italic:[{type:o.Input,args:["italic"]}],margin:[{type:o.Input,args:["margin"]}],mode:[{type:o.Input,args:["mode"]}],name:[{type:o.Input,args:["name"]}],offset:[{type:o.Input,args:["offset"]}],opacity:[{type:o.Input,args:["opacity"]}],overflowType:[{type:o.Input,args:["overflowType"]}],padding:[{type:o.Input,args:["padding"]}],readOnly:[{type:o.Input,args:["readOnly"]}],rotateAngle:[{type:o.Input,args:["rotateAngle"]}],templateId:[{type:o.Input,args:["templateId"]}],text:[{type:o.Input,args:["text"]}],textAlign:[{type:o.Input,args:["textAlign"]}],textDecoration:[{type:o.Input,args:["textDecoration"]}],textOverflow:[{type:o.Input,args:["textOverflow"]}],verticalAlignment:[{type:o.Input,args:["verticalAlignment"]}],visible:[{type:o.Input,args:["visible"]}],width:[{type:o.Input,args:["width"]}],wrapping:[{type:o.Input,args:["wrapping"]}]},e}(n.ComplexTagElement);e.DiagramNodeLabelDirective=m;var p=function(t){function e(e){return t.call(this,"labels")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-nodes>e-nodelabels",queries:{children:new o.ContentChildren(m)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramNodeLabelsDirective=p;var f=function(t){function e(e){var i=t.call(this,[])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-phases>e-phase"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={label:[{type:o.Input,args:["label"]}],lineColor:[{type:o.Input,args:["lineColor"]}],lineDashArray:[{type:o.Input,args:["lineDashArray"]}],lineWidth:[{type:o.Input,args:["lineWidth"]}],name:[{type:o.Input,args:["name"]}],offset:[{type:o.Input,args:["offset"]}],orientation:[{type:o.Input,args:["orientation"]}],type:[{type:o.Input,args:["type"]}]},e}(n.ComplexTagElement);e.DiagramPhaseDirective=f;var _=function(t){function e(e){return t.call(this,"phases")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-nodes>e-phases",queries:{children:new o.ContentChildren(f)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramPhasesDirective=_;var v=function(t){function e(e){var i=t.call(this,[])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-ports>e-port"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={borderColor:[{type:o.Input,args:["borderColor"]}],borderWidth:[{type:o.Input,args:["borderWidth"]}],connectorPadding:[{type:o.Input,args:["connectorPadding"]}],constraints:[{type:o.Input,args:["constraints"]}],cssClass:[{type:o.Input,args:["cssClass"]}],fillColor:[{type:o.Input,args:["fillColor"]}],name:[{type:o.Input,args:["name"]}],offset:[{type:o.Input,args:["offset"]}],pathData:[{type:o.Input,args:["pathData"]}],shape:[{type:o.Input,args:["shape"]}],size:[{type:o.Input,args:["size"]}],visibility:[{type:o.Input,args:["visibility"]}],parent:[{type:o.Input,args:["parent"]}]},e}(n.ComplexTagElement);e.DiagramPortDirective=v;var y=function(t){function e(e){return t.call(this,"ports")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-nodes>e-ports",queries:{children:new o.ContentChildren(v)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramPortsDirective=y;var b=function(t){function e(e){var i=t.call(this,["labels","phases","ports"])||this;return i.parent=e,i}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"e-nodes>e-node"}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e.propDecorators={activity:[{type:o.Input,args:["activity"]}],addInfo:[{type:o.Input,args:["addInfo"]}],annotation:[{type:o.Input,args:["annotation"]}],annotation_angle:[{type:o.Input,args:["annotation.angle"]}],annotation_direction:[{type:o.Input,args:["annotation.direction"]}],annotation_height:[{type:o.Input,args:["annotation.height"]}],annotation_length:[{type:o.Input,args:["annotation.length"]}],annotation_text:[{type:o.Input,args:["annotation.text"]}],annotation_width:[{type:o.Input,args:["annotation.width"]}],borderColor:[{type:o.Input,args:["borderColor"]}],borderDashArray:[{type:o.Input,args:["borderDashArray"]}],borderWidth:[{type:o.Input,args:["borderWidth"]}],canUngroup:[{type:o.Input,args:["canUngroup"]}],children:[{type:o.Input,args:["children"]}],classifier:[{type:o.Input,args:["classifier"]}],class:[{type:o.Input,args:["class"]}],class_name:[{type:o.Input,args:["class.name"]}],class_attributes:[{type:o.Input,args:["class.attributes"]}],class_methods:[{type:o.Input,args:["class.methods"]}],collapseIcon:[{type:o.Input,args:["collapseIcon"]}],collapseIcon_borderColor:[{type:o.Input,args:["collapseIcon.borderColor"]}],collapseIcon_borderWidth:[{type:o.Input,args:["collapseIcon.borderWidth"]}],collapseIcon_fillColor:[{type:o.Input,args:["collapseIcon.fillColor"]}],collapseIcon_height:[{type:o.Input,args:["collapseIcon.height"]}],collapseIcon_horizontalAlignment:[{type:o.Input,args:["collapseIcon.horizontalAlignment"]}],collapseIcon_margin:[{type:o.Input,args:["collapseIcon.margin"]}],collapseIcon_offset:[{type:o.Input,args:["collapseIcon.offset"]}],collapseIcon_shape:[{type:o.Input,args:["collapseIcon.shape"]}],collapseIcon_verticalAlignment:[{type:o.Input,args:["collapseIcon.verticalAlignment"]}],connectorPadding:[{type:o.Input,args:["connectorPadding"]}],constraints:[{type:o.Input,args:["constraints"]}],container:[{type:o.Input,args:["container"]}],container_orientation:[{type:o.Input,args:["container.orientation"]}],container_type:[{type:o.Input,args:["container.type"]}],cornerRadius:[{type:o.Input,args:["cornerRadius"]}],cssClass:[{type:o.Input,args:["cssClass"]}],data:[{type:o.Input,args:["data"]}],data_type:[{type:o.Input,args:["data.type"]}],data_collection:[{type:o.Input,args:["data.collection"]}],enumeration:[{type:o.Input,args:["enumeration"]}],enumeration_name:[{type:o.Input,args:["enumeration.name"]}],enumeration_members:[{type:o.Input,args:["enumeration.members"]}],event:[{type:o.Input,args:["event"]}],excludeFromLayout:[{type:o.Input,args:["excludeFromLayout"]}],expandIcon:[{type:o.Input,args:["expandIcon"]}],expandIcon_borderColor:[{type:o.Input,args:["expandIcon.borderColor"]}],expandIcon_borderWidth:[{type:o.Input,args:["expandIcon.borderWidth"]}],expandIcon_fillColor:[{type:o.Input,args:["expandIcon.fillColor"]}],expandIcon_height:[{type:o.Input,args:["expandIcon.height"]}],expandIcon_horizontalAlignment:[{type:o.Input,args:["expandIcon.horizontalAlignment"]}],expandIcon_margin:[{type:o.Input,args:["expandIcon.margin"]}],expandIcon_offset:[{type:o.Input,args:["expandIcon.offset"]}],expandIcon_shape:[{type:o.Input,args:["expandIcon.shape"]}],expandIcon_verticalAlignment:[{type:o.Input,args:["expandIcon.verticalAlignment"]}],fillColor:[{type:o.Input,args:["fillColor"]}],gateway:[{type:o.Input,args:["gateway"]}],gradient:[{type:o.Input,args:["gradient"]}],gradient_LinearGradient:[{type:o.Input,args:["gradient.LinearGradient"]}],gradient_LinearGradient_stops:[{type:o.Input,args:["gradient.LinearGradient.stops"]}],gradient_LinearGradient_type:[{type:o.Input,args:["gradient.LinearGradient.type"]}],gradient_LinearGradient_x1:[{type:o.Input,args:["gradient.LinearGradient.x1"]}],gradient_LinearGradient_x2:[{type:o.Input,args:["gradient.LinearGradient.x2"]}],gradient_LinearGradient_y1:[{type:o.Input,args:["gradient.LinearGradient.y1"]}],gradient_LinearGradient_y2:[{type:o.Input,args:["gradient.LinearGradient.y2"]}],gradient_RadialGradient:[{type:o.Input,args:["gradient.RadialGradient"]}],gradient_RadialGradient_type:[{type:o.Input,args:["gradient.RadialGradient.type"]}],gradient_RadialGradient_cx:[{type:o.Input,args:["gradient.RadialGradient.cx"]}],gradient_RadialGradient_cy:[{type:o.Input,args:["gradient.RadialGradient.cy"]}],gradient_RadialGradient_fx:[{type:o.Input,args:["gradient.RadialGradient.fx"]}],gradient_RadialGradient_fy:[{type:o.Input,args:["gradient.RadialGradient.fy"]}],gradient_RadialGradient_stops:[{type:o.Input,args:["gradient.RadialGradient.stops"]}],gradient_Stop:[{type:o.Input,args:["gradient.Stop"]}],gradient_Stop_color:[{type:o.Input,args:["gradient.Stop.color"]}],gradient_Stop_offset:[{type:o.Input,args:["gradient.Stop.offset"]}],gradient_Stop_opacity:[{type:o.Input,args:["gradient.Stop.opacity"]}],borderGradient:[{type:o.Input,args:["borderGradient"]}],header:[{type:o.Input,args:["header"]}],height:[{type:o.Input,args:["height"]}],horizontalAlign:[{type:o.Input,args:["horizontalAlign"]}],inEdges:[{type:o.Input,args:["inEdges"]}],interface:[{type:o.Input,args:["interface"]}],interface_name:[{type:o.Input,args:["interface.name"]}],interface_attributes:[{type:o.Input,args:["interface.attributes"]}],interface_methods:[{type:o.Input,args:["interface.methods"]}],isExpanded:[{type:o.Input,args:["isExpanded"]}],isSwimlane:[{type:o.Input,args:["isSwimlane"]}],labels:[{type:o.Input,args:["labels"]}],lanes:[{type:o.Input,args:["lanes"]}],marginBottom:[{type:o.Input,args:["marginBottom"]}],marginLeft:[{type:o.Input,args:["marginLeft"]}],marginRight:[{type:o.Input,args:["marginRight"]}],marginTop:[{type:o.Input,args:["marginTop"]}],maxHeight:[{type:o.Input,args:["maxHeight"]}],maxWidth:[{type:o.Input,args:["maxWidth"]}],minHeight:[{type:o.Input,args:["minHeight"]}],minWidth:[{type:o.Input,args:["minWidth"]}],name:[{type:o.Input,args:["name"]}],offsetX:[{type:o.Input,args:["offsetX"]}],offsetY:[{type:o.Input,args:["offsetY"]}],opacity:[{type:o.Input,args:["opacity"]}],orientation:[{type:o.Input,args:["orientation"]}],outEdges:[{type:o.Input,args:["outEdges"]}],paddingBottom:[{type:o.Input,args:["paddingBottom"]}],paddingLeft:[{type:o.Input,args:["paddingLeft"]}],paddingRight:[{type:o.Input,args:["paddingRight"]}],paddingTop:[{type:o.Input,args:["paddingTop"]}],paletteItem:[{type:o.Input,args:["paletteItem"]}],paletteItem_enableScale:[{type:o.Input,args:["paletteItem.enableScale"]}],paletteItem_height:[{type:o.Input,args:["paletteItem.height"]}],paletteItem_label:[{type:o.Input,args:["paletteItem.label"]}],paletteItem_margin:[{type:o.Input,args:["paletteItem.margin"]}],paletteItem_previewHeight:[{type:o.Input,args:["paletteItem.previewHeight"]}],paletteItem_previewWidth:[{type:o.Input,args:["paletteItem.previewWidth"]}],paletteItem_width:[{type:o.Input,args:["paletteItem.width"]}],parent:[{type:o.Input,args:["parent"]}],pathData:[{type:o.Input,args:["pathData"]}],phases:[{type:o.Input,args:["phases"]}],phaseSize:[{type:o.Input,args:["phaseSize"]}],pivot:[{type:o.Input,args:["pivot"]}],points:[{type:o.Input,args:["points"]}],ports:[{type:o.Input,args:["ports"]}],rotateAngle:[{type:o.Input,args:["rotateAngle"]}],shadow:[{type:o.Input,args:["shadow"]}],shadow_angle:[{type:o.Input,args:["shadow.angle"]}],shadow_distance:[{type:o.Input,args:["shadow.distance"]}],shadow_opacity:[{type:o.Input,args:["shadow.opacity"]}],shape:[{type:o.Input,args:["shape"]}],source:[{type:o.Input,args:["source"]}],subProcess:[{type:o.Input,args:["subProcess"]}],subProcess_adhoc:[{type:o.Input,args:["subProcess.adhoc"]}],subProcess_boundary:[{type:o.Input,args:["subProcess.boundary"]}],subProcess_compensation:[{type:o.Input,args:["subProcess.compensation"]}],subProcess_collapsed:[{type:o.Input,args:["subProcess.collapsed"]}],subProcess_event:[{type:o.Input,args:["subProcess.event"]}],subProcess_events:[{type:o.Input,args:["subProcess.events"]}],subProcess_loop:[{type:o.Input,args:["subProcess.loop"]}],subProcess_Processes:[{type:o.Input,args:["subProcess.Processes"]}],subProcess_trigger:[{type:o.Input,args:["subProcess.trigger"]}],subProcess_type:[{type:o.Input,args:["subProcess.type"]}],task:[{type:o.Input,args:["task"]}],task_call:[{type:o.Input,args:["task.call"]}],task_compensation:[{type:o.Input,args:["task.compensation"]}],task_loop:[{type:o.Input,args:["task.loop"]}],task_type:[{type:o.Input,args:["task.type"]}],task_events:[{type:o.Input,args:["task.events"]}],templateId:[{type:o.Input,args:["templateId"]}],textBlock:[{type:o.Input,args:["textBlock"]}],tooltip:[{type:o.Input,args:["tooltip"]}],trigger:[{type:o.Input,args:["trigger"]}],type:[{type:o.Input,args:["type"]}],verticalAlign:[{type:o.Input,args:["verticalAlign"]}],visible:[{type:o.Input,args:["visible"]}],width:[{type:o.Input,args:["width"]}],zOrder:[{type:o.Input,args:["zOrder"]}],tag_labels:[{type:o.ContentChild,args:[p]}],tag_phases:[{type:o.ContentChild,args:[_]}],tag_ports:[{type:o.ContentChild,args:[y]}]},e}(n.ComplexTagElement);e.DiagramNodeDirective=b;var x=function(t){function e(e){return t.call(this,"nodes")||this}return a(e,t),e.decorators=[{type:o.Directive,args:[{selector:"ej-diagram>e-nodes",queries:{children:new o.ContentChildren(b)}}]}],e.ctorParameters=function(){return[{type:n.EJComponents,decorators:[{type:o.Inject,args:[o.forwardRef(function(){return D})]}]}]},e}(n.ArrayTagElement);e.DiagramNodesDirective=x;var D=function(t){function e(e,i,a,n){var s=t.call(this,"Diagram",e,i,["commandManager.commands","connectors","nodes"],a,n)||this;return s.el=e,s.cdRef=i,s._ejIterableDiffers=a,s._ejkeyvaluediffers=n,s.autoScrollChange_output=new o.EventEmitter,s.click_output=new o.EventEmitter,s.ejclick_output=new o.EventEmitter,s.connectionChange_output=new o.EventEmitter,s.connectorCollectionChange_output=new o.EventEmitter,s.connectorSourceChange_output=new o.EventEmitter,s.connectorTargetChange_output=new o.EventEmitter,s.contextMenuBeforeOpen_output=new o.EventEmitter,s.contextMenuClick_output=new o.EventEmitter,s.doubleClick_output=new o.EventEmitter,s.drag_output=new o.EventEmitter,s.dragEnter_output=new o.EventEmitter,s.dragLeave_output=new o.EventEmitter,s.dragOver_output=new o.EventEmitter,s.drop_output=new o.EventEmitter,s.editorFocusChange_output=new o.EventEmitter,s.groupChange_output=new o.EventEmitter,s.historyChange_output=new o.EventEmitter,s.itemClick_output=new o.EventEmitter,s.mouseEnter_output=new o.EventEmitter,s.mouseLeave_output=new o.EventEmitter,s.mouseOver_output=new o.EventEmitter,s.nodeCollectionChange_output=new o.EventEmitter,s.propertyChange_output=new o.EventEmitter,s.rotationChange_output=new o.EventEmitter,s.scrollChange_output=new o.EventEmitter,s.segmentChange_output=new o.EventEmitter,s.selectionChange_output=new o.EventEmitter,s.sizeChange_output=new o.EventEmitter,s.textChange_output=new o.EventEmitter,s.create_output=new o.EventEmitter,s.setTool_output=new o.EventEmitter,s}return a(e,t),e.decorators=[{type:o.Component,args:[{selector:"ej-diagram",template:""}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.ChangeDetectorRef},{type:o.IterableDiffers},{type:o.KeyValueDiffers}]},e.propDecorators={backgroundColor_input:[{type:o.Input,args:["backgroundColor"]}],backgroundImage_input:[{type:o.Input,args:["backgroundImage"]}],bridgeDirection_input:[{type:o.Input,args:["bridgeDirection"]}],commandManager_input:[{type:o.Input,args:["commandManager"]}],connectorTemplate_input:[{type:o.Input,args:["connectorTemplate"]}],constraints_input:[{type:o.Input,args:["constraints"]}],contextMenu_input:[{type:o.Input,args:["contextMenu"]}],dataSourceSettings_input:[{type:o.Input,args:["dataSourceSettings"]}],defaultSettings_input:[{type:o.Input,args:["defaultSettings"]}],drawType_input:[{type:o.Input,args:["drawType"]}],enableAutoScroll_input:[{type:o.Input,args:["enableAutoScroll"]}],enableContextMenu_input:[{type:o.Input,args:["enableContextMenu"]}],height_input:[{type:o.Input,args:["height"]}],historyManager_input:[{type:o.Input,args:["historyManager"]}],labelRenderingMode_input:[{type:o.Input,args:["labelRenderingMode"]}],layout_input:[{type:o.Input,args:["layout"]}],locale_input:[{type:o.Input,args:["locale"]}],nodeTemplate_input:[{type:o.Input,args:["nodeTemplate"]}],pageSettings_input:[{type:o.Input,args:["pageSettings"]}],scrollSettings_input:[{type:o.Input,args:["scrollSettings"]}],selectedItems_input:[{type:o.Input,args:["selectedItems"]}],showTooltip_input:[{type:o.Input,args:["showTooltip"]}],serializationSettings_input:[{type:o.Input,args:["serializationSettings"]}],rulerSettings_input:[{type:o.Input,args:["rulerSettings"]}],snapSettings_input:[{type:o.Input,args:["snapSettings"]}],tool_input:[{type:o.Input,args:["tool"]}],tooltip_input:[{type:o.Input,args:["tooltip"]}],width_input:[{type:o.Input,args:["width"]}],zoomFactor_input:[{type:o.Input,args:["zoomFactor"]}],backgroundImage_alignment_input:[{type:o.Input,args:["backgroundImage.alignment"]}],commandManager_commands_input:[{type:o.Input,args:["commandManager.commands"]}],commandManager_commands_canExecute_input:[{type:o.Input,args:["commandManager.commands.canExecute"]}],commandManager_commands_execute_input:[{type:o.Input,args:["commandManager.commands.execute"]}],commandManager_commands_gesture_input:[{type:o.Input,args:["commandManager.commands.gesture"]}],commandManager_commands_parameter_input:[{type:o.Input,args:["commandManager.commands.parameter"]}],contextMenu_showCustomMenuItemsOnly_input:[{type:o.Input,args:["contextMenu.showCustomMenuItemsOnly"]}],dataSourceSettings_dataSource_input:[{type:o.Input,args:["dataSourceSettings.dataSource"]}],dataSourceSettings_id_input:[{type:o.Input,args:["dataSourceSettings.id"]}],dataSourceSettings_parent_input:[{type:o.Input,args:["dataSourceSettings.parent"]}],dataSourceSettings_query_input:[{type:o.Input,args:["dataSourceSettings.query"]}],dataSourceSettings_root_input:[{type:o.Input,args:["dataSourceSettings.root"]}],dataSourceSettings_tableName_input:[{type:o.Input,args:["dataSourceSettings.tableName"]}],dataSourceSettings_crudAction_input:[{type:o.Input,args:["dataSourceSettings.crudAction"]}],dataSourceSettings_crudAction_create_input:[{type:o.Input,args:["dataSourceSettings.crudAction.create"]}],dataSourceSettings_crudAction_update_input:[{type:o.Input,args:["dataSourceSettings.crudAction.update"]}],dataSourceSettings_crudAction_destroy_input:[{type:o.Input,args:["dataSourceSettings.crudAction.destroy"]}],dataSourceSettings_crudAction_read_input:[{type:o.Input,args:["dataSourceSettings.crudAction.read"]}],dataSourceSettings_customFields_input:[{type:o.Input,args:["dataSourceSettings.customFields"]}],dataSourceSettings_connectionDataSource_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource"]}],dataSourceSettings_connectionDataSource_dataSource_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.dataSource"]}],dataSourceSettings_connectionDataSource_id_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.id"]}],dataSourceSettings_connectionDataSource_sourceNode_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.sourceNode"]}],dataSourceSettings_connectionDataSource_targetNode_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.targetNode"]}],dataSourceSettings_connectionDataSource_sourcePointX_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.sourcePointX"]}],dataSourceSettings_connectionDataSource_sourcePointY_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.sourcePointY"]}],dataSourceSettings_connectionDataSource_targetPointX_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.targetPointX"]}],dataSourceSettings_connectionDataSource_targetPointY_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.targetPointY"]}],dataSourceSettings_connectionDataSource_crudAction_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.crudAction"]}],dataSourceSettings_connectionDataSource_customFields_input:[{type:o.Input,args:["dataSourceSettings.connectionDataSource.customFields"]}],defaultSettings_connector_input:[{type:o.Input,args:["defaultSettings.connector"]}],defaultSettings_group_input:[{type:o.Input,args:["defaultSettings.group"]}],defaultSettings_node_input:[{type:o.Input,args:["defaultSettings.node"]}],historyManager_canPop_input:[{type:o.Input,args:["historyManager.canPop"]}],historyManager_closeGroupAction_input:[{type:o.Input,args:["historyManager.closeGroupAction"]}],historyManager_pop_input:[{type:o.Input,args:["historyManager.pop"]}],historyManager_push_input:[{type:o.Input,args:["historyManager.push"]}],historyManager_redo_input:[{type:o.Input,args:["historyManager.redo"]}],historyManager_redoStack_input:[{type:o.Input,args:["historyManager.redoStack"]}],historyManager_stackLimit_input:[{type:o.Input,args:["historyManager.stackLimit"]}],historyManager_startGroupAction_input:[{type:o.Input,args:["historyManager.startGroupAction"]}],historyManager_undo_input:[{type:o.Input,args:["historyManager.undo"]}],historyManager_undoStack_input:[{type:o.Input,args:["historyManager.undoStack"]}],layout_bounds_input:[{type:o.Input,args:["layout.bounds"]}],layout_fixedNode_input:[{type:o.Input,args:["layout.fixedNode"]}],layout_getLayoutInfo_input:[{type:o.Input,args:["layout.getLayoutInfo"]}],layout_getConnectorSegments_input:[{type:o.Input,args:["layout.getConnectorSegments"]}],layout_horizontalSpacing_input:[{type:o.Input,args:["layout.horizontalSpacing"]}],layout_margin_input:[{type:o.Input,args:["layout.margin"]}],layout_horizontalAlignment_input:[{type:o.Input,args:["layout.horizontalAlignment"]}],layout_verticalAlignment_input:[{type:o.Input,args:["layout.verticalAlignment"]}],layout_orientation_input:[{type:o.Input,args:["layout.orientation"]}],layout_type_input:[{type:o.Input,args:["layout.type"]}],layout_verticalSpacing_input:[{type:o.Input,args:["layout.verticalSpacing"]}],layout_root_input:[{type:o.Input,args:["layout.root"]}],layout_springLength_input:[{type:o.Input,args:["layout.springLength"]}],layout_springFactor_input:[{type:o.Input,args:["layout.springFactor"]}],layout_maxIteration_input:[{type:o.Input,args:["layout.maxIteration"]}],layout_avoidSegmentOverlapping_input:[{type:o.Input,args:["layout.avoidSegmentOverlapping"]}],pageSettings_autoScrollBorder_input:[{type:o.Input,args:["pageSettings.autoScrollBorder"]}],pageSettings_multiplePage_input:[{type:o.Input,args:["pageSettings.multiplePage"]}],pageSettings_pageBackgroundColor_input:[{type:o.Input,args:["pageSettings.pageBackgroundColor"]}],pageSettings_pageBorderColor_input:[{type:o.Input,args:["pageSettings.pageBorderColor"]}],pageSettings_pageBorderWidth_input:[{type:o.Input,args:["pageSettings.pageBorderWidth"]}],pageSettings_pageHeight_input:[{type:o.Input,args:["pageSettings.pageHeight"]}],pageSettings_pageMargin_input:[{type:o.Input,args:["pageSettings.pageMargin"]}],pageSettings_pageOrientation_input:[{type:o.Input,args:["pageSettings.pageOrientation"]}],pageSettings_pageWidth_input:[{type:o.Input,args:["pageSettings.pageWidth"]}],pageSettings_scrollableArea_input:[{type:o.Input,args:["pageSettings.scrollableArea"]}],pageSettings_scrollLimit_input:[{type:o.Input,args:["pageSettings.scrollLimit"]}],pageSettings_boundaryConstraints_input:[{type:o.Input,args:["pageSettings.boundaryConstraints"]}],pageSettings_showPageBreak_input:[{type:o.Input,args:["pageSettings.showPageBreak"]}],scrollSettings_currentZoom_input:[{type:o.Input,args:["scrollSettings.currentZoom"]}],scrollSettings_horizontalOffset_input:[{type:o.Input,args:["scrollSettings.horizontalOffset"]}],scrollSettings_padding_input:[{type:o.Input,args:["scrollSettings.padding"]}],scrollSettings_verticalOffset_input:[{type:o.Input,args:["scrollSettings.verticalOffset"]}],scrollSettings_viewPortHeight_input:[{type:o.Input,args:["scrollSettings.viewPortHeight"]}],scrollSettings_viewPortWidth_input:[{type:o.Input,args:["scrollSettings.viewPortWidth"]}],selectedItems_children_input:[{type:o.Input,args:["selectedItems.children"]}],selectedItems_constraints_input:[{type:o.Input,args:["selectedItems.constraints"]}],selectedItems_getConstraints_input:[{type:o.Input,args:["selectedItems.getConstraints"]}],selectedItems_height_input:[{type:o.Input,args:["selectedItems.height"]}],selectedItems_offsetX_input:[{type:o.Input,args:["selectedItems.offsetX"]}],selectedItems_offsetY_input:[{type:o.Input,args:["selectedItems.offsetY"]}],selectedItems_rotateAngle_input:[{type:o.Input,args:["selectedItems.rotateAngle"]}],selectedItems_tooltip_input:[{type:o.Input,args:["selectedItems.tooltip"]}],selectedItems_width_input:[{type:o.Input,args:["selectedItems.width"]}],serializationSettings_preventDefaultValues_input:[{type:o.Input,args:["serializationSettings.preventDefaultValues"]}],rulerSettings_showRulers_input:[{type:o.Input,args:["rulerSettings.showRulers"]}],rulerSettings_horizontalRuler_input:[{type:o.Input,args:["rulerSettings.horizontalRuler"]}],rulerSettings_horizontalRuler_interval_input:[{type:o.Input,args:["rulerSettings.horizontalRuler.interval"]}],rulerSettings_horizontalRuler_segmentWidth_input:[{type:o.Input,args:["rulerSettings.horizontalRuler.segmentWidth"]}],rulerSettings_horizontalRuler_arrangeTick_input:[{type:o.Input,args:["rulerSettings.horizontalRuler.arrangeTick"]}],rulerSettings_horizontalRuler_tickAlignment_input:[{type:o.Input,args:["rulerSettings.horizontalRuler.tickAlignment"]}],rulerSettings_horizontalRuler_markerColor_input:[{type:o.Input,args:["rulerSettings.horizontalRuler.markerColor"]}],rulerSettings_horizontalRuler_length_input:[{type:o.Input,args:["rulerSettings.horizontalRuler.length"]}],rulerSettings_horizontalRuler_thickness_input:[{type:o.Input,args:["rulerSettings.horizontalRuler.thickness"]}],rulerSettings_verticalRuler_input:[{type:o.Input,args:["rulerSettings.verticalRuler"]}],rulerSettings_verticalRuler_interval_input:[{type:o.Input,args:["rulerSettings.verticalRuler.interval"]}],rulerSettings_verticalRuler_segmentWidth_input:[{type:o.Input,args:["rulerSettings.verticalRuler.segmentWidth"]}],rulerSettings_verticalRuler_arrangeTick_input:[{type:o.Input,args:["rulerSettings.verticalRuler.arrangeTick"]}],rulerSettings_verticalRuler_tickAlignment_input:[{type:o.Input,args:["rulerSettings.verticalRuler.tickAlignment"]}],rulerSettings_verticalRuler_markerColor_input:[{type:o.Input,args:["rulerSettings.verticalRuler.markerColor"]}],rulerSettings_verticalRuler_length_input:[{type:o.Input,args:["rulerSettings.verticalRuler.length"]}],rulerSettings_verticalRuler_thickness_input:[{type:o.Input,args:["rulerSettings.verticalRuler.thickness"]}],snapSettings_enableSnapToObject_input:[{type:o.Input,args:["snapSettings.enableSnapToObject"]}],snapSettings_horizontalGridLines_input:[{type:o.Input,args:["snapSettings.horizontalGridLines"]}],snapSettings_horizontalGridLines_lineColor_input:[{type:o.Input,args:["snapSettings.horizontalGridLines.lineColor"]}],snapSettings_horizontalGridLines_lineDashArray_input:[{type:o.Input,args:["snapSettings.horizontalGridLines.lineDashArray"]}],snapSettings_horizontalGridLines_linesInterval_input:[{type:o.Input,args:["snapSettings.horizontalGridLines.linesInterval"]}],snapSettings_horizontalGridLines_snapInterval_input:[{type:o.Input,args:["snapSettings.horizontalGridLines.snapInterval"]}],snapSettings_snapAngle_input:[{type:o.Input,args:["snapSettings.snapAngle"]}],snapSettings_snapConstraints_input:[{type:o.Input,args:["snapSettings.snapConstraints"]}],snapSettings_snapObjectDistance_input:[{type:o.Input,args:["snapSettings.snapObjectDistance"]}],snapSettings_verticalGridLines_input:[{type:o.Input,args:["snapSettings.verticalGridLines"]}],snapSettings_verticalGridLines_lineColor_input:[{type:o.Input,args:["snapSettings.verticalGridLines.lineColor"]}],snapSettings_verticalGridLines_lineDashArray_input:[{type:o.Input,args:["snapSettings.verticalGridLines.lineDashArray"]}],snapSettings_verticalGridLines_linesInterval_input:[{type:o.Input,args:["snapSettings.verticalGridLines.linesInterval"]}],snapSettings_verticalGridLines_snapInterval_input:[{type:o.Input,args:["snapSettings.verticalGridLines.snapInterval"]}],tooltip_alignment_input:[{type:o.Input,args:["tooltip.alignment"]}],tooltip_alignment_horizontal_input:[{type:o.Input,args:["tooltip.alignment.horizontal"]}],tooltip_alignment_vertical_input:[{type:o.Input,args:["tooltip.alignment.vertical"]}],tooltip_margin_input:[{type:o.Input,args:["tooltip.margin"]}],tooltip_relativeMode_input:[{type:o.Input,args:["tooltip.relativeMode"]}],tooltip_templateId_input:[{type:o.Input,args:["tooltip.templateId"]}],connectors_input:[{type:o.Input,args:["connectors"]}],nodes_input:[{type:o.Input,args:["nodes"]}],layers_input:[{type:o.Input,args:["layers"]}],contextMenu_items_input:[{type:o.Input,args:["contextMenu.items"]}],nodes_class_attributes_input:[{type:o.Input,args:["nodes.class.attributes"]}],nodes_class_methods_input:[{type:o.Input,args:["nodes.class.methods"]}],nodes_enumeration_members_input:[{type:o.Input,args:["nodes.enumeration.members"]}],nodes_interface_attributes_input:[{type:o.Input,args:["nodes.interface.attributes"]}],nodes_interface_methods_input:[{type:o.Input,args:["nodes.interface.methods"]}],nodes_subProcess_events_input:[{type:o.Input,args:["nodes.subProcess.events"]}],selectedItems_userHandles_input:[{type:o.Input,args:["selectedItems.userHandles"]}],options:[{type:o.Input,args:["options"]}],autoScrollChange_output:[{type:o.Output,args:["autoScrollChange"]}],click_output:[{type:o.Output,args:["click"]}],ejclick_output:[{type:o.Output,args:["ejclick"]}],connectionChange_output:[{type:o.Output,args:["connectionChange"]}],connectorCollectionChange_output:[{type:o.Output,args:["connectorCollectionChange"]}],connectorSourceChange_output:[{type:o.Output,args:["connectorSourceChange"]}],connectorTargetChange_output:[{type:o.Output,args:["connectorTargetChange"]}],contextMenuBeforeOpen_output:[{type:o.Output,args:["contextMenuBeforeOpen"]}],contextMenuClick_output:[{type:o.Output,args:["contextMenuClick"]}],doubleClick_output:[{type:o.Output,args:["doubleClick"]}],drag_output:[{type:o.Output,args:["drag"]}],dragEnter_output:[{type:o.Output,args:["dragEnter"]}],dragLeave_output:[{type:o.Output,args:["dragLeave"]}],dragOver_output:[{type:o.Output,args:["dragOver"]}],drop_output:[{type:o.Output,args:["drop"]}],editorFocusChange_output:[{type:o.Output,args:["editorFocusChange"]}],groupChange_output:[{type:o.Output,args:["groupChange"]}],historyChange_output:[{type:o.Output,args:["historyChange"]}],itemClick_output:[{type:o.Output,args:["itemClick"]}],mouseEnter_output:[{type:o.Output,args:["mouseEnter"]}],mouseLeave_output:[{type:o.Output,args:["mouseLeave"]}],mouseOver_output:[{type:o.Output,args:["mouseOver"]}],nodeCollectionChange_output:[{type:o.Output,args:["nodeCollectionChange"]}],propertyChange_output:[{type:o.Output,args:["propertyChange"]}],rotationChange_output:[{type:o.Output,args:["rotationChange"]}],scrollChange_output:[{type:o.Output,args:["scrollChange"]}],segmentChange_output:[{type:o.Output,args:["segmentChange"]}],selectionChange_output:[{type:o.Output,args:["selectionChange"]}],sizeChange_output:[{type:o.Output,args:["sizeChange"]}],textChange_output:[{type:o.Output,args:["textChange"]}],create_output:[{type:o.Output,args:["create"]}],setTool_output:[{type:o.Output,args:["setTool"]}],tag_commandManager_commands:[{type:o.ContentChild,args:[r]}],tag_connectors:[{type:o.ContentChild,args:[u]}],tag_nodes:[{type:o.ContentChild,args:[x]}]},e}(n.EJComponents);e.DiagramComponent=D,e.EJ_DIAGRAM_COMPONENTS=[D,r,d,g,u,p,_,y,x,s,l,h,c,m,f,v,b]},1495:function(t,e,i){"use strict";var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();Object.defineProperty(e,"__esModule",{value:!0}),i(1036);var n=i(12),o=i(5),s=function(t){function e(e,i,a,n){var o=t.call(this,"Overview",e,i,[],a,n)||this;return o.el=e,o.cdRef=i,o._ejIterableDiffers=a,o._ejkeyvaluediffers=n,o}return a(e,t),e.decorators=[{type:o.Component,args:[{selector:"ej-overview",template:""}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.ChangeDetectorRef},{type:o.IterableDiffers},{type:o.KeyValueDiffers}]},e.propDecorators={sourceID_input:[{type:o.Input,args:["sourceID"]}],height_input:[{type:o.Input,args:["height"]}],width_input:[{type:o.Input,args:["width"]}],options:[{type:o.Input,args:["options"]}]},e}(n.EJComponents);e.OverviewComponent=s,e.EJ_OVERVIEW_COMPONENTS=[s]},1517:function(t,e,i){"use strict";var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();Object.defineProperty(e,"__esModule",{value:!0}),i(1036);var n=i(12),o=i(5),s=function(t){function e(e,i,a,n){var s=t.call(this,"SymbolPalette",e,i,[],a,n)||this;return s.el=e,s.cdRef=i,s._ejIterableDiffers=a,s._ejkeyvaluediffers=n,s.selectionChange_output=new o.EventEmitter,s}return a(e,t),e.decorators=[{type:o.Component,args:[{selector:"ej-symbolpalette",template:""}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.ChangeDetectorRef},{type:o.IterableDiffers},{type:o.KeyValueDiffers}]},e.propDecorators={allowDrag_input:[{type:o.Input,args:["allowDrag"]}],cssClass_input:[{type:o.Input,args:["cssClass"]}],defaultSettings_input:[{type:o.Input,args:["defaultSettings"]}],diagramId_input:[{type:o.Input,args:["diagramId"]}],headerHeight_input:[{type:o.Input,args:["headerHeight"]}],height_input:[{type:o.Input,args:["height"]}],paletteItemHeight_input:[{type:o.Input,args:["paletteItemHeight"]}],paletteItemWidth_input:[{type:o.Input,args:["paletteItemWidth"]}],previewHeight_input:[{type:o.Input,args:["previewHeight"]}],previewOffset_input:[{type:o.Input,args:["previewOffset"]}],previewWidth_input:[{type:o.Input,args:["previewWidth"]}],showPaletteItemText_input:[{type:o.Input,args:["showPaletteItemText"]}],width_input:[{type:o.Input,args:["width"]}],defaultSettings_node_input:[{type:o.Input,args:["defaultSettings.node"]}],defaultSettings_connector_input:[{type:o.Input,args:["defaultSettings.connector"]}],palettes_input:[{type:o.Input,args:["palettes"]}],options:[{type:o.Input,args:["options"]}],selectionChange_output:[{type:o.Output,args:["selectionChange"]}]},e}(n.EJComponents);e.SymbolPaletteComponent=s,e.EJ_SYMBOLPALETTE_COMPONENTS=[s]},1733:function(t,e){t.exports='<ej-diagram width="100%" height="600" [pageSettings]="pageSettings" [enableContextMenu]="enableContextMenu">\r\n\t<e-nodes>\r\n            <e-node name ="NewIdea" type = "flow" [width]="150" [height]="60" [offsetX]="300" [offsetY]="60" fillColor="#1BA0E2" borderColor="#1BA0E2" \r\n                 shape="terminator" >\r\n                <e-nodelabels>\r\n                    <e-nodelabel text="New Idea Identified" fontColor="white"></e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n            <e-node name ="Meeting" type = "flow" shape="process" [width]="150" [height]="60" [offsetX]="300" [offsetY]="155" fillColor="#1BA0E2" borderColor="#1BA0E2">\r\n                <e-nodelabels>\r\n                    <e-nodelabel text="Meeting with board" fontColor="white"></e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n            <e-node name ="BoardDecision" type = "flow" shape="decision" [width]="150" [height]="110" [offsetX]="300" [offsetY]="280" fillColor="#1BA0E2" borderColor="#1BA0E2">                 \r\n                <e-nodelabels>\r\n                    <e-nodelabel text="Board decides whether to proceed" [margin]="margin" fontColor="white">                        \r\n                    </e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n            <e-node name ="Project" type = "flow" shape="decision" [width]="140" [height]="100" [offsetX]="300" [offsetY]="430" fillColor="#1BA0E2" borderColor="#1BA0E2">                 \r\n                 <e-nodelabels>\r\n                    <e-nodelabel text="Find Project manager" [margin]="margin" fontColor="white"></e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n            <e-node name ="End" type = "flow" shape="process" [width]="150" [height]="60" [offsetX]="300" [offsetY]="555" fillColor="#1BA0E2" borderColor="#1BA0E2">\r\n                <e-nodelabels>\r\n                    <e-nodelabel text="Implement and Deliver" fontColor="white"></e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n            <e-node name ="Decision" type = "flow"  shape="card" [width]="250" [height]="60" [offsetX]="550" [offsetY]="60" fillColor="#858585" borderColor="#1BA0E2">                   \r\n                 <e-nodelabels>\r\n                    <e-nodelabel text="Decision Process for new software ideas" fontColor="white"></e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n            <e-node name ="Reject" type = "flow"  shape="process" [width]="150" [height]="60" [offsetX]="550" [offsetY]="280" fillColor="#1BA0E2" borderColor="#1BA0E2">\r\n                <e-nodelabels>\r\n                    <e-nodelabel text="Reject and write report" fontColor="white"></e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n            <e-node name ="Resources" type = "flow"  shape="process" [width]="150" [height]="60" [offsetX]="550" [offsetY]="430" fillColor="#1BA0E2" borderColor="#1BA0E2">\r\n                <e-nodelabels>\r\n                    <e-nodelabel text="Hire new resources" fontColor="white"></e-nodelabel>\r\n                </e-nodelabels>\r\n            </e-node>\r\n        </e-nodes>\r\n         <e-connectors>\r\n            <e-connector name="Connector1" sourceNode="NewIdea" targetNode="Meeting" lineColor="#606060">\r\n            </e-connector>\r\n            <e-connector name="Connector2" sourceNode="Meeting" targetNode="BoardDecision" lineColor="#606060">\r\n            </e-connector>\r\n          <e-connector name="Connector3" sourceNode="BoardDecision" targetNode="Reject" lineColor="#606060">   \r\n                <e-connectorlabels>\r\n                    <e-connectorlabel text="No" fillColor="white"></e-connectorlabel>\r\n                </e-connectorlabels>\r\n            </e-connector>\r\n            <e-connector name="Connector4" sourceNode="BoardDecision" targetNode="Project" lineColor="#606060">\r\n                <e-connectorlabels>\r\n                    <e-connectorlabel text="Yes" fillColor="white"></e-connectorlabel>\r\n                </e-connectorlabels>\r\n            </e-connector>\r\n            <e-connector name="Connector5" sourceNode="Project" targetNode="Resources" lineColor="#606060">              \r\n                <e-connectorlabels>\r\n                    <e-connectorlabel text="No" fillColor="white"></e-connectorlabel>\r\n                </e-connectorlabels>\r\n            </e-connector>\r\n            <e-connector name="Connector6" sourceNode="Project" targetNode="End" lineColor="#606060">   \r\n                <e-connectorlabels>\r\n                    <e-connectorlabel text="Yes" fillColor="white"></e-connectorlabel>\r\n                </e-connectorlabels>\r\n            </e-connector>\r\n        </e-connectors>\r\n\t\t</ej-diagram>'},1734:function(t,e){t.exports=' <ej-diagram id="diagramCore" width="100%" height="450" [pageSettings]="pageSettings" [snapSettings]="snapSettings" \r\n    [dataSourceSettings]="dataSourceSettings" [layout]="layout" [defaultSettings]="defaultSettings" \r\n    [nodeTemplate]="nodeTemplate" [tool]="tool">\r\n </ej-diagram>'},1735:function(t,e){t.exports=' <ej-diagram id="diagramCore"  width="100%" height="490px" [pageSettings]="pageSettings" [snapSettings]="snapSettings" \r\n    [dataSourceSettings]="dataSourceSettings" [layout]="layout" [defaultSettings]="defaultSettings" \r\n    [nodeTemplate]="nodeTemplate" tools="tools" [enableContextMenu]="enableContextMenu">\r\n </ej-diagram>'},1736:function(t,e){t.exports='<ej-diagram width="100%" height="490" [pageSettings]="pageSettings" [snapSettings]="snapSettings" \r\n    [dataSourceSettings]="dataSourceSettings" [layout]="layout" [defaultSettings]="defaultSettings" \r\n    [nodeTemplate]="nodeTemplate">\r\n</ej-diagram>'},1737:function(t,e){t.exports='<ej-diagram  id="diagramCore" width="100%" height="490px" [nodes]="nodes" [snapSettings]="snapSettings" \r\n    [pageSettings]="pageSettings" [enableContextMenu]="enableContextMenu" [tool]="tool">\r\n</ej-diagram>\r\n<ej-overview  id="overview" sourceID="diagramCore" width="100%" height="560px">\r\n</ej-overview>\r\n    \r\n<style>\r\n    #diagramCore{\r\n        margin-bottom: 20px;\r\n    }\r\n</style>\r\n '},1738:function(t,e){t.exports=' <ej-diagram #diagram width="100%" height="600" [pageSettings]="pageSettings">\r\n    <e-nodes>\t\r\n        <e-node name="node1" [width]="60" [height]="60" [offsetX]="170" [offsetY]="105" borderWidth="1" borderColor="#FF8C00" [gradient]="gradient" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node2" [width]="60" [height]="90" [offsetX]="240" [offsetY]="105" borderWidth="1" borderColor="#8BB23F" [gradient]="gradient1" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node3" [width]="60" [height]="120" [offsetX]="310" [offsetY]="105" borderWidth="1" borderColor="#27A9CC" [gradient]="gradient2" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node4" [width]="60" [height]="90" [offsetX]="160" [offsetY]="255" borderWidth="1" borderColor="#FF8C00" [gradient]="gradient" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node5" [width]="90" [height]="90" [offsetX]="240" [offsetY]="255" borderWidth="1" borderColor="#8BB23F" [gradient]="gradient1" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node6" [width]="60" [height]="90" [offsetX]="320" [offsetY]="255" borderWidth="1" borderColor="#27A9CC" [gradient]="gradient2" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node7" [width]="90" [height]="60" [offsetX]="165" [offsetY]="400" borderWidth="1" borderColor="#FF8C00" [gradient]="gradient" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node8" [width]="90" [height]="60" [offsetX]="240" [offsetY]="400" borderWidth="1" borderColor="#8BB23F" [gradient]="gradient1" shape="ellipse">\r\n        </e-node>\r\n        <e-node name="node9" [width]="90" [height]="60" [offsetX]="315" [offsetY]="400" borderWidth="1" borderColor="#27A9CC" [gradient]="gradient2" shape="ellipse">\r\n        </e-node>\r\n   </e-nodes>\r\n</ej-diagram>'},1739:function(t,e){t.exports='<ej-diagram #diagram width="100%" height="490" [pageSettings]="pageSettings" \r\n    [snapSettings]="snapSettings" [dataSourceSettings]="dataSourceSettings" [layout]="layout" \r\n    [defaultSettings]="defaultSettings" [nodeTemplate]="nodeTemplate" [tool]="tool">\r\n</ej-diagram>'},1740:function(t,e){t.exports='<style>\r\n    .control_section {\r\n        height: 600px;\r\n        background-color: transparent;\r\n    }\r\n\r\n    .diagram_section {\r\n        width: calc(100% - 255px);\r\n        height: 100%;\r\n        float: left;\r\n    }\r\n\r\n    .middle_section {\r\n        float: left;\r\n        width: 5px;\r\n        height: 100%;\r\n    }\r\n\r\n    .symPalette_section {\r\n        width: 250px;\r\n        height: 100%;\r\n        float: left;\r\n    }\r\n    #symbolpalette{\r\n        display: inline-block;\r\n    }\r\n</style>\r\n\r\n<div class="cols-sample-area" align="center">\r\n    <div class="control_section">\r\n        <div class="symPalette_section">\r\n            <ej-symbolpalette   id="symbolpalette" diagramId="diagramCore" [palettes]="palettes" height="600px" width="250px" [paletteItemWidth]="50" [paletteItemHeight]="50" [previewWidth]="100" [previewHeight]="100" [showPaletteItemText]="showPaletteItemText">\r\n            </ej-symbolpalette>\r\n        </div>\r\n        <div class="middle_section"></div>\r\n        <div class="diagram_section">\r\n            <ej-diagram id="diagramCore" width="100%" height="100%" [pageSettings]="pageSettings" [nodes]="nodes" [connectors]="connectors" >\r\n            </ej-diagram>\r\n        </div>\r\n    </div>\r\n</div>\r\n'},1741:function(t,e){t.exports='<ej-diagram width="100%" height="750" [nodes]="nodes" [connectors]="connectors"  [enableContextMenu]="enableContextMenu" [pageSettings] ="pageSettings">\r\n</ej-diagram>'},430:function(t,e,i){"use strict";var a=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),o=i(78),s=i(1483),r=i(1517),l=i(1495),d=i(413),h=i(1234),g=i(1241),c=i(1235),u=i(1237),m=i(1240),p=i(1236),f=i(1239),_=i(1242),v=i(1238);e.diagramAppRoutes=[{path:"default",component:h.DefaultComponent,data:{name:"Default Functionalities",location:"app/components/diagram/default.component"}},{path:"swimlane",component:g.SwimlaneComponent,data:{name:"Swimlane",location:"app/components/diagram/swimlane.component"}},{path:"hierarchicallayout",component:c.HierarchicalLayoutComponent,data:{name:"Hierarchical Layout",location:"app/components/diagram/hierarchicallayout.component"}},{path:"organizationalchart",component:u.OrganizationalChartComponent,data:{name:"Organizational Chart",location:"app/components/diagram/organizationalchart.component"}},{path:"radialtree",component:m.RadialTreeComponent,data:{name:"Radial Tree",location:"app/components/diagram/radialtree.component"}},{path:"localdatabinding",component:p.LocalDataBindingComponent,data:{name:"Local Data Binding",location:"app/components/diagram/localdatabinding.component"}},{path:"pagesettings",component:f.PageSettingsComponent,data:{name:"Page Settings",location:"app/components/diagram/pagesettings.component"}},{path:"overview",component:v.OverviewComponent,data:{name:"Overview",location:"app/components/diagram/overview.component"}},{path:"umldiagram",component:_.UMLDiagramComponent,data:{name:"UML Diagram",location:"app/components/diagram/umldiagram.component"}},{path:"",redirectTo:"default"}],e.DiagramRouting=o.RouterModule.forChild(e.diagramAppRoutes);var y=function(){function t(){}return t=a([n.NgModule({imports:[e.DiagramRouting,d.SharedModule],declarations:[h.DefaultComponent,s.EJ_DIAGRAM_COMPONENTS,r.EJ_SYMBOLPALETTE_COMPONENTS,l.EJ_OVERVIEW_COMPONENTS,g.SwimlaneComponent,c.HierarchicalLayoutComponent,u.OrganizationalChartComponent,m.RadialTreeComponent,p.LocalDataBindingComponent,f.PageSettingsComponent,v.OverviewComponent,_.UMLDiagramComponent]})],t)}();e.DiagramModule=y}});