webpackJsonp([20],{1009:function(e,t,i){var r,l,n;
/*!
*  filename: ej.olap.base.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.olap.base.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(s){l=[i(4)],void 0===(n="function"==typeof(r=s)?r.apply(t,l):r)||(e.exports=n)}(function(){!function(e,t,i){t.olap=t.olap||{},t.olap.base={_initProperties:function(){this._columnHeaders=[],this._rowHeaders=[],this._valueCells=[],this.pivotEngine=[],this.olapCtrlObj=null,this._cBIndx=null,this._rBIndx=null,this._OlapDataSource,this._measureDt={},this._cTotIndexInfo=null,this._rTotIndexInfo=null,this._kpi=null,this._rowCount=0,this._colCount=0,this._isPaging=!1,this._indexRCell=0,this._indexCCell=0},_initControlProperties:function(e){e._drilledCellSet=e.model.enablePaging||e.model.enableVirtualScrolling?t.isNullOrUndefined(e._drilledCellSet)?[]:e._drilledCellSet:[],e.XMLACellSet=null,e._isMondrian=e.model.dataSource.providerName==t.olap.Providers.Mondrian,(t.isNullOrUndefined(e._fieldData)||!t.isNullOrUndefined(e._fieldData)&&t.isNullOrUndefined(e._fieldData.hierarchy))&&this._getFieldItemsInfo(e),this._currIndex={},this._isRowDrilled=!1,this._isColDrilled=!1,this._isNoSummary="nosummaries"==e.model.layout},getJSONData:function(i,r,l){var n,s,o;i.action&&("initialLoad"==i.action||"navPaging"==i.action)&&(this._initControlProperties(l),this._applyTrim(l)),"loadFieldElements"==i.action&&(l._baseSavedProperties=e.extend(!0,{},{drilledCellSet:l._drilledCellSet,XMLACellSet:l.XMLACellSet,columnHeaders:this._columnHeaders,rowHeaders:this._rowHeaders,valueCells:this._valueCells,pivotEngine:this.pivotEngine,olapCtrlObj:this.olapCtrlObj,cBIndx:this._cBIndx,rBIndx:this._rBIndx,OlapDataSource:this._OlapDataSource,measureDt:this._measureDt,cTotIndexInfo:this._cTotIndexInfo,rTotIndexInfo:this._rTotIndexInfo,kpi:this._kpi,rowCount:this._rowCount,colCount:this._colCount,isPaging:this._isPaging,indexRCell:this._indexRCell,indexCCell:this._indexCCell})),this._initProperties(),this.olapCtrlObj=l,this._OlapDataSource=r,r.data,l.model.enableGroupingBar&&"loadFieldElements"!=i.action&&l._createGroupingBar(r),this._isPaging=!(!this.olapCtrlObj.model.enablePaging&&!this.olapCtrlObj.model.enableVirtualScrolling||t.isNullOrUndefined(this._OlapDataSource.pagerOptions)||0==this._OlapDataSource.pagerOptions.categoricalPageSize||0==this._OlapDataSource.pagerOptions.seriesPageSize),n=r.MDXQuery?r.MDXQuery:this._getParsedMDX(r,r.cube,!(!i.action||"navPaging"==i.action||!this._isPaging||t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions))),o=this._getConnectionInfo(this.olapCtrlObj.model.dataSource.data),s=t.isNullOrUndefined(r.providerName)||r.providerName==t.olap.Providers.SSAS?'<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+n+" </Statement> </Command> <Properties> <PropertyList> <Catalog>"+r.catalog+"</Catalog> <LocaleIdentifier>"+o.LCID+"</LocaleIdentifier> </PropertyList> </Properties></Execute> </Body> </Envelope>":'<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement><![CDATA['+n+"]]></Statement></Command><Properties><PropertyList><DataSourceInfo>"+r.sourceInfo+"</DataSourceInfo><Catalog>"+r.catalog+"</Catalog><AxisFormat>TupleFormat</AxisFormat><Content>Data</Content><Format>Multidimensional</Format></PropertyList></Properties></Execute></SOAP-ENV:Body></SOAP-ENV:Envelope>","drilldown"!=i.action||this._isPaging?this.olapCtrlObj.doAjaxPost("POST",o.url,{XMLA:s},i.action&&"navPaging"!=i.action&&this._isPaging&&!t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)?this._generatePagingData:this._generateJSONData,null,i):this.olapCtrlObj.doAjaxPost("POST",o.url,{XMLA:s},this._onDemandExpand,null,i)},_getParsedMDX:function(e,r,l){var n,s,o,a,d,h;if(e!=i){if(n="",(d=e.providerName==t.olap.Providers.Mondrian)&&0==e.columns.length&&!("columns"==e.values[0].axis&&e.values[0].measures.length>0))return"";s=t.olap._mdxParser._getRowMDX(e),o=t.olap._mdxParser._getcolumnMDX(e),delete e._isCollapse,s=s.length>0?this._isPaging&&!l||d?"("+s+")":"NON EMPTY("+s+")":"",o=o.length>0?this._isPaging&&!l||d?"("+o+")":"NON EMPTY("+o+")":"",!this._isPaging||l||t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)||(s=(h=this._getPagingQuery(s,o)).rowQuery,o=h.columnQuery),a=t.olap._mdxParser._getSlicerMDX(e,this.olapCtrlObj),n="\nSelect \n"+(""==o?"{}":o)+"\ndimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON COLUMNS \n"+(""==s?"":","+s+"\ndimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON ROWS")+"\n "+t.olap._mdxParser._getIncludefilterQuery(e,r,this.olapCtrlObj)+a+"\n CELL PROPERTIES VALUE, FORMAT_STRING, FORMATTED_VALUE \n ",""==o&&n.replace(/NON EMPTY/g," "),n=this._getCalculatedItems(n)}return n},_getCalculatedItems:function(i){var r,l,n=this.olapCtrlObj.model.calculatedMembers;if(n&&n.length>0){for(r="\nWITH",l=0;l<n.length;l++){var s=(n[l].expression.indexOf("Measure")>-1?"[Measures].":n[l].hierarchyUniqueName+".")+"["+(n[l].caption||n[l].name)+"]",o=t.isNullOrUndefined(n[l].formatString)?t.isNullOrUndefined(n[l].format)?null:n[l].format:n[l].formatString;r+="\n MEMBER "+s+" as ("+n[l].expression+" ) "+(t.isNullOrUndefined(o)?"":', FORMAT_STRING ="'+e.trim(o)+'"')}return(r=r.replace(/\&/g,"&amp;"))+" "+i}return i},_getPagingQuery:function(e,t){var i=Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj._categCurrentPage)&&this._colCount>0?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize):this.olapCtrlObj._categCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage),r=Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj._seriesCurrentPage)&&this._rowCount>0?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize):this.olapCtrlObj._seriesCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage),l=e;return{rowQuery:""!=e?"SUBSET({"+(this.olapCtrlObj._isMondrian?"":"NONEMPTY")+"("+e+(this.olapCtrlObj._isMondrian||""==t?"":","+t)+")},"+((0==r?1:r)-1)*this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize+","+this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize+")":"",columnQuery:""!=t?"SUBSET({"+(this.olapCtrlObj._isMondrian?"":"NONEMPTY")+"("+t+(this.olapCtrlObj._isMondrian||""==l?"":","+l)+")},"+((0==i?1:i)-1)*this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize+","+this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize+")":""}},_getAxisElementsUName:function(e){for(var t="",i=0;i<e.length;i++)t+=""==t?"{"+e[i].uniqueName+"}":", {"+e[i].uniqueName+"}";return t},_generatePagingData:function(i,r){var l,n,s;if(e(r).find("Error").length>0)return t.Pivot._createErrorDialog(e(r).find("faultstring").text(),i.action,this.olapCtrlObj),!1;l=e(r).find("Axes, CellData"),this._rowCount=e(l.find("Axis[name|='Axis1']").find("Tuples")).length>0?e(l.find("Axis[name|='Axis1']").find("Tuples")[0]).children().length:0,this._colCount=e(l.find("Axis[name|='Axis0']").find("Tuples")).length>0?e(l.find("Axis[name|='Axis0']").find("Tuples")[0]).children().length:0,n=this._getParsedMDX(this.olapCtrlObj.model.dataSource,this.olapCtrlObj.model.dataSource.cube,!1),s=this._getConnectionInfo(this.olapCtrlObj.model.dataSource.data),this.olapCtrlObj._isMondrian&&(this._controlObj=this.olapCtrlObj),this.olapCtrlObj.doAjaxPost("POST",s.url,{XMLA:t.olap._mdxParser.getSoapMsg(n,this.olapCtrlObj.model.dataSource.data,this.olapCtrlObj.model.dataSource.catalog)},this._generateJSONData,null,i)},_generateJSONData:function(r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f;if(this.olapCtrlObj.model.dataSource=this._OlapDataSource,this._isPaging&&"drilldown"==r.action&&this._onDemandExpand(r,l),n=[],s=[],e(l).find("Error").length>0)return t.Pivot._createErrorDialog(e(l).find("faultstring").text(),"Error",this.olapCtrlObj),!1;if(e(l).find("Axis[name|='SlicerAxis']").remove(),this.olapCtrlObj.XMLACellSet=e(l).find("Axes, CellData"),[],"onDemandDrill"==r&&(this.olapCtrlObj.XMLACellSet=l),o=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple"),a=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple"),o.length>0){if(d=e(this.olapCtrlObj.XMLACellSet[1]).children(),this._rowHeaders=this._getHeaderCollection(a,"rowheader"),this._columnHeaders=this._getHeaderCollection(o,"colheader"),this._valueCells=this._getValueCells(d,o.length),this._indexRCell="rowheader"==this._measureDt.axis?t.sum(this._rowHeaders.maxLvlLen)+1:t.sum(this._rowHeaders.maxLvlLen),this._indexCCell="colheader"==this._measureDt.axis?t.sum(this._columnHeaders.maxLvlLen)+1:t.sum(this._columnHeaders.maxLvlLen),this._rowHeaders.headers.length>0&&0==t.sum(this._rowHeaders.maxLvlLen)&&(this._indexRCell=this._rowHeaders.headers[0].length),this._columnHeaders.headers.length>0&&0==t.sum(this._columnHeaders.maxLvlLen)&&(this._indexCCell=this._columnHeaders.headers[0].length),this._isPaging)for(m=0;m<this._rowHeaders.headers.length;m++)for(f=0;f<this._columnHeaders.headers.length;f++)t.isNullOrUndefined(this._valueCells[m])?(this._valueCells[m]=[],this._valueCells[m][f]={FormatString:"#,#",Value:""}):t.isNullOrUndefined(this._valueCells[m][f])&&(this._valueCells[m][f]={FormatString:"#,#",Value:""});for(this._populateEngine(this._rowHeaders.headers,this._columnHeaders.headers,this._valueCells),e(this.olapCtrlObj).find(".e-pivotGridTable").remove(),this.olapCtrlObj._measureDt=this._measureDt,h=this._rowHeaders.headers.length+this._indexCCell,c=this._columnHeaders.headers.length+this._indexRCell,this.pivotEngine.length>1&&(h=this.pivotEngine.length),m=0;m<h;m++)for(f=0;f<c;f++)n[f]==i&&(n[f]=[]),this.pivotEngine[m]!=i&&this.pivotEngine[m][f]!=i?(n[f][m]={Index:f+","+m,CSS:""==this.pivotEngine[m][f].CSS?"none":this.pivotEngine[m][f].CSS==i?"value":this.pivotEngine[m][f].CSS,Value:this.pivotEngine[m][f].Value,State:this.pivotEngine[m][f].ChildCount>0?2:this.pivotEngine[m][f].ChildCount<0?1:0,RowSpan:this.pivotEngine[m][f].RowSpan!=i?this.pivotEngine[m][f].RowSpan:1,ColSpan:this.pivotEngine[m][f].ColSpan!=i?this.pivotEngine[m][f].ColSpan:1,Info:this.pivotEngine[m][f].UName+"::"+this.pivotEngine[m][f].LName+"::"+this.pivotEngine[m][f].Value+"::"+this.pivotEngine[m][f].PUName,Span:"Block"==this.pivotEngine[m][f].Span?"Block":"None",Expander:1},this.pivotEngine[m][f].kpiInfo&&(n[f][m].kpi=this.pivotEngine[m][f].kpi,n[f][m].kpiInfo=this.pivotEngine[m][f].kpiInfo),this.pivotEngine[m][f].ActualValue&&(n[f][m].ActualValue=this.pivotEngine[m][f].ActualValue,n[f][m].Format=this.pivotEngine[m][f].FormatString)):this.pivotEngine[m]!=i&&(u="none",m<this._indexCCell&&f<this._indexRCell&&(u="rowheader"),n[f][m]={Index:f+","+m,CSS:u,Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"Block",Expander:0});for(m=0;m<c;m++)for(f=0;f<h;f++)n[m]!=i&&n[m][f]!=i&&s.push(n[m][f]);for(g=0,p=0;p<s.length&&0==parseInt(s[p].Index.split(",")[0]);p++)g++}if(this.olapCtrlObj._isExporting&&this.olapCtrlObj.model.enableCompleteDataExport){for(f=0;f<this._indexRCell;f++)for(_="",m=this._indexCCell;m<n[0].length;m++)""!=n[f][m].Info&&(_==n[f][m].Info?n[f][m].Span="Block":_=n[f][m].Info);for(m=0;m<this._indexCCell;m++)for(_="",f=this._indexRCell;f<n.length;f++)""!=n[f][m].Info&&(_==n[f][m].Info?n[f][m].Span="Block":_=n[f][m].Info);this.olapCtrlObj._fullExportedData={jsonObj:s,tranposeEngine:n,rowCount:g},this.olapCtrlObj._drilledCellSet=this.olapCtrlObj._baseSavedProperties.drilledCellSet,this.olapCtrlObj.XMLACellSet=this.olapCtrlObj._baseSavedProperties.XMLACellSet,this._columnHeaders=this.olapCtrlObj._baseSavedProperties.columnHeaders,this._rowHeaders=this.olapCtrlObj._baseSavedProperties.rowHeaders,this._valueCells=this.olapCtrlObj._baseSavedProperties.valueCells,this.pivotEngine=this.olapCtrlObj._baseSavedProperties.pivotEngine,this.olapCtrlObj=this.olapCtrlObj._baseSavedProperties.olapCtrlObj,this._cBIndx=this.olapCtrlObj._baseSavedProperties.cBIndx,this._rBIndx=this.olapCtrlObj._baseSavedProperties.rBIndx,this._OlapDataSource=this.olapCtrlObj._baseSavedProperties.OlapDataSource,this._measureDt=this.olapCtrlObj._baseSavedProperties.measureDt,this._cTotIndexInfo=this.olapCtrlObj._baseSavedProperties.cTotIndexInfo,this._rTotIndexInfo=this.olapCtrlObj._baseSavedProperties.rTotIndexInfo,this._kpi=this.olapCtrlObj._baseSavedProperties.kpi,this._rowCount=this.olapCtrlObj._baseSavedProperties.rowCount,this._colCount=this.olapCtrlObj._baseSavedProperties.colCount,this._isPaging=this.olapCtrlObj._baseSavedProperties.isPaging,this._indexRCell=this.olapCtrlObj._baseSavedProperties.indexRCell,this._indexCCell=this.olapCtrlObj._baseSavedProperties.indexCCell,this.olapCtrlObj._baseSavedProperties={}}else this.olapCtrlObj._pivotRecords={records:s,rowCount:g},"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotGrid"!=this.olapCtrlObj.pluginName?"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotChart"!=this.olapCtrlObj.pluginName&&"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotGauge"!=this.olapCtrlObj.pluginName&&"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotTreeMap"!=this.olapCtrlObj.pluginName?(this._renderPager(r),this.olapCtrlObj.generateJSON({baseObj:this,tranposeEngine:n,jsonObj:s})):(this.olapCtrlObj.generateJSON({baseObj:this},n),this._isPaging&&this._renderPager(r)):this._renderPivotGrid(r,s),this._columnHeaders=this._rowHeaders=this._valueCells=this.pivotEngine=[],this._cBIndx=this._rBIndx=null,this._measureDt={axis:"",posision:null},this._cTotIndexInfo=this._rTotIndexInfo=null},_renderPager:function(e){var i,r,l,n;this._isPaging&&("navPaging"!=e.action&&(t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)?this.olapCtrlObj.model.enablePaging&&(l={CategoricalCurrentPage:1,CategoricalPageSize:1,SeriesCurrentPage:1,SeriesPageSize:1},n={Column:1,Row:1},this.olapCtrlObj._pagerObj.initPagerProperties(n,l),this.olapCtrlObj._pagerObj.element.css("opacity","0.5"),this.olapCtrlObj._pagerObj.element.find(".e-pagerTextBox").attr("disabled","disabled"),this.olapCtrlObj._pagerObj._unwireEvents()):(i=Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj._categCurrentPage)?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize):this.olapCtrlObj._categCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage),r=Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj._seriesCurrentPage)?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize):this.olapCtrlObj._seriesCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage),i=0==i?1:i,r=0==r?1:r,this._colCount=0==this._colCount?1:this._colCount,this._rowCount=0==this._rowCount?1:this._rowCount,this.olapCtrlObj.model.enablePaging?(l={CategoricalCurrentPage:i,CategoricalPageSize:this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize,SeriesCurrentPage:r,SeriesPageSize:this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize},n={Column:this._colCount,Row:this._rowCount},this.olapCtrlObj._pagerObj.element.css("opacity","1"),this.olapCtrlObj._pagerObj.element.find(".e-pagerTextBox").removeAttr("disabled"),this.olapCtrlObj._pagerObj._unwireEvents(),this.olapCtrlObj._pagerObj._wireEvents(),this.olapCtrlObj._pagerObj.initPagerProperties(n,l)):this.olapCtrlObj.model.enableVirtualScrolling&&(this.olapCtrlObj._categPageCount=Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize),this.olapCtrlObj._seriesPageCount=Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)),this.olapCtrlObj._categCurrentPage=i,this.olapCtrlObj._seriesCurrentPage=r,t.isNullOrUndefined(this.olapCtrlObj._pivotGrid)||(this.olapCtrlObj._pivotGrid._categCurrentPage=i,this.olapCtrlObj._pivotGrid._seriesCurrentPage=r,this.olapCtrlObj._pivotGrid._categPageCount=this.olapCtrlObj._categPageCount,this.olapCtrlObj._pivotGrid._seriesPageCount=this.olapCtrlObj._seriesPageCount))),t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)||(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage=this.olapCtrlObj._categCurrentPage,this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage=this.olapCtrlObj._seriesCurrentPage))},_renderPivotGrid:function(e,i){this.olapCtrlObj._dataModel="XMLA",this.olapCtrlObj.setJSONRecords(JSON.stringify(i)),this.olapCtrlObj.setOlapReport(this.olapCtrlObj.model.dataSource),this._renderPager(e),this.olapCtrlObj.model.enableGroupingBar&&this.olapCtrlObj._createGroupingBar(this.olapCtrlObj.model.dataSource),null!=this.olapCtrlObj.model.layout&&this.olapCtrlObj.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this.olapCtrlObj.excelLikeLayout(i):this.olapCtrlObj.renderControlFromJSON(i),e.action&&("initialLoad"==e.action||"navPaging"==e.action)&&(this.olapCtrlObj._trigger("renderSuccess",this.olapCtrlObj),this.olapCtrlObj._fieldData={hierarchy:this.olapCtrlObj._fieldData.hierarchy,measures:this.olapCtrlObj._fieldData.measures})},_onDemandExpand:function(t,i){var r,l,n,s,o,a,d,h="",c=this.olapCtrlObj.XMLACellSet,u=e(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis0'] Tuple").length,g=e(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis1'] Tuple").length;g=g||1,e(i).find("CellData Cell").length,e(this.olapCtrlObj.XMLACellSet[1]).children().length,t.cellInfo.previousElements.split(">#>");var p=e(i).find("Axis[name|='Axis0']").find("Tuple"),m=e(i).find("Axis[name|='Axis1']").find("Tuple"),_=p.length;l=m.length,e(i).find("Axis[name='SlicerAxis']").remove();var f,b,C=t.cellInfo.itemPosition,S=0,x=!1,v="";for(b="rowheader"==t.cellInfo.axis?m[0]:p[0],h=f=e(b).find("Member:nth-child("+(C+1)+") PARENT_UNIQUE_NAME").text(),s=C+1;s>0;s--)c=e(c).find("Tuple Member:nth-child("+s+") UName:contains('"+f+"')").parents("tuple"),v=(f=e(b).find("Member:nth-child("+(s-1)+") UName").text())+v;if(h=v+h,n=c.index()+1,h=t.cellInfo.previousElements.split(">#>").join().replace(/,/g,""),r=t.cellInfo.preRepItm.split(">#>").join().replace(/,/g,""),this.olapCtrlObj._drilledCellSet&&(S=this.olapCtrlObj._drilledCellSet.length),h=h+" !#"+t.cellInfo.axis,this.olapCtrlObj._drilledCellSet[0]&&S)for(o=0;o<S;o++){for(a=this.olapCtrlObj._drilledCellSet[o].length,t.cellInfo.parentUniqueName,d=0;d<a;d++){if(t.cellInfo.previousElements.startsWith(this.olapCtrlObj._drilledCellSet[o][d].key)){this.olapCtrlObj._drilledCellSet[o].push({key:h,repItms:r}),x=!0;break}if(this.olapCtrlObj._drilledCellSet[o][d].key.startsWith(t.cellInfo.previousElements)){this.olapCtrlObj._drilledCellSet[o].splice(d,0,{key:h,repItms:r}),x=!0;break}}if(x)break}else this.olapCtrlObj._drilledCellSet[0]=[],this.olapCtrlObj._drilledCellSet[0][0]={key:h,repItms:r},x=!0;x||(this.olapCtrlObj._drilledCellSet[S]=[],this.olapCtrlObj._drilledCellSet[S].push({key:h,repItms:r})),this._isPaging||("rowheader"==t.cellInfo.axis?(e(i).find("Axis[name|='Axis1']").find("Tuple"),this._insertCellSet("rowheader",c,m,p,l,u,_,n,i)):(e(i).find("Axis[name|='Axis1']").find("Tuple"),this._insertCellSet("colheader",c,p,m,g,u,_,n,i)),this._generateJSONData("onDemandDrill",this.olapCtrlObj.XMLACellSet))},_insertCellSet:function(t,i,r,l,n,s,o,a,d){var h,c,u,g,p,m=e(e(d).find("CellData Cell")[0]).clone();e(m).find("FmtValue").text(""),i.length>1?e(i[0]).after(r):e(i).after(r),c=s,"rowheader"==t?h=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple"):(h=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple"),c=o);var _=0,f=e(h).filter(function(t,i){if(l[_]&&e(i).find("UName").text()==e(l[_]).find("UName").text())return _++,!0}),b=0,C=!1;for(u=0;u<n;u++){var S,x="",v=0,w=0;for(S="rowheader"==t?(a+u)*c:u*(s+c)+a,g=0;g<c;g++)"rowheader"==t&&e(f[v]).index()==g||"colheader"==t&&e(f[b]).index()==u||!h.length?(p="rowheader"==t?u*o:b*o,x=e(e(d).find("CellData Cell")[p+v]).clone(),e(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(S+w)+")").after(x),v++,C=!0):e(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(S+w)+")").after(e(m).clone()),w++;"colheader"==t&&(C&&b++,C=!1)}this._setCellOrdinal(this.olapCtrlObj.XMLACellSet[1])},_clearDrilledCellSet:function(){for(var t,i=e.extend([],this.olapCtrlObj._drilledCellSet),r="",l=0;l<i.length;l++)(r=i[l][0].key.split("!#")).length&&(t=this._getDrilledMemeber({item:{previousElements:r[0]}})),t.length&&this._onDemandCollapse({drilledMembers:t,action:""},r[1])},_onDemandCollapse:function(i,r){e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple"),e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple");try{this.olapCtrlObj.model.dataSource=t.olap._mdxParser._clearCollapsedItems(r,i.drilledMembers[i.drilledMembers.length-1],this.olapCtrlObj.model.dataSource),i.drilledMembers=i.drilledMembers.splice(0,i.drilledMembers.length-1)}catch(e){this.olapCtrlObj._ogridWaitingPopup.hide()}i.drilledMembers.length?this._onDemandCollapse({drilledMembers:i.drilledMembers,action:i.action},r):"collapse"==i.action&&(this.olapCtrlObj.model.dataSource._isCollapse=!0,delete this._currIndex.axis,this.getJSONData({action:"onDemandCollapse"},this.olapCtrlObj.model.dataSource,this.olapCtrlObj))},_removeCellSets:function(t,i,r,l,n,s){for(var o,a,d,h,c,u,g,p=t.length,m=n[0],_=0;_<i.length;_++)if(e(i[_]).find("UName").text()==e(m).find("UName").text()){g=i[_];break}if(o=p,a=e(g).index())if("rowheader"==s){for(u=r.length;o>0;)e(e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple")[a]).remove(),o--;for(c=ext=a;c<ext+p;c++)d=e(e(this.olapCtrlObj.XMLACellSet[1]).children()).splice(a*u,u),e(d).remove()}else{for(u=i.length,h=r.length;o>0;)e(e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple")[a]).remove(),o--;for(c=0;c<h;c++)d=e(e(this.olapCtrlObj.XMLACellSet[1]).children()).splice(u*c-c*p+a,p),e(d).remove()}this._setCellOrdinal(this.olapCtrlObj.XMLACellSet[1])},_getDrilledMemeber:function(t){for(var i,r,l=[],n=t.item.previousElements.split(">#>").join().replace(/,/g,""),s=this.olapCtrlObj._drilledCellSet,o=(l=e.map(this.olapCtrlObj._drilledCellSet,function(t){return l=e.map(t,function(e){if(e.key.startsWith(n))return e})}),0);o<s.length;o++)for(i=0,r=s[o];s[o]&&i<s[o].length;i++)r[i]&&r[i].key.startsWith(n)&&(r.splice(i,1),i--,r.length||(s.splice(o,1),o--));return l},_getHeaderCollection:function(t,r){var l,n,s,o,a,d,h,c,u,g,p,m,_=[],f="",b=[],C=null,S={},x={},v=this;if(l=e(t).filter(function(t,i){var l,o,a,d=e(i).find("Member"),h=!("4"==e(d[0]).find("MEMBER_TYPE").text())&&-1!=e(d[0]).find("LName").text().indexOf("[(All)]"),c=h?1:0,u=0;for(C=null,h?(s=0,f="total"):(f="",s=d.length),l=1,-1!=e(d[0]).find("LName").text().toLowerCase().indexOf("[measures]")&&(l=0);l<d.length;l++)o=!1,"colheader"==r&&v._OlapDataSource.columns[l]?(v._OlapDataSource.columns[l].hasAllMember||null!=v._OlapDataSource.columns[l].expression)&&(o=!0):"rowheader"==r&&v._OlapDataSource.rows[l]&&(v._OlapDataSource.rows[l].hasAllMember||null!=v._OlapDataSource.rows[l].expression)&&(o=!0),-1!=e(d[l]).find("LName").text().toLowerCase().indexOf("[measures]")||o?(u=h,x.axis=r,x.posision=l,4==parseInt(e(d[l]).find("MEMBER_TYPE").text())&&(-1!=(a=e(d[l]).find("UName").text().toLowerCase()).indexOf("trend]")?(v._kpi||v._loadKpi(v.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(S=v._isKpi(e(d[l]).find("UName").text(),"trend"))&&(C="trend",x.isKpiExist=!0)):-1!=a.indexOf("status]")?(v._kpi||v._loadKpi(v.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(S=v._isKpi(e(d[l]).find("UName").text(),"status"))&&(C="status",x.isKpiExist=!0)):-1!=a.indexOf("goal]")&&(v._kpi||v._loadKpi(v.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(S=v._isKpi(e(d[l]).find("UName").text()+"::"+e(d[l]).find("Caption").text(),"goal"))&&(C="goal",x.isKpiExist=!0)))):u=-1!=e(d[l]).find("LName").text().indexOf("[(All)]"),(0==h&&1==u||1==h&&0==u)&&(c++,s=l,f="total"),h=u;return n=t,c<2&&_.push({selIndx:n,totLvl:s,type:f,kpi:C,kpiInfo:S}),c<2}).map(function(t,l){for(var n,s,o,a,d=e(l).find("Member"),h=[],c=0;c<d.length;c++)n=!1,s=parseInt(e(d[c]).find("LNum").text()),"colheader"==r&&v._OlapDataSource.columns[c]?v._OlapDataSource.columns[c].hasAllMember||null!=v._OlapDataSource.columns[c].expression?s+=1:n=null!=v._OlapDataSource.columns[c].expression:"rowheader"==r&&v._OlapDataSource.rows[c]&&(v._OlapDataSource.rows[c].hasAllMember||null!=v._OlapDataSource.rows[c].expression?s+=1:n=null!=v._OlapDataSource.rows[c].expression),o=e(d[c]).find("PARENT_UNIQUE_NAME").length?e(d[c]).find("PARENT_UNIQUE_NAME").text():"",h.push({CSS:r,Value:""==e(d[c]).find("Caption").text()?"(Blank)":e(d[c]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:e(d[c]).attr("Hierarchy"),LName:e(d[c]).find("LName").text(),UName:e(d[c]).find("UName").text(),ChildCount:parseInt(e(d[c]).find("CHILDREN_CARDINALITY").text()),PUName:o,isCalcMem:n,LNum:s,MemberType:parseInt(e(d[c]).find("MEMBER_TYPE").text())}),(-1!=e(d[c]).find("LName").text().toLowerCase().indexOf("[measures]")||n)&&_[t].kpi&&(h[h.length-1].kpiInfo=_[t].kpiInfo,h[h.length-1].kpi=_[t].kpi),b[c]==i?b[c]=s:b[c]<s&&(b[c]=s);return(a=[])[0]=h,a}),"colheader"==r?this._cTotIndexInfo=_:this._rTotIndexInfo=_,l={headers:l,indxInfo:_,maxLvlLen:b},e.isEmptyObject(x)||(this._measureDt=e.extend({},x)),1,r.indexOf(this._OlapDataSource.values[0].axis.substring(0,3))>-1&&(this._measureDt.measureCount=this._OlapDataSource.values[0].measures.length),!this._OlapDataSource._enableBasicEngine&&!this._isPaging){var w={headers:[],indxInfo:[]},I=_.length,y=w.length,T=[],L=[];try{for(u=0;u<I;u++)u<I&&"total"==l.indxInfo[u].type&&(w.indxInfo.push(l.indxInfo.splice(u,1)[0]),w.headers.push(l.headers.splice(u,1)[0]),I--,u--);var R=l.headers.length>0?l.headers[0].length:0,O=0,F=0;for(this._measureDt.posision==R-1&&this._measureDt.axis==r&&(F=1),I=l.headers.length,u=0;u<=I;u++){var E=null,D=null,N=null,A=null;for(E=(A=this._updateMemberVariables(l.headers,E,D,N,u)).prev,D=A.next,N=A.cur,A=null,V=R-2-F;V>=0;V--)if(o=this._comparePrevMembers(l.headers,I,u,V,R,-2),u==I||u>0&&(E&&E[V].UName!=N[V].UName||E[V].UName==N[V].UName&&o))if(N&&E[V].UName==N[V].PUName)u-=a=this._removeSubtotalMembers(l,u,V),I-=a,E=(A=this._updateMemberVariables(l.headers,E,D,N,u)).prev,D=A.next,N=A.cur,A=null;else{var P,k=E,j=(y=0,0),M=0;for(E&&(M=E[V].LNum),N&&(j=N[V].LNum),d=!1,h=j;h<=M;h++){for(y=(P=this._getSummaryHeaders(k,w,V,d,F)).headers.length;P.headers.length>0;)l.headers.splice(u,0,P.headers.pop()),l.indxInfo.splice(u,0,P.indexInfo.pop());d=!0,u+=y,I+=y,k=l.headers[u-1]}}if(u==I&&w.headers.length>0){for(c=0;w.headers.length>0;)l.headers.splice(u,0,w.headers.pop()),l.indxInfo.splice(u,0,w.indxInfo.pop()),I++,c++;u+=c}}var V=0,B="";for(T={headers:[],indxInfo:[]},V=R-1-F,I=l.headers.length,u=0;u<I;u++)if(E=this._findPreviousMember(l.headers,u-1,V),u>0&&l.headers[u-1][V].UName!=l.headers[u][V].UName&&V==R-1-F&&b[V]>1){if(u>0&&l.headers[u]!=i&&0!=l.headers[u-1][V].LNum&&l.headers[u-1][V].UName==l.headers[u][V].PUName)for(g=E;g<0;g++)l.indxInfo[u+g].lnum=l.headers[u+g][V].LNum,l.indxInfo[u+g].type="total",T.indxInfo.push(l.indxInfo.splice(u+g,1)[0]),T.headers.push(l.headers.splice(u+g,1)[0]),u+1==I?B=l.headers[u][V].PUName:(u--,I--);0!=u&&l.headers[u]!=i&&l.headers[u-1][V].LNum>l.headers[u][V].LNum&&(p=[],I=(m=this._insertSummaryHeaders(l,T,p,u,V,R,O,B,!1,L)).itmCnt,u=m.hCnt,O=m.insCnt,L[V]=m.subPos)}}catch(e){this.olapCtrlObj._waitingPopup.hide()}}return"rowheader"==r?this._rBIndx=_:this._cBIndx=_,l},_insertSummaryHeaders:function(t,r,l,n,s,o,a,d,h,c){l=[];var u,g,p,m,_,f,b,C="";a=0;for(t.headers[n-1]&&(d=t.headers[n-1][s].PUName),p=t.headers.length,u=t.headers[n][s].LNum,g=t.headers[n-1][s].LNum,m=this._comparePrevMembers(t.headers,p,n,s,o,a),_=u;_<g;_++){for(e.grep(r.headers,function(e,r){(d==e[s].UName||t.headers[n+1+a]!=i&&t.headers[n][s].UName!=t.headers[n+1+a][s].UName&&t.headers[n][s].PUName==e[s].UName&&m)&&(C=e[s].PUName,l.push(r))}),d=C,m&&(l.reverse(),m=!1);l.length>0;){for(f=l.length-1,b=l[l.length-1],t.headers.splice(n,0,r.headers.splice(l[l.length-1],1)[0]),t.indxInfo.splice(n,0,r.indxInfo.splice(l[l.length-1],1)[0]);f>=0;)b<l[f]&&l[f]--,f--;l.pop(),p++,a++,h&&c[s]++}a>0&&(n+=a,a=0)}return{itmCnt:p,hCnt:n,insCnt:a,subPos:c[s]}},_comparePrevMembers:function(e,t,i,r,l,n){var s,o=!1;if(r>0&&i<t&&i+1+n>=0&&i+1+n<t)for(s=r-1;s>=0;s--)e[i][s].UName!=e[i+1+n][s].UName&&(o=!0);return o},_updateMemberVariables:function(e,t,i,r,l){return e[l]&&(r=e[l]),i=e[l+1]?e[l+1]:null,{cur:r,prev:e[l-1]?e[l-1]:null,next:i}},_removeSubtotalMembers:function(e,t,i){for(var r=t-1,l=e.headers[r][i].UName;e.headers[r]&&e.headers[r][i].UName==l;)e.indxInfo.splice(r,1),e.headers.splice(r,1),r--;return t-(r+1)},_getSummaryHeaders:function(t,i,r,l){var n,s=i.headers,o=t,a=r,d=[],h=[],c=i.indxInfo;return n=e.grep(s,function(e,t){for(var i=!1,r=a;r>=0&&(e[r].UName==o[r].UName||l&&r==a&&e[r].UName==o[r].PUName);r--)0==r&&(i=!0,h.push(c[t]));return i}),i.headers=e.grep(s,function(e,t){for(var i=!0,r=a;r>=0&&(e[r].UName==o[r].UName||l&&r==a&&e[r].UName==o[r].PUName);r--)0==r&&(i=!1);return i&&d.push(c[t]),i}),i.indxInfo=d,{headers:n,indexInfo:h}},_drillOrderHeaderCollection:function(t,i,r){var l=i,n=r,s=this;return e(t).map(function(t,i){var r,o,a,d,h=e(l[i.selIndx]).find("Member"),c=[];for(c[0]=[],r=0;r<h.length;r++)o=parseInt(e(h[r]).find("LNum").text()),"colheader"==n&&s._OlapDataSource.columns[r]?s._OlapDataSource.columns[r].hasAllMember&&(o+=1):"rowheader"==n&&s._OlapDataSource.rows[r]&&s._OlapDataSource.rows[r].hasAllMember&&(o+=1),a=e(h[r]).find("PARENT_UNIQUE_NAME").length?e(h[r]).find("PARENT_UNIQUE_NAME").text():"",c[0].push({CSS:n,Value:e(h[r]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:e(h[r]).attr("Hierarchy"),LName:e(h[r]).find("LName").text(),UName:e(h[r]).find("UName").text(),ChildCount:parseInt(e(h[r]).find("CHILDREN_CARDINALITY").text()),PUName:a,LNum:o,MemberType:parseInt(e(h[r]).find("MEMBER_TYPE").text())}),d=c[0][c[0].length-1],i.kpiInfo&&d.UName.toLowerCase().indexOf("[measures]")>-1&&4==d.MemberType&&(c[0][c[0].length-1].kpiInfo=i.kpiInfo),i.kpi&&d.UName.toLowerCase().indexOf("[measures]")>-1&&4==d.MemberType&&(c[0][c[0].length-1].kpi=i.kpi);return c})},_loadKpi:function(e,t,i){i={action:"loadFieldElements"};var r=this._getConnectionInfo(e.data),l='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_KPIS</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+e.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.catalog+"</Catalog></PropertyList></Properties></Discover></Body></Envelope>";this.olapCtrlObj.doAjaxPost("POST",r.url,{XMLA:l},this._loadKpiSuccess,null,i)},_loadKpiSuccess:function(e,t){this._kpi=t},_isKpi:function(t,i){var r=e(this._kpi).find("row:contains("+t.split("::")[0]+")"),l={};return!!r.length&&("trend"==i?(l.Graphic=e(r).find("KPI_TREND_GRAPHIC").text(),l.Value=e(r).find("KPI_NAME").text()):"status"==i?(l.Graphic=e(r).find("KPI_STATUS_GRAPHIC").text(),l.Value=e(r).find("KPI_NAME").text()):"goal"==i&&(l.Caption=t.split("::")[1],l.Value=e(r).find("KPI_NAME").text()),l)},_getValueCells:function(i,r){var l,n,s,o,a,d=this._columnHeaders.headers.length,h=this._rowHeaders.headers.length?this._rowHeaders.headers.length:1,c=0,u=0;if(this._valueCells[c]=[],this._fillAllValueCells(),i=e(this.olapCtrlObj.XMLACellSet[1]).children(),this._OlapDataSource._enableBasicEngine||this._isPaging)for(s=0;s<i.length;s++)u<d&&(this._valueCells[c][u]={ActualValue:e(i[s]).find("Value").text(),Value:e(i[s]).find("FmtValue")[0]?e(i[s]).find("FmtValue").text():"",FormatString:e(i[s]).find("FormatString")[0]?e(i[s]).find("FormatString").text():"",kpi:!t.isNullOrUndefined(this._cBIndx[u])&&this._cBIndx[u].kpi?this._cBIndx[u].kpi:!t.isNullOrUndefined(this._rBIndx[c])&&this._rBIndx[c].kpi?this._rBIndx[c].kpi:""},u++),u==d&&c+1<h&&(u=0,c++,this._valueCells[c]=[]);else for(l=0;l<h;l++)for(n=this._rBIndx.length?this._rBIndx[l].selIndx:0,s=0;s<d;s++)i&&(o=e(i[n*r+this._cBIndx[s].selIndx]),a="",(this._columnHeaders.indxInfo[s]&&"total"==this._columnHeaders.indxInfo[s].type||this._rowHeaders.indxInfo[l]&&"total"==this._rowHeaders.indxInfo[l].type)&&(a="summary"),u<d&&(this._valueCells[l][s]={ActualValue:e(o).find("Value").text(),Value:e(o).find("FmtValue")[0]?this._getFormatedValue(e(o),e(o).find("FormatString")[0]):"",FormatString:e(o).find("FormatString")[0]?e(o).find("FormatString").text():"",kpi:this._cBIndx[s].kpi?this._cBIndx[s].kpi:this._rBIndx[l]?this._rBIndx[l].kpi:"",summary:a,Span:this._isNoSummary&&"summary"==a?"Block":"None"},u++),u==d&&c+1<h&&(u=0,c++,this._valueCells[c]=[]));return this._valueCells},_fillAllValueCells:function(i){var r,l,n,s,o;i=e(this.olapCtrlObj.XMLACellSet[1]).children();if(!t.isNullOrUndefined(i))for(r=!e(i[0]).clone(),e(r).find("FmtValue").text(""),i,l=0;l<i.length;l++)if(n=parseInt(e(i[l]).attr("CellOrdinal")),i[l+1]&&(s=parseInt(e(i[l+1]).attr("CellOrdinal"))),n+1<s)for(o=n+1;o<s;o++)e(i[l]).after(e(r).clone().attr("CellOrdinal",o)[0]);return i},_setCellOrdinal:function(t){for(var i=e(t).find("Cell"),r=0;r<i.length;r++)e(i[r]).attr("CellOrdinal",r)},_getFormatedValue:function(i,r){var l;if(("en-US"==this.olapCtrlObj.model.locale||!e.isNumeric(parseFloat(e(i).find("Value").text())))&&e(i).length>0)l=e(i).find("FmtValue").text();else switch(r=e(r).length>0?e(r).text().toLowerCase():t.isNullOrUndefined(r)?"":r.length>0?r:"",l=e(i).length>0?parseFloat(i.find("Value").text()):i,r){case"decimal":l=parseFloat(t.widgetBase.formatting("{0:D2}",l,this.olapCtrlObj.model.locale));break;case"percent":l=t.widgetBase.formatting("{0:P0}",l,this.olapCtrlObj.model.locale);break;case"number":l=t.widgetBase.formatting("{0:N}",l,this.olapCtrlObj.model.locale);break;case"currency":l=t.widgetBase.formatting("{0:C2}",l,this.olapCtrlObj.model.locale);break;case"date":l=new Date(864e5*(Number(l)-2)+new Date("01/01/1900").getTime()),this._isDateTime(l)&&(l=t.widgetBase.formatting("{0:MM/dd/yyyy}",l,this.olapCtrlObj.model.locale));break;case"scientific":l=Number(l).toExponential(2).replace("e","E");break;case"accounting":l=this._toAccounting(l,"{0:C2}",this.olapCtrlObj.model.locale);break;case"time":l=new Date(864e5*(Number(l)-2)+new Date("01/01/1900").getTime()),this._isDateTime(l)&&(l=t.widgetBase.formatting("{0:h:mm:ss tt}",l,this.olapCtrlObj.model.locale));break;case"fraction":l="numerator"in(l=this._toFraction(l))?l.integer+" "+l.numerator+"/"+l.denominator:l.integer;break;default:l=e(i).find("FmtValue").text()}return l},_isDateTime:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())},_toAccounting:function(e,i,r){var l,n,s,o,a=t.preferredCulture(r).numberFormat.currency.symbol;return val=t.widgetBase.formatting(i,e,this.olapCtrlObj.model.locale),s=val.replace(a,""),!(o=val.indexOf(a))||e<0&&1===o?(l=a,n=Number(e)?s:"-"):(l=Number(e)?s:"-",n=a),l+"   "+n},_toFraction:function(e){if(this._isNumber(e)){var t=e.toString(),i=t.split(".")[0],r=t.split(".")[1];if(!r)return{integer:e};var l=(+r).toString(),n=this._getPlaceValue(r,l),s=this._getGCD(l,n);return{integer:i,numerator:Number(l)/s,denominator:Number(n)/s}}return null},_isNumber:function(e){return e-parseFloat(e)>=0},_getGCD:function(e,t){return e=Number(e),(t=Number(t))?this._getGCD(t,e%t):e},_getPlaceValue:function(e,t){var i=e.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_populateEngine:function(r,l,n){var s,o,a,d,h,c=r.length,u=l.length,g=c?r[0].length:c,p=u?l[0].length:u,m=[],_=n.length,f=n[0].length;try{this.pivotEngine=[];var b,C=[],S=[],x=[],v=!1;for(d=0;d<u;d++)for(this.pivotEngine[d+p]==i&&(this.pivotEngine[d+p]=[]),0==d&&(this.pivotEngine[0]=[],this.pivotEngine[0][0]={CSS:"none",Value:"",ColSpan:this._indexCCell?this._indexCCell:1,RowSpan:this._indexRCell?this._indexRCell:1,HUName:"",LName:"",UName:"",LNum:""}),s=0;s<p;s++)v=!1,this._OlapDataSource.columns&&this._OlapDataSource.columns[s]&&this._OlapDataSource.columns[s].isNamedSets&&(v=!0),this._pivotEngineSpanCalculation("colheader",l,r,this._columnHeaders.maxLvlLen,n,s,d,S,C,this._cTotIndexInfo,v,x);for(b=this.pivotEngine.slice(),this.pivotEngine=[],d=0;d<b.length;d++)if(b[d])for(s=0;s<b[d].length;s++)b[d][s]&&(this.pivotEngine[s]==i&&(this.pivotEngine[s]=[]),this.pivotEngine[s][d]={CSS:b[d][s].CSS,ColSpan:b[d][s].RowSpan,HUName:b[d][s].HUName,LName:b[d][s].LName,LNum:b[d][s].LNum,RowSpan:b[d][s].ColSpan,UName:b[d][s].UName,PUName:b[d][s].PUName,Value:b[d][s].Value,ChildCount:b[d][s].ChildCount,MemberType:b[d][s].MemberType,Span:"Block"==b[d][s].Span?"Block":"None"},b[d][s].kpiInfo&&(this.pivotEngine[s][d].kpiInfo=b[d][s].kpiInfo,this.pivotEngine[s][d].kpi=b[d][s].kpi));var w=[],I=[];x=[];for(d=0;d<c;d++)for(this.pivotEngine[d+this._indexCCell]==i&&(this.pivotEngine[d+this._indexCCell]=[]),s=0;s<g;s++)v=!1,this._OlapDataSource.rows&&this._OlapDataSource.rows[s]&&this._OlapDataSource.rows[s].isNamedSets&&(v=!0),this._pivotEngineSpanCalculation("rowheader",r,l,this._rowHeaders.maxLvlLen,n,s,d,I,w,this._rTotIndexInfo,v,x);for(m=e.extend(!0,[],this.pivotEngine),g="rowheader"==this._measureDt.axis?this._indexRCell+1:this._indexRCell,p=this._indexCCell?this._indexCCell:p,d=0;d<_;d++)for(this.pivotEngine[d+p]!=i&&(g=this.pivotEngine[d+p].length),s=0;s<f;s++)t.isNullOrUndefined(n[d][s])||(this.pivotEngine[d+p]==i&&(this.pivotEngine[d+p]=[]),o=this._setClassName(n[d][s]),n[d][s].CSS=o,o.indexOf("kpiiconvalue")>-1&&("ejPivotGrid"==this.olapCtrlObj.pluginName||"ejPivotClient"==this.olapCtrlObj.pluginName)?n[d][s].Value="":o.indexOf("kpiiconvalue")>-1&&(n[d][s].Value=parseInt(n[d][s].Value)),this.pivotEngine[d+this._indexCCell][s+this._indexRCell]=n[d][s]);if(e.grep(this.pivotEngine,function(e){return e}),this._isPaging){for(t.isNullOrUndefined(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName)||"collapse"!=this.olapCtrlObj._pagingSavedObjects.curDrilledItem.action?t.isNullOrUndefined(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.index)?t.isNullOrUndefined(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName)||(e.each(this.olapCtrlObj._pagingSavedObjects.savedHdrEngine,function(i,r){e.each(r,function(e,r){if(!t.isNullOrUndefined(r)&&r.UName==t.olap.base.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName.split("::")[0].split("amp;").join(""))return t.olap.base.olapCtrlObj._pagingSavedObjects.drillEngine.push(t.olap.base.olapCtrlObj._pagingSavedObjects.savedHdrEngine[i][e]),!1})}),this.olapCtrlObj._pagingSavedObjects.drillEngine[this.olapCtrlObj._pagingSavedObjects.drillEngine.length-1].ChildCount=-1):(this.olapCtrlObj._pagingSavedObjects.drillEngine.push(this.olapCtrlObj._pagingSavedObjects.savedHdrEngine[parseInt(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.index.split(",")[1])][parseInt(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.index.split(",")[0])]),this.olapCtrlObj._pagingSavedObjects.drillEngine[this.olapCtrlObj._pagingSavedObjects.drillEngine.length-1].ChildCount=-1):e.each(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e,i){if(i.UName==t.olap.base.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName.split("::")[0].split("amp;").join(""))return t.olap.base.olapCtrlObj._pagingSavedObjects.drillEngine.splice(e,1),!1}),e.map(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(i){var r=0,l=e.map(t.olap.base.olapCtrlObj.model.dataSource.columns,function(e,l){return t.olap.base.olapCtrlObj._isMondrian?(r=e.fieldName.replace(/\]/g,"").replace(/\[/g,"")==i.HUName.replace(/\[/g," ").replace(/\[/g,"")?l:r,e.fieldName.replace(/\]/g,"").replace(/\[/g,"")==i.HUName.replace(/\[/g," ").replace(/\[/g,"")):(r=e.fieldName==i.HUName?l:r,e.fieldName==i.HUName)});i.CSS=l[r]?"colheader":"rowheader"}),this.olapCtrlObj._pagingSavedObjects.curDrilledItem={},d=this.pivotEngine[0][0].RowSpan-2;d>=0;d--){for("empty",s=1;s<this.pivotEngine[this.pivotEngine[0][0].RowSpan-1].length;s++)t.isNullOrUndefined(this.pivotEngine[d])&&(this.pivotEngine[d]=[]),t.isNullOrUndefined(this.pivotEngine[d+1])||!t.isNullOrUndefined(this.pivotEngine[d][s])||t.isNullOrUndefined(this.pivotEngine[d+1][s])||(this.pivotEngine[d][s]=e.grep(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e){return e.UName==t.olap.base.pivotEngine[d+1][s].PUName})[0],t.isNullOrUndefined(this.pivotEngine[d][s])||(this.pivotEngine[d][s].ColSpan=t.isNullOrUndefined(this.pivotEngine[d][s-1])||this.pivotEngine[d][s-1].UName!=this.pivotEngine[d][s].UName?1:this.pivotEngine[d][s-1].ColSpan+1,this.pivotEngine[d][s].RowSpan=1,this.pivotEngine[d][s].UName));for(a=1,s=this.pivotEngine[this.pivotEngine[0][0].RowSpan-1].length-2;s>0;s--)t.isNullOrUndefined(this.pivotEngine[d])||t.isNullOrUndefined(this.pivotEngine[d][s])||t.isNullOrUndefined(this.pivotEngine[d][s+1])||this.pivotEngine[d][s+1].UName!=this.pivotEngine[d][s].UName?t.isNullOrUndefined(this.pivotEngine[d])||t.isNullOrUndefined(this.pivotEngine[d][s+1])||(this.pivotEngine[d][s+1].ColSpan=1==a?this.pivotEngine[d][s+1].ColSpan:a,a=1):(this.pivotEngine[d][s].ColSpan,this.pivotEngine[d][s+1].ColSpan,a++)}for(d=this.pivotEngine[0][0].RowSpan;d<this.pivotEngine.length;d++)for(h="empty",s=this.pivotEngine[0][0].ColSpan-1;s>=0;s--)t.isNullOrUndefined(this.pivotEngine[d][s])?t.isNullOrUndefined(this.pivotEngine[d-1][s])||this.pivotEngine[d-1][s].UName!=h?(this.pivotEngine[d][s]=e.grep(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e){return e.UName==h})[0],t.isNullOrUndefined(this.pivotEngine[d][s])||(this.pivotEngine[d][s].RowSpan=1,this.pivotEngine[d][s].ColSpan=1,h=this.pivotEngine[d][s].PUName)):(this.pivotEngine[d][s]=e.grep(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e){return e.UName==h})[0],t.isNullOrUndefined(this.pivotEngine[d][s])||(this.pivotEngine[d][s].RowSpan=this.pivotEngine[d-1][s].RowSpan+1,this.pivotEngine[d][s].ColSpan=1,h=this.pivotEngine[d][s].PUName)):h=this.pivotEngine[d][s].PUName;this.olapCtrlObj._pagingSavedObjects.savedHdrEngine=m}}catch(e){this.olapCtrlObj._waitingPopup.hide()}},_pivotEngineSpanCalculation:function(t,r,l,n,s,o,a,d,h,c,u,g){var p,m,_,f,b,C,S,x,v,w,I,y=r.length,T="",L=l.length,R=y?r[0].length:y,O=L?l[0].length:L;s.length,s[0].length;"rowheader"==t?(O=this._indexCCell?this._indexCCell:O,T="row"):(O=this._indexRCell?this._indexRCell:O,T="col"),m=0,u&&(r[a][o].ChildCount=0),this._measureDt.axis==t&&this._measureDt.posision==R-1&&(m=1),d[o]||(d[o]=[]),this._isNoSummary&&!g[o]&&(g[o]=[]),this.pivotEngine[a+O]||(this.pivotEngine[a+O]=[]),h[o]=a;var F=n[o]?n[o]:1,E=0,D=0;for(_=0;_<o;_++)n[_]&&(E+=n[_]-1,D+=n[_]);if(!this._OlapDataSource._enableBasicEngine||this._OlapDataSource._checkSummaryHeaders)for(f=1;f<=F;f++){var N,A=!1,P=r[a][o].LNum;if(d[o][f]==i&&(d[o][f]=0),this._isNoSummary&&g[o][f]==i&&(g[o][f]=0),r[a-1]&&d[o][P]&&(0!=r[a][o].LNum&&r[a-1][o].PUName==r[a][o].UName||o+m==R-1&&r[a-1][o].LNum<r[a][o].LNum)&&(b=d[o][P],this._isNoSummary&&(b+=g[o][P],g[o][P]=0),this.pivotEngine[a+O-b][o+P-1+E]=r[a][o],o+m!=R-1&&(this.pivotEngine[a+O][o+P-1+E]=e.extend({},r[a][o]),this._isNoSummary&&(this.pivotEngine[a+O][o+P-1+E].Span="Block")),this._isNoSummary&&(this.pivotEngine[a+O-b][o+P-1+E].RowSpan=0),u||(this.pivotEngine[a+O-b][o+P-1+E].ChildCount=-1),this.pivotEngine[a+O-b][o+P-1+E].ColSpan=1,this.pivotEngine[a+O-b][o+P-1+E].RowSpan+=d[o][P],this._drilledJSONData(a+O-b,a+O,o+P-1+E,r[a][o]),d[o][P]=0,o+m==R-1&&r[a-1][o].LNum>r[a][o].LNum)){for(C=n[o]-P,S=this._findNextMember(r,a,o),x=0;x<S;x++)this.pivotEngine[a+O+x]||(this.pivotEngine[a+O+x]=[]),this.pivotEngine[a+O+x][o+E+P]={CSS:"summary "+T,Value:"Total",ColSpan:C,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:"",Span:this._isNoSummary?"Block":"None"};this._isNoSummary||(this.pivotEngine[a+O-b][o+P-1+E].RowSpan+=S-1)}if(r[a][o].LNum>f&&(!this._isNoSummary||"total"!=c[a].type)?d[o][f]++:r[a][o].LNum>f&&this._isNoSummary&&"total"==c[a].type&&g[o][f]++,N=a+O,f==r[a][o].LNum&&0==a&&r[a][o].LNum>1)this.pivotEngine[N]||(this.pivotEngine[N]=[]),this.pivotEngine[N][o+f-1+E]=r[a][o],(!(r[a+1]!=i&&r[a][o].LNum<r[a+1][o].LNum)||o+m==R-1&&r[a+1]&&r[a][o].LNum<r[a+1][o].LNum)&&(this.pivotEngine[N][o+f-1+E].ColSpan+=n[o]-this.pivotEngine[N][o+f-1+E].LNum);else if(0!=a&&r[a][o].LNum>1&&f==r[a][o].LNum&&r[a-1][o].UName!=r[a][o].UName&&r[a-1][o].PUName!=r[a][o].UName)this.pivotEngine[N]==i&&(this.pivotEngine[N]=[]),this.pivotEngine[N][o+f-1+E]=r[a][o],(!(r[a+1]!=i&&r[a][o].LNum<r[a+1][o].LNum)||o+m==R-1&&r[a+1]&&r[a][o].LNum<r[a+1][o].LNum)&&(this.pivotEngine[N][o+f-1+E].ColSpan+=n[o]-this.pivotEngine[N][o+f-1+E].LNum);else if(0!=a&&f==r[a][o].LNum&&r[a-1][o].UName==r[a][o].UName)this._isNoSummary&&"total"==c[a].type?this._isNoSummary&&"total"==c[a].type&&g[o][f]++:d[o][f]++,this.pivotEngine[a+O][o+f-1+E]=r[a][o],this._isNoSummary&&"total"==c[a].type&&(this.pivotEngine[a+O][o+f-1+E].Span="Block"),(r[a+1]!=i&&r[a+1][o].UName!=r[a][o].UName||a+1==y&&d[o][f]>0)&&(v=d[o][f],w=r[a][o].LNum,this._isNoSummary&&(v+=g[o][f],g[o][f]=0),v&&this.pivotEngine[a+O-v][o+w-1+E]!=i&&this.pivotEngine[a+O-v][o+w-1+E].Value!=i&&(this.pivotEngine[a+O-v][o+w-1+E].RowSpan+=d[o][f],this._drilledJSONData(a+O-v,a+O,o+w-1+E,r[a][o])),d[o][f]=0);else if(r[a][o].LNum<2&&(f==r[a][o].LNum||0==r[a][o].LNum)||r[a][o].LNum<f&&r[a-1]&&r[a][o].LNum<r[a-1][o].LNum&&"total"==c[a].type&&this._measureDt.axis==t)if(f-1,r[a-1]&&r[a-1][o].UName==r[a][o].UName&&r[a][o].LName.toLowerCase().indexOf("[measures]")>-1&&(this.pivotEngine[a+O][o+f-1+E]=e.extend({},r[a][o]),this._measureDt.measureCount>1&&t==this._measureDt.axis||this._isNoSummary&&"total"==c[a].type?this._measureDt.measureCount>1&&t==this._measureDt.axis||!this._isNoSummary||"total"!=c[a].type||g[o][f]++:d[o][f]++,this._isNoSummary&&"total"==c[a].type&&(this.pivotEngine[a+O][o+f-1+E].Span="Block")),-1!=r[a][o].UName.indexOf("Measures")&&this._isPaging||"total"==c[a].type)if("total"==c[a].type&&-1==r[a][o].LName.toLowerCase().indexOf("[measures]")&&r[a][o].LNum!=f&&0!=n[o]){if((r[a][o-1]&&-1==r[a][o-1].LName.toLowerCase().indexOf("[measures]")||this._measureDt.axis!=t)&&(o>c[a].totLvl||o==R-1&&f>c[a].totLvl&&0!=c[a].totLvl||0==c[a].totLvl&&f-1>c[a].totLvl))break;for(var k=1,j=1,M=0;r[a-j][o]&&0==r[a-j][o].LNum&&!r[a][o].LName.toLowerCase().indexOf("[measures]")>-1;)r[a][o-1]&&r[a-j+1][o-1].UName!=r[a-j][o-1].UName&&M++,j++;0==r[a][o].LNum&&!r[a][o].LName.toLowerCase().indexOf("[measures]")>-1&&(I=0,0,a>0&&o>0&&r[a][o].LName.indexOf("(All)")>-1&&r[a][o-1]&&n[o-1]>1&&(I=this._findPreviousMember(r,a,o-1)),0!=a&&r[a][o-1]&&n[o-1]>1&&r[a+I]&&r[a][o-1].LNum<r[a+I][o-1].LNum&&(M=n[o-1]-r[a][o-1].LNum),"rowheader"==t?(k=this._indexRCell-D+M,this._indexRCell-k):"colheader"==t&&(k=this._indexCCell-D+M,this._indexCCell-k),(1!=n.length&&o==R-1||n.length>1&&o<R-1)&&(A=!0),this._measureDt.axis==t&&(k-=1),1,0!=a&&r[a][o-1]&&r[a][o-1].LNum+1,1,I=a+O,this.pivotEngine[a+O][o+f-1+E-M]={CSS:"summary "+T,Value:"Total",ColSpan:k,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:"",Span:this._isNoSummary?"Block":"None"})}else-1!=r[a][o].LName.toLowerCase().indexOf("[measures]")?(r[a-1]&&r[a-1][o].UName==r[a][o].UName||(this.pivotEngine[a+O][o+f-1+E]=e.extend({},r[a][o]),this._isNoSummary&&"total"==c[a].type&&(this.pivotEngine[a+O][o+f-1+E].Span="Block")),(r[a-1]&&r[a-1][o].UName!=r[a][o].UName||a+1==y)&&(p=d[o][f],this._isNoSummary&&(p+=g[o][f],g[o][f]=0),p&&this.pivotEngine[a+O-p][o+f-1+E]!=i&&(this.pivotEngine[a+O-p][o+f-1+E].RowSpan+=d[o][f],this._drilledJSONData(a+O-p,a+O,o+f-1+E,r[a][o])),d[o][f]=0)):"total"==c[a].type&&1==r.length&&(this.pivotEngine[a+O][o+f-1+E]={CSS:"summary "+T,Value:"Total",ColSpan:1,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:"",Span:this._isNoSummary?"Block":"None"});else r[a-1]&&r[a-1][o].UName==r[a][o].UName||(this.pivotEngine[a+O][o+f-1+E]=r[a][o],p=d[o][f],this._isNoSummary&&(p+=g[o][f],g[o][f]=0),p&&this.pivotEngine[a+O-p][o+f-1+E]!=i&&(this.pivotEngine[a+O-p][o+f-1+E].RowSpan+=d[o][f],this._drilledJSONData(a+O-p,a+O,o+f-1+E,r[a][o])),d[o][f]=0),0==!r[a][o].LNum&&(!(r[a+1]!=i&&r[a][o].LNum<r[a+1][o].LNum)||o+m==R-1&&r[a+1]&&r[a][o].LNum<r[a+1][o].LNum)&&this.pivotEngine[a+O][o+f-1+E]&&(this.pivotEngine[a+O][o+f-1+E].ColSpan+=n[o]-this.pivotEngine[a+O][o+f-1+E].LNum);if(A)break}else this.pivotEngine[a+O][o]=r[a][o]},_findNextMember:function(e,t,i){for(var r=0;e[t+r]&&e[t][i].UName==e[t+r][i].UName;)r++;return r},_findPreviousMember:function(e,t,i){for(var r=-1;e[t+r]&&e[t][i].UName==e[t+r][i].UName;)r--;return r},_drilledJSONData:function(t,i,r,l){for(var n=t+1;n<i;n++)this.pivotEngine[n][r]=e.extend({},l),this._isNoSummary&&(this.pivotEngine[n][r].Span="Block")},_setClassName:function(e){var t=parseInt(e.Value),i="value";if(e.kpi)if("trend"==e.kpi)switch(t){case-1:i="value kpiiconvalue kpidownarrow";break;case 0:i="value kpiiconvalue kpirightarrow";break;case 1:i="value kpiiconvalue kpiuparrow"}else if("status"==e.kpi)switch(t){case-1:i="value kpiiconvalue kpidiamond";break;case 0:i="value kpiiconvalue kpitriangle";break;case 1:i="value kpiiconvalue kpicircle"}return e.summary+" "+i},_getFieldItemsInfo:function(e){var t=this._getConnectionInfo(e.model.dataSource.data),i='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_HIERARCHIES</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+e.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.model.dataSource.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+t.LCID+"</LocaleIdentifier></PropertyList></Properties></Discover></Body></Envelope>";e.doAjaxPost("POST",t.url,{XMLA:i},this._getHierarchyInfo,null,{pvtGridObj:e,action:"loadFieldElements"})},_getHierarchyInfo:function(t,i){for(var r,l,n=[],s=t.pvtGridObj,o=this._getConnectionInfo(s.model.dataSource.data),a=0;a<e(i).find("row").length;a++)r=e(e(i).find("row")[a]),n.push({pid:r.find("DIMENSION_UNIQUE_NAME").text(),id:r.find("HIERARCHY_UNIQUE_NAME").text(),name:r.find("HIERARCHY_CAPTION").text(),tag:r.find("HIERARCHY_UNIQUE_NAME").text(),hasAllMember:0==r.children("ALL_MEMBER").length});s._fieldData={hierarchy:n,hierarchySuccess:i,measures:[]},o.LCID.indexOf("1033")>=0&&!s.model.enableDrillThrough||(l='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASURES</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+s.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+s.model.dataSource.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+s.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+o.LCID+"</LocaleIdentifier> </PropertyList></Properties></Discover></Body></Envelope>",s.doAjaxPost("POST",o.url,{XMLA:l},this._getMeasureInfo,null,{pvtGridObj:s,action:"loadFieldElements"}))},_getMeasureInfo:function(t,i){for(var r=[],l=0;l<e(i).find("row").length;l++){var n=e(e(i).find("row")[l]),s=n.children("MEASUREGROUP_NAME").text(),o=n.find("MEASURE_UNIQUE_NAME").text();r.push({id:o,pid:s,name:n.children("MEASURE_CAPTION").text(),tag:o})}t.pvtGridObj._fieldData.measures=r,t.pvtGridObj._fieldData.measureSuccess=i},_getConnectionInfo:function(t){var i={url:"",LCID:"1033"};return""!=t&&e.map(t.split(";"),function(e){e.toLowerCase().indexOf("locale")<0&&0==i.url.length?i.url=e:e.toLowerCase().indexOf("locale")>=0&&(i.LCID=e.replace(/ /g,"").split("=")[1])}),i},_applyTrim:function(r){var l=[],n=r.model.dataSource,s=this;r._fieldData&&r._fieldData.measures&&r._fieldData.hierarchy?(e.merge(l,r._fieldData.hierarchy),e.merge(l,r._fieldData.measures)):!r._fieldData||!r._fieldData.hierarchy||r._fieldData.hierarchy,n.rows=e.map(n.rows,function(r){if(!t.isNullOrUndefined(r)&&r.fieldName!=i)return r.fieldName=e.trim(r.fieldName),s._getCaption(r,l)}),n.columns=e.map(n.columns,function(r){if(!t.isNullOrUndefined(r)&&r.fieldName!=i)return r.fieldName=e.trim(r.fieldName),s._getCaption(r,l)}),n.filters=e.map(n.filters,function(r){if(!t.isNullOrUndefined(r)&&r.fieldName!=i)return r.fieldName=e.trim(r.fieldName),s._getCaption(r,l)}),n.values=n.values.length>0&&n.values[0].measures!=i?n.values:[{measures:[],axis:"columns"}],n.values[0].measures=e.map(n.values[0].measures,function(r){if(!t.isNullOrUndefined(r)&&r.fieldName!=i)return r.fieldName=e.trim(r.fieldName),s._getCaption(r,l)}),r.model.dataSource=n},_getCaption:function(r,l){var n=r.fieldName,s=[];return t.isNullOrUndefined(r.fieldCaption)&&(l.length>0?(s=e.map(l,function(t){if(t.tag!=i&&t.tag.toLowerCase()==e.trim(n.toLowerCase()))return t}),n.toLowerCase().indexOf("[measures]")>=0&&0==s.length&&n.split(".[").length>0?r.fieldCaption=n.split(".[")[1].replace(/]/g,""):s.length>0&&(r.hasAllMember=!!s[0].hasAllMember,r.fieldCaption=s[0].name)):0==s.length&&(r.fieldCaption=n)),r},clearDrilledItems:function(r,l,n){var s=l.action;return r.rows=e.grep(r.rows,function(e){return e.filterItems!=i&&"filtering"!=s&&delete e.filterItems,e.filterItems!=i&&"advancedFilter"!=s&&delete e.advancedFilter,e.drilledItems!=i&&delete e.drilledItems,e._prevDimElements!=i&&delete e._prevDimElements,e}),r.columns=e.grep(r.columns,function(e){return e.filterItems!=i&&"filtering"!=s&&delete e.filterItems,e.filterItems!=i&&"advancedFilter"!=s&&delete e.advancedFilter,e.drilledItems!=i&&delete e.drilledItems,e._prevDimElements!=i&&delete e._prevDimElements,e}),r.filters=e.grep(r.filters,function(e){return e.filterItems!=i&&"filtering"!=s&&delete e.filterItems,e.filterItems!=i&&"advancedFilter"!=s&&delete e.advancedFilter,e.drilledItems!=i&&delete e.drilledItems,e._prevDimElements!=i&&delete e._prevDimElements,e}),"filtering"!=s&&(n._currentReportItems=e.map(n._currentReportItems,function(e){if(!t.isNullOrUndefined(e.dataSrc)){if(e.dataSrc.cube!=r.cube)return e;if(e.dataSrc.reportName!=r.reportName)return e}}),t.isNullOrUndefined(n._schemaData)||n._schemaData.element.find(".filter").remove(),n._savedReportItems=e.extend(!0,[],n._currentReportItems)),t.olap.base._clearDrilledCellSet(),r}},t.olap._mdxParser={_getRowMDX:function(r){var l,n,s=e(r)[0].rows,o="",a="",d=[],h=!1,c=!1,u=r._isCollapse,g=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.olap.AxisName.Row;if(t.isNullOrUndefined(r.providerName)||r.providerName==t.olap.Providers.SSAS){if(s.length>0){for(c=!t.isNullOrUndefined(s[0].drillCellInfo),l=0;l<s.length;l++){var p=!(t.isNullOrUndefined(s[l].isNamedSets)||!s[l].isNamedSets),m="",_="";s[l].fieldName==i||p?p&&(o=l>0?o+"*{"+s[l].fieldName+"}":"{"+s[l].fieldName+"}"):(m=this._getDimensionQuery(s[l],r,"rows",l,!1),d.push(m.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"").replace(/\levels0/g,"levels(0)")),t.olap.base._isPaging&&c&&(_=this._getDimensionQuery(s[l],r,"rows",l,!0)),s[l].sortOrder&&s[l].sortOrder!=t.olap.SortOrder.None?(n=s[l].sortOrder==t.olap.SortOrder.Ascending?"asc":"desc",h=!0,o=o+(l>0?"*":"")+"{ORDER({HIERARCHIZE({"+(t.olap.base._isPaging&&c?_:m)+"})},"+s[l].fieldName+".CurrentMember.MEMBER_CAPTION,"+n+")}"):o=o+(l>0?"*":"")+"{HIERARCHIZE({({"+(t.olap.base._isPaging&&c?_:m)+"})})}")}t.olap.base._isPaging&&this._updateOlapReport(e(r)[0].rows,o,"rows",d),u&&(h=u),o=(h?" ":" HIERARCHIZE ")+"( {"+(t.olap.base._isPaging?o:this._updateOlapReport(e(r)[0].rows,o,"rows",d))+"})",u&&(o="HIERARCHIZE("+o+")")}g&&(a=t.olap._mdxParser._getMeasuresQuery(r),o=""!=o?(t.olap.base._isPaging?o.slice(0,-1):o)+(""!=o&&""!=a?t.olap.base._isPaging?"*":",":"")+a:(t.olap.base._isPaging&&""!=a?"(":"")+a),t.olap.base._isPaging&&(o=""!=o?""==a?("}"!=o[o.length-1]?o.slice(0,-1):o)+this._getDrilledSection(r,e.extend(!0,{},s),"row",a)+")":o+this._getDrilledSection(r,e.extend(!0,{},s),"row",a)+")":"")}else o=this._generateAxisMDXOnMondrian(r,s,g);return o},_generateAxisMDXOnMondrian:function(e,i,r){for(var l,n,s="",o=0;o<i.length;o++)l=t.olap.base._isPaging?"({"+i[o].fieldName+".children})":"DrillDownLevel({"+i[o].fieldName+"})",!t.isNullOrUndefined(i[o].drilledItems)&&i[o].drilledItems.length>0&&(l=this._getDrilledMDXOnMondrian(i[o].drilledItems,l)),!t.isNullOrUndefined(i[o].filterItems)&&!t.isNullOrUndefined(i[o].filterItems.values)&&i[o].filterItems.values.length>0&&(l="({{hierarchize(Union(Intersect((Except("+("Descendants("+i[o].fieldName+","+e._maxLevel+", SELF_AND_BEFORE)")+","+(n="{"+i[o].filterItems.values.join()+"}")+")),"+l+"),Except("+l+","+n+")))}})"),s+=(""==s?"":"*")+l;return r&&(s+=(""==s?"":"*")+t.olap._mdxParser._getMeasuresQuery(e)),s},_getDrilledMDXOnMondrian:function(e,i){for(var r=0;r<e.length;r++)i=t.olap.base._isPaging?"Except(DrillDownMember("+i+", {"+e[r].join()+"}),{"+e[r].join()+"})":"(DrillDownMember("+i+", {"+e[r].join()+"}))";return i},_getcolumnMDX:function(r){var l,n,s=e(r)[0].columns,o="",a="",d=[],h=!1,c=!1,u=r._isCollapse,g=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.olap.AxisName.Column;if(t.isNullOrUndefined(r.providerName)||r.providerName==t.olap.Providers.SSAS){if(s.length>0){for(c=!t.isNullOrUndefined(s[0].drillCellInfo),l=0;l<s.length;l++){var p=!(!t.isNullOrUndefined(s[l].isNamedSets)&&s[l].isNamedSets),m=(h=!1,""),_="";s[l].fieldName!=i&&p?(m=this._getDimensionQuery(s[l],r,"columns",l,!1),d.push(m.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"")),t.olap.base._isPaging&&c&&(_=this._getDimensionQuery(s[l],r,"columns",l,!0)),s[l].sortOrder&&s[l].sortOrder!=t.olap.SortOrder.None?(n=s[l].sortOrder==t.olap.SortOrder.Ascending?"asc":"desc",h=!0,o=o+(l>0?"*":"")+"{ ORDER ({HIERARCHIZE ({"+(t.olap.base._isPaging&&c?_:m)+"})},"+s[l].fieldName+".CurrentMember.MEMBER_CAPTION,"+n+")}"):o=o+(l>0?"*":"")+"{"+(t.olap.base._isPaging&&c?_:m)+"}"):o=l>0?o+"*{"+s[l].fieldName+"}":"{"+s[l].fieldName+"}"}t.olap.base._isPaging&&c&&this._updateOlapReport(e(r)[0].columns,o,"columns",d),u&&(h=u),o=(h?" ":" HIERARCHIZE ")+"( {"+(t.olap.base._isPaging?o:this._updateOlapReport(s,o,"columns",d))+"})",u&&(o="HIERARCHIZE("+o+")")}g&&(a=t.olap._mdxParser._getMeasuresQuery(r),o=""!=o?(t.olap.base._isPaging?o.slice(0,-1):o)+(""!=o&&""!=a?t.olap.base._isPaging?"*":",":"")+a:(t.olap.base._isPaging&&""!=a?"(":"")+a),t.olap.base._isPaging&&(o=""!=o?""==a?("}"!=o[o.length-1]?o.slice(0,-1):o)+this._getDrilledSection(r,e.extend(!0,{},s),"column",a)+")":o+this._getDrilledSection(r,e.extend(!0,{},s),"column",a)+")":"")}else o=this._generateAxisMDXOnMondrian(r,s,g);return o},_getDrilledSection:function(i,r,l,n){var s="";r=r;return e.each(r,function(i,r){t.isNullOrUndefined(r.drilledItems)||e.each(r.drilledItems,function(t,r){var l="",o="";e.each(r,function(e,t){l=""==l?"{"+t+"}":l+"*{"+t+"}",t=e==i?t.replace(".children",""):t,o=""==o?"{"+t+"}":o+"*{"+t+"}"}),""!=n&&(l=l+"*"+n,o=o+"*"+n),s=""==s?"+{"+l+"}-{"+o+"}":s+"+{"+l+"}-{"+o+"}"})}),s},_getSortedMembers:function(i){var r,l=i.fieldName;return i.sortOrder&&i.sortOrder!=t.olap.SortOrder.None?(r="ascending"==i.sortOrder?"asc":"desc",e.map(i.drilledItems,function(t){return e.map(t,function(e){return e.indexOf(l)>=0&&(e="order ( "+e+" , "+l+".CurrentMember.MEMBER_CAPTION,"+r+")"),e})})):i.drilledItems},_getAvailCount:function(i,r,l){var n=0;return e.each(i.split("--"),function(e,i){i=i.replace(l[e],""),r.split("--").length>0&&!t.isNullOrUndefined(r.split("--")[e])&&(n+=i.indexOf(r.split("--")[e])>-1&&!((i+"$").indexOf(r.split("--")[e])>-1)||r.split("--")[e].indexOf(i)>-1&&!(r.split("--")[e].indexOf(i+"$")>-1)?1:0)}),n},_updateTmpItems:function(i,r,l,n){var s=e.map(r.split("--"),function(e,i){return t.isNullOrUndefined(l.split("--")[i])||e.replace(n[i],"")!=l.split("--")[i].replace(n[i],"")||-1!=e.indexOf(n[i])?e:l.split("--")[i]}).join("--");-1==i.indexOf(s)&&i.push(s)},_updateExpandCollection:function(i,r,l){return e.each(r,function(n,s){e.each(r,function(r,n){var o,a,d;s!=n&&(o=0,e.each(n.split("--"),function(e,i){i=i.replace(l[e],""),t.isNullOrUndefined(s.split("--")[e])||(o+=n.split(l[e]).join("").indexOf(s.split("--")[e].replace(l[e],""))>-1||s.split("--")[e].replace(l[e],"").indexOf(i)>-1?1:0)}),o==n.split("--").length&&t.olap._mdxParser._updateTmpItems(i,s,n,l),o==s.split("--").length&&t.olap._mdxParser._updateTmpItems(i,n,s,l),a=[],d=0,e.each(n.split("--"),function(e,i){var r=s.split("--").length>e?s.split("--")[e]:"";t.isNullOrUndefined(r)||""==r||(i!=r&&i.indexOf("$")>-1&&(i.indexOf(r)>-1||r.indexOf(i)>-1)&&s.split("--").length-1>e?(a.push(i),d++):a.push(r))}),d>0&&i.push(a.concat(e.map(s.split("--"),function(e,t){if(t>=a.length)return e})).join("--")))})}),i},_updateDrillQuery:function(i,r,l,n){var s,o,a,d=t.olap.base._isRowDrilled||t.olap.base._isColDrilled,h=e.map(i,function(i){var r=e.map(t.olap.base.olapCtrlObj._prevDrillElements,function(e){if(e.indexOf(i.fieldName)>-1)return e}).join("$");if(""!=r)return r}).join("--"),c=e.map(n,function(e){return e.indexOf("DrillDownlevel")>=0&&(e=e.replace("DrillDownlevel","DrillDownlevel(")+")"),e}),u=e.map(i,function(e){return!t.isNullOrUndefined(e.hasAllMember)&&e.hasAllMember?".levels(0).AllMembers":".children"});d||""==h||(t.isNullOrUndefined(i[h.split("--").length-1]._prevDimElements)||-1!=i[h.split("--").length-1]._prevDimElements.indexOf(h+u[h.split("--").length-1])?i[h.split("--").length-1]._prevDimElements=i[h.split("--").length-1]._prevDimElements.filter(function(e){if(t.olap._mdxParser._getAvailCount(e,h,u)!=h.split("--").length)return e}):i[h.split("--").length-1]._prevDimElements.push(h+u[h.split("--").length-1]+"!#collapse")),i=e.map(i,function(i){return t.isNullOrUndefined(i._prevDimElements)?i:(i._prevDimElements=e.map(i._prevDimElements,function(i){var r=-1!=i.indexOf("!#collapse");return d?i.indexOf("!#collapse")>-1?(i=i.replace("!#collapse",""),t.olap._mdxParser._getAvailCount(i,h,u)!=h.split("--").length?i:void 0):i:""!=h?(i=i.replace("!#collapse",""),t.olap._mdxParser._getAvailCount(i,h,u)==h.split("--").length?e.map(i.split("--"),function(e,t){return t==h.split("--").length-1&&-1==e.indexOf(u[t])?h.split("--")[h.split("--").length-1]+"":e}).join("--")+(r?"!#collapse":""):i+(r?"!#collapse":"")):i}),""!=h&&(i._prevDimElements=e.map(i._prevDimElements,function(e){if(!(e.indexOf("!#collapse")>-1&&i._prevDimElements.filter(function(e){if(-1==e.indexOf("!#collapse"))return e}).indexOf(e.replace("!#collapse",""))>-1||-1==e.indexOf("!#collapse")&&i._prevDimElements.map(function(e){if(e.indexOf("!#collapse")>-1)return e.replace("!#collapse","")}).indexOf(e)>-1))return e})),i)});var g=e.map(i,function(e){if(!t.isNullOrUndefined(e._prevDimElements))return e._prevDimElements}).filter(function(e){if(-1==e.indexOf("!#collapse"))return e}),p=e.map(i,function(e){if(!t.isNullOrUndefined(e._prevDimElements))return e._prevDimElements}).filter(function(e){if(e.indexOf("!#collapse")>-1)return e}).map(function(e){return e.replace("!#collapse","")}),m=0==h.length?i.length:h.split("--").length,_=[];return d&&(g=e.map(g,function(e){if(t.olap._mdxParser._getAvailCount(e,h,u)==h.split("--").length)return e})),s=t.olap._mdxParser._updateExpandCollection([],g,u),o=t.olap._mdxParser._updateExpandCollection([],s,u),g=g.concat(s.concat(o)),s=[],e.each(g,function(t,i){e.each(p,function(t,r){var l=[],n=0;i.split("--").length>r.split("--").length&&(e.each(r.split("--"),function(e,t){var r=i.split("--")[e];(t.replace(u[e],"").indexOf(r.replace(u[e],""))>-1||r.replace(u[e],"").indexOf(t.replace(u[e],""))>-1)&&(l.push(t),n++)}),r.split("--").length==n&&n<i.split("--").length&&-1==s.indexOf(l.concat(e.map(i.split("--"),function(e,t){if(t>=l.length)return e})).join("--"))&&-1==p.indexOf(l.concat(e.map(i.split("--"),function(e,t){if(t>=l.length)return e})).join("--"))&&s.push(l.concat(e.map(i.split("--"),function(e,t){if(t>=l.length)return e})).join("--")))})}),p=p.concat(s),g=e.map(g,function(i){var r=d?m:i.split("--").length;return e.map(i.split("--"),function(e,i){return i<r-1?!t.isNullOrUndefined(h.split("--")[i])&&(h.split("--")[i].indexOf(e.replace(u[i],"")>-1)||e.replace(u[i],"").indexOf(h.split("--")[i])>-1)&&d?c[i].split("&amp;").join("&"):e.split("$")[e.split("$").length-1]:i==r-1?d?c[i].split("&amp;").join("&"):e.replace(u[i],"").split("$")[e.split("$").length-1]+u[i]:e.split("$")[e.split("$").length-1]}).join("--")}).sort(function(e,t){return e.split("--").length-t.split("--").length}),g=e.map(g,function(t){var i=[];return(i=t.split("--").length<c.length?[t.split("&").join("&amp;").split("--").concat(e.map(c,function(e,i){if(t.split("--").length-1<i)return e}))]:[t.split("&").join("&amp;").split("--")]).join()!=c.join()?i:void 0}),p=e.map(p,function(t){return t.split("--").length<c.length?[t.split("&").join("&amp;").split("--").map(function(e){return e.split("$")[e.split("$").length-1]}).concat(e.map(c,function(e,i){if(t.split("--").length-1<i)return e}))]:[t.split("&").join("&amp;").split("--").map(function(e){return e.split("$")[e.split("$").length-1]})]}),_=[],e.each(e.map(g,function(e){return e.join("--")}),function(e,t){(0==_.length||-1==_.indexOf(t))&&_.push(t)}),a={expandCollection:g=e.map(_,function(e){return[e.split("--")]}),collapseCollection:p},g.length>0&&i.length>1&&n[n.length-1].indexOf(".children")<0&&(r=this._getDrillQuery(a,r,i)),r},_updateOlapReport:function(r,l,n,s){var o,a,d,h=this;return"rows"==n?(o=e.map(r,function(e,t){if(r[t].drilledItems!=i)return h._getSortedMembers(e,r)}),t.olap.base._isRowDrilled&&"rows"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(d=e.map(s,function(e){return e.indexOf("DrillDownlevel")>=0&&(e=e.replace("DrillDownlevel","DrillDownlevel(")+")"),e}),r[t.olap.base._currIndex.Index].drilledItems.push(d),t.olap.base._isRowDrilled=!1):o.length>0&&(t.olap.base._currIndex.axis==i||"columns"==t.olap.base._currIndex.axis&&!t.olap.base._isRowDrilled)&&(l=this._getDrillQuery(o,l,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||"rows"!=t.olap.base._currIndex.axis||(t.olap.base._currIndex={})):(a=e.map(r,function(e,t){if(r[t].drilledItems!=i)return h._getSortedMembers(e,r)}),t.olap.base._isColDrilled&&"columns"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(d=e.map(s,function(e){return e.indexOf("DrillDownlevel")>=0&&(e=e.replace("DrillDownlevel","DrillDownlevel(")+")"),e}),r[t.olap.base._currIndex.Index].drilledItems.push(d),t.olap.base._isColDrilled=!1):a.length>0&&(t.olap.base._currIndex.axis==i||"rows"==t.olap.base._currIndex.axis&&!t.olap.base._isColDrilled)&&(l=this._getDrillQuery(a,l,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||"columns"!=t.olap.base._currIndex.axis||(t.olap.base._currIndex={})),l},_getDrillQuery:function(r,l,n){for(var s,o,a,d="",h=r,c=0;c<h.length;c++)if(h[c][h[c].length-1].toLowerCase().indexOf(".children")>=0||h[c][h[c].length-1].toLowerCase().indexOf("drilldownlevel")>=0||h[c][h[c].length-1].toLowerCase().indexOf("members")>=0||(h[c][h[c].length-1]=h[c][h[c].length-1]+".children"),h[c].length!=n.length){for(s=e.map(n,function(r){if(r.fieldName!=i&&r.fieldName!=h[c][[h[c].length-1]].split(".").splice(0,2).join("."))return{uniqueName:t.olap.base._isPaging?"("+e.trim(r.fieldName)+").children":"DrillDownLevel("+e.trim(r.fieldName)+")",fieldName:e.trim(r.fieldName)}}),o=0;o<s.length;o++)a=this._getItemPosition(n,s[o].fieldName)[0],h[c].toString().indexOf(s[o].fieldName)>=0||h[c].splice(a,0,s[o].uniqueName);d=d+""+(c>0?",":"")+"\n ("+h[c]+")"}else d=d+""+(c>0?",":"")+"\n ("+h[c].toString()+")\n";return"("+l+"),"+d},_createDrillThroughQuery:function(i,r){var l,n;if(r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)r._waitingPopup.show(),l=e(r.element).hasClass("e-pivotclient")?r.element.find(".e-pivotgrid").data("ejPivotGrid"):r,r.doAjaxPost("POST",r.model.url+"/"+r.model.serviceMethodSettings.drillThroughDataTable,JSON.stringify({currentReport:e(r.element).parents(".e-pivotclient").length>0?r.currentReport:JSON.parse(l.getOlapReport()).Report,layout:e(r.element).hasClass("e-pivotclient")?r.model.gridLayout:r.model.layout,cellPos:"",selector:i}),function(e){this._trigger("drillThrough",{element:e.element,data:e})}),r._waitingPopup.hide();else{var s=r.measureGrp,o="",a="DRILLTHROUGH Select("+r._colHeader.join()+","+r._rowHeader.join()+") on 0 from ["+r.model.dataSource.cube+"]";e.map(r._fieldData.measures,function(e){e.pid==s&&(o+=""==o?"["+s+"]."+e.id.split(".")[1]:",["+s+"]."+e.id.split(".")[1])}),a=a.replace(/&/g,"&amp;"),n=r._getConnectionInfo(r.model.dataSource.data),pData='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+a+" </Statement> </Command> <Properties> <PropertyList> <Catalog>"+r.model.dataSource.catalog+"</Catalog> </PropertyList> </Properties></Execute> </Body> </Envelope>",r.doAjaxPost("POST",n.url,{XMLA:pData},t.Pivot._generateDrillData,null,{pvtGridObj:r,action:"loadFieldElements"})}},_getDimensionQuery:function(r,l,n,s,o){var a="";return r.drillCellInfo==i||o?a=t.isNullOrUndefined(r.expression)?t.isNullOrUndefined(r.hasAllMember)||!r.hasAllMember?t.olap.base._isPaging?"(("+e.trim(r.fieldName)+").children)":"DrillDownlevel(("+e.trim(r.fieldName)+"))":"(("+e.trim(r.fieldName)+").levels(0).AllMembers)":"("+r.hierarchyUniqueName+".["+(r.fieldCaption||r.fieldName)+"])":(a="{("+r.drillCellInfo.uniqueName+")}",delete r.drillCellInfo),a},_updateReport:function(i,r,l,n){var s,o,a,d={};n._isMondrian?(s=r.preRepItm.split(">#>"),o=(a=r.itemPosition)?r.previousElements.split(s[a-1])[1].split("][").length:r.previousElements.split("][").length,l.drilledItems&&(l.drilledItems.length<=o-1&&(l.drilledItems[o-1]=[]),r.action&&"collapse"==r.action?l.drilledItems[o-1]=e.grep(l.drilledItems[o-1],function(e){return e!=s[a]}):l.drilledItems[o-1].push(s[a])),d={action:"mondrianDrilldown"}):(l.drillCellInfo=e.extend({},r),l.drillCellInfo.uniqueName="("+e.trim(l.drillCellInfo.uniqueName)+".children)",d={action:"drilldown",cellInfo:r}),t.olap.base.getJSONData(d,n.model.dataSource,n)},_splitCellInfo:function(e){var i,r=t.olap.base.olapCtrlObj._isMondrian?1:2;return e&&(i={hierarchyUniqueName:e.split("::")[1].split(".").splice(0,r).join("."),uniqueName:e.split("::")[0],levelUniqueName:e.split("::")[1],leveName:e.split("::")[2],parentUniqueName:e.split("::")[3]}),i},updateDrilledReport:function(r,l,n){var s,o,a,d,h;t.olap.base._isPaging&&!t.isNullOrUndefined(n._pagingSavedObjects.curDrilledItem)&&(n._pagingSavedObjects.curDrilledItem=r);t.olap._mdxParser;var c,u,g,p=null,m="",_="";if((c=this._splitCellInfo(r.uniqueName)).targetUName=r.uniqueName,c.previousElements="",(u="rowheader"==l?n.model.dataSource.rows:"colheader"==l?n.model.dataSource.columns:null).length>0){if(p=(g=e.map(u,function(t,r){return t.fieldName!=i&&e.trim(t.fieldName).toLowerCase()==e.trim(c.hierarchyUniqueName).toLowerCase()?{report:t,index:r}:t.hierarchyUniqueName!=i&&e.trim(t.hierarchyUniqueName).toLowerCase()==e.trim(c.hierarchyUniqueName).toLowerCase()?{report:t,index:r}:void 0}))[0].report,c.itemPosition=g[0].index,!t.isNullOrUndefined(n._pivotRecords)||t.isNullOrUndefined(n._pivotClientObj)||t.isNullOrUndefined(n._pivotClientObj._pivotRecords)||(n._pivotRecords=n._pivotClientObj._pivotRecords),s=e.map(n._pivotRecords.records,function(e){if(e.Info.replace(/&/g,"&amp;")==r.uniqueName)return e.Index}),p.drilledItems!=i?p.drilledItems:p.drilledItems=[],t.olap.base._currIndex={axis:"rowheader"==l?"rows":"columns",Index:g[0].index},"ejPivotChart"==n.pluginName||"ejPivotTreeMap"==n.pluginName||t.isNullOrUndefined(r.index)){for(c.cellIndex=s.length>0?"":r.index,c.axis=b=l,"rowheader"!=l?t.olap.base._isColDrilled=r.action==i||"collapse"!=r.action:t.olap.base._isRowDrilled=r.action==i||"collapse"!=r.action,o=0;o<n.model.dataSource.rows.length&&r.seriesInfo[o]!=r.uniqueName;o++)n.model.dataSource.rows[o].drillCellInfo=this._splitCellInfo(r.seriesInfo[o]);for(c.previousElements="",c.preRepItm="",o=0;o<r.uniqueNameArray.length;o++)c.previousElements+=this._splitCellInfo(r.uniqueNameArray[o]).uniqueName;for(o=0;o<r.seriesInfo.length;o++)c.preRepItm+=""==c.preRepItm?this._splitCellInfo(r.seriesInfo[o]).uniqueName:">#>"+this._splitCellInfo(r.seriesInfo[o]).uniqueName}else{c.cellIndex=r.index;var f=c.hierarchyUniqueName,b="",C=(m="",""),S=c.cellIndex.split(",")[0],x=c.cellIndex.split(",")[1];if("rowheader"==l)for(b="rowheader",t.olap.base._isRowDrilled=r.action==i||"collapse"!=r.action,o=parseInt(S);o>=0;o--)!n._pivotRecords.records[parseInt(o*n._pivotRecords.rowCount+parseInt(S))].Info.indexOf(f)>=0&&(C=n._pivotRecords.records[parseInt(o*n._pivotRecords.rowCount+parseInt(x))].Info,(a=this._splitCellInfo(C))&&(m=a.uniqueName+m),""==C||C.indexOf(f)>=0||((d=this._splitCellInfo(C)).uniqueName=d.uniqueName.replace(/&/g,"&amp;"),_=d.uniqueName+">#>"+_,currReport=e.map(u,function(t,r){return t.fieldName!=i&&e.trim(t.fieldName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?r:t.hierarchyUniqueName!=i&&e.trim(t.hierarchyUniqueName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?r:void 0}),"collapse"!=r.action&&(n.model.dataSource.rows[currReport[0]].drillCellInfo=d),f=d.hierarchyUniqueName));else for(b="colheader",t.olap.base._isColDrilled=r.action==i||"collapse"!=r.action,o=parseInt(x);o>=0;o--)!n._pivotRecords.records[parseInt(S*n._pivotRecords.rowCount+parseInt(o))].Info.indexOf(f)>=0&&(C=n._pivotRecords.records[parseInt(S*n._pivotRecords.rowCount+parseInt(o))].Info,(a=this._splitCellInfo(C))&&(m=a.uniqueName+(n._isMondrian?"":">#>")+m),""==C||C.indexOf(f)>=0||((d=this._splitCellInfo(C)).uniqueName=d.uniqueName.replace(/&/g,"&amp;"),_=d.uniqueName+(n._isMondrian?">#>":"")+_,currReport=e.map(u,function(t,r){return t.fieldName!=i&&e.trim(t.fieldName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?r:t.expression!=i&&e.trim(t.hierarchyUniqueName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?r:void 0}),"collapse"!=r.action&&(n.model.dataSource.columns[currReport[0]].drillCellInfo=d),f=d.hierarchyUniqueName));_+=c.uniqueName,c.previousElements=m.replace(/&amp;/g,"&"),c.preRepItm=_.replace(/&amp;/g,"&"),c.axis=b}if(c.previousElements=c.previousElements.replace(/&amp;/g,"&"),c.preRepItm=c.preRepItm.replace(/&amp;/g,"&"),r.action)if(r.action){if(n._isMondrian)return c.action="collapse",void t.olap._mdxParser._updateReport(p.drilledItems,c,p,n);if(t.isNullOrUndefined(c)||t.isNullOrUndefined(c.previousElements)||""==c.previousElements||(t.olap.base.olapCtrlObj._prevDrillElements=c.previousElements.split("][").join("]>#>[").split(">#>")),(h=t.olap.base._getDrilledMemeber({item:c})).length&&!t.olap.base._isPaging)t.olap.base._onDemandCollapse({drilledMembers:h,action:r.action},b);else{for(;0!=h.length;)t.olap.base.olapCtrlObj.model.dataSource=t.olap._mdxParser._clearCollapsedItems(b,h[h.length-1],t.olap.base.olapCtrlObj.model.dataSource),h=h.splice(0,h.length-1);t.olap.base.getJSONData(r,t.olap.base.olapCtrlObj.model.dataSource,t.olap.base.olapCtrlObj)}}else e(r.drilledMember).clone(!0),t.olap.base._onDemandExpand({action:"drilldown",cellInfo:c,isExist:!0},r.drilledMember);else h=t.olap.base._getDrilledMemeber({item:c}),t.olap._mdxParser._updateReport(p.drilledItems,c,p,n)}},_clearCollapsedItems:function(t,r,l){return"rowheader"==t?l.rows=e.map(l.rows,function(t){return t.drilledItems!=i&&t.drilledItems.length&&(t.drilledItems=e.map(t.drilledItems,function(e){if(e.join("").indexOf(r.repItms.replace(/&/g,"&amp;"))<0)return[e]})),t}):"colheader"==t&&(l.columns=e.map(l.columns,function(t){return t.drilledItems!=i&&t.drilledItems.length&&(t.drilledItems=e.map(t.drilledItems,function(e){if(e.join("").indexOf(r.repItms.replace(/&/g,"&amp;"))<0)return[e]})),t})),l},_getSlicerMDX:function(t,r){for(var l=e(t)[0].filters,n="",s=this,o=r._fieldData,a=e.merge(e.merge([],t.columns),t.rows),d=0;d<l.length;d++)e.grep(a,function(e){var t=s._getDimensionUniqueName(e.fieldName,o),i=s._getDimensionUniqueName(l[d].fieldName,o);return t==i&&!(r._isMondrian&&""==i&&""==t)}).length>0||(l[d].fieldName!=i&&l[d].filterItems==i?n=n+(""!=n?"*":"")+"{"+this._getDimensionQuery(l[d])+"}":l[d].filterItems!=i&&(n=n+(""!=n?"*":"")+"{"+l[d].filterItems.values.toString()+"}"));return""!=n?"where ("+n.replace(/DrillDownlevel/g,"")+")":""},_getDimensionUniqueName:function(t,i){var r,l=i.hierarchy;return l?(r=e.map(l,function(e){if(e.id.toLowerCase()==t.toLowerCase())return e.pid})).length>0?r[0]:"":t.split(".")[0]},_getMeasuresQuery:function(t){var r,l,n,s=e(t)[0].values,o=[];return s.length>0&&(null!=(n=(l=jQuery.map(s,function(e,t){if(e.measures!=i)return{measureElements:e.measures,Index:t,axisName:e.axis}})).length>0?e.map(l[0].measureElements,function(e){return e.fieldName}):null)&&o.push({values:n,Index:l[0].Index}),s.axis),""!=(r=e.map(o,function(e){return e.values.toString()}))[0]?"{"+r+"}":""},_getIncludefilterQuery:function(t,r,l){var n,s,o,a="FROM ["+r+"]",d="FROM ( SELECT (",h=l._fieldData,c=[],u="COLUMNS";if(l._isMondrian)return a;for(n=e.map(e(t.rows),function(e){if(e.filterItems!=i)return[e.filterItems.values]}),s=e.map(e(t.columns),function(e){if(e.filterItems!=i)return[e.filterItems.values]}),o=0;o<t.filters.length;o++){var g=t.filters,p=this,m=!1;e.map(t.columns,function(e){p._getDimensionUniqueName(e.fieldName,h)==p._getDimensionUniqueName(g[o].fieldName,h)&&g[o].filterItems!=i&&(s.push(g[o].filterItems.values),m=!0)}),m||e.map(t.rows,function(e){p._getDimensionUniqueName(e.fieldName,h)==p._getDimensionUniqueName(g[o].fieldName,h)&&g[o].filterItems!=i&&n.push(g[o].filterItems.values)})}if(t.enableAdvancedFilter){for(o=0;o<=t.columns.length-1;o++)t.columns[o].advancedFilter&&e.merge(c,this._getAdvancedFilterQuery(t.columns[o],d,u));for(o=0;o<=t.rows.length-1;o++)t.rows[o].advancedFilter&&e.merge(c,this._getAdvancedFilterQuery(t.rows[o],d,u))}for(o=0;o<=s.length-1;o++)d=0==o?d+"{"+s[o].toString()+"}":d+",{"+s[o].toString()+"}";for(s.length>0&&(d=n.length>0?d+" ) on COLUMNS ,(":d+" ) on COLUMNS "),o=0;o<=n.length-1;o++)d=o>0?d+",{"+n[o].toString()+"}":d+"{"+n[o].toString()+"}";return d=s.length>0&&n.length>0?d+=") on ROWS ":0==s.length&&n.length>0?d+") on COLUMNS ":d,c.length>0&&(c=(s.length>0||n.length>0?d:"")+" "+c.join(" ")+" "+a+Array(c.length+1+s.length+n.length).join(")")),a=0==s.length&&0==n.length?a:d+a+")",c.length>0?c:a},_getAdvancedFilterQuery:function(i,r,l){var n=[],s=this;return e.map(i.advancedFilter,function(r){t.isNullOrUndefined(r.labelFilterOperator)&&r.labelFilterOperator==t.olap.LabelFilterOptions.None&&t.isNullOrUndefined(r.valueFilterOperator)&&r.valueFilterOperator==t.olap.ValueFilterOptions.None||n.push("FROM (SELECT Filter("+e.trim(r.name)+".AllMembers, "+s._getAdvancedFilterCondtions(i.fieldName,r.advancedFilterType==t.olap.AdvancedFilterType.LabelFilter||t.isNullOrUndefined(r.advancedFilterType)?r.labelFilterOperator:r.valueFilterOperator,r.values,r.advancedFilterType,r.measure)+")) on "+l)}),n},_getAdvancedFilterCondtions:function(e,i,r,l,n){var s="";l=t.isNullOrUndefined(l)?"label":l;switch(i.toLowerCase()){case"equals":s="("+("value"!=l?e+'.CurrentMember.member_caption ="'+r[0]+'"':n+" = "+r[0]);break;case"notequals":s="("+("value"!=l?e+'.CurrentMember.member_caption &lt;&gt;"'+r[0]+'"':n+" &lt;&gt;"+r[0]);break;case"contains":s="( InStr (1,"+e+'.CurrentMember.member_caption,"'+r[0]+'")&gt;0';break;case"notcontains":s="( InStr (1,"+e+'.CurrentMember.member_caption,"'+r[0]+'")=0';break;case"beginswith":s="( Left ("+e+".CurrentMember.member_caption,"+r[0].length+')="'+r[0]+'"';break;case"notbeginswith":s="( Left ("+e+".CurrentMember.member_caption,"+r[0].length+')&lt;&gt;"'+r[0]+'"';break;case"endswith":s="( Right ("+e+".CurrentMember.member_caption,"+r[0].length+')="'+r[0]+'"';break;case"notendswith":s="( Right ("+e+".CurrentMember.member_caption,"+r[0].length+')&lt;&gt;"'+r[0]+'"';break;case"greaterthan":s="("+("value"!=l?e+'.CurrentMember.member_caption &gt;"'+r[0]+'"':n+" &gt;"+r[0]);break;case"greaterthanorequalto":s="("+("value"!=l?e+'.CurrentMember.member_caption &gt;="'+r[0]+'"':n+" &gt;="+r[0]);break;case"lessthan":s="("+("value"!=l?e+'.CurrentMember.member_caption &lt;"'+r[0]+'"':n+" &lt;"+r[0]);break;case"lessthanorequalto":s="("+("value"!=l?e+'.CurrentMember.member_caption &lt;="'+r[0]+'"':n+" &lt;="+r[0]);break;case"between":s="("+("value"!=l?e+'.CurrentMember.member_caption &gt;="'+r[0]+'"AND '+e+'.CurrentMember.member_caption &lt;="'+r[1]+'"':n+" &gt;="+r[0]+" AND "+n+"&lt;="+r[1]);break;case"notbetween":s="("+("value"!=l?e+'.CurrentMember.member_caption &gt;="'+r[0]+'"OR '+e+'.CurrentMember.member_caption &lt;="'+r[1]+'"':n+" &gt;="+r[0]+" OR "+n+"&lt;="+r[1]);break;default:s="( InStr (1,"+e+'.CurrentMember.member_caption,"'+r[0]+'")&gt;0'}return s},_getItemPosition:function(t,r){return e.map(t,function(t,l){if(t.fieldName!=i&&e.trim(t.fieldName)==e.trim(r))return l})},getAllMember:function(i,r,l){if(!t.isNullOrUndefined(l)){var n="select {"+r+"} dimension properties CHILDREN_CARDINALITY on 0 from ["+e.trim(i.cube)+"]",s=t.olap._mdxParser.getSoapMsg(n,i.data,i.catalog),o=t.olap.base._getConnectionInfo(i.data);l.doAjaxPost("POST",o.url,{XMLA:s},l._generateAllMember,null,{action:"loadFieldElements"})}},getMembers:function(i,r,l){var n=t.Pivot.getReportItemByFieldName(r,i).item;t.olap.base.olapCtrlObj._isMondrian&&(t.isNullOrUndefined(l.model.pivotControl)||(this._controlObj=l.model.pivotControl));var s="select {"+(n&&n.hasAllMember?r+".levels(0).AllMembers":r+".children")+"}dimension properties CHILDREN_CARDINALITY, MEMBER_TYPE on 0 from ["+e.trim(i.cube)+"]",o=t.olap._mdxParser.getSoapMsg(s,i.data,i.catalog),a=t.olap.base._getConnectionInfo(i.data);l.doAjaxPost("POST",a.url,{XMLA:o},l._generateMembers,null,{action:"fetchMembers"})},getChildren:function(e,i,r){var l,n,s="select {"+i+".children} dimension properties CHILDREN_CARDINALITY on 0 from ["+e.cube+"]",o=r.model.pivotControl;!t.isNullOrUndefined(o)&&t.olap.base.olapCtrlObj._isMondrian&&(this._controlObj=r.model.pivotControl),l=t.olap._mdxParser.getSoapMsg(s,e.data,e.catalog),n=t.olap.base._getConnectionInfo(e.data),r.doAjaxPost("POST",n.url,{XMLA:l},t.Pivot.generateChildMembers,null,{action:"nodeExpand",currentNode:i})},getSoapMsg:function(e,i,r){var l,n=t.olap.base._getConnectionInfo(i);return!t.isNullOrUndefined(this._controlObj)||!t.isNullOrUndefined(t.olap.base.olapCtrlObj)&&t.olap.base.olapCtrlObj._isMondrian?(l='<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement><![CDATA['+e+"]]></Statement></Command><Properties><PropertyList><DataSourceInfo>"+(t.isNullOrUndefined(this._controlObj)?t.olap.base.olapCtrlObj.model.dataSource.sourceInfo:this._controlObj.model.dataSource.sourceInfo)+"</DataSourceInfo><Catalog>"+r+"</Catalog><AxisFormat>TupleFormat</AxisFormat><Content>Data</Content><Format>Multidimensional</Format></PropertyList></Properties></Execute></SOAP-ENV:Body></SOAP-ENV:Envelope>",delete this._controlObj):l='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+e+" </Statement> </Command> <Properties> <PropertyList> <Catalog>"+r+"</Catalog> <LocaleIdentifier>"+n.LCID+"</LocaleIdentifier></PropertyList> </Properties> </Execute> </Body> </Envelope>",l}},t.olap.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"},t.olap.Providers={SSAS:"ssas",Mondrian:"mondrian"},t.olap.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"},t.olap.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.olap.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.olap.AxisName={Row:"rows",Column:"columns"}}(jQuery,Syncfusion)})},1010:function(e,t,r){var l,n,s;
/*!
*  filename: ej.pivot.common.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.pivot.common.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(i){n=[r(4)],void 0===(s="function"==typeof(l=i)?l.apply(t,n):l)||(e.exports=s)}(function(){ej.Pivot=ej.Pivot||{},function(e,t,r){t.Pivot={addReportItem:function(e,i){var r,l;if(i.isMeasuresDropped)""!=i.droppedClass?e.values[0].axis="row"==i.droppedClass?"rows":"column"==i.droppedClass?"columns":e.values[0].axis:e.values[0].measures=[];else{for(l in r=this.removeReportItem(e,i.droppedFieldName,i.isMeasuresDropped),t.isNullOrUndefined(r)&&(r={fieldName:i.droppedFieldName,fieldCaption:i.droppedFieldCaption,format:i.droppedFieldFormat,formatString:i.droppedFieldFormatString,showSubTotal:i.droppedFieldShowSubTotal,expression:i.droppedExpression,hierarchyUniqueName:i.droppedHierarchyUniqueName,summaryType:i.summaryType}),r)("format"==l||"formatString"==l)&&(t.isNullOrUndefined(r[l])||""==r[l])&&delete r[l];switch(i.droppedClass){case"row":""!=i.droppedPosition.toString()?e.rows.splice(i.droppedPosition,0,r):e.rows.push(r);break;case"column":""!=i.droppedPosition.toString()?e.columns.splice(i.droppedPosition,0,r):e.columns.push(r);break;case"value":""==e.cube?""!=i.droppedPosition.toString()?e.values.splice(i.droppedPosition,0,r):e.values.push(r):""!=i.droppedPosition.toString()?e.values[0].measures.splice(i.droppedPosition,0,r):e.values[0].measures.push(r);break;case"filter":""!=i.droppedPosition.toString()?e.filters.splice(i.droppedPosition,0,r):e.filters.push(r)}}},removeReportItem:function(i,r,l){var n,s=""==i.cube?t.Pivot.AnalysisMode.Pivot:t.Pivot.AnalysisMode.Olap,o=e.grep(i.columns,function(e){return e.fieldName==r});return l?i.values[0].measures=[]:o.length>0?i.columns=e.grep(i.columns,function(e){return e.fieldName!=r}):(o=e.grep(i.rows,function(e){return e.fieldName==r})).length>0?i.rows=e.grep(i.rows,function(e){return e.fieldName!=r}):(n=s==t.Pivot.AnalysisMode.Olap?i.values[0].measures:i.values,(o=e.grep(n,function(e){return e.fieldName==r})).length>0?i.values=s==t.Pivot.AnalysisMode.Olap?[{measures:e.grep(n,function(e){return e.fieldName!=r}),axis:i.values[0].axis}]:e.grep(n,function(e){return e.fieldName!=r}):(o=e.grep(i.filters,function(e){return e.fieldName==r})).length>0&&(i.filters=e.grep(i.filters,function(e){return e.fieldName!=r}))),o[0]},getReportItemByFieldName:function(i,r){var l,n="columns",s=e.grep(r.columns,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()});return 0==s.length&&(s=e.grep(r.rows,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()}),n="rows"),0==s.length&&(l=""==r.cube?r.values:r.values.length>0&&!t.isNullOrUndefined(r.values[0].measures)?r.values[0].measures:[],s=e.grep(l,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()}),n="values"),0==s.length&&(s=e.grep(r.filters,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()}),n="filters"),{item:s[0],axis:n}},getReportItemByFieldCaption:function(i,r){var l,n="columns",s=e.grep(r.columns,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()});return 0==s.length&&(s=e.grep(r.rows,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()}),n="rows"),0==s.length&&(l=""==r.cube?r.values:r.values.length>0&&!t.isNullOrUndefined(r.values[0].measures)?r.values[0].measures:[],s=e.grep(l,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()}),n="values"),0==s.length&&(s=e.grep(r.filters,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()}),n="filters"),{item:s[0],axis:n}},closePreventPanel:function(i){var r="close"!=i.type?i:this;r.element.find("[id^='preventDiv']").remove(),t.isNullOrUndefined(r.model.pivotControl)?r._currentReportItems=e.extend(!0,[],r._savedReportItems):(r.model.pivotControl.element.find("[id^='preventDiv']").remove(),r.model.pivotControl._currentReportItems=e.extend(!0,[],r.model.pivotControl._savedReportItems)),t.isNullOrUndefined(r._waitingPopup)||r._waitingPopup.hide(),t.isNullOrUndefined(r.model.pivotControl)||t.isNullOrUndefined(r.model.pivotControl._waitingPopup)||r.model.pivotControl._waitingPopup.hide()},openPreventPanel:function(i){var r=t.buildTag("div#preventDiv.errorDlg").css({width:e("body").width()+"px",height:e("body").height()+"px",position:"absolute",top:e("body").offset().top+"px",left:e("body").offset().left+"px","z-index":10})[0].outerHTML;e("#"+i._id).append(r)},_createErrorDialog:function(i,r,l){var n,s;if(t.Pivot.closePreventPanel(l),l._errorDialog=r,t.Pivot.openPreventPanel(l),0==l.element.find(".e-errorDialog:visible").length&&(n=t.isNullOrUndefined(i.Exception)?t.buildTag("div.e-errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",i)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn",l._getLocalizedLabels("OK"),{margin:"20px 0 10px 165px"}).attr("title",l._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML)[0].outerHTML).attr("title",r)[0].outerHTML:t.buildTag("div.e-errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",i.Exception.Message)[0].outerHTML+t.buildTag("br")[0].outerHTML+t.buildTag("div."+l._id+"stackTraceContent","Stack Trace :"+i.Exception.StackTraceString)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn",l._getLocalizedLabels("OK"),{margin:"20px 0 10px 165px"}).attr("title",l._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML)[0].outerHTML).attr("title",r)[0].outerHTML,l.element.append(n),l.element.find(".e-errorDialog").ejDialog({target:"#"+l._id,enableResize:!1,enableRTL:l.model.enableRTL,width:"400px",close:t.proxy(t.Pivot.closePreventPanel,l)}),s=l.element.find(".e-errorDialog").data("ejDialog"),e("#"+s._id+"_wrapper").css({left:"50%",top:"50%"}),l.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,width:"50px"}).on(t.eventType.click,function(){"nodeCheck"!=l._errorDialog||t.isNullOrUndefined(l._schemaData)||t.isNullOrUndefined(l._schemaData._selectedTreeNode)||l._schemaData._tableTreeObj.uncheckNode(l._schemaData._selectedTreeNode),l.element.find("#preventDiv").remove(),(l._errorDialog==l._getLocalizedLabels("Success")||l._errorDialog==l._getLocalizedLabels("Warning")||l._errorDialog==l._getLocalizedLabels("Exception")||l._errorDialog==l._getLocalizedLabels("Error"))&&l.element.children("#ErrorDialog_wrapper").remove()}),l.element.find(".e-dialog .e-close").attr("title","Close"),t.isNullOrUndefined(e("#"+l._id).data("ejWaitingPopup"))||e("#"+l._id).data("ejWaitingPopup").hide(),"undefined"!=typeof oclientWaitingPopup&&null!=oclientWaitingPopup&&oclientWaitingPopup.hide(),!t.isNullOrUndefined(i.Exception))){var o="Show more";e("."+l._id+"stackTraceContent").each(function(){var i=e(this).html();if(i.length>50){l._id;var r=i.substr(0,50),n=i.substr(50,i.length-50),s=r+t.buildTag("span."+l._id+"moreellipses","...")[0].outerHTML+t.buildTag("span."+l._id+"morecontent",t.buildTag("span",n).css("display","none")[0].outerHTML+t.buildTag("a."+l._id+"morelink",o).css("display","block")[0].outerHTML)[0].outerHTML;e(this).html(s)}}),e("."+l._id+"morelink").click(function(){return e(this).hasClass("less")?(e(this).removeClass("less"),e(this).html(o)):(e(this).addClass("less"),e(this).html("Show less")),e(this).parent().prev().toggle("slow",function(){}),e(this).prev().toggle("slow",function(){}),!1})}},_updateValueSortingIndex:function(i,l){if(i.SortColIndex!=r)t.PivotAnalysis._valueSorting=JSON.parse(i.SortColIndex)[0],t.PivotAnalysis._sort=l.model.valueSortSettings.sortOrder;else{i=i[0]!=r?i:i.d!=r?i.d:i;var n=e.map(i,function(e){if(null!=e)var t=e.Key;if(null!=t&&t!=r&&"SortColIndex"==t)return e});n.length>0?(i.splice(e.map(i,function(e,t){if("SortColIndex"==e.Key)return t}),1),t.PivotAnalysis._valueSorting=JSON.parse(n[0].Value),t.PivotAnalysis._sort=l.model.valueSortSettings.sortOrder):t.PivotAnalysis._valueSorting=null}},_memberSortBtnClick:function(i){var l,n,s,o,a,d,h,c=this.element.hasClass("e-pivotclient")&&"servermode"==this.model.operationalMode&&"olap"==this.model.analysisMode,u="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl:this,g="ejPivotGrid"==this.pluginName&&u.model.analysisMode==t.Pivot.AnalysisMode.Olap&&u.model.operationalMode==t.Pivot.OperationalMode.ServerMode,p=e(i.target).parents(".e-memberEditorDiv").find(".e-editorTreeView"),m=this._sortType=e(i.target).hasClass("e-memberAscendingIcon")?"ascending":"descending",_=[],f=jQuery.extend(!0,[],this._memberTreeObj._dataSource);if(this.element.find(".e-memberDrillPager").is(":visible")&&(l=this.model.memberEditorPageSize==r?this.model.pivotControl.model.memberEditorPageSize:this.model.memberEditorPageSize,_=t.Pivot._getParentsTreeList(this,this._drilledNode,this._editorTreeData).concat(t.DataManager(this._editorDrillTreeData[this._drilledNode]).executeLocal(t.Query().sortBy("name",this._sortType).page(this._memberDrillPageSettings.currentMemberDrillPage,l)))),!t.isNullOrUndefined(p)&&p.length>0){if(t.Pivot.updateTreeView(this),n=(this.model.enableMemberEditorPaging||!t.isNullOrUndefined(this.model.pivotControl)&&this.model.pivotControl.model.enableMemberEditorPaging)&&!this._isSearchApplied?this._editorTreeData:p.data("ejTreeView").model.fields.dataSource,s=c||"All"!=n[0].id&&"(All)_0"!=n[0].id?n:n.slice(1),_.length>0&&(s=_),s.length>1&&"SearchFilterSelection"==s[0].id&&(s=s.slice(1)),o=c?[]:n.length>1&&("All"==n[0].id||"(All)_0"==n[0].id)?n.splice(0,1):[],a=t.DataManager(s).executeLocal(t.Query().sortBy("name",m)),!t.isNullOrUndefined(o)&&o.length>0&&(a.splice(0,0,o[0]),n.splice(0,0,o[0])),(this.model.enableMemberEditorPaging||!t.isNullOrUndefined(this.model.pivotControl)&&this.model.pivotControl.model.enableMemberEditorPaging)&&0==_.length&&(a=t.DataManager(a).executeLocal(t.Query().page(this._memberPageSettings.currentMemeberPage,(this.model.memberEditorPageSize||this.model.pivotControl.model.memberEditorPageSize)+(1==this._memberPageSettings.currentMemeberPage?1:0)))),u.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&a.length>0&&"All"!=a[0].id&&"(All)_0"!=a[0].id&&!t.isNullOrUndefined(o)&&o.length>0&&a.splice(0,0,o[0]),o={},p.data("ejTreeView").model.fields.dataSource.length>1&&"SearchFilterSelection"==p.data("ejTreeView").model.fields.dataSource[1].id&&"SearchFilterSelection"!=a[1].id&&a.splice(1,0,{id:"SearchFilterSelection",name:this._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:this._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"}),c&&this._isSearchApplied&&a.splice(0,0,{id:"SearchFilterSelection",name:this._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:this._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"}),t.isNullOrUndefined(p)||p.ejTreeView({fields:{dataSource:jQuery.extend(!0,[],a)}}),_.length>0&&!t.isNullOrUndefined(f)&&(this._memberTreeObj._dataSource=f),g)for(d=this.element.find(".e-editorTreeView").find("li"),h=0;h<d.length;h++)t.isNullOrUndefined(e(d[h]).attr("id"))||e(d[h]).attr("data-tag",t.DataManager(p.data("ejTreeView").model.fields.dataSource).executeLocal(t.Query().where("id","equal",e(d[h]).attr("id")))[0].tag);t.Pivot._separateAllMember(this)}},_contextMenuOpen:function(i,r){var l,n,s,o;if(t.Pivot.openPreventPanel(r),r._selectedMember=e(i.target),"ejPivotGrid"==r.pluginName?(l=r.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot",s=e("#pivotTree").data("ejMenu")):(t.isNullOrUndefined(r.model.pivotControl)||(l=r.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot"),s=e("#"+r._id+"_pivotTreeContextMenu").data("ejMenu")),l==t.Pivot.AnalysisMode.Olap){if(t.isNullOrUndefined(e(i.target).parent().attr("data-tag"))&&e(i.target).hasClass("e-pivotButton")&&e(i.target).children(".e-pvtBtn:eq(0)").length>0)return s.disable(),r._selectedMember=e(i.target).children(".e-pvtBtn:eq(0)"),!1;!t.isNullOrUndefined(e(i.target).parent().attr("data-tag"))&&e(i.target).parent().attr("data-tag").split(":")[1].toLowerCase().startsWith("[measures]")?s.disable():t.isNullOrUndefined(r._selectedMember.parent().attr("data-tag"))||"measures"!=r._selectedMember.parent().attr("data-tag").split(":")[1].toLowerCase()?t.isNullOrUndefined(e(i.target).parent().attr("data-tag"))?s.disable():(s.disableItem(r._getLocalizedLabels("AddToValues")),e(i.target.parentElement).find(".e-namedSetCDB").length>0?s.disableItem(r._getLocalizedLabels("AddToFilter")):s.enableItem(r._getLocalizedLabels("AddToFilter")),s.enableItem(r._getLocalizedLabels("AddToRow")),s.enableItem(r._getLocalizedLabels("AddToColumn"))):(s.disableItem(r._getLocalizedLabels("AddToValues")),s.disableItem(r._getLocalizedLabels("AddToFilter")),s.enableItem(r._getLocalizedLabels("AddToRow")),s.enableItem(r._getLocalizedLabels("AddToColumn")))}else l==t.Pivot.AnalysisMode.Pivot&&(n=i.target.textContent,e(i.target).hasClass("e-btn")?(s.enable(),"ejPivotGrid"==r.pluginName&&(s.disableItem(r._getLocalizedLabels("CalculatedField")),"values"==e(i.target).parents(".e-pivotButton").attr("data-tag").split(":")[0].toLowerCase()&&(r.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&e.grep(r.model.dataSource.values,function(e){return e.fieldCaption==n&&1==e.isCalculatedField}).length>0?s.disable():r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&e.grep(JSON.parse(r.getOlapReport()).PivotCalculations,function(e){return e.FieldHeader==n&&8==e.CalculationType}).length>0&&s.disable(),s.enableItem(r._getLocalizedLabels("CalculatedField"))))):e("#pivotTree").length>0?(s=e("#pivotTree").data("ejMenu")).disable():s.disable());o=r.model.pivotControl,t.isNullOrUndefined(o)||o.model.analysisMode!=t.Pivot.AnalysisMode.Pivot||0==e(i.target).parents(".e-schemaValue").length&&s.disableItem(r._getLocalizedLabels("SummarizeValueBy"))},_searchTreeNodes:function(i){var r,l,n,s,o,a,d=e(i.target).hasClass("searchTreeView")?this.element.find(".searchTreeView").data("ejMaskEdit"):this.element.find(".searchEditorTreeView").data("ejMaskEdit"),h=e(i.target).hasClass("searchTreeView")?this.model.operationalMode==t.Pivot.OperationalMode.ClientMode||this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this.element.find(".e-schemaFieldTree").data("ejTreeView"):this.element.find(".e-cubeTreeView").data("ejTreeView"):this.element.find(".e-editorTreeView").data("ejTreeView"),c={id:"SearchFilterSelection",name:this._getLocalizedLabels("AddCurrentSelectionToFilter"),hasChildren:!1,checkedStatus:!0,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"},u=h.element,g=u.find("li[data-isItemSearch='true']"),p=t.isNullOrUndefined(d.get_StrippedValue())?"":d.get_StrippedValue().toLowerCase();if(g.length>0&&e(g).each(function(e,t){t.removeAttribute("data-isItemSearch")}),p.length>0){var m=[],_=[],f=u.find("ul>li>div>a");for(r=0;r<f.length;r++)-1!=e(f[r]).text().toLowerCase().indexOf(p)||"(All)_0"==e(e(f[r]).closest("li")).attr("id")||"All"==e(e(f[r]).closest("li")).attr("id")||"SearchFilterSelection"==e(e(f[r]).closest("li")).attr("id")?m.push(f[r]):_.push(f[r]);for((l=u.find(m).closest("li").css("display","block")).length>0&&(this._isOptionSearch=!0,e(l).each(function(t,i){"SearchFilterSelection"!=e(i).attr("id")&&i.setAttribute("data-isItemSearch",!0)}),u.hasClass("e-editorTreeView")&&(!u.find("li span.e-searchfilterselection").length>0?("(All)_0"==u.find("li:first").attr("id")||"All"==u.find("li:first").attr("id")?(l.length>1&&h.insertAfter(c,u.find("li:first")),(this.element.hasClass("e-pivotschemadesigner")?this.model.pivotControl.model.analysisMode:this.model.analysisMode)==t.Pivot.AnalysisMode.Pivot&&u.find("li span.e-searchfilterselection").closest("li").css("padding","0")):h.insertBefore(c,u.find("li:first")),u.find("li span.e-searchfilterselection").closest("li").attr("data-tag",c.tag)):u.find("li span.e-searchfilterselection").length>0&&!this._isSelectSearchFilter&&h.uncheckNode(u.find("li span.e-searchfilterselection").closest("li")))),u.find(_).closest("li").css("display","none"),a=0;a<l.length;a++)(s=(n=e(l[a])).parents("ul").closest("li").css("display","block")).length>0&&(h.expandNode(s),-1!=h.model.expandedNodes.indexOf(e(h._liList).index(s))||t.isNullOrUndefined(window._temp)||window._temp.push(s)),(o=n.children("ul")).length>0&&0==o.children("li:visible").length&&(n.children("ul").children("li").css("display","block"),h.expandNode(l[a]),-1!=h.model.expandedNodes.indexOf(e(h._liList).index(l[a]))||t.isNullOrUndefined(window._temp)||window._temp.push(l[a]))}else{u.find("ul>li").css("display","block"),u.find("li span.e-searchfilterselection").closest("li").length>0&&h.removeNode(u.find("#SearchFilterSelection")),e(u.find("ul>li")).each(function(e,t){t.removeAttribute("data-isItemSearch")}),this._isOptionSearch=!1;var b=e(u).find("ul>li"),C=0,S=0;if("(All)_0"==e(e(b)[0]).attr("id")||"All"==e(e(b)[0]).attr("id")){for(a=1;a<e(b).length;a++)e(e(b)[a]).find("span.e-checkmark").length>0?C++:S++;C>0&&S>0?e(u.find("ul>li")[0]).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-checkmark").addClass("e-stop"):C>0&&0==S?e(u.find("ul>li")[0]).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-stop").addClass("e-checkmark"):e(u.find("ul>li")[0]).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-checkmark").removeClass("e-stop")}if(!t.isNullOrUndefined(window._temp))for(a=0;a<window._temp.length;a++)h._collpaseNode(window._temp[a]);window._temp=[],e(i.target).hasClass("searchTreeView")&&h.collapseAll()}},_updateSearchFilterSelection:function(i,r,l){var n,s,o={},a={};"SearchFilterSelection"==i.id&&(n=e(r).find("li:not([data-isItemSearch='true'])"),"nodeCheck"==i.type?(l._isSelectSearchFilter=!0,l._isOptionSearch?n.length>0&&e(n).each(function(i,n){"SearchFilterSelection"!=e(n).attr("id")&&!t.isNullOrUndefined(l._currentFilterList[e(n).attr("id")])&&l._currentFilterList[e(n).attr("id")].checkedStatus&&e(r).ejTreeView("checkNode",e(n))}):n.length>0&&(l.model.enableMemberEditorPaging&&(o=l._currentFilterList,e(o).each(function(e,t){a[t.id]=t})),e(l._editorTreeData).each(function(i,r){for(var s=0;s<n.length;s++){if(n[s].id==r.id){r.checkedStatus=e(n[s]).find(".checked").length>0;break}t.isNullOrUndefined(l._currentFilterList)||(r.checkedStatus=l.model.enableMemberEditorPaging&&!t.isNullOrUndefined(a)?a[e(r).attr("id")].checkedStatus:l._currentFilterList[e(r).attr("id")].checkedStatus)}}),s=!0,e(l._editorTreeData).each(function(e,t){if(t.checkedStatus)return s=!1,!1}),s&&l._editorTreeData.length>0?(l._dialogOKBtnObj.disable(),l.element.find(".e-dialogOKBtn").attr("disabled","disabled")):(l._dialogOKBtnObj.enable(),l.element.find(".e-dialogOKBtn").removeAttr("disabled")))):"nodeUncheck"==i.type&&(l._isSelectSearchFilter=!1,l._isOptionSearch?n.length>0&&e(n).each(function(t,i){"SearchFilterSelection"!=e(i).attr("id")&&e(r).ejTreeView("uncheckNode",e(i))}):n.length>0&&(e(l._editorTreeData).each(function(t,i){for(var r=0;r<n.length;r++){if(n[r].id==i.id){i.checkedStatus=e(n[r]).find(".checked").length>0;break}i.checkedStatus=!1}}),s=!0,e(l._editorTreeData).each(function(e,t){if(t.checkedStatus)return s=!1,!1}),s&&l._editorTreeData.length>0?(l._dialogOKBtnObj.disable(),l.element.find(".e-dialogOKBtn").attr("disabled","disabled")):(l._dialogOKBtnObj.enable(),l.element.find(".e-dialogOKBtn").removeAttr("disabled")))))},editorTreeNavigatee:function(i,r){var l,n;if(e(i.target).parents(".e-memberPager").length>0){if(n=r._memberPageSettings.currentMemeberPage,!e(i.target).hasClass("e-pageDisabled")){if(e(i.target).hasClass("e-nextPage"))r._memberPageSettings.startPage+=r.model.memberEditorPageSize,r._memberPageSettings.currentMemeberPage+=1,r._memberPageSettings.endPage+=r.model.memberEditorPageSize;else if(e(i.target).hasClass("e-prevPage"))r._memberPageSettings.currentMemeberPage-=1,r._memberPageSettings.startPage=Math.abs(r._memberPageSettings.startPage-(r._memberPageSettings.currentMemeberPage,r.model.memberEditorPageSize)),r._memberPageSettings.endPage-=r.model.memberEditorPageSize;else if(e(i.target).hasClass("e-firstPage"))r._memberPageSettings.currentMemeberPage=1,r._memberPageSettings.endPage=r.model.memberEditorPageSize,r._memberPageSettings.startPage=0;else if(e(i.target).hasClass("e-lastPage"))r._memberPageSettings.currentMemeberPage=parseInt(e.trim(r.element.find(".e-memberPageCount").text().split("/")[1])),r._memberPageSettings.endPage=r._memberPageSettings.currentMemeberPage*r.model.memberEditorPageSize,r._memberPageSettings.startPage=r._memberPageSettings.endPage-r.model.memberEditorPageSize;else{if(parseInt(e(i.target).val())>e.trim(r.element.find(".e-memberPageCount").text().split("/")[1])||0==parseInt(e(i.target).val()))return r.element.find(".e-memberCurrentPage").val(n),!1;r._memberPageSettings.currentMemeberPage=parseInt(e(i.target).val()),r._memberPageSettings.endPage=r._memberPageSettings.currentMemeberPage*r.model.memberEditorPageSize,r._memberPageSettings.startPage=1==r._memberPageSettings.currentMemeberPage||0==r._memberPageSettings.currentMemeberPage?0:r._memberPageSettings.endPage-r.model.memberEditorPageSize}r._waitingPopup.show(),r.element.hasClass("e-pivotclient")&&r.model.analysisMode==t.Pivot.AnalysisMode.Olap&&r.model.operationalMode==t.Pivot.OperationalMode.ServerMode?(r.model.enableMemberEditorSorting&&(r._editorTreeData=t.DataManager(r._editorTreeData).executeLocal(t.Query().sortBy("name",r._sortType))),this.editorTreePageInfoSuccess(r._editorTreeData,r)):("ejPivotSchemaDesigner"!=r.pluginName?r._isMemberPageFilter=!0:r.model.pivotControl._isMemberPageFilter=!0,t.Pivot.updateTreeView(r),l=t.DataManager(r._editorTreeData).executeLocal(t.Query().sortBy("name",t.isNullOrUndefined(r._sortType)?"":r._sortType).where(t.Predicate("pid","equal",null).and("id","notequal","All").and("id","notequal","(All)_0")).page(r._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.memberEditorPageSize:r.model.memberEditorPageSize)),r._memberPageSettings.currentMemeberPage>1?r.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):r.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),r._memberPageSettings.currentMemeberPage==parseInt(e.trim(r.element.find(".e-memberPageCount").text().split("/")[1]))?r.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):r.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),r.element.find(".e-memberCurrentPage").val(r._memberPageSettings.currentMemeberPage),r.element.find(".e-nextPageDiv .e-pageDisabled").css("opacity","0.5"),r.element.find(".e-nextPageDiv .e-pageEnabled").css("opacity","1"),t.Pivot._createSearchTreeview(l,r),r._waitingPopup.hide())}}else if(e(i.target).parents(".e-memberSearchPager").length>0){if(n=r._memberSearchPageSettings.currentMemberSearchPage,!e(i.target).hasClass("e-pageDisabled")){if(e(i.target).hasClass("e-nextPage"))r._memberSearchPageSettings.startSearchPage+=r.model.memberEditorPageSize,r._memberSearchPageSettings.currentMemberSearchPage+=1,r._memberSearchPageSettings.endSearchPage+=r.model.memberEditorPageSize;else if(e(i.target).hasClass("e-prevPage"))r._memberSearchPageSettings.currentMemberSearchPage-=1,r._memberSearchPageSettings.startSearchPage=Math.abs(r._memberSearchPageSettings.startSearchPage-(r._memberSearchPageSettings.currentMemberSearchPage,r.model.memberEditorPageSize)),r._memberSearchPageSettings.endSearchPage-=r.model.memberEditorPageSize;else if(e(i.target).hasClass("e-firstPage"))r._memberSearchPageSettings.currentMemberSearchPage=1,r._memberSearchPageSettings.endSearchPage=r.model.memberEditorPageSize,r._memberSearchPageSettings.startSearchPage=0;else if(e(i.target).hasClass("e-lastPage"))r._memberSearchPageSettings.currentMemberSearchPage=parseInt(e.trim(r.element.find(".e-memberSearchPageCount").text().split("/")[1])),r._memberSearchPageSettings.endSearchPage=r._memberSearchPageSettings.currentMemberSearchPage*r.model.memberEditorPageSize,r._memberSearchPageSettings.startSearchPage=r._memberSearchPageSettings.endSearchPage-r.model.memberEditorPageSize;else{if(parseInt(e(i.target).val())>e.trim(r.element.find(".e-memberSearchPageCount").text().split("/")[1])||0==parseInt(e(i.target).val()))return r.element.find(".e-memberCurrentSearchPage").val(n),!1;r._memberSearchPageSettings.currentMemberSearchPage=parseInt(e(i.target).val()),r._memberSearchPageSettings.endSearchPage=r._memberSearchPageSettings.currentMemberSearchPage*r.model.memberEditorPageSize,r._memberSearchPageSettings.startSearchPage=1==r._memberSearchPageSettings.currentMemberSearchPage||0==r._memberSearchPageSettings.currentMemberSearchPage?0:r._memberSearchPageSettings.endSearchPage-r.model.memberEditorPageSize}r._waitingPopup.show(),r.element.hasClass("e-pivotclient")&&r.model.analysisMode==t.Pivot.AnalysisMode.Olap&&r.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._editorTreeSearchPageInfoSuccess(r._editorSearchTreeData,r):("ejPivotSchemaDesigner"!=r.pluginName?r._isMemberPageFilter=!0:r.model.pivotControl._isMemberPageFilter=!0,this._editorTreeSearchPageInfoSuccess(r._editorSearchTreeData,r))}}else if(e(i.target).parents(".e-memberDrillPager").length>0&&(n=r._memberDrillPageSettings.currentMemberDrillPage,!e(i.target).hasClass("e-pageDisabled"))){if(e(i.target).hasClass("e-nextPage"))r._memberDrillPageSettings.startDrillPage+=r.model.memberEditorPageSize,r._memberDrillPageSettings.currentMemberDrillPage+=1,r._memberDrillPageSettings.endDrillPage+=r.model.memberEditorPageSize;else if(e(i.target).hasClass("e-prevPage"))r._memberDrillPageSettings.currentMemberDrillPage-=1,r._memberDrillPageSettings.startDrillPage=Math.abs(r._memberDrillPageSettings.startDrillPage-(r._memberDrillPageSettings.currentMemberDrillPage,r.model.memberEditorPageSize)),r._memberDrillPageSettings.endDrillPage-=r.model.memberEditorPageSize;else if(e(i.target).hasClass("e-firstPage"))r._memberDrillPageSettings.currentMemberDrillPage=1,r._memberDrillPageSettings.endDrillPage=r.model.memberEditorPageSize,r._memberDrillPageSettings.startDrillPage=0;else if(e(i.target).hasClass("e-lastPage"))r._memberDrillPageSettings.currentMemberDrillPage=parseInt(e.trim(r.element.find(".e-memberDrillPageCount").text().split("/")[1])),r._memberDrillPageSettings.endDrillPage=r._memberDrillPageSettings.currentMemberDrillPage*r.model.memberEditorPageSize,r._memberDrillPageSettings.startDrillPage=r._memberDrillPageSettings.endDrillPage-r.model.memberEditorPageSize;else{if(parseInt(e(i.target).val())>e.trim(r.element.find(".e-memberDrillPageCount").text().split("/")[1])||0==parseInt(e(i.target).val()))return r.element.find(".e-memberCurrentDrillPage").val(n),!1;r._memberDrillPageSettings.currentMemberDrillPage=parseInt(e(i.target).val()),r._memberDrillPageSettings.endDrillPage=r._memberDrillPageSettings.currentMemberDrillPage*r.model.memberEditorPageSize,r._memberDrillPageSettings.startDrillPage=1==r._memberDrillPageSettings.currentMemberDrillPage||0==r._memberDrillPageSettings.currentMemberDrillPage?0:r._memberDrillPageSettings.endDrillPage-r.model.memberEditorPageSize}r._waitingPopup.show(),this._editorTreeDrillPageInfoSuccess(r._memberTreeObj._dataSource.slice(),r)}},editorTreePageInfoSuccess:function(i,l){setTimeout(function(){var n,s;l._memberPageSettings.currentMemeberPage>1?l.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):l.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),l._memberPageSettings.currentMemeberPage==parseInt(e.trim(l.element.find(".e-memberPageCount").text().split("/")[1]))?l.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):l.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),l.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&(n=i[0]!=r?i[0].Value:i.d!=r?i.d[0].Value:i.EditorTreeInfo,(s=e.parseJSON(n)).splice(-1,1)),l.element.find(".e-memberCurrentPage").val(l._memberPageSettings.currentMemeberPage),l._appendTreeViewData(l.model.operationalMode==t.Pivot.OperationalMode.ClientMode?s:t.DataManager(l._editorTreeData).executeLocal(t.Query().where("pid","equal",r).page(l._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize:l.model.memberEditorPageSize)),l.element.find(".pvtBtn").parent("[data-tag='Slicers:"+l._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0),l._waitingPopup.hide()},0)},_editorTreeDrillPageInfoSuccess:function(i,l){setTimeout(function(){var n,s,o;l._memberDrillPageSettings.currentMemberDrillPage>1?l.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):l.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),l._memberDrillPageSettings.currentMemberDrillPage==parseInt(e.trim(l.element.find(".e-memberDrillPageCount").text().split("/")[1]))?l.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):l.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),l.element.find(".e-memberCurrentDrillPage").val(l._memberDrillPageSettings.currentMemberDrillPage),s=0,i.length>0&&i[0].length>0&&"All"==i[0][0].id&&i[0].splice(0,1),e.each(i,function(e,t){if(1!=t.length||!t[0].expanded)return!1;s=e}),o=l.model.enableMemberEditorSorting&&l._sortType?t.DataManager(t.DataManager(l._editorTreeData).executeLocal(t.Query().where("pid","equal",i[s][0].id).sortBy("name",l._sortType))).executeLocal(t.Query().where("pid","notequal",r).page(l._memberDrillPageSettings.currentMemberDrillPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize:l.model.memberEditorPageSize)):t.DataManager(t.DataManager(l._editorTreeData).executeLocal(t.Query().where("pid","equal",i[s][0].id))).executeLocal(t.Query().where("pid","notequal",r).page(l._memberDrillPageSettings.currentMemberDrillPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize:l.model.memberEditorPageSize)),l._editorDrillTreePageSettings[i[s][0].id]=e.extend(!0,{},l._memberDrillPageSettings),l.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0?(n=t.Pivot._getParentsTreeList(l,i[s][0].id,l._editorTreeData).concat(o),"ejPivotClient"!=l.pluginName?t.Pivot._createSearchTreeview(n,l):l._appendTreeViewData(n,l.element.find(".pvtBtn").parent("[data-tag='Slicers:"+l._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0)):"ejPivotClient"!=l.pluginName?t.Pivot._createSearchTreeview(o,l):l._appendTreeViewData(o,l.element.find(".pvtBtn").parent("[data-tag='Slicers:"+l._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0),l._waitingPopup.hide()},0)},_editorTreeSearchPageInfoSuccess:function(i,r){setTimeout(function(){var l,n="ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.memberEditorPageSize:r.model.memberEditorPageSize;for(r._memberSearchPageSettings.currentMemberSearchPage>1?r.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):r.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),r._memberSearchPageSettings.currentMemberSearchPage==parseInt(e.trim(r.element.find(".e-memberSearchPageCount").text().split("/")[1]))?r.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):r.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),i=t.DataManager(i).executeLocal(t.Query().where(t.Predicate("id","notequal","(All)_0").and("id","notequal","All"))).slice((r._memberSearchPageSettings.currentMemberSearchPage-1)*n,(r._memberSearchPageSettings.currentMemberSearchPage-1)*n+n),l=0;l<i.length;l++)t.isNullOrUndefined(i[l].pid)||(i[l].parentId=i[l].pid);for(l=0;l<i.length;l++)t.Pivot._appendParentNodes(i,i[l],r);r.element.find(".e-memberCurrentSearchPage").val(r._memberSearchPageSettings.currentMemberSearchPage),i.splice(0,0,{id:"SearchFilterSelection",name:r._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:r._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"}),"ejPivotClient"==r.pluginName&&r.model.analysisMode==t.Pivot.AnalysisMode.Olap&&r.model.operationalMode==t.Pivot.OperationalMode.ServerMode?r._appendTreeViewData(i,r.element.find(".pvtBtn").parent("[data-tag='Slicers:"+r._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):t.Pivot._createSearchTreeview(i,r),r._waitingPopup.hide(),r._parentNodeCollection={},r._parentSearchNodeCollection={}},0)},_drillEditorTreeNode:function(i,l,n){var s,o;l._waitingPopup.show(),s=i.childNodes,l._isEditorDrillPaging&&!l._isEditorCollapseDrillPaging?l.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0&&(l._memberDrillPageSettings={currentMemberDrillPage:1,startDrillPage:0,endDrillPage:0},t.isNullOrUndefined(i.parentNode.id)||(l._editorDrillTreeData[i.parentNode.id]=s.slice(),l._editorDrillTreePageSettings[i.parentNode.id]=e.extend(!0,{},l._memberDrillPageSettings)),this._refreshDrillEditorPager(i,l,n)):l._isEditorCollapseDrillPaging&&(l.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0&&(l._isEditorCollapseDrillPaging=!1,l._memberDrillPageSettings=t.isNullOrUndefined(i.parentNode.id)?i.drillPageSettings:i.drillPageSettings[i.parentNode.id]),this._refreshDrillEditorPager(i,l,n)),l._drilledNode=i.parentNode.id,o=t.isNullOrUndefined(i.parentNode.id)?i.parentNode.concat(i.childNodes):this._getParentsTreeList(l,i.parentNode.id,l._editorTreeData).concat(t.DataManager(s).executeLocal(t.Query().where("pid","notequal",r).page(l._memberDrillPageSettings.currentMemberDrillPage,n))),"ejPivotClient"==l.pluginName&&l.model.analysisMode==t.Pivot.AnalysisMode.Olap&&l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?l._appendTreeViewData(o,l.element.find(".pvtBtn").parent("[data-tag='Slicers:"+l._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):t.Pivot._createSearchTreeview(o,l),l._waitingPopup.hide()},_refreshDrillEditorPager:function(t,i,r){i.element.find(".e-memberPager,.e-memberSearchPager").css("display","none"),i.element.find(".e-memberDrillPager").css("display","block");var l=t.childNodes.length/r;l!=Math.round(l)&&(l=parseInt(l)+1),i._memberDrillPageSettings.currentMemberDrillPage==l&&i.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").addClass("disabled"),i.element.find(".e-memberDrillPageCount").html("/ "+l),i.element.find(".e-memberCurrentDrillPage").val(i._memberDrillPageSettings.currentMemberDrillPage),i._memberDrillPageSettings.currentMemberDrillPage>1?i.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):i.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),i._memberDrillPageSettings.currentMemberDrillPage==parseInt(e.trim(i.element.find(".e-memberDrillPageCount").text().split("/")[1]))?i.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):i.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),t.childNodes=t.childNodes.slice((i._memberDrillPageSettings.currentMemberDrillPage-1)*r,i._memberDrillPageSettings.currentMemberDrillPage*r)},_getParentsTreeList:function(e,i,r){var l,n=[];do{parentNodes=t.DataManager(r).executeLocal(t.Query().where("id","equal",i)),l=!t.isNullOrUndefined(parentNodes)&&parentNodes.length>0&&!t.isNullOrUndefined(parentNodes[0].pid),n.push(new t.Predicate("id","equal",i)),i=l?parentNodes[0].pid:null}while(!t.isNullOrUndefined(i));return t.DataManager(r).executeLocal(t.Query().where(t.Predicate.or(n)))},_onNodeCollapse:function(i){var l,n=t.isNullOrUndefined(i.olapCtrlObj)?this:i.olapCtrlObj,s=!1,o={memberEditorPageSize:"ejPivotSchemaDesigner"==n.pluginName?n.model.pivotControl.model.memberEditorPageSize:n.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==n.pluginName?n.model.pivotControl.model.enableMemberEditorPaging:n.model.enableMemberEditorPaging};if(jQuery.each(n._editorTreeData,function(e,r){r.id==i.id?(t.isNullOrUndefined(r.pid)||(i.parentId=r.pid),r.expanded=!1):r.pid==i.id&&(t.isNullOrUndefined(n._editorDrillTreeData[r.id])||(s=!0))}),o.enableMemberEditorPaging&&(s||!t.isNullOrUndefined(n._editorDrillTreeData[i.id])||""==i.parentId)){n.element.find(".searchEditorTreeView").data("ejMaskEdit").clear(),n._lastSavedTree=[],n._isEditorDrillPaging=!1,n.element.find(".e-memberPager").length>0?(n.element.find(".e-memberPager").css("display","block"),n.element.find(".e-memberDrillPager,.e-memberSearchPager").css("display","none")):n.element.find(".e-memberDrillPager, .e-memberSearchPager").css("display","none");var a=[],d=i.parentId,h=!1,c=!1,u="";if(!t.isNullOrUndefined(d)&&""!=d){do{parentNodes=t.DataManager(n._editorTreeData).executeLocal(t.Query().where("id","equal",d)),h=!!(h||o.memberEditorPageSize<=t.DataManager(n._editorTreeData).executeLocal(t.Query().where("pid","equal",d)).length),a.push(new t.Predicate(h?"id":"pid","equal",d)),!c&&h&&o.memberEditorPageSize<t.DataManager(n._editorTreeData).executeLocal(t.Query().where("pid","equal",d)).length&&(c=!0,u=d),d=parentNodes[0].pid}while(!t.isNullOrUndefined(d));h?a.push(new t.Predicate("id","equal",i.parentId)):a.push(new t.Predicate("pid","equal",r))}h?(t.Pivot._makeAncestorsExpandable(n,i.parentId),n._isEditorCollapseDrillPaging=!0,(l={drillPageSettings:t.isNullOrUndefined(n._editorDrillTreePageSettings[u])&&"ejPivotSchemaDesigner"==n.pluginName?n.model.pivotControl._editorDrillTreePageSettings[u]:n._editorDrillTreePageSettings[u],parentNode:t.DataManager(e.extend(!0,[],n._editorTreeData)).executeLocal(t.Query().where(t.Predicate.or(a))),childNodes:t.DataManager(e.extend(!0,[],n._editorTreeData)).executeLocal(t.Query().where("pid","equal",u))}).parentNode=e.grep(l.parentNode,function(t){var i=!1;return e.each(l.childNodes,function(e,r){r.id==t.id&&(r.expanded=!0,i=!0)}),!i}),t.Pivot._drillEditorTreeNode(l,n,o.memberEditorPageSize)):(n.model.enableMemberEditorSorting&&(n._editorTreeData=t.DataManager(n._editorTreeData).executeLocal(t.Query().sortBy("name",n._sortType))),0==a.length&&a.push(new t.Predicate("pid","equal",r)),n.element.find(".e-memberPager").length>0?"ejPivotClient"!=n.pluginName?t.Pivot._createSearchTreeview(t.DataManager(n._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(a)).page(n._memberPageSettings.currentMemeberPage,o.memberEditorPageSize)),n):n._appendTreeViewData(t.DataManager(n._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(a)).page(n._memberPageSettings.currentMemeberPage,o.memberEditorPageSize)),n.element.find(".pvtBtn").parent("[data-tag='Slicers:"+n._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):"ejPivotClient"!=n.pluginName?t.Pivot._createSearchTreeview(t.DataManager(n._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(a))),n):n._appendTreeViewData(t.DataManager(n._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(a))),n.element.find(".pvtBtn").parent("[data-tag='Slicers:"+n._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0))}},_searchEditorTreeNodes:function(i,l){if(t.isNullOrUndefined(window.event)?0!=i.which&&13!=i.which:0!=window.event.which&&13!=window.event.which){t.isNullOrUndefined(l._waitingPopup.element)||l._waitingPopup.show();var n=this;setTimeout(function(){var i,s,o,a,d,h={memberEditorPageSize:"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize:l.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.enableMemberEditorPaging:l.model.enableMemberEditorPaging},c="";if("ejPivotClient"!=l.pluginName||t.isNullOrUndefined(l._pivotSchemaDesigner)){if(t.isNullOrUndefined(l.element.find(".searchEditorTreeView"))||0==l.element.find(".searchEditorTreeView").length)return!1;c=t.isNullOrUndefined(e.trim(l.element.find(".searchEditorTreeView").val()))?"":e.trim(l.element.find(".searchEditorTreeView").val()).toLowerCase()}else{if(t.isNullOrUndefined(l._pivotSchemaDesigner.element.find(".searchEditorTreeView"))||0==l._pivotSchemaDesigner.element.find(".searchEditorTreeView").length)return!1;c=t.isNullOrUndefined(e.trim(l._pivotSchemaDesigner.element.find(".searchEditorTreeView").val()))?"":e.trim(l._pivotSchemaDesigner.element.find(".searchEditorTreeView").val()).toLowerCase()}if(""!=c){var u=jQuery.extend(!0,[],t.DataManager(l._editorTreeData).executeLocal(t.Query().where("name","contains",c,!0).sortBy("name",t.isNullOrUndefined(l._sortType)?"":l._sortType))),g=e.extend(!0,[],u.slice(0,h.memberEditorPageSize+1)),p=h.enableMemberEditorPaging?g:u;for(i=0;i<p.length;i++)t.isNullOrUndefined(p[i].pid)||(p[i].parentId=p[i].pid);for(i=0;i<p.length;i++)n._appendParentNodes(p,p[i],l);l._isSearchApplied=!0,u.length>0?(l._isSelectSearchFilter=l.model.enableCheckStateOnSearch,h.enableMemberEditorPaging&&(l.element.find(".e-memberSearchPager").find(".e-nextPageDiv").length>0||l.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0)&&(l._memberSearchPageSettings.currentMemberSearchPage=1,l._memberSearchPageSettings.startSearchPage=0,l._memberSearchPageSettings.endSearchPage=0,l.element.find(".e-memberPager,.e-memberDrillPager").css("display","none"),l._editorSearchTreeData=u.slice(),(s=t.DataManager(u).executeLocal(t.Query().where(t.Predicate("id","notequal","(All)_0").and("id","notequal","All"))).length/h.memberEditorPageSize)!=Math.round(s)&&(s=parseInt(s)+1),s>1&&l.element.find(".e-memberSearchPager").css("display","block"),l._memberSearchPageSettings.currentMemberSearchPage==s&&l.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").addClass("disabled"),l.element.find(".e-memberSearchPageCount").html("/ "+s),l.element.find(".e-memberCurrentSearchPage").val(l._memberSearchPageSettings.currentMemberSearchPage),l._memberSearchPageSettings.currentMemberSearchPage>1?l.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):l.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),l._memberSearchPageSettings.currentMemberSearchPage==parseInt(e.trim(l.element.find(".e-memberSearchPageCount").text().split("/")[1]))?l.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):l.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"))):(l.element.find(".e-memberPager,.e-memberSearchPager,.e-memberDrillPager").css("display","none"),l.element.find(".e-dialogFooter").css("margin-top","5px")),p.length>0&&("All"==p[0].id&&p.splice(0,1),p.splice(0,0,{id:"SearchFilterSelection",name:l._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:l._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"})),"ejPivotClient"==l.pluginName&&l.model.analysisMode==t.Pivot.AnalysisMode.Olap&&l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?l._appendTreeViewData(p,l.element.find(".pvtBtn").parent("[data-tag='Slicers:"+l._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):n._createSearchTreeview(p,l)}else l._isSearchApplied=!1,l._isSelectSearchFilter=l.model.enableCheckStateOnSearch,o=!t.isNullOrUndefined(l._lastSavedTree)&&e.grep(l._lastSavedTree,function(e){return e.pid}).length>0,h.enableMemberEditorPaging&&l.element.find(".e-memberSearchPager").find(".e-nextPageDiv").length>0&&(l._editorSearchTreeData=[],""!=l.element.find(".e-memberPageCount").text()&&l.element.find(".e-memberPager").css("display","block"),l.element.find(".e-memberSearchPager").css("display","none")),o&&""!=l.element.find(".e-memberDrillPageCount").text()&&(l.element.find(".e-memberDrillPager").css("display","block"),l.element.find(".e-memberPager").css("display","none")),"ejPivotClient"==l.pluginName&&l.model.analysisMode==t.Pivot.AnalysisMode.Olap&&l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?l._appendTreeViewData(h.enableMemberEditorPaging?o?t.DataManager(l._lastSavedTree).executeLocal(t.Query().sortBy("name",t.isNullOrUndefined(l._sortType)?"":l._sortType)):t.DataManager(l._editorTreeData).executeLocal(t.Query().where("pid","equal",r).page(l._memberPageSettings.currentMemeberPage,h.memberEditorPageSize).sortBy("name",t.isNullOrUndefined(l._sortType)?"":l._sortType)):l._editorTreeData,l.element.find(".pvtBtn").parent("[data-tag='Slicers:"+l._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):n._createSearchTreeview(h.enableMemberEditorPaging?o?t.DataManager(l._lastSavedTree).executeLocal(t.Query().sortBy("name",t.isNullOrUndefined(l._sortType)?"":l._sortType)):t.DataManager(l._editorTreeData).executeLocal(t.Query().where(t.Predicate("pid","equal",null).and("id","notequal","All").and("id","notequal","(All)_0")).page(l._memberPageSettings.currentMemeberPage,h.memberEditorPageSize).sortBy("name",t.isNullOrUndefined(l._sortType)?"":l._sortType)):l._editorTreeData,l);a={id:"SearchFilterSelection",type:l._isSelectSearchFilter?"nodeCheck":"nodeUncheck"},d=l.element.find(".e-editorTreeView"),t.Pivot._updateSearchFilterSelection(a,d,l),l._waitingPopup.hide(),l._parentNodeCollection={},l._parentSearchNodeCollection={}},0)}},_createSearchTreeview:function(i,r){"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.enableMemberEditorPaging:r.model.enableMemberEditorPaging;var l,n,s="ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.enableAdvancedFilter:r.model.enableAdvancedFilter,o="ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.enableMemberEditorSorting:r.model.enableMemberEditorSorting,a=r.element.find(".e-pvtBtn").parent("[data-tag='Slicers:"+(r._selectedFieldName||r._dialogHead)+"']").length>0,d=("ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.analysisMode:r.model.analysisMode,"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.operationalMode:r.model.operationalMode);for(!r._isSearchApplied&&0==r._editorSearchTreeData.length&&i.length>0&&(r._lastSavedTree=i),i.length>0&&(i=t.DataManager(i).executeLocal(t.Query().where(t.Predicate("id","notequal","All").and("id","notequal","(All)_0")))).splice(0,0,{id:"All",name:s&&!a?"(Select All)":d==t.Pivot.OperationalMode.ServerMode?"(All)":"All",checkedStatus:r._isAllMemberChecked,_isAllMemberChecked:r._isAllMemberChecked}),r.element.find(".e-editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,enableRTL:r.model.enableRTL,beforeDelete:function(e){if(!t.isNullOrUndefined(e.event)&&"keydown"==e.event.type&&"delete"==e.event.originalEvent.key.toLowerCase())return!1},height:o?"200px":"245px",fields:{id:"id",text:"name",isChecked:"checkedStatus",parentId:"pid",expanded:"expanded",hasChild:"hasChildren",dataSource:t.Pivot._showEditorLinkPanel(i,r,"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl:r)}}),l=r.element.find(".e-editorTreeView").find("li"),n=0;n<l.length;n++)t.isNullOrUndefined(e(l[n]).attr("id"))||e(l[n]).attr("data-tag",t.DataManager(i).executeLocal(t.Query().where("id","equal",e(l[n]).attr("id")))[0].tag);r._memberTreeObj=r.element.find(".e-editorTreeView").data("ejTreeView"),r._memberTreeObj.model.nodeCheck=t.proxy(r._nodeCheckChanges,r),r._memberTreeObj.model.nodeUncheck=t.proxy(r._nodeCheckChanges,r),"ejPivotGrid"==r.pluginName?r.model.operationalMode==t.Pivot.OperationalMode.ClientMode?r._memberTreeObj.model.beforeExpand=t.proxy(r._beforeNodeExpand,r):r._memberTreeObj.model.nodeClick=t.proxy(r._nodeExpand,r):(r.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?r._memberTreeObj.model.beforeExpand=t.proxy(r._beforeNodeExpand,r):r._memberTreeObj.model.nodeClick=t.proxy(r._nodeExpand,r),r._memberTreeObj.model.beforeCollapse=t.proxy(t.Pivot._onNodeCollapse,r)),t.isNullOrUndefined(r.element.find(".e-dialog .e-text:visible").first())||(r.element.find(".e-dialog .e-text:visible").length>0?(r.element.find(".e-dialog .e-text:visible").first().attr("tabindex","-1").addClass("e-hoverCell"),r.element.find(".e-dialog button").removeClass("e-hoverCell")):r.element.find(".e-dialog button:visible").first().attr("tabindex","-1").addClass("e-hoverCell")),0==r._memberTreeObj.element.find(".e-plus").length&&0==r._memberTreeObj.element.find(".e-minus").length&&r._memberTreeObj.element.find(".e-item").css("padding","0px"),r.model.enableMemberEditorSorting&&this._separateAllMember(r)},_separateAllMember:function(e){var i=e.element.hasClass("e-pivotclient")&&"servermode"==e.model.operationalMode&&"olap"==e.model.analysisMode,r="ejPivotSchemaDesigner"==e.pluginName?e.model.pivotControl.model.enableAdvancedFilter:e.model.enableAdvancedFilter,l="ejPivotSchemaDesigner"==e.pluginName?e.model.pivotControl.model.enableRTL:e.model.enableRTL,n="ejPivotSchemaDesigner"==e.pluginName?e.model.pivotControl.model.analysisMode:e.model.analysisMode,s=i?"":t.buildTag("div.e-checkAllBox",t.buildTag("input#allElement.allMember","",{float:l?"right":"left"},{name:"row",type:"checkbox",tabindex:0})[0].outerHTML+" "+t.buildTag("label.e-allElementLabel",r?"(Select All)":"All",{"margin-left":"5px"})[0].outerHTML,{width:"100px",float:l?"right":"left"})[0].outerHTML,o=t.buildTag("div.memberSortDiv",t.buildTag("div.e-icon e-memberAscendingIcon",{margin:"5px"})[0].outerHTML+t.buildTag("div.e-icon e-memberDescendingIcon")[0].outerHTML,{height:"35px","margin-left":"5px",float:l?"left":"right"})[0].outerHTML,a=t.buildTag("div.memberSortingDiv",s+o,{height:"20px",margin:"ejPivotSchemaDesigner"==e.pluginName?l?n==t.Pivot.AnalysisMode.Pivot?"10px 15px 0px 21px":"10px 31px 0px 12px":n==t.Pivot.AnalysisMode.Pivot?"10px 0px 0px 8px":"10px 0px 0px 20px":l?n==t.Pivot.AnalysisMode.Pivot?"10px 15px 0px 20px":"10px 28px 0px 20px":n==t.Pivot.AnalysisMode.Pivot?"10px 0px 0px 20px":"10px 0px 0px 29px"});r&&e.element.find(".e-editorTreeView").css("margin-top","10px"),e.element.find(".memberSortingDiv, .e-separateDiv").remove(),n==t.Pivot.AnalysisMode.Pivot&&e.element.find(".e-editorTreeView").addClass("e-treeViewUl"),i||e.element.find(".e-editorTreeView").before(a),("All"==e.element.find(".e-editorTreeView li:first").attr("id")||"(All)_0"==e.element.find(".e-editorTreeView li:first").attr("id"))&&e.element.find(".e-editorTreeView li:first").css("display","none"),i?(e.element.find(".memberSortDiv, .e-separateDiv").remove(),e.element.find(".e-checkOptions").after(t.buildTag("div.e-separateDiv",{margin:"0px 5px"})[0].outerHTML),e.element.find(".e-checkOptions").append(o),r&&e.element.find(".e-editorTreeView").height(235)):(e.element.find(".memberSortingDiv").after(t.buildTag("div.e-separateDiv",{})[0].outerHTML),e.element.find(".allMember").ejCheckBox({size:"small",width:"40px",checked:"disabled"!=e.element.find(".e-dialogOKBtn").attr("disabled"),change:t.proxy(e._nodeCheckChanges,e)})),"ascending"==e._sortType?e.element.find(".e-memberAscendingIcon").addClass("e-selectedSort"):"descending"==e._sortType&&e.element.find(".e-memberDescendingIcon").addClass("e-selectedSort")},_checkChanges:function(e){var t="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl:this;e.isChecked?t._nodeCheckChanges(e):e.isChecked||t._nodeUnCheckChanges(e)},_fetchMemberPageSuccess:function(i){var l,n="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl:this;i[0]!=r&&i.length>0?(l=i[0].Value,null!=i[1]&&i[1]!=r&&(this.model.customObject=i[1].Value)):i.d!=r&&i.d.length>0?(l=i.d[0].Value,null!=i.d[1]&&i.d[1]!=r&&(this.model.customObject=i.d[1].Value)):i!=r&&i.length>0?(l=i.EditorTreeInfo,null!=i&&i.customObject!=r&&(this.model.customObject=i.customObject)):i!=r&&(l=i.EditorTreeInfo,null!=i&&i.customObject!=r&&(this.model.customObject=i.customObject)),this._memberPageSettings.endPage="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl.model.memberEditorPageSize:this.model.memberEditorPageSize,this._memberPageSettings.startPage=0,this._memberPageSettings.currentMemeberPage=1,filteredData=JSON.parse(l),this._editorTreeData=e.extend(!0,[],filteredData),n.model.enableAdvancedFilter&&(this._editorTreeData=e.map(this._editorTreeData,function(e){if(t.isNullOrUndefined(e.levels))return e})),("ejPivotSchemaDesigner"==this.pluginName&&this.model.pivotControl&&this.model.pivotControl.model.enableAdvancedFilter&&this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||"ejPivotGrid"==this.pluginName&&this.model.enableAdvancedFilter&&this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)&&(this._memberPagingAvdData=filteredData.splice(filteredData.length-1,1)),this._memberCount=t.DataManager(this._editorTreeData).executeLocal(t.Query().where(t.Predicate("pid","equal",null).and("id","notequal","All").and("id","notequal","(All)_0"))).length,filteredData=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",r).page(this._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl.model.memberEditorPageSize+1:this.model.memberEditorPageSize+1)),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(filteredData)})},_memberPageNodeUncheck:function(i,r){var l,n="",s=null,o="ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.enableMemberEditorPaging:r.model.enableMemberEditorPaging;e(i.currentElement).parent().parent().hasClass("e-editorTreeView")&&!r._isSearchApplied&&o?(n=t.DataManager(r._editorTreeData).executeLocal(t.Query().page(r._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.memberEditorPageSize+1:r.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(r._editorSearchTreeData)||(s=t.DataManager(r._editorSearchTreeData).executeLocal(t.Query().page(r._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.memberEditorPageSize+1:r.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0])):(n=t.DataManager(r._editorTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(r._editorSearchTreeData)||(s=t.DataManager(r._editorSearchTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0])),t.isNullOrUndefined(n)||(n.checkedStatus=!1,t.isNullOrUndefined(n.pid)||(l=t.DataManager(r._editorTreeData).executeLocal(t.Query().where("pid","equal",n.pid).where("checkedStatus","equal",!0)),t.isNullOrUndefined(l)||0!=l.length||t.Pivot._unSelectParentTreeNode(n,r)),l=t.DataManager(r._editorTreeData).executeLocal(t.Query().where("pid","equal",n.id)),!t.isNullOrUndefined(l)&&l.length>0&&t.Pivot._unSelectChildTreeNode(n,r)),t.isNullOrUndefined(s)||(s.checkedStatus=!1,t.isNullOrUndefined(s.pid)||(l=t.DataManager(r._editorSearchTreeData).executeLocal(t.Query().where("pid","equal",s.pid).where("checkedStatus","equal",!0)),t.isNullOrUndefined(l)||0!=l.length||t.Pivot._unSelectParentTreeNode(s,r)),l=t.DataManager(r._editorSearchTreeData).executeLocal(t.Query().where("pid","equal",n.id)),!t.isNullOrUndefined(l)&&l.length>0&&t.Pivot._unSelectChildTreeNode(s,r))},_memberPageNodeCheck:function(i,r){var l,n,s="",o=null,a="ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.enableMemberEditorPaging:r.model.enableMemberEditorPaging;if(e(i.currentElement).parent().parent().hasClass("e-editorTreeView")&&!r._isSearchApplied&&a?(s=t.DataManager(r._editorTreeData).executeLocal(t.Query().page(r._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.memberEditorPageSize+1:r.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(r._editorSearchTreeData)||(o=t.DataManager(r._editorSearchTreeData).executeLocal(t.Query().page(r._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.memberEditorPageSize+1:r.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0])):(s=t.DataManager(r._editorTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(r._editorSearchTreeData)||(o=t.DataManager(r._editorSearchTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0])),!t.isNullOrUndefined(s)&&(s.checkedStatus=!0,t.isNullOrUndefined(s.pid)||t.Pivot._selectParentTreeNode(s,r),!t.isNullOrUndefined(s.id)&&(l=t.DataManager(r._editorTreeData).executeLocal(t.Query().where("pid","equal",s.id)),!t.isNullOrUndefined(l)&&l.length>0)))for(n=0;n<l.length;n++)l[n].checkedStatus=!0,(l[n].expanded||l[n].isChildMerged)&&t.Pivot._selectChildTreeNode(l[n],r);if(!t.isNullOrUndefined(o)&&(o.checkedStatus=!0,t.isNullOrUndefined(o.pid)||t.Pivot._selectParentTreeNode(o,r),!t.isNullOrUndefined(o.id)&&(l=t.DataManager(r._editorSearchTreeData).executeLocal(t.Query().where("pid","equal",o.id)),!t.isNullOrUndefined(l)&&l.length>0)))for(n=0;n<l.length;n++)l[n].checkedStatus=!0,t.Pivot._selectChildTreeNode(l[n],r)},_appendParentNodes:function(e,i,r){var l,n;t.isNullOrUndefined(i.pid)||(t.isNullOrUndefined(r._parentNodeCollection[i.pid])?(l=jQuery.extend(!0,[],t.DataManager(r._editorTreeData).executeLocal(t.Query().where("id","equal",i.pid))),r._parentNodeCollection[i.pid]=l):l=r._parentNodeCollection[i.pid],!t.isNullOrUndefined(l)&&l.length>0&&(t.isNullOrUndefined(r._parentSearchNodeCollection[l[0].id])?(n=jQuery.extend(!0,[],t.DataManager(e).executeLocal(t.Query().where("id","equal",l[0].id))),r._parentSearchNodeCollection[l[0].id]=l):n=r._parentSearchNodeCollection[l[0].id]),t.isNullOrUndefined(n)||(0==n.length?(l[0].expanded=!0,e.push(l[0]),t.isNullOrUndefined(l[0].pid)||this._appendParentNodes(e,l[0],r)):n[0].expanded=!0))},_selectParentTreeNode:function(e,i){var r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("id","equal",e.pid));!t.isNullOrUndefined(r)&&r.length>0&&(r[0].checkedStatus=!0,this._selectParentTreeNode(r[0],i))},_selectChildTreeNode:function(e,i){var r,l=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",e.id));if(!t.isNullOrUndefined(l)&&l.length>0)for(r=0;r<l.length;r++)l[r].checkedStatus=!0,(l[r].expanded||l[r].isChildMerged)&&this._selectChildTreeNode(l[r],i)},_unSelectChildTreeNode:function(e,i){var r,l=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",e.id));if(!t.isNullOrUndefined(l)&&l.length>0)for(r=0;r<l.length;r++)l[r].checkedStatus=!1,(l[r].expanded||l[r].isChildMerged)&&this._unSelectChildTreeNode(l[r],i)},_unSelectParentTreeNode:function(e,i){var r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("id","equal",e.pid));!t.isNullOrUndefined(r)&&r.length>0&&(r[0].checkedStatus=!1,0==t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",r[0].pid).where("checkedStatus","equal",!0)).length&&this._unSelectParentTreeNode(r[0],i))},_getSelectedTreeState:function(e,i){var l,n,s,o,a,d;if(e){for(a=[],l=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",r)),d=0;d<l.length;d++){if(n=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",l[d].id)),s={caption:l[d].name,parentId:t.isNullOrUndefined(l[d].pid)?"None":l[d].pid,id:l[d].id,checked:l[d].checkedStatus,expanded:n.length>0,childNodes:[],tag:l[d].tag},n.length>0)for(o=0;o<n.length;o++)s.childNodes.push(this._getEditorSlicerInfo(n[o],i));a.push(s)}return JSON.stringify(a)}for(a="",d=0;d<i._editorTreeData.length;d++)1==i._editorTreeData[d].checkedStatus&&(a+="::"+i._editorTreeData[d].id+"||"+i._editorTreeData[d].tag);return a},_getUnSelectedTreeState:function(e){for(var t="",i=0;i<e._editorTreeData.length;i++)0==e._editorTreeData[i].checkedStatus&&(t+="::"+e._editorTreeData[i].id+"||"+e._editorTreeData[i].tag);return t},_getEditorSlicerInfo:function(e,i){var r,l=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",e.id)),n={caption:e.name,parentId:t.isNullOrUndefined(e.pid)?"None":e.pid,id:e.id,checked:e.checkedStatus,expanded:l.length>0,childNodes:[],tag:e.tag};if(l.length>0)for(r=0;r<l.length;r++)n.childNodes.push(this._getEditorSlicerInfo(l[r],i));return n},_editorLinkPanelClick:function(){this.element.find(".e-dialog").hide(),t.Pivot._createErrorDialog(this._getLocalizedLabels("EditorLinkPanelAlert").split("1000").join(this.model.maxNodeLimitInMemberEditor),this._getLocalizedLabels("Warning"),this)},_showEditorLinkPanel:function(i,r,l){var n,s;if(!l.model.enableMemberEditorPaging&&(l.model.analysisMode!=t.Pivot.AnalysisMode.Pivot||r._isSearchApplied||(r._editorTreeData=i),i.length>l.model.maxNodeLimitInMemberEditor+(r._isSearchApplied?1:0))){var o=[],a={},d={},h=!1;for(n=0;n<i.length;n++)t.isNullOrUndefined(a[i[n].pid])?(t.isNullOrUndefined(i[n].pid)||(s=e.grep(i,function(e){if(e.id==i[n].pid)return e})).length>0&&(d[i[n].pid]=!!s[0].expanded),a[i[n].pid]=1):a[i[n].pid]++,a[i[n].pid]<=l.model.maxNodeLimitInMemberEditor+(r._isSearchApplied&&t.isNullOrUndefined(i[n].pid)?1:0)?o.push(i[n]):(t.isNullOrUndefined(d[i[n].pid])||d[i[n].pid])&&(h=!0);i=o,h&&r.element.find("div.e-linkOuterPanel").css("display","block")}return i},createErrorDialog:function(i){var r,l;t.Pivot.openPreventPanel(i),0==i.element.find(".e-errorDialog").length?(l=t.buildTag("div.e-errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent",i._getLocalizedLabels("AlertMsg"))[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title",i._getLocalizedLabels("Warning"))[0].outerHTML,i.element.append(l),i.element.find(".e-errorDialog").ejDialog({target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,width:"400px"}),r=i.element.find(".e-errorDialog").data("ejDialog"),e("#"+r._id+"_wrapper").css({left:"50%",top:"50%"}),i.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(t.Pivot.errOKBtnClick,i)}),i.element.find(".e-dialog .e-close").attr("title",i._getLocalizedLabels("Close"))):(r=i.element.find(".e-errorDialog").data("ejDialog")).open()},errOKBtnClick:function(){this.element.find("#preventDiv").remove(),this.element.find(".e-errorDialog").data("ejDialog")._ejDialog.find("div.e-dialog-icon").trigger("click")},doAjaxPost:function(i,l,n,s,o,a){var d,h,c,u=!0;n.XMLA==r?(d="application/json; charset=utf-8",h="json",c=e.proxy(s,this)):(d="text/xml",h="xml",n=n.XMLA,c=e.proxy(s,t.olap.base,a),u=!("msie"==t.browserInfo().name&&t.browserInfo().version<=9)&&(!t.isNullOrUndefined(a)&&"loadFieldElements"!=a.action)),e.ajax({type:i,url:l,contentType:d,async:u,dataType:h,data:n,success:c,complete:t.proxy(function(t){e.proxy(t,this);this._currentAction,this.element},this),error:t.proxy(function(e){void 0!==this._ogridWaitingPopup&&null!=this._ogridWaitingPopup&&this._ogridWaitingPopup.hide(),"undefined"!=typeof oclientWaitingPopup&&null!=oclientWaitingPopup&&oclientWaitingPopup.hide();var t={action:""!=this._drillAction?this._drillAction:"initialize",customObject:"",element:this.element,Message:e};this._trigger("renderFailure",t),this.renderControlFromJSON(""),"XMLA"==this._dataModel&&this._createErrorDialog(e.statusText,this._getLocalizedLabels("Error")),e.statusText},this)})},getCubeList:function(t,i){for(var r,l=[],n=0;n<e(i).find("row").length;n++)r=e(e(i).find("row")[n]),l.push({name:e(r).children("CUBE_NAME").text()});t.pvtCtrldObj.setCubeList(l)},generateTreeViewData:function(e){var t={catalog:e.model.pivotControl.model.dataSource.catalog,cube:e.model.pivotControl.model.dataSource.cube,url:e.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this._getTreeData(t,this.loadDimensionElements,{schemaData:e,action:"loadFieldElements"})},loadDimensionElements:function(i,l){var n,s=i.schemaData.model.pivotControl,o={},a=(t.olap.base._getConnectionInfo(s.model.dataSource.data),{}),d=s.model.dataSource.providerName==t.olap.Providers.Mondrian;for(a={catalog:s.model.dataSource.catalog,cube:s.model.dataSource.cube,url:s.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},s.schemaTreeView=[],s.reportItemNames=[],n=0;n<e(l).find("row").length;n++){var h=e(e(l).find("row")[n]),c=h.find("DIMENSION_UNIQUE_NAME").text(),u=h.find("DIMENSION_CAPTION").text();c.toLowerCase().indexOf("[measure")>=0?o={hasChildren:!0,isSelected:!1,id:c,name:u,spriteCssClass:"[measures]"==c.toLowerCase()?"e-folderCDB e-icon":"e-dimensionCDB e-icon",tag:c}:!e(e(l).find("row")[0]).find("HIERARCHY_CAPTION").length>0&&s.schemaTreeView.push({hasChildren:!0,isSelected:!1,id:d?c+"~#^Dim":c,name:u,spriteCssClass:"e-dimensionCDB e-icon",tag:c,defaultHierarchy:e(e(l).find("row")[n]).children("DEFAULT_HIERARCHY").text()})}s.schemaTreeView.splice(0,0,o),!s.model.enableDrillThrough||i.schemaData!=r&&i.schemaData.model.olap.showNamedSets?(a.request="MDSCHEMA_SETS",t.Pivot._getTreeData(a,t.Pivot.loadNamedSetElements,i)):(a.request="MDSCHEMA_HIERARCHIES",(t.isNullOrUndefined(s._fieldData)||!t.isNullOrUndefined(s._fieldData)&&t.isNullOrUndefined(s._fieldData.hierarchy))&&this._getFieldItemsInfo(s),s._fieldData.hierarchySuccess==r?t.Pivot._getTreeData(a,s.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,s._fieldData.hierarchySuccess))},loadNamedSetElements:function(i,l){var n,s,o,a=i.schemaData.model.pivotControl,d={catalog:a.model.dataSource.catalog,cube:a.model.dataSource.cube,url:a.model.dataSource.data,request:"MDSCHEMA_HIERARCHIES"},h=(l=a.model.dataSource,[]);for(n=e.map(l.rows,function(e){if(e.fieldName!=r)return e.fieldName}),e.merge(n,e.map(l.columns,function(e){if(e.fieldName!=r)return e.fieldName})),e.merge(n,e.map(l.filters,function(e){if(e.fieldName!=r)return e.fieldName})),s=0;s<e(l).find("row").length;s++)o=e(e(l).find("row")[s]),e.inArray(o.find("DIMENSIONS").text().split(".")[0],h)>=0||(a.schemaTreeView.push({hasChildren:!0,isSelected:!1,pid:o.find("DIMENSIONS").text().split(".")[0],id:o.find("SET_DISPLAY_FOLDER").text()+"_"+o.find("DIMENSIONS").text().split(".")[0],name:o.find("SET_DISPLAY_FOLDER").text(),spriteCssClass:"e-folderCDB e-icon namedSets"}),h.push(o.find("DIMENSIONS").text().split(".")[0])),a.schemaTreeView.push({hasChildren:!0,isSelected:e.inArray("["+e.trim(o.children("SET_NAME").text())+"]",n)>=0,pid:o.find("SET_DISPLAY_FOLDER").text()+"_"+o.find("DIMENSIONS").text().split(".")[0],id:"["+e.trim(o.children("SET_NAME").text()).replace(/\&/g,"&amp;")+"]",name:o.children("SET_CAPTION").text(),spriteCssClass:"e-namedSetCDB e-icon",tag:o.find("EXPRESSION").text()});t.isNullOrUndefined(a._fieldData)||a._fieldData.hierarchySuccess==r?t.Pivot._getTreeData(d,t.Pivot.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,a._fieldData.hierarchySuccess)},loadHierarchyElements:function(i,l){var n,s,o=i.schemaData.model.pivotControl,a={catalog:o.model.dataSource.catalog,cube:o.model.dataSource.cube,url:o.model.dataSource.data,request:"MDSCHEMA_LEVELS"},d=o.model.dataSource,h=o.model.dataSource.providerName==t.olap.Providers.Mondrian;for(n=e.map(d.rows,function(e){if(e.fieldName!=r)return e.fieldName}),e.merge(n,e.map(d.columns,function(e){if(e.fieldName!=r)return e.fieldName})),e.merge(n,e.map(d.filters,function(e){if(e.fieldName!=r)return e.fieldName})),s=0;s<e(l).find("row").length;s++){var c=e(e(l).find("row")[s]),u=c.find("DIMENSION_UNIQUE_NAME").text(),g=c.find("HIERARCHY_UNIQUE_NAME").text();e(o.schemaTreeView).filter(function(e,t){return t.tag==u}).map(function(e,t){return t}).length>0&&(u!=g||h)&&o.schemaTreeView.push({hasChildren:!0,isSelected:e.inArray(g,n)>=0,pid:u+(h?"~#^Dim":""),id:g,name:c.find("HIERARCHY_CAPTION").text(),spriteCssClass:"2"!=c.find("HIERARCHY_ORIGIN").text()&&"6"!=c.find("HIERARCHY_ORIGIN").text()?"e-hierarchyCDB e-icon":"e-attributeCDB e-icon",tag:g})}t.Pivot._getTreeData(a,t.Pivot.loadLevelElements,i)},loadLevelElements:function(i,r){var l,n=i.schemaData.model.pivotControl,s=e.map(e(r).find("row"),function(t){if("1"!=parseInt(e(t).children("LEVEL_TYPE").text())&&"[measures]"!=e(t).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase())return{hasChildren:!1,isChecked:!1,id:e(t).find("LEVEL_UNIQUE_NAME").text(),pid:e(t).find("HIERARCHY_UNIQUE_NAME").text(),name:e(t).find("LEVEL_CAPTION").text(),tag:e(t).find("LEVEL_UNIQUE_NAME").text(),spriteCssClass:"e-level"+parseInt(e(t).children("LEVEL_NUMBER").text())+" e-icon"}});e.merge(n.schemaTreeView,s),(!n.model.enableDrillThrough||n._fieldData.measureSuccess)&&(t.isNullOrUndefined(n._fieldData)||!n._fieldData.measureSuccess?(l={catalog:n.model.dataSource.catalog,cube:n.model.dataSource.cube,url:n.model.dataSource.data,request:"MDSCHEMA_MEASURES"},t.Pivot._getTreeData(l,t.Pivot.loadMeasureElements,i)):t.Pivot.loadMeasureElements(i,n._fieldData.measureSuccess))},loadMeasureGroups:function(i,r){t.isNullOrUndefined(i.pivotControl._fieldData)&&(i.pivotControl._fieldData={}),i.pivotControl._fieldData.measuresGroups=e(r).find("row")},loadMeasureElements:function(i,l){var n,s,o,a,d=i.schemaData.model.pivotControl,h={catalog:d.model.dataSource.catalog,cube:d.model.dataSource.cube,url:d.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},c=[];n=e.map(d.model.dataSource.values,function(e){if(e.measures!=r)return e.measures}),d.reportItemNames=e.map(n,function(e){if(e.fieldName!=r)return e.fieldName}),"en-US"!=d.model.locale&&(h={catalog:d.model.dataSource.catalog,cube:d.model.dataSource.cube,url:d.model.dataSource.data,request:"MDSCHEMA_MEASUREGROUPS"},t.Pivot._getTreeData(h,t.Pivot.loadMeasureGroups,{pivotControl:d,action:"loadFieldElements"}));var u,g,p,m=[],_=[],f=[],b=[],C=[];if("ejPivotClient"==d.pluginName&&(d.model.sortCubeMeasures==t.PivotAnalysis.SortOrder.Ascending||d.model.sortCubeMeasures==t.PivotAnalysis.SortOrder.Descending)&&d.model.sortCubeMeasures!=t.PivotAnalysis.SortOrder.None){for(sortType=d.model.sortCubeMeasures==t.PivotAnalysis.SortOrder.Ascending?"ascending":"descending",o=0;o<e(l).find("row").length;o++)_.push({name:e(l).find("row:eq("+o+") MEASURE_CAPTION").text()});for(g=t.DataManager(_).executeLocal(t.Query().sortBy("name",sortType)),e.each(g,function(t,i){for(var r=0;r<e(l).find("row").length;r++)i.name==e(l).find("row:eq("+r+") MEASURE_CAPTION").text()&&f.push(e(l).find("row:eq("+r+")"))}),o=0;o<f.length;o++)e.inArray(e(f[o]).children("MEASUREGROUP_NAME").text(),m)>=0||(m.push(e(f[o]).children("MEASUREGROUP_NAME").text()),b.push({name:e(f[o]).children("MEASUREGROUP_NAME").text()}));u=t.DataManager(b).executeLocal(t.Query().sortBy("name",sortType)),e.each(u,function(t,i){for(var r=0;r<f.length;r++)i.name==e(f[r]).children("MEASUREGROUP_NAME").text()&&C.push(e(f[r]))}),p=C}else p=e(l).find("row");for(o=0;o<p.length;o++){var S=e(p[o]),x=S.children("MEASUREGROUP_NAME").text(),v=S.find("MEASURE_UNIQUE_NAME").text();e.inArray(x,c)>=0||("en-US"!=d.model.locale?s=(a=e.map(d._fieldData.measuresGroups,function(t){if(e(t).children("MEASUREGROUP_NAME").text()==x)return e(t).children("MEASUREGROUP_CAPTION").text()})).length>0?a[0]:x:s=x,""!=x&&d.schemaTreeView.push({hasChildren:!0,isChecked:!1,pid:"[Measures]",id:x,name:s,spriteCssClass:"e-measureGroupCDB e-icon",tag:x}),c.push(x)),d.schemaTreeView.push({hasChildren:!0,isSelected:e.inArray(v,d.reportItemNames)>=0,id:v,pid:""==x?"[Measures]":x,name:S.children("MEASURE_CAPTION").text(),spriteCssClass:"measure",tag:v}),e.inArray(v,d.reportItemNames)>=0&&d.reportItemNames.splice(d.reportItemNames.indexOf(v),1)}t.isNullOrUndefined(i.schemaData)||!i.schemaData.model.olap.showKpi&&!d.model.enableKPI?t.isNullOrUndefined(i.schemaData)||i.schemaData._createTreeView(this,d.schemaTreeView):(treeNodeElement={hasChildren:!0,isChecked:!1,id:"folderStruct",name:"KPI",spriteCssClass:"kpiCDB e-folderCDB e-icon",tag:""},d.schemaTreeView.splice(1,0,treeNodeElement),h.request="MDSCHEMA_KPIS",t.Pivot._getTreeData(h,t.Pivot.loadKPIElements,i))},loadKPIElements:function(t,i){for(var r=t.schemaData.model.pivotControl,l=this.reportItemNames,n=[],s=0;s<e(i).find("row").length;s++){var o=e(e(i).find("row")[s]),a=o.children("KPI_CAPTION").text(),d=o.children("KPI_goal").text(),h=o.children("KPI_STATUS").text(),c=o.children("KPI_TREND").text(),u=o.find("KPI_VALUE").text();e.inArray(o.children("KPI_NAME").text(),n)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"folderStruct",id:a,name:a,spriteCssClass:"e-measureGroupCDB e-icon",tag:a},r.schemaTreeView.push(treeNodeElement),n.push(a)),treeNodeElement={hasChildren:!0,isSelected:e.inArray(d,l)>=0,id:d,pid:a,name:r.model.enableKPI?"Goal":r._getLocalizedLabels("Goal"),spriteCssClass:"kpiGoal e-icon",tag:d},r.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(h,l)>=0,id:h,pid:a,name:r.model.enableKPI?"Status":r._getLocalizedLabels("Status"),spriteCssClass:"kpiStatus e-icon",tag:h},r.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(c,l)>=0,id:c,pid:a,name:r.model.enableKPI?"Trend":r._getLocalizedLabels("Trend"),spriteCssClass:"kpiTrend e-icon",tag:c},r.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(u,l)>=0,id:u,pid:a,name:r.model.enableKPI?"Value":r._getLocalizedLabels("Value"),spriteCssClass:"kpiValue e-icon",tag:u},r.schemaTreeView.push(treeNodeElement)}t.schemaData._createTreeView(this,r.schemaTreeView),delete r.reportItemNames,delete r.schemaTreeView},_createCalcMemberDialog:function(i,l){var n,s,o,a,d,h,c,u;l=t.isNullOrUndefined(l.model)?this:l;n=i.length>1&&i[0]!=r?JSON.parse(i[0].Value):i.d!=r?JSON.parse(i.d[0].Value):JSON.parse(i.CubeTreeInfo),null!=l.model.afterServiceInvoke&&l._trigger("afterServiceInvoke",{action:"fetchCalcMemberTreeView",element:l.element,customObject:l.model.customObject}),t.Pivot.openPreventPanel(l),l.element.find(".e-calcMemberDialog",".e-clientDialog",".e-dialog").remove();var g=t.buildTag("div.e-cubeBrowserCalcMember",t.buildTag("div#"+l._id+"_cubeTreeViewCalcMember.e-cubeTreeViewCalcMember")[0].outerHTML,{})[0].outerHTML,p=t.buildTag("label.lblCaption",l._getLocalizedLabels("Caption"),{})[0].outerHTML+t.buildTag("input#"+l._id+"_captionFieldCM.captionFieldCM","",{}).attr("aria-label",l._getLocalizedLabels("Caption"))[0].outerHTML,m=t.buildTag("label.lblexpression",l._getLocalizedLabels("Expression"),{})[0].outerHTML+t.buildTag("textarea#"+l._id+"_expressionFieldCM.e-textarea e-droppable expressionFieldCM"+(l.model.enableRTL?" e-rtl":""),"",{}).attr("aria-label",l._getLocalizedLabels("Expression"))[0].outerHTML,_=t.buildTag("label.lblmemberType",l._getLocalizedLabels("MemberType"),{})[0].outerHTML+t.buildTag("input#"+l._id+"_memberTypeFieldCM.memberTypeFieldCM","",{}).attr("aria-label",l._getLocalizedLabels("MemberType"))[0].outerHTML+t.buildTag("input#"+l._id+"_dimensionFieldCM.dimensionFieldCM","",{}).attr("aria-label","dimension")[0].outerHTML,f=t.buildTag("label.lblformat",l._getLocalizedLabels("FormatString"),{})[0].outerHTML+t.buildTag("input#"+l._id+"_formatFieldCM.formatFieldCM","",{}).attr("aria-label",l._getLocalizedLabels("FormatString"))[0].outerHTML+t.buildTag("input#"+l._id+"_customFormatFieldCM.customFormatFieldCM","",{}).attr("aria-label","custom format")[0].outerHTML,b=t.buildTag("div.e-calcMemberFieldPanel",p+m+_+f,{})[0].outerHTML,C=t.buildTag("button#"+l._id+"_btnOk.e-btnCalcMemberOk",l._getLocalizedLabels("OK"),{},{name:l._getLocalizedLabels("OK")}).attr("aria-label",l._getLocalizedLabels("OK")).attr("title",l._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,S=t.buildTag("button#"+l._id+"_btnCancel.btnCalcMemberCancel",l._getLocalizedLabels("Cancel"),{},{name:l._getLocalizedLabels("Cancel")}).attr("aria-label",l._getLocalizedLabels("Cancel")).attr("title",l._getLocalizedLabels("Cancel").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,x=t.buildTag("div.e-calcMemberFooter",C+S,{})[0].outerHTML;for(l._calcMemberDialog=t.buildTag("div#"+l._id+"_calcMemberDialog",g+b+x,{})[0].outerHTML,e(l._calcMemberDialog).appendTo("#"+l._id),e("#"+l._id+"_calcMemberDialog").ejDialog({width:"auto",title:l._getLocalizedLabels("CalculatedMember"),cssClass:l.model.cssClass+" e-calcMemberDialog",enableModal:!1,target:"#"+l._id,enableRTL:l.model.enableRTL,enableResize:!1,close:t.proxy(function(){t.Pivot.closePreventPanel(l)},l),beforeOpen:t.proxy(function(){l.element.find(".e-calcMemberDialog .e-dialog").css("display","block")},l)}),l._calcMemberDialog=l.element.find("#"+l._id+"_calcMemberDialog").data("ejDialog"),e("#"+l._id+"_btnCancel").ejButton({type:t.ButtonType.Button,width:"80px",enableRTL:l.model.enableRTL,click:t.proxy(function(){l._calcMemberDialog.close(),l._selectedCalcMember=null,t.Pivot.closePreventPanel(l)},l)}),e("#"+l._id+"_btnOk").ejButton({type:t.ButtonType.Button,width:"80px",enableRTL:l.model.enableRTL,click:t.proxy(function(){var i,r,n,s,o,a,d;if(""!=e.trim(l.element.find("#"+l._id+"_captionFieldCM").val())&&""!=e.trim(l.element.find("#"+l._id+"_expressionFieldCM").val()))if("Custom"!=l.element.find("#"+l._id+"_formatFieldCM").val()||""!=e.trim(l.element.find("#"+l._id+"_customFormatFieldCM").val())){if(t.isNullOrUndefined(l._selectedCalcMember))for(i=0;i<l._calcMembers.length;i++)if(e.trim(l.element.find("#"+l._id+"_captionFieldCM").val()).toLowerCase()==l._calcMembers[i].name.toLowerCase()){if(!confirm(l._getLocalizedLabels("Confirm")))return;l._selectedCalcMember=e.trim(l.element.find("#"+l._id+"_captionFieldCM").val())}if(l._calcMemberDialog.close(),t.Pivot.closePreventPanel(l),r="",t.isNullOrUndefined(l._selectedCalcMember)||(o=t.DataManager(l._calcMembers).executeLocal(t.Query().where("name","equal",l._selectedCalcMember,!0)),!t.isNullOrUndefined(o)&&o.length>0&&(r=o[0].tag)),l._waitingPopup.show(),n={action:"calculatedMember",olapReport:l.currentReport,clientReports:l.reports,caption:l.currentCubeName+"%"+e.trim(l.element.find("#"+l._id+"_captionFieldCM").val()),expression:e.trim(l.element.find("#"+l._id+"_expressionFieldCM").val()),memberType:l.element.find("#"+l._id+"_memberTypeFieldCM").val(),dimension:l.element.find("#"+l._id+"_dimensionFieldCM").val(),formatString:"Custom"==l.element.find("#"+l._id+"_formatFieldCM").val()?e.trim(l.element.find("#"+l._id+"_customFormatFieldCM").val()):l.element.find("#"+l._id+"_formatFieldCM").val(),uniqueName:r,customObject:l.model.customObject},l.model.operationalMode==t.Pivot.OperationalMode.ServerMode)l.doAjaxPost("POST",l.model.url+"/"+l.model.serviceMethodSettings.calculatedMember,JSON.stringify(n),l._calcMemberDroppedSuccess);else{n.caption=n.caption.replace("%",""),s="",s=n.memberType.toLowerCase().indexOf("measure")>-1?"[Measures].["+e.trim(n.caption)+"]":e(jQuery("[id*='["+n.dimension+"]']")[0]).attr("data-defaulthierarchy")+".["+e.trim(n.caption)+"]",o={caption:n.caption,expression:n.expression,tag:s,hierarchyUniqueName:"["+e.trim(n.dimension)+"].["+e.trim(n.dimension)+"]",memberType:n.memberType,formatString:n.formatString?n.formatString:n.format?n.format:null},-1==n.memberType.toLowerCase().indexOf("measure")&&null!=l._selectedCalcMember&&(t.Pivot.getReportItemByFieldName(this._schemaData._selectedFieldName,this.model.dataSource).item.hierarchyUniqueName=o.hierarchyUniqueName),l._selectedCalcMember=null;var h={id:n.caption,pid:"_0",name:n.caption,hasChildren:!1,spriteCssClass:"e-calcMemberCDB e-icon",tag:s,expression:n.expression,formatString:null,nodeType:0,hierarchyUniqueName:"Measure"==n.memberType?"":o.hierarchyUniqueName},c=!1,u=o.caption;l.model.calculatedMembers=e.grep(l.model.calculatedMembers,function(e){return e.caption==u&&(c=!0,e.caption=o.caption,e.expression=o.expression,e.hierarchyUniqueName=o.hierarchyUniqueName,e.memberType=n.memberType,e.formatString=n.formatString),e}),"_0"!=(a=l.element.find(".e-schemaFieldTree").data("ejTreeView").model.fields).dataSource[0].id&&a.dataSource.splice(0,0,{id:"_0",name:"Calculated Members",hasChildren:!0,spriteCssClass:"e-calcMemberGroupCDB e-icon",tag:""}),c?(d=this._schemaData._selectedFieldName,a.dataSource=e.grep(a.dataSource,function(e){return e.id==d&&(e.expression=o.expression,e.hierarchyUniqueName=o.hierarchyUniqueName,e.expression=o.expression,e.memberType=o.memberType,e.formatString=o.formatString),e})):l.model.calculatedMembers.push(o),c?l.refreshControl():a.dataSource.push(h),t.Pivot._refreshFieldList(l)}}else t.Pivot._createErrorDialog(l._getLocalizedLabels("EmptyFormat"),l._getLocalizedLabels("Warning"),l);else t.Pivot._createErrorDialog(l._getLocalizedLabels("EmptyField"),l._getLocalizedLabels("Warning"),l)},l)}),l.element.find("#"+l._id+"_cubeTreeViewCalcMember").ejTreeView({fields:{id:"id",parentId:"pid",text:"name",spriteCssClass:"spriteCssClass",dataSource:n},allowDragAndDrop:!0,enableRTL:l.model.enableRTL,allowDropChild:!1,allowDropSibling:!1,dragAndDropAcrossControl:!0,cssClass:"calcMemberTreeViewDragedNode",nodeDropped:t.proxy(function(t){null!=t.target&&t.target.attr("id")==l._id+"_expressionFieldCM"&&l.element.find("#"+l._id+"_expressionFieldCM").val(l.element.find("#"+l._id+"_expressionFieldCM").val()+e(t.droppedElement).attr("data-tag"))},l),beforeExpand:t.proxy(t.Pivot._getMemberChildNodes,l)}),l.element.find("#"+l._id+"_captionFieldCM").ejMaskEdit({name:"inputbox",inputMode:t.InputMode.Text,watermarkText:"",maskFormat:"",textAlign:l.model.enableRTL?"right":"left",width:"100%"}),l.element.find("#"+l._id+"_customFormatFieldCM").ejMaskEdit({name:"inputbox",inputMode:t.InputMode.Text,watermarkText:"",maskFormat:"",textAlign:l.model.enableRTL?"right":"left",width:"100%",cssClass:"e-calcMemberCustomFormat"}),l.element.find(".e-calcMemberCustomFormat").css("visibility","hidden"),l.element.find("#"+l._id+"_memberTypeFieldCM").ejDropDownList({dataSource:[{text:"Measure",value:"Measure"},{text:"Dimension",value:"Dimension"}],enableRTL:l.model.enableRTL,width:"100%",selectedIndex:0,change:t.proxy(function(e){"Dimension"==e.text?l.element.find(".e-calcMemberDimensionField").css("visibility","visible"):l.element.find(".e-calcMemberDimensionField").css("visibility","hidden")},l)}),s=t.DataManager(n).executeLocal(t.Query().where("spriteCssClass","contains","e-dimensionCDB")),o=[],u=0;u<s.length;u++)o.push({text:s[u].name,value:s[u].name});for(l.element.find("#"+l._id+"_dimensionFieldCM").ejDropDownList({dataSource:o,selectedIndex:0,width:"100%",enableRTL:l.model.enableRTL,cssClass:"e-calcMemberDimensionField"}),l.element.find(".e-calcMemberDimensionField").css("visibility","hidden"),l.element.find("#"+l._id+"_formatFieldCM").ejDropDownList({dataSource:[{text:"Standard",value:"Standard"},{text:"Currency",value:"Currency"},{text:"Percent",value:"Percent"},{text:"Custom",value:"Custom"}],enableRTL:l.model.enableRTL,selectedIndex:0,width:"100%",enableRTL:l.model.enableRTL,change:t.proxy(function(e){"Custom"==e.text?l.element.find(".e-calcMemberCustomFormat").css("visibility","visible"):l.element.find(".e-calcMemberCustomFormat").css("visibility","hidden")},l)}),a=l.element.find(".e-cubeTreeViewCalcMember").find("li"),u=0;u<a.length;u++)t.isNullOrUndefined(e(a[u]).attr("id"))||e(a[u]).attr("data-tag",t.DataManager(n).executeLocal(t.Query().where("id","equal",e(a[u]).attr("id")))[0].tag);for(d=l.element.find(".e-cubeTreeViewCalcMember .e-folderCDB"),u=0;u<d.length;u++)e(d[u].parentElement).removeClass("e-draggable");if(l.element.find(".e-cubeTreeViewCalcMember .calcMemberGroupCDB").length>0&&l.element.find(".e-cubeTreeViewCalcMember .calcMemberGroupCDB").parent().removeClass("e-draggable"),l._calcMemberTreeObj=l.element.find(".e-cubeTreeViewCalcMember").data("ejTreeView"),!t.isNullOrUndefined(l._selectedCalcMember)&&(h={},(h=l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?t.DataManager(l._calcMembers).executeLocal(t.Query().where("name","equal",l._selectedCalcMember)):t.DataManager(l.model.calculatedMembers).executeLocal(t.Query().where("caption","equal",l._selectedCalcMember))).length>0)){if(c=0,c=l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?h[0].nodeType:h.length>0&&h[0].memberType&&("dimension"==h[0].memberType||"Dimension"==h[0].memberType)?1:0,l.element.find("#"+l._id+"_captionFieldCM").val(h[0].caption||h[0].name),l.element.find("#"+l._id+"_expressionFieldCM").val(h[0].expression),l.element.find("#"+l._id+"_memberTypeFieldCM").data("ejDropDownList").selectItemsByIndices(c),1==c){var v=(l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?h[0].tag:h[0].hierarchyUniqueName).split(".")[0].replace(/\[/g,"").replace(/\]/g,""),w=l.element.find("#"+l._id+"_dimensionFieldCM").data("ejDropDownList").model.dataSource;for(u=0;u<w.length;u++)w[u].value==v&&l.element.find("#"+l._id+"_dimensionFieldCM").data("ejDropDownList").selectItemsByIndices(u)}t.isNullOrUndefined(h[0].formatString)||("Standard"==h[0].formatString?l.element.find("#"+l._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(0):"Currency"==h[0].formatString?l.element.find("#"+l._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(1):"Percent"==h[0].formatString?l.element.find("#"+l._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(2):(l.element.find("#"+l._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(3),l.element.find("#"+l._id+"_customFormatFieldCM").val(h[0].formatString)))}l._waitingPopup.hide()},_refreshFieldList:function(i){var r,l,n,s,o,a=i.element.find(".e-schemaFieldTree").data("ejTreeView");for(a.refresh(),r=a.model.fields.dataSource,l=i.element.find(".e-schemaFieldTree li"),n=0;n<e(l).length;n++)s=e(e(l)[n]).attr("id"),(o=e.map(r,function(e){if(e.id==s)return{tag:e.tag,expression:e.expression,defaultHierarchy:e.defaultHierarchy}})).length>0&&""!=o[0]&&(e(e(l)[n]).attr("data-tag",o[0].tag),t.isNullOrUndefined(o[0].expression)||e(e(l)[n]).attr("expression",o[0].expression),t.isNullOrUndefined(o[0].defaultHierarchy)||e(e(l)[n]).attr("data-defaultHierarchy",o[0].defaultHierarchy))},_getMemberChildNodes:function(i){var r,l,n;if((e(i.currentElement).find("a > span")[0].className.indexOf("level")>-1||e(i.currentElement).find("a > span")[0].className.indexOf("member")>-1)&&(r=t.DataManager(this._calcMemberTreeObj.dataSource()).executeLocal(t.Query().where("pid","equal",e(i.currentElement).attr("id")).where("name","equal","(Blank)")),!t.isNullOrUndefined(r)&&r.length>0))if(this._calcMemberTreeObj.hideNode(r[0].id),this.pNode=i.currentElement,this._waitingPopup.show(),l=e(i.currentElement).find("a > span")[0].className.indexOf("level")>-1?"level":"member",this.model.operationalMode==t.Pivot.OperationalMode.ClientMode){var s=this.model.dataSource,o=this.element.find(".e-cubeTreeViewCalcMember").data("ejTreeView"),a=e.map(o.model.fields.dataSource,function(t){if(t.id==e(i.currentElement).attr("id"))return t});if(e(i.currentElement).children("ul").children().length>1)this._waitingPopup&&this._waitingPopup.hide();else{a.length>0&&(this._calcExpanded=a[0]);var d="select {"+e(i.currentElement).attr("data-tag")+".members}dimension properties CHILDREN_CARDINALITY, MEMBER_TYPE on 0 from ["+e.trim(s.cube)+"]",h=t.olap._mdxParser.getSoapMsg(d,s.data,s.catalog),c=t.olap.base._getConnectionInfo(s.data);this.doAjaxPost("POST",c.url,{XMLA:h},t.proxy(this._generateCalculatedMember,this),null,{action:"fetchMembers"})}}else null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:"fetchMemberChildNodes",element:this.element,customObject:this.model.customObject}),n=JSON.stringify(this.model.customObject),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.fetchMemberTreeNodes,JSON.stringify({action:"fetchMemberChildNodes",dimensionName:e(i.currentElement).attr("data-tag")+":"+l+":"+e(i.currentElement).attr("id"),olapReport:this.currentReport,customObject:n}),t.proxy(t.Pivot._fetchMemberSuccess,this))},_fetchMemberSuccess:function(l){var n,s,o;for(n=l.length>1&&l[0]!=r?JSON.parse(l[0].Value):l.d!=r?JSON.parse(l.d[0].Value):JSON.parse(l.MemberChildNodes),null!=this.model.afterServiceInvoke&&this._trigger("afterServiceInvoke",{action:"fetchMemberChildNodes",element:this.element,customObject:this.model.customObject}),this._calcMemberTreeObj.model.beforeExpand=null,this._calcMemberTreeObj.addNode(n,e(this.pNode)),s=t.DataManager(this._calcMemberTreeObj.dataSource()).executeLocal(t.Query().where("pid","equal",e(this.pNode).attr("id")).where("name","equal","(Blank)")),!t.isNullOrUndefined(s)&&s.length>0&&this._calcMemberTreeObj.removeNode(s[0].id),e.each(e(this.pNode).children().find("li"),function(e,t){t.setAttribute("data-tag",n[e].tag)}),o=e(this.pNode).children().find("li"),i=0;i<o.length;i++)1==n[i].hasChildren&&(this._calcMemberTreeObj.addNode({id:n[i].id+"_Blank_"+i,name:"(Blank)",parentId:n[i].id},o[i]),this.element.find("#"+n[i].id).find("> div > div:first").removeClass("e-process"),this._calcMemberTreeObj.collapseNode(this.element.find("#"+n[i].id)));this._calcMemberTreeObj.model.beforeExpand=t.proxy(t.Pivot._getMemberChildNodes,this),this._waitingPopup.hide()},_drillThroughCellClick:function(r,l){var n,s,o,a,d,h,c;if(l._waitingPopup.show(),o=e(r.currentTarget.parentElement).attr("data-p"),l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)(s=e(l.element).parents(".e-pivotclient").length>0||e(l.element).parents(".e-maximumView").length>0?l._pivotClientObj:l).doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillThroughDataTable,JSON.stringify({currentReport:JSON.parse(l.getOlapReport()).Report,layout:l.model.layout,cellPos:o,selector:"",customObject:JSON.stringify(s.model.customObject)}),function(e){s._trigger("drillThrough",{element:l.element,data:e})});else{for(a=e("#"+l._id).find("tbody").find("tr:first").find("th").length,i=0;i<a;i++)-1!=(d=-1!=l.getJSONRecords()[parseInt(i*l._rowCount+parseInt(o.split(",")[1]))].Info.indexOf("Measures")||l.getJSONRecords()[parseInt(i*l._rowCount+parseInt(o.split(",")[1]))].RowSpan<=1?l.getJSONRecords()[parseInt(i*l._rowCount+parseInt(o.split(",")[1]))].Info.split("::")[0]:"").indexOf("Measures")&&(n=d),""!=d&&(l._rowHeader[i]=d);for(h=e("#"+l._id).find("tbody").find('[data-p="'+parseInt(o.split(",")[0])+","+parseInt(o.split(",")[1])+'"]').closest("tbody").prev().children("tr").length,i=0;i<h;i++)-1!=(c=-1!=l.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*l._rowCount+i)].Info.indexOf("Measures")||l.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*l._rowCount+i)].ColSpan<=1?l.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*l._rowCount+i)].Info.split("::")[0]:"").indexOf("Measures")&&(n=c),""!=c&&(l._colHeader[i]=c);for((t.isNullOrUndefined(l._fieldData)||!t.isNullOrUndefined(l._fieldData)&&t.isNullOrUndefined(l._fieldData.hierarchy))&&l._getFieldItemsInfo(l),j=0;j<l._fieldData.measures.length;j++)n==l._fieldData.measures[j].id&&(l.measureGrp=l._fieldData.measures[j].pid);l._rowHeader=e.grep(l._rowHeader,function(e){return 0==e||e}),l._colHeader=e.grep(l._colHeader,function(e){return 0==e||e}),l._createDrillThroughQuery("",l)}},openHierarchySelector:function(e,i){var r,l,n;e.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._createDrillThroughDialog(e,i):(e._waitingPopup.show(),l=(r=e.target.className.indexOf("e-pivotclient")>=0?e._pivotGrid:e)._getConnectionInfo(e.model.dataSource.data),n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASUREGROUP_DIMENSIONS</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+e.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.model.dataSource.cube+"</CUBE_NAME><MEASUREGROUP_NAME>"+r.measureGrp+"</MEASUREGROUP_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+l.LCID+"</LocaleIdentifier></PropertyList></Properties></Discover></Body></Envelope>",this.doAjaxPost("POST",l.url,{XMLA:n},r._loadDimensionElements,null,{pvtGridObj:r,action:"loadMeasureElements"}))},_createDrillThroughDialog:function(i,r){var l,n,s,o;i.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode&&r.shift(),i.element.find(".e-dialog:not(.e-calcMemberDialog, .e-calcMemberDialog .e-dialog), .e-clientDialog").remove();var a=t.buildTag("label#",i._getLocalizedLabels("SelectHierarchy"))[0].outerHTML,d="<div class=e-cubeTable style='width:200px; overflow:auto'><div valign=\"bottom\">"+this._createHierarchyBrowser()+"</div></div>",h=t.buildTag("div#dropDlg.dropDlg",'<table class="e-outerTable"><tr><td>'+d+"</td><td>"+a+"<br><textarea id='hrSel' style='width:270px; height:300px; resize:none; margin:0px 5px 0 5px'></textarea></br><br></td></tr></table>")[0].outerHTML+"</br>",c=t.buildTag("div",t.buildTag("button#btnOK.dialogBtnOK",i._getLocalizedLabels("OK")).attr("title",i._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML+t.buildTag("button#btnCancel.dialogBtnCancel",i._getLocalizedLabels("Cancel")).attr("title",i._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,{float:"right",margin:"-5px 0 6px"})[0].outerHTML,u=t.buildTag("div#clientDialog.e-clientDialog",h+c,{opacity:"1"}).attr("title","Hierarchy Selector")[0].outerHTML;for(e(u).appendTo("#"+i._id),e("#btnOK, #btnCancel").ejButton(),e("#btnOK, #btnCancel").css({margin:"0 20px 20px 0",width:"50px"}),i.element.find(".e-clientDialog").ejDialog({width:550,target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,i)}),i.element.find(".cubeTreeViewHierarchy").ejTreeView({showCheckbox:!0,fields:{id:"id",parentId:"pid",text:"name",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.isNullOrUndefined(r.d)?e.parseJSON(r):e.parseJSON(r.d):r},allowDragAndDrop:!0,allowDropChild:!1,allowDropSibling:!1,enableRTL:!!i.model.enableRTL,beforeDelete:function(){return!1},dragAndDropAcrossControl:!0,nodeDropped:t.proxy(this._hierarchyNodeDropped,i)}),i._tableTreeObj=i.element.find(".cubeTreeViewHierarchy").data("ejTreeView"),i._tableTreeObj.element.find(".e-ul").css({width:"100%",height:"100%"}),i._tableTreeObj.element.find(".e-chkbox-wrap").remove(),l=i._tableTreeObj.element.find("li"),n=0;n<l.length;n++)s=i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.isNullOrUndefined(r.d)?e.parseJSON(r)[n].tag:e.parseJSON(r.d)[n].tag:r[n].tag,l[n].setAttribute("data-tag",s);i._tableTreeObj&&i._tableTreeObj.element.find("li").mouseover(t.proxy(function(t){e(t.target).parent().find(".e-measureGroupCDB, .e-dimensionCDB, .e-folderCDB").length>0&&e(t.target).css("cursor","default")},i)),o=i,e("#btnOK").click(function(){var i=e("#hrSel").val();e(".e-dialog:not(.e-calcMemberDialog, .e-calcMemberDialog .e-dialog), .e-clientDialog, .drilltableDialog").remove(),o._waitingPopup.show(),t.olap._mdxParser._createDrillThroughQuery(i,o),o._waitingPopup.hide()}),e("#btnCancel").click(function(){e(".e-dialog:not(.e-calcMemberDialog, .e-calcMemberDialog .e-dialog), .e-clientDialog").remove(),o._waitingPopup.hide()}),i.model.enableRTL&&(e(".e-dialog").addClass("e-rtl"),e(".dialogBtnCancel").css("margin","0 -70px 0 0"))},_createHierarchyBrowser:function(){return t.buildTag("div.cubeBrowserHierarchy",t.buildTag("div.cubeTreeViewHierarchy")[0].outerHTML,{width:"200px",height:"300px",overflow:"auto"})[0].outerHTML},_hierarchyNodeDropped:function(i){var r,l,n;if("hrSel"==i.dropTarget[0].id&&(r=e(e(i.droppedElement).children()[0]).find(".e-dimensionCDB").length>0?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(i.droppedElement).find("li:first").attr("data-tag"):e(i.droppedElement).find("li:first")[0].id:0==e(i.droppedElement).find("li:first").length?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(i.droppedElement.parent().parent()).attr("data-tag"):e(i.droppedElement.parent().parent())[0].id:this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(i.droppedElement).attr("data-tag"):i.droppedElementData.id,!t.isNullOrUndefined(r))){for(r=r.replace("[","[$"),l=0;l<e("#hrSel").val().split(",").length;l++)if(r==e("#hrSel").val().split(",")[l])return!1;0!=(n=this.element.find("#hrSel").val()).length?(n=n+","+r,this.element.find("#hrSel").val(n)):this.element.find("#hrSel").val(r)}},_generateDrillData:function(t,i){for(var r=e(i).find("row").children(),l=e.map(r,function(e){var t=e.textContent;return'"'+e.tagName.replace(/_x005B_/g,"[").replace(/_x0020_/g," ").replace(/_x005D_/g,"]").replace(/_x0024_/g,"$").replace("].[","]-[")+'":"'+t+'"'}),n=l[0],s="",o=0;o<l.length;o++)l[o]!=n?s+=","+l[o]:s+=""==s?"[{"+l[o]:"}, {"+l[o];s+="}]",e(t.pvtGridObj.element).parents(".e-pivotclient").length>0?e(t.pvtGridObj.element).parents(".e-pivotclient").data("ejPivotClient")._trigger("drillThrough",{element:t.pvtGridObj.element,data:s}):t.pvtGridObj._trigger("drillThrough",{element:t.pvtGridObj.element,data:s})},_getFilterStateMember:function(i,r,l,n,s){if("include"==l.filterItems.filterType)if(1==l.filterItems.values.length)if(t.isNullOrUndefined(n._fieldSelectedMembers[l.fieldName.toLowerCase()])&&i){var o="select {"+l.filterItems.values[0]+"}dimension properties CHILDREN_CARDINALITY on 0 from ["+e.trim(n.model.dataSource.cube)+"]",a=t.olap._mdxParser.getSoapMsg(o,n.model.dataSource.data,n.model.dataSource.catalog),d=t.olap.base._getConnectionInfo(n.model.dataSource.data);this.doAjaxPost("POST",d.url,{XMLA:a},t.proxy(this._getInitialSlicerName,this),null,{controlObject:n,action:"fetchMembers"}),s=n._slicerName}else i||(s=l.filterItems.values[0]);else s=n._getLocalizedLabels("MultipleItems");else s=r.length-(-1==l.filterItems.values.indexOf("All")?l.filterItems.values.length:l.filterItems.values.length-1)==1?r.filter(function(e){if(-1==l.filterItems.values.indexOf(e))return e}):n._getLocalizedLabels("MultipleItems");return s},_getFilterState:function(i,l,n,s){var o,a,d="";if(s.model.operationalMode==t.Pivot.OperationalMode.ClientMode)i?(t.isNullOrUndefined(t.olap.base.olapCtrlObj)&&(t.olap.base.olapCtrlObj=s),("All"==s._fieldSelectedMembers[n.fieldName.toLowerCase()]||t.isNullOrUndefined(s._fieldSelectedMembers[n.fieldName.toLowerCase()]))&&t.olap._mdxParser.getAllMember(s.model.dataSource,n.fieldName,s),d="All"==s._fieldSelectedMembers[n.fieldName.toLowerCase()]||t.isNullOrUndefined(s._fieldSelectedMembers[n.fieldName.toLowerCase()])?s._allMember:s._fieldSelectedMembers[n.fieldName.toLowerCase()],d=this._getFilterStateMember(i,l,n,s,d)):d=this._getFilterStateMember(i,l,n,s,d);else if(s.model.analysisMode==t.Pivot.AnalysisMode.Pivot)if((o=t.isNullOrUndefined(s._tempFilterData)?[]:e.map(s._tempFilterData,function(e){return e[n.DimensionName]})).length>0&&s._fieldMembers[n.DimensionName])d=s._fieldMembers[n.DimensionName].length-o.length==1?s._fieldMembers[n.DimensionName].filter(function(e){if(-1==o.indexOf(e))return e}):s._getLocalizedLabels("MultipleItems");else if(t.isNullOrUndefined(s._clientReportCollection))d=s._getLocalizedLabels("All");else for(a=0;a<s._clientReportCollection.length;a++){if(!t.isNullOrUndefined(s._clientReportCollection[a]._fieldSelectedMembers)&&(""==s._currentRecordName&&s.element.find("#reportList")!=r&&s.element.find("#reportList")[0].value==s._clientReportCollection[a].name||""!=s._currentRecordName&&s._currentReportName==s._clientReportCollection[a].name)){s._fieldSelectedMembers[n.Tag]=s._clientReportCollection[a]._fieldSelectedMembers[n.DimensionName],d="All"==s._fieldSelectedMembers[n.Tag]||s._fieldSelectedMembers[n.Tag]==r?s._getLocalizedLabels("All"):s._fieldSelectedMembers[n.Tag];break}d=s._getLocalizedLabels("All")}else d=("All"==s._fieldSelectedMembers[n.Tag]?n.AllMember:s._fieldSelectedMembers[n.Tag])||n.AllMember;return d},_getInitialSlicerName:function(t,i){t.controlObject._slicerName=e(e(i).find("Axis:eq(0) Tuple:eq(0)").children().children()[1]).text()},_getTreeViewItems:function(t){for(var i,r=t.element.find(".e-editorTreeView"),l=[],n=e(r).find(":input.nodecheckbox"),s=0;s<n.length;s++)i=e(n[s]).parents("li:eq(0)"),l.push({Id:i[0].id,name:e(i[0]).find("a:eq(0)").text()});return l},_getEditorMember:function(i,r,l){var n,s,o,a=l?r._schemaData._editorTreeData:r._editorTreeData,d=[];if(r.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(0==a.length){var h=this._getTreeViewItems(l?r._schemaData:r,a),c=e.extend(!0,[],l?r._schemaData._memberTreeObj.dataSource():r._memberTreeObj.dataSource()),u=e.map(h,function(i){if("All"!=i.Id)return e.map(c,function(e){i.Id==e.id&&((i=e).name=t.isNullOrUndefined(i.parentId)?i.name+"_1":i.name)}),i}),g=e.map(u,function(t){return e.map(u,function(e){t.parentId==e.id&&(t.name=t.name+"_"+(Number(e.name.split("_")[e.name.split("_").length-1])+1))}),t});e.map(g,function(e){var t=e.name.split("_")[e.name.split("_").length-2],i=Number(e.name.split("_")[e.name.split("_").length-1]),r=e.checkedStatus;d.push({name:t,checked:r,level:Number(i)})})}else e.map(a,function(e){d.push({name:e.name,id:e.id,pid:e.pid,checked:e.checkedStatus,level:e.level})});return this._updateEditorMembers(i,d,r,a)}if(r.model.analysisMode==t.Pivot.AnalysisMode.Olap)return n=l?r._schemaData.element.find(".e-editorTreeView"):r.element.find(".e-editorTreeView"),g=a.length>0?a:e(n).find(":input.nodecheckbox"),a.length>0?e.map(g,function(e){d.push({name:e.name,id:e.id,pid:e.pid,checked:e.checkedStatus,level:Number(e.id.split("_")[e.id.split("_").length-1])})}):e.map(g,function(t){if("All"!=e(t).parents("li:eq(0)").attr("id")){var i=e(t).parent().siblings("a").text(),r=t.value.split("_")[t.value.split("_").length-1],l=!(!t.checked&&"mixed"!=e(t.parentElement).attr("aria-checked"));d.push({name:i,checked:l,level:Number(r)})}}),this._updateEditorMembers(i,d,r,a);for(s=[],o=1;o<i.length;o++)s.push(e(i[o].parentElement).siblings("a").text());return s},_updateEditorMembers:function(i,r,l,n){var s,o,a,d,h,c;if(r.length>0&&"All"==r[0].name&&r.splice(0,1),!t.isNullOrUndefined(l._fieldMembers[i]))if(0==n.length){var u=[],g=0,p="",m=l._fieldMembers[i];for(s=0;s<r.length;s++)if(t.isNullOrUndefined(m[s+g])||r[s].level==m[s+g].level)u.push(r[s]);else if(t.isNullOrUndefined(m[s+g])||r[s].level<m[s+g].level){a=s;do{r[s-1].checked&&u.push(m[a]),g++,a++}while(r[s].level<m[a].level);s--}else if(t.isNullOrUndefined(m[s+g])||r[s].level>m[s+g].level){o=m[s+g].level,a=s;do{u.push(r[a]),g--,s=++a-1}while(r[a].level>o)}l._fieldMembers[i]=u}else d=e.extend(!0,[],l._fieldMembers[i]),h=[],e.each(r,function(e,t){for(var i=!1,r=0;r<d.length;r++)if(t.id==d[r].id){d.splice(r,1,t),i=!0;break}i||h.push(t)}),l._fieldMembers[i]=d.concat(h);l._fieldMembers[i]=t.isNullOrUndefined(l._fieldMembers[i])?r:l._fieldMembers[i];var _=1,f="",b="",C=[];do{if(c=e.map(l._fieldMembers[i],function(e){if(e.level==_)return e}),C=e.map(c,function(e){if(e.checked)return e}),c.length==C.length)p=1==_?"All":f,c.length>1&&(b="All"),_++;else if(1==C.length)f=p="All"==b?"multiple":C[0].name,_++;else if(C.length>1&&c.length>C.length){p="multiple";break}}while(C.length>0&&"All"!=p&&"multiple"!=p&&e.map(l._fieldMembers[i],function(e){if(e.level==_)return e}).length>0);return p},_getTreeData:function(e,i,r){var l=t.olap.base._getConnectionInfo(e.url),n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+e.request+"</RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+e.catalog+"</CATALOG_NAME>"+("loadcubelist"==r.action?"":"<CUBE_NAME>"+e.cube+"</CUBE_NAME>")+"</RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.catalog+"</Catalog><LocaleIdentifier>"+l.LCID+"</LocaleIdentifier> </PropertyList></Properties></Discover></Body></Envelope>";r.action="loadFieldElements",this.doAjaxPost("POST",l.url,{XMLA:n},i,null,r)},updateTreeView:function(i){var r,l,n,s,o,a,d=i.element.find(".e-editorTreeView").find("li"),h=d.length,c=i._memberTreeObj.dataSource(),u=c.length;if(i.element.find(".e-editorTreeView").parents("#"+i._id+"_ClientDialog").find(".e-editorPara").text()==i._getLocalizedLabels("KPIs"))for(o=0;o<h;o++)for(r=e(d[o]).find("span:first").attr("aria-checked"),a=0;a<u;a++)d[o].id!=c[a].id||"mixed"!=r&&"true"!=r?d[o].id==c[a].id&&"false"==r&&(t.isNullOrUndefined(c[a].parentId)?c[a].checkedStatus=!1:e(d[o].parentElement).parent().attr("id")==c[a].parentId&&(c[a].checkedStatus=!1)):t.isNullOrUndefined(c[a].parentId)?c[a].checkedStatus=!0:e(d[o].parentElement).parent().attr("id")==c[a].parentId&&(c[a].checkedStatus=!0);else for(o=0;o<h;o++)for(r=e(d[o]).find("span:first").attr("aria-checked"),a=0;a<u;a++){if(d[o].id==c[a].id&&("mixed"==r||"true"==r)){c[a].checkedStatus=!0;break}if(d[o].id==c[a].id&&"false"==r){c[a].checkedStatus=!1;break}}for(o=0;o<c.length;o++)if(l=!1,1==c[o].checkedStatus){for(a=0;a<c.length;a++)if(c[a].hasOwnProperty("parentId")&&c[a].parentId==c[o].id&&1==c[a].checkedStatus){l=!0;break}if(!l)for(n=0;n<c.length;n++)c[n].hasOwnProperty("parentId")&&c[n].parentId==c[o].id&&(c[n].checkedStatus=!0)}else if(0==c[o].checkedStatus)for(s=0;s<c.length;s++)c[s].hasOwnProperty("parentId")&&c[s].parentId==c[o].id&&(c[s].checkedStatus=!1);for(o=0;o<h;o++)if(null==e(d[o]).attr("data-tag"))for(a=0;a<u;a++)if(e(d[o]).attr("id")==c[a].id){e(d[o]).attr("data-tag",c[a].tag);break}return i._memberTreeObj},getNodesState:function(e){for(var t="",i="",r="ejTreeView"==e.pluginName?e.dataSource():e,l=0;l<r.length;l++)1==r[l].checkedStatus?t+="::"+r[l].id+"||"+r[l].tag+"||"+(r[l].parentId||r[l].pid)+"||"+r[l].name:i+="::"+(r[l].parentId||r[l].pid)+"||"+r[l].tag+"||"+r[l].name;return{selectedNodes:t,unSelectedNodes:i}},removeParentSelectedNodes:function(t){for(var i,l=e.extend([],t),n=0;n<t.length;n++)for(i=0;i<l.length;i++)l[i].Id==t[n].parentId&&l.splice(i,1);return e.map(l,function(e){if(""!=e.tag&&e.tag!=r)return e.tag.replace(/\&/g,"&amp;")})},getChildNodes:function(i,l,n,s,o){var a,d,h,c=i.targetElement,u=(s.cube,s.catalog,s.data,o._generateChildMembers,e(i.currentElement).find("li").length),g=!1,p={memberEditorPageSize:"ejPivotSchemaDesigner"==o.pluginName?o.model.pivotControl.model.memberEditorPageSize:o.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==o.pluginName?o.model.pivotControl.model.enableMemberEditorPaging:o.model.enableMemberEditorPaging};if(p.enableMemberEditorPaging){for(a=0;a<o._memberTreeObj.dataSource().length;a++)if(o._memberTreeObj.dataSource()[a].parentId==i.id||o._memberTreeObj.dataSource()[a].pid==i.id)return i.isChildLoaded=!0,void t.Pivot.closePreventPanel(o)}else o._isSearchApplied=!1;if(jQuery.each(o._editorTreeData,function(e,t){if(t.id==i.id)return t.expanded=!0,t.isChildMerged=!0,!1}),0==u){var m=t.buildTag("span.nodeExpand e-load e-icon")[0].outerHTML,_=e(c).parents("li:eq(0)").attr("id");e.map(n,function(i){var n,s,a,d;i.fieldName!=l||t.isNullOrUndefined(i.filterItems)||(n=i.filterItems,(t.isNullOrUndefined(o.model.pivotControl)?o.model.enableMemberEditorPaging:o.model.pivotControl.model.enableMemberEditorPaging)?(n=e.map(n,function(e){if(e.pid!=r&&e.pid==_.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"))return g=!0,e})).length>0&&1==g&&(s=t.Pivot._generateChildWithAncestors(o,e(c).parents("li:eq(0)"),p.enableMemberEditorPaging,p.memberEditorPageSize),p.enableMemberEditorPaging&&(n.length>=p.memberEditorPageSize||s.lstChildren.length>=p.memberEditorPageSize)?(o._isEditorDrillPaging=!0,o.element.find(".searchEditorTreeView").data("ejMaskEdit").clear(),o._lastSavedTree=[],t.Pivot._makeAncestorsExpandable(o,e(c).parents("li:eq(0)")[0].id),a=s.allLvlLst.length>1&&s.lstChildren.length>=p.memberEditorPageSize?t.Pivot._getParentsTreeList(o,s.lstParents[0].id,o._editorTreeData):e.grep(o._editorTreeData,function(t){return t.id==e(c).parents("li:eq(0)")[0].id})[0],d={childNodes:s.allLvlLst.length>1&&s.lstChildren.length>=p.memberEditorPageSize?s.lstChildren:n,parentNode:a},t.Pivot._drillEditorTreeNode(d,o,p.memberEditorPageSize)):(e(c).parents("li:eq(0)").find(".nodeExpand").remove(),e(c).parents("li:eq(0)").removeClass("e-load"),e.each(n,function(e,t){delete t.parentId}),o._onDemandNodeExpand=!1,o._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(n,o,"ejPivotSchemaDesigner"==o.pluginName?o.model.pivotControl:o),e(c).parents("li:eq(0)")),o._onDemandNodeExpand=!1,o._memberTreeObj.model.nodeCheck=t.proxy(o._nodeCheckChanges,o),o._memberTreeObj.model.nodeUncheck=t.proxy(o._nodeCheckChanges,o),e.each(e(c).parents("li:eq(0)").find("li"),function(e,i){t.isNullOrUndefined(n[e])||i.setAttribute("data-tag",n[e].tag)}))):e.map(n,function(e){(e.parentId!=r&&e.parentId==_.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-")||e.pid!=r&&e.pid==_.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"))&&(g=!0)}))});i.isChildLoaded=!!g,g?jQuery.grep(o._editorTreeData,function(e){if(e.pid==i.id)return e}).length>10&&o.element.find("a.e-linkPanel").css("display","block"):(e(c).parents("li:eq(0)").prepend(m),e(c).parents("li:eq(0)").attr("data-tag")==r&&((d=e.map(n,function(e){if(e.fieldName==l)return e})[0])&&e.map(d.filterItems,function(t){t.id==e(c).parents("li:eq(0)").attr("id")&&e(c).parents("li:eq(0)").attr("data-tag",t.tag)})),h=e(c).parents("li:eq(0)").attr("data-tag").replace(/\&/g,"&amp;"),t.olap._mdxParser.getChildren(s,h,o))}},_getFilterParams:function(e,i,r){var l,n,s,o="";if("schemaValue"!=e){if(l="",!t.isNullOrUndefined(i))for(n=0;n<i.length;n++)if(!t.isNullOrUndefined(i[n][r]))for(s=0;s<i[n][r].length;s++)l+="##"+i[n][r][s];""!=l&&(o=e+"::"+r+"::FILTERED"+l)}return o},generateChildMembers:function(i,r){var l,n,s,o,a,d,h=e(r).find("Axis:eq(0) Tuple"),c=[],u=this;t.isNullOrUndefined(u.olapCtrlObj)||(u=u.olapCtrlObj);var g={memberEditorPageSize:"ejPivotSchemaDesigner"==u.pluginName?u.model.pivotControl.model.memberEditorPageSize:u.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==u.pluginName?u.model.pivotControl.model.enableMemberEditorPaging:u.model.enableMemberEditorPaging},p={currentReportItems:"ejPivotSchemaDesigner"==u.pluginName?u.model.pivotControl._currentReportItems:u._currentReportItems,savedReportItems:"ejPivotSchemaDesigner"==u.pluginName?u.model.pivotControl._savedReportItems:u._savedReportItems},m=u.element.find("[data-tag='"+i.currentNode.replace(/&amp;/g,"&")+"']");for(n=0;n<h.length;n++){var _=e(e(r).find("Axis:eq(0) Tuple:eq("+n+")").children().children()[0]).text(),f=""==e(e(r).find("Axis:eq(0) Tuple:eq("+n+")").children()).find("Caption").text()?"(Blank)":e(e(r).find("Axis:eq(0) Tuple:eq("+n+")").children()).find("Caption").text(),b={hasChildren:"0"!=e(h[n]).find("CHILDREN_CARDINALITY").text(),checkedStatus:"true"==e(e(m).find("input.nodecheckbox")[0]).parent().attr("aria-checked"),id:_.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-").replace(/ /g,"_"),name:f,tag:_,level:parseInt(e(h[n]).find("LNum").text())};c.push(b)}c.length>0&&u.model.enableMemberEditorSorting&&null!=u._sortType&&(c=t.DataManager(c).executeLocal(t.Query().sortBy("name",u._sortType))),l=e(m).parents("li").length>1?e(m).parents("li").first():e(m).parents("li"),e(e(l).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1}),u._memberTreeObj=u.element.find(".e-editorTreeView").data("ejTreeView"),c.length>0&&(s="ejPivotGrid"==u.pluginName?u._selectedField:u._selectedFieldName,e.map(p.currentReportItems,function(i){i.fieldName!=s||t.isNullOrUndefined(i.filterItems)||(e.each(c,function(t,i){i.pid=e(m).attr("id")}),e.merge(i.filterItems,c),u._editorTreeData=i.filterItems)}),0==p.currentReportItems.length&&u._editorTreeData.concat(c)),m.find(".nodeExpand").remove(),m.find(".e-load").removeClass("e-load"),jQuery.each(u._editorTreeData,function(e,t){if(t.id==m[0].id)return t.expanded=!0,!1}),g.enableMemberEditorPaging?(o=t.Pivot._generateChildWithAncestors(u,m,g.enableMemberEditorPaging,g.memberEditorPageSize),c.length>=g.memberEditorPageSize||o.lstChildren.length>=g.memberEditorPageSize?(u._isEditorDrillPaging=!0,u.element.find(".searchEditorTreeView").data("ejMaskEdit").clear(),u._lastSavedTree=[],t.Pivot._makeAncestorsExpandable(u,m[0].id),a=o.allLvlLst.length>1&&o.lstChildren.length>=g.memberEditorPageSize?t.Pivot._getParentsTreeList(u,o.lstParents[0].id,u._editorTreeData):e.grep(u._editorTreeData,function(e){return e.id==m[0].id})[0],d={childNodes:o.allLvlLst.length>1&&o.lstChildren.length>=g.memberEditorPageSize?o.lstChildren:c,parentNode:a},t.Pivot._drillEditorTreeNode(d,u,g.memberEditorPageSize)):u._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(c,u,"ejPivotSchemaDesigner"==u.pluginName?u.model.pivotControl:u),e(m))):u._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(c,u,"ejPivotSchemaDesigner"==u.pluginName?u.model.pivotControl:u),e(m)),e.each(m.find("li"),function(e,i){t.isNullOrUndefined(c[e])||i.setAttribute("data-tag",c[e].tag)}),p.savedReportItems=e.extend(!0,[],p.currentReportItems)},_generateChildWithAncestors:function(i,r,l,n){var s,o,a=[],d=[e.grep(i._editorTreeData,function(e){return e.id==r[0].id})[0]],h=[];if(l){jQuery.each(i._editorTreeData,function(e,t){if(t.id==r[0].id)return t.expanded=!0,!1}),a.push(d[0]);do{for(s=[],h=[],o=0;o<d.length&&(e.each(i._editorTreeData,function(e,i){t.isNullOrUndefined(i.pid)||i.pid!=d[o].id||(i.expanded&&(s.push(i),a.push(i)),h.push(i))}),!(h.length>=n));o++)h=[];if(d=s.length>0&&h.length<n?s:d,h.length>=n)break}while(s.length>0)}return{allLvlLst:a,lstParents:d,lstChildren:h}},_makeAncestorsExpandable:function(e,i){var r=t.DataManager(e._editorTreeData).executeLocal(t.Query().where("id","equal",i));r.length>0&&(r[0].expanded=!0,i=r[0].pid),!t.isNullOrUndefined(i)&&r.length>0&&this._makeAncestorsExpandable(e,i)},_jsonToEngine:function(e){for(var i,r=e,l=[],n=0;n<r.length;n++)i=parseInt(r[n].Index.split(",")[0]),t.isNullOrUndefined(l[i])?(l[i]=[],l[i].push(r[n])):l[i].push(r[n]);return l},_cropJson:function(i,r){var l,n,s,o,a,d,h,c,u=0,g=0,p=1;if(n=(l=i.model.operationalMode==t.Pivot.OperationalMode.ServerMode?{columns:JSON.parse(i.getOlapReport()).PivotColumns,rows:JSON.parse(i.getOlapReport()).PivotRows,values:JSON.parse(i.getOlapReport()).PivotCalculations}:{columns:i.model.dataSource.columns,rows:i.model.dataSource.rows,values:i.model.dataSource.values}).columns.length+(l.values.length>0&&"rows"!=l.values[0].axis?1:0),s=l.rows.length+(l.values.length>0&&"rows"==l.values[0].axis?1:0),n=0==n?1:n,s=0==s?1:s,""==i._drillAction&&i.model.enableCollapseByDefault){if(_=e.extend(!0,[],t.Pivot._jsonToEngine(r)),n+s>2){for(;g<_[0].length;)if(l.rows.length>1&&-1==_[0][g].CSS.indexOf("summary")&&g+p>n||0==l.columns.length&&0==l.values.length&&-1==_[0][g].CSS.indexOf("summary")||g>0&&p<l.columns.length){for(o=0;o<_.length;o++)_[o].splice(g,1);p++}else g++;for(p=1;u<_.length;)l.columns.length>1&&-1==_[u][0].CSS.indexOf("summary")&&u+p>s||0==l.rows.length&&0==l.values.length&&-1==_[u][0].CSS.indexOf("summary")||u>0&&p<l.rows.length?(_.splice(u,1),p++):u+=_[u][0].CSS.indexOf("summary")>-1?_[u][0].ColSpan:1}for((_=e.map(_,function(t){return[e.map(t,function(e){return("summary rstot"==e.CSS||"summary cstot"==e.CSS||"summary stot"==e.CSS)&&(e.State=2,e.Value=e.Value.replace("Total","")),e})]}))[0][0].ColSpan="none"==_[0][0].CSS&&l.values.length>0&&"rows"==l.values[0].axis&&l.rows.length>0?2:1,_[0][0].RowSpan="none"==_[0][0].CSS&&l.values.length>0&&"rows"!=l.values[0].axis&&l.columns.length>0?2:1,n=l.values.length>0&&"rows"==l.values[0].axis?l.values.length:1,s=l.values.length>0&&"rows"!=l.values[0].axis?l.values.length:1,u=0;u<_[0].length;u++)_[0][u].CSS.indexOf("summary")>-1&&(_[0][u].RowSpan=n,_[0][u].ColSpan=1);for(u=0;u<_.length;u++)_[u][0].CSS.indexOf("summary")>-1&&(_[u][0].ColSpan=s,_[u][0].RowSpan=1);return e.map(_,function(e){return e})}if(i.model.enableCollapseByDefault||""!=i._drillAction){var m=0,_=e.extend(!0,[],t.Pivot._jsonToEngine(i._croppedJson)),f=e.extend(!0,[],t.Pivot._jsonToEngine(i._compJson)),b=e.extend(!0,[],i._compJson),C=""==i._drillParams.currRow?"column":"row";for(a=0;a<i._compJson.length&&0==parseInt(i._compJson[a].Index.split(",")[0]);a++)m++;return d=t.Pivot._getDrillRange(l,C,i,m,b),h=t.Pivot._sliceJson(l,C,n,s,i,b,d.startPos,d.endPos,m,_),"drilldown"==i._drillAction&&(c=t.Pivot._mergeJson(l,i,C,n,s,b,f,_,h,d.startPos,d.endPos,m)),e.map("drilldown"==i._drillAction?c:h,function(e){return e})}return r},_getEnginePos:function(i,r,l){var n=e.map(t.isNullOrUndefined(l[parseInt(i.split(",")[0])])?l[parseInt(r.split(",")[0])]:l[parseInt(i.split(",")[0])],function(e,t){if(e.Index==e.Index.split(",")[0]+","+r.split(",")[1])return t})[0];return{colPos:e.map(l,function(t,i){var l=!1;return e.each(t,function(e,t){t.Index==r&&(l=!0)}),l?i:void 0})[0],rowPos:n}},_mergeJson:function(i,r,l,n,s,o,a,d,h,c,u,g){var p,m,_,f,b,C,S=t.Pivot._getIndices(l,o,r,d,c,u,g),x=S.columnIndices,v=S.rowIndices,w=S.rowSpan,I=S.colSpan,y=t.Pivot._getEnginePos(c,u,d),T=y.colPos,L=y.rowPos,R=[];if("row"==l){if(t.isNullOrUndefined(d[parseInt(c.split(",")[0])+1])){p=parseInt(c.split(",")[0])+1;do{R=e.map(a[p],function(e){if(v.indexOf(parseInt(e.Index.split(",")[1]))>-1)return e.Span="Block",e}),d[p]=R,p++}while(p<I&&!r.model.enableCollapseByDefault)}}else if(parseInt(d[0][parseInt(c.split(",")[1])+1].Index.split(",")[1])!=parseInt(c.split(",")[1])+1)for(C=0;C<a.length;C++){p=parseInt(c.split(",")[1])+1;do{m=a[C][p],x.indexOf(parseInt(m.Index.split(",")[0]))>-1&&(m.Span="Block",d[C].splice(p,0,m)),p++}while(p<w&&!r.model.enableCollapseByDefault)}if("row"==l){for(b=0,C=0;C<d.length;C++)if(!t.isNullOrUndefined(d[C])){_=L,f=0;do{_==L&&d[C].splice(_,1,h[b][f]),_++,f++,d[C].splice(_,0,h[b][f])}while(t.isNullOrUndefined(h[b][f])||parseInt(h[b][f].Index.split(",")[1])<parseInt(u.split(",")[1]));b++}}else for(b=h.length-1,C=T;C>=s;C--)t.isNullOrUndefined(h[b])||d.splice(C,1,h[b]),b--;return t.Pivot._drillSpanCalculation(d,r)},_getIndices:function(i,r,l,n,s,o,a){var d,h=e.map(n,function(e){if(!t.isNullOrUndefined(e))return parseInt(e[0].Index.split(",")[0])}),c=e.map(n[0],function(e){if(!t.isNullOrUndefined(e))return parseInt(e.Index.split(",")[1])});if(l.model.enableCollapseByDefault)"row"==i?h.push(parseInt(s.split(",")[0])+1):c.push(parseInt(s.split(",")[1])+1);else{var u=r[parseInt(o.split(",")[0])*a+parseInt(o.split(",")[1])],g=parseInt(u.Index.split(",")[0]),p=parseInt(u.Index.split(",")[1]),m=u.ColSpan,_=u.RowSpan;if("row"==i)for(d=g+1;d<m;d++)-1==h.indexOf(d)&&h.push(d);else for(d=p+1;d<_;d++)-1==c.indexOf(d)&&c.push(d)}return{columnIndices:h,rowIndices:c,colSpan:m,rowSpan:_}},_sliceJson:function(i,r,l,n,s,o,a,d,h,c){var u,g,p,m,_,f,b,C,S,x,v,w,I=[],y=i.values.length>0&&"rows"!=i.values[0].axis?1:0;if("drilldown"==s._drillAction){var T="row"==r?"0,"+parseInt(a.split(",")[1]):parseInt(a.split(",")[0])+",0",L="row"==r?"0,"+parseInt(d.split(",")[1]):parseInt(d.split(",")[0])+",0",R=t.Pivot._getIndices(r,o,s,c,a,d,h),O=R.columnIndices,F=R.rowIndices,E=parseInt(T.split(",")[0])*h+h,D=0;T="row"==r?T:parseInt(T.split(",")[0])*h+",0";do{for(u="row"==r?parseInt(T.split(",")[1]):parseInt(T.split(",")[0]),D="row"==r?0:D;!t.isNullOrUndefined(o[u])&&("column"!=r||E>u);)("row"==r?O.indexOf(parseInt(o[u].Index.split(",")[0]))>-1:F.indexOf(parseInt(o[u].Index.split(",")[1]))>-1)&&(t.isNullOrUndefined(I[D])&&(I[D]=[]),I[D].push(o[u]),"row"==r&&D++),u+="row"==r?h:1;"column"==r&&(E+=h,D++),T="row"==r?"0,"+(parseInt(T.split(",")[1])+1):parseInt(T.split(",")[0])+h+",0"}while(T!=("row"==r?"0,"+(parseInt(L.split(",")[1])+1):(parseInt(L.split(",")[0])+1)*h+",0"));if(("row"==r?n-1>parseInt(s._drillParams.currPos.split(",")[0])+1:l-y-1>parseInt(s._drillParams.currPos.split(",")[1])+1)&&s.model.enableCollapseByDefault){j="row"==r?0:parseInt(s._drillParams.currPos.split(",")[1])+1,N="row"==r?parseInt(s._drillParams.currPos.split(",")[0])+1:0;do{if(g=!1,!(t.isNullOrUndefined(I[N])||t.isNullOrUndefined(I[N][j])||-1!=I["row"==r?N-1:N]["row"==r?j:j-1].CSS.indexOf("summary")||"rowheader"!=I[N][j].CSS&&"colheader"!=I[N][j].CSS&&"none"!=I[N][j].CSS&&""!=I[N][j].Value))if("row"==r)for(w=0;w<I.length;w++)t.isNullOrUndefined(I[w])||(I[w].splice(j,1),g=!0);else delete I[N],g=!0;"row"==r?j=g?j:j+1:N+=1}while("row"==r?j<I[0].length:N<I.length)}var N=parseInt(s._drillParams.currPos.split(",")[0])+("row"==r?1:0),A="",P=0,k=0,j=parseInt(s._drillParams.currPos.split(",")[1])+1;if(s.model.enableCollapseByDefault)do{if("row"==r?N==parseInt(s._drillParams.currPos.split(",")[0])+1:j==parseInt(s._drillParams.currPos.split(",")[1])+1){for(w="row"==r?I[N].length-1:I.length-1;w>=0;w--)if(("column"!=r||!t.isNullOrUndefined(I[w]))&&(C="row"==r?I[N][w]:I[w][j]).CSS.indexOf("summary")>-1){C.State=2,C.Expander=1;var M=N,V=j,B=0;if("row"==r){do{B++,M++}while(!t.isNullOrUndefined(c[M])&&("none"==c[M][0].CSS||""==c[M][0].Value));C.ColSpan=B}else{do{B++,V++}while(!t.isNullOrUndefined(c[0][V])&&("none"==c[0][V].CSS||""==c[0][V].Value));C.RowSpan=B}C.Value=C.Value.replace(" Total","")}}else for(p="","column"==r&&(p=e.map(I,function(e,i){if(!t.isNullOrUndefined(e))return i})[0]),w="row"==r?I[N].length-1:I.length-1;w>=0;w--)"column"==r&&t.isNullOrUndefined(I[w])||(m=(C="row"==r?I[N][w]:I[w][j]).Value.replace(" Total",""),A=""==A&&""!=C.Value.replace(" Total","")?C.Value.replace(" Total",""):""!=C.Value.replace(" Total","")&&A!=C.Value.replace(" Total","")?C.Value.replace(" Total",""):A,""!=m&&m!=A||0==w||p==w?(C.CSS="row"==r?"rowheader":"colheader",C.State=1,C.Expander=1,C.Value=A,"row"==r?C.RowSpan=N>parseInt(s._drillParams.currPos.split(",")[0])-1?P:C.RowSpan:C.ColSpan=j>parseInt(s._drillParams.currPos.split(",")[1])-1?k:C.ColSpan,P=1,k=1):(C.CSS.indexOf("summary")>-1&&("row"==r?C.ColSpan=parseInt(s._drillParams.currPos.split(",")[0])+2-N:C.RowSpan=parseInt(s._drillParams.currPos.split(",")[1])+2-j),P++,k++));"row"==r?N--:j--}while("row"==r?N>=0:j>=0)}else{var H=t.Pivot._getEnginePos(a,d,c);N=H.colPos,j=H.rowPos;if("row"==r){for(_=0,e.each(c[0],function(e,t){if(parseInt(t.Index.split(",")[1])==parseInt(a.split(",")[1]))return _=e,!1}),w=parseInt(a.split(",")[1]);w<parseInt(d.split(",")[1]);w++)for(f=0;f<c.length;f++)if(!t.isNullOrUndefined(c[f])){for(b="",C="",V=_;V<c[f].length;V++)if(parseInt(c[f][V].Index.split(",")[1])==w){C=c[f][V],b=V,c[f].splice(V,1);break}t.isNullOrUndefined(c[f][b])||"none"!=c[f][b].CSS&&""!=c[f][b].Value&&("rowheader"!=c[f][b].CSS||0!=c[f][b].Expander)||"rowheader"!=C.CSS||(c[f][b].CSS="rowheader",c[f][b].Value=C.Value,c[f][b].State=C.State,c[f][b].Expander=C.Expander)}}else for(S=[],w=parseInt(a.split(",")[0]);w<parseInt(d.split(",")[0]);w++)if(S=0!=S.length||t.isNullOrUndefined(c[w])?S:c[w],delete c[w],parseInt(d.split(",")[0])-w==1){x=0;do{("none"==c[w+1][x].CSS||""==c[w+1][x].Value||"colheader"==c[w+1][x].CSS&&0==c[w+1][x].Expander)&&(c[w+1][x].CSS=S[x].CSS,c[w+1][x].Value=S[x].Value,c[w+1][x].State=S[x].State,c[w+1][x].Expander=S[x].Expander),x++}while(x<=parseInt(d.split(",")[1]))}if(0==(v="row"==r?e.map(c[parseInt(d.split(",")[0])+1],function(e){if("rowheader"==e.CSS||e.CSS.indexOf("summary")>-1)return e}).length:e.map(c,function(e){if(!t.isNullOrUndefined(e)&&!t.isNullOrUndefined(e[j+1])&&("colheader"==e[j+1].CSS||e[j+1].CSS.indexOf("summary")>-1))return e}).length))if("row"==r){N=parseInt(d.split(",")[0])+1;do{delete c[N],N++}while(!t.isNullOrUndefined(c[N])&&("none"==c[N][0].CSS||""==c[N][0].Value))}else{j=parseInt(d.split(",")[1])+1;do{for(w=0;w<c.length;w++)t.isNullOrUndefined(c[w])||(c[w]=e.map(c[w],function(e){if(parseInt(e.Index.split(",")[1])!=j)return e}));j++}while(j<c[0][0].RowSpan-(i.values.length>0&&"rows"!=i.values[0].axis?1:0))}if(N=(H=t.Pivot._getEnginePos(a,d,c)).colPos,j=H.rowPos,"row"==r){for(w=0;w<c[parseInt(d.split(",")[0])].length;w++)if(c[parseInt(d.split(",")[0])][w].Index==d){c[parseInt(d.split(",")[0])][w].Value=c[parseInt(d.split(",")[0])][w].Value.replace(" Total",""),c[parseInt(d.split(",")[0])][w].State=2,c[parseInt(d.split(",")[0])][w].ColSpan=0==v?c[parseInt(d.split(",")[0])][w].ColSpan-1:c[parseInt(d.split(",")[0])][w].ColSpan;break}}else c[N][j].Value=c[N][j].Value.replace(" Total",""),c[N][j].State=2,c[N][j].RowSpan=0==v?c[N][j].RowSpan-1:c[N][j].RowSpan;I=t.Pivot._drillSpanCalculation(c,s)}return I},_getDrillRange:function(i,r,l,n,s){var o,a,d=0,h=0,c="",u="",g=n,p="row"==r?l._drillParams.currRow.split(">#>"):l._drillParams.currCol.split(">#>");do{if((o="row"==r?parseInt((d-1)/n):h)+1==p.length){if((!("none"!=s[d].CSS&&""!=s[d].Value||t.isNullOrUndefined(s["row"==r?d-n:d-1])||"string"!=typeof s["row"==r?d-n:d-1].Value||s["row"==r?d-n:d-1].Value.replace(" Total","")!=e.trim(p[o<1?0:o-1]))||"string"==typeof s[d].Value&&""!=s[d].Value&&s[d].Value.replace(" Total","")!=e.trim(p[o]))&&""!=c){for(a="row"==r?d-1:d-n;!t.isNullOrUndefined(s[a])&&"summary rstot"!=s[a].CSS&&"summary cstot"!=s[a].CSS&&"summary stot"!=s[a].CSS;)a="row"==r?a-1:a-n;t.isNullOrUndefined(s[a])||(u=s[a].Index);break}"string"==typeof s[d].Value&&s[d].Value.replace(" Total","")==e.trim(p[o])&&(c=""==c?s[d].Index:c)}else s[d].Value.replace(" Total","")==e.trim(p[o])&&(d="row"==r?g*(o+1)+(d-1):d-g+1);h=(d="row"==r?d+1:d+n)%n,"column"==r&&d>s.length&&(d=++h)}while(s.length>d&&""==u);return"drillup"==l._drillAction&&l.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&("column"==r&&i.values.length>0&&"row"!=i.values[0].axis?u=parseInt(u.split(",")[0])-(i.values.length-1)+","+u.split(",")[1]:"row"==r&&i.values.length>0&&"row"==i.values[0].axis&&(u=u.split(",")[0]+","+(parseInt(u.split(",")[1])-(i.values.length-1)))),{startPos:c,endPos:u}},_drillSpanCalculation:function(i,r){for(var l,n,s,o,a,d=r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(r.getOlapReport()).PivotCalculations:r.getOlapReport().values,h=r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(r.getOlapReport()).PivotColumns:r.getOlapReport().columns,c=r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(r.getOlapReport()).PivotRows:r.getOlapReport().rows,u=[],g=[],p=e.map(i,function(e){if(!t.isNullOrUndefined(e))return e[0]}).length,m=0;m<i[0].length;m++){for(I=0,l=0,a=0;a<i.length;a++)t.isNullOrUndefined(i[a])||t.isNullOrUndefined(i[a][m])||(I++,i[a][m].ColSpan>p-I+1&&(i[a][m].ColSpan=p-I+1),"none"!=i[a][m].CSS&&""!=i[a][m].Value&&l++);0==l&&u.push(m)}for(m=0;m<i.length;m++)t.isNullOrUndefined(i[m])||(n=e.map(i[m],function(e,t){if(-1==u.indexOf(t))return e.RowSpan>=i[m].length-t&&(e.RowSpan=i[m].length-t),"summary value"==e.CSS&&(e.RowSpan=1,e.ColSpan=1),e}),g[m]=n);i=g;var _=h.length+(d.length>0&&"rows"!=d[0].axis?d.length:0),f=c.length+(d.length>0&&"rows"==d[0].axis?d.length:0),b=-1;do{b++}while(!(t.isNullOrUndefined(i[0])||t.isNullOrUndefined(i[0][b])||"none"!=i[0][b].CSS&&""!=i[0][b].Value));i[0][0].RowSpan=b>_?_:b,b=d.length>0&&"rows"!=d[0].axis?b-1:b,s=-1,o=0;do{s++}while(!t.isNullOrUndefined(i[s])&&("none"==i[s][0].CSS||""==i[s][0].Value));for(i[0][0].ColSpan=s>f?f:s,m=0;m<i[0].length;m++)for(I=d.length>0&&"rows"==d[0].axis?1:0,a=0;a<i[0][0].ColSpan;a++)t.isNullOrUndefined(i[a][m])||(I++,(0!=m||0!=a)&&i[a][m].ColSpan>i[0][0].ColSpan-I+1&&i[0][0].ColSpan-I+1>0&&(i[a][m].ColSpan=i[0][0].ColSpan-I+1));for(m=i[0][0].ColSpan-1;m<i.length;m++)if(I=d.length>0&&"rows"!=d[0].axis?1:0,!t.isNullOrUndefined(i[m]))for(a=0;a<i[0][0].RowSpan;a++)I++,(0!=m||0!=a)&&i[m][a].RowSpan>i[0][0].RowSpan-I+1&&i[0][0].RowSpan-I+1>0&&(i[m][a].RowSpan=i[0][0].RowSpan-I+1);if(!t.isNullOrUndefined(c)&&c.length>1){s=d.length>0&&"rows"==d[0].axis?s-1:s;do{i[o]=e.map(i[o],function(e){return e.CSS.indexOf("summary")>-1&&(e.ColSpan=s-o),e});var C=0,S=!1,x="";for(m=i[o].length-1;m>=i[0][0].RowSpan;m--)"summary rstot"==i[o][m].CSS||"summary stot"==i[o][m].CSS?(t.isNullOrUndefined(i[o][m+1])||"rowheader"!=i[o][m+1].CSS||(i[o][m+1].RowSpan=C),C=0,S=!0,x=""):i[0][0].RowSpan-m==0?i[o][m].RowSpan=S||x==i[o][m].Value?C+1:i[o][m].RowSpan:(x=i[o][m].Value,C++);o++}while(s>o+(d.length>0&&"rows"==d[0].axis?1:0))}if(!t.isNullOrUndefined(h)&&h.length>1){o=0;do{for(m=0;m<i.length;m++)!t.isNullOrUndefined(i[m])&&i[m][o].CSS.indexOf("summary")>-1&&(i[m][o].RowSpan=b-o);var v=0,w=(S=!1,""),I=(x="",e.grep(i,function(e,i){if(!t.isNullOrUndefined(e)&&"none"!=e[0].CSS&&""!=e[0].Value)return w=""==w?i:w,e}).length);for(m=i.length-1;m>=w;m--)I-=t.isNullOrUndefined(i[m])||"none"==i[m][0].CSS||""==i[m][0].Value?0:1,t.isNullOrUndefined(i[m])||"summary cstot"!=i[m][o].CSS&&"summary stot"!=i[m][o].CSS?0!=I||t.isNullOrUndefined(i[m])?t.isNullOrUndefined(i[m])||(x=i[m][o].Value,v++):i[m][o].ColSpan=S||x==i[m][o].Value?v+1:i[m][o].ColSpan:(t.isNullOrUndefined(i[m+1])||t.isNullOrUndefined(i[m+1][o])||"rowheader"!=i[m+1][o].CSS&&"colheader"!=i[m+1][o].CSS||(i[m+1][o].ColSpan=v),v=0,S=!0,x="");o++}while(b>o+(d.length>0&&"rows"!=d[0].axis?1:0))}return i},_calculatePagingSpan:function(i,r){var l,n;if(null!=i&&""!=i&&i.length>0){for(r._rowCount=0,l=jQuery.extend(!0,[],i),r._compJson=""==r._drillAction?jQuery.extend(!0,[],l):r._compJson,r._croppedJson=t.Pivot._cropJson(r,l),l=e.extend(!0,[],r._croppedJson),n=0;n<l.length&&0==parseInt(l[n].Index.split(",")[0]);n++)r._rowCount++;var s=r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(r.getOlapReport()).PivotRows.length:r.getOlapReport().rows.length,o=r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(r.getOlapReport()).PivotColumns.length:r.getOlapReport().columns.length,a=r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(r.getOlapReport()).PivotCalculations.length:r.getOlapReport().values.length;l.length,r._rowCount;for(n=(0==l[0].RowSpan?0:l[0].RowSpan-1)+r.model.dataSource.pagerOptions.seriesPageSize;n<l.length&&n<r._rowCount;n+=r.model.dataSource.pagerOptions.seriesPageSize){if(l[n].CSS.indexOf("summary")>-1||l[n].CSS.indexOf("rowheader")>-1&&0==l[n].Expander&&null!=l[n+r._rowCount]&&l[n+r._rowCount].CSS.indexOf("value")>-1)continue;s>1&&t.Pivot._calculateRowPagingSpan(n,l,1,s,r)}for(n=((0==l[0].ColSpan?0:l[0].ColSpan-1)+r.model.dataSource.pagerOptions.categoricalPageSize)*r._rowCount;n<l.length;n+=r.model.dataSource.pagerOptions.categoricalPageSize*r._rowCount){if(l[n].CSS.indexOf("summary")>-1&&a<=1)continue;if(1==r.model.dataSource.pagerOptions.categoricalPageSize&&(l[n].CSS.indexOf("stot")>-1&&null!=l[n+r._rowCount]&&l[n+r._rowCount].CSS.indexOf("gtot")>-1||l[n].CSS.indexOf("gtot")>-1&&null==l[n+r._rowCount]))continue;t.Pivot._calculateColumnPagingSpan(n,l,1,o,a,r)}r._relPagingRecords=jQuery.extend(!0,[],l),r._rowCount=0}},_generatePagingRecords:function(i){var r,l,n,s,o;if(null!=i._relPagingRecords&&i._relPagingRecords.length>0){for(r=e.extend(!0,[],i._relPagingRecords),i._rowCount=0,p=0;p<r.length&&0==parseInt(r[p].Index.split(",")[0]);p++)i._rowCount++;var a=r.length/i._rowCount,d=0==r[0].RowSpan?0:r[0].RowSpan-1,h=0==r[0].ColSpan?0:r[0].ColSpan-1,c=Math.ceil((a-(h+1))/i.model.dataSource.pagerOptions.categoricalPageSize),u=Math.ceil((i._rowCount-(d+1))/i.model.dataSource.pagerOptions.seriesPageSize);i.model.dataSource.pagerOptions.categoricalCurrentPage=i.model.dataSource.pagerOptions.categoricalCurrentPage>c?c:i.model.dataSource.pagerOptions.categoricalCurrentPage,i.model.dataSource.pagerOptions.seriesCurrentPage=i.model.dataSource.pagerOptions.seriesCurrentPage>u?u:i.model.dataSource.pagerOptions.seriesCurrentPage,i._seriesPageCount=i.model.enablePaging?i._rowCount-(d+1):u,i._categPageCount=i.model.enablePaging?a-(h+1):c,i._categCurrentPage=i.model.dataSource.pagerOptions.categoricalCurrentPage,i._seriesCurrentPage=i.model.dataSource.pagerOptions.seriesCurrentPage;var g,p,m,_,f,b,C,S,x,v,w=[],I=d+1+i.model.dataSource.pagerOptions.seriesPageSize,y=h+1+i.model.dataSource.pagerOptions.categoricalPageSize;for(g=p=m=_=f=b=C=S=x=v=0,s=0;s<d+1;s++){for(o=0;o<h+1;o++)null!=r[p]&&(w[_]=r[p],p+=i._rowCount,_+=I);p=++g,_=++m}for(f=p=d+(0==i.model.dataSource.pagerOptions.seriesCurrentPage||1==i.model.dataSource.pagerOptions.seriesCurrentPage?0:(i.model.dataSource.pagerOptions.seriesCurrentPage-1)*i.model.dataSource.pagerOptions.seriesPageSize)+1,b=_=d+1,s=0;s<i.model.dataSource.pagerOptions.seriesPageSize;s++){for(o=0;o<h+1;o++)null!=r[p]&&(w[_]=r[p],p+=i._rowCount,_+=I);if(_=++b,(p=++f)>i._rowCount-1)break}for(C=p=(h+1)*i._rowCount+(0==i.model.dataSource.pagerOptions.categoricalCurrentPage||1==i.model.dataSource.pagerOptions.categoricalCurrentPage?0:(i.model.dataSource.pagerOptions.categoricalCurrentPage-1)*i.model.dataSource.pagerOptions.categoricalPageSize*i._rowCount),S=_=(h+1)*I,s=0;s<d+1;s++){for(o=0;o<i.model.dataSource.pagerOptions.categoricalPageSize;o++)null!=r[p]&&(w[_]=r[p],p+=i._rowCount,_+=I);if(_=++S,null==r[p=++C])break}for(x=p=(h+1)*i._rowCount+(0==i.model.dataSource.pagerOptions.categoricalCurrentPage||1==i.model.dataSource.pagerOptions.categoricalCurrentPage?0:(i.model.dataSource.pagerOptions.categoricalCurrentPage-1)*i.model.dataSource.pagerOptions.categoricalPageSize*i._rowCount)+d+(0==i.model.dataSource.pagerOptions.seriesCurrentPage||1==i.model.dataSource.pagerOptions.seriesCurrentPage?0:(i.model.dataSource.pagerOptions.seriesCurrentPage-1)*i.model.dataSource.pagerOptions.seriesPageSize)+1,v=_=(h+1)*I+d+1,l=0,s=0;s<i.model.dataSource.pagerOptions.seriesPageSize;s++){for(o=0;o<i.model.dataSource.pagerOptions.categoricalPageSize;o++)null!=r[p]&&(w[_]=r[p],l=parseInt(r[p].Index.split(",")[1]),p+=i._rowCount,_+=I);if(_=++v,null==r[p=++x]||l>parseInt(r[p].Index.split(",")[1]))break}for(i._rowCount=0,w=w.filter(function(e){return null!=e}),I=0,p=0;p<w.length&&0==parseInt(w[p].Index.split(",")[0]);p++)I++;for(y=w.length/I,s=0;s<y;s++)for(o=0;o<I;o++)t.isNullOrUndefined(w[s*I+o])||(w[s*I+o].Index=s+","+o);for(n=t.Pivot._drillSpanCalculation(t.Pivot._jsonToEngine(w),i),s=0;s<n.length;s++)for(o=0;o<n[s].length;o++)n[s][o].Index=s+","+o;return e.map(n,function(e){return e})}},_calculateRowPagingSpan:function(e,i,r,l,n){var s,o;if(i[e].CSS.indexOf("summary")>-1||i[e].CSS.indexOf("rowheader")>-1&&0==i[e].Expander&&r<l&&null!=i[e+n._rowCount]&&i[e+n._rowCount].CSS.indexOf("value")>-1)return!1;if(1==i[e].Expander&&i[e].RowSpan>1)i[e+1].RowSpan=i[e].RowSpan-1,i[e].RowSpan=1,i[e+1].Expander=i[e].Expander,i[e+1].State=i[e].State,i[e+1].Value=i[e].Value,i[e+1].CSS=i[e].CSS,-1==i[e+n._rowCount].CSS.indexOf("value")&&r<l-1&&t.Pivot._calculateRowPagingSpan(e+n._rowCount,i,r+1,l,n);else if(0==i[e].Expander&&null!=i[e+n._rowCount]&&r<l&&-1==i[e+n._rowCount].CSS.indexOf("value"))for(s=1,o=e-1;o>=0;o--)if(s++,1==i[o].Expander){i[o].RowSpan!=s&&(i[e+1].RowSpan=i[o].RowSpan-s,i[o].RowSpan=s,i[e+1].Expander=i[o].Expander,i[e+1].State=i[o].State,i[e+1].Value=i[o].Value,i[e+1].CSS=i[o].CSS,-1==i[e+n._rowCount].CSS.indexOf("value")&&r<l-1&&t.Pivot._calculateRowPagingSpan(e+n._rowCount,i,r+1,l,n));break}},_calculateColumnPagingSpan:function(e,i,r,l,n,s){var o,a;if(i[e].CSS.indexOf("summary")>-1&&n<=1)return!1;if(null!=i[e+s._rowCount]&&(1==i[e].Expander&&i[e].ColSpan>1||i[e].CSS.indexOf("summary")>-1&&i[e].ColSpan>1||r==l&&n>1&&i[e].ColSpan>1))i[e+s._rowCount].ColSpan=i[e].ColSpan-1,i[e].ColSpan=1,i[e+s._rowCount].Expander=i[e].Expander,i[e+s._rowCount].RowSpan=i[e].RowSpan,i[e+s._rowCount].State=i[e].State,i[e+s._rowCount].Value=i[e].Value,i[e+s._rowCount].CSS=i[e].CSS,r<l&&-1==i[e].CSS.indexOf("summary")&&t.Pivot._calculateColumnPagingSpan(e+1,i,r+1,l,n,s);else if(0==i[e].Expander&&null!=i[e+s._rowCount]&&1!=i[e+s._rowCount].Expander)for(o=1,a=e-s._rowCount;a>=0;a-=s._rowCount)if(o++,1==i[a].Expander||i[a].CSS.indexOf("summary")>-1&&i[a].ColSpan>1||r==l&&n>1&&i[a].ColSpan>1){i[a].ColSpan!=o&&(i[e+s._rowCount].ColSpan=i[a].ColSpan-o,i[a].ColSpan=o,i[e+s._rowCount].RowSpan=i[a].RowSpan,i[e+s._rowCount].Expander=i[a].Expander,i[e+s._rowCount].State=i[a].State,i[e+s._rowCount].Value=i[a].Value,i[e+s._rowCount].CSS=i[a].CSS,r<l&&-1==i[a].CSS.indexOf("summary")&&t.Pivot._calculateColumnPagingSpan(e+1,i,r+1,l,n,s));break}},createAdvanceFilterTag:function(i,r){var l,n,s,o,a,d,h,c,u,g,p="",m=(t.buildTag("li.e-separator").css("margin-left","29px")[0].outerHTML,r.element.hasClass("e-pivotschemadesigner")?r.model.pivotControl.model.operationalMode:r.model.operationalMode),_=r.element.hasClass("e-pivotschemadesigner")?r.model.pivotControl.model.analysisMode:r.model.analysisMode;if("filterTag"==i.action)p=[{id:"ascOrder",text:r._getLocalizedLabels("SortAtoZ"),parentId:null,spriteCssClass:"e-ascImage e-icon"},{id:"descOrder",text:r._getLocalizedLabels("SortZtoA"),parentId:null,spriteCssClass:"e-descImage e-icon"},{id:"clearSorting",text:r._getLocalizedLabels("ClearSorting"),parentId:null,spriteCssClass:"e-clrSort e-icon"},{id:"sep1",parentId:null,text:"",spriteCssClass:"e-seperator"},{id:"clearAllFilters",text:r._getLocalizedLabels("ClearFilterFrom"),parentId:null,spriteCssClass:"e-clrFilter e-icon"},{id:"labelFilterBtn",text:r._getLocalizedLabels("LabelFilters"),parentId:null},{id:"valueFilterBtn",text:r._getLocalizedLabels("ValueFilters"),parentId:null},{id:"labelClearFilter",parentId:"labelFilterBtn",text:r._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep2",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals_labelFilter",parentId:"labelFilterBtn",text:r._getLocalizedLabels("Equals"),spriteCssClass:"sprite"},{id:"notequals_labelFilter",parentId:"labelFilterBtn",text:r._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep3",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"beginswith",parentId:"labelFilterBtn",text:r._getLocalizedLabels("BeginsWith")+"...",spriteCssClass:"sprite"},{id:"notbeginswith",parentId:"labelFilterBtn",text:r._getLocalizedLabels("DoesNotBeginsWith")+"...",spriteCssClass:"sprite"},{id:"endswith",parentId:"labelFilterBtn",text:r._getLocalizedLabels("EndsWith")+"...",spriteCssClass:"sprite"},{id:"notendswith",parentId:"labelFilterBtn",text:r._getLocalizedLabels("DoesNotEndsWith")+"...",spriteCssClass:"sprite"},{id:"sep4",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"contains",parentId:"labelFilterBtn",text:r._getLocalizedLabels("Contains")+"...",spriteCssClass:"sprite"},{id:"notcontains",parentId:"labelFilterBtn",text:r._getLocalizedLabels("DoesNotContains")+"...",spriteCssClass:"sprite"},{id:"sep5",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan_labelFilter",parentId:"labelFilterBtn",text:r._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto_labelFilter",parentId:"labelFilterBtn",text:r._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan_labelFilter",parentId:"labelFilterBtn",text:r._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto_labelFilter",parentId:"labelFilterBtn",text:r._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"valueClearFilter",parentId:"valueFilterBtn",text:r._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep6",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals_valueFilter",parentId:"valueFilterBtn",text:r._getLocalizedLabels("Equals"),spriteCssClass:"equals"},{id:"notequals_valueFilter",parentId:"valueFilterBtn",text:r._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep7",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan_valueFilter",parentId:"valueFilterBtn",text:r._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto_valueFilter",parentId:"valueFilterBtn",text:r._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan_valueFilter",parentId:"valueFilterBtn",text:r._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto_valueFilter",parentId:"valueFilterBtn",text:r._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"sep8",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"between",parentId:"valueFilterBtn",text:r._getLocalizedLabels("Between")+"...",spriteCssClass:"sprite"},{id:"notbetween",parentId:"valueFilterBtn",text:r._getLocalizedLabels("NotBetween")+"...",spriteCssClass:"sprite"},{id:"topCount",parentId:"valueFilterBtn",text:r._getLocalizedLabels("Top10")+"...",spriteCssClass:"sprite"}],(m==t.Pivot.OperationalMode.ClientMode||m==t.Pivot.OperationalMode.ServerMode&&_==t.Pivot.AnalysisMode.Pivot)&&p.splice(p.length-1,2);else if("clearFilter"==i.action)p=t.buildTag("div.clearSorting",t.buildTag("span.e-clrSort","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label","clear sort")[0].outerHTML+t.buildTag("span.clearSortText","Clear Sorting",{padding:"5px 0px"})[0].outerHTML)[0].outerHTML+t.buildTag("div.separator",{padding:"5px 0px"})[0].outerHTML+t.buildTag("div.clearAllFilters",t.buildTag("span.e-clrFilter","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label"," clear filter")[0].outerHTML+t.buildTag("span.clearFltrText",'Clear Filter From"'+i.selectedLevel.text+'"',{padding:"5px 0px"})[0].outerHTML)[0].outerHTML;else if("sort"==i.action)p=t.buildTag("div#sortDiv.sortDiv",t.buildTag("li#ascOrder.e-ascOrder",t.buildTag("span.e-ascImage").addClass("e-icon").attr("aria-label","ascending")[0].outerHTML+r._getLocalizedLabels("Sort")+" A to Z")[0].outerHTML+t.buildTag("li#descOrder.e-descOrder",t.buildTag("span.e-descImage").addClass("e-icon").attr("aria-label","descending")[0].outerHTML+r._getLocalizedLabels("Sort")+" Z to A")[0].outerHTML)[0].outerHTML;else if("labelFilterDlg"==i.action||"valueFilterDlg"==i.action){if(l="",n=[],"labelFilterDlg"==i.action)l=t.buildTag("table.labelfilter",t.buildTag("tr",t.buildTag("td",r._getLocalizedLabels("LabelFilterLabel")).attr("colspan","2")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'  style='width:220px'/>")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1'  value='"+(i.filterInfo.length>0?m==t.Pivot.OperationalMode.ClientMode?i.filterInfo[0].values[0]:i.filterInfo[0].value1:"")+"' style='display:inline; width:160px; height:19px; margin-left:7px;' class='e-filterValues'/></br>")[0].outerHTML)[0].outerHTML)[0].outerHTML,n=[{value:"equals",option:r._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:r._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"begins with",option:r._getLocalizedLabels("BeginsWith").toLowerCase()},{value:"not begins with",option:r._getLocalizedLabels("DoesNotBeginsWith").toLowerCase()},{value:"ends with",option:r._getLocalizedLabels("EndsWith").toLowerCase()},{value:"not ends with",option:r._getLocalizedLabels("DoesNotEndsWith").toLowerCase()},{value:"contains",option:r._getLocalizedLabels("Contains").toLowerCase()},{value:"not contains",option:r._getLocalizedLabels("DoesNotContains").toLowerCase()},{value:"greater than",option:r._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:r._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:r._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:r._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()}];else{if(s=[],a="between"==e(i.selectedArgs.element).attr("id")||"notbetween"==e(i.selectedArgs.element).attr("id")||"between"==i.selectedArgs.value||"not between"==i.selectedArgs.value?"4":"3",r.element.find(".e-cubeTreeView ").length>0)s=e.map(r.element.find(".e-cubeTreeView [data-tag*='[Measures]'] "),function(t){return{option:e(t).text(),value:e(t).attr("data-tag")}});else for(d=r.element.hasClass("e-pivotschemadesigner")?r.element.find(".e-schemaValue .e-pivotButton"):r.element.find(".groupingBarPivot .values .e-pivotButton"),d=r._schemaData&&0==d.length?e(r._schemaData.element.find(".e-schemaValue .e-pivotButton")):d,h=0;h<d.length;h++)s.push({option:e(d[h]).text(),value:e(d[h]).attr("data-tag").split(":")[1]});o=e(i.selectedArgs.element).hasClass("topCount")?t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions' />").attr("width","80px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterValue1' class='e-filterValues' />").attr("width","50px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML:t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'/>").attr("width","180px")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1' value='"+(i.filterInfo.length>0?m==t.Pivot.OperationalMode.ClientMode?i.filterInfo[0].values[0]:i.filterInfo[0].value1:"")+"' style='display:inline; width:190px; height:19px;' class='e-filterValues'/>"+("4"==a?"<span>"+r._getLocalizedLabels("and")+" </span><input type='text' id='filterValue2' value='"+(i.filterInfo.length>0?m!=t.Pivot.OperationalMode.ClientMode||t.isNullOrUndefined(i.filterInfo[0].values[1])?m!=t.Pivot.OperationalMode.ServerMode||t.isNullOrUndefined(i.filterInfo[0].value2)?"":i.filterInfo[0].value2:i.filterInfo[0].values[1]:"")+"' style='display:inline; width:190px; height:19px;' class='e-filterValues'/> </br>":"</br>"))[0].outerHTML,l=t.buildTag("table.valuefilter",t.buildTag("tr",t.buildTag("td",r._getLocalizedLabels("ValueFilterLabel")).attr("colspan","Between"==i.text?"4":"3")[0].outerHTML)[0].outerHTML+t.buildTag("tr",o)[0].outerHTML)[0].outerHTML,n=[{value:"equals",option:r._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:r._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"greater than",option:r._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:r._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:r._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:r._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()},{value:"between",option:r._getLocalizedLabels("Between").toLowerCase()},{value:"not between",option:r._getLocalizedLabels("NotBetween").toLowerCase()}]}c=t.buildTag("div",t.buildTag("button#filterDlgOKBtn.e-dialogOKBtn",r._getLocalizedLabels("OK")).attr("title",r._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML+t.buildTag("button#filterDlgCancelBtn.e-dialogCancelBtn",r._getLocalizedLabels("Cancel")).attr("title",r._getLocalizedLabels("Cancel").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,{float:r.model.enableRTL?"left":"right",margin:"8px 0 6px"})[0].outerHTML,r.element.find(".e-dialog").remove(),e(t.buildTag("div#filterDialog.filterDialog",l+c,{opacity:"1"})).appendTo("#"+r._id),r.element.find(".filterDialog").ejDialog({enableRTL:r.model.enableRTL,enableResize:!1,cssClass:"e-labelValueFilterDlg",width:"auto",content:"#"+r._id,close:t.proxy(t.Pivot.closePreventPanel,r)}),"valueFilterDlg"==i.action&&(r.element.find(".filterMeasures").ejDropDownList({dataSource:s,width:"180px",height:"25px",fields:{text:"option",value:"value"},create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),r._measureDDL=r.element.find(".filterMeasures").data("ejDropDownList"),""!=(u=i.filterInfo.length>0&&!t.isNullOrUndefined(i.filterInfo[0].measure)?i.filterInfo[0].measure:s.length>0?s[0].value:"")&&r._measureDDL.selectItemByValue(u)),"topCount"==e(i.selectedArgs.element).attr("id")?(r.element.find("#filterOptions").ejDropDownList({dataSource:[{option:"Top",value:"topCount"},{option:"Bottom",value:"BottomCount"}],fields:{text:"option",value:"value"},value:i.filterInfo.length>0?i.filterInfo[0].operator:"topCount",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),r.element.find("#filterValue1").ejNumericTextbox({value:i.filterInfo.length>0?parseInt(i.filterInfo[0].value1):5,minValue:1})):(g=e(i.selectedArgs.element).parent().children('li:not([id^="sep"])').index(i.selectedArgs.element),r.element.find(".filterOptions").ejDropDownList({dataSource:n,width:"180px",height:"25px",fields:{value:"value",text:"option"},selectedIndices:[g-1],change:t.proxy(r._filterOptionChanged,r),create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),0==e(i.selectedArgs.element).length&&r.element.find(".filterOptions").data("ejDropDownList").selectItemByValue(i.selectedArgs.selectedValue)),r.element.find("#filterDlgOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(r._filterElementOkBtnClick,r)}),r.element.find("#filterDlgCancelBtn").ejButton({type:t.ButtonType.Button,click:function(){e(".e-dialog").hide(),t.Pivot.closePreventPanel(r)}}),r.element.find(".e-titlebar").prepend(t.buildTag("div",("valueFilterDlg"==i.action?r._getLocalizedLabels("ValueFilters")+"(":r._getLocalizedLabels("LabelFilters")+"(")+(-1==r._selectedLevelUniqueName.indexOf(".")?r._selectedLevelUniqueName:r._selectedLevelUniqueName.indexOf(".")<0?r._selectedLevelUniqueName:r._selectedLevelUniqueName.split(".")[2].replace(/\[/g,"").replace(/\]/g,""))+")",{display:"inline"}))}return p}},t.Pivot.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"},t.Pivot.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"},t.Pivot.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.Pivot.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.Pivot.AnalysisMode={Olap:"olap",Pivot:"pivot"},t.Pivot.OperationalMode={ClientMode:"clientmode",ServerMode:"servermode"}}(jQuery,Syncfusion)})},1011:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
*  filename: ej.pivotanalysis.base.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.pivotanalysis.base.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(4)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=e)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(function(){!function($,ej,undefined){ej.PivotAnalysis={_initProperties:function(){this._colkeyvalues=[],this._rowKeyValues=[],this._colKeysCalcValues=[],this._rowKeysCalcValues=[],this._tableKeysCalcValues=[],this._gridMatrix=null,this._rowTotCalc=[],this._colTotCalc=[],this._transposeEngine=[],this._tRowCnt=0,this._tColCnt=0,this._cellType="",this._valueFilterArray=ej.isNullOrUndefined(this._valueFilterArray)?[]:this._valueFilterArray,this._currentFilterVal={},this._fieldMembers={},this._summaryTypes=[],this._editCellsInfo=[],this._locale="en-US",this._valueSorting=ej.isNullOrUndefined(this._valueSorting)?null:this._valueSorting,this._sort=ej.isNullOrUndefined(this._sort)?null:this._sort,this._isPaging=!1,this._colHdrLen=1,this._rowHdrLen=1,this._rowMembers={},this._colMembers={},this._calcMembers={}},setFieldCaptions:function(e){$.each(e.rows,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)}),$.each(e.columns,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)}),$.each(e.filters,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)}),$.each(e.values,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)})},getTreeViewData:function(e){var t,i,r,l,n,s,o=[],a=[];if(null!=e.data)for(r=0;r<e.data.length;r++)jQuery.each(e.data[r],function(e){-1==jQuery.inArray(e,o)&&o.push(e)});for(jQuery.each(e.values,function(e,t){1==t.isCalculatedField&&-1==jQuery.inArray(t.fieldName,o)&&o.push(t.fieldName)}),t=[e.rows,e.columns,e.filters,e.values],i=[].concat.apply([],t),r=0;r<o.length;r++){for(l=0;l<i.length;l++)(o[r].caption==undefined||""==o[r].caption)&&i[l].fieldName==o[r]&&(o[r]={name:i[l].fieldName,caption:i[l].fieldCaption,format:i[l].format,formatString:i[l].formatString,showSubTotal:!!ej.isNullOrUndefined(i[l].showSubTotal)||i[l].showSubTotal});(o[r].caption==undefined||""==o[r].caption)&&(o[r]={name:o[r].name||o[r],caption:o[r].name||o[r]})}for(n=0;n<o.length;n++)s=$.grep(e.rows,function(e){return e.fieldName==o[n].name}).length>0||$.grep(e.columns,function(e){return e.fieldName==o[n].name}).length>0||$.grep(e.values,function(e){return e.fieldName==o[n].name}).length>0||$.grep(e.filters,function(e){return e.fieldName==o[n].name}).length>0,a.push({id:o[n].name,name:o[n].name,caption:o[n].caption,format:o[n].format,formatString:o[n].formatString,showSubTotal:!!ej.isNullOrUndefined(o[n].showSubTotal)||o[n].showSubTotal,isSelected:s,spriteCssClass:""});return a},pivotEnginePopulate:function(model){var dataSource=model.dataSource,currentObj=this,isLiteral=!1,rowFilters,lit,formatSt,uV,fields,vC,list,cnt,nC,outputString,rC,cC,isFiltered,cCnt,rCnt,temp,value,val,j,k,formula,oldValue,newValue,i;this._initProperties(),model.dataSource.enableAdvancedFilter&&0==this._valueFilterArray.length&&(this._valueFilterArray=$.grep(dataSource.columns,function(e){if(e.advancedFilter&&e.advancedFilter.length>0&&e.advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter)return e.advancedFilter}),rowFilters=$.grep(dataSource.rows,function(e){if(e.advancedFilter&&e.advancedFilter.length>0&&e.advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter)return e.advancedFilter}),rowFilters.length>0&&$.merge(this._valueFilterArray,rowFilters)),this._locale=model.locale;var colAxis=dataSource.columns,rowAxis=dataSource.rows,filters=dataSource.filters,calcValues=dataSource.values,colLen,jsonObj=[],pivotFieldList=[],rowLen;for(lit=0;dataSource.values.length>lit;lit++)if(formatSt="",dataSource.values[lit].format&&(formatSt=dataSource.values[lit].format.toLowerCase()),"string"==formatSt||"text"==formatSt||"literal"==formatSt){isLiteral=!0;break}if(this._editCellsInfo=[],!ej.isNullOrUndefined(model.editCellsInfo)){var rowHeaders=model.editCellsInfo.rowHeader,colHeaders=model.editCellsInfo.columnHeader,values=model.editCellsInfo.JSONRecords;if(!ej.isNullOrUndefined(values)){for(uV=0;uV<values.length;uV++)fields={},rowAxis.length>0&&(fields.row=rowHeaders[uV].toString().split("#").splice(0,rowAxis.length).join(">#>")),colAxis.length>0&&(fields.column=colHeaders[uV].toString().split("#").splice(0,colAxis.length).join(">#>")),fields.value=colHeaders[uV].toString().split("#")[colHeaders[uV].toString().split("#").length-1]+"#"+values[uV].Value,this._editCellsInfo.push(fields);for(vC=0;vC<calcValues.length;vC++)$.each(this._editCellsInfo,function(e,t){calcValues[vC].fieldName==t.value.split("#")[0]&&(ej.PivotAnalysis._editCellsInfo[e].value=vC+"#"+t.value.split("#")[1])})}}for(i=0;i<calcValues.length;i++)this._summaryTypes.push(null!=calcValues[i].summaryType&&calcValues[i].summaryType!=undefined?calcValues[i].summaryType:ej.PivotAnalysis.SummaryType.Sum);if(null!=dataSource.data)for(cnt=0;cnt<dataSource.data.length;cnt++){list=jQuery.extend(!0,{},dataSource.data[cnt]);var table={keys:[],uniqueName:"",value:null},row={keys:[],uniqueName:"",value:null},col={keys:[],uniqueName:"",value:null},values={keys:[],uniqueName:"",value:null},isExcluded=!1;for(i=0;i<filters.length;i++)if(val=this._getReflectedValue(list,filters[i].fieldName,null,null),this._fieldMembers[filters[i].fieldName]==undefined||null==this._fieldMembers[filters[i].fieldName]?this._fieldMembers[filters[i].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[filters[i].fieldName])&&this._fieldMembers[filters[i].fieldName].push(val),null!=filters[i].filterItems&&filters[i].filterItems!=undefined&&((filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||null==filters[i].filterItems.filterType)&&$.inArray(val,filters[i].filterItems.values)>=0||filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val,filters[i].filterItems.values)<0)){isExcluded=!0;break}for(nC=0;nC<calcValues.length;nC++)val="",calcValues[nC]!=undefined&&null!=calcValues[nC]&&(list[calcValues[nC].fieldName]=model.dataSource.isFormattedValues?this._getNumber($(list).prop(calcValues[nC].fieldName),calcValues[nC].formatString):list[calcValues[nC].fieldName],val=this._getReflectedValue(list,calcValues[nC].fieldName,calcValues[nC].format,calcValues[nC].formatString),this._fieldMembers[calcValues[nC].fieldName]==undefined||null==this._fieldMembers[calcValues[nC].fieldName]?this._fieldMembers[calcValues[nC].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[calcValues[nC].fieldName])&&this._fieldMembers[calcValues[nC].fieldName].push(val)),outputString=null!=val?val.toString().replace(/([AMPME~!@#$%^&*()_+=`{}\[\]\|\\:;'<>,-.\/? ])+/g,""):"0",outputString=outputString.replace(ej.globalize.preferredCulture(this._locale).numberFormat.currency.symbol,""),$.isNumeric(outputString)||"date"==calcValues[nC].format?values.keys.push(null!=val?val:null):(values.keys.push(1),isLiteral&&(""==values.uniqueName&&(values.uniqueName=[]),ej.isNullOrUndefined(calcValues[nC].format)||"string"!=calcValues[nC].format.toLowerCase()&&"literal"!=calcValues[nC].format.toLowerCase()&&"text"!=calcValues[nC].format.toLowerCase()?values.uniqueName.push(" "):values.uniqueName.push(val)));for(rC=0;rC<rowAxis.length;rC++){if(val="",rowAxis[rC]!=undefined&&null!=rowAxis[rC])if(val=this._getReflectedValue(list,rowAxis[rC].fieldName,ej.isNullOrUndefined(rowAxis[rC].format)?null:rowAxis[rC].format,ej.isNullOrUndefined(rowAxis[rC].format)||ej.isNullOrUndefined(rowAxis[rC].formatString)?null:rowAxis[rC].formatString),this._fieldMembers[rowAxis[rC].fieldName]==undefined||null==this._fieldMembers[rowAxis[rC].fieldName]?this._fieldMembers[rowAxis[rC].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[rowAxis[rC].fieldName])&&this._fieldMembers[rowAxis[rC].fieldName].push(val),dataSource.enableAdvancedFilter&&!ej.isNullOrUndefined(rowAxis[rC].advancedFilter)&&rowAxis[rC].advancedFilter.length&&rowAxis[rC].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.LabelFilter){if(isFiltered=this._applyLabelFilter(rowAxis[rC].advancedFilter,val),isFiltered){isExcluded=!0;break}}else if(null!=rowAxis[rC].filterItems&&rowAxis[rC].filterItems!=undefined&&((rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||null==rowAxis[rC].filterItems.filterType)&&$.inArray(val,rowAxis[rC].filterItems.values)>=0||rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val,rowAxis[rC].filterItems.values)<0)){isExcluded=!0;break}null!=val&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)"),row.keys.push(val),row.uniqueName+=""==row.uniqueName?val:">#>"+val,table.keys.push(val),table.uniqueName+=""==table.uniqueName?val:">#>"+val}for(cC=0;cC<colAxis.length;cC++){if(val="",colAxis[cC]!=undefined&&null!=colAxis[cC])if(val=this._getReflectedValue(list,colAxis[cC].fieldName,ej.isNullOrUndefined(colAxis[cC].format)?null:colAxis[cC].format,ej.isNullOrUndefined(colAxis[cC].format)||ej.isNullOrUndefined(colAxis[cC].formatString)?null:colAxis[cC].formatString),this._fieldMembers[colAxis[cC].fieldName]==undefined||null==this._fieldMembers[colAxis[cC].fieldName]?this._fieldMembers[colAxis[cC].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[colAxis[cC].fieldName])&&this._fieldMembers[colAxis[cC].fieldName].push(val),dataSource.enableAdvancedFilter&&!ej.isNullOrUndefined(colAxis[cC].advancedFilter)&&colAxis[cC].advancedFilter.length&&colAxis[cC].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.LabelFilter){if(isFiltered=this._applyLabelFilter(colAxis[cC].advancedFilter,val),isFiltered){isExcluded=!0;break}}else if(null!=colAxis[cC].filterItems&&colAxis[cC].filterItems!=undefined&&((colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||null==colAxis[cC].filterItems.filterType)&&$.inArray(val,colAxis[cC].filterItems.values)>=0||colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val,colAxis[cC].filterItems.values)<0)){isExcluded=!0;break}null!=val&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)"),col.keys.push(val),col.uniqueName+=""==col.uniqueName?val:">#>"+val,table.keys.push(val),table.uniqueName+=""==table.uniqueName?val:">#>"+val}if(!isExcluded)if(this._isMemberExist("row",row,$.extend(!0,{},values),dataSource),this._isMemberExist("column",col,$.extend(!0,{},values),dataSource),!model.enablePaging&&!model.enableVirtualScrolling||0==row.keys.length&&0==col.keys.length)this._isMemberExist("calc",table,$.extend(!0,{},values),dataSource);else if(row.keys.length>0&&col.keys.length>0)for(rCnt=0;rCnt<row.keys.length;rCnt++)for(cCnt=0;cCnt<col.keys.length;cCnt++)row.keys.length==rCnt+1&&col.keys.length==cCnt+1?this._isMemberExist("calc",{keys:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)),uniqueName:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)).join(">#>"),value:null},$.extend(!0,{},values),dataSource):this._isMemberExist("calc",{cellType:"SubTot",keys:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)),uniqueName:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)).join(">#>"),value:null},$.extend(!0,{},values),dataSource);else if(0==row.keys.length)for(cCnt=0;cCnt<col.keys.length;cCnt++)col.keys.length==cCnt+1?this._isMemberExist("calc",{keys:col.keys.slice(0,cCnt+1),uniqueName:col.keys.slice(0,cCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource):this._isMemberExist("calc",{cellType:"SubTot",keys:col.keys.slice(0,cCnt+1),uniqueName:col.keys.slice(0,cCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource);else for(rCnt=0;rCnt<row.keys.length;rCnt++)row.keys.length==rCnt+1?this._isMemberExist("calc",{keys:row.keys.slice(0,rCnt+1),uniqueName:row.keys.slice(0,rCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource):this._isMemberExist("calc",{cellType:"SubTot",keys:row.keys.slice(0,rCnt+1),uniqueName:row.keys.slice(0,rCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource)}for(i=0;i<calcValues.length;i++)if(temp=$.grep(calcValues,function(e){return 1==e.isCalculatedField}),calcValues[i].isCalculatedField&&temp.length!=calcValues.length)for(j=0;j<this._tableKeysCalcValues.length;j++){for(formula=calcValues[i].formula.replace(/\s/g,""),k=0;k<calcValues.length;k++)1!=calcValues[k].isCalculatedField&&(value=ej.globalize.parseFloat(null==this._tableKeysCalcValues[j].value.keys[k]?"0":"date"==calcValues[k].format?this._dateToInt(this._tableKeysCalcValues[j].value.keys[k].toString()).toString():"time"==calcValues[k].format?this._dateToInt(new Date("1900",this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[0],this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[1],this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[2].split(" ")[0]).toString()).toString():this._tableKeysCalcValues[j].value.keys[k].toString(),this._locale),formula=formula.replace(new RegExp(calcValues[k].fieldName,"g"),"percentage"==calcValues[k].format&&0!=value?value<0?"("+value/100+")":value:value<0?"("+value+")":value));formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",calcValues[i].format,calcValues[i].formatString):null==dataSource.values[i].format?0:"0",newValue=null==dataSource.values[i].format?0:"0",this._tableKeysCalcValues[j].value.keys[i]=this._getSummaryValue(oldValue,newValue,1,this._summaryTypes[i],dataSource.values[i].format,dataSource.values[i].formatString)}else if(calcValues[i].isCalculatedField)for(val={keys:[],uniqueName:"",value:null},j=0;j<this._tableKeysCalcValues.length;j++){for(k=0;k<calcValues.length&&calcValues[k].isCalculatedField;k++)formula=calcValues[k].formula.replace(/\s/g,""),formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",calcValues[k].format,calcValues[k].formatString):null==dataSource.values[k].format?0:"0",newValue=null==dataSource.values[k].format?0:"0",val.keys.push(this._getSummaryValue(oldValue,newValue,1,"sum",dataSource.values[k].format,dataSource.values[k].formatString));this._tableKeysCalcValues[j].value=val,val={keys:[],uniqueName:"",value:null}}if(rowAxis.length>0&&(this._rowKeysCalcValues=this._sortHeaders(this._rowKeysCalcValues,rowAxis,0)),colAxis.length>0&&(this._colKeysCalcValues=this._sortHeaders(this._colKeysCalcValues,colAxis,0)),this._colkeyvalues=$.extend([],this._colKeysCalcValues),this._rowKeyValues=$.extend([],this._rowKeysCalcValues),colAxis.length>0&&this._insertTotalHeader(colAxis,this._colKeysCalcValues),rowAxis.length>0)this._insertTotalHeader(rowAxis,this._rowKeysCalcValues);else if(calcValues.length>0)if(this._rowKeysCalcValues.length>0)this._rowKeysCalcValues[0].keys[0]="Grand Total";else{for(this._rowKeysCalcValues.push({keys:[""],value:{keys:[]}}),i=0;i<calcValues.length;i++)this._rowKeysCalcValues[0].value.keys.push();this._rowKeysCalcValues[0].keys[0]="Grand Total"}return this._fillEngine(model)},_fillEngine:function(e){var t,i,r,l,n,s,o,a,d;(e.enablePaging||e.enableVirtualScrolling)&&(this._isPaging=!0,this._colHdrLen=1,this._rowHdrLen=1,this._controlObj._colKeysCalcValues=$.extend(!0,[],this._colKeysCalcValues),this._controlObj._rowKeysCalcValues=$.extend(!0,[],this._rowKeysCalcValues),this._controlObj._tableKeysCalcValues=$.extend(!0,[],this._tableKeysCalcValues),this._cropHeaders(),this._applyPaging());var h=e.dataSource,c=[],u=h.columns,g=h.rows,p=(h.filters,h.values);for(this._tRowCnt=0,this._tColCnt=0,this._currentFilterVal=this._valueFilterArray.length>0?this._valueFilterArray[0]:{},this._calculateValues(h),r=0;r<this._valueFilterArray.length;r++)this._advancedFilterInfo.length>0&&(this,this._rowKeysCalcValues=this._filterKeyValues(this._rowKeyValues),this._colKeysCalcValues=this._filterKeyValues(this._colkeyvalues),this._gridMatrix=null,this._colkeyvalues=$.extend([],this._colKeysCalcValues),this._rowKeyValues=$.extend([],this._rowKeysCalcValues),u.length>0&&this._insertTotalHeader(u,this._colKeysCalcValues),g.length>0?this._insertTotalHeader(g,this._rowKeysCalcValues):p.length>0&&(this._rowKeysCalcValues[0].keys[0]="Grand Total"),this._tRowCnt=0,this._tColCnt=0,this._currentFilterVal=this._valueFilterArray.length!=r+1?this._valueFilterArray[r+1]:{},this._calculateValues(h));if(t=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType,this._colTotCalc=[],this._rowTotCalc=[],this._colKeysCalcValues=[],this._rowKeysCalcValues=[],this._tableKeysCalcValues=[],this._transposeEngineCreation(),!ej.isNullOrUndefined(e.valueSortSettings)&&!ej.isNullOrUndefined(e.valueSortSettings.sortOrder)&&"none"!=e.valueSortSettings.sortOrder&&e.dataSource.values.length>0&&(!ej.isNullOrUndefined(this._valueSorting)||!ej.isNullOrUndefined(e.valueSortSettings.headerText)&&""!=e.valueSortSettings.headerText))if(i=0,e.valueSortSettings.headerDelimiters=e.valueSortSettings.headerDelimiters==undefined?"##":e.valueSortSettings.headerDelimiters,ej.isNullOrUndefined(this._valueSorting)){for(r=0;r<this._transposeEngine.length;r++){for(l=0;l<e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters).length;l++)ej.isNullOrUndefined(this._transposeEngine[r][l])||this._transposeEngine[r][l].Value!=e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters)[l]||i++;if(i==e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters).length){this._valueSorting=r;break}i=0}this._sort=ej.isNullOrUndefined(e.valueSortSettings)||ej.isNullOrUndefined(e.valueSortSettings.sortOrder)?this._sort:e.valueSortSettings.sortOrder,e.dataSource.columns.length+1!=e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters).length||ej.isNullOrUndefined(this._valueSorting)||this._applyValueSorting(e)}else this._applyValueSorting(e);for(n=0;n<this._tColCnt-1;n++){if(n<(s=0==g.length?1:this._isPaging?this._rowHdrLen:g.length))for(0==(o=(t?1:this._isPaging?this._colHdrLen:u.length)+(h.values.length>0?1:0))&&s>0&&(o=1),a=0;a<o;a++)this._gridMatrix.length>0&&c.push({Index:n+","+a,CSS:"none",Value:"",State:0,ColSpan:0==n&&0==a?s:1,RowSpan:0==n&&0==a?(t?1:this._isPaging?this._colHdrLen:u.length)+(h.values.length>0?1:0):1,Info:"",Span:"None",Expander:0});for(d=0;d<this._tRowCnt-1;d++)this._transposeEngine[n]==undefined||this._transposeEngine[n][d]==undefined||d<(t?1:this._isPaging?this._colHdrLen:u.length)+(h.values.length>0?1:0)&&n<s||c.push(this._transposeEngine[n][d])}return this._gridMatrix=[],h.rows[0]==undefined&&(h.rows.length=0),{json:c,pivotEngine:this._transposeEngine}},_cropHeaders:function(){var e,t,i,r,l=this._controlObj._drillHeaders.row,n=this._controlObj._drillHeaders.column,s=[],o=2,a=this._controlObj.model.enableCollapseByDefault,d=this._controlObj.model.dataSource.rows.length,h=this._controlObj.model.dataSource.columns.length;do{if(t=2==o?$.extend(!0,[],this._rowKeysCalcValues):$.extend(!0,[],this._colKeysCalcValues),a||(2==o?l.length>0:n.length>0)){for(i=0,e="",r=t.length-1;r>=0;r--)if(!ej.isNullOrUndefined(t[r])){ej.isNullOrUndefined(t[r].cellType)||ej.isNullOrUndefined(t[r].uniqueName)||(-1==t[r].uniqueName.indexOf(">#>")?t[r].uniqueName==e:-1!=t[r].uniqueName.indexOf(e))||(e="",i=t[r].level),a&&0==t[r].level&&""==e&&(i=0),(a?t[r].level!=i:""!=e)||ej.isNullOrUndefined(t[r].cellType)||ej.isNullOrUndefined(t[r].uniqueName)||!(2==o?l.indexOf(t[r].uniqueName)>-1:n.indexOf(t[r].uniqueName)>-1)||(e=t[r].uniqueName,i++);var c=e==t[r].uniqueName,u="RGTot"==t[r].cellType,g=t[r].level==i;(a?c||u||g||(2==o?i>d-2:i>h-2):""==e||ej.isNullOrUndefined(t[r].uniqueName)||c)&&((a?g:c)&&!ej.isNullOrUndefined(t[r].keys)&&t[r].keys.length>0&&!u&&""!=t[r].uniqueName&&(t[r].keys[t[r].keys.length-1]=t[r].keys[t[r].keys.length-1].replace(" Total","").replace("%####%",""),t[r].expander=2),s.push(t[r]))}2==o?this._rowKeysCalcValues=$.extend(!0,[],s.reverse()):this._colKeysCalcValues=$.extend(!0,[],s.reverse())}s=[],o--}while(o>0)},_applyPaging:function(){var e,t=[];this._controlObj._seriesPageCount=this._controlObj.model.enablePaging?this._rowKeysCalcValues.length:Math.ceil(this._rowKeysCalcValues.length/this._controlObj.model.dataSource.pagerOptions.seriesPageSize),this._controlObj._categPageCount=this._controlObj.model.enablePaging?this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1):Math.ceil(this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)/this._controlObj.model.dataSource.pagerOptions.categoricalPageSize),this._controlObj._categPageCount=0==this._controlObj._categPageCount?1:this._controlObj._categPageCount,this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage=this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage*this._controlObj.model.dataSource.pagerOptions.seriesPageSize>this._rowKeysCalcValues.length?Math.ceil(this._rowKeysCalcValues.length/this._controlObj.model.dataSource.pagerOptions.seriesPageSize):this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage,this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage=this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize>this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)?Math.ceil(this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)/this._controlObj.model.dataSource.pagerOptions.categoricalPageSize):this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage,this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage=0==this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage?1:this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage,this._controlObj._seriesCurrentPage=this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage,this._controlObj._categCurrentPage=this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage;var i=this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage*this._controlObj.model.dataSource.pagerOptions.seriesPageSize-this._controlObj.model.dataSource.pagerOptions.seriesPageSize,r=Math.ceil((this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize-this._controlObj.model.dataSource.pagerOptions.categoricalPageSize)/(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)),l=i+this._controlObj.model.dataSource.pagerOptions.seriesPageSize,n=Math.ceil(this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize/(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1));r=(this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage-1)*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize%this._controlObj.model.dataSource.values.length>0?r-1:r;for(e=i;e<l;e++)t.push(this._rowKeysCalcValues[e]);for(t=this._spanCalculation(t),this._rowKeysCalcValues=$.extend(!0,[],t),t=[],e=r;e<n;e++)t.push(this._colKeysCalcValues[e]);t=this._spanCalculation(t),this._colKeysCalcValues=$.extend(!0,[],t)},_spanCalculation:function(e){for(var t,i,r,l,n=0;n<e.length;n++)if(e.length>0&&!ej.isNullOrUndefined(e[n])&&!ej.isNullOrUndefined(e[n].uniqueName)){for(t=e[n].uniqueName.split(">#>"),[],e[n].keys[e[n].level]=e[n].keys[0],e[n].span=ej.isNullOrUndefined(e[n].span)?[]:e[n].span,i=ej.isNullOrUndefined(e[n].level)?e[n].span.length>0?e[n].span.length-2:e[n].keys.length-2:e[n].level-1;i>=0;i--){r=n+1,e[n].keys[i]=t[i],e[n].span[i]=1;do{if(!(!ej.isNullOrUndefined(e[r])&&e[r].uniqueName.split(">#>").indexOf(t[i])>-1&&e[r].uniqueName.split(">#>").indexOf(t[i])<e[r].uniqueName.split(">#>").length-1))break;e[n].span[i]++,r++}while(r<e.length)}ej.isNullOrUndefined(e[n].span)||0!=e[n].span.length||delete e[n].span}return l=e.length,$.map(e,function(e,t){if(!ej.isNullOrUndefined(e)&&!ej.isNullOrUndefined(e.span))for(var i=0;i<e.span.length;i++)e.span[i]=e.span[i]>l-t?l-t:e.span[i];return e})},_applyValueSorting:function(e){for(var t,i,r,l,n,s,o,a,d,h,c=[],u=[],g=0,p=0,m="",_=0;_<this._transposeEngine.length;_++)for(c[g]=[],ej.isNullOrUndefined(u[p])&&(u[p]=[]),h=0;h<this._transposeEngine[_].length&&this._valueSorting==Number(this._transposeEngine[_][h].Index.split(",")[0]);h++)("colheader"==this._transposeEngine[_][h].CSS||"calc"==$.trim(this._transposeEngine[_][h].CSS)||"colheader calc"==this._transposeEngine[_][h].CSS||"summary cstot"==this._transposeEngine[_][h].CSS||"summary cstot calc"==this._transposeEngine[_][h].CSS||"summary cgtot"==this._transposeEngine[_][h].CSS||"summary cgtot calc"==this._transposeEngine[_][h].CSS)&&(m=""==m?this._transposeEngine[_][h].Value:m+e.valueSortSettings.headerDelimiters+this._transposeEngine[_][h].Value),"value"==this._transposeEngine[e.dataSource.rows.length][h].CSS&&(c[g].push(this._transposeEngine[_][h]),p=0),"summary value"==this._transposeEngine[e.dataSource.rows.length][h].CSS&&(u[p].push(this._transposeEngine[_][h]),c[g].length>0&&(c[g+=1]=[]),"summary rgtot"!=this._transposeEngine[0][h].CSS&&u[p].length>0&&p++,ej.isNullOrUndefined(u[p])&&(u[p]=[]));for(e.valueSortSettings.headerText=m,e.valueSortSettings.sortOrder=this._sort,g=0;g<c.length;g++)for(_=0;_<c[g].length;_++)for(h=_;h<c[g].length;h++)("descending"==this._sort?this._getNumber(c[g][_].Value)<this._getNumber(c[g][h].Value):this._getNumber(c[g][_].Value)>this._getNumber(c[g][h].Value))&&(r=c[g][h],c[g][h]=c[g][_],c[g][_]=r);for(g=0;g<c.length;g++)0==c[g].length&&c.splice(g,1);for(t=[],_=0;_<this._tRowCnt-1;_++)t[_]={index:0,level:-1};var f=0,b=[],C=[];for(g=u.length-2;g>=0;g--){for(i=0,h=0;h<u[g].length;h++)for(_=h;_<u[g].length;_++)("descending"==this._sort?this._getNumber(u[g][h].Value)<this._getNumber(u[g][_].Value):this._getNumber(u[g][h].Value)>this._getNumber(u[g][_].Value))&&(r=u[g][_],u[g][_]=u[g][h],u[g][h]=r);if(0==f)for(h=0;h<u[g].length;h++)t[i=0==i?this._transposeEngine[f][Number(u[g][h].Index.split(",")[1])].MCnt+e.dataSource.columns.length+1:this._transposeEngine[f][Number(u[g][h].Index.split(",")[1])].MCnt+i+1]={index:Number(u[g][h].Index.split(",")[1]),level:f},b[h]==undefined&&(b[h]={}),b[h].end=Number(u[g][h].Index.split(",")[1]),b[h].start=Number(u[g][h].Index.split(",")[1])-this._transposeEngine[f][Number(u[g][h].Index.split(",")[1])].MCnt;else{for(l=[],n=0,a=0;a<b.length;a++){for(l=[],h=0;h<u[g].length;h++)Number(u[g][h].Index.split(",")[1])>b[a].start&&Number(u[g][h].Index.split(",")[1])<b[a].end&&l.push(u[g][h]);for(h=0;h<l.length;h++)t[i=0==i?this._transposeEngine[f][Number(l[h].Index.split(",")[1])].MCnt+e.dataSource.columns.length+1:this._transposeEngine[f][Number(l[h].Index.split(",")[1])].MCnt+i+1]={index:Number(l[h].Index.split(",")[1]),level:f},C[n]==undefined&&(C[n]={}),C[n].end=Number(l[h].Index.split(",")[1]),C[n].start=Number(l[h].Index.split(",")[1])-this._transposeEngine[f][Number(l[h].Index.split(",")[1])].MCnt,n++;for(;i<this._tRowCnt-2&&t[i].level>t[i+1].level;)i++;i--}b=jQuery.extend(!0,[],C)}f++}if(1==u.length&&u[0].length>0)for(s=e.dataSource.columns.length+1,_=0;_<c[0].length;_++)t[s]={index:Number(c[0][_].Index.split(",")[1])},s++;for(o=e.dataSource.columns.length+1,a=0;a<b.length;a++)for(g=0;g<c.length;g++)if(Number(c[g][0].Index.split(",")[1])>=b[a].start&&Number(c[g][0].Index.split(",")[1])<=b[a].end){for(h=0,_=b[a].start;_<b[a].end;_++)t[o]={index:Number(c[g][h].Index.split(",")[1])},h++,o++;for(o++;0!=t[o].index&&o<=t.length;)o++}for(d=[],_=0;_<e.dataSource.columns.length+1;_++)t[_]={index:_};for(_=0;_<t.length-1;_++)d.push(this._gridMatrix[t[_].index]);for(d.push(this._gridMatrix[_]),_=0;_<this._gridMatrix.length&&this._gridMatrix[_]!=undefined&&d[_]!=undefined;_++)for(h=0;h<this._gridMatrix[_].length&&this._gridMatrix[_][h]!=undefined;h++)this._gridMatrix[_][h]!=undefined&&d[_][h]!=undefined&&(d[_][h].Index=this._gridMatrix[_][h].Index);for(h=0;h<e.dataSource.rows.length-1;h++){var S=e.dataSource.columns.length+1,x=0,v=(g=0,!1);for(_=e.dataSource.columns.length+(e.dataSource.values.length>0?1:0);_<d.length;_++)if(d[_]!=undefined&&d[_][h]!=undefined&&"rowheader"==d[_][h].CSS&&d[_][h].RowSpan!=undefined&&(v=!0,x=x>d[_][h].RowSpan?x:d[_][h].RowSpan),d[_]!=undefined&&d[_][h]!=undefined&&"summary rstot"==d[_][h].CSS&&v&&!ej.isNullOrUndefined(d[S])){for(v=!1;d[S]==undefined||d[S][h]==undefined;)S++;d[S][h].RowSpan=x,x=0,0,S=_+1,g++}}this._gridMatrix=d,this._transposeEngineCreation()},_transposeEngineCreation:function(){var e,t,i;for(this._tColCnt=this._isPaging&&this._gridMatrix.length>0?!ej.isNullOrUndefined(this._gridMatrix[0])&&this._gridMatrix[0].length>0?this._gridMatrix[0].length+1:this._gridMatrix[this._gridMatrix.length-1].length+1:this._tColCnt,e=0;e<this._tRowCnt-1;e++)for(t=0;t<this._tColCnt-1;t++)this._transposeEngine[t]==undefined&&(this._transposeEngine[t]=[]),this._gridMatrix[e]!=undefined&&this._gridMatrix[e][t]!=undefined?(i="string"==typeof this._gridMatrix[e][t]||"number"==typeof this._gridMatrix[e][t]||"object"==typeof this._gridMatrix[e][t]?0==this._gridMatrix[e][t].Value?this._gridMatrix[e][t].Value:this._gridMatrix[e][t].Value==undefined?"":ej.isNullOrUndefined(this._gridMatrix[e][t].valueText)?this._gridMatrix[e][t].Value:this._gridMatrix[e][t].valueText:"",this._transposeEngine[t][e]={Index:t+","+e,CSS:this._gridMatrix[e][t].CSS,Value:"string"==typeof i&&i.indexOf("%####%")>-1?i.replace("%####%",""):i,State:this._gridMatrix[e][t].State,RowSpan:this._gridMatrix[e][t].RowSpan!=undefined?this._gridMatrix[e][t].RowSpan:1,ColSpan:this._gridMatrix[e][t].ColSpan!=undefined?this._gridMatrix[e][t].ColSpan:1,Info:this._gridMatrix[e][t].Info,Span:"None",Expander:this._gridMatrix[e][t].Expander,MCnt:this._gridMatrix[e][t].MCnt!=undefined?this._gridMatrix[e][t].MCnt:1}):this._gridMatrix[e]!=undefined&&(this._transposeEngine[t][e]={Index:t+","+e,CSS:"none",Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0})},_filterKeyValues:function(e){var t=this;return $.grep(e,function(e){for(var i=!1,r=0;r<(!ej.isNullOrUndefined(e.uniqueName)&&e.uniqueName.split(">#>").length)&&(i=$.inArray(e.uniqueName.split(">#>")[r],t._advancedFilterInfo)>-1||i,!(i=$.inArray(e.uniqueName,t._advancedFilterInfo)>-1||i));r++);if(!i)return e})},_getFilteredIndex:function(e,t,i,r){return $.map(t,function(t,l){if(e.length>0&&r[i].keys.length>0&&e[r[i].keys.length-1].advancedFilter&&e[r[i].keys.length-1].advancedFilter.length>0&&(e[r[i].keys.length-1].advancedFilter[0].measure==t.fieldName||e[r[i].keys.length-1].advancedFilter[0].name==t.fieldName))return l})[0]},_applyValueFilter:function(e,t){var i,r,l=!1;if(e.length>0&&!ej.isNullOrUndefined(t))switch(t=this._isNumber(t)?t:ej.parseFloat(t,this._locale),i=e[0].valueFilterOperator,r=e[0].values,i.toLowerCase()){case"equals":l=!(t==JSON.parse(e[0].values[0]));break;case"notequals":l=!(t!=JSON.parse(e[0].values[0]));break;case"greaterthan":l=!(t>JSON.parse(e[0].values[0]));break;case"greaterthanorequalto":l=!(t>=JSON.parse(e[0].values[0]));break;case"lessthan":l=!(t<JSON.parse(e[0].values[0]));break;case"lessthanorequalto":l=!(t<=JSON.parse(e[0].values[0]));break;case"between":l=!(t>JSON.parse(r[0])&&t<JSON.parse(r[1]));break;case"notbetween":l=!!(t>JSON.parse(r[0])&&t<JSON.parse(r[1]));break;default:l=!(t==JSON.parse(e[0].values[0]))}return l},_applyLabelFilter:function(e,t){if(e.length>0){var i=e[0].labelFilterOperator,r=e[0].values,l=!1;switch(t=ej.isNullOrUndefined(t)?"":t.toString(),i.toLowerCase()){case"equals":l=!(t.toLowerCase()==r[0].toLowerCase());break;case"notequals":l=t.toLowerCase()==r[0].toLowerCase();break;case"contains":l=!(t.toLowerCase().indexOf(r[0].toLowerCase())>-1);break;case"notcontains":l=t.toLowerCase().indexOf(r[0].toLowerCase())>-1;break;case"beginswith":l=!(0==t.toLowerCase().indexOf(r[0].toLowerCase()));break;case"notbeginswith":l=0==t.toLowerCase().indexOf(r[0].toLowerCase());break;case"endswith":l=ej.isNullOrUndefined(t.toLowerCase().match(r[0].toLowerCase()+"$"));break;case"notendswith":l=!ej.isNullOrUndefined(t.toLowerCase().match(r[0].toLowerCase()+"$"));break;case"greaterthan":l=!(t.toLowerCase()>r[0].toLowerCase());break;case"greaterthanorequalto":l=!(t.toLowerCase()>=r[0].toLowerCase());break;case"lessthan":l=!(t.toLowerCase()<r[0].toLowerCase());break;case"lessthanorequalto":l=!(t.toLowerCase()<=r[0].toLowerCase());break;case"between":l=!(t.toLowerCase()>r[0].toLowerCase()||t.toLowerCase()<r[1].toLowerCase());break;case"notbetween":l=!!(t.toLowerCase()>r[0].toLowerCase()||t.toLowerCase()<r[1].toLowerCase());break;default:l=!(t.toLowerCase().indexOf(r[0].toLowerCase())>-1)}return l}},getMembers:function(e,t){var i,r,l;if(ej.isNullOrUndefined(t))return ej.isNullOrUndefined(this._fieldMembers)?[]:ej.isNullOrUndefined(this._fieldMembers[e])?[]:this._fieldMembers[e];for(i={},r=0;r<t.length;r++)l=t[r],$.each(l,function(e,t){ej.isNullOrUndefined(i[e])?i[e]=[t]:i[e].indexOf(t)<0&&i[e].push(t)});return i[e]},_powerFunction:function(e){if(e.indexOf("^")>-1){for(var t=[];e.indexOf("(")>-1;)e=e.replace(/(\([^\(\)]*\))/g,function(e,i){return t.push(i),"~"+(t.length-1)});for(t.push(e),e="~"+(t.length-1);e.indexOf("~")>-1;)e=e.replace(new RegExp("~(\\d+)","g"),function(e,i){return t[i].replace(/(\w*)\^(\w*)/g,"Math.pow($1,$2)")})}return e},_calculatedFieldSummaryValue:function(index,calValue,dataSource){var formula,i,value,oldValue,newValue;if(1==dataSource.values[index].isCalculatedField){for(formula=dataSource.values[index].formula.replace(/\s/g,""),i=0;i<dataSource.values.length;i++)1!=dataSource.values[i].isCalculatedField&&(value=ej.globalize.parseFloat(null==calValue[i]?"0":"date"==dataSource.values[i].format?this._dateToInt(calValue[i].toString()).toString():"time"==dataSource.values[i].format?this._dateToInt(new Date("1900",calValue[i].toString().split(":")[0],calValue[i].toString().split(":")[1],calValue[i].toString().split(":")[2].split(" ")[0]).toString()).toString():calValue[i].toString(),this._locale),formula=formula.replace(new RegExp(dataSource.values[i].fieldName,"g"),"percentage"==dataSource.values[i].format&&0!=value?value<0?"("+value/100+")":value:value<0?"("+value+")":value));return formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",dataSource.values[index].format,dataSource.values[index].formatString):null==dataSource.values[index].format?0:"0",newValue=null==dataSource.values[index].format?0:"0",this._getSummaryValue(oldValue,newValue,1,"count"==this._summaryTypes[index]?"sum":this._summaryTypes[index],dataSource.values[index].format,dataSource.values[index].formatString)}},_sortHeaders:function(e,t,i){for(var r,l=[],n=[],s=0,o=t[i].sortOrder!=ej.PivotAnalysis.SortOrder.None?ej.isNullOrUndefined(t[i].format)?ej.DataManager(e).executeLocal(ej.Query().sortBy("keys."+i,null!=t[i].sortOrder&&t[i].sortOrder==ej.PivotAnalysis.SortOrder.Descending?ej.sortOrder.Descending:ej.sortOrder.Ascending,!1)):this._getSortedHeaders(e,t,i):e;s<o.length;)r=o[s].keys[i],(l=$.grep(o,function(e){return e.keys[i]==r})).length>1&&i+1<o[s].keys.length&&(l=this._sortHeaders(l,t,i+1)),n=n.concat(l),s+=l.length;return n},_getSortedHeaders:function(e,t,i){return t[i].sortOrder==ej.PivotAnalysis.SortOrder.Descending?e.sort(function(e,r){return ej.PivotAnalysis._formatToInt(r.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)-ej.PivotAnalysis._formatToInt(e.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)}):e.sort(function(e,r){return ej.PivotAnalysis._formatToInt(e.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)-ej.PivotAnalysis._formatToInt(r.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)})},_isValidTime:function(e){var t=e.indexOf(":")>-1?e.split(":"):[];return 3==t.length&&(t[3]=t[2].indexOf(" ")>-1?t[2].split(" ")[1]:"AM",t[2]=t[2].indexOf(" ")>-1?t[2].split(" ")[0]:t[2],!(!(Number(t[0])>-1&&Number(t[0])<13&&Number(t[1])>-1&&Number(t[1])<61&&jQuery.isNumeric(t[2]))||"AM"!=t[3]&&"PM"!=t[3]))},_getNumber:function(e,t){return ej.isNullOrUndefined(e)||(jQuery.isNumeric(e.toString().replace(/[,.]/g,""))?(e=e.toString().replace(/[,]/g,","==ej.preferredCulture(this._locale).numberFormat[","]?"":"~").replace(/[.]/g,"."==ej.preferredCulture(this._locale).numberFormat["."]?".":""),e=Number(e.toString().replace(/[~]/g,"."))):e=this._isValidTime(e)?this._formatToInt(e,"time",t):ej.isNullOrUndefined(ej.parseDate(e,t==undefined?"MM/dd/yyyy":t))?-1!=e.indexOf("/")&&2==e.split("/")?this._formatToInt(e,"fraction",undefined):$.trim(e).indexOf("%")==$.trim(e).length-1?Number(e.replace(/[^\d.-]/g,""))/100:/[a-zA-Z]/.test(e)?1:Number(e.replace(/[^\d.-]/g,"")):this._formatToInt(e,"date",t)),e},_setFormat:function(e,t,i){switch(t){case"percentage":var r=jQuery.isNumeric(e)?1:100;e="string"==typeof e?$.trim(e.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",",".").replace(ej.preferredCulture(this._locale).numberFormat.percent.symbol,"")):e,e=jQuery.isNumeric(e)?e:0,e=ej.widgetBase.formatting(i||"{0:P}",""==e?0:e/r,this._locale);break;case"decimal":case"number":e="string"==typeof e?e.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):e,e=jQuery.isNumeric(e)?e:0,e=ej.widgetBase.formatting(i||"{0:N}",e,this._locale);break;case"currency":e="string"==typeof e?$.trim(e.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",",".").replace(ej.preferredCulture(this._locale).numberFormat.currency.symbol,"")):e,e=jQuery.isNumeric(e)?e:0,e=ej.widgetBase.formatting(i||"{0:C2}",""==e?0:e,this._locale);break;case"date":jQuery.isNumeric(e)?(e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",e,this._locale))):"Invalid Date"!=new Date(e)?(e=new Date(e),e=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",e,this._locale)):(e=new Date(864e5*(Number(0)-2)+new Date("01/01/1900").getTime()),e=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",e,this._locale));break;case"scientific":e="string"==typeof e?e.split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):e,e=jQuery.isNumeric(e)?e:0,e=Number(e).toExponential(2).replace("e","E");break;case"accounting":e=this._toAccounting(e,i||"{0:C2}",this._locale);break;case"time":jQuery.isNumeric(e)?(e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale))):this._isValidTime(e)?e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale):(e=new Date(864e5*(Number(0)-2)+new Date("01/01/1900").getTime()),e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale));break;case"fraction":e="string"==typeof e?e.split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):e,e="numerator"in(e=jQuery.isNumeric(e)?this._toFraction(e):this._toFraction(0))?e.integer+" "+e.numerator+"/"+e.denominator:e.integer}return e},_getReflectedValue:function(e,t,i,r){var l=$(e).prop(t);return null==l?l:(jQuery.isNumeric(l)||"Invalid Date"!=new Date(l)||(i=r=null),this._setFormat(l,i,r))},_formatToInt:function(value,format,formatString){var time;switch(format){case"date":value=null!=ej.parseDate(value.toString(),formatString==undefined?"MM/dd/yyyy":formatString,this._locale)?this._dateToInt(ej.parseDate(value,formatString==undefined?"MM/dd/yyyy":formatString,this._locale)):value;break;case"percentage":value=0!=value?ej.globalize.parseFloat(value.toString(),this._locale)/100:Number(value);break;case"currency":case"accounting":value=0!=value?ej.globalize.parseFloat(ej.globalize.format(value.toString(),"c",this._locale),this._locale):Number(value);break;case"decimal":case"number":value=0!=value?ej.globalize.parseFloat(value.toString(),this._locale):Number(value);break;case"scientific":value=0!=value||0==value?parseFloat(value):Number(value);break;case"time":this._isNumber(value)||(time=value.toString().split(":"),time=new Date("1900",time[0],time[1],time[2].split(" ")[0]).toString(),value=this._dateToInt(time));break;case"fraction":var temp1=parseFloat(value.toString().split(" ")[0]),temp2=eval(value.toString().split(" ")[1])!=undefined?parseFloat(eval(value.toString().split(" ")[1])):parseFloat(0),value=0!=value?temp1+temp2:Number(value)}return value},_isDateTime:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())},_toAccounting:function(e,t,i){var r,l,n,s,o=ej.preferredCulture(i).numberFormat,a=o.currency.symbol;return val=ej.widgetBase.formatting(t,e,i),val=val.indexOf(" ")>-1?val.split(" ").join(""):val,n=val.replace(a,""),s=jQuery.isNumeric(n.toString().split(o[","]).join("").replace(",","."))?val.indexOf(a):0,n=jQuery.isNumeric(n.toString().split(",").join(""))?n:"0.00",!s||Number(n)<0&&1===s?(r=a,l=n):(r=n,l=a),r+"   "+l},_toFraction:function(e){if(this._isNumber(e)){var t=e.toString(),i=t.split(".")[0],r=t.split(".")[1];if(!r)return{integer:e};var l=(+r).toString(),n=this._getPlaceValue(r,l),s=this._getGCD(l,n);return{integer:i,numerator:Number(l)/s,denominator:Number(n)/s}}return null},_isNumber:function(e){return e-parseFloat(e)>=0},_getGCD:function(e,t){return e=Number(e),(t=Number(t))?this._getGCD(t,e%t):e},_getPlaceValue:function(e,t){var i=e.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_cellEdit:function(e,t,i,r){return $.each(this._editCellsInfo,function(l,n){if(e==(ej.isNullOrUndefined(n.row)&&ej.isNullOrUndefined(n.column)?"":ej.isNullOrUndefined(n.row)?n.column:ej.isNullOrUndefined(n.column)?n.row:n.row+">#>"+n.column)&&i==parseInt(n.value.split("#")[0]))return t=ej.PivotAnalysis._setFormat(ej.isNullOrUndefined(r.format)?jQuery.isNumeric(n.value.split("#")[1].toString().split(",").join(""))?parseFloat(n.value.split("#")[1].toString().split(",").join("")):0:n.value.split("#")[1],r.format,r.formatString),!1}),t},_isMemberExist:function(e,t,i,r){var l,n,s,o,a,d;switch(e){case"row":if(n=!1,(s=0==this._rowKeysCalcValues.length?0:this._rowMembers[t.uniqueName])>-1&&(n=!0,l=s),0==this._rowKeysCalcValues.length&&(this._rowKeysCalcValues.push(t),this._rowMembers[t.uniqueName]=this._rowKeysCalcValues.length-1),n)for(o=0;o<i.keys.length;o++){if(null==this._rowKeysCalcValues[l].value){this._rowKeysCalcValues[l].value=i;break}this._rowKeysCalcValues[l].value.keys[o]+=i.keys[o]}else this._rowKeysCalcValues.push(t),this._rowMembers[t.uniqueName]=this._rowKeysCalcValues.length-1;break;case"column":if(n=!1,(s=0==this._colKeysCalcValues.length?0:this._colMembers[t.uniqueName])>-1&&(n=!0,l=s),0==this._colKeysCalcValues.length&&(r.columns.length>0||r.values.length>0)&&(this._colKeysCalcValues.push(t),this._colMembers[t.uniqueName]=this._colKeysCalcValues.length-1),n)for(o=0;o<i.keys.length;o++){if(null==this._colKeysCalcValues[l].value){this._colKeysCalcValues[l].value=i;break}this._colKeysCalcValues[l].value.keys[o]+=i.keys[o]}else(r.columns.length>0||r.values.length>0)&&(this._colKeysCalcValues.push(t),this._colMembers[t.uniqueName]=this._colKeysCalcValues.length-1);break;case"calc":if(n=!1,(s=0==this._tableKeysCalcValues.length?0:this._calcMembers[t.uniqueName])>-1&&(n=!0,l=s),0==this._tableKeysCalcValues.length&&(this._tableKeysCalcValues.push(t),this._calcMembers[t.uniqueName]=this._tableKeysCalcValues.length-1),n)for(o=0;o<i.keys.length;o++){if(null==this._tableKeysCalcValues[l].value){for(this._tableKeysCalcValues[l].value=i,this._tableKeysCalcValues[l].value.count=1,d=0;d<i.keys.length;d++)this._summaryTypes[d]==ej.PivotAnalysis.SummaryType.Count&&(this._tableKeysCalcValues[l].value.keys[d]=this._tableKeysCalcValues[l].value.count);break}a=r.values[o],this._tableKeysCalcValues[l].value.uniqueName[o]==i.uniqueName[o]&&(ej.isNullOrUndefined(a.formatString)||"single-entry"!=a.formatString.toLowerCase())||(this._tableKeysCalcValues[l].value.uniqueName[o]=" "),0==o&&this._tableKeysCalcValues[l].value.count++,1!=r.values[o].isCalculatedField&&(this._tableKeysCalcValues[l].value.keys[o]=this._getSummaryValue(this._tableKeysCalcValues[l].value.keys[o],i.keys[o],this._tableKeysCalcValues[l].value.count,this._summaryTypes[o],r.values[o].format,r.values[o].formatString))}else for(this._tableKeysCalcValues.push(t),this._calcMembers[t.uniqueName]=this._tableKeysCalcValues.length-1,this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value=i,d=0;d<i.keys.length;d++)this._summaryTypes[d]==ej.PivotAnalysis.SummaryType.Count&&(this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value.keys[d]=1),this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value.count=1}},_getSummaryValue:function(e,t,i,r,l,n){if(t=ej.isNullOrUndefined(t)?null:0==t?0:t,e=ej.isNullOrUndefined(e)?null:0==e?0:e,!ej.isNullOrUndefined(t)&&!ej.isNullOrUndefined(e)){switch(e=this._formatToInt(e,l,n),t=this._formatToInt(t,l,n),r){case ej.PivotAnalysis.SummaryType.Sum:e+=t;break;case ej.PivotAnalysis.SummaryType.Average:e=(e*(i-1)+t)/i,Math.floor(e)!=e&&(e=Number(e.toFixed(2)));break;case ej.PivotAnalysis.SummaryType.Min:e=1==i?t:Math.min(e,t);break;case ej.PivotAnalysis.SummaryType.Max:e=1==i?t:Math.max(e,t);break;case ej.PivotAnalysis.SummaryType.Count:e=i}switch(l){case"percentage":e=ej.widgetBase.formatting(n||"{0:P}",e,this._locale);break;case"decimal":case"number":e=ej.widgetBase.formatting(n||"{0:N}",e,this._locale);break;case"date":e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:"+(n==undefined?"MM/dd/yyyy":n)+"}",e,this._locale));break;case"currency":e=ej.widgetBase.formatting(n||"{0:C2}",e,this._locale);break;case"scientific":e=e.toExponential(2).replace("e","E");break;case"accounting":e=this._toAccounting(e,n||"{0:C2}",this._locale);break;case"time":e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale));break;case"fraction":e="numerator"in(e=this._toFraction(e))?e.integer+" "+e.numerator+"/"+e.denominator:e.integer}}return e},_dateToInt:function(e){var t=new Date("01/01/1900");return((this._isDateTime(e)?e:new Date(e)).getTime()-t.getTime())/864e5+2},_insertTotalHeader:function(e,t){var i,r,l,n,s;if(e.length<=1)t.push({cellType:"RGTot",keys:["Grand Total"],tot:"sub"});else{for(i=-1,r=e.length-2;r>=0;r--)if(i++,(l=t.length)>0){n=t[0].uniqueName.split(">#>"),t[0].keys[i],n=n.slice(0,r+1).join(">#>");var o="",a=0,d="";for(s=1;s<=l;s++)t[s]!=undefined?(o=(o=t[s].uniqueName.split(">#>")).slice(0,r+1).join(">#>"),d=t[s].keys[r+1]):o=undefined,o!=undefined&&-1==o.indexOf("%####%")?n!=undefined&&o!=n&&(t.splice(s,0,{keys:[n.split(">#>")[r]+" Total%####%"],cellType:"SubTot",uniqueName:n,level:r,mSpan:s-a}),t[a].span==undefined&&(t[a].span=[]),t[a].span[r]=s-a,l++,n=o,a=++s,d):n!=undefined&&(t.splice(s,0,{keys:[n.split(">#>")[r]+" Total%####%"],cellType:"SubTot:",uniqueName:n,level:r,mSpan:s-a}),t[a].span==undefined&&(t[a].span=[]),t[a].span[r]=s-a,l++,n=o,a=++s,d)}t.push({cellType:"RGTot",keys:["Grand Total"]})}},_isPreviousLevelEqual:function(e,t,i,r){for(var l=r-1;l>=0;l--)return e[t].keys[l]!=e[i].keys[l]},_calculateValues:function(e){var t,i,r=this._rowKeysCalcValues.length+(e.values.length>0?1:0),l=0==this._colKeysCalcValues.length?1:this._colKeysCalcValues.length*(0==e.values.length?1:e.values.length)+1-(this._isPaging&&e.values.length>0&&e.pagerOptions.categoricalPageSize<e.values.length*this._colKeysCalcValues.length?e.values.length-(e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length==0?e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize:e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length):0);this._isPaging&&(0==e.columns.length?ej.PivotAnalysis._colHdrLen=0:$.each(this._colKeysCalcValues,function(e,t){!ej.isNullOrUndefined(t)&&t.keys.length>ej.PivotAnalysis._colHdrLen&&(ej.PivotAnalysis._colHdrLen=t.keys.length)}),0==e.rows.length?ej.PivotAnalysis._rowHdrLen=0:$.each(this._rowKeysCalcValues,function(e,t){!ej.isNullOrUndefined(t)&&t.keys.length>ej.PivotAnalysis._rowHdrLen&&(ej.PivotAnalysis._rowHdrLen=t.keys.length)})),this._gridMatrix=new Array(r+(this._isPaging?this._rowHdrLen:e.rows.length)+1),this._populateRowHeaders(e,r+(this._isPaging?this._rowHdrLen:e.rows.length)+1,0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length),t=(this._isPaging?this._colHdrLen:e.columns.length)+1,i=(this._isPaging&&e.pagerOptions.categoricalPageSize+1<l?e.pagerOptions.categoricalPageSize+1:l)+(0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length),this._populateColumnHeaders(e,t,i),this._advancedFilterInfo=[],e.values.length>0&&this._populateCalcTable(e),this._tRowCnt=r+t,this._tColCnt=i},_populateRowHeaders:function(e,t,i){var r,l,n,s,o;if(0!=this._rowKeysCalcValues.length){for(r=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?1+(e.values.length>0?1:0):(this._isPaging?this._colHdrLen:e.columns.length)+(e.values.length>0?1:0),this._gridMatrix=[],"",l=0;l<this._rowKeysCalcValues.length;l++){this._rowKeysCalcValues[l];var a=0,d=0,h=0,c=0;if(this._rowKeysCalcValues[l].keys!=undefined&&0!=this._rowKeysCalcValues[l].keys.length)for(this._gridMatrix[r]=new Array(i),c=this._rowKeysCalcValues[l].keys.length,n=0;n<c;n++)this._rowKeysCalcValues[l].cellType!=undefined&&ej.isNullOrUndefined(this._rowKeysCalcValues[l].span)?this._rowKeysCalcValues[l].cellType.indexOf("SubTot")>-1?(d=0==a?this._rowKeysCalcValues[l].level+a:a,h=i-this._rowKeysCalcValues[l].level,this._cellType="summary rstot"):(this._cellType="summary rgtot",d=a,h=this._isPaging?this._rowHdrLen:e.rows.length):(this._cellType="rowheader",d=a,h=1),s=c>1&&c-n>1?1:ej.isNullOrUndefined(this._rowKeysCalcValues[l].expander)?0:2,o=$.extend(!0,[],this._rowKeysCalcValues[l].keys),this._gridMatrix[r][d]={Index:d+","+r,CSS:this._cellType,Value:this._rowKeysCalcValues[l].keys[n],State:s,RowSpan:this._rowKeysCalcValues[l].span!=undefined?this._rowKeysCalcValues[l].span[n]:1,ColSpan:h,Info:o.splice(0,n+1).join(">#>"),Span:"None",Expander:this._rowKeysCalcValues[l].span!=undefined?this._rowKeysCalcValues[l].span[n]!=undefined?1:ej.isNullOrUndefined(this._rowKeysCalcValues[l].expander)?0:1:ej.isNullOrUndefined(this._rowKeysCalcValues[l].expander)?0:2,MCnt:this._rowKeysCalcValues[l].mSpan!=undefined&&ej.isNullOrUndefined(this._rowKeysCalcValues[l].span)?this._rowKeysCalcValues[l].mSpan:0},this._rowKeysCalcValues[l].level-n==1&&delete this._rowKeysCalcValues[l].span,a++;r++}this._cellType=""}},_populateColumnHeaders:function(e,t){var i,r,l,n,s,o,a;if(0!=this._colKeysCalcValues.length){var d,h,c,u,g,p,m=d=0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length,_=0==e.values.length?1:e.values.length,f=h=0,b=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?1:this._isPaging?this._colHdrLen:e.columns.length;for(i=0;i<this._colKeysCalcValues.length;i++){for(f=0,c=0,u=0,0,g=_,p=0,this._isPaging&&e.values.length>0&&(p=(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length,0==i?g=(g=(1==e.pagerOptions.categoricalCurrentPage&&e.values.length>e.pagerOptions.categoricalPageSize?e.pagerOptions.categoricalPageSize:e.values.length)-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length)<1?e.values.length:e.values.length>e.pagerOptions.categoricalPageSize&&g>e.pagerOptions.categoricalPageSize?e.pagerOptions.categoricalPageSize:g:this._colKeysCalcValues.length-i==1?g=(g=e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length)<1||e.pagerOptions.categoricalPageSize>=e.values.length*this._colKeysCalcValues.length-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length?e.values.length:g:g=e.values.length),this._colKeysCalcValues[i].keys,this._gridMatrix[f]==undefined&&(this._gridMatrix[f]=[]),h=this._colKeysCalcValues[i].keys.length,r=0;r<h;r++){for(this._gridMatrix[f]==undefined&&(this._gridMatrix[f]=[]),this._colKeysCalcValues[i].cellType!=undefined&&ej.isNullOrUndefined(this._colKeysCalcValues[i].span)?this._colKeysCalcValues[i].cellType.indexOf("SubTot")>-1?(c=0==f?this._colKeysCalcValues[i].level+f:f,u=t-this._colKeysCalcValues[i].level-1,this._cellType="summary cstot"):(c=f,u=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?1:this._isPaging?this._colHdrLen:e.columns.length,this._cellType="summary cgtot"):(c=f,u=1,this._cellType="colheader"),l=h>1&&h-r>1?1:ej.isNullOrUndefined(this._colKeysCalcValues[i].expander)?0:2,o=0;o<g;o++)n=$.extend(!0,[],this._colKeysCalcValues[i].keys),this._gridMatrix[c][_*i+o+d-(i>0?p:0)]={Index:m+","+c,CSS:this._cellType,Value:this._colKeysCalcValues[i].keys[r],State:l,ColSpan:o>0?1:this._isPaging&&0==i&&!ej.isNullOrUndefined(this._colKeysCalcValues[i].span)&&this._colKeysCalcValues[i].span[r]>=this._colKeysCalcValues.length?e.pagerOptions.categoricalPageSize:(this._colKeysCalcValues[i].span!=undefined?this._colKeysCalcValues[i].span[r]==undefined?1:this._colKeysCalcValues[i].span[r]:1)*(this._colKeysCalcValues.length-i==1?g:_)-(0==i?p:0),RowSpan:u,Info:n.splice(0,r+1).join(">#>"),Span:"None",Expander:o>0?ej.isNullOrUndefined(this._colKeysCalcValues[i].expander)?0:1:this._colKeysCalcValues[i].span!=undefined&&this._colKeysCalcValues[i].span[r]!=undefined?1:ej.isNullOrUndefined(this._colKeysCalcValues[i].expander)?0:1};this._colKeysCalcValues[i].level-r==1&&delete this._colKeysCalcValues[i].span,f++}if(e.values.length>0)for(o=0;o<g;o++)this._gridMatrix[b]==undefined&&(this._gridMatrix[b]=[]),s=this._isPaging&&e.values.length>0&&0==i?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length+o:o,this._gridMatrix[b][_*i+o+d-(i>0?p:0)]={Index:_*i+o+d-(i>0?p:0)+","+f,CSS:this._cellType+" calc",Value:e.values[s].fieldCaption==undefined?e.values[s].fieldName:e.values[s].fieldCaption,State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0};m++}if(this._cellType="",this._isPaging&&e.values.length>0&&this._colKeysCalcValues.length>0&&t>1)for(o=0;o<t;o++)for(a=0;a<this._gridMatrix[o].length;a++)!ej.isNullOrUndefined(this._gridMatrix[o][a])&&this._gridMatrix[o][a].ColSpan>this._gridMatrix[o].length-a&&(this._gridMatrix[o][a].ColSpan=this._gridMatrix[o].length-a)}},_populateCalcTable:function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S=[],x=null,v=e.values.length,w=this;this._rowTotCalc=[],this._rowTotCalc=[];var I,y=0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length,T=!1,L=0,R=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?2:(this._isPaging?this._colHdrLen:e.columns.length)+1,O=R,F=!1,E={};for($.grep(w._tableKeysCalcValues,function(e){E[e.uniqueName]=e}),t=$.grep(this._tableKeysCalcValues,function(e){if(ej.isNullOrUndefined(e.cellType))return e}),$.grep(this._tableKeysCalcValues,function(e){if(!ej.isNullOrUndefined(e.cellType))return e}),_=0;_<this._rowKeysCalcValues.length;_++){for(this._colTotCalc=[],I=y,T=!0,this._gridMatrix[_+R]==undefined&&(this._gridMatrix[_+R]=[]),this._rowTotCalc[L]=[],i=0;i<this._colKeysCalcValues.length;i++){if(S=[],x=null,this._cellType="value",f=this._isPaging&&e.values.length>0&&0==i?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length:0,b=(b=this._isPaging&&e.values.length>0&&this._colKeysCalcValues.length-i==1&&i>0?e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length:v)<1||this._isPaging&&e.pagerOptions.categoricalPageSize>=e.values.length*this._colKeysCalcValues.length-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length?v:b,e.columns.length>0&&e.rows.length>0)if(!w._isPaging||"RGTot"!=w._rowKeysCalcValues[_].cellType&&"RGTot"!=w._colKeysCalcValues[i].cellType){if(r=w._rowKeysCalcValues[_].uniqueName+">#>"+w._colKeysCalcValues[i].uniqueName,l=E[r]){for(a=0;a<l.value.keys.length;a++)S.push(l.value.keys[a]);""!=l.value.uniqueName&&(x=l.value.uniqueName)}}else n=0,$.grep(t,function(t){if("RGTot"==w._rowKeysCalcValues[_].cellType&&"RGTot"==w._colKeysCalcValues[i].cellType||("RGTot"==w._rowKeysCalcValues[_].cellType?t.uniqueName.indexOf(w._colKeysCalcValues[i].uniqueName)>-1:t.uniqueName.indexOf(w._rowKeysCalcValues[_].uniqueName)>-1))for(n++,a=0;a<t.value.keys.length;a++)ej.isNullOrUndefined(S[a])?S.push(t.value.keys[a]):S[a]=e.values[a].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(a,S,e):ej.PivotAnalysis._getSummaryValue(S[a],t.value.keys[a],n,"count"==ej.PivotAnalysis._summaryTypes[a]?"sum":ej.PivotAnalysis._summaryTypes[a],e.values[a].format,e.values[a].formatString)});else 0==e.rows.length?w._isPaging?(n=0,$.grep(t,function(t){if("RGTot"==w._colKeysCalcValues[i].cellType||t.uniqueName.indexOf(w._colKeysCalcValues[i].uniqueName)>-1)for(n++,a=0;a<t.value.keys.length;a++)ej.isNullOrUndefined(S[a])?S.push(t.value.keys[a]):S[a]=e.values[a].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(a,S,e):ej.PivotAnalysis._getSummaryValue(S[a],t.value.keys[a],n,"count"==ej.PivotAnalysis._summaryTypes[a]?"sum":ej.PivotAnalysis._summaryTypes[a],e.values[a].format,e.values[a].formatString)})):$.grep(w._tableKeysCalcValues,function(e){if(e.uniqueName==w._colKeysCalcValues[i].uniqueName){for(a=0;a<e.value.keys.length;a++)S.push(e.value.keys[a]);""!=e.value.uniqueName&&(x=e.value.uniqueName)}}):w._isPaging?(n=0,$.grep(t,function(t){if("RGTot"==w._rowKeysCalcValues[_].cellType||t.uniqueName.indexOf(w._rowKeysCalcValues[_].uniqueName)>-1)for(n++,a=0;a<t.value.keys.length;a++)ej.isNullOrUndefined(S[a])?S.push(t.value.keys[a]):S[a]=e.values[a].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(a,S,e):ej.PivotAnalysis._getSummaryValue(S[a],t.value.keys[a],n,"count"==ej.PivotAnalysis._summaryTypes[a]?"sum":ej.PivotAnalysis._summaryTypes[a],e.values[a].format,e.values[a].formatString)})):$.grep(w._tableKeysCalcValues,function(e){if(e.uniqueName==w._rowKeysCalcValues[_].uniqueName){for(a=0;a<e.value.keys.length;a++)S.push(e.value.keys[a]);""!=e.value.uniqueName&&(x=e.value.uniqueName)}});if(this._editCellsInfo.length>0)for(C=0;C<e.values.length;C++)S[C]=ej.PivotAnalysis._cellEdit(e.columns.length>0&&e.rows.length>0?this._rowKeysCalcValues[_].uniqueName+">#>"+this._colKeysCalcValues[i].uniqueName:0==e.rows.length?this._colKeysCalcValues[i].uniqueName:this._rowKeysCalcValues[_].uniqueName,S[C],C,e.values[C]);if(this._colKeysCalcValues[i].cellType!=undefined&&(this._colKeysCalcValues[i].cellType.indexOf("SubTot")>-1||this._colKeysCalcValues[i].cellType.indexOf("RGTot")>-1)){if(!this._isPaging){for(S=[],x=null,a=0;a<v;a++)for(d=0,n=0,s=I;s<=i*v+y;s++)this._gridMatrix[_+R]!=undefined&&this._gridMatrix[_+R][I+d*v+a]!=undefined&&this._gridMatrix[_+R][I+d*v+a].Value!=undefined&&(S[a]==undefined&&(S[a]=0),n++,S[a]=e.values[a].isCalculatedField?this._calculatedFieldSummaryValue(a,S,e):this._getSummaryValue(S[a],this._gridMatrix[_+R][I+d*v+a].Value,n,"count"==this._summaryTypes[a]?"sum":this._summaryTypes[a],e.values[a].format,e.values[a].formatString)),d++;0,I=(i+1)*v+y,ej.isNullOrUndefined(S)||this._colTotCalc.push({uniqueName:this._colKeysCalcValues[i].uniqueName,level:this._colKeysCalcValues[i].level,value:S}),this._colKeysCalcValues[i-1]!=undefined&&this._colKeysCalcValues[i-1].cellType!=undefined&&this._colKeysCalcValues[i-1].cellType.indexOf("SubTot")>-1&&-1==this._colKeysCalcValues[i-1].cellType.indexOf("RGTot")&&($(this._colTotCalc).filter(function(e,t){return t!=undefined&&t.uniqueName!=undefined&&w._colKeysCalcValues[i].uniqueName!=undefined&&t.level!=undefined&&w._colKeysCalcValues[i].level!=undefined&&0===t.uniqueName.indexOf(w._colKeysCalcValues[i].uniqueName)&&w._colKeysCalcValues[i].level+1==t.level}).map(function(t,i){for(var r=0;r<i.value.length;r++)S[r]=ej.isNullOrUndefined(S[r])?0:S[r],i.value[r]=ej.isNullOrUndefined(i.value[r])?0:i.value[r],e.values[r].isCalculatedField?S[r]=ej.PivotAnalysis._calculatedFieldSummaryValue(r,S,e):S[r]+=i.value[r];return S}),ej.isNullOrUndefined(S)||this._colTotCalc.push({uniqueName:this._colKeysCalcValues[i].uniqueName,level:this._colKeysCalcValues[i].level,value:S}))}this._cellType="summary value"}if(this._colKeysCalcValues[i].cellType!=undefined&&this._colKeysCalcValues[i].cellType.indexOf("RGTot")>-1&&0==S&&(this._isPaging||(S=[],x=null,n=0,$(this._colTotCalc).filter(function(e,t){return t!=undefined&&t!=undefined&&t.level!=undefined&&0==t.level}).map(function(t,i){for(var r=0;r<i.value.length;r++)S[r]=ej.isNullOrUndefined(S[r])?0:S[r],i.value[r]=ej.isNullOrUndefined(i.value[r])?0:i.value[r],n++,S[r]=e.values[r].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(r,S,e):ej.PivotAnalysis._getSummaryValue(S[r],i.value[r],n,"count"==w._summaryTypes[r]?"sum":w._summaryTypes[r],e.values[r].format,e.values[r].formatString);return S})),this._cellType="summary value"),this._rowKeysCalcValues[_].cellType!=undefined&&(this._rowKeysCalcValues[_].cellType.indexOf("SubTot")>-1||this._rowKeysCalcValues[_].cellType.indexOf("RGTot")>-1)){if(!this._isPaging){for(S=[],x=null,this._rowKeysCalcValues[_].uniqueName,this._rowKeysCalcValues[_-1]!=undefined&&this._rowKeysCalcValues[_-1].cellType!=undefined&&this._rowKeysCalcValues[_-1].cellType.indexOf("SubTot")>-1&&-1==this._rowKeysCalcValues[_].cellType.indexOf("RGTot")&&(n=0,$(this._rowTotCalc).filter(function(e,t){return t[0]!=undefined&&t[0].uniqueName!=undefined&&w._rowKeysCalcValues[_].uniqueName!=undefined&&t[0].level!=undefined&&w._rowKeysCalcValues[_].level!=undefined&&0===t[0].uniqueName.indexOf(w._rowKeysCalcValues[_].uniqueName)&&w._rowKeysCalcValues[_].level+1==t[0].level}).map(function(t,r){if(r[y+i].length>0){n++;for(var l=0;l<r[y+i].length;l++)S[l]=ej.isNullOrUndefined(S[l])?0:S[l],r[y+i][l]=ej.isNullOrUndefined(r[y+i][l])?0:r[y+i][l],S[l]=e.values[l].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(l,S,e):ej.PivotAnalysis._getSummaryValue(S[l],r[y+i][l],n,"count"==w._summaryTypes[l]?"sum":w._summaryTypes[l],e.values[l].format)}return S})),this._rowKeysCalcValues[_].cellType!=undefined&&this._rowKeysCalcValues[_].cellType.indexOf("RGTot")>-1&&(n=0,$(this._rowTotCalc).filter(function(e,t){return t!=undefined&&t[0]!=undefined&&t[0].level!=undefined&&0==t[0].level}).map(function(t,r){if(r[y+i].length>0){n++;for(var l=0;l<r[y+i].length;l++)S[l]=ej.isNullOrUndefined(S[l])?0:S[l],r[y+i][l]=ej.isNullOrUndefined(r[y+i][l])?0:r[y+i][l],S[l]=e.values[l].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(l,S,e):ej.PivotAnalysis._getSummaryValue(S[l],r[y+i][l],n,"count"==w._summaryTypes[l]?"sum":w._summaryTypes[l],e.values[l].format,e.values[l].formatString)}return S})),n=1,s=O;s<=_+R;s++){for(o=!1,a=0;a<v;a++)d=0,this._gridMatrix[s]!=undefined&&this._gridMatrix[s][y+i*v+a]!=undefined&&this._gridMatrix[s][y+i*v+a].Value!=undefined&&(S[a]==undefined&&(S[a]=0),o=!0,S[a]=e.values[a].isCalculatedField?this._calculatedFieldSummaryValue(a,S,e):this._getSummaryValue(S[a],this._gridMatrix[s][y+i*v+a].Value,n,"count"==this._summaryTypes[a]?"sum":this._summaryTypes[a],e.values[a].format,e.values[a].formatString)),d++;o&&n++}0,F=!0,T&&(this._rowTotCalc[L][0]={uniqueName:this._rowKeysCalcValues[_].uniqueName,level:this._rowKeysCalcValues[_].level},T=!1),this._rowTotCalc[L][y+i]=S}this._cellType="summary value"}if(e.enableAdvancedFilter){var D=0,N=this._currentFilterVal.fieldName?ej.Pivot.getReportItemByFieldName(this._currentFilterVal.fieldName,e):null;null!=N&&"rows"==N.axis&&(D=this._getFilteredIndex(e.rows,e.values,_,this._rowKeysCalcValues)),ej.isNullOrUndefined(D)||null==N||"rows"==N.axis||(D=this._getFilteredIndex(e.columns,e.values,i,this._colKeysCalcValues)),ej.isNullOrUndefined(D)||(h=this._rowKeysCalcValues[_].keys.length>0&&e.rows.length>0&&e.rows[this._rowKeysCalcValues[_].keys.length-1].advancedFilter&&e.rows[this._rowKeysCalcValues[_].keys.length-1].advancedFilter.length>0&&e.rows[this._rowKeysCalcValues[_].keys.length-1].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter?1:null,c=!(!N||null==N||null==h||e.rows[this._rowKeysCalcValues[_].keys.length-1].fieldName!=N.item.fieldName)&&this._applyValueFilter(e.rows[this._rowKeysCalcValues[_].keys.length-1].advancedFilter,S[D]),this._colKeysCalcValues[i].keys.indexOf("Grand Total")>=0&&c&&this._rowKeysCalcValues[_].uniqueName?this._advancedFilterInfo.push(this._rowKeysCalcValues[_].uniqueName):0==e.columns.length&&c&&this._rowKeysCalcValues[_].uniqueName&&this._advancedFilterInfo.push(this._rowKeysCalcValues[_].uniqueName),u=this._colKeysCalcValues[i].keys.length>0&&e.columns.length>0&&e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter&&e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter.length>0&&e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter?1:null,g=null!=N&&null!=u&&e.columns[this._colKeysCalcValues[i].keys.length-1].fieldName==N.item.fieldName&&this._applyValueFilter(e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter,S[D]),this._colKeysCalcValues[i].uniqueName&&"string"===jQuery.type(this._rowKeysCalcValues[_].keys[0])&&this._rowKeysCalcValues[_].keys[0].indexOf("Grand Total")>-1&&g&&this._advancedFilterInfo.push(this._colKeysCalcValues[i].uniqueName))}for(p=this._isPaging&&e.values.length>0?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length:0,C=f;C<b;C++)S!=undefined&&S.length!=undefined?(m=null,null!=x&&""!=x[C]&&" "!=x[C]&&(m=x[C]),this._gridMatrix[R+_][v*i+C+y-p]={Index:v*i+C+y-p+","+R+_,CSS:this._cellType,Value:S[C],valueText:m,State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0}):this._gridMatrix[R+_][v*i+C+y-p]=0}F&&(L++,O=_+R+1,F=!1)}for(_=0;_<this._rowKeysCalcValues.length;_++)for(i=0;i<this._colKeysCalcValues.length;i++)for(f=this._isPaging&&e.values.length>0&&0==i?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length:0,b=(b=this._isPaging&&e.values.length>0&&this._colKeysCalcValues.length-i==1&&i>0?e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length:v)<1||this._isPaging&&e.pagerOptions.categoricalPageSize>=e.values.length*this._colKeysCalcValues.length-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length?v:b,C=f;C<b;C++)e.values[C].isCalculatedField&&null==this._gridMatrix[R+_][v*i+C+y-p].Value&&(this._gridMatrix[R+_][v*i+C+y-p].Value=this._calculatedFieldSummaryValue(C,[],e));return this._gridMatrix}},ej.PivotAnalysis.SortOrder={Ascending:"ascending",Descending:"descending",None:"none"},ej.PivotAnalysis.FilterType={Exclude:"exclude",Include:"include"},ej.PivotAnalysis.SummaryType={Sum:"sum",Average:"average",Count:"count",Min:"min",Max:"max"}}(jQuery,Syncfusion)})},1022:function(e,t,r){var l,n,s;
/*!
*  filename: ej.pivotgrid.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.pivotgrid.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(i){n=[r(4),r(21),r(65),r(47),r(66),r(415),r(1011),r(96),r(1009),r(1010)],void 0===(s="function"==typeof(l=i)?l.apply(t,n):l)||(e.exports=s)}(function(){!function(e,t,r){t.olap=t.olap||{},t.widget("ejPivotGrid","ej.PivotGrid",{_rootCSS:"e-pivotgrid",element:null,model:null,_requiresID:!0,validTags:["div","span"],defaults:{url:"",cssClass:"",jsonRecords:"",currentReport:"",layout:"normal",analysisMode:"olap",operationalMode:"clientmode",filterType:"filterType",enablePivotFieldList:!0,enableGroupingBar:!1,enableDeferUpdate:!1,enableJSONRendering:!1,enableVirtualScrolling:!1,enablePaging:!1,enableColumnResizing:!1,resizeColumnsToFit:!0,enableContextMenu:!1,enableCellContext:!1,enableRTL:!1,enableDefaultValue:!1,enableToolTip:!0,enableToolTipAnimation:!0,enableCellSelection:!1,enableConditionalFormatting:!1,enableCellEditing:!1,enableColumnGrandTotal:!0,enableRowGrandTotal:!0,enableGrandTotal:!0,enableCollapseByDefault:!1,enableCellDoubleClick:!1,enableCellClick:!1,enableDrillThrough:!1,isResponsive:!1,enableAdvancedFilter:!1,showUniqueNameOnPivotButton:!1,enableMemberEditorPaging:!1,enableMemberEditorSorting:!1,enableXHRCredentials:!1,enableCompleteDataExport:!1,enableCheckStateOnSearch:!0,editCellsInfo:{},hyperlinkSettings:{enableValueCellHyperlink:!1,enableRowHeaderHyperlink:!1,enableColumnHeaderHyperlink:!1,enableSummaryCellHyperlink:!1},headerSettings:{showRowItems:!1,showColumnItems:!1},frozenHeaderSettings:{enableFrozenRowHeaders:!1,enableFrozenColumnHeaders:!1,enableFrozenHeaders:!1,scrollerSize:18},valueSortSettings:{headerText:"",headerDelimiters:"##",sortOrder:t.PivotAnalysis.SortOrder.None},conditionalFormatSettings:[],serviceMethodSettings:{initialize:"InitializeGrid",drillDown:"DrillGrid",exportPivotGrid:"Export",paging:"Paging",fetchMembers:"FetchMembers",nodeStateModified:"NodeStateModified",nodeDropped:"NodeDropped",filtering:"Filtering",sorting:"Sorting",valueSorting:"ValueSorting",deferUpdate:"DeferUpdate",memberExpand:"MemberExpanded",writeBack:"WriteBack",cellEditing:"CellEditing",saveReport:"SaveReport",loadReport:"LoadReportFromDB",calculatedField:"CalculatedField",drillThroughHierarchies:"DrillThroughHierarchies",drillThroughDataTable:"DrillThroughDataTable",removeButton:"RemoveButton"},customObject:{},locale:"en-US",dataSource:{data:null,sourceInfo:"",providerName:"ssas",enableAdvancedFilter:!1,isFormattedValues:!1,reportName:"Default",columns:[],cube:"",catalog:"",rows:[],values:[],filters:[],pagerOptions:{categoricalPageSize:0,seriesPageSize:0,categoricalCurrentPage:0,seriesCurrentPage:0}},pivotTableFieldListID:"",collapsedMembers:null,cellSelection:null,valueCellHyperlinkClick:null,rowHeaderHyperlinkClick:null,columnHeaderHyperlinkClick:null,summaryCellHyperlinkClick:null,beforeServiceInvoke:null,afterServiceInvoke:null,drillThrough:null,drillSuccess:null,cellContext:null,load:null,renderComplete:null,renderFailure:null,renderSuccess:null,cellDoubleClick:null,cellClick:null,applyFieldCaption:null,beforeExport:null,beforePivotEnginePopulate:null,pivotEnginePopulated:null,saveReport:null,loadReport:null,cellEdit:null,memberEditorPageSize:100,maxNodeLimitInMemberEditor:1e3},dataTypes:{dataSource:{data:"data",columns:"array",rows:"array",values:"array",filters:"array"},serviceMethodSettings:{initialize:"enum",drillDown:"enum",exportPivotGrid:"enum",paging:"enum",fetchMembers:"enum",nodeStateModified:"enum",nodeDropped:"enum",filtering:"enum",sorting:"enum",deferUpdate:"enum",memberExpand:"enum",writeBack:"enum",cellEditing:"enum",saveReport:"enum",loadReport:"enum",calculatedField:"enum",drillThroughHierarchies:"enum",drillThroughDataTable:"enum",removeButton:"enum"},customObject:"data"},observables:["layout","enableCellContext","hyperlinkSettings.enableValueCellHyperlink","hyperlinkSettings.enableRowHeaderHyperlink","hyperlinkSettings.enableColumnHeaderHyperlink","hyperlinkSettings.enableSummaryCellHyperlink"],layout:t.util.valueFunction("layout"),enableCellContext:t.util.valueFunction("enableCellContext"),enableValueCellHyperlink:t.util.valueFunction("hyperlinkSettings.enableValueCellHyperlink"),enableRowHeaderHyperlink:t.util.valueFunction("hyperlinkSettings.enableRowHeaderHyperlink"),enableColumnHeaderHyperlink:t.util.valueFunction("hyperlinkSettings.enableColumnHeaderHyperlink"),enableSummaryCellHyperlink:t.util.valueFunction("hyperlinkSettings.enableSummaryCellHyperlink"),locale:t.util.valueFunction("locale"),getOlapReport:function(){return this._olapReport},setOlapReport:function(e){this._olapReport=e},getJSONRecords:function(){return this._JSONRecords},setJSONRecords:function(t){this._JSONRecords=e.parseJSON(t)},_init:function(){this._initPrivateProperties(),this._load()},_destroy:function(){e(this.element).next().length>0&&"e-pGridTooltip"==e(this.element).next()[0].className&&e(this.element).next().remove(),this.element.empty().removeClass("e-pivotgrid"+this.model.cssClass).removeAttr("tabindex"),this._waitingPopup!=r&&this._waitingPopup.destroy(),""==this.element.attr("class")&&this.element.removeAttr("class")},_getExportModel:function(){var i="ExportControl",r={rowCellColor:t.isNullOrUndefined(this.element.find(".rowheader"))?"":t.isNullOrUndefined(this.element.find(".rowheader").css("color"))?"rgb(51, 51, 51)":this.element.find(".rowheader").css("color"),rowCellBGColor:t.isNullOrUndefined(this.element.find(".rowheader"))?"":t.isNullOrUndefined(this.element.find(".rowheader").css("background-color"))?"rgb(255, 255, 255)":this.element.find(".rowheader").css("background-color"),columnCellColor:t.isNullOrUndefined(this.element.find(".colheader"))?"":t.isNullOrUndefined(this.element.find(".colheader").css("color"))?"rgb(51, 51, 51)":this.element.find(".colheader").css("color"),columnCellBGColor:t.isNullOrUndefined(this.element.find(".colheader"))?"":t.isNullOrUndefined(this.element.find(".colheader").css("background-color"))?"rgb(255, 255, 255)":this.element.find(".colheader").css("background-color"),valueCellColor:t.isNullOrUndefined(this.element.find(".value"))?"":t.isNullOrUndefined(this.element.find(".value").css("color"))?"rgb(51, 51, 51)":this._cFormat.length<=0?this.element.find(".value").css("color"):"rgb(51, 51, 51)",valueCellBGColor:t.isNullOrUndefined(this.element.find(".value"))?"":t.isNullOrUndefined(this.element.find(".value").css("background-color"))?"rgb(255, 255, 255)":this._cFormat.length<=0?this.element.find(".value").css("background-color"):"rgb(255, 255, 255)",summaryCellColor:t.isNullOrUndefined(this.element.find(".summary"))?"":t.isNullOrUndefined(this.element.find(".summary").css("color"))?"rgb(51, 51, 51)":this.element.find(".summary").css("color"),summaryCellBGColor:t.isNullOrUndefined(this.element.find(".summary"))?"":t.isNullOrUndefined(this.element.find(".summary").css("background-color"))?"rgb(255, 255, 255)":this.element.find(".summary").css("background-color")},l=(e.extend(!0,{},this.model),"PivotGrid"),n=(t.PivotGrid.ExportMode.JSON,this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?".xls":".xlsx"),s="",o="",a=!0,d=!1;return{args:{pGridData:null!=this.exportRecords&&""!=this.exportRecords?this.exportRecords:null,rowCount:null!=this._excelLikeJSONRecords?this._excelRowCount:this._rowCount,columnCount:null!=this._excelLikeJSONRecords?Math.floor(this._excelLikeJSONRecords.length/this._excelRowCount):null!=this.getJSONRecords()?Math.floor(this.getJSONRecords().length/this._rowCount):0,fileFormat:n+(".xls"==n||".xlsx"==n?"~"+d:""),fileName:t.isNullOrUndefined(i)?t.isNullOrUndefined(l)?"PivotGrid":l:i,colorSettings:r,Formatting:this._cFormat,title:s,description:o,language:this.model.locale,multiControlExport:!0,exportWithStyle:a,customObject:JSON.stringify(this.model.customObject)}}},_initPrivateProperties:function(){this._id=this.element.attr("id"),this._olapReport="",this._JSONRecords=null,this._excelLikeJSONRecords=null,this._drillCaption="",this._drillAction="",this._startDrilldown=!1,this._pagerObj=null,this._seriesPageCount=null,this._categPageCount=null,this._seriesCurrentPage=1,this._categCurrentPage=1,this._drillHeaders={row:[],column:[]},this._collapsedRowHeaders=[],this._isDragging=!1,this._droppedClass="",this._dataModel="",this._ascdes="",this._filterUpdate=[],this._pivotRow=[],this._pivotColumn=[],this._pivotCalculation=[],this._pivotFilter=[],this._pivotTableFields=[],this._schemaData=null,this._waitingPopup=null,this._oriX=null,this._oriY=null,this._sortType="",this._startPosCell=null,this._startCellPosition=null,this._maxViewLoading=null,this._list=[],this._formatEdit=!1,this._formatName=[],this._formatName.push(this._getLocalizedLabels("AddNew")),this._rowCount=0,this._excelRowCount=0,this._dialogTitle="",this._selectedField="",this._selectedAxis="",this._isUpdateRequired=!1,this._isMembersFiltered=!1,this._selectedCell=null,this._onholdKey="",this._primaryCellPos="",this._prevDrillElements=[],this._currentReportItems=[],this._savedReportItems=[],this._rowHeader=[],this._colHeader=[],this._cellInfo=[],this._editorFlag=!0,this._isSubTotalHide=!1,this._isSubTotalhidden=!1,this._dimension,this._calculatedField=[],this._isFormatApply=!1,this._cFormat=[],this._curFocus={cell:null,tab:null,tree:null,cformat:null,grp:null,selection:null,filter:null,field:null,formula:null},this._index={index:0,grp:1,cell:1,dialog:1,paging:1,cformat:1,filter:0,field:0,formula:0},this._dataSet=[],this._currentCell=-1,this._target=null,this._orgX=null,this._orgY=null,this._expand=!1,this._excelFilterInfo=[],this._pagingSavedObjects={drillEngine:[],savedHdrEngine:[],curDrilledItem:{}},this._isSchemaInitialize=!0,this._fieldMembers={},this._fieldSelectedMembers={},this._allMember="",this._selectedMeasure="",this._selectedFormat="",this._dialogName="",this._pivotClientObj=null,this._memberPageSettings={currentMemeberPage:1,startPage:0,endPage:0},this._memberSearchPageSettings={currentMemberSearchPage:1,startSearchPage:0,endSearchPage:0},this._memberDrillPageSettings={currentMemberDrillPage:1,startDrillPage:0,endDrillPage:0},this._isAllMemberChecked=!0,this._editorTreeData=[],this._editorSearchTreeData=[],this._editorDrillTreeData={},this._editorDrillTreePageSettings={},this._lastSavedTree=[],this._onDemandNodeExpand=!0,this._isSearchApplied=!1,this._isEditorDrillPaging=!1,this._isEditorCollapseDrillPaging=!1,this._isSchemaClick=!1,this._memberPagingAvdData=[],this._table="",this._drillParams={currRow:"",currCol:"",currPos:""},this._croppedJson=[],this._compJson=[],this._isNavigation=!1,this._isOptionSearch=!1,this._isSelectSearchFilter=!0,this._currentFilterList={},this._rawData=[],this._colKeysCalcValues=[],this._rowKeysCalcValues=[],this._tableKeysCalcValues=[],this._isExporting=!1,this._fullExportedData={},this._pivotEngine=null,this._isXMLImport=!1,this._isFilterBtnClick=!1,this._parentNodeCollection={},this._parentSearchNodeCollection={},this._initialSlicerName=""},_load:function(){var i,r,l={element:this.element,customObject:this.model.customObject};if((this.model.enableAdvancedFilter||this.model.dataSource.enableAdvancedFilter)&&(this.model.dataSource.enableAdvancedFilter=this.model.enableAdvancedFilter=!0),this.model.enableCellEditing&&this.model.enableCellSelection&&(this.model.enableCellSelection=!1),this._trigger("load",l),this.element.addClass(this.model.cssClass),e(this.element).parents(".e-pivotclient").length>0?(this._pivotClientObj=e(this.element).parents(".e-pivotclient").data("ejPivotClient"),e("#"+this._pivotClientObj._id+"_maxView")[0]&&e("#"+this._pivotClientObj._id+"_maxView").ejWaitingPopup({showOnInit:!0}),t.isNullOrUndefined(this._waitingPopup)&&!t.isNullOrUndefined(this._pivotClientObj._waitingPopup)&&(this._waitingPopup=this._pivotClientObj._waitingPopup),this._waitingPopup.show()):t.isNullOrUndefined(this._waitingPopup)&&(this.element.ejWaitingPopup({showOnInit:!0}),this._waitingPopup=this.element.data("ejWaitingPopup")),this._waitingPopup.show(),this.model.enableJSONRendering)this.setJSONRecords(this.model.jsonRecords),this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this.excelLikeLayout(this.getJSONRecords()):this.renderControlFromJSON();else if(t.isNullOrUndefined(this.model.dataSource.data)&&""==this.model.url&&!t.isNullOrUndefined(this._pivotClientObj))this.renderControlFromJSON(),this._waitingPopup.hide();else if(null==this.model.dataSource.data&&""!=this.model.url||null!=this.model.dataSource.data&&""!=this.model.url&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)this.model.operationalMode=t.Pivot.OperationalMode.ServerMode,t.isNullOrUndefined(this.model.beforeServiceInvoke)||this._trigger("beforeServiceInvoke",{action:"initialize",element:this.element,customObject:this.model.customObject}),i=JSON.stringify(this.model.customObject),this.model.enableVirtualScrolling&&(this.model.layout=t.PivotGrid.Layout.NoSummaries),null!=this.element[0]&&this.element.parents().find(".e-controlPanel").length>0&&""!=this.layout()&&this.layout()!=t.PivotGrid.Layout.Normal?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGrid",currentReport:this.model.currentReport,gridLayout:this.layout(),customObject:i}),this._renderControlSuccess):null!=this.element[0]&&this.element.parents().find(".e-controlPanel").length>0?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:this.model.enableCellDoubleClick||this.model.enableCellClick||this.model.enableDrillThrough?"initializeGrid:getDataSet":"initializeGrid",currentReport:this.model.currentReport,customObject:i}),this._renderControlSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:this.model.enableCellDoubleClick||this.model.enableCellClick||this.model.enableDrillThrough?this.model.enableCollapseByDefault&&(this.model.enablePaging||this.model.enableVirtualScrolling)?"initializeGrid:getDataSet:collapseByDefault":"initializeGrid:getDataSet":this.model.enableCollapseByDefault&&(this.model.enablePaging||this.model.enableVirtualScrolling)?"initializeGrid:collapseByDefault":"initializeGrid",gridLayout:this.layout(),enablePivotFieldList:this.model.enablePivotFieldList,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:i}),this._renderControlSuccess);else if(this.model.operationalMode=t.Pivot.OperationalMode.ClientMode,""!=this.model.dataSource.cube)this.model.analysisMode=t.Pivot.AnalysisMode.Olap,this._trigger("beforePivotEnginePopulate",{pivotGridObj:this}),t.olap.base.getJSONData({action:"initialLoad"},this.model.dataSource,this);else if(null!=this.model.dataSource.data){for(!1,r=0;r<this.model.dataSource.rows.length;r++)this._applyGrouping("rows",r)&&r--;for(r=0;r<this.model.dataSource.columns.length;r++)this._applyGrouping("columns",r)&&r--;for(r=0;r<this.model.dataSource.values.length;r++)this._applyGrouping("values",r)&&r--;for(r=0;r<this.model.dataSource.filters.length;r++)this._applyGrouping("filters",r)&&r--;this.model.analysisMode=t.Pivot.AnalysisMode.Pivot,t.PivotAnalysis.setFieldCaptions(this.model.dataSource),this._populatePivotGrid()}},_formatChange:function(e,t,i){var r,l=t.split(i);return l[0].indexOf("M")>-1&&l[1].indexOf("d")>-1||l[1].indexOf("M")>-1&&l[2].indexOf("d")>-1?e:l[1].indexOf("M")>-1&&l[0].indexOf("d")>-1?(r=e.split(i))[1]+i+r[0]+i+r[2]:l[2].indexOf("M")>-1&&l[0].indexOf("d")>-1?(r=e.split(i))[2]+i+r[0]+i+r[1]:l[2].indexOf("M")>-1&&l[1].indexOf("d")>-1?(r=e.split(i))[2]+i+r[1]+i+r[0]:l[0].indexOf("M")>-1&&l[2].indexOf("d")>-1?(r=e.split(i))[0]+i+r[2]+i+r[1]:void 0},_applyGrouping:function(e,i){var l,n;this._rawData=this.model.dataSource.data;var s=this.model.dataSource.data,o=-1,a=!1;for(o=-1,l=0;"date"==this.model.dataSource[e][i].format&&this.model.dataSource[e][i].formatString!=r&&this.model.dataSource[e][i].delimiter!=r&&this.model.dataSource[e][i].groupByDate!=r&&l<this.model.dataSource[e][i].groupByDate.interval.length;l++){var d=this.model.dataSource[e][i].groupByDate.interval[l].indexOf("MM")>-1&&-1==this.model.dataSource[e][i].groupByDate.interval[l].indexOf("dd")?this._getLocalizedLabels("Months"):this.model.dataSource[e][i].groupByDate.interval[l].indexOf("dd")>-1?this._getLocalizedLabels("Days"):this.model.dataSource[e][i].groupByDate.interval[l].indexOf("qq")>-1?this._getLocalizedLabels("Quarters"):this._getLocalizedLabels("Years"),h=this.model.dataSource[e][i].formatString,c=this.model.dataSource[e][i].delimiter,u={fieldName:d+" ("+this.model.dataSource[e][i].fieldName+")",fieldCaption:d+" ("+this.model.dataSource[e][i].fieldName+")"};for(this.model.dataSource[e].push(u),n=0;n<s.length;n++)s[n][u.fieldName]=this.model.dataSource[e][i].groupByDate.interval[l].indexOf("MM")>-1&&-1==this.model.dataSource[e][i].groupByDate.interval[l].indexOf("DD")?t.PivotAnalysis._setFormat(this._formatChange(s[n][this.model.dataSource[e][i].fieldName],h,c),this.model.dataSource[e][i].format,this.model.dataSource[e][i].groupByDate.interval[l]):this.model.dataSource[e][i].groupByDate.interval[l].indexOf("dd")>-1?t.PivotAnalysis._setFormat(this._formatChange(s[n][this.model.dataSource[e][i].fieldName],h,c),this.model.dataSource[e][i].format,this.model.dataSource[e][i].groupByDate.interval[l]):this.model.dataSource[e][i].groupByDate.interval[l].indexOf("qq")>-1?("qq"==this.model.dataSource[e][i].groupByDate.interval[l]?this._getLocalizedLabels("Qtr")+" "+c:this._getLocalizedLabels("Quarter")+" "+c)+this._getQuarter(this._formatChange(s[n][this.model.dataSource[e][i].fieldName],h,c)):t.PivotAnalysis._setFormat(this._formatChange(s[n][this.model.dataSource[e][i].fieldName],h,c),this.model.dataSource[e][i].format,this.model.dataSource[e][i].groupByDate.interval[l]);o=i}return-1!=o&&(this.model.dataSource[e].splice(i,1),a=!0),a},_getQuarter:function(e){if(jQuery.isNumeric(e))t=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime());else if("Invalid Date"!=new Date(e))var t=new Date(e);else t=new Date(864e5*(Number(0)-2)+new Date("01/01/1900").getTime());return Math.floor((t.getMonth()+3)/3)},refreshControl:function(){t.Pivot.openPreventPanel(this),this._trigger("beforePivotEnginePopulate",{pivotObject:this}),this.model.enableGroupingBar&&this._createGroupingBar(this.model.dataSource),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(t.PivotAnalysis._controlObj=this,this._pivotEngine=t.PivotAnalysis.pivotEnginePopulate(this.model),this.setJSONRecords(JSON.stringify(this._pivotEngine.json)),this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this.excelLikeLayout(this._pivotEngine.json):this.renderControlFromJSON(this._pivotEngine.json),this._trigger("renderSuccess",this)):t.olap.base.getJSONData({action:"initialLoad"},this.model.dataSource,this)},_setCaptions:function(){e.each(this.model.dataSource.rows,function(e,i){t.isNullOrUndefined(i.fieldCaption)&&(i.fieldCaption=i.fieldName)}),e.each(this.model.dataSource.columns,function(e,i){t.isNullOrUndefined(i.fieldCaption)&&(i.fieldCaption=i.fieldName)}),e.each(this.model.dataSource.filters,function(e,i){t.isNullOrUndefined(i.fieldCaption)&&(i.fieldCaption=i.fieldName)}),e.each(this.model.dataSource.values,function(e,i){t.isNullOrUndefined(i.fieldCaption)&&(i.fieldCaption=i.fieldName)})},refreshFieldCaption:function(e,t,i){var r;if(i.indexOf("row")>=0)for(r=0;r<this.model.dataSource.rows.length;r++)e==this.model.dataSource.rows[r].fieldName&&(this.model.dataSource.rows[r].fieldCaption=t);else if(i.indexOf("calc")>=0)for(r=0;r<this.model.dataSource.values.length;r++)e==this.model.dataSource.values[r].fieldName&&(this.model.dataSource.values[r].fieldCaption=t);else if(i.indexOf("col")>=0)for(r=0;r<this.model.dataSource.columns.length;r++)e==this.model.dataSource.columns[r].fieldName&&(this.model.dataSource.columns[r].fieldCaption=t);else for(r=0;r<this.model.dataSource.filters.length;r++)e==this.model.dataSource.filters[r].fieldName&&(this.model.dataSource.filters[r].fieldCaption=t);for(r=0;r<this._pivotTableFields.length;r++)e==this._pivotTableFields[r].name&&(this._pivotTableFields[r].caption=t)},refreshPivotGrid:function(){this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(this.getOlapReport()&&(this.model.dataSource.rows&&(this.model.dataSource.rows=this.getOlapReport().rows),this.model.dataSource.columns&&(this.model.dataSource.columns=this.getOlapReport().columns),this.model.dataSource.filters&&(this.model.dataSource.filters=this.getOlapReport().filters),this.model.dataSource.values&&(this.model.dataSource.values=this.getOlapReport().values)),this.model.editCellsInfo={},this._populatePivotGrid()):(this._trigger("beforePivotEnginePopulate",{olapObject:this}),t.olap.base.getJSONData({action:"initialLoad"},this.model.dataSource,this)):this._load()},_populatePivotGrid:function(){var i,r,l,n,s;for(this._trigger("beforePivotEnginePopulate",{pivotObject:this}),i=e(this.element).parents(".e-pivotclient").length>0?e(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,r=e.grep(this.model.dataSource.values,function(e){return 1==e.isCalculatedField}),this.model.dataSource.values=e.grep(this.model.dataSource.values,function(e){return t.isNullOrUndefined(e.isCalculatedField)||0==e.isCalculatedField}),l=0;l<r.length;l++)n=r[l].formula,0==e.grep(this._calculatedField,function(e){return e.name==r[l].fieldName}).length&&(n=n.replace(/\s+|\s+$/gm,""),n=(n=this._parenthesisAsterisk(n)).replace(/[-+/^%*]/g,function(e){return" "+e+" "}),this._calculatedField.push({name:r[l].fieldName,formula:n,format:r[l].format,formatString:r[l].formatString})),r[l].formula=n,this.model.dataSource.values.push(r[l]);t.PivotAnalysis._controlObj=this,s=t.PivotAnalysis.pivotEnginePopulate(this.model),this.setJSONRecords(JSON.stringify(s.json)),this.setOlapReport(this.model.dataSource),this._createGroupingBar(this.model.dataSource),this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this.excelLikeLayout(s.json):this.renderControlFromJSON(),t.isNullOrUndefined(i)||(i._isTimeOut=!1),this._waitingPopup.hide(),this._trigger("renderSuccess",this),t.isNullOrUndefined(this._pivotClientObj)||void 0===this._pivotClientObj._pivotSchemaDesigner||(this._schemaData=this._pivotClientObj._pivotSchemaDesigner),null!=this._schemaData&&(t.isNullOrUndefined(this._schemaData._waitingPopup)?this._waitingPopup.hide():this._schemaData._waitingPopup.hide(),this._calculatedField.length>0&&this._schemaCalculatedField())},_setFirst:!1,_setModel:function(i){for(var r in i)switch(r){case"OlapReport":case"JsonData":this.setOlapReport(i[r]);break;case"RefreshOlapGrid":this.element.renderControlFromJSON(i[r]);break;case"layout":this.layout(t.util.getVal(i[r])),this._load();break;case"customObject":this.model.customObject=i[r];break;case"enableCellContext":this.enableCellContext(t.util.getVal(i[r])),this._load();break;case"enableDefaultValue":this.model.enableDefaultValue=i[r];break;case"hyperlinkSettings":!t.isNullOrUndefined(t.util.getVal(i[r]).enableValueCellHyperlink)&&e.isFunction(t.util.getVal(i[r]).enableValueCellHyperlink)?this.enableValueCellHyperlink(i[r].enableValueCellHyperlink()):t.isNullOrUndefined(i[r].enableValueCellHyperlink)||this.enableValueCellHyperlink(i[r].enableValueCellHyperlink),!t.isNullOrUndefined(t.util.getVal(i[r]).enableRowHeaderHyperlink)&&e.isFunction(t.util.getVal(i[r]).enableRowHeaderHyperlink)?this.enableRowHeaderHyperlink(i[r].enableRowHeaderHyperlink()):t.isNullOrUndefined(i[r].enableRowHeaderHyperlink)||this.enableRowHeaderHyperlink(i[r].enableRowHeaderHyperlink),!t.isNullOrUndefined(t.util.getVal(i[r]).enableColumnHeaderHyperlink)&&e.isFunction(t.util.getVal(i[r]).enableColumnHeaderHyperlink)?this.enableColumnHeaderHyperlink(i[r].enableColumnHeaderHyperlink()):t.isNullOrUndefined(i[r].enableColumnHeaderHyperlink)||this.enableColumnHeaderHyperlink(i[r].enableColumnHeaderHyperlink),!t.isNullOrUndefined(t.util.getVal(i[r]).enableSummaryCellHyperlink)&&e.isFunction(t.util.getVal(i[r]).enableSummaryCellHyperlink)?this.enableSummaryCellHyperlink(i[r].enableSummaryCellHyperlink()):t.isNullOrUndefined(i[r].enableSummaryCellHyperlink)||this.enableSummaryCellHyperlink(i[r].enableSummaryCellHyperlink),this._load();break;case"operationalMode":this.model.operationalMode=i[r];break;case"analysisMode":this.model.analysisMode=i[r];break;case"locale":this.locale(t.util.getVal(i[r])),this._load();break;case"dataSource":this.model.dataSource=e.extend({},this.model.dataSource,i[r]),this.refreshControl(),this._schemaData&&this._schemaData._load();break;case"enableGroupingBar":case"enableDeferUpdate":this.model.enableGroupingBar=i[r],this._load();break;case"enableJSONRendering":this.model.enableJSONRendering=i[r],this._load();break;case"enableVirtualScrolling":this.model.enableVirtualScrolling=i[r],this._load();break;case"enablePaging":this.model.enablePaging=i[r],this._load();break;case"enableColumnResizing":this.model.enableColumnResizing=i[r],this._load();break;case"resizeColumnsToFit":this.model.resizeColumnsToFit=i[r],this.renderControlFromJSON();break;case"enableContextMenu":this.model.enableContextMenu=i[r],this._load();break;case"enableRTL":this.model.enableRTL=i[r],this._load();break;case"enableToolTip":this.model.enableToolTip=i[r];break;case"enableToolTipAnimation":this.model.enableToolTipAnimation=i[r];break;case"enableCellSelection":this.model.enableCellSelection=i[r],this._load();break;case"enableConditionalFormatting":this.model.enableConditionalFormatting=i[r],this._load();break;case"enableCellEditing":this.model.enableCellEditing=i[r],this._load();break;case"enableColumnGrandTotal":this.model.enableColumnGrandTotal=i[r],this._load();break;case"enableRowGrandTotal":this.model.enableRowGrandTotal=i[r],this._load();break;case"enableGrandTotal":this.model.enableGrandTotal=i[r],this._load();break;case"enableCollapseByDefault":this.model.enableCollapseByDefault=i[r],this._load();break;case"enableCellDoubleClick":this.model.enableCellDoubleClick=i[r],this._load();break;case"enableDrillThrough":this.model.enableDrillThrough=i[r],this._load();break;case"isResponsive":this.model.isResponsive=i[r],this._load();break;case"enableAdvancedFilter":this.model.enableAdvancedFilter=i[r],this._load();break;case"showUniqueNameOnPivotButton":this.model.showUniqueNameOnPivotButton=i[r],this._load();break;case"enableMemberEditorPaging":this.model.enableMemberEditorPaging=i[r],this._load();break;case"frozenHeaderSettings":this.model.frozenHeaderSettings=e.extend({},this.model.frozenHeaderSettings,i[r]),this.refreshControl();break;case"valueSortSettings":this.model.valueSortSettings=e.extend({},this.model.valueSortSettings,i[r]),this.refreshControl()}},_wireEvents:function(){this.model.enableCellDoubleClick&&this._on(this.element,"dblclick",".value, .summary",this._cellRangeInfo),this.model.enableCellClick&&this._on(this.element,"click",".value, .summary",this._cellRangeInfo),this._on(this.element,"mouseover",".value,.rowheader,.colheader,.summary",t.proxy(function(i){var r,l,n;e(i.target).hasClass("cellValue")||e(i.target).children().hasClass("cellValue")||(r=e(i.target).contents().filter(function(){return 3==this.nodeType}),t.isNullOrUndefined(r.text())||""==e.trim(r.text())||(n=(l=e(i.target).find(".valueSorting").length>0)?e(i.target).find(".valueSorting"):"",e(i.target).find(".valueSorting").remove(),e(i.target).contents().filter(function(){return 3==this.nodeType}).remove(),e(i.target).append("<span class='cellValue'>"+r.text()+"</span>"),l&&(e(i.target).hasClass("colheader")||e(i.target).hasClass("summary"))&&e(i.target).hasClass("calc")&&!e(i.target).hasClass("rowheader")&&e(i.target).append(n)))})),this._on(this.element,"contextmenu",".value,.rowheader,.colheader,.summary",t.proxy(function(i){var r;if(this.model.enableContextMenu&&t.isNullOrUndefined(this._pivotClientObj)&&!this.model.enableCellContext){i.preventDefault();var l,n,s="",o="";n=this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?"<li><a>"+this._getLocalizedLabels("Layouts")+"</a><ul><li id='normalLayout'><a>"+this._getLocalizedLabels("NormalLayout")+"</a><li><li id='excelLikeLayout'><a>"+this._getLocalizedLabels("ExcelLikeLayout")+"</a><li></ul></li>":this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode?"<li><a>"+this._getLocalizedLabels("Layouts")+"</a><ul><li id='normalLayout'><a>"+this._getLocalizedLabels("NormalLayout")+"</a><li><li id='excelLikeLayout'><a>"+this._getLocalizedLabels("ExcelLikeLayout")+"</a><li><li id='noSummariesLayout'><a>"+this._getLocalizedLabels("NoSummaries")+"</a><li></ul></li>":"<li><a>"+this._getLocalizedLabels("Layouts")+"</a><ul><li id='normalLayout'><a>"+this._getLocalizedLabels("NormalLayout")+"</a><li><li id='excelLikeLayout'><a>"+this._getLocalizedLabels("ExcelLikeLayout")+"</a><li><li id='noSummariesLayout'><a>"+this._getLocalizedLabels("NoSummaries")+"</a><li><li id='normalTopSummaryLayout'><a>"+this._getLocalizedLabels("NormalTopSummary")+"</a><li></ul></li>",l=this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot&&this.model.analysisMode!=t.Pivot.AnalysisMode.Olap||this.model.operationalMode!=t.Pivot.OperationalMode.ServerMode?t.buildTag("li.e-advancedFiltering",t.buildTag("a",this._getLocalizedLabels("AdvancedFiltering"))[0].outerHTML)[0].outerHTML:"",this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(o=t.buildTag("li.e-collapseByDefault",t.buildTag("a",this._getLocalizedLabels("CollapseByDefault"))[0].outerHTML)[0].outerHTML),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&(s=t.buildTag("li.e-numberFormatting",t.buildTag("a",this._getLocalizedLabels("NumberFormatting"))[0].outerHTML)[0].outerHTML);var a="<li><a>"+this._getLocalizedLabels("HyperLink")+"</a><ul><li id='rowHeader'><a>"+this._getLocalizedLabels("EnableRowHeaderHyperlink")+"</a></li><li id='columnHeader'><a>"+this._getLocalizedLabels("EnableColumnHeaderHyperlink")+"</a></li><li id='valueCell'><a>"+this._getLocalizedLabels("EnableValueCellHyperlink")+"</a></li><li id='summaryCell'><a>"+this._getLocalizedLabels("EnableSummaryCellHyperlink")+"</a></li></ul></li>",d="<li><a>"+this._getLocalizedLabels("Exporting")+"</a><ul><li id='excel'><a>"+this._getLocalizedLabels("Excel")+"</a></li><li id='word'><a>"+this._getLocalizedLabels("Word")+"</a></li><li id='pdf'><a>"+this._getLocalizedLabels("PDF")+"</a></li><li id='csv'><a>"+this._getLocalizedLabels("CSV")+"</a></li></ul></li>",h="<li class='e-separator'><a>"+this._getLocalizedLabels("FrozenHeader")+"</a><ul><li id='row'><a>"+this._getLocalizedLabels("Row")+"</a></li><li id='column'><a>"+this._getLocalizedLabels("Column")+"</a></li></ul></li>",c=t.buildTag("ul#"+this._id+"contextMenu.e-pivotGridContextMenu",t.buildTag("li.e-cellSelect",t.buildTag("a",this._getLocalizedLabels("CellSelection"))[0].outerHTML)[0].outerHTML+t.buildTag("li.e-columnResize",t.buildTag("a",this._getLocalizedLabels("ColumnResize"))[0].outerHTML)[0].outerHTML+t.buildTag("li.e-toolTip",t.buildTag("a",this._getLocalizedLabels("ToolTip"))[0].outerHTML)[0].outerHTML+o+l+t.buildTag("li.groupingBar",t.buildTag("a",this._getLocalizedLabels("GroupingBar"))[0].outerHTML)[0].outerHTML+("pivot"==this.model.analysisMode?t.buildTag("li.e-cellEditing",t.buildTag("a",this._getLocalizedLabels("CellEditing"))[0].outerHTML)[0].outerHTML:"")+t.buildTag("li.e-drillThrough",t.buildTag("a",this._getLocalizedLabels("DrillThrough"))[0].outerHTML)[0].outerHTML+t.buildTag("li.rtl",t.buildTag("a",this._getLocalizedLabels("RTL"))[0].outerHTML)[0].outerHTML+n+a+d+h+t.buildTag("li.e-summaryCustomize",t.buildTag("a",this._getLocalizedLabels("SummaryCustomization"))[0].outerHTML)[0].outerHTML+t.buildTag("li.e-conditionalFormat",t.buildTag("a",this._getLocalizedLabels("ConditionalFormatting"),{})[0].outerHTML)[0].outerHTML+("pivot"==this.model.analysisMode?t.buildTag("li.e-calculatedField",t.buildTag("a",this._getLocalizedLabels("CalculatedField"))[0].outerHTML)[0].outerHTML+s+(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?t.buildTag("li.e-summaryTypes",t.buildTag("a",this._getLocalizedLabels("SummaryTypes"),{})[0].outerHTML)[0].outerHTML:""):""))[0].outerHTML;e("#"+this._id).append(c),e("li.rtl").addClass("e-separator"),r=this.element.find(".e-pivotGridTable"),this.element.find("#"+this._id+"contextMenu").ejMenu({width:"200px",menuType:t.MenuType.ContextMenu,contextMenuTarget:r,enableRTL:this.model.enableRTL,click:t.proxy(this._contextMenuClick,this)}),this._stateMaintenance()}})),this._on(e(document),"keydown",this._keyDownPress),this._on(e(document),"keyup",this._keyUpPress),this._on(this.element.find("a.e-linkPanel"),"click",t.Pivot._editorLinkPanelClick),this.model.enableCellSelection&&(this._on(this.element,"mousedown touchstart",".value",this._initCellSelection),this._on(this.element,"click",".colheader,.rowheader",this._headerClickCellSelection)),1==this.enableCellContext()&&(document.addEventListener?(document.removeEventListener("contextmenu",this._cellContext,!1),document.addEventListener("contextmenu",this._cellContext,!1)):(document.detachEvent("oncontextmenu",this._cellContext),document.attachEvent("oncontextmenu",this._cellContext))),this._on(this.element,"mouseover",".e-pivotButton",t.proxy(function(e){this._isDragging&&(this.element.append(t.buildTag("span.e-dropIndicator e-dropIndicatorActive")[0].outerHTML),e.target.className.indexOf("e-pivotButton")>=0?this.element.find(".e-dropIndicator").css("top",e.target.getBoundingClientRect().top-20).css("left",e.target.getBoundingClientRect().left-3):this.element.find(".e-dropIndicator").css("top",e.target.parentElement.getBoundingClientRect().top-20).css("left",e.target.parentElement.getBoundingClientRect().left-3))},this)),this._on(this.element,"mouseleave",".e-pivotButton",t.proxy(function(){this._isDragging&&this.element.find(".e-dropIndicator").removeClass("e-dropIndicatorActive")},this)),this._on(this.element,"click","#preventDiv",t.proxy(function(){this.element.find(".e-dialog.e-advancedFilterDlg:visible").length>0&&(this.element.find(".e-dialog.e-advancedFilterDlg").hide(),this.element.find("#preventDiv").remove())},this)),this.model.enableCellEditing&&this._on(this.element,"mousedown",".value",this._initCellEditing),this.drillDownHandler=e.proxy(this._drillDown,this),this.addHyperlinkHandler=e.proxy(this._addHyperlink,this),this.removeHyperlinkHandler=e.proxy(this._removeHyperlink,this),this.model.enableCellSelection&&(e(document).on("click",this._clearSelection),e(document).on("keyup",this._endCellSelection),e(document).on("keydown",this._startCellSelection)),this._on(this.element,"mouseover",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?".value .cellValue, .rowheader .cellValue, .colheader .cellValue":".value .cellValue, .rowheader .cellValue, .colheader .cellValue, .summary .cellValue",this.addHyperlinkHandler),this._on(this.element,"mouseleave",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?".value, .rowheader, .colheader":".value .cellValue, .rowheader .cellValue, .colheader .cellValue, .summary .cellValue",this.removeHyperlinkHandler),this._on(this.element,"click",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?".value .cellValue, .rowheader .cellValue, .colheader .cellValue":".value .cellValue, .rowheader .cellValue, .colheader .cellValue, .summary .cellValue",function(i){if(-1!=i.target.className.indexOf("hyperlink")){var r=null!=this._excelLikeJSONRecords&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?e(i.target.parentElement).attr("data-i"):e(i.target.parentElement).attr("data-p"),l=null!=this._excelLikeJSONRecords&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this._excelLikeJSONRecords[parseInt(parseInt(r.split(",")[0])*this._rowCount+parseInt(r.split(",")[1]))].Info:this.getJSONRecords()[parseInt(parseInt(r.split(",")[0])*this._excelRowCount+parseInt(r.split(",")[1]))].Info,n={cellValue:i.target.innerHTML,cellPosition:r,cellType:i.target.parentElement.className.split(" ")[0],uniqueName:l.split("::")[0],args:i,rawdata:l};this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&i.target.parentElement.className.indexOf("summary")>=0||i.target.parentElement.className.indexOf("summary value")>=0?t.isNullOrUndefined(this._pivotClientObj)?this._trigger("summaryCellHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n}):this._pivotClientObj._trigger("summaryCellHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n}):i.target.parentElement.className.indexOf("value")>=0?t.isNullOrUndefined(this._pivotClientObj)?this._trigger("valueCellHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n}):this._pivotClientObj._trigger("valueCellHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n}):i.target.parentElement.className.indexOf("rowheader")>=0?t.isNullOrUndefined(this._pivotClientObj)?this._trigger("rowHeaderHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n}):this._pivotClientObj._trigger("rowHeaderHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n}):i.target.parentElement.className.indexOf("colheader")>=0&&(t.isNullOrUndefined(this._pivotClientObj)?this._trigger("columnHeaderHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n}):this._pivotClientObj._trigger("columnHeaderHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:n})),i.target.parentElement.className.indexOf("value")>=0&&this.model.enableDrillThrough&&(this._rowHeader=[],this._colHeader=[],this.model.analysisMode==t.Pivot.AnalysisMode.Olap?t.Pivot._drillThroughCellClick(i,this):this._cellRangeInfo(i))}}),this._on(this.element,"click",this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?".rowheader, .colheader, .summary":".rowheader, .colheader",function(i){var r,l,n,s,o,a,d,h;if(this.model.enableCellSelection&&(!e(i.target).hasClass("cellValue")||!e(i.target).hasClass("hyperlinkHeaderCell")))if(r=e(i.target).hasClass("cellValue")?i.target.parentElement:i.target,i.shiftKey){if(window.getSelection().removeAllRanges(),e(this.element).find(".e-selected").removeClass("e-selected"),l=e(this._selectedCell).attr("data-p"),n=e(r).attr("data-p"),(e(r).hasClass("rowheader")||"rowheader"==e(r).attr("role"))&&(e(this._selectedCell).hasClass("rowheader")||"rowheader"==e(this._selectedCell).attr("role")))for(a=Math.min(l.split(",")[1],n.split(",")[1]);a<=Math.max(l.split(",")[1],n.split(",")[1]);a++)this.element.find("[data-p='"+l.split(",")[0]+","+a+"']").addClass("e-selected");if((e(r).hasClass("colheader")||"columnheader"==e(r).attr("role"))&&(e(this._selectedCell).hasClass("colheader")||"columnheader"==e(this._selectedCell).attr("role")))for(a=Math.min(l.split(",")[0],n.split(",")[0]);a<=Math.max(l.split(",")[0],n.split(",")[0]);a++)this.element.find("[data-p='"+a+","+l.split(",")[1]+"']").addClass("e-selected");if((s=e(this.element).find(".e-selected")).length>0){for(o=[],a=0;a<s.length;a++)d=e(s[a]).attr("data-p"),(h=this.getJSONRecords()[parseInt(parseInt(d.split(",")[0])*this._rowCount+parseInt(d.split(",")[1]))]).Value=e.trim(e(s[a]).text()),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(h.Field=this._getFieldName(s[a])),o.push(h);t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellSelection",{JSONRecords:o}):this._pivotClientObj._trigger("cellSelection",o)}}else i.ctrlKey||e(this.element).find(".e-selected").removeClass("e-selected"),(e(r).hasClass("colheader")||e(r).hasClass("rowheader")||"rowheader"==e(r).attr("role")||"columnheader"==e(r).attr("role"))&&(i.ctrlKey?e(r).toggleClass("e-selected"):e(r).addClass("e-selected"),this._selectedCell=r,this._primaryCellPos=e(r).attr("data-p"),(h=this.getJSONRecords()[parseInt(parseInt(this._primaryCellPos.split(",")[0])*this._rowCount+parseInt(this._primaryCellPos.split(",")[1]))]).Value=e.trim(e(r).text()),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(h.Field=this._getFieldName(r)),i.ctrlKey||(t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellSelection",{JSONRecords:[h]}):this._pivotClientObj._trigger("cellSelection",{JSONRecords:[h]})))}),t.isNullOrUndefined(this._pivotClientObj)?this._on(this.element,"click","table .e-expand,table .e-collapse",t.proxy(this._drillDown,this)):this._pivotClientObj.model.enableDeferUpdate||this._on(this.element,"click","table .e-expand,table .e-collapse",t.proxy(this._drillDown,this)),this._on(this.element,"mouseover",".colheader, .rowheader, .e-expand, .e-collapse",function(t){if(t.target.className.indexOf("e-expand")>-1&&!e(t.target).hasClass("header-hover-expand"))e(t.target).addClass("header-hover-expand");else if(t.target.className.indexOf("e-collapse")>-1&&!e(t.target).hasClass("header-hover-collapse"))e(t.target).addClass("header-hover-collapse");else if((t.target.className.indexOf("e-expand")<0||t.target.className.indexOf("e-collapse")<0)&&e(t.target).children("span").length>0){var i=e(t.target).children("span")[0];!e(i).hasClass("header-hover-expand")&&i.className.indexOf("e-expand")>-1?e(i).addClass("header-hover-expand"):!e(i).hasClass("header-hover-collapse")&&i.className.indexOf("e-collapse")>-1&&e(i).addClass("header-hover-collapse")}}),this._on(this.element,"mouseleave",".colheader, .rowheader, .e-expand, .e-collapse",function(){this.element.find(".e-expand, .e-collapse").removeClass("header-hover-expand header-hover-collapse")}),this.model.enableToolTip&&(this._on(this.element,"mouseover",".value",this._applyToolTip),this._on(this.element,"mouseleave",".value",function(){this.model.enableToolTipAnimation?e("#"+this._id+"_gridTooltip").hide("slow"):e("#"+this._id+"_gridTooltip").hide()})),this.model.enableDrillThrough&&e.proxy(this._addHyperlink,this),this._on(this.element,"click",".filter",t.proxy(this._filterBtnClick,this)),this._on(this.element,"click",".e-sorting",t.proxy(this._sortBtnClick,this)),this._on(this.element,"click",".e-memberAscendingIcon, .e-memberDescendingIcon",t.proxy(t.Pivot._memberSortBtnClick,this)),this._on(this.element,"click",".e-removeBtn",t.proxy(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._removePvtBtn:this._clientRemovePvtBtn,this)),this._on(this.element,"click",".e-ascOrder, .e-descOrder",t.proxy(this._sortField,this)),this._on(this.element,"mouseover",".e-pvtBtn",function(t){e(t.target.parentElement).addClass("e-btn e-select")}),this._on(this.element,"mouseleave",".e-pvtBtn",function(t){e(t.target.parentElement).removeClass("e-btn e-select"),e(t.target).removeClass("e-hoverBtn")}),this._on(this.element,"mouseover",".e-pivotButton",function(t){t.target.title=t.target.textContent,e(t.target).find("button").addClass("e-hoverBtn")}),this._on(this.element,"mouseleave",".e-pivotButton",function(t){e(t.target).find("button").removeClass("e-hoverBtn")}),this._on(this.element,"mouseover",".filter,.e-sorting,.e-removeBtn",function(t){e(t.target.parentElement).find("button").addClass("e-hoverBtn")}),this._on(this.element,"mouseleave",".filter,.e-sorting,.e-removeBtn",function(t){e(t.target.parentElement).find("button").removeClass("e-hoverBtn")}),this._on(this.element,"mouseleave",".value,.rowheader,.colheader,.summary",t.proxy(function(t){var i,r,l=e(t.target).find(".cellValue").contents().filter(function(){return 3==this.nodeType});0!=l.text()&&(r=(i=e(t.target).find(".valueSorting").length>0)?e(t.target).find(".valueSorting"):"",e(t.target).find(".valueSorting").remove(),e(t.target).find(".cellValue").remove(),e(t.target).append(l.text()),i&&(e(t.target).hasClass("colheader")||e(t.target).hasClass("summary"))&&e(t.target).hasClass("calc")&&!e(t.target).hasClass("rowheader")&&e(t.target).append(r))})),this._on(this.element,"click",".e-close",t.proxy(function(){this.element.find("#preventDiv").remove()})),this._on(this.element,"click",".e-dialogOkBtn",t.proxy(this._dialogOKBtnClick,this)),(this.model.enableContextMenu||e(this.element).parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableToolBar&&!this._pivotClientObj.model.displaySettings.enableFullScreen)&&(this._on(this.element,"click",".e-cellSelect",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-columnResize",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-excelLikeLayout",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-advancedFiltering",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-toolTip",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-collapseByDefault",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".rtl",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-calculatedField",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-cellEditing",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-conditionalFormat",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-summaryCustomize",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-summaryTypes",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-numberFormatting",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-rowHeaderHyperLink",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-colHeaderHyperLink",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-valueCellHyperLink",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-summaryCellHyperLink",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-rowFreeze",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-colFreeze",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-excel",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-word",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-pdf",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".csv",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-normalLayout",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-normalTopSummaryLayout",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-noSummariesLayout",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-drillThrough",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".groupingBar",t.proxy(this._contextMenuClick,this)),this._on(this.element,"click",".e-frozenHeaders",t.proxy(this._createMenuIcons,this)),this._on(this.element,"click",".e-exporting",t.proxy(this._createMenuIcons,this)),this._on(this.element,"click",".e-hyperlinkOptions",t.proxy(this._createMenuIcons,this)),this._on(this.element,"click",".e-layouts",t.proxy(this._createMenuIcons,this)),e(document).click(function(t){-1==t.target.className.indexOf("e-hyperlinkOptions")&&e(".e-hyperLinkDialog").remove(),-1==t.target.className.indexOf("e-exporting")&&e(".e-exportDialog").remove(),-1==t.target.className.indexOf("e-frozenHeaders")&&e(".e-frozenDialog").remove(),-1==t.target.className.indexOf("e-layouts")&&e(".e-layoutsDialog").remove()})),this._on(this.element,"click",".e-dialogCancelBtn",t.proxy(function(){this.element.find(".e-dialog, .e-clientDialog").hide(),e("#preventDiv").remove()})),this.model.enableColumnResizing&&(this._on(this.element,"mousemove",t.proxy(function(e){this._colResizing(e)})),this._on(this.element,"mousedown","thead,.pivotGridFrozenTable,.pivotGridColValueTable",t.proxy(function(e){this._startColResizing(e)})),this._on(this.element,"mouseup",".e-reSizeColbg",t.proxy(function(e){this._endColResizing(e)}))),this._on(this.element,"click",".e-nextPage, .e-prevPage, .e-firstPage, .e-lastPage",t.proxy(this._navigateTreeData,this)),this._on(this.element,"click",".e-searchEditorTree",t.proxy(function(e){t.Pivot._searchEditorTreeNodes(e,this)},this)),this._on(this.element,"click",".colheader,.cstot,.cgtot,.calc,.stot,.gtot",t.proxy(function(i){var r,l,n,s,o,a;if(e(i.target).hasClass("e-collapse")||e(i.target).hasClass("e-expand"))return!1;if(!t.isNullOrUndefined(this.model.valueSortSettings)&&!t.isNullOrUndefined(this.model.valueSortSettings.sortOrder)&&"none"!=this.model.valueSortSettings.sortOrder&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.dataSource.values.length>0||this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&JSON.parse(this.getOlapReport()).PivotCalculations.length>0)){if(r=this.model.valueSortSettings.sortOrder,(l=e(i.target).hasClass("cellValue")||e(i.target).hasClass("valueSorting")||e(i.target).hasClass("e-expand")||e(i.target).hasClass("e-collapse")?e(i.target).parent():e(i.target)).hasClass("calc")||(l=e(this.element).find("[data-p='"+(Number(l.attr("data-p").split(",")[0])+Number(l.attr("colspan"))-1)+","+(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.columns.length:JSON.parse(this.getOlapReport()).PivotColumns.length)+"']")[0]),r=e(l).find(".valueSorting").length>0?e(l).find(".valueSorting").hasClass("descending")?"ascending":"descending":r,this.element.find(".valueSorting").remove(),0!=e(l).find(".valueSorting").length||e(l).hasClass("rowheader")?e(l).find(".valueSorting").removeClass("ascending").removeClass("descending").addClass(r):(n=t.buildTag("span.valueSorting e-icon "+r).css("margin-left","5px").attr("role","button").attr("aria-label","sort")[0].outerHTML,e(l).append(n)),s=JSON.stringify(this.model.customObject),t.PivotAnalysis._valueSorting=Number(e(l).attr("data-p").split(",")[0]),t.PivotAnalysis._sort=r,this._waitingPopup=t.isNullOrUndefined(this._pivotClientObj)?this.element.data("ejWaitingPopup"):this._pivotClientObj.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)this.refreshControl(),t.isNullOrUndefined(this._pivotClientObj)||"gridOnly"==this._pivotClientObj.displayMode()||(this._pivotClientObj._pivotChart._labelCurrentTags.expandedMembers=null,this._pivotClientObj._pivotChart.setPivotEngine(this._pivotEngine.pivotEngine),this._pivotClientObj._pivotChart._generateData(this._pivotEngine.pivotEngine),this._pivotEngine=null);else{for(o="",a=0;a<this.getJSONRecords().length;a++)Number(this.getJSONRecords()[a].Index.split(",")[0])==t.PivotAnalysis._valueSorting&&Number(this.getJSONRecords()[a].Index.split(",")[1])<JSON.parse(this.getOlapReport()).PivotColumns.length+1&&(o=""==o?-1==this.getJSONRecords()[a].Value.indexOf(".")?this.getJSONRecords()[a].Value:this.getJSONRecords()[a].Value.split(".")[1]:o+this.model.valueSortSettings.headerDelimiters+(-1==this.getJSONRecords()[a].Value.indexOf(".")?this.getJSONRecords()[a].Value:this.getJSONRecords()[a].Value.split(".")[1]));this.model.valueSortSettings.index=t.PivotAnalysis._valueSorting,this.model.valueSortSettings.headerText=o,this.model.valueSortSettings.sortOrder=r,t.isNullOrUndefined(this._pivotClientObj)?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.valueSorting,JSON.stringify({action:"valueSorting",valueSorting:JSON.stringify(this.model.valueSortSettings),currentReport:JSON.parse(this.getOlapReport()).Report,customObject:s}),this._renderControlSuccess):this._pivotClientObj.doAjaxPost("POST",this._pivotClientObj.model.url+"/"+this._pivotClientObj.model.serviceMethodSettings.valueSorting,JSON.stringify({action:"valueSorting",valueSorting:JSON.stringify(this.model.valueSortSettings),currentReport:JSON.parse(this._pivotClientObj.getOlapReport()).Report,customObject:s}),this._pivotClientObj._renderControlSuccess),delete this.model.valueSortSettings.index}t.isNullOrUndefined(this._pivotClientObj)||(this._pivotClientObj.model.valueSortSettings=this.model.valueSortSettings)}}))},_navigateTreeData:function(e){t.Pivot.editorTreeNavigatee(e,this)},_stateMaintenance:function(){var i=t.buildTag("span.e-enabledState").addClass("e-icon").attr("aria-label",this._getLocalizedLabels("EnabledState"))[0].outerHTML;this.model.dataSource.enableAdvancedFilter&&(this.element.parents(".e-pivotclient").length>0?e(".e-advancedFiltering").addClass("e-enabled"):e(".e-advancedFiltering a:eq(0)").append(i)),this.model.enableDrillThrough&&(e(".e-drillThrough a:eq(0)").append(i),e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("CellEditing"))),this.element.parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableDrillThrough&&(this.element.find(".e-drillThrough").addClass("e-enabled"),this.element.find(".toolBar").ejToolbar("disableItemByID","cellEditing")),!this.model.enableToolTip||this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||(this.element.parents(".e-pivotclient").length>0?e(".e-toolTip").addClass("e-enabled"):e(".e-toolTip a:eq(0)").append(i)),this.model.enableCellSelection&&(e(".e-cellSelect a:eq(0)").append(i),e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("CellEditing"))),this.model.enableColumnResizing&&(this.element.parents(".e-pivotclient").length>0?(e(".e-columnResize").addClass("e-enabled"),e(".toolBar").ejToolbar("disableItemByID","collapseByDefault")):(e(".e-columnResize a:eq(0)").append(i),e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("CollapseByDefault")))),this.model.enableGroupingBar&&e(".groupingBar a:eq(0)").append(i),this.model.enableRTL&&(this.element.parents(".e-pivotclient").length>0?e(".rtl").addClass("e-enabled"):e(".rtl a:eq(0)").append(i)),this.model.enableCollapseByDefault&&(this.element.parents(".e-pivotclient").length>0?(e(".toolBar").ejToolbar("disableItemByID","columnResize"),e(".e-collapseByDefault").addClass("e-enabled")):(e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("ColumnResize")),e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("FrozenHeader")),e(".e-collapseByDefault a:eq(0)").append(i))),this.model.enableCellEditing&&(this.element.parents(".e-pivotclient").length>0?(this.element.find(".e-cellEditing").addClass("e-enabled"),this.element.find(".toolBar").ejToolbar("disableItemByID","drillThrough")):e(".e-cellEditing a:eq(0)").append(i),e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("DrillThrough")),e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("CellSelection"))),this.model.frozenHeaderSettings.enableFrozenRowHeaders&&e("li#row a:eq(0)").append(i),this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&e("li#column a:eq(0)").append(i),this.model.hyperlinkSettings.enableRowHeaderHyperlink&&e("li#rowHeader a:eq(0)").append(i),this.model.hyperlinkSettings.enableColumnHeaderHyperlink&&e("li#columnHeader a:eq(0)").append(i),this.model.hyperlinkSettings.enableValueCellHyperlink&&e("li#valueCell a:eq(0)").append(i),this.model.hyperlinkSettings.enableSummaryCellHyperlink&&e("li#summaryCell a:eq(0)").append(i),this.model.layout==t.PivotGrid.Layout.Normal&&e("li#normalLayout a:eq(0)").append(i),this.model.layout==t.PivotGrid.Layout.NoSummaries&&e("li#noSummariesLayout a:eq(0)").append(i),this.model.layout==t.PivotGrid.Layout.ExcelLikeLayout&&e("li#excelLikeLayout a:eq(0)").append(i),this.model.layout==t.PivotGrid.Layout.NormalTopSummary&&e("li#normalTopSummaryLayout a:eq(0)").append(i),(this.model.layout==t.PivotGrid.Layout.NormalTopSummary||this.model.layout==t.PivotGrid.Layout.ExcelLikeLayout||this.model.layout==t.PivotGrid.Layout.NoSummaries||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&(this.element.parents(".e-pivotclient").length>0?e(".toolBar").ejToolbar("disableItemByID","summaryCustomize"):e("#"+this._id+"contextMenu").ejMenu("disableItem",this._getLocalizedLabels("SummaryCustomization")))},_contextMenuClick:function(i){var l,n;t.buildTag("span.e-enabledState").addClass("e-icon").attr("aria-label","")[0].outerHTML,this.element.parents(".e-pivotclient").length>0?e(i.target):e(i.element);(e(i.element).hasClass("e-numberFormatting")||e(i.target).hasClass("e-numberFormatting"))&&this._createMenuDialog(i),(e(i.element).hasClass("e-cellSelect")||e(i.target).hasClass("e-cellSelect"))&&(this.model.enableCellSelection=!this.model.enableCellSelection,this.model.enableCellEditing=!1,this.renderControlFromJSON()),(e(i.element).hasClass("e-columnResize")||e(i.target).hasClass("e-columnResize"))&&!this.model.enableCollapseByDefault&&(this.model.enableColumnResizing=!this.model.enableColumnResizing,this.renderControlFromJSON()),(e(i.element).hasClass("e-toolTip")||e(i.target).hasClass("e-toolTip"))&&(this.model.enableToolTip=!this.model.enableToolTip,this.renderControlFromJSON()),!e(i.element).hasClass("e-collapseByDefault")&&!e(i.target).hasClass("e-collapseByDefault")||this.model.enableColumnResizing||this.model.enableFrozenColumnHeaders||this.model.enableFrozenRowHeaders||(this.model.enableCollapseByDefault?this.model.enableCollapseByDefault=!1:(this.model.enableCollapseByDefault=!0,this.model.collapsedMembers=null),this.renderControlFromJSON()),(e(i.element).hasClass("rtl")||e(i.target).hasClass("rtl"))&&(this.model.enableRTL=!this.model.enableRTL,this.renderControlFromJSON()),(e(i.element).hasClass("e-calculatedField")||e(i.target).hasClass("e-calculatedField"))&&this._createCalculatedField(),(e(i.element).hasClass("e-cellEditing")||e(i.target).hasClass("e-cellEditing"))&&(this.model.enableCellEditing=!this.model.enableCellEditing,this.model.enableDrillThrough=!1,this.model.enableCellSelection=!1,this.renderControlFromJSON()),(e(i.element).hasClass("e-drillThrough")||e(i.target).hasClass("e-drillThrough"))&&(this.model.analysisMode==t.Pivot.AnalysisMode.Olap?(dialogTitle="Cube Configuration",dialogContent="<p>Please configure cube!</p>",l=t.buildTag("div#clientDialog.e-clientDialog",{opacity:"1"}).attr("title",dialogTitle)[0].outerHTML,e(l).appendTo("#"+this._id),e(dialogContent).appendTo(this.element.find(".e-clientDialog")),this.element.find(".e-clientDialog").ejDialog({enableRTL:this.model.enableRTL,width:200,target:"#"+this._id,enableResize:!1,close:t.proxy(t.Pivot.closePreventPanel,this)})):this.element.parents(".e-pivotclient").length>0?(this._pivotClientObj.model.enableDrillThrough=!this._pivotClientObj.model.enableDrillThrough,this.model.enableDrillThrough=this._pivotClientObj.model.enableDrillThrough,this.model.enableCellEditing=!1,this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.renderControlFromJSON():this._pivotClientObj._load()):(this.model.enableDrillThrough=!this.model.enableDrillThrough,this.model.enableCellEditing=!1,this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.renderControlFromJSON():this._load())),(e(i.element).hasClass("e-summaryCustomize")||e(i.target).hasClass("e-summaryCustomize"))&&this._createMenuDialog(i),(e(i.element).hasClass("e-conditionalFormat")||e(i.target).hasClass("e-conditionalFormat"))&&(this.element.parents(".e-pivotclient").length>0&&"clientmode"==this._pivotClientObj.model.operationalMode&&this.setOlapReport(this._pivotClientObj.model.dataSource),this.model.enableConditionalFormatting=!0,this.openConditionalFormattingDialog(),t.Pivot.closePreventPanel(this)),(e(i.element).hasClass("e-summaryTypes")||e(i.target).hasClass("e-summaryTypes"))&&this._createMenuDialog(i),(e(i.element).hasClass("e-advancedFiltering")||e(i.target).hasClass("e-advancedFiltering"))&&(this.model.dataSource.enableAdvancedFilter=!this.model.dataSource.enableAdvancedFilter,this.renderControlFromJSON()),e(i.element).hasClass("groupingBar")&&(this.model.enableGroupingBar=!this.model.enableGroupingBar,this.renderControlFromJSON()),("undefined"!=i.element&&i.parentText==this._getLocalizedLabels("Layouts")||e(i.target).parents().hasClass("e-layoutsDialog"))&&(("normalLayout"==i.ID||e(i.target).hasClass("e-normalLayout"))&&(this.model.layout=t.PivotGrid.Layout.Normal,this.element.parents(".e-pivotclient").length>0&&(this._pivotClientObj.model.gridLayout="normal")),("excelLikeLayout"==i.ID||e(i.target).hasClass("e-excelLikeLayout"))&&(this.model.layout=t.PivotGrid.Layout.ExcelLikeLayout,this.element.parents(".e-pivotclient").length>0&&(this._pivotClientObj.model.gridLayout="excellikelayout")),("noSummariesLayout"==i.ID||e(i.target).hasClass("e-noSummariesLayout"))&&(this.model.layout=t.PivotGrid.Layout.NoSummaries,this.element.parents(".e-pivotclient").length>0&&(this._pivotClientObj.model.gridLayout="nosummaries")),("normalTopSummaryLayout"==i.ID||e(i.target).hasClass("e-normalTopSummaryLayout"))&&(this.model.layout=t.PivotGrid.Layout.NormalTopSummary,this.element.parents(".e-pivotclient").length>0&&(this._pivotClientObj.model.gridLayout="normaltopsummary")),"excelLikeLayout"==i.ID||e(i.target).hasClass("e-excelLikeLayout")?this.excelLikeLayout(this.getJSONRecords()):(this._excelLikeJSONRecords=null,this.refreshPivotGrid())),("undefined"!=i.element&&i.parentText==this._getLocalizedLabels("HyperLink")||e(i.target).parents().hasClass("e-hyperLinkDialog"))&&(("rowHeader"==i.ID||e(i.target).hasClass("e-rowHeaderHyperLink"))&&(this.model.hyperlinkSettings.enableRowHeaderHyperlink=!this.model.hyperlinkSettings.enableRowHeaderHyperlink),("columnHeader"==i.ID||e(i.target).hasClass("e-colHeaderHyperLink"))&&(this.model.hyperlinkSettings.enableColumnHeaderHyperlink=!this.model.hyperlinkSettings.enableColumnHeaderHyperlink),("valueCell"==i.ID||e(i.target).hasClass("e-valueCellHyperLink"))&&(this.model.hyperlinkSettings.enableValueCellHyperlink=!this.model.hyperlinkSettings.enableValueCellHyperlink),("summaryCell"==i.ID||e(i.target).hasClass("e-summaryCellHyperLink"))&&(this.model.hyperlinkSettings.enableSummaryCellHyperlink=!this.model.hyperlinkSettings.enableSummaryCellHyperlink),this.renderControlFromJSON()),(i.element!=r&&i.parentText==this._getLocalizedLabels("Exporting")||e(i.target).parents().hasClass("e-exportDialog"))&&(n=this.element.parents(".e-pivotclient").length>0?e(i.target).attr("class").split(" ")[0]:i.ID,this.element.parents(".e-pivotclient").length>0&&!t.isNullOrUndefined(this._pivotClientObj)&&(this.model.beforeExport=this._pivotClientObj.model.beforeExport),this.exportPivotGrid(n,"Sample")),(i.element!=r&&i.parentText==this._getLocalizedLabels("FrozenHeader")||e(i.target).parents().hasClass("e-frozenDialog"))&&(("row"==i.ID||e(i.target).hasClass("e-rowFreeze"))&&(this.model.frozenHeaderSettings.enableFrozenRowHeaders=!this.model.frozenHeaderSettings.enableFrozenRowHeaders),("column"==i.ID||e(i.target).hasClass("e-colFreeze"))&&(this.model.frozenHeaderSettings.enableFrozenColumnHeaders=!this.model.frozenHeaderSettings.enableFrozenColumnHeaders),this.renderControlFromJSON()),this._unWireEvents(),this._wireEvents()},_createMenuIcons:function(i){var r,l,n,s;e(i.target).hasClass("e-exporting")&&(r=t.buildTag("div.e-exportDialog#exportDialog",t.buildTag("table",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.e-excel e-exportingIcons").attr({"aria-label":this._getLocalizedLabels("Excel"),title:this._getLocalizedLabels("Excel"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.e-word e-exportingIcons").attr({"aria-label":this._getLocalizedLabels("Word"),title:this._getLocalizedLabels("Word"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.e-pdf e-exportingIcons").attr({"aria-label":this._getLocalizedLabels("PDF"),title:this._getLocalizedLabels("PDF"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.csv e-exportingIcons").attr({"aria-label":this._getLocalizedLabels("CSV"),title:this._getLocalizedLabels("CSV"),tabindex:0})[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML,0==this.element.find("div .e-exportDialog").length&&(e(r).appendTo(this.element),e(".e-exportDialog").css("left",i.target.offsetLeft+20+"px").css("top",i.target.offsetTop+15+"px"))),e(i.target).hasClass("e-hyperlinkOptions")&&(l=t.buildTag("div.e-hyperLinkDialog#hyperLinkTypesDialog",t.buildTag("table",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.e-rowHeaderHyperLink e-hyperLinkIcons").attr({"aria-label":this._getLocalizedLabels("EnableRowHeaderHyperlink"),title:this._getLocalizedLabels("EnableRowHeaderHyperlink"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.e-colHeaderHyperLink e-hyperLinkIcons").attr({"aria-label":this._getLocalizedLabels("EnableColumnHeaderHyperlink"),title:this._getLocalizedLabels("EnableColumnHeaderHyperlink"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.e-valueCellHyperLink e-hyperLinkIcons").attr({"aria-label":this._getLocalizedLabels("EnableValueCellHyperlink"),title:this._getLocalizedLabels("EnableValueCellHyperlink"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.e-summaryCellHyperLink e-hyperLinkIcons").attr({"aria-label":this._getLocalizedLabels("EnableSummaryCellHyperlink"),title:this._getLocalizedLabels("EnableSummaryCellHyperlink"),tabindex:0})[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML),0==this.element.find("div.e-hyperLinkDialog").length&&(e(l).appendTo(this.element),e(l).css("left",i.target.offsetLeft+20+"px").css("top",i.target.offsetTop+15+"px"),this.model.hyperlinkSettings.enableRowHeaderHyperlink&&this.element.find(".e-rowHeaderHyperLink").addClass("e-enabled"),this.model.hyperlinkSettings.enableColumnHeaderHyperlink&&this.element.find(".e-colHeaderHyperLink").addClass("e-enabled"),this.model.hyperlinkSettings.enableValueCellHyperlink&&this.element.find(".e-valueCellHyperLink").addClass("e-enabled"),this.model.hyperlinkSettings.enableSummaryCellHyperlink&&this.element.find(".e-summaryCellHyperLink").addClass("e-enabled"))),e(i.target).hasClass("e-frozenHeaders")&&(n=t.buildTag("div.e-frozenDialog#frozenDialog",t.buildTag("table",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.e-rowFreeze e-frozenHeaderIcons").attr({"aria-label":this._getLocalizedLabels("Row"),title:this._getLocalizedLabels("Row"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.e-colFreeze e-frozenHeaderIcons").attr({"aria-label":this._getLocalizedLabels("Column"),title:this._getLocalizedLabels("Column"),tabindex:0})[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML,0==this.element.find("div.e-frozenDialog").length&&(e(n).appendTo(this.element),e(".e-frozenDialog").css("left",i.target.offsetLeft+20+"px").css("top",i.target.offsetTop+15+"px"),this.model.frozenHeaderSettings.enableFrozenRowHeaders&&this.element.find(".e-rowFreeze").addClass("e-enabled"),this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&this.element.find(".e-colFreeze").addClass("e-enabled"),this.model.frozenHeaderSettings.enableFrozenHeaders&&this.element.find(".bothFreeze").addClass("e-enabled"))),e(i.target).hasClass("e-layouts")&&(s=t.buildTag("div.e-layoutsDialog#layoutsDialog",t.buildTag("table",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td",t.buildTag("div.e-normalLayout e-layoutIcons").attr({"aria-label":this._getLocalizedLabels("NormalLayout"),title:this._getLocalizedLabels("NormalLayout"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("td",t.buildTag("div.e-excelLikeLayout e-layoutIcons").attr({"aria-label":this._getLocalizedLabels("ExcelLikeLayout"),title:this._getLocalizedLabels("ExcelLikeLayout"),tabindex:0})[0].outerHTML)[0].outerHTML+(this.model.analysisMode==t.Pivot.AnalysisMode.Olap?t.buildTag("td",t.buildTag("div.e-noSummariesLayout e-layoutIcons").attr({"aria-label":this._getLocalizedLabels("NoSummaries"),title:this._getLocalizedLabels("NoSummaries"),tabindex:0})[0].outerHTML)[0].outerHTML:"")+(this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?t.buildTag("td",t.buildTag("div.e-normalTopSummaryLayout e-layoutIcons").attr({"aria-label":this._getLocalizedLabels("NormalTopSummary"),title:this._getLocalizedLabels("NormalTopSummary"),tabindex:0})[0].outerHTML)[0].outerHTML:""))[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML,0==this.element.find("div .e-layoutsDialog").length&&(e(s).appendTo(this.element),e(".e-layoutsDialog").css("left",i.target.offsetLeft+20+"px").css("top",i.target.offsetTop+15+"px"),this.model.layout==t.PivotGrid.Layout.Normal&&this.element.find(".e-normalLayout").addClass("e-enabled"),this.model.layout==t.PivotGrid.Layout.ExcelLikeLayout&&this.element.find(".e-excelLikeLayout").addClass("e-enabled"),this.model.layout==t.PivotGrid.Layout.NoSummaries&&this.element.find(".e-noSummariesLayout").addClass("e-enabled"),this.model.layout==t.PivotGrid.Layout.NormalTopSummary&&this.element.find(".e-normalTopSummaryLayout").addClass("e-enabled")))},_createMenuDialog:function(i){var l,n,s,o,a,d,h,c,u,g,p;if(this._dialogName=t.isNullOrUndefined(i.target)?e(i.element).attr("class").split(" ")[0]:e(i.target).attr("class").split(" ")[0],t.Pivot.openPreventPanel(this),this.element.find(".e-dialog").remove(),l=t.buildTag("div#clientDialog.e-clientDialog",{opacity:"1"})[0].outerHTML,n=currentTag=dialogContent="",e(i.target).hasClass("e-numberFormatting")||e(i.element).hasClass("e-numberFormatting")){for(n=this._getLocalizedLabels("NumberFormatting"),currentTag="Number Formatting",s=t.buildTag("label",this._getLocalizedLabels("Measures"))[0].outerHTML,f="<select id='measureOption'>",h=0;h<this.model.dataSource.values.length;h++)f+="<option>"+this.model.dataSource.values[h].fieldName+"</option>";f+="</select>",o=t.buildTag("label",this._getLocalizedLabels("NumberFormats"))[0].outerHTML,a="<div class='summarTypes'><select id='numberFormatOption'><option value='Decimal'>Decimal</option><option value='Currency'>Currency</option><option value='Percentage'>Percentage</option><option value='Number'>Number</option><option value='Date'>Date</option><option value='Time'>Time</option><option value='Scientific'>Scientific</option><option value='Fraction'>Fraction</option></select></div>",dialogContent=t.buildTag("div#reportDlg.e-reportDlg","<table><tr><td>"+s+"</td><td>"+f+"</td></tr><tr><td>"+o+"</td><td>"+a+"</td></tr></table>")[0].outerHTML}if(e(i.target).hasClass("e-summaryCustomize")||e(i.element).hasClass("e-summaryCustomize")){n=this._getLocalizedLabels("SummaryCustomization");var m=t.buildTag("label",this._getLocalizedLabels("HideGrandTotal"))[0].outerHTML,_=t.buildTag("label",this._getLocalizedLabels("HideSubTotal"))[0].outerHTML,f="<div class='measures'><select id='hideSubTotal'>";if(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){for(h=0;h<this.model.dataSource.columns.length;h++)f+="<option>"+this.model.dataSource.columns[h].fieldCaption+"</option>";for(h=0;h<this.model.dataSource.rows.length;h++)f+="<option>"+this.model.dataSource.rows[h].fieldCaption+"</option>"}else if(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){for(d=e(this.element).parents(".e-pivotclient").length>0?this._pivotClientObj.getOlapReport():this.getOlapReport(),h=0;h<JSON.parse(d).PivotRows.length;h++)f+="<option>"+JSON.parse(d).PivotRows[h].FieldName+"</option>";for(h=0;h<JSON.parse(d).PivotColumns.length;h++)f+="<option>"+JSON.parse(d).PivotColumns[h].FieldName+"</option>"}f+="</div>";var b=t.buildTag("input#rowSumCheckBox.rowSumCheckBox","",{},{name:"row",type:"checkbox",tabindex:0})[0].outerHTML+" "+t.buildTag("label.rowGrndlabel",this._getLocalizedLabels("Row"))[0].outerHTML+"<br/>",C=t.buildTag("input#colSumCheckBox.colSumCheckBox","",{},{name:"column",type:"checkbox",tabindex:0})[0].outerHTML+" "+t.buildTag("label.colGrndlabel",this._getLocalizedLabels("Column"))[0].outerHTML+"<br/>",S=t.buildTag("input#bothSumCheckBox.bothSumCheckBox","",{},{name:"both",type:"checkbox",tabindex:0})[0].outerHTML+" "+t.buildTag("label.bothGrndlabel",this._getLocalizedLabels("Both"))[0].outerHTML+"<br/>";dialogContent="pivot"==this.model.analysisMode?t.buildTag("div#customizeDlg.customizeDlg","<table><tr><td style='vertical-align:top'>"+m+"</td><td>"+b+C+S+"</td></tr><tr><td>"+_+"</td><td>"+f+"</td></tr></table>")[0].outerHTML:t.buildTag("div#customizeDlg.customizeDlg","<table><tr><td>"+m+"</td><td>"+b+C+S+"</td></tr></table>")[0].outerHTML}if(e(i.target).hasClass("e-summaryTypes")||e(i.element).hasClass("e-summaryTypes")){if(n=this._getLocalizedLabels("SummaryTypes"),m=t.buildTag("label",this._getLocalizedLabels("Measures"))[0].outerHTML,this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){for(f="<div class='measures'><select id='drillMeasure'>",h=0;h<this.model.dataSource.values.length;h++)f+="<option>"+this.model.dataSource.values[h].fieldCaption+"</option>";f+="</div>"}_=t.buildTag("label",this._getLocalizedLabels("SummaryType"))[0].outerHTML,c=t.buildTag("input#drillSum").attr("type","text")[0].outerHTML,dialogContent=t.buildTag("div#summaryDlg.#summaryDlg","<table><tr><td>"+m+"</td><td>"+f+"</td></tr><tr><td>"+_+"</td><td>"+c+"</td></tr></table>")[0].outerHTML}u=t.buildTag("div#EditorDiv.e-editorDiv","",{"margin-left":"5px"})[0].outerHTML,dialogContent+=u,g="<button id=OKBtn class='e-dialogOkBtn'>"+this._getLocalizedLabels("OK")+"</button>",p="<button id=CancelBtn class='e-dialogCancelBtn'>"+this._getLocalizedLabels("Cancel")+"</button>",dialogFooter=t.buildTag("div.e-dialogFooter",g+p,{float:this.model.enableRTL?"left":"right",margin:"20px 0px 6px"})[0].outerHTML,e(l).appendTo("#preventDiv"),e(dialogContent+dialogFooter).appendTo(".e-clientDialog"),e(".e-clientDialog").ejDialog({enableRTL:this.model.enableRTL,width:"auto",target:"#"+this._id,enableResize:!1,close:t.Pivot.closePreventPanel(this)}),e(".e-titlebar").prepend(t.buildTag("div",n,{display:"inline"})[0].outerHTML)[0],e(".e-dialogOkBtn, .e-dialogCancelBtn").ejButton({width:"67px",enableRTL:this.model.enableRTL,type:t.ButtonType.Button}),e(".e-dialogOkBtn, .e-dialogCancelBtn").css({"margin-left":"10px"}),""==this._selectedFormat&&""==this._selectedMeasure&&(e("#numberFormatOption").ejDropDownList({enableRTL:this.model.enableRTL,selectedIndex:0,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#measureOption").ejDropDownList({enableRTL:this.model.enableRTL,selectedIndex:0,showCheckbox:!0,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}})),""!=this._selectedMeasure&&""!=this._selectedFormat&&(e("#numberFormatOption").ejDropDownList({enableRTL:this.model.enableRTL,text:this._selectedFormat,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#measureOption").ejDropDownList({enableRTL:this.model.enableRTL,text:this._selectedMeasure,showCheckbox:!0,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}})),e("#categoricalInput").ejMaskEdit({name:"mask",inputMode:t.InputMode.Text,watermarkText:"Column Page Size"}),e("#seriesInput").ejMaskEdit({name:"mask",inputMode:t.InputMode.Text,watermarkText:"Row Page Size"}),e("#rowSumCheckBox,#colSumCheckBox,#bothSumCheckBox").ejCheckBox({size:"small",showRoundedCorner:!0}),this.rowCheckBox=e("#rowSumCheckBox").data("ejCheckBox"),this.colCheckBox=e("#colSumCheckBox").data("ejCheckBox"),this.bothCheckBox=e("#bothSumCheckBox").data("ejCheckBox"),(e(i.target).hasClass("e-summaryCustomize")||e(i.element).hasClass("e-summaryCustomize"))&&(0==this.rowGrand&&this.rowCheckBox.setModel({checked:"checked"}),0==this.colGrand&&this.colCheckBox.setModel({checked:"checked"}),0==this.bothGrand&&this.bothCheckBox.setModel({checked:"checked"}),e("#hideSubTotal").ejDropDownList({showCheckbox:!0,enableRTL:this.model.enableRTL,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),this.dropmeasure=e("#hideSubTotal").data("ejDropDownList"),this.selval!=r&&this.dropmeasure.setModel({value:this.selval})),(e(i.target).hasClass("e-summaryTypes")||e(i.element).hasClass("e-summaryTypes"))&&(e("#_summaryOK,#_summaryCancel").ejButton({enableRTL:this.model.enableRTL}),e("#drillMeasure").ejDropDownList({selectedIndices:[0],enableRTL:this.model.enableRTL,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#drillSum").ejDropDownList({dataSource:[{option:"Sum",value:this._getLocalizedLabels("Sum")},{option:"Average",value:this._getLocalizedLabels("Average")},{option:"Count",value:this._getLocalizedLabels("Count")},{option:"Min",value:this._getLocalizedLabels("Min")},{option:"Max",value:this._getLocalizedLabels("Max")}],fields:{text:"value",value:"option"},selectedIndices:[0],enableRTL:this.model.enableRTL,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),drilmes=e("#drillMeasure").data("ejDropDownList"),drilsum=e("#drillSum").data("ejDropDownList"),this.drilsumval!=r&&drilmes.setModel({value:this.drilsumval}),null!=this.sumtyp&&drilsum.setModel({value:this.sumtyp}))},_dialogOKBtnClick:function(){var i,l,n,s,o,a,d,h,c,u;if("e-numberFormatting"==this._dialogName){for(this._selectedFormat=e("#numberFormatOption").ejDropDownList("getSelectedValue"),this._selectedMeasure=e("#measureOption").ejDropDownList("getSelectedValue"),i=this._selectedMeasure.split(","),this.element.find(".e-dialog").remove(),t.Pivot.closePreventPanel(this),c=0;c<this.model.dataSource.values.length;c++)for(l=0;l<i.length;l++)this.model.dataSource.values[c].fieldName==i[l]&&(this.model.dataSource.values[c].format=this._selectedFormat.toLowerCase());t.isNullOrUndefined(this._pivotClientObj)||"pivot"!=this._pivotClientObj.model.analysisMode||"clientmode"!=this._pivotClientObj.model.operationalMode||(this.model.collapsedMembers=null),this._populatePivotGrid()}if("e-summaryCustomize"==this._dialogName&&(pGridObj=this,t.isNullOrUndefined(this._pivotClientObj)||"pivot"!=this._pivotClientObj.model.analysisMode||"clientmode"!=this._pivotClientObj.model.operationalMode||(pGridObj.model.collapsedMembers=null),pGridObj.rowCheckBox.model.checked?(pGridObj.model.enableColumnGrandTotal=pGridObj.model.enableGrandTotal=!0,pGridObj.model.enableRowGrandTotal=pGridObj.rowGrand=!1):pGridObj.model.enableRowGrandTotal=pGridObj.rowGrand=!0,pGridObj.colCheckBox.model.checked?(pGridObj.model.enableRowGrandTotal=pGridObj.model.enableGrandTotal=!0,pGridObj.model.enableColumnGrandTotal=pGridObj.colGrand=!1):pGridObj.model.enableColumnGrandTotal=pGridObj.colGrand=!0,pGridObj.bothCheckBox.model.checked||pGridObj.colCheckBox.model.checked&&pGridObj.rowCheckBox.model.checked?(pGridObj.model.enableRowGrandTotal=pGridObj.model.enableColumnGrandTotal=!0,pGridObj.model.enableGrandTotal=pGridObj.bothGrand=!1):pGridObj.model.enableGrandTotal=pGridObj.bothGrand=!0,null!=e("#hideSubTotal").ejDropDownList("getSelectedValue")&&"pivot"==this.model.analysisMode&&this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(pGridObj.selval=e("#hideSubTotal").ejDropDownList("getSelectedValue"),n=e("#hideSubTotal").ejDropDownList("getSelectedValue").split(","),pGridObj.model.dataSource.rows.length>0&&e.each(pGridObj.model.dataSource.rows,function(e,t){t.fieldName.length>0&&(t.showSubTotal=!0)}),pGridObj.model.dataSource.columns.length>0&&e.each(pGridObj.model.dataSource.columns,function(e,t){t.fieldName.length>0&&(t.showSubTotal=!0)}),e.each(n,function(t,i){pGridObj.model.dataSource.rows.length>0&&e.each(pGridObj.model.dataSource.rows,function(e,t){t.fieldName.length>0&&t.fieldName==i&&(t.showSubTotal=!1)}),pGridObj.model.dataSource.columns.length>0&&e.each(pGridObj.model.dataSource.columns,function(e,t){t.fieldName.length>0&&t.fieldName==i&&(t.showSubTotal=!1)})}),pGridObj._populatePivotGrid()):"pivot"==this.model.analysisMode&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(pGridObj.selval=e("#hideSubTotal").ejDropDownList("getSelectedValue"),n=e("#hideSubTotal").ejDropDownList("getSelectedValue").split(","),(s=e(this.element).parents(".e-pivotclient").length>0&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(this._pivotClientObj.getOlapReport()):JSON.parse(pGridObj.getOlapReport())).PivotRows.length>0&&e.each(s.PivotRows,function(e,t){t.FieldName.length>0&&(t.showSubTotal=!0)}),s.PivotColumns.length>0&&e.each(s.PivotColumns,function(e,t){t.FieldName.length>0&&(t.showSubTotal=!0)}),e.each(n,function(t,i){s.PivotRows.length>0&&e.each(s.PivotRows,function(e,t){t.FieldName.length>0&&t.FieldName==i&&(t.showSubTotal=!1)}),s.PivotColumns.length>0&&e.each(s.PivotColumns,function(e,t){t.FieldName.length>0&&t.FieldName==i&&(t.showSubTotal=!1)})}),o={JsonRecords:JSON.stringify(pGridObj.getJSONRecords()),PivotReport:JSON.stringify(s)},pGridObj._renderControlSuccess(o)):pGridObj._load(),t.Pivot.closePreventPanel(this)),"e-summaryTypes"==this._dialogName){if(e("#drillSum").val()!=r&&(this.drilsumval=e("#drillMeasure").ejDropDownList("getSelectedValue"),null!=(a=this.sumtyp=e("#drillSum").val())&&(d=a.toLowerCase()),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)){for(h=e("#drillMeasure").ejDropDownList("getSelectedValue").split(",").length,c=0;c<h;c++)u=e("#drillMeasure").ejDropDownList("getSelectedValue").split(",")[c],e.grep(this.model.dataSource.values,function(e){return e.fieldName==u})[0].summaryType=d;t.isNullOrUndefined(this._pivotClientObj)||"pivot"!=this._pivotClientObj.model.analysisMode||"clientmode"!=this._pivotClientObj.model.operationalMode||(this.model.collapsedMembers=null),this._populatePivotGrid()}t.Pivot.closePreventPanel(this)}},_keyUpPress:function(t){if(16===t.which&&this.model.enableCellSelection&&(this._completeCellSelection(t),e("#"+this._id).find(".value").removeClass("e-hoverCell"),this._startPosCell=null,this._startCellPosition=null),13===t.which&&this.model.enableCellEditing&&!this.model.enableCellSelection&&e("#"+this._id).find(".value.e-hoverCell").length){e("#"+this._id).find(".value.e-hoverCell").trigger("mouseover"),this._startCellPosition=e(e("#"+this._id).find(".value.e-hoverCell")).attr("data-p");var i={target:e("#"+this._id).find(".value.e-hoverCell > span")[0]};this._completeCellEditing(i),t.preventDefault(),e("#"+this._id).find(".value.e-hoverCell .curInput").focus(),e("#"+this._id).find(".value").removeClass("e-hoverCell")}},_keyDownPress:function(i){var r,l,n,s,o,a,d;if(e(".e-pivotpager[data-targetcontrolid='"+this._id+"']:visible").length>0&&(("Pager_CategCurrentPage"==document.activeElement.id||"Pager_SeriesCurrentPage"==document.activeElement.id)&&(35===i.which?(i.preventDefault(),"Pager_CategCurrentPage"==document.activeElement.id?e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .e-moveLast").first().trigger("click"):"Pager_SeriesCurrentPage"==document.activeElement.id&&e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .e-moveLast").last().trigger("click")):36==i.which&&(i.preventDefault(),"Pager_CategCurrentPage"==document.activeElement.id?e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .moveFirst").first().trigger("click"):"Pager_SeriesCurrentPage"==document.activeElement.id&&e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .moveFirst").last().trigger("click")),39===i.which?"Pager_CategCurrentPage"==document.activeElement.id?e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .e-moveNext").first().trigger("click"):"Pager_SeriesCurrentPage"==document.activeElement.id&&e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .e-moveNext").last().trigger("click"):37===i.which&&("Pager_CategCurrentPage"==document.activeElement.id?e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .e-movePrevious").first().trigger("click"):"Pager_SeriesCurrentPage"==document.activeElement.id&&e(".e-pivotpager[data-targetcontrolid='"+this._id+"'] .e-movePrevious").last().trigger("click"))),i.stopImmediatePropagation()),27!==i.which||t.isNullOrUndefined(this._curFocus.grp)&&(t.isNullOrUndefined(this._curFocus.tab)||!this._curFocus.tab.hasClass("e-pivotButton"))?27===i.which&&(this._index.dialog=0):(this._curFocus.tab.mouseleave().removeClass("e-hoverCell"),t.isNullOrUndefined(this._curFocus.grp)?!t.isNullOrUndefined(this._curFocus.tab)&&this._curFocus.tab.hasClass("e-pivotButton")&&(d=this._curFocus.tab.attr("data-tag"),a=this._curFocus.tab=e("#"+this._id).find("[data-tag='"+d+"']")):(d=this._curFocus.grp.attr("data-tag"),a=this._curFocus.grp=e("#"+this._id).find("[data-tag='"+d+"']")),a.mouseover().addClass("e-hoverCell").focus(),this._index.filter=0,this._index.dialog=this.model.dataSource.enableAdvancedFilter?0:1,this._index.field=0),70===i.which&&i.ctrlKey&&(i.preventDefault(),t.isNullOrUndefined(this._curFocus.grp)?t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.find(".filter").click():this._curFocus.grp.find(".filter").click()),83===i.which&&i.ctrlKey&&(i.preventDefault(),t.isNullOrUndefined(this._curFocus.grp)?t.isNullOrUndefined(this._curFocus.tab)||(this._curFocus.tab.find(".e-sorting").click(),d=this._curFocus.tab.attr("data-tag"),a=this._curFocus.tab=e("#"+this._id).find("[data-tag='"+d+"']")):(this._curFocus.grp.find(".e-sorting").click(),d=this._curFocus.grp.attr("data-tag"),a=this._curFocus.grp=e("#"+this._id).find("[data-tag='"+d+"']")),a.mouseover().addClass("e-hoverCell").focus()),(46===i.which||82===i.which&&i.ctrlKey)&&(46!=i.which&&i.preventDefault(),t.isNullOrUndefined(this._curFocus.grp)?t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.find(".e-removeBtn").click():this._curFocus.grp.find(".e-removeBtn").click()),i.shiftKey&&t.isNullOrUndefined(this._startPosCell)&&(this._startCellPosition=i.target.getAttribute("data-p"),this._startPosCell=i.target.getAttribute("data-p")),39===i.which&&e("#"+this._id).find(".e-dialog .e-hoverCell").length>0?e("#"+this._id).find(".e-dialog .e-hoverCell").parent().find(".e-plus").click():37===i.which&&e("#"+this._id).find(".e-dialog .e-hoverCell").length>0&&e("#"+this._id).find(".e-dialog .e-hoverCell").parent().find(".e-minus").click(),(40===i.which||39===i.which||38===i.which||37===i.which)&&i.shiftKey&&this.model.enableCellSelection){if(e("#"+this._id).find(".e-hoverCell").removeClass("e-hoverCell"),t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.attr("tabindex","0"),r=e(i.target),"40"==i.which)for(h=r.attr("data-p"),c=parseInt(h.split(",")[1])+Number(r.attr("rowspan"));t.isNullOrUndefined(u)&&c<this._rowCount;)l=e(e("#"+this._id)).find("[data-p='"+h.split(",")[0]+","+c+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),this._curFocus.selection=e(u),c++;else if("38"==i.which)for(h=r.attr("data-p"),c=parseInt(h.split(",")[1])-1;t.isNullOrUndefined(u)&&c>=0;)l=e(e("#"+this._id)).find("[data-p='"+h.split(",")[0]+","+c+"']")[0],t.isNullOrUndefined(l)&&(l=e(e("#"+this._id)).find("[data-p='"+(parseInt(h.split(",")[0])-1)+","+c+"']")[0]),!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),this._curFocus.selection=e(u),c--;else if("39"==i.which)for(h=r.attr("data-p"),c=parseInt(h.split(",")[0])+Number(r.attr("colspan"));t.isNullOrUndefined(u)&&c<Math.ceil(this.getJSONRecords().length/this._rowCount);)l=e(e("#"+this._id)).find("[data-p='"+c+","+h.split(",")[1]+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),this._curFocus.selection=e(u),c++;else if("37"==i.which){for(var h=r.attr("data-p"),c=parseInt(h.split(",")[0])-1,u=e(e("#"+this._id)).find("[data-p='"+(parseInt(h.split(",")[0])-1)+","+h.split(",")[1]+"']")[0];t.isNullOrUndefined(u)&&c>=0;)l=e(e("#"+this._id)).find("[data-p='"+c+","+h.split(",")[1]+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),c--;this._curFocus.selection=e(u)}if(this._curFocus.selection.attr("tabindex","-1").focus().addClass("e-hoverCell"),Number(this._startCellPosition.split(",")[0])<=Number(this._curFocus.selection.attr("data-p").split(",")[0])&&Number(this._startCellPosition.split(",")[1])<=Number(this._curFocus.selection.attr("data-p").split(",")[1]))for(c=Number(this._startCellPosition.split(",")[0]);c<=Number(this._curFocus.selection.attr("data-p").split(",")[0]);c++)for(g=Number(this._startCellPosition.split(",")[1]);g<=Number(this._curFocus.selection.attr("data-p").split(",")[1]);g++)e("#"+this._id).find("[data-p='"+c+","+g+"']").hasClass("value")&&e("#"+this._id).find("[data-p='"+c+","+g+"']").addClass("e-hoverCell");else if(Number(this._startCellPosition.split(",")[0])>=Number(this._curFocus.selection.attr("data-p").split(",")[0])&&Number(this._startCellPosition.split(",")[1])>=Number(this._curFocus.selection.attr("data-p").split(",")[1]))for(c=Number(this._startCellPosition.split(",")[0]);c>=Number(this._curFocus.selection.attr("data-p").split(",")[0]);c--)for(g=Number(this._startCellPosition.split(",")[1]);g>=Number(this._curFocus.selection.attr("data-p").split(",")[1]);g--)e("#"+this._id).find("[data-p='"+c+","+g+"']").hasClass("value")&&e("#"+this._id).find("[data-p='"+c+","+g+"']").addClass("e-hoverCell");else if(Number(this._startCellPosition.split(",")[0])<=Number(this._curFocus.selection.attr("data-p").split(",")[0])&&Number(this._startCellPosition.split(",")[1])>=Number(this._curFocus.selection.attr("data-p").split(",")[1]))for(c=Number(this._startCellPosition.split(",")[0]);c<=Number(this._curFocus.selection.attr("data-p").split(",")[0]);c++)for(g=Number(this._startCellPosition.split(",")[1]);g>=Number(this._curFocus.selection.attr("data-p").split(",")[1]);g--)e("#"+this._id).find("[data-p='"+c+","+g+"']").hasClass("value")&&e("#"+this._id).find("[data-p='"+c+","+g+"']").addClass("e-hoverCell");else if(Number(this._startCellPosition.split(",")[0])>=Number(this._curFocus.selection.attr("data-p").split(",")[0])&&Number(this._startCellPosition.split(",")[1])<=Number(this._curFocus.selection.attr("data-p").split(",")[1]))for(c=Number(this._startCellPosition.split(",")[0]);c>=Number(this._curFocus.selection.attr("data-p").split(",")[0]);c--)for(g=Number(this._startCellPosition.split(",")[1]);g<=Number(this._curFocus.selection.attr("data-p").split(",")[1]);g++)e("#"+this._id).find("[data-p='"+c+","+g+"']").hasClass("value")&&e("#"+this._id).find("[data-p='"+c+","+g+"']").addClass("e-hoverCell")}else if((40===i.which||38===i.which||37===i.which||39===i.which)&&e("#"+this._id).find(".e-calcFormulaDiv:visible").length>0)i.preventDefault(),n=e("#"+this._id).find(".e-calcFormulaDiv td:visible"),t.isNullOrUndefined(this._curFocus.formula)?(this._index.formula=39==i.which?0:37==i.which?n.length-1:0,this._curFocus.formula=n.eq(this._index.formula).addClass("e-hoverCell").mouseover()):(this._curFocus.formula.removeClass("e-hoverCell").mouseleave(),39===i.which?this._index.formula=this._index.formula+1>n.length-1?0:this._index.formula+1:37===i.which?this._index.formula=this._index.formula-1<0?n.length-1:this._index.formula-1:40===i.which?this._index.formula=this._index.formula+4>n.length-1?(this._index.formula+4)%10:this._index.formula+4:38===i.which&&(this._index.formula=this._index.formula-4<0?this._index.formula- -16:this._index.formula-4),this._curFocus.formula=n.eq(this._index.formula).addClass("e-hoverCell").mouseover());else if((40===i.keyCode||38===i.which)&&e("#"+this._id).find(".e-dialog:visible").length>0&&!t.isNullOrUndefined(e("#"+this._id).find(".e-dialog .e-text"))&&e(".e-dialog .e-text").hasClass("e-hoverCell"))e("#"+this._id).find(".e-dialog .e-hoverCell").removeClass("e-hoverCell"),i.preventDefault(),n=e("#"+this._id).find(".e-dialog .e-text:visible"),t.isNullOrUndefined(this._curFocus.filter)?(this._index.filter=40==i.which?1:38==i.which?n.length-1:0,this._curFocus.filter=n.eq(this._index.filter).attr("tabindex","-1")):(this._curFocus.filter.attr("tabindex","0").removeClass("e-hoverCell"),40===i.which?this._index.filter=this._index.filter+1>n.length-1?0:this._index.filter+1:38===i.which&&(this._index.filter=this._index.filter-1<0?n.length-1:this._index.filter-1),this._curFocus.filter=n.eq(this._index.filter).attr("tabindex","-1")),this._curFocus.filter.focus().addClass("e-hoverCell"),e(".e-node-focus").removeClass("e-node-focus");else if((40===i.which||38===i.which||37===i.which||39===i.which)&&!t.isNullOrUndefined(this._curFocus.tab)&&this._curFocus.tab.hasClass("e-pivotButton")&&!e(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0&&!e("#"+this._id).find(".e-dialog:visible").length>0)i.preventDefault(),t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.mouseleave().attr("tabindex","0").removeClass("e-hoverCell"),n=e("#"+this._id).find(".e-pivotButton"),t.isNullOrUndefined(this._curFocus.grp)?40===i.which||39===i.which?this._curFocus.grp=n.eq(1).attr("tabindex","-1"):(38===i.which||37===i.which)&&(this._curFocus.grp=n.eq(n.length-1).attr("tabindex","-1")):(this._curFocus.grp.attr("tabindex","0").removeClass("e-hoverCell").mouseleave(),40===i.which||39===i.which?this._index.grp=this._index.grp+1>n.length-1?0:this._index.grp+1:(38===i.which||37===i.which)&&(this._index.grp=this._index.grp-1<0?n.length-1:this._index.grp-1),this._curFocus.grp=n.eq(this._index.grp)),this._curFocus.grp.addClass("e-hoverCell").mouseover().focus();else if(40!==i.which&&38!==i.which&&37!==i.which&&39!==i.which||!(!e(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0)||"columnheader"!=document.activeElement.getAttribute("role")&&"rowheader"!=document.activeElement.getAttribute("role")&&"gridcell"!=document.activeElement.getAttribute("role"))40==i.which&&e(".e-list").hasClass("e-hoverCell")&&e("#"+this._id).find(".e-hoverCell").removeClass("e-hoverCell");else{if(t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.attr("tabindex","0"),t.isNullOrUndefined(this._curFocus.cell)||(this._curFocus.cell.attr("tabindex","0").removeClass("e-hoverCell"),this.model.hyperlinkSettings.enableColumnHeaderHyperlink&&this._curFocus.cell.find("span").mouseleave()),this._index.menu=0,this._curFocus.cmenu=null,r=e(i.target),"40"==i.which)for(h=r.attr("data-p"),c=parseInt(h.split(",")[1])+Number(r.attr("rowspan"));t.isNullOrUndefined(u)&&c<=this._rowCount;){if(l=e("#"+this._id).find("[data-p='"+h.split(",")[0]+","+c+"']")[0],t.isNullOrUndefined(l))for(k=parseInt(h.split(",")[0])-1;k>=0;k--)t.isNullOrUndefined(l)&&(l=e("#"+this._id).find("[data-p='"+k+","+c+"']")[0]);!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),t.isNullOrUndefined(u)||(this._curFocus.cell=e(u)),c++}else if("38"==i.which){h=r.attr("data-p"),c=parseInt(h.split(",")[1])-1;for(var g=parseInt(h.split(",")[0]);t.isNullOrUndefined(u)&&c>=0;){if(l=e("#"+this._id).find("[data-p='"+h.split(",")[0]+","+c+"']")[0],t.isNullOrUndefined(l)&&("gridcell"==r.attr("role")||r.hasClass("summary")&&r.hasClass("calc")))for(k=parseInt(h.split(",")[1])-1;k>=0;k--)t.isNullOrUndefined(l)&&(l=e("#"+this._id).find("[data-p='"+g+","+k+"']")[0]);if(t.isNullOrUndefined(l))for(k=parseInt(h.split(",")[0])-1;k>=0;k--)t.isNullOrUndefined(l)&&(l=e("#"+this._id).find("[data-p='"+k+","+c+"']")[0]);!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),t.isNullOrUndefined(u)||e(u).hasClass("e-grpRow")||(this._curFocus.cell=e(u)),c--,g--}}else if("39"==i.which)for(h=r.attr("data-p"),c=parseInt(h.split(",")[0])+Number(r.attr("colspan"));t.isNullOrUndefined(u)&&c<=Math.ceil((Number(e("#"+this._id).find(".e-pivotGridTable td:last").attr("data-p").split(",")[0])+1)*(Number(e("#"+this._id).find(".e-pivotGridTable td:last").attr("data-p").split(",")[1])+1)/this._rowCount);){if(l=e("#"+this._id).find("[data-p='"+c+","+h.split(",")[1]+"']")[0],t.isNullOrUndefined(l))for(k=parseInt(h.split(",")[1])-1;k>=0;k--)t.isNullOrUndefined(l)&&(l=e("#"+this._id).find("[data-p='"+c+","+k+"']")[0]);!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),t.isNullOrUndefined(u)||(this._curFocus.cell=e(u)),c++}else if("37"==i.which){for(h=r.attr("data-p"),c=parseInt(h.split(",")[0])-1,u=e("#"+this._id).find("[data-p='"+(parseInt(h.split(",")[0])-1)+","+h.split(",")[1]+"']")[0],g=parseInt(h.split(",")[1]);t.isNullOrUndefined(u)&&c>=0;){if(l=e("#"+this._id).find("[data-p='"+c+","+h.split(",")[1]+"']")[0],t.isNullOrUndefined(l)&&"gridcell"==r.attr("role"))for(k=parseInt(h.split(",")[0])-1;k>=0;k--)t.isNullOrUndefined(l)&&(l=e("#"+this._id).find("[data-p='"+k+","+g+"']")[0]);if(t.isNullOrUndefined(l))for(k=parseInt(h.split(",")[1])-1;k>=0;k--)t.isNullOrUndefined(l)&&(l=e("#"+this._id).find("[data-p='"+c+","+k+"']")[0]);!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role")||e(l).hasClass("value")||"gridcell"==e(l).attr("role"))&&(u=l),c--,g--}t.isNullOrUndefined(u)||e(u).hasClass("e-grpRow")||(this._curFocus.cell=e(u))}t.isNullOrUndefined(this._curFocus.cell)||(e(".e-hoverCell").removeClass("e-hoverCell"),this._curFocus.cell.attr("tabindex","-1").focus().addClass("e-hoverCell"),this.model.hyperlinkSettings.enableColumnHeaderHyperlink&&(this._curFocus.cell.mouseover(),this._curFocus.cell.find("span").mouseover()))}if(9===i.which&&e("#"+this._id).find(".colheader.e-hoverCell")&&(this._curFocus.cell=e("#"+this._id).find(".colheader.e-hoverCell")),(9===i.which&&i.shiftKey||9===i.which)&&e("#"+this._id).find("#"+this._id+"_clientDlg_wrapper :visible").length>0?(i.preventDefault(),n=e("#"+this._id+"_editCon_hidden").hasClass("e-disable")||"disabled"==e("#"+this._id+"_conTo").attr("disabled")?"disabled"!=e("#"+this._id+"_conTo").attr("disabled")?e("#"+this._id).find("#"+this._id+"_conType_wrapper,#"+this._id+"_conFrom,#"+this._id+"_conTo,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_borderrange_wrapper,#"+this._id+"_conFrom,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_bordercolor_wrapper,#"+this._id+"_borderstyle_wrapper,#"+this._id+"_fStyle_wrapper,#"+this._id+"_fSize_wrapper,#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn,.e-dialog .e-close"):e("#"+this._id+"_editCon_hidden").hasClass("e-disable")?e("#"+this._id).find("#"+this._id+"_conType_wrapper,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_borderrange_wrapper,#"+this._id+"_conFrom,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_bordercolor_wrapper,#"+this._id+"_borderstyle_wrapper,#"+this._id+"_fStyle_wrapper,#"+this._id+"_fSize_wrapper,#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn,.e-dialog .e-close"):e("#"+this._id).find("#"+this._id+"_conType_wrapper,#"+this._id+"_editCon_wrapper,#"+this._id+"_removeBtn,#"+this._id+"_conFrom,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_borderrange_wrapper,#"+this._id+"_conFrom,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_bordercolor_wrapper,#"+this._id+"_borderstyle_wrapper,#"+this._id+"_fStyle_wrapper,#"+this._id+"_fSize_wrapper,#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn,.e-dialog .e-close"):e("#"+this._id).find("#"+this._id+"_conType_wrapper,#"+this._id+"_editCon_wrapper,#"+this._id+"_removeBtn,#"+this._id+"_conFrom,#"+this._id+"_conTo,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_borderrange_wrapper,#"+this._id+"_conFrom,#"+this._id+"_fontcolor_wrapper,#"+this._id+"_backcolor_wrapper,#"+this._id+"_bordercolor_wrapper,#"+this._id+"_borderstyle_wrapper,#"+this._id+"_fStyle_wrapper,#"+this._id+"_fSize_wrapper,#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn,.e-dialog .e-close"),t.isNullOrUndefined(this._curFocus.cformat)?(this._index.cformat=1,this._curFocus.cformat=n.eq(this._index.cformat).attr("tabindex","-1")):(this._curFocus.cformat.attr("tabindex","0").removeClass("e-hoverCell"),9===i.which&&i.shiftKey?this._index.cformat=this._index.cformat-1<0?n.length-1:this._index.cformat-1:9===i.which&&(this._index.cformat=this._index.cformat+1>n.length-1?0:this._index.cformat+1),this._curFocus.cformat=n.eq(this._index.cformat).attr("tabindex","-1")),this._curFocus.cformat.focus().addClass("e-hoverCell")):(9===i.which&&i.shiftKey||9===i.which)&&e("#"+this._id).find(".e-dlgCalculatedField:visible").length>0?(i.preventDefault(),e("#"+this._id).find(".e-calcFormulaDiv:visible").length>0&&e("#"+this._id).find(".e-calcFormulaDiv").css("display","none"),(s=[]).push(e("#"+this._id).find("#"+this._id+"_calculateFieldName:visible")),s.push(e("#"+this._id).find("#"+this._id+"_calculateFieldList_dropdown:visible")),s.push(e("#"+this._id).find(".calculatorFields:visible")),s.push(e("#"+this._id).find(".editFormula:visible")),s.push(e("#"+this._id).find("#"+this._id+"_fieldCollection_container:visible")),e("#"+this._id).find("#"+this._id+"_btnInsert:visible:not([aria-disabled='true'])").length>0&&s.push(e("#"+this._id).find("#"+this._id+"_btnInsert:visible:not([aria-disabled='true'])")),s.push(e("#"+this._id).find("#"+this._id+"_btnAdd:visible")),s.push(e("#"+this._id).find("#"+this._id+"_btnDelete:visible")),s.push(e("#"+this._id).find("#"+this._id+"_btnOk:visible")),s.push(e("#"+this._id).find("#"+this._id+"_btnCancel:visible")),t.isNullOrUndefined(this._curFocus.field)?(this._index.field=s.length>5?6:0,this._curFocus.field=s[this._index.field].attr("tabindex","-1")):(this._curFocus.field.attr("tabindex","0").removeClass("e-hoverCell").blur(),9===i.which&&i.shiftKey?this._index.field=this._index.field-1<0?s.length-1:this._index.field-1:9===i.which&&(this._index.field=this._index.field+1>s.length-1?0:this._index.field+1),this._curFocus.field=s[this._index.field].attr("tabindex","-1")),this._curFocus.field.focus().addClass("e-hoverCell")):(9===i.which&&i.shiftKey||9===i.which)&&e("#"+this._id).find(".e-dialog:visible").length>0?(i.preventDefault(),e("#"+this._id).find(".e-dialog .e-hoverCell").removeClass("e-hoverCell"),this._curFocus.filter=null,this._index.filter=0,s=e("#"+this._id).find(".e-dialogOKBtn:visible:not([aria-disabled='true']),.e-dialogCancelBtn:visible,.e-close:visible,#GroupLabelDrop_wrapper:visible,.filterElementTag:visible,.e-dialog .e-text:visible:first,.filterValues:visible,#filterMeasures_wrapper:visible,#filterOptions_wrapper:visible,#filterValue1:visible,#filterValue2:visible,.searchEditorTreeView"),t.isNullOrUndefined(this._curFocus.tree)?(this._index.dialog=this.model.dataSource.enableAdvancedFilter?1:2,this._curFocus.tree=s.eq(this._index.dialog).attr("tabindex","-1").focus()):(this._curFocus.tree.attr("tabindex","0").removeClass("e-hoverCell"),9===i.which&&i.shiftKey?this._index.dialog=this._index.dialog-1<0?s.length-1:this._index.dialog-1:9===i.which&&(this._index.dialog=this._index.dialog+1>s.length-1?0:this._index.dialog+1),this._curFocus.tree=s.eq(this._index.dialog).attr("tabindex","-1").focus()),this._curFocus.tree.hasClass("filterElementTag")?this._curFocus.tree.find(".e-list:first:visible").addClass("e-hoverCell"):this._curFocus.tree.addClass("e-hoverCell")):(9===i.which&&i.shiftKey||9===i.which)&&!e(".e-dialog:visible").length>0&&t.isNullOrUndefined(this._pivotClientObj)&&(i.preventDefault(),e("#"+this._id).find(".e-hoverCell").removeClass("e-hoverCell"),t.isNullOrUndefined(this._schemaData)||e("#"+this._schemaData._id).find(".e-hoverCell").removeClass("e-hoverCell"),t.isNullOrUndefined(this._curFocus.grp)||this._curFocus.grp.mouseleave(),this._index.field=0,this._index.grp=1,this._index.cell=1,this._index.filter=0,this._index.dialog=this.model.dataSource.enableAdvancedFilter?0:1,t.isNullOrUndefined(this._schemaData)||t.isNullOrUndefined(this._schemaData._curFocus)||(this._schemaData._curFocus.tree=null,this._schemaData._curFocus.node=null,this._schemaData._curFocus.button=null),this._curFocus.field=null,this._curFocus.cell=null,this._curFocus.grp=null,this._curFocus.tree=null,this._curFocus.cmenu=null,this._curFocus.cformat=null,this._curFocus.selection=null,s=[],this.model.enableGroupingBar&&e("#"+this._id).find(".e-pivotButton:visible").first().length>0&&s.push(e("#"+this._id).find(".e-pivotButton:visible").first()),e(".e-pivotpager[data-targetcontrolid='"+this._id+"']:visible").length>0&&e("[role='columnheader']:visible:not([p='0,0'])").first().length>0?s.push(e("[role='columnheader']:visible:not([p='0,0'])").first()):e("#"+this._id).find("[role='columnheader']:visible").first().length>0&&s.push(e("[role='columnheader']:not('.e-grpRow'):visible:first")),!t.isNullOrUndefined(this._schemaData)&&e("#"+this._schemaData._id).find(".e-text:visible").first().length>0&&s.push(e("#"+this._schemaData._id).find(".e-text:visible").first()),!t.isNullOrUndefined(this._schemaData)&&e("#"+this._schemaData._id).find(".e-pvtBtn:visible").first().length>0&&s.push(e("#"+this._schemaData._id).find(".e-pvtBtn:visible").first()),e(".e-pivotpager[data-targetcontrolid='"+this._id+"']:visible").length>0&&e("#Pager_CategCurrentPage:visible").length>0&&s.push(e("#Pager_CategCurrentPage:visible")),e(".e-pivotpager[data-targetcontrolid='"+this._id+"']:visible").length>0&&e("#Pager_SeriesCurrentPage:visible").length>0&&s.push(e("#Pager_SeriesCurrentPage:visible")),t.isNullOrUndefined(this._curFocus.tab)?this._curFocus.tab=s[0].attr("tabindex","-1"):(this._curFocus.tab.attr("tabindex","0").removeClass("e-hoverCell"),this._curFocus.tab.hasClass("e-active")&&this._curFocus.tab.removeClass("e-active"),t.isNullOrUndefined(this._schemaData)||(e("#"+this._schemaData._id).find(".e-active").removeClass("e-active"),e("#"+this._schemaData._id).find(".e-node-hover").removeClass("e-node-hover"),e("#"+this._schemaData._id).find(".e-node-focus").removeClass("e-node-focus")),this._curFocus.tab.hasClass("e-node-hover")&&this._curFocus.tab.removeClass("e-node-hover"),this._curFocus.tab.mouseleave(),9===i.which&&i.shiftKey?this._index.index=this._index.index-1<0?s.length-1:this._index.index-1:9===i.which&&(this._index.index=this._index.index+1>s.length-1?0:this._index.index+1),this._curFocus.tab=s[this._index.index].attr("tabindex","-1")),this._curFocus.tab.focus().addClass("e-hoverCell").mouseover(),this.model.hyperlinkSettings.enableColumnHeaderHyperlink&&(this._curFocus.tab.mouseover(),this._curFocus.tab.find("span").mouseover()),e(".e-node-focus").removeClass("e-node-focus"),i.stopImmediatePropagation()),93===i.which&&!e(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0&&this.model.enableGroupingBar&&(!t.isNullOrUndefined(this._curFocus.grp)||!t.isNullOrUndefined(this._curFocus.tab))&&(i.preventDefault(),document.activeElement.className.startsWith("e-pivotButton")&&(t.isNullOrUndefined(this._curFocus.grp)?t.isNullOrUndefined(this._curFocus.tab)||(o={x:e(this._curFocus.tab).offset().left+e(this._curFocus.tab).outerWidth(),y:e(this._curFocus.tab).offset().top+e(this._curFocus.tab).outerHeight()},this._curFocus.tab.find("button").trigger({type:"mouseup",which:3,clientX:o.x,clientY:o.y,pageX:o.x,pageY:o.y})):(o={x:e(this._curFocus.grp).offset().left+e(this._curFocus.grp).outerWidth(),y:e(this._curFocus.grp).offset().top+e(this._curFocus.grp).outerHeight()},this._curFocus.grp.find("button").trigger({type:"mouseup",which:3,clientX:o.x,clientY:o.y,pageX:o.x,pageY:o.y})))),13===i.which&&this.model.hyperlinkSettings.enableColumnHeaderHyperlink)t.isNullOrUndefined(this._curFocus.cell)?t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.find(".cellValue").click():this._curFocus.cell.find(".cellValue").click();else if(13==i.which&&!e(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0&&!e(".e-waitpopup-pane:visible").length>0){if(e("#"+this._id).find(".e-dialog:visible").length>0){if(e(i.target).hasClass("e-memberCurrentPage")||e(i.target).hasClass("e-memberCurrentSearchPage")||e(i.target).hasClass("e-memberCurrentDrillPage"))return void t.Pivot.editorTreeNavigatee(i,this);if(e(i.target).hasClass("searchEditorTreeView"))return void t.Pivot._searchEditorTreeNodes(i,this)}e("#"+this._id).find(".e-dialog .e-hoverCell").length>0&&e("#"+this._id).find(".e-dialog .e-hoverCell").hasClass("e-text")?e("#"+this._id).find(".e-dialog .e-hoverCell").parent().find(".e-chkbox-small").click():document.activeElement.className.startsWith("e-pivotGridTable")||"rowheader"==document.activeElement.getAttribute("role")||"columnheader"==document.activeElement.getAttribute("role")?t.isNullOrUndefined(this._curFocus.cell)?t.isNullOrUndefined(this._curFocus.tab)||(this._curFocus.tab.find(".e-expand").length>0?this._curFocus.tab.find(".e-expand").click():this._curFocus.tab.find(".e-collapse").length>0&&this._curFocus.tab.find(".e-collapse").click(),this._curFocus.tab=e("#"+this._id).find("[role='"+this._curFocus.tab.attr("role")+"']:contains('"+this._curFocus.tab.text()+"'):visible").first(),this._curFocus.tab.attr("tabindex","-1").focus().addClass("e-hoverCell")):this._curFocus.cell.find(".e-expand,.e-collapse").length>0?(this._curFocus.cell.find(".e-expand,.e-collapse").click(),this._curFocus.cell.removeClass("e-hoverCell").attr("tabindex","0"),this._curFocus.cell=e("#"+this._id).find("[role='"+this._curFocus.cell.attr("role")+"']:contains('"+this._curFocus.cell.text()+"'):visible").first(),this._curFocus.cell.attr("tabindex","-1").focus().addClass("e-hoverCell")):(this._curFocus.cell.click(),this._curFocus.cell.removeClass("e-hoverCell").attr("tabindex","0"),this._curFocus.cell=e("#"+this._id).find("[data-p='"+this._curFocus.cell.attr("data-p")+"']"),this._curFocus.cell.attr("tabindex","-1").focus().addClass("e-hoverCell")):t.isNullOrUndefined(this._curFocus.tree)&&t.isNullOrUndefined(this._curFocus.formula)&&(t.isNullOrUndefined(this._curFocus.field)||!this._curFocus.field.hasClass("editFormula"))||e("#"+this._id).find(".e-dialog .e-hoverCell:visible").length>0&&(e("#"+this._id).find(".e-dialog .e-hoverCell:visible").click(),this._index.tree=1),e(".e-pivotpager[data-targetcontrolid='"+this._id+"']:visible").length>0&&!t.isNullOrUndefined(this._curFocus.tab)&&this._curFocus.tab.attr("tabindex","-1").focus()}79==i.keyCode&&e("#"+this._id).find(".e-dialog").length>0&&i.ctrlKey&&(i.preventDefault(),e("#"+this._id).find(".e-dialogOKBtn:visible").click(),this._index.field=0,this._index.filter=0,this._index.dialog=this.model.dataSource.enableAdvancedFilter?0:1,this._curFocus.tree=null,t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.mouseleave().removeClass("e-hoverCell"),t.isNullOrUndefined(this._curFocus.grp)?t.isNullOrUndefined(this._curFocus.tab)||(d=this._curFocus.tab.attr("data-tag"),a=this._curFocus.tab=e("#"+this._id).find("[data-tag='"+d+"']")):(d=this._curFocus.grp.attr("data-tag"),a=this._curFocus.grp=e("#"+this._id).find("[data-tag='"+d+"']")),t.isNullOrUndefined(a)||a.mouseover().addClass("e-hoverCell").focus()),67==i.keyCode&&e("#"+this._id).find(".e-dialog:visible").length>0&&i.ctrlKey&&(i.preventDefault(),e("#"+this._id).find(".e-dialogCancelBtn:visible").click(),this._index.field=0,this._index.filter=0,this._index.dialog=this.model.dataSource.enableAdvancedFilter?0:1,this._curFocus.tree=null,t.isNullOrUndefined(this._curFocus.tab)||this._curFocus.tab.mouseleave().removeClass("e-hoverCell"),t.isNullOrUndefined(this._curFocus.grp)?t.isNullOrUndefined(this._curFocus.tab)||(d=this._curFocus.tab.attr("data-tag"),a=this._curFocus.tab=e("#"+this._id).find("[data-tag='"+d+"']")):(d=this._curFocus.grp.attr("data-tag"),a=this._curFocus.grp=e("#"+this._id).find("[data-tag='"+d+"']")),t.isNullOrUndefined(a)||a.mouseover().addClass("e-hoverCell").focus())},_unWireEvents:function(){this._off(this.element,"mousedown",".value",this._initCellEditing),this._off(this.element,"click",".colheader,.cstot,.cgtot,.calc,.stot,.gtot"),this._off(e(document),"keydown",this._keyDownPress),this._off(e(document),"keyup",this._keyUpPress),this._off(this.element.find("a.e-linkPanel"),"click",t.Pivot._editorLinkPanelClick),this._off(this.element,"click","#preventDiv"),this._off(this.element,"click","table .e-expand,table .e-collapse"),this._off(this.element,"dblclick",".value, .summary"),this._off(this.element,"click",".value, .summary"),this._off(this.element,"mouseover",".colheader, .rowheader, .e-expand, .e-collapse"),this._off(this.element,"mouseleave",".colheader, .rowheader, .e-expand, .e-collapse"),this._off(this.element,"mouseover",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?".value, .rowheader, .colheader":".value, .rowheader, .colheader, .summary",this.addHyperlinkHandler),this._off(this.element,"mouseleave",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?".value, .rowheader, .colheader":".value, .rowheader, .colheader, .summary",this.removeHyperlinkHandler),this._off(this.element,"click",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?".value, .rowheader, .colheader":".value, .rowheader, .colheader, .summary"),this._off(this.element,"click",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?".value .cellValue, .rowheader .cellValue, .colheader .cellValue":".value .cellValue, .rowheader .cellValue, .colheader .cellValue, .summary .cellValue"),this._off(this.element,"mouseover",".value"),this._off(this.element,"mouseleave",".value"),this._off(this.element,"mousedown touchstart",".value"),this._off(this.element,"mouseup touchend",".value"),this._off(this.element,"click",".filter"),this._off(this.element,"click",".e-sorting"),this._off(this.element,"click",".e-removeBtn"),this._off(this.element,"mouseover",".e-pvtBtn"),this._off(this.element,"mouseleave",".e-pvtBtn"),e(document).off("keyup",this._endCellSelection),e(document).off("keydown",this._startCellSelection),e(document).off("click",this._clearSelection),this._off(this.element,"click",".calculatedFieldPopup .menuItem "),this._off(this.element,"contextmenu",".values .e-pivotButton"),this._off(this.element,"click",".filter",t.proxy(this._filterBtnClick,this)),this._off(this.element,"click",".e-sorting",t.proxy(this._sortBtnClick,this)),this._off(this.element,"click",".e-memberAscendingIcon, .e-memberDescendingIcon",t.proxy(t.Pivot._memberSortBtnClick,this)),this._off(this.element,"click",".e-removeBtn",t.proxy(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._removePvtBtn:this._clientRemovePvtBtn,this)),this._off(this.element,"click",".e-ascOrder, .e-descOrder"),this._off(this.element,"click",".clearAllFilters, .clearSorting"),this._off(this.element,"contextmenu"),this._off(this.element,"click",".e-dialogOkBtn"),this._off(this.element,"click",".e-cellSelect"),this._off(this.element,"click",".e-columnResize"),this._off(this.element,"click",".e-excelLikeLayout"),this._off(this.element,"click",".e-advancedFiltering"),this._off(this.element,"click",".e-toolTip"),this._off(this.element,"click",".e-collapseByDefault"),this._off(this.element,"click",".rtl"),this._off(this.element,"click",".e-calculatedField"),this._off(this.element,"click",".e-cellEditing"),this._off(this.element,"click",".groupingBar"),this._off(this.element,"click",".e-conditionalFormat"),this._off(this.element,"click",".e-summaryCustomize"),this._off(this.element,"click",".e-summaryTypes"),this._off(this.element,"click",".e-numberFormatting"),this._off(this.element,"click",".e-rowHeaderHyperLink"),this._off(this.element,"click",".e-colHeaderHyperLink"),this._off(this.element,"click",".e-valueCellHyperLink"),this._off(this.element,"click",".e-summaryCellHyperLink"),this._off(this.element,"click",".e-rowFreeze"),this._off(this.element,"click",".e-colFreeze"),this._off(this.element,"click",".bothFreeze"),this._off(this.element,"click",".e-excel"),this._off(this.element,"click",".e-word"),this._off(this.element,"click",".e-pdf"),this._off(this.element,"click",".csv"),this._off(this.element,"click",".e-frozenHeaders"),this._off(this.element,"click",".e-exporting"),this._off(this.element,"click",".e-layouts"),this._off(this.element,"click",".e-hyperlinkOptions"),this._off(this.element,"click",".e-normalLayout"),this._off(this.element,"click",".e-normalTopSummaryLayout"),this._off(this.element,"click",".e-noSummariesLayout"),this._off(this.element,"click",".e-drillThrough"),this._off(this.element,"mousedown touchstart",".value",this._initCellSelection),this._off(this.element,"click",".colheader,.rowheader",this._headerClickCellSelection),this._off(this.element,"click",".e-nextPage, .e-prevPage, .e-firstPage, .e-lastPage"),this._off(this.element,"click",".e-searchEditorTree")},_getFieldName:function(i){var r;if(e(i).hasClass("colheader")||"columnheader"==e(i).attr("role")){var l=parseInt(e(i).attr("data-p").split(",")[1]),n=t.isNullOrUndefined(this.model.dataSource.data)||this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(e(this.element).parents(".e-pivotclient").length>0||e(this.element).parents(".e-fullScreenView").length>0)&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(this._pivotClientObj.getOlapReport()).PivotColumns:JSON.parse(this.getOlapReport()).PivotColumns:this.model.dataSource.columns,s=i.textContent.replace("expanded","");return l<n.length?this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n[l].fieldName:n[l].FieldName:s}if(e(i).hasClass("rowheader")||"rowheader"==e(i).attr("role"))return r=parseInt(e(i).attr("data-p").split(",")[0]),t.isNullOrUndefined(this.model.dataSource.data)||this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(this.element.parents(".e-pivotclient").length>0||this.element.parents(".e-fullScreenView").length>0)&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?JSON.parse(this._pivotClientObj.getOlapReport()).PivotRows[r].FieldName:JSON.parse(this.getOlapReport()).PivotRows[r].FieldName:t.isNullOrUndefined(this.model.dataSource.rows)?"":this.model.dataSource.rows[r].fieldName},_colResizing:function(t){var i,r;if(this.model.enableColumnResizing)if(this._expand){var l=t.clientX,n=t.clientY,s=this.element.find("thead,.pivotGridFrozenTable,.pivotGridColValueTable").first()[0].getBoundingClientRect();s.left+document.documentElement.scrollLeft+s.width<l||l<s.left+document.documentElement.scrollLeft?this.element.find(".e-reSizeColbg").remove():-1!=this._currentCell&&this.element.find(".e-reSizeColbg").css({left:l,top:this._tableY})}else{if(this.element.find(".e-reSizeColbg").is(":visible"))return;if("columnheader"==e(t.target).attr("role")){var o=this.resCell=t.target,a=o.getBoundingClientRect();l=t.clientX,n=t.clientY;i=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?e(".pivotGridFrozenTable,.pivotGridColValueTable").width()+e(".pivotGridFrozenTable,.pivotGridColValueTable").find("tr").offset().left:e(this.element).find("thead").width()+e(this.element).find("thead tr").offset().left,(l>=a.left+document.documentElement.scrollLeft+o.offsetWidth-5||l<=a.left+3)&&l<i&&l>=a.left&&n<=a.top+document.documentElement.scrollTop+t.target.offsetHeight?(l>a.left+3?(r=e(t.target).find("span"),this._currentCell=t.target):(r=e(t.target).prevAll("th:visible:first").find("span"),this._currentCell=e(t.target).prev()),r.length&&e(t.target).parents(".e-pivotGridTable tr").css("cursor","col-resize")):(e(t.target).parent("tr").css("cursor","pointer"),this._currentCell=null)}else this.element.find("thead,.pivotGridFrozenTable,.pivotGridColValueTable tr").css("cursor","pointer"),this._currentCell=null}},_startColResizing:function(t){var i,l,n,s,o;if("col-resize"==e(t.target).closest("tr").css("cursor")&&(i=t.clientX,l=t.clientY,this._target=t.target,this._orgX=i,i+=document.documentElement.scrollLeft,2!=t.button))if(e(this._target).parent("tr").find("[role='columnheader']"),null!=this._currentCell&&(n=e(this._currentCell)[0].getBoundingClientRect()),s=this._tableY=(n==r?0:n.top)+document.documentElement.scrollTop,"col-resize"==e(this._target).closest("tr").css("cursor")){var a=e(document.createElement("div")),d=this.model.enableGroupingBar?this.element.height()-this.element.find(".groupingBarPivot").height():this.model.enableVirtualScrolling?this.element.height()-this.element.find(".e-hScrollPanel").parent().height():this.element.height(),h=this.element.find("thead,.pivotGridFrozenTable,.pivotGridColValueTable").find("tr[role='row']"),c=e(this._target).parent("tr")[0]==r?0:e(this._target).parent("tr")[0].rowIndex;for(o=0;o<c;o++)d-=e(h[o]).height();a.addClass("e-reSizeColbg").appendTo(this.element).attr("unselectable","on").css("visibility","hidden"),a.css({visibility:"visible",height:d+"px",cursor:"col-resize",left:i,top:s,position:"fixed"}),this._orgX=i,this._orgY=l,this._expand=!0}else this._currentCell=null},_endColResizing:function(i){var r,l,n,s,o,a,d,h,c,u,g,p;if(this._expand&&(r=i.clientX,i.clientY),this.element.find(".e-reSizeColbg").remove(),r+=document.documentElement.scrollLeft,l=e(this._target).parents("thead,.pivotGridFrozenTable,.pivotGridColValueTable"),null!=this._currentCell&&this._expand){n=30,this._expand=!1;var m=this._currentCell,_=e(m)[0].offsetWidth,f=r-this._orgX,b=(this.model.frozenHeaderSettings.enableFrozenHeaders||!this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&"none"==this._JSONRecords[0].CSS;if(parseInt(f)+parseInt(_)>n&&0!=f){for(l.css("cursor","default"),o=0;o<2;o++)if(a=0==o?e(m):e(m).next(),d=0==o?parseInt(e(m).attr("colspan")):parseInt(e(m).next().attr("colspan")),a.length){if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)if(this.element.find(".e-pivotGridTable").find("[role='columnheader']").find(".e-expand").length>1||this.element.find(".e-pivotGridTable").find("[role='columnheader']").find(".e-collapse").length>1)if(b)s=parseInt(this.element.find(".pivotGridFrozenTable thead tr:last").find("[data-p^='"+a.attr("data-p").split(",")[0]+"']").index());else if(this.model.enableAdvancedFilter){for(h=0,c=0;c<parseInt(a.attr("data-p").split(",")[0]);c++)"none"==this.element.find(".e-pivotGridTable thead tr:last th:eq("+c+")").css("display")&&h++;s=parseInt(a.attr("data-p").split(",")[0])-(h+(this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this._JSONRecords[0].ColSpan-1:0))}else s=parseInt(this.element.find(".e-pivotGridTable thead tr:last").find("[data-p^='"+a.attr("data-p").split(",")[0]+"']").index())+(this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?1:this._JSONRecords[0].ColSpan);else s=b?parseInt(a.attr("data-p").split(",")[0])-this._JSONRecords[0].ColSpan:this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?t.isNullOrUndefined(a.attr("data-i"))?parseInt(a.attr("data-p").split(",")[0]):parseInt(a.attr("data-i").split(",")[0]):parseInt(a.attr("data-p").split(",")[0]);else s=b?parseInt(a.attr("data-p").split(",")[0])-this._JSONRecords[0].ColSpan:this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?parseInt(a.attr("data-i").split(",")[0]):parseInt(a.attr("data-p").split(",")[0]);u=Math.round(f/d),g=this.element.find("col:eq("+s+")").width()+(0==o?u:-u),this._setWidthColResize(s,d,g)}this.element.find("tr").css("cursor","default")}}this.model.enableGroupingBar&&(this._createFields(null,e("#"+this._id).find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth()),this.element.find(".groupingBarPivot").css({overflow:"hidden"})),(this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders)&&(p=this.element.find(".e-scroller").data("ejScroller"),t.isNullOrUndefined(p)||p.refresh()),!this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&this.model.frozenHeaderSettings.enableFrozenRowHeaders&&((p=this.element.find(".e-scroller").data("ejScroller")).model.enableTouchScroll=!1),this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&!this.model.frozenHeaderSettings.enableFrozenRowHeaders&&this.element.find("#coltable").width()<this.element.find(".valScrollArea").width()&&this.element.find("#coltable").width(this.element.find(".valScrollArea").width()),this._target=null,this.element.find(".e-reSizeColbg").remove(),this._expand=!1,this._currentCell=null},_setWidthColResize:function(e,t,i){for(var r=i>30?i:30,l=e;l<e+t;l++)this.element.find("colgroup").find("col:eq("+l+")").outerWidth(r)},_resizeColumnsWidth:function(){var i,r,l,n,s,o;if(!(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders||t.isNullOrUndefined(this._JSONRecords))){if(this.model.enableAdvancedFilter||this.element.find(".e-pivotGridTable").find("colgroup").remove(),i=e("<colgroup></colgroup>"),(this.model.operationalMode!=t.Pivot.OperationalMode.ClientMode||t.isNullOrUndefined(this.model.dataSource.columns)||0!=this.model.dataSource.columns.length&&1!=this.model.dataSource.columns.length)&&(this.model.operationalMode!=t.Pivot.OperationalMode.ServerMode||t.isNullOrUndefined(JSON.parse(this.getOlapReport()).PivotColumns)||0!=JSON.parse(this.getOlapReport()).PivotColumns.length&&1!=JSON.parse(this.getOlapReport()).PivotColumns.length))for(o=0;o<this._JSONRecords.length/this._rowCount&&!t.isNullOrUndefined(this.element.find(".e-pivotGridTable tbody tr:first").children(":visible")[o]);o++)n="<col style='width:"+this.element.find(".e-pivotGridTable tbody tr:first").children(":visible")[o].offsetWidth/Number(e(this.element.find(".e-pivotGridTable tbody tr:first").children(":visible")[o]).attr("colspan"))+"px'></col>",i.append(n);else for(o=0;o<this.element.find(".e-pivotGridTable thead tr:first th").length;o++)for(r=0;r<Number(this.element.find(".e-pivotGridTable thead tr:first th:eq("+o+")").attr("colspan"));r++)l=this.element.find(".e-pivotGridTable thead tr:first th:eq("+o+")"),n="<col style='width:"+(t.isNullOrUndefined(l.offsetWidth)?l.outerWidth():l.offsetWidth)/Number(l.attr("colspan"))+"px'></col>",i.append(n);if(this.model.enableAdvancedFilter&&this.element.find(".e-pivotGridTable").find("colgroup").remove(),this.element.find(".e-pivotGridTable").prepend(i),this.model.enableColumnResizing&&this.model.resizeColumnsToFit&&this.element.find(".e-pivotGridTable").css("width","100%"),this.model.enableGroupingBar){if(s=this.element.find(".groupingBarPivot .values").width()>this.element.find(".e-grpRow .e-rows").width()?this.element.find(".groupingBarPivot .values").width():this.element.find(".e-grpRow .e-rows").width(),this._JSONRecords.length>0&&this._JSONRecords[0].ColSpan>=1&&!this.model.resizeColumnsToFit)for(o=0;o<this._JSONRecords[0].ColSpan;o++)this.element.find("colgroup col:eq("+o+")").css("width",s/this._JSONRecords[0].ColSpan);this.element.find(".groupingBarPivot .values").width()<this.element.find(".e-grpRow .e-rows").width()&&this.element.find(".groupingBarPivot .values").css("width",this.element.find(".e-grpRow .e-rows").width()),this.element.find(".e-grpRow").length>0&&this.element.find("colgroup col:eq(0)").width()<140&&this.element.find("colgroup col:eq(0)").css("min-width","140px"),this.element.find(".values").width(this.element.find(".e-grpRow").length>0?this.model.enableDeferUpdate&&0==this.element.find(".colheader").length?this.element.find(".e-grpRow").width():this.element.find(".e-grpRow").width()+4:140),this._createFields(null,this.element.find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth())}}},_direction:function(e){return this.model.enableRTL&&!t.isNullOrUndefined(e)&&e.toString().indexOf("-")>-1?e.split("-").reverse().join("-"):e},_clearSelection:function(t){0==e(t.target).parents(".e-pivotGridTable").length&&e(this.element).find(".e-selected").removeClass("e-selected")},_startCellSelection:function(i){var r,l;if("Control"!=this._onholdKey&&!t.isNullOrUndefined(this._selectedCell))if(i.preventDefault(),""==this._onholdKey&&(this._onholdKey="16"==i.which.toString()?"Shift":"17"==i.which.toString()?"Control":""),"40"==i.which){for(n=e(this._selectedCell).attr("data-p"),s=parseInt(n.split(",")[1])+this._selectedCell.rowSpan;t.isNullOrUndefined(o)&&s<this._rowCount;)l=e(this.element).find("[data-p='"+n.split(",")[0]+","+s+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role"))&&(o=l),s++;t.isNullOrUndefined(o)||this._selectCells("Down",o)}else if("38"==i.which){for(n=e(this._selectedCell).attr("data-p"),s=parseInt(n.split(",")[1])-1;t.isNullOrUndefined(o)&&s>=0;)l=e(this.element).find("[data-p='"+n.split(",")[0]+","+s+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role"))&&(o=l),s--;if(t.isNullOrUndefined(o)&&"Shift"!=this._onholdKey&&(e(this._selectedCell).hasClass("colheader")||"columnheader"==e(this._selectedCell).attr("role")))for(column=parseInt(n.split(",")[0])-1;column>0&&t.isNullOrUndefined(o);column--)for(row=parseInt(n.split(",")[1]-1);row>=0&&t.isNullOrUndefined(o);row--)l=e(this.element).find("[data-p='"+column+","+row+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("colheader")||"columnheader"==e(l).attr("role"))&&(o=l);t.isNullOrUndefined(o)||this._selectCells("Up",o)}else if("39"==i.which){for(n=e(this._selectedCell).attr("data-p"),s=parseInt(n.split(",")[0])+this._selectedCell.colSpan;t.isNullOrUndefined(o)&&s<Math.ceil(this.getJSONRecords().length/this._rowCount);)l=e(this.element).find("[data-p='"+s+","+n.split(",")[1]+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role"))&&(o=l),s++;t.isNullOrUndefined(o)||this._selectCells("Right",o)}else if("37"==i.which){for(var n=e(this._selectedCell).attr("data-p"),s=parseInt(n.split(",")[0])-1,o=e(this.element).find("[data-p='"+(parseInt(n.split(",")[0])-1)+","+n.split(",")[1]+"']")[0];t.isNullOrUndefined(o)&&s>=0;)l=e(this.element).find("[data-p='"+s+","+n.split(",")[1]+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role")||e(l).hasClass("colheader")||"columnheader"==e(l).attr("role"))&&(o=l),s--;if(t.isNullOrUndefined(o)&&"Shift"!=this._onholdKey&&(e(this._selectedCell).hasClass("rowheader")||"rowheader"==e(this._selectedCell).attr("role")))for(r=parseInt(n.split(",")[1])-1;t.isNullOrUndefined(o)&&r>0;)l=e(this.element).find("[data-p='"+parseInt(n.split(",")[0]-1)+","+r+"']")[0],!t.isNullOrUndefined(l)&&"none"!=e(l).css("display")&&"none"!=e(e(l).parents("tr")[0]).css("display")&&(e(l).hasClass("rowheader")||"rowheader"==e(l).attr("role"))&&(o=l),r--;t.isNullOrUndefined(o)||this._selectCells("Left",o)}},_endCellSelection:function(i){var r,l,n,s,o;if(!t.isNullOrUndefined(this._selectedCell)&&(i.preventDefault(),(16==i.which||17==i.which)&&(this._onholdKey="",(r=e(this.element).find(".e-selected")).length>0))){for(l=[],n=0;n<r.length;n++)s=e(r[n]).attr("data-p"),(o=this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))]).Value=e.trim(e(r[n]).text()),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(o.Field=this._getFieldName(r[n])),l.push(o);t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellSelection",{JSONRecords:l}):this._pivotClientObj._trigger("cellSelection",{JSONRecords:l})}},_selectCells:function(i,r){var l,n,s,o,a,d,h;if("Shift"==this._onholdKey)(("Up"==i||"Down"==i)&&(e(r).hasClass("rowheader")||"rowheader"==e(r).attr("role"))||("Right"==i||"Left"==i)&&(e(r).hasClass("colheader")||"columnheader"==e(r).attr("role")))&&(l="Up"==i||"Down"==i?1:0,("Up"==i||"Left"==i)&&parseInt(e(r).attr("data-p").split(",")[l])>=parseInt(this._primaryCellPos.split(",")[l])||("Right"==i||"Down"==i)&&parseInt(e(r).attr("data-p").split(",")[l])<=parseInt(this._primaryCellPos.split(",")[l])?e(this._selectedCell).removeClass("e-selected"):"0,0"!=e(r).attr("data-p")&&e(r).addClass("selected"));else if("0,0"!=e(r).attr("data-p")&&(this.element.find(".e-selected").removeClass("e-selected"),e(r).addClass("e-selected"),this._primaryCellPos=e(r).attr("data-p"),(n=e(this.element).find(".e-selected")).length>0)){for(s=[],o=0;o<n.length;o++)a=e(n[o]).attr("data-p"),(d=this.getJSONRecords()[parseInt(parseInt(a.split(",")[0])*this._rowCount+parseInt(a.split(",")[1]))]).Value=e.trim(e(n[o]).text()),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(d.Field=this._getFieldName(n[o])),s.push(d);t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellSelection",{JSONRecords:s}):this._pivotClientObj._trigger("cellSelection",{JSONRecords:s})}h="Up"==i||"Down"==i?!e(this._selectedCell).hasClass("colheader")&&"columnheader"!=e(this._selectedCell).attr("role"):!e(this._selectedCell).hasClass("rowheader")&&"rowheader"!=e(this._selectedCell).attr("role"),"0,0"!=e(r).attr("data-p")&&("Shift"!=this._onholdKey||h)&&(this._selectedCell=r)},_sortBtnClick:function(i){var r,l,n,s,o,a,d,h;if(t.PivotAnalysis._valueSorting=null,t.isNullOrUndefined(this.model.valueSortSettings)||(this.model.valueSortSettings.headerText=""),this._isUpdateRequired=!0,e(i.delegateTarget).attr("id")==this._id&&(e(i.target).toggleClass("descending"),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".e-pivotButton[data-tag='"+e(i.target).parent().attr("data-tag")+"']").find(".e-sorting").toggleClass("descending")),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)r=e(i.target).siblings(".e-pvtBtn").attr("data-fieldName"),t.Pivot.getReportItemByFieldName(r,this.model.dataSource).item.sortOrder=i.target.className.indexOf("descending")>=0?t.PivotAnalysis.SortOrder.Descending:t.PivotAnalysis.SortOrder.Ascending,this.refreshControl();else{for(l=this._ascdes.split("##"),n=0,s=0;s<l.length;s++)l[s]==e(e(i.target).siblings(".e-pvtBtn")).attr("data-fieldName")?n=1:e(i.target).parents().hasClass("e-pivotschemadesigner")&&l[s]==e(e(i.target).siblings(".e-pvtBtn")).text()&&(n=1);o=i.target.className,new RegExp("descending").test(o)?0==n&&(this._ascdes+=e(i.target).parents().hasClass("e-pivotschemadesigner")?e(e(i.target).siblings(".e-pvtBtn")).text()+"##":e(e(i.target).siblings(".e-pvtBtn")).attr("data-fieldName")+"##"):1==n&&(this._ascdes=this._ascdes.replace(e(e(i.target).siblings(".e-pvtBtn")).attr("data-fieldName")+"##","")),d=JSON.stringify(this.model.customObject);try{a=JSON.parse(this.getOlapReport()).Report}catch(e){a=this.getOlapReport()}null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:"sorting",element:this.element,customObject:this.model.customObject}),d=JSON.stringify(this.model.customObject),h=JSON.stringify({action:"sorting",sortedHeaders:this._ascdes,currentReport:a,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:d}),this._waitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),this.model.enableDeferUpdate?this._waitingPopup.hide():this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.sorting,h,this._sortingSuccess)}},calculateCellWidths:function(){var t,i,r,l,n={rowHeight:0,columnWidths:[]};if(t=null!=this._excelLikeJSONRecords?this._excelLikeJSONRecords.length/this._excelRowCount:null!=this.getJSONRecords()?this.getJSONRecords().length/this._rowCount:0,i=1,r=!1,t>0)for(n.rowHeight=this.element.find("tbody tr:visible").length>0?this.element.find("tbody tr:visible")[0].getBoundingClientRect().height:0,l=0;l<t&&i<=t;l++)e(null!=this._excelLikeJSONRecords?this.element.find("th[data-i^="+l+"]:visible"):this.element.find("th[data-p^="+l+"]:visible")).each(function(){if(e(this).length>0&&e(this).attr("colspan")==i&&(null!=e(this).attr("data-i")?e(this).attr("data-i").split(",")[0]==l:e(this).attr("data-p").split(",")[0]==l))return n.columnWidths.push(this.getBoundingClientRect().width),l+=i-1,i=1,r=!0,!1;r=!1}),r||i==t?i=1:(l--,i++);return n},_deferUpdate:function(){var e,i,r,l,n;if(!this._isUpdateRequired)return!1;this._isUpdateRequired=!1;try{e=JSON.parse(this.getOlapReport()).Report}catch(t){e=this.getOlapReport()}for(i="",r=0;r<this._filterUpdate.length;r++)i+=this._filterUpdate[r]+"%%";l=JSON.stringify(this.model.customObject),n=JSON.stringify({action:"deferUpdate",sortedHeaders:this._ascdes,gridLayout:this.layout(),filterParams:i,currentReport:e,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:l}),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.deferUpdate,n,this._renderControlSuccess),this._filterUpdate=[],this._waitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show()},_dialogBtnClick:function(i){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w;if(this.element.find(".e-dialog, .e-clientDialog").hide(),"cancel"==i.model.text.toLowerCase()||!this._isMembersFiltered)return t.Pivot.closePreventPanel(this),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style"),!1;if(this._savedReportItems=e.extend(!0,[],this._currentReportItems),this.element.find(".e-editorTreeView").find("li span.e-searchfilterselection").length>0&&this.element.find(".e-editorTreeView").ejTreeView("removeNode",this.element.find(".e-editorTreeView").find("li span.e-searchfilterselection").closest("li")),this._isUpdateRequired=!0,this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)if(l=[],n=[],this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)t.PivotAnalysis._valueSorting=null,this.model.enableMemberEditorPaging||this._editorTreeData.length>0?(jQuery.each(this._editorTreeData,function(e,t){"All"!=t.id&&t.checkedStatus&&l.push(t.name)}),jQuery.each(this._editorTreeData,function(e,t){t.checkedStatus||n.push(t.name="(blank)"==t.name?"":t.name)})):(jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:checked"),function(e,t){"All"!=t.value&&l.push(t.value)}),jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:not(:checked)"),function(t,i){n.push(i.value="(blank)"==i.value?"":e(i).parents("li").find("a").text())})),this._pivotFilterItems(l,n),(u=t.Pivot.getReportItemByFieldName(this._selectedField,this.model.dataSource).item)&&(u.advancedFilter=[]),this.model.editCellsInfo={},this._populatePivotGrid();else{if(o=this.model.dataSource.providerName==t.olap.Providers.Mondrian,this._waitingPopup.show(),a=this._selectedField.toLocaleLowerCase(),this._currentReportItems=e.grep(this._currentReportItems,function(e){if(e["data-fieldName"]!=r&&e["data-fieldName"].toLocaleLowerCase()!=a)return e}),this._memberTreeObj=t.Pivot.updateTreeView(this),d=t.Pivot.getNodesState(this.model.enableMemberEditorPaging||this._editorTreeData.length>0?this._editorTreeData:this._memberTreeObj),null!=this._schemaData&&(this._schemaData._memberTreeObj=this._memberTreeObj),s=this.model.enableMemberEditorPaging||this._editorTreeData.length>0?e.extend(!0,[],this._editorTreeData):this._memberTreeObj.dataSource(),o){for(h=2,c=0;c<s.length;c++)!t.isNullOrUndefined(s[c].level)&&s[c].level>h&&(h=s[c].level);this.model.dataSource._maxLevel=h}if(this._currentReportItems.push({filterItems:s,fieldName:this._selectedField,pageSettings:this._memberCount}),this.model.enableGroupingBar){var I=t.Pivot._getEditorMember(a,this,!1),y="selectedNodes",T="include";this._fieldSelectedMembers[a]=0==e.map(this._fieldMembers[a],function(e){if(!e.checked)return e}).length?"All":"All"!=I&&"multiple"!=I?I:this._getLocalizedLabels("MultipleItems")}o&&(y="unSelectedNodes",T="exclude"),l=e.map(d[y].split("::"),function(e){return{Id:e.split("||")[0],tag:e.split("||")[1],parentId:e.split("||")[2]}}),u=t.Pivot.getReportItemByFieldName(a,this.model.dataSource).item,t.isNullOrUndefined(u)||(""!=d.unSelectedNodes?(this.model.dataSource=this.clearDrilledItems(this.model.dataSource,{action:"filtering"},this),u.advancedFilter=[],u.filterItems={filterType:T,values:this._removeSelectedNodes(l)},this.element.find(".e-pivotButton:contains('"+this._selectedField+"') .filter").addClass("filtered"),null!=this._schemaData&&0==this._schemaData._tableTreeObj.element.find("li[data-tag='"+this._selectedField+"'] .filter").length&&(this._schemaData._tableTreeObj.element.find("li[data-tag='"+this._selectedField+"'] div:first .e-text").after(t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML),this._schemaData.element.find(".e-pvtBtn[data-fieldName='"+this._selectedField+"']").parent().find(".filter").addClass("filtered"))):(delete u.filterItems,null!=this._schemaData&&(this._schemaData._tableTreeObj.element.find("li[data-tag='"+this._selectedField+"'] .filter").remove(),this._schemaData.element.find(".e-pvtBtn[data-fieldName='"+this._selectedField+"']").parent().find(".filter").removeClass("filtered")))),this.getJSONData({action:"filtering"},this.model.dataSource,this)}else{"",g="",g=this.element.find(".e-editorTreeView :input.nodecheckbox");var L=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this._getUnSelectedNodes()+"FILTERED"+this._getSelectedNodes(this.model.analysisMode==t.Pivot.AnalysisMode.Olap?"Slicers"==this._curFilteredAxis:"Filter"==this._curFilteredAxis):this.model.enableMemberEditorPaging||this._editorTreeData.length>0?this._editorTreeData:this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),R=!1,O=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.enableMemberEditorPaging||this._editorTreeData.length>0?t.Pivot._getUnSelectedTreeState(this)+"FILTERED"+t.Pivot._getSelectedTreeState(this.model.analysisMode==t.Pivot.AnalysisMode.Olap?"Slicers"==this._curFilteredAxis:"Filter"==this._curFilteredAxis,this):L:this._curFilteredAxis+"::"+this._curFilteredText+"::FILTERED",F=this._curFilteredText,E=[],D={};if(p=this.model.enableMemberEditorPaging||this._editorTreeData.length>0?""!=t.Pivot._getUnSelectedTreeState(this):""!=this._getUnSelectedNodes(),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){for(this.model.enableGroupingBar&&t.isNullOrUndefined(this._fieldMembers[F])&&(this._fieldMembers[F]=this._editorTreeData.length>0?e.map(this._editorTreeData,function(e){if("(All)_0"!=e.id)return e.key||e.name}):t.Pivot._getEditorMember(g,this,!1)),this._removeFilterTag(this._curFilteredText),L.length>0&&"(All)_0"==L[0].id&&L.splice(0,1),_=0;_<L.length;_++)this.model.enableMemberEditorPaging||0!=this._editorTreeData.length?0==L[_].checkedStatus&&E.push(L[_].key||L[_].name):E.push(e(L[_].parentElement).siblings("a").text());for(D[F]=E,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),_=0;_<this._tempFilterData.length;_++)t.isNullOrUndefined(this._tempFilterData[_][F])||(this._tempFilterData[_][F]=E,R=!0);if(R||this._tempFilterData.push(D),null!=this._schemaData&&(this._schemaData._tempFilterData=this._tempFilterData),t.isNullOrUndefined(this._curFilteredAxis)||""!=this._curFilteredAxis)for(_=0;_<L.length;_++)this.model.enableMemberEditorPaging||0!=this._editorTreeData.length?0==L[_].checkedStatus&&(O+="##"+(L[_].key||L[_].name)):O+="##"+e(L[_].parentElement).siblings("a").text()}else{for(this.model.enableGroupingBar&&(I=t.Pivot._getEditorMember(F.split(":")[1],this,!1),this._fieldSelectedMembers[F.split(":")[1]]=0==e.map(this._fieldMembers[F.split(":")[1]],function(e){if(!e.checked)return e}).length?"All":"All"!=I&&"multiple"!=I?I:this._getLocalizedLabels("MultipleItems")),D[this._curFilteredText.split(":")[1]]=O,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),_=0;_<this._tempFilterData.length;_++)t.isNullOrUndefined(this._tempFilterData[_][this._curFilteredText.split(":")[1]])||(this._tempFilterData[_]=D,R=!0);R||this._tempFilterData.push(D)}if("excel"==this.model.layout?this.element.find(".e-schemaFieldTree li:contains('"+this._curFilteredText+"')"):this.element.find("."+this._curFilteredAxis+" .e-pivotButton:contains("+this._curFilteredText+") .filterBtn"),m=this._curFilteredText,this.model.layout==t.PivotGrid.Layout.Normal&&null!=this._schemaData){for(_=0;_<this._schemaData.element.find(".e-fieldTable").find("li").length;_++)this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this._curFilteredText.split(":")[1]==e(this._schemaData.element.find(".e-fieldTable").find("li")[_]).attr("data-tag").replace(/\]/g,"").replace(/\[/g,"")&&(this._schemaData._selectedTreeNode=this._schemaData.element.find(".e-fieldTable").find("li")[_],m=this._curFilteredText.split(":")[1].split(".")[1]):this._curFilteredText==this._schemaData.element.find(".e-fieldTable").find("li")[_].id&&(this._schemaData._selectedTreeNode=this._schemaData.element.find(".e-fieldTable").find("li")[_],m=this._curFilteredText);if(e(this._schemaData._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("e-hierarchyCDB")&&(this._schemaData._selectedTreeNode=e(e(this._schemaData._selectedTreeNode).parents("li:eq(0)"))),p&&e(this._schemaData._selectedTreeNode).find(".filter").length<=0?(f=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,e(e(this._schemaData._selectedTreeNode).find(".e-text")[0]).after(f),this._schemaData.element.find(".e-pvtBtn:contains('"+m+"')").parent().find(".filter").addClass("filtered")):p||(e(this._schemaData._selectedTreeNode).find(".filter").remove(),this._schemaData.element.find(".e-pvtBtn:contains('"+m+"')").parent().find(".filter").removeClass("filtered")),""==this._curFilteredAxis)return!1}try{b=JSON.parse(this.getOlapReport()).Report}catch(e){b=this.getOlapReport()}if(this.model.enableAdvancedFilter&&this._selectedLevelUniqueName&&3==this._selectedLevelUniqueName.split("].").length&&((C=this._getAdvancedFilterInfo(this._selectedLevelUniqueName.split("].").slice(0,2).join(".").replace(/\[/g,""))).length>0&&this._removeFilterTag(C[0].levelUniqueName)),"KPI"==this._dialogHead&&(O=L),null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject}),S=JSON.stringify(this.model.customObject),x=this.model.customObject!={}&&""!=O?JSON.stringify({action:"filtering",filterParams:O,sortedHeaders:this._ascdes,currentReport:b,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:S,gridLayout:this.model.layout}):this.model.customObject!={}?JSON.stringify({action:"filtering",currentReport:b,customObject:S,gridLayout:this.model.layout}):""!=O?JSON.stringify({action:"filtering",filterParams:O,sortedHeaders:this._ascdes,currentReport:b,gridLayout:this.model.layout}):JSON.stringify({action:"filtering"}),this._waitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").addClass("freeze").width(e(this._schemaData.element).width()).height(e(this._schemaData.element).height()).css({top:e(this._schemaData.element).offset().top,left:e(this._schemaData.element).offset().left}),this.model.enableDeferUpdate){if(this._filterUpdate.push(O),e.each(this.element.find(".e-pivotButton .filter"),function(t,i){e(i).removeClass("filtered")}),!t.isNullOrUndefined(this._tempFilterData))for(v=0;v<this._tempFilterData.length;v++)for(w in this._tempFilterData[v])this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?w==F.split(":")[1]&&this._tempFilterData[v][F.split(":")[1]].split("FILTERED::")[0].length>0&&this.element.find(".e-pivotButton[data-tag='"+F+"']").find("span.filter").addClass("filtered"):w==F&&this._tempFilterData[v][F].length>0&&this.element.find("#pivotButton"+F).next().addClass("filtered");t.Pivot.closePreventPanel(this),this.model.enableGroupingBar&&this._refreshGroupingBar(this),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")}else this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,x,this._filterElementSuccess)}t.isNullOrUndefined(this._schemaData)||this._schemaData._refreshPivotButtons()},_refreshGroupingBar:function(){this._createGroupingBar(JSON.parse(this.getOlapReport())),this._createFields(null,e("#"+this._id).find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth())},_removeSelectedNodes:function(t){for(var i,l=e.extend([],t),n=0;n<t.length;n++)for(i=0;i<l.length;i++)l[i].Id==t[n].parentId&&l.splice(i,1);return e.map(l,function(e){if(""!=e.tag&&e.tag!=r)return e.tag.replace(/\&/g,"&amp;")})},_pivotFilterItems:function(i,r){var l,n,s=this.model.dataSource["Slicers"==this._selectedAxis?"filters":this._selectedAxis.toLowerCase()],o=t.PivotAnalysis.getMembers(this._selectedField);jQuery.each(o,function(e,t){null!=t&&t.toString().replace(/^\s+|\s+$/gm,"")||jQuery.each(r,function(e,i){i.toString().replace(/^\s+|\s+$/gm,"")||(r[e]=t)})});var a=this._selectedField,d=(this._dialogTitle,e.grep(s,function(e){return e.fieldName==a}));for(l=0;l<d.length;l++)d[l].filterItems=i.length==o.length?null:{filterType:t.PivotAnalysis.FilterType.Exclude,values:r};null!=this._schemaData&&(r.length>0&&this._schemaData.element.find(".e-schemaFieldTree li[id='"+this._selectedField+"']").find(".filter").length<=0?(n=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,this._schemaData.element.find(".e-schemaFieldTree li[id='"+this._selectedField+"']").find(".e-text").after(n),this._schemaData.element.find(".e-pvtBtn[data-fieldName='"+this._selectedField+"']").parent().find(".filter").addClass("filtered")):0==r.length&&(this._schemaData.element.find(".e-schemaFieldTree li[id='"+this._selectedField+"']").find(".filter").remove(),this._schemaData.element.find(".e-pvtBtn[data-fieldName='"+this._selectedField+"']").parent().find(".filter").removeClass("filtered")))},_getUnSelectedNodes:function(){var i,r,l=this.element.find(".e-editorTreeView")[0],n="",s=e(l).find(":input.nodecheckbox:not(:checked)");if(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode)for(i=0;i<s.length;i++)e(s[i].parentElement).find("span:nth-child(1)").attr("class").indexOf("e-chk-act")>-1||"mixed"==e(s[i].parentElement).attr("aria-checked")||(n+="::"+(r=e(s[i]).parents("li:eq(0)"))[0].id+"||"+e(r).attr("data-tag")+("KPI"==this._dialogHead?"~&"+e(e(s[i]).parents("ul:eq(1) li")[1]).attr("data-tag"):""));return n},_getSelectedNodes:function(i){var r,l,n,s,o;if(i){for(this.element.find(".e-editorTreeView").length>0?a=this.element.find(".e-editorTreeView")[0].childNodes[0]:t.isNullOrUndefined(this._schemaData)||(a=this._memberTreeObj.element[0].childNodes[0]),d=[],h=e(a).children(),s=0;s<h.length;s++){if(o=h[s],r={caption:e(o.firstChild).find("a").text(),parentId:o.parentElement.parentElement.className.indexOf("e-editorTreeView")>-1?"None":e(o).parents()[1].id,id:o.id,checked:e(o).find(":input.nodecheckbox")[0].checked||e(o).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:e(o.firstChild).find(".e-minus").length>0,childNodes:[],tag:e(o).attr("data-tag")},e(o).find("ul:first").children().length>0)for(l=e(o).find("ul:first").children(),n=0;n<l.length;n++)r.childNodes.push(this._getNodeInfo(l[n]));d.push(r)}return JSON.stringify(d)}var a=this.element.find(".e-editorTreeView")[0],d="",h=e(a).find(":input.nodecheckbox");for(s=0;s<h.length;s++)(h[s].checked||"mixed"==e(h[s].parentElement).attr("aria-checked"))&&(d+="::"+(o=e(h[s]).parents("li:eq(0)"))[0].id+"||"+e(o).attr("data-tag")+("KPI"==this._dialogHead?"~&"+e(e(h[s]).parents("ul:eq(1) li")[1]).attr("data-tag"):""));return d},_getNodeInfo:function(t){var i,r,l={caption:e(t.firstChild).find("a").text(),parentId:t.parentElement.parentElement.className.indexOf("e-editorTreeView")>-1?"None":e(t).parents()[1].id,id:t.id,checked:e(t).find(":input.nodecheckbox")[0].checked||e(t).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:e(t.firstChild).find(".e-minus").length>0,childNodes:[],tag:e(t).attr("data-tag")};if(e(t).find("ul:first").children().length>0)for(i=e(t).find("ul:first").children(),r=0;r<i.length;r++)l.childNodes.push(this._getNodeInfo(i[r]));return l},_getLevelInfo:function(t,i){var r=e.map(e(i).find("row"),function(i){if("1"!=parseInt(e(i).children("LEVEL_TYPE").text())&&"[measures]"!=e(i).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase()&&e(i).find("HIERARCHY_UNIQUE_NAME").text()==t.hierarchy)return{value:e(i).find("LEVEL_UNIQUE_NAME").text(),text:e(i).find("LEVEL_CAPTION").text()}});this.olapCtrlObj._currentReportItems.push({fieldName:t.hierarchy,dropdownData:r})},_sortField:function(i){var r,l,n,s,o;if(this.element.find(".e-dialog, .e-clientDialog").remove(),t.Pivot.closePreventPanel(this),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){if(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode)return r=this._selectedField,this._ascdes=this._ascdes+r+"##","descOrder"!=e(i.element).attr("id")&&(this._ascdes=e.grep(this._ascdes.split("##"),function(e){return e!=r}).join("##")),this._applySorting(),!1;t.Pivot.getReportItemByFieldName(this._selectedField,this.model.dataSource).item.sortOrder="descOrder"==e(i.element).attr("id")?t.PivotAnalysis.SortOrder.Descending:t.PivotAnalysis.SortOrder.Ascending,this.refreshControl()}else{if(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode){this._waitingPopup&&this._waitingPopup.show();try{l=JSON.parse(this.getOlapReport()).Report}catch(e){l=this.getOlapReport()}n=!1,this._excelFilterInfo.length>0&&(this._selectedField=this._selectedLevelUniqueName.split("].").splice(0,2).join("].")+"]",s=this._selectedLevelUniqueName,o=this._selectedField,this._excelFilterInfo=e.grep(this._excelFilterInfo,function(r){return(r.hierarchyUniqueName==o||t.isNullOrUndefined(o)||t.isNullOrUndefined(r.hierarchyUniqueName))&&r.levelUniqueName==s&&(n=!0,0==e(i.element).find(".e-clrSort").length?r.sortOrder=e(i.element).attr("id"):delete r.sortOrder),r})),n||this._excelFilterInfo.push({hierarchyUniqueName:this._selectedFieldName,levelUniqueName:this._selectedLevelUniqueName,sortOrder:e(i.element).attr("id")}),this._selectedField=this._selectedLevelUniqueName.split("].").splice(0,2).join("].")+"]";var a=this._selectedField+"--"+e(i.element).attr("id"),d=JSON.stringify(this.model.customObject),h=JSON.stringify({action:"labelSorting",filterParams:a,currentReport:l,customObject:d,gridLayout:this.model.layout});return this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,h,this._filterElementSuccess),!1}t.olap.base._clearDrilledCellSet(),("descOrder"==e(i.element).attr("id")||"ascOrder"==e(i.element).attr("id"))&&(t.Pivot.getReportItemByFieldName(this._selectedField,this.model.dataSource).item.sortOrder="descOrder"==e(i.element).attr("id")?t.olap.SortOrder.Descending:t.olap.SortOrder.Ascending,this._waitingPopup.show(),t.olap.base.getJSONData({action:"sorting"},this.model.dataSource,this))}},_applySorting:function(){var e,i,r=JSON.stringify(this.model.customObject);try{e=JSON.parse(this.getOlapReport()).Report}catch(t){e=this.getOlapReport()}null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:"sorting",element:this.element,customObject:this.model.customObject}),r=JSON.stringify(this.model.customObject),i=JSON.stringify({action:"sorting",sortedHeaders:this._ascdes,currentReport:e,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:r}),this._waitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),this.model.enableDeferUpdate?t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.hide():this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.sorting,i,this._sortingSuccess)},_createDialog:function(i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=this.model.enableAdvancedFilter||this.model.dataSource.enableAdvancedFilter,C=!1;b&&(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(this._selectedField=this._curFilteredText,"Slicers"!=this._curFilteredAxis&&(C=this._getAdvancedFilterInfo(this._curFilteredText).length>0),b=!this.element.find(".e-pivotButton button[data-fieldName='"+this._curFilteredText+"']").parents("div:eq(0)").hasClass("e-drag")):b=!(!b||this.element.find(".e-pivotButton[data-tag='"+this._curFilteredText+"']").parents("div:eq(0)").hasClass("e-drag")):b=!(!b||"filters"==t.Pivot.getReportItemByFieldName(this._selectedField,this.model.dataSource).axis)),this.element.find(".e-dialog, .e-clientDialog").remove(),this._isOptionSearch=!1,this._currentFilterList={},this._editorSearchTreeData=[],this._isEditorDrillPaging=!1,this._lastSavedTree=[],this._isSearchApplied=!1;var S,x,v,w=this._selectedField,I="",y="";e(document).height();b&&((n=JSON.parse(r))[0].name="(Select All)",this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?(S=this.model.enableMemberEditorPaging?this._memberPagingAvdData:n.splice(n.length-1,1),S=JSON.parse(S[0].levels)):this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?0==(S=e.map(this._currentReportItems,function(e){if(e.fieldName==w)return e.dropdownData})).length&&(s=this._getConnectionInfo(this.model.dataSource.data),o='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_LEVELS</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+this.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+this.model.dataSource.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+this.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+s.LCID+"</LocaleIdentifier> </PropertyList></Properties></Discover></Body></Envelope>",this.doAjaxPost("POST",s.url,{XMLA:o},this._getLevelInfo,null,{pvtGridObj:this,action:"loadFieldElements",hierarchy:this._selectedField}),S=e.map(this._currentReportItems,function(e){if(e.fieldName==w)return e.dropdownData})):S=[{value:this._selectedField,text:this._selectedField}],r=JSON.stringify(n),I=t.buildTag("div.e-ddlGroupWrap",this._getLocalizedLabels("SelectField")+t.buildTag("input#GroupLabelDrop.groupLabelDrop").attr("type","text")[0].outerHTML,{})[0].outerHTML,y=t.buildTag("ul.e-filterElementTag")[0].outerHTML,a=t.Pivot.createAdvanceFilterTag({action:"filterTag"},this)),x=t.buildTag("div.e-memberSearchEditorDiv",t.buildTag("input#searchEditorTreeView.searchEditorTreeView").attr("type","text")[0].outerHTML+(this.model.enableMemberEditorPaging&&e.parseJSON(r).length>=this.model.memberEditorPageSize?t.buildTag("span.e-icon e-searchEditorTree",{})[0].outerHTML:""),{padding:b?"5px 5px 0px 9px":"0px"})[0].outerHTML;var T=t.buildTag("div#EditorDiv.e-editorDiv",I+t.buildTag("div",y+x+t.buildTag("div.e-memberEditorDiv",t.buildTag("div#editorTreeView.e-editorTreeView",{"margin-top":this.model.enableAdvancedFilter?"10px":"2px"})[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML+(!t.isNullOrUndefined(r)&&this.model.enableMemberEditorPaging&&(e.parseJSON(r).length>=this.model.memberEditorPageSize||this.model.memberEditorPageSize<this._memberPageSettings.endPage)?"":"</br>"),L=t.buildTag("div",t.buildTag("button#OKBtn.e-dialogOKBtn",this._getLocalizedLabels("OK")).attr({title:this._getLocalizedLabels("OK"),tabindex:0})[0].outerHTML+t.buildTag("button#CancelBtn.e-dialogCancelBtn",this._getLocalizedLabels("Cancel")).attr({title:this._getLocalizedLabels("Cancel"),tabindex:0})[0].outerHTML,{float:"right",margin:(b?"-9px 5px 11px ":"-13px 0px 7px ")+"  0px"})[0].outerHTML,R=t.buildTag("div.e-memberPager",t.buildTag("div#"+this._id+"_NextpageDiv.e-nextPageDiv",t.buildTag("div.e-icon e-media-backward_01 e-firstPage",{})[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-left e-prevPage",{})[0].outerHTML+t.buildTag("input.e-memberCurrentPage#memberCurrentPage",{},{width:"20px",height:"10px"})[0].outerHTML+t.buildTag("span.e-memberPageCount#memberPageCount")[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-right e-nextPage",{})[0].outerHTML+t.buildTag("div.e-icon e-media-forward_01 e-lastPage",{})[0].outerHTML)[0].outerHTML)[0].outerHTML,O=t.buildTag("div.e-memberSearchPager",t.buildTag("div#"+this._id+"_NextSearchpageDiv.e-nextPageDiv",t.buildTag("div.e-icon e-media-backward_01 e-firstPage",{})[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-left e-prevPage",{})[0].outerHTML+t.buildTag("input.e-memberCurrentSearchPage#memberCurrentSearchPage",{},{width:"20px",height:"10px"})[0].outerHTML+t.buildTag("span.e-memberSearchPageCount#memberSearchPageCount")[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-right e-nextPage",{})[0].outerHTML+t.buildTag("div.e-icon e-media-forward_01 e-lastPage",{})[0].outerHTML)[0].outerHTML,{}).css("display","none")[0].outerHTML,F=t.buildTag("div.e-memberDrillPager",t.buildTag("div#"+this._id+"_NextDrillpageDiv.e-nextPageDiv",t.buildTag("div.e-icon e-media-backward_01 e-firstPage",{})[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-left e-prevPage",{})[0].outerHTML+t.buildTag("input.e-memberCurrentDrillPage#memberCurrentDrillPage",{},{width:"20px",height:"10px"})[0].outerHTML+t.buildTag("span.e-memberDrillPageCount#memberDrillPageCount")[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-right e-nextPage",{})[0].outerHTML+t.buildTag("div.e-icon e-media-forward_01 e-lastPage",{})[0].outerHTML)[0].outerHTML,{}).css("display","none")[0].outerHTML;for(v=t.buildTag("div.e-linkOuterPanel",t.buildTag("span.e-infoImg e-icon","",{}).css({float:"left","margin-top":"4px","font-size":"16px"})[0].outerHTML+t.buildTag("a.e-linkPanel",this._getLocalizedLabels("NotAllItemsShowing")).css({display:"inline-block","margin-left":"3px","margin-top":"2px"})[0].outerHTML,{}).css({display:"none","margin-top":"-16px","margin-left":b?"8px":"0px"})[0].outerHTML,d=t.buildTag("div#clientDialog.e-clientDialog",T+(!t.isNullOrUndefined(r)&&this.model.enableMemberEditorPaging?e.parseJSON(r).length>=this.model.memberEditorPageSize||this.model.memberEditorPageSize<this._memberPageSettings.endPage?F+O+R:F+O:v)+L,{opacity:"1"}).attr("title",i)[0].outerHTML,r=JSON.parse(r),_=0;_<r.length;_++)null!=r[_].name&&r[_].name.toString().replace(/^\s+|\s+$/gm,"")||(r[_].name="(blank)",r[_].id="(blank)"),t.isNullOrUndefined(r[_].id)||"string"!=typeof r[_].id||(r[_].id=r[_].id.replace(/ /g,"_"));if(this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?!t.isNullOrUndefined(this._fieldMembers):!t.isNullOrUndefined(this._tempFilterData)){if(this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)for(_=0;_<Object.keys(this._fieldMembers).length;_++)t.isNullOrUndefined(this._fieldMembers[this._curFilteredText.split(":")[1]])||(h=e.map(this._fieldMembers[this._curFilteredText.split(":")[1]],function(e){if(!e.checked)return e.name}));else for(_=0;_<this._tempFilterData.length;_++)t.isNullOrUndefined(this._tempFilterData[_][i])||(h=this._tempFilterData[_][i]);if(!t.isNullOrUndefined(h))for(_=0;_<h.length;_++)for(c=0;c<r.length;c++)h[_]==r[c].name&&(r[c].checkedStatus=!1)}for(e(d).appendTo("#"+this._id),this.model.enableMemberEditorPaging&&(r.length>=this.model.memberEditorPageSize||this.model.memberEditorPageSize<this._memberPageSettings.endPage)&&(this.element.find(".e-prevPage, .e-firstPage").addClass("e-pageDisabled"),this.element.find(".e-nextPage, .e-lastPage").addClass("e-pageEnabled"),(u=this._memberCount/this.model.memberEditorPageSize)!=Math.round(u)&&(u=parseInt(u)+1),this.element.find(".e-memberPageCount").html("/ "+u),this.element.find(".e-memberCurrentPage").val(this._memberPageSettings.currentMemeberPage),this._memberPageSettings.currentMemeberPage>1?this.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):this.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),this._memberPageSettings.currentMemeberPage==parseInt(e.trim(this.element.find(".e-memberPageCount").text().split("/")[1]))?this.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):this.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),this.element.find(".e-nextPageDiv .e-pageDisabled").css("opacity","0.5")),this.element.find("#searchEditorTreeView").ejMaskEdit({name:"inputbox",width:"100%",inputMode:t.InputMode.Text,watermarkText:this._getLocalizedLabels("Search")+" "+i,maskFormat:"",textAlign:this.model.enableRTL?"right":"left",change:t.proxy(function(e){t.Pivot._searchEditorTreeNodes(e,this)},this)}),this.element.find(".e-editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,enableRTL:this.model.enableRTL,beforeDelete:function(e){if(!t.isNullOrUndefined(e.event)&&"keydown"==e.event.type&&"delete"==e.event.originalEvent.key.toLowerCase())return!1},height:this.model.enableMemberEditorSorting?"200px":b?"inherit":"245px",fields:{id:"id",text:"name",parentId:"pid",expanded:"expanded",isChecked:"checkedStatus",hasChild:"hasChildren",dataSource:t.Pivot._showEditorLinkPanel(r,this,this)}}),b&&(l=this.element.find("[data-tag*='"+(this.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._selectedField:this._curFilteredText)+"']").offset(),this.element.find(".e-filterElementTag").ejMenu({fields:{dataSource:a,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"},menuType:t.MenuType.NormalMenu,enableRTL:this.model.enableRTL,width:"100%",orientation:t.Orientation.Vertical,click:t.proxy(this._filterElementClick,this)}),this.element.find(".groupLabelDrop").ejDropDownList({width:"99%",enableRTL:this.model.enableRTL,dataSource:S,fields:{id:"id",text:"text",value:"value"},change:t.proxy(this._groupLabelChange,this),create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),(g=this.element.find(".groupLabelDrop").data("ejDropDownList")).selectItemByText(g.model.dataSource[0].text),this.element.find(".e-memberEditorDiv").addClass("advancedFilter")),_=0;_<this._editorTreeData.length;_++)null!=this._editorTreeData[_].name&&this._editorTreeData[_].name.toString().replace(/^\s+|\s+$/gm,"")||(this._editorTreeData[_].name="(blank)",this._editorTreeData[_].id="(blank)"),t.isNullOrUndefined(this._editorTreeData[_].id)||"string"!=typeof this._editorTreeData[_].id||(this._editorTreeData[_].id=this._editorTreeData[_].id.replace(/ /g,"_"));for(C&&(this.element.find(".e-editorTreeView").data("ejTreeView").checkAll(),this._editorTreeData=e.map(this._editorTreeData,function(e){return e.checkedStatus=!0,e}),this._editorDrillTreeData=e.map(this._editorTreeData,function(e){return e.checkedStatus=!0,e}),this._editorSearchTreeData=e.map(this._editorTreeData,function(e){return e.checkedStatus=!0,e})),p=this,this.model.enableMemberEditorPaging&&jQuery.isEmptyObject(this._currentFilterList)?this._currentFilterList=JSON.parse(JSON.stringify(this._editorTreeData)):!this.model.enableMemberEditorPaging&&jQuery.isEmptyObject(this._currentFilterList)&&e(r).each(function(e,t){p._currentFilterList[t.id]=t}),e.grep(r,function(e){if(1==e.hasChildren)return e}).length>0||this.element.find(".e-memberEditorDiv").addClass("noChildNode"),m=this.element.find(".e-editorTreeView").find("li"),_=0;_<m.length;_++)m[_].setAttribute("data-tag",r[_].tag);this.element.find(".e-dialogOKBtn, .e-dialogCancelBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._dialogBtnClick,this)}),this._dialogOKBtnObj=this.element.find(".e-dialogOKBtn").data("ejButton"),this._memberTreeObj=this.element.find(".e-editorTreeView").data("ejTreeView");var E=this.element.find(".e-editorTreeView li:gt(0)"),D=e(this._memberTreeObj.element.find("li:first")).find("span.e-chk-image");e(E).find(":input.nodecheckbox:not(:checked)").length>0&&e(D).removeClass("e-checkmark").addClass("e-stop"),this.model.enableMemberEditorPaging&&(this._isAllMemberChecked||(this._dialogOKBtnObj.disable(),this.element.find(".e-dialogOKBtn").attr("disabled","disabled"),e(D).removeClass("e-checkmark").removeClass("e-stop").addClass("e-chk-inact"))),this.element.find(".e-clientDialog").ejDialog({width:b?"auto":265,target:"#"+this._id,enableResize:!1,enableRTL:this.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,this)}),this.element.find("#clientDialog_wrapper").css("top",this.element[0].offsetTop+20),this.element.find(".e-clientDialog").next(".e-scrollbar").hide(),b&&(this.element.find("#clientDialog_wrapper").addClass("e-advancedFilterDlg"),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.element.find("#clientDialog_wrapper").addClass("advancedFilterDlgOSM"),(f=e(".cols-sample-area").position())&&f.left>0?this.element.find("#clientDialog_wrapper").css({left:l.left+50-f.left,top:l.top}):t.isNullOrUndefined(l)||this.element.find("#clientDialog_wrapper").css({left:l.left+50,top:l.top}),this.element.find(".e-clientDialog").css({padding:"0px","min-width":"265px"}).parents().find(".e-titlebar").remove()),this.model.enableMemberEditorSorting&&(this._sortType="",t.Pivot._separateAllMember(this),this.model.enableRTL&&this.element.find(".memberSortDiv, .e-insideDiv").addClass("e-rtl")),this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this),this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this._memberTreeObj.model.beforeExpand=t.proxy(this._beforeNodeExpand,this):this._memberTreeObj.model.nodeClick=t.proxy(this._nodeExpand,this)),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&(this._memberTreeObj.model.beforeCollapse=t.proxy(t.Pivot._onNodeCollapse,this)),0==this._memberTreeObj.element.find(".e-plus").length&&this._memberTreeObj.element.find(".e-item").css("padding","0px"),this._isMembersFiltered=!1,this._unWireEvents(),this._wireEvents(),this.element.find(".e-dialog .e-close").attr("title",this._getLocalizedLabels("Close")),this.element.find(".e-dialog .e-close").click(function(){var i=e(this).parents(".e-pivotgrid").data("ejPivotGrid");t.isNullOrUndefined(i._schemaData)||i._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")})},_clearSorting:function(i){var l,n,s;if("disabled"==e(i.target).parent().attr("disabled"))return!1;if(t.Pivot.closePreventPanel(this),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._sortField(i):((h=t.Pivot.getReportItemByFieldName(this._selectedField,this.model.dataSource).item).sortOrder=t.PivotAnalysis.SortOrder.None,this.refreshControl());else{if(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode){this._waitingPopup&&this._waitingPopup.show(),this._selectedField=this._selectedLevelUniqueName.split("].").splice(0,2).join("].")+"]",this._excelFilterInfo.length>0&&(l=this._selectedLevelUniqueName,n=this._selectedField,this._excelFilterInfo=e.grep(this._excelFilterInfo,function(e){return(e.hierarchyUniqueName==n||t.isNullOrUndefined(n)||t.isNullOrUndefined(e.hierarchyUniqueName))&&e.levelUniqueName==l&&delete e.sortOrder,e}));try{s=JSON.parse(this.getOlapReport()).Report}catch(e){s=this.getOlapReport()}var o=this._selectedField+"--"+e(i.element).attr("id"),a=JSON.stringify(this.model.customObject),d=JSON.stringify({action:"labelSorting",filterParams:o,currentReport:s,customObject:a,gridLayout:this.model.layout});return this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,d,this._filterElementSuccess),!1}var h,c=this.model.dataSource,u=this._selectedField.toLowerCase();0==(h=e.map(c.columns,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==u)return e})).length&&(h=e.map(c.rows,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==u)return e})),h.length>0&&delete h[0].sortOrder,this.model.dataSource=c,this.element.find(".e-dialog").remove(),this.element.find("#preventDiv").remove(),null!=this._schemaData&&this._schemaData.element.find(".e-dialog").remove(),this._waitingPopup.show(),this.getJSONData({action:"clearSorting"},this.model.dataSource,this)}},_clearAllFilters:function(i){var l,n,s,o,a,d,h,c,u;if("disabled"==e(i.target).parent().attr("disabled"))return!1;if(t.Pivot.closePreventPanel(this),this.model.operationalMode==t.Pivot.OperationalMode.ClientMode){var g=this.model.dataSource,p=this._selectedField.toLowerCase(),m=e.map(g.columns,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==p)return e});0==m.length&&(m=e.map(g.rows,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==p)return e})),m.length>0&&(null!=(l=this.element.find(".groupLabelDrop").length>0?this.element.find(".groupLabelDrop").data("ejDropDownList"):null==this._schemaData?null:this._schemaData.element.find(".groupLabelDrop").data("ejDropDownList"))?(m[0].advancedFilter&&(m[0].advancedFilter=e.map(m[0].advancedFilter,function(e){if(e.name!=r&&e.name.toLowerCase()!=l.getSelectedValue().toLowerCase())return e})),null!=this._schemaData&&(m[0].advancedFilter&&0==m[0].advancedFilter.length&&this._schemaData._tableTreeObj.element.find("li[data-tag ='"+m[0].fileName+"'] div:eq(0) .filter").remove(),this._schemaData._tableTreeObj.element.find("li[data-tag='"+l.getSelectedValue()+"'] div:eq(0) .filter").remove())):delete m[0].advancedFilter,delete m[0].filterItems),this._currentReportItems=e.grep(this._currentReportItems,function(e){if(e["data-fieldName"]!=r&&e["data-fieldName"].toLocaleLowerCase()!=p)return e}),this.model.dataSource=g,this.element.find(".e-dialog").remove(),this.element.find("#preventDiv").remove(),null!=this._schemaData&&(this._schemaData._tableTreeObj.element.find("li[data-tag ='"+this._selectedField+"'] .filter").remove(),this._schemaData.element.find(".e-dialog").remove()),this._waitingPopup.show(),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(t.PivotAnalysis._valueFilterArray=e.grep(t.PivotAnalysis._valueFilterArray,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()!=p)return e}),this.refreshControl()):this.getJSONData({action:"advancedfiltering"},this.model.dataSource,this)}else{try{n=JSON.parse(this.getOlapReport()).Report}catch(e){n=this.getOlapReport()}if(this._removeFilterTag(this._curFilteredText),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)d=this._curFilteredAxis+"::"+this._curFilteredText+"## Clear Filter",h=this._curFilteredText,this._tempFilterData=e.map(this._tempFilterData,function(e){if(!e[h])return e}),c=JSON.stringify(this.model.customObject),u=JSON.stringify({action:"labelfiltering",filterParams:d,sortedHeaders:this._ascdes,currentReport:n,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:c,gridLayout:this.model.layout}),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,u,this._filterElementSuccess);else{if(!t.isNullOrUndefined(this._tempFilterData))for(s=0;s<this._tempFilterData.length;s++)for(o in this._tempFilterData[s])o==this._curFilteredText.split(":")[1]&&""!=this._tempFilterData[s][this._curFilteredText.split(":")[1]]&&(this._tempFilterData.splice(s,1),delete this._fieldMembers[this._curFilteredText.split(":")[1]]);a=this._removeFilterTag(this._selectedLevelUniqueName),this._excelFilterInfo.push({hierarchyUniqueName:this._selectedFieldName,levelUniqueName:this._selectedLevelUniqueName,sortOrder:a}),d=this._selectedLevelUniqueName+"--Clear Filter",h=this._curFilteredText,this._tempFilterData=e.map(this._tempFilterData,function(e){if(!e[h])return e}),c=JSON.stringify(this.model.customObject),u=JSON.stringify({action:"labelfiltering",filterParams:d,sortedHeaders:this._ascdes,currentReport:n,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:c,gridLayout:this.model.layout}),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,u,this._filterElementSuccess)}}},_removeFilterTag:function(i){var r,l=[],n=this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot;return(i&&i.indexOf("].")>=0||n)&&(r=i.split("].").length>2||n?"levelUniqueName":"hierarchyUniqueName",this._excelFilterInfo.length>0&&(levelName=this._selectedLevelUniqueName,hierarchyName=this._selectedFieldName,this._excelFilterInfo=e.grep(this._excelFilterInfo,function(e){if(e[r]!=i)return e;l=e.sortOrder}))),l},_groupLabelChange:function(i){var r,l,n,s,o,a=this.element.find(".e-filterElementTag").data("ejMenu");if(a.disableItemByID("labelClearFilter"),a.disableItemByID("valueClearFilter"),a.disableItemByID("clearAllFilters"),a.disableItemByID("clearSorting"),this.model.operationalMode==t.Pivot.OperationalMode.ClientMode){var d,h=this.element.hasClass("e-pivotschemadesigner")?this.model.pivotControl:this,c=this.element.find(".groupLabelDrop").length>0?this.element.find(".groupLabelDrop").data("ejDropDownList"):[],u=h._getAdvancedFiltervalue(h._selectedField,c.getSelectedValue()),g=t.Pivot.getReportItemByFieldName(h._selectedField,h.model.dataSource).item,p=t.buildTag("span.e-filterState").addClass("e-icon").attr("aria-label","filter state")[0].outerHTML,m=t.buildTag("span.e-activeFilter").addClass("e-icon")[0].outerHTML,_=t.Pivot.getReportItemByFieldName(h._selectedField,h.model.dataSource).item;_&&_.sortOrder&&_.sortOrder!=t.Pivot.SortOrder.None&&(d=_&&_.sortOrder==t.Pivot.SortOrder.Descending?"desc":"asc",t.isNullOrUndefined(d)||"asc"==d?this.element.find(".e-clientDialog .ascImage").addClass("e-selectedSort"):this.element.find(".e-clientDialog .e-descImage").addClass("e-selectedSort"),a.enableItemByID("clearSorting")),this.element.find(".e-filterState,.e-activeFilter").remove(),s=this.element.find("#clearAllFilters a").children().clone(),this.element.find("#clearAllFilters a").text(this._getLocalizedLabels("ClearFilter")+' from "'+i.text+'"').append(s),u.length>0?(u[0].advancedFilterType==t.Pivot.AdvancedFilterType.LabelFilter?(this.element.find("#labelFilterBtn a:eq(0)").append(p),this.element.find("#labelFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),r="equals"==u[0].labelFilterOperator||"notequals"==u[0].labelFilterOperator||"lessthanorequalto"==u[0].labelFilterOperator||"greaterthanorequalto"==u[0].labelFilterOperator||"greaterthan"==u[0].labelFilterOperator||"lessthan"==u[0].labelFilterOperator?"_labelFilter":"",this.element.find("#labelFilterBtn li#"+u[0].labelFilterOperator+r+" a").append(m),a.enableItemByID("labelClearFilter")):(this.element.find("#valueFilterBtn a:eq(0)").append(p),this.element.find("#valueFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),l="equals"==u[0].valueFilterOperator||"notequals"==u[0].valueFilterOperator||"lessthanorequalto"==u[0].valueFilterOperator||"greaterthanorequalto"==u[0].valueFilterOperator||"greaterthan"==u[0].valueFilterOperator||"lessthan"==u[0].valueFilterOperator?"_valueFilter":"",this.element.find("#valueFilterBtn li#"+u[0].valueFilterOperator+l+" a").append(m),a.enableItemByID("valueClearFilter")),a.enableItemByID("clearAllFilters")):g&&g.filterItems&&(this.element.find(".e-memberEditorDiv").before(p),this.element.find(".e-filterState").addClass("memberFilter").css("visibility","hidden"),a.enableItemByID("clearAllFilters"))}else{var f,b=this._selectedLevelUniqueName=i.selectedValue,C=(p=t.buildTag("span.e-filterState").addClass("e-icon").attr("aria-label","filter state")[0].outerHTML,[]);this._excelFilterInfo.length>0&&(b=this._selectedLevelUniqueName,n=this._selectedFieldName,C=e.map(this._excelFilterInfo,function(e){if(e.hierarchyUniqueName==n&&e.levelUniqueName==b)return{action:e.action,operator:e.operator,value1:e.value1,sortInfo:e.sortOrder}})),s=this.element.find("#clearAllFilters a").children().clone(),this.element.find("#clearAllFilters a").text(this._getLocalizedLabels("ClearFilter")+' from "'+i.text+'"').append(s),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?e.grep(this._ascdes.split("##"),function(e){if(e==b)return e}).length>0?(this.element.find(".e-descImage").addClass("e-selectedSort"),a.enableItemByID("clearSorting")):this.element.find(".ascImage").addClass("e-selectedSort"):C.length>0&&(t.isNullOrUndefined(C[0].sortInfo)||!t.isNullOrUndefined(C[0].sortInfo)&&0==C[0].sortInfo.length)||0==C.length||C[0].sortInfo.length>0&&(this.element.find("#"+C[0].sortInfo+" span:eq(0)").addClass("e-selectedSort"),a.enableItemByID("clearSorting")),this.element.find(".e-filterElementTag .e-activeFilter,.e-filterIndicator").remove(),C.length>0&&!t.isNullOrUndefined(C[0].operator)?(a.enableItemByID("clearAllFilters"),o="","valuefiltering"==C[0].action?(o="valueFilterBtn",a.enableItemByID("valueClearFilter"),f="equals"==C[0].operator||"not equals"==C[0].operator||"less than or equal to"==C[0].operator||"greater than or equal to"==C[0].operator||"greater than"==C[0].operator||"less than"==C[0].operator?"_valueFilter":""):(o="labelFilterBtn",a.enableItemByID("labelClearFilter"),f="equals"==C[0].operator||"not equals"==C[0].operator||"less than or equal to"==C[0].operator||"greater than or equal to"==C[0].operator||"greater than"==C[0].operator||"less than"==C[0].operator?"_labelFilter":""),this.element.find("#"+o+" a:eq(0)").append(p),"BottomCount"==C[0].operator.replace(/ /g,"")?this.element.find("#"+o+" li#"+C[0].operator.replace(/ /g,"").replace("Bottom","top")+" a").append(e(t.buildTag("span.e-activeFilter e-icon")[0].outerHTML)):this.element.find("#"+o+" li#"+C[0].operator.replace(/ /g,"")+f+" a").append(e(t.buildTag("span.e-activeFilter e-icon")[0].outerHTML))):""!=this._getUnSelectedNodes()&&(this.element.find(".e-memberEditorDiv").before("<div class='e-filterState e-icon' style='margin-top:5px;position:absolute;visibility:hidden' />"),a.enableItemByID("clearAllFilters"))}},_getAdvancedFiltervalue:function(i,l){var n=t.Pivot.getReportItemByFieldName(i,this.model.dataSource).item,s=[];return n&&n.advancedFilter&&(s=e.map(n.advancedFilter,function(e){if(e.name!=r&&e.name.toLocaleLowerCase()==l.toLowerCase())return e})),s},_filterElementClick:function(i,l){var n,s,o,a,d,h;if("labelFilterBtn"==i.ID||"valueFilterBtn"==i.ID)return!1;if(n=this.element.find(".groupLabelDrop").length>0?this.element.find(".groupLabelDrop").data("ejDropDownList"):l.element.find(".groupLabelDrop").data("ejDropDownList"),this._selectedLevelUniqueName=n.getSelectedValue(),"clearAllFilters"==i.ID||"valueClearFilter"==i.ID&&"pivot"==this.model.analysisMode&&"servermode"==this.model.operationalMode){if(this._clearAllFilters(i),"valueClearFilter"==i.ID&&"pivot"==this.model.analysisMode&&"servermode"==this.model.operationalMode)return!1}else"clearSorting"==i.ID?this._clearSorting(i):("ascOrder"==i.ID||"descOrder"==i.ID)&&this._sortField(i);if(this.element.find(".e-dialog, .e-filterDialog, #preventDiv").remove(),null!=this._schemaData&&this._schemaData.element.find(".e-dialog").remove(),!e(i.element).parent().hasClass("e-filterElementTag")&&"ascOrder"!=i.ID&&"descOrder"!=i.ID&&"clearSorting"!=i.ID&&"clearAllFilters"!=i.ID)if(s=this._selectedField,this._filterAction=t.isNullOrUndefined(i.element)?t.isNullOrUndefined(i.parentId)&&(t.isNullOrUndefined(i.menuId)||""==i.menuId)?"valueFilterBtn"==e(i.selectedItem).attr("id")?"valueFiltering":"labelFilterBtn"==e(i.selectedItem).attr("id")?"labelFiltering":"":"valueFilterBtn"==i.parentId?"valueFiltering":"labelFilterBtn"==i.menuId?"labelFiltering":"":0==e(i.element).parents("#valueFilterBtn").length?"labelFiltering":"valueFiltering",e.trim(i.text)==e.trim(this._getLocalizedLabels("ClearFilter"))){if(this.model.operationalMode!=t.Pivot.OperationalMode.ServerMode){t.Pivot.closePreventPanel(this);var c,u=this._selectedLevelUniqueName.toLowerCase(),g=[];return 0==(c=e.map(this.model.dataSource.columns,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==s.toLowerCase())return e})).length&&(c=e.map(this.model.dataSource.rows,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==s.toLowerCase())return e})),t.PivotAnalysis._valueFilterArray=e.grep(t.PivotAnalysis._valueFilterArray,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()!=s.toLowerCase())return e}),c.length>0&&(c[0].advancedFilter&&(g=e.map(c[0].advancedFilter,function(e){if(e.name!=r&&e.name.toLowerCase()!=u)return e})),c[0].advancedFilter=g,this._schemaData&&(0==c[0].advancedFilter.length&&this._schemaData._tableTreeObj.element.find("li[data-tag ='"+s+"'] div:eq(0) .filter").remove(),this._schemaData._tableTreeObj.element.find("li[data-tag='"+this._selectedLevelUniqueName+"'] div:eq(0) .filter").remove())),this._waitingPopup.show(),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this.refreshControl():this.getJSONData({action:"advancedfiltering"},this.model.dataSource,this),!1}this._removeFilterTag(this._selectedLevelUniqueName);try{o=JSON.parse(this.getOlapReport()).Report}catch(e){o=this.getOlapReport()}if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap)m=JSON.stringify(this.model.customObject),_=JSON.stringify({action:this._filterAction.toLowerCase(),filterParams:this._selectedLevelUniqueName+"--Clear Filter",currentReport:o,customObject:m,gridLayout:this.model.layout}),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,_,this._filterElementSuccess);else{a=this._curFilteredText,this._tempFilterData=e.map(this._tempFilterData,function(e){if(!e[a])return e});var p=this._curFilteredAxis+"::"+this._curFilteredText+"## Clear Filter",m=JSON.stringify(this.model.customObject),_=JSON.stringify({action:this._filterAction.toLowerCase(),filterParams:p,sortedHeaders:this._ascdes,currentReport:o,customObject:m,gridLayout:this.model.layout});this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,_,this._filterElementSuccess)}}else this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?(h=[],d=this._selectedLevelUniqueName,this._excelFilterInfo.length>0&&"true"!=e(i.element).siblings("li:eq(0)").attr("disable")&&((h=e.map(this._excelFilterInfo,function(e){if(e.levelUniqueName==d&&!t.isNullOrUndefined(e.operator))return{value1:e.value1,value2:e.value2,operator:e.operator,measure:e.measure}})).length>0&&i.ID.replace("_valueFilter","").replace("_labelFilter","")!=h[0].operator.replace(/ /g,"")&&(h=[])),t.Pivot.createAdvanceFilterTag({action:"labelFiltering"==this._filterAction?"labelFilterDlg":"valueFilterDlg",selectedArgs:i,filterInfo:h},this)):(0==(c=e.map(this.model.dataSource.columns,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==s.toLowerCase())return e})).length&&(c=e.map(this.model.dataSource.rows,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()==s.toLowerCase())return e})),h=[],c[0].advancedFilter&&(h=e.map(c[0].advancedFilter,function(e){if(e.name!=r&&e.name.toLowerCase()!=u)return e})),t.Pivot.createAdvanceFilterTag({action:"labelFiltering"==this._filterAction?"labelFilterDlg":"valueFilterDlg",selectedArgs:i,filterInfo:h},this))},_filterOptionChanged:function(i){var r,l=this._getAdvancedFiltervalue(this._selectedField,this._selectedLevelUniqueName);l=l.length>0?"label"==l[0].advancedFilterType&&i.value.replace(/ /g,"")==l[0].labelFilterOperator?l[0].values:"value"==l[0].advancedFilterType&&i.value.replace(/ /g,"")==l[0].valueFilterOperator?l[0].values:[""]:[""],r=this.element.find(".filterValuesTd")[0],i.value.toLowerCase().indexOf("between")>=0&&e(r).html("<input type='text' id='filterValue1' class='e-filterValues' value='"+l[0]+"' style='display:inline'/> <span>"+this._getLocalizedLabels("and")+"</span> <input type='text' id='filterValue2' value='"+(t.isNullOrUndefined(l[1])?"":l[1])+"' class='e-filterValues' style='display:inline' /> </br>"),i.value.toLowerCase().indexOf("between")<0&&e(r).html("<input type='text' id='filterValue1' class='e-filterValues' value='"+l[0]+"' style='display:inline'/>")},_filterElementOkBtnClick:function(){var i,l,n,s,o,a;t.Pivot.closePreventPanel(this);var d=this.element.find(".filterOptions")[0].value,h=[this.element.find("#filterValue1")[0].value],c=[],u=this._selectedField;if(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode){h[0].value;var g,p,m=this.element.find("#filterValue2").length>0?this.element.find("#filterValue2")[0].value:"",_=this._filterAction.toLowerCase();if(p=this._selectedLevelUniqueName+"--"+d+"--"+h[0],this.element.find(".filterMeasures").length>0&&(this.element.find("#filterValue2").length>0&&(p=p+","+m),p=p+"--"+(g=this.element.find(".filterMeasures").data("ejDropDownList").model.value),_="valuefiltering",null==g))return;try{i=JSON.parse(this.getOlapReport()).Report}catch(e){i=this.getOlapReport()}if(b=JSON.stringify(this.model.customObject),C=JSON.stringify({action:_,filterParams:p,currentReport:i,customObject:b,gridLayout:this.model.layout}),this._waitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").addClass("freeze").width(e(this._schemaData.element).width()).height(e(this._schemaData.element).height()).css({top:e(this._schemaData.element).offset().top,left:e(this._schemaData.element).offset().left}),""!=(l=this._curFilteredText.indexOf(":")>-1?this._curFilteredText.split(":")[1]:"")&&this._tempFilterData&&(this._tempFilterData=e.grep(this._tempFilterData,function(e){if(t.isNullOrUndefined(e[l]))return e})),n=this._removeFilterTag(this._selectedLevelUniqueName),this._excelFilterInfo.push({action:_,hierarchyUniqueName:this._selectedFieldName,levelUniqueName:this._selectedLevelUniqueName,operator:d,measure:g,value1:h[0],value2:m,sortOrder:n}),this.model.analysisMode==t.Pivot.AnalysisMode.Olap)this.model.enableDeferUpdate||this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,C,this._filterElementSuccess);else if("labelFiltering"==this._filterAction){s=this._curFilteredText,this._tempFilterData=e.map(this._tempFilterData,function(e){if(!e[s])return e});var f=this._curFilteredAxis+"::"+this._curFilteredText+"##"+d+"::"+h[0],b=JSON.stringify(this.model.customObject),C=JSON.stringify({action:_,filterParams:f,sortedHeaders:this._ascdes,currentReport:i,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:b,gridLayout:this.model.layout});this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,C,this._filterElementSuccess)}else{s=this._curFilteredText,this._tempFilterData=e.map(this._tempFilterData,function(e){if(!e[s])return e}),this._measureDDL=this.element.find(".filterMeasures").data("ejDropDownList"),g=this._measureDDL.getSelectedValue();f=this._curFilteredText+"::"+d+"::"+g+"::"+h[0]+"::"+(this.element.find("#filterValue2").length>0?this.element.find("#filterValue2")[0].value:""),b=JSON.stringify(this.model.customObject),C=JSON.stringify({action:_,filterParams:f,sortedHeaders:this._ascdes,currentReport:i,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:b,gridLayout:this.model.layout});this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,C,this._filterElementSuccess)}return!1}if("valueFiltering"==this._filterAction){if(this._measureDDL=this.element.find(".filterMeasures").data("ejDropDownList"),g=this._measureDDL.getSelectedValue(),isNaN(parseFloat(h[0]))||!isFinite(h[0])||""==g)return;this.element.find("#filterValue2")[0]!=r&&h.push(this.element.find("#filterValue2")[0].value)}if(this.element.find(".e-dialog").remove(),this._schemaData){var S=t.buildTag("span.filter").addClass("e-icon")[0].outerHTML,x=this._schemaData._tableTreeObj.element.find("li[data-tag='"+this._selectedLevelUniqueName+"'] div:eq(0)"),v=this._schemaData._tableTreeObj.element.find("li[data-tag ='"+u+"'] div:eq(0)");0==x.find(".filter").length&&x.append(S),0===v.find(".filter").length&&v.append(S)}o=this._selectedLevelUniqueName.toLowerCase(),0==(a=e.map(this.model.dataSource.columns,function(e){if(e.fieldName!=r&&e.fieldName.toLocaleLowerCase()==u.toLowerCase())return e})).length&&(a=e.map(this.model.dataSource.rows,function(e){if(e.fieldName!=r&&e.fieldName.toLocaleLowerCase()==u.toLowerCase())return e})),a.length>0&&(delete a[0].filterItems,a[0].advancedFilter&&(c=e.map(a[0].advancedFilter,function(e){if(e.name!=r&&e.name.toLocaleLowerCase()!=o)return e})),"labelfiltering"==this._filterAction.toLowerCase()?c.push({name:this._selectedLevelUniqueName,labelFilterOperator:d.replace(/ /g,""),advancedFilterType:t.Pivot.AdvancedFilterType.LabelFilter,values:h}):c.push({name:this._selectedLevelUniqueName,valueFilterOperator:d.replace(/ /g,""),advancedFilterType:t.Pivot.AdvancedFilterType.ValueFilter,values:h,measure:g}),this._currentReportItems=e.grep(this._currentReportItems,function(e){if(e["data-fieldName"]!=u)return e}),a[0].advancedFilter=c,this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.dataSource=this.clearDrilledItems(this.model.dataSource,{action:"filtering"},this))),this._waitingPopup.show(),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(t.PivotAnalysis._valueSorting=null,t.PivotAnalysis._valueFilterArray=e.grep(t.PivotAnalysis._valueFilterArray,function(e){if(e.fieldName!=r&&e.fieldName.toLowerCase()!=u.toLowerCase())return e}),"valueFiltering"==this._filterAction&&t.PivotAnalysis._valueFilterArray.push(a[0]),this.refreshControl()):this.getJSONData({action:"advancedfiltering"},this.model.dataSource,this)},_nodeCheckChanges:function(i){var l,n,s,o,a;if(this._onDemandNodeExpand){this._isMembersFiltered=!0;var d=this,h=this.element.find(".e-editorTreeView"),c=null,u=!t.isNullOrUndefined(i.model.id)&&"allelement"==i.model.id.toLowerCase()&&!i.isChecked||!t.isNullOrUndefined(i.id)&&("(all)_0"==i.id.toLowerCase()||"all"==i.id.toLowerCase())&&!t.isNullOrUndefined(i.type)&&"nodeUncheck"==i.type,g=!t.isNullOrUndefined(i.model.id)&&"allelement"==i.model.id.toLowerCase()&&i.isChecked||!t.isNullOrUndefined(i.id)&&("(all)_0"==i.id.toLowerCase()||"all"==i.id.toLowerCase())&&!t.isNullOrUndefined(i.type)&&"nodeCheck"==i.type;if(u){if(this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this._isOptionSearch?(c=e(h).find("li[data-isItemSearch='true']")).length>0&&e(c).each(function(t,i){e(h).ejTreeView("uncheckNode",e(i))}):this.model.enableMemberEditorPaging&&e(h).find("li span.e-searchfilterselection").length>0?(e(h).ejTreeView("unCheckAll"),this._isSelectSearchFilter?e(h).find("li span.e-searchfilterselection").closest("li").find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark"):e(h).find("li span.e-searchfilterselection").closest("li").find("span.e-chk-image").removeClass("e-checkmark").removeClass("e-stop")):e(h).ejTreeView("unCheckAll"),this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this),e(h).find("li").length>0&&!e(h).find("li").find("span.e-checkmark").length>0?this._dialogOKBtnObj.disable():e(h).find("li").length>0&&1==e(h).find("li").find("span.e-checkmark").length&&e(h).find("li span.e-searchfilterselection").closest("li").find("span.e-checkmark").length>0&&this._dialogOKBtnObj.disable(),this.model.enableMemberEditorPaging||this._editorTreeData.length>0){if(this.element.find(".e-dialogOKBtn").attr("disabled","disabled"),this._isAllMemberChecked=!1,this._editorSearchTreeData.length>0)for(a=0;a<this._editorSearchTreeData.length;a++)e(this._editorTreeData).each(function(e,t){if(d._editorSearchTreeData[a].id==t.id)return d._editorSearchTreeData[a].checkedStatus=!1,t.checkedStatus=!1,!1});else e(this._editorTreeData).each(function(e,t){t.checkedStatus=!1});e(this._editorTreeData).each(function(e,t){if(t.checkedStatus)return d._dialogOKBtnObj.enable(),d.element.find(".e-dialogOKBtn").removeAttr("disabled"),!1})}}else if(g){if(this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this._isOptionSearch?(c=e(h).find("li[data-isItemSearch='true']")).length>0&&e(c).each(function(t,i){e(h).ejTreeView("checkNode",e(i))}):this.model.enableMemberEditorPaging&&e(h).find("li span.e-searchfilterselection").length>0?(e(h).ejTreeView("checkAll"),this._isSelectSearchFilter?e(h).find("li span.e-searchfilterselection").closest("li").find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark"):e(h).find("li span.e-searchfilterselection").closest("li").find("span.e-chk-image").removeClass("e-checkmark").removeClass("e-stop")):e(h).ejTreeView("checkAll"),e(this._memberTreeObj.element.find("li:first")).find("span.e-chk-image").removeClass("e-stop"),this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this),e(h).find("li").length>0&&e(h).find("li").find("span.e-checkmark").length>0&&this._dialogOKBtnObj.enable(),this.model.enableMemberEditorPaging||this._editorTreeData.length>0)if(this.element.find(".e-dialogOKBtn").removeAttr("disabled"),this._isAllMemberChecked=!0,this._editorSearchTreeData.length>0)for(a=0;a<this._editorSearchTreeData.length;a++)e(this._editorTreeData).each(function(e,t){if(d._editorSearchTreeData[a].id==t.id)return d._editorSearchTreeData[a].checkedStatus=!0,t.checkedStatus=!0,!1});else e(this._editorTreeData).each(function(e,t){t.checkedStatus=!0})}else if("searchfilterselection"==i.id.toLowerCase())t.Pivot._updateSearchFilterSelection(i,h,d);else if((t.isNullOrUndefined(i.model.id)||"allelement"!=i.model.id.toLowerCase())&&(t.isNullOrUndefined(i.id)||"(all)_0"!=i.id.toLowerCase()&&"all"==i.id.toLowerCase())||!this.model.enableMemberEditorPaging&&!this._editorTreeData){if(!t.isNullOrUndefined(i.model.id)&&"allelement"==i.model.id.toLowerCase()||!t.isNullOrUndefined(i.id)&&("(all)_0"==i.id.toLowerCase()||"all"!=i.id.toLowerCase()))if(n=this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),s=e(this._memberTreeObj.element.find("li:first")).find("span.e-chk-image"),"KPI"==this._dialogHead){for(g=!0,o=this.element.find(".e-editorTreeView ul:eq(0)"),a=0;a<o.children("li").length;a++)if("false"==o.children("li:eq("+a+")").find(".e-check-small").attr("aria-checked")){g=!1;break}g?this._dialogOKBtnObj.enable():(s.removeClass("e-checkmark").removeClass("e-stop"),this._dialogOKBtnObj.disable())}else 0==n.length||1==n.length&&0==n[0].id[n[0].id.length-1]?(e(s).parent().removeClass("e-chk-inact").removeClass("e-chk-ind").addClass("e-chk-act"),s.removeClass("e-stop").addClass("e-checkmark"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark")):"nodeCheck"==i.type&&1==n.length&&0==n[0].id[n[0].id.length-1]?(s.removeClass("e-stop").addClass("e-checkmark"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark")):n.length>0&&(s.removeClass("e-checkmark").addClass("e-stop"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-checkmark").addClass("e-stop")),this._dialogOKBtnObj.enable(),"nodeUncheck"==i.type&&(n.length+1==this._memberTreeObj.element.find("li").length?(s.removeClass("e-checkmark").removeClass("e-stop"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-checkmark").removeClass("e-stop"),this._dialogOKBtnObj.disable()):this._isOptionSearch&&e(h).find("li span.e-searchfilterselection").closest("li").find("span.e-checkmark").length>0&&1==this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:checked").length&&(s.removeClass("e-checkmark").removeClass("e-stop"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-checkmark").removeClass("e-stop"),this._dialogOKBtnObj.disable()))}else"nodeUncheck"==i.type?(this._isMembersFiltered=!0,l="",t.Pivot._memberPageNodeUncheck(i,this),l=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",r).where("checkedStatus","equal",!0)),!t.isNullOrUndefined(l)&&l.length>0&&("All"==l[0].id||"(All)_0"==l[0].id)&&l.splice(0,1),s=e(this._memberTreeObj.element.find("li:first")).find("span.e-chk-image"),t.isNullOrUndefined(l)||0!=l.length?(e(this._memberTreeObj.element.find("li:first")).find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark"),e(this._editorTreeData).each(function(t,i){if(i.checkedStatus)return this._isAllMemberChecked=!1,e(d._memberTreeObj.element.find("li:first")).find("span.e-chk-image").removeClass("e-checkmark").addClass("e-stop"),!1})):(this._dialogOKBtnObj.disable(),this.element.find(".e-dialogOKBtn").attr("disabled","disabled"),this._isAllMemberChecked=!1,s.removeClass("e-stop").removeClass("e-checkmark").addClass("e-chk-inact"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-checkmark").addClass("e-chk-inact"))):"nodeCheck"==i.type&&(this._isMembersFiltered=!0,t.Pivot._memberPageNodeCheck(i,this),this.element.find(".e-dialogOKBtn").data("ejButton").enable(),this.element.find(".e-dialogOKBtn").removeAttr("disabled"),this._isAllMemberChecked=!0,e(this._memberTreeObj.element.find("li:first")).find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark"),this.element.find(".e-checkAllBox").find("span.e-chk-image").removeClass("e-stop").addClass("e-checkmark"),e(this._editorTreeData).each(function(t,i){if(!i.checkedStatus)return this._isAllMemberChecked=!1,e(d._memberTreeObj.element.find("li:first")).find("span.e-chk-image").removeClass("e-checkmark").addClass("e-stop"),!1}))}},_fetchMemberSuccess:function(i){i[0]!=r&&i.length>0?(this._currentMembers=i[0].Value,null!=i[1]&&i[1]!=r&&(this.model.customObject=i[1].Value)):i.d!=r&&i.d.length>0?(this._currentMembers=i.d[0].Value,null!=i.d[1]&&i.d[1]!=r&&(this.model.customObject=i.d[1].Value)):i!=r&&i.length>0?(this._currentMembers=i.EditorTreeInfo,null!=i&&i!=r&&(this.model.customObject=i.customObject)):i!=r&&(this._currentMembers=i.EditorTreeInfo),this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&!this.model.enableMemberEditorPaging&&(0==this._editorTreeData.length||this._isFilterBtnClick)&&(this._editorTreeData=JSON.parse(this._currentMembers),this.model.enableAdvancedFilter&&(this._editorTreeData=e.map(this._editorTreeData,function(e){if(t.isNullOrUndefined(e.levels))return e}))),this._savedReportItems=e.extend(!0,[],this._currentReportItems),this._isFilterBtnClick=!1,this._createDialog(this._dialogHead,this._currentMembers),null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject}),this.model.dataSource.enableAdvancedFilter?this.element.find(".e-dialog #GroupLabelDrop_wrapper:visible").first().attr("tabindex","-1").focus().addClass("e-hoverCell"):t.isNullOrUndefined(this.element.find(".e-dialog .e-text:visible").first())||this.element.find(".e-dialog .e-text:visible").first().attr("tabindex","-1").focus().addClass("e-hoverCell"),this._waitingPopup.hide()},_filterElementSuccess:function(e){e[0]!=r?null!=e[2]&&e[2]!=r&&(this.model.customObject=e[2].Value):e.d!=r?null!=e.d[2]&&e.d[2]!=r&&(this.model.customObject=e.d[2].Value):null!=e.customObject&&e.customObject!=r&&(this.model.customObject=e.customObject),null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject}),this._renderControlSuccess(e)},_sortingSuccess:function(e){e[0]!=r?e[2]!=r&&e.length>0&&(this.model.customObject=e[2].Value):e.d!=r&&e.d.length>0?null!=e.d[2]&&e.d[2]!=r&&(this.model.customObject=e.d[2].Value):e!=r&&e.length>0&&null!=e.customObject&&e.customObject!=r&&(this.model.customObject=e.customObject),null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"sorting",element:this.element,customObject:this.model.customObject}),this._renderControlSuccess(e)},_nodeExpand:function(i){var l,n,s,o,a,d,h,c,u,g,p=t.isNullOrUndefined(i.event)?i.targetElement:i.event.originalEvent!=r&&i.event.originalEvent.target!=r?i.event.originalEvent.target:i.event.target,m="";if(this._isSchemaClick=!!i._isSchemaClick,p!=r&&p.className!=r&&""!=p.className&&p.className.indexOf("e-minus")>-1)return i.olapCtrlObj=i._isSchemaClick?this._schemaData:this,void t.Pivot._onNodeCollapse(i);if(jQuery.each(this._isSchemaClick?this._schemaData._editorTreeData:this._editorTreeData,function(e,t){if(t.id==i.id)return t.expanded=!0,t.isChildMerged=!0,!1}),l=e(p).parents("li").first().children().find("li").length,n=i._isSchemaClick?this._schemaData._memberTreeObj.dataSource():this._memberTreeObj.dataSource(),this.model.enableMemberEditorPaging)for(s=0;s<n.length;s++)if(n[s].parentId==i.id||n[s].pid==i.id)return i.isChildLoaded=!0,void t.Pivot.closePreventPanel(this);if(!t.isNullOrUndefined(this)&&this.model.enableMemberEditorPaging&&t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",i.id)).length>0&&p!=r&&p.className!=r&&""!=p.className&&p.className.indexOf("e-plus")>-1&&0==l)return i.isChildLoaded=!0,t.Pivot.closePreventPanel(this),this.pNode=p,void this._fetchChildNodeSuccess({ChildNodes:JSON.stringify(t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",i.id))),customObject:this.model.customObject});if(p!=r&&p.className!=r&&""!=p.className&&p.className.indexOf("e-plus")>-1&&0==l){e(p).removeClass("e-plus").addClass("e-load"),o=e(p).parent().find("input.e-checkbox").prop("checked"),d=e(p).parents("li").first().attr("data-tag"),this.pNode=p;try{a=JSON.parse(this.model.pivotControl!=r?this.model.pivotControl.getOlapReport():this.getOlapReport()).Report}catch(e){a=this.model.pivotControl!=r?this.model.pivotControl.getOlapReport():this.getOlapReport()}for(h=this.element.find(".e-pivotButton"),u=0;u<h.length>0;u++)e(h[u]).attr("data-tag").indexOf(t.isNullOrUndefined(this._curFilteredText)?t.isNullOrUndefined(this._schemaData)?"":this._schemaData._curFilteredText:this._curFilteredText)>-1&&e(h[u]).attr("data-tag").split(":")[1].length==(t.isNullOrUndefined(this._curFilteredText)?t.isNullOrUndefined(this._schemaData)?0:this._schemaData._curFilteredText.length:this._curFilteredText.length)?m=e(h[u]).attr("data-tag"):e(h[u]).attr("data-tag").indexOf(t.isNullOrUndefined(this._curFilteredText)?t.isNullOrUndefined(this._schemaData)?"":this._schemaData._curFilteredText:this._curFilteredText)>-1&&(c=e(h[u]).attr("data-tag"));m=""==m?t.isNullOrUndefined(c)?t.isNullOrUndefined(this._curFilteredText)?this._schemaData._curFilteredText:this._curFilteredText:c.split(":")[1]:m.split(":")[1],null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject}),g=JSON.stringify(this.model.customObject),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.memberExpand,JSON.stringify({action:"memberExpanded",checkedStatus:o,parentNode:e(p).parents("li")[0].id,tag:d,cubeName:JSON.parse(this._olapReport).CurrentCube+"##"+m,currentReport:a,customObject:g}),this._fetchChildNodeSuccess)}},_fetchChildNodeSuccess:function(i){var l,n,s,o,a,d;i.length>1&&i[0]!=r?(l=JSON.parse(i[0].Value),null!=i[1]&&i[1]!=r&&(this.model.customObject=i[1].Value)):i.d!=r?(l=JSON.parse(i.d[0].Value),null!=i.d[1]&&i.d[1]!=r&&(this.model.customObject=i.d[1].Value)):(l=JSON.parse(i.ChildNodes),null!=i.customObject&&i.customObject!=r&&(this.model.customObject=i.customObject)),n=e(this.pNode).parents("li").length>1?e(this.pNode).parents("li").first():e(this.pNode).parents("li"),e(e(n).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1}),s=this._isSchemaClick?this._schemaData:this,this.model.enableMemberEditorPaging?(o=t.Pivot._generateChildWithAncestors(s,n,this.model.enableMemberEditorPaging,this.model.memberEditorPageSize),l.length>=this.model.memberEditorPageSize||o.lstChildren.length>=this.model.memberEditorPageSize?(s.element.find(".searchEditorTreeView").data("ejMaskEdit").clear(),s._lastSavedTree=[],t.Pivot._makeAncestorsExpandable(s,n[0].id),s._isEditorDrillPaging=!0,a=o.allLvlLst.length>1&&o.lstChildren.length>=this.model.memberEditorPageSize?t.Pivot._getParentsTreeList(s,o.lstParents[0].id,s._editorTreeData):e.grep(s._editorTreeData,function(e){return e.id==n[0].id})[0],d={childNodes:o.allLvlLst.length>1&&o.lstChildren.length>=this.model.memberEditorPageSize?o.lstChildren:l,parentNode:a},t.Pivot._drillEditorTreeNode(d,s,this.model.memberEditorPageSize)):t.isNullOrUndefined(this._memberTreeObj)||!this._editorFlag||this._isSchemaClick?t.isNullOrUndefined(this._schemaData._memberTreeObj)||this._schemaData._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(l,this._schemaData,this),n):this._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(l,this,this),n)):(t.isNullOrUndefined(this._memberTreeObj)||!this._editorFlag||this._isSchemaClick?t.isNullOrUndefined(this._schemaData._memberTreeObj)||this._schemaData._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(l,this._schemaData,this),n):this._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(l,this,this),n),this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&e.merge(s._editorTreeData,e.extend(!0,[],l))),l.length>0&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.enableMemberEditorPaging&&!t.DataManager(s._editorTreeData).executeLocal(t.Query().where("pid","equal",l[0].pid)).length>0&&e.merge(s._editorTreeData,e.extend(!0,[],l)),e.each(e(n).children().find("li"),function(e,t){t.setAttribute("data-tag",l[e].tag)}),null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject}),t.isNullOrUndefined(this._schemaData)||this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_beforeNodeExpand:function(e){t.Pivot.getChildNodes(e,this._selectedField,this._currentReportItems,this.model.dataSource,this)},_generateAllMember:function(t,i){this.olapCtrlObj._allMember=e(e(i).find("Axis:eq(0) Tuple:eq(0)").children().children()[1]).text()},_generateMembers:function(i,l){var n,s,o,a,d=e(l).find("Axis:eq(0) Tuple"),h=[],c={};for(h.push({id:"All",name:"All",checkedStatus:!0,tag:""}),n=0;n<d.length;n++)s=e(e(l).find("Axis:eq(0) Tuple:eq("+n+")").children().children()[0]).text(),o=e(e(l).find("Axis:eq(0) Tuple:eq("+n+")").children().children()[1]).text(),c={hasChildren:"0"!=e(d[n]).find("CHILDREN_CARDINALITY").text(),checkedStatus:!0,id:s.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-").replace(/ /g,"_"),name:o,tag:s,level:parseInt(e(d[n]).find("LNum").text())},h.push(c);t.isNullOrUndefined(this.olapCtrlObj)||(this.olapCtrlObj._waitingPopup.hide(),this.olapCtrlObj._editorTreeData=h,this.olapCtrlObj._currentReportItems.push({filterItems:h,fieldName:this.olapCtrlObj._selectedField,dataSrc:this.olapCtrlObj.model.dataSource,pageSettings:this.olapCtrlObj._memberCount}),this.olapCtrlObj.model.enableMemberEditorPaging?(this.olapCtrlObj._memberCount=t.DataManager(this.olapCtrlObj._editorTreeData).executeLocal(t.Query().where(t.Predicate("pid","equal",null).and("id","notequal","All"))).length,a=t.DataManager(this.olapCtrlObj._editorTreeData).executeLocal(t.Query().where("pid","equal",r).page(this.olapCtrlObj._memberPageSettings.currentMemeberPage,this.olapCtrlObj.model.memberEditorPageSize+1)),this.olapCtrlObj._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(a)})):this.olapCtrlObj._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(h)}))},_filterBtnClick:function(i){var l,n,s,o;if(this._editorFlag=!0,t.Pivot.openPreventPanel(this),this._isAllMemberChecked=!0,this.model.operationalMode==t.Pivot.OperationalMode.ClientMode)if(this.model.enableMemberEditorPaging&&(this._memberPageSettings.endPage=this.model.memberEditorPageSize,this._memberPageSettings.startPage=0,this._memberPageSettings.currentMemeberPage=1),this.model.analysisMode==t.Pivot.AnalysisMode.Olap){var a,d=this._selectedField=e(i.currentTarget.parentNode).attr("data-tag").split(":")[1],h=[];this._dialogHead=e(i.target).siblings(".e-pvtBtn").attr("data-fieldCaption"),h=e.map(this._currentReportItems,function(i){if(i.fieldName==d&&(a=i.pageSettings,!t.isNullOrUndefined(i.filterItems)))return e.map(i.filterItems,function(e){return e.expanded&&(e.expanded=!1),e})}),this.model.enableMemberEditorPaging&&a&&a&&(this._memberCount=a),h.length>0?(this._editorTreeData=h,this.model.enableMemberEditorPaging&&(this._memberCount=t.DataManager(this._editorTreeData).executeLocal(t.Query().where(t.Predicate("pid","equal",null).and("id","notequal","All"))).length,h=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",r).page(this._memberPageSettings.currentMemeberPage,this.model.memberEditorPageSize+1))),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(h)})):(this._waitingPopup.show(),t.olap._mdxParser.getMembers(this.model.dataSource,d,this))}else this._selectedField=e(i.target).siblings(".e-pvtBtn").attr("data-fieldName"),this._dialogHead=e(i.target).siblings(".e-pvtBtn").attr("data-fieldCaption"),this._selectedAxis=e(i.target).siblings(".e-pvtBtn").attr("data-axis"),l=this._getTreeViewData(this._selectedField,this._selectedAxis),this.model.enableMemberEditorPaging?(h=l,this._editorTreeData=h,this._memberCount=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("id","notequal","All")).length,h=t.DataManager(this._editorTreeData).executeLocal(t.Query().page(this._memberPageSettings.currentMemeberPage,this.model.memberEditorPageSize+1)),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(h)})):this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(l)});else{this._isFilterBtnClick=!0,this._curFilteredAxis=i.target.parentElement.getAttribute("data-tag").split(":")[0],this._curFilteredText=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?i.target.parentElement.getAttribute("data-tag"):e(e(i.target).siblings()[1]).attr("data-fieldName"),this._dialogTitle=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?i.target.parentElement.getAttribute("data-tag"):e(e(i.target).siblings()[1]).attr("data-fieldName"),this._dialogHead=e(e(i.target).siblings("button")).attr("data-fieldCaption");try{n=JSON.parse(this.getOlapReport()).Report}catch(e){n=this.getOlapReport()}this._waitingPopup.show(),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").addClass("freeze").width(e(this._schemaData.element).width()).height(e(this._schemaData.element).height()).css({top:e(this._schemaData.element).offset().top,left:e(this._schemaData.element).offset().left}),null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject}),s=JSON.stringify(this.model.customObject),o=JSON.stringify({action:"fetchMembers",headerTag:this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.enableAdvancedFilter?this._dialogTitle+"##"+this.model.enableAdvancedFilter:this._dialogTitle,sortedHeaders:this._ascdes,currentReport:n,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:s}),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.fetchMembers,o,this.model.enableMemberEditorPaging?t.Pivot._fetchMemberPageSuccess:this._fetchMemberSuccess)}},_getTreeViewData:function(i){var l,n=t.Pivot.getReportItemByFieldName(i,this.model.dataSource).item,s=t.PivotAnalysis.getMembers(i),o=[{id:"All",name:"All",checkedStatus:!0}];if(null!=n.filterItems&&n.filterItems!=r)for(l=0;l<s.length;l++)o.push({id:s[l],name:s[l],checkedStatus:n.filterItems.filterType==t.PivotAnalysis.FilterType.Include?e.inArray(s[l],n.filterItems.values)>=0:e.inArray(s[l],n.filterItems.values)<0});else for(l=0;l<s.length;l++)o.push({id:s[l],name:s[l],checkedStatus:!0});return o},_applyToolTip:function(i){var l,n,s,o,a,d,h,c,u;if(this.model.enableToolTip){var g,p,m,_="",f=e(i.target).hasClass("cellValue")?i.target.parentElement:i.target;if(0==e(f).find("input").length&&!e(f).hasClass("curInput")&&!t.isNullOrUndefined(e(f).attr("role"))){if(null==(m=this.element.find(".summary[role!='gridcell'][data-p$=',"+e(f).attr("data-p").split(",")[1]+"'] , .rowheader[role!='gridcell'][data-p$=',"+e(f).attr("data-p").split(",")[1]+"']").last().attr("data-p"))&&(m=e(f).parent("tr").find(".summary,.rowheader").attr("data-p")),null!=m)if(0==m[0]&&null!=parseInt(m.split(",")[0]))m==this.getJSONRecords()[parseInt(parseInt(m.split(",")[0])*this._rowCount+parseInt(m.split(",")[1]))].Index&&(p=this.getJSONRecords()[parseInt(parseInt(m.split(",")[0])*this._rowCount+parseInt(m.split(",")[1]))].Value);else for(;m[0]>=0;)m==this.getJSONRecords()[parseInt(parseInt(m.split(",")[0])*this._rowCount+parseInt(m.split(",")[1]))].Index&&(g=this.getJSONRecords()[parseInt(parseInt(m.split(",")[0])*this._rowCount+parseInt(m.split(",")[1]))].Value,m=parseInt(m.split(",")[0])-1+","+parseInt(m.split(",")[1])),p=p?""!=g?g+"-"+p:p:g;var b=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,C=this.element.find(b?".pivotGridFrozenTable ":'tr:has("[role=columnheader]")').length-1,S=e(f).attr("data-p");for(S!=r&&S==this.getJSONRecords()[parseInt(parseInt(S.split(",")[0])*this._rowCount+parseInt(S.split(",")[1]))].Index&&(l=parseInt(S.split(",")[0])),n=0;n<=C;n++)s=l+","+n,null!=l&&s==this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))].Index&&(-1==(g=this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))]).CSS.indexOf("value")&&(""==_?_=g.Value:""!=g.Value&&(_=_+"-"+g.Value)));e("#"+this._id+"_gridTooltip").remove(),this.element.find("span#celval").remove(),o=t.isNullOrUndefined(this._pivotClientObj)?f.getBoundingClientRect():e(f).position(),(this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders)&&(a=this.element.find(".e-scroller").data("ejScroller"),(this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&!this.model.frozenHeaderSettings.enableFrozenRowHeaders||!this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&(o.left=o.left+this.element.find(".rowhead").width()-a.model.scrollLeft,o.top=o.top-a.model.scrollTop)),e("#"+this._id).append('<div id="'+this._id+'_gridTooltip" class="e-pGridTooltip" role=\'tooltip\'></div>'),e(f).find("span.cellValue").attr("aria-label","row- "+p+": column- "+_),d=e(f).find("span.cellValue:not('#celval')").text(),this.model.enableRTL?(e("#"+this._id+"_gridTooltip").append('<p id="value" class="e-tooltipText">'+(d||this._getLocalizedLabels("NoValue"))+":"+this._getLocalizedLabels("ToolTipValue")+"</p>"),e("#"+this._id+"_gridTooltip").append('<p id="row" class="e-tooltipText">'+(p==r||1==this._rowCount?this._getLocalizedLabels("NoValue"):this._direction(p))+":"+this._getLocalizedLabels("ToolTipRow")+"</p>"),e("#"+this._id+"_gridTooltip").append('<p id="column" class="e-tooltipText">'+(_==r||""==_?this._getLocalizedLabels("NoValue"):this._direction(_))+":"+this._getLocalizedLabels("ToolTipColumn")+"</p>")):(e("#"+this._id+"_gridTooltip").append('<p id="value" class="e-tooltipText">'+this._getLocalizedLabels("ToolTipValue")+": "+(d||this._getLocalizedLabels("NoValue"))+"</p>"),e("#"+this._id+"_gridTooltip").append('<p id="row" class="e-tooltipText">'+this._getLocalizedLabels("ToolTipRow")+": "+(p==r||1==this._rowCount?this._getLocalizedLabels("NoValue"):p)+"</p>"),e("#"+this._id+"_gridTooltip").append('<p id="column" class="e-tooltipText">'+this._getLocalizedLabels("ToolTipColumn")+": "+(_==r||""==_?this._getLocalizedLabels("NoValue"):_)+"</p>")),h=0,h=t.isNullOrUndefined(this._pivotClientObj)?e("#"+this._id).parent().position().left+e("#"+this._id).parent().width():e("#"+this._id).parent().position().left+this._pivotClientObj.element.find(".e-gridContainer").width();var x=o.left+e("#"+this._id+"_gridTooltip").width(),v=0,w=0;t.isNullOrUndefined(this._pivotClientObj)?(v=(o.left>0?o.left:0)+(h-x<0?h-x-20:5),w=e(this.element).height()-o.top<100?o.top-e("#"+this._id+"_gridTooltip").outerHeight()-2:o.top+40,(u=(c=e(i.target).hasClass("cellValue")?i.target.parentElement:i.target).getBoundingClientRect().width/c.offsetWidth)>1&&(w=e(c).position().top/u,w=e(this.element).height()-w*u<100*u?w-e("#"+this._id+"_gridTooltip").outerHeight():w+40)):(v=(o.left>0?o.left:0)+(h-x<50?h-x-40:5)+this._pivotClientObj.element.find(".e-gridContainer").scrollLeft(),w=(this._pivotClientObj.element.find(".e-gridContainer").height()-o.top<150?o.top-e("#"+this._id+"_gridTooltip").outerHeight()-2:o.top+40)+this._pivotClientObj.element.find(".e-gridContainer").scrollTop()),!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableRTL&&(v=e("#"+this._pivotClientObj._id+"_PivotGrid").parent().hasClass("e-maximumView")?o.left:v-(e("#"+this._pivotClientObj._id+"_PivotGrid").position().left+this._pivotClientObj.element.find(".e-gridContainer").scrollLeft())),e("#"+this._id+"_gridTooltip").css({left:v,top:w}),this.model.enableToolTipAnimation?e("#"+this._id+"_gridTooltip").show("fast"):e("#"+this._id+"_gridTooltip").show(),t.isNullOrUndefined(this._pivotClientObj)||"tile"!=this._pivotClientObj.controlPlacement()||e("#"+this._id+"_gridTooltip").css("position","absolute")}}},_applyVScrolling:function(){var i,r,l,n,s,o,a,d,h,c,u=!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableVirtualScrolling,g=u?this._pivotClientObj.element.find(".e-pivotgrid"):e(this.element).find(".virtualScrollGrid"),p=u?this._pivotClientObj:this,m=u&&!t.isNullOrUndefined(this._pivotClientObj._pivotGrid)?this._pivotClientObj._pivotGrid:this,_=u&&this.model.isResponsive;m._seriesPageCount>1&&(r=function(){return Math.round(p.element.find(".e-vScrollPanel").offset().top)+1},(l=e(p.element).find(".e-vScrollPanel")).height(u?this._pivotClientObj.model.isResponsive?parseInt(this._pivotClientObj.element.find(".e-controlPanel").height()):"tile"==this._pivotClientObj.controlPlacement()?parseInt(this._pivotClientObj.element.find(".e-gridContainer").parents("table:eq(0)").height()):parseInt(this._pivotClientObj.element.find(".e-gridContainer").height()):e(g).height()),l.html(t.buildTag("div.e-vScrollThumb")[0].outerHTML),(n=l.find(".e-vScrollThumb")).height(Math.max(Math.ceil((u?this._pivotClientObj.model.isResponsive?parseInt(this._pivotClientObj.element.find(".e-controlPanel").height()):parseInt(this._pivotClientObj.element.find(".e-gridContainer").height()):e(g).height())/m._seriesPageCount),15)),s=l.height()-n.height()-2,n.offset({top:r()+(m._seriesCurrentPage-1)*(s/(m._seriesPageCount-1))}),e(".e-vScrollPanel").on("mousewheel DOMMouseScroll",function(t){var l,o;e("body").on("mousewheel DOMMouseScroll",function(e){return e.preventDefault(),e.stopPropagation(),!1}),initThumbPos=(_?n.offset().top:n.position().top)-r(),l=m._seriesCurrentPage,movedDistance=t.originalEvent.wheelDelta<0||t.originalEvent.detail>0?t.target.offsetParent.offsetTop+10:-t.target.offsetParent.offsetTop-10,p.element.find(".e-seriesPageIndicator").removeClass("inActive").css({top:n.position().top,left:n.position().left+20}),l=m._seriesCurrentPage,window.navigator.userAgent.indexOf("MSIE ")>-1?e(document).on("selectstart",function(e){e.preventDefault()}):window.getSelection().removeAllRanges(),movedDistance>0&&initThumbPos+movedDistance<=s||movedDistance<0&&initThumbPos+movedDistance>=0?o=initThumbPos+movedDistance+r():initThumbPos+movedDistance>s?o=r()+s:initThumbPos+movedDistance<0&&(o=r()),n.offset({top:o}),(l=0==Math.ceil(((_?n.offset().top:n.position().top)-r())/(s/m._seriesPageCount))?1:Math.ceil(((_?n.offset().top:n.position().top)-r())/(s/m._seriesPageCount)))>m._seriesPageCount&&(l=m._seriesPageCount),(movedDistance>0?m._seriesCurrentPage>l:m._seriesCurrentPage<l)&&(l=m._seriesCurrentPage),p.element.find(".e-seriesPageIndicator").css({top:n.position().top}),p.element.find(".series_CurrentPage").html(l),l!=m._seriesCurrentPage&&(m._seriesCurrentPage=l,clearTimeout(i),i=setTimeout(function(){u?m._pivotClientObj.refreshPagedPivotClient("series",m._seriesCurrentPage):m.refreshPagedPivotGrid("series",m._seriesCurrentPage)},250))}),e(n).on("mousedown touchstart",function(t){var i,l,o,a;e(this).addClass("dragging"),i=t.pageY-r(),l=(_?n.offset().top:n.position().top)-r(),p.element.find(".e-seriesPageIndicator").removeClass("inActive").css({top:n.position().top,left:n.position().left+20}),o=t.pageY-r()-i,a=m._seriesCurrentPage,e(document).on("mousemove touchmove",function(t){window.navigator.userAgent.indexOf("Trident")>-1?e(document).on("selectstart",function(e){e.preventDefault()}):window.getSelection().removeAllRanges();var d=t.pageY-r()-i;0!=d&&(d>0&&l+d<=s?n.offset({top:l+d+r()}):d<0&&l+d>=0?n.offset({top:l+d+r()}):l+d>s?n.offset({top:r()+s}):l+d<0&&n.offset({top:r()}),a=0==Math.floor((Math.round(_?n.offset().top:n.position().top)-r())/(s/m._seriesPageCount))?1:Math.floor((Math.round(_?n.offset().top:n.position().top)-r())/(s/m._seriesPageCount)),(o<d?a<m._seriesCurrentPage:a>m._seriesCurrentPage)&&(a=m._seriesCurrentPage)),p.element.find(".e-seriesPageIndicator").css({top:n.position().top}),p.element.find(".series_CurrentPage").html(a),p.element.find(".e-vScrollThumb").attr("title",p.element.find(".e-seriesPageIndicator").text())}),e(document).on("mouseup touchend",function(){e(document).off("selectstart"),e(this).off("mousemove touchmove").off("mouseup touchend"),e(n).removeClass("dragging"),a!=m._seriesCurrentPage?(m._seriesCurrentPage=a,u?m._pivotClientObj.refreshPagedPivotClient("series",m._seriesCurrentPage):m.refreshPagedPivotGrid("series",m._seriesCurrentPage)):p.element.find(".e-seriesPageIndicator").addClass("inActive")})})),m._categPageCount>1&&(o=function(){return Math.round(p.element.find(".e-hScrollPanel").offset().left)+1},this.element.parents(".e-pivotclient").length>0&&this._pivotClientObj.element.find(".childsplit").length>0&&this._pivotClientObj.element.find(".childsplit").data("ejSplitter").refresh(),(a=e(p.element).find(".e-hScrollPanel")).width(u?this._pivotClientObj.model.enableSplitter?parseInt(this._pivotClientObj.element.find(".controlPanelTD").width()):parseInt(this._pivotClientObj.element.find(".e-controlPanel").width()):e(g).width()),a.html(t.buildTag("div.e-hScrollThumb")[0].outerHTML),(d=a.find(".e-hScrollThumb")).width(Math.max(Math.ceil((u?this._pivotClientObj.model.enableSplitter?parseInt(this._pivotClientObj.element.find(".controlPanelTD").width()):parseInt(this._pivotClientObj.element.find(".e-controlPanel").width()):e(g).width())/m._categPageCount),15)),h=a.width()-d.width()-2,this.model.enableRTL?d.css({right:(m._categCurrentPage-1)*(h/(m._categPageCount-1))}):d.offset({left:o()+(m._categCurrentPage-1)*(h/(m._categPageCount-1))}),e(".e-hScrollPanel").on("mousewheel DOMMouseScroll",function(t){var r;e("body").on("mousewheel DOMMouseScroll",function(e){return e.preventDefault(),e.stopPropagation(),!1}),initThumbPos=p.model.enableRTL?p.element.find(".e-hScrollPanel").width()-((_?d.offset().left:d.position().left)+16-o()):(_?d.offset().left:d.position().left)-o(),currentPage=m._categCurrentPage,movedDistance=t.originalEvent.wheelDelta<0||t.originalEvent.detail>0?u?t.target.offsetParent.children[1].offsetLeft+10:t.target.offsetParent.offsetLeft+10:u?-t.target.offsetParent.children[1].offsetLeft-10:-t.target.offsetParent.offsetLeft-10,movedDistance=p.model.enableRTL?-movedDistance:movedDistance,p.element.find(".e-categPageIndicator").removeClass("inActive").css({left:d.position().left,top:d.position().top+20}),window.navigator.userAgent.indexOf("MSIE ")>-1?e(document).on("selectstart",function(e){e.preventDefault()}):window.getSelection().removeAllRanges(),p.model.enableRTL?movedDistance>0&&initThumbPos+movedDistance<=h||movedDistance<0&&initThumbPos+movedDistance>=0?r=initThumbPos+movedDistance:initThumbPos+movedDistance>h?r=h:initThumbPos+movedDistance<0&&(r=0):movedDistance>0&&initThumbPos+movedDistance<=h||movedDistance<0&&initThumbPos+movedDistance>=0?r=initThumbPos+movedDistance+o():initThumbPos+movedDistance>h?r=o()+h:initThumbPos+movedDistance<0&&(r=o()),p.model.enableRTL?d.css("right",r):d.offset({left:r}),currentPage=p.model.enableRTL?0==Math.floor((p.element.find(".e-hScrollPanel").width()-((_?d.offset().left:d.position().left)+16-o()))/(h/m._categPageCount))?1:Math.floor((p.element.find(".e-hScrollPanel").width()-((_?d.offset().left:d.position().left)+16-o()))/(h/m._categPageCount)):0==Math.floor((Math.round(_?d.offset().left:d.position().left)-o())/(h/m._categPageCount))?1:Math.floor((Math.round(_?d.offset().left:d.position().left)-o())/(h/m._categPageCount)),currentPage=currentPage>m._categPageCount?m._categPageCount:currentPage<1?1:currentPage,(movedDistance>0?m._categCurrentPage>currentPage:m._categCurrentPage<currentPage)&&(currentPage=m._categCurrentPage),p.element.find(".e-categPageIndicator").css({left:d.position().left}),p.element.find(".categ_CurrentPage").html(currentPage),currentPage!=m._categCurrentPage&&(m._categCurrentPage=currentPage,clearTimeout(i),i=setTimeout(function(){u?m._pivotClientObj.refreshPagedPivotClient("categ",m._categCurrentPage):m.refreshPagedPivotGrid("categ",m._categCurrentPage)},250))}),e(d).on("mousedown touchstart",function(t){var i,r,l,n;e(this).addClass("dragging"),i=p.model.enableRTL?p.element.find(".e-hScrollPanel").width()-(t.pageX-o()):t.pageX-o(),r=p.model.enableRTL?p.element.find(".e-hScrollPanel").width()-((_?d.offset().left:d.position().left)+16-o()):(_?d.offset().left:d.position().left)-o(),p.element.find(".e-categPageIndicator").removeClass("inActive").css({left:d.position().left,top:d.position().top+20}),l=p.model.enableRTL?p.element.find(".e-hScrollPanel").width()-(t.pageX-o())-i:t.pageX-o()-i,n=m._categCurrentPage,e(document).on("mousemove touchmove",function(t){window.navigator.userAgent.indexOf("Trident")>-1?e(document).on("selectstart",function(e){e.preventDefault()}):window.getSelection().removeAllRanges();var s=p.model.enableRTL?p.element.find(".e-hScrollPanel").width()-(t.pageX-o())-i:t.pageX-o()-i;0!=s&&(s>0&&r+s<=h?p.model.enableRTL?d.css({right:r+s}):d.offset({left:r+s+o()}):s<0&&r+s>=0?p.model.enableRTL?d.css({right:r+s}):d.offset({left:r+s+o()}):r+s>h?p.model.enableRTL?d.css({right:h}):d.offset({left:o()+h}):r+s<0&&(p.model.enableRTL?d.css({right:"0px"}):d.offset({left:o()})),n=(n=p.model.enableRTL?0==Math.floor((p.element.find(".e-hScrollPanel").width()-((_?d.offset().left:d.position().left)+16-o()))/(h/m._categPageCount))?1:Math.floor((p.element.find(".e-hScrollPanel").width()-((_?d.offset().left:d.position().left)+16-o()))/(h/m._categPageCount)):0==Math.floor((Math.round(_?d.offset().left:d.position().left)-o())/(h/m._categPageCount))?1:Math.floor((Math.round(_?d.offset().left:d.position().left)-o())/(h/m._categPageCount)))>m._categPageCount?m._categPageCount:n<1?1:n,(l<s?n<m._categCurrentPage:n>m._categCurrentPage)&&(n=m._categCurrentPage)),p.element.find(".e-categPageIndicator").css({left:d.position().left}),p.element.find(".categ_CurrentPage").html(n),p.element.find(".e-hScrollThumb").attr("title",p.element.find(".e-categPageIndicator").text())}),e(document).on("mouseup touchend",function(){e(document).off("selectstart"),e(this).off("mousemove touchmove").off("mouseup touchend"),e(d).removeClass("dragging"),n!=m._categCurrentPage?(m._categCurrentPage=n,u?m._pivotClientObj.refreshPagedPivotClient("categ",m._categCurrentPage):m.refreshPagedPivotGrid("categ",m._categCurrentPage)):p.element.find(".e-categPageIndicator").addClass("inActive")})})),u&&(m._categPageCount<=1&&(c=this._pivotClientObj.element.find(".e-outerTable").height()-58,this._pivotClientObj.element.find(".e-gridContainer").height(c),this._pivotClientObj.element.find(".e-chartContainer").height(c)),m._seriesPageCount<=1&&(c=this._pivotClientObj.element.find("ul.clientTab").width()-2,this._pivotClientObj.element.find(".e-gridContainer").width(c),this._pivotClientObj.element.find(".e-chartContainer").width(c)),this._pivotClientObj.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&(this._pivotClientObj.element.find(".e-hScrollThumb").length>0?this._pivotClientObj.element.find(".e-gridContainer,.e-chartContainer").height(this._pivotClientObj.element.find(".e-controlPanel").height()-(this._pivotClientObj.element.find("ul.clientTab").height()+23)):this._pivotClientObj.element.find(".e-gridContainer,.e-chartContainer").height(this._pivotClientObj.element.find(".e-controlPanel").height()-this._pivotClientObj.element.find("ul.clientTab").height()-2),this._pivotClientObj.element.find(".e-vScrollPanel").css("margin-left","7px"))),e("body").off("mousewheel DOMMouseScroll")},_getLocalizedLabels:function(e){return t.isNullOrUndefined(t.PivotGrid.Locale[this.locale()])||t.PivotGrid.Locale[this.locale()][e]==r?t.PivotGrid.Locale["en-US"][e]:t.PivotGrid.Locale[this.locale()][e]},_drillDown:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b;if(this._drillCaption=e(i.target).parent().find(".cellValue").text(),d=i.target.className,this._startDrilldown=!0,r=this,l=e(this.element).parents(".e-pivotclient").length>0?e(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,d=d.split(" "),e(i.target).hasClass("e-expand")?this._drillAction="drilldown":e(i.target).hasClass("e-collapse")&&(this._drillAction="drillup"),n=e(e(i.target).parent()).hasClass("rowheader")||"rowheader"==e(e(i.target).parent()).attr("role")?"rowheader":"colheader",this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode){t.isNullOrUndefined(l)?this._waitingPopup.show():(l._isTimeOut=!0,setTimeout(function(){l._isTimeOut&&r._waitingPopup.show()},800));for(var C,S=e(i.target).parent().attr("data-p"),x=(C=this.getJSONRecords()[parseInt(parseInt(S.split(",")[0])*this._rowCount+parseInt(S.split(",")[1]))].Info).replace(/&/g,"&amp;"),v=parseInt(S.split(",")[0]),w=parseInt(S.split(",")[1]);v>0;){for(v--,s=this.getJSONRecords()[v*this._rowCount+w].Info,o=w;""==s&&o>0;)o--,s=this.getJSONRecords()[v*this._rowCount+o].Info;C=s+">#>"+C}return"ejPivotClient"==(a=this.element.parents(".e-pivotclient").length>0?this.element.parents(".e-pivotclient").data("ejPivotClient"):t.isNullOrUndefined(this._pivotClientObj)?this:this._pivotClientObj).pluginName&&"rowheader"==n&&a.displayMode()!=t.PivotClient.DisplayMode.GridOnly&&(a._drillInfo=C,a.setChartDrillParams(C,this._drillAction)),a._pivotRecords={records:this.getJSONRecords(),rowCount:this._rowCount},e(i.target).hasClass("e-collapse")?this.updateDrilledReport({uniqueName:x,index:S,action:"collapse"},n,a):this.updateDrilledReport({uniqueName:x,index:S},n,a),!1}if(this.element.find(".e-dialog").remove(),!this.model.enableDeferUpdate){this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this._off(this.element,"click",".e-expand, .e-collapse"),this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.element.find(".colheader, .rowheader, .value").removeClass("e-droppable"),d=i.target.className,h=e(i.target).parent(),this._startDrilldown=!0,"e-expand"==(d=d.split(" "))[0]?this._drillAction="drilldown":"e-collapse"==d[0]&&(this._drillAction="drillup"),null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"drillDown",element:this.element,customObject:this.model.customObject}),c=JSON.stringify(this.model.customObject),u=e(i.target).parent().attr("data-p"),this._drillCaption=e(i.target).parent().find(".cellValue").text(),t.isNullOrUndefined(r._pivotClientObj)||t.isNullOrUndefined(r._pivotClientObj._waitingPopup)?t.isNullOrUndefined(l)?this._waitingPopup.show():(l._isTimeOut=!0,setTimeout(function(){l._isTimeOut&&r._waitingPopup.show()},800)):(r._pivotClientObj._isTimeOut=!0,setTimeout(function(){r._pivotClientObj._isTimeOut&&(e("#"+r._pivotClientObj._id+"_maxView")[0]?(e("#"+r._pivotClientObj._id+"_maxView").ejWaitingPopup({showOnInit:!0}),r._maxViewLoading=e("#"+r._pivotClientObj._id+"_maxView").data("ejWaitingPopup")):r._pivotClientObj._waitingPopup.show())},800)),g="relational"==this.model.analysisMode?this._drillHeaders.join("||"):this.getJSONRecords()[parseInt(parseInt(u.split(",")[0])*this._rowCount+parseInt(u.split(",")[1]))].Info;try{b=e(this.element).parents(".e-pivotclient").length>0&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?JSON.parse(this._pivotClientObj.getOlapReport()).Report:this._pivotClientObj.currentReport:JSON.parse(this.getOlapReport()).Report}catch(i){b=e(this.element).parents(".e-pivotclient").length>0&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this._pivotClientObj.getOlapReport():this._pivotClientObj.currentReport:this.getOlapReport()}if(this.model.operationalMode==t.Pivot.OperationalMode.ClientMode||this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){p=null,!t.isNullOrUndefined(this.model.valueSortSettings)&&this.element.find(".valueSorting").length>0&&!t.isNullOrUndefined(t.PivotAnalysis._valueSorting)&&(p=this.element.find(".valueSorting").parent());var I=this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&(this.model.enableAdvancedFilter||(e(this.element).parents(".e-pivotclient").length>0||e(this.element).parents(".e-fullScreenView").length>0)&&this._pivotClientObj.model.enableAdvancedFilter)?e(this.element).find(".e-pivotGridTable").detach():this._table,y=this._getFieldName(e(i.target).parent()[0]),T=e(e(i.target).parent()).hasClass("rowheader")||"rowheader"==e(e(i.target).parent()).attr("role")?"rowheader":e(e(i.target).parent()).hasClass("colheader")||"columnheader"==e(e(i.target).parent()).attr("role")?"columnheader":"";this.model.enablePaging||this.model.enableVirtualScrolling||(e(i.target).hasClass("e-collapse")?(t.isNullOrUndefined(this.model.collapsedMembers)&&(this.model.collapsedMembers={}),t.isNullOrUndefined(this.model.collapsedMembers[y])?this.model.collapsedMembers[y]=[e(e(i.target).parent()[0]).text().trim()]:this.model.collapsedMembers[y].push(e(e(i.target).parent()[0]).text().trim())):e(i.target).hasClass("e-expand")&&(this.model.collapsedMembers[y]=e.grep(this.model.collapsedMembers[y],function(t){return t!=e(e(i.target).parent()[0]).text().trim()})),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&(this.model.enableAdvancedFilter||(e(this.element).parents(".e-pivotclient").length>0||e(this.element).parents(".e-fullScreenView").length>0)&&this._pivotClientObj.model.enableAdvancedFilter)?(this._collapseMember(I,i.target),e(this.element).parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableToolBar&&!this._pivotClientObj.model.displaySettings.enableFullScreen?this.element.find("#"+this._id+"Toolbar").append(I):this.element.append(I)):(this._collapseMember(I,I.find("[data-p='"+u+"']").children("span")[0]),this._cropHtml(I),this.model.enableColumnResizing&&this.model.resizeColumnsToFit&&!this.model.isResponsive&&this.element.find(".e-pivotGridTable").removeAttr("style"),this._mergeHtml(T,u,I,this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?e(this.element).find(".e-pivotGridTable"):e(this.element).find("table")),(this.model.resizeColumnsToFit||!this.model.enableColumnResizing)&&(this.model.enableColumnResizing||this.model.resizeColumnsToFit)||this.element.find(".e-pivotGridTable").css("width","100%")),this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?this._applyFrozenHeaderWidth(this._JSONRecords,this._drillAction,h):(this.model.enableColumnResizing&&this.model.resizeColumnsToFit||this.model.enableColumnResizing&&!this.model.resizeColumnsToFit)&&this._resizeColumnsWidth(),this._hideGrandTotal(I),this.model.enableGroupingBar&&(m=e("#"+this._id).find(".e-pivotGridTable").width(),this.element.find(".groupingBarPivot .e-drag").width(m-5),_=e("#"+this._id).find(".e-pivotGridTable").find("th").width(),this.element.find(".groupingBarPivot .values").width(_-2),this.element.find(".groupingBarPivot .columns").width(m-_),this.element.find(".groupingBarPivot .valueColumn").width(m)),this.element.find(".colheader, .rowheader, .value").addClass("e-droppable"),t.isNullOrUndefined(l)?t.isNullOrUndefined(r._pivotClientObj)||(r._pivotClientObj._isTimeOut=!1):l._isTimeOut=!1,this._waitingPopup.hide());v=parseInt(u.split(",")[0]),w=parseInt(u.split(",")[1]);if(""==this._drillCaption&&(this._drillCaption=e.trim(e(i.target).parent(":not(span)").text().replace("expanded","").replace("collapsed",""))),C=this._drillCaption,C=e.trim(this._getMemberInfo(C,w,v,T)),f=this.model.operationalMode==t.Pivot.OperationalMode.ClientMode,"rowheader"==T?(this.model.enablePaging||this.model.enableVirtualScrolling)&&("drillup"==this._drillAction?this.model.enableCollapseByDefault?this._drillHeaders.row=this._drillHeaders.row.filter(function(e){if(e!=(f?C:C.split(">#>").join(".")))return e}):this._drillHeaders.row.push(f?C:C.split(">#>").join(".")):this.model.enableCollapseByDefault?this._drillHeaders.row.push(f?C:C.split(">#>").join(".")):this._drillHeaders.row=this._drillHeaders.row.filter(function(e){if(e!=(f?C:C.split(">#>").join(".")))return e})):(this.model.enablePaging||this.model.enableVirtualScrolling)&&(C.startsWith(">#>")&&(C=C.substring(3,C.length)),"drillup"==this._drillAction?this.model.enableCollapseByDefault?this._drillHeaders.column=this._drillHeaders.column.filter(function(e){if(e!=(f?C:C.split(">#>").join(".")))return e}):this._drillHeaders.column.push(f?C:C.split(">#>").join(".")):this.model.enableCollapseByDefault?this._drillHeaders.column.push(f?C:C.split(">#>").join(".")):this._drillHeaders.column=this._drillHeaders.column.filter(function(e){if(e!=(f?C:C.split(">#>").join(".")))return e}),C=""),this.model.enableVirtualScrolling||this.model.enablePaging)if(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode){try{b=JSON.parse(this.getOlapReport()).Report}catch(e){b=this.getOlapReport()}this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",drillHeaders:JSON.stringify(this._drillHeaders),currentReport:b,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:JSON.stringify(this.model.customObject)}),this._renderControlSuccess)}else this._refPaging();this.model.valueSortSettings&&this._refreshValueSortIcons(p),t.isNullOrUndefined(this._pivotClientObj)||this._pivotClientObj._trigger("gridDrillSuccess",{gridObj:this,drillAction:this._drillAction,drilledMember:C,fieldName:y,axis:n,cellPosition:u}),this._trigger("drillSuccess",{gridObj:this,drillAction:this._drillAction,drilledMember:C,fieldName:y,axis:n,cellPosition:u}),this.model.enableGroupingBar&&this._createFields("drilldown",e("#"+this._id).find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth()),this._unWireEvents(),this._wireEvents(),this._drillAction=""}else""!=this.layout()||"normal"!=this.layout()?t.isNullOrUndefined(this._pivotClientObj)?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:u,currentReport:b,headerInfo:g,layout:this.layout(),customObject:c}),this._drillDownSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:u,currentReport:b,clientReports:this._pivotClientObj.reports,headerInfo:g,layout:this.layout(),customObject:c}),this._drillDownSuccess):t.isNullOrUndefined(this._pivotClientObj)?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:u,currentReport:b,headerInfo:g,customObject:c}),this._drillDownSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:u,currentReport:b,clientReports:this._pivotClientObj.reports,headerInfo:g,customObject:c}),this._drillDownSuccess)}},_getMemberInfo:function(e,i,r,l){if(this.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&(this.model.paging||this.model.enableVirtualScrolling))e=this.getJSONRecords()[this._rowCount*r+i].Info;else for(;"rowheader"==l?r>0:i>0;){"rowheader"==l?r--:i--;for(var n=this.getJSONRecords()[this._rowCount*r+i].Value,s=i;""==n&&("rowheader"==l?s>0:r>0);)"rowheader"==l?s--:r--,n=this.getJSONRecords()[this._rowCount*r+s].Value;e=n+">#>"+e}return e},_collapseMember:function(i,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L;if(!this.model.enablePaging&&!this.model.enableVirtualScrolling){var R=e(l).parent()[0],O=e(R).attr("data-p"),F=e(l).attr("data-tag")!=r?parseInt(e(l).attr("data-tag"))+R.rowSpan:R.rowSpan,E=this.model.enableAdvancedFilter&&!t.isNullOrUndefined(e(R).attr("vfcolspan"))?parseInt(e(R).attr("vfcolspan")):e(l).attr("data-tag")!=r?parseInt(e(l).attr("data-tag"))+R.colSpan:R.colSpan,D=e(l).closest("tr")[0],N=null,A=null,P="false",k=0;if(R.className.indexOf("rowheader")>=0||R.className.indexOf("summary")>=0&&"rowheader"==e(R).attr("role")){if(this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout){var j="0,0"==this.getJSONRecords()[1].Index?1:0,M=(F=this.getJSONRecords()[parseInt(O.split(",")[0])*this._rowCount+parseInt(O.split(",")[1])+j].RowSpan,D);for(e(l).attr("class").indexOf("e-expand")>-1&&e(D).removeAttr("data-tag"),u=0;u<F;u++)e(l).attr("class")&&e(l).attr("class").indexOf("e-collapse")>-1&&(e(e(D).next()).attr("data-tag")==r&&e(e(D).next()).attr("data-tag",O),e(e(D).next()).css("display","none"),(this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders)&&e(i).find(".pivotGridValueTable  td[data-i$=',"+e(e(D).next()).find("td").attr("data-i").split(",")[1]+"']").css("display","none")),e(l).attr("class").indexOf("e-expand")>-1&&(e(e(D).next()).attr("data-tag")==r||e(e(D).next()).attr("data-tag")==O)&&(e(e(D).next()).css("display","table-row"),e(e(D).next()).removeAttr("data-tag"),(this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders)&&e(D).parents().find(".pivotGridValueTable td[data-i$=',"+e(e(D).next()).find("td").attr("data-i").split(",")[1]+"']").css("display","")),D=e(D).next();var V=this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders?"td":"th",B=this.model.enableRTL?"margin-right":"margin-left",H=e(M).find(V+" span:not(.cellValue)").css(B);return e(M).find(V+" span:not(.cellValue)").remove(),void e(M).find(V).prepend(e(l).attr("class").indexOf("e-collapse")>-1?'<span style="'+B+":"+H+'" class="e-expand e-icon" aria-label=\'collapsed\' title="'+this._getLocalizedLabels("Expand")+'">&nbsp;</span>':'<span style="'+B+":"+H+'" class="e-collapse e-icon" aria-label=\'expanded\' title="'+this._getLocalizedLabels("Collapse")+'">&nbsp;</span>')}var X,U=!e(R).index()>0,z=X=!1;if(e(l).attr("class")&&e(l).attr("class").indexOf("collapse")>-1){for(u=0;u<F;u++){if(N=e(D).next(),U)e(D).find(".stot,.rstot").length>=1&&1==u&&e(e(D).find(".stot,.rstot")).find(".e-expand").length>=1&&(X=!0),(e(e(D).find(".stot,.rstot")).find(".e-expand").length>=1||"none"==e(D).css("display"))&&(z=!0),e(D).css("display","none"),e(D).attr("data-tag",e(D).attr("data-tag")!=r?parseInt(e(D).attr("data-tag"))+1:1),(this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders)&&(e(i).find(".pivotGridValueTable tr:eq("+e(D).index()+")").css("display","none"),e(i).find(".pivotGridValueTable tr:eq("+e(D).index()+")").attr("data-tag",e(D).attr("data-tag")!=r?parseInt(e(D).attr("data-tag"))+1:1));else{if(o=R,this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders)for(I=e(R).prevAll().length;I<e(i).find("[data-p$=',"+e(R).attr("data-p").split(",")[1]+"'] ").length;I++)e(o).css("display","none").attr("data-hc",e(o).attr("data-hc")==r?1:parseInt(e(o).attr("data-hc"))+1),o=e(e(i).find("[data-p$=',"+e(o).attr("data-p").split(",")[1]+"'] ")[I+1]);else for(I=0;I<=e(R).nextAll().length;I++)e(o).css("display","none").attr("data-hc",e(o).attr("data-hc")==r?1:parseInt(e(o).attr("data-hc"))+1),o=e(o).next();!1,P="true"}D=N,U=!0}for(n="true"==P?R.rowSpan-1:R.rowSpan,"none"!=e(D).css("display")&&X&&(s=e(l).attr("subTag")!=r?-1==parseInt(e(l).attr("subTag"))?R.rowSpan+1:parseInt(e(l).attr("subTag"))+R.rowSpan:R.rowSpan),"none"==e(D).css("display")&&(e(D).css("display",""),(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&e(i).find('td.value[data-p$=",'+parseInt(e(D).children().eq(0).attr("data-p").split(",")[1])+'"]').parent().css("display",""),z=!0,n-=1),z&&t.isNullOrUndefined(s)&&(s=e(l).attr("subTag")!=r?-1==parseInt(e(l).attr("subTag"))?R.rowSpan:parseInt(e(l).attr("subTag"))+R.rowSpan:R.rowSpan),(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&e(i).find(".pivotGridValueTable").length>0?(e(D).find("td").text(e(D).find("td").text().replace(" Total","")),e(D).find("td span:not(.cellValue)").remove(),e(D).find("td").prepend('<span class="e-expand e-icon" title="'+this._getLocalizedLabels("Expand")+'" data-tag="'+F+":"+P+'">&nbsp;</span>')):(e(D).find("th").text(e(D).find("th").text().replace(" Total","")),e(D).find("th span:not(.cellValue)").remove(),e(D).find("th").prepend('<span class="e-expand e-icon" title="'+this._getLocalizedLabels("Expand")+'" data-tag="'+F+":"+P+(t.isNullOrUndefined(s)?"":"true"==e(l).attr("isChildSubNode")?'" subTag="'+s+":"+P+'" isChildSubNode="true':'" subTag="'+s+":"+P)+'">&nbsp;</span>')),d=e(D).prevAll().find("th:has(span):not(.summary), td:has(span):not(.summary)"),u=0;u<d.length;u++)parseInt(e(d[u]).attr("data-p").split(",")[0])<parseInt(O.split(",")[0])&&parseInt(e(d[u]).attr("data-p").split(",")[1])+d[u].rowSpan+(e(d[u]).find("span").attr("data-tag")!=r?parseInt(e(d[u]).find("span").attr("data-tag")):0)>=parseInt(O.split(",")[1])+F&&(d[u].rowSpan-=n,e(d[u]).find("span").attr("data-tag")==r&&e(d[u]).find("span").attr("isChildSubNode",!0),e(d[u]).find("span").attr("data-tag",e(d[u]).find("span").attr("data-tag")!=r?parseInt(e(d[u]).find("span").attr("data-tag"))+n:n),e(d[u]).find("span").attr("subTag",e(d[u]).find("span").attr("subTag")!=r?parseInt(e(d[u]).find("span").attr("subTag"))+n:n))}else if(e(l).attr("class")&&e(l).attr("class").indexOf("e-expand")>-1){var q=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,G=this._isSubTotalhidden=!1,W=0;for(u=parseInt(e(l).attr("data-tag").split(":")[0]);u>=0;u--)A=e(D).prev(),e(D).attr("data-tag")==r||parseInt(e(D).attr("data-tag"))<=1?(this._hideSubTotal(e(D),W,e(l)),this._isSubTotalHide?(G=!0,this._isSubTotalHide=!1,e(D).css("display","none"),q&&e(i).find(".pivotGridValueTable tr:eq("+e(D).index()+")").css("display","none")):(e(D).css("display","table-row"),(this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders)&&0==e(D).find("td[data-hc]").length&&e(i).find(".pivotGridValueTable tr:eq("+e(D).index()+")").css("display","table-row"))):k++,W=0==W?1:W,e(D).attr("data-tag")!=r&&(0==parseInt(e(D).attr("data-tag")-1)?e(D).removeAttr("data-tag"):e(D).attr("data-tag",parseInt(e(D).attr("data-tag"))-1)),D=A;if("true"==e(l).attr("data-tag").split(":")[1]){for(o=e(i).find((q?".pivotGridRowTable ":"th")+"[data-p='"+parseInt(e(R).attr("data-p").split(",")[0])+","+(parseInt(e(R).attr("data-p").split(",")[1])-parseInt(e(l).attr("data-tag").split(":")[0]))+"'], td[data-p='"+parseInt(e(R).attr("data-p").split(",")[0])+","+(parseInt(e(R).attr("data-p").split(",")[1])-parseInt(e(l).attr("data-tag").split(":")[0]))+"']"),a=e(o).nextAll().length,q&&(a=e.merge(e(o).nextAll(),e(i).find(".pivotGridValueTable tr:eq("+e(o).parent().index()+") td")).length),I=0;I<=a;I++)e(o).attr("data-hc")==r||parseInt(e(o).attr("data-hc"))<=1?(e(o).removeAttr("data-hc"),e(o).attr("data-hc")==r&&e(o).css("display","")):e(o).attr("data-hc",parseInt(e(o).attr("data-hc"))-1),o=q?e.merge(e(o).nextAll(),e(i).find(".pivotGridValueTable tr:eq("+e(o).parent().index()+") td"))[0]:e(o).next();if(q)for(D=e(l).closest("tr")[0],u=parseInt(e(l).attr("data-tag").split(":")[0]);u>=0;u--)0==e(D).find("td[data-hc]").length&&e(i).find(".pivotGridValueTable tr:eq("+e(D).index()+")").css("display","table-row"),D=e(D).prev()}for(d=e(e(l).closest("tr")[0]).prevAll().find("th:has(span):not(.summary), td:has(span):not(.summary)"),h=e(l).attr("subTag")!=r&&G?"true"==e(l).attr("subTag").split(":")[1]?parseInt(e(l).attr("subTag").split(":")[0])-1:parseInt(e(l).attr("subTag").split(":")[0]):("true"==e(l).attr("data-tag").split(":")[1]?parseInt(e(l).attr("data-tag").split(":")[0])-1:parseInt(e(l).attr("data-tag").split(":")[0]))-k,c=e(i).find("th[data-p='"+parseInt(e(R).attr("data-p").split(",")[0])+","+(parseInt(e(R).attr("data-p").split(",")[1])-parseInt(e(l).attr("data-tag").split(":")[0]))+"'], td[data-p='"+parseInt(e(R).attr("data-p").split(",")[0])+","+(parseInt(e(R).attr("data-p").split(",")[1])-parseInt(e(l).attr("data-tag").split(":")[0]))+"']"),G&&(h=parseInt(e(c).attr("rowspan")),h=e(l).attr("subTag")!=r?"true"==e(l).attr("subTag").split(":")[1]?h-1:h:"true"==e(l).attr("data-tag").split(":")[1]?h-1:h,h=e(l).attr("subTag")!=r?-1==parseInt(e(l).attr("subTag").split(":")[0])?h:this._isSubTotalhidden?h-1:h:h-1),u=0;u<d.length;u++)parseInt(e(d[u]).attr("data-p").split(",")[0])<parseInt(O.split(",")[0])&&parseInt(e(d[u]).attr("data-p").split(",")[1])+d[u].rowSpan+(e(d[u]).find("span").attr("data-tag")!=r?parseInt(e(d[u]).find("span").attr("data-tag")):0)>=parseInt(O.split(",")[1])&&(G&&(this._isSubTotalhidden=G=!1,"true"==e(l).attr("isChildSubNode")&&e(l).removeAttr("isChildSubNode")),d[u].rowSpan+=h,e(d[u]).find("span").attr("data-tag")!=r&&e(d[u]).find("span").attr("data-tag",parseInt(e(d[u]).find("span").attr("data-tag"))-h),0==parseInt(e(d[u]).find("span").attr("data-tag"))&&e(d[u]).find("span").removeAttr("data-tag"),e(d[u]).find("span").attr("subTag")!=r&&e(d[u]).find("span").attr("subTag",parseInt(e(d[u]).find("span").attr("subTag"))-h),0==parseInt(e(d[u]).find("span").attr("subTag"))&&e(d[u]).find("span").removeAttr("subTag"));e(R).find(".cellValue").length>0?e(R).find(".cellValue").text(e.trim(e(R).find(".cellValue").text())+" Total"):e(R).text(e.trim(e(R).text())+" Total"),e(R).find(".e-expand").remove(),e(R).prepend("<span style='margin-left:10px'></span>")}}if(R.className.indexOf("colheader")>=0||R.className.indexOf("summary")>=0&&"columnheader"==e(R).attr("role"))if(g=parseInt(O.split(",")[0]),e(i).find("tr"),e(l).attr("class")&&e(l).attr("class").indexOf("e-collapse")>-1){if(p=R.colSpan,"none"==e(R).next().css("display")){var K=e(R).next().attr("data-p"),J=parseInt(K.split(",")[0]),Q=(e(i).find("tr"),parseInt(e(R).next().attr("colspan")));if(e(R).next().attr("class").indexOf("stot","cstot")>-1)for(T=0;T<Q;T++){for(m=e(D).nextAll().find("th[data-p^='"+(T+J)+",']"),C=0;C<e(m).length;C++)e(m[C]).css("display","");if(e(m[C]).attr("data-hc")==r||parseInt(e(m[C]).attr("data-hc"))<1)for(e(i).find("td[data-p^='"+(T+J)+",']").css("display",""),w=0;w<e(i).find("td[data-p^='"+(T+J)+",']").length;w++)(e(e(i).find("td[data-p^='"+(T+J)+",']")[w]).attr("data-hc")!=r||e(e(i).find("td[data-p^='"+(T+J)+",']")[w]).attr("data-hc")>-1)&&e(e(i).find("td[data-p^='"+(T+J)+",']")[w]).css("display","none")}e(R).next().css("display",""),p=R.colSpan-Q}for(T=0;T<E;T++)if(0!=(m=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?e(D).nextAll().find("td[data-p^='"+(T+g)+",']"):e(D).nextAll().find("th[data-p^='"+(T+g)+",']")).length){for(C=0;C<e(m).length;C++)e(m[C]).attr("data-hc",e(m[C]).attr("data-hc")!=r?parseInt(e(m[C]).attr("data-hc"))+1:1).css("display","none");(e(m[C]).attr("data-hc")==r||parseInt(e(m[C]).attr("data-hc"))<1)&&(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?(e(i).find(".pivotGridValueTable td[data-p^='"+(T+g)+",']").css("display","none"),e(i).find(".pivotGridValueTable td[data-p^='0,']:not(.summary)").parent().find("td[data-p^='"+(T+g)+",']").attr("data-ch",1)):(e(i).find("td[data-p^='"+(T+g)+",']").css("display","none"),e(i).find("th[data-p^='0,']:not(.summary)").parent().find("td[data-p^='"+(T+g)+",']").attr("data-ch",1)))}for(e(R).attr("data-hc",1).css("display","none"),e(R).next().text(e(R).next().text().replace(" Total","")),e(R).next().find("span:not(.cellValue)").remove(),e(R).next().prepend('<span class="e-expand e-icon" title="'+this._getLocalizedLabels("Expand")+'" data-tag="'+E+'">&nbsp;</span>'),ee=e(D).prevAll().find("th:has(span):not(.summary), td:has(span):not(.summary)"),T=0;T<ee.length;T++)L=this.model.enableAdvancedFilter&&!t.isNullOrUndefined(e(ee[T]).attr("vfcolspan"))?parseInt(e(ee[T]).attr("vfcolspan")):ee[T].colSpan,parseInt(e(ee[T]).attr("data-p").split(",")[1])<parseInt(O.split(",")[1])&&parseInt(e(ee[T]).attr("data-p").split(",")[0])<=parseInt(O.split(",")[0])&&parseInt(e(ee[T]).attr("data-p").split(",")[0])+L+(e(ee[T]).find("span").attr("data-tag")!=r?parseInt(e(ee[T]).find("span").attr("data-tag")):0)>=parseInt(O.split(",")[0])+E&&(ee[T].colSpan-=p,e(ee[T]).find("span").attr("data-tag",e(ee[T]).find("span").attr("data-tag")!=r?parseInt(e(ee[T]).find("span").attr("data-tag"))+p:p))}else if(e(l).attr("class")&&e(l).attr("class").indexOf("e-expand")>-1){var Y,$=0;G=Y=this._isSubTotalhidden=!1,W=0,Q=parseInt(e(R).attr("colspan"));if(this._hideSubTotal(e(D),W,e(l)),this._isSubTotalHide){Y=G=!0,this._isSubTotalHide=!1;K=e(R).attr("data-p"),J=parseInt(K.split(",")[0]),e(i).find("tr");if(e(R).attr("class").indexOf("stot","cstot")>-1)for(T=0;T<Q;T++){for(b=e(D).nextAll().find("th[data-p^='"+(T+J)+",']"),C=0;C<e(b).length;C++)e(b[C]).css("display","none");(e(b[C]).attr("data-hc")==r||parseInt(e(b[C]).attr("data-hc"))<1)&&e(i).find("td[data-p^='"+(T+J)+",']").css("display","none")}e(R).css("display","none")}for(p=E-(Q-1),T=1;T<p;T++){for(m=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?e(D).nextAll().find("td[data-p^='"+(g-T)+",']"):e(D).nextAll().find("th[data-p^='"+(g-T)+",']"),C=0;C<e(m).length;C++){for(Y=!1,_=0;_<e(m[C]).length;_++)(e(e(m[C])[_]).hasClass("stot")||e(e(m[C])[_]).hasClass("cstot"))&&!e(e(m[C])[_]).hasClass("calc")&&this._hideSubTotal(e(e(m[C])[_]),W,e(l));if(this._isSubTotalHide){Y=!0,this._isSubTotalHide=!1;K=e(m[C]).attr("data-p"),J=parseInt(K.split(",")[0]),e(i).find("tr"),Q=parseInt(e(m[C]).attr("colspan"));if(e(m[C]).attr("class").indexOf("stot","cstot")>-1&&!(e(m[C]).find(".e-expand").length>0))for(f=0;f<Q;f++){for(b=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?e(D).nextAll().find("td[data-p^='"+(f+J)+",']"):e(D).nextAll().find("th[data-p^='"+(f+J)+",']"),C=0;C<e(b).length;C++)e(b[C]).css("display","none");e(b[C]).attr("data-hc")==r||parseInt(e(b[C]).attr("data-hc"))<1?e(i).find("td[data-p^='"+(f+J)+",']").css("display","none"):$++}e(m[C]).css("display","none")}e(m[C]).attr("data-hc")==r||1==parseInt(e(m[C]).attr("data-hc"))?(e(m[C]).css("display",""),e(m[C]).removeAttr("data-hc")):parseInt(e(m[C]).attr("data-hc"))-1==0?e(m[C]).removeAttr("data-hc"):e(m[C]).attr("data-hc",parseInt(e(m[C]).attr("data-hc"))-1)}if(W=0==W?1:W,!Y)if(e(m).last().attr("data-hc")==r){if(q=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,e(i).find("td[data-p^='"+(g-T)+",']").css("display",""),S=[],q){for(x=e(i).find("[data-p^='0,']:not(.summary)").parent(),v="",w=0;w<x.length;w++)v=v+(0!=w?" , ":"")+"  .pivotGridValueTable td:eq("+e(x[w]).index()+")";S=e(i).find(v)}else S=e(i).find("[data-p^='0,']:not(.summary)").parent().find("td[data-p^='"+(g-T)+",']");for(e(S).removeAttr("data-ch"),I=0;I<=e(S).length;I++)e(S[I]).attr("data-hc")!=r&&e(S[I]).css("display","none")}else $++}e(R).prev().removeAttr("data-hc").css("display","");parseInt(e(R).prev().attr("colspan"));var Z=parseInt(e(l).attr("data-tag"))-$,ee=e(D).prevAll().find("th:has(span):not(.summary), td:has(span):not(.summary)");for(G&&(G=!1,y=e(this.element).parents(".e-pivotclient").length>0&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?this._pivotClientObj.getOlapReport():this.getOlapReport(),Z=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?parseInt(e(R).prev().attr("colSpan"))-this.model.dataSource.values.length:parseInt(e(R).prev().attr("colSpan"))-JSON.parse(y).PivotCalculations.length),T=0;T<ee.length;T++)L=this.model.enableAdvancedFilter&&!t.isNullOrUndefined(e(ee[T]).attr("vfcolspan"))?parseInt(e(ee[T]).attr("vfcolspan")):ee[T].colSpan,parseInt(e(ee[T]).attr("data-p").split(",")[1])<parseInt(O.split(",")[1])&&parseInt(e(ee[T]).attr("data-p").split(",")[0])<parseInt(O.split(",")[0])&&parseInt(e(ee[T]).attr("data-p").split(",")[0])+ee[T].colSpan+(e(ee[T]).find("span").attr("data-tag")!=r?parseInt(e(ee[T]).find("span").attr("data-tag")):0)>=parseInt(O.split(",")[0])&&(ee[T].colSpan+=Z,e(ee[T]).find("span").attr("data-tag")!=r&&e(ee[T]).find("span").attr("data-tag",parseInt(e(ee[T]).find("span").attr("data-tag"))-Z),0==parseInt(e(ee[T]).find("span").attr("data-tag"))&&e(ee[T]).find("span").removeAttr("data-tag"));e(R).find(".cellValue").length>0?e(R).find(".cellValue").text(e.trim(e(R).find(".cellValue").text())+" Total"):e(R).text(e.trim(e(R).text())+" Total"),e(R).find(".e-expand").remove(),e(R).prepend("<span style='margin-left:10px'></span>")}}},_generateTreeViewData:function(){var e={catalog:this.model.dataSource.catalog,cube:this.model.dataSource.cube,url:this.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this._getTreeData(e,this._loadDimensionElements,{pvtGridObj:this,action:"loadFieldElements"})},_dimensionsDetails:function(t,i){t.pvtGridObj._dimension=e(i).find("row")},_loadDimensionElements:function(t,i){var l,n,s,o,a,d,h;t.pvtGridObj._waitingPopup.show();var c,u={},g={},p=t.pvtGridObj._getConnectionInfo(t.pvtGridObj.model.dataSource.data);for(t.pvtGridObj.schemaTreeView=[],t.pvtGridObj.reportItemNames=[],l='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_DIMENSIONS</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+t.pvtGridObj.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+t.pvtGridObj.model.dataSource.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+t.pvtGridObj.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+p.LCID+"</LocaleIdentifier></PropertyList></Properties></Discover></Body></Envelope>",t.pvtGridObj.doAjaxPost("POST",p.url,{XMLA:l},t.pvtGridObj._dimensionsDetails,null,{pvtGridObj:t.pvtGridObj,action:"loadFieldElements"}),n=t.pvtGridObj._dimension,s=0;s<e(i).find("row").length;s++){if(a=(o=e(e(i).find("row")[s])).find("DIMENSION_UNIQUE_NAME").text(),t.pvtGridObj.model.enableDrillThrough)for(d=0;d<n.length;d++)a==e(n[d]).find("DIMENSION_UNIQUE_NAME").text()&&(c=e(n[d]).find("DIMENSION_CAPTION").text());else c=o.find("DIMENSION_CAPTION").text();"[measures]"==a.toLowerCase()?g={hasChildren:!0,isSelected:!1,id:a,name:c,spriteCssClass:"[measures]"==a.toLowerCase()?"e-folderCDB e-icon":"e-dimensionCDB e-icon",tag:a}:!e(e(i).find("row")[0]).find("HIERARCHY_CAPTION").length>0&&(u={hasChildren:!0,isSelected:!1,id:a,name:c,spriteCssClass:"e-dimensionCDB e-icon",tag:a},t.pvtGridObj.schemaTreeView.push(u))}t.pvtGridObj.schemaTreeView.splice(0,0,g),h={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},!t.pvtGridObj.model.enableDrillThrough||t.pvtGridObj._schemaData!=r&&t.pvtGridObj._schemaData.model.olap.showNamedSets?(h.request="MDSCHEMA_SETS",t.pvtGridObj._getTreeData(h,t.pvtGridObj._loadNamedSetElements,t)):(h.request="MDSCHEMA_HIERARCHIES",t.pvtGridObj._fieldData.hierarchySuccess==r?t.pvtGridObj._getTreeData(h,t.pvtGridObj._loadHierarchyElements,t):t.pvtGridObj._loadHierarchyElements(t,t.pvtGridObj._fieldData.hierarchySuccess))},_loadNamedSetElements:function(t,i){var l,n;t.pvtGridObj._waitingPopup.show();var s={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},o=t.pvtGridObj.model.dataSource,a=e.map(o.rows,function(e){if(e.fieldName!=r)return e.fieldName});for(e.merge(a,e.map(o.columns,function(e){if(e.fieldName!=r)return e.fieldName})),e.merge(a,e.map(o.filters,function(e){if(e.fieldName!=r)return e.fieldName})),measureGroupItems=[],l=0;l<e(i).find("row").length;l++)n=e(e(i).find("row")[l]),e.inArray(n.find("DIMENSIONS").text().split(".")[0],measureGroupItems)>=0||(treeNodeElement={hasChildren:!0,isSelected:!1,pid:n.find("DIMENSIONS").text().split(".")[0],id:n.find("SET_DISPLAY_FOLDER").text()+"_"+n.find("DIMENSIONS").text().split(".")[0],name:n.find("SET_DISPLAY_FOLDER").text(),spriteCssClass:"e-folderCDB e-icon namedSets"},t.pvtGridObj.schemaTreeView.push(treeNodeElement),measureGroupItems.push(n.find("DIMENSIONS").text().split(".")[0])),treeNodeElement={hasChildren:!0,isSelected:e.inArray("["+e.trim(n.children("SET_NAME").text())+"]",a)>=0,pid:n.find("SET_DISPLAY_FOLDER").text()+"_"+n.find("DIMENSIONS").text().split(".")[0],id:"["+e.trim(n.children("SET_NAME").text()).replace(/\&/g,"&amp;")+"]",name:n.children("SET_CAPTION").text(),spriteCssClass:"e-namedSetCDB e-icon",tag:n.find("EXPRESSION").text()},t.pvtGridObj.schemaTreeView.push(treeNodeElement);s.request="MDSCHEMA_HIERARCHIES",t.pvtGridObj._fieldData.hierarchySuccess==r?t.pvtGridObj._getTreeData(s,t.pvtGridObj._loadHierarchyElements,t):t.pvtGridObj._loadHierarchyElements(t,t.pvtGridObj._fieldData.hierarchySuccess)},_loadHierarchyElements:function(t,i){var l,n;t.pvtGridObj._waitingPopup.show();var s={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},o=t.pvtGridObj.model.dataSource,a=e.map(o.rows,function(e){if(e.fieldName!=r)return e.fieldName});for(e.merge(a,e.map(o.columns,function(e){if(e.fieldName!=r)return e.fieldName})),e.merge(a,e.map(o.filters,function(e){if(e.fieldName!=r)return e.fieldName})),l={},"",n=0;n<e(i).find("row").length;n++){var d=e(e(i).find("row")[n]),h=d.find("DIMENSION_UNIQUE_NAME").text(),c=d.find("HIERARCHY_UNIQUE_NAME").text();e(t.pvtGridObj.schemaTreeView).filter(function(e,t){return t.tag==h}).map(function(e,t){return t}).length>0&&h!=c&&(l={hasChildren:!0,isSelected:e.inArray(c,a)>=0,pid:h,id:c,name:d.find("HIERARCHY_CAPTION").text(),spriteCssClass:"2"!=d.find("HIERARCHY_ORIGIN").text()&&"6"!=d.find("HIERARCHY_ORIGIN").text()?"e-hierarchyCDB e-icon":"e-attributeCDB e-icon",tag:c},t.pvtGridObj.schemaTreeView.push(l))}s.request="MDSCHEMA_LEVELS",t.pvtGridObj._getTreeData(s,t.pvtGridObj._loadLevelElements,t)},_loadLevelElements:function(i,r){var l;i.pvtGridObj._waitingPopup.show(),l=e.map(e(r).find("row"),function(t){if("1"!=parseInt(e(t).children("LEVEL_TYPE").text())&&"[measures]"!=e(t).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase())return treeNodeElement={hasChildren:!1,isChecked:!1,id:e(t).find("LEVEL_UNIQUE_NAME").text(),pid:e(t).find("HIERARCHY_UNIQUE_NAME").text(),name:e(t).find("LEVEL_CAPTION").text(),spriteCssClass:"level"+parseInt(e(t).children("LEVEL_NUMBER").text())+" e-icon",tag:e(t).find("LEVEL_UNIQUE_NAME").text()}}),e.merge(i.pvtGridObj.schemaTreeView,l),!i.pvtGridObj.model.enableDrillThrough&&i.pvtGridObj._fieldData.measureSuccess?i.pvtGridObj._fieldData.measureSuccess?i.pvtGridObj._loadMeasureElements(i,i.pvtGridObj._fieldData.measureSuccess):(r={catalog:i.pvtGridObj.model.dataSource.catalog,cube:i.pvtGridObj.model.dataSource.cube,url:i.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_MEASURES"},i.pvtGridObj._getTreeData(r,i.pvtGridObj._loadMeasureElements,i)):t.Pivot._createDrillThroughDialog(i.pvtGridObj,i.pvtGridObj.schemaTreeView)},_loadMeasureGroups:function(t,i){t.pvtGridObj._fieldData.measuresGroups=e(i).find("row")},_loadMeasureElements:function(t,i){var l,n,s,o,a={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},d=t.pvtGridObj.model.dataSource,h=e.map(d.values,function(e){if(e.measures!=r)return e.measures});for(this.reportItemNames=e.map(h,function(e){if(e.fieldName!=r)return e.fieldName}),l=[],"","en-US"!=t.pvtGridObj.model.locale&&(a={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_MEASUREGROUPS"},t.pvtGridObj._getTreeData(a,this._loadMeasureGroups,{pvtGridObj:this,action:"loadFieldElements"})),s=0;s<e(i).find("row").length;s++){var c=e(e(i).find("row")[s]),u=c.children("MEASUREGROUP_NAME").text(),g=c.find("MEASURE_UNIQUE_NAME").text();e.inArray(u,l)>=0||("en-US"!=t.pvtGridObj.model.locale?n=(o=e.map(t.pvtGridObj._fieldData.measuresGroups,function(t){if(e(t).children("MEASUREGROUP_NAME").text()==u)return e(t).children("MEASUREGROUP_CAPTION").text()})).length>0?o[0]:u:n=u,treeNodeElement={hasChildren:!0,isChecked:!1,pid:"[Measures]",id:u,name:n,spriteCssClass:"e-measureGroupCDB e-icon",tag:u},t.pvtGridObj.schemaTreeView.push(treeNodeElement),l.push(u)),treeNodeElement={hasChildren:!0,isSelected:e.inArray(g,this.reportItemNames)>=0,id:g,pid:u,name:c.children("MEASURE_CAPTION").text(),spriteCssClass:"measure",tag:g},t.pvtGridObj.schemaTreeView.push(treeNodeElement),e.inArray(g,t.pvtGridObj.reportItemNames)>=0&&t.pvtGridObj.reportItemNames.splice(t.pvtGridObj.reportItemNames.indexOf(g),1)}t.pvtGridObj._schemaData.model.olap.showKpi?(treeNodeElement={hasChildren:!0,isChecked:!1,id:"folderStruct",name:"KPI",spriteCssClass:"KPICDB e-folderCDB e-icon",tag:""},t.pvtGridObj.schemaTreeView.splice(1,0,treeNodeElement),a.request="MDSCHEMA_KPIS",t.pvtGridObj._getTreeData(a,t.pvtGridObj._loadKPIElements,t)):t.pvtGridObj._schemaData._createTreeView(this,t.pvtGridObj.schemaTreeView)},_loadKPIElements:function(t,i){t.pvtGridObj.model.dataSource;for(var r=this.reportItemNames,l=[],n=0;n<e(i).find("row").length;n++){var s=e(e(i).find("row")[n]),o=s.children("KPI_CAPTION").text(),a=s.children("KPI_goal").text(),d=s.children("KPI_STATUS").text(),h=s.children("KPI_TREND").text(),c=s.find("KPI_VALUE").text();e.inArray(s.children("KPI_NAME").text(),l)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"folderStruct",id:o,name:o,spriteCssClass:"e-measureGroupCDB e-icon",tag:o},t.pvtGridObj.schemaTreeView.push(treeNodeElement),l.push(o)),treeNodeElement={hasChildren:!0,isSelected:e.inArray(a,r)>=0,id:a,pid:o,name:t.pvtGridObj._getLocalizedLabels("Goal"),spriteCssClass:"kpiGoal e-icon",tag:a},t.pvtGridObj.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(d,r)>=0,id:d,pid:o,name:t.pvtGridObj._getLocalizedLabels("Status"),spriteCssClass:"kpiStatus e-icon",tag:d},t.pvtGridObj.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(h,r)>=0,id:h,pid:o,name:t.pvtGridObj._getLocalizedLabels("Trend"),spriteCssClass:"kpiTrend e-icon",tag:h},t.pvtGridObj.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(c,r)>=0,id:c,pid:o,name:t.pvtGridObj._getLocalizedLabels("Value"),spriteCssClass:"kpiValue e-icon",tag:c},t.pvtGridObj.schemaTreeView.push(treeNodeElement)}t.pvtGridObj._schemaData._createTreeView(this,t.pvtGridObj.schemaTreeView),delete t.pvtGridObj.reportItemNames,delete t.pvtGridObj.schemaTreeView},_getTreeData:function(e,i,r){var l=t.olap.base._getConnectionInfo(e.url),n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+e.request+"</RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+e.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.catalog+"</Catalog><LocaleIdentifier>"+l.LCID+"</LocaleIdentifier> </PropertyList></Properties></Discover></Body></Envelope>";this.doAjaxPost("POST",l.url,{XMLA:n},i,null,r)},_addHyperlink:function(i){if(e(".hyperlinkValueCell")[0]&&e(e(".hyperlinkValueCell")[0]).removeClass("hyperlinkValueCell"),e(".hyperlinkHeaderCell")[0]&&e(e(".hyperlinkHeaderCell")[0]).removeClass("hyperlinkHeaderCell"),""==e(i.target).text()||null==e(i.target).text())return!1;var r;"value"==i.target.parentElement.className.replace(/^\s+/,"").split(" ")[0]&&(this.enableValueCellHyperlink()||(t.isNullOrUndefined(this._pivotClientObj)?this.model.enableDrillThrough:this._pivotClientObj.model.enableDrillThrough))?e(i.target).addClass("hyperlinkValueCell"):e(i.target.parentElement).hasClass("summary value")&&this.enableSummaryCellHyperlink()?e(i.target).addClass("hyperlinkValueCell"):"rowheader"==i.target.parentElement.className.split(" ")[0]||this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&"rowheader"==e(i.target.parentElement).attr("role")?this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot||this.model.enableDeferUpdate||0!=e(this.element).parents(".e-pivotclient").length?this.enableRowHeaderHyperlink()&&e(i.target).addClass("hyperlinkHeaderCell"):e(i.target.parentElement).hasClass("rgtot")||(r=e(i.target.parentElement).attr("data-p").split(",")[0],this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&!t.isNullOrUndefined(JSON.parse(this.getOlapReport()).PivotRows[r])&&JSON.parse(this.getOlapReport()).PivotRows[r].EnableHyperlink?e(i.target).addClass("hyperlinkHeaderCell"):this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.dataSource.rows.length>0&&!t.isNullOrUndefined(this.model.dataSource.rows[r].enableHyperlink)&&this.model.dataSource.rows[r].enableHyperlink?e(i.target).addClass("hyperlinkHeaderCell"):this.enableRowHeaderHyperlink()&&e(i.target).addClass("hyperlinkHeaderCell")):("colheader"==i.target.parentElement.className.split(" ")[0]||this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&"columnheader"==e(i.target.parentElement).attr("role"))&&(this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot||this.model.enableDeferUpdate||0!=e(this.element).parents(".e-pivotclient").length?this.enableColumnHeaderHyperlink()&&e(i.target).addClass("hyperlinkHeaderCell"):e(i.target.parentElement).hasClass("calc")||e(i.target.parentElement).hasClass("cgtot")||e(i.target.parentElement).hasClass("gtot")||(r=e(i.target.parentElement).attr("data-p").split(",")[1],this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&!t.isNullOrUndefined(JSON.parse(this.getOlapReport()).PivotColumns[r])&&JSON.parse(this.getOlapReport()).PivotColumns[r].EnableHyperlink?e(i.target).addClass("hyperlinkHeaderCell"):this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&!t.isNullOrUndefined(this.model.dataSource.columns[r].enableHyperlink)&&this.model.dataSource.columns[r].enableHyperlink?e(i.target).addClass("hyperlinkHeaderCell"):this.enableColumnHeaderHyperlink()&&e(i.target).addClass("hyperlinkHeaderCell")))},_removeHyperlink:function(t){e(t.target).removeClass("hyperlinkValueCell").removeClass("hyperlinkHeaderCell")},_cellContext:function(i){var r=e(i.target).parents(".e-pivotgrid").data("ejPivotGrid"),l=(e(i.target).hasClass("cellValue")?e(i.target).parent()[0]:i.target)||(e(i.srcElement).hasClass("cellValue")?e(i.srcElement).parent()[0]:i.srcElement);if(!t.isNullOrUndefined(r)&&1==r.enableCellContext()&&e(l).parents("#"+r._id)[0]&&(n=e(l).attr("data-p"))){var n=null!=r._excelLikeJSONRecords&&r.model.layout.toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?e(l).attr("data-i"):e(l).attr("data-p"),s=null!=r._excelLikeJSONRecords&&r.model.layout.toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?r._excelLikeJSONRecords[parseInt(parseInt(n.split(",")[0])*r._excelRowCount+parseInt(n.split(",")[1]))].Info:r.getJSONRecords()[parseInt(parseInt(n.split(",")[0])*r._rowCount+parseInt(n.split(",")[1]))].Info,o={cellValue:l.innerHTML,cellPosition:n,cellType:""!=l.className.split(" ")[0]?l.className.split(" ")[0]:l.className.split(" ")[1],role:e(l).attr("role"),uniqueName:s.split("::")[0],args:i,rawdata:s};""!=o.cellType&&(t.isNullOrUndefined(r._pivotClientObj)?r._trigger("cellContext",{args:o}):r._pivotClientObj._trigger("cellContext",{args:o})),i.target?i.preventDefault():window.event.returnValue=!1}},_initCellSelection:function(i){var r,l;e("#"+this._id+" td,th").removeClass("e-highlighted"),this._on(this.element,"mouseup touchend",".value",this._completeCellSelection),this._oriX=i.pageX,this._oriY=i.pageY,r=i.target||window.event.srcElement,e(r).hasClass("cellValue")&&(r=r.parentElement),e(".value").addClass("selection"),e("#"+this._id).append(t.buildTag("div.e-cellSelection#"+this._id+"_cellSelection","",{})),this._startCellPosition=e(r)[0].attributes.getNamedItem("data-p").value,null!=this._excelLikeJSONRecords&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout&&(l=this._excelLikeJSONRecords[0*this._rowCount+parseInt(e(r)[0].attributes.getNamedItem("data-i").value.split(",")[1])].Index,this._startCellPosition=this.getJSONRecords()[parseInt(e(r)[0].attributes.getNamedItem("data-p").value.split(",")[0])*this._rowCount+parseInt(l.split(",")[1])].Index),this._on(this.element,"mousemove touchmove",".value, .e-cellSelection",this._cellSelection)},_headerClickCellSelection:function(i){var r,l,n,s=e(i.target).attr("class").indexOf("colheader")&&-1==e(i.target).attr("class").indexOf("rowheader")?-1!=e(i.target).attr("class").indexOf("cellValue")?e(i.target).parent():null:e(i.target);if(null!=s){var o,a,d;for(e("#"+this._id+" td,th").removeClass("e-highlighted"),d="columnheader"==(o=s.attr("role"))?s.attr("data-p").split(",")[0]:s.attr("data-p").split(",")[1],a="columnheader"==o?s.attr("colspan"):s.attr("rowspan"),null!=this._excelLikeJSONRecords&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout&&(r=parseInt(s.attr("data-p").split(",")[0])*this._rowCount+parseInt(s.attr("data-p").split(",")[1]),a="columnheader"==o?this._excelLikeJSONRecords[parseInt(s.attr("data-i").split(",")[0])*this._rowCount+parseInt(s.attr("data-i").split(",")[1])].ColSpan:this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&null!=this.getJSONRecords()[r+this._rowCount]&&-1==this.getJSONRecords()[r+this._rowCount].CSS.indexOf("value")?this.getJSONRecords()[r].RowSpan+1:this.getJSONRecords()[r].RowSpan),l=0;l<a;l++)"columnheader"==o?(e("#"+this._id+" [data-p^='"+(parseInt(l)+parseInt(d))+",']").addClass("e-highlighted"),e("#"+this._id+" [data-p^='"+(parseInt(l)+parseInt(d))+",'][role='columnheader']").each(function(t,i){(parseInt(i.attributes["data-p"].value.split(",")[1])<=parseInt(s.attr("data-p").split(",")[1])||parseInt(i.attributes.colspan.value)>parseInt(s.attr("colspan")))&&e(i).removeClass("e-highlighted")})):(e("#"+this._id+" [data-p$=',"+(parseInt(l)+parseInt(d))+"']").addClass("e-highlighted"),e("#"+this._id+" [data-p$=',"+(parseInt(l)+parseInt(d))+"'][role='rowheader']").each(function(t,i){(parseInt(i.attributes["data-p"].value.split(",")[0])<=parseInt(s.attr("data-p").split(",")[0])||parseInt(i.attributes.rowspan.value)>parseInt(s.attr("rowspan")))&&e(i).removeClass("e-highlighted")}));this._startCellPosition="columnheader"==o?e("#"+this._id+" [data-p^='"+(0+parseInt(d))+",'].value").eq(0).attr("data-p"):e("#"+this._id+" [data-p$=',"+(0+parseInt(d))+"'].value").eq(0).attr("data-p"),null==this._excelLikeJSONRecords||this.layout().toLowerCase()!=t.PivotGrid.Layout.ExcelLikeLayout||this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||(this._startCellPosition="columnheader"==o?e("#"+this._id+" [data-p^='"+(0+parseInt(d))+",'].value:not(.summary)").eq(0).attr("data-p"):e("#"+this._id+" [data-p$=',"+(0+parseInt(d))+"'].value:not(.summary)").eq(0).attr("data-p")),n="columnheader"==o?e("#"+this._id+" [data-p^='"+(parseInt(a)-1+parseInt(d))+",']").eq(e("#"+this._id+" [data-p^='"+(parseInt(a)-1+parseInt(d))+",']").length-1):e("#"+this._id+" [data-p$=',"+(parseInt(a)-1+parseInt(d))+"']").eq(e("#"+this._id+" [data-p$=',"+(parseInt(a)-1+parseInt(d))+"']").length-1),this._completeCellSelection(n)}},_cellSelection:function(i){e("#"+this._id+"_gridTooltip").hide();var r=e(i.target).parents(".e-pivotclient").length>0,l=i.pageX-this.element.offset().left-(this._oriX-this.element.offset().left),n=i.pageY-this.element.offset().top-(this._oriY-this.element.offset().top),s=this._oriX-this.element.offset().left,o=this._oriY-this.element.offset().top+3;l<0&&(s-=(l=Math.abs(l))-5),n<0&&(o-=(n=Math.abs(n))-12),i.pageX<this._oriX?e("#"+this._id+"_cellSelection").css({left:r?s:i.pageX+2,width:r?l:this._oriX-i.pageX}):e("#"+this._id+"_cellSelection").css({left:r?s:this._oriX-6,width:r?l:i.pageX-this._oriX}),i.pageY<this._oriY?e("#"+this._id+"_cellSelection").css({top:r?o:i.pageY,height:r?n:this._oriY-i.pageY-7}):e("#"+this._id+"_cellSelection").css({top:r?o:this._oriY+7,height:r?n:i.pageY-this._oriY-11}),e(".e-pivotGridTable").mouseleave(function(i){var r=e(i.target).parents(".e-pivotgrid").data("ejPivotGrid");t.isNullOrUndefined(i.toElement)||t.isNullOrUndefined(i.toElement.classList)||"e-pivotgrid"!=i.toElement.classList[0]||(e("#"+r._id+"_cellSelection").remove(),e(".value").removeClass("selection"),r._off(r.element,"mouseup mouseend",".value"))})},_completeCellSelection:function(i){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w=[],I=[],y=[];if(this._off(this.element,"mousemove touchmove",".value"),e(".value").removeClass("selection"),l=e(i).hasClass("value")?i:i.target||window.event.srcElement,e(l).hasClass("cellValue")&&(l=l.parentElement),null==e(l)[0].attributes.getNamedItem("data-p"))return!1;for(n=e(l)[0].attributes.getNamedItem("data-p").value,null==this._excelLikeJSONRecords||this.layout().toLowerCase()!=t.PivotGrid.Layout.ExcelLikeLayout||e(i).hasClass("value")||(a=this._excelLikeJSONRecords[0*this._rowCount+parseInt(e(l)[0].attributes.getNamedItem("i").value.split(",")[1])].Index,n=this.getJSONRecords()[parseInt(e(l)[0].attributes.getNamedItem("data-p").value.split(",")[0])*this._rowCount+parseInt(a.split(",")[1])].Index),d=0,h=parseInt(this._startCellPosition.split(",")[1])<parseInt(n.split(",")[1])?parseInt(this._startCellPosition.split(",")[1]):parseInt(n.split(",")[1]);h<=(parseInt(this._startCellPosition.split(",")[1])>parseInt(n.split(",")[1])?parseInt(this._startCellPosition.split(",")[1]):parseInt(n.split(",")[1]));h++)if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap||e("#"+this._id).find("td[data-p*=',"+h+"']").parent().is(":visible"))for(c=parseInt(this._startCellPosition.split(",")[0])<parseInt(n.split(",")[0])?parseInt(this._startCellPosition.split(",")[0]):parseInt(n.split(",")[0]);c<=(parseInt(this._startCellPosition.split(",")[0])>parseInt(n.split(",")[0])?parseInt(this._startCellPosition.split(",")[0]):parseInt(n.split(",")[0]));c++)if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap||e("#"+this._id).find("[data-p*='"+c+",']").last("th").is(":Visible")){w[d]=this.getJSONRecords()[c*this._rowCount+h];var T,L,R,O="",F=0,E=0;if((s=this.element.find(".summary[role!='gridcell'][data-p$=',"+h+"'] , .rowheader[role!='gridcell'][data-p$=',"+h+"']").last().attr("data-p"))==r&&(s=e("#"+this._id).find("tbody").find('[data-p="'+c+","+h+'"]').parent("tr").find(".summary").first().attr("data-p")),L=s,null!=s){for(;s[0]>=0;)s==this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))].Index&&(T=this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))].Value,this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(T=e("#"+this._id).find("td[data-p*='"+c+","+h+"']").prevAll("th").children(".e-expand").length>0?T.replace(this._getLocalizedLabels("Total"),""):T),s=parseInt(s.split(",")[0])-1+","+parseInt(s.split(",")[1])),O&&""!=T?O=T+"##"+O:""!=T&&(O=T);I[d]=O}for(u="",R=p=this.element.find('tr:has(".colheader")').length-1,(o=w[d].Index)!=r&&o==this.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*this._rowCount+parseInt(o.split(",")[1]))].Index&&(m=parseInt(o.split(",")[0])),_=0;_<=p;_++){if(null!=m&&m+","+_==this.getJSONRecords()[parseInt(parseInt(m)*this._rowCount+_)].Index){if(g=this.getJSONRecords()[parseInt(parseInt(m)*this._rowCount+_)].Value,this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)for(f=m;f>=0;f--)if(e("#"+this._id).find("th[data-p*='"+f+","+_+"']").length>0){g=e("#"+this._id).find("th[data-p*='"+f+","+_+"']").find(".e-expand").length>0?g.replace(this._getLocalizedLabels("Total"),""):g;break}""==u?u=g:""!=g&&(u=u+"##"+g)}y[d]=u}d++}if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap){for(b=this.getJSONRecords()[parseInt(parseInt(L.split(",")[0])*this._rowCount+parseInt(L.split(",")[1]))].Info;b[0]>=0;)((T=this.getJSONRecords()[parseInt(parseInt(b.split(",")[0])*this._rowCount+parseInt(b.split(",")[1]))].Info).split("::")[0].indexOf("Measures")>0||T.split("::")[0].indexOf("MEASURES")>0)&&F++,s=parseInt(s.split(",")[0])-1+","+parseInt(s.split(",")[1]);if(C=parseInt(o.split(",")[0]),0==F)for(S=0;S<=R;S++)null!=C&&(x=this.getJSONRecords()[parseInt(parseInt(C)*this._rowCount+S)].Info),(x.split("::")[0].indexOf("Measures")>0||x.split("::")[0].indexOf("MEASURES")>0)&&E++}else this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(this.getOlapReport()).PivotCalculations.length:this.model.dataSource.values.length;v={JSONRecords:w,rowHeader:I,columnHeader:y,measureCount:F>0?"Row:"+F:"Column:"+E},t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellSelection",v):this._pivotClientObj._trigger("cellSelection",v),w=I=y=[],e("#"+this._id+"_cellSelection").remove(),this._on(this.element,"mousemove touchmove",".value",this._applyToolTip),this._off(this.element,"mouseup touchend",".value")},exportPivotGrid:function(i,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S;if(this._rowCount=t.isNullOrUndefined(this._rowLength)?this._rowCount:this._rowLength,this._isExporting=!0,{},n="excel"==i.toLowerCase()||"excelexport"==i.toLowerCase()?{url:"",fileName:"PivotGrid",exportMode:t.PivotGrid.ExportMode.JSON,fileFormat:this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?".xls":".xlsx",title:"",description:"",exportType:i,controlName:this,exportWithStyle:!0,exportValueAsNumber:!1}:{url:"",fileName:"PivotGrid",exportMode:t.PivotGrid.ExportMode.JSON,fileFormat:"word"==i.toLowerCase()?".docx":".pdf",title:"",description:"",exportType:i,controlName:this,exportWithStyle:!0},this._trigger("beforeExport",n),s={rowCellColor:t.isNullOrUndefined(this.element.find(".rowheader"))?"":t.isNullOrUndefined(this.element.find(".rowheader").css("color"))?"rgb(51, 51, 51)":this.element.find(".rowheader").css("color"),rowCellBGColor:t.isNullOrUndefined(this.element.find(".rowheader"))?"":t.isNullOrUndefined(this.element.find(".rowheader").css("background-color"))?"rgb(255, 255, 255)":this.element.find(".rowheader").css("background-color"),columnCellColor:t.isNullOrUndefined(this.element.find(".colheader"))?"":t.isNullOrUndefined(this.element.find(".colheader").css("color"))?"rgb(51, 51, 51)":this.element.find(".colheader").css("color"),columnCellBGColor:t.isNullOrUndefined(this.element.find(".colheader"))?"":t.isNullOrUndefined(this.element.find(".colheader").css("background-color"))?"rgb(255, 255, 255)":this.element.find(".colheader").css("background-color"),valueCellColor:t.isNullOrUndefined(this.element.find(".value"))?"":t.isNullOrUndefined(this.element.find(".value").css("color"))?"rgb(51, 51, 51)":this._cFormat.length<=0?this.element.find(".value").css("color"):"rgb(51, 51, 51)",valueCellBGColor:t.isNullOrUndefined(this.element.find(".value"))?"":t.isNullOrUndefined(this.element.find(".value").css("background-color"))?"rgb(255, 255, 255)":this._cFormat.length<=0?this.element.find(".value").css("background-color"):"rgb(255, 255, 255)",summaryCellColor:t.isNullOrUndefined(this.element.find(".summary"))?"":t.isNullOrUndefined(this.element.find(".summary").css("color"))?"rgb(51, 51, 51)":this.element.find(".summary").css("color"),summaryCellBGColor:t.isNullOrUndefined(this.element.find(".summary"))?"":t.isNullOrUndefined(this.element.find(".summary").css("background-color"))?"rgb(255, 255, 255)":"rgba(0, 0, 0, 0)"==this.element.find(".summary").css("background-color")?"rgb(255, 255, 255)":this.element.find(".summary").css("background-color")},this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode||n.exportMode==t.PivotGrid.ExportMode.JSON){if(S={},this.model.enableCompleteDataExport&&(this.model.enablePaging||this.model.enableVirtualScrolling)){if(o={paging:this.model.enablePaging,vScrolling:this.model.enableVirtualScrolling},a=0,this.model.enablePaging=this.model.enableVirtualScrolling=!1,this._isExporting=!0,this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)for(this._fullExportedData.jsonObj=t.PivotAnalysis.pivotEnginePopulate(this.model).json,this._fullExportedData.rowCount=0,g=0;g<this._fullExportedData.jsonObj.length&&0==parseInt(this._fullExportedData.jsonObj[g].Index.split(",")[0]);g++)this._fullExportedData.rowCount++;else t.olap.base.getJSONData({action:"loadFieldElements"},this.model.dataSource,this);else{try{C=JSON.parse(this.getOlapReport()).Report}catch(e){C=this.getOlapReport()}this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"export",currentReport:C,gridLayout:this.layout(),enablePivotFieldList:this.model.enablePivotFieldList,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:JSON.stringify(this.model.customObject)}),function(e){if(this._fullExportedData.jsonObj=t.isNullOrUndefined(e[0])?t.isNullOrUndefined(e.d)?JSON.parse(e.JsonRecords):JSON.parse(e.d[0]):JSON.parse(e[0]),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){this._fullExportedData.rowCount=0;for(var i=0;i<this._fullExportedData.jsonObj.length&&0==parseInt(this._fullExportedData.jsonObj[i].Index.split(",")[0]);i++)this._fullExportedData.rowCount++}else this._fullExportedData.rowCount=t.isNullOrUndefined(e[1])?t.isNullOrUndefined(e.d)?JSON.parse(e.RowCount):JSON.parse(e.d[1]):JSON.parse(e[1])})}this.exportRecords=this._fullExportedData.jsonObj,a=this._fullExportedData.rowCount,S={args:JSON.stringify({pGridData:null!=this.exportRecords&&""!=this.exportRecords?this.exportRecords:null,rowCount:a,columnCount:null!=this.exportRecords?Math.floor(this.exportRecords.length/a):0,fileFormat:n.fileFormat+(".xls"==n.fileFormat||".xlsx"==n.fileFormat?"~"+n.exportValueAsNumber:""),fileName:t.isNullOrUndefined(l)?t.isNullOrUndefined(n.fileName)?"PivotGrid":n.fileName:l,colorSettings:s,Formatting:this._cFormat,title:n.title,description:n.description,language:this.model.locale,exportWithStyle:n.exportWithStyle,customObject:JSON.stringify(this.model.customObject)})},this.model.enablePaging=o.paging,this.model.enableVirtualScrolling=o.vScrolling,this._isExporting=!1}else{var x,v,w,I=0,y=!1,T=!1,L=0,R=0,O=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap,F=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.analysisMode!=t.Pivot.AnalysisMode.Olap,E=this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode,D=e.extend(!0,[],this.exportRecords),N=this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&JSON.parse(this.getOlapReport()).PivotRows.length>1;if(!(this.model.enableColumnGrandTotal&&this.model.enableGrandTotal&&this.model.enableRowGrandTotal||this.model.enableColumnGrandTotal&&this.model.enableGrandTotal)){if(!O||E)for(g=0;g<D.length;g++)("summary cgtot"==D[g].CSS||"summary gtot"==D[g].CSS&&0==D[g].Index.split(",")[1])&&D.splice(g);if(O)for(g=0;g<D.length;g++)0==D[g].Index.split(",")[1]&&"summary col"==D[g].CSS&&D.splice(g);R=this._rowCount}if(!(this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode!=t.PivotGrid.OperationalMode.ClientMode||this.model.enableRowGrandTotal&&this.model.enableGrandTotal||N)){for(d=this._rowCount-1,g=0;g<D.length;g++)D[g].Index.split(",")[1]==d&&(D=D.slice(0,g).concat(D.slice(g+1,D.length)));R=this._rowCount-1}if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&(JSON.parse(this.getOlapReport()).PivotRows.length>1||JSON.parse(this.getOlapReport()).PivotColumns.length>1)){if(!this.model.enableColumnGrandTotal||!this.model.enableGrandTotal)for(g=0;g<D.length;g++)0==D[g].Index.split(",")[1]&&"summary"==D[g].CSS&&D.splice(g);if(!this.model.enableRowGrandTotal||!this.model.enableGrandTotal)for(x=this.exportRecords.length/this._rowCount,g=0;g<D.length;g++)if(0==D[g].Index.split(",")[0]&&"summary"==D[g].CSS){for(h=g,c=this._rowCount-h,m=0;m<D.length;m++)D=D.slice(0,h).slice(0,this._rowCount+L).concat(D.slice(this._rowCount+I,D.length)),L=h-1,h=h+this.element.find("tr").length-c,I=L+1;break}R=c!=r?this.element.find("tr").length-c:this.element.find("tr").length}if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){if(F?(v=this.model.dataSource.rows,w=this.model.dataSource.columns):null!=this.getOlapReport()&&(v=JSON.parse(this.getOlapReport()).PivotRows,w=JSON.parse(this.getOlapReport()).PivotColumns),0==R&&(R=this._rowCount),x=D.length/R,v.length>1&&"excellikelayout"!=this.layout())for(p=0;p<v.length;p++)if(0==v[p].showSubTotal)for(y=!0,g=0;g<D.length;g++)if(D[g].Index.split(",")[0]==p&&"summary rstot"==D[g].CSS||"summary stot"==D[g].CSS)for(u=D[g].Index.split(",")[1],m=0;m<D.length;m++)D[m].Index.split(",")[1]==u&&(D=D.slice(0,m).concat(D.slice(m+1,D.length)),g=0);if(v.length>1&&1==y)for(R=D.length/x,x=D.length/R,p=0;p<x-1;p++)for(m=D[0].RowSpan;m<D.length;m++)if(D[m].Index.split(",")[0]==p&&("rowheader"==D[m].CSS||"summary rstot"==D[m].CSS||"summary stot"==D[m].CSS||"none"==D[m].CSS)&&1==D[m].Expander){var A=D[m].Index.split(",")[1],P=D[m].Index.split(",")[0],k=0;for(j=0;j<D[m].RowSpan;j++)parseInt(A)+D[m].RowSpan>D[m+j].Index.split(",")[1]&&P==D[m+j].Index.split(",")[0]&&k++;D[m].RowSpan=k}if(w.length>1&&"excellikelayout"!=this.layout())for(F&&(valuedata=this.model.dataSource.values),E&&(valuedata=JSON.parse(this.getOlapReport()).PivotCalculations),p=0;p<w.length;p++)if(0==w[p].showSubTotal)for(T=!0,g=0;g<D.length;g++)(D[g].Index.split(",")[1]==p&&"summary cstot"==D[g].CSS||"summary stot"==D[g].CSS)&&(D=D.slice(0,g-p).slice(0,g+R*valuedata.length-p).concat(D.slice(g+R*valuedata.length-p,D.length)));if(w.length>1&&1==T)for(x=D.length/R,p=0;p<D.length;p++)for(m=D[0].ColSpan;m<D.length;m++)if(D[m].Index.split(",")[0]==p&&("colheader"==D[m].CSS||"summary cstot"==D[m].CSS||"summary stot"==D[m].CSS||"none"==D[m].CSS)&&1==D[m].Expander){A=D[m].Index.split(",")[1],P=D[m].Index.split(",")[0];var M=0;for(j=0;j<D.length;j++)m+j<D.length&&parseInt(P)+D[m].ColSpan>D[m+j].Index.split(",")[0]&&A==D[m+j].Index.split(",")[1]&&(M++,j+=R-1);D[m].ColSpan=M}}_=D.length,S=0!=R?N?{args:JSON.stringify({pGridData:null!=D&&""!=D?D:null,rowCount:R,columnCount:JSON.parse(this.getOlapReport()).PivotRows.length>1&&!this.model.enableGrandTotal?_/R:this.model.enableColumnGrandTotal?t.isNullOrUndefined(x)?_/R:x:_/R,fileFormat:n.fileFormat+(".xls"==n.fileFormat||".xlsx"==n.fileFormat?"~"+n.exportValueAsNumber:""),fileName:t.isNullOrUndefined(l)?t.isNullOrUndefined(n.fileName)?"PivotGrid":n.fileName:l,colorSettings:s,Formatting:this._cFormat,title:n.title,description:n.description,language:this.model.locale,exportWithStyle:n.exportWithStyle,customObject:JSON.stringify(this.model.customObject)})}:{args:JSON.stringify({pGridData:null!=D&&""!=D?D:null,rowCount:R,columnCount:_/R,fileFormat:n.fileFormat+(".xls"==n.fileFormat||".xlsx"==n.fileFormat?"~"+n.exportValueAsNumber:""),fileName:t.isNullOrUndefined(l)?t.isNullOrUndefined(n.fileName)?"PivotGrid":n.fileName:l,colorSettings:s,Formatting:this._cFormat,title:n.title,description:n.description,language:this.model.locale,exportWithStyle:n.exportWithStyle,customObject:JSON.stringify(this.model.customObject)})}:{args:JSON.stringify({pGridData:null!=this.exportRecords&&""!=this.exportRecords?this.exportRecords:null,rowCount:null!=this._excelLikeJSONRecords?this._excelRowCount:this._rowCount,columnCount:null!=this._excelLikeJSONRecords?Math.floor(this._excelLikeJSONRecords.length/this._excelRowCount):null==this.getJSONRecords()||t.isNullOrUndefined(this._rowLength)?Math.floor(this.getJSONRecords().length/this._rowCount):_/this._rowLength,fileFormat:n.fileFormat+(".xls"==n.fileFormat||".xlsx"==n.fileFormat?"~"+n.exportValueAsNumber:""),fileName:t.isNullOrUndefined(l)?t.isNullOrUndefined(n.fileName)?"PivotGrid":n.fileName:l,colorSettings:s,Formatting:this._cFormat,title:n.title,description:n.description,language:this.model.locale,exportWithStyle:n.exportWithStyle,customObject:JSON.stringify(this.model.customObject)})}}!t.raiseWebFormsServerEvents||"excelExport"!=i&&"wordExport"!=i&&"pdfExport"!=i&&"csvExport"!=i||n.exportMode!=t.PivotGrid.ExportMode.JSON||""!=e.trim(n.url)?this.doPostBack(""!=e.trim(n.url)?n.url:i,S):(f={model:this.model,originalEventType:i},b=S,t.raiseWebFormsServerEvents(i,f,b),setTimeout(function(){t.isOnWebForms=!0},1e3))}else{try{C=JSON.parse(this.getOlapReport()).Report}catch(e){C=this.getOlapReport()}S={args:JSON.stringify({exportOption:i,fileFormat:n.fileFormat,currentReport:C,layout:this.layout(),colorSettings:s!=r?JSON.stringify(s):"",customObject:JSON.stringify(this.model.customObject),title:n.title,description:n.description,completeDataExport:this.model.enableCompleteDataExport,exportWithStyle:n.exportWithStyle})},this.doPostBack(""!=e.trim(n.url)?n.url:this.model.url+"/"+this.model.serviceMethodSettings.exportPivotGrid,S)}this._isExporting=!1},_createCalculatedField:function(){var i,r;t.Pivot.openPreventPanel(this),this.element.find(".calculatedFieldPopup",".e-clientDialog",".e-dialog").remove();var l=this._getLocalizedLabels("CalculatedField"),n=t.buildTag("label#"+this._id+"_lblCalFieldName",this._getLocalizedLabels("Name"))[0].outerHTML,s=t.buildTag("span.fieldDropDown",t.buildTag("input#"+this._id+"_calculateFieldList","",{},{type:"text"})[0].outerHTML+t.buildTag("input#"+this._id+"_calculateFieldName.calculateFieldName","",{"margin-left":this.model.enableRTL?"86px":"2px",outline:"none"},{type:"text"})[0].outerHTML,{})[0].outerHTML,o=t.buildTag("button#"+this._id+"_btnAdd",this._getLocalizedLabels("Add"),{},{name:this._getLocalizedLabels("Add")})[0].outerHTML,a=t.buildTag("label#"+this._id+"_lblCalFieldFormula",this._getLocalizedLabels("Formula"))[0].outerHTML,d=t.buildTag("input.calculatedFieldFormula#"+this._id+"_calculatedFieldFormula","",{width:"192px",height:"27px"},{type:"text",disabled:"disabled"})[0].outerHTML,h=t.buildTag("button#"+this._id+"_btnDelete",this._getLocalizedLabels("Delete"),{"margin-top":"-2px"},{name:this._getLocalizedLabels("Delete")})[0].outerHTML,c=t.buildTag("label#"+this._id+"_pivotGridValueFields",this._getLocalizedLabels("Fields"))[0].outerHTML,u=t.buildTag("ul#"+this._id+"_fieldCollection","")[0].outerHTML,g=t.buildTag("button.calculatorFields","",{"margin-left":this.model.enableRTL?"0px":"10px","margin-right":this.model.enableRTL?"10px":"0px"})[0].outerHTML,p=t.buildTag("span.editFormula e-icon e-cancel","",{padding:"3px","margin-left":"-54px","margin-right":this.model.enableRTL?"-54px":"0px",position:"relative"}).attr("aria-label","cancel")[0].outerHTML,m=t.buildTag("span",t.buildTag("button#"+this._id+"_btnInsert",this._getLocalizedLabels("InsertField"),{},{name:this._getLocalizedLabels("InsertField")})[0].outerHTML,{"margin-right":"150px","margin-left":"150px"})[0].outerHTML,_=t.buildTag("button#"+this._id+"_btnOk",this._getLocalizedLabels("OK"),{"margin-left":"10px"},{name:this._getLocalizedLabels("OK")})[0].outerHTML,f=t.buildTag("button#"+this._id+"_btnCancel",this._getLocalizedLabels("Cancel"),{"margin-left":this.model.enableRTL?"0px":"10px"},{name:this._getLocalizedLabels("Cancel")})[0].outerHTML,b=t.buildTag("div",_+f,{float:this.model.enableRTL?"left":"right","margin-bottom":"15px","margin-top":"4px"})[0].outerHTML,C=t.buildTag("div.e-calcFormulaDiv",t.buildTag("table",t.buildTag("tbody",t.buildTag("tr",t.buildTag("td","+")[0].outerHTML+t.buildTag("td","-")[0].outerHTML+t.buildTag("td","*")[0].outerHTML+t.buildTag("td","/")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","7")[0].outerHTML+t.buildTag("td","8")[0].outerHTML+t.buildTag("td","9")[0].outerHTML+t.buildTag("td","%")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","4")[0].outerHTML+t.buildTag("td","5")[0].outerHTML+t.buildTag("td","6")[0].outerHTML+t.buildTag("td","^")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","1")[0].outerHTML+t.buildTag("td","2")[0].outerHTML+t.buildTag("td","3")[0].outerHTML+t.buildTag("td","(")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td",".")[0].outerHTML+t.buildTag("td","0")[0].outerHTML+t.buildTag("td","C")[0].outerHTML+t.buildTag("td",")")[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML,{display:"none"})[0].outerHTML,S=t.buildTag("div#calculatedField.e-dlgCalculatedField",'<table class="outerTable"><tr><td>'+n+"</td><td>"+s+"</td><td>"+o+"</td></tr><tr><td>"+a+"</td><td>"+d+g+p+"</td><td>"+h+'</td></tr></table><p class="borderLine"></p><table class="e-fieldTable"><tr><td>'+c+"</td></tr><tr><td>"+u+"</td></tr><tr><td>"+m+"</td></tr></table>")[0].outerHTML,x=t.buildTag("div#clientDialog.e-clientDialog",S+b+C,{opacity:"1"}).attr("title",l)[0].outerHTML;e(x).appendTo("#"+this._id),this.element.find(".e-clientDialog").ejDialog({width:"auto",target:"#"+this._id,enableRTL:this.model.enableRTL,enableResize:!1,close:t.proxy(t.Pivot.closePreventPanel,this)}),e("#"+this._id+"_btnAdd,#"+this._id+"_btnDelete,#"+this._id+"_btnOk,#"+this._id+"_btnCancel").ejButton({type:t.ButtonType.Button,width:"80",enableRTL:this.model.enableRTL}),e("#"+this._id+"_btnInsert").ejButton({type:t.ButtonType.Button,enabled:!1,width:"100",enableRTL:this.model.enableRTL}),e(".calculatorFields").ejButton({type:t.ButtonType.Button,contentType:"imageonly",prefixIcon:"e-icon e-sigma",htmlAttributes:{title:"Click Me"},enableRTL:this.model.enableRTL}),e("#"+this._id+"_calculateFieldList").ejDropDownList({width:"230px",enableRTL:this.model.enableRTL,dataSource:this._calculatedField,fields:{text:"name",value:"name"},select:t.proxy(this._calculatedFieldListChange,this),create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),i=[],this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(JSON.parse(this.getOlapReport()).PivotCalculations).each(function(){8!=this.CalculationType&&"Formula"!=this.CalculationType&&i.push({fields:this.FieldName})}):e(e.grep(this.model.dataSource.values,function(e){return t.isNullOrUndefined(e.isCalculatedField)||0==e.isCalculatedField})).each(function(){i.push({fields:this.fieldName})}),r=e("#"+this._id+"_btnInsert").data("ejButton"),0==this._calculatedField.length&&(e("#"+this._id+"_btnOk").ejButton("disable"),e("#"+this._id+"_btnOk").attr("disabled","disabled")),e("#"+this._id+"_fieldCollection").ejListBox({dataSource:i,enableRTL:this.model.enableRTL,select:function(){r.enable()},height:"130",width:"400"}),r.disable(),this.element.find(".e-dialog .e-close").attr("title",this._getLocalizedLabels("Close")),e(".calculatorFields").click(function(){e("div.e-calcFormulaDiv").removeAttr("style")}),e(".editFormula").click(function(){var t=e(this).parents(".e-pivotgrid").data("ejPivotGrid"),i=e("#"+t._id+"_calculatedFieldFormula").val().lastIndexOf(" ");""!==e("#"+t._id+"_calculatedFieldFormula").val()&&i>0?i+1==e("#"+t._id+"_calculatedFieldFormula").val().length?e("#"+t._id+"_calculatedFieldFormula").val(e("#"+t._id+"_calculatedFieldFormula").val().substring(0,i-2)):e("#"+t._id+"_calculatedFieldFormula").val(e("#"+t._id+"_calculatedFieldFormula").val().substring(0,i)+" "):e("#"+t._id+"_calculatedFieldFormula").val("")}),null!=this.model.pivotEnginePopulated&&this._trigger("pivotEnginePopulated",{JSONRecords:jsonObj}),e(document).click(function(t){e(t.target).hasClass("calculatorFields")||e(t.target).hasClass("e-sigma")||e(t.target).parents(".e-calcFormulaDiv").length>0||e("div.e-calcFormulaDiv").css("display","none")}),e("div.e-calcFormulaDiv").on("click","td",function(){var t=e(this).parents(".e-pivotgrid").data("ejPivotGrid");"C"==this.textContent?e("#"+t._id+"_calculatedFieldFormula").val(""):e("#"+t._id+"_calculatedFieldFormula").val(e("#"+t._id+"_calculatedFieldFormula").val()+("+-/%^*".indexOf(this.textContent)>-1?" "+this.textContent+" ":this.textContent))}),e("#"+this._id+"_btnInsert").click(function(){var t=e(this).parents(".e-pivotgrid").data("ejPivotGrid"),i=e("#"+t._id+"_fieldCollection").data("ejListBox");e("#"+t._id+"_calculatedFieldFormula").val(e("#"+t._id+"_calculatedFieldFormula").val()+i.value())}),e("#"+this._id+"_btnAdd").click(function(){var i,r,l,n,s=e(this).parents(".e-pivotgrid").data("ejPivotGrid"),o=e("#"+s._id+"_calculatedFieldFormula").val().split(" "),a=-1;if(""!=e("#"+s._id+"_calculateFieldName").val()&&""!=e("#"+s._id+"_calculatedFieldFormula").val()){for(n=0;n<o.length;n++){if((a="+-/%^*".indexOf(o[n])>-1?n:-1)>-1&&o.length>0&&(""==o[0]||"."==o[0]||""==o[o.length-1]||"."==o[o.length-1]||""==o[a+1]||"."==o[a+1]))return void t.Pivot._createErrorDialog(s._getLocalizedLabels("NotValid"),s._getLocalizedLabels("Warning"),s);if(o[n].indexOf("(")==o[n].length-1||0==o[n].indexOf(")")||e("#"+s._id+"_calculatedFieldFormula").val().replace(/[^\(_]/g,"").length!=e("#"+s._id+"_calculatedFieldFormula").val().replace(/[^\)_]/g,"").length)return void t.Pivot._createErrorDialog(s._getLocalizedLabels("NotValid"),s._getLocalizedLabels("Warning"),s)}for(i=[],s.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(JSON.parse(s.getOlapReport()).PivotCalculations).each(function(){8!=this.CalculationType&&"Formula"!=this.CalculationType&&i.push({fields:this.FieldName})}):e(s.model.dataSource.values).each(function(){i.push({fields:this.fieldName})}),o=e("#"+s._id+"_calculatedFieldFormula").val().replace(/\(|\)/g," ").split(" "),n=0;n<o.length;n++){for(r=!1,l=0;l<i.length;l++)if(o[n].indexOf(i[l].fields)>-1&&o[n]!=i[l].fields)r=!0;else if(o[n]==i[l].fields){r=!1;break}if(r)return void t.Pivot._createErrorDialog(s._getLocalizedLabels("NotPresent"),s._getLocalizedLabels("Warning"),s)}for(n=0;n<s._calculatedField.length;n++)if(s._calculatedField[n].name==e("#"+s._id+"_calculateFieldName").val())return confirm(s._getLocalizedLabels("Confirm"))?(s._calculatedField[n].formula=e("#"+s._id+"_calculatedFieldFormula").val(),e("#"+s._id+"_calculatedFieldFormula").val(""),e("#"+s._id+"_calculateFieldName").val(""),void e("#"+s._id+"_calculateFieldList").ejDropDownList({dataSource:s._calculatedField,fields:{text:"name",value:"name"},enableRTL:s.model.enableRTL,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}})):void 0;s._calculatedField.push({name:e("#"+s._id+"_calculateFieldName").val(),formula:e("#"+s._id+"_calculatedFieldFormula").val()}),e("#"+s._id+"_calculatedFieldFormula").val(""),e("#"+s._id+"_calculateFieldName").val(""),e("#"+s._id+"_calculateFieldList").ejDropDownList({dataSource:s._calculatedField,fields:{text:"name",value:"name"},enableRTL:s.model.enableRTL,create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),s._calculatedField.length>0&&(e("#"+s._id+"_btnOk").ejButton("enable"),e("#"+s._id+"_btnOk").removeAttr("disabled"))}else t.Pivot._createErrorDialog(s._getLocalizedLabels("EmptyField"),s._getLocalizedLabels("Warning"),s)}),e("#"+this._id+"_btnDelete").click(function(){var i,r,l,n,s,o,a,d=e(this).parents(".e-pivotgrid").data("ejPivotGrid");if(0!=d._calculatedField.length){for(i=hederTag=e("#"+d._id+"_calculateFieldName").val(),s=0;s<d._calculatedField.length;s++)if(d._calculatedField[s].name==e("#"+d._id+"_calculateFieldName").val()){if(d.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)d.model.dataSource.values=e.grep(d.model.dataSource.values,function(e){return e.fieldCaption!=d._calculatedField[s].name}),d._calculatedField.splice(s,1),d._populatePivotGrid();else{for(d._calculatedField.splice(s,1),s=0;s<d._pivotTableFields.length;s++)d._pivotTableFields[s].name==i&&(d._pivotTableFields[s].isSelected=!1,headerTag=d._pivotTableFields[s],d._pivotTableFields.splice(s,1));try{r=JSON.parse(d.getOlapReport()).Report}catch(e){r=d.getOlapReport()}n="schemaRow::"+headerTag.id+"::FILTERED",null==d._schemaData&&(null!=d.model.beforeServiceInvoke&&d.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&d._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:d.element,customObject:d.model.customObject}),o=JSON.stringify(d.model.customObject),l=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(headerTag),dropAxis:"schemaValue::",sortedHeaders:d._ascdes,filterParams:n,currentReport:r,valueSorting:JSON.stringify(d.model.valueSortSettings),customObject:o}),d.model.enableDeferUpdate?d.doAjaxPost("POST",d.model.url+"/"+d.model.serviceMethodSettings.nodeStateModified,l.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),d._nodeStateModifiedSuccess):d.doAjaxPost("POST",d.model.url+"/"+d.model.serviceMethodSettings.nodeStateModified,l,d._nodeStateModifiedSuccess))}null!=d._schemaData&&(a=d._schemaData._tableTreeObj.element.find("li[id='"+i+"']"),d._schemaData._tableTreeObj.uncheckNode(a),d._schemaData._tableTreeObj.model.beforeDelete=null,d._schemaData._tableTreeObj.removeNode(a),d._schemaData._tableTreeObj.model.beforeDelete=function(){return!1})}else if(s==d._calculatedField.length-1)return void t.Pivot._createErrorDialog(d._getLocalizedLabels("CalculatedFieldNameNotFound"),d._getLocalizedLabels("Warning"),d)}else t.Pivot._createErrorDialog(d._getLocalizedLabels("CalculatedFieldNameNotFound"),d._getLocalizedLabels("Warning"),d)}),e("#"+this._id+"_btnOk").click(function(){var i,r,l,n,s,o,a,d=e(this).parents(".e-pivotgrid").data("ejPivotGrid");for(d.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&(d.model.dataSource.values=e.grep(d.model.dataSource.values,function(e){return t.isNullOrUndefined(e.isCalculatedField)||0==e.isCalculatedField})),i=0;i<d._calculatedField.length;i++){for(r=d._calculatedField[i].formula.replace(/\(|\)/g," ").replace(/[-+*/^%]/g," ").split(" "),l=0;l<r.length;l++)if(!e.isNumeric(r[l])&&""!=r[l].replace(/\s+|\s+$/gm,"")&&0==(d.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e.grep(JSON.parse(d.getOlapReport()).PivotCalculations,function(e){return e.FieldName==r[l]}).length:e.grep(d.model.dataSource.values,function(e){return e.fieldName==r[l]}).length))return void t.Pivot._createErrorDialog(d._getLocalizedLabels("NotPresent"),d._getLocalizedLabels("Warning"),d);n=d._calculatedField[i].formula.replace(/\s+|\s+$/gm,""),n=d._parenthesisAsterisk(n),d.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode&&0==e.grep(d.model.dataSource.values,function(e){return e.fieldName==d._calculatedField[i].name&&(e.formula=d._calculatedField[i].formula),e.fieldName==d._calculatedField[i].name}).length&&(d.model.dataSource.values.push({fieldName:d._calculatedField[i].name,fieldCaption:d._calculatedField[i].name,isCalculatedField:!0,formula:n,format:d._calculatedField[i].format,formatString:d._calculatedField[i].formatString}),null!=d._schemaData&&d._schemaData._tableTreeObj.element.find("li[id='"+d._calculatedField[i].name+"']").find(".e-chk-inact").length>0&&d._schemaData._tableTreeObj.checkNode(d._calculatedField[i].name))}if(d.element.find(".e-dialog, .e-clientDialog").remove(),t.Pivot.closePreventPanel(d),d.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode)d._populatePivotGrid();else{t.isNullOrUndefined(d._waitingPopup)||d._waitingPopup.show();try{s=JSON.parse(d.getOlapReport()).Report}catch(e){s=d.getOlapReport()}null!=d.model.beforeServiceInvoke&&d._trigger("beforeServiceInvoke",{action:"calculatedField",element:d.element,customObject:d.model.customObject}),o=JSON.stringify(d.model.customObject),a=JSON.stringify({action:"calculatedField",headerTag:JSON.stringify(d._calculatedField),currentReport:s,valueSorting:JSON.stringify(d.model.valueSortSettings),customObject:o}),d.model.enableDeferUpdate?(t.isNullOrUndefined(d._waitingPopup)||d._waitingPopup.hide(),d.doAjaxPost("POST",d.model.url+"/"+d.model.serviceMethodSettings.calculatedField,a.replace("calculatedField","calculatedFieldDeferUpdate"),null==d._schemaData?d._renderControlSuccess:d._schemaCalculatedField)):d.doAjaxPost("POST",d.model.url+"/"+d.model.serviceMethodSettings.calculatedField,a,null==d._schemaData?d._renderControlSuccess:d._schemaCalculatedField)}}),e("#"+this._id+"_btnCancel").click(function(){var i=e(this).parents(".e-pivotgrid").data("ejPivotGrid");i.element.find(".e-dialog, .e-clientDialog").remove(),t.Pivot.closePreventPanel(i)}),this._curFocus.field=this.element.find(".e-dialog .calculateFieldName").attr("tabindex","-1")},_schemaCalculatedField:function(i){var r,l,n;for(this._schemaData._tableTreeObj.model.nodeCheck=null,this._schemaData._tableTreeObj.model.nodeUncheck=null,n=0;n<this._calculatedField.length;n++)r=this._schemaData.element.find(".e-schemaFieldTree").data("ejTreeView"),0==this._schemaData._tableTreeObj.element.find("li[id='"+this._calculatedField[n].name+"']").length?(l=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?{id:this._calculatedField[n].name,name:this._calculatedField[n].name,caption:this._calculatedField[n].name,isSelected:!0,spriteCssClass:""}:{id:this._calculatedField[n].name,name:this._calculatedField[n].name,isSelected:!0,calculationType:8,formula:this._calculatedField[n].formula,summaryType:6,format:null,allowRunTimeGroupByField:"false",pivotType:"PivotComputationInfo",spriteCssClass:""},this._pivotTableFields.push(l),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&(this._pivotTableFields=t.PivotAnalysis.getTreeViewData(this.model.dataSource)),this._schemaData._setTableFields(this._pivotTableFields),r.addNode(l),this._schemaData._tableTreeObj.element.find(".e-item").css("padding","0px")):this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&null!=this._schemaData&&this._schemaData._tableTreeObj.element.find("li[id='"+this._calculatedField[n].name+"']").find(".e-chk-inact").length>0?this._schemaData._tableTreeObj.checkNode(this._calculatedField[n].name):this._schemaData._tableTreeObj.element.find("li[id='"+this._calculatedField[n].name+"']").removeClass("filter").find(".treeDrop , .filter").remove();if(this._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style"),this._schemaData._tableTreeObj.model.nodeCheck=this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.proxy(this._schemaData._checkedStateModified,this._schemaData):t.proxy(this._schemaData._pivotCheckedStateModified,this._schemaData),this._schemaData._tableTreeObj.model.nodeUncheck=this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.proxy(this._schemaData._checkedStateModified,this._schemaData):t.proxy(this._schemaData._pivotCheckedStateModified,this._schemaData),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&(this.model.enableDeferUpdate?(this._isUpdateRequired=!0,this._deferUpdateSuccess(i)):this._renderControlSuccess(i)),e(this._schemaData.element.find(".e-schemaValue .e-pivotButton")).each(function(){e(this).remove()}),t.isNullOrUndefined(this._pivotClientObj)||void 0===this._pivotClientObj._pivotSchemaDesigner)if(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)for(report=JSON.parse(this.getOlapReport()),n=0;n<report.PivotCalculations.length;n++)this._schemaData._createPivotButton({fieldName:report.PivotCalculations[n].FieldName,fieldCaption:report.PivotCalculations[n].FieldHeader},"value","","","");else for(n=0;n<this.model.dataSource.values.length;n++)this._schemaData._createPivotButton({fieldName:this.model.dataSource.values[n].fieldName,fieldCaption:this.model.dataSource.values[n].fieldCaption},"value","","","");else this._schemaData._refreshPivotButtons();this._schemaData._setPivotBtnWidth()},_calculatedFieldListChange:function(t){e("#"+this._id+"_calculateFieldName").val(t.selectedText);for(var i=0;i<this._calculatedField.length;i++)this._calculatedField[i].name==t.selectedText&&e("#"+this._id+"_calculatedFieldFormula").val(this._calculatedField[i].formula)},_parenthesisAsterisk:function(e){for(var t=1;t<e.length-1;t++)"("==e[t]&&-1=="+-/%^*(".indexOf(e[t-1])&&(e=e.substring(0,t)+"*"+e.substring(t),t--),")"==e[t]&&-1=="+-/%^*)".indexOf(e[t+1])&&(e=e.substring(0,t+1)+"*"+e.substring(t+1),t--);return e},_calcFieldNodeDrop:function(t){for(var i=e.grep(this.model.dataSource.values,function(e){return 1==e.isCalculatedField&&e.formula.indexOf(t.fieldName)>-1}),r=0;r<i.length;r++)this._schemaData._tableTreeObj.uncheckNode(i[r].fieldName)},_schemaButtonCreate:function(){if(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){e(this._schemaData.element.find(".e-schemaValue .e-pivotButton")).each(function(){e(this).remove()}),report=JSON.parse(this.getOlapReport());for(var i=0;i<report.PivotCalculations.length;i++)this._schemaData._createPivotButton({fieldName:report.PivotCalculations[i].FieldName,fieldCaption:report.PivotCalculations[i].FieldHeader},"value","","","")}this._schemaData._setPivotBtnWidth()},_calculatedFieldNodeRemove:function(i){for(var r=e.grep(JSON.parse(this.getOlapReport()).PivotCalculations,function(e){return 8==e.CalculationType&&e.Formula.indexOf(i.id)>-1}),l=0;l<r.length;l++)this._schemaData._tableTreeObj.model.nodeUncheck=null,this._schemaData._tableTreeObj.uncheckNode(r[l].FieldName),this._schemaData._tableTreeObj.element.find("li[id='"+r[l].FieldName+"']").removeClass("filter").find(".treeDrop").remove(),this._schemaData._tableTreeObj.model.nodeUncheck=t.proxy(this._schemaData._checkedStateModified,this._schemaData)},createConditionalDialog:function(){this.openConditionalFormattingDialog()},openConditionalFormattingDialog:function(){var i,l,n,s,o,a,d,h;if(!this.model.enableConditionalFormatting)return!1;t.Pivot.openPreventPanel(this),this.element.find(".e-dialog").remove(),i=t.buildTag("div#"+this._id+"_clientDlg.clientDialog",{opacity:"1"})[0].outerHTML,n=this._getLocalizedLabels("ConditionalFormatting");var c=t.buildTag("label#"+this._id+"_conLbl.e-conditionLbl",this._getLocalizedLabels("Condition"))[0].outerHTML,u=t.buildTag("input#"+this._id+"_conType.conditionType","",{},{type:"text",tabindex:0,accesskey:"f"})[0].outerHTML,g=t.buildTag("label#"+this._id+"_editcond.e-editcondition",this._getLocalizedLabels("FormatName"))[0].outerHTML,p=t.buildTag("label#"+this._id+"_value1.value1",this._getLocalizedLabels("Value1"))[0].outerHTML,m=t.buildTag("label#"+this._id+"_value2.e-value2",this._getLocalizedLabels("Value2"))[0].outerHTML,_=t.buildTag("label#"+this._id+"_backcolorLbl.backcolorLbl",this._getLocalizedLabels("Backcolor"))[0].outerHTML,f=t.buildTag("label#"+this._id+"_bordercolorLbl.bordercolorLbl",this._getLocalizedLabels("Bordercolor"))[0].outerHTML,b=t.buildTag("label#"+this._id+"_borderrangeLbl.e-borderrangeLbl",this._getLocalizedLabels("Borderrange"))[0].outerHTML,C=t.buildTag("label#"+this._id+"_borderstyleLbl.e-borderstyleLbl",this._getLocalizedLabels("Borderstyle"))[0].outerHTML,S=t.buildTag("label#"+this._id+"_fStyleLbl.fStyleLbl",this._getLocalizedLabels("Fontstyle"))[0].outerHTML,x=t.buildTag("label#"+this._id+"_fSizeLbl.e-fSizeLbl",this._getLocalizedLabels("Fontsize"))[0].outerHTML,v=t.buildTag("label#"+this._id+"_fontcolorLbl.fontcolorLbl",this._getLocalizedLabels("Fontcolor"))[0].outerHTML,w=t.buildTag("label#"+this._id+"_fValueLbl.fValueLbl",this._getLocalizedLabels("Measures"))[0].outerHTML,I=t.buildTag("input#"+this._id+"_editCon.editconditionDropDown","",{},{type:"text",tabindex:1,accesskey:"e"})[0].outerHTML,y=t.buildTag("input#"+this._id+"_editConText.editconditionText","",{},{type:"text",tabindex:1,accesskey:"e"})[0].outerHTML,T=t.buildTag("button#"+this._id+"_editBtn",this._getLocalizedLabels("Edit"),{},{name:this._getLocalizedLabels("Edit")}).attr("title",this._getLocalizedLabels("Edit")).attr("role","button").attr("aria-label","edit")[0].outerHTML,L=t.buildTag("button#"+this._id+"_removeBtn.e-dialogremoveBtn e-icon","",{},{name:this._getLocalizedLabels("Remove")}).attr("title",this._getLocalizedLabels("RemoveFormat")).attr("role","button").attr("aria-label","remove")[0].outerHTML,R=t.buildTag("input#"+this._id+"_conFrom.e-conditionFrom"+(t.isMobile()?" inputConditionMbl":""),"",{},{name:"inputVal",type:t.isMobile()?"number":"text",inputmode:t.isMobile()?"numeric":"",pattern:t.isMobile()?"[0-9]*":"",tabindex:2})[0].outerHTML,O=t.buildTag("input#"+this._id+"_conTo.e-conditionTo"+(t.isMobile()?" inputConditionMbl":""),"",{},{name:"inputVal",type:t.isMobile()?"number":"text",inputmode:t.isMobile()?"numeric":"",pattern:t.isMobile()?"[0-9]*":"",tabindex:3})[0].outerHTML,F=t.buildTag("input#"+this._id+"_backcolor.backcolor","",{},{type:"text",tabindex:4,accesskey:"d"})[0].outerHTML,E=t.buildTag("input#"+this._id+"_bordercolor.bordercolor","",{},{type:"text",tabindex:5,accesskey:"c"})[0].outerHTML,D=t.buildTag("input#"+this._id+"_borderrange.borderrange","",{},{type:"text",tabindex:6,accesskey:"r"})[0].outerHTML,N=t.buildTag("input#"+this._id+"_borderstyle.borderstyle","",{},{type:"text",tabindex:7,accesskey:"s"})[0].outerHTML,A=t.buildTag("input#"+this._id+"_fStyle.fStyle","",{},{type:"text",tabindex:8,accesskey:"o"})[0].outerHTML,P=t.buildTag("input#"+this._id+"_fSize.fSize","",{},{type:"text",tabindex:9,accesskey:"l"})[0].outerHTML,k=t.buildTag("input#"+this._id+"_fontcolor.fontcolor","",{},{type:"text",tabindex:10,accesskey:"b"})[0].outerHTML,j=t.buildTag("input#"+this._id+"_fValue.fValue","",{},{type:"text",tabindex:11,accesskey:"v"})[0].outerHTML;l=t.buildTag("div#"+this._id+"_conditionDlg.e-conditionDlg","<table class='conditionformatTbl'><tr><td>"+c+"</td><td>"+u+"</td><td>"+g+"</td><td>"+(this.model.conditionalFormatSettings.length>0?I:y)+"</td><td>"+T+"</td><td>"+L+"</td></tr><tr><td>"+p+"</td><td>"+R+"</td><td>"+m+"</td><td>"+O+"</td></tr><tr><td>"+S+"</td><td>"+A+"</td><td>"+b+"</td><td>"+D+"</td></tr><tr><td>"+v+"</td><td>"+k+"</td><td>"+C+"</td><td>"+N+"</td></tr><tr><td>"+_+"</td><td>"+F+"</td><td>"+x+"</td><td>"+P+"</td></tr><tr><td>"+f+"</td><td>"+E+"</td><td>"+w+"</td><td>"+j+"</td></tr></table>")[0].outerHTML;var M=t.buildTag("button#"+this._id+"_OKBtn.e-dialogOKBtn","",{},{name:this._getLocalizedLabels("OK")}).attr("title",this._getLocalizedLabels("OK"))[0].outerHTML,V=t.buildTag("button#"+this._id+"_CancelBtn.e-dialogCancelBtn","",{},{name:this._getLocalizedLabels("Cancel")}).attr("title",this._getLocalizedLabels("Cancel"))[0].outerHTML,B=t.buildTag("div",M+V,{float:this.model.enableRTL?"left":"right",margin:"20px 0px 6px"})[0].outerHTML;e("#"+this._id).after(i),e("#"+this._id+"_clientDlg").append(l+B),a=e(this.element).parents(".e-pivotclient").length>0?this.element.parents(".e-pivotclient")[0].id:this._id,e("#"+this._id+"_clientDlg").ejDialog({width:"auto",target:"#"+a,enableResize:!1,enableRTL:this.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,this)}),e(".e-titlebar").prepend(t.buildTag("div",n,{display:"inline"})[0].outerHTML)[0],e("#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn,#"+this._id+"_removeBtn,#"+this._id+"_editBtn").ejButton({type:t.ButtonType.Button}),e("#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn").css({margin:"0 0 0 10px",width:"67px"}),e("#"+this._id+"_removeBtn").css({margin:this.model.enableRTL?"0px":"0 0 0 10px",width:"38px",height:"29px"}),e("#"+this._id+"_editBtn").css({margin:"0 0 0 10px",width:"70px",height:"29px"}),e("#"+this._id+"_conFrom,#"+this._id+"_conTo").css({width:"196px",height:"26px"}),e("#"+this._id+"_conditionDlg").css({margin:"13px 0 0 0"}),e("#"+this._id+"_editcond,#"+this._id+"_value2,#"+this._id+"_fValueLbl,#"+this._id+"_borderrangeLbl,#"+this._id+"_borderstyleLbl,#"+this._id+"_fSizeLbl").css({margin:"0 0 0 15px"}),e("#"+this._id+"_editConText").length>0&&(this._formatEdit=!0),e("#"+this._id+"_editConText").ejMaskEdit({inputMode:t.InputMode.Text,width:"200px",height:"26px"}),e("#"+this._id+"_conTo").attr("disabled","disabled"),this.removeBtn=e("#"+this._id+"_removeBtn").data("ejButton"),s=e("#"+this._id+"_OKBtn").data("ejButton"),o=e("#"+this._id+"_CancelBtn").data("ejButton"),T=e("#"+this._id+"_editBtn").data("ejButton"),this.removeBtn.setModel({enabled:!1}),s.setModel({text:this._getLocalizedLabels("OK")}),o.setModel({text:this._getLocalizedLabels("Cancel")}),e("#"+this._id+"_conType").ejDropDownList({change:"_activeConditionChange",dataSource:[{option:"Less Than",value:this._getLocalizedLabels("LessThan")},{option:"Less Than Or Equal To",value:this._getLocalizedLabels("LessThanOrEqualTo")},{option:"Greater Than",value:this._getLocalizedLabels("GreaterThan")},{option:"Greater Than Or Equal To",value:this._getLocalizedLabels("GreaterThanOrEqualTo")},{option:"Equals",value:this._getLocalizedLabels("Equals")},{option:"Not Equals",value:this._getLocalizedLabels("NotEquals")},{option:"Between",value:this._getLocalizedLabels("Between")},{option:"Not Between",value:this._getLocalizedLabels("NotBetween")}],fields:{text:"value",value:"option"},selectedIndices:[0],enableRTL:this.model.enableRTL,width:"200px",height:"30px",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#"+this._id+"_editCon").ejDropDownList({change:"_editConditionChange",dataSource:this._formatName,selectedIndices:[0],enableRTL:this.model.enableRTL,width:"200px",height:"30px",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#"+this._id+"_fontcolor").ejColorPicker({enableRTL:this.model.enableRTL}),e("#"+this._id+"_backcolor").ejColorPicker({enableRTL:this.model.enableRTL}),e("#"+this._id+"_bordercolor").ejColorPicker({enableRTL:this.model.enableRTL}),e("#"+this._id+"_borderrange").ejDropDownList({dataSource:["1","2","3","4","5","6","7","8","9"],selectedIndices:[0],enableRTL:this.model.enableRTL,width:"200px",height:"30px",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#"+this._id+"_borderstyle").ejDropDownList({dataSource:[{option:"Solid",value:this._getLocalizedLabels("Solid")},{option:"Dashed",value:this._getLocalizedLabels("Dashed")},{option:"Dotted",value:this._getLocalizedLabels("Dotted")},{option:"Double",value:this._getLocalizedLabels("Double")},{option:"Groove",value:this._getLocalizedLabels("Groove")},{option:"Inset",value:this._getLocalizedLabels("Inset")},{option:"Outset",value:this._getLocalizedLabels("Outset")},{option:"Ridge",value:this._getLocalizedLabels("Ridge")},{option:"None",value:this._getLocalizedLabels("None")}],fields:{text:"value",value:"option"},selectedIndices:[0],enableRTL:this.model.enableRTL,width:"200px",height:"30px",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#"+this._id+"_fStyle").ejDropDownList({dataSource:[{option:"Algerian",value:this._getLocalizedLabels("Algerian")},{option:"Arial",value:this._getLocalizedLabels("Arial")},{option:"Bodoni MT",value:this._getLocalizedLabels("BodoniMT")},{option:"Britannic Bold",value:this._getLocalizedLabels("BritannicBold")},{option:"Cambria",value:this._getLocalizedLabels("Cambria")},{option:"Calibri",value:this._getLocalizedLabels("Calibri")},{option:"Courier New",value:this._getLocalizedLabels("CourierNew")},{option:"DejaVu Sans",value:this._getLocalizedLabels("DejaVuSans")},{option:"Forte",value:this._getLocalizedLabels("Forte")},{option:"Gerogia",value:this._getLocalizedLabels("Gerogia")},{option:"Impact",value:this._getLocalizedLabels("Impact")},{option:"Segoe UI",value:this._getLocalizedLabels("SegoeUI")},{option:"Tahoma",value:this._getLocalizedLabels("Tahoma")},{option:"Times New Roman",value:this._getLocalizedLabels("TimesNewRoman")},{option:"Verdana",value:this._getLocalizedLabels("Verdana")},{option:"None",value:this._getLocalizedLabels("None")}],fields:{text:"value",value:"option"},selectedIndices:[0],enableRTL:this.model.enableRTL,width:"200px",height:"30px",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#"+this._id+"_fSize").ejDropDownList({dataSource:["12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],selectedIndices:[0],enableRTL:this.model.enableRTL,width:"200px",height:"30px",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}});var H,X=[],U=[];if(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){if(e(this.element).parents(".e-pivotclient").length>0)if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap)for(d=0;d<this._JSONRecords.length;d++)this._JSONRecords[d].Info.indexOf("Measures")>-1&&-1==e.inArray(this._JSONRecords[d].Value,U)&&U.push(this._JSONRecords[d].Value);else U=JSON.parse(this._pivotClientObj.getOlapReport()).PivotCalculations;else U=JSON.parse(this.getOlapReport()).PivotCalculations;H="FieldHeader"}else if(H="fieldCaption",this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)U=this.model.dataSource.values;else for(d=0;d<this.model.dataSource.values.length;d++)U=this.model.dataSource.values[d].measures;for(X=U.length>0?["All"]:X,h=0;h<U.length;h++)e(this.element).parents(".e-pivotclient").length>0&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap?X.push(U[h]):X.push(U[h][H]);return X=X.length>0?X:["No Measure"],e("#"+this._id+"_fValue").ejDropDownList({dataSource:X,selectedIndices:[0],enableRTL:this.model.enableRTL,width:"200px",height:"30px",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),e("#"+this._id+"_conType").ejDropDownList("option","change",t.proxy(this._activeConditionChange,this)),e("#"+this._id+"_editCon").ejDropDownList("option","change",t.proxy(this._editConditionChange,this)),this.isNewFormat=!0,this.ddlEditCondition=e("#"+this._id+"_editCon").data("ejDropDownList"),this.ddlConditionType=e("#"+this._id+"_conType").data("ejDropDownList"),this.ddlFont=e("#"+this._id+"_fStyle").data("ejDropDownList"),this.ddlFontSize=e("#"+this._id+"_fSize").data("ejDropDownList"),this.ddlFontColor=e("#"+this._id+"_fontcolor").data("ejColorPicker"),this.ddlBackColor=e("#"+this._id+"_backcolor").data("ejColorPicker"),this.ddlBorderColor=e("#"+this._id+"_bordercolor").data("ejColorPicker"),this.ddlBorderStyle=e("#"+this._id+"_borderstyle").data("ejDropDownList"),this.ddlBorderWidth=e("#"+this._id+"_borderrange").data("ejDropDownList"),this.ddlFieldValue=e("#"+this._id+"_fValue").data("ejDropDownList"),this.element.find("#"+this._id+"_conFrom,#"+this._id+"_conTo").keypress(function(t){return 8==t.which||0==t.which||!(t.which<45||45==t.which&&(""!=t.target.value||t.target.value.indexOf("-")>-1)||t.which>58)&&((46!=t.which||-1==e(this).val().indexOf("."))&&47!=t.which&&void 0)}),e("#"+this._id+"_OKBtn").click(function(){var i,l,n=null,s=!1;if(n=e(this).parents(".e-pivotclient").length>0?e(this).parents(".e-pivotclient").find(".e-pivotgrid").data("ejPivotGrid"):e(this).parents(".e-pivotgrid").data("ejPivotGrid"),!t.isNullOrUndefined(n.ddlEditCondition))for(i=0;i<n.ddlEditCondition.model.dataSource.length;i++)n.ddlEditCondition.model.dataSource[i]==e("#"+n._id+"_editConText").val()&&i!=n.ddlEditCondition.selectedIndexValue&&(s=!0);this.ddlEditCondition=e("#"+n._id+"_editCon").data("ejDropDownList"),l=e(this).parents(".e-pivotclient").length>0?e(this).parents(".e-pivotclient").data("ejPivotClient"):n,""==e("#"+n._id+"_editConText").val()?t.Pivot._createErrorDialog(n._getLocalizedLabels("EnterFormatName"),n._getLocalizedLabels("Warning"),l):n._formatEdit&&e("#"+n._id+"_editConText").val()!=r&&-1!=e.inArray(e("#"+n._id+"_editConText").val(),n._formatName)||!t.isNullOrUndefined(e("#"+n._id+"_editConText").val())&&s?t.Pivot._createErrorDialog(n._getLocalizedLabels("DuplicateFormatName"),n._getLocalizedLabels("Warning"),l):""==e("#"+n._id+"_conFrom").val()?t.Pivot._createErrorDialog(n._getLocalizedLabels("EnterOperand1"),n._getLocalizedLabels("Warning"),l):e("#"+n._id+"_conTo").attr("disabled")||""!=e("#"+n._id+"_conTo").val()?e("#"+n._id+"_fValue").attr("disabled")&&"No Measure"==e("#"+n._id+"_fValue").val()?t.Pivot._createErrorDialog(n._getLocalizedLabels("NoMeasure"),n._getLocalizedLabels("Warning"),l):(n._applyFormatting(),t.Pivot.closePreventPanel(n)):t.Pivot._createErrorDialog(n._getLocalizedLabels("EnterOperand2"),n._getLocalizedLabels("Warning"),l)}),this.ddlEditCondition!=r&&(this.ddlEditCondition.getListData().length>1?e("#"+this._id+"_editCon").ejDropDownList("enable"):(e("#"+this._id+"_editCon").ejDropDownList("disable"),e("#"+this._id+"_editcond").css("color","#cbcbcb"))),1==this.ddlFieldValue.getListData().length&&"No Measure"==this.ddlFieldValue._selectedValue?(e("#"+this._id+"_fValue").ejDropDownList("disable"),e("#"+this._id+"_fValueLbl").css("color","#cbcbcb")):e("#"+this._id+"_fValue").ejDropDownList("enable"),this.model.conditionalFormatSettings.length>0&&(this.ddlEditCondition.selectItemByValue(this.model.conditionalFormatSettings[this.model.conditionalFormatSettings.length-1].name),this._editConditionChange()),e("#"+this._id+"_removeBtn").click(function(){var t,i,r=null;(r=e(this).parents(".e-pivotclient").length>0?e(this).parents(".e-pivotclient").find(".e-pivotgrid").data("ejPivotGrid"):e(this).parents(".e-pivotgrid").data("ejPivotGrid")).removeBtn.option("enabled")&&(1==(t=confirm(r._getLocalizedLabels("ConditionalFormattingConformMsg")))&&(i=r.ddlEditCondition._selectedIndices[0],r._removeCellFormatting(i,t),e(this).parents(".e-pivotclient").length>0?e(this).parents(".e-pivotclient").find(".e-dialog, .clientDialog").remove():r.element.find(".e-dialog, .clientDialog").remove()))}),e("#"+this._id+"_CancelBtn").click(function(){var i=null;e(this).parents(".e-pivotclient").length>0?(i=e(this).parents(".e-pivotclient").find(".e-pivotgrid").data("ejPivotGrid"),e(this).parents(".e-pivotclient").find(".e-dialog, .e-clientDialog").remove()):i=e(this).parents(".e-pivotgrid").data("ejPivotGrid"),i.element.find(".e-dialog, .e-clientDialog").remove(),t.Pivot.closePreventPanel(i)}),e("#"+this._id+"_editBtn").click(function(){(e(this).parents(".e-pivotclient").length>0?e(this).parents(".e-pivotclient").find(".e-pivotgrid").data("ejPivotGrid"):e(this).parents(".e-pivotgrid").data("ejPivotGrid"))._editBtnAdd()}),!1},_editBtnAdd:function(){var i,l;0==e("#"+this._id+"_editConText").length&&(this._formatEdit=!0,i=t.buildTag("input#"+this._id+"_editConText.editconditionText","",{},{type:"text",tabindex:1,accesskey:"e"})[0].outerHTML,e(e(".editconditionDropDown").parents("td")[0]).before("<td>"+i+"</td>"),e(e(".editconditionDropDown").parents("td")[0]).css("display","none"),l=this.ddlEditCondition!=r&&this.ddlEditCondition.selectedTextValue!=r&&this.ddlEditCondition.selectedTextValue!=this._getLocalizedLabels("AddNew")?this.ddlEditCondition.selectedTextValue:"",this._formatEdit=this.ddlEditCondition!=r&&this.ddlEditCondition.selectedTextValue!=r&&this.ddlEditCondition.selectedTextValue==this._getLocalizedLabels("AddNew"),e("#"+this._id+"_editConText").ejMaskEdit({inputMode:t.InputMode.Text,value:l,width:"200px",height:"26px"}))},_activeConditionChange:function(t){"Between"==t.selectedValue||"Not Between"==t.selectedValue?e("#"+this._id+"_conTo").removeAttr("disabled"):(e("#"+this._id+"_conTo").attr("disabled","disabled"),e("#"+this._id+"_conTo").val(""))},_editConditionChange:function(){if(this.ddlEditCondition._selectedIndices[0]>0){var t=this.ddlEditCondition._selectedIndices[0]-1,i=this._cFormat[t].split(",");this.ddlConditionType.selectItemByValue(i[1]),e("#"+this._id+"_conFrom").val(i[9]),"undefined"!=i[9]&&"undefined"!=i[10]&&e("#"+this._id+"_conTo").val(i[10]),e("#"+this._id+"_fontcolor").ejColorPicker({value:i[2]}),e("#"+this._id+"_backcolor").ejColorPicker({value:i[3]}),e("#"+this._id+"_bordercolor").ejColorPicker({value:i[4]}),this.ddlBorderStyle.selectItemByValue(i[8]),this.ddlBorderWidth.selectItemByValue(i[5]),this.ddlFont.selectItemByValue(i[6]),this.ddlFontSize.selectItemByValue(i[7]),this.ddlFieldValue.selectItemByValue(i[11]),this.removeBtn.option("enabled",!0),this._conditionTypeChange()}else this._editBtnAdd(),this.removeBtn.option("enabled",!1),this._clearWindow()},_clearWindow:function(){e("#"+this._id+"_clientDlg").find("#"+this._id+"_conFrom,#"+this._id+"_conTo").val(""),e("#"+this._id+"_conTo").disabled=!0},_conditionTypeChange:function(){e("#"+this._id+"_conTo").disabled=!(4==this.ddlConditionType._selectedIndices[0]||5==this.ddlConditionType._selectedIndices[0])},_removeCellFormatting:function(e,t){for(var i,r=e,l=0;l<this._cFormat.length&&e;l++)for(t&&(l=e-1,e=0),i=0;i<this._JSONRecords.length;i++)this._JSONRecords[i].CSS=this._JSONRecords[i].CSS.replace(" "+this._cFormat[l].split(",")[0].replace(/ /g,""),"");t?(this._cFormat.splice(r-1,1),this._list.splice(r-1,1),this.model.conditionalFormatSettings.splice(r-1,1),this._formatName.splice(r,1)):(this._cFormat=[],this._list=[],this.model.conditionalFormatSettings=[],this._formatName=[this._getLocalizedLabels("AddNew")]),this.renderControlFromJSON()},_applyStyle:function(i,r,l,n,s,o,a,d,h){var c,u,g=r.CSS,p="rows"==i?r.Index.split(",")[1]:"columns"==i?r.Index.split(",")[0]:null;h=h.replace(/ /g,""),(r.Value==l||"All"==l)&&-1==e.inArray(Number(p),n)&&n.push(Number(p)),u=1==e.isNumeric(r.Value)?r.Value:e.isNumeric(t.globalize.parseFloat(t.globalize.format(r.Value,"c",this.model.locale),this.model.locale))?t.globalize.parseFloat(t.globalize.format(r.Value,"c",this.model.locale),this.model.locale):r.Value.replace(/[^\d.\-]/g,""),c=-1!=e.inArray(Number(p),n),this._getResult(Number(s),Number(o),u,a)&&!t.isNullOrUndefined(u)&&e.isNumeric(u)&&c&&-1!=r.CSS.indexOf("value")&&(r.CSS=g+" "+h)},_refreshCellFormatting:function(e){for(var t,i,r,l=this._getAxis(),n=0;n<this._cFormat.length;n++)for(t=[],i=this._cFormat[n].split(","),r=0;r<e.length;r++)-1===e[r].CSS.indexOf(i[0].replace(/ /g,""))&&this._applyStyle(l,e[r],i[11],t,i[9],i[10],i[1],r,this._cFormat[n].split(",")[0].replace(/ /g,""));return e},_createDynamicRule:function(e,t,i,r,l,n,s,o){var a="color: "+e+"!important;background-color: "+t+" !important;border:"+i+" "+r+"px "+l+" !important;font:"+n+"px "+s+" !important;";(function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet})().insertRule("."+o.replace(/ /g,"")+"{"+a+"}",0)},_getMDXAxis:function(){for(var e="",i=0;i<this._JSONRecords.length;i++)if(!t.isNullOrUndefined(this._JSONRecords[i].Info)&&this._JSONRecords[i].Info.toLowerCase().indexOf("measures")>-1){e=this._JSONRecords[i].CSS.indexOf("colheader")>-1?"columns":this._JSONRecords[i].CSS.indexOf("rowheader")>-1?"rows":"";break}return e},_getAxis:function(){var i,l,n;if(e(this.element).parents(".e-pivotclient").length>0&&("undefined"!=typeof pivotGridObj&&this.element.hasClass("e-pivotgrid")&&(pivotGridObj=this),this._pivotClientObj.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.setOlapReport(e(this.element).parents(".e-pivotclient").data("ejPivotClient").model.dataSource)),this.getOlapReport())if(i=null,l="",this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){for(this.getOlapReport()!=r&&""!=this.getOlapReport()&&JSON.parse(this.getOlapReport()).PivotCalculations.length>0&&(i=JSON.parse(this.getOlapReport()).PivotCalculations[0].FieldHeader),n=0;n<this._JSONRecords.length;n++)if(this._JSONRecords[n].Value==i){l=this._JSONRecords[n].CSS.indexOf("colheader")>-1?"columns":this._JSONRecords[n].CSS.indexOf("rowheader")>-1?"rows":"";break}}else if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)l="columns";else for(n=0;n<this.getOlapReport().values.length;n++)l=this.getOlapReport().values[n].axis;return""==l&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(l=this._getMDXAxis()),l},_applyCodeBehindFormatting:function(i){var r,l,n,s,o,a,d,h;if(this._isFormatApply=!0,l=this._getAxis(),!t.isNullOrUndefined(this.model.conditionalFormatSettings))for(n=0;n<this.model.conditionalFormatSettings.length;n++)if(s=[],s=this.model.conditionalFormatSettings[n].measures.split(","),-1==e.inArray(this.model.conditionalFormatSettings[n].name,this._formatName)){for(this.model.conditionalFormatSettings[n].className=this._id+"_"+this.model.conditionalFormatSettings[n].name.trim().toLowerCase(),o=0;o<s.length;o++)for(a=[],r=s[o],d=0;d<i.length;d++)this._applyStyle(l,i[d],r,a,t.isNullOrUndefined(this.model.conditionalFormatSettings[n].value.split(",")[0])?"":this.model.conditionalFormatSettings[n].value.split(",")[0],t.isNullOrUndefined(this.model.conditionalFormatSettings[n].value.split(",")[1])?"":this.model.conditionalFormatSettings[n].value.split(",")[1],this.model.conditionalFormatSettings[n].condition,d,this.model.conditionalFormatSettings[n].className);h=this.model.conditionalFormatSettings[n].className+","+this.model.conditionalFormatSettings[n].condition+","+this.model.conditionalFormatSettings[n].style.color+","+this.model.conditionalFormatSettings[n].style.backgroundcolor+","+this.model.conditionalFormatSettings[n].style.bordercolor+","+this.model.conditionalFormatSettings[n].style.borderwidth+","+this.model.conditionalFormatSettings[n].style.fontstyle+","+this.model.conditionalFormatSettings[n].style.fontsize+","+this.model.conditionalFormatSettings[n].style.borderstyle+","+this.model.conditionalFormatSettings[n].value.split(",")[0]+","+this.model.conditionalFormatSettings[n].value.split(",")[1]+","+r,this._cFormat.push(h),this._list.push(this.model.conditionalFormatSettings[n].className),this._formatName.push(this.model.conditionalFormatSettings[n].name),this._createDynamicRule(this.model.conditionalFormatSettings[n].style.color,this.model.conditionalFormatSettings[n].style.backgroundcolor,this.model.conditionalFormatSettings[n].style.borderstyle,this.model.conditionalFormatSettings[n].style.borderwidth,this.model.conditionalFormatSettings[n].style.bordercolor,this.model.conditionalFormatSettings[n].style.fontsize,this.model.conditionalFormatSettings[n].style.fontstyle,this.model.conditionalFormatSettings[n].className)}return this._JSONRecords=i,i},_applyFormatting:function(){var i,l;this._isFormatApply=!0;var n,s,o,a,d,h,c,u,g,p,m,_,f=[],b=e("#"+this._id+"_editConText").val();if(t.isNullOrUndefined(e("#"+this._id+"_conFrom").val())||(this._formatValue1=e("#"+this._id+"_conFrom").val(),this._formatValue2=e("#"+this._id+"_conTo").val(),this.ddlConditionType._selectedValue,h=this.ddlFontColor.model.value,c=this.ddlBackColor.model.value,u=this.ddlBorderColor.model.value,g=this.ddlBorderWidth._selectedValue,p=this.ddlFont._selectedValue,m=this.ddlFontSize._selectedValue,_=this.ddlBorderStyle._selectedValue),a=this.ddlFieldValue._selectedValue!=r?this.ddlFieldValue._selectedValue:"",e(this.element).parents(".e-pivotclient").length>0&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap)for(l=0;l<this._JSONRecords.length&&(this._JSONRecords[l].Info.indexOf("Measures")>-1&&(d="colheader"==this._JSONRecords[l].CSS?"columns":"rowheader"==this._JSONRecords[l].CSS?"rows":""),""==d);l++);else for(field=JSON.parse(this.getOlapReport()).PivotCalculations[0].FieldHeader,l=0;l<this._JSONRecords.length;l++)if(this._JSONRecords[l].Value==field){d="colheader calc"==this._JSONRecords[l].CSS?"columns":"rowheader"==this._JSONRecords[l].CSS?"rows":"";break}}else d=this._getAxis();if(this._formatEdit)n=(s=this._id+"_"+b.trim().toLowerCase())+","+this.ddlConditionType._selectedValue+","+h+","+c+","+u+","+g+","+p+","+m+","+_+","+this._formatValue1+","+this._formatValue2+","+a,this._cFormat.push(n),this._list.push(s),this._formatName.push(b),i={name:b,style:{fontcolor:h,backgroundcolor:c,bordercolor:u,borderstyle:_,borderwidth:g,fontsize:m,fontstyle:p},condition:this.ddlConditionType._selectedValue,value:this._formatValue1+","+this._formatValue2,measures:a,className:s},this.model.conditionalFormatSettings.push(i);else for(b=""!=b&&b!=r?b:this.ddlEditCondition._selectedValue,o=this.ddlEditCondition._selectedIndices[0]-1,this._formatName[o+1]=b,s=this.model.conditionalFormatSettings[o].className,this._cFormat[o]=s+","+this.ddlConditionType._selectedValue+","+h+","+c+","+u+","+g+","+p+","+m+","+_+","+this._formatValue1+","+this._formatValue2+","+a,i={name:b,style:{fontcolor:h,backgroundcolor:c,bordercolor:u,borderstyle:_,borderwidth:g,fontsize:m,fontstyle:p},condition:this.ddlConditionType._selectedValue,value:this._formatValue1+","+this._formatValue2,measures:a,className:s},this.model.conditionalFormatSettings[o]=i,l=0;l<this._JSONRecords.length;l++)this._JSONRecords[l].CSS=this._JSONRecords[l].CSS.replace(" "+s,"");for(l=0;l<this._JSONRecords.length;l++)this._applyStyle(d,this._JSONRecords[l],a,f,this._formatValue1,this._formatValue2,this.ddlConditionType._selectedValue,l,s);this._createDynamicRule(h,c,_,g,u,m,p,s),this.renderControlFromJSON(),e(this.element).parents(".e-pivotclient").length>0&&e(this.element).parents(".e-pivotclient").find(".e-dialog, .e-clientDialog").remove(),this.element.find(".e-dialog, .e-clientDialog").remove(),this._formatEdit=!1},_getResult:function(e,t,i,r){switch(r){case"Less Than":return i<e;case"Less Than Or Equal To":if(i<=e)return i;break;case"Greater Than":return i>e;case"Greater Than Or Equal To":if(i>=e)return i;break;case"Equals":if(i==e)return i;break;case"Not Equals":return i!=e;case"Between":return e<t&&i>e&&i<t||e>t&&i<e&&i>t||i==e&&i==t;case"Not Between":return!(e<t&&i>e&&i<t||e>t&&i<e&&i>t||i==e&&i==t)}},_appendCssClassName:function(e){var i,r,l,n,s,o,a,d,h,c,u=!0,g=r=i=!1,p=!1,m=l=-1;if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){for(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?(n="FieldHeader",s="CssClass",o=JSON.parse(this.getOlapReport()).PivotRows,a=JSON.parse(this.getOlapReport()).PivotColumns,d=JSON.parse(this.getOlapReport()).PivotCalculations):(n="fieldCaption",s="cssClass",o=this.model.dataSource.rows,a=this.model.dataSource.columns,d=this.model.dataSource.values),c=0;c<o.length&&!g;c++)t.isNullOrUndefined(o[c].cssClass)||(g=!0);for(c=0;c<a.length&&!r;c++)t.isNullOrUndefined(a[c].cssClass)||(r=!0);for(c=0;c<d.length&&!i;c++)t.isNullOrUndefined(d[c].cssClass)||(i=!0);for(h=0;h<e.length&&(g||r||i);h++){for(c=0;c<o.length&&u&&g;c++)t.isNullOrUndefined(o[c][s])||Number(e[h].Index.split(",")[0])!=c||-1!=e[h].CSS.indexOf("none")||-1!=e[h].CSS.indexOf(o[c][s])||(e[h].CSS=e[h].CSS+" "+o[c][s]),u&&e[h].CSS.indexOf("colheader")>-1&&(u=!1);for(c=0;c<a.length&&r;c++)t.isNullOrUndefined(a[c][s])||Number(e[h].Index.split(",")[1])!=c||-1!=e[h].CSS.indexOf("none")||-1!=e[h].CSS.indexOf(a[c][s])||(e[h].CSS=e[h].CSS+" "+a[c][s]);for(c=0;c<d.length&&i;c++)p&&(e[h].CSS.indexOf("colheader")>-1||e[h].CSS.indexOf("cgtot")>-1||e[h].CSS.indexOf("cstot")>-1||e[h].CSS.indexOf("gtot")>-1||e[h].CSS.indexOf("stot")>-1)&&-1==e[h].CSS.indexOf("calc")&&(p=!1),d[c][n]==e[h].Value&&(p=!0,m=e[h].Index.split(",")[0],l=c),!t.isNullOrUndefined(d[c][s])&&p&&m==e[h].Index.split(",")[0]&&l==c&&-1==e[h].CSS.indexOf(d[c][s])&&(e[h].CSS=e[h].CSS+" "+d[c][s])}}return e},_updateReportSettings:function(i){var r=e.map(i,function(e){var t=e.Key;if("JsonRecords"==t||"PivotRecords"==t)return e}),l=e.map(i,function(e){var t=e.Key;if("PivotReport"==t||"OlapReport"==t)return e}),n=e.map(i,function(e){if("SortColIndex"==e.Key)return e});this.setJSONRecords(r.length>0?r[0].Value:null),this.setOlapReport(l[0].Value),n.length>0?(t.PivotAnalysis._valueSorting=JSON.parse(n[0].Value),t.PivotAnalysis._sort=this.model.valueSortSettings.sortOrder):t.PivotAnalysis._valueSorting=null},_updatePageSettings:function(t,i){var r=e.map(t,function(e){if("PageSettings"==e.Key)return e}),l=e.map(t,function(e){if("HeaderCounts"==e.Key)return e});r.length>0&&null!=i._pagerObj&&(i._pagerObj.element.css("opacity","1"),i._pagerObj.element.find(".e-pagerTextBox").removeAttr("disabled"),i._pagerObj._unwireEvents(),i._pagerObj._wireEvents(),i._pagerObj.initPagerProperties(JSON.parse(l[0].Value),JSON.parse(r[0].Value)))},_removeCells:function(i){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I=[],y=[];if(i[0]!=r&&i.length>0?(l=e.map(i,function(e){if("FilteredColumnHeaders"==e.Key)return e}),n=e.map(i,function(e){if("FilteredRowHeaders"==e.Key)return e}),l.length>0&&(I=JSON.parse(l[0].Value)),n.length>0&&(y=JSON.parse(n[0].Value))):i.d!=r?(l=e.map(i.d,function(e){if("FilteredColumnHeaders"==e.Key)return e}),n=e.map(i.d,function(e){if("FilteredRowHeaders"==e.Key)return e}),l.length>0&&(I=JSON.parse(l[0].Value)),n.length>0&&(y=JSON.parse(n[0].Value))):(i.FilteredColumnHeaders&&(I=JSON.parse(i.FilteredColumnHeaders)),i.FilteredRowHeaders&&(y=JSON.parse(i.FilteredRowHeaders))),I.length>0){for(R=I,_=0;_<R.length;_++)for(f=R[_].From;f<=R[_].To;f++)for(u=R[_].Level;u<this._rowCount;u++)this.element.find(".e-pivotGridTable  [data-p='"+f+","+u+"']").remove();for(s=(n=this.element.find(".e-pivotGridTable thead").children()).length-2;s>=0;s--)for(o=e(n[s]).find("th.colheader:visible"),a=0;a<=o.length-1;a++){for(d=e(o[a]).attr("colSpan"),u=0;u<=parseInt(e(o[a]).attr("colSpan"))-1;u++)h=parseInt(e(o[a]).attr("data-p").split(",")[0])+u,c=this.element.find(".e-pivotGridTable  [data-p='"+h+","+(s+1)+"']:visible"),e(c).length>0?d=parseInt(d)+(e(c).attr("colspan")?parseInt(e(c).attr("colspan"))-1:0):d--;if(0==d&&e(o[a]).nextAll(".summary.stot:eq(0)").length>0){var T=e(o[a]).nextAll(".summary.stot:eq(0)").attr("data-p").split(",")[0],L=[],R=[];for(u=0;u<this._rowCount;u++){if(g="[data-p='"+parseInt(T)+","+u+"'] ",R.push(g),this._JSONRecords[parseInt(T)*this._rowCount+u].ColSpan>1&&this.element.find(".e-pivotGridTable [data-p='"+parseInt(T)+","+u+"']:visible").length>0)for(p=1;p<=this._JSONRecords[parseInt(T)*this._rowCount+u].ColSpan-1;p++)L.push(parseInt(T)+p);for(hc=0;hc<L.length;hc++)g+=", [data-p='"+L[hc]+","+u+"'] ";this.element.find(".e-pivotGridTable "+g).remove()}}t.isNullOrUndefined(e(o[a]).attr("vfColSpan"))&&e(o[a]).attr("vfColSpan",e(o[a]).attr("colSpan")),e(o[a]).attr("colSpan",d)}this.element.find(".colheader[colspan='0']:not(.gtot,.calc)").remove()}if(y.length>0){for(R=y,m=parseInt(this.element.find(".e-pivotGridTable td:eq(0)").attr("data-p").split(",")[0])-2,_=0;_<R.length;_++)for(f=R[_].From;f<=R[_].To;f++)this.element.find(".e-pivotGridTable tr:eq("+f+") th:last").css("display","none"),this.element.find(".e-pivotGridTable tr:eq("+f+") td").css("display","none");for(w=m;w>=0;w--)for(b=this.element.find(".e-pivotGridTable tbody").find(" .rowheader[data-p^='"+w+",'] :visible"),C=this.element.find(".e-pivotGridTable th.rowheader").parent(),S=0;S<=b.length;S++){var O=e(b[S]).parent(),F=parseInt(O.attr("rowSpan")),E=O.attr("data-p");if(E){var D=parseInt(E.split(",")[1]),N=(parseInt(E.split(",")[0]),0);for(x=D;x<=D+F;x++)(v=C.children(" [data-p='"+(w+1)+","+x+"']")).length>0&&!v.is(":visible")&&(N=N+parseInt(v.attr("rowSpan"))+(v.next("th.rowheader").length>0||parseInt(v.attr("rowSpan"))>1?1:0));N==F&&O.css("display","none")}}for(w=0;w<e(this.element.find(".summary.stot")).length;w++)""==e(this.element.find(".summary.stot")[w]).nextAll().text()&&(e(this.element.find(".summary.stot")[w]).css("display","none"),e(this.element.find(".summary.stot")[w]).nextAll().css("display","none"))}this.model.enableGroupingBar&&this._createFields(null,e("#"+this._id).find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth())},saveXMLReport:function(e,t){var i={clientReports:JSON.parse(this.getOlapReport()).Report,fileName:e};this.doPostBack(t,i)},_reportModelUpdate:function(i){t.isNullOrUndefined(i)||(this.model.enableGrandTotal=i.ShowGrandTotals,this.model.enableCollapseByDefault=i.enableCollapseByDefault,i.ShowSubTotals||(e.each(i.PivotRows,function(e,t){t.showSubTotal=!1}),e.each(i.PivotColumns,function(e,t){t.showSubTotal=!1})),this.setOlapReport(JSON.stringify(i)),this.model.enableColumnResizing=i.AllowResizeColumns,this.model.resizeColumnsToFit=i.ResizePivotGridToFit,this.model.enableCellSelection=i.AllowSelection,this.model.enableDeferUpdate=i.DeferLayoutUpdate,this.model.frozenHeaderSettings.enableFrozenHeaders=i.FreezeHeaders,this.model.enableGroupingBar=i.ShowGroupingBar,this.model.enablePivotFieldList=i.ShowFieldList,this.model.collapsedMembers={},this.model._isXMLImport=!1)},_renderControlSuccess:function(i){var l,n,s,o,a,d,h,c,u,g,p;try{if(i[0]!=r&&i.length>0?(this._updateReportSettings(i),null!=i[2]&&i[2]!=r&&("PageSettings"==i[2].Key&&(this.model.enableVirtualScrolling||!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i[3].Value).Column/JSON.parse(i[2].Value).CategoricalPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i[3].Value).Row/JSON.parse(i[2].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(i[2].Value).CategoricalCurrentPage,this._seriesCurrentPage=JSON.parse(i[2].Value).SeriesPageSize):null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r&&null!=this._pagerObj&&this._pagerObj.initPagerProperties(JSON.parse(i[3].Value),JSON.parse(i[2].Value)),t.isNullOrUndefined(i[4])||("DataSet"==i[4].Key?(this._dataSet=i[4].Value,t.isNullOrUndefined(i[5])||(this.model.customObject=i[5].Value)):this.model.customObject=i[4].Value))),t.isNullOrUndefined(i[2])||("DataSet"==i[2].Key?(this._dataSet=i[2].Value,t.isNullOrUndefined([3])||(this.model.customObject=i[3].Value)):this.model.customObject=i[2].Value),t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._pagerObj||this._updatePageSettings(i,this._pivotClientObj)):i.d!=r&&i.d.length>0?(this._updateReportSettings(i.d),null!=i.d[2]&&i.d[2]!=r?"PageSettings"==i.d[2].Key&&(this.model.enableVirtualScrolling||!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i.d[3].Value).Column/JSON.parse(i.d[2].Value).CategoricalPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i.d[3].Value).Row/JSON.parse(i.d[2].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(i.d[2].Value).CategoricalCurrentPage,this._seriesCurrentPage=JSON.parse(i.d[2].Value).SeriesCurrentPage):null!=this._pagerObj&&null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(i.d[3].Value),JSON.parse(i.d[2].Value)),t.isNullOrUndefined(i.d[4])||("DataSet"==i.d[4].Key?(this._dataSet=i.d[4].Value,t.isNullOrUndefined(i.d[5])||(this.model.customObject=i.d[5].Value)):this.model.customObject=i.d[4].Value),t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._pagerObj||this._updatePageSettings(i.d,this._pivotClientObj)):t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._pagerObj||2!=i.d.length||(this._pivotClientObj._pagerObj.element.css("opacity","0.5"),this._pivotClientObj._pagerObj.element.find(".e-pagerTextBox").attr("disabled","disabled"),this._pivotClientObj._pagerObj._unwireEvents()),t.isNullOrUndefined(i[2])||"PageSettings"==i.d[2].Key||("DataSet"==i.d[2].Key?(this._dataSet=i.d[2].Value,t.isNullOrUndefined([3])||(this.model.customObject=i.d[3].Value)):this.model.customObject=i.d[2].Value)):!t.isNullOrUndefined(i)&&t.isNullOrUndefined(i.d)&&(i.SortColIndex!=r?(t.PivotAnalysis._valueSorting=JSON.parse(i.SortColIndex)[0],t.PivotAnalysis._sort=this.model.valueSortSettings.sortOrder):t.PivotAnalysis._valueSorting=null,i.PivotRecords!=r?(this.setJSONRecords(i.PivotRecords),this.setOlapReport(i.OlapReport),i.HeaderCounts!=r&&(this.model.enableVirtualScrolling||!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableVirtualScrolling)?(this._categPageCount=Math.ceil(JSON.parse(i.HeaderCounts).Column/JSON.parse(i.PageSettings).CategoricalPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i.HeaderCounts).Row/JSON.parse(i.PageSettings).SeriesPageSize),this._categCurrentPage=JSON.parse(i.PageSettings).CategoricalCurrentPage,this._seriesCurrentPage=JSON.parse(i.PageSettings).SeriesCurrentPage):i.HeaderCounts!=r&&null!=this._pagerObj&&null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r?this._pagerObj.initPagerProperties(JSON.parse(i.HeaderCounts),JSON.parse(i.PageSettings)):i.HeaderCounts==r||t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._pagerObj||this._pivotClientObj._pagerObj.initPagerProperties(JSON.parse(i.HeaderCounts),JSON.parse(i.PageSettings))):i.JsonRecords!=r&&1==this.model.enableJSONRendering?(this.setJSONRecords(JSON.stringify(i.JsonRecords)),this.setOlapReport(JSON.stringify(i.PivotReport)),null!=i.DataSet&&(this._dataSet=i.DataSet)):i.JsonRecords!=r?(this.setJSONRecords(i.JsonRecords),this.setOlapReport(i.PivotReport),null!=i.DataSet&&(this._dataSet=i.DataSet)):i.JsonRecords==r&&(this.setJSONRecords(null),i.PivotReport&&this.setOlapReport(i.PivotReport),i.OlapReport&&this.setOlapReport(i.OlapReport)),i.isXMLLoad!=r&&(this.model._isXMLImport=i.isXMLLoad),null!=i.customObject&&i.customObject!=r&&(this.model.customObject=i.customObject)),t.isNullOrUndefined(this.getJSONRecords())&&!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enablePaging&&(l={CategoricalCurrentPage:1,CategoricalPageSize:1,SeriesCurrentPage:1,SeriesPageSize:1},n={Column:1,Row:1},this._pivotClientObj._pagerObj.initPagerProperties(n,l)),(this.model.enableVirtualScrolling||null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r)&&this.layout("nosummaries"),this.getOlapReport()!=r&&""!=this.getOlapReport()&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode)try{t.isNullOrUndefined(JSON.parse(this.getOlapReport()).DataModel)||(this.model.analysisMode="Olap"==JSON.parse(this.getOlapReport()).DataModel?t.Pivot.AnalysisMode.Olap:t.Pivot.AnalysisMode.Pivot),!t.isNullOrUndefined(JSON.parse(this.getOlapReport()).PagerOptions)&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(this.model.enablePaging||this.model.enableVirtualScrolling)&&(this._categPageCount=this.model.enablePaging?JSON.parse(this.getOlapReport()).PagerOptions.CategoricalPageCount:Math.ceil(JSON.parse(this.getOlapReport()).PagerOptions.CategoricalPageCount/JSON.parse(this.getOlapReport()).PagerOptions.CategoricalPageSize),this._seriesPageCount=this.model.enablePaging?JSON.parse(this.getOlapReport()).PagerOptions.SeriesPageCount:Math.ceil(JSON.parse(this.getOlapReport()).PagerOptions.SeriesPageCount/JSON.parse(this.getOlapReport()).PagerOptions.SeriesPageSize),this.model.dataSource.pagerOptions.categoricalPageSize=JSON.parse(this.getOlapReport()).PagerOptions.CategoricalPageSize,this.model.dataSource.pagerOptions.seriesPageSize=JSON.parse(this.getOlapReport()).PagerOptions.SeriesPageSize,this.model.dataSource.pagerOptions.categoricalCurrentPage=JSON.parse(this.getOlapReport()).PagerOptions.CategoricalCurrentPage,this.model.dataSource.pagerOptions.seriesCurrentPage=JSON.parse(this.getOlapReport()).PagerOptions.SeriesCurrentPage),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&null!=this._pagerObj&&(s=this,o=setInterval(function(){clearInterval(o);var e={CategoricalCurrentPage:s.model.dataSource.pagerOptions.categoricalCurrentPage,CategoricalPageSize:s.model.dataSource.pagerOptions.categoricalPageSize,SeriesCurrentPage:s.model.dataSource.pagerOptions.seriesCurrentPage,SeriesPageSize:s.model.dataSource.pagerOptions.seriesPageSize},t={Column:s._categPageCount,Row:s._seriesPageCount};s._pagerObj.element.css("opacity","1"),s._pagerObj.element.find(".e-pagerTextBox").removeAttr("disabled"),s._pagerObj._unwireEvents(),s._pagerObj._wireEvents(),s._pagerObj.initPagerProperties(t,e)},10))}catch(e){}if(i.isXMLLoad!=r&&i.isXMLLoad&&this._reportModelUpdate(t.isNullOrUndefined(this.getOlapReport())?null:JSON.parse(this.getOlapReport())),1==this.model.enableGroupingBar&&(c=JSON.parse(this.getOlapReport()),a=t.isNullOrUndefined(c.ItemsProperties)?[]:JSON.parse(c.ItemsProperties),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(d=c.PivotRows.concat(c.PivotColumns,c.PivotCalculations,c.Filters),h=e.grep(a,function(t){return e.grep(d,function(e){t.id==(e.FieldHeader||e.DimensionHeader)&&(t.id=e.FieldName||e.DimensionName)}),t}),this._pivotTableFields=h):this._pivotTableFields=a,this._createGroupingBar(c)),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)for(c=JSON.parse(this.getOlapReport()),u=0;u<c.PivotCalculations.length;u++)(8==c.PivotCalculations[u].CalculationType||"Formula"==c.PivotCalculations[u].CalculationType)&&0==e.grep(this._calculatedField,function(e){return e.name==c.PivotCalculations[u].FieldName}).length&&this._calculatedField.push({name:c.PivotCalculations[u].FieldName,formula:c.PivotCalculations[u].Formula});null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"initialize",element:this.element,customObject:this.model.customObject}),null!=this.getJSONRecords()&&this.getJSONRecords().length>0?this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout&&0==this.model.enableVirtualScrolling&&null==e(".e-pivotpager")[0]?this.excelLikeLayout(this.getJSONRecords()):this.renderControlFromJSON(this.getJSONRecords()):this.renderControlFromJSON(""),g=e(this.element).parents(".e-pivotclient").length>0?e(this.element).parents(".e-pivotclient").data("ejPivotClient"):null,t.isNullOrUndefined(g)||(g._isTimeOut=!1),t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._waitingPopup?this._waitingPopup.hide():e("#"+this._pivotClientObj._id+"_maxView")[0]&&this._maxViewLoading?this._maxViewLoading.hide():this._pivotClientObj._waitingPopup.hide(),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style"),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._calculatedField.length>0&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&null!=this._schemaData&&this._schemaButtonCreate(),p={action:"initialize",customObject:this.model.customObject,element:this.element},this._trigger("renderSuccess",p),t.isNullOrUndefined(i.Exception)||t.Pivot._createErrorDialog(i,"Exception",this),this.model.enableAdvancedFilter&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._removeCells(i)}catch(e){}},_hideGrandTotal:function(i){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=i.find(".pivotGridFrozenTable");if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){if(this.model.enableRowGrandTotal&&this.model.enableGrandTotal||((this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders)&&i.find(".valueCell tr:last,.rowhead tr:last").hide(),i.find("tbody").children().length>0&&(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?i.find("tr:last .gtot").parent().hide():i.find("tr:last .rgtot").parent().hide())),!(i.find("tr:first th.summary").attr("data-p")==r&&i.find(".pivotGridFrozenTable tr:first td.summary").attr("data-p")==r||this.model.enableColumnGrandTotal&&this.model.enableGrandTotal||this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot))for(l=[],l=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?b.find(".gtot[role^='columnheader']"):b.find(".cgtot[role^='columnheader']"):this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?i.find("th.gtot[role^='columnheader']"):i.find("th.cgtot[role^='columnheader']"),n=0;n<l.length;n++)i.find('[data-p^="'+parseInt(e(l[n]).attr("data-p").split(",")[0])+',"]').hide(),i.find('[data-p^="'+parseInt(e(l[n]).attr("data-p").split(",")[0])+',"]').hide()}else if(s=!0,o=0,this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||this.model.analysisMode==t.Pivot.AnalysisMode.Olap){if((!this.model.enableColumnGrandTotal||!this.model.enableGrandTotal)&&((d=e(i).find("thead tr").length||e(i).find(".pivotGridFrozenTable tr").length)>1||1==d&&e(i).find("th.summary[data-p$=',"+o+"']").length>0)){for(;s;)(a=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?e(i).find("td.summary[data-p$=',"+o+"']"):e(i).find("th.summary[data-p$=',"+o+"']")).length&&(s=!1),o++;for(p=0;p<a.length;p++){var C=o,S=a[p],x=e(S).attr("data-p"),v=parseInt(x.split(",")[1])-1,w=e(S).attr("colspan");e(i).find("thead tr").length,e(i).find("tbody tr").length;for(h=0;h<parseInt(w);h++)e(i).find(" [data-p^='"+(parseInt(x.split(",")[0])+h)+",']").css("display","none");for(c=0;c<d;c++)this.model.frozenHeaderSettings.enableFrozenHeaders?1==e(b).find("tr:eq("+c+") td").length&&(u=e(b).find(" tr:eq("+c+") td").attr("colspan"),e(b).find(" tr:eq("+c+") td").attr("colspan",parseInt(u)-parseInt(w))):1==e(i).find("thead tr:eq("+c+") th").length&&(u=e(i).find("thead tr:eq("+c+") th").attr("colspan"),e(i).find("thead tr:eq("+c+") th").attr("colspan",parseInt(u)-parseInt(w)));if(v>=0)for(_=e(i).find(" [data-p^='"+x.split(",")[0]+","+v+"']")[0];C>1;){if(t.isNullOrUndefined(_))for(v=parseInt(x.split(",")[1])-1;v>=0;v--){if(f=e(i).find("[data-p='"+x.split(",")[0]+","+v+"']")[0],t.isNullOrUndefined(f))for(k=parseInt(x.split(",")[0])-1;k>=0;k--)t.isNullOrUndefined(f)&&(f=e(i).find("[data-p='"+k+","+v+"']")[0]);!t.isNullOrUndefined(f)&&"none"!=e(f).css("display")&&"none"!=e(e(f).parents("tr")[0]).css("display")&&(e(f).hasClass("rowheader")||"rowheader"==e(f).attr("role")||e(f).hasClass("colheader")||"columnheader"==e(f).attr("role")||e(f).hasClass("value")||"gridcell"==e(f).attr("role"))&&(_=f),set_spn=parseInt(e(f).attr("colspan"))-parseInt(w),e(f).attr("colspan",set_spn)}t.isNullOrUndefined(f)||C--}}}if(s=!0,o=0,a="",!this.model.enableRowGrandTotal||!this.model.enableGrandTotal){if(g=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,(d=e(i).find("tbody tr").length)>1||1==d&&"summary"==e(i).find(g?"":"th[data-p^='"+o+",']"))for(d=e(i).find("tbody tr").length;s;)(a=g?e(i).find("td.summary[data-p^='"+o+",']"):e(i).find("th.summary[data-p^='"+o+",']")).length&&(s=!1),o++;if(d>0)for(p=0;p<a.length;p++){C=o,S=a[p],x=e(S).attr("data-p"),v=parseInt(x.split(",")[0])-1;var I=e(S).attr("rowspan"),y=e(S).parent();for(m=0;m<S.rowSpan;m++)e(y).css("display","none"),g&&e(i).find(".pivotGridValueTable tr:eq("+e(y).index()+")").css("display","none"),y=e(y).next();if(v>=0)for(_=e(i).find(" [data-p^='"+v+","+x.split(",")[1]+"']")[0];C>1;){if(t.isNullOrUndefined(_))for(v=parseInt(x.split(",")[0])-1;v>=0;v--){if(f=e(i).find("[data-p='"+v+","+x.split(",")[1]+"']")[0],t.isNullOrUndefined(f))for(k=parseInt(x.split(",")[1])-1;k>=0;k--)t.isNullOrUndefined(f)&&(f=e(i).find("[data-p='"+v+","+k+"']")[0]);!t.isNullOrUndefined(f)&&"none"!=e(f).css("display")&&"none"!=e(e(f).parents("tr")[0]).css("display")&&(e(f).hasClass("rowheader")||"rowheader"==e(f).attr("role")||e(f).hasClass("colheader")||"columnheader"==e(f).attr("role")||e(f).hasClass("value")||"gridcell"==e(f).attr("role"))&&(_=f),set_spn=parseInt(e(f).attr("rowspan"))-parseInt(I),e(f).attr("rowspan",set_spn)}t.isNullOrUndefined(f)||C--}}}}},_hideSubTotal:function(i,l,n){var s,o,a,d,h,c,u,g,p,m;if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){var _,f={},b=!1,C={},S=!1,x=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.rows:this.element.parents(".e-pivotclient").length>0?JSON.parse(this._pivotClientObj.getOlapReport()).PivotRows:JSON.parse(this.getOlapReport()).PivotRows,v=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.columns:this.element.parents(".e-pivotclient").length>0?JSON.parse(this._pivotClientObj.getOlapReport()).PivotColumns:JSON.parse(this.getOlapReport()).PivotColumns,w=i[0].querySelectorAll("tbody th.rowheader"),I=i[0].querySelectorAll("thead th, tbody td");for(a=0;a<x.length;a++)0==x[a].showSubTotal&&(b=!0);if(1==b)for(c=0;c<w.length;c++)f[e(w[c]).attr("data-p")]=w[c];for(a=0;a<v.length;a++)0==v[a].showSubTotal&&(S=!0);if(1==S)for(c=0;c<I.length;c++)C[e(I[c]).attr("data-p")]=I[c]}if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){if(x=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.rows:this.element.parents(".e-pivotclient").length>0?JSON.parse(this._pivotClientObj.getOlapReport()).PivotRows:JSON.parse(this.getOlapReport()).PivotRows,v=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.columns:this.element.parents(".e-pivotclient").length>0?JSON.parse(this._pivotClientObj.getOlapReport()).PivotColumns:JSON.parse(this.getOlapReport()).PivotColumns,!t.isNullOrUndefined(x))for(a=0;a<x.length;a++)if(0==x[a].showSubTotal)if(s=a.toString(),"row"==e(i).attr("role")&&e(i).parent().is("tbody")){if(0==e(i).find(".stot,.rstot").length||this._isSubTotalhidden&&e(i).find(".stot,.rstot").find(".e-expand").length>=1||e(i).find(".stot,.rstot").attr("data-p").split(",")[0]==s&&1==l&&e(i).find(".stot,.rstot").find(".e-expand").length>=1)break;if(e(i).find(".stot,.rstot").attr("data-p").split(",")[0]==s){e(n).parent().attr("data-p").split(",")[0]==s&&(this._isSubTotalhidden=!0),this._isSubTotalHide=!0;break}}else if(e(i).find("tbody").length>0&&(_=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?i.find('.summary.rstot[data-p^="'+a+',"]'):i.find('.summary.stot[data-p^="'+a+',"]')).length>0)for(o=0;o<_.length;o++){var y=e(_[o]).closest("tr"),T=e(y).find(".stot,.rstot").attr("data-p"),L=parseInt(T.split(",")[0])-1,R=parseInt(e(y).find(".stot,.rstot").attr("rowspan"));for(e(y).css("display","none"),(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders)&&e(i).find(".valueCell td[data-p$=',"+T.split(",")[1]+"']").closest("tr").css("display","none"),A=parseInt(T.split(",")[1]);L>=0;){for(m=null;t.isNullOrUndefined(m)&&A>=0;){if(m=f[L+","+A],!t.isNullOrUndefined(m)&&"none"!=e(e(m).closest("tr")[0]).css("display")&&e(m).hasClass("rowheader")&&"rowheader"==e(m).attr("role")&&parseInt(e(m).attr("data-p").split(",")[0])<parseInt(T.split(",")[0])&&parseInt(e(m).attr("data-p").split(",")[1])+m.rowSpan+(e(m).find("span").attr("data-tag")!=r?parseInt(e(m).find("span").attr("data-tag")):0)>=parseInt(T.split(",")[1])+R){m.rowSpan-=1,e(m).find("span").attr("data-tag",e(m).find("span").attr("data-tag")!=r?parseInt(e(m).find("span").attr("data-tag"))+1:1);break}A--}L--}}if(!t.isNullOrUndefined(v))for(a=0;a<v.length;a++)if(0==v[a].showSubTotal)if(d=a.toString(),(e(i).hasClass("stot")||e(i).hasClass("cstot"))&&"columnheader"==e(i).attr("role")){if(this._isSubTotalhidden&&e(i).find(".stot,.cstot").find(".e-expand").length>=1||e(i).attr("data-p").split(",")[1]==d&&1==l&&e(i).find(".e-expand").length>=1)break;if(e(i).attr("data-p").split(",")[1]==d){this._isSubTotalhidden=this._isSubTotalHide=!0;break}}else if("row"==e(i).attr("role")&&((this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&e(i).parent().is("tbody")||e(i).parent().is("thead"))){if(0==e(i).find(".stot,.cstot").length||this._isSubTotalhidden&&e(i).find(".stot,.cstot").find(".e-expand").length>=1||e(i).find(".stot,.cstot").attr("data-p").split(",")[1]==d&&1==l&&e(i).find(".stot,.cstot").find(".e-expand").length>=1)break;if(e(i).find(".stot,.cstot").attr("data-p").split(",")[1]==d){this._isSubTotalhidden=this._isSubTotalHide=!0;break}}else if((e(i).find("thead").length>0||e(i).find(".colhead").length>0)&&(_=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?i.find('td.summary.cstot[data-p$=",'+a+'"]'):i.find('th.summary.cstot[data-p$=",'+a+'"]'):this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders?i.find('td.summary.stot[data-p$=",'+a+'"]'):i.find('th.summary.stot[data-p$=",'+a+'"]')).length>0)for(h=_,c=0;c<h.length;c++){var O=e(h[c]),F=e(i),E=(T=e(h[c]).attr("data-p"),e(h[c]).closest("tr")[0]),D=parseInt(T.split(",")[0]),N=(R=parseInt(e(h[c]).attr("rowspan")),parseInt(e(h[c]).attr("colspan"))),A=parseInt(T.split(",")[1])-1;for(u=0;u<N;u++){for(g=e(E).nextAll().find("[data-p^='"+(u+D)+",']"),p=0;p<e(g).length;p++)e(g[p]).css("display","none");(e(g[p]).attr("data-hc")==r||parseInt(e(g[p]).attr("data-hc"))<1)&&(e(F).find("[data-p^='"+(u+D)+",']").css("display","none"),e(F).find("[data-p^='0,']:not(.summary)").parent().find("td[data-p^='"+(u+D)+",']").attr("data-ch",1))}for(e(O).css("display","none"),L=parseInt(T.split(",")[0]);A>=0;){for(m=null;t.isNullOrUndefined(m)&&L>=0;){if(m=C[L+","+A],!t.isNullOrUndefined(m)&&"none"!=e(e(m).closest("tr")[0]).css("display")&&e(m).hasClass("colheader")&&"columnheader"==e(m).attr("role")&&parseInt(e(m).attr("data-p").split(",")[1])<parseInt(T.split(",")[1])&&parseInt(e(m).attr("data-p").split(",")[0])<=parseInt(T.split(",")[0])&&parseInt(e(m).attr("data-p").split(",")[0])+m.colSpan+(e(m).find("span").attr("data-tag")!=r?parseInt(e(m).find("span").attr("data-tag")):0)>=parseInt(T.split(",")[0])+N){m.colSpan-=N,e(m).find("span").attr("data-tag",e(m).find("span").attr("data-tag")!=r?parseInt(e(m).find("span").attr("data-tag"))+N:N);break}L--}A--}}}},_filterReport:function(e){for(var i,r=0;r<e.Filters.length;r++)if(e.PivotColumns.length>=1)for(i=0;i<e.PivotColumns.length;i++)0==e.Filters.length||t.isNullOrUndefined(e.Filters[r])||e.Filters[r].Tag!=e.PivotColumns[i].FieldName||(e.Filters.splice(r,1),r=-1);for(r=0;r<e.Filters.length;r++)if(e.PivotRows.length>=1)for(i=0;i<e.PivotRows.length;i++)0==e.Filters.length||t.isNullOrUndefined(e.Filters[r])||e.Filters[r].Tag!=e.PivotRows[i].FieldName||(e.Filters.splice(r,1),r=-1);for(r=0;r<e.Filters.length;r++)if(e.PivotCalculations.length>=1)for(i=0;i<e.PivotCalculations.length;i++)0==e.Filters.length||t.isNullOrUndefined(e.Filters[r])||e.Filters[r].Tag!=e.PivotCalculations[i].FieldName||(e.Filters.splice(r,1),r=-1);return e},_createGroupingBar:function(e){var i;this._pivotFilter=this._getLocalizedLabels("DragFieldHere"),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(e=this._filterReport(e),i=this._createPivotButtons(null!=this._pivotFilter&&e.Filters.length>1&&e.Filters[0].Tag==e.Filters[1].Tag?e.Filters.slice(1):e.Filters,"filter")):i=this._createPivotButtons(null!=this._pivotFilter&&e.filters.length>0?e.filters:"","filter"),this._pivotFilter=i,this._pivotRow=this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e.PivotRows:e.rows,"row"),this._pivotColumn=this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e.PivotColumns:e.columns,"column"),this._pivotCalculation=this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e.PivotCalculations:e.values,"values"),this.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&e.values.length>0&&e.values[0].measures&&("columns"==e.values[0].axis&&e.values[0].measures.length>0?this._pivotColumn=this._pivotColumn+this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e.PivotColumns:[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"column"):"rows"==e.values[0].axis&&e.values[0].measures.length>0&&(this._pivotRow=this._pivotRow+this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e.PivotColumns:[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"row")))},_contextOpen:function(e){t.Pivot._contextMenuOpen(e,this)},_pivotContextClick:function(i){var r,l;if(i.text!=this._getLocalizedLabels("CalculatedField"))if(this.model.operationalMode==t.Pivot.OperationalMode.ClientMode){var n=i.text==this._getLocalizedLabels("AddToColumn")?"column":i.text==this._getLocalizedLabels("AddToRow")?"row":i.text==this._getLocalizedLabels("AddToValues")?"value":i.text==this._getLocalizedLabels("AddToFilter")?"filter":"",s=e(this._selectedMember).attr("data-fieldName"),o={droppedFieldName:s,droppedFieldCaption:e(this._selectedMember).text(),droppedClass:n,droppedPosition:"",isMeasuresDropped:0==s.toLocaleLowerCase().indexOf("measures")};this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._calculatedField.length>0&&"values"!=n&&(this.model.dataSource.values=e.grep(this.model.dataSource.values,function(e){return t.isNullOrUndefined(e.isCalculatedField)||0==e.isCalculatedField||1==e.isCalculatedField&&-1==e.formula.indexOf(o.droppedFieldName)})),this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.dataSource=this.clearDrilledItems(this.model.dataSource,{action:"pvtBtnDropped"},this)),t.Pivot.addReportItem(this.model.dataSource,o),this.refreshControl(),t.isNullOrUndefined(this._schemaData)||this._schemaData._refreshPivotButtons()}else r=i.text==this._getLocalizedLabels("AddToColumn")?this.element.find(".columns"):i.text==this._getLocalizedLabels("AddToRow")?0==this.element.find(".e-grpRow").length?this.element.find(".emptyRows").addClass("e-grpRow"):this.element.find(".e-grpRow"):i.text==this._getLocalizedLabels("AddToValues")?this.element.find(".values"):i.text==this._getLocalizedLabels("AddToFilter")?this.element.find(".e-drag"):"",l={element:this._selectedMember,target:r,cancel:!1},this._pvtBtnDropped(l);else this._createCalculatedField()},_getAdvancedFilterInfo:function(i){var r=[];return this._excelFilterInfo.length>0&&(i,r=e.grep(this._excelFilterInfo,function(e){try{if(e.levelUniqueName.replace(/]/g,"").replace(/\[/g,"").indexOf(i)>-1&&!t.isNullOrUndefined(e.operator))return e}catch(e){}})),r},_createPivotButtons:function(i,l){var n,s,o,a,d,h,c,u,g,p,m=this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode;if(!t.isNullOrUndefined(i)){var _="",f="column"==l?"Columns":"row"==l?"Rows":"filter"==l?"Slicers":"Values",b="";if(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for("values"==(f="column"==l?"Columns":"row"==l?"Rows":"filter"==l?"filters":"values")&&m&&(i=e.map(i,function(e){return e.measures})),a=0;a<i.length;a++){b=i[a].fieldCaption;var C=m?"":t.PivotAnalysis.getMembers(i[a].fieldName),S=t.Pivot.getReportItemByFieldName(i[a].fieldName,this.model.dataSource),x=null!=i[a].filterItems&&i[a].filterItems.values.length>0||!t.isNullOrUndefined(i[a].advancedFilter)&&i[a].advancedFilter.length>0&&S.item&&"filters"!=S.axis?"filtered":"";"filter"==l&&("filtered"==x?b=t.Pivot._getFilterState(m,C,i[a],this):m?(t.olap._mdxParser.getAllMember(this.model.dataSource,i[a].fieldName,this),b=this._allMember):b=this._getLocalizedLabels("All")),n=m?"":i[a].sortOrder==t.PivotAnalysis.SortOrder.Descending?"descending":"",s=(i[a].fieldName||i[a]).replace(/[\(\)\[\]{}'"]/g,"").replace(/[\W]/g,"_"),_+=t.buildTag("span.e-pivotButton",t.buildTag("button.e-pvtBtn#pivotButton_"+s,(this.model.showUniqueNameOnPivotButton&&"values"!=l?i[a].fieldName.replace(/\[/g,"").replace(/\]/g,""):i[a].fieldCaption==r?i[a].fieldName:i[a].fieldCaption||i[a])+("filter"==l?" ("+b+")":""),{},{"data-fieldName":i[a].fieldName,"data-fieldCaption":i[a].fieldCaption,"data-axis":f})[0].outerHTML+(!m||"measures"!=i[a].fieldName.toLowerCase()&&(t.isNullOrUndefined(i[a].isNamedSet)||i[a].isNamedSet)?t.buildTag("span.filter e-icon "+x).attr("role","button").attr("aria-label","filter")[0].outerHTML:"")+(m?" ":t.buildTag("span.e-sorting e-icon "+n).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML)+t.buildTag("span.e-removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML).attr("data-tag",f+":"+i[a].fieldName||i[a])[0].outerHTML}else for("Values"==f&&"values"==l&&(o=this.element.find(".e-pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").length>0?this.element.find(".e-pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").parent()[0].className.split(" ")[0]:"e-schemaColumn",this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(f="e-schemaColumn"==o||"columns"==o?"Columns":"Rows")),a=0;a<i.length;a++){for(d=this._ascdes.split("##"),h=0,n="",x="",c=0;c<d.length;c++)(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&d[c]==i[a].Tag||this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&d[c]==i[a])&&(h=1);if(1==h&&(n="descending"),!t.isNullOrUndefined(this._tempFilterData))for(c=0;c<this._tempFilterData.length;c++)for(u in this._tempFilterData[c])this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?u==(i[a].FieldName||i[a].DimensionName)&&""!=this._tempFilterData[c][i[a].FieldName||i[a].DimensionName]&&(x="filtered"):this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&u==(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?i[a].Tag:i[a])&&0!=this._tempFilterData[c][i[a].Tag].indexOf("FILTERED")&&(x="filtered");this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(i[a].FieldHeader="Measures"==i[a].FieldHeader?this._getLocalizedLabels("Measures"):i[a].FieldHeader,x="filter"!=l&&this.model.enableAdvancedFilter&&this._getAdvancedFilterInfo(i[a].Tag).length>0?"filtered":x,this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(g=t.isNullOrUndefined(this._tempFilterData)?[]:e.map(this._tempFilterData,function(e){return e[i[a].DimensionName]}),"filter"==l&&(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.enableAdvancedFilter&&this._getAdvancedFilterInfo(i[a].Tag).length>0&&(x="filtered"),b=g.length>0&&x&&this._fieldMembers[i[a].DimensionName]?this._fieldMembers[i[a].DimensionName].length-g.length==1?this._fieldMembers[i[a].DimensionName].filter(function(e){if(-1==g.indexOf(e))return e}):this._getLocalizedLabels("MultipleItems"):this._getLocalizedLabels("All"))):"filter"==l&&(b=("All"==this._fieldSelectedMembers[i[a].Tag]?i[a].AllMember:this._fieldSelectedMembers[i[a].Tag])||i[a].AllMember),p="Measures"==i[a].FieldHeader||"Measures"==i[a].Tag||i[a].Tag.indexOf("::NAMEDSET")>-1?"":t.buildTag("span.filter e-icon "+x).attr("role","button").attr("aria-label","filter")[0].outerHTML,_+=t.buildTag("span.e-pivotButton",t.buildTag("span.e-dropIndicator")[0].outerHTML+t.buildTag("button.e-pvtBtn#pivotButton"+i[a].FieldHeader||i[a].FieldName||i[a].Name||i[a].DimensionHeader||i[a].DimensionName,(this.model.showUniqueNameOnPivotButton&&"values"!=l?i[a].Tag:i[a].FieldHeader||i[a].FieldName||i[a].Name||i[a].DimensionHeader||i[a].DimensionName)+("filter"==l?" ("+b+")":""),{},this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?{"data-fieldName":i[a].FieldName||i[a].DimensionName||i[a].FieldHeader||i[a].DimensionHeader,"data-fieldCaption":i[a].FieldHeader||i[a].DimensionHeader||i[a].FieldName||i[a].DimensionName}:{"data-fieldCaption":i[a].FieldHeader})[0].outerHTML+p+t.buildTag("span.e-sorting e-icon "+n).attr("role","button").attr("aria-label","sort")[0].outerHTML+t.buildTag("span.e-removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML).attr("data-tag",f+":"+i[a].Tag)[0].outerHTML):_+=t.buildTag("span.e-pivotButton",t.buildTag("span.e-dropIndicator")[0].outerHTML+t.buildTag("button.e-pvtBtn#pivotButton"+i[a],i[a])[0].outerHTML+t.buildTag("span.filter e-icon "+x).attr("role","button").attr("aria-label","filter")[0].outerHTML+t.buildTag("span.e-sorting e-icon "+n).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML+t.buildTag("span.e-removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML).attr("data-tag",f+":"+i[a])[0].outerHTML}return _}},_createFields:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m;if(this.element.find(".groupingBarPivot").remove(),this.model.enableVirtualScrolling&&this.element.find(".virtualScrollGrid").length>0?this.element.find(".virtualScrollGrid").prepend(t.buildTag("div#groupingBarPivot.groupingBarPivot")[0].outerHTML):this.element.prepend(t.buildTag("div#groupingBarPivot.groupingBarPivot")[0].outerHTML),this.element.find(".groupingBarPivot").prepend(t.buildTag("div.valueColumn",t.buildTag("span.values").attr("aria-label","values")[0].outerHTML+t.buildTag("span.columns").attr("aria-label","column")[0].outerHTML,{width:"100%"})),this.element.find(".groupingBarPivot").prepend(t.buildTag("div.e-drag",t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("DragFieldHere"),{width:"100%"}).attr("aria-label","filter")[0].outerHTML),""!=this._pivotFilter&&null!=this._pivotFilter&&this.element.find(".e-drag").text("").attr("aria-label","filter"),this.element.find(".e-drag").append(this._pivotFilter),this.element.find(".values").append(this._pivotCalculation),this.element.find(".columns").append(this._pivotColumn),0==this.element.find(".values .e-pivotButton").length&&this.element.find(".values").append(t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("ValueArea")),0==this.element.find(".columns .e-pivotButton").length&&this.element.find(".columns").append(t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("ColumnArea")),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&0==this.element.find(".e-rows").length&&!t.isNullOrUndefined(this.getJSONRecords())&&this.getJSONRecords().length>0&&"colheader"==this.getJSONRecords()[0].CSS?(this.element.find(".e-pivotGridTable thead tr:first").prepend(t.buildTag("th.e-grpRow",t.buildTag("div.e-rows",t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("RowArea"))[0].outerHTML,{},{rowspan:this.element.find("thead tr").length})[0].outerHTML),this.element.find(".e-pivotGridTable tbody tr:first").prepend(t.buildTag("td.rowheader",this._getLocalizedLabels("Total"))[0].outerHTML)):0==this.element.find(".e-rows .e-pivotButton").length&&(this.element.find(".e-rows").text("").children("span").remove(),this.element.find(".e-rows").append(t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("RowArea"))),(0==this.element.find(".rowheader").length&&0==this.element.find(".colheader").length&&0==this.element.find(".values .e-pivotButton").length||0==this.element.find(".e-pivotGridTable th").length)&&(i=t.buildTag("div.emptyRows",t.buildTag("span.e-rows",""!=this._pivotRow?this._pivotRow:this._getLocalizedLabels("RowArea"),{width:"5px"})[0].outerHTML,{width:140})[0].outerHTML,0==this.element.find(".e-rows").length&&this.element.find(".groupingBarPivot").append(i),this.model.enableDeferUpdate&&""!=this._pivotRow&&(this.element.find(".e-rows").text(""),this.element.find(".e-rows").append(this._pivotRow)),(null==this.getJSONRecords()||0==this.getJSONRecords().length)&&this.element.find(".groupingBarPivot").addClass("emptyPivotGrid"),this.element.find(".emptyRows,.e-rows").ejDroppable({})),this.element.find(".values").find(".filter").remove(),this.element.find(".values").find(".e-sorting").remove(),this.element.find(".e-drag").find(".e-sorting").remove(),this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.element.find(".e-pivotButton").find(".e-sorting").remove(),(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&(this.element.find(".e-rows").width(this.element.find(".pivotGridRowTable").width()),this._setGroupingBarFrozenRowBtnWidth()),this.element.find(".e-pivotButton .e-pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._clientPvtBtnDropped:this._pvtBtnDropped,this),helper:t.proxy(function(t){return e(t.element).parent().addClass("dragHover"),e(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1&&e(t.sender.target).clone().addClass("dragClone").appendTo(this.element)},this)}),t.browserInfo().name.indexOf("moz")>-1&&(this.element.find(".columns .e-btn, .e-rows .e-btn").addClass("e-pvtBtnIndent"),this.element.find(".columns .e-sorting,.e-rows .e-sorting").addClass("e-pvtBtnSort")),this.element.find(".e-drag, .values, .columns, .e-grpRow, .e-rows").ejDroppable({}),this.element.find(".e-pivotGridTable").find("thead th:eq(1), tbody td.value:eq(0)").length>0)this.element.find(".groupingBarPivot").width(this.element.find(".e-pivotGridTable").width());else if(0==this.element.find(".columns .e-pivotButton").length||0==this.element.find(".values .e-pivotButton").length&&1==this.element.find(".columns .e-pivotButton").length)this.element.find(".groupingBarPivot").width(300);else{for(r=0,g=0;g<e(this.element.find(".columns .e-pivotButton")).length;g++)r=Math.max(e(this.element.find(".columns .e-pivotButton")[g]).width(),r);r<140&&this.element.find(".columns").css("min-width",r+"px"),l=r*e(this.element.find(".columns .e-pivotButton")).length+this.element.find(".values").width()+10,this.element.find(".groupingBarPivot").width(l)}for((this.element.find(".e-rows").width()>140||this.model.enableDeferUpdate&&this.element.find(".e-rows").width()<this.element.find(".e-grpRow").width()&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)&&(this.enableDeferUpdate?this.element.find(".e-rows").width(0==this.element.find(".colheader").length?this.element.find(".e-grpRow").width()-140:this.element.find(".e-grpRow").width()):this.model.isResponsive||this.element.find(".e-rows").width(this.model.enableDeferUpdate?this.element.find(".e-grpRow").width()-8:this.element.find(".e-grpRow").width())),(this.element.find(".e-pivotGridTable thead").length>0||this.model.enableDeferUpdate&&0==this.element.find(".e-pivotGridTable thead").length&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&(this.model.isResponsive&&0==this.element.find(".values .e-pivotButton").length&&0==this.element.find(".columns .e-pivotButton").length?this.element.find(".values").width(140):this.element.find(".values").width(this.element.find(".e-grpRow").length>0?this.model.enableDeferUpdate&&0==this.element.find(".colheader").length?this.element.find(".e-grpRow").width():this.element.find(".e-grpRow").width()+3:140),this.model.enableDeferUpdate&&0==this.element.find(".colheader").length&&0!=this.element.find(".e-pivotGridTable .rowheader").length&&((u=this.element.find(".groupingBarPivot").width()-this.element.find(".values").width())<140&&this.element.find(".groupingBarPivot").width(this.element.find(".groupingBarPivot").width()+140)),this.element.find(".e-pivotGridTable").find("thead th:eq(1), tbody td.value:eq(0)").length>0||this.model.enableDeferUpdate&&0==this.element.find(".columns .e-pivotButton").length||this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?(C=this.element.find(".e-pivotGridTable").width()-this.element.find(".values").width()-4,0==this.element.find(".e-pivotGridTable").find("thead th:eq(2), tbody td:eq(1)").length?(this.element.find(".columns").css("min-width",C>=30&&0==this.element.find(".e-pivotGridTable .colheader").length&&0==this.element.find(".columns .e-pivotButton").length?140:C).width(C>=30&&0==this.element.find(".e-pivotGridTable .colheader").length&&0==this.element.find(".columns .e-pivotButton").length?82:C),this.element.find(".values").height(C>=30&&0==this.element.find(".e-pivotGridTable .colheader").length&&0==this.element.find(".columns .e-pivotButton").length?this.element.find(".columns").height():this.element.find(".values").height()),(0==this.element.find(".columns .e-pivotButton").length||this.model.enableDeferUpdate&&0==this.element.find(".e-pivotGridTable .colheader").length)&&(0==this.element.find(".columns .e-pivotButton").length&&(C=this.element.find(".groupingBarPivot").width()-this.element.find(".values").width()-5,this.element.find(".columns").width(C),C<140&&(1==e(".groupingBarPivot .values .e-pivotButton").length||0==e(".groupingBarPivot .values .e-pivotButton").length&&this.model.enableDeferUpdate)&&this.element.find(".columns").css("min-width",C+"px")),this.element.find(".columns").addClass("e-widthSetter"))):C<140?e(".columns .e-pivotButton").length<2?this.element.find(".columns").css("min-width",C).addClass("e-widthSetter"):(this.element.find(".columns").width(C).css("min-width",C),this.element.find(".values").height(this.element.find(".columns").height())):this.element.find(".columns").width(C)):0!=this.element.find(".e-pivotGridTable").find("thead th:eq(1)").length||this.model.enableDeferUpdate||(0==this.element.find(".columns .e-pivotButton").length&&this.element.find(".columns").addClass("e-widthSetter"),n=this.element.find(".columns .e-pivotButton").length<1?1:this.element.find(".columns .e-pivotButton").length,this.element.find(".columns").css("min-width",(this.element.find(".groupingBarPivot").width()-this.element.find(".values").width()-7)/n))),null!=this.model.dataSource.data&&""==this.model.url&&(s=0,e(".columns .e-pivotButton").each(function(){s+=parseInt(e(this).width()+10)}),e(".valueColumn").height()>30&&0==this.element.find(".values button").length&&this.element.find(".columns").width()<s&&(_=this.element.find(".columns .e-pivotButton").length,f=(this.element.find(".valueColumn").width()-this.element.find(".values").width())/(0==_?1:_)-70,this.element.find(".columns .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"}))),this.element.find(".columns").height()>47?(f=this.model.isResponsive?this.element.find(".columns").width()/this.element.find(".columns .e-pivotButton").length-5:this.element.find(".columns").width()/2-60,this.element.find(".columns .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})):this.element.find(".columns .e-pivotButton").width()>this.element.find(".columns").width()&&(f=this.element.find(".columns").width()-(this.element.find(".columns .e-pivotButton").width()-this.element.find(".columns .e-pivotButton .e-pvtBtn").width()+40),this.element.find(".columns .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})),this.element.find(".e-drag").height()>47?(f=this.element.find(".groupingBarPivot").width()/4-35,this.element.find(".e-drag .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})):this.element.find(".e-drag .e-pivotButton").width()>this.element.find(".e-drag").width()&&(f=this.element.find(".e-drag").width()-(this.element.find(".e-drag .e-pivotButton").width()-this.element.find(".e-drag .e-pivotButton .e-pvtBtn").width()+40),this.element.find(".e-drag .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})),this.element.find(".values").height()>47?(f=this.model.isResponsive?this.element.find(".values").width()/this.element.find(".values .e-pivotButton").length-5:this.element.find(".values").width()/2-40,this.element.find(".values .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})):(this.element.find(".values .e-pivotButton").width()>this.element.find(".values").width()||!this.model.enableDeferUpdate&&0==this.element.find(".e-pivotGridTable").find("thead th:eq(1), tbody td.value:eq(0)").length&&this.element.find(".values .e-pivotButton").length>0)&&(f=this.element.find(".values").width()-(this.element.find(".values .e-pivotButton").width()-this.element.find(".values .e-pivotButton .e-pvtBtn").width()+20),this.element.find(".values .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})),o=0,g=0;g<this.element.find(".e-rows .e-pivotButton").length;g++)o+=this.element.find(".e-rows .e-pivotButton:eq("+g+")").width();if(o-20>this.element.find(".e-rows").width()||this.element.find(".colfreeze").length-20>0&&o>this.element.find(".colfreeze").width()||this.element.find(".e-rows").parent(".emptyRows").length>0&&this.element.find(".e-rows").parent(".emptyRows").width()<o){var _,f=0,b=this.element.find(".colfreeze").length>0?".colfreeze":".e-rows";f=this.element.find(b).parent().height()/(this.element.find(b+" .e-pivotButton").eq(0).height()*(_=this.element.find(b+" .e-pivotButton").length))>=1?"auto":this.element.find(b).width()/2-40,this.element.find(".e-rows .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})}if((this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(0==this.element.find(".values .e-pvtBtn").length||0==this.element.find(".columns .e-pvtBtn").length)&&(this.element.find(".e-rows").width()>this.element.find(".values").width()||this.element.find(".e-rows").width()>this.element.find(".columns").width())&&140==this.element.find(".emptyRows").width()||this.model.enableDeferUpdate&&this.element.find(".values .e-pvtBtn").length<=1&&this.element.find(".columns .e-pvtBtn").length<=1)&&(a=this.element.find(".e-rows").width(),d=this.element.find(".values").width()+this.element.find(".columns").width(),this.element.find(".values").css({"min-width":a,width:a}),h=this.element.find(".values").width(),this.element.find(".columns").css({"min-width":d-h,width:d-h}),this.element.find(".columns .e-pvtBtn,.values .e-pvtBtn").width("auto").css({"text-overflow":"ellipsis"}),this.element.find(".emptyRows").width(a)),this.model.enableDeferUpdate&&0!=this.element.find(".columns .e-pivotButton").length&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){for(c=0,u=0,g=0;this.element.find(".columns .e-pivotButton").length>g;g++)c=this.element.find(".columns .e-pivotButton:eq("+g+")").width()+c+7;if(c>=(u=this.element.find(".e-pivotGridFrozenTable").width())){var C;f=(C=0==(this.element.find(".e-pivotGridTable .colheader").length>0?1:0)?140:u)/(this.model.enableDeferUpdate?this.element.find(".columns .e-pivotButton").length:3)-15;this.model.enableDeferUpdate?this.element.find(".columns .e-pvtBtn").width(30).css({"text-overflow":"ellipsis"}):this.element.find(".columns .e-pvtBtn").width(f).css({"text-overflow":"ellipsis"})}}(this.element.find(".values").height()>this.element.find(".columns").height()||this.element.find(".columns").height()>this.element.find(".values").height())&&(this.element.find(".values").height()>this.element.find(".columns").height()?this.element.find(".columns").height(this.element.find(".values").height()):this.element.find(".values").height(this.element.find(".columns").height())),this.element.find(".colheader, .rowheader, .value").addClass("e-droppable"),this.element.find(".summary").removeClass("e-droppable"),this.model.enableGroupingBar&&(p=this.element.find(".e-pvtBtn"),m=t.buildTag("ul.pivotTree#pivotTree",(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?t.buildTag("li.e-calculatedFieldMenuItem",t.buildTag("a.menuItem",this._getLocalizedLabels("CalculatedField"))[0].outerHTML)[0].outerHTML:" ")+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToFilter"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToRow"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToColumn"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToValues"))[0].outerHTML)[0].outerHTML)[0].outerHTML,e(this.element).append(m),e("#pivotTree").ejMenu({menuType:t.MenuType.ContextMenu,enableRTL:this.model.enableRTL,openOnClick:!1,contextMenuTarget:p,click:t.proxy(this._pivotContextClick,this),beforeOpen:t.proxy(this._contextOpen,this),close:t.proxy(t.Pivot.closePreventPanel,this)}))},_clientPvtBtnDropped:function(i){var r,l,n,s,o;t.PivotAnalysis._valueSorting=null,this._isDragging=!1,t.Pivot.openPreventPanel(this),i.element.removeClass("dragHover").css("background-color","inherit"),i.element.parent().removeClass("dragHover"),this.element.find(".dragClone").remove(),this.element.find(".e-dropIndicator").removeClass("e-dropIndicatorHover"),this.element.find(".dragClone,.e-dropIndicator").remove();var a=e(i.target).hasClass("columns")||e(i.target).parents(".columns").length>0?"column":e(i.target).hasClass("e-grpRow")||e(i.target).parents(".e-grpRow").length>0||e(i.target).hasClass("e-rows")?"row":e(i.target).hasClass("values")||e(i.target).parents(".values").length>0?"value":e(i.target).hasClass("e-drag")||e(i.target).parents(".e-drag").length>0?"filter":"",d=i.element.text(),h=e(i.element).attr("data-fieldName");if(""!=a&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(h.toLowerCase().indexOf("[measures]")>=0&&"value"!=a||h==this._getLocalizedLabels("Measures")&&"row"!=a&&"column"!=a||h.toLowerCase().indexOf("[measures]")<0&&"value"==a))t.Pivot._createErrorDialog(this._getLocalizedLabels("GroupingBarAlertMsg"),this._getLocalizedLabels("Warning"),this);else{if(""==a&&this._schemaData)if("measures"==d.toLowerCase()&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap)for(r=0;this.model.dataSource.values[0].measures.length>0;)selectedTreeNode=this._schemaData._tableTreeObj.element.find("li[data-tag='"+this.model.dataSource.values[0].measures[r].fieldName+"']"),this._schemaData._tableTreeObj.uncheckNode(selectedTreeNode);else this._schemaData&&(l=this._schemaData._tableTreeObj.element.find("li:contains('"+d+"')"),this._schemaData._tableTreeObj.uncheckNode(l));if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&""!=a&&"value"!=a&&e.grep(this._calculatedField,function(e){return e.name==h}).length>0)return t.Pivot._createErrorDialog(this._getLocalizedLabels("CalcValue"),this._getLocalizedLabels("Warning"),this),void this.element.find(".dragClone,.e-dropIndicator").remove();var c=""==a?"":this._setSplitBtnTargetPos(i.event,a,"drop"),u=""==a?"":this._setSplitBtnTargetPos(i,a,"original"),g=e(i.element).hasClass("columns")||e(i.element).parents(".columns").length>0?"column":e(i.element).hasClass("e-grpRow")||e(i.element).parents(".e-grpRow").length>0||e(i.element).hasClass("e-rows")?"row":e(i.element).hasClass("values")||e(i.element).parents(".values").length>0?"value":e(i.element).hasClass("e-drag")||e(i.element).parents(".e-drag").length>0?"filter":"";""!=a&&a.toLowerCase()==g.toLowerCase()&&c>u&&(c-=1),n={droppedFieldName:h,droppedFieldCaption:d,droppedClass:a,droppedPosition:c,isMeasuresDropped:0==h.toLocaleLowerCase().indexOf("measures")},this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._calculatedField.length>0&&"value"!=a?this.model.dataSource.values=e.grep(this.model.dataSource.values,function(e){return t.isNullOrUndefined(e.isCalculatedField)||0==e.isCalculatedField||1==e.isCalculatedField&&-1==e.formula.indexOf(n.droppedFieldName)}):this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this._fieldMembers={},this._fieldSelectedMembers={},this.model.dataSource=this.clearDrilledItems(this.model.dataSource,{action:"pvtBtnDropped"},this)),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),t.Pivot.addReportItem(this.model.dataSource,n),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(s=e.grep(this.model.dataSource.values,function(e){return 1==e.isCalculatedField}),this.model.dataSource.values=e.grep(this.model.dataSource.values,function(e){return t.isNullOrUndefined(e.isCalculatedField)||0==e.isCalculatedField}),e.merge(this.model.dataSource.values,s)),(this.model.enableAdvancedFilter||this.model.dataSource.enableAdvancedFilter)&&"filter"==a&&((o=t.Pivot.getReportItemByFieldName(this._selectedField,this.model.dataSource).item)&&o.advancedFilter&&(o.advancedFilter=[])),this.refreshControl(),t.isNullOrUndefined(this._schemaData)||(null==t.Pivot.getReportItemByFieldName(h,this.model.dataSource).item&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._schemaData._tableTreeObj.element.find("li[data-tag='"+h+"']").removeClass("filter").find(".treeDrop,.filter").remove(),this._schemaData._refreshPivotButtons())}},_pvtBtnDropped:function(i){var r,l,n,s,o,a,d,h,c,u,g;t.Pivot.openPreventPanel(this),e(i.element).parent().removeClass("dragHover"),e(i.element).removeClass("dragHover"),this._isUpdateRequired=!0,r="",this._isDragging=!1,this.element.find(".e-dropIndicator").removeClass("e-dropIndicatorHover");var p,m,_=null,f="",b="",C=!1;if(l="e-grpRow"==(l=t.isNullOrUndefined(i.target.className)?e(i.target).hasClass("columns")?"columns":e(i.target).hasClass("e-grpRow")?"e-rows":e(i.target).hasClass("values")?"values":e(i.target).hasClass("e-drag")?"e-drag":"":i.target.className.indexOf("e-droppable")>=0?i.target.className.split(" ")[0]:"")?"e-rows":l,m=e(i.element).parent().find(".filtered").length>0,this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)for(e(i.target).hasClass("e-pvtBtn")&&this.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode&&(l=e(i.target).attr("data-axis").toLowerCase()),p=t.isNullOrUndefined(i.element.attr("data-fieldCaption"))?i.element.text():i.element.attr("data-fieldCaption"),C=e(i.element).parent().find(".descending").length>0,""==l&&("BUTTON"==i.target.tagName||"SPAN"==i.target.tagName)&&(l=i.target.parentNode.parentElement.className.split(" ")[0]),n=0;n<this._pivotTableFields.length;n++)this._pivotTableFields[n].name==p&&(this._pivotTableFields[n].isSelected=!0,b=this._pivotTableFields[n]);else t.isNullOrUndefined(i.target.className)?(_=e(i.target),f=e(i.target).hasClass("columns")?"Categorical":e(i.target).hasClass("e-grpRow")?"Series":e(i.target).hasClass("e-drag")?"Slicer":"",l=e(i.target).hasClass("columns")?"columns":e(i.target).hasClass("e-grpRow")?"e-rows":e(i.target).hasClass("values")?"values":e(i.target).hasClass("e-drag")?"e-drag":""):(f="columns"==(_=i.target.className.indexOf("e-pvtBtn")>-1?e(i.target).parents(".e-droppable")[0]:i.target.className.indexOf("e-droppable")?i.target:"td"==i.target[0].tagName.toLowerCase()?i.target.children(":last")[0]:i.target).className.split(" ")[0]?"Categorical":"e-rows"==_.className.split(" ")[0]||"e-grpRow"==_.className.split(" ")[0]?"Series":"filters"==_.className.split(" ")[0]?"Slicer":"",l=_.className.split(" ")[0]),""==f&&(i.element.parent().attr("data-tag").indexOf("[Measures]")>-1||i.element.parent().attr("data-tag").indexOf("KPI")>-1)&&(f=this.element.find(".e-schemaRow .e-pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").length>0?"Series":"Categorical"),t.isNullOrUndefined(i.element.parent())||(r=i.element.parents(".values").length>0?"values":i.element.parents(".e-drag").length>0?"e-drag":i.element.parents(".e-grpRow").length>0?"e-rows":i.element.parents(".columns").length>0?"columns":""),b=e(i.element.parent()[0]).attr("data-tag"),l="e-grpRow"==l?"e-rows":l,f="e-grpRow"==f?"Series":f,p=i.element.text();if(this.element.find(".dragClone").remove(),this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(("MEASURES"==b.split(":")[1].toLocaleUpperCase()||"KPI"==b.split(":")[1].toLocaleUpperCase())&&("columns"!=l||"e-rows"!=l)&&("e-drag"==l||"values"==l)||b.toUpperCase().indexOf("[MEASURES]")>-1&&"values"!=l&&("e-rows"==l||"columns"==l||"e-drag"==l)||(-1==b.toUpperCase().indexOf("[MEASURES]")||-1==b.toUpperCase().indexOf("KPI"))&&"values"==l&&l!=r))return t.Pivot._createErrorDialog(this._getLocalizedLabels("GroupingBarAlertMsg"),this._getLocalizedLabels("Error"),this),this.element.find(".dragClone,.e-dropIndicator").remove(),i.element.parent().removeAttr("style"),i.element.css("background-color","inherit"),!1;if("e-rows"==l||"columns"==l||"values"==l||"e-drag"==l){if(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&"values"!=l&&(e.grep(this._calculatedField,function(e){return e.name==p}).length>0||e.grep(JSON.parse(this.getOlapReport()).PivotCalculations,function(e){return e.FieldHeader==p&&8==e.CalculationType}).length>0))return t.Pivot._createErrorDialog(this._getLocalizedLabels("CalcValue"),this._getLocalizedLabels("Warning"),this),i.element.parent().removeAttr("style"),void i.element.css("background-color","inherit");s=this._setSplitBtnTargetPos(i,l,"drop"),o=this._setSplitBtnTargetPos(i,l,"original"),"e-drag"==l&&this.element.find(".e-drag").text("").attr("aria-label","filter");try{a=JSON.parse(this.getOlapReport()).Report}catch(e){a=this.getOlapReport()}if(e(i.element.parent()).remove(),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)v=i.element.parents(".e-pivotButton").attr("data-tag").split(":")[0],this._waitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),e.isNumeric(s)&&l==v.toLowerCase()&&s>o&&(s-=1),l="e-rows"==l?"schemaRow":"columns"==l?"schemaColumn":"e-drag"==l?"schemaFilter":"values"==l?"schemaValue":"",this.model.analysisMode==t.Pivot.AnalysisMode.Olap?(this.model.enableAdvancedFilter&&"schemaFilter"==l&&!t.isNullOrUndefined(this._curFilteredText)&&this._curFilteredText.indexOf(":")>-1&&((c=this._getAdvancedFilterInfo(this._curFilteredText.split(":")[1])).length>0&&this._removeFilterTag(c[0].levelUniqueName)),f="schemaFilter"==l?"Slicer":f,d=JSON.parse(this._olapReport).CurrentCube+"--"+b+"--"+f+"--"+s,null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),u=JSON.stringify(this.model.customObject),h=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:d,currentReport:a,gridLayout:this.model.layout,customObject:u}),this.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,h.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtBtnDroppedSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,h,this._pvtBtnDroppedSuccess)):(this._calculatedField.length>0&&"schemaValue"!=l&&null!=this._schemaData&&this._calculatedFieldNodeRemove(b),null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),u=JSON.stringify(this.model.customObject),g=t.Pivot._getFilterParams(l,this._tempFilterData,p),h=JSON.stringify({action:"nodeDropped",dropAxis:l+"::"+s,headerTag:JSON.stringify(b),sortedHeaders:this._ascdes,filterParams:g,currentReport:a,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:u}),this._renderControlSuccess,this.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,h.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtBtnDroppedSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,h,this._pvtBtnDroppedSuccess));else{if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&"values"!=l&&e.grep(this._calculatedField,function(e){return e.name==p}).length>0)return t.Pivot._createErrorDialog(this._getLocalizedLabels("CalcValue"),this._getLocalizedLabels("Warning"),this),this.model.editCellsInfo={},void this._populatePivotGrid();var S=this._getDroppedItem(p),x={fieldName:S[0].fieldName,fieldCaption:S[0].fieldCaption},v=i.element.parents(".e-pivotButton").attr("data-tag").split(":")[0];this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&S.length>0&&"e-drag"==l&&(S[0].advancedFilter=[]),e.isNumeric(s)?l==v.toLowerCase()&&s>o?"e-rows"==l?this.model.dataSource.rows.splice(s-1,0,S[0]):"columns"==l?this.model.dataSource.columns.splice(s-1,0,S[0]):"values"==l?this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.dataSource.values[0].measures.splice(s-1,0,S[0]):this.model.dataSource.values.splice(s,0,S[0]):this.model.dataSource.filters.splice(s,0,S[0]):"e-rows"==l?this.model.dataSource.rows.splice(s,0,S[0]):"columns"==l?this.model.dataSource.columns.splice(s,0,S[0]):"values"==l?this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.dataSource.values[0].measures.splice(s,0,S[0]):this.model.dataSource.values.splice(s,0,S[0]):this.model.dataSource.filters.splice(s,0,S[0]):"e-rows"==l?this.model.dataSource.rows.push(S[0]):"columns"==l?this.model.dataSource.columns.push(S[0]):"values"==l?this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.dataSource.values[0].measures.push(S[0]):this.model.dataSource.values.push(S[0]):this.model.dataSource.filters.push(S[0]),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._calculatedField.length>0&&"values"!=l&&(null!=this._schemaData&&this._calcFieldNodeDrop(S[0]),this.model.dataSource.values=e.grep(this.model.dataSource.values,function(e){return t.isNullOrUndefined(e.isCalculatedField)||0==e.isCalculatedField||1==e.isCalculatedField&&-1==e.formula.indexOf(S[0].fieldName)})),this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.dataSource=this.clearDrilledItems(this.model.dataSource,{action:"pvtBtnDropped"},this)),null!=this._schemaData&&(l==v&&s>o&&(s-=1),this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this._schemaData.element.find("button[data-fieldName='"+p+"']").remove():this._schemaData.element.find("#pivotButton"+p).parent().remove(),this._schemaData._createPivotButton(x,"e-rows"==l?"row":"columns"==l?"column":"e-drag"==l?"filter":"values"==l?"value":"",m,C,s)),this.model.analysisMode==t.Pivot.AnalysisMode.Olap?(t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),this.getJSONData({action:"pvtBtnDropped"},this.model.dataSource,this)):(this.model.editCellsInfo={},this._populatePivotGrid())}}else this._removePvtBtn(i);t.isNullOrUndefined(this._schemaData)||this._schemaData._setPivotBtnWidth()},_getDroppedItem1:function(i){this.model.analysisMode,t.Pivot.AnalysisMode.Olap;var r,l=e.grep(this.model.dataSource.columns,function(e){return e.fieldName==i});return l.length>0?this.model.dataSource.columns=e.grep(this.model.dataSource.columns,function(e){return e.fieldName!=i}):(l=e.grep(this.model.dataSource.rows,function(e){return e.fieldName==i})).length>0?this.model.dataSource.rows=e.grep(this.model.dataSource.rows,function(e){return e.fieldName!=i}):(r=this.model.dataSource.values,this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(r=this.model.dataSource.values[0].measures),(l=e.grep(r,function(e){return e.fieldName==i})).length>0?this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.dataSource.values[0].measures=e.grep(r,function(e){return e.fieldName!=i}):this.model.dataSource.values=e.grep(r,function(e){return e.fieldName!=i}):(l=e.grep(this.model.dataSource.filters,function(e){return e.fieldName==i})).length>0&&(this.model.dataSource.filters=e.grep(this.model.dataSource.filters,function(e){return e.fieldName!=i}))),l},_clearCollapsedItems:function(t,i,l){return"rowheader"==t?l.rows=e.map(l.rows,function(t){return t.drilledItems!=r&&t.drilledItems.length&&(t.drilledItems=e.map(t.drilledItems,function(e){if(e.join("").indexOf(i.repItms.replace(/&/g,"&amp;"))<0)return[e]})),t}):"colheader"==t&&(l.columns=e.map(l.columns,function(t){return t.drilledItems!=r&&t.drilledItems.length&&(t.drilledItems=e.map(t.drilledItems,function(e){if(e.join("").indexOf(i.repItms.replace(/&/g,"&amp;"))<0)return[e]})),t})),l},_setSplitBtnTargetPos:function(t,i,r){var l,n,s,o="";for(n="drop"==r?e(t.target).parents(".e-pivotButton"):e(t.element).parents(".e-pivotButton"),i="column"==i?"columns":"row"==i?"e-rows":"filter"==i?"e-drag":"value"==i?"values":i,l=this.element.find("."+i).children(".e-pivotButton"),s=0;s<l.length;s++)e(l[s]).attr("data-tag")==e(n).attr("data-tag")&&(o=s);return o},_pvtBtnDroppedSuccess:function(e){!t.isNullOrUndefined(e[0])&&e.length>0?null!=e[2]&&e[2]!=r&&(this.model.customObject=e[2].Value):!t.isNullOrUndefined(e.d)&&e.d.length>0?null!=e.d[2]&&e.d[2]!=r&&(this.model.customObject=e.d[2].Value):t.isNullOrUndefined(e)||t.isNullOrUndefined(e.OlapReport)||null!=e&&e.customObject!=r&&(this.model.customObject=e.customObject),null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),this.model.enableDeferUpdate?this._deferUpdateSuccess(e):this._renderControlSuccess(e),null!=this._schemaData&&this._schemaData._refreshPivotButtons()},_deferUpdateSuccess:function(i){if(t.isNullOrUndefined(i.PivotReport)&&t.isNullOrUndefined(i.OlapReport)?(this.setOlapReport(i.d[0].Value),null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(i.d[2].Value),JSON.parse(i.d[1].Value))):(t.isNullOrUndefined(i.PivotReport)?this.setOlapReport(i.OlapReport):this.setOlapReport(i.PivotReport),i.HeaderCounts!=r&&null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(i.HeaderCounts),JSON.parse(i.PageSettings))),this.model.enableGroupingBar){var l=JSON.parse(this.getOlapReport());this._pivotTableFields=JSON.parse(l.ItemsProperties),this._createGroupingBar(l),this.element.find(".e-grpRow .e-rows").text(""),this.element.find(".e-grpRow .e-rows").children().remove(),this.element.find(".e-grpRow .e-rows").append(this._pivotRow),this._createFields(null,e("#"+this._id).find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth())}this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._calculatedField.length>0&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&null!=this._schemaData&&this._schemaButtonCreate(),t.Pivot.closePreventPanel(this)},_clientRemovePvtBtn:function(i){t.PivotAnalysis._valueSorting=null,t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show();var r=e(e(i.target).siblings()[0]).attr("data-fieldName");delete this._fieldMembers[r.toLowerCase()],delete this._fieldSelectedMembers[r.toLowerCase()],this._calculatedField.length>0&&e.grep(this.model.dataSource.values,function(e){return e.fieldName==r}).length>0?this.model.dataSource.values=e.grep(this.model.dataSource.values,function(e){return(null==e.isCalculatedField||0==e.isCalculatedField||-1==e.formula.indexOf(r))&&e.fieldName!=r}):t.Pivot.removeReportItem(this.model.dataSource,r,0==r.toLocaleLowerCase().indexOf("measures")),this.refreshControl(),t.isNullOrUndefined(this._schemaData)||(this._schemaData._tableTreeObj.element.find("li[data-tag='"+r+"']").removeClass("filter").find(".treeDrop,.filter").remove(),this._schemaData.refreshControl())},_removePvtBtn:function(i){var r,l,n,s,o,a,d,h;if(this._isUpdateRequired=!0,this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if("click"==i.type){var c=e(e(i.target).siblings()[0]).attr("data-fieldName"),u="",g="";e(e(i.target).siblings()[0]).text()}else{c=i.element.attr("data-fieldName"),u="",g="";i.element.text()}for(s=0;s<this.element.find(".e-pivotButton").length;s++)(g=e(this.element.find(".e-pivotButton")[s]).find("button").attr("data-fieldName"))==c&&(u=e(this.element.find(".e-pivotButton")[s]));if(e(u).remove(),null!=this._schemaData){if(d=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this._schemaData._tableTreeObj.element.find("li [data-tag='"+c+"']"):this._schemaData._tableTreeObj.element.find("li[id='"+c+"']"),this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&0==d.length&&"measures"==c.toLowerCase()){for(this._schemaData.element.find("div[data-tag='"+u.attr("data-tag")+"']").remove(),s=0;s<this.model.dataSource.values[0].measures.length;s++)this._schemaData._nodeCheck=!0,selectedTreeNode=this._schemaData._tableTreeObj.element.find("li[data-tag='"+this.model.dataSource.values[0].measures[s].fieldName+"']"),this._schemaData._tableTreeObj.uncheckNode(selectedTreeNode),this.element.find("div[data-tag='values:"+this.model.dataSource.values[0].measures[s].fieldName+"']").remove(),this._schemaData.element.find("div[data-tag='values:"+this.model.dataSource.values[0].measures[s].fieldName+"']").remove();this.model.dataSource.values[0].measures=[],t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),this.getJSONData({action:"removeBtn"},this.model.dataSource,this)}this._schemaData._tableTreeObj.uncheckNode(d)}else this.model.dataSource.columns=e.grep(this.model.dataSource.columns,function(e){return e.fieldName!=c}),this.model.dataSource.rows=e.grep(this.model.dataSource.rows,function(e){return e.fieldName!=c}),this.model.analysisMode==t.Pivot.AnalysisMode.Olap?"measures"==u.attr("data-tag").split(":")[1].toLowerCase()?this.model.dataSource.values[0].measures=[]:this._getItemPosition(this.model.dataSource.values[0].measures,u.attr("data-tag").split(":")[1]).length>0&&this.model.dataSource.values[0].measures.splice(this._getItemPosition(this.model.dataSource.values[0].measures,u.attr("data-tag").split(":")[1])[0],1):this.model.dataSource.values=this._calculatedField.length>0?e.grep(this.model.dataSource.values,function(e){return(null==e.isCalculatedField||0==e.isCalculatedField||-1==e.formula.indexOf(c))&&e.fieldName!=c}):e.grep(this.model.dataSource.values,function(e){return e.fieldName!=c}),this.model.dataSource.filters=e.grep(this.model.dataSource.filters,function(e){return e.fieldName!=c}),this.model.analysisMode!=t.Pivot.AnalysisMode.Olap&&this.model.operationalMode!=t.Pivot.OperationalMode.ClientMode?(this.model.editCellsInfo={},this._populatePivotGrid()):(t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),this.model.dataSource=this.clearDrilledItems(this.model.dataSource,{action:"removeButton"},this),this.getJSONData({action:"removeButton"},this.model.dataSource,this))}else{if("click"==i.type?(c=e(e(i.target).siblings("button")).attr("data-fieldCaption"),m=e(e(i.target).siblings("button")).parent().attr("data-tag")):(c=i.element.attr("data-fieldCaption"),m=i.element.parent().attr("data-tag")),!t.isNullOrUndefined(this._tempFilterData)&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap)for(r=0;r<this._tempFilterData.length;r++)for(l in this._tempFilterData[r])l==m.split(":")[1]&&""!=this._tempFilterData[r][m.split(":")[1]]&&this._tempFilterData.splice(r,1);delete this._fieldMembers[m.split(":")[m.split(":").length-1]],delete this._fieldSelectedMembers[m.split(":")[m.split(":").length-1]];var p="",m=(u="",""),_=(g="","");for(u=this.element.find(".e-pivotButton:contains("+c+")"),s=0;s<this._pivotTableFields.length;s++)this._pivotTableFields[s].name==c&&(this._pivotTableFields[s].isSelected=!1,m=this._pivotTableFields[s]);try{_=JSON.parse(this.getOlapReport()).Report}catch(e){_=this.getOlapReport()}if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap)if(m=e(u).attr("data-tag"),n=e(u).parents().hasClass("values")&&-1==m.indexOf("[Measures]"),"[Measures]"==(g=m.indexOf("[Measures]")>-1||m.indexOf("KPI")>-1||n||m.indexOf("[")>-1?m.split(":")[1]:this._getNodeUniqueName(m))||"KPI"==g||n){if(m=n?m+":KPI":m,u.remove(),!t.isNullOrUndefined(this._schemaData))for(this._schemaData.element.find(".e-pivotButton:contains("+c+")").remove(),s=0;s<this._schemaData.model.pivotCalculations.length&&(m.indexOf("Measures")>-1||m.indexOf("KPI")>-1||e(u).parents().hasClass("values")&&-1==m.indexOf("[Measures]"));s++)g=this._schemaData.model.pivotCalculations[s].Tag,this._schemaData._isMeasureBtnRemove=!0,selectedTreeNode=this._getNodeByUniqueName(g),this._schemaData._tableTreeObj.uncheckNode(selectedTreeNode);this._waitingPopup.show(),null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject}),h=JSON.stringify(this.model.customObject),a=JSON.stringify({action:"removeButton",headerInfo:m,currentReport:_,gridLayout:this.model.layout,customObject:h}),!t.isNullOrUndefined(this._schemaData)&&(m.indexOf("[Measures]")<0||m.indexOf("KPI")<0)&&(m.indexOf("Measures")>=0||m.indexOf("KPI")>=0)&&this._schemaData.element.find(".e-schemaValue .e-pivotButton").remove(),this.model.enableDeferUpdate&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.removeButton,a.replace("removeButton","removeButtonDeferUpdate"),this._pvtBtnDroppedSuccess),this.element.find(".schemaNoClick").removeClass("freeze"),this._waitingPopup.hide()):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.removeButton,a,this._pvtBtnDroppedSuccess)}else if(t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),t.isNullOrUndefined(this._schemaData)){if(h=JSON.stringify(this.model.customObject),a=JSON.stringify({action:"removeButton",headerInfo:m,currentReport:_,gridLayout:this.model.layout,customObject:h}),t.isNullOrUndefined(m))return!1;this.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.removeButton,a.replace("removeButton","removeButtonDeferUpdate"),this._pvtBtnDroppedSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.removeButton,a,this._pvtBtnDroppedSuccess)}else selectedTreeNode=this._getNodeByUniqueName(g),this._schemaData._tableTreeObj.uncheckNode(selectedTreeNode);else p="schemaRow::"+m.id+"::FILTERED",o=""!=this._droppedClass?this._droppedClass:"PivotItem"==m.pivotType?"e-schemaRow":"e-schemaValue",this._droppedClass="",e(u).remove(),this._waitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._waitingPopup)||this._waitingPopup.show(),null!=this._schemaData?(d=this._schemaData._tableTreeObj.element.find("li:contains('"+c+"')"),this._schemaData._tableTreeObj.uncheckNode(d)):(null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject}),h=JSON.stringify(this.model.customObject),a=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(m),dropAxis:o+"::",sortedHeaders:this._ascdes,filterParams:p,currentReport:_,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:h}),this.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeStateModified,a.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeStateModified,a,this._nodeStateModifiedSuccess))}},_getNodeUniqueName:function(e){for(var t="",i=0;i<e.split(":")[1].split(".").length;i++)""!=t&&(t+="."),t+="["+e.split(":")[1].split(".")[i]+"]";return t},_getNodeByUniqueName:function(t){for(var i=null,r=0;r<e(this._schemaData._tableTreeObj.element.find("li")).length;r++)e(this._schemaData._tableTreeObj.element.find("li")[r]).attr("data-tag").toLowerCase()==t.toLowerCase()&&(i=e(this._schemaData._tableTreeObj.element.find("li")[r]));return i},_nodeStateModifiedSuccess:function(e){e[0]!=r?null!=e[2]&&e[2]!=r&&(this.model.customObject=e[2].Value):e.d!=r?null!=e.d[2]&&e.d[2]!=r&&(this.model.customObject=e.d[2].Value):null!=e.customObject&&e.customObject!=r&&(this.model.customObject=e.customObject),null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject}),this.model.enableDeferUpdate?this._deferUpdateSuccess(e):this._renderControlSuccess(e)},_drillDownSuccess:function(i){if(i[0]!=r)this.setJSONRecords(i[0].Value),this.setOlapReport(i[1].Value),t.isNullOrUndefined(this._pivotClientObj)||(this._pivotClientObj.currentReport=JSON.parse(i[1].Value).Report,i[2].Value!=r&&"undefined"!=i[2].Value&&(this._pivotClientObj.reports=i[2].Value)),null!=i[3]&&i[3]!=r&&"PageSettings"==i[3].Key&&(this.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i[4].Value).Column/JSON.parse(i[3].Value).CategoricalPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i[4].Value).Row/JSON.parse(i[3].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(i[3].Value).CategoricalCurrentPage,this._seriesCurrentPage=JSON.parse(i[3].Value).SeriesPageSize):null!=this._pagerObj&&null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r?this._pagerObj.initPagerProperties(JSON.parse(i[4].Value),JSON.parse(i[3].Value)):t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._pagerObj||this._pivotClientObj._pagerObj.initPagerProperties(JSON.parse(i[4].Value),JSON.parse(i[3].Value)),null!=i[5]&&i[5]!=r&&(this.model.customObject=i[5].Value)),null!=i[3]&&i[3]!=r&&"PageSettings"!=i[3].Key&&(this.model.customObject=i[3].Value);else if(i.d!=r)this.setJSONRecords(i.d[0].Value),this.setOlapReport(i.d[1].Value),t.isNullOrUndefined(this._pivotClientObj)||(this._pivotClientObj.currentReport=JSON.parse(i.d[1].Value).Report,i.d[2].Value!=r&&"undefined"!=i.d[2].Value&&(this._pivotClientObj.reports=i.d[2].Value),this._updatePageSettings(i.d,this._pivotClientObj)),null!=i.d[3]&&i.d[3]!=r&&"PageSettings"==i.d[3].Key&&(this.model.enableVirtualScrolling||!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i.d[4].Value).Column/JSON.parse(i.d[3].Value).CategoricalPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i.d[4].Value).Row/JSON.parse(i.d[3].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(i.d[3].Value).CategoricalCurrentPage,this._seriesCurrentPage=JSON.parse(i.d[3].Value).SeriesCurrentPage):null!=this._pagerObj&&null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r?this._pagerObj.initPagerProperties(JSON.parse(i.d[4].Value),JSON.parse(i.d[3].Value)):t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._pagerObj||this._pivotClientObj._pagerObj.initPagerProperties(JSON.parse(i.d[4].Value),JSON.parse(i.d[3].Value)),null!=i.d[5]&&i.d[5]!=r&&(this.model.customObject=i.d[5].Value)),null!=i.d[3]&&i.d[3]!=r&&"PageSettings"!=i.d[3].Key&&(this.model.customObject=i.d[3].Value);else{if(t.isNullOrUndefined(i.PivotRecords))return(t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._waitingPopup)&&t.isNullOrUndefined(this._pivotClientObj)?t.isNullOrUndefined(this._pivotClientObj)&&(this._waitingPopup=this.element.data("ejWaitingPopup"),this._waitingPopup.hide()):(this._pivotClientObj._isTimeOut=!1,this._pivotClientObj._waitingPopup.hide()),!1;this.setJSONRecords(i.PivotRecords),this.setOlapReport(i.OlapReport),t.isNullOrUndefined(this._pivotClientObj)||(this._pivotClientObj.currentReport=JSON.parse(i.OlapReport).Report,i.ClientReports!=r&&"undefined"!=i.ClientReports&&(this._pivotClientObj.reports=i.ClientReports),i.PageSettings!=r&&null!=i.PageSettings&&null!=this._pivotClientObj._pagerObj&&this._pivotClientObj._pagerObj.initPagerProperties(JSON.parse(i.HeaderCounts),JSON.parse(i.PageSettings))),i.PageSettings!=r&&null!=i.PageSettings&&(this.model.enableVirtualScrolling||!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i.HeaderCounts).Column/JSON.parse(i.PageSettings).CategoricalPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i.HeaderCounts).Row/JSON.parse(i.PageSettings).SeriesPageSize),this._categCurrentPage=JSON.parse(i.PageSettings).CategoricalCurrentPage,this._seriesCurrentPage=JSON.parse(i.PageSettings).SeriesCurrentPage):this._pagerObj&&null!=e(".e-pivotpager")[0]&&e(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(i.HeaderCounts),JSON.parse(i.PageSettings))),null!=i.customObject&&i.customObject!=r&&(this.model.customObject=i.customObject)}null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"drillDown",element:this.element,customObject:this.model.customObject}),this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout&&0==this.model.enableVirtualScrolling&&null==e(".e-pivotpager")[0]?this.excelLikeLayout(this.getJSONRecords()):this.renderControlFromJSON(this.getJSONRecords());try{this.model.currentReport=JSON.parse(this.getOlapReport()).Report}catch(e){this.model.currentReport=this.getOlapReport()}t.isNullOrUndefined(this._pivotClientObj)||this._pivotClientObj._trigger("gridDrillSuccess",this.element),this._trigger("drillSuccess",this.element),t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._waitingPopup?t.isNullOrUndefined(this._pivotClientObj)?t.isNullOrUndefined(this._pivotClientObj)&&(this._waitingPopup=this.element.data("ejWaitingPopup"),this._waitingPopup.hide()):((!this._pivotClientObj||this._pivotClientObj._pivotGrid._startDrilldown||this._pivotClientObj._pivotChart._startDrilldown)&&"gridOnly"!=this._pivotClientObj.model.displaySettings.mode||(this._pivotClientObj._isTimeOut=!1),this._pivotClientObj._waitingPopup.hide()):e("#"+this._pivotClientObj._id+"_maxView")[0]&&this._maxViewLoading?(this._maxViewLoading.hide(),this._pivotClientObj._waitingPopup.hide()):"gridOnly"==this._pivotClientObj.model.displaySettings.mode&&this._pivotClientObj._waitingPopup.hide(),t.isNullOrUndefined(this._pivotClientObj)?this._waitingPopup.hide():(this._pivotClientObj._isTimeOut=!1,this._pivotClientObj._pivotGrid._startDrilldown=!1);var l={action:this._drillAction,customObject:this.model.customObject,element:this.element};this._trigger("renderSuccess",l)},saveReport:function(e,i,r){var l,n,s;"local"==i.toLowerCase()?this._trigger("saveReport",{report:this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource:this.getOlapReport()}):(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(n=JSON.stringify(this.model.dataSource),l="clientMode"):this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&(n=JSON.parse(this.getOlapReport()).Report,l="serverMode"),null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:"saveReport",element:this.element,customObject:this.model.customObject}),s=JSON.stringify(this.model.customObject),this.doAjaxPost("POST",r+"/"+this.model.serviceMethodSettings.saveReport,JSON.stringify({reportName:e,clientReports:n,operationalMode:l,customObject:s})))},loadReport:function(e,i,r){var l,n,s,o;if(this._waitingPopup.show(),"local"==i.toLowerCase())if(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)this._trigger("loadReport",{targetControl:this,dataModel:this.model.analysisMode}),this.refreshPivotGrid();else{this._trigger("loadReport",{targetControl:this,dataModel:this.model.analysisMode});try{s=JSON.parse(this.getOlapReport()).Report}catch(e){s=this.getOlapReport()}null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:"loadReport",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),l=JSON.stringify({action:"loadReport",gridLayout:this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.layout:this.layout(),enablePivotFieldList:this.model.enablePivotFieldList,reportName:e,operationalMode:"serverMode",clientReports:s,customObject:o}),this.doAjaxPost("POST",r+"/"+this.model.serviceMethodSettings.loadReport,l,this._loadReportSuccess)}else null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:"loadReport",element:this.element,customObject:this.model.customObject}),o=JSON.stringify(this.model.customObject),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(n="clientMode",this.doAjaxPost("POST",r+"/"+this.model.serviceMethodSettings.loadReport,JSON.stringify({action:"loadReport",gridLayout:this.layout(),enablePivotFieldList:this.model.enablePivotFieldList,reportName:e,operationalMode:n,customObject:o}),this._loadReportSuccess)):this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&(n="serverMode",l=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?JSON.stringify({action:"loadReport",reportName:e,gridLayout:this.model.layout,enablePivotFieldList:this.model.enablePivotFieldList,operationalMode:n,customObject:o}):JSON.stringify({action:"loadReport",gridLayout:this.layout(),enablePivotFieldList:this.model.enablePivotFieldList,reportName:e,operationalMode:n,customObject:o}),this.doAjaxPost("POST",r+"/"+this.model.serviceMethodSettings.loadReport,l,this._loadReportSuccess))},_loadReportSuccess:function(e){this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(e.d!=r&&e.d.length>0?this.setOlapReport(JSON.parse(e.d[0].Value)):this.setOlapReport(JSON.parse(e.report)),this.model.dataSource=this.getOlapReport(),this.refreshPivotGrid(),this._unWireEvents(),this._wireEvents()):this._renderControlSuccess(e),!t.isNullOrUndefined(this._schemaData)&&this.model.enablePivotFieldList&&this._schemaData._load()},doAjaxPost:function(i,l,n,s,o,a){var d,h,c,u,g,p;t.isNullOrUndefined(n.XMLA)&&"cellEditing"!=JSON.parse(n).action&&(this.model.editCellsInfo={}),u=!0,g=this.model.enableXHRCredentials||!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableXHRCredentials,n.XMLA==r?(d="application/json; charset=utf-8",h="json",c=e.proxy(s,this),u=!("msie"==t.browserInfo().name&&t.browserInfo().version<=9||"export"==JSON.parse(n).action)):(d="text/xml",h="xml",n=n.XMLA,c=e.proxy(s,t.olap.base,a),u=!("msie"==t.browserInfo().name&&t.browserInfo().version<=9)&&(!t.isNullOrUndefined(a)&&"loadFieldElements"!=a.action)),p={type:i,url:l,contentType:d,async:u,dataType:h,data:n,success:c,xhrFields:{withCredentials:g},complete:t.proxy(function(i){if(e.proxy(i,this),null!=this.model){var r={action:t.isNullOrUndefined(a)||t.isNullOrUndefined(a.action)?JSON.parse(n).action:a.action,customObject:this.model.customObject,element:this.element};this._trigger("renderComplete",r)}},this),error:t.proxy(function(e){void 0!==this._waitingPopup&&null!=this._waitingPopup&&this._waitingPopup.hide(),t.isNullOrUndefined(this._pivotClientObj)||null==this._pivotClientObj._waitingPopup||this._pivotClientObj._waitingPopup.hide();var i={action:""!=this._drillAction?this._drillAction:"initialize",customObject:this.model.customObject,element:this.element,Message:e};this._trigger("renderFailure",i),this.renderControlFromJSON(""),this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&t.Pivot._createErrorDialog(e.statusText,this._getLocalizedLabels("Error"),this),e.statusText},this)},g||delete p.xhrFields,e.ajax(p)},doPostBack:function(t,i){var r=e("<form>").attr({action:t,method:"POST",name:"export"}),l=function(t,i){e('<input type="hidden" title="params">').attr({id:t,name:t,value:i}).appendTo(r)};for(var n in i)l(n,i[n]);r.appendTo(document.body).submit().remove()},_import:function(e){if(window.FormData&&this._isObject(e)){var t,i=new FormData;for(t in e)"async"!=t&&i.append(t,e[t]);return i}return e},_isObject:function(e){return"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)},refreshPagedPivotGrid:function(e,i){var r;if(this._isUpdateRequired=!0,t.isNullOrUndefined(this._pivotClientObj)&&(this._waitingPopup=this.element.data("ejWaitingPopup"),this._waitingPopup.show()),e=-1!=e.indexOf("categ")?"categorical":"series",this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){if(this._isNavigation=!0,"categorical"==e?this.model.dataSource.pagerOptions.categoricalCurrentPage=parseInt(i):this.model.dataSource.pagerOptions.seriesCurrentPage=parseInt(i),this.model.operationalMode==t.Pivot.OperationalMode.ServerMode){try{r=JSON.parse(this.getOlapReport()).Report}catch(e){r=this.getOlapReport()}this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.paging,JSON.stringify({action:"paging",axis:e,pageNo:i,drillHeaders:JSON.stringify(this._drillHeaders),currentReport:r,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:JSON.stringify(this.model.customObject)}),this._renderControlSuccess)}else this._refPaging();return!1}if(this.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap)"categorical"==e?this._categCurrentPage=parseInt(i):this._seriesCurrentPage=parseInt(i),t.olap.base.getJSONData({action:"navPaging"},this.model.dataSource,this);else{try{r=JSON.parse(this.getOlapReport()).Report}catch(e){r=this.getOlapReport()}this.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.paging,JSON.stringify({action:"pagingDeferUpdate",pagingInfo:e+":"+i,currentReport:r,layout:this.layout(),customObject:JSON.stringify(this.model.customObject)}),this._deferUpdateSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.paging,JSON.stringify({action:"paging",pagingInfo:e+":"+i,currentReport:r,layout:this.layout(),customObject:JSON.stringify(this.model.customObject)}),this._renderControlSuccess)}},_refPaging:function(){t.PivotAnalysis._controlObj=this,t.PivotAnalysis._colKeysCalcValues=e.extend(!0,[],this._colKeysCalcValues),t.PivotAnalysis._rowKeysCalcValues=e.extend(!0,[],this._rowKeysCalcValues),t.PivotAnalysis._tableKeysCalcValues=e.extend(!0,[],this._tableKeysCalcValues);var i=t.PivotAnalysis._fillEngine(this.model);this.setJSONRecords(JSON.stringify(i.json)),this.model.enableGroupingBar&&this._createGroupingBar(this.model.dataSource),this.renderControlFromJSON(i.json)},excelLikeLayout:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m;for(this._excelRowCount=0,g=0;g<i.length&&0==parseInt(i[g].Index.split(",")[0]);g++)this._excelRowCount++;this._rowCount=this._excelRowCount;var _=jQuery.extend(!0,[],i),f=[],b=[],C=null,S=0;if(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&(r=e(this.element).parents(".e-pivotclient").length>0&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this._pivotClientObj.getOlapReport():this.getOlapReport()),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&0==this.model.dataSource.rows.length&&null!=this.model.dataSource.data||this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&""!==r&&0==JSON.parse(r).PivotRows.length))return this._excelLikeJSONRecords=null,this._isExporting||this.renderControlFromJSON(),void(this._excelRowCount=0);if(this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot&&null!=_&&""!=_){for(l=null,c="colheader"!=_[0].CSS?_[0].ColSpan*this._excelRowCount:0;c<_.length&&(_[c].Info.toLowerCase().indexOf("[measure")>-1&&(l=parseInt(_[c].Index.split(",")[1])),!(_[c].CSS.indexOf("value")>-1));c++)n=parseInt(_[c].Index.split(",")[1]);for(null!=l&&l!=n&&0!=l&&this._columnExcelLikeLayout(_,l,n),s=_.length/this._excelRowCount,o=0;o<s&&o<_.length;o++)for(a=0;a<=n&&a<_.length;a++)if("colheader"==_[g=o*this._excelRowCount+a].CSS&&"Block"!=_[g].Span&&(-1==_[g].Info.toLowerCase().indexOf("[measure")||_[g].Info.toLowerCase().indexOf("[measure")>-1&&null!=l&&0==l)&&_[g].ColSpan>1){for(p=g;p<g+_[g].RowSpan;p++){for(m=p+this._excelRowCount;m<p+_[g].ColSpan*this._excelRowCount;m+=this._excelRowCount)_[m].Span="Block";p!=g&&(_[p].Span="Block")}if(h=null,_[d=g+(_[g].RowSpan-1)+(_[g].ColSpan-1)*this._excelRowCount+1].CSS.indexOf("summary")>-1&&_[d].Value==this._getLocalizedLabels("Total")&&-1==_[d-this._excelRowCount].CSS.indexOf("summary"))h=d;else if(_[d].CSS.indexOf("summary")>-1&&_[d-this._excelRowCount].CSS.indexOf("e-summary")>-1)for(p=d-this._excelRowCount;p>=0&&p<_.length;p-=this._excelRowCount)if(_[p].ColSpan>1||-1==_[p-this._excelRowCount].CSS.indexOf("e-summary")&&this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){h=p;break}null!=h&&(_[h].ColSpan=this.model.operationalMode!=t.PivotGrid.OperationalMode.ClientMode?_[h].ColSpan:parseInt(_[d].Index.split(",")[0])-parseInt(_[h].Index.split(",")[0])+1,_[g].ColSpan=_[g].ColSpan-_[h].ColSpan,_[g+_[g].ColSpan*this._excelRowCount]=e.extend(!0,{},_[h]),_[g+_[g].ColSpan*this._excelRowCount].RowSpan=_[h].RowSpan+_[g].RowSpan,_[g+_[g].ColSpan*this._excelRowCount].Value=_[g].Value+" Total")}}if(null!=_&&""!=_&&"colheader"!=_[0].CSS&&(this.model.analysisMode!=t.Pivot.AnalysisMode.Olap||this.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode)){if("0,0"==_[0].Index&&"colheader"!=_[0].CSS)for(S=_[0].ColSpan,0==_[0].RowSpan&&(_[0].RowSpan=1),p=0;p<_[0].RowSpan&&p<_.length;p++)f.push(_[p]),_[p].Level=1,_[p].Span="Block";for(c=_[0].RowSpan;c<_.length&&this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot&&this.model.dataSource.rows.length>0;c+=this._excelRowCount)if(_[c].Info.toLowerCase().indexOf("[measure")>-1){C=parseInt(_[c].Index.split(",")[0]);break}for(g=0;g<_.length&&g<this._excelRowCount;g++)if("rowheader"==_[g].CSS&&0==parseInt(_[g].Index.split(",")[0])&&"Block"!=_[g].Span){for(_[g].Level=1,null!=_[g+this._excelRowCount]&&-1==_[g+this._excelRowCount].CSS.indexOf("value")&&(_[g].itemIndex=_[g+_[g].RowSpan-(this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot?1:0)].Index),f.push(_[g]),null!=C&&0==C&&_[g].Info.toLowerCase().indexOf("[measure")>-1&&b.push(_[g]),p=g+1;p<g+_[g].RowSpan;p++)(-1==_[p].Info.toLowerCase().indexOf("[measure")||null!=C&&C!=S-1)&&(_[p].Span="Block");this._rowExcelLikeLayout(g,_,f,2,C,b,S)}else("summary rgtot"==_[g].CSS||"summary gtot"==_[g].CSS||"summary calc gtot"==_[g].CSS||"colheader"==_[g].CSS&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot||("summary"==_[g].CSS&&_[g].Value.indexOf(this._getLocalizedLabels("Total"))>-1||"summary row"==_[g].CSS)&&this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot)&&0==parseInt(_[g].Index.split(",")[0])&&(null!=C&&C==S-1&&(_[g].Value+=" "+_[g+this._excelRowCount*parseInt(_[g].ColSpan)].Value),_[g].Value=_[g].Value==this._getLocalizedLabels("Total")?this._getLocalizedLabels("GrandTotal"):_[g].Value,f.push(_[g]),_[g].Level=1);if(null!=C&&0==C){for(g=0;g<b.length;g++)f.push(e.extend(!0,{},b[g])),f[f.length-1].CSS="summary",f[f.length-1].Value=this._getLocalizedLabels("Total")+" "+f[f.length-1].Value;b.splice(0,b.length)}var x,v=f.length,w=0,I=!1;for(g=0;g<v;g++){for(w+=g,x=null!=f[g].itemIndex?f[g].itemIndex:f[g].Index,u=parseInt(x.split(",")[0])*this._excelRowCount+parseInt(x.split(",")[1]);u<_.length;u+=this._excelRowCount)(_[u].CSS.indexOf("value")>-1||_[u].CSS.indexOf("colheader")>-1||_[u].CSS.indexOf("calc")>-1||_[u].CSS.indexOf("cstot")>-1||_[u].CSS.indexOf("cgtot")>-1||_[u].CSS.indexOf("none")>-1)&&parseInt(_[u].Index.split(",")[0])>=S&&(I=!0),I&&(f[w+=this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot?parseInt(v):this._excelRowCount]=e.extend(!0,{},_[u]));w=0,I=!1}for(g=0;g<v;g++)null!=f[g]&&(f[g].Span="none",isNaN(f[g].Level)&&(f[g].Level=1),"0,0"==f[g].Index&&"colheader"!=f[g].CSS&&0==g||(f[g].RowSpan=1),f[g].ColSpan=null!=C&&C==S-1&&"rowheader"==f[g].CSS&&-1==f[g].Info.toLowerCase().indexOf("[measure")?f.length/v:null!=C&&0==C&&f[g].Info.toLowerCase().indexOf("[measure")>-1&&"rowheader"==f[g].CSS?f.length/v:null!=C&&C!=S-1&&0!=C&&(f[g].Info.toLowerCase().indexOf("[measure")>-1||"rowheader"==f[g].CSS&&parseInt(f[g].Index.split(",")[0])<C)?f.length/v:1);this._excelRowCount=v}for(null!=_&&0==f.length&&(f=_),p=0;p<f.length/this._excelRowCount;p++)for(m=0;m<this._excelRowCount;m++)f[p*this._excelRowCount+m].i=p+","+m,f[p*this._excelRowCount+m].Span="none";this._excelLikeJSONRecords=f,this._isExporting||this.renderControlFromJSON()},_rowExcelLikeLayout:function(e,i,r,l,n,s,o){for(var a,d,h,c=!1,u=e+(this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot?i[e].ColSpan*this._excelRowCount:this._excelRowCount),g=0;g<i[e].RowSpan&&u<i.length&&-1==i[u].CSS.indexOf("value");u++,g++){if(null!=n&&n!=o-1&&0!=n&&i[u].Info.toLowerCase().indexOf("[measure")>-1&&"Block"!=i[u].Span&&(c=!0),a=null!=n&&n==o-1?"summary row"==i[u].CSS&&("summary row"==i[u+this._excelRowCount].CSS||"none"==i[u+this._excelRowCount].CSS||i[u+this._excelRowCount].Info.toLowerCase().indexOf("[measure")>-1):null!=n&&n!=o-1&&0!=n&&("summary"==i[u].CSS&&("summary"==i[u+this._excelRowCount].CSS||"none"==i[u+this._excelRowCount].CSS||i[u+this._excelRowCount].Info.toLowerCase().indexOf("[measure")>-1||parseInt(i[u].Index.split(",")[0])-1<=n)),("rowheader"==i[u].CSS||"none"==i[u].CSS||a)&&"Block"!=i[u].Span){for(h=u+1;h<u+i[u].RowSpan;h++)(-1==i[h].Info.toLowerCase().indexOf("[measure")||null!=n&&n!=o-1)&&(i[h].Span="Block");if(i[u].Level=l,"none"!=i[u].CSS)if(null!=i[u+this._excelRowCount]&&-1==i[u+this._excelRowCount].CSS.indexOf("value")&&(i[u].itemIndex=i[u+i[u].RowSpan-(this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot?1:0)].Index),a){for(d=u-i[e].ColSpan*this._excelRowCount;d>=0&&d<i.length;d--)if(""!=i[d].Value){i[u].Value=i[d].Value,i[u].Level=i[e].Level;break}null!=n&&n!=o-1&&0!=n&&parseInt(i[u].Index.split(",")[0])-1==n?s.push(i[u]):(i[u].Value+=" "+i[u+this._excelRowCount*parseInt(i[u].ColSpan)].Value,r.push(i[u]))}else r.push(i[u]);i[u].Span="Block","summary row"!=i[u].CSS&&"summary"!=i[u].CSS&&this._rowExcelLikeLayout(u,i,r,l+1,n,s,o)}if(c&&g+1==i[e].RowSpan){for(c=!1,h=0;h<s.length;h++)s[h].Value=i[e].Value+" "+s[h].Value,r.push(s[h]);s.splice(0,s.length)}}},_columnExcelLikeLayout:function(t,i,r){for(var l,n,s,o,a,d,h,c,u,g,p=t.length/this._excelRowCount,m=0;m<p&&m<t.length;m++)for(l=0;l<=r&&l<t.length;l++)if("colheader"==t[n=m*this._excelRowCount+l].CSS&&"Block"!=t[n].Span&&-1==t[n].Info.toLowerCase().indexOf("[measure")&&t[n].ColSpan>1){for(a=n;a<n+t[n].RowSpan;a++){for(c=a+this._excelRowCount;c<a+t[n].ColSpan*this._excelRowCount;c+=this._excelRowCount)t[c].Span="Block";a!=n&&(t[a].Span="Block")}if(t[s=n+(t[n].RowSpan-1)+(t[n].ColSpan-1)*this._excelRowCount+1].Info.toLowerCase().indexOf("[measure")>-1&&JSON.parse(this.getOlapReport()).PivotCalculations.length>1&&null!=i&&i!=r&&0!=i){for(o=[],a=n+t[n].RowSpan;a<=s;a+=(t[a].ColSpan+1)*this._excelRowCount)if(t[d=a+(t[a].RowSpan-1)+(t[a].ColSpan-1)*this._excelRowCount+1].CSS.indexOf("summary")>-1){for(t[d-1].RowSpan=t[d-1].RowSpan+t[d].RowSpan,h=parseInt(t[d].Index.split(",")[0])*this._excelRowCount,c=0;c<this._excelRowCount;c++)t.splice(parseInt(t[s].Index.split(",")[0])*this._excelRowCount+this._excelRowCount+c+o.length*this._excelRowCount,0,e.extend(!0,{},t[h+c]));o.push(h),t[a].ColSpan=t[a].ColSpan-1}for(u=o.length-1;u>=0;u--)t.splice(parseInt(t[o[u]].Index.split(",")[0])*this._excelRowCount,this._excelRowCount);o.length>0&&(t[n].ColSpan=t[n].ColSpan-o.length,t[g=n+t[n].ColSpan*this._excelRowCount].ColSpan=o.length,t[g].RowSpan=t[n].RowSpan,t[g].Value=t[n].Value+" Total",t[g].CSS="summary",t[g].Span="none",t[g].State=0)}else t[s].Info.toLowerCase().indexOf("[measure")>-1&&t[s+1].CSS.indexOf("summary")>-1&&1==JSON.parse(this.getOlapReport()).PivotCalculations.length&&null!=i&&i!=r&&0!=i&&(t[n].ColSpan=t[n].ColSpan-1,t[n+t[n].ColSpan*this._excelRowCount]=e.extend(!0,{},t[s+1]),t[s+1].Value="",t[n+t[n].ColSpan*this._excelRowCount].Value=t[n].Value+" Total",t[n+t[n].ColSpan*this._excelRowCount].RowSpan=t[n].RowSpan)}},_getColumnIndices:function(t,i,r,l){var n="rows"==t?i.Index.split(",")[1]:"columns"==t?i.Index.split(",")[0]:null;return i.Value==r&&(-1==e.inArray(Number(n),l)&&l.push(Number(n))),l},_getParentPosition:function(i,r,l){var n="",s="",o="";for(r=this.layout().toLowerCase()!=t.PivotGrid.Layout.ExcelLikeLayout||e.isNumeric(r)?r:parseInt(r.split(",")[0])*this._rowCount+parseInt(r.split(",")[1]);s==n&&!t.isNullOrUndefined(this.getJSONRecords()[r]);)s=this.getJSONRecords()[r].Value,(""==n&&""!=s||n==s+" Total"||n+" Total"==s)&&(n=s),"columnheader"==i&&"start"==l?r-=this._rowCount:"rowheader"==i&&"end"==l&&r++,o=s==n?this.getJSONRecords()[r].Index:o,"columnheader"==i&&"end"==l?r+=this._rowCount:"rowheader"==i&&"start"==l&&r--,s=""==s?n:s;return o},_updateRowCells:function(i,r,l,n,s,o){var a,d,h,c,u,g;o&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout&&r.find("tbody:eq(2) tr:empty").remove();do{if(this.model.enableRTL&&e(e(i).find(".summary,.rowheader,.colheader")).css("text-align","right"),a=e(i).next().children().first().attr("data-p"),d=this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?"data-i":"data-p",t.isNullOrUndefined(a))a=e(i).children().first().attr("data-p"),l.find("[data-p='"+a+"']").length>0&&this.layout().toLowerCase()!=t.PivotGrid.Layout.ExcelLikeLayout?""!=n&&l.find("[data-p='"+n+"']").parent().length>0?(e(i).clone().insertBefore(l.find("[data-p='"+n+"']").parent()),l.find("[data-p='"+n+"']").parent().remove()):e(i).clone().insertAfter(l.find("[data-p='"+a+"']").parent()):o?(g=r.find("["+d+"$=',"+parseInt(e(i).children().first().attr(d).split(",")[1])+"']").parent(),e(g).eq(1).clone().insertAfter(l.find("tr:last")),e(g).eq(0).clone().insertAfter(l.find(".rowhead tr:last"))):e(i).clone().insertAfter(l.find("tr:last")),l.find("[data-p='"+e(i).children().first().attr("data-p")+"']").parent().last().prev().find("[data-p='"+e(i).children().first().attr("data-p")+"']").parent().remove();else if(o||this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?e(i).children().length>0&&l.find("["+d+"$=',"+parseInt(e(i).children().first().attr(d).split(",")[1])+"']").parent().remove():l.find("[data-p='"+e(i).children().first().attr("data-p")+"']:not('.e-grpRow')").parent().remove(),""!=n&&l.find("[data-p='"+n+"']").parent().length>0)if(o||e(i).clone().insertBefore(l.find("[data-p='"+n+"']").parent()),o){if(e(i).children().length>0){h=0;do{c=l.find("["+d+"$=',"+parseInt(n.split(",")[1])+"']").parent().eq(h),g=r.find("["+d+"$=',"+parseInt(e(i).children().first().attr(d).split(",")[1])+"']").parent().eq(h).clone(),e(c).length>0?e(g).insertBefore(e(c)):e(g).insertAfter(l.find("["+d+"$=',"+parseInt(r.find("["+d+"$=',"+parseInt(e(i).children().first().attr(d).split(",")[1])+"']").parent().eq(h).prev().children().first().attr(d).split(",")[1])+"']").parent().eq(h)),h++}while(h<2);this.layout().toLowerCase()!=t.PivotGrid.Layout.ExcelLikeLayout&&l.find("["+d+"$=',"+parseInt(n.split(",")[1])+"']").parent().remove()}}else this.layout().toLowerCase()!=t.PivotGrid.Layout.ExcelLikeLayout&&l.find("[data-p='"+n+"']").parent().remove();else if(o){if(0==l.find("["+d+"$=',"+parseInt(a.split(",")[1])+"']").parent().length){u=e(i).next();do{a=e(u).next().children().length>0?e(u).next().children().first().attr(d):a,u=e(u).next()}while(0==l.find("["+d+"$=',"+parseInt(a.split(",")[1])+"']").parent().length&&e(u).children().length>0)}e(i).children().length>0&&(c=l.find("["+d+"$=',"+parseInt(a.split(",")[1])+"']").parent(),g=r.find("["+d+"$=',"+parseInt(e(i).children().first().attr(d).split(",")[1])+"']").parent(),e(c).length>0?(e(g).eq(0).clone().insertBefore(e(c).eq(0)),e(g).eq(1).clone().insertBefore(e(c).eq(1))):(e(g).eq(1).clone().insertAfter(l.find("tr:last")),e(g).eq(0).clone().insertAfter(l.find(".rowhead tr:last"))))}else if(this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout)e(i).clone().insertAfter(l.find("tr:last"));else{if(0==l.find("[data-p='"+a+"']").parent().length){u=e(i).next();do{a=e(u).next().children().first().attr("data-p"),u=e(u).next()}while(0==l.find("[data-p='"+a+"']").parent().length&&e(u).children().length>0)}l.find("[data-p='"+a+"']").parent().length>0?e(i).clone().insertBefore(l.find("[data-p='"+a+"']").parent()):e(i).clone().insertAfter(l.find("tr:last"))}i=this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?e(i).next():e(i).prev()}while(this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?e(i).length>0&&0==e(i).children("[data-p='"+n+"']").length:0==e(i).next().children("[data-p='"+s+"']").length&&e(i).length>0&&e(i).next().children().length>0&&parseInt(e(i).next().children().first().attr("data-p").split(",")[1])>parseInt(s.split(",")[1]))},_getAdjacentRowPos:function(t,i,r){var l,n=[],s=r;do{l=i+","+r,n=e(t.find("[data-p='"+l+"']")),--r<0&&(i-=1,s=r=s+1)}while(0==n.length&&i>-1);return l},_mergeHtml:function(i,r,l,n){var s,o,a,d,h,c,u,g=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,p=l.find("[data-p='"+r+"']").children("span")[0];if("rowheader"==i){var m=parseInt(r.split(",")[1]),_="",f="";if(_=this._getParentPosition(i,this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?r:m,"start"),f=this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this._getParentPosition(i,r,"end"):f,f=this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout&&0==n.find("[data-p='"+f+"']").parent().length?"drilldown"==this._drillAction?n.find("[data-p='"+r+"']").parent().next().children().first().attr("data-p"):l.find("[data-p='"+r+"']").parent().next().children().first().attr("data-p"):f,"drilldown"==this._drillAction){if(t.isNullOrUndefined(p)){for(s=(parseInt(r.split(",")[0])+1)*this._rowCount+parseInt(r.split(",")[1])-1,f=r;!t.isNullOrUndefined(this._JSONRecords[s])&&this._JSONRecords[s].CSS.indexOf("summary")>-1&&0==e(l.find("[data-p='"+this._JSONRecords[s].Index+"']")).length;)s=s+this._rowCount-1;r=this._JSONRecords[s].Index,r=e(l.find("[data-p='"+r+"']")).length>0?r:this._getAdjacentRowPos(l,parseInt(r.split(",")[0]),parseInt(r.split(",")[1]))}b=e(l.find("[data-p='"+r+"']").children("span")[0]).closest("tr")[0],this._updateRowCells(b,l,n,f,_,g)}else{var b=e(n.find("[data-p='"+r+"']").closest("tr")[0]),C=parseInt(n.find("[data-p='"+r+"']").attr("rowSpan")),S=0,x=this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?"data-i":"data-p";do{o=this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?e(b).children().first().attr("data-i"):e(b).children().first().attr("data-p"),b=e(b).next(),g||this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?n.find("["+x+"$=',"+parseInt(o.split(",")[1])+"']").parent().remove():n.find("[data-p='"+o+"']:not('.e-grpRow')").parent().remove(),S++}while(this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?e(b).children().first().attr("data-p")!=f:S<C);b=this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?l.find("[data-p='"+r+"']").parent():l.find("[data-p='"+e(b).children().first().attr("data-p")+"']").parent().length>0?l.find("[data-p='"+e(b).children().first().attr("data-p")+"']").parent():g?e(l).find(".rowhead tr:last"):e(l).find("tr:last"),this._updateRowCells(b,l,n,f,_,g)}}else{var v=parseInt(r.split(",")[0])*this._rowCount;_="",f="";_=this._getParentPosition(i,v,"start"),a=!1,this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?JSON.parse(this.getOlapReport()).PivotColumns.length>0&&e.each(JSON.parse(this.getOlapReport()).PivotColumns,function(e,t){if(0==t.showSubTotal)return a=!0,!1}):this.model.dataSource.columns.length>0&&e.each(this.model.dataSource.columns,function(e,t){if(0==t.showSubTotal)return a=!0,!1}),("drillup"==this._drillAction||a)&&(f=this._getParentPosition(i,v,"end"),r=f);var w=g?e(l).find(".pivotGridFrozenTable,.pivotGridValueTable").find("tr:not(.hdrTr)"):e(l).find("tr:not(.hdrTr)"),I=g?e(n).find(".pivotGridFrozenTable,.pivotGridValueTable").find("tr:not(.hdrTr)"):e(n).find("tr:not(.hdrTr)");for(this.model.enableRTL&&e(w).find(".summary,.rowheader,.colheader").css("text-align","right"),d=0;d<w.length;d++)h=e(w[d]).children().filter(function(){return e(this).attr("data-p").split(",")[0]>parseInt(_.split(",")[0])&&e(this).attr("data-p").split(",")[0]<=parseInt(r.split(",")[0])}),c=e(I[d]).children().filter(function(){return e(this).attr("data-p").split(",")[0]>parseInt(_.split(",")[0])&&e(this).attr("data-p").split(",")[0]<=parseInt(r.split(",")[0])}),0==e(I[d]).children().length?e(I[d]).append(h):e(I[d]).find("").eq(0).prev().length>0?(u=c.eq(0).prev(),c.remove(),h.insertAfter(u)):(c.remove(),e(I[d]).children(".colheader,.rowheader,.summary,.value").eq(0).length>0?h.eq(0).prev().length>0?h.insertAfter(e(I[d]).find('[data-p="'+h.eq(0).prev().attr("data-p")+'"]')):h.insertBefore(e(I[d]).children(".colheader,.rowheader,.summary,.value").eq(0)):e(I[d]).append(h))}},_cropHtml:function(t){return this._table=e(t).clone(),e(e(t)).find('[style*="display: none"]').remove(),t},renderControlFromJSON:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P;if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&(this.model.enablePaging||this.model.enableVirtualScrolling)&&0==this._isNavigation&&(i=this,r=setInterval(function(){if(null!=i._pagerObj){clearInterval(r);var e={CategoricalCurrentPage:i.model.dataSource.pagerOptions.categoricalCurrentPage,CategoricalPageSize:i.model.dataSource.pagerOptions.categoricalPageSize,SeriesCurrentPage:i.model.dataSource.pagerOptions.seriesCurrentPage,SeriesPageSize:i.model.dataSource.pagerOptions.seriesPageSize},t={Column:i._categPageCount,Row:i._seriesPageCount};i._pagerObj.element.css("opacity","1"),i._pagerObj.element.find(".e-pagerTextBox").removeAttr("disabled"),i._pagerObj._unwireEvents(),i._pagerObj._wireEvents(),i._pagerObj.initPagerProperties(t,e)}},10)),this._isNavigation=!1,l=null,!t.isNullOrUndefined(this.model.valueSortSettings)&&this.element.find(".valueSorting").length>0&&!t.isNullOrUndefined(t.PivotAnalysis._valueSorting)&&(l=this.element.find(".valueSorting").parent()),n=null!=this._excelLikeJSONRecords&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this._excelLikeJSONRecords:this.getJSONRecords(),!this.model.enableJSONRendering&&!this.model.enableDefaultValue&&!t.isNullOrUndefined(n)&&n.length>0&&this.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?0==JSON.parse(this.getOlapReport()).PivotCalculations.length&&t.isNullOrUndefined(JSON.parse(this.getOlapReport()).CalculatedMeasure):0==this.model.dataSource.values.length||0==this.model.dataSource.values[0].measures.length)&&(n=e.map(n,function(e){return e.CSS.indexOf("value")>-1&&(e.Value=""),e}),this.setJSONRecords(JSON.stringify(n))),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&0==this.model.dataSource.values.length&&0==this.model.dataSource.rows.length&&(n=n.filter(function(e){return e.Index=Number(e.Index.split(",")[0])-1+","+e.Index.split(",")[1],-1!=e.Index.split(",")[0]?e:void 0})),t.isNullOrUndefined(n)||(n=this._appendCssClassName(n)),this.model.enableConditionalFormatting&&this._isFormatApply&&!t.isNullOrUndefined(n)&&n.length>0&&(n=this._refreshCellFormatting(n)),this.model.enableConditionalFormatting&&!this._isFormatApply&&!t.isNullOrUndefined(n)&&n.length>0&&(n=this._applyCodeBehindFormatting(n)),e(this.element).parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableToolBar&&!this._pivotClientObj.model.displaySettings.enableFullScreen&&(s=e("<div id="+this._id+"Toolbar style='width:"+this._pivotClientObj._gridWidth+";height:"+this._pivotClientObj._gridHeight+";overflow:auto;margin-top:5px;margin-left:5px'></div>")),null!=n&&""!=n)for(m=0;m<n.length;m++)"Total"==n[m].Value&&(n[m].Value=this._getLocalizedLabels("Total")),"Grand Total"==n[m].Value&&(n[m].Value=this._getLocalizedLabels("GrandTotal"));if(this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this._applyLocale(n),o=e("<table class=\"e-pivotGridTable\" role='grid'  aria-readonly='true'></table>"),this.model.isResponsive&&o.addClass("e-table"),this.model.enableColumnResizing&&this.model.resizeColumnsToFit&&o.addClass("e-column-resizeToContent"),(!this.model.enableColumnResizing||this.model.resizeColumnsToFit)&&(this.model.enableColumnResizing||this.model.resizeColumnsToFit)||o.addClass("e-column-resizeToSize"),null!=n&&""!=n||this.model.enableGroupingBar){if(null!=n&&""!=n){for(h=this._rowCount,this._rowCount=0,this,S=0;S<n.length&&0==parseInt(n[S].Index.split(",")[0]);S++)this._rowCount++;if(this._rowCount=null!=this._excelLikeJSONRecords&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this._excelRowCount:this._rowCount,this.model.analysisMode==t.Pivot.AnalysisMode.Olap){var k,j,M,V,B,H,X,U,z,q,G=this._rowCount,W=!1,K=!1,J=!1,Q=!1,Y=e.extend(!0,[],n),$=t.isNullOrUndefined(this._pivotClientObj)?this.model.subTotalSettings:this._pivotClientObj.model.subTotalSettings,Z=this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?JSON.parse(this.getOlapReport()).PivotRows:this.model.dataSource.rows,ee=this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?JSON.parse(this.getOlapReport()).PivotColumns:this.model.dataSource.columns;if(!t.isNullOrUndefined($))for(w=0;w<$.length;w++){for(I=0;I<Z.length;I++)$[w].name==(t.isNullOrUndefined(Z[I].Tag)?Z[I].fieldName:Z[I].Tag)&&(J=!0);for(I=0;I<ee.length;I++)$[w].name==(t.isNullOrUndefined(ee[I].Tag)?ee[I].fieldName:ee[I].Tag)&&(Q=!0)}if(c=t.isNullOrUndefined(this._pivotClientObj)?this.layout():this._pivotClientObj.gridLayout(),!t.isNullOrUndefined($)&&1==J)for(0==(u=Y.filter(function(e){return"rowheader"==e.CSS&&1!=e.RowSpan&&1==e.State}))&&(u=Y.filter(function(e){return"rowheader"==e.CSS&&1!=e.RowSpan})),m=0;m<$.length;m++)for(w=0;w<$[m].levels.length;w++)if(1==$[m].levels[w].showSubTotal&&"excellikelayout"!=c)for(I=0;I<u.length;I++)if($[m].levels[w].name==u[I].Info.split(".&")[0])for(M=u[I].Index.split(",")[0],V=u[I].ColSpan,B=u[I].Index.split(",")[1],_=0;_<Y.length;_++)if(("summary"==Y[_].CSS||"summary row"==Y[_].CSS)&&!t.isNullOrUndefined(Y[_].Value)&&!t.isNullOrUndefined(Y[_+1])&&Y[_].Index.split(",")[0]==Y[_+1].Index.split(",")[0]&&Y[_].Index.split(",")[0]==(parseInt(M)+V).toString()&&parseInt(B)<=parseInt(Y[_].Index.split(",")[1])){if(W=!0,H=Y[_].Index.split(",")[1],X=Y[_],U=Y[_].RowSpan,Y.splice(e.inArray(X,Y),1),(z=U)>1)for(;1!=z;)X=Y[_],Y.splice(e.inArray(X,Y),1),z--;for(f=0;f<Y.length;f++)if(Y[f].Index.split(",")[1]==H&&(X=Y[f],z=U,Y.splice(e.inArray(X,Y),1),z>1))for(;1!=z;)X=Y[f],Y.splice(e.inArray(X,Y),1),z--;G-=U;break}if(!t.isNullOrUndefined($)&&1==Q)for(0==(g=Y.filter(function(e){return"colheader"==e.CSS&&1!=e.ColSpan&&1==e.State}))&&(g=Y.filter(function(e){return"colheader"==e.CSS&&1!=e.ColSpan})),p=(Y.length/this._rowCount-1).toString(),m=0;m<$.length;m++)for(w=0;w<$[m].levels.length;w++)if(1==$[m].levels[w].showSubTotal&&"excellikelayout"!=c)for(I=0;I<g.length;I++)if($[m].levels[w].name==g[I].Info.split(".&")[0])for(H=g[I].Index.split(",")[1],U=g[I].RowSpan,B=g[I].Index.split(",")[0],ColSpan=parseInt(g[I].ColSpan)-1,_=0;_<Y.length;_++)if(("summary"==Y[_].CSS||"summary col"==Y[_].CSS)&&parseInt(Y[_].Index.split(",")[0])!=p&&parseInt(Y[_].Index.split(",")[1])==parseInt(H)+U&&parseInt(Y[_].Index.split(",")[0])<=parseInt(B)+ColSpan&&parseInt(B)<=parseInt(Y[_].Index.split(",")[0])){for(K=!0,M=Y[_].Index.split(",")[0],X=Y[_],V=Y[_].ColSpan,Index=_,Y.splice(e.inArray(X,Y),1),f=0;f<Y.length;f++)Y[f].Index.split(",")[0]==M&&(X=Y[f],colSpancount=(V-1)*G,Y.splice(e.inArray(X,Y),1),f-=1);if(colSpancount>G)for(;colSpancount>0;)X=Y[_-1],Y.splice(e.inArray(X,Y),1),colSpancount--;_--}if(G!=this._rowCount&&1==W)for(b=Y[0].RowSpan;b<Y.length;b++)if(("rowheader"==Y[b].CSS||"summary"==Y[b].CSS||"summary row"==Y[b].CSS)&&1!=Y[b].RowSpan&&!t.isNullOrUndefined(Y[b].State)){for(H=Y[b].Index.split(",")[1],q=Y[b].Index.split(",")[0],U=0,I=0;I<Y[b].RowSpan;I++)parseInt(H)+Y[b].RowSpan>Y[b+I].Index.split(",")[1]&&q==Y[b+I].Index.split(",")[0]&&U++;Y[b].RowSpan=U}if(1==K)for(b=0;b<Y.length;b++)if(("colheader"==Y[b].CSS||"summary"==Y[b].CSS||"summary col"==Y[b].CSS)&&1!=Y[b].ColSpan&&!t.isNullOrUndefined(Y[b].State)){for(H=Y[b].Index.split(",")[1],q=Y[b].Index.split(",")[0],V=0,I=0;I<Y.length;I++)b+I<Y.length&&parseInt(q)+Y[b].ColSpan>parseInt(Y[b+I].Index.split(",")[0])&&H==Y[b+I].Index.split(",")[1]&&(V++,I+=G-1);Y[b].ColSpan=V}}1==W||1==K?(k=Y,j=t.isNullOrUndefined(G)?this._rowCount:G,this._rowLength=t.isNullOrUndefined(G)?this._rowCount:G):(k=n,j=this._rowCount);var te=e("<thead></thead>"),ie=e("<tbody></tbody>"),re=!0,le=0;for("none"==k[0].CSS?le=e(this.element).parents(".e-pivotclient").length>0&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&0==JSON.parse(this._pivotClientObj.getOlapReport()).PivotCalculations.length&&0==JSON.parse(this._pivotClientObj.getOlapReport()).PivotRows.length?JSON.parse(this._pivotClientObj.getOlapReport()).PivotColumns.length-1:k[0].RowSpan-1:(jQuery.each(k,function(e){return le+=k[e].RowSpan,"colheader"==k[e].CSS}),le-=2),ne=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,C=!1,S=0;S<k.length;S++)if(S<j)if(re){for(re=!(S>=le),x="<tr role='row'>",this.model.enableGroupingBar&&"0,0"==k[S].Index&&k[S].CSS.indexOf("colheader")>-1&&(x=x+"<"+(ne?"td":"th")+" class='e-grpRow' data-p='-1,-1' colspan= 1 rowspan="+(j-1)+"> <div class=e-rows>"+this._getLocalizedLabels("DragFieldHere")+"</div></th>",C=!0),v=S;v<k.length;v+=j)if("Block"!=k[v].Span)if(x="0,0"==k[v].Index&&-1==k[v].CSS.indexOf("colheader")&&this.model.enableGroupingBar?x+"<"+(ne?"td":"th")+" class=e-grpRow data-p="+k[v].Index+" colspan="+k[v].ColSpan+" rowspan="+k[v].RowSpan+" role='columnheader' aria-label='row'"+(null==k[v].i?"":"data-i="+k[v].i)+">"+(0==k[v].State?'<span style="margin-left: 0px"></span>':2==k[v].State?'<span class="e-expand e-icon" aria-label=\'collapsed\' title="'+this._getLocalizedLabels("Expand")+'">&nbsp;</span>':1==k[v].State?'<span class="e-collapse e-icon" aria-label=\'expanded\' title="'+this._getLocalizedLabels("Collapse")+'">&nbsp;</span>':"")+k[v].Value+t.buildTag("div.e-rows",this._pivotRow,{})[0].outerHTML+"</th>":x+"<"+(ne?"td":"th")+("none"==k[v].CSS?"":' class="'+k[v].CSS)+("none"==k[v].CSS?" data-p="+k[v].Index:'" data-p='+k[v].Index)+" colspan="+k[v].ColSpan+" rowspan="+k[v].RowSpan+" role='columnheader'"+(null==k[v].i?"":"data-i="+k[v].i)+">"+(0==k[v].State?'<span style="margin-left: 10px"></span>':2==k[v].State?'<span class="e-expand e-icon" aria-label=\'collapsed\' title="'+this._getLocalizedLabels("Expand")+'">&nbsp;</span>':1==k[v].State?'<span class="e-collapse e-icon" aria-label=\'expanded\' title=" '+this._getLocalizedLabels("Collapse")+'">&nbsp;</span>':"")+k[v].Value+"</th>",k[v].RowSpan>1&&k[v].ColSpan<=1)for(w=v+1;w<v+k[v].RowSpan;w++)t.isNullOrUndefined(k[w])||(k[w].Span="Block");else if(k[v].ColSpan>1&&k[v].RowSpan<=1)for(w=v+j;w<v+k[v].ColSpan*j;w+=j)t.isNullOrUndefined(k[w])||(k[w].Span="Block");else if(k[v].ColSpan>1&&k[v].RowSpan>1)for(w=v;w<v+k[v].RowSpan;w++){for(I=w+j;I<w+k[v].ColSpan*j;I+=j)t.isNullOrUndefined(k[I])||(k[I].Span="Block");w!=v&&(t.isNullOrUndefined(k[w])||(k[w].Span="Block"))}""!=e(x+="</tr>").text()&&e(te).append(x)}else{for(x="<tr role='row'>",0==parseInt(k[S].Index.split(",")[0])&&parseInt(k[S].Index.split(",")[1])==j-1&&C&&(x=x+"<td class='rowheader' data-p='-1,-2' colspan=1 rowspan=1>"+(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot||this.model.layout==t.PivotGrid.Layout.ExcelLikeLayout?this._getLocalizedLabels("GrandTotal"):this._getLocalizedLabels("Total"))+"</td>"),v=S;v<k.length;v+=j)if("Block"!=k[v].Span)if(x=k[v].CSS.indexOf("rowheader")>-1||"summary"==k[v].CSS||k[v].CSS.indexOf("summary rstot")>-1||k[v].CSS.indexOf("summary stot")>-1||"summary row"==k[v].CSS||k[v].CSS.indexOf("summary rgtot")>-1?"excellikelayout"==this.layout().toLowerCase()?x+"<"+(ne?"td":"th")+("none"==k[v].CSS?"":' class="'+k[v].CSS)+'" data-p='+k[v].Index+" colspan="+k[v].ColSpan+" rowspan="+k[v].RowSpan+" role='rowheader'"+(null==k[v].i?"":"data-i="+k[v].i)+">"+(2==k[v].State?'<span style="margin-'+(this.model.enableRTL?"right:":"left:")+10*k[v].Level+'px" class="e-expand e-icon" aria-label=\'collapsed\' title="'+this._getLocalizedLabels("Expand")+'">&nbsp;</span>':1==k[v].State?'<span style="margin-'+(this.model.enableRTL?"right:":"left:")+10*k[v].Level+'px" class="e-collapse e-icon" aria-label=\'expanded\' title="'+this._getLocalizedLabels("Collapse")+'">&nbsp;</span>':'<span style="margin-'+(this.model.enableRTL?"right:":"left:")+(null!=this._excelLikeJSONRecords&&"summary row"==k[v].CSS?10*k[v].Level:10*(1==k[v].Level?1:k[v].Level+2))+'px">&nbsp;</span>')+k[v].Value+"</th>":x+"<"+(ne?"td":"th")+("none"==k[v].CSS?"":' class="'+k[v].CSS)+'" data-p='+k[v].Index+" colspan="+k[v].ColSpan+" rowspan="+k[v].RowSpan+" role='rowheader'>"+(0==k[v].State?'<span style="margin-left: 10px"></span>':2==k[v].State?'<span class="e-expand e-icon" aria-label=\'collapsed\' title="'+this._getLocalizedLabels("Expand")+'">&nbsp;</span>':1==k[v].State?'<span class="e-collapse e-icon" aria-label=\'expanded\' title="'+this._getLocalizedLabels("Collapse")+'">&nbsp;</span>':"")+k[v].Value+"</th>":x+"<td"+("none"==k[v].CSS?"":' class="'+k[v].CSS)+'" data-p='+k[v].Index+" colspan="+k[v].ColSpan+" rowspan="+k[v].RowSpan+" role='gridcell'"+(null==k[v].i?"":"data-i="+k[v].i)+">"+(2==k[v].State?'<span class="e-expand e-icon" title="'+this._getLocalizedLabels("Expand")+'">&nbsp;</span>':1==k[v].State?'<span class="e-collapse e-icon" title="'+this._getLocalizedLabels("Collapse")+'">&nbsp;</span>':"")+k[v].Value+"</td>",k[v].RowSpan>1&&k[v].ColSpan<=1)for(w=v+1;w<v+k[v].RowSpan;w++)t.isNullOrUndefined(k[w])||(k[w].Span="Block");else if(k[v].ColSpan>1&&k[v].RowSpan<=1)for(w=v+j;w<v+k[v].ColSpan*j;w+=j)t.isNullOrUndefined(k[w])||(k[w].Span="Block");else if(k[v].ColSpan>1&&k[v].RowSpan>1)for(w=v;w<v+k[v].RowSpan;w++){for(I=w+j;I<w+k[v].ColSpan*j;I+=j)t.isNullOrUndefined(k[I])||(k[I].Span="Block");w!=v&&(t.isNullOrUndefined(k[w])||(k[w].Span="Block"))}""!=e(x+="</tr>").text()&&e(ie).append(x)}ne?this._renderFrozenGridTable(o,te,ie):(e(o).append(te),e(o).append(ie))}}else a=t.buildTag("tr",t.buildTag("th","",{width:"70px"})[0].outerHTML+t.buildTag("th","",{width:"70px"})[0].outerHTML+t.buildTag("th","",{width:"70px"})[0].outerHTML),d=t.buildTag("tr",t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML)[0].outerHTML,e(o).append(a),e(o).append(d),this._rowCount=0;if(this._unWireEvents(),this._wireEvents(),y=!1,this._pivotClientObj&&"olap"==this._pivotClientObj.model.analysisMode&&"clientmode"==this._pivotClientObj.model.operationalMode&&(y=this._pivotClientObj.model.enableVirtualScrolling||this._pivotClientObj.model.enablePaging),this.model.enableVirtualScrolling||y||!(e(o).find("tr:last > td").length>0)||""!=e(o).find("tr:last").find("td").text()||this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot||null!=this._pagerObj||e(o).find("tr:last").hide(),this.model.enablePaging||this.model.enableVirtualScrolling||(this._hideGrandTotal(o),this._hideSubTotal(o)),this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(this.model.enableCollapseByDefault||!t.isNullOrUndefined(this.model.collapsedMembers))&&!t.isNullOrUndefined(k))if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.enableCollapseByDefault){var ne=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,se=t.isNullOrUndefined(this.model.dataSource.data)||t.isNullOrUndefined(this.model.dataSource.rows)?e(this.element).parents(".e-pivotclient").length>0&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(this._pivotClientObj.getOlapReport()).PivotRows.length:JSON.parse(this.getOlapReport()).PivotRows.length:this.model.dataSource.rows.length,oe=t.isNullOrUndefined(this.model.dataSource.data)||t.isNullOrUndefined(this.model.dataSource.columns)?e(this.element).parents(".e-pivotclient").length>0&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(this._pivotClientObj.getOlapReport()).PivotColumns.length:JSON.parse(this.getOlapReport()).PivotColumns.length:this.model.dataSource.columns.length;for(this.model.collapsedMembers={},R=se;R>=0;R--)for(T=ne?e(o).find(".pivotGridRowTable [data-p^='"+R+",']:has('span.e-collapse')[class^='rowheader']"):e(o).find("th[data-p^='"+R+",']:has('span.e-collapse')[class^='rowheader']"),F=this._getFieldName(T[0]),this.model.collapsedMembers[F]=[],E=0;E<T.length;E++)this.model.collapsedMembers[F].push(e(T[E]).clone().children().remove().end().text()),this._collapseMember(o,e(T[E]).find(".e-collapse"));for(O=oe;O>=0;O--)for(L=e(o).find((ne?".pivotGridFrozenTable ":"th")+"[data-p$=',"+O+"']:has('span.e-collapse')[class$='colheader']"),F=this._getFieldName(L[0]),this.model.collapsedMembers[F]=[],E=0;E<L.length;E++)this.model.collapsedMembers[F].push(e(T[E]).clone().children().remove().end().text()),this._collapseMember(o,e(L[E]).find(".e-collapse"))}else t.isNullOrUndefined(this.model.collapsedMembers)||(D=this,e.each(this.model.collapsedMembers,function(i,r){var l,n,s,a,d,h,c,u;r=r;if(D.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){for(d=0;d<D.model.dataSource.rows.length;d++)D.model.dataSource.rows[d].fieldName==i&&(l=d,n="row");for(d=0;d<D.model.dataSource.columns.length;d++)D.model.dataSource.columns[d].fieldName==i&&(l=d,n="column");if(!t.isNullOrUndefined(l))if("row"==n)for(d=D.model.dataSource.columns.length+1;d<D._rowCount;d+=t.isNullOrUndefined(h)?1:h.rowSpan){for(h=e(o).find("tBody th[data-p='"+l+","+d+"']")[0],c=!1,u=0;u<r.length;u++)if(e.trim(e(h).text().replace("expanded",""))==e.trim(r[u].toString())){c=!0;break}!t.isNullOrUndefined(h)&&(e(h).hasClass("rowheader")||"rowheader"==e(h).attr("role"))&&c&&e(h).find(".e-collapse").length>0&&D._collapseMember(o,e(h).find(".e-collapse"))}else if("column"==n)for(d=D.model.dataSource.rows.length;d<Math.ceil(D.getJSONRecords().length/D._rowCount);d+=t.isNullOrUndefined(h)?1:h.colSpan){for(h=e(o).find("thead th[data-p='"+d+","+l+"']")[0],c=!1,u=0;u<r.length;u++)if(e.trim(e(h).text().replace("expanded",""))==e.trim(r[u].toString())){c=!0;break}!t.isNullOrUndefined(h)&&(e(h).hasClass("colheader")||"columnheader"==e(h).attr("role"))&&c&&e(h).find(".e-collapse").length>0&&D._collapseMember(o,e(h).find(".e-collapse"))}}else{for(s=JSON.parse(D.getOlapReport()).PivotRows,a=JSON.parse(D.getOlapReport()).PivotColumns,d=0;d<s.length;d++)s[d].FieldName==i&&(l=d,n="row");for(d=0;d<a.length;d++)a[d].FieldName==i&&(l=d,n="column");if(!t.isNullOrUndefined(l))if("row"==n)for(d=a.length+1;d<D._rowCount;d+=t.isNullOrUndefined(h)?1:h.rowSpan){for(h=e(o).find("tBody th[data-p='"+l+","+d+"']")[0],c=!1,u=0;u<r.length;u++)if(e.trim(e(h).text().replace("expanded",""))==e.trim(r[u].toString())){c=!0;break}!t.isNullOrUndefined(h)&&(e(h).hasClass("rowheader")||"rowheader"==e(h).attr("role"))&&c&&e(h).find(".e-collapse").length>0&&D._collapseMember(o,e(h).find(".e-collapse"))}else if("column"==n)for(d=s.length;d<Math.ceil(D.getJSONRecords().length/D._rowCount);d+=t.isNullOrUndefined(h)?1:h.colSpan){for(h=e(o).find("thead th[data-p='"+d+","+l+"']")[0],c=!1,u=0;u<r.length;u++)if(e.trim(e(h).text().replace("expanded",""))==e.trim(r[u].toString())){c=!0;break}!t.isNullOrUndefined(h)&&(e(h).hasClass("colheader")||"columnheader"==e(h).attr("role"))&&c&&e(h).find(".e-collapse").length>0&&D._collapseMember(o,e(h).find(".e-collapse"))}}}));if(this.element.html(""),this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot||this.model.enablePaging||this.model.enableVirtualScrolling||(this.model.enableAdvancedFilter||e(this.element).parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableAdvancedFilter)&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||(o=this._cropHtml(o)),this.model.enableGroupingBar?(this.element.append(o),(null==this._JSONRecords||0==this._JSONRecords.length)&&this.element.append(t.buildTag("span",this._getLocalizedLabels("NoRecordsToDisplay"),{display:"inline-block",padding:"10px 0px 0px 0px","font-family":"Segoe UI"})[0].outerHTML),this.model.enableRTL&&this.element.addClass("e-rtl"),this._createFields(o,e("#"+this._id).find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth())):e(this.element).parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableToolBar&&!this._pivotClientObj.model.displaySettings.enableFullScreen?(e(s).append(o),this.element.append(e(s))):this.element.append(o),(this.model.enableColumnResizing&&this.model.resizeColumnsToFit||this.model.enableColumnResizing&&!this.model.resizeColumnsToFit)&&this._resizeColumnsWidth(),(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&(this._applyFrozenHeaderWidth(k),this.element.find(".e-pivotGridTable").width("auto")),this.model.enableVirtualScrolling&&t.isNullOrUndefined(this._pivotClientObj)&&(this._createVirtualPivotGrid(o),this.model.enableGroupingBar&&this._createFields(null,e("#"+this._id).find(".e-pivotGridTable").width(),e("#"+this._id).find(".e-pivotGridTable th").outerWidth()),this.model.enableRTL&&this.element.addClass("e-rtl"),this._applyVScrolling()),t.isNullOrUndefined(this._pivotClientObj)||!this._pivotClientObj.model.enableVirtualScrolling||this._pivotClientObj.model.enablePaging||(this._pivotClientObj.element.find(".e-categPageIndicator, .e-seriesPageIndicator , .e-vScrollThumb, .e-hScrollThumb").remove(),N=t.buildTag("div.e-seriesPageIndicator inActive",t.buildTag("span.axislabel",this._getLocalizedLabels("SeriesPage")+" : ")[0].outerHTML+t.buildTag("span.series_CurrentPage",this._seriesCurrentPage)[0].outerHTML+" / "+t.buildTag("span.series_pageCount",this._seriesPageCount)[0].outerHTML)[0].outerHTML,this._seriesPageCount>1?(12!=this._pivotClientObj.element.find(".e-vScrollPanel").width()&&this._pivotClientObj.element.width(this._pivotClientObj.element.width()+12),this._pivotClientObj.element.find(".e-vScrollPanel").width(12),this._pivotClientObj.element.find(".virtualScrolling").append(N),this._pivotClientObj.controlPlacement()==t.PivotClient.ControlPlacement.Tab&&this._pivotClientObj.model.displaySettings.mode==t.PivotClient.DisplayMode.ChartAndGrid?this._pivotClientObj.element.find(".virtualScrolling").css("padding-top","10px"):this._pivotClientObj.element.find(".virtualScrolling").css("padding-left","2px")):12==this._pivotClientObj.element.find(".e-vScrollPanel").width()&&(this._pivotClientObj.element.width(this._pivotClientObj.element.width()-12),this._pivotClientObj.element.find(".e-vScrollPanel").width(0)),A=t.buildTag("div.e-categPageIndicator inActive",t.buildTag("span.axislabel",this._getLocalizedLabels("CategoricalPage")+" : ")[0].outerHTML+t.buildTag("span.categ_CurrentPage",this._categCurrentPage)[0].outerHTML+" / "+t.buildTag("span.categ_pageCount",this._categPageCount)[0].outerHTML)[0].outerHTML,this._categPageCount>1?(12!=this._pivotClientObj.element.find(".e-hScrollPanel").height()&&this._pivotClientObj.element.find(".e-hScrollPanel").height(12),this._pivotClientObj.controlPlacement()==t.PivotClient.ControlPlacement.title&&this._pivotClientObj.element.find(".hsVirtualScrolling").css("margin-top","3px"),this._pivotClientObj.element.find(".hsVirtualScrolling").append(A)):12==this._pivotClientObj.element.find(".e-hScrollPanel").height()&&(this._pivotClientObj.model.isResponsive?this._pivotClientObj.element.find(".e-categoricalAxis, .e-rowAxis,.e-slicerAxis").height(this._pivotClientObj.element.find(".e-categoricalAxis, .e-rowAxis,.e-slicerAxis").height()-6):this._pivotClientObj.element.find(".e-categoricalAxis, .e-rowAxis,.e-slicerAxis").height(150),this._pivotClientObj.model.enableSplitter||this._pivotClientObj.element.find(".e-cubeBrowser").height(this._pivotClientObj.element.find(".e-cubeBrowser").height()-20),this._pivotClientObj.element.find(".e-hScrollPanel").height(0)),this._applyVScrolling(),this._pivotClientObj.element.find(".e-chartContainer").length>0&&this._pivotClientObj.element.find(".e-gridContainer").height(this._pivotClientObj.element.find(".e-chartContainer").height()+5),this._pivotClientObj.model.enableSplitter&&(t.isNullOrUndefined(this._pivotClientObj.element.find(".e-childsplit").data("ejSplitter"))||this._pivotClientObj.element.find(".e-childsplit").data("ejSplitter").refresh(),t.isNullOrUndefined(this._pivotClientObj.element.find(".e-serverchildsplit").data("ejSplitter"))||this._pivotClientObj.element.find(".e-serverchildsplit").data("ejSplitter").refresh())),this.model.enableColumnResizing?this.element.addClass("e-column-resize"):this.element.removeClass("e-column-resize"),this.model.enableRTL?(this.element.addClass("e-rtl"),this.element.find(".groupingBarPivot").addClass("e-rtl"),this.element.find("table .rowheader,.colheader,.summary, .groupingBarPivot, .e-grpRow").css("text-align","right")):(this.element.removeClass("e-rtl"),this.element.find(".groupingBarPivot").removeClass("e-rtl"),this.element.find("table .rowheader,.colheader,.summary, .e-grpRow, .groupingBarPivot ").css("text-align","left")),e(this.element).parents(".e-pivotclient").length>0&&this._pivotClientObj.model.enableToolBar&&!this._pivotClientObj.model.displaySettings.enableFullScreen){e("#"+this._id).prepend("<div class='toolBar' style='height:40px,width:"+this.element.find("#PivotGridToolbar").width()+"px'></div>");var ae,de="",he=t.buildTag("li#frozenHeaders.e-frozenHeaders e-icon","",{}).attr("aria-label",this._getLocalizedLabels("FrozenHeader")).attr({title:this._getLocalizedLabels("FrozenHeader"),tabindex:0})[0].outerHTML;t.buildTag("li.e-cellSelect e-icon","",{}).attr("aria-label",this._getLocalizedLabels("CellSelection")).attr({title:this._getLocalizedLabels("CellSelection"),tabindex:0})[0].outerHTML;this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(de=t.buildTag("li#collapseByDefault.e-collapseByDefault e-icon","",{}).attr("aria-label",this._getLocalizedLabels("CollapseByDefault")).attr({title:this._getLocalizedLabels("CollapseByDefault"),tabindex:0})[0].outerHTML),ae=t.buildTag("li.e-numberFormatting e-icon","",{}).attr("aria-label",this._getLocalizedLabels("NumberFormatting")).attr({title:this._getLocalizedLabels("NumberFormatting"),tabindex:0})[0].outerHTML,t.buildTag("li.e-calculatedField e-icon","",{}).attr("aria-label",this._getLocalizedLabels("CalculatedField")).attr({title:this._getLocalizedLabels("CalculatedField"),tabindex:0})[0].outerHTML,P=t.buildTag("ul",(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?t.buildTag("li#cellEditing.e-cellEditing e-icon","",{}).attr("aria-label",this._getLocalizedLabels("CellEditing")).attr({title:this._getLocalizedLabels("CellEditing"),tabindex:0})[0].outerHTML:" ")+t.buildTag("li#drillThrough.e-drillThrough e-icon","",{}).attr("aria-label",this._getLocalizedLabels("DrillThrough")).attr({title:this._getLocalizedLabels("DrillThrough"),tabindex:0})[0].outerHTML+(this.model.analysisMode!=t.Pivot.AnalysisMode.Pivot&&this.model.analysisMode!=t.Pivot.AnalysisMode.Olap||this.model.operationalMode!=t.Pivot.OperationalMode.ServerMode?t.buildTag("li.e-advancedFiltering e-icon","",{}).attr("aria-label",this._getLocalizedLabels("AdvancedFiltering")).attr({title:this._getLocalizedLabels("AdvancedFiltering"),tabindex:0})[0].outerHTML:"")+t.buildTag("li#columnResize.e-columnResize e-icon","",{}).attr("aria-label",this._getLocalizedLabels("ColumnResize")).attr({title:this._getLocalizedLabels("ColumnResize"),tabindex:0})[0].outerHTML+t.buildTag("li.e-toolTip e-icon","",{}).attr("aria-label",this._getLocalizedLabels("ToolTip")).attr({title:this._getLocalizedLabels("ToolTip"),tabindex:0})[0].outerHTML+(this._pivotClientObj.displayMode()==t.PivotClient.DisplayMode.GridOnly?de:"")+t.buildTag("li.rtl e-icon","",{}).attr("aria-label",this._getLocalizedLabels("RTL")).attr({title:this._getLocalizedLabels("RTL"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("ul",t.buildTag("li.e-hyperlinkOptions e-icon","",{}).attr("aria-label",this._getLocalizedLabels("HyperLink")).attr({title:this._getLocalizedLabels("HyperLink"),tabindex:0})[0].outerHTML+t.buildTag("li.e-layouts e-icon","",{}).attr("aria-label",this._getLocalizedLabels("Layouts")).attr({title:this._getLocalizedLabels("Layouts"),tabindex:0})[0].outerHTML+he+t.buildTag("li.e-exporting e-icon","",{}).attr("aria-label",this._getLocalizedLabels("Exporting")).attr({title:this._getLocalizedLabels("Exporting"),tabindex:0})[0].outerHTML)[0].outerHTML+t.buildTag("ul",t.buildTag("li#summaryCustomize.e-summaryCustomize e-icon","",{}).attr("aria-label",this._getLocalizedLabels("SummaryCustomization")).attr({title:this._getLocalizedLabels("SummaryCustomization"),tabindex:0})[0].outerHTML+t.buildTag("li.e-conditionalFormat e-icon","",{}).attr("aria-label",this._getLocalizedLabels("ConditionalFormatting")).attr({title:this._getLocalizedLabels("ConditionalFormatting"),tabindex:0})[0].outerHTML+("pivot"==this._pivotClientObj.model.analysisMode&&"clientmode"==this._pivotClientObj.model.operationalMode?t.buildTag("li.e-summaryTypes e-icon","",{}).attr("aria-label",this._getLocalizedLabels("SummaryTypes")).attr({title:this._getLocalizedLabels("SummaryTypes"),tabindex:0})[0].outerHTML+ae:""))[0].outerHTML,e(".toolBar").append(P),e(".toolBar").ejToolbar({enableRTL:this.model.enableRTL,height:"35px",enableSeparator:!0})}this._stateMaintenance(),""!=e.trim(this.model.pivotTableFieldListID)&&this._isSchemaInitialize&&this.model.enablePivotFieldList&&this._renderPivotSchemaDesigner(),this.model._isXMLImport&&""!=e.trim(this.model.pivotTableFieldListID)&&(this.model.enablePivotFieldList?(e("#"+this.model.pivotTableFieldListID).css("display",""),this._renderPivotSchemaDesigner()):e("#"+this.model.pivotTableFieldListID).css("display","none"),this.model._isXMLImport=!1),null!=this._schemaData&&this.element.find(".colheader, .rowheader, .value").addClass("e-droppable"),this.exportRecords=1==W||1==K?k:n,t.Pivot.closePreventPanel(this),this._schemaData&&t.Pivot.closePreventPanel(this._schemaData),null!=this._excelLikeJSONRecords&&this.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout&&(this._rowCount=h),this.model.valueSortSettings&&this._refreshValueSortIcons(l),this.model.enableGroupingBar&&this.element.find(".e-pivotGridTable").width()>0&&(!(0==this.element.find(".values .e-pvtBtn, .columns .e-pvtBtn").length&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot)&&this.element.find("tbody .value").length>0&&this.element.find("thead tr").length>0&&this.element.find(".groupingBarPivot").width(this.element.find(".e-pivotGridTable").width()),this.model.enableColumnResizing&&(this.element.find(".groupingBarPivot").css({overflow:"hidden"}),this.element.find(".e-pivotGridTable").width()+1==this.element.width()&&this.element.find(".groupingBarPivot").css({width:"100%"}))),(this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&this._applyFrozenHeaderWidth(this._JSONRecords),this._applyHeaders()},_refreshValueSortIcons:function(i){var r,l;t.isNullOrUndefined(this.model.valueSortSettings.headerText)||""==this.model.valueSortSettings.headerText||t.isNullOrUndefined(t.PivotAnalysis._valueSorting)?t.isNullOrUndefined(i)||0!=e(i).find(".rowheader").length||this.element.find("[data-p='"+Number(e(i).attr("data-p").split(",")[0])+","+Number(e(i).attr("data-p").split(",")[1])+"']").html(i.html()):(r=this.element.find("[data-p='"+Number(t.PivotAnalysis._valueSorting)+","+Number(this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?JSON.parse(this.getOlapReport()).PivotColumns.length:this.model.dataSource.columns.length)+"']"),0!=e(r).find(".valueSorting").length||e(r).hasClass("rowheader")||(l=t.buildTag("span.valueSorting e-icon "+t.PivotAnalysis._sort).css("margin-left","5px").attr("role","button").attr("aria-label","sort")[0].outerHTML,e(r).append(l)))},_applyHeaders:function(){var i,r,l,n,s,o;if(null!=this._JSONRecords){var a=[],d=[],h={},c=[],u=this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode;if(this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap||!this.model.headerSettings.showColumnItems&&!this.model.headerSettings.showRowItems||this.model.enableGroupingBar){if(this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&(this.model.headerSettings.showColumnItems||this.model.headerSettings.showRowItems)&&"excellikelayout"!=this.model.layout&&!this.model.enableGroupingBar&&(u&&JSON.parse(this.getOlapReport()).PivotCalculations.length||!u&&this.model.dataSource.values[0].measures.length)&&("columns"==this._getAxis()||"rows"==this._getAxis())){for(i=0,r=-1,s=0;s<Number(this.element.find(".value:first").attr("data-p").split(",")[1])-1;s++)d[s]="";for(s=0;s<this._JSONRecords.length;s++)if(""!=this._JSONRecords[s].Info&&this._JSONRecords[s].Info.split("::")[1].indexOf("Measures")>-1&&"colheader"==this._JSONRecords[s].CSS){r=Number(this._JSONRecords[s].Index.split(",")[1]);break}for(s=0;s<this._JSONRecords.length;s++)"value"!=this._JSONRecords[s].CSS&&" value"!=this._JSONRecords[s].CSS&&("rowheader"==this._JSONRecords[s].CSS&&""!=this._JSONRecords[s].Info&&-1==e.inArray(e(".e-cubeTreeView").find("li[data-tag='"+this._JSONRecords[s].Info.split("::")[1]+"'] a:eq(0)").text(),a)&&-1==e.inArray(this._JSONRecords[s].Info.split("::")[1].replace(/[\[\]]+/g,""),a)&&-1===this._JSONRecords[s].Info.indexOf("Measure")&&(e(this.element).parents(".e-pivotclient").length>0?a.push(e(".e-cubeTreeView").find("li[data-tag='"+this._JSONRecords[s].Info.split("::")[1]+"'] a:eq(0)").text()):a.push(this._JSONRecords[s].Info.split("::")[1].replace(/[\[\]]+/g,"")),this.element.find("[data-p*='"+this._JSONRecords[s].Index.split(",")[0]+",'] .collapse").parent().not(".colheader").length>0?c.push(e(this.element.find("[data-p*='"+this._JSONRecords[s].Index.split(",")[0]+",'] .collapse").parent().not(".colheader")[0]).width()):c.push(this.element.find("[data-p='"+this._JSONRecords[s].Index.split(",")[0]+","+this._JSONRecords[s].Index.split(",")[1]+"']").width()),s+=this._rowCount-s%this._rowCount),"colheader"==this._JSONRecords[s].CSS&&""!=this._JSONRecords[s].Info&&(-1==e.inArray(e(".e-cubeTreeView").find("li[data-tag='"+this._JSONRecords[s].Info.split("::")[1]+"'] a:eq(0)").text(),d)||-1==e.inArray(this._JSONRecords[s].Info.split("::")[1].replace(/[\[\]]+/g,""),d))&&-1===this._JSONRecords[s].Info.indexOf("Measure")&&(i=-1!=r?r>Number(this._JSONRecords[s].Index.split(",")[1])?0:1:0,d[Number(this._JSONRecords[s].Index.split(",")[1])-i]=e(this.element).parents(".e-pivotclient").length>0?e(".e-cubeTreeView").find("li[data-tag='"+this._JSONRecords[s].Info.split("::")[1]+"'] a:eq(0)").text():this._JSONRecords[s].Info.split("::")[1].replace(/[\[\]]+/g,"")));h={rows:a,columns:d}}}else if(u&&(JSON.parse(this.getOlapReport()).PivotRows.length>0||JSON.parse(this.getOlapReport()).PivotColumns.length>0)&&JSON.parse(this.getOlapReport()).PivotCalculations.length>0||!u&&(this.model.dataSource.rows.length>0||this.model.dataSource.columns.length>0)&&this.model.dataSource.values.length>0){for(s=0;s<(u?JSON.parse(this.getOlapReport()).PivotRows.length:this.model.dataSource.rows.length);s++)a.push(u?JSON.parse(this.getOlapReport()).PivotRows[s].FieldHeader:this.model.dataSource.rows[s].fieldCaption);for(s=0;s<(u?JSON.parse(this.getOlapReport()).PivotColumns.length:this.model.dataSource.columns.length);s++)d.push(u?JSON.parse(this.getOlapReport()).PivotColumns[s].FieldHeader:this.model.dataSource.columns[s].fieldCaption);h={rows:a,columns:d}}if(!e.isEmptyObject(h)&&(this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&h.rows.length>0||"pivot"==this.model.analysisMode)){for(this.element.find(".e-pivotGridTable")&&(l=this.element.find(".e-pivotGridTable").find("tbody>tr:eq(0)"),t.isNullOrUndefined(l)||jQuery.each(e(l).find("th"),function(t,i){e(i).hasClass("rowheader")&&c.push(e(i).width())})),n=e("<table></table>").css({width:this.element.find(".colfreeze").length>0?this.element.find(".colfreeze").width()+10:this.element.find("[p='0,0']").width()+10,height:this.element.find(".colfreeze").length>0?this.element.find(".colfreeze").height()+10:this.element.find("[p='0,0']").height()+10}).attr({id:"hdrSec"}),s=0;s<h.columns.length+1;s++)if(a=e("<tr></tr>").attr({class:"hdrTr"}).appendTo(n),h.rows.length>0)for(o=0;o<h.rows.length;o++)e('<td class="e-headerItem"></td>').css("width",o==h.rows.length-1&&s<h.columns.length?c[h.rows.length-1]:c[o]).text(o==h.rows.length-1&&s<h.columns.length&&this.model.headerSettings.showColumnItems?this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?h.columns[s].split(".")[h.columns[s].split(".").length-1]:h.columns[s]:s==h.columns.length&&this.model.headerSettings.showRowItems?this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?h.rows[o].split(".")[h.rows[o].split(".").length-1]:h.rows[o]:"").attr("title",o==h.rows.length-1&&s<h.columns.length&&this.model.headerSettings.showColumnItems?h.columns[s]:s==h.columns.length&&this.model.headerSettings.showRowItems?h.rows[o]:"").appendTo(a);else this.model.headerSettings.showColumnItems&&e('<td class="e-headerItem"></td>').css("width",c[0]).text(this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?h.columns[s].split(".")[h.columns[s].split(".").length-1]:h.columns[s]).attr("title",h.columns[s]).appendTo(a);this.element.find(".colfreeze").length>0?(this.element.find(".colfreeze").css("visibility","visible").html(""),n.appendTo(this.element.find(".colfreeze"))):(this.element.find("[data-p='0,0']").css({padding:"0px"}).html(""),n.appendTo(this.element.find("[data-p='0,0']")))}}},_applyLocale:function(i){var l,n,s,o,a,d,h;if(0!=this.model.dataSource.values.length){for(l=!1,s=0;s<this.model.dataSource.values[0].measures.length;s++)if(this.model.dataSource.values[0].measures[s].format){l=!0;break}if(l)for(n=this._getAxis(),s=0;s<this.model.dataSource.values[0].measures.length;s++){var c,u=[],g=[],p=this.model.dataSource.values[0].measures[s].format;for(o=0;o<i.length;o++)g=this._getColumnIndices(n,i[o],this.model.dataSource.values[0].measures[s].fieldCaption,u);for(a=0;a<g.length;a++)for(d=0;d<i.length;d++)("rows"==n?i[d].Index.split(",")[1]:"columns"==n?i[d].Index.split(",")[0]:null)==g[a]&&""!=i[d].Value&&(c=(c=i[d].Value.replace(/[\s,%]/g,"")).replace(t.preferredCulture(this.model.locale).numberFormat.currency.symbol,""),e.isNumeric(c)&&p!=r&&(h=t.olap.base._getFormatedValue(c,p),i[d].Value=h))}}},_renderPivotSchemaDesigner:function(){var i,r,l;e("#"+this.model.pivotTableFieldListID).length>0&&(null!=(i=e("#"+this.model.pivotTableFieldListID).data("ejPivotSchemaDesigner"))?(i.model.pivotControl=this,i.model.enableWrapper=!0,i._load(),this._waitingPopup&&this._waitingPopup.hide(),this._isSchemaInitialize=!1):(r=this,l=setInterval(function(){var i=e("#"+r.model.pivotTableFieldListID).data("ejPivotSchemaDesigner");null!=i&&(clearInterval(l),i.model.pivotControl=r,i.model.enableWrapper=!0,i._load(),r._waitingPopup&&r._waitingPopup.hide(),r._isSchemaInitialize=!1,t.isNullOrUndefined(i.model.pivotControl)||i.model.pivotControl.element.find(".colheader, .rowheader, .value").addClass("e-droppable"))},10)))},_renderFrozenGridTable:function(i,r,l){var n,s,o,a,d,h,c,u,g,p=e("<table class=\"pivotGridFrozenTable\" style='height:47px' ></table>"),m=e('<table class="pivotGridRowTable" ></table>');n=e('<table class="pivotGridValueTable" ></table>'),s=e("<thead></thead>"),o=e("<tbody></tbody>"),a=e("<tbody></tbody>"),d="<tr role='row'>",h=e("<div class='rowhead' style='position: relative; float: left;display: inline-block'>"),e(s).append(e(r).children()),c=l.children().clone(),u=l.children().clone(),e(u).find(".value").remove(),e(o).append(e(u)),e(m).append(o),e(h).append(m),e(c).find(".rowheader, .summary:not(.summary.value)").remove(),e(a).append(e(c));var _=e(t.buildTag("div.colhead").css({position:"relative",overflow:"hidden"})[0].outerHTML),f=e(t.buildTag("div.colmovable")[0].outerHTML),b=e(t.buildTag("div.colfreeze").css({float:"left",height:"100%",visibility:this.model.enableGroupingBar?"visible":"hidden"})[0].outerHTML);e(_).append(e(p).append(s)),0==e(d).children().length&&(d=e("<tr role='row'></tr>")),e(d).length>0&&(e(f).append(_),e(b).append(e("<table id='colfretable' style='height:100%'></table>").append(d)));var C=e(t.buildTag("div#rowvaluecontent.valScrollArea")[0].outerHTML),S=e(t.buildTag("div.valueCell").css({position:"relative"})[0].outerHTML),x=e(t.buildTag("div.rowHeaderArea")[0].outerHTML);e(S).append(e(n).append(a)),!this.model.frozenHeaderSettings.enableFrozenRowHeaders&&this.model.frozenHeaderSettings.enableFrozenColumnHeaders?(e(i).append("<tr><td style='padding:0px'></td></tr><tr><td style='padding:0px'></td></tr>"),e(i).find("tr:first td:eq(0)").append(e("<div id='headerContent' class='headerContent'></div>")),e(e(i).find("tr:last td:eq(0)")).append(e(C)),e(i).find(".headerContent").append(f),e(i).find(".headerContent .colhead").prepend(b),e(i).find(".headerContent .colhead").append("<div class='headerTable'/>"),e(i).find(".pivotGridFrozenTable").appendTo(e(i).find(".headerTable")),e(i).find(".valScrollArea").append(e(x)),e(i).find(".rowHeaderArea").append(h,S)):this.model.frozenHeaderSettings.enableFrozenRowHeaders&&!this.model.frozenHeaderSettings.enableFrozenColumnHeaders?(e(i).append("<tr ><td style='padding:0px;border-right:0px' ></td><td style='padding:0px;'></td></tr>"),e(i).find("tr:first td:eq(0)").append(e("<div id='headerContent' class='headerContent' style='position:relative'></div>")),e(i).find(".headerContent").append(b,h),e(i).find("tr td:last").append(e(C)),e(i).find(".valScrollArea").append(e(x)),e(i).find(".rowHeaderArea").append(f,S)):(e(i).append("<tr><td style='padding:0px'></td><td style='padding:0px;'></td></tr><tr><td style='padding:0px'></td><td style='padding:0px' class='valueArea'></td></tr>"),e(i).find("tr:first td:eq(0)").append(b),e(i).find("tr:first").children("td:eq(1)").append(f),e(i).find("tr:last td:eq(0)").append(e(x)),e(i).find(".rowHeaderArea").append(h),e(i).find(".valueArea").append(e(C)),e(i).find(".valScrollArea").append(S)),this.model.enableGroupingBar?e(i).find(".e-grpRow").length>0&&(e(i).find(".e-grpRow").appendTo(e(i).find(".colfreeze table tr:eq(0)")),e(i).find(".e-grpRow").removeAttr("colspan").removeAttr("rowspan")):(e(i).find("[data-p='0,0']").length>0||e(i).find("[data-p='-1,-1']").length>0)&&(this.model.enablePaging||this.model.enableVirtualScrolling?e(i).find(".rowheader").length>0||e(i).find(".rstot").length>0||e(i).find(".rgtot").length>0:e(i).find(".rowheader").length>0)&&(g=e(i).find("[data-p='-1,-1']").length>0?"-1,-1":"0,0",e(i).find("[data-p='"+g+"']").appendTo(e(i).find(".colfreeze table tr:eq(0)")),e(i).find("[data-p='"+g+"']").removeAttr("colspan").removeAttr("rowspan"))},_applyFrozenHeaderWidth:function(i){var r,l,n,s,o;if((this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders)&&!t.isNullOrUndefined(i)&&i.length>0){(r=this.element.find(".e-scroller").data("ejScroller"))&&(r.destroy(),e(this.element).css("overflow",""),this.element.find(".pivotGridRowTable, .pivotGridValueTable , .pivotGridFrozenTable").removeAttr("style")),this.model.frozenHeaderSettings.enableFrozenRowHeaders&&!this.model.frozenHeaderSettings.enableFrozenColumnHeaders?this.element.find(".pivotGridValueTable,.pivotGridFrozenTable").addClass("rowFrozenTable"):this.element.find(".pivotGridValueTable,.pivotGridFrozenTable").removeClass("rowFrozenTable"),this.element.find(".pivotGridFrozenTable colgroup, .pivotGridValueTable colgroup").remove();var a=e("<colgroup></colgroup>"),d=this.element.find(".pivotGridFrozenTable"),h=this.element.find(".pivotGridRowTable tr:visible").index(),c=this.element.find(".pivotGridValueTable tr:eq("+h+") td");for(l=0;l<c.length;l++)n=e(c[l]).attr("data-p").split(",")[0],s=d.find("[data-p^='"+n+",']"),s=t.isNullOrUndefined(s.last().attr("colSpan"))||"1"==s.last().attr("colSpan")?e(s).last():s[s.length-2],e(c[l]).is(":visible")&&a.append("<col style='width:"+Math.max(e(s).outerWidth(),e(c[l]).outerWidth())+"px'>");this.element.find(".pivotGridFrozenTable, .pivotGridValueTable").prepend(a),this.model.enableColumnGrandTotal||this.element.find(".pivotGridValueTable tr:visible:eq(0) td:visible").length==e(a).children().length||(o=parseInt(this.element.find(".pivotGridFrozenTable tr:first td:last").attr("colspan")),this.element.find(".pivotGridFrozenTable colgroup col").slice(-o).remove(),this.element.find(".pivotGridValueTable colgroup col").slice(-o).remove()),this._refreshScroller()}},_refreshScroller:function(){var i,r=t.isNullOrUndefined(this.model.frozenHeaderSettings.scrollerSize)?18:this.model.frozenHeaderSettings.scrollerSize,l=!t.isNullOrUndefined(this._pivotClientObj)&&e("#"+this._pivotClientObj._id+"_PivotGridToolbar").length>0,n=l?e("#"+this._pivotClientObj._id+"_PivotGridToolbar"):[];if(this.element.find(".values").width()>this.element.find(".pivotGridRowTable").width()&&this.element.find(".pivotGridRowTable").width(this.element.find(".values").width()),this.element.find(".pivotGridValueTable .value:visible").length>0){if(this.element.find(".pivotGridFrozenTable").height(this.element.find(".colfreeze").height()),!this.model.frozenHeaderSettings.enableFrozenRowHeaders&&this.model.frozenHeaderSettings.enableFrozenColumnHeaders){if(this._removeFrozenBorders(),this.element.find(".headerContent").width(this.element.width()),this.element.find(".colfreeze").css({width:this.element.find(".pivotGridRowTable").width(),float:this.model.enableRTL?"right":"left"}),this.element.find(".pivotGridFrozenTable").height()>this.element.find(".colfreeze").height()?this.element.find(".colfreeze").height(this.element.find(".pivotGridFrozenTable").height()):this.element.find(".pivotGridFrozenTable").height(this.element.find(".colfreeze").height()),this.element.find(".valueCell").css({display:"inline-block",width:this.element.width()-this.element.find(".pivotGridRowTable").width()}),this.element.find(".pivotGridValueTable, .pivotGridFrozenTable").css({width:"100%","table-layout":"fixed"}),this.element.find(".headerContent").css({position:"relative",overflow:"hidden"}),this.element.find(".colmovable").css({display:"inline",position:"relative",overflow:"hidden"}),this.element.find(".headerContent").height(this.element.find(".headerTable").height()),g=0,u=0,this.element.find(".pivotGridValueTable").height()>0){var s=this.model.enableGroupingBar?this.element.find(".groupingBarPivot").height():0,o=this.element.find(".headerContent").height(),a=o+this.element.find(".valueCell").height()+s,d=this.element.height(),h=this.element.find(".e-pivotGridTable").width(),c=this.element.find(".pivotGridValueTable").width()+this.element.find(".pivotGridRowTable").width();l&&(e(n).css("overflow","hidden"),d=e(n).height(),c=this.element.find(".pivotGridValueTable").width()+this.element.find(".pivotGridRowTable").width(),h=e(n).width()),g=(d>a?a:d)-o-s,u=h>c?c:h,l&&(this.element.find(".valueCell").width(e(n).width()-this.element.find(".pivotGridRowTable").width()-5),(u=this.element.find(n).width()-3)<0&&(u=200))}this.element.find("#rowvaluecontent").ejScroller({scroll:this._applyScroll,scrollerSize:r,width:u,height:g,targetControl:this,enableRTL:this.model.enableRTL}),this.model.enableRTL&&this.element.find(".rowhead").css({float:this.model.enableRTL?"right":"left"}),this.element.find(".e-vscrollbar").length>0&&(this.element.find(".valueCell").width(this.element.find(".valueCell").width()-r),this.element.find(".headerContent").width(this.element.find(".headerContent").width()-(l?28.5:18))),this.element.find(".headerTable").css({display:"inline-block",width:this.element.find(".valueCell").width()}),this.model.enableGroupingBar&&(this.element.find(" .groupingBarPivot").width("100%"),i=this.element.find(".pivotGridRowTable").width(),this.element.find(".e-grpRow ,.values").width(i),this.element.find(".rowhead").width()<this.element.find(".colfreeze").width()&&(this.element.find(".colfreeze").width(this.element.find(".rowhead").width()),this.element.find(".columns").width("auto")),this.element.find(".columns").css({height:"auto",width:"calc(100% -  "+this.element.find(".values").width()+")"}))}else if(this.model.frozenHeaderSettings.enableFrozenRowHeaders&&!this.model.frozenHeaderSettings.enableFrozenColumnHeaders){if(this._removeFrozenBorders(l),s=this.model.enableGroupingBar?this.element.find(".groupingBarPivot").height():0,this.element.find(".pivotGridValueTable, .pivotGridFrozenTable").css({width:"100%","table-layout":"fixed"}),this.element.find(".colfreeze").height(this.element.find(".pivotGridFrozenTable").height()),this.element.find(".colhead").css("overflow","visible"),g=0,u=0,this.element.find(".pivotGridValueTable").height()>0){a=this.element.height(),l&&(a=e(n).height()-5);d=this.element.find(".rowHeaderArea").height(),c=this.element.width()-this.element.find(".headerContent").width();u=(h=this.element.find(".pivotGridValueTable").width())>c?c:h,g=(d>a?a:d)-s,l&&u<0&&(u=200)}this.element.find(".pivotGridRowTable").css({width:"100%","table-layout":"fixed"}),this.element.find("#rowvaluecontent").ejScroller({scrollerSize:r,scroll:this._applyScroll,width:u,height:g,targetControl:this,enableRTL:this.model.enableRTL}),this.element.find(".headerContent").css({height:this.element.find("#rowvaluecontent").height(),overflow:"hidden","border-right":"0px"}),this.element.find(".rowhead").css("padding-bottom",this.element.find("#rowvaluecontent .e-hscrollbar").length>0?r:"0px"),this.model.enableGroupingBar&&(this.element.find(" .groupingBarPivot,.colfreeze").width("100%"),i=this.element.find(".pivotGridRowTable").width(),this.element.find(".e-grpRow ,.values").width(i),this.element.find(".columns").width(this.element.find(".valueColumn").width()-this.element.find(".values").width()-5),this.element.find(".columns").css("height","auto"))}else{this._removeFrozenBorders(),this.element.find(".rowhead").css({overflow:"hidden",width:this.element.find(".pivotGridRowTable").width()}),a=this.element.height()-(this.element.find(".colhead").outerHeight()+(this.model.enableGroupingBar?this.element.find(".groupingBarPivot").height():0)),l&&(a=e(n).outerHeight()-(this.element.find(".colhead").outerHeight()+(this.model.enableGroupingBar?this.element.find(".groupingBarPivot").height():0))),d=this.element.find(".pivotGridValueTable").height(),this.element.find(".rowhead").height(d>a?a:d),this.element.find(".colfreeze").width(this.element.find(".pivotGridRowTable").width()),this.element.find(".pivotGridFrozenTable, .pivotGridValueTable").css({width:"100%","table-layout":"fixed"});c=this.element.width()-this.element.find(".pivotGridRowTable").width()-3;var u=(h=this.element.find(".pivotGridValueTable").width())>c?c:h,g=this.element.find(".rowhead").height()+(h>c?r:0);l&&(this.element.find(".rowhead").height(this.element.find(".rowhead").height()-10),this.element.find(".rowhead, .colfreeze").width(this.element.find(".pivotGridRowTable").width()-5),g=this.element.find(".rowhead").height(),u<0&&(u=200)),this.element.find("#rowvaluecontent").ejScroller({scroll:this._applyScroll,width:u,height:g,targetControl:this,scrollerSize:r,enableRTL:this.model.enableRTL}),l&&this.element.find(".rowhead, .pivotGridRowTable").width("100%"),this.element.find(".colmovable").width(this.element.find(".valueCell").width()),this.element.find("#rowvaluecontent .e-hscrollbar").length>0?(this.element.find(".rowhead").css("margin-bottom",r),this.element.find(".rowhead").addClass("frozenBorderBtmClr")):(this.element.find(".rowhead").css("margin-bottom","0px"),this.element.find(".rowhead").removeClass("frozenBorderBtmClr")),this.element.find(".colhead , .colfreeze").height(this.element.find(".pivotGridFrozenTable").height()),this.element.find(".e-rows").height()>this.element.find(".colfreeze").height()&&this.element.find(".colmovable .colhead .pivotGridFrozenTable thead tr,.colfreeze").height(this.element.find(".e-rows").height()+15),this.element.find(".pivotGridFrozenTable").height("100%"),this.element.find(".rowhead").height(this.element.find(".valueCell").height()),0!=this.element.find(".e-scroller .e-hscroll").length||this.model.enableVirtualScrolling||this.element.find(".e-scroller").height("auto"),this.model.enableGroupingBar&&(i=this.element.find(".pivotGridRowTable").width(),this.element.find(".e-grpRow ,.values").width(i),this._refreshGroupingBarLayout())}this.element.find(".rowhead").scrollTop(0),this.element.find(".groupingBarPivot ").width(this.element.find(".e-pivotGridTable").width())}else e(this.element).css("overflow","auto"),this.element.find(".headerTable").css("display","inline-block"),this.element.find(".valScrollArea").css("height","100%")},_removeFrozenBorders:function(t){var r,l,n,s=this.model.enableRTL,o=this.element;if(t&&(r=t?e("#"+this._pivotClientObj._id+"_PivotGridToolbar"):[],e(r).css("overflow","hidden"),r.width()<this.element.find(".pivotGridRowTable").width()&&e(r).css("overflow","auto"),r.height()<this.element.find(".e-pivotGridTable").height()&&e(r).css("overflow","auto")),this.model.frozenHeaderSettings.enableFrozenHeaders&&!this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&!this.model.frozenHeaderSettings.enableFrozenRowHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&this.model.frozenHeaderSettings.enableFrozenRowHeaders){for(o.find(".colhead").css({"border-right":"1px solid rgb(200, 200, 200)"}),o.find(".pivotGridRowTable, .pivotGridRowTable tr td:first-child").css({"border-collapse":"collapse","border-spacing":"0"}),o.find(".pivotGridRowTable tr td:last-child").css({"border-collapse":"collapse","border-spacing":"0"}),o.find(".pivotGridValueTable, .pivotGridValueTable tr td:first-child").css({"border-collapse":"collapse","border-spacing":"0"}),o.find(".pivotGridFrozenTable,  .pivotGridFrozenTable tr:nth-child(1) td").css({"border-collapse":"collapse"," border-spacing":"0","border-top":"0px"}),o.find(".colfretable .e-grpRow").css({"border-top":"0px"}),o.find(".pivotGridValueTable tr:visible:eq(0) td, .pivotGridRowTable tr:visible:eq(0) td").css("border-top","0px"),s?(o.find(".pivotGridRowTable, .pivotGridRowTable tr td:first-child").css({"border-right":"0px"}),o.find(".pivotGridRowTable tr td:last-child").css({"border-left":"0px"}),o.find(".pivotGridValueTable, .pivotGridValueTable tr td:first-child").css({"border-right":"0px"}),o.find(".colfretable .e-grpRow").css({"border-right":"0px","border-left":"0px"})):(o.find(".pivotGridRowTable, .pivotGridRowTable tr td:first-child").css({"border-left":"0px"}),o.find(".pivotGridRowTable tr td:last-child").css({"border-right":"0px"}),o.find(".pivotGridValueTable, .pivotGridValueTable tr td:first-child").css({"border-left":"0px"}),o.find(".colfretable .e-grpRow").css({"border-left":"0px","border-right":"0px"})),l=o.find(".pivotGridValueTable tr").length,i=0;i<l;i++)s?(o.find(".pivotGridValueTable tr:eq("+i+") td:visible:eq(0)").css("border-right","0px"),o.find(".pivotGridValueTable tr:eq("+i+") td:visible:last").css("border-left","0px")):(o.find(".pivotGridValueTable tr:eq("+i+") td:visible:eq(0)").css("border-left","0px"),o.find(".pivotGridValueTable tr:eq("+i+") td:visible:last").css("border-right","0px"));for(o.find(".pivotGridFrozenTable td").css("border-bottom","0px"),n=this.element.find(".pivotGridFrozenTable tr").length,i=0;i<n;i++)s?(o.find(".pivotGridFrozenTable tr:eq("+i+") td:visible:eq(0)").css("border-right","0px"),o.find(".pivotGridFrozenTable tr:eq("+i+") td:visible:last").css("border-left","0px")):(o.find(".pivotGridFrozenTable tr:eq("+i+") td:visible:eq(0)").css("border-left","0px"),o.find(".pivotGridFrozenTable tr:eq("+i+") td:visible:last").css("border-right","0px"));o.find(".pivotGridRowTable tr:visible:last td").css("border-bottom","0"),o.find(".pivotGridValueTable tr:visible:last td").css("border-bottom","0")}else this.element.find(".pivotGridFrozenTable tr:first td").css("border-top","0px"),this.element.find(".pivotGridRowTable tr td:first-child").css(this.model.enableRTL?"border-right":"border-left","0px"),this.element.find(".pivotGridRowTable tr td:last-child").css(this.model.enableRTL?"border-left":"border-right","0px"),this.element.find(".pivotGridFrozenTable tr:last td").css("border-bottom","0px"),!this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&this.model.frozenHeaderSettings.enableFrozenRowHeaders?(this.element.find(".pivotGridFrozenTable tr td:first-child").css(this.model.enableRTL?"border-right":"border-left","0px"),this.element.find(".pivotGridValueTable tr:last td").css("border-bottom","0px"),this.element.find(".pivotGridValueTable tr td:visible:eq(0)").attr("p")&&this.element.find(".pivotGridValueTable tr td[p^='"+this.element.find(".pivotGridValueTable tr td:visible:eq(0)").attr("p").split(",")[0]+",']").css(this.model.enableRTL?"border-right":"border-left","0")):this.model.frozenHeaderSettings.enableFrozenColumnHeaders&&!this.model.frozenHeaderSettings.enableFrozenRowHeaders&&(this.element.find(".pivotGridRowTable  tr:eq(0) td").css("border-top","0px"),this.element.find(".pivotGridValueTable tr:eq(0) td").css("border-top","0px"))},_applyScroll:function(){this.model.targetControl.model.frozenHeaderSettings.enableFrozenRowHeaders&&this.model.targetControl.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.targetControl.model.frozenHeaderSettings.enableFrozenHeaders&&!this.model.targetControl.model.frozenHeaderSettings.enableFrozenRowHeaders&&!this.model.targetControl.model.frozenHeaderSettings.enableFrozenColumnHeaders?(this.isVScroll()&&this.model.targetControl.element.find(".rowhead").scrollTop(this.model.scrollTop),this.isHScroll()&&this.model.targetControl.element.find(".colhead").scrollLeft(this.model.scrollLeft)):!this.model.targetControl.model.frozenHeaderSettings.enableFrozenRowHeaders&&this.model.targetControl.model.frozenHeaderSettings.enableFrozenColumnHeaders?this.isHScroll()&&this.model.targetControl.element.find(".colhead").scrollLeft(this.model.scrollLeft):this.isVScroll()&&this.model.targetControl.element.find(".headerContent").scrollTop(this.model.scrollTop)},_setGroupingBarFrozenRowBtnWidth:function(){var t,i;(this.model.frozenHeaderSettings.enableFrozenRowHeaders&&this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenHeaders&&(!this.model.frozenHeaderSettings.enableFrozenRowHeaders||!this.model.frozenHeaderSettings.enableFrozenColumnHeaders))&&this.element.find(".pivotGridRowTable").outerWidth()>=this.element.find(".e-grpRow").outerWidth()&&this.element.find(".pivotGridRowTable").css("min-width",this.element.find(".e-grpRow").outerWidth()),this.element.find(".e-grpRow .e-removeBtn, .e-grpRow .filter, .e-grpRow .e-sorting ").css("position","inherit"),this.element.find(".colfreeze .e-pivotButton").width("auto");var r=this.element.find(".pivotGridRowTable").width(),l=this.element.find(".colfreeze .e-pivotButton"),n=r/l.length;if(r<n&&(n=r-40),this.element.find(".e-rows").width()>r){l.length;var s=0,o=0;e.each(this.element.find(".e-rows .e-pivotButton"),function(t,i){s+=e(i).width()}),e.each(this.element.find(".e-rows .e-pivotButton .e-pvtBtn"),function(t,i){o+=e(i).width()}),n-(t=(s-o)/l.length)<40&&(n=t+40)*l.length,this.element.find(".e-rows .e-pivotButton").width(n-20),this.element.find(".e-rows .e-pvtBtn").css({width:n-10-t,"text-overflow":"ellipsis"}),this.element.find(".e-rows").css({"white-space":"nowrap"}),i=this.element.find(".colfreeze .e-pivotButton:eq(0)").outerWidth()*l.length+30,this.element.find(".pivotGridRowTable,.rowhead,.colfreeze table,.valueColumn span.values").width(i)}},_refreshGroupingBarLayout:function(){this.element.find(".e-pivotGridTable .value").length>0||this.element.find(".e-pivotGridTable .colheader").length>0?this.element.find(".groupingBarPivot ").width(this.element.find(".e-pivotGridTable").width()):this.element.find(".pivotGridRowTable").length>0?this.element.find(".groupingBarPivot ").width(this.element.find(".pivotGridRowTable").width()+140):this.element.find(".groupingBarPivot ").width(330);var e=this.element.find(".pivotGridRowTable").width();this.element.find(".e-grpRow ,.values").width(e),this.element.find(".columns").css({height:"auto",width:this.element.find(".valueColumn").width()-this.element.find(".values").width()-1}),this._setGroupingBarFrozenRowBtnWidth()},_cellRangeInfo:function(i){var r,l,n,s,o,a,d=e(i.target).parents(".e-pivotgrid").data("ejPivotGrid"),h=e(this.element).parents(".e-pivotclient").length>0||e(this.element).parents(".e-maximumView").length>0;h&&this._pivotClientObj.model.enableDrillThrough&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&(this._dataSet=this._pivotClientObj.dataSet),e(i.target).hasClass("cellValue")&&(i.target=i.target.parentElement);e("thead tr").length;var c=[],u=0,g=e.grep(this.getJSONRecords(),function(t){return(t.CSS.indexOf("colheader")>-1||t.CSS.indexOf("summary cstot")>-1||t.CSS.indexOf(" calc")>-1)&&-1==t.CSS.indexOf("colheader calc")&&t.Index.split(",")[0]==e(i.target).attr("data-p").split(",")[0]}),p=e.grep(this.getJSONRecords(),function(t){return(t.CSS.indexOf("rowheader")>-1||t.CSS.indexOf("summary rstot")>-1)&&t.Index.split(",")[1]==e(i.target).attr("data-p").split(",")[1]});if(1==p.length&&1==g.length&&(p[0].Value.toString().indexOf(this._getLocalizedLabels("GrandTotal"))>=0||g[0].Value.toString().indexOf(this._getLocalizedLabels("GrandTotal"))>=0||g[0].CSS.indexOf(" calc")>-1))if([],(g[0].Value.toString().indexOf(this._getLocalizedLabels("GrandTotal"))>=0||g[0].CSS.indexOf(" calc")>-1)&&p[0].Value.toString().indexOf("Grand")>=0)for(o=0;o<this.model.dataSource.data.length;o++)c[o]=this.model.dataSource.data[o];else for(p[0].Value.toString().indexOf(this._getLocalizedLabels("GrandTotal"))>=0?r=g[0].Value.toString().indexOf(this._getLocalizedLabels("Total"))>=0?g[0].Value.replace(" "+this._getLocalizedLabels("Total"),""):g[0].Value:(g[0].Value.toString().indexOf(this._getLocalizedLabels("Total"))>=0||g[0].CSS.indexOf(" calc")>-1)&&(r=p[0].Value.toString().indexOf(this._getLocalizedLabels("Total"))>=0?p[0].Value.replace(" "+this._getLocalizedLabels("Total"),""):p[0].Value),o=0;o<d.model.dataSource.data.length;o++)e.each(d.model.dataSource.data[o],function(e,t){t==r&&(c[u]=d.model.dataSource.data[o],u++)});else if(p.length>=1&&g.length>=1&&(p[0].Value.toString().indexOf(this._getLocalizedLabels("Total"))>=0||g[0].Value.toString().indexOf(this._getLocalizedLabels("Total"))>=0)){for(p[0].Value.toString().indexOf(this._getLocalizedLabels("Total"))>=0?(r=g,l=p):g[0].Value.toString().indexOf(this._getLocalizedLabels("Total"))>=0&&(r=p,l=g),f=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this.model.dataSource.data:this._dataSet.length>0?JSON.parse(this._dataSet):[],n=r.length-1;n>=0;n--){for(s=[],o=0;o<f.length;o++)e.each(f[o],function(e,t){t==r[n].Value&&s.push(f[o])});f=s}if(c=s,l[0].Value.toString().indexOf("Grand")<=0)for(s=[],o=0;o<f.length;o++)e.each(f[o],function(e,t){t==l[0].Value.replace(" Total","")&&(c=[],s.push(f[o]))});c=0==c.length?s:c}else{var m=p,_=g,f=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this.model.dataSource.data:this._dataSet.length>0?JSON.parse(this._dataSet):[];for(n=m.length-1;n>=0;n--){for(s=[],o=0;o<f.length;o++)e.each(f[o],function(e,t){(t==m[n].Key||t==m[n].Value)&&s.push(f[o])});f=s}for(n=_.length-1;n>=0;n--)if(-1==_[n].CSS.indexOf("calc")){for(s=[],o=0;o<f.length;o++)e.each(f[o],function(e,t){(t==_[n].Key||t==_[n].Value)&&s.push(f[o])});f=s}c=0==c.length?s:c}a={selectedData:c||[],element:this.element,customObject:this.model.customObject},this.model.enableCellDoubleClick&&null!=this.model.enableCellDoubleClick&&"dblclick"==i.type&&(t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellDoubleClick",a):this._pivotClientObj._trigger("cellDoubleClick",a)),this.model.enableCellClick&&null!=this.model.enableCellClick&&"click"==i.type&&(t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellClick",a):this._pivotClientObj._trigger("cellClick",a)),(this.model.enableDrillThrough||h&&this._pivotClientObj.model.enableDrillThrough)&&c.length>0&&(h&&this._pivotClientObj.model.enableDrillThrough?this._pivotClientObj:this)._trigger("drillThrough",a)},_initCellEditing:function(i){var r;"INPUT"==i.target.tagName||e(i.target).hasClass("summary")||e(i.target).parent().hasClass("summary")?this._off(this.element,"mouseup",".value",this._completeCellEditing):(this._on(this.element,"mouseup",".value",this._completeCellEditing),this._oriX=i.pageX,this._oriY=i.pageY,r=i.target||window.event.srcElement,e(r).hasClass("cellValue")&&(r=e(r).parent()[0]),e(".value").addClass("selection"),e("#"+this._id).append(t.buildTag("div.e-cellSelection#"+this._id+"_cellSelection","",{})),this._startCellPosition=e(r)[0].attributes.getNamedItem("data-p").value,this._on(this.element,"mousemove",".value, .e-cellSelection",this._cellSelection))},_completeCellEditing:function(i){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S=[];if("INPUT"!=i.target.tagName){if(this._off(this.element,"mousemove",".value"),e(".value").removeClass("selection"),l=i.target||window.event.srcElement,e(l).hasClass("cellValue")&&(l=e(l).parent()[0]),n=e(l)[0].attributes.getNamedItem("data-p").value,a=0,this.element.find(".curInput").length>0)return 0==e(l).find(".curInput").length&&this._updateTableCell(),e("#"+this._id+"_cellSelection").remove(),this.model.enableToolTip&&this._on(this.element,"mousemove",".value",this._applyToolTip),this._off(this.element,"mouseup",".value"),!1;for(d=parseInt(this._startCellPosition.split(",")[1])<parseInt(n.split(",")[1])?parseInt(this._startCellPosition.split(",")[1]):parseInt(n.split(",")[1]);d<=(parseInt(this._startCellPosition.split(",")[1])>parseInt(n.split(",")[1])?parseInt(this._startCellPosition.split(",")[1]):parseInt(n.split(",")[1]));d++)if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap||e("#"+this._id).find("td[data-p*=',"+d+"']").parent().is(":visible"))for(h=parseInt(this._startCellPosition.split(",")[0])<parseInt(n.split(",")[0])?parseInt(this._startCellPosition.split(",")[0]):parseInt(n.split(",")[0]);h<=(parseInt(this._startCellPosition.split(",")[0])>parseInt(n.split(",")[0])?parseInt(this._startCellPosition.split(",")[0]):parseInt(n.split(",")[0]));h++)if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap||e("#"+this._id).find("[data-p*='"+h+",']").last("th").is(":Visible")||!this.model.enableGrandTotal||!this.model.enableRowGrandTotal){S[a]=this.getJSONRecords()[h*this._rowCount+d],this.element.find("[data-p='"+h+","+d+"']").hasClass("summary")||(this.element.find("[data-p='"+h+","+d+"'] span.cellValue").length>0?(c=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?""!=this.element.find("[data-p='"+h+","+d+"'] span.cellValue").text()?this.element.find("[data-p='"+h+","+d+"'] span.cellValue").text():this.element.find(".curInput").val():this.element.find("[data-p='"+h+","+d+"'] span.cellValue").text(),this.element.find("[data-p='"+h+","+d+"'] span.cellValue").html("<input type='text' class='curInput' value='"+c+"' />")):this.element.find("[data-p='"+h+","+d+"']").children().length>0?this.element.find("[data-p='"+h+","+d+"']").append("<input type='text' class='curInput' value='' />"):(c=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?""!=this.element.find("[data-p='"+h+","+d+"']").text()?this.element.find("[data-p='"+h+","+d+"']").text():this.element.find(".curInput").val():this.element.find("[data-p='"+h+","+d+"']").text(),this.element.find("[data-p='"+h+","+d+"']").html("<input type='text' class='curInput' value='"+c+"' />")));var x,v="",w=0;if((s=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders?this.element.find(".summary[role!='gridcell'][data-p$=',"+e(l).attr("data-p").split(",")[1]+"'] , .rowheader[role!='gridcell'][data-p$=',"+e(l).attr("data-p").split(",")[1]+"']").last().attr("data-p"):this.element.find(".summary[role!='gridcell'][data-p$=',"+d+"'] , .rowheader[role!='gridcell'][data-p$=',"+d+"']").last().attr("data-p"))==r&&(s=e("#"+this._id).find("tbody").find('[data-p="'+h+","+d+'"]').parent("tr").find(".summary").first().attr("data-p")),s,null!=s){for(;s[0]>=0;)s==this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))].Index&&(x=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))].Info.split("::")[0]:this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))].Value,s=parseInt(s.split(",")[0])-1+","+parseInt(s.split(",")[1])),v&&""!=x?v=x+"#"+v:""!=x&&(v=x);if(this._rowHeader[a]=v,(p=this._rowHeader[a].toString().split("#")).length>1){for(_=0;_<p.length-1;_++)for(m=0;m<p[_].split(".").length;m++)if(p[_].split(".")[m]==p[_+1].split(".")[m]&&p[_].split(".")[m+1]==p[_+1].split(".")[m+1]){p.splice(_,1);break}for(this._rowHeader[a]="",_=0;_<p.length;_++)this._rowHeader[a]+=""==this._rowHeader[a]?p[_]:"#"+p[_]}}var I,y="",T=this.model.frozenHeaderSettings.enableFrozenHeaders||this.model.frozenHeaderSettings.enableFrozenColumnHeaders||this.model.frozenHeaderSettings.enableFrozenRowHeaders,L=this.element.find((T?".pivotGridFrozenTable ":"")+'tr:has(".colheader")').length-1;for(L,(o=S[a].Index)!=r&&o==this.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*this._rowCount+parseInt(o.split(",")[1]))].Index&&(u=parseInt(o.split(",")[0])),g=0;g<=L;g++)null!=u&&u+","+g==this.getJSONRecords()[parseInt(parseInt(u)*this._rowCount+g)].Index&&(I=this.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.getJSONRecords()[parseInt(parseInt(u)*this._rowCount+g)].Info.split("::")[0]:this.getJSONRecords()[parseInt(parseInt(u)*this._rowCount+g)].Value,""==y?y=I:""!=I&&(y=y+"#"+I)),this._colHeader[a]=y;if((p=this._colHeader[a].split("#")).length>1){for(_=0;_<p.length-1;_++)for(m=0;m<p[_].split(".").length;m++)if(p[_].split(".")[m]==p[_+1].split(".")[m]&&p[_].split(".")[m+1]==p[_+1].split(".")[m+1]){p.splice(_,1);break}for(this._colHeader[a]="",_=0;_<p.length;_++)this._colHeader[a]+=""==this._colHeader[a]?p[_]:"#"+p[_]}a++}for(this._originalValue="",this._cellInfo=S,f=0;f<this.element.find(".curInput").length;f++)b=this.element.find(".curInput")[f],this._originalValue+=""==this._originalValue?b.value:"#"+b.value;C={JSONRecords:S,rowHeader:this._rowHeader,columnHeader:this._colHeader,measureCount:w>0?"Row:"+w:"Column:0"},t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellSelection",C):this._pivotClientObj._trigger("cellSelection",C),S=[],e("#"+this._id+"_cellSelection").remove(),this.model.enableToolTip&&this._on(this.element,"mousemove",".value",this._applyToolTip),this._off(this.element,"mouseup",".value")}this.element.find(".curInput").keypress(function(i){if(13==i.which){var r=e(i.target).parents(".e-pivotgrid").data("ejPivotGrid");t.isNullOrUndefined(r)||r._updateTableCell()}})},_updateTableCell:function(){var i,r,l,n,s,o,a,d="",h="",c=this.element.find(".curInput");e.each(c,function(e,t){d+=0==e?t.value:"#"+t.value});var u=[],g=this._rowHeader,p=this._colHeader;for(i=(h=d.split("#")).length-1;i>=0;i--)h[i]==this._originalValue.split("#")[i]?(g.splice(i,1),p.splice(i,1),h.splice(i,1),this._cellInfo.splice(i,1)):(u.push(this._originalValue.split("#")[i]),t.isNullOrUndefined(this._cellInfo[i])||(this._cellInfo[i].Value=h[i]=""==h[i]?"":h[i]));for(u=u.reverse(),d="",a=0;a<h.length;a++)d+=""==d?h[a]:"#"+h[a];if(0==d.length){for(a=c.length-1;a>=0;a--)e(c[a]).closest("td").text(this.element.find(".curInput")[a].value);return!1}if(this._waitingPopup.show(),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)try{r=JSON.parse(this.getOlapReport()).Report}catch(e){r=this.getOlapReport()}if(this.model.analysisMode==t.Pivot.AnalysisMode.Pivot){(t.isNullOrUndefined(this.model.editCellsInfo.JSONRecords)||0==this.model.editCellsInfo.JSONRecords.length)&&(this.model.editCellsInfo={JSONRecords:[],rowHeader:[],columnHeader:[]});var m=this.model.editCellsInfo.rowHeader,_=this.model.editCellsInfo.columnHeader,f=this.model.editCellsInfo.JSONRecords,b=this._cellInfo;for(l=0;l<b.length;l++){for(n=0,s=0;s<f.length;s++)if(m[s]==g[l]&&_[s]==p[l]){f[s].Value=b[l].Value,n++;break}0==n&&(m.push(g[l]),_.push(p[l]),f.push(b[l]))}if(t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellEdit",{editCellsInfo:this.model.editCellsInfo}):this._pivotClientObj._trigger("cellEdit",{editCellsInfo:this.model.editCellsInfo}),!t.isNullOrUndefined(this.model.editCellsInfo.JSONRecords)&&this.model.editCellsInfo.JSONRecords.length>0)if(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){d="";var C="",S="";for(e.each(this.model.editCellsInfo.JSONRecords,function(e,t){d=""==d?t.Value:d+":"+t.Value,C=""==C?t.Index:C+":"+t.Index,S=""==S?_[e].toString().split("#")[_[e].toString().split("#").length-1]:S+":"+_[e].toString().split("#")[_[e].toString().split("#").length-1]}),o=JSON.stringify({action:"cellEditing",index:C,valueHeaders:S,summaryValues:d,currentReport:r,valueSorting:JSON.stringify(this.model.valueSortSettings),customObject:JSON.stringify(this.model.customObject)}),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.cellEditing,o,this._renderControlSuccess),a=c.length-1;a>=0;a--)e(c[a]).closest("td").text(e(c[a]).val())}else this._populatePivotGrid();else{for(a=c.length-1;a>=0;a--)e(c[a]).closest("td").text(t.isNullOrUndefined(this._originalValue.split("#")[a])?"":this._originalValue.split("#")[a]);this._waitingPopup.hide()}}else if(this.model.analysisMode==t.Pivot.AnalysisMode.Olap)if(null!=this.model.beforeServiceInvoke&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"writeBack",element:this.element}),this.model.editCellsInfo.JSONRecords=this._cellInfo,this.model.editCellsInfo.rowHeader=g,this.model.editCellsInfo.columnHeader=p,t.isNullOrUndefined(this._pivotClientObj)?this._trigger("cellEdit",{editCellsInfo:this.model.editCellsInfo}):this._pivotClientObj._trigger("cellEdit",{editCellsInfo:this.model.editCellsInfo}),d="",!t.isNullOrUndefined(this.model.editCellsInfo.JSONRecords)&&this.model.editCellsInfo.JSONRecords.length>0&&e.each(this.model.editCellsInfo.JSONRecords,function(e,t){d=""==d?t.Value:d+":"+t.Value}),o=JSON.stringify({action:"writeBack",value:d,rowUniqueName:JSON.stringify(this.model.editCellsInfo.rowHeader),columnUniqueName:JSON.stringify(this.model.editCellsInfo.columnHeader),currentReport:r,customObject:JSON.stringify(this.model.customObject)}),!t.isNullOrUndefined(this.model.editCellsInfo.JSONRecords)&&this.model.editCellsInfo.JSONRecords.length>0)this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.writeBack,o,this._renderControlSuccess);else{for(a=c.length-1;a>=0;a--)e(c[a]).closest("td").text(t.isNullOrUndefined(this._originalValue.split("#")[a])?"":this._originalValue.split("#")[a]);this._waitingPopup.hide()}this._rowHeader=[],this._colHeader=[]},_createVirtualPivotGrid:function(e){var i,r,l=this._seriesPageCount>1?t.buildTag("div.e-vScrollPanel")[0].outerHTML:"",n=this._categPageCount>1?t.buildTag("div.e-hScrollPanel")[0].outerHTML:"",s=t.buildTag("td.virtualScrollGrid",e[0].outerHTML)[0],o=t.buildTag("td.virtualScrollElement",l),a=t.buildTag("td.virtualScrollElement",n),d=t.buildTag("tr.virtualScrollElement",s.outerHTML+o[0].outerHTML),h=t.buildTag("tr.virtualScrollElement",a[0].outerHTML+t.buildTag("td.virtualScrollElement")[0].outerHTML),c=t.buildTag("tbody.oGridOuterDiv.virtualScrollElement",d[0].outerHTML+h[0].outerHTML);this.element.html(t.buildTag("table.virtualScrollElement",c[0].outerHTML)),i=t.buildTag("div.e-seriesPageIndicator inActive",t.buildTag("span.axislabel",this._getLocalizedLabels("SeriesPage"))[0].outerHTML+t.buildTag("span.series_CurrentPage",this._seriesCurrentPage)[0].outerHTML+" / "+t.buildTag("span.series_pageCount",this._seriesPageCount)[0].outerHTML)[0].outerHTML,this._seriesPageCount>1&&this.element.append(i),r=t.buildTag("div.e-categPageIndicator inActive",t.buildTag("span.axislabel",this._getLocalizedLabels("CategoricalPage"))[0].outerHTML+t.buildTag("span.categ_CurrentPage",this._categCurrentPage)[0].outerHTML+" / "+t.buildTag("span.categ_pageCount",this._categPageCount)[0].outerHTML)[0].outerHTML,this._categPageCount>1&&this.element.append(r)}}),t.PivotGrid.Layout={Normal:"normal",NormalTopSummary:"normaltopsummary",NoSummaries:"nosummaries",ExcelLikeLayout:"excellikelayout"},t.PivotGrid.Locale=t.PivotGrid.Locale||{},t.PivotGrid.Locale["en-US"]={Sort:"Sort",Search:"Search",SelectField:"Select field",LabelFilterLabel:"Show the items for which the label",ValueFilterLabel:"Show the items for which",ClearSorting:"Clear Sorting",ClearFilterFrom:"Clear Filter From",SortAtoZ:"Sort A to Z",SortZtoA:"Sort Z to A",and:"and",LabelFilters:"Label Filters  ",BeginsWith:"Begins With",DoesNotBeginsWith:"Does Not Begin With",EndsWith:"Ends With",NotEndsWith:"Not Ends With",DoesNotEndsWith:"Does Not End With",Contains:"Contains",DoesNotContains:"Does Not Contain",ValueFilters:"Value Filters",ClearFilter:"Clear Filter",Equals:"Equals",DoesNotEquals:"Does Not Equal",NotEquals:"Not Equals",GreaterThan:"Greater Than",IsGreaterThan:"Is Greater Than",IsGreaterThanOrEqualTo:"Is Greater Than Or Equal To",IsLessThan:"Is Less Than",IsLessThanOrEqualTo:"Is Less Than Or Equal To",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between",Top10:"Top Count",AddToFilter:"Add to Filter",AddToRow:"Add to Row",AddToColumn:"Add to Column",AddToValues:"Add to Values",Warning:"Warning",Error:"Error",GroupingBarAlertMsg:"The field you are moving cannot be placed in that area of the report",Measures:"Measures",Expand:"Expand",Collapse:"Collapse",ToolTipRow:"Row",ToolTipColumn:"Column",ToolTipValue:"Value",NoValue:"No value",SeriesPage:"Series Page",CategoricalPage:"Categorical Page",DragFieldHere:"Drag field here",ColumnArea:"Drop column here",RowArea:"Drop row here",ValueArea:"Drop values here",Close:"Close",OK:"OK",Cancel:"Cancel",Remove:"Remove",Goal:"Goal",Status:"Status",Trend:"Trend",Value:"Value",ConditionalFormattingErrorMsg:"The given value is not matched",ConditionalFormattingConformMsg:"Are you sure you want to remove the selected format?",EnterOperand1:"Enter Operand1",EnterOperand2:"Enter Operand2",ConditionalFormatting:"Conditional Formatting",Condition:"Conditional Type",Value1:"Value1",Value2:"Value2",Editcondtion:"Edit Condition",AddNew:"Add New",Format:"Format",Fontcolor:"Font Color",Backcolor:"Back Color",Borderrange:"Border Range",Borderstyle:"Border Style",Fontsize:"Font Size",Fontstyle:"Font Style",Bordercolor:"Border Color",NoMeasure:"Please add any measure",Solid:"Solid",Dashed:"Dashed",Dotted:"Dotted",Double:"Double",Groove:"Groove",Inset:"Inset",Outset:"Outset",Ridge:"Ridge",None:"None",Algerian:"Algerian",Arial:"Arial",BodoniMT:"Bodoni MT",BritannicBold:"Britannic Bold",Cambria:"Cambria",Calibri:"Calibri",CourierNew:"Courier New",DejaVuSans:"DejaVu Sans",Forte:"Forte",Gerogia:"Gerogia",Impact:"Impact",SegoeUI:"Segoe UI",Tahoma:"Tahoma",TimesNewRoman:"Times New Roman",Verdana:"Verdana",CubeDimensionBrowser:"Cube Dimension Browser",SelectHierarchy:"Select Hierarchy",CalculatedField:"Calculated Field",Name:"Name:",Add:"Add",Formula:"Formula:",Delete:"Delete",Fields:"Fields:",MultipleItems:"Multiple items",All:"All",CalculatedFieldNameNotFound:"Given CalculatedField name is not found",InsertField:"Insert Field",EmptyField:"Please enter Calculated field name or formula",NotValid:"Given formula is not valid",NotPresent:"Value field used in any of the Calculated Field formula is not present in the PivotGrid",Confirm:"Calculated field with the same name already exists. Do you want to Replace ?",CalcValue:"Calculated field can be inserted only in value area field",NoRecordsToDisplay:"No records to display.",NumberFormatting:"Number Formatting",FrozenHeaders:"Frozen Headers",CellSelection:"Cell Selection",CellContext:"Cell Context",ColumnResize:"Column Resize",Layouts:"Layouts",ExcelLikeLayout:"Excel Like Layout",NormalLayout:"Normal Layout",NormalTopSummary:"NormalTopSummary Layout",NoSummaries:"NoSummaries Layout",FrozenHeader:"Frozen Header",AdvancedFiltering:"Advanced Filtering",Amount:"Amount",Quantity:"Quantity",Measures:"Measures",NumberFormats:"Number Formats",Exporting:"Exporting",FileName:"File Name",ToolTip:"Tool Tip",RTL:"RTL",CollapseByDefault:"Collapse By Default",EnableDisablePaging:"Enable / Disable Paging",PagingOptions:"Paging Options",CategoricalPageSize:"Categorical Page Size",SeriesPageSize:"Series Page Size",HyperLink:"HyperLink",CellEditing:"Cell Editing",GroupingBar:"Grouping Bar",SummaryCustomization:"Summary Customization",SummaryTypes:"Summary Types",SummaryType:"Summary Type",EnableRowHeaderHyperlink:"Enable RowHeaderHyperLink",EnableColumnHeaderHyperlink:"Enable ColumnHeaderHyperLink",EnableValueCellHyperlink:"Enable ValueCellHyperLink",EnableSummaryCellHyperlink:"Enable SummaryCellHyperLink",HideGrandTotal:"Hide GrandTotal",HideSubTotal:"Hide SubTotal",Row:"Row",Column:"Column",Both:"Both",Sum:"Sum",Average:"Average",Count:"Count",Min:"Min",Max:"Max",Excel:"Excel",Word:"Word",PDF:"PDF",CSV:"CSV",Total:"Total",GrandTotal:"Grand Total",DrillThrough:"Drill Through",EnabledState:"Enabled State",Months:"Months",Days:"Days",Quarters:"Quarters",Years:"Years",Qtr:"Qtr",Quarter:"Quarter",AddCurrentSelectionToFilter:"Add current selection to filter",FormatName:"Format Name",RemoveFormat:"Remove Format",Edit:"Edit",DuplicateFormatName:"Duplicate Format Name",EnterFormatName:"Enter Format Name",NotAllItemsShowing:"Not all child nodes are shown",EditorLinkPanelAlert:"The members have more than 1000 items under one or more parent. Only the first 1000 items are displayed under each parent.",Exception:"Exception"},t.PivotGrid.ExportOptions={Excel:"excel",Word:"word",PDF:"pdf",CSV:"csv"},t.PivotGrid.ConditionalOptions={Equals:"Equals",NotEquals:"Not Equals",GreaterThan:"Greater Than",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between"},t.PivotGrid.AnalysisMode={Olap:"olap",Relational:"relational"},t.PivotGrid.ExportMode={JSON:"json",PivotEngine:"pivotengine"},t.PivotGrid.OperationalMode={ClientMode:"clientmode",ServerMode:"servermode"},t.olap.base&&e.extend(t.PivotGrid.prototype,t.olap.base),t.olap._mdxParser&&e.extend(t.PivotGrid.prototype,t.olap._mdxParser)}(jQuery,Syncfusion)})},1031:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getDefaultData=function(){return[{"Item Name":"Casual Shoes",Date:"02/14/2014",Time:"11:34:32 AM",Quantity:10,Price:"20",Amount:"200",Discount:"1",Profit:"10"},{"Item Name":"Sports Shoes",Date:"06/11/2014",Time:"05:56:32 AM",Quantity:20,Price:"30",Amount:"600",Discount:"5",Profit:"50"},{"Item Name":"Formal Shoes",Date:"07/27/2014",Time:"03:32:44 AM",Quantity:20,Price:"15",Amount:"300",Discount:"7",Profit:"27"},{"Item Name":"Sandals & Floaters",Date:"11/21/2014",Time:"06:23:54 AM",Quantity:15,Price:"20",Amount:"300",Discount:"11",Profit:"67"},{"Item Name":"Flip- Flops & Slippers",Date:"06/23/2014",Time:"12:43:59 AM",Quantity:30,Price:"10",Amount:"300",Discount:"10",Profit:"70"},{"Item Name":"Sneakers",Date:"07/22/2014",Time:"10:55:53 AM",Quantity:40,Price:"20",Amount:"800",Discount:"13",Profit:"66"},{"Item Name":"Running Shoes",Date:"02/04/2014",Time:"03:44:34 AM",Quantity:20,Price:"10",Amount:"200",Discount:"3",Profit:"14"},{"Item Name":"Loafers",Date:"11/30/2014",Time:"03:12:52 AM",Quantity:31,Price:"10",Amount:"310",Discount:"6",Profit:"29"},{"Item Name":"Cricket Shoes",Date:"07/09/2014",Time:"11:32:14 AM",Quantity:41,Price:"30",Amount:"1210",Discount:"12",Profit:"166"},{"Item Name":"T-Shirts",Date:"10/31/2014",Time:"12:01:44 AM",Quantity:50,Price:"10",Amount:"500",Discount:"9",Profit:"55"}]},e.prototype.getconditionalFormat=function(){return[{"Item Name":"Text contains with Loafers",Date:"Loafers",Quantity:"",Price:"Date occur with 02/04/2014",Amount:"05/03/2013",Discount:"",Netamount:"Less than 30",Value:"5"},{"Item Name":"",Date:"Casual Shoes",Quantity:"",Price:"",Amount:"06/23/2014",Discount:"",Netamount:"",Value:"56"},{"Item Name":"",Date:"Loafers",Quantity:"",Price:"",Amount:"07/22/2014",Discount:"",Netamount:"",Value:"24"},{"Item Name":"",Date:"Formal Shoes",Quantity:"",Price:"",Amount:"02/04/2014",Discount:"",Netamount:"",Value:"12"},{"Item Name":"",Date:"Sandals & Floaters",Quantity:"",Price:"",Amount:"11/30/2014",Discount:"",Netamount:"",Value:"36"},{"Item Name":"",Date:"",Quantity:"",Price:"",Amount:"",Discount:"",Netamount:"",Value:"",Value1:"",Tax:"",Tax1:""},{"Item Name":"Between 400 to 500",Date:"273",Quantity:"",Price:"Greater than 5000",Amount:"5003",Discount:"",Netamount:"Equal to 20",Value:"21"},{"Item Name":"",Date:"345",Quantity:"",Price:"",Amount:"3434",Discount:"",Netamount:"",Value:"34",Value1:""},{"Item Name":"",Date:"494",Quantity:"",Price:"",Amount:"7553",Discount:"",Netamount:"",Value:"20",Value1:""},{"Item Name":"",Date:"506",Quantity:"",Price:"",Amount:"2364",Discount:"",Netamount:"",Value:"20",Value1:""},{"Item Name":"",Date:"453",Quantity:"",Price:"",Amount:"6788",Discount:"",Netamount:"",Value:"23",Value1:""}]},e}();t.SpreadsheetService=r},1035:function(e,t){e.exports="ej-spreadsheet {\r\n    display: block;\r\n}\r\n"},1041:function(e,t,i){var r,l,n;
/*!
*  filename: ej.ribbon.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.ribbon.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(s){l=[i(4),i(15),i(92),i(47),i(155),i(122),i(48),i(16),i(31),i(221),i(66)],void 0===(n="function"==typeof(r=s)?r.apply(t,l):r)||(e.exports=n)}(function(){!function(e,t,i){t.widget("ejRibbon","ej.Ribbon",{element:null,validTags:["div"],model:null,_rootCSS:"e-ribbon",_requiresID:!0,defaults:{width:null,cssClass:"",buttonDefaults:{width:null,height:null,enableRTL:!1,showRoundedCorner:!1,enabled:!0,cssClass:null},expandPinSettings:{toolTip:null,customToolTip:{title:null,content:null,prefixIcon:null}},collapsePinSettings:{toolTip:null,customToolTip:{title:null,content:null,prefixIcon:null}},applicationTab:{type:"menu",backstageSettings:{text:null,height:null,width:null,headerWidth:null,pages:[{id:null,text:null,itemType:"tab",contentID:null,enableSeparator:!1}]},menuItemID:null,menuSettings:{}},tabs:[{id:null,text:null,groups:[{id:null,text:null,type:null,contentID:null,customContent:null,alignType:"rows",enableGroupExpander:!1,groupExpanderSettings:{toolTip:null,customToolTip:{title:null,content:null,prefixIcon:null}},content:[{groups:[{id:null,text:null,toolTip:null,quickAccessMode:"none",isMobileOnly:"false",customToolTip:{title:null,content:null,prefixIcon:null},columns:null,itemHeight:null,itemWidth:null,expandedColumns:null,type:"button",galleryItems:[{text:null,toolTip:null,customToolTip:{},buttonSettings:{}}],customGalleryItems:[{text:null,toolTip:null,customToolTip:{},customItemType:"button",buttonSettings:{},menuId:"",menuSettings:{}}],contentID:null,enableSeparator:!1,isBig:!1,cssClass:null,buttonSettings:{},splitButtonSettings:{},toggleButtonSettings:{},dropdownSettings:{}}],defaults:{}}]}]}],contextualTabs:[{backgroundColor:null,borderColor:null,tabs:[]}],tabSelect:null,tabClick:null,tabAdd:null,tabRemove:null,load:null,beforeTabRemove:null,tabCreate:null,create:null,groupClick:null,beforeTabClick:null,galleryItemClick:null,backstageItemClick:null,collapse:null,expand:null,pinState:null,toggleButtonClick:null,groupExpand:null,qatMenuItemClick:null,selectedItemIndex:1,enabledItemIndex:[],disabledItemIndex:[0],allowResizing:!1,isResponsive:!1,showQAT:!1,showBelowQAT:!1,enableOnDemand:!1,collapsible:!1,locale:"en-US",enableRTL:!1,destory:null,_destroyed:null},dataTypes:{tabs:"array",contextualTabs:"array",disabledItemIndex:"data",enabledItemIndex:"data",selectedItemIndex:"number",applicationTab:{backstageSettings:{pages:"array"}}},_destroy:function(){var t,i,r,l,n,s,o,a;for((l=this._applicationTab.find(".e-menu")).length>0&&l.data("ejMenu").destroy(),this.element.find(".e-rbncustomelement,.e-backstagetabarea,.e-gallerymenu").hide(),n=(t=this.element.find(".e-gallerymenu")).length,a=0;a<n;a++)t.eq(a).data("ejMenu").destroy(),t.eq(a).remove();for(this.element.find(".e-rbncustomelement,.e-backstagetabarea,.e-gallerymenu").appendTo(this.element.parent()),s=(i=e(".e-rbn-ddl.e-ddl").find(".e-dropdownlist")).length,a=0;a<s;a++)i.eq(a).data("ejDropDownList").destroy(),i.siblings("ul").appendTo(this.element.parent());for(o=(r=e(".e-rbn-splitbtn.e-splitbutton")).length,a=0;a<o;a++)r.eq(a).data("ejSplitButton").destroy(),r.siblings("ul").appendTo(this.element.parent());this.element.children().remove(),this._cloneElement.attr("role")||this.element.removeAttr("role"),this.element.removeClass("e-tab e-widget"),this.element.hasClass("e-ribwithout-apptab")&&this.element.removeClass("e-ribwithout-apptab"),this.model.enableOnDemand&&this.element.ejWaitingPopup("destroy"),this._trigger("_destroyed")},_tags:[{tag:"applicationTab.backstageSettings.pages",attr:["id","text","itemType","contentID","enableSeparator"]},{tag:"tabs",attr:["id","text",[{tag:"groups",attr:["id","text","alignType","type","contentID","enableGroupExpander",[{tag:"content",attr:["defaults.type","defaults.width","defaults.height","defaults.isBig",[{tag:"groups",attr:["id","columns","itemHeight","itemWidth","expandedColumns","contentID","text","type","toolTip","isMobileOnly","quickAccessMode","width","enableSeparator","buttonSettings.contentType","buttonSettings.type","buttonSettings.imagePosition","buttonSettings.prefixIcon","buttonSettings.click","buttonSettings.width","buttonSettings.cssClass","buttonSettings.enabled","buttonSettings.showRoundedCorner","buttonSettings.enableRTL","buttonSettings.repeatButton","buttonSettings.size","buttonSettings.height","buttonSettings.text","buttonSettings.timeInterval","buttonSettings.create","buttonSettings.click","buttonSettings.destroy","splitButtonSettings.contentType","splitButtonSettings.prefixIcon","splitButtonSettings.targetID","splitButtonSettings.buttonMode","splitButtonSettings.arrowPosition","splitButtonSettings.type","splitButtonSettings.click","splitButtonSettings.enabled","splitButtonSettings.showRoundedCorner","splitButtonSettings.enableRTL","splitButtonSettings.size","splitButtonSettings.height","splitButtonSettings.imagePosition","splitButtonSettings.width","splitButtonSettings.text","splitButtonSettings.suffixIcon","splitButtonSettings.create","splitButtonSettings.itemMouseOver","splitButtonSettings.itemSelected","splitButtonSettings.beforeOpen","splitButtonSettings.destroy","splitButtonSettings.cssClass","dropdownSettings.dataSource","dropdownSettings.text","dropdownSettings.value","dropdownSettings.select","dropdownSettings.width","dropdownSettings.showRoundedCorner","dropdownSettings.showPopupOnLoad","dropdownSettings.allowMultiSelection","dropdownSettings.enableRTL","dropdownSettings.enabled","dropdownSettings.caseSensitiveSearch","dropdownSettings.showCheckbox","dropdownSettings.checkAll","dropdownSettings.uncheckAll","dropdownSettings.enablePersistence","dropdownSettings.enableIncrementalSearch","dropdownSettings.readOnly","dropdownSettings.allowGrouping","dropdownSettings.fields","dropdownSettings.selectedItems","dropdownSettings.itemsCount","dropdownSettings.height","dropdownSettings.cssClass","dropdownSettings.itemValue","dropdownSettings.popupHeight","dropdownSettings.targetID","dropdownSettings.waterMarkText","dropdownSettings.template","dropdownSettings.cascadeTo","dropdownSettings.query","dropdownSettings.create","dropdownSettings.popupHide","dropdownSettings.popupShown","dropdownSettings.beforePopupShown","dropdownSettings.change","dropdownSettings.checkChange","dropdownSettings.enableAnimation","dropdownSettings.destroy","toggleButtonSettings.contentType","toggleButtonSettings.defaultText","toggleButtonSettings.activeText","toggleButtonSettings.type","toggleButtonSettings.defaultPrefixIcon","toggleButtonSettings.activePrefixIcon","toggleButtonSettings.click","toggleButtonSettings.enabled","toggleButtonSettings.showRoundedCorner","toggleButtonSettings.enableRTL","toggleButtonSettings.enablePersistence","toggleButtonSettings.toggleState","toggleButtonSettings.preventToggle","toggleButtonSettings.size","toggleButtonSettings.imagePosition","toggleButtonSettings.height","toggleButtonSettings.width","toggleButtonSettings.cssClass","toggleButtonSettings.defaultText","toggleButtonSettings.activeText","toggleButtonSettings.defaultPrefixIcon","toggleButtonSettings.defaultSuffixIcon","toggleButtonSettings.activePrefixIcon","toggleButtonSettings.create","toggleButtonSettings.change","toggleButtonSettings.destroy","customToolTip.title","customToolTip.content","customToolTip.prefixIcon",[{tag:"galleryItems",attr:["text","toolTip","customToolTip.title","customToolTip.content","customToolTip.prefixIcon","buttonSettings.contentType","buttonSettings.type","buttonSettings.imagePosition","buttonSettings.prefixIcon","buttonSettings.click","buttonSettings.width","buttonSettings.cssClass","buttonSettings.enabled","buttonSettings.showRoundedCorner","buttonSettings.enableRTL","buttonSettings.repeatButton","buttonSettings.size","buttonSettings.height","buttonSettings.text","buttonSettings.timeInterval","buttonSettings.create","buttonSettings.click","buttonSettings.destroy"]},{tag:"customGalleryItems",attr:["text","toolTip","customToolTip.title","customToolTip.content","customToolTip.prefixIcon","menuId","customItemType","buttonSettings.contentType","buttonSettings.type","buttonSettings.imagePosition","buttonSettings.prefixIcon","buttonSettings.click","buttonSettings.width","buttonSettings.cssClass","buttonSettings.enabled","buttonSettings.showRoundedCorner","buttonSettings.enableRTL","buttonSettings.repeatButton","buttonSettings.size","buttonSettings.height","buttonSettings.text","buttonSettings.timeInterval","buttonSettings.create","buttonSettings.click","buttonSettings.destroy","menuSettings.openOnClick","menuSettings.enableCenterAlign","menuSettings.showRooltLevelArrows","menuSettings.showSubLevelArrows","menuSettings.enableSeparator","menuSettings.enabled","menuSettings.orientation","menuSettings.menuType","menuSettings.animationType","menuSettings.subMenuDirection","menuSettings.fields","menuSettings.cssClass","menuSettings.contextMenuTarget","menuSettings.excludeTarget","menuSettings.height","menuSettings.width","menuSettings.titleText","menuSettings.create","menuSettings.beforeOpen","menuSettings.open","menuSettings.close","menuSettings.mouseover","menuSettings.mouseout","menuSettings.keydown","menuSettings.destroy"]}]]}]]}]]}]]},{tag:"contextualTabs",attr:["backgroundColor","borderColor",[{tag:"tabs",attr:["id","text",[{tag:"groups",attr:["id","text","alignType","type","contentID",[{tag:"content",attr:["defaults.type","defaults.width","defaults.height","defaults.isBig",[{tag:"groups",attr:["id","columns","itemHeight","itemWidth","expandedColumns","contentID","text","type","toolTip","width","enableSeparator","buttonSettings.contentType","buttonSettings.type","buttonSettings.imagePosition","buttonSettings.prefixIcon","buttonSettings.click","buttonSettings.width","buttonSettings.cssClass","buttonSettings.enabled","buttonSettings.showRoundedCorner","buttonSettings.enableRTL","buttonSettings.repeatButton","buttonSettings.size","buttonSettings.height","buttonSettings.text","buttonSettings.timeInterval","buttonSettings.create","buttonSettings.click","buttonSettings.destroy","splitButtonSettings.contentType","splitButtonSettings.prefixIcon","splitButtonSettings.targetID","splitButtonSettings.buttonMode","splitButtonSettings.arrowPosition","splitButtonSettings.type","splitButtonSettings.click","splitButtonSettings.enabled","splitButtonSettings.showRoundedCorner","splitButtonSettings.enableRTL","splitButtonSettings.size","splitButtonSettings.height","splitButtonSettings.imagePosition","splitButtonSettings.width","splitButtonSettings.text","splitButtonSettings.suffixIcon","splitButtonSettings.create","splitButtonSettings.itemMouseOver","splitButtonSettings.itemSelected","splitButtonSettings.beforeOpen","splitButtonSettings.destroy","splitButtonSettings.cssClass","dropdownSettings.dataSource","dropdownSettings.text","dropdownSettings.value","dropdownSettings.select","dropdownSettings.width","dropdownSettings.showRoundedCorner","dropdownSettings.showPopupOnLoad","dropdownSettings.allowMultiSelection","dropdownSettings.enableRTL","dropdownSettings.enabled","dropdownSettings.caseSensitiveSearch","dropdownSettings.showCheckbox","dropdownSettings.checkAll","dropdownSettings.uncheckAll","dropdownSettings.enablePersistence","dropdownSettings.enableIncrementalSearch","dropdownSettings.readOnly","dropdownSettings.allowGrouping","dropdownSettings.fields","dropdownSettings.selectedItems","dropdownSettings.itemsCount","dropdownSettings.height","dropdownSettings.cssClass","dropdownSettings.itemValue","dropdownSettings.popupHeight","dropdownSettings.targetID","dropdownSettings.waterMarkText","dropdownSettings.template","dropdownSettings.cascadeTo","dropdownSettings.query","dropdownSettings.create","dropdownSettings.popupHide","dropdownSettings.popupShown","dropdownSettings.beforePopupShown","dropdownSettings.change","dropdownSettings.checkChange","dropdownSettings.enableAnimation","dropdownSettings.destroy","toggleButtonSettings.contentType","toggleButtonSettings.defaultText","toggleButtonSettings.activeText","toggleButtonSettings.type","toggleButtonSettings.defaultPrefixIcon","toggleButtonSettings.activePrefixIcon","toggleButtonSettings.click","toggleButtonSettings.enabled","toggleButtonSettings.showRoundedCorner","toggleButtonSettings.enableRTL","toggleButtonSettings.enablePersistence","toggleButtonSettings.toggleState","toggleButtonSettings.preventToggle","toggleButtonSettings.size","toggleButtonSettings.imagePosition","toggleButtonSettings.height","toggleButtonSettings.width","toggleButtonSettings.cssClass","toggleButtonSettings.defaultText","toggleButtonSettings.activeText","toggleButtonSettings.defaultPrefixIcon","toggleButtonSettings.defaultSuffixIcon","toggleButtonSettings.activePrefixIcon","toggleButtonSettings.create","toggleButtonSettings.change","toggleButtonSettings.destroy","customToolTip.title","customToolTip.content","customToolTip.prefixIcon",[{tag:"galleryItems",attr:["text","toolTip","customToolTip.title","customToolTip.content","customToolTip.prefixIcon","buttonSettings.contentType","buttonSettings.type","buttonSettings.imagePosition","buttonSettings.prefixIcon","buttonSettings.click","buttonSettings.width","buttonSettings.cssClass","buttonSettings.enabled","buttonSettings.showRoundedCorner","buttonSettings.enableRTL","buttonSettings.repeatButton","buttonSettings.size","buttonSettings.height","buttonSettings.text","buttonSettings.timeInterval","buttonSettings.create","buttonSettings.click","buttonSettings.destroy"]},{tag:"customGalleryItems",attr:["text","toolTip","customToolTip.title","customToolTip.content","customToolTip.prefixIcon","menuId","customItemType","buttonSettings.contentType","buttonSettings.type","buttonSettings.imagePosition","buttonSettings.prefixIcon","buttonSettings.click","buttonSettings.width","buttonSettings.cssClass","buttonSettings.enabled","buttonSettings.showRoundedCorner","buttonSettings.enableRTL","buttonSettings.repeatButton","buttonSettings.size","buttonSettings.height","buttonSettings.text","buttonSettings.timeInterval","buttonSettings.create","buttonSettings.click","buttonSettings.destroy","menuSettings.openOnClick","menuSettings.enableCenterAlign","menuSettings.showRooltLevelArrows","menuSettings.showSubLevelArrows","menuSettings.enableSeparator","menuSettings.enabled","menuSettings.orientation","menuSettings.menuType","menuSettings.animationType","menuSettings.subMenuDirection","menuSettings.fields","menuSettings.cssClass","menuSettings.contextMenuTarget","menuSettings.excludeTarget","menuSettings.height","menuSettings.width","menuSettings.titleText","menuSettings.create","menuSettings.beforeOpen","menuSettings.open","menuSettings.close","menuSettings.mouseover","menuSettings.mouseout","menuSettings.keydown","menuSettings.destroy"]}]]}]]}]]}]]}]]}],_ribbonRerender:function(){var e,t,i,r=this.model,l=this.element;if(t=this.element.find(".e-content.e-content-item"),this.element.find(".e-collapse-content").length>0)for(i=t.length,e=0;e<i;e++)if(t.eq(e).hasClass("e-active-content")&&t.eq(e).hasClass("e-collapse-content")){this._selectedItemIndex=e,this._isCollapsed=!0;break}this._isCollapsed?(r.selectedItemIndex=this._selectedItemIndex,r._isCollapsed=!0):r._isCollapsed=!1,this.element.data("ejTab")&&(this.element.data("ejTab")._destroy(),this.element=l,this.model=r),this.element.ejRibbon("destroy").ejRibbon(r),this.model=r,this.element=l,this.model._isCollapsed&&this.collapse()},_setModel:function(i){var r,l,n,s,o,a,d,h,c,u;for(r in i)switch(r){case"applicationTab":t.isNullOrUndefined(i.applicationTab.backstageSettings)||t.isNullOrUndefined(i.applicationTab.backstageSettings.pages)||(this.model.applicationTab.backstageSettings.pages=i.applicationTab.backstageSettings.pages),this.model.enableOnDemand?this._createAppTabOnDemand():this._createApplicationTab();break;case"selectedItemIndex":this.model.selectedItemIndex>0&&-1===this._tabObj.model.disabledItemIndex.indexOf(this.model.selectedItemIndex)&&(this._ribbonTabs.eq(this.model.selectedItemIndex).is(":visible")||this._responsiveTabText.eq(t.isNullOrUndefined(t.isNullOrUndefined(this.model.applicationTab))?this.model.selectedItemIndex:this.model.selectedItemIndex-1).is(":visible"))&&this._tabObj.option({selectedItemIndex:this.model.selectedItemIndex});break;case"disabledItemIndex":var g,p,m=this.model.disabledItemIndex.length,_=this.model.disabledItemIndex,f=this.element.find(".e-link");for(this.model.disabledItemIndex.push(0),this._tabObj.option({disabledItemIndex:this.model.disabledItemIndex}),s=0;s<m;s++)((g=this._ribbonTabs.eq(_[s]).parent().parent()).hasClass("e-contextli")||g.hasClass("e-contextliset"))&&g.addClass("e-disable"),0!=this._tabObj.model.selectedItemIndex&&this._tabObj.model.selectedItemIndex===_[s]&&(p=f.eq(_[s]).attr("href"),e(p).append(this.element.find("#"+this._id+"_disabled")),e(p).css("position","relative"),this.element.find("#"+this._id+"_disabled").show());break;case"enabledItemIndex":for(l=this.model.enabledItemIndex.length,n=this._tabUl.find(".e-contextualtabset"),this._ribbonTabs=this._ribbonTabs.not("span,.e-ribresmenu,.e-responsiveqat"),s=0;s<l;s++)0!==this.model.enabledItemIndex[s]&&this._ribbonTabs.eq(this.model.enabledItemIndex[s]).is(":visible")||(this.model.enabledItemIndex.splice(s,1),--l,--s);for(this._conTabsRemove(),this._tabObj.option({enabledItemIndex:this.model.enabledItemIndex}),this._contextualTabs(),o=this.model.enabledItemIndex.length,a=0;a<o;a++)this._tabText.eq(this.model.enabledItemIndex[a]).parent().removeClass("e-disable"),this._tabText.eq(this.model.enabledItemIndex[a]).parent().css("position",""),((g=this._ribbonTabs.eq(this.model.enabledItemIndex[a]).parent().parent()).hasClass("e-contextli")||g.hasClass("e-contextliset"))&&g.removeClass("e-disable"),this.model.enabledItemIndex[a]==this._tabObj.model.selectedItemIndex&&this.element.find("#"+this._id+"_disabled").hide();for(d=n.length,h=0;h<d;h++)e(n[h]).hasClass("e-disable")&&e(n[h]).parents(".e-contextliset").addClass("e-disable");break;case"allowResizing":case"isResponsive":this._ribbonWindowResize();break;case"width":this.element.width(i[r]),this._ribbonWindowResize();break;case"enableRTL":this.model.enableRTL=i[r],c=this.model,u=this.element,this.element.data("ejTab")&&(this.element.data("ejTab")._destroy(),this.element=u,this.model=c),this.element.ejRibbon("destroy"),e("#"+this._id).ejRibbon(c),this.model=c,this.element=u;break;case"locale":this.model.locale=i[r],this._ribbonRerender();break;case"cssClass":this._changeSkin(i[r])}},_changeSkin:function(e){this._tabObj.option("cssClass",e)},_setTabContentHeight:function(){var t,i,r,l,n,s;for(this.element.find(".e-ribGroupContent").height("auto"),t=0,i=this.element.find(".e-content.e-content-item"),n=e("#"+this._id).parents(),e(i).addClass("e-content-show"),e("#"+this._id).is(":hidden")&&e("#"+this._id).addClass("e-ribbon-show"),s=0;s<n.length;s++)n.eq(s).is(":hidden")&&n.eq(s).addClass("e-ribbon-show");for(l=(r=this.element.find(".e-separatordivrow")).length,s=0;s<l;s++)e(r).eq(s).height(e(r).eq(s).prev().height());this.element.find(".e-ribGroupContent").each(function(){t=Math.max(t,e(this).height())}),this.element.find(".e-ribGroupContent").height(t),e(i).removeClass("e-content-show"),e("#"+this._id).hasClass("e-ribbon-show")&&(this._ribbonResize(),e(".e-ribbon-show").removeClass("e-ribbon-show"))},_init:function(){t.isNullOrUndefined(this.element)||(this._cloneElement=this.element.clone(),this._trigger("load"),this._render(),this._wireEvents())},_render:function(){var i,r,l,n,s;this.model.enableOnDemand&&e.isFunction(e.fn.ejWaitingPopup)&&(this.element.ejWaitingPopup({showOnInit:!1}),e("#"+this._id+"_WaitingPopup").addClass("e-ribbonwaitingpopup")),0==this.model.disabledItemIndex.length&&this.model.disabledItemIndex.push(0),this._renderTab(),this.model.showQAT&&(i=t.buildTag("div.e-rbnquickaccessbar").click(e.proxy(this._onQatClick,this)),this.model.showBelowQAT?(i.removeClass("e-rbnabove").addClass("e-rbnbelow"),this.element.append(i).addClass("e-rbnwithqatbelow")):(i.removeClass("e-rbnbelow").addClass("e-rbnabove"),this.element.prepend(i).addClass("e-rbnwithqatabove")),this.element.addClass("e-rbnwithqat")),this._initPrivateProperties(),this.model.enableOnDemand?this.model.collapsible?this._createQAT():(this._groupContent(),this.element.find(".e-header").addClass("e-rbnondemand"),this._createQAT()):(this._groupingControls(),this._createQAT()),this._initial=!0,this._customization(),this._initialRender=!0,this.model.collapsible&&this.collapse(),this._ribbonResponsive(),this._responsiveTabText=this.element.find(".e-responsivetabheader li"),this._phoneMode&&this._ribbonWindowResize(),this._tabObj.initialRender=!1,this.element.append(t.buildTag("div#"+this._id+"_disabled")),this.element.append(t.buildTag("div#"+this._id+"_modelDiv")),r=this.element.find(".e-content"),this.element.find("#"+this._id+"_disabled").height(this.element.find(".e-active-content").height()).width(this.model.width),this.element.find("#"+this._id+"_disabled").css({top:0,left:0,position:"absolute"}).addClass("e-disable"),this.element.find("#"+this._id+"_disabled").hide(),this.element.find("#"+this._id+"_modelDiv").height(e(r).height()).width(this.model.width),this.element.find("#"+this._id+"_modelDiv").css({top:0,left:0,position:"absolute"}).addClass("e-modelDiv"),this.element.find("#"+this._id+"_modelDiv").hide(),l=t.buildTag("div#"+this._id+"_resize").addClass("e-resizediv").hide().click(e.proxy(this._onResizeDivClick,this)),this.element.append(l);var o=t.buildTag("div#"+this._id+"_tooltip").addClass("e-tooltipdiv").hide(),a=t.buildTag("div#"+this._id+"_toolTip_title").addClass("e-tooltiptitle"),d=t.buildTag("div#"+this._id+"_toolTip_Desc").addClass("e-tooltipdesc");o.append(a),o.append(d),this.element.append(o),this._applicationTab.hasClass("e-active")&&!t.isNullOrUndefined(this.model.tabs[0].id)&&(this._applicationTab.removeClass("e-active"),this.element.find(".e-content.e-content-item").remove(),this._tabUl.find(".e-expandcollapse").remove()),n=this.element.find(".e-empty-content"),s=this.element.find(".e-groupdiv").eq(0),e(n).length>0&&e(s).length>0&&e(n).height(e(s).parent().height()),this.element.find(".e-rbncustomelement,.e-backstagetabarea,.e-gallerymenu").show()},_createQuickAccessBar:function(){var i,r,l,n,s,o,a;if(this.model.showQAT){for(i=t.buildTag("div.e-splitbtnqatdiv").attr("title",this.localizedLabels.CustomizeQuickAccess),r=t.buildTag("button#"+this._id+"_qatsplitbtn").addClass("e-splitbtnqat e-rbn-button"),i.append(r.ejButton({size:"normal",type:"button",contentType:"imageonly",height:30,width:14,prefixIcon:"e-icon e-ribbon e-qatexpand",click:e.proxy(this._onQatExpandBtnClick,this)})),this._qAccessBar.append(i),l=t.buildTag("ul.e-rbnqatmenu","<div>"+this.localizedLabels.CustomizeQuickAccess+"</div>").click(e.proxy(this._onQatMenuClick,this)),n=this._qatControlsName.length,s=0;s<n;s++)o=t.buildTag("li#"+this._qatControlsName[s].id+"_menuli.e-qatmenuli e-removemenuli","<p>"+this._qatControlsName[s].text+"</p>").appendTo(l).attr("title",this.localizedLabels.RemoveFromQuickAccessToolbar),"menu"==this._qatControlsName[s].qAccess&&o.addClass("e-addmenuli").removeClass("e-removemenuli").attr("title",this.localizedLabels.AddToQuickAccessToolbar);a="",a=this.model.showBelowQAT?"<li class='e-rbnshowabove e-qatmenuli'>"+this.localizedLabels.ShowAboveTheRibbon+"</li>":"<li class='e-rbnshowbelow e-qatmenuli'>"+this.localizedLabels.ShowBelowTheRibbon+"</li>",l.append("<li class='e-qatmenuli e-qatseparator'></li><li class='e-qatmorecommands e-qatmenuli' title="+this.localizedLabels.CustomizeQuickAccess+">"+this.localizedLabels.MoreCommands+"</li>"+a),this._qAccessBar.append(l.hide())}},_tooltip:function(t){var i=this.element.find(".e-controlclicked");(i.length<=0||e(i).find(".e-ribbonbtn").length>0)&&(this.element.find("#"+t.data.ribbonId+"_resize").is(":visible")||this.element.find(".e-gallexpandcontent").is(":visible")?(e(t.target).parents(".e-resizediv").length>0||e(t.target).parents(".e-gallexpandcontent").length>0)&&this._toolTipShow(t):this._toolTipShow(t))},_toolTipShow:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=this.element.find("#"+i.data.ribbonId+"_tooltip");b.find(".e-tooltiptitle").length<=0&&(h=t.buildTag("div#"+i.data.ribbonId+"_toolTip_title").addClass("e-tooltiptitle"),b.prepend(h)),b.removeClass("e-tooltipdivwithimg"),(a=b.find(".e-tooltiptitle")).children().remove(),e(i.target).is("li")||(e(i.target).hasClass("e-rarrowup-2x")&&!t.isNullOrUndefined(this.model.expandPinSettings.toolTip)&&e(e(i.target).parent()).attr("title",this.model.expandPinSettings.toolTip),!e(i.target).hasClass("e-rarrowup-2x")||t.isNullOrUndefined(this.model.expandPinSettings.customToolTip.title)&&t.isNullOrUndefined(this.model.expandPinSettings.customToolTip.content)||(p=i.data.value.expandObj),e(i.target).hasClass("e-ribbonpinicon")&&!t.isNullOrUndefined(this.model.collapsePinSettings.toolTip)?e(e(i.target).parent()).attr("title",this.model.collapsePinSettings.toolTip):!e(i.target).hasClass("e-ribbonpinicon")||t.isNullOrUndefined(this.model.collapsePinSettings.customToolTip.title)&&t.isNullOrUndefined(this.model.collapsePinSettings.customToolTip.content)?e(i.target).hasClass("e-rarrowup-2x")||e(i.target).hasClass("e-ribbonpinicon")||(p=i.data.value):p=i.data.value.collapseObj,t.isNullOrUndefined(p)||t.isNullOrUndefined(p.customToolTip)||t.isNullOrUndefined(p.customToolTip.title)?a.remove():a.append(p.customToolTip.title),t.isNullOrUndefined(p)||t.isNullOrUndefined(p.customToolTip)||t.isNullOrUndefined(p.customToolTip.content)||(a.children().length<=0&&a.empty().append("<b>"+p.customToolTip.title+"</b>"),(o=b.find(".e-tooltipdesc")).children().remove(),o.append(p.customToolTip.content),o.children().length<=0&&o.empty().append("<h6>"+p.customToolTip.content+"</h6>"),t.isNullOrUndefined(p)||t.isNullOrUndefined(p.customToolTip.prefixIcon)?o.children().addClass("e-tooltipcontent"):(o.prepend("<span class=e-tooltipimg></span>"),o.find(".e-tooltipimg").addClass(p.customToolTip.prefixIcon),o.children().not("."+p.customToolTip.prefixIcon).addClass("e-tooltipcntwithimg"),b.addClass("e-tooltipdivwithimg"))),t.isNullOrUndefined(p))||(l=this.element.find("#"+i.delegateTarget.id).offset(),r=this.element.find("#"+i.delegateTarget.id),b.stop(!0).delay(700).show(0).addClass("e-rbntooltipshadow"),s=this.element.find("#"+i.data.ribbonId+"_resize"),d=e(i.target).parents(".e-gallexpandcontent"),this.element.css({position:"relative"}),c=this.element.width()+this.element.offset().left-(l.left+parseInt(e(b).width(),10)),l.left=c<=0?l.left+c-this.element.offset().left:l.left-this.element.offset().left,u=(g=this.element.find(".e-active-content").eq(0)).is(":visible")?this._tabUl.height()+g.height():this._tabUl.height(),s.is(":visible")&&!d.is(":visible")?(b.offset({left:l.left}),n=r.parents(".e-galleryrow").length>0?u+r.position().top+r.parents(".e-galleryrow").height():u+r.position().top+r.height(),b.css({top:n})):d.is(":visible")?(m=r.parents(".e-galleryrow").length>0?r.parents(".e-galleryrow"):r.parents(".e-galleryexpanderrow").length>0?r.parents(".e-galleryexpanderrow"):r,n=e(d).parents(".e-resizediv").length>0?m.height()+u+r.position().top+12:m.height()+this._tabUl.height()+r.position().top+12,b.offset({left:l.left}),b.css({top:n})):e(i.target).parents(".e-qatooldiv").length>0||e(i.target).hasClass("e-qatooldiv")?(_=this.element.find(".e-qaresizediv"),(f=this.element.find(".e-rbnquickaccessbar")).hasClass("e-rbnabove")&&_.length>0?_.is(":visible")&&b.offset({top:_.height()+f.height()+4,left:l.left}):f.hasClass("e-rbnabove")?b.offset({top:f.height()+4,left:l.left}):(n=_.is(":visible")?f.height()+_.height()+u+4:u+f.height()+4,b.offset({top:n,left:l.left}))):(n=u+3,b.offset({top:n,left:l.left})))},_toolTipOut:function(e){var t=this.element.find("#"+e.data.ribbonId+"_tooltip");t.hide(0),t.css({top:"",left:""}),t.find(".e-tooltiptitle").children().remove(),t.find(".e-tooltipdesc").children().remove()},_responsiveScrollRemove:function(){var e=this.element.find(".e-active-content .e-responsiveScroll"),t=this.element.find(".e-rescontentScroll");t.length>0&&(t.data("ejScroller")._destroy(),t.parent().append(t.find("div:first").children()),t.remove()),e.length>0&&(e.data("ejScroller")._destroy(),this.element.find(".e-active-content").append(e.find("div:first").children()),e.remove())},_onGroupClick:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v;if(this._toolTipCustomization(i),r=e(i.target).parents(".e-resizebtnselect"),this.element.find(".e-resizebtnselect").removeClass("e-resizebtnselect e-active"),l=e(i.target).parents(".e-resizediv"),e(i.target).hasClass("e-resizebtnselect")?e(i.target).removeClass("e-resizebtnselect e-active"):r.length>0?r.removeClass("e-resizebtnselect e-active"):(r=e(i.target).parents(".e-resizebtn")).length>0?r.addClass("e-resizebtnselect e-active"):e(i.target).hasClass("e-resizebtn")&&e(i.target).addClass("e-resizebtnselect e-active"),this.model.showQAT&&!e(i.target).parents(".e-mobdiv").length>0&&(e(i.target).hasClass("e-togglebutton e-btn")||e(i.target).parents(".e-togglebutton.e-btn").length>0)&&(R=e(i.target),e(i.target).parents(".e-togglebutton.e-btn").length>0&&(R=e(i.target).parents(".e-togglebutton.e-btn")),n=this._QATclick?R.parent().find("input").attr("id")+"_mobEle":R.parent().find("input").attr("id")+"_qatEle",e(".e-ribbon.e-rbnwithqat").find("#"+n).length>0&&this._rbnToggleBtnCustomization(i,n)),!this._phoneMode)if(l.length<=0&&(e(i.target).hasClass("e-resizebtn")?l=e(i.target):t.isNullOrUndefined(e(i.target).parents(".e-resizebtn"))||(l=e(i.target).parents(".e-resizebtn"))),this.element.find(".e-resizediv").is(":visible")&&this.element.find(".e-resizediv .e-gallexpandcontent").is(":visible"))e(i.target).hasClass("e-gallerymoveicon")||e(i.target).hasClass("e-gallerymovediv")||e(i.target).hasClass("e-expgallerydiv")||e(i.target).hasClass("e-scrollbar")||e(i.target).parents().hasClass("e-scrollbar")?s=i.target:e(i.target).parents().hasClass("e-gallerymenu")&&(e(i.target).hasClass("e-haschild")||e(i.target).hasClass("aschild")||e(i.target).hasClass("e-arrows"))&&(s=i.target),t.isNullOrUndefined(s)&&(this._ribbonGalleryShow(),this.element.find(".e-resizediv").show().css("visibility",""),this.element.find(".e-resizediv .e-gallexpandcontent").hide().css("visibility",""));else if(l.length<=0){if(!e(i.target).parents(".e-content").length>0&&e(i.target).parents(".e-rbn-ddl").length>0||e(i.target).parents(".e-rbn-splitbtn").length>0||e(i.target).parents(".e-presetWrapper").length>0||e(i.target).parents(".e-ribbonpopup").length>0||e(i.target).parents(".e-colorpicker.e-ribbon:visible").length>0)return!1;this._resizeDivHide()}else e(l).hasClass("e-resizebtn")&&(this.element.find(".e-resizediv").is(":visible")?l.parent().siblings(".e-contentbottom").length<=0?this._resizeDivHide():(this._resizeDivHide(),this._resizeDivShow(l)):this._resizeDivShow(l));if(this._phoneMode){var w,I,y,T=this.element.find(".e-active-content"),L=0,R=i.target;if(e(R).hasClass("e-groupresponsive e-ribdownarrow")){for(w=T.find(".e-resptoolbarScroll .e-scrollbar").height(),y=T.children(".e-groupdiv,.e-groupmobdiv"),o=0;o<y.length;o++)L+=y.eq(o).outerHeight();L+=t.isNullOrUndefined(w)?0:w,I=T.find(".e-respmobcontent").length>0?L-T.find(".e-respmobcontent").outerHeight()>this._responsiveHeight:L>this._responsiveHeight,T.height(I?T.find(".e-respmobcontent").length>0?this._responsiveHeight+T.find(".e-respmobcontent").outerHeight():this._responsiveHeight:L).removeClass("e-responsiveheight e-rbnmobheader e-responsiveToolbarScroll"),I&&(a=t.buildTag("div#"+this._id+"_responsiveScroller").addClass("e-responsiveScroll").append(t.buildTag("div")),T.find(".e-respmobcontent").length>0?a.find("div").append(T.children().eq(0).siblings()):a.find("div").append(T.children()),T.append(a),T.find(".e-responsiveScroll").ejScroller({height:this._responsiveHeight,scrollerSize:8,buttonSize:0})),e(R).removeClass("e-ribdownarrow").addClass("e-ribuparrow"),e(R).parents(".e-groupdiv").find(".e-ribdownarrow").removeClass("e-ribdownarrow").addClass("e-ribuparrow")}else if(e(R).hasClass("e-groupresponsive e-ribuparrow"))T.addClass("e-responsiveheight e-rbnmobheader"),T.find(".e-resptoolbarScroll").length>0&&T.addClass("e-responsiveToolbarScroll"),this._responsiveScrollRemove(),e(R).removeClass("e-ribuparrow").addClass("e-ribdownarrow");else if(this.element.find(".e-responsivecontent").is(":hidden")&&(e(R).hasClass("e-resizebtn")||e(R).parents(".e-resizebtn").length>0||e(R).hasClass("e-groupresponsive e-ribrightarrow")||e(R).hasClass("e-ribrightdivarrow"))){if(e(R).hasClass("e-resizebtn")?(this._responsiveTarget=e(R).parents(".e-groupdiv"),this._responsiveContent=e(R).parent().siblings()):e(R).parents(".e-resizebtn").length>0?(this._responsiveTarget=e(R).parents(".e-resizebtn").parents(".e-groupdiv"),this._responsiveContent=e(R).parents(".e-resizebtn").parent().siblings()):(e(R).hasClass("e-groupresponsive e-ribrightarrow")||e(R).hasClass("e-ribrightdivarrow"))&&((d=e(R).parents(".e-resizegroupdiv").find(".e-resizebtn")).length>0&&(this._responsiveTarget=d.parents(".e-groupdiv"),this._responsiveContent=d.parent().siblings())),h=this._responsiveContent.eq(0).removeClass("e-reshide"),(c=this.element.find(".e-content.e-responsivecontent")).children().not(".e-responsiveback").remove(),c.append(h),this.element.find(".e-restopbackcontent").text(this._responsiveTarget.find(".e-resizebtn .e-btntxt").text()),(u=c.find(".e-ribbongallery")).length>0){for(g=this._responsiveGallery,p=Math.floor(u.find(".e-galleryrow").children().length/g),u.find(".e-galleryrow").children().length%g>0&&++p,m=1;m<=p;m++){for(_=t.buildTag("div#"+u.attr("id")+"_galleryExpanderRow_"+m).addClass("e-galleryexpanderrow").click({model:u},e.proxy(this._onGalleryItemClick,this)),f=0;f<g;f++)u.find(".e-galleryrow").children().eq(0).appendTo(_);_.appendTo(c.parent().find(".e-expandercontent"))}u.hide(),c.parent().find(".e-gallexpandcontent").show()}this._responsiveContentShow(c)}}-1!=(b=e(i.target).hasClass("e-groupdiv")?e(i.target).index():e(i.target).parents(".e-groupdiv").index())&&(i.groupItems=this._groupClickEventArgs(b,i)),0===e(i.target).parents(".e-ribbongallerycontrol").length&&(this._trigger("groupClick",i),i.cancel||!t.raiseWebFormsServerEvents||t.isNullOrUndefined(this.model.serverEvents)||-1!=this.model.serverEvents.indexOf("groupClick")&&(x={model:C=e.extend(!0,{},this.model),originalEventType:"groupClick",id:S=i.target.id?i.target.id:i.target.parentNode.id},v={model:C,id:S},t.raiseWebFormsServerEvents("groupClick",x,v)))},_groupClickEventArgs:function(i,r){var l,n,s=this._tabUl.find(".e-active"),o=s.index();return this._phoneMode&&e(r.target).parents(".e-groupdiv").siblings(".e-groupmobdiv").length>0&&(i-=1),t.isNullOrUndefined(this.model.applicationTab)||s.hasClass("e-contextualtabset")||(o-=1),o<0?void 0:(n=s.hasClass("e-contextualtabset")?this.model.contextualTabs[s.parents(".e-contextual").index()].tabs[o]:this.model.tabs[o],t.isNullOrUndefined(n)||(l=n.groups[i]),l)},goToMainContent:function(){var e=this.element.find(".e-responsivebackstage"),t=this.element.find(".e-responsivetabheader"),i={},r=this.element.find(".e-active-content"),l=(this.element.find(".e-responsivebackstage"),this.element.find(".e-responsivebackstagecontent"));t.removeClass("e-resshow"),e.is(":visible")&&e.removeClass("e-backstageshowanimate").addClass("e-reshide"),l.is(":visible")&&l.hide(),this.element.find(".e-responsivecontent").is(":visible")&&this._responsiveContentBack(),r.hasClass("e-responsiveheight")||(r.addClass("e-responsiveheight e-rbnmobheader"),this._responsiveScrollRemove(),r.find(".e-groupresponsive.e-ribuparrow").removeClass("e-ribuparrow").addClass("e-ribdownarrow"),i.type="collapse",this._trigger("collapse",i)),t.hasClass("e-resshow")&&t.removeClass("e-resshow")},_onResizeDivClick:function(t){var i,r,l,n;this._toolTipCustomization(t),this.model.showQAT&&(e(t.target).hasClass("e-togglebutton e-btn")||e(t.target).parents(".e-togglebutton.e-btn").length>0)&&(r=e(t.target),e(t.target).parents(".e-togglebutton.e-btn").length>0&&(r=e(t.target).parents(".e-togglebutton.e-btn")),i=r.parent().find("input").attr("id")+"_qatEle",this._rbnToggleBtnCustomization(t,i)),this._phoneMode&&((e(t.target).hasClass("e-togglebutton e-btn")||e(t.target).parents(".e-togglebutton.e-btn").length>0)&&(r=e(t.target),e(t.target).parents(".e-togglebutton.e-btn").length>0&&(r=e(t.target).parents(".e-togglebutton.e-btn")),i=r.parent().find("input").not(".e-active").attr("id")+"_mobEle",this._rbnToggleBtnCustomization(t,i)),e(t.target).hasClass("e-ribleftarrow")&&this._responsiveContentBack()),e(t.currentTarget).find(".e-ribGroupContent").length>0&&(l=e(t.currentTarget).find(".e-ribGroupContent").attr("id").split("_"),n=this.element.find("#"+l[0]+"_"+l[1]+"_"+l[2]).index(),this._phoneMode&&n>0&&this.element.find("#"+l[0]+"_"+l[1]+"_"+l[2]).siblings(".e-groupmobdiv").length>0&&(n-=1),-1!=n&&(t.groupItems=this._groupClickEventArgs(n,t))),t.targetElement="resizedGroup",this._trigger("groupClick",t)},_toolTipCustomization:function(t){var i=e(t.target).parents(".e-controlpadding");e(i).find(".e-ribbongallerycontrol").length<=0&&e(t.target).find(".e-disable").length<=0&&!e(t.target).hasClass("e-disable")&&(this.element.find(".e-tooltipdiv").hide(0),e(i).hasClass("e-controlclicked")?e(i).removeClass("e-controlclicked"):e(i).addClass("e-controlclicked"))},_onTabClick:function(i){var r;this._trigger("beforeTabClick",i),this.model.enableOnDemand&&(e("#"+this._id+"_WaitingPopup").is(":hidden")&&0==this.element.find(".e-content.e-content-item").eq(i.activeIndex).children().length&&this.element.ejWaitingPopup("show"),this._groupContent(i));var l,n,s=this.element.find(".e-rarrowup-2x"),o=this._tabUl.find("li.e-active"),a=this.element.find(".e-collapseactive"),d=this.element.find(".e-active-content").eq(0);if(this._phoneMode){this._responsiveScrollRemove(),this.element.find(".e-mobribgroupactive").removeClass("e-mobribgroupactive");var h=i.activeIndex,c=this.element.find(".e-content.e-content-item").eq(h),u=this._tabUl.children(".e-tab").index(i.activeHeader);if(t.isNullOrUndefined(this.model.applicationTab)&&(--i.activeIndex,--i.prevActiveIndex),this.element.find(".e-content.e-content-item").eq(i.prevActiveIndex).removeClass("e-responsiveheight e-rbnmobheader"),this.element.find(".e-content.e-content-item").eq(i.activeIndex).addClass("e-responsiveheight e-rbnmobheader"),this.element.find(".e-responsivecontent").is(":visible")&&this.element.find(".e-responsivecontent").hasClass("e-resshow")&&this.element.find(".e-responsivecontent").removeClass("e-resshow"),t.isNullOrUndefined(this._responsiveContent)||this._responsiveTarget.append(this._responsiveContent).css(this._responsiveContentStyle),-1!=u&&this._mobileContents[u].mobileContent.length>0&&!c.find(".e-respmobcontent").length>0){for(c.prepend(t.buildTag("div#"+this._id+"_mobcontent").addClass("e-respmobcontent e-groupmobdiv").append(t.buildTag("div#"+this._id+"_mobribgroup").addClass("e-mobribgroup e-mobribgroupactive").append(t.buildTag("div.e-ribupdivarrow").addClass("e-toolbaralign").append(t.buildTag("span.e-icon").addClass("e-groupresponsive e-ribdownarrow"))))).click(e.proxy(this._onGroupClick,this)).click(e.proxy(this._onMobContentClick,this)),c.find(".e-resgroupheader").removeClass("e-resgroupheader"),r=0;r<this._mobileToolbar[u].Content.length;r++)c.find(".e-mobribgroup").append(this._mobileToolbar[u].Content[r]);c.find(".e-mobribgroup").append(c.find(".e-mobribgroup .e-ribupdivarrow"))}-1!=u&&this._mobileContents[u].mobileContent.length>0&&!c.find(".e-mobribgroup").hasClass("e-mobribgroupactive")&&c.find(".e-mobribgroup").addClass("e-mobribgroupactive")}o.length>0?(o.removeClass("e-active"),o.children().removeClass("e-active"),d.removeClass("e-active-content").hide()):a.length>0&&(i.activeHeader.textContent===a.find(".e-link").text()?(a.addClass("e-active").removeClass("e-collapseactive"),d.removeClass("e-collapse-content").slideDown("fast","swing",e.proxy(this._ribExpand,this))):(l=this.element.find(".e-link"),a.removeClass("e-collapseactive"),this.element.find(".e-collapse-content").removeClass("e-collapse-content"),d.removeClass("e-active-content"),n=l.eq(i.activeIndex).attr("href"),l.eq(i.activeIndex).addClass("e-active"),e(n).slideDown("fast","swing",e.proxy(this._ribExpand,this)))),s.length>0&&this.element.find(".e-collapsed").length>0&&this._addRibbonPin(),this._initialRender||this._trigger("tabClick",i),this._clickValue="click"},_onTabSelect:function(i){var r,l,n,s;if(this.model.enableOnDemand&&(this._initialRender&&e("#"+this._id+"_WaitingPopup").is(":hidden")&&this.element.ejWaitingPopup("show"),this._setTabContentHeight()),r=this.element.find("li.e-active"),n=this.element.find(".e-expandcollapse"),this.model.selectedItemIndex=i.activeIndex,r.hasClass("e-disable")||(l=this.element.find(".e-link").eq(i.activeIndex).attr("href"),e(l).find("#"+this._id+"_disabled")&&this.element.find("#"+this._id+"_disabled").hide()),n.length>0&&n.appendTo(this.element.find(".e-active-content").eq(0)),this._phoneMode||this._ribbonResize(),!this._initialRender&&(this._trigger("tabSelect",i),e(".e-menu-wrap").children(".e-split:visible").length>0&&e(e(".e-menu-wrap").children(".e-split")).css("display","none"),e(".e-rbn-ddl").parent(".e-ddl-popup:visible").length>0&&e(e(".e-rbn-ddl").parent(".e-ddl-popup:visible")).css("display","none"),e(".e-popupWrapper").parent(".e-colorpicker.e-ribbon:visible").length>0&&e(e(".e-popupWrapper").parent(".e-colorpicker.e-ribbon")).css("display","none"),t.isOnWebForms&&t.raiseWebFormsServerEvents&&!t.isNullOrUndefined(this.model.serverEvents)&&-1!=this.model.serverEvents.indexOf("tabSelect"))){var o=e.extend(!0,{},this.model),a={model:o,originalEventType:"tabSelect",activeIndex:i.activeIndex,prevActiveIndex:i.prevActiveIndex},d={model:o,activeIndex:i.activeIndex,prevActiveIndex:i.prevActiveIndex};t.raiseWebFormsServerEvents("tabSelect",a,d)}this._phoneMode&&!this._initialRender&&this._ribbonWindowResize(),this._initialRender=!1,s=this,this.model.enableOnDemand&&e("#"+this._id+"_WaitingPopup").is(":visible")&&setTimeout(function(){s.element.ejWaitingPopup("hide")},300)},_create:function(e){this.model.enableOnDemand&&this.element.find(".e-content.e-content-item").addClass("e-rbn-ondemand"),this._trigger("tabCreate",e)},_onGalMoveUpClick:function(t){var i=this.element.find("#"+t.data.galleryId),r=i.find(".e-gallerycontent").children(":visible").first().prev();this.element.find(".e-gallexpandcontent:visible").length>0&&this._ribbonGalleryShow(),r.length>0&&(i.find(".e-gallerycontent").children(":visible").last().hide(),r.show().width(i.find(".e-galleryrow").first().width()),e(r).hasClass("e-gryfirstrow")&&i.find(".e-moveupdiv").addClass("e-disablegrymovebtn"),i.find(".e-movedowndiv").removeClass("e-disablegrymovebtn"))},_onGalMoveDownClick:function(t){var i=this.element.find("#"+t.data.galleryId),r=i.find(".e-gallerycontent").children(":visible").last().next();this.element.find(".e-gallexpandcontent:visible").length>0&&this._ribbonGalleryShow(),r.length>0&&(i.find(".e-gallerycontent").children(":visible").first().hide(),r.show().width(i.find(".e-galleryrow").first().width()),e(r).hasClass("e-grylastrow")&&i.find(".e-movedowndiv").addClass("e-disablegrymovebtn"),i.find(".e-moveupdiv").removeClass("e-disablegrymovebtn"))},_onQatMenuItemClick:function(t){var i={target:e(t.target),cancel:!1,text:e(t.target).text()};this._trigger("qatMenuItemClick",i)},_onQatResizeBtnClick:function(t){var i,r=this.element.find(".e-qaresizediv"),l=this.element.find(".e-qaresizebtn");l.hasClass("e-active")?l.removeClass("e-tbtn e-active"):l.addClass("e-tbtn e-active"),r.is(":hidden")?(e(t.e.currentTarget).position().left+r.width()>this.element.width()?(i=e(t.e.currentTarget).position().left+r.width()-this.element.width(),r.show().css({left:e(t.e.currentTarget).position().left-i})):r.show().css({top:this._qAccessBar.height(),left:e(t.e.currentTarget).position().left}),this._qAccessBar.hasClass("e-rbnbelow")?r.css({top:this.element.height()}):r.css({top:this._qAccessBar.height()})):r.hide().css({top:"",left:""})},_onQatExpandBtnClick:function(t){var i,r=0,l=this.element.find(".e-splitbtnqat"),n=this.element.find(".e-qaresizediv"),s=this.element.find(".e-rbnqatmenu"),o=e(t.e.currentTarget);if(l.hasClass("e-active"))return l.removeClass("e-tbtn e-active"),void s.hide();l.addClass("e-tbtn e-active"),n.length>0&&n.is(":visible")?((i=n.position().left+o.position().left+s.width())>this.element.width()&&(r=i-this.element.width()),s.show().css({top:n.height()-6,left:n.position().left+o.position().left-(r+6)})):(i=o.position().left+s.width(),this.model.enableRTL&&(i=this.element.width()-o.offset().left+s.width()),i>this.element.width()&&(r=i-this.element.width()),this.model.enableRTL&&s.show().css({right:this.element.width()-o.offset().left+this.element.offset().left-o.outerWidth()-r}),s.show().css({left:o.position().left-r}),this.element.hasClass("e-grpdivhide")&&(this.element.removeClass("e-grpdivhide"),this.element.find(".e-active-content").eq(0).addClass("e-resdivshow")))},_onQatClick:function(t){if(this._QATclick||(this._QATclick=!0),this.model.showQAT&&(e(t.target).hasClass("e-togglebutton e-btn")||e(t.target).parents(".e-togglebutton.e-btn").length>0)){var i,r=e(t.target);e(t.target).parents(".e-togglebutton.e-btn").length>0&&(r=e(t.target).parents(".e-togglebutton.e-btn")),i=r.parents(".e-qatooldiv").attr("id").slice(0,-7),this._rbnToggleBtnCustomization(t,i)}this._QATclick=!1},_onMobContentClick:function(t){if(e(t.target).hasClass("e-togglebutton e-btn")||e(t.target).parents(".e-togglebutton.e-btn").length>0){var i,r=e(t.target);if(e(t.target).parents(".e-togglebutton.e-btn").length>0&&(r=e(t.target).parents(".e-togglebutton.e-btn")),!r.parents(".e-mobdiv").length>0)return;i=r.parents(".e-mobdiv").attr("id").slice(0,-7),this._rbnToggleBtnCustomization(t,i)}},_rbnToggleBtnCustomization:function(e,t){var i,r,l=this.element.find("#"+t+":input.e-togglebutton.e-chkbx-hidden"),n=l.parent().siblings(".e-togglebutton");this._rbnToggleBtnAction&&l.length>0&&(this._rbnToggleBtnAction=!1,i=(r=l.data("ejToggleButton")).model.click,r.model.click="",n.click(),r.model.click=i),this._rbnToggleBtnAction=!0},_onQatMenuClick:function(t){var i,r=this.element.find(".e-rbnquickaccessbar"),l=e(t.target),n=l.parents(".e-qatmenuli");(l.hasClass("e-qatmenuli")||n.length>0)&&(n.length>0&&(l=n),l.attr("id")&&((i=this.element.find("#"+this._id+"_"+l.attr("id").slice(0,-7)+"_qatEle").parents(".e-qatooldiv")).is(":visible")?(i.hide(),l.addClass("e-addmenuli").removeClass("e-removemenuli").attr("title",this.localizedLabels.AddToQuickAccessToolbar)):(i.show(),l.removeClass("e-addmenuli").addClass("e-removemenuli").attr("title",this.localizedLabels.RemoveFromQuickAccessToolbar))),l.hasClass("e-rbnshowbelow")?(this.element.append(r.removeClass("e-rbnabove").addClass("e-rbnbelow")).removeClass("e-rbnwithqatabove").addClass("e-rbnwithqatbelow"),l.addClass("e-rbnshowabove").removeClass("e-rbnshowbelow").text(this.localizedLabels.ShowAboveTheRibbon),this.model.showBelowQAT=!0):l.hasClass("e-rbnshowabove")&&(this.element.prepend(r.removeClass("e-rbnbelow").addClass("e-rbnabove")).removeClass("e-rbnwithqatbelow").addClass("e-rbnwithqatabove"),l.addClass("e-rbnshowbelow").removeClass("e-rbnshowabove").text(this.localizedLabels.ShowBelowTheRibbon),this.model.showBelowQAT=!1),this.element.find(".e-rbnqatmenu").hide().css({top:"",left:""}),this.element.find(".e-qaresizebtn,.e-splitbtnqat").removeClass("e-tbtn e-active"),(this.model.allowResizing||this.model.isResponsive)&&(this._qatResize(),this._qatResizeRemove()))},_onGalContentClick:function(t){var i=this.element.find("#"+t.data.galleryId);e(t.target).hasClass("e-gallerybtn")?(i.find(".e-galleryselect").removeClass("e-galleryselect"),e(t.target).addClass("e-galleryselect")):e(t.target).parents(".e-gallerybtn")&&(i.find(".e-galleryselect").removeClass("e-galleryselect"),e(t.target).parents(".e-gallerybtn").addClass("e-galleryselect"))},_onExpandContentClick:function(t){var i=this.element.find("#"+t.data.galleryId);e(t.target).hasClass("e-gallerybtn")?(i.parent().find(".e-galleryselect").removeClass("e-galleryselect"),e(t.target).addClass("e-galleryselect")):e(t.target).parents(".e-gallerybtn")&&(i.parent().find(".e-galleryselect").removeClass("e-galleryselect"),e(t.target).parents(".e-gallerybtn").addClass("e-galleryselect"))},_onExpandGalleryClick:function(i){var r,l,n,s,o,a=this.element.find("#"+i.data.galleryId),d=i.data.expandedColumns;for(this.element.find(".e-gallexpandcontent:visible").length>0&&this._ribbonGalleryShow(),t.isNullOrUndefined(i.data.expandedColumns)&&(d=i.data.columns),r=Math.floor(a.find(".e-galleryrow").children().length/d),a.find(".e-galleryrow").children().length%d>0&&++r,l=1;l<=r;l++){for(n=t.buildTag("div#"+a.attr("id")+"_galleryExpanderRow_"+l).addClass("e-galleryexpanderrow").click({model:a},e.proxy(this._onGalleryItemClick,this)),s=0;s<d;s++)a.find(".e-galleryrow").children().eq(0).appendTo(n);n.appendTo(this.element.find("#"+a.attr("id")).parent().find(".e-expandercontent"))}for(a.hide(),o=0;o<i.data.columns;o++)a.find(".e-galleryrow").eq(0).append("<div></div>");this.element.find(".e-resizediv").is(":visible")&&(this.element.find(".e-resizediv").css("visibility","hidden"),this.element.find(".e-resizediv .e-gallexpandcontent").css("visibility","visible")),this.element.find("#"+a.attr("id")).parent().find(".e-gallexpandcontent").show(),this.element.find("#"+a.attr("id")).parent().find(".e-expandercontent").height()>160&&!this._phoneMode&&this.element.find("#"+a.attr("id")).parent().find(".e-gallscrollcontent").ejScroller({height:160})},_onGalleryItemClick:function(i){var r,l,n,s;r={target:i.target,galleryModel:i.data.model,cancel:!1},e(r.target).hasClass("e-galleryexpanderrow")||(this._trigger("galleryItemClick",r),i.preventDefault(),t.raiseWebFormsServerEvents&&!t.isNullOrUndefined(this.model.serverEvents)&&-1!=this.model.serverEvents.indexOf("galleryItemClick")&&(n={model:e.extend(!0,{},this.model),originalEventType:"galleryItemClick",id:l=r.target.id?r.target.id:r.target.parentNode.id},s={model:i.data.model,id:l},t.raiseWebFormsServerEvents("galleryItemClick",n,s)))},_ribbonKeyDown:function(e){(40===e.keyCode||39===e.keyCode)&&this._tabUl.find(".e-tab:visible,.e-contextualtabset:visible").length===this._tabObj.model.selectedItemIndex&&e.stopImmediatePropagation()},_OnKeyDown:function(t){var i,r;27===t.keyCode&&(i=this.element.find(".e-resizediv"),this.element.find(".e-ribbonbackstagepage").is(":visible")?this.hideBackstage():e(".e-menu-wrap").children(".e-split:visible").length<=0&&i.find(".e-ddl").parents(".e-controlclicked").length<=0&&i.is(":visible")?this._resizeDivHide():this.element.find(".e-gallexpandcontent").is(":visible")&&this._ribbonGalleryShow(),i.is(":visible")&&i.find(".e-controlclicked").removeClass("e-controlclicked"),(r=this.element.find("#"+this._id+"_modelDiv")).is(":visible")&&r.css("display","none"))},_ribCollapse:function(e){e={clickType:this._clickValue};null==this._clickValue&&(e={clickType:"click"}),this._clickValue=null,this._trigger("collapse",e)},_ribExpand:function(e){this.element.find(".e-ribbonpin").length>0&&this._tabContents.width(this.element.width());e={clickType:this._clickValue};null==this._clickValue&&(e={clickType:"click"}),this._clickValue=null,this._trigger("expand",e)},collapse:function(){var t=this.element.find(".e-active-content").eq(0),i=this.element.find("#"+this._id+"_togglebutton");this._initialRender&&this.model.collapsible?t.hide():t.slideUp("fast","swing",e.proxy(this._ribCollapse,this)),this.element.find("li.e-active").eq(0).removeClass("e-active").addClass("e-collapseactive e-select"),t.addClass("e-collapse-content"),this._selectedItemIndex=this._tabObj.model.selectedItemIndex,this._tabObj.option({selectedItemIndex:0}),this._tabObj.model.selectedItemIndex=0,this.model.selectedItemIndex=0,i.removeClass("e-expanded").addClass("e-collapsed"),this._isCollapsed=!0},expand:function(){var t,i=this.element.find(".e-active-content").eq(0);i.hasClass("e-rbn-ondemand")&&this._groupContent({activeIndex:this.model.selectedItemIndex+1}),t=this.element.find("#"+this._id+"_togglebutton"),i.slideDown("fast","swing",e.proxy(this._ribExpand,this)),this.element.find(".e-collapseactive").addClass("e-active").removeClass("e-collapseactive"),i.removeClass("e-collapse-content"),this._tabObj.model.selectedItemIndex=this._selectedItemIndex,this.model.selectedItemIndex=this._selectedItemIndex,t.removeClass("e-collapsed").addClass("e-expanded"),t.find("span").addClass("e-rarrowup-2x"),this._phoneMode||(this._ribbonResize(),this._addRibbonPin())},_addRibbonPin:function(){if(this.element.find(".e-ribbonpinicon").length<=0){this.element.find(".e-expandcollapse");var e=this.element.find(".e-rarrowup-2x");e.parent().removeClass("e-collapsed").addClass("e-expanded e-ribbonpin"),e.removeClass("e-rarrowup-2x").addClass("e-ribbonpinicon"),this._isCollapsed=!1}this._tabContents.css({position:"absolute"}).width(this.element.width()),this.element.hasClass("e-grpdivhide")&&this._tabContents.css({position:""}).width(this.element.width()),this.element.hasClass("e-grpdivhide")&&this.element.find(".e-ribbonpin").length>0&&this.model.showQAT&&this._qAccessBar.hasClass("e-rbnbelow")&&this.element.find(".e-rbnquickaccessbar").css({position:"absolute"})},_removeRibbonPin:function(){var e=this.element.find("#"+this._id+"_togglebutton");this._tabContents.css({position:"",width:""}),e.removeClass("e-ribbonpin"),e.find("span").removeClass("e-ribbonpinicon").addClass("e-rarrowup-2x")},_onRbnPinDivClick:function(){this._removeRibbonPin()},_onGroupExpandClick:function(e){this._trigger("groupExpand",e)},_onBackStageItemClick:function(i){var r,l,n,s,o,a,d,h;this._phoneMode&&this.element.find(".e-responsivebackstagecontent .e-backstageTitle").text(e(i.currentTarget).text()),o=this.element.find(i.data.contentDivId),i.preventDefault(),e(i.target).hasClass("e-backstagebutton")&&(this.element.find(".e-ribbonbackstagepage").hide(),this._phoneMode&&this.element.find(".e-responsivebackstage").is(":visible")&&this.element.find(".e-responsivebackstage").removeClass("e-backstageshowanimate")),this.element.find(".e-backstageactive-content").removeClass("e-backstageactive-content").hide(),this.element.find(".e-backstageactive").removeClass("e-backstageactive"),this.model.enableOnDemand&&0==o.children().length&&(d=(a=this.model.applicationTab.backstageSettings).pages.length,this.model.enableOnDemand&&d>0&&(h=e(i.currentTarget).index()-e(i.currentTarget).prevAll(".e-backstageseparator").length,o.append(e("#"+a.pages[h].contentID).addClass("e-backstagetabarea").show()))),this.element.find(i.data.contentDivId).addClass("e-backstageactive-content").show(),e(i.target).hasClass("e-backstageli")?e(i.target).addClass("e-backstageactive"):e(i.target).parents(".e-backstageli").addClass("e-backstageactive"),r=this.element.find(".e-ribbonbackstagetop").height(),this.element.find(".e-backstagescrollcontent").ejScroller({height:0}),s=this.model.applicationTab.backstageSettings.height,l=t.isNullOrUndefined(e(i.target).text())?e(i.target).children("a").text():e(i.target).text(),n={id:t.isNullOrUndefined(e(i.target).attr("id"))?e(i.target).parent().attr("id"):e(i.target).attr("id"),text:l,target:i.target,type:"backstageItemClick",cancel:!1},!this.element.find(i.data.contentDivId).children().hasClass("e-backstagetitlecontent")&&this.model.enableOnDemand?t.buildTag("div#"+this._id+"_BackStageTitleContent").addClass("e-backstagetitlecontent").text(l).prependTo(o):this.model.enableOnDemand&&this.element.find(".e-backstagetitlecontent").text("").append(l),this._backStageHeightCalculate(s,r),e(i.target).parents(".e-backstageheader").length>0&&(e(i.target).find("a").length>0||"a"==i.target.localName)&&this._phoneMode&&(this.element.find(".e-responsivebackstagecontent").show(),this.element.find(".e-responsivebackstage").removeClass("e-backstageshowanimate")),this._trigger("backstageItemClick",n)},_onBackStageTopIcon:function(){this.hideBackstage()},_backStageHeightCalculate:function(i,r){var l=this.model.applicationTab.backstageSettings.width;t.isNullOrUndefined(i)||(i.toString().endsWith("%")?i=this.element.find(".e-ribbonbackstagepage").height():i.toString().endsWith("px")&&(i=parseInt(i,10)),"100%"!=this.model.applicationTab.backstageSettings.height&&(this.element.find(".e-backstageactive-content").height()>i-r?(this.element.find(".e-ribbonbackstagepage").height(i).width(l),this.element.find(".e-backstagescrollcontent").ejScroller({height:i-r,scroll:e.proxy(this._scroll,this)})):t.isNullOrUndefined(i)&&this.element.find(".e-backstageactive-content").height()>this.element.height()-r&&this.element.find(".e-backstagescrollcontent").ejScroller({height:this.element.height()-r,scroll:e.proxy(this._scroll,this)}))),t.isNullOrUndefined(l)||(l.toString().endsWith("%")?l=this.element.find(".e-ribbonbackstagepage").width():l.toString().endsWith("px")&&(i=parseInt(l,10)),"100%"!=this.model.applicationTab.backstageSettings.width&&(this.element.find(".e-backstageactive-content").width()>l-this.element.find(".e-backstageheader").width()?(this.element.find(".e-ribbonbackstagepage").height(i).width(l),this.element.find(".e-backstagescrollcontent").ejScroller({width:l})):t.isNullOrUndefined(l)&&this.element.find(".e-backstageactive-content").width()>this.element.width()&&this.element.find(".e-backstagescrollcontent").ejScroller({width:this.element.width()}))),this._refreshBackstageScroller()},_refreshBackstageScroller:function(){var i=this;this.element.find(".e-backstagescrollcontent").find(".e-content").scroll(t.proxy(function(t){i.model.enableRTL?i.element.find(".e-backstagetopcontent").css({position:"relative",left:0}):i.element.find(".e-backstagetopcontent").css({position:"relative",left:-e(t.currentTarget).scrollLeft()}),i.element.find(".e-backstagetopicon").css({left:e(t.currentTarget).scrollLeft()+26})}))},_onApplicationTabClick:function(e){e.preventDefault();var t=this.element.find(".e-backstagecontent");this.model.enableOnDemand&&0==t.length&&this._createApplicationTab(),t=this.element.find(".e-backstagecontent"),this.showBackstage()},showBackstage:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f=this.element.find(".e-backstagecontent");if(this.model.enableOnDemand&&0==f.length&&this._createApplicationTab(),h=this.element.find(".e-ribbonbackstagebody"),c=this.element.find(".e-backstageheader"),n=this.model.applicationTab.backstageSettings.height,s=this.model.applicationTab.backstageSettings.width,this.model.applicationTab.type===t.Ribbon.ApplicationTabType.Backstage){t.isNullOrUndefined(n)?(this.element.find(".e-ribbonbackstagepage").height(this.element.height()).width(this.element.width()),h.height(this.element.height()-92),c.height(this.element.height()-92)):(h.height(n-92),c.height(n-92)),t.isNullOrUndefined(s)?(this.element.find(".e-ribbonbackstagepage").height(this.element.height()).width(this.element.width()),h.width(this.element.width())):h.width(s),this.element.css({position:"relative"}),this.element.find(".e-ribbonbackstagepage").show(),i=this.element.find(".e-backstageheader").width(),this.element.find(".e-backstagetopcontent").width(i),this.element.find(".e-backstageheader").width(i),(d=this.element.find(".e-backstageli")).width(d.width()),l=this.element.find(".e-ribbonbackstagetop").height(),this.element.find(".e-backstageactive-content").removeClass("e-backstageactive-content").hide(),this.element.find(".e-backstageactive").removeClass("e-backstageactive"),d.first().addClass("e-backstageactive"),this.element.find(".e-backstagecontent").first().addClass("e-backstageactive-content").show(),this.element.find(".e-backstagescrollcontent").ejScroller({height:0,width:0}),o=this.element.find(".e-backstageli").first(),a=t.isNullOrUndefined(e(o).text())?e(o).children("a").text():e(o).text();var b=this.model.applicationTab.backstageSettings,C=b.pages.length;f=this.element.find(".e-backstagecontent");this._phoneMode||this.model.enableOnDemand&&C>0&&!t.isNullOrUndefined(b.pages[0].text)&&(u=e(".e-backstageactive-content").index()-1,g=e(f).filter(".e-backstageactive-content"),-1!=u&&e(g).append(e("#"+b.pages[u].contentID).addClass("e-backstagetabarea").show()),e(g).children().hasClass("e-backstagetitlecontent")||e(g).prepend(t.buildTag("div#"+this._id+"_BackStageTitleContent").addClass("e-backstagetitlecontent"))),this._backStageHeightCalculate(n,l),f=this.element.find(".e-backstagecontent"),m=(p=this.element.find(".e-responsivebackstage").removeClass("e-reshide")).find(".e-backstageheader"),this._phoneMode&&(this.element.find(".e-responsivetabheader").is(":visible")&&this.element.find(".e-responsivetabheader").removeClass("e-resshow"),p.children().length>0&&(_=parseInt(m.css("top")),this.element.parent(".e-js").length>0&&document.documentElement.clientHeight-p.find(".e-backstageheader").offset().top>this.element.parent(".e-js").height()?m.css({width:this.element.find(".e-header").outerWidth()/2,height:this.element.parent().height()}):m.css({width:this.element.find(".e-header").outerWidth()/2,height:document.documentElement.clientHeight-p.find(".e-backstageheader").offset().top}),m.offset().top!=_&&m.height(m.height()-_)),p.addClass("e-backstageshowanimate"),this.element.find(".e-backstageactive").removeClass("e-backstageactive")),r={id:e(o).attr("id"),text:a,target:e(o).children(),type:"backstageItemClick",cancel:!1},this.model.enableOnDemand&&this.element.find(".e-backstagetitlecontent").text("").append(a),this._trigger("backstageItemClick",r)}},hideBackstage:function(){this.element.find(".e-ribbonbackstagepage").hide(),this._phoneMode&&this.goToMainContent()},_initPrivateProperties:function(){this._initialRender=!1,this._tabUl=this.element.find(".e-header"),this._applicationTab=this.element.find(".e-apptab"),this._ribbonTabs=this._tabUl.find(":not('a')"),this._tabText=this.element.find(".e-link"),this._id=this.element.attr("id"),this._tabObj=this.element.data("ejTab"),this._isCollapsed=!1,this._contextualTabSet="",this._resizeWidth=0,this._selectedItemIndex=0,this._clickValue=null,this._tabContents=this.element.children().attr("role","tablist").not(".e-header,.e-disable,.e-resizediv,.e-tooltipdiv,.e-ribbonbackstagepage"),this._qatControlsName=[],this._qAccessBar=this.element.find(".e-rbnquickaccessbar"),this._rbnToggleBtnAction=!0,this.localizedLabels=this._getLocalizedLabels(),this._phoneMode=!!((this.model.allowResizing||this.model.isResponsive)&&document.documentElement.clientWidth<420),this._responsiveTarget=null,this._responsiveContent=null,this._responsiveContentStyle=null,this._responsiveGallery=null,this._mobileToolbar=[],this._mobileContents=[],this._responsiveTabText=null,this._responsiveHeight=document.documentElement.clientHeight*(parseInt("40%")/100),this._QATclick=!1},_getLocalizedLabels:function(){return t.getLocalizedConstants(this.sfType,this.model.locale)},_customization:function(){var i,r,l={},n=this;this._initial&&(this.model.contextualTabs.length>0&&this.model.contextualTabs[0].tabs.length>0&&this._contextualTabs(),i="<div id="+this._id+'_togglebutton class="e-expanded"><span class="e-icon e-rarrowup-2x"></span></div>',r=t.buildTag("li#"+this._id+"_expandCollapse.e-expandcollapse",i),this.element.find(".e-active-content").eq(0).append(r),l.expandObj=this.model.expandPinSettings,l.collapseObj=this.model.collapsePinSettings,r.mouseover({value:l,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this))),this.model.enableOnDemand?this._createAppTabOnDemand():this._createApplicationTab(),this.element.find(".e-content.e-content-item").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){n.element.hasClass("e-responsive")&&(n.element.find(".e-ribupdivarrow .e-icon").hasClass("e-ribuparrow")?n._ribExpand(this):n.element.find(".e-ribupdivarrow .e-icon").hasClass("e-ribdownarrow")&&n._ribCollapse(this))})},_createAppTabOnDemand:function(){var i;this.model.applicationTab.type===t.Ribbon.ApplicationTabType.Menu?(this._applicationTab.find(".e-link").hide(),this.model.applicationTab.menuSettings&&(i=this.model.applicationTab.menuSettings),this.model.applicationTab.menuItemID&&(e("#"+this.model.applicationTab.menuItemID).appendTo(this._applicationTab),i.enableRTL=this.model.enableRTL,i.isResponsive=!1,e("#"+this.model.applicationTab.menuItemID).addClass("e-rbncustomelement").ejMenu(i)),e("#"+this._id+"_"+this.model.applicationTab.type.replace(/\s/g,"")).hide()):this._applicationTab.find(".e-link").text(this.model.applicationTab.backstageSettings.text),this._applicationTab.click(e.proxy(this._onApplicationTabClick,this)),this.model.applicationTab.type===t.Ribbon.ApplicationTabType.Backstage&&this._applicationTab.find("a").addClass("e-apptabanchor")},_createApplicationTab:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I=this.element.find(".e-ribbonbackstagepage"),y=this.element.find(".e-backstageheader"),T=this.element.find(".e-ribbonbackstagebody"),L=this.element.find(".e-backstagetopcontent");if(a=(o=this.model.applicationTab.backstageSettings).pages.length,this.model.applicationTab.type!==t.Ribbon.ApplicationTabType.Menu||this.model.enableOnDemand?(t.isNullOrUndefined(this.model.applicationTab.menuItemID)||((h=e("#"+this.model.applicationTab.menuItemID).data("ejMenu"))&&h._destroy(),e("#"+this.model.applicationTab.menuItemID).appendTo("body"),this.model.applicationTab.menuItemID=null,this.model.applicationTab.menuSettings={},this._applicationTab.find(".e-link").css("display","block")),this._applicationTab.find(".e-link").text(this.model.applicationTab.backstageSettings.text)):(this._applicationTab.find(".e-link").hide(),this.element.find(".e-backstagetabarea").appendTo("body").removeClass("e-backstagetabarea"),I.remove(),this.model.applicationTab.menuSettings&&(d=this.model.applicationTab.menuSettings),this.model.applicationTab.menuItemID&&(e("#"+this.model.applicationTab.menuItemID).appendTo(this._applicationTab),d.enableRTL=this.model.enableRTL,d.isResponsive=!1,e("#"+this.model.applicationTab.menuItemID).addClass("e-rbncustomelement").ejMenu(d)),e("#"+this._id+"_"+this.model.applicationTab.type.replace(/\s/g,"")).hide()),this._applicationTab.click(e.proxy(this._onApplicationTabClick,this)),this.element.find(".e-content.e-content-item").css("box-sizing","content-box"),this.model.applicationTab.type===t.Ribbon.ApplicationTabType.Backstage){for((c=this.model.applicationTab.backstageSettings.height).toString().endsWith("%")?c=e(document).height()*(parseInt(c.slice(0,-1),10)/100):c.toString().endsWith("px")&&(c=parseInt(c,10)),0==I.length&&(I=t.buildTag("div#"+this._id+"_BackStage").addClass("e-ribbonbackstagepage"),T=t.buildTag("div#"+this._id+"_BackStageBody").addClass("e-ribbonbackstagebody"),y=t.buildTag("ul#"+this._id+"_BackStageHeader").addClass("e-backstageheader")),I.height(c).width(this.model.applicationTab.backstageSettings.width).hide(),T.height(c-50),y.height(c-50),S=0;S<a;S++)u=this.element.find("#"+o.pages[S].id+"_backStageTab"),g=this.element.find("#"+o.pages[S].id+"_backStageBtn"),t.isNullOrUndefined(o.pages[S].itemType)&&(o.pages[S].itemType=t.Ribbon.ItemType.Tab),o.pages[S].itemType==t.Ribbon.ItemType.Button&&(u=this.element.find("#"+o.pages[S].id+"_backStageBtn"),g=this.element.find("#"+o.pages[S].id+"_backStageTab")),0==this.element.find(".e-ribbonbackstagepage").length||0==u.length&&0==g.length?(i=t.buildTag("li").addClass("e-backstageli").attr("tabindex",0).click({contentDivId:"#"+this._id+"_BackStage_"+o.pages[S].id.replace(/\s/g,""),height:o.height},e.proxy(this._onBackStageItemClick,this)),o.pages[S].itemType==t.Ribbon.ItemType.Tab?(r=t.buildTag("a",o.pages[S].text,{},{href:"#"+this._id+"_BackStage_"+o.pages[S].id.replace(/\s/g,"")}).focus(function(){e(this).parents(".e-backstageli").addClass("e-bsmaterial-focus")}).focusout(function(){e(this).parents(".e-backstageli").removeClass("e-bsmaterial-focus")}),i.append(r).attr("id",o.pages[S].id+"_backStageTab")):i.append(o.pages[S].text).addClass("e-backstagebutton").attr("id",o.pages[S].id+"_backStageBtn"),y.append(i),o.pages[S].enableSeparator&&(s=t.buildTag("li").addClass("e-backstageseparator"),y.append(s)),o.pages[S].itemType==t.Ribbon.ItemType.Tab&&this._addBackStageTabCont(o,T,S)):(p=g,u.length>0&&(p=u),o.pages[S].itemType==t.Ribbon.ItemType.Button?(p.find("a").length>0&&(this._removeBackStageTabCont(this.element.find(p.find("a").attr("href"))),p.attr("id",o.pages[S].id+"_backStageBtn").addClass("e-backstagebutton"),p.find("a").remove()),p.text(o.pages[S].text)):(p.hasClass("e-backstagebutton")&&(r=t.buildTag("a",o.pages[S].text,{},{href:"#"+this._id+"_BackStage_"+o.pages[S].id.replace(/\s/g,"")}).focus(function(){e(this).parents(".e-backstageli").addClass("e-bsmaterial-focus")}).focusout(function(){e(this).parents(".e-backstageli").removeClass("e-bsmaterial-focus")}),p.append(r).attr("id",o.pages[S].id+"_backStageTab").removeClass("e-backstagebutton"),this._addBackStageTabCont(o,T,S)),p.find("a").text(o.pages[S].text),m=this.element.find(p.find("a").attr("href")),o.pages[S].contentID!=m.find(".e-backstagetabarea").attr("id")&&(m.find(".e-backstagetabarea").removeClass("e-backstagetabarea").appendTo("body"),m.append(e("#"+o.pages[S].contentID).addClass("e-backstagetabarea")))),o.pages[S].enableSeparator?p.next().length>0&&!p.next().hasClass("e-backstageseparator")&&(s=t.buildTag("li").addClass("e-backstageseparator"),p.after(s)):p.next().length>0&&p.next().hasClass("e-backstageseparator")&&p.next().remove());if(0==this.element.find(".e-ribbonbackstagepage").length)T.prepend(y),n=t.buildTag("div#"+this._id+"_BackStageTop").addClass("e-ribbonbackstagetop").height(92),L=t.buildTag("div#"+this._id+"_BackStageTopContent").addClass("e-backstagetopcontent").appendTo(n),t.buildTag("div#"+this._id+"_BackStageTopIcon","<div class='e-ribbonbackicon'><span></span></div>").addClass("e-backstagetopicon").click(e.proxy(this._onBackStageTopIcon,this)).appendTo(L),I.append(n),(l=t.buildTag("div#"+this._id+"_backStageScrollContent","<div></div>").addClass("e-backstagescrollcontent")).children().append(T),I.append(l),this._applicationTab.addClass("e-backstagetab"),this._applicationTab.find("a").addClass("e-apptabanchor"),this.element.find(".e-ribbonbackstagepage").length>0&&this.element.find(".e-ribbonbackstagepage").remove(),this.element.append(I),_=this.element.find(".e-responsivebackstagecontent .e-resbackstagecontent"),I.find(".e-ribbonbackstagebody .e-backstagecontent").length>0&&this._phoneMode&&(_.children().remove(),_.append(I.find(".e-ribbonbackstagebody .e-backstagecontent")));else{for(f=[],S=0;S<this.model.applicationTab.backstageSettings.pages.length;S++)f.push(this.model.applicationTab.backstageSettings.pages[S].id);for(S=0;S<this.element.find(".e-backstageli").length;S++)C=(b=this.element.find(".e-backstageli").eq(S)).attr("id").split("_")[0],e.inArray(C,f)<0&&(b.find("a").length>0&&this._removeBackStageTabCont(this.element.find(b.find("a").attr("href"))),b.next().length>0&&b.next().hasClass("e-backstageseparator")&&b.next().remove(),b.remove(),--S);for(S=0;S<o.pages.length;S++)this._checkBackstageTabOrder(o.pages[S],S)}t.isNullOrUndefined(o.headerWidth)||(L.css("width",o.headerWidth),y.css("width",o.headerWidth))}this.model.enableOnDemand&&this._phoneMode&&(x=this.element.find(".e-responsivebackstage"),v=this.element.find(".e-ribbonbackstagepage"),this._tabUl.find(".e-backstagetab").length>0&&1==x.length&&(w=v.find(".e-ribbonbackstagebody .e-backstageheader"),x.append(w).addClass("e-reshide")))},_addBackStageTabCont:function(i,r,l){var n,s=t.buildTag("div#"+this._id+"_BackStage_"+i.pages[l].id.replace(/\s/g,"")).addClass("e-backstagecontent").css({width:"auto"});l>0&&s.hide(),i.pages[l].contentID&&!this.model.enableOnDemand&&(n=t.buildTag("div#"+this._id+"_BackStageTitleContent").addClass("e-backstagetitlecontent").appendTo(e(s)),e(n).text("").append(i.pages[l].text),e(s).append(e("#"+i.pages[l].contentID).addClass("e-backstagetabarea").show())),r.append(s)},_removeBackStageTabCont:function(e){e.find(".e-backstagetabarea").removeClass("e-backstagetabarea").appendTo("body"),e.remove()},_conTabsRemove:function(){for(var t,i=this.element.find(".e-contextli,.e-contextliset"),r=i.length,l=0;l<r;l++)(t=e(i[l])).is(":visible")?t.find("li").insertAfter(t.eq(0)):t.find("li").hide().insertAfter(t.eq(0)),t.remove()},_contextualTabs:function(){var i,r,l,n,s,o,a;if(this.model.contextualTabs)for(n=this.model.contextualTabs.length,s=0;s<n;s++)if((i=this.model.contextualTabs[s]).tabs.length>0){for(r=t.buildTag("li#e-contextlisetIn_"+s).addClass("e-contextliset"),this._contextualTabSet=this._tabUl.children(".e-contextualtabset").filter(function(){return e(this).text()===i.tabs[0].text}),this._contextualTabSet.before(r),this._tabUl.children(".e-contextualtabset").find("a").css("color",i.borderColor),l=t.buildTag("ul.e-contextual","",{background:i.backgroundColor,"border-top-color":i.borderColor}),o=i.tabs.length,a=0;a<o;a++)l.append(this._tabUl.children(".e-contextualtabset").filter(function(){return e(this).text()===i.tabs[a].text}));l.appendTo(r)}},addBackStageItem:function(e,i){var r,l=this.model.applicationTab.backstageSettings.pages.length;t.isNullOrUndefined(i)||(l=i),this.model.applicationTab.backstageSettings.pages.splice(l,0,e),this._initial=!1,this._customization(),this._phoneMode&&((r=this.element.find(".e-ribbonbackstagepage")).find(".e-ribbonbackstagebody .e-backstagecontent").length>0&&this.element.find(".e-responsivebackstagecontent .e-resbackstagecontent").append(r.find(".e-ribbonbackstagebody .e-backstagecontent")))},_checkBackstageTabOrder:function(e,t){var i,r=this.element.find("#"+e.id+"_backStageTab");0==r.length&&(r=this.element.find("#"+e.id+"_backStageBtn")),r.index()!=t&&(i=this.element.find(".e-backstageli").eq(t),e.enableSeparator&&r.next().hasClass("e-backstageseparator")&&(i=r.next().insertBefore(i)),r.insertBefore(i),this.element.find("#"+this._id+"_BackStage_"+e.id).insertBefore(this.element.find(".e-backstagecontent").eq(t)))},removeBackStageItem:function(t){var i,r;i=this.model.applicationTab.backstageSettings.pages[t].id,r="#"+this._id+"_BackStage_"+i,this.model.applicationTab.backstageSettings.pages.splice(t,1),this.element.find(r).hasClass("e-backstagecontent")&&this.element.find(r).remove(),e(this.element.find(".e-backstageli")[t]).remove(),this.hideBackstage()},updateBackStageItem:function(t,i){if(e.extend(this.model.applicationTab.backstageSettings.pages[t],i),this._initial=!1,this._customization(),this._phoneMode){var r=this.element.find(".e-ribbonbackstagepage");r.find(".e-ribbonbackstagebody .e-backstagecontent").length>0&&this.element.find(".e-responsivebackstagecontent .e-resbackstagecontent").append(r.find(".e-ribbonbackstagebody .e-backstagecontent"))}},showContextualTab:function(t){this.element.find(".e-contexttitle").filter(function(){return e(this).text()===t}).parent().parent().show()},hideContextualTab:function(t){this.element.find(".e-contexttitle").filter(function(){return e(this).text()===t}).parent().parent().hide(),this._tabObj.option({selectedItemIndex:this._tabObj.model.selectedItemIndex+1})},_createQAT:function(){if(this.model.showQAT&&(!t.isNullOrUndefined(this.model.qatItems)||0==this.element.find(".e-rbnquickaccessbar").children().length)){if(this.model.enableOnDemand&&(t.isNullOrUndefined(this.model.tabs)||this._createCollapseQuickaccess(this.model.tabs),!t.isNullOrUndefined(this.model.contextualTabs)))for(var e=0;e<this.model.contextualTabs.length;e++)this._createCollapseQuickaccess(this.model.contextualTabs[e].tabs);this.model.showQAT&&!t.isNullOrUndefined(this.model.qatItems)&&this._createCollapseQuickaccess()}this._createQuickAccessBar()},_createCollapseQuickaccess:function(e){var i,r,l,n,s;if(t.isNullOrUndefined(e)||t.isNullOrUndefined(this.model.qatItems)&&0!=this.element.find(".e-rbnquickaccessbar").children().length)this._createqatItems(this.model.qatItems);else for(i=0;i<e.length;i++)if(!t.isNullOrUndefined(e[i].groups))for(r=0;r<e[i].groups.length;r++)if(!t.isNullOrUndefined(e[i].groups[r].content))for(l=0;l<e[i].groups[r].content.length;l++)n=e[i].groups[r].content[l].groups,s=e[i].groups[r].content[l].defaults,e[i].groups[r].content[l].defaults,this._createqatItems(n,s)},_createqatItems:function(i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_,f;for(this.model.showQAT&&(!t.isNullOrUndefined(this.model.qatItems)||0==this.element.find(".e-rbnquickaccessbar").children().length)&&(l=t.buildTag("div#"+this._id+"order")),n=[],s=0;s<i.length;s++)if(!t.isNullOrUndefined(i[s]))switch(t.isNullOrUndefined(r)||t.isNullOrUndefined(r.type)||(i[s].type=r.type),t.isNullOrUndefined(i[s].type)&&(i[s].type=t.Ribbon.Type.Button),t.isNullOrUndefined(i[s].isBig)&&!t.isNullOrUndefined(r)&&(i[s].isBig=r.isBig),o=this.model.buttonDefaults,t.isNullOrUndefined(i[s].height)&&(t.isNullOrUndefined(i[s].buttonSettings)||t.isNullOrUndefined(i[s].buttonSettings.height)?t.isNullOrUndefined(r)||t.isNullOrUndefined(r.height)?t.isNullOrUndefined(o)||t.isNullOrUndefined(o.height)||(a=o.height):a=r.height:a=i[s].buttonSettings.height,i[s].height=a,a=null),t.isNullOrUndefined(i[s].width)&&(t.isNullOrUndefined(i[s].buttonSettings)||t.isNullOrUndefined(i[s].buttonSettings.width)?t.isNullOrUndefined(r)||t.isNullOrUndefined(r.width)?t.isNullOrUndefined(o)||t.isNullOrUndefined(o.width)||(d=o.width):d=r.width:d=i[s].buttonSettings.width,i[s].width=d,d=null),t.isNullOrUndefined(i[s].buttonSettings)||(h=i[s].buttonSettings,!t.isNullOrUndefined(h.enabled)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.enabled)||(h.enabled=o.enabled),!t.isNullOrUndefined(h.enableRTL)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.enableRTL)||(h.enableRTL=o.enableRTL),!t.isNullOrUndefined(h.cssClass)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.cssClass)||(h.cssClass=o.cssClass),!t.isNullOrUndefined(h.showRoundedCorner)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.showRoundedCorner)||(h.showRoundedCorner=o.showRoundedCorner)),t.isNullOrUndefined(i[s].splitButtonSettings)||(c=i[s].splitButtonSettings,!t.isNullOrUndefined(c.enabled)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.enabled)||(c.enabled=o.enabled),!t.isNullOrUndefined(c.enableRTL)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.enableRTL)||(c.enableRTL=o.enableRTL),!t.isNullOrUndefined(c.cssClass)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.cssClass)||(c.cssClass=o.cssClass),!t.isNullOrUndefined(c.showRoundedCorner)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.showRoundedCorner)||(c.showRoundedCorner=o.showRoundedCorner)),t.isNullOrUndefined(i[s].toggleButtonSettings)||(!t.isNullOrUndefined(i[s].toggleButtonSettings.enabled)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.enabled)||(i[s].toggleButtonSettings.enabled=o.enabled),!t.isNullOrUndefined(i[s].toggleButtonSettings.enableRTL)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.enableRTL)||(i[s].toggleButtonSettings.enableRTL=o.enableRTL),!t.isNullOrUndefined(i[s].toggleButtonSettings.cssClass)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.cssClass)||(i[s].toggleButtonSettings.cssClass=o.cssClass),!t.isNullOrUndefined(i[s].toggleButtonSettings.showRoundedCorner)||t.isNullOrUndefined(o)||t.isNullOrUndefined(o.showRoundedCorner)||(i[s].toggleButtonSettings.showRoundedCorner=o.showRoundedCorner)),t.isNullOrUndefined(i[s].quickAccessMode)&&(i[s].quickAccessMode="none"),i[s].type){case t.Ribbon.Type.SplitButton:m={},(u=i[s]).splitButtonSettings&&(m=JSON.parse(JSON.stringify(u.splitButtonSettings))),m.height=t.isNullOrUndefined(m.height)?i[s].height:m.height,m.width=t.isNullOrUndefined(m.width)?i[s].width:m.width,m.cssClass=m.cssClass?m.cssClass.concat(" e-rbn-splitbtn e-rbn-button"):"e-rbn-splitbtn e-rbn-button",m.enableRTL=this.model.enableRTL,"none"!=u.quickAccessMode&&this.model.showQAT&&(this._splitButtonQAT=t.buildTag("button#"+this._id+"_"+u.id+"_qatEle",u.text,{},{type:"button"}).addClass(u.cssClass),_=t.buildTag("div#"+this._id+"_"+u.id+"_qatDiv",this._splitButtonQAT).addClass("e-qatooldiv"),l.append(_),m.height=30,m.arrowPosition=t.ArrowPosition.Right,m.contentType=t.ContentType.ImageOnly,e.isEmptyObject(u.customToolTip)?t.isNullOrUndefined(u.toolTip)||_.attr("title",u.toolTip):_.mouseover({value:u,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),this._splitButtonQAT.ejSplitButton(m),"menu"==u.quickAccessMode&&_.hide(),t.isNullOrUndefined(u.text)?t.isNullOrUndefined(u.splitButtonSettings.text)||(f=u.splitButtonSettings.text):f=u.text,n.push({id:u.id,text:f,qAccess:u.quickAccessMode}));break;case t.Ribbon.Type.ToggleButton:m={},(g=i[s]).toggleButtonSettings&&(m=JSON.parse(JSON.stringify(g.toggleButtonSettings))),m.height=t.isNullOrUndefined(m.height)?i[s].height:m.height,m.width=t.isNullOrUndefined(m.width)?i[s].width:m.width,"none"!=g.quickAccessMode&&this.model.showQAT&&(this._toggleButtonQAT=t.buildTag("input#"+this._id+"_"+g.id+"_qatEle","","",{type:"checkbox"}).addClass(g.cssClass),_=t.buildTag("div#"+this._id+"_"+g.id+"_qatDiv",this._toggleButtonQAT).addClass("e-qatooldiv e-rbn-button"),m.height=30,m.contentType=t.ContentType.ImageOnly,e.isEmptyObject(g.customToolTip)?t.isNullOrUndefined(g.toolTip)||_.attr("title",g.toolTip):_.mouseover({value:g,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),this._toggleButtonQAT.ejToggleButton(m).addClass("e-ribbonbtn"),_.find("button").addClass("e-rbn-button"),l.append(_),"menu"==g.quickAccessMode&&_.hide(),t.isNullOrUndefined(g.text)?t.isNullOrUndefined(g.toggleButtonSettings.defaultText)||(f=g.toggleButtonSettings.defaultText):f=g.text,n.push({id:g.id,text:f,qAccess:g.quickAccessMode}));break;case t.Ribbon.Type.Button:m={},(p=i[s]).buttonSettings&&(m=JSON.parse(JSON.stringify(p.buttonSettings))),m.height=t.isNullOrUndefined(m.height)?i[s].height:m.height,m.width=t.isNullOrUndefined(m.width)?i[s].width:m.width,"none"!=p.quickAccessMode&&this.model.showQAT&&(this._buttonQAT=p.buttonSettings&&p.buttonSettings.type?t.buildTag("button#"+this._id+"_"+p.id+"_qatEle",p.text,{},{type:p.buttonSettings.type}).addClass(p.cssClass):t.buildTag("button#"+this._id+"_"+p.id+"_qatEle",p.text).addClass(p.cssClass),_=t.buildTag("div#"+this._id+"_"+p.id+"_qatDiv",this._buttonQAT).addClass("e-qatooldiv"),m.height=30,m.contentType=t.ContentType.ImageOnly,e.isEmptyObject(p.customToolTip)?t.isNullOrUndefined(p.toolTip)||_.attr("title",p.toolTip):_.mouseover({value:p,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),this._buttonQAT.ejButton(m).addClass("e-ribbonbtn e-rbn-button"),l.append(_),"menu"==p.quickAccessMode&&_.hide(),t.isNullOrUndefined(p.text)?t.isNullOrUndefined(p.buttonSettings.text)||(f=p.buttonSettings.text):f=p.text,n.push({id:p.id,text:f,qAccess:p.quickAccessMode}))}l.children().prependTo(this._qAccessBar),this._qatControlsName=e.merge(n,this._qatControlsName)},_resizeTabName:function(i){var r,l;if(!t.isNullOrUndefined(this.model.tabs))for(r=0;r<this.model.tabs.length;r++)if(this.model.tabs[r].text===i)return e(this._tabUl.find(".e-tab")[r]);if(!t.isNullOrUndefined(this.model.contextualTabs))for(r=0;r<this.model.contextualTabs.length;r++)for(l=0;l<this.model.contextualTabs[r].tabs.length;l++)if(this.model.contextualTabs[r].tabs[l].text===i)return e(this._tabUl.find(".e-contextliset")[r]).children().find(".e-contextualtabset").eq(l)},hideTab:function(i){var r,l,n,s,o,a,d=this._tabText.map(function(t){if(e(this).text()===i)return t})[0],h=this._tabObj.model.disabledItemIndex.length,c=!0;for(this._width=this.element.width(),t.isNullOrUndefined(d)&&(n=this._resizeTabName(i),this._phoneMode&&(n=this._responsiveTabText.filter(function(){return e(this).text()===i}),this.element.find(".e-responsivetabheader").addClass("e-resshow")),t.isNullOrUndefined(n)||n.hide()),s=this.element.find(".e-link").eq(d).attr("href"),l=this._tabText.filter(function(){return e(this).text()===i}).parents(".e-contextualtabset"),o=0;o<h;o++)this._tabObj.model.disabledItemIndex[o]===d&&(c=!1);c&&(l.length>0?(l.hide(),this._responsiveTabText.eq(t.isNullOrUndefined(this.model.applicationTab)?d:d-1).hide()):(this._tabText.filter(function(){return e(this).text()===i}).parent().hide(),this._responsiveTabText.eq(t.isNullOrUndefined(this.model.applicationTab)?d:d-1).hide()),e(s).hasClass("e-active-content")&&(e(s).hide(),e(s).removeClass("e-active-content"))),this._tabUl.find(".e-active").is(":hidden")&&(this._phoneMode?(this.element.find(".e-responsivetabheader").addClass("e-resshow"),r=this._getVisibleItemIndex(this._responsiveTabText)):r=this._getVisibleItemIndex(this._tabText),r&&(a=this.element.find(".e-link").eq(r).attr("href"),e(this._tabText[r]).parent().hasClass("e-disable")?(e(this._tabText[d]).parent().removeClass("e-active"),e(this._tabText[r]).parent().addClass("e-active"),e(a).append(this.element.find("#"+this._id+"_disabled")),e(a).css("position","relative"),this.element.find("#"+this._id+"_disabled").show(),e(a).show(),this._tabObj.option("selectedItemIndex",r)):this._tabObj.option("selectedItemIndex",r),this._tabObj.model.selectedItemIndex=r,this.model.selectedItemIndex=r)),this.element.hasClass("e-responsive")&&this.element.find(".e-responsivetabheader").removeClass("e-resshow")},showTab:function(i){var r,l,n,s,o=this._tabText.map(function(t){if(e(this).text()===i)return t})[0];t.isNullOrUndefined(o)&&(l=this._resizeTabName(i),this._phoneMode&&(l=this._responsiveTabText.filter(function(){return e(this).text()===i}),this.element.find(".e-responsivetabheader").addClass("e-resshow")),t.isNullOrUndefined(l)||l.show()),n=this._tabText.filter(function(){return e(this).text()===i}).parent(),(r=this._tabText.filter(function(){return e(this).text()===i}).parents(".e-contextualtabset")).length>0?(r.show(),this._responsiveTabText.eq(t.isNullOrUndefined(this.model.applicationTab)?o:o-1).show()):(this._tabText.filter(function(){return e(this).text()===i}).parent().show(),this._responsiveTabText.eq(t.isNullOrUndefined(this.model.applicationTab)?o:o-1).show()),s=this.element.find(".e-content").eq(o),n.hasClass("e-active")?"none"==s.css("display")&&s.show():n.addClass("e-select"),this.element.hasClass("e-responsive")&&this.element.find(".e-responsivetabheader").removeClass("e-resshow")},hideGroups:function(t,i){if("string"==typeof i)e("#"+this._id+"_"+t+"_"+i).hide();else for(var r=0;r<i.length;r++)e("#"+this._id+"_"+t+"_"+i[r]).hide()},showGroups:function(t,i){if("string"==typeof i)e("#"+this._id+"_"+t+"_"+i).show();else for(var r=0;r<i.length;r++)e("#"+this._id+"_"+t+"_"+i[r]).show()},hideGroupItems:function(t,i,r){if("string"==typeof r)e("#"+this._id+"_"+t+"_"+i+"_"+r).hide();else for(var l=0;l<r.length;l++)e("#"+this._id+"_"+t+"_"+i+"_"+r[l]).hide()},showGroupItems:function(t,i,r){if("string"==typeof r)e("#"+this._id+"_"+t+"_"+i+"_"+r).show();else for(var l=0;l<r.length;l++)e("#"+this._id+"_"+t+"_"+i+"_"+r[l]).show()},_getVisibleItemIndex:function(t){for(var i=1;i<t.length;){if(e(t[i]).is(":visible"))return i;i++}},removeApplicationTab:function(){var t,i,r;this._ribbonTabs=this._tabUl.find(".e-link").parent(),t=this._ribbonTabs.eq(0).children().attr("href"),(i=this._ribbonTabs.eq(0)).hasClass("e-apptab")&&(this._tabObj.contentPanels.splice(0,1),this._tabObj.items.splice(0,1),this._tabObj.selectedItemIndex(this._tabObj.model.selectedItemIndex-1),i.remove(),e(t).remove(),e(this._tabUl.find(".e-link").parent(".e-active")).find("a").addClass("e-removeapptab"),(r=this._tabUl.find("li").eq(0)).hasClass("e-disable")||r.hasClass("e-apptab")||(this._tabObj.option({enabledItemIndex:[0]}),this.model.disabledItemIndex.splice(0)),this.element.addClass("e-ribwithout-apptab"),this._ribbonWindowResize())},removeTab:function(t){var i,r,l,n,s;this._tabObj.model&&t>0&&(l={index:t},this._trigger("beforeTabRemove",l),this._ribbonTabs=this._tabUl.find(".e-link").parent(),r=this._ribbonTabs.eq(t).children().attr("href"),i=this._ribbonTabs.eq(t),this._phoneMode&&(s=this._responsiveTabText.eq(t-1)),i.hasClass("e-contextualtab")?i.parent().remove():i.hasClass("e-contextualtabset")&&0===i.siblings(".e-contextualtabset").length?i.parent().remove():i.remove(),this._phoneMode&&s.remove(),this._responsiveTabText=this.element.find(".e-responsivetabheader li"),n=this.element.find(".e-expandcollapse"),e(r).remove(),this._ribbonTabs=this._tabUl.find(".e-link").parent(),this._tabObj.model.selectedItemIndex===t&&(i=this._ribbonTabs.eq(t),this._phoneMode&&((s=this._responsiveTabText.eq(t-1)).addClass("e-resactive"),this.element.find(".e-ribresmenu .e-reslink").text(this._responsiveTabText.filter(".e-resactive").text())),i.addClass("e-active"),r=i.children().attr("href"),e(r).append(n.click(e.proxy(this._tabExpandCollapse,this))),e(r).addClass("e-active-content e-activetop").show()),this._isCollapsed&&this.element.find(this._ribbonTabs.eq(t).children().attr("href")).append(n.click(e.proxy(this._tabExpandCollapse,this))),this._tabObj.contentPanels.splice(t,1),this._tabObj.items.splice(t,1),this.model.tabs.splice(t-1,1),this._phoneMode&&(this._mobileContents.splice(t-1,1),this._mobileToolbar.splice(t-1,1),this._ribbonWindowResize()),l={removedIndex:t},this._trigger("tabRemove",l))},removeTabGroup:function(i,r){var l,n,s,o,a,d,h,c,u,g;if(l=e(e(".e-ribbon .e-content")[i]).find(".e-groupdiv"),n=this._tabUl.find(".e-select,.e-active").eq(i),e(n).hasClass("e-tab"))for(s=this.model.tabs[i-1].groups,d=0;d<s.length;d++)s[d].text==r?(s.splice(d,1),e(l[d]).remove()):t.isNullOrUndefined(r)&&e(l[d]).remove();else for(o=this.model.tabs.length,this.model.contextualTabs.length,d=0;d<this.model.contextualTabs.length;d++)for(h=this.model.contextualTabs[d].tabs.length,c=0;c<h;c++)if(++o===i)for(u=(a=this.model.contextualTabs[d].tabs[c].groups).length,g=0;g<u;g++)a[g].text==r?(a.splice(g,1),e(l[g]).remove()):t.isNullOrUndefined(r)&&e(l[g]).remove()},_addTabGrpIntoCollec:function(t,i,r){var l,n,s=i.length,o=r;for(e.isPlainObject(i)&&(s=1),l=0;l<s;l++)n=i,e.isPlainObject(i)||(n=i[l],l>0&&++o),t.groups.splice(o,0,n);return t},addTabGroup:function(i,r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=0,S=0;if(n=(o=this._tabUl.find(".e-select,.e-active").eq(i)).children("a").attr("href"),e(o).hasClass("e-tab"))for(c=this.model.tabs.length,g=0;g<c;g++)g===i-1&&(S=this.model.tabs[g].groups.length,t.isNullOrUndefined(l)&&(l=S),s=this._addTabGrpIntoCollec(this.model.tabs[g],r,l));else for(C=this.model.tabs.length,u=this.model.contextualTabs.length,g=0;g<u;g++)for(p=this.model.contextualTabs[g].tabs.length,m=0;m<p;m++)++C===i&&(S=this.model.contextualTabs[g].tabs[m].groups.length,t.isNullOrUndefined(l)&&(l=S),s=this._addTabGrpIntoCollec(this.model.contextualTabs[g].tabs[m],r,l));if(!t.isNullOrUndefined(s.groups[l])&&!this.element.find(".e-content.e-content-item").eq(i).hasClass("e-rbn-ondemand")){for(_=r.length,f=l,e.isPlainObject(r)&&(_=1),b=0;b<_;b++)!e.isPlainObject(r)&&b>0&&++f,a=t.isNullOrUndefined(s.groups[f].id)?t.isNullOrUndefined(s.groups[f].text)?s.groups[f].text:s.groups[f].text.replace(/\s/g,""):s.groups[f].id.replace(/\s/g,""),d=this._createControls(f,s,a,i),h=this._addControlsToGroup(f,s,a,d),e(n).children().eq(f).length>0?e(n).children().eq(f).before(h):e(n).append(h);e(n).hasClass("e-empty-content")&&e(n).removeClass("e-empty-content")}e(n).hasClass("e-parentdiv")||e(n).addClass("e-parentdiv"),this._setTabContentHeight()},addTabGroupContent:function(i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y=0,T=!1;if(o=(d=this._tabUl.find(".e-select,.e-active").eq(i)).children("a").attr("href"),t.isNullOrUndefined(n)&&(n=0),t.isNullOrUndefined(s)&&(s=0),d.hasClass("e-tab"))for(C=this.model.tabs.length,x=0;x<C;x++)x===i-1&&(t.isNullOrUndefined(this.model.tabs[x].groups[r].content)||(f=this.model.tabs[x].groups[r].alignType,0!=n&&t.isNullOrUndefined(this.model.tabs[x].groups[r].content[n-1])||(t.isNullOrUndefined(this.model.tabs[x].groups[r].content[n])?(this.model.tabs[x].groups[r].content[n]=l,T=!0):this.model.tabs[x].groups[r].content[n].groups.splice(s,0,l),a=this.model.tabs[x])));else for(y=this.model.tabs.length,S=this.model.contextualTabs.length,x=0;x<S;x++)for(v=this.model.contextualTabs[x].tabs.length,w=0;w<v;w++)++y===i&&(t.isNullOrUndefined(this.model.contextualTabs[x].tabs[w].groups[r].content)||(f=this.model.contextualTabs[x].tabs[w].groups[r].alignType,t.isNullOrUndefined(n)&&(n=this.model.contextualTabs[x].tabs[w].groups[r].content[0].groups.length),0!=n&&t.isNullOrUndefined(this.model.contextualTabs[x].tabs[w].groups[r].content[n-1])||(t.isNullOrUndefined(this.model.contextualTabs[x].tabs[w].groups[r].content[n])?(this.model.contextualTabs[x].tabs[w].groups[r].content[n]=l,T=!0):this.model.contextualTabs[x].tabs[w].groups[r].content[n].groups.splice(s,0,l),a=this.model.contextualTabs[x].tabs[w])));t.isNullOrUndefined(a)||t.isNullOrUndefined(a.groups[r])||this.element.find(".e-content.e-content-item").eq(i).hasClass("e-rbn-ondemand")||(h=t.isNullOrUndefined(a.groups[r].id)?t.isNullOrUndefined(a.groups[r].text)?a.groups[r].text:a.groups[r].text.replace(/\s/g,""):a.groups[r].id.replace(/\s/g,""),c=this._createControls(r,a,h,i),m=t.buildTag("div"),b=c.find(".e-innerdiv,.e-innerdivrow").eq(n).find(".e-controlpadding"),u=T?b:b.eq(s),(p=c.find("#"+u.attr("id")).next()).hasClass("e-separatordivrow")&&m.append(p),m.prepend(u),!(g=e(o).children().eq(r).find(".e-innerdiv,.e-innerdivrow").eq(n)).length>0&&(I=f==t.Ribbon.alignType.columns?t.buildTag("div#"+this._id+"_"+a.id+"_"+h+"_"+(n+1)).addClass("e-innerdiv"):t.buildTag("div#"+this._id+"_"+a.id+"_"+h+"_"+(n+1)).addClass("e-innerdivrow"),e(o).children().eq(r).find(".e-ribGroupContent").append(I),g=e(o).children().eq(r).find(".e-innerdiv,.e-innerdivrow").eq(n)),_=e(g).parent().height(),g.find(".e-controlpadding").eq(s).length>0?g.find(".e-controlpadding").eq(s).before(m.children()):g.append(m.children()),e(g).parent().height()>_&&this.element.find(".e-content").height(this.element.find(".e-content").height()+(e(g).parent().height()-_)),c.children().remove(),e(o).hasClass("e-empty-content")&&e(o).removeClass("e-empty-content"),this._setTabContentHeight())},removeTabGroupContent:function(i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w;if(e(e(".e-ribbon .e-content")[i]).find(".e-groupdiv"),h=(s=this._tabUl.find(".e-select,.e-active").eq(i)).children("a").attr("href"),e(s).hasClass("e-tab")){for(g=(o=this.model.tabs[i-1].groups).length,_=0;_<g;_++)if(o[_].text==r)if(t.isNullOrUndefined(l)){if(o[_].type===t.Ribbon.type.custom&&o[_].text==r&&t.isNullOrUndefined(o[_].content))u=e(h).find(".e-groupdiv").eq(_).find(".e-ribGroupContent"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-ribGroupContent")),u.children().remove(),o[_].contentID=null;else if(o[_].text==r&&t.isNullOrUndefined(l)){if(d=o[_].content,!t.isNullOrUndefined(d))for(p=o[_].content.length,w=0;w<p;w++)d[w].groups.splice(0,d[w].groups.length);u=e(h).find(".e-groupdiv").eq(_).find(".e-ribGroupContent"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-ribGroupContent")),u.children().remove()}}else if(t.isNullOrUndefined(n)||t.isNullOrUndefined(o[_].content[l].groups))d=o[_].content[l],u=e(h).children(".e-groupdiv").eq(_).find(".e-innerdiv,.e-innerdivrow"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-innerdiv,.e-innerdivrow")),u.eq(l).children().remove(),d.groups.splice(0,d.groups.length);else{for(d=o[_].content[l].groups,u=e(h).children(".e-groupdiv").eq(_).find(".e-innerdiv,.e-innerdivrow"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-innerdiv,.e-innerdivrow")),c=u.eq(l),b=0;b<c.children().length;b++)d.splice(b,1);c.children().eq(n).remove(),0==u.children().length&&u.remove()}}else for(a=this.model.tabs.length,m=this.model.contextualTabs.length,_=0;_<m;_++)for(f=this.model.contextualTabs[_].tabs.length,b=0;b<f;b++)if(++a===i)for(C=(d=this.model.contextualTabs[_].tabs[b].groups).length,S=0;S<C;S++)if(d[S].text==r)if(t.isNullOrUndefined(l)){if(d[S].type===t.Ribbon.type.custom&&d[S].text==r&&t.isNullOrUndefined(d[S].content))u=e(h).find(".e-groupdiv").eq(S).find(".e-ribGroupContent"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-ribGroupContent")),u.children().remove(),d[S].contentID=null;else if(t.isNullOrUndefined(l)){if(x=d[S].content,!t.isNullOrUndefined(x))for(p=d[S].content.length,w=0;w<p;w++)x[w].groups.splice(0,x[w].groups.length);u=e(h).find(".e-groupdiv").eq(S).find(".e-ribGroupContent"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-ribGroupContent")),u.children().remove()}}else if(t.isNullOrUndefined(n)||t.isNullOrUndefined(d[S].content[l].groups))x=d[S].content[l],u=e(h).children(".e-groupdiv").eq(S).find(".e-innerdiv,.e-innerdivrow"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-innerdiv,.e-innerdivrow")),u.eq(l).children().remove(),x.groups.splice(0,x.groups.length);else{for(x=d[S].content[l].groups,u=e(h).children(".e-groupdiv").eq(S).find(".e-innerdiv,.e-innerdivrow"),this._phoneMode&&this.element.find(".e-responsivecontent").is(":visible")&&0==u.length&&(u=this.element.find(".e-responsivecontent").find(".e-innerdiv,.e-innerdivrow")),c=u.eq(l),v=0;v<c.children().length;v++)x.splice(v,1);c.children().eq(n).remove(),0==u.children().length&&u.remove()}},addTab:function(i,r,l){var n,s,o,a,d,h,c={id:i.replace(/\s/g,""),text:i,groups:r};this.model.tabs.length;if(t.isNullOrUndefined(l)&&(l=this._tabUl.find(".e-select,.e-active").length),l>0){for(this._conTabsRemove(),this._tabObj.addItem("#"+this._id+"_"+i.replace(/\s/g,""),i,l),this._tabUl.find(".e-ribresmenu").nextAll("li.e-select").length>0&&this._tabUl.find(".e-select,.e-active").not(".e-apptab,.e-tab").insertBefore(this._tabUl.find(".e-ribresmenu")),this._contextualTabs(),this._tabUl.find(".e-select,.e-active").eq(l).addClass("e-tab"),this._tabUl.find(".e-select > a,.e-active > a ").eq(l).addClass("e-link"),t.isNullOrUndefined(this.model.tabs[0].id)?(this.model.tabs[0]=c,this._tabObj.showItem(1)):this.model.tabs.splice(l-1,0,c),o=0;o<1;o++)for(0==(d=(a=this.model.tabs[l-1]).groups.length)&&this.element.find("#"+this._id+"_"+a.id).addClass("e-empty-content"),h=0;h<d;h++)if(!t.isNullOrUndefined(a.groups[h])){var u=t.isNullOrUndefined(a.groups[h].id)?t.isNullOrUndefined(a.groups[h].text)?a.groups[h].text:a.groups[h].text.replace(/\s/g,""):a.groups[h].id.replace(/\s/g,""),g=this._createControls(h,a,u,l),p=this._addControlsToGroup(h,a,u,g);(n=this.element.find("#"+this._id+"_"+a.id)).append(p).addClass("e-parentdiv")}this._setTabContentHeight(),this.element.find(".e-content.e-content-item").css("box-sizing","content-box"),this._ribbonTabs=this._tabUl.find(".e-link").parent(),this._tabContents=this.element.children().attr("role","tablist").not(".e-header,.e-disable,.e-resizediv,.e-tooltipdiv,.e-ribbonbackstagepage"),this._applicationTab.click(e.proxy(this._onApplicationTabClick,this)),s={tabHeader:this._tabUl.find(".e-select,.e-active").eq(l),tabContent:n},this._trigger("tabAdd",s)}this._tabText=this.element.find(".e-link"),this._applicationTab.hasClass("e-active")&&this._applicationTab.removeClass("e-active"),e(n).hasClass("e-parentdiv")||e(n).addClass("e-parentdiv")},addContextualTabs:function(i,r){var l,n,s,o,a,d,h;if(this._tabUl.find(".e-tab").length<r&&(this.model.contextualTabs.length,t.isNullOrUndefined(r)&&(r=this._tabUl.find(".e-select,.e-active").length),r>0)){for(this._conTabsRemove(),l=i.tabs.length,o=0;o<l;o++)t.isNullOrUndefined(this._mobileContents[r-1])?(this._mobileContents[r-1]={tab:i.tabs[o].text,mobileContent:[]},this._mobileToolbar[r-1]={tab:i.tabs[o].text,Content:[]}):(this._mobileContents.splice(r-1,0,{tab:i.tabs[o].text,mobileContent:[]}),this._mobileToolbar.splice(r-1,0,{tab:i.tabs[o].text,Content:[]})),this._tabObj.addItem("#"+this._id+"_"+i.tabs[o].id,i.tabs[o].text,r),n=t.buildTag("li",i.tabs[o].text).addClass("e-responsivetabli e-resContextual"),s=e.isEmptyObject(this.model.applicationTab.menuSettings)&&t.isNullOrUndefined(this.model.applicationTab.menuItemID)&&t.isNullOrUndefined(this.model.applicationTab.backstageSettings.pages[0].id),n.insertBefore(this.element.find(".e-rescontent").children(".e-responsivetabli ").eq(r-(s?0:1))),this._responsiveTabText=this.element.find(".e-responsivetabheader li"),this._tabUl.find(".e-ribresmenu").nextAll("li.e-select").length>0&&this._tabUl.find(".e-select,.e-active").not(".e-apptab,.e-tab").insertBefore(this._tabUl.find(".e-ribresmenu")),this._tabUl.find(".e-select,.e-active").eq(r).addClass("e-contextualtabset"),this._tabUl.find(".e-select > a ,.e-active > a ").eq(r).addClass("e-link"),++r;for(this.model.contextualTabs[0].tabs.length>0?this.model.contextualTabs.splice(r-1,0,i):this.model.contextualTabs[0]=i,this._contextualTabs(),l=i.tabs.length,o=0;o<l;o++)for(d=(a=i.tabs[o]).groups.length,h=0;h<d;h++)if(!t.isNullOrUndefined(a.groups[h])){var c=t.isNullOrUndefined(a.groups[h].id)?t.isNullOrUndefined(a.groups[h].text)?a.groups[h].text:a.groups[h].text.replace(/\s/g,""):a.groups[h].id.replace(/\s/g,""),u=this._createControls(h,a,c),g=this._addControlsToGroup(h,a,c,u);this.element.find("#"+this._id+"_"+a.id).append(g).addClass("e-parentdiv")}this._setTabContentHeight(),this.element.find(".e-content.e-content-item").css("box-sizing","content-box"),this._ribbonTabs=this._tabUl.find(".e-link").parent(),this._tabContents=this.element.children().attr("role","tablist").not(".e-header,.e-disable,.e-resizediv,.e-tooltipdiv,.e-ribbonbackstagepage"),this._applicationTab.click(e.proxy(this._onApplicationTabClick,this))}},setTabText:function(t,i){var r=this;this._tabText.filter(function(l){var n=e(this).text();return n===t&&(r.model.tabs[l-1].text=i),n===t}).text(i),this._phoneMode&&(this._responsiveTabText.filter(function(){return e(this).text()===t}).text(i),this.element.find(".e-ribresmenu .e-reslink").text(this._responsiveTabText.filter(".e-resactive").text()))},getTabText:function(e){return this._tabText=this.element.find(".e-link"),this._tabText.eq(e).text()},updateGroup:function(i,r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v;if(n=this._tabUl.find(".e-select,.e-active").eq(i),e(n).hasClass("e-tab")){for(g=(s=this.model.tabs[i-1].groups).length,C=0;C<g;C++)if(!t.isNullOrUndefined(s[C].content))for(p=s[C].content.length,S=0;S<p;S++)for(m=s[C].content[S].groups.length,x=0;x<m;x++)s[C].content[S].groups[x].id==r&&(v=s[C].content[S].groups[x],t.isNullOrUndefined(l.buttonSettings)||(e.extend(v.buttonSettings,l.buttonSettings),e(l).removeProp("buttonSettings")),t.isNullOrUndefined(l.dropdownSettings)||(e.extend(v.dropdownSettings,l.dropdownSettings),e(l).removeProp("dropdownSettings")),t.isNullOrUndefined(l.toggleButtonSettings)||(e.extend(v.toggleButtonSettings,l.toggleButtonSettings),e(l).removeProp("toggleButtonSettings")),t.isNullOrUndefined(l.splitButtonSettings)||(e.extend(v.splitButtonSettings,l.splitButtonSettings),e(l).removeProp("splitButtonSettings")),t.isNullOrUndefined(l.customToolTip)||(e.extend(v.customToolTip,l.customToolTip),e(l).removeProp("customToolTip")),e.extend(v,l),h=t.isNullOrUndefined(s[C].id)?t.isNullOrUndefined(s[C].text)?s[C].text:s[C].text.replace(/\s/g,""):s[C].id.replace(/\s/g,""),d=this.model.tabs[i-1],a=this._createControls(C,d,h,i),c="#"+this._id+"_"+d.id+"_"+h+"_"+r,o=this.element.find(c),_=a.find(c),o.replaceWith(_))}else for(u=this.model.tabs.length,f=0;f<this.model.contextualTabs.length;f++)for(b=0;b<this.model.contextualTabs[f].tabs.length;b++)if(++u===i)for(g=(s=this.model.contextualTabs[f].tabs[b].groups).length,C=0;C<g;C++)if(!t.isNullOrUndefined(s[C].content))for(p=s[C].content.length,S=0;S<p;S++)for(m=s[C].content[S].groups.length,x=0;x<m;x++)s[C].content[S].groups[x].id==r&&(v=s[C].content[S].groups[x],t.isNullOrUndefined(l.buttonSettings)||(e.extend(v.buttonSettings,l.buttonSettings),e(l).removeProp("buttonSettings")),t.isNullOrUndefined(l.dropdownSettings)||(e.extend(v.dropdownSettings,l.dropdownSettings),e(l).removeProp("dropdownSettings")),t.isNullOrUndefined(l.toggleButtonSettings)||(e.extend(v.toggleButtonSettings,l.toggleButtonSettings),e(l).removeProp("toggleButtonSettings")),t.isNullOrUndefined(l.splitButtonSettings)||(e.extend(v.splitButtonSettings,l.splitButtonSettings),e(l).removeProp("splitButtonSettings")),t.isNullOrUndefined(l.customToolTip)||(e.extend(v.customToolTip,l.customToolTip),e(l).removeProp("customToolTip")),e.extend(v,l),h=t.isNullOrUndefined(s[C].id)?t.isNullOrUndefined(s[C].text)?s[C].text:s[C].text.replace(/\s/g,""):s[C].id.replace(/\s/g,""),d=this.model.contextualTabs[0].tabs[0],a=this._createControls(C,d,h,i),c="#"+this._id+"_"+d.id+"_"+h+"_"+r,o=this.element.find(c),_=a.find(c),o.replaceWith(_))},isVisible:function(t){return this._tabText.filter(function(){return e(this).text()===t}).parent().is(":visible")},isEnable:function(t){for(var i=!0,r=this._tabText.filter(function(){return e(this).text()===t}).parent().index(),l=this.model.disabledItemIndex.length,n=0;n<l;n++)this.model.disabledItemIndex[n]==r&&(i=!1);return i},_renderTab:function(){var i,r,l,n,s,o,a,d,h=t.buildTag("ul"),c=this.model.applicationTab.type,u=this.model.tabs,g=u.length;if(null!=c&&(r=t.buildTag("a","",{},{href:"#"+this._id+"_"+c.replace(/\s/g,"")})),i=t.buildTag("li.e-apptab",r),h.append(i),g>=1&&!t.isNullOrUndefined(u[0].id)&&!t.isNullOrUndefined(u[0].text))for(s=0;s<g;s++)l=u[s],r=t.buildTag("a",l.text,{},{href:"#"+this._id+"_"+l.id}),i=t.buildTag("li",r).addClass("e-tab"),h.append(i);if(this.model.contextualTabs)for(a=this.model.contextualTabs.length,s=0;s<a;s++)if(this.model.contextualTabs[s].tabs)for(d=this.model.contextualTabs[s].tabs.length,o=0;o<d;o++)n=this.model.contextualTabs[s].tabs[o],r=t.buildTag("a",n.text,{},{href:"#"+this._id+"_"+n.id}),i=t.buildTag("li",r).addClass("e-contextualtabset").css("border-bottom-color",this.model.contextualTabs[s].backgroundColor),h.append(i);h.append(t.buildTag("li.e-ribresmenu").append(t.buildTag("span.e-icon").addClass("e-ribdownarrow")).prepend(t.buildTag("a#"+this._id+"_responsivelink").addClass("e-reslink")).click(e.proxy(this._onResponsiveHeaderClick,this))),this.model.showQAT&&h.append(t.buildTag("li#"+this._id+"_responsiveqat").addClass("e-responsiveqat").click(e.proxy(this._onQatClick,this))),this.element.append(h),this.element.ejTab({width:this.model.width,allowKeyboardNavigation:!1,disabledItemIndex:this.model.disabledItemIndex,enabledItemIndex:this.model.enabledItemIndex,enableTabScroll:!1,itemActive:e.proxy(this._onTabSelect,this),beforeActive:e.proxy(this._onTabClick,this),create:e.proxy(this._create,this),selectedItemIndex:this.model.selectedItemIndex,enableRTL:this.model.enableRTL,cssClass:this.model.cssClass})},_createControls:function(i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j,M,V,B,H,X={};if(l=t.isNullOrUndefined(l)?l:l.replace(/\&/g,""),d=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_content").addClass("e-ribGroupContent"),"custom"===r.groups[i].type)r.groups[i].contentID?(o=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+r.groups[i].type).addClass("e-innerdiv"),e("#"+r.groups[i].contentID).addClass("e-rbncustomelement").appendTo(o).show()):o=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+r.groups[i].type,r.groups[i].customContent).addClass("e-innerdiv"),0===i&&d.append(t.buildTag("div.e-ribupdivarrow").append(t.buildTag("span.e-icon").addClass("e-groupresponsive e-ribdownarrow"))).addClass("e-resgroupheader"),d.append(o);else if(r.groups[i].content)for(0===i&&d.append(t.buildTag("div.e-ribupdivarrow").append(t.buildTag("span.e-icon").addClass("e-groupresponsive e-ribdownarrow"))).addClass("e-resgroupheader"),_=r.groups[i].content.length,B=0;B<_;B++)if(void 0!=r.groups[i].content[B])for(b=r.groups[i].content[B].groups,C=r.groups[i].content[B].defaults,1==r.groups[i].content.length&&!0,t.isNullOrUndefined(r.groups[i].alignType)&&(r.groups[i].alignType=t.Ribbon.AlignType.Rows),r.groups[i].alignType===t.Ribbon.AlignType.Columns?s=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+(B+1)).addClass("e-innerdiv"):r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(s=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+(B+1)).addClass("e-innerdivrow"),++N),f=b.length,N=0;N<f;N++)if(!t.isNullOrUndefined(b[N])){switch(t.isNullOrUndefined(C)||t.isNullOrUndefined(C.type)||(b[N].type=C.type),t.isNullOrUndefined(b[N].type)&&(b[N].type=t.Ribbon.Type.Button),t.isNullOrUndefined(b[N].isBig)&&!t.isNullOrUndefined(C)&&(b[N].isBig=C.isBig),S=this.model.buttonDefaults,t.isNullOrUndefined(b[N].height)&&(t.isNullOrUndefined(b[N].buttonSettings)||t.isNullOrUndefined(b[N].buttonSettings.height)?t.isNullOrUndefined(C)||t.isNullOrUndefined(C.height)?t.isNullOrUndefined(S)||t.isNullOrUndefined(S.height)||(x=S.height):x=C.height:x=b[N].buttonSettings.height,b[N].height=x,x=null),t.isNullOrUndefined(b[N].width)&&(t.isNullOrUndefined(b[N].buttonSettings)||t.isNullOrUndefined(b[N].buttonSettings.width)?t.isNullOrUndefined(C)||t.isNullOrUndefined(C.width)?t.isNullOrUndefined(S)||t.isNullOrUndefined(S.width)||(v=S.width):v=C.width:v=b[N].buttonSettings.width,b[N].width=v,v=null),t.isNullOrUndefined(b[N].buttonSettings)||(w=b[N].buttonSettings,!t.isNullOrUndefined(w.enabled)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enabled)||(w.enabled=S.enabled),!t.isNullOrUndefined(w.enableRTL)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enableRTL)||(w.enableRTL=S.enableRTL),!t.isNullOrUndefined(w.cssClass)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.cssClass)||(w.cssClass=S.cssClass),!t.isNullOrUndefined(w.showRoundedCorner)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.showRoundedCorner)||(w.showRoundedCorner=S.showRoundedCorner)),t.isNullOrUndefined(b[N].splitButtonSettings)||(I=b[N].splitButtonSettings,!t.isNullOrUndefined(I.enabled)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enabled)||(I.enabled=S.enabled),!t.isNullOrUndefined(I.enableRTL)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enableRTL)||(I.enableRTL=S.enableRTL),!t.isNullOrUndefined(I.cssClass)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.cssClass)||(I.cssClass=S.cssClass),!t.isNullOrUndefined(I.showRoundedCorner)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.showRoundedCorner)||(I.showRoundedCorner=S.showRoundedCorner)),t.isNullOrUndefined(b[N].dropdownSettings)||(!t.isNullOrUndefined(b[N].dropdownSettings.enabled)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enabled)||(b[N].dropdownSettings.enabled=S.enabled),!t.isNullOrUndefined(b[N].dropdownSettings.enableRTL)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enableRTL)||(b[N].dropdownSettings.enableRTL=S.enableRTL),!t.isNullOrUndefined(b[N].dropdownSettings.cssClass)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.cssClass)||(b[N].dropdownSettings.cssClass=S.cssClass),!t.isNullOrUndefined(b[N].dropdownSettings.showRoundedCorner)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.showRoundedCorner)||(b[N].dropdownSettings.showRoundedCorner=S.showRoundedCorner)),t.isNullOrUndefined(b[N].toggleButtonSettings)||(!t.isNullOrUndefined(b[N].toggleButtonSettings.enabled)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enabled)||(b[N].toggleButtonSettings.enabled=S.enabled),!t.isNullOrUndefined(b[N].toggleButtonSettings.enableRTL)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.enableRTL)||(b[N].toggleButtonSettings.enableRTL=S.enableRTL),!t.isNullOrUndefined(b[N].toggleButtonSettings.cssClass)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.cssClass)||(b[N].toggleButtonSettings.cssClass=S.cssClass),!t.isNullOrUndefined(b[N].toggleButtonSettings.showRoundedCorner)||t.isNullOrUndefined(S)||t.isNullOrUndefined(S.showRoundedCorner)||(b[N].toggleButtonSettings.showRoundedCorner=S.showRoundedCorner)),t.isNullOrUndefined(b[N].quickAccessMode)&&(b[N].quickAccessMode="none"),b[N].type){case t.Ribbon.Type.Custom:g=b[N],r.groups[i].alignType===t.Ribbon.AlignType.Columns?a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+g.contentID).addClass("e-controlpadding"):r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+g.contentID).addClass("e-innerdivchild e-controlpadding")),e.isEmptyObject(g.customToolTip)?t.isNullOrUndefined(g.toolTip)||a.attr("title",g.toolTip):a.mouseover({value:g,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),e("#"+g.contentID).addClass("e-rbncustomelement").appendTo(a),t.isNullOrUndefined(b[N])||(t.isNullOrUndefined(b[N].height)||a.children().height(b[N].height),t.isNullOrUndefined(b[N].width)||a.children().width(b[N].width)),t.isNullOrUndefined(g.isBig)||(g.isBig?a.children().addClass("e-big"):a.children().addClass("e-small")),s.append(a),b[N].enableSeparator&&r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(m=t.buildTag("div#"+this._id+"_separator_"+g.toolTip).addClass("e-separatordivrow"),s.append(m));break;case t.Ribbon.Type.SplitButton:h=b[N],this._splitButtonControl=t.buildTag("button#"+this._id+"_"+h.id,h.text,{},{type:"button"}).addClass(h.cssClass),r.groups[i].alignType===t.Ribbon.AlignType.Columns?a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+h.id,this._splitButtonControl).addClass("e-controlpadding"):r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+h.id,this._splitButtonControl).addClass("e-innerdivchild e-controlpadding")),e.isEmptyObject(h.customToolTip)?t.isNullOrUndefined(h.toolTip)||a.attr("title",h.toolTip):a.mouseover({value:h,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),X={},h.splitButtonSettings&&(X=h.splitButtonSettings),X.height=t.isNullOrUndefined(X.height)?b[N].height:X.height,X.width=t.isNullOrUndefined(X.width)?b[N].width:X.width,X.cssClass=X.cssClass?X.cssClass.concat(" e-rbn-splitbtn e-rbn-button"):"e-rbn-splitbtn e-rbn-button",X.enableRTL=this.model.enableRTL,this._splitButtonControl.ejSplitButton(X),a.find(".e-split").addClass("e-rbn-split"),h.isMobileOnly&&(this._mobileSplitButton=t.buildTag("button#"+this._id+"_"+h.id+"_mobEle",h.text,{},{type:"button"}).addClass(h.cssClass),L=t.buildTag("div#"+this._id+"_"+h.id+"_mobDiv",this._mobileSplitButton).addClass("e-mobdiv"),X.height=h.splitButtonSettings.height,X.width=h.splitButtonSettings.width,X.arrowPosition=t.ArrowPosition.Right,X.imagePosition=h.splitButtonSettings.imagePosition,X.contentType=h.splitButtonSettings.contentType,this._mobileSplitButton.ejSplitButton(X),L.find("button").addClass("e-rbn-button"),this._mobileToolbar[n].Content.push(L),t.isNullOrUndefined(h.text)?t.isNullOrUndefined(h.splitButtonSettings.text)||(R=h.splitButtonSettings.text):R=h.text,this._mobileContents[n].mobileContent.push({id:h.id,text:R,isMobileOnly:h.isMobileOnly})),"none"!=h.quickAccessMode&&this.model.showQAT&&!this.model.enableOnDemand&&(this._splitButtonQAT=t.buildTag("button#"+this._id+"_"+h.id+"_qatEle",h.text,{},{type:"button"}).addClass(h.cssClass),T=t.buildTag("div#"+this._id+"_"+h.id+"_qatDiv",this._splitButtonQAT).addClass("e-qatooldiv"),X.height=30,X.arrowPosition=t.ArrowPosition.Right,X.contentType=t.ContentType.ImageOnly,e.isEmptyObject(h.customToolTip)?t.isNullOrUndefined(h.toolTip)||T.attr("title",h.toolTip):T.mouseover({value:h,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),this._splitButtonQAT.ejSplitButton(X),T.find("button").addClass("e-rbn-button"),T.appendTo(this._qAccessBar),"menu"==h.quickAccessMode&&T.hide(),t.isNullOrUndefined(h.text)?t.isNullOrUndefined(h.splitButtonSettings.text)||(R=h.splitButtonSettings.text):R=h.text,this._qatControlsName.push({id:h.id,text:R,qAccess:h.quickAccessMode})),t.isNullOrUndefined(h.isBig)||(h.isBig?a.children().prop("style",!1).addClass("e-big"):a.children().prop("style",!1).addClass("e-small")),s.append(a),b[N].enableSeparator&&r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(m=t.buildTag("div#"+this._id+"_separator_"+h.id).addClass("e-separatordivrow"),s.append(m));break;case t.Ribbon.Type.ToggleButton:p=b[N],this._toggleButtonControl=t.buildTag("input#"+this._id+"_"+p.id,"","",{type:"checkbox"}).addClass(p.cssClass),r.groups[i].alignType===t.Ribbon.AlignType.Columns?a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+p.id,this._toggleButtonControl).addClass("e-controlpadding"):r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+p.id,this._toggleButtonControl).addClass("e-innerdivchild e-controlpadding")),e.isEmptyObject(p.customToolTip)?t.isNullOrUndefined(p.toolTip)||a.attr("title",p.toolTip):a.mouseover({value:p,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),X={},p.toggleButtonSettings&&(X=p.toggleButtonSettings),X.height=t.isNullOrUndefined(X.height)?b[N].height:X.height,X.width=t.isNullOrUndefined(X.width)?b[N].width:X.width,y=e("#"+this._toggleButtonControl.attr("id")+"_qatDiv button.e-togglebutton"),this.model.enableOnDemand&&this.model.showQAT&&y.is(":visible")&&y.hasClass("e-active")&&(X.toggleState=!0),this._toggleButtonControl.ejToggleButton(X).addClass("e-ribbonbtn e-rbn-button"),a.find("button").addClass("e-rbn-button"),p.isMobileOnly&&(this._mobileToggleButton=t.buildTag("button#"+this._id+"_"+p.id+"_mobEle","","",{type:"checkbox"}).addClass(p.cssClass),L=t.buildTag("div#"+this._id+"_"+p.id+"_mobDiv",this._mobileToggleButton).addClass("e-mobdiv"),X.height=p.toggleButtonSettings.height,X.width=p.toggleButtonSettings.width,X.contentType=p.toggleButtonSettings.contentType,X.imagePosition=p.toggleButtonSettings.imagePosition,this._mobileToggleButton.ejToggleButton(X).addClass("e-ribbonbtn"),L.find("button").addClass("e-rbn-button"),this._mobileToolbar[n].Content.push(L),t.isNullOrUndefined(p.text)?t.isNullOrUndefined(p.toggleButtonSettings.defaultText)||(R=p.toggleButtonSettings.defaultText):R=p.text,this._mobileContents[n].mobileContent.push({id:p.id,text:R,isMobileOnly:p.isMobileOnly})),"none"!=p.quickAccessMode&&this.model.showQAT&&!this.model.enableOnDemand&&(this._toggleButtonQAT=t.buildTag("input#"+this._id+"_"+p.id+"_qatEle","","",{type:"checkbox"}).addClass(p.cssClass),T=t.buildTag("div#"+this._id+"_"+p.id+"_qatDiv",this._toggleButtonQAT).addClass("e-qatooldiv"),X.height=30,X.contentType=t.ContentType.ImageOnly,e.isEmptyObject(p.customToolTip)?t.isNullOrUndefined(p.toolTip)||T.attr("title",p.toolTip):T.mouseover({value:p,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),this._toggleButtonQAT.ejToggleButton(X).addClass("e-ribbonbtn"),T.find("button").addClass("e-rbn-button"),T.appendTo(this._qAccessBar),"menu"==p.quickAccessMode&&T.hide(),t.isNullOrUndefined(p.text)?t.isNullOrUndefined(p.toggleButtonSettings.defaultText)||(R=p.toggleButtonSettings.defaultText):R=p.text,this._qatControlsName.push({id:p.id,text:R,qAccess:p.quickAccessMode})),t.isNullOrUndefined(p.isBig)||(p.isBig?a.find(".e-togglebutton.e-tbtn.e-btn").addClass("e-big"):a.find(".e-togglebutton.e-tbtn.e-btn").addClass("e-small")),s.append(a),b[N].enableSeparator&&r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(m=t.buildTag("div#"+this._id+"_separator_"+p.id).addClass("e-separatordivrow"),s.append(m));break;case t.Ribbon.Type.Button:c=b[N],this._buttonControl=c.buttonSettings&&c.buttonSettings.type?t.buildTag("button#"+this._id+"_"+c.id,c.text,{},{type:c.buttonSettings.type}).addClass(c.cssClass):t.buildTag("button#"+this._id+"_"+c.id,c.text).addClass(c.cssClass),r.groups[i].alignType===t.Ribbon.AlignType.Columns?a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+c.id,this._buttonControl).addClass("e-controlpadding"):r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+c.id,this._buttonControl).addClass("e-innerdivchild e-controlpadding")),e.isEmptyObject(c.customToolTip)?t.isNullOrUndefined(c.toolTip)||a.attr("title",c.toolTip):a.mouseover({value:c,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),X={},c.buttonSettings&&(X=c.buttonSettings),X.height=t.isNullOrUndefined(X.height)?b[N].height:X.height,X.width=t.isNullOrUndefined(X.width)?b[N].width:X.width,this._buttonControl.ejButton(X).addClass("e-ribbonbtn  e-rbn-button"),c.isMobileOnly&&(this._mobileButton=c.buttonSettings&&c.buttonSettings.type?t.buildTag("button#"+this._id+"_"+c.id+"_mobEle",c.text,{},{type:c.buttonSettings.type}).addClass(c.cssClass):t.buildTag("button#"+this._id+"_"+c.id+"_mobEle",c.text).addClass(c.cssClass),L=t.buildTag("div#"+this._id+"_"+c.id+"_mobDiv",this._mobileButton).addClass("e-mobdiv"),this._mobileButton.ejButton(X).addClass("e-ribbon-resbtn  e-rbn-button"),this._mobileToolbar[n].Content.push(L),t.isNullOrUndefined(c.text)?t.isNullOrUndefined(c.buttonSettings.text)||(R=c.buttonSettings.text):R=c.text,this._mobileContents[n].mobileContent.push({id:c.id,text:R,isMobileOnly:c.isMobileOnly})),"none"!=c.quickAccessMode&&this.model.showQAT&&!this.model.enableOnDemand&&(this._buttonQAT=c.buttonSettings&&c.buttonSettings.type?t.buildTag("button#"+this._id+"_"+c.id+"_qatEle",c.text,{},{type:c.buttonSettings.type}).addClass(c.cssClass):t.buildTag("button#"+this._id+"_"+c.id+"_qatEle",c.text).addClass(c.cssClass),T=t.buildTag("div#"+this._id+"_"+c.id+"_qatDiv",this._buttonQAT).addClass("e-qatooldiv"),X.height=30,X.contentType=t.ContentType.ImageOnly,e.isEmptyObject(c.customToolTip)?t.isNullOrUndefined(c.toolTip)||T.attr("title",c.toolTip):T.mouseover({value:c,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),this._buttonQAT.ejButton(X).addClass("e-ribbonbtn e-rbn-button"),T.appendTo(this._qAccessBar),"menu"==c.quickAccessMode&&T.hide(),t.isNullOrUndefined(c.text)?t.isNullOrUndefined(c.buttonSettings.text)||(R=c.buttonSettings.text):R=c.text,this._qatControlsName.push({id:c.id,text:R,qAccess:c.quickAccessMode})),t.isNullOrUndefined(c.isBig)||(c.isBig?a.children().addClass("e-big"):a.children().addClass("e-small")),s.append(a),b[N].enableSeparator&&r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(m=t.buildTag("div#"+this._id+"_separator_"+c.id).addClass("e-separatordivrow"),s.append(m));break;case t.Ribbon.Type.DropDownList:u=b[N],this._dropdownControl=t.buildTag("input#"+this._id+"_"+u.id,{type:"text"}).addClass(u.cssClass),u.dropdownSettings&&(r.groups[i].alignType===t.Ribbon.AlignType.Columns?a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+u.id,this._dropdownControl).append(e("#"+u.dropdownSettings.targetID)).addClass("e-controlpadding"):r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+u.id,this._dropdownControl).append(e("#"+u.dropdownSettings.targetID)).addClass("e-innerdivchild e-controlpadding")),e.isEmptyObject(u.customToolTip)?t.isNullOrUndefined(u.toolTip)||a.attr("title",u.toolTip):a.mouseover({value:u,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this))),X={},u.dropdownSettings&&(X=u.dropdownSettings),X.height=t.isNullOrUndefined(X.height)?b[N].height:X.height,X.width=t.isNullOrUndefined(X.width)?b[N].width:X.width,X.cssClass=X.cssClass?X.cssClass.concat(" e-rbn-ddl"):"e-rbn-ddl",u.isMobileOnly&&(this._mobileDropdown=t.buildTag("input#"+this._id+"_"+u.id+"_mobEle","","",{type:"text"}).addClass(u.cssClass),L=t.buildTag("div#"+this._id+"_"+u.id+"_mobDiv",this._mobileDropdown).addClass("e-mobdiv"),this._mobileDropdown.ejDropDownList(X).addClass("e-ribbonbtn"),this._mobileToolbar[n].Content.push(L),t.isNullOrUndefined(u.text)?t.isNullOrUndefined(u.dropdownSettings.defaultText)||(R=u.dropdownSettings.defaultText):R=u.text,this._mobileContents[n].mobileContent.push({id:u.id,text:R,isMobileOnly:u.isMobileOnly})),X.enableRTL=this.model.enableRTL,this._dropdownControl.ejDropDownList(X),s.append(a),b[N].enableSeparator&&r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(m=t.buildTag("div#"+this._id+"_separator_"+u.id).addClass("e-separatordivrow"),s.append(m));break;case t.Ribbon.Type.Gallery:for(E=b[N],this._galleryControl=t.buildTag("div#"+this._id+"_"+E.id+"_gallerycontrol").addClass("e-ribbongallerycontrol"),this._gallery=t.buildTag("div#"+this._id+"_"+E.id).addClass("e-ribbongallery"),D=t.buildTag("div#"+this._id+"_"+E.id+"_ContentDiv").addClass("e-gallerycontent").height(65).width(E.columns*E.itemWidth).click({galleryId:this._gallery.attr("id")},e.proxy(this._onGalContentClick,this)),F=Math.floor(E.galleryItems.length/E.columns),E.galleryItems.length%E.columns>0&&++F,N=1;N<=F;N++){for(A=t.buildTag("div#"+this._id+"_"+E.id+"_galleryrow_"+N).addClass("e-galleryrow").click({model:E},e.proxy(this._onGalleryItemClick,this)),1===N?A.addClass("e-gryfirstrow"):N===F&&A.addClass("e-grylastrow"),P=1;P<=E.columns;P++)k=D.find(".e-galleryrow").children().length+A.children().length,t.isNullOrUndefined(E.galleryItems[k])||(j=t.buildTag("button#"+E.id+"_galleryItem_"+(k+1),E.galleryItems[k].text,{},{type:"button"}).addClass("e-gallerybtn  e-rbn-button"),e.isEmptyObject(E.galleryItems[k].customToolTip)?t.isNullOrUndefined(E.galleryItems[k].toolTip)||j.attr("title",E.galleryItems[k].toolTip):j.mouseover({value:E.galleryItems[k],ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),X={},E.galleryItems[k].buttonSettings&&(X=E.galleryItems[k].buttonSettings),X.height=E.itemHeight<=65?E.itemHeight:65,X.width=E.itemWidth,j.ejButton(X),j.appendTo(A));N>(O=E.itemHeight>65?1:D.height()/E.itemHeight)&&A.hide(),A.appendTo(D)}this._gallery.append(D);var U=t.buildTag("div#"+this._id+"_"+E.id+"_PagesDiv").addClass("e-gallerymovediv"),z=t.buildTag("div#"+this._id+"_"+E.id+"_prevPage","<span class='e-icon e-galleryup e-gallerymoveicon'></span>").click({galleryId:this._gallery.attr("id"),rowCnt:O},e.proxy(this._onGalMoveUpClick,this)).addClass("e-moveupdiv e-disablegrymovebtn"),q=t.buildTag("div#"+this._id+"_"+E.id+"_nextPage","<span class='e-icon e-gallerydown e-gallerymoveicon'></span>").click({galleryId:this._gallery.attr("id")},e.proxy(this._onGalMoveDownClick,this)).addClass("e-movedowndiv"),G=t.buildTag("div#"+this._id+"_"+E.id+"_expandGallery","<span class='e-icon e-galleryexpand e-gallerymoveicon'></span>").click({galleryId:this._gallery.attr("id"),columns:E.columns,expandedColumns:E.expandedColumns,itemWidth:E.itemWidth},e.proxy(this._onExpandGalleryClick,this)).addClass("e-expgallerydiv");this._responsiveGallery=E.expandedColumns,U.append(z),U.append(q),U.append(G),this._gallery.append(U);var W=t.buildTag("div#"+this._id+"_"+E.id+"_ExpandContent").addClass("e-gallexpandcontent").hide(),K=t.buildTag("div#"+this._id+"_"+E.id+"_scrollContent","<div></div>").addClass("e-gallscrollcontent"),J=t.buildTag("div#"+this._id+"_"+E.id+"_ExpanderContent").addClass("e-expandercontent").click({galleryId:this._gallery.attr("id")},e.proxy(this._onExpandContentClick,this));if(K.children().append(J),W.append(K),!t.isNullOrUndefined(E.customGalleryItems)){for(M=t.buildTag("div#"+this._id+"_"+E.id+"_ExtraContent").addClass("e-extracontent").click({model:E},e.proxy(this._onGalleryItemClick,this)),V=E.customGalleryItems.length,B=0;B<V;B++)t.isNullOrUndefined(E.customGalleryItems[B].customItemType)&&(E.customGalleryItems[B].customItemType=t.Ribbon.CustomItemType.Button),E.customGalleryItems[B].customItemType===t.Ribbon.CustomItemType.Button?(H=t.buildTag("button#"+E.id+"__extraItem_"+B,E.customGalleryItems[B].text,{},{type:"button"}).addClass("e-galleryextrabtn e-rbn-button"),e.isEmptyObject(E.customGalleryItems[B].customToolTip)?t.isNullOrUndefined(E.customGalleryItems[B].toolTip)||H.attr("title",E.customGalleryItems[B].toolTip):H.mouseover({value:E.customGalleryItems[B],ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)),X={},E.customGalleryItems[B]&&(E.customGalleryItems[B].buttonSettings&&(X=E.customGalleryItems[B].buttonSettings),H.ejButton(X)),H.appendTo(M)):(X={},E.customGalleryItems[B].menuSettings&&(X=E.customGalleryItems[B].menuSettings),X.menuType=t.MenuType.NormalMenu,X.orientation=t.Orientation.Vertical,X.enableRTL=this.model.enableRTL,e("#"+E.customGalleryItems[B].menuId).ejMenu(X).addClass("e-gallerymenu"),e("#"+E.customGalleryItems[B].menuId).appendTo(M).css("width","100%"));W.append(M)}this._galleryControl.append(this._gallery),this._galleryControl.append(W),r.groups[i].alignType===t.Ribbon.AlignType.Columns?a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+E.id,this._galleryControl).addClass("e-controlpadding"):r.groups[i].alignType===t.Ribbon.AlignType.Rows&&(a=t.buildTag("div#"+this._id+"_"+r.id+"_"+l+"_"+E.id,this._galleryControl).addClass("e-innerdivchild e-controlpadding")),s.append(a)}d.append(s)}return d},_groupContent:function(i){var r,l,n,s,o,a,d,h,c,u=0;if(t.isNullOrUndefined(i)?r=this._tabUl.find(".e-active").index()-1:(u=e(i.activeHeader).parents(".e-contextliset").length>0?e(i.activeHeader).parents(".e-contextliset").prevAll(".e-tab").eq(0).prevAll().not(".e-tab,.e-apptab").length:e(i.activeHeader).prevAll().not(".e-tab,.e-apptab").length,r=i.activeIndex-(u+1)),(l=this.element.find(".e-content-item").eq(r+(1+u))).hasClass("e-rbn-ondemand")&&!(r<0)){if(n=e.extend(!0,{},this.model),s=this.model.tabs.length,p=t.isNullOrUndefined(i)?-1:e(i.activeHeader).hasClass("e-contextualtabset")?s-e(i.activeHeader).index():-1,this.model.contextualTabs&&-1!=p){var g=e(i.activeHeader).parents(".e-contextliset").attr("id"),p=parseInt(g[g.length-1]),m=this.model.contextualTabs[p];if(m.tabs)for(o=m.tabs.length,a=0;a<o;a++)!t.isNullOrUndefined(m.tabs[a].groups)&&m.tabs[a].groups.length>0&&(this.model.tabs[s]=m.tabs[a],r=s)}if(d=this.model.tabs[r],this._mobileContents[this._tabObj.model.selectedItemIndex-1]={tab:d.text,mobileContent:[]},this._mobileToolbar[this._tabObj.model.selectedItemIndex-1]={tab:d.text,Content:[]},t.isNullOrUndefined(d.groups))this.element.find(".e-content.e-content-item").eq(r+1).addClass("e-empty-content");else for(h=d.groups.length,c=0;c<h;c++)if(!t.isNullOrUndefined(d.groups[c])){var _=t.isNullOrUndefined(d.groups[c].id)?t.isNullOrUndefined(d.groups[c].text)?d.groups[c].text:d.groups[c].text.replace(/\s/g,""):d.groups[c].id.replace(/\s/g,""),f=this._createControls(c,d,_,r),b=this._addControlsToGroup(c,d,_,f);this.element.find("#"+this._id+"_"+d.id).append(b).addClass("e-parentdiv")}l.removeClass("e-rbn-ondemand"),this.model=n}},_groupingControls:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p=this.model.tabs.length,m=e.extend(!0,{},this.model);if(this.model.contextualTabs)for(d=this.model.contextualTabs.length,h=0;h<d;h++)if((i=this.model.contextualTabs[h]).tabs)for(0==(c=i.tabs.length)&&this.element.find(".e-content.e-content-item").eq(s+1).addClass("e-empty-content"),u=0;u<c;u++)!t.isNullOrUndefined(i.tabs[u].groups)&&i.tabs[u].groups.length>0&&(this.model.tabs[p]=i.tabs[u],++p);for(s=0;s<p;s++)if(r=this.model.tabs[s],this._mobileContents[s]={tab:r.text,mobileContent:[]},this._mobileToolbar[s]={tab:r.text,Content:[]},t.isNullOrUndefined(r.groups))this.element.find(".e-content.e-content-item").eq(s+1).addClass("e-empty-content");else for(0==(g=r.groups.length)&&this.element.find(".e-content.e-content-item").eq(s+1).addClass("e-empty-content"),o=0;o<g;o++)t.isNullOrUndefined(r.groups[o])||(a=t.isNullOrUndefined(r.groups[o].id)?t.isNullOrUndefined(r.groups[o].text)?r.groups[o].text:r.groups[o].text.replace(/\s/g,""):r.groups[o].id.replace(/\s/g,""),n=this._createControls(o,r,a,s),l=this._addControlsToGroup(o,r,a,n),this.element.find("#"+this._id+"_"+r.id).append(l).addClass("e-parentdiv"));this._setTabContentHeight(),this.model=m},_addControlsToGroup:function(i,r,l,n){var s,o,a=t.buildTag("div.e-contentbottom"),d=!1,h=t.buildTag("div.e-captionarea",r.groups[i].text);return a.append(h),r.groups[i].enableGroupExpander&&(o=t.buildTag("div#"+this._id+"_"+l+"_e-groupexpander.e-icon e-expander e-groupexpander"),a.append(o),t.isNullOrUndefined(r.groups[i].groupExpanderSettings)||(t.isNullOrUndefined(r.groups[i].groupExpanderSettings.toolTip)||o.attr("title",r.groups[i].groupExpanderSettings.toolTip),e.isEmptyObject(r.groups[i].groupExpanderSettings.customToolTip)||o.mouseover({value:r.groups[i].groupExpanderSettings,ribbonId:this._id},e.proxy(this._tooltip,this)).mouseout({ribbonId:this._id},e.proxy(this._toolTipOut,this)))),s=t.buildTag("div#"+this._id+"_"+r.id+"_"+l).addClass("e-groupdiv").click(e.proxy(this._onGroupClick,this)),t.isNullOrUndefined(r.groups[i].content)||1==r.groups[i].content.length&&(d=!0),r.groups[i].width&&s.width(r.groups[i].width),s.append(n),d&&s.addClass("e-centeralign"),s.append(a),s},_tabExpandCollapse:function(t){var i,r,l;"touchend"==t.type&&t.preventDefault(),l="e-expanded"==(i="div"==t.target.tagName?t.target:t.target.parentNode).className?"collapse":"expand",r={target:e(i),type:t.type,action:l,cancel:!1},this._trigger("toggleButtonClick",r),r.cancel||(this.element.find(".e-rarrowup-2x").length>0?this.collapse():(this._removeRibbonPin(),this.model.showQAT&&this._qAccessBar.show(),this._trigger("pinState",{action:"pin"})),this._clickValue="click")},_responsiveback:function(){this.element.find(".e-resizebtnselect").removeClass("e-active e-resizebtnselect"),this.element.find(".e-responsivebackstagecontent").is(":visible")&&this.element.find(".e-responsivebackstagecontent").hide(),!this.element.find(".e-responsivecontent").hasClass("e-resshow")||this.element.find(".e-responsivecontent").find(".e-split.e-active").length>0||this._responsiveContentBack(),this.element.find(".e-respcontent").is(":visible")&&(this.element.find(".e-active-content").addClass("e-responsiveheight e-rbnmobheader"),this.element.find(".e-respcontent .e-groupresponsive.e-ribuparrow").removeClass("e-ribuparrow").addClass("e-ribdownarrow"))},_ribbonResponsive:function(){for(var i,r,l=t.buildTag("ul#"+this._id+"_responsivetabContent").addClass("e-rescontent"),n=this.model.tabs.length,s=!0,o=0;o<n;o++)l.append(t.buildTag("li",this.model.tabs[o].text).addClass("e-responsivetabli"));if(1==(n=this.model.contextualTabs.length)&&(s=this.model.contextualTabs[0].tabs.length>0),0!=n&&s)for(o=0;o<n;o++)l.append(t.buildTag("li",this.model.contextualTabs[o].tabs[0].text).addClass("e-responsivetabli").addClass("e-resContextual"));(i=t.buildTag("div#"+this._id+"_responsivetabHeader").addClass("e-responsivetabheader").click(e.proxy(this._onResponsiveHeaderClick,this))).append(l),this.element.append(i),this._initialRender&&this._tabUl.find("li.e-ribresmenu a").not(".e-backstagetab").text(this._tabUl.find("li.e-active a").text()),this.model.applicationTab.type===t.Ribbon.ApplicationTabType.Backstage&&(this.element.prepend(t.buildTag("div#"+this._id+"_responsivebackstage").addClass("e-responsivebackstage")),(r=t.buildTag("div#"+this._id+"_resbackstagecontent").addClass("e-responsivebackstagecontent").append(t.buildTag("div.e-resbackstagecontent"))).prepend(t.buildTag("div#"+this._id+"backstagetop").addClass("e-backstagerestop").append(t.buildTag("div.e-backstagerestopcontent").append(t.buildTag("span.e-icon").addClass("e-ribleftarrow")).append(t.buildTag("div#"+this._id+"resbacstageTitle").addClass("e-backstageTitle")))),this.element.prepend(r.hide()))},_onResponsiveHeaderClick:function(t){if(e(t.target).hasClass("e-responsivetabli")){var i=e(t.target).parent("ul").children().index(t.target);return this.element.find(".e-responsivetabheader").removeClass("e-resshow"),this.element.find(".e-ribresmenu a").text(t.target.textContent),e(this._tabUl.find(".e-tab,.e-contextliset").find("a")[i]).trigger("click"),e(t.target).parent("ul").children(".e-resactive").removeClass("e-resactive"),void e(t.target).addClass("e-resactive")}e(t.target).parent(".e-ribresmenu").length>0&&this.element.find(".e-responsivetabheader").addClass("e-resshow")},_ribbonResGroup:function(){var i,r,l,n,s,o=this._tabUl.find(".e-tab,.e-contextualtabset").index(this._tabUl.find("li.e-active"));o<0&&(o=this._tabUl.find(".e-tab,.e-contextualtabset").index(this._tabUl.find("li.e-collapseactive"))),t.isNullOrUndefined(this.model.applicationTab)||(i=o+1);var a=this.element.find(".e-content.e-content-item"),d=this.element.find(".e-active-content"),h=(a.eq(i).attr("id"),a.eq(i).children(".e-groupdiv").length),c=(a.eq(i).children(".e-groupdiv")[h-1],a.eq(i).children(".e-groupdiv").eq(h-1).find(".e-resizebtn"));if(-1!=o&&this.element.find(".e-content-item").eq(i).children().not(".e-expandcollapse").length>0&&this._mobileContents[o].mobileContent.length>0&&!d.find(".e-respmobcontent").length>0){for(d.prepend(t.buildTag("div#"+this._id+"_mobcontent").addClass("e-respmobcontent e-groupmobdiv").append(t.buildTag("div#"+this._id+"_mobribgroup").addClass("e-mobribgroup e-mobribgroupactive").append(t.buildTag("div.e-ribupdivarrow").addClass("e-toolbaralign").append(t.buildTag("span.e-icon").addClass("e-groupresponsive e-ribdownarrow"))))).click(e.proxy(this._onGroupClick,this)).click(e.proxy(this._onMobContentClick,this)),d.find(".e-resgroupheader").removeClass("e-resgroupheader"),r=this._mobileToolbar[o].Content.length,l=0;l<r;l++)d.find(".e-mobribgroup").append(this._mobileToolbar[o].Content[l]);d.find(".e-mobribgroup").append(d.find(".e-mobribgroup .e-ribupdivarrow"))}for(n=h-1;n>=0;n--)0==(c=a.eq(i).children(".e-groupdiv").eq(n).find(".e-resizebtn")).length&&(0!=n||this._mobileContents[o].mobileContent.length>0)?this._createResizeBtn(i,n):0==n&&c.length>0&&!this._mobileContents[o].mobileContent.length>0&&(s=c.parent().siblings(),c.parent().remove(),s.show(),s.not(".e-contentbottom").css("width",""))},_ribbonWindowResize:function(){var i,r,l,n,s,o,a,d,h,c;this._phoneMode=!!((this.model.allowResizing||this.model.isResponsive)&&document.documentElement.clientWidth<420);var u,g,p,m=this._tabUl.find(".e-tab,.e-contextualtabset").index(this._tabUl.find("li.e-active")),_=this.element.find(".e-ribbonpin"),f=this.element.find(".e-active-content").eq(0),b=this.element.find(".e-ribresmenu"),C=this.element.find(".e-respcontent");if(t.isNullOrUndefined(this.model.applicationTab)||m+1,this.element.find(".e-ribGroupContent.e-resshow").addClass("e-reshide"),this._phoneMode)return this._responsiveScrollRemove(),C.is(":hidden")&&this.element.find(".e-responsivecontent").is(":hidden")&&C.removeClass("e-reshide"),this._isCollapsed?this._tabUl.find(".e-active").length>0?b.find("a").text(this._tabUl.find(".e-active a").text()):(this._responsiveTabText.eq(0).addClass("e-resactive"),b.find("a").text(this._responsiveTabText.filter(".e-resactive").text())):(this._responsiveTabText.filter(".e-resactive").removeClass("e-resactive"),this._responsiveTabText.eq(e(this._ribbonTabs.filter(".e-tab ,.e-contextualtabset")).index(this._ribbonTabs.filter(".e-active"))).addClass("e-resactive"),b.find("a").text(this._responsiveTabText.filter(".e-resactive").text())),_.length>0&&_.trigger("click"),f.addClass("e-responsiveheight e-rbnmobheader").addClass("e-tab_"+this._tabUl.find(".e-active a").text()),f.hasClass("e-respcontent")||f.addClass("e-respcontent"),i=f.find(".e-groupresponsive"),(e(i).eq(0).hasClass("e-ribdownarrow")||i.hasClass("e-ribuparrow"))&&i.hasClass("e-ribuparrow")&&i.eq(0).removeClass("e-ribuparrow").addClass("e-ribdownarrow"),t.isNullOrUndefined(this.model.applicationTab)||this.element.find(".e-ribresmenu").css("padding-left","12px"),this._ribbonResGroup(),this.element.addClass("e-responsive"),this.element.find(".e-rbn-ddl.e-ddl").addClass("e-rbn-resize"),g=this.element.find(".e-ribbonbackstagepage"),u=this.element.find(".e-responsivebackstage"),r=this.element.find(".e-header").width(),this.model.enableOnDemand&&0==this.element.find(".e-backstagetab .e-resbackstage").length?(this.model.applicationTab.type===t.Ribbon.ApplicationTabType.Backstage&&this._applicationTab.addClass("e-backstagetab"),this.element.find(".e-backstagetab").append(t.buildTag("span.e-icon").addClass("e-ribbon e-resbackstage").click(e.proxy(this._onResponsiveHeaderClick,this))),this.element.find(".e-header").addClass("e-resheader")):this.model.applicationTab.type==t.Ribbon.ApplicationTabType.Backstage&&0==this.element.find(".e-backstagetab .e-resbackstage").length?(this.element.find(".e-backstagetab").append(t.buildTag("span.e-icon").addClass("e-ribbon e-resbackstage").click(e.proxy(this._onResponsiveHeaderClick,this))),this.element.find(".e-header").addClass("e-resheader")):this.model.applicationTab.type==t.Ribbon.ApplicationTabType.Menu&&this.model.applicationTab.menuItemID&&(this.element.find(".e-header").addClass("e-resheader"),this.element.find(".e-rescontent").addClass("e-rescontent-menu")),this.model.showQAT&&(this._tabUl.find("li.e-responsiveqat").append(this.element.find(".e-rbnquickaccessbar.e-rbnabove").children()),l=this.element.find(".e-ribdownarrow").not(".e-groupresponsive"),this.element.find(".e-resqatScroll").length>0&&((n=this.element.find(".e-resqatScroll")).data("ejScroller")._destroy(),n.parent().append(n.find("div:first").children()),n.remove()),r-(l.offset().left+l.outerWidth())<r-this.element.find("li.e-responsiveqat").offset().left&&!this.element.find(".e-resqatScroll").length>0&&(s=r-this.element.find("li.e-responsiveqat").offset().left-(r-(l.offset().left+l.outerWidth())),(h=t.buildTag("div#"+this._id+"_responsiveqat").addClass("e-resqatScroll").append(t.buildTag("div"))).find("div").append(this._tabUl.find("li.e-responsiveqat").children()),this._tabUl.find("li.e-responsiveqat").append(h),this.element.find(".e-resqatScroll").ejScroller({width:r-this.element.find("li.e-responsiveqat").offset().left-s,height:"",scrollerSize:3,buttonSize:0}))),f.find(".e-groupdiv .e-resizebtn").length>0&&!f.find(".e-groupdiv .e-groupresponsive").not(".e-ribdownarrow").length>0&&f.find(".e-groupdiv").find(".e-resizebtn").parent("div").prepend(t.buildTag("div.e-ribrightdivarrow").append(t.buildTag("span.e-icon").addClass("e-groupresponsive e-ribrightarrow"))),this._tabUl.find(".e-backstagetab").length>0&&1==u.length&&(o=g.find(".e-ribbonbackstagebody .e-backstageheader"),u.append(o).addClass("e-reshide")),!this.element.find(".e-responsivecontent").length>0&&((h=t.buildTag("div#"+this._id+"_responsive").addClass("e-content e-responsivecontent").click(e.proxy(this._onResizeDivClick,this))).append(t.buildTag("div#"+this._id+"_resback").addClass("e-responsiveback").append(t.buildTag("span").addClass("e-groupresponsive e-icon e-ribleftarrow")).append(t.buildTag("div#"+this._id+"+rescontentback").addClass("e-restopbackcontent"))),this.element.append(h.hide())),g.find(".e-ribbonbackstagebody .e-backstagecontent").length>0&&this.element.find(".e-responsivebackstagecontent .e-resbackstagecontent").append(g.find(".e-ribbonbackstagebody .e-backstagecontent")),this.element.find(".e-header"),a=document.documentElement.clientHeight,p=this.element.find(".e-mobribgroup.e-mobribgroupactive"),this.element.find(".e-responsivebackstagecontent .e-resbackstagecontent").css({height:a-this.element.find(".e-backstagerestop").outerHeight()}),p.find(".e-ribupdivarrow").removeClass("e-toolbaralign"),(d=p.find(".e-resptoolbarScroll")).length>0&&(d.data("ejScroller")._destroy(),d.parent().append(d.find("div:first").children()),d.parents(".e-active-content").removeClass("e-responsiveToolbarScroll"),d.remove()),this._phoneMode&&p.outerWidth()>this.element.find(".e-header").outerWidth()?((h=t.buildTag("div#"+this._id+"_responsivetoolbar").addClass("e-resptoolbarScroll").append(t.buildTag("div"))).find("div").append(p.children()),p.append(h),(c=this.element.find(".e-respmobcontent .e-resptoolbarScroll")).find(".e-toolbaralign").removeClass("e-toolbaralign"),c.ejScroller({width:this.element.find(".e-header").width(),height:"",scrollerSize:4,buttonSize:0}),c.parents(".e-active-content").addClass("e-responsiveToolbarScroll")):p.find(".e-resptoolbarScroll").length>0&&!p.find("e-responsiveToolbarScroll").length>0?p.parents(".e-active-content").addClass("e-responsiveToolbarScroll"):p.find(".e-ribupdivarrow").addClass("e-toolbaralign"),void this.goToMainContent();this.element.hasClass("e-responsive")&&(this.element.removeClass("e-responsive"),this._ribbonRerender()),(this.model.allowResizing||this.model.isResponsive)&&(this.element.find(".e-ribbonpin").length>0&&this.element.find(".e-active-content").eq(0).is(":visible")?this.collapse():this._ribbonResize()),this.element.find(".e-ribbonpin").length>0&&this._tabContents.width(this.element.width())},_ribbonResize:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j=[],M=this.element.find(".e-active-content").eq(0),V=this.element.find(".e-ribbonpin");if(S=this._tabUl.find("li.e-select:visible,li.e-active:visible"),x=this.element.find(".e-resizediv"),_=this.element.find(".e-expandcollapse"),p=this.element.find(".e-header"),V.length>0&&(this._removeRibbonPin(),_.children().addClass("e-ribbonpin")),p.is(":hidden")&&M.is(":hidden")&&this._resizeWidth<=this.element.width()+this.element.offset().left&&(p.show(),this._qAccessBar.show(),(this.element.find(".e-expandcollapse").children().hasClass("e-expanded")||p.find(".e-active").length>0)&&(V.length<=0?(M.show(),_.children().addClass("e-expanded").removeClass("e-collapsed")):V.length>0&&this.collapse())),s=(C=p.find("li.e-select,li.e-active")).length,p.is(":visible")){for(F=s-1;F>0;F--)for(E=(o=C.eq(F).children()).text().length-1;E>1;E--)S.length>0&&(l=S.last().offset().left,n=S.last().width(),(this.element.width()+this.element.offset().left-30-(l+n)<=0||this.model.enableRTL&&S.last().offset().left<this.element.offset().left)&&(o.hasClass("e-resizeHead")?o.text(o.text().slice(0,-1)):o.text(o.text().slice(0,-1)).addClass("e-resizeHead")));s-1===(v=p.find(".e-resizeHead")).length&&v.eq(0).text().length<=2&&S.length>0&&(l=S.last().offset().left,n=S.last().width(),this.element.width()+this.element.offset().left-30-(l+n)<=0&&(this._resizeWidth=this.element.width()+this.element.offset().left))}if(r=this._tabObj.model.selectedItemIndex,(b=this.element.find(".e-content.e-content-item")).eq(r).attr("id"),a=b.eq(r).children(".e-groupdiv").length,i=b.eq(r).children(".e-groupdiv")[a-1],m=b.eq(r).children().eq(a-1).find(".e-resizebtn"),!t.isNullOrUndefined(i)){for(O=a-1;O>=0;O--)m=b.eq(r).children().eq(O).find(".e-resizebtn"),(this.element.width()+this.element.offset().left-25-(i.offsetWidth+e(i).offset().left)<=0||this.model.enableRTL&&e(window).width()-this.element.offset().left+25-(e(window).width()-e(i).offset().left+i.offsetWidth)<=0)&&0===m.length&&this._createResizeBtn(r,O);this.element.width()+this.element.offset().left-25-(i.offsetWidth+e(i).offset().left)<=0||this.model.enableRTL&&e(window).width()-this.element.offset().left+25-(e(window).width()-e(i).offset().left+i.offsetWidth)<=0?a===b.eq(r).find(".e-resizebtn").length&&(this._resizeWidth=this.element.width()+this.element.offset().left,this.element.addClass("e-grpdivhide"),this.element.find(".e-expandcollapse").css("display","none")):(this.element.removeClass("e-grpdivhide"),this.element.find(".e-expandcollapse").css("display","block"))}for(this._qatResize(),x.is(":visible")&&(w="#"+(w=x.children().eq(0).attr("id")).replace("_content",""),x.children().hide().appendTo(w),x.hide()),I=this.model.tabs.length,y=0;y<I;y++)T=this.model.tabs[y].text,j.push(T);if(this.model.contextualTabs)for(L=this.model.contextualTabs.length,D=0;D<L;D++)if(this.model.contextualTabs[D].tabs)for(R=this.model.contextualTabs[D].tabs.length,O=0;O<R;O++)T=this.model.contextualTabs[D].tabs[O].text,j.push(T);if(f=p.find(".e-resizeHead").length,p.is(":visible"))for(F=0;F<f;F++)if((o=p.find(".e-resizeHead").eq(0)).hasClass("e-resizeHead")){var B=C.find(".e-link").not(".e-resizeHead").length-1,H=o.text().length,X=j[B].length;for(E=H;E<=X;E++)S.length>0&&(l=S.last().offset().left,n=S.last().width()+15,(this.element.width()+this.element.offset().left-30>=l+n&&!this.model.enableRTL||this.model.enableRTL&&S.last().offset().left-15>this.element.offset().left)&&(o.text().length===j[B].length?o.removeClass("e-resizeHead"):this._width!=this.element.width()&&o.text(j[B].slice(0,o.text().length+1))))}for(c=b.eq(r).find(".e-resizebtn").length,D=0;D<c;D++)if(u=b.eq(r).find(".e-resizebtn").eq(0),e(u).is(":visible")){if(h=this.element.width()+this.element.offset().left-25,d=u.offset().left+u.parent().siblings().not(".e-contentbottom").width(),this.model.enableRTL&&(d=this.element.width()+this.element.offset().left-u.offset().left+u.parent().siblings().not(".e-contentbottom").width()),(N=b.eq(r).find(".e-resizebtn").length)>1)for(A=0;A<N;A++)d=d+b.eq(r).find(".e-resizebtn").eq(A).parents(".e-groupdiv").width()+7;h>d&&(P=u.parent().siblings(),u.parent().remove(),P.show(),P.not(".e-contentbottom").css("width",""))}this._qatResizeRemove(),(g=this.element.find(".e-tooltipdiv")).hide(),g.find(".e-tooltiptitle").children().remove(),g.find(".e-tooltipdesc").children().remove(),this.element.find(".e-ribbonpin").length>0&&this.element.find(".e-active-content").eq(0).is(":visible")&&(this._addRibbonPin(),this._tabContents.width(this.element.width())),this.element.find(".e-resizebtnselect").removeClass("e-resizebtnselect e-active"),this.model.showQAT&&((k=this.element.find(".e-rbnqatmenu")).is(":visible")&&k.hide().css({top:"",left:""}),this.element.find(".e-qaresizebtn,.e-splitbtnqat").removeClass("e-tbtn e-active"))},_qatResize:function(){var i,r,l,n,s,o;if(this.model.showQAT&&this._qAccessBar.is(":visible")){for(l=this._qAccessBar.children(":visible").length,n=0;n<l;n++)i=this._qAccessBar.children(":visible").last(),this.element.width()-(i.width()+e(i).position().left+6)<=0&&(i.hasClass("e-splitbtnqatdiv")?(s=t.buildTag("div.e-qaresizebtndiv").attr("title","More Controls"),o=t.buildTag("button.e-qaresizebtn"),r=t.buildTag("div.e-qaresizediv").hide(),this.element.append(r),r.append(i.prev()),s.append(o.ejButton({size:"normal",type:"button",contentType:"imageonly",height:30,width:14,prefixIcon:"e-icon e-ribbon e-qaresizebtnicon",click:e.proxy(this._onQatResizeBtnClick,this)})),r.append(i),s.insertBefore(this.element.find(".e-rbnqatmenu"))):i.hasClass("e-qaresizebtndiv")&&(r=this.element.find(".e-qaresizediv")).prepend(i.prevAll(":visible").first()));(r=this.element.find(".e-qaresizediv")).is(":visible")&&r.hide()}},_qatResizeRemove:function(){var e,t,i,r,l=this.element.find(".e-qaresizediv"),n=this.element.width(),s=0;if(l.length>0&&this._qAccessBar.is(":visible")&&this.model.showQAT){for(l.show(),e=this.element.find(".e-qaresizebtndiv"),t=this._qAccessBar.children(":visible").length,i=l.children().length,r=0;r<t;r++)s=s+this._qAccessBar.children(":visible").eq(r).width()+6;for(r=0;r<=i;r++)n>(s=l.children().length>2?s+l.children().eq(0).width():s+l.width())&&(l.children().length>2?l.children().eq(0).insertBefore(e):(l.children().insertBefore(e),this.element.find(".e-qaresizebtndiv").remove(),l.remove()));l.hide()}},_createResizeBtn:function(i,r){var l,n,s,o,a,d,h,c,u,g=this.element.find(".e-content.e-content-item");for(s=g.eq(i).children(".e-groupdiv").eq(r),this.element.find(".e-respcontent").length||(a=s.height()),d=e.extend(!0,[],this.model.tabs),h=0;h<this.model.contextualTabs.length;h++)for(c=0;c<this.model.contextualTabs[h].tabs.length;c++)d.push(this.model.contextualTabs[h].tabs[c]);u=t.isNullOrUndefined(d[i-1].groups[r].id)?d[i-1].groups[r].text:d[i-1].groups[r].id,l=s.find(".e-contentbottom").text(),n=(o=s.children().not(".e-contentbottom")).width(),t.isNullOrUndefined(this._responsiveContentStyle)&&(this._responsiveContentStyle={height:a}),s.children().hide(),o.css("width",n);var p=t.buildTag("div.e-resizegroupdiv#"+this._id+"_resizeDiv_"+u),m=t.buildTag("button#"+this._id+"_resizebtn_"+u,l,{},{type:"button"}).addClass("e-resizebtn e-rbn-button"),_={target:g.eq(i).children(".e-groupdiv").eq(r).children()};m.ejButton({click:e.proxy(this._resizeBtnClick,_),contentType:t.ContentType.TextAndImage,imagePosition:t.ImagePosition.ImageBottom,prefixIcon:"e-icon e-ribbonresize"}),s.height(a),m.children().prepend("<span class='e-icon e-"+l+"'></span>").height(a-5),m.appendTo(p),p.appendTo(g.eq(i).children(".e-groupdiv").eq(r))},_resizeBtnClick:function(){},_responsiveCustomize:function(e){e.find(".e-rbn-resize").parents(".e-controlpadding").addClass("e-rbn-resize").addClass("e-rbn-dll-cus"),e.find(".e-rbn-resize").parents(".e-innerdivrow").addClass("e-rbn-resize").next().css("display","inline-block")},_responsiveContentShow:function(e){var i,r=this.element.find(".e-active-content");this._responsiveCustomize(e),r.addClass("e-reshide"),e.addClass("e-resshow"),this.element.find(".e-responsivecontent .e-ribGroupContent").addClass("e-resshow"),e.find(".e-ribGroupContent").height()>this._responsiveHeight&&((i=t.buildTag("div#"+this._id+"_responsivecontentScroll").addClass("e-rescontentScroll").append(t.buildTag("div"))).find("div").append(e.children(".e-ribGroupContent")),e.append(i),e.find(".e-rescontentScroll").ejScroller({height:this._responsiveHeight,scrollerSize:8,buttonSize:0})),r.find(".e-resizebtnselect").removeClass("e-resizebtnselect")},_responsiveContentBack:function(){this._responsiveTarget.append(this._responsiveContent).find(".e-ribGroupContent").addClass("e-reshide").css(this._responsiveContentStyle),this._responsiveContent=null,this.element.find(".e-resizebtn.e-active").removeClass("e-active e-resizebtnselect"),this.element.find(".e-galleryexpand.e-gallerymoveicon").length>0&&this.element.find(".e-galleryexpand.e-gallerymoveicon").trigger("click"),this.element.find(".e-content.e-responsivecontent").children().not(".e-responsiveback").remove(),this.element.find(".e-active-content").removeClass("e-reshide"),this.element.find(".e-responsivecontent").removeClass("e-resshow")},_ribbonDocClick:function(i){var r,l,n,s,o,a,d,h;if(this.element.hasClass("e-responsive")){var c=i.target,u={},g=this,p=this.element.find(".e-responsivebackstage"),m=this.element.find(".e-responsivetabheader"),_=this.element.find(".e-active-content");this.element.find(".e-responsivebackstage");return!e(i.target).parents(".e-ribbon").length>0&&i.target!=document.documentElement&&!e(i.target).parents(".e-rbn-ddl").length>0&&!e(i.target).parents(".e-popup").length>0&&!this.element.find(".e-responsivecontent").is(":visible")?(m.removeClass("e-resshow"),p.is(":visible")&&p.removeClass("e-backstageshowanimate"),this.element.find(".e-responsivecontent").is(":visible")&&this._responsiveContentBack(),this.element.find(".e-responsivebackstagecontent").hide(),void(_.hasClass("e-responsiveheight")||(_.addClass("e-responsiveheight e-rbnmobheader"),this._responsiveScrollRemove(),_.find(".e-groupresponsive.e-ribuparrow").removeClass("e-ribuparrow").addClass("e-ribdownarrow"),u.isMobile=this.element.hasClass("e-responsive"),u.target=c,u.currentTarget=i.currentTarget,u.eventType=i.type,this.element.find(".e-content.e-content-item").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){g._trigger("collapse",u)})))):((e(c).hasClass("e-header")||e(c).hasClass("e-ribGroupContent")||e(c).hasClass("e-groupresponsive")||e(c).hasClass("e-respmobcontent"))&&(m.hasClass("e-resshow")&&m.removeClass("e-resshow"),p.is(":visible")&&p.removeClass("e-backstageshowanimate")),e(c).parent().hasClass("e-backstagerestopcontent")&&!e(".e-ddl-popup").is(":visible")?void e(c).parents(".e-responsivebackstagecontent").hide():void 0)}if(h=this.element.find(".e-gallexpandcontent"),s=this.element.find("#"+this._id+"_modelDiv"),o=this.element.find(".e-active-content"),s.is(":visible")&&s.hide(),h.hasClass("e-gallerypopupshow")&&(h.removeClass("e-gallerypopupshow"),s.hide()),(e(".e-rbn-splitbtn").parents().hasClass("e-active")||this.element.find(".e-resizebtn").hasClass("e-resizebtnselect")||e(".e-ddl-popup.e-rbn-ddl:visible").length>0||this.element.find(".e-colorwidget").hasClass("e-active"))&&o.append(s.show().height("100%")),(d=e(".e-ribbonpopup:visible")).length>0&&!d.hasClass("e-ribbonpopupshow")?(d.addClass("e-ribbonpopupshow"),o.append(s.show().height("100%"))):d.hasClass("e-ribbonpopupshow")&&d.removeClass("e-ribbonpopupshow"),(e(i.target).hasClass("e-expgallerydiv")||e(i.target).parents(".e-expgallerydiv").length>0)&&(h.addClass("e-gallerypopupshow"),o.append(s.show().height("100%"))),e(i.target).hasClass("e-gallerymoveicon")||e(i.target).hasClass("e-gallerymovediv")||e(i.target).hasClass("e-expgallerydiv")||e(i.target).hasClass("e-scrollbar")||e(i.target).parents().hasClass("e-scrollbar")?r=i.target:e(i.target).parents().hasClass("e-gallerymenu")&&(e(i.target).hasClass("e-haschild")||e(i.target).hasClass("aschild")||e(i.target).hasClass("e-arrows"))&&(r=i.target),t.isNullOrUndefined(r)&&this._ribbonGalleryShow(),l=this.element.find(".e-tooltipdiv"),a=e(i.target).find(".e-disable"),l.is(":visible")&&e(a).length<=0&&!e(i.target).hasClass("e-disable")&&l.hide(),(e(i.target).hasClass("e-backstagechild")||e(i.target).parents(".e-backstagechild").length>0||e(i.target).hasClass("e-ribbonbackstagepage")||e(i.target).hasClass("e-apptab")||e(i.target).parents(".e-ribbonbackstagepage").length>0||e(i.target).parents(".e-apptab").length>0)&&(r=i.target),t.isNullOrUndefined(r)&&0==e(document).find(e(i.target)).length&&(r=e(i.currentTarget.activeElement)),t.isNullOrUndefined(r)&&this.element.find(".e-ribbonbackstagepage").hide(),!e(i.target).hasClass("e-disable-item")&&e(i.target).parents(".e-disable-item").length<=0&&this.element.find(".e-controlclicked").removeClass("e-controlclicked"),(n=e(i.target).parents(".e-controlpadding")).length>0&&e(a).length<=0&&!e(i.target).hasClass("e-disable")&&e(n).find(".e-ribbongallerycontrol").length<=0&&e(n).addClass("e-controlclicked"),this.element.find(".e-ribbonpin").is(":visible")&&e(i.target).parents(".e-ribbon").length<=0&&!e(i.target).hasClass("e-scrollbar")&&!e(i.target).parents().hasClass("e-scrollbar")&&this.collapse(),this.element.find(".e-resizediv").is(":hidden")&&this.element.find(".e-resizebtnselect").removeClass("e-resizebtnselect e-active"),this._tabUl.find(".e-link.e-active").removeClass("e-active"),this.model.showQAT){var f=this.element.find(".e-rbnqatmenu"),b=this.element.find(".e-qaresizediv"),C=this.element.find(".e-splitbtnqat");!e(i.target).hasClass("e-splitbtnqatdiv")&&e(i.target).parents(".e-splitbtnqatdiv").length<=0&&e(i.target).parents(".e-rbnqatmenu").length<=0&&f.hide().css({top:"",left:""}),!e(i.target).hasClass("e-qaresizebtndiv")&&f.is(":hidden")&&e(i.target).parents(".e-qaresizediv").length<=0&&e(i.target).parents(".e-qaresizebtndiv").length<=0&&!e(i.target).hasClass("e-splitbtnqatdiv")&&e(i.target).parents(".e-splitbtnqatdiv").length<=0&&b.hide().css({top:"",left:""}),b.is(":hidden")&&this.element.find(".e-qaresizebtn").hasClass("e-active")&&!e(i.target).hasClass("e-qaresizebtndiv")&&e(i.target).parents(".e-qaresizebtndiv").length<=0&&e(i.target).parents(".e-rbnqatmenu").length<=0&&this.element.find(".e-qaresizebtn").removeClass("e-tbtn e-active"),C.hasClass("e-active")&&!e(i.target).hasClass("e-splitbtnqatdiv")&&e(i.target).parents(".e-splitbtnqatdiv").length<=0&&e(i.target).parents(".e-rbnqatmenu").length<=0&&C.removeClass("e-tbtn e-active")}},_ribbonGalleryShow:function(){var t,i,r,l,n,s=0;if(this.element.find(".e-gallexpandcontent:visible").length>0){var o=0,a=0,d=this.element.find(".e-gallexpandcontent:visible").parent().find(".e-ribbongallery"),h=d.find(".e-galleryrow").length;for(n=1;n<=h;n++)"block"===d.find(".e-galleryrow").eq(n-1).css("display")&&(0===o&&(s=n-1),++o);for(d.find(".e-galleryrow").hide(),d.parent().find(".e-gallexpandcontent").hide(),d.show(),t=d.find(".e-galleryrow").eq(0).children().length,d.find(".e-galleryrow").eq(0).children().remove(),h=d.find(".e-galleryrow").length,i=0;i<h;i++)for(r=0;r<t;r++)if(l=d.parent().find(".e-galleryexpanderrow").children().eq(0),e(l).hasClass("e-galleryselect")){for(d.find(".e-galleryrow").eq(i).append(d.parent().find(".e-galleryexpanderrow").children().eq(0)).show(),--o,n=1;n<=o;n++)d.find(".e-galleryrow").eq(i+n).length>0?d.find(".e-galleryrow").eq(i+n).show():(++a,d.find(".e-galleryrow").eq(i-a).show());d.find(".e-galleryrow").last().is(":visible")?d.parent().find(".e-movedowndiv").addClass("e-disablegrymovebtn"):d.parent().find(".e-movedowndiv").removeClass("e-disablegrymovebtn"),d.find(".e-galleryrow").first().is(":visible")?d.parent().find(".e-moveupdiv").addClass("e-disablegrymovebtn"):d.parent().find(".e-moveupdiv").removeClass("e-disablegrymovebtn")}else d.find(".e-galleryrow").eq(i).append(d.parent().find(".e-galleryexpanderrow").children().eq(0));if(d.find(".e-galleryselect").length<=0)for(n=0;n<o;n++)d.find(".e-galleryrow").eq(s).show(),++s;d.parent().find(".e-galleryexpanderrow").remove()}},_resizeDivHide:function(){var i,r=this.element.find(".e-resizediv");this._off(e(document),"mousedown",this._rbndocumentClick),e(r).is(":visible")&&(i=e(r).children().eq(0).attr("id"),t.isNullOrUndefined(i)||(i="#"+i.slice(0,-8),e(r).children().hide().appendTo(i),this.element.find("#"+this._id+"_disabled").hide(),e(r).hide()),this.element.find(".e-ribbonpin").length>0&&e(r).css({top:""}))},_resizeDivShow:function(t){var i,r,l,n,s=this.element.find(".e-resizediv");i=(l=this.element.find("#"+t[0].id).parent().siblings()).not(".e-contentbottom").width()+l.parent().offset().left,this.model.enableRTL&&(i=l.not(".e-contentbottom").width()+(this.element.width()+this.element.offset().left-l.parent().offset().left)),this.element.css({position:"relative"}),e(s).css({left:""}),i>this.element.width()+this.element.offset().left?(r=l.parent().position().left-(i-(this.element.width()+this.element.offset().left)),this.model.enableRTL&&(r=this.element.width()+(this.element.offset().left-l.parent().offset().left)-(i-(this.element.width()+this.element.offset().left-l.parent().width()))),n=parseInt(e(s).css("padding-left"),10)+parseInt(e(s).css("padding-right"),10),this.model.enableRTL?e(s).css({right:r+n-1}):e(s).offset({left:r-n})):this.model.enableRTL?e(s).css({right:this.element.width()+(this.element.offset().left-l.parent().offset().left)-l.parent().outerWidth()}):e(s).offset({left:l.parent().position().left}),this.element.find(".e-ribbonpin").length>0&&e(s).offset({top:this.element.height()+this.element.find(".e-active-content").eq(0).height()}),e(s).width(l.not(".e-contentbottom").css("width")),e(s).append(l.show()).show(),this.element.hasClass("e-grpdivhide")&&(this.element.removeClass("e-grpdivhide"),this.element.find(".e-active-content").eq(0).addClass("e-resdivshow")),this._on(e(document),"mousedown",this._rbndocumentClick)},_rbndocumentClick:function(t){this.element.find(".e-resizediv").is(":visible")&&e(t.target).parents(".e-resizediv").length<=0&&e(t.target).parents(".e-rbn-ddl").length<=0&&!e(t.target).hasClass("e-rbn-splitbtn")&&e(t.target).parents(".e-colorpicker.e-ribbon:visible").length<=0&&e(t.target).parents(".e-rbn-splitbtn:visible").length<=0&&this._resizeDivHide(),this.element.find(".e-resizediv").is(":hidden")&&this.element.find(".e-resizebtnselect").removeClass("e-resizebtnselect e-active")},_ribbonDocRightClick:function(t){var i;e(t.target).parents(".e-resizediv").length<=0&&this._resizeDivHide(),this.element.find(".e-resizediv").is(":hidden")&&this.element.find(".e-resizebtnselect").removeClass("e-resizebtnselect e-active"),this.element.find(".e-gallexpandcontent").hasClass("e-gallerypopupshow")&&this._ribbonGalleryShow(),e(this.element.find(".e-ribbonbackstagepage")).is(":visible")&&this.element.find(".e-ribbonbackstagepage").hide(),(i=this.element.find(".e-tooltipdiv")).is(":visible")&&i.hide()},_onTabDblClick:function(t){this._phoneMode||this.element.find(".e-apptab .e-menu ul").is(":visible")||this.element.find(".e-ribbonbackstagepage").is(":visible")||(e(t.target).closest(".e-tab.e-disable").length||(this.element.find(".e-collapsed .e-rarrowup-2x").length&&this.expand(),this.element.find(".e-expanded .e-rarrowup-2x").length&&this.collapse(),this.element.find(".e-expanded.e-ribbonpin").length&&this._removeRibbonPin()),this._clickValue=t.type)},_ribbonhover:function(t){this._phoneMode&&("mouseover"==t.type?e(t.currentTarget).hasClass("e-resizegroupdiv")&&e(t.currentTarget).addClass("e-reshover"):"mouseout"==t.type&&e(t.currentTarget).hasClass("e-resizegroupdiv e-reshover")&&e(t.currentTarget).removeClass("e-reshover"))},_wireEvents:function(){this._on(e(document),"keydown",this._OnKeyDown),this._on(this.element,"keydown",this._ribbonKeyDown),this._on(this.element,"mouseover mouseout",".e-resizegroupdiv",this._ribbonhover),this._on(this.element.find("#"+this._id+"_expandCollapse"),t.eventType.click,this._tabExpandCollapse),this._on(this.element.find(".e-groupexpander"),t.eventType.click,this._onGroupExpandClick),this._on(this.element.find(".e-qatmenuli"),t.eventType.click,this._onQatMenuItemClick),this._on(e(window),"resize",this._ribbonWindowResize),this._on(e(document),"click",this._ribbonDocClick),this._on(e(document),"contextmenu",this._ribbonDocRightClick),this._on(this.element.find(".e-header > li"),"dblclick",this._onTabDblClick)}}),t.Ribbon.alignType={rows:"rows",columns:"columns"},t.Ribbon.AlignType={Rows:"rows",Columns:"columns"},t.Ribbon.applicationTabType={menu:"menu",backstage:"backstage"},t.Ribbon.ApplicationTabType={Menu:"menu",Backstage:"backstage"},t.Ribbon.quickAccessMode={none:"none",toolBar:"toolbar",menu:"menu"},t.Ribbon.QuickAccessMode={None:"none",ToolBar:"toolbar",Menu:"menu"},t.Ribbon.type={button:"button",splitButton:"splitbutton",dropDownList:"dropdownlist",custom:"custom",toggleButton:"togglebutton",gallery:"gallery"},t.Ribbon.Type={Button:"button",SplitButton:"splitbutton",DropDownList:"dropdownlist",Custom:"custom",ToggleButton:"togglebutton",Gallery:"gallery"},t.Ribbon.customItemType={button:"button",menu:"menu"},t.Ribbon.CustomItemType={Button:"button",Menu:"menu"},t.Ribbon.itemType={button:"button",tab:"tab"},t.Ribbon.ItemType={Button:"button",Tab:"tab"},t.Ribbon.Locale=t.Ribbon.Locale||{},t.Ribbon.Locale.default=t.Ribbon.Locale["en-US"]={CustomizeQuickAccess:"Customize Quick Access Toolbar",RemoveFromQuickAccessToolbar:"Remove from Quick Access Toolbar",AddToQuickAccessToolbar:"Add to Quick Access Toolbar",ShowAboveTheRibbon:"Show Above the Ribbon",ShowBelowTheRibbon:"Show Below the Ribbon",MoreCommands:"More Commands..."}}(jQuery,Syncfusion)})},1421:function(e,t,i){"use strict";var r=this&&this.__decorate||function(e,t,i,r){var l,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(l=e[o])&&(s=(n<3?l(s):n>3?l(t,i,s):l(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var n=i(5),s=i(1031),o=function(){function e(e){this.SpreadsheetService=e,this.spreadData=[{rows:[{height:30,cells:[{value:"Item Name",style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}},{value:"Quantity",style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}},{value:"Price",style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}},{value:"Amount",style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}},{value:"Stock Detail",style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}},{value:"Website",style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}}]},{cells:[{value:"Casual Shoes",comment:{value:"Casual Footwears with wide variety of colors."}},{value:"10"},{value:"20",format:{type:"currency"}},{value:"=B2*C2"},{value:"OUT OF STOCK"},{value:"Amazon",hyperlink:{webAddr:"www.amazon.com"}}]},{cells:[{value:"Sports Shoes",style:{"background-color":"#E5F3FF"}},{value:"20",style:{"background-color":"#E5F3FF"}},{value:"30",format:{type:"currency"},style:{"background-color":"#E5F3FF"}},{value:"=B3*C3",style:{"background-color":"#E5F3FF"}},{value:"IN STOCK",style:{"background-color":"#E5F3FF"}},{value:"AliExpress",hyperlink:{webAddr:"www.aliexpress.com"},style:{"background-color":"#E5F3FF"}}]},{cells:[{value:"Formal Shoes",comment:{value:"Formal Footwears with wide range of sizes."}},{value:"20"},{value:"15",format:{type:"currency"}},{value:"=B4*C4"},{value:"IN STOCK"},{value:"Amazon",hyperlink:{webAddr:"www.amazon.com"}}]},{cells:[{value:"Sandals & Floaters",style:{"background-color":"#E5F3FF"}},{value:"15",style:{"background-color":"#E5F3FF"}},{value:"20",format:{type:"currency"},style:{"background-color":"#E5F3FF"}},{value:"=B5*C5",style:{"background-color":"#E5F3FF"}},{value:"OUT OF STOCK",style:{"background-color":"#E5F3FF"}},{value:"Alibaba",hyperlink:{webAddr:"www.alibaba.com"},style:{"background-color":"#E5F3FF"}}]},{cells:[{value:"Flip-Flops & Slippers"},{value:"30"},{value:"10",format:{type:"currency"}},{value:"=B6*C6"},{value:"IN STOCK"},{value:"Ebay",hyperlink:{webAddr:"www.ebay.com"}}]},{cells:[{value:"Sneakers",style:{"background-color":"#E5F3FF"},comment:{value:"Sneakers with recent designs."}},{value:"40",style:{"background-color":"#E5F3FF"}},{value:"20",format:{type:"currency"},style:{"background-color":"#E5F3FF"}},{value:"=B7*C7",style:{"background-color":"#E5F3FF"}},{value:"OUT OF STOCK",style:{"background-color":"#E5F3FF"}},{value:"Amazon",hyperlink:{webAddr:"www.amazon.com"},style:{"background-color":"#E5F3FF"}}]},{cells:[{value:"Running Shoes"},{value:"20"},{value:"10",format:{type:"currency"}},{value:"=B8*C8"},{value:"IN STOCK"},{value:"AliExpress",hyperlink:{webAddr:"www.aliexpress.com"}}]},{cells:[{value:"Loafers",style:{"background-color":"#E5F3FF"}},{value:"31",style:{"background-color":"#E5F3FF"}},{value:"10",format:{type:"currency"},style:{"background-color":"#E5F3FF"}},{value:"=B9*C9",style:{"background-color":"#E5F3FF"}},{value:"OUT OF STOCK",style:{"background-color":"#E5F3FF"}},{value:"Alibaba",hyperlink:{webAddr:"www.alibaba.com"},style:{"background-color":"#E5F3FF"}}]},{cells:[{value:"Cricket Shoes"},{value:"41"},{value:"30",format:{type:"currency"}},{value:"=B10*C10"},{value:"IN STOCK"},{value:"Ebay",hyperlink:{webAddr:"www.ebay.com"}}]},{cells:[{value:"T-Shirts",style:{"background-color":"#E5F3FF"}},{value:"50",style:{"background-color":"#E5F3FF"}},{value:"10",format:{type:"currency"},style:{"background-color":"#E5F3FF"}},{value:"=B11*C11",style:{"background-color":"#E5F3FF"}},{value:"OUT OF STOCK",style:{"background-color":"#E5F3FF"}},{value:"Amazon",hyperlink:{webAddr:"www.amazon.com"},style:{"background-color":"#E5F3FF"}}]},{height:30,cells:[{style:{"background-color":"#428bca"}},{style:{"background-color":"#428bca"}},{value:"Total Amount",index:2,style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}},{value:"=Sum(D2:D11)",style:{"font-weight":"bold",color:"#FFFFFF","background-color":"#428bca"}},{style:{"background-color":"#428bca"}},{style:{"background-color":"#428bca"}}]}]}]}return e.prototype.loadComplete=function(e){$("#spreadsheet").data("ejSpreadsheet").setWidthToColumns([140,100,100,110,140,100,110])},e=r([n.Component({selector:"ej-app",template:i(1919),styles:[i(1035)],providers:[s.SpreadsheetService]}),l("design:paramtypes",[s.SpreadsheetService])],e)}();t.CellDataBindingComponent=o},1422:function(e,t,i){"use strict";var r=this&&this.__decorate||function(e,t,i,r){var l,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(l=e[o])&&(s=(n<3?l(s):n>3?l(t,i,s):l(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var n=i(5),s=i(1031),o=function(){function e(e){this.SpreadsheetService=e,this.spreadData=e.getconditionalFormat()}return e.prototype.loadComplete=function(e){var t=$("#spreadsheet").data("ejSpreadsheet"),i=t.XLCFormat,r=t.XLFormat;t.sheetRename("Conditional Formatting"),t.setWidthToColumns([165,130,37,165,130,37,129,132]),t.mergeCells("A1:A5",!0),t.mergeCells("D1:D5",!0),t.mergeCells("G1:G5",!0),t.mergeCells("G7:G11",!0),t.mergeCells("A7:A11",!0),t.mergeCells("D7:D11",!0),i.setCFRule({action:"greaterthan",inputs:["5000"],color:"redft",range:"E7:E11"}),i.setCFRule({action:"lessthan",inputs:["30"],color:"yellowft",range:"H1:H5"}),i.setCFRule({action:"between",inputs:["400","500"],color:"greenft",range:"B7:B11"}),i.setCFRule({action:"equalto",inputs:["20"],color:"redf",range:"H7:H11"}),i.setCFRule({action:"textcontains",inputs:["loafers"],color:"redt",range:"B1:B5"}),i.setCFRule({action:"dateoccur",inputs:["02/04/2014"],color:"redft",range:"E1:E5"}),r.format({style:{"font-weight":"bold","font-size":"10pt","vertical-align":"middle","text-align":"center"}},"A1:A13"),r.format({style:{"font-weight":"bold","font-size":"10pt","vertical-align":"middle","text-align":"center"}},"D1:D13"),r.format({style:{"font-weight":"bold","font-size":"10pt","vertical-align":"middle","text-align":"center"}},"G1:G7")},e=r([n.Component({selector:"ej-app",template:i(1920),styles:[i(1035)],providers:[s.SpreadsheetService]}),l("design:paramtypes",[s.SpreadsheetService])],e)}();t.ConditionalFormattingComponent=o},1423:function(e,t,i){"use strict";var r=this&&this.__decorate||function(e,t,i,r){var l,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(l=e[o])&&(s=(n<3?l(s):n>3?l(t,i,s):l(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var n=i(5),s=i(1031),o=function(){function e(e){this.SpreadsheetService=e,this.spreadData=e.getDefaultData()}return e.prototype.loadComplete=function(e){var t=$("#spreadsheet").data("ejSpreadsheet"),i=t.XLFormat;t.model.isImport||(t.setWidthToColumns([140,128,105,100,100,110,120,120,100]),i.format({style:{"font-weight":"bold"}},"A1:H1"),i.format({type:"currency"},"E2:H11"),t.XLRibbon.updateRibbonIcons())},e=r([n.Component({selector:"ej-app",template:i(1921),styles:[i(1035)],providers:[s.SpreadsheetService]}),l("design:paramtypes",[s.SpreadsheetService])],e)}();t.DefaultComponent=o},1515:function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),i(2049);var l=i(12),n=i(5),s=function(e){function t(t){var i=e.call(this,[])||this;return i.parent=t,i}return r(t,e),t.decorators=[{type:n.Directive,args:[{selector:"e-rangesettings>e-rangesetting"}]}],t.ctorParameters=function(){return[{type:l.EJComponents,decorators:[{type:n.Inject,args:[n.forwardRef(function(){return h})]}]}]},t.propDecorators={dataSource:[{type:n.Input,args:["dataSource"]}],headerStyles:[{type:n.Input,args:["headerStyles"]}],primaryKey:[{type:n.Input,args:["primaryKey"]}],query:[{type:n.Input,args:["query"]}],showHeader:[{type:n.Input,args:["showHeader"]}],startCell:[{type:n.Input,args:["startCell"]}]},t}(l.ComplexTagElement);t.SpreadsheetRangeSettingDirective=s;var o=function(e){function t(t){return e.call(this,"rangeSettings")||this}return r(t,e),t.decorators=[{type:n.Directive,args:[{selector:"e-sheets>e-rangesettings",queries:{children:new n.ContentChildren(s)}}]}],t.ctorParameters=function(){return[{type:l.EJComponents,decorators:[{type:n.Inject,args:[n.forwardRef(function(){return h})]}]}]},t}(l.ArrayTagElement);t.SpreadsheetRangeSettingsDirective=o;var a=function(e){function t(t){var i=e.call(this,["rangeSettings"])||this;return i.parent=t,i}return r(t,e),t.decorators=[{type:n.Directive,args:[{selector:"e-sheets>e-sheet"}]}],t.ctorParameters=function(){return[{type:l.EJComponents,decorators:[{type:n.Inject,args:[n.forwardRef(function(){return h})]}]}]},t.propDecorators={border:[{type:n.Input,args:["border"]}],cellTypes:[{type:n.Input,args:["cellTypes"]}],cFormatRule:[{type:n.Input,args:["cFormatRule"]}],colCount:[{type:n.Input,args:["colCount"]}],columnWidth:[{type:n.Input,args:["columnWidth"]}],dataSource:[{type:n.Input,args:["dataSource"]}],fieldAsColumnHeader:[{type:n.Input,args:["fieldAsColumnHeader"]}],frozenRows:[{type:n.Input,args:["frozenRows"]}],frozenColumns:[{type:n.Input,args:["frozenColumns"]}],headerStyles:[{type:n.Input,args:["headerStyles"]}],hideColumns:[{type:n.Input,args:["hideColumns"]}],hideRows:[{type:n.Input,args:["hideRows"]}],mergeCells:[{type:n.Input,args:["mergeCells"]}],primaryKey:[{type:n.Input,args:["primaryKey"]}],query:[{type:n.Input,args:["query"]}],rangeSettings:[{type:n.Input,args:["rangeSettings"]}],rowCount:[{type:n.Input,args:["rowCount"]}],rows:[{type:n.Input,args:["rows"]}],showGridlines:[{type:n.Input,args:["showGridlines"]}],showHeader:[{type:n.Input,args:["showHeader"]}],showHeadings:[{type:n.Input,args:["showHeadings"]}],sheetName:[{type:n.Input,args:["sheetName"]}],startCell:[{type:n.Input,args:["startCell"]}],tag_rangeSettings:[{type:n.ContentChild,args:[o]}]},t}(l.ComplexTagElement);t.SpreadsheetSheetDirective=a;var d=function(e){function t(t){return e.call(this,"sheets")||this}return r(t,e),t.decorators=[{type:n.Directive,args:[{selector:"ej-spreadsheet>e-sheets",queries:{children:new n.ContentChildren(a)}}]}],t.ctorParameters=function(){return[{type:l.EJComponents,decorators:[{type:n.Inject,args:[n.forwardRef(function(){return h})]}]}]},t}(l.ArrayTagElement);t.SpreadsheetSheetsDirective=d;var h=function(e){function t(t,i,r,l){var s=e.call(this,"Spreadsheet",t,i,["sheets"],r,l)||this;return s.el=t,s.cdRef=i,s._ejIterableDiffers=r,s._ejkeyvaluediffers=l,s.actionBegin_output=new n.EventEmitter,s.actionComplete_output=new n.EventEmitter,s.autoFillBegin_output=new n.EventEmitter,s.autoFillComplete_output=new n.EventEmitter,s.beforeBatchSave_output=new n.EventEmitter,s.beforeCellFormat_output=new n.EventEmitter,s.beforeCellSelect_output=new n.EventEmitter,s.beforeDrop_output=new n.EventEmitter,s.beforeEditComment_output=new n.EventEmitter,s.beforeOpen_output=new n.EventEmitter,s.beforePanelOpen_output=new n.EventEmitter,s.cellClick_output=new n.EventEmitter,s.cellEdit_output=new n.EventEmitter,s.cellFormatting_output=new n.EventEmitter,s.cellHover_output=new n.EventEmitter,s.cellSave_output=new n.EventEmitter,s.cellSelected_output=new n.EventEmitter,s.contextMenuClick_output=new n.EventEmitter,s.drag_output=new n.EventEmitter,s.dragShape_output=new n.EventEmitter,s.dragStart_output=new n.EventEmitter,s.drop_output=new n.EventEmitter,s.editRangeBegin_output=new n.EventEmitter,s.editRangeComplete_output=new n.EventEmitter,s.keyDown_output=new n.EventEmitter,s.keyUp_output=new n.EventEmitter,s.load_output=new n.EventEmitter,s.loadComplete_output=new n.EventEmitter,s.menuClick_output=new n.EventEmitter,s.onImport_output=new n.EventEmitter,s.openFailure_output=new n.EventEmitter,s.pagerClick_output=new n.EventEmitter,s.resizeStart_output=new n.EventEmitter,s.resizeEnd_output=new n.EventEmitter,s.ribbonClick_output=new n.EventEmitter,s.tabClick_output=new n.EventEmitter,s.tabSelect_output=new n.EventEmitter,s}return r(t,e),t.decorators=[{type:n.Component,args:[{selector:"ej-spreadsheet",template:""}]}],t.ctorParameters=function(){return[{type:n.ElementRef},{type:n.ChangeDetectorRef},{type:n.IterableDiffers},{type:n.KeyValueDiffers}]},t.propDecorators={activeSheetIndex_input:[{type:n.Input,args:["activeSheetIndex"]}],allowAutoCellType_input:[{type:n.Input,args:["allowAutoCellType"]}],allowAutoFill_input:[{type:n.Input,args:["allowAutoFill"]}],allowAutoSum_input:[{type:n.Input,args:["allowAutoSum"]}],allowCellFormatting_input:[{type:n.Input,args:["allowCellFormatting"]}],allowCellType_input:[{type:n.Input,args:["allowCellType"]}],allowCharts_input:[{type:n.Input,args:["allowCharts"]}],allowClear_input:[{type:n.Input,args:["allowClear"]}],allowClipboard_input:[{type:n.Input,args:["allowClipboard"]}],allowComments_input:[{type:n.Input,args:["allowComments"]}],allowConditionalFormats_input:[{type:n.Input,args:["allowConditionalFormats"]}],allowDataValidation_input:[{type:n.Input,args:["allowDataValidation"]}],allowDelete_input:[{type:n.Input,args:["allowDelete"]}],allowDragAndDrop_input:[{type:n.Input,args:["allowDragAndDrop"]}],allowEditing_input:[{type:n.Input,args:["allowEditing"]}],allowFiltering_input:[{type:n.Input,args:["allowFiltering"]}],allowFormatAsTable_input:[{type:n.Input,args:["allowFormatAsTable"]}],allowFormatPainter_input:[{type:n.Input,args:["allowFormatPainter"]}],allowFormulaBar_input:[{type:n.Input,args:["allowFormulaBar"]}],allowFreezing_input:[{type:n.Input,args:["allowFreezing"]}],allowHyperlink_input:[{type:n.Input,args:["allowHyperlink"]}],allowImport_input:[{type:n.Input,args:["allowImport"]}],allowInsert_input:[{type:n.Input,args:["allowInsert"]}],allowKeyboardNavigation_input:[{type:n.Input,args:["allowKeyboardNavigation"]}],allowLockCell_input:[{type:n.Input,args:["allowLockCell"]}],allowMerging_input:[{type:n.Input,args:["allowMerging"]}],allowOverflow_input:[{type:n.Input,args:["allowOverflow"]}],allowResizing_input:[{type:n.Input,args:["allowResizing"]}],allowSearching_input:[{type:n.Input,args:["allowSearching"]}],allowSelection_input:[{type:n.Input,args:["allowSelection"]}],allowSorting_input:[{type:n.Input,args:["allowSorting"]}],allowSparkline_input:[{type:n.Input,args:["allowSparkline"]}],allowUndoRedo_input:[{type:n.Input,args:["allowUndoRedo"]}],allowWrap_input:[{type:n.Input,args:["allowWrap"]}],apWidth_input:[{type:n.Input,args:["apWidth"]}],autoFillSettings_input:[{type:n.Input,args:["autoFillSettings"]}],chartSettings_input:[{type:n.Input,args:["chartSettings"]}],columnCount_input:[{type:n.Input,args:["columnCount"]}],columnWidth_input:[{type:n.Input,args:["columnWidth"]}],cssClass_input:[{type:n.Input,args:["cssClass"]}],customFormulas_input:[{type:n.Input,args:["customFormulas"]}],enableContextMenu_input:[{type:n.Input,args:["enableContextMenu"]}],enablePivotTable_input:[{type:n.Input,args:["enablePivotTable"]}],enableTouch_input:[{type:n.Input,args:["enableTouch"]}],exportSettings_input:[{type:n.Input,args:["exportSettings"]}],formatSettings_input:[{type:n.Input,args:["formatSettings"]}],importSettings_input:[{type:n.Input,args:["importSettings"]}],isImport_input:[{type:n.Input,args:["isImport"]}],isReadOnly_input:[{type:n.Input,args:["isReadOnly"]}],locale_input:[{type:n.Input,args:["locale"]}],pictureSettings_input:[{type:n.Input,args:["pictureSettings"]}],printSettings_input:[{type:n.Input,args:["printSettings"]}],ribbonSettings_input:[{type:n.Input,args:["ribbonSettings"]}],rowCount_input:[{type:n.Input,args:["rowCount"]}],rowHeight_input:[{type:n.Input,args:["rowHeight"]}],scrollSettings_input:[{type:n.Input,args:["scrollSettings"]}],selectionSettings_input:[{type:n.Input,args:["selectionSettings"]}],sheetCount_input:[{type:n.Input,args:["sheetCount"]}],showPager_input:[{type:n.Input,args:["showPager"]}],showRibbon_input:[{type:n.Input,args:["showRibbon"]}],undoRedoStep_input:[{type:n.Input,args:["undoRedoStep"]}],userName_input:[{type:n.Input,args:["userName"]}],autoFillSettings_fillType_input:[{type:n.Input,args:["autoFillSettings.fillType"]}],autoFillSettings_showFillOptions_input:[{type:n.Input,args:["autoFillSettings.showFillOptions"]}],chartSettings_height_input:[{type:n.Input,args:["chartSettings.height"]}],chartSettings_width_input:[{type:n.Input,args:["chartSettings.width"]}],exportSettings_allowExporting_input:[{type:n.Input,args:["exportSettings.allowExporting"]}],exportSettings_enableFormulaCalculation_input:[{type:n.Input,args:["exportSettings.enableFormulaCalculation"]}],exportSettings_csvUrl_input:[{type:n.Input,args:["exportSettings.csvUrl"]}],exportSettings_excelUrl_input:[{type:n.Input,args:["exportSettings.excelUrl"]}],exportSettings_password_input:[{type:n.Input,args:["exportSettings.password"]}],exportSettings_pdfUrl_input:[{type:n.Input,args:["exportSettings.pdfUrl"]}],formatSettings_allowCellBorder_input:[{type:n.Input,args:["formatSettings.allowCellBorder"]}],formatSettings_allowDecimalPlaces_input:[{type:n.Input,args:["formatSettings.allowDecimalPlaces"]}],formatSettings_allowFontFamily_input:[{type:n.Input,args:["formatSettings.allowFontFamily"]}],importSettings_importMapper_input:[{type:n.Input,args:["importSettings.importMapper"]}],importSettings_importOnLoad_input:[{type:n.Input,args:["importSettings.importOnLoad"]}],importSettings_importUrl_input:[{type:n.Input,args:["importSettings.importUrl"]}],importSettings_password_input:[{type:n.Input,args:["importSettings.password"]}],pictureSettings_allowPictures_input:[{type:n.Input,args:["pictureSettings.allowPictures"]}],pictureSettings_height_input:[{type:n.Input,args:["pictureSettings.height"]}],pictureSettings_width_input:[{type:n.Input,args:["pictureSettings.width"]}],printSettings_allowPageSetup_input:[{type:n.Input,args:["printSettings.allowPageSetup"]}],printSettings_allowPageSize_input:[{type:n.Input,args:["printSettings.allowPageSize"]}],printSettings_allowPrinting_input:[{type:n.Input,args:["printSettings.allowPrinting"]}],ribbonSettings_applicationTab_input:[{type:n.Input,args:["ribbonSettings.applicationTab"]}],ribbonSettings_applicationTab_type_input:[{type:n.Input,args:["ribbonSettings.applicationTab.type"]}],ribbonSettings_applicationTab_menuSettings_input:[{type:n.Input,args:["ribbonSettings.applicationTab.menuSettings"]}],scrollSettings_allowScrolling_input:[{type:n.Input,args:["scrollSettings.allowScrolling"]}],scrollSettings_allowSheetOnDemand_input:[{type:n.Input,args:["scrollSettings.allowSheetOnDemand"]}],scrollSettings_allowVirtualScrolling_input:[{type:n.Input,args:["scrollSettings.allowVirtualScrolling"]}],scrollSettings_height_input:[{type:n.Input,args:["scrollSettings.height"]}],scrollSettings_isResponsive_input:[{type:n.Input,args:["scrollSettings.isResponsive"]}],scrollSettings_scrollMode_input:[{type:n.Input,args:["scrollSettings.scrollMode"]}],scrollSettings_width_input:[{type:n.Input,args:["scrollSettings.width"]}],selectionSettings_activeCell_input:[{type:n.Input,args:["selectionSettings.activeCell"]}],selectionSettings_animationTime_input:[{type:n.Input,args:["selectionSettings.animationTime"]}],selectionSettings_enableAnimation_input:[{type:n.Input,args:["selectionSettings.enableAnimation"]}],selectionSettings_selectionType_input:[{type:n.Input,args:["selectionSettings.selectionType"]}],selectionSettings_selectionUnit_input:[{type:n.Input,args:["selectionSettings.selectionUnit"]}],nameManager_input:[{type:n.Input,args:["nameManager"]}],sheets_input:[{type:n.Input,args:["sheets"]}],sheets_rows_cells_input:[{type:n.Input,args:["sheets.rows.cells"]}],options:[{type:n.Input,args:["options"]}],actionBegin_output:[{type:n.Output,args:["actionBegin"]}],actionComplete_output:[{type:n.Output,args:["actionComplete"]}],autoFillBegin_output:[{type:n.Output,args:["autoFillBegin"]}],autoFillComplete_output:[{type:n.Output,args:["autoFillComplete"]}],beforeBatchSave_output:[{type:n.Output,args:["beforeBatchSave"]}],beforeCellFormat_output:[{type:n.Output,args:["beforeCellFormat"]}],beforeCellSelect_output:[{type:n.Output,args:["beforeCellSelect"]}],beforeDrop_output:[{type:n.Output,args:["beforeDrop"]}],beforeEditComment_output:[{type:n.Output,args:["beforeEditComment"]}],beforeOpen_output:[{type:n.Output,args:["beforeOpen"]}],beforePanelOpen_output:[{type:n.Output,args:["beforePanelOpen"]}],cellClick_output:[{type:n.Output,args:["cellClick"]}],cellEdit_output:[{type:n.Output,args:["cellEdit"]}],cellFormatting_output:[{type:n.Output,args:["cellFormatting"]}],cellHover_output:[{type:n.Output,args:["cellHover"]}],cellSave_output:[{type:n.Output,args:["cellSave"]}],cellSelected_output:[{type:n.Output,args:["cellSelected"]}],contextMenuClick_output:[{type:n.Output,args:["contextMenuClick"]}],drag_output:[{type:n.Output,args:["drag"]}],dragShape_output:[{type:n.Output,args:["dragShape"]}],dragStart_output:[{type:n.Output,args:["dragStart"]}],drop_output:[{type:n.Output,args:["drop"]}],editRangeBegin_output:[{type:n.Output,args:["editRangeBegin"]}],editRangeComplete_output:[{type:n.Output,args:["editRangeComplete"]}],keyDown_output:[{type:n.Output,args:["keyDown"]}],keyUp_output:[{type:n.Output,args:["keyUp"]}],load_output:[{type:n.Output,args:["load"]}],loadComplete_output:[{type:n.Output,args:["loadComplete"]}],menuClick_output:[{type:n.Output,args:["menuClick"]}],onImport_output:[{type:n.Output,args:["onImport"]}],openFailure_output:[{type:n.Output,args:["openFailure"]}],pagerClick_output:[{type:n.Output,args:["pagerClick"]}],resizeStart_output:[{type:n.Output,args:["resizeStart"]}],resizeEnd_output:[{type:n.Output,args:["resizeEnd"]}],ribbonClick_output:[{type:n.Output,args:["ribbonClick"]}],tabClick_output:[{type:n.Output,args:["tabClick"]}],tabSelect_output:[{type:n.Output,args:["tabSelect"]}],tag_sheets:[{type:n.ContentChild,args:[d]}]},t}(l.EJComponents);t.SpreadsheetComponent=h,t.EJ_SPREADSHEET_COMPONENTS=[h,o,d,s,a]},1919:function(e,t){e.exports='\r\n<ej-spreadsheet id="spreadsheet" scrollSettings.height="530" scrollSettings.width="100%" [showRibbon] ="false" [enableContextMenu]="false" [allowFormulaBar]="false" [sheets]="spreadData" (loadComplete)= loadComplete($event)> \r\n</ej-spreadsheet>'},1920:function(e,t){e.exports='\r\n<ej-spreadsheet id="spreadsheet" scrollSettings.height="530" scrollSettings.width="100%" [showRibbon] ="false" [enableContextMenu]="false" [allowFormulaBar]="false" (loadComplete)= loadComplete($event)>\r\n    <e-sheets>\r\n        <e-sheet>\r\n            <e-rangesettings>\r\n                <e-rangesetting [dataSource]="spreadData" startCell="A1" [headerStyles]="{\'font-weight\':\'bold\'}" [showHeader]="false"></e-rangesetting>\r\n            </e-rangesettings>\r\n        </e-sheet>\r\n    </e-sheets>\r\n</ej-spreadsheet>'},1921:function(e,t){e.exports='<ej-spreadsheet id="spreadsheet" scrollSettings.height="530" scrollSettings.width="100%" importSettings.importMapper="//js.syncfusion.com/demos/ejservices/api/Spreadsheet/Import" exportSettings.excelUrl="//js.syncfusion.com/demos/ejservices/api/Spreadsheet/ExcelExport" exportSettings.csvUrl="//js.syncfusion.com/demos/ejservices/api/Spreadsheet/CsvExport" exportSettings.pdfUrl="//js.syncfusion.com/demos/ejservices/api/Spreadsheet/PdfExport" (loadComplete)= loadComplete($event)>\r\n    <e-sheets>\r\n        <e-sheet [columnWidth]=\'150\'>\r\n            <e-rangesettings>\r\n                <e-rangesetting [dataSource]="spreadData" startCell="A1" [headerStyles]="{\'font-weight\':\'bold\'}"></e-rangesetting>\r\n            </e-rangesettings>\r\n        </e-sheet>\r\n    </e-sheets>\r\n</ej-spreadsheet>'},2036:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
*  filename: ej.calculate.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.calculate.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(4)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=e)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(function(){var LookupCachingMode,CalcQuickBase,FormulaInfoSetAction,FormulaInfoHashtable,HashTable;(function($,ej,undefined){window.__calcQuickextends=function(e,t){function i(){this.constructor=e}for(var r=0;r<t.length;r++)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},window.CalcEngine=function(parentObject){function _getLocaleNumberValue(e){if(e="object"!=typeof e&&Number(e)?Number(e):ej.isNullOrUndefined(e)||"object"==typeof e?null:ej.parseFloat(e+"",ej.cultureObject.name)){var t=ej.preferredCulture(ej.cultureObject.name).numberFormat,i=e.toString();"."!=t["."]&&i.indexOf(t["."])<0&&(e=i.replace(".",t["."]))}return ej.isNullOrUndefined(e)?NaN:e.toString()}function _calculateDate(e){return e<10?"0"+e:e}function StringBuilder(){this.strings=[""],this.append=function(e){e&&this.strings.push(e)},this.toString=function(){return this.strings.join("")}}var _weekEndType,FormulaArgumentType,needToContinue;this.parentObject=parentObject,this._useFormulaValues=!1,this._multiTick=!1,this._isErrorString=!1,this._ignoreBracet=!1,this._libraryFunctions=new HashTable,this._customlibraryFunctions=new HashTable,this._refreshedCells=new HashTable,this._treatStringsAsZero=!0,this._supportLogicalOperators=!1,this._isRangeOperand=!1,this._uniqueStringMarker=String.fromCharCode(127),this._isParseArgumentSeparator=!1,this._isParseDecimalSeparatorChanged=!1,this._enableFormulaErrorValidation=!1,this._validPrecedingChars=" (+-*/^&<>=",this._validFunctionNameChars="_",this.bMARKER=String.fromCharCode(146),this.bMARKER2=this.bMARKER+this.bMARKER,this.tic='"',this._parseDecimalSeparator=".",this.parseDateTimeSeparator="/",this._parseArgumentSeparator=",",this._rightBracket=String.fromCharCode(131),this._leftBracket=String.fromCharCode(130),this.iFMarker="qIF"+String.fromCharCode(130),this.braceLeft="{",this.braceRight="}",this._braceRightNLeft=")(",this.computedValueLevel=0,this._circCheckList=[],this._maximumRecursiveCalls=100,this._sortedSheetNames=null,this.trueValueStr="TRUE",this.falseValueStr="FALSE",this.useDatesInCalcs=!1,this.sheetToken="!",this.namedRanges=null,this.undefinednamedRange=null,this.undefinedsheetNamedRnages=null,this.namerangecellcollection=null,this.sheetNamedRangesOriginalNames=null,this.sheetNamedRangeCellCollection=null,this.sheetDependentNamedRangeCells=null,this.namedRangesOriginalNames=null,this.namedRangeValues=null,this.rangeValues=null,this.dependentNamedRangeCells=null,this.namedRangesSized=null,this._namedRangesNonScoped=null,this.char_add="+",this.char_and="i",this.char_ANDop=String.fromCharCode(140),this.char_divide="/",this.char_ELSEop=String.fromCharCode(144),this.char_EM="r",this.char_EP="x",this.char_equal="=",this.char_greater=">",this.char_greatereq="h",this.char_IFop=String.fromCharCode(142),this.char_less="<",this.char_lesseq="f",this.char_multiply="*",this.char_noequal="p",this.char_NOTop=String.fromCharCode(145),this.char_or="w",this.char_ORop=String.fromCharCode(139),this.char_subtract="-",this.char_THENop=String.fromCharCode(143),this.char_XORop=String.fromCharCode(141),this.chartic="'"[0],this._string_and="&",this._string_E="E",this._string_EM="E-",this._string_empty="",this._string_EP="E+",this._string_fixedreference="$",this._string_greatereq=">=",this._string_lesseq="<=",this._string_noequal="<>",this._string_or="^",this.token_add="a",this.token_and="c",this.token_ANDop=String.fromCharCode(133),this.token_divide="d",this.token_ELSEop=String.fromCharCode(137),this.token_EM="v",this.token_EP="t",this.token_equal="e",this.token_greater="g",this.token_greatereq="j",this.token_IFop=String.fromCharCode(135),this.token_less="l",this.token_lesseq="k",this.token_multiply="m",this.token_noequal="o",this.token_NOTop=String.fromCharCode(138),this.token_or=String.fromCharCode(126),this.token_ORop=String.fromCharCode(132),this.token_subtract="s",this.token_THENop=String.fromCharCode(136),this.token_XORop=String.fromCharCode(134),this.tokens=[this.token_add,this.token_subtract,this.token_multiply,this.token_divide,this.token_less,this.token_greater,this.token_equal,this.token_lesseq,this.token_greatereq,this.token_noequal,this.token_and,this.token_or],this._dateTime1900=new Date(1900,0,1,0,0,0),this._preserveLeadingZeros=!1,this._ignoreCellValue=!1,this._errorStrings=null,this.cell="",this._iterationMaxCount=0,this._supportRangeOperands=!1,this._allowShortCircuitIFs=!1,this._processUpperCaseFormula="",this._processUpperCaseIvalue=0,this._processUpperCaseSheet="",this._markerChar="`",this._rowMaxCount=-1,this._columnMaxCount=-1,this._isInteriorFunction=!1,this._tempSheetPlaceHolder=String.fromCharCode(133),this.sheetFamilyID=0,this._supportsSheetRanges=!0,this._markers="()+-*/=><.,!",this._formulaInfoTable=null,this._dependentFormulaCells=null,this._dependentCells=new HashTable,this._calculatingSuspended=!1,this._inAPull=!1,this._useDatesInCalcs=!1,this._excelLikeComputations=!1,this._rethrowLibraryComputationExceptions=!1,this.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control named '{0}' is already registered","Calculation overflow","Missing sheet"],this._parseDateTimeSeparator="/",this._millisecondsOfaDay=864e5,this.treat1900AsLeapYear=!1,this._oaDate=new Date(1899,11,30),this._saveStringsText="",this._processedCells=[],this.ignoreValueChanged=!1,this._breakedFormulaCells=[],this._tempBreakedFormulaCells=[],this._lockDependencies=!1,this._useDependencies=!1,this._inHandleIterations=!1,this._inRecalculateRange=!1,this._useNoAmpersandQuotes=!1,this._calcID=0,this._operators_cannot_start_an_expression=0,this._reservedWord_AND=1,this._reservedWord_XOR=2,this._reservedWord_IF=3,this._number_contains_2_decimal_points=4,this._reservedWord_ELSE=5,this._reservedWord_NOT=6,this._invalid_char_in_number=7,this._invalid_characters_following_an_operator=6,this._mismatched_parentheses=8,this._unknown_formula_name=9,this._requires_a_single_argument=10,this._requires_3_args=11,this._invalid_Math_argument=12,this._requires_2_args=13,this._bad_index=14,this._too_complex=15,this._circular_reference_=16,this._missing_formula=17,this._improper_formula=18,this._invalid_expression=19,this._cell_empty=20,this._bad_formula=21,this._empty_expression=22,this._virtual_mode_required=23,this._mismatched_tics=24,this._wrong_number_arguments=25,this._invalid_arguments=26,this._iterations_dont_converge=27,this._calculation_overflow=29,this._already_registered=28,this._missing_sheet=30,this._alwaysComputeDuringRefresh=!0,this._libraryComputationException=null,this._dependencyLevel=0,this._isDisposed=undefined,this._forceRefreshCall=!1,this.grid=this.parentObject,this._enableLookupTableCaching=0,this._lookupTables=new HashTable,this._isIE8="msie"==ej.browserInfo().name&&"8.0"==ej.browserInfo().version,this._acc=4,this._bingo=1e10,this._bigni=1e-10,this.machineepsilon=5e-16,this.maxrealnumber=1e300,this.minrealnumber=1e-300,this.nativeFormats=[],this.nativeFormats.push("[DBNUM1]"),this.nativeFormats.push("[DBNUM2]"),this.nativeFormats.push("[DBNUM3]"),this.nativeFormats.push("[DBNUM4]"),this.computeFunctionLevel=0,this._table_Data="[#Data]",this._table_Row="[#THIS ROW]",this._table_Headers="[#Headers]",this._table_Totals="[#Totals]",this._table_All="[#All]",this._isArrayFormula=!1,this._getPositionHeight=0,this._getPositionWidth=0,this._calculateArraySizeheight=0,this._calculateArraySizewidth=0,this._calculateArraySizeminHeight=0,this._calculateArraySizeminWidth=0,this._length=0,this._arrayMarkers="+-*/&",this._validFunctionNameChars="_",this._findNamedRange=!1,this._addFunction=function(e,t){return e=e.toUpperCase(),this._libraryFunctions.getItem(e)==undefined&&(this._libraryFunctions.add(e,t),!0)},this._addToFormulaDependentCells=function(e){var t=this.cell,i=CalcEngine.getSheetFamilyItem(this.grid);null!=i.sheetNameToParentObject&&-1==t.indexOf(this.sheetToken)&&(t=i.parentObjectToToken.getItem(this.grid)+t),this.getDependentFormulaCells().containsKey(t)?this.getDependentFormulaCells().getItem(t).containsKey(e)||this.getDependentFormulaCells().getItem(t).add(e,e):(this.getDependentFormulaCells().add(t,new HashTable),this.getDependentFormulaCells().getItem(t).add(e,e))},this._arrayRemove=function(e,t){for(var i=null;-1!==(i=e.indexOf(t));)e.splice(i,1);return e},this._canGetRowIndex=function(e){var t=0;if(t<e.length&&e[t]==this.sheetToken){for(t++;t<e.length&&e[t]!=this.sheetToken;)t++;t++}for(;t<e.length&&this._isLetter(e[t]);)t++;return t<e.length&&!!this._isDigit(e[t])},this._checkAddNonScopedNamedRange=function(e){var t,i;(t=e.indexOf("!"))>-1&&(i=e.substring(t+1),this._namedRangesNonScoped.containsKey(i)||this._namedRangesNonScoped.add(i,this.namedRanges.getItem(e)))},this._checkHasCharBeforeNumber=function(e){for(var t=!1,i=e.length-1;i>0;i--)if(this._isLetter(e[i])){t=!0;break}return t},this._checkIfScopedRange=function(e,t){var i,r,l,n,s,o;var a="NaN",d=this.getSheetID(this.grid),h=CalcEngine.getSheetFamilyItem(this.grid);if(e[0]==this.sheetToken.toString()&&(i=e.indexOf(this.sheetToken,1),r=parseInt(e.substr(1,i-1)),i>1&&!isNaN(r)&&(e=e.substring(i+1),d=r)),l="!"+d.toString()+"!",null==h||null==h.sheetNameToToken)return a;for(n=h.sheetNameToToken.keys(),s=0;s<n.length;s++)h.sheetNameToToken.getItem(n[s]).toString()==l&&(o=ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName?(n[s]+"!"+e).toUpperCase():(this.parentObject.model.sheets[s+1].sheetInfo.text+"!"+e).toUpperCase(),this.getNamedRanges().containsKey(o)&&(a=this.getNamedRanges().getItem(o).toUpperCase()));return a},this._checkUnderTolerance=function(e,t){return Math.abs(t)>this._absoluteZero?Math.abs((e-t)/t)<this._iterationMaxTolerance:Math.abs(e-t)<this._iterationMaxTolerance},this._combineStack=function(e,t,i){var r,l,n,s="";if(2==i.length){for(r=3,l=e.substring(t);r>1;)s=(n=i.pop().toString())==this.tic+this.tic?s+this.tic:n+s,l=3==r?n:l,r--;i[0]==this.tic+this.tic&&i.pop(),s=e.length==t&&this._isTextEmpty(l.split(this.tic).join(""))?s+l:s,i.push(s)}return i},this._computeMath=function(e,t){var i,r,l,n,s,o,a,d,h,c,u=0,g=!1;if(e.length>0&&(e=this.splitArgsPreservingQuotedCommas(e)[0]),r=[this.getParseArgumentSeparator(),":"],e.length>0&&(!this._isLetter(e[0])&&e[0]!=this.sheetToken&&e[0]!=this.bMARKER||"u"==e[0]&&this._isDigit(e[1]))&&-1==this._indexOfAny(e,r)){if(e=e.split("u").join("-").split("n").join(""),l=this._parseDouble(e),isNaN(l))return this.getErrorStrings()[1].toString();u=t(l)}else if(e.length>0&&(e[0]==this.bMARKER||"u"==e[0]||"n"==e[0]||this._indexOfAny(e,this.tokens)>-1)){e=(e=e.split("{").join("(")).split("}").join(")"),n="",s=Math.PI.toString();try{e.indexOf(s)>-1?(i=this._substring(e,1,e.indexOf(s)-2),i=this._isTextEmpty(i)?"1":i,n=this._indexOfAny(e,this.tokens)>-1?e.split(s.toString())[1]:"1",g=!0):i=this.computedValue(e)}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(g)if(o=this.computedValue(i.toString()),n.indexOf("180")>-1){if(!(l=this._parseDouble(o)))return this.getErrorStrings()[1].toString();u=t(l*(Math.PI/180))}else{if(a=this.computedValue(o+n),d=this._parseDouble(a),isNaN(d))return this.getErrorStrings()[1].toString();u=t(d*Math.PI)}else{if(l=this._parseDouble(i),isNaN(l))return this.getErrorStrings()[1].toString();u=t(l)}}else for(e=e.split("u").join("-"),h=this.getCellsFromArgs(e),c=0;c<h.length;c++){try{i=this.getValueFromArg(h[c])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(i.length>0){if(l=this._parseDouble(i),isNaN(l))return this.getErrorStrings()[1].toString();u=t(l)}break}return this.computeIsErr(u.toString())==this.trueValueStr?this.getErrorStrings()[4].toString():u.toString()},this._computeInteriorFunctions=function(e){var t,i,l,n,s,o,a,d;try{if(this._isTextEmpty(e))return e;for(this.computeFunctionLevel++,t=this._findLastqNotInBrackets(e);t>0;){if(-1==(i=e.substring(t).indexOf(this._rightBracket)))throw this.formulaErrorStrings[this._bad_formula];if(this._isInteriorFunction=!0,l=this._substring(e,t,i+1),l=this.computedValue(l),ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName)""==l||l[0]!=this.tic[0]||l[l.length-1]!=this.tic[0]||(-1!=(d=this._substring(l,1,l.length-2)).indexOf(this.tic)&&(this._multiTick=!0,d=d.split(this.tic).join("|")),l=this.tic+d+this.tic),this._isInteriorFunction||(l=this._markupResultToIncludeInFormula(l));else if("-"==l[0])l="nu"+l.substring(1);else if(l.length>0&&(l[0]==this.tic[0]||"#"==l[0]))l.length>1&&l[0]==this.bmarker&&l[1]==this.bmarker&&(l=this.tic+l+this.tic);else if(!l.startsWith(this.trueValueStr)&&!l.startsWith(this.falseValueStr))if(n=this._parseDouble(l),isNaN(n))if(this._isRange(l)||l[0]!=this.braceLeft||l[l.length-1]!=this.braceRight)this._isRange(l)||(l=this.tic+l+this.tic);else{for(l=l.Replace("{","").Replace("}",""),s=string.Empty,o=this.splitArgsPreservingQuotedCommas(l),a=0;a<o.length;a++)0,!isNaN(this.parseDouble(o[a]))&&(s+="n"+r+this._parseArgumentSeparator);l=s.substr(0,s.Length-1)}else l=n<0?"nu"+l.substring(1):"n"+l;e=e.substring(0,t)+l+e.substring(t+i+1),this._isInteriorFunction=!1,t=this._findLastqNotInBrackets(e)}}catch(e){return e}finally{this.computeFunctionLevel--}return e},this._computeArrayInteriorFunction=function(e,t,i){var r=this._string_empty;return"LEN"==t?r=this._computeArrayLen(e,i):"ROW"==t?r=this._computeArrayRow(e,i):"COLUMN"==t&&(r=this._computeArrayColumn(e,i)),i>0?"{"+r+"}":r},this._parseLibraryFormula=function(e){var t,i,r,l,n,s,o,a;if(e.length>0&&(e=e.substr(1,e.length-2)),t=e,"{"==(e=this._checkForNamedRange(e))[0]&&"}"==e[e.length-1]||this._findNamedRange)return this._parseDimensionalArray(e);if(i=this._saveStrings(e),-1==(r=(e=(e=this._saveStringsText).split(" ").join(this._string_empty).split("{").join('"[').split("}").join(']"')).indexOf(")")))e=this._parseArrayFormula(e,t);else for(;r>-1;){for(l=0,n=r-1;n>-1&&("("!=e[n]||0!=l);)")"==e[n]&&l++,n--;if(-1==n)return this.getErrorStrings()[0].toString();for(s=n-1;s>-1&&(this._isLetterOrDigit(e[s])||this._validFunctionNameChars.indexOf(e[s])>-1||e[s]==this._parseDecimalSeparator);)s--;(o=n-s-1)>0&&null!=this.getLibraryFunctions().getItem(e.substr(s+1,o).toUpperCase())?(a=e.substr(n,r-n+1),a=this._parseArrayFormula(a,t),e=e.substr(0,s+1)+e.substr(s+1,o)+a.split("(").join("{").split(")").join("}")+e.substr(r+1)):e=0==o?this._parseArrayFormula(e,t).split("(").join("{").split(")").join("}"):e.split("(").join("{").split(")").join("}"),r=e.indexOf(")")}return null!=i&&i.length>0&&(e=this._setStrings(e,i)),e=e.split("{").join("(").split("}").join(")"),this._isMultiCellArray(t)&&(e=this._parseMultiCellArray(e,t)),e},this._parseArrayFormula=function(e,t){var i,r,l,n,s,o,a,d=e,h=this._string_empty,c=(this._string_empty,null);if(this._indexOfAny(e,this._arrayMarkers)<0)return e;if(d.indexOf(this._parseArgumentSeparator.toString())>-1){for(d=d.split("{").join('"{').split("}").join('}"'),c=this.splitArgsPreservingQuotedCommas(d),l=0;l<c.length;l++)this._indexOfAny(c[l],this._arrayMarkers)>-1&&-1==c[l].indexOf('"')&&(h=d=c[l]);if(h==this._string_empty&&(1!=c.length&&this._indexOfAny(c[0],this._arrayMarkers)<0||c[0].indexOf('"{')>-1&&c[0].indexOf('}"')>-1))return e}d=(d=d.split("(").join(this._string_empty).split(")").join(this._string_empty)).split('"').join(this._string_empty);var u=this._resizeCellRange(d,t),g=[],p=this._string_empty,m=this._string_empty;for(0==length&&(length=u[0].length),i=u.length,r=0,l=0;l<length;l++){for(r=l,n="",s=0;s<i;s++)1==u[s].length&&(l=0),n+=u[s][l],l=r;g.push(n)}for(o=0;o<g.length;o++)m+=g[o]+this._parseArgumentSeparator;if(null!=c&&c.length>1)for(a=0;a<c.length;a++)p+=c[a]==h?0==a?"("+m.substr(0,m.length-1):this._parseArgumentSeparator+m.substr(0,m.length-1)+")":0==a?c[a]:this._parseArgumentSeparator+c[a];else p+="("+m.substr(0,m.length-1)+")";return p.split('"').join(this._string_empty)},this._isMultiCellArray=function(e){var t,i,r,l;for("("==e[0]&&")"==e[e.length-1]&&(e=e.substr(1,e.length-2)),t=!1,i=this._splitString(e),r=0;r<i.length;r++){if((l=i[r]).indexOf("(")>-1&&-1==l.indexOf(")")||-1==l.indexOf("(")&&l.indexOf(")")>-1){t=!1;break}(this._isRange(l.split(this._string_fixedreference).join(this._string_empty))||"{"==l[0]&&"}"==l[l.length-1])&&(t=!0)}return t},this._parseMultiCellArray=function(e,t){var i,r=t,l=this._splitString(t);if(r!=(t=this._markNamedRanges(t)))return this._parseDimensionalArray(e);if(!ej.isNullOrUndefined(this.cell)){var n=this._getHeight(l),s=this._getWidth(l),o=this._getPosition(n,s);n=this._getPositionHeight,s=this._getPositionWidth,this._getWidth(l)>s&&-1!=o&&o>=s&&(o+=o/s*(this._getWidth(l)-s)),o>=0?("("==e[0]&&")"==e[e.length-1]&&(e=e.substr(1,e.length-2)),(i=this.splitArgsPreservingQuotedCommas(e)).length>o&&(e=i[o])):e=this.getErrorStrings()[0].toString()}return e},this._getWidth=function(e){var t,i,r=0,l=this._string_empty,n=0;for(e[0]=e[0].split(this._string_fixedreference).join(this._string_empty),this._isCellReference(e[0])?(l=this.computeColumns(e[0]),r=parseInt(l)):e[0].indexOf(",")>-1&&-1==e[0].indexOf(";")?r=this.splitArgsPreservingQuotedCommas(e[0]).length:e[0].indexOf(";")>-1&&-1==e[0].indexOf(",")&&(r=1),t=0;t<e.length;t++)e[t]=e[t].split(this._string_fixedreference).join(this._string_empty),0==r&&(r=1),this._isCellReference(e[t])?(l=this.computeColumns(e[t]),i=parseInt(l),isNaN(i)||(n=i)):e[t].indexOf(",")>-1&&-1==e[t].indexOf(";")?n=this.splitArgsPreservingQuotedCommas(e[t]).length:e[t].indexOf(";")>-1&&-1==e[t].indexOf(",")&&(n=1),0!=n&&(1==r||n<r&&1!=n)&&(r=n);return r},this._getHeight=function(e){var t,i=0,r=this._string_empty,l=0;for(e[0]=e[0].split(this._string_fixedreference).join(this._string_empty),this._isCellReference(e[0])?(r=this.computeRows(e[0]),i=parseInt(r)):e[0].indexOf(",")>-1&&-1==e[0].indexOf(";")?i=1:e[0].indexOf(";")>-1&&-1==e[0].indexOf(",")&&(i=this._splitArguments(e[0],";").length),t=0;t<e.length;t++)0==i&&(i=1),e[t]=e[t].split(this._string_fixedreference).join(this._string_empty),this._isCellReference(e[t])?(r=this.computeRows(e[t]),l=parseInt(r),isNaN(l)&&(l=0)):e[t].indexOf(",")>-1&&-1==e[t].indexOf(";")?l=1:e[t].indexOf(";")>-1&&-1==e[t].indexOf(",")&&(l=this._splitArguments(e[t],";").length),0!=l&&(1==i||i<i&&1!=i)&&(i=l);return i},this._getPosition=function(e,t){var i=this.rowIndex(this.cell),r=this.colIndex(this.cell);return this._getPositionHeight=e,this._getPositionWidth=t,ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName?0:this.parentObject.XLEdit._getCellPosition(e,t)[i-1][r-1]},this._resizeCellRange=function(e){var t,i,r,l=[],n=this._splitString(e),s=(this._string_empty,this._getHeight(n)),o=this._getWidth(n),a=0,d=0;for(length=s*o,t=0;t<n.length;t++)if(this._indexOfAny(n[t],this._arrayMarkers)>-1||!this._isCellReference(n[t])?"["==n[t][0]&&"]"==n[t][n[t].length-1]?(n[t]=n[t].substr(1,n[t].length-2),n[t].indexOf(",")>-1?(n[t]=this._calculateArraySize(n[t],s,o,a,d),l.push(this.splitArgsPreservingQuotedCommas(n[t]))):n[t].indexOf(";")>-1&&(n[t]=this._calculateArraySize(n[t],s,o,a,d),l.push(this._splitArguments(n[t],";"))),s=this._calculateArraySizeheight,o=this._calculateArraySizewidth,a=this._calculateArraySizeminHeight,d=this._calculateArraySizeminWidth):(l.push([n[t]]),this._indexOfAny(n[t],this._arrayMarkers)<0&&(a=1)):(n[t]=this._calculateArraySize(n[t],s,o,a,d),l.push(this.getCellsFromArgs(n[t])),s=this._calculateArraySizeheight,o=this._calculateArraySizewidth,a=this._calculateArraySizeminHeight,d=this._calculateArraySizeminWidth),l[t].length<length&&this._indexOfAny(n[t],this._arrayMarkers)<0){var h=l[t].slice(),c=l[t].length,u=0;if(h.length=length,0!=d&&d<o)for(u=0,r=0,i=0;i<length;){for(;r<o&&i<length;)u>=c&&(u=0),h[i]=l[t][u],r++,i++;u++,r=0}if(0!=a&&a<s)for(u=0,r=c;r<length;r++)u>=c&&(u=0),h[r]=l[t][u],u++;l[t]=h}return l},this._parseDimensionalArray=function(e){var t,i,r,l,n,s;if(t=e=e.split(" ").join(this._string_empty),this._indexOfAny(e,this._arrayMarkers)>-1&&(e=e.split("{").join('"[').split("}").join(']"'),e=this._parseArrayFormula(e,t).split("(").join("{").split(")").join("}")),"{"==e[0]&&"}"==e[e.length-1]&&(e=e.substr(1,e.length-2)),1==e.Length)return e;if(i=e.indexOf(":"),this._isCellReference(e)&&i>-1){var o=this.getCellsFromArgs(e),a=this._string_empty,d=",",h=this.rowIndex(e.substr(0,i)),c=this.rowIndex(e.substr(i+1)),u=this.colIndex(e.substr(0,i)),g=c-h+1,p=this.colIndex(e.substr(i+1))-u+1;for(1==p?d=";":1==g&&(d=","),r=0;r<o.length;r++)a+=o[r]+d;if(t=e=a.substr(0,a.length-1).split(" ").join(this._string_empty),g>1&&p>1)return this._parseRangeArray(e,g,p)}if(t.indexOf(",")>-1&&-1==t.indexOf(";"))return this._parseHorizontalArray(e);if(t.indexOf(";")>-1&&-1==t.indexOf(","))return this._parseVerticalArray(e);if(this._indexOfAny(t,this._arrayMarkers)>-1)return _=this._splitString(t),this._parseRangeArray(e,this._getHeight(_),this._getWidth(_));var m=this._splitArguments(e,";"),_=[],f=[],b=m.length,C=0;for(r=0;r<m.length;r++)l=this.splitArgsPreservingQuotedCommas(m[r]),_.push(l),C=l.length;for(n=0;n<b;n++)for(s=0;s<C;s++)f.push(_[n][s]);if(this.cell==this._string_empty)return f[0];var S=C,x=this._getPosition(b,C);return b=this._getPositionHeight,S>(C=this._getPositionWidth)&&-1!=x&&x>=C&&(x+=x/C*(S-C)),e=x>-1?f[x]:this.getErrorStrings()[0].toString()},this._parseRangeArray=function(e,t,i){var r=this.splitArgsPreservingQuotedCommas(e);if(this.cell==this._string_empty)return r[0];var l=i,n=this._getPosition(t,i);return t=this._getPositionHeight,l>(i=this._getPositionWidth)&&-1!=n&&n>=i&&(n+=n/i*(l-i)),n>-1?r[n]:this.getErrorStrings()[0].toString()},this._parseVerticalArray=function(e){var t,i=16384,r=this._splitArguments(e,";"),l=r.length;return this.cell==this._string_empty?r[0]:(t=this._getPosition(l,i),l=this._getPositionHeight,i=this._getPositionWidth,(t=t>-1?t/i:t)>-1?r[t]:this.getErrorStrings()[0].toString())},this._parseHorizontalArray=function(e){var t,i=1048576,r=this.splitArgsPreservingQuotedCommas(e),l=r.length;return this.cell==this._string_empty?r[0]:(t=this._getPosition(i,l),i=this._getPositionHeight,l=this._getPositionWidth,(t=t>-1?t%l:t)>-1?r[t]:this.getErrorStrings()[0].toString())},this._splitString=function(e){return e=e.split(" ").join(this._string_empty).toUpperCase(),(e=this._markNamedRanges(e)).split(/([-+*/&])/)},this._computeArrayLen=function(e,t){var i,r,l,n,s,o,a,d,h,c=this._string_empty,u=this._string_empty;this._string_empty;if(e.indexOf(":")>-1&&t>0){for(i=this.getCellsFromArgs(e),r=0;r<i.length;r++)(c=this.getValueFromArg(i[r]).split(this.tic).join(this._string_empty))!=this._string_empty&&(u+=c.length+this._parseArgumentSeparator);u=u.substring(0,u.length-1)}else if(t>0){for(h=this.splitArgsPreservingQuotedCommas(e),l=0;l<h.length;l++)(c=this.getValueFromArg(h[l]).split(this.tic).join(this._string_empty))!=this._string_empty&&(u+=c.length.toString()+this._parseArgumentSeparator);u=u.substring(0,u.length-1)}else e.indexOf(":")>-1?this.cell!=this._string_empty?(n=this.getCellsFromArgs(e),s=this.computeRows(e),s=isNaN(s)?0:s,o=this.computeColumns(e),o=isNaN(o)?0:o,a=parseInt(this._getPosition(s,o)),s=this._getPositionHeight,o=this._getPositionWidth,(d=isNaN(a)?-1:a)>=0&&n.length>d?(c=this.getValueFromArg(n[d]).split('"').join(this._string_empty))!=this._string_empty&&(u=c.length.toString()):u=this.getErrorStrings()[0].toString()):u=this._string_empty:(h=this.splitArgsPreservingQuotedCommas(e),(c=this.getValueFromArg(h[0]).split('"').join(this._string_empty))!=this._string_empty&&(u=c.length.toString()));return u},this._computeArrayRow=function(e,t){var i,r,l,n,s,o,a=this._string_empty;e=e.split('"').join(this._string_empty);var d=this.getCellsFromArgs(e),h=this.rowIndex(d[0].toString()),c=this.rowIndex(d[d.length-1].toString());if(t>0){for(l=h;l<=c;l++)a+=l.toString()+this._parseArgumentSeparator;a=a.substr(0,a.length-1)}else if(this.cell!=this._string_empty){for((i=[]).length=c-h+1,r=0,l=h;l<=c;l++)i[r]=l.toString(),r++;n=this.computeRows(e),n=isNaN(n)?0:n,s=this.computeColumns(e),1==(s=isNaN(s)?0:s)&&(s=16384),o=this._getPosition(n,s),n=this._getPositionHeight,s=this._getPositionWidth,a=(o=o>-1?o/s:o)>-1?i[o].toString():this.getErrorStrings()[0].toString()}else a=this._string_empty;return a},this._computeArrayColumn=function(e,t){var i,r,l,n,s,o,a=this._string_empty;e=e.split('"').join(this._string_empty);var d=this.getCellsFromArgs(e),h=this.colIndex(d[0].toString()),c=this.colIndex(d[d.length-1].toString());if(t>0){for(l=h;l<=c;l++)a+=l.toString()+this._parseArgumentSeparator;a=a.substr(a.length-1)}else if(this.cell!=this._string_empty){for((i=[]).length=c-h+1,r=0,l=h;l<=c;l++)i[r]=l.toString(),r++;n=this.computeRows(e),n=isNaN(n)?0:n,s=this.computeColumns(e),s=isNaN(s)?0:s,1==n&&(n=1048576),o=this._getPosition(n,s),n=this._getPositionHeight,s=this._getPositionWidth,a=(o=o>-1?o%s:o)>-1?i[o].toString():this.getErrorStrings()[0].toString()}else a=this._string_empty;return a},this._findAndCheckPrecedingChar=function(e,t,i){var r=e.indexOf(t,i);if(r>0)for(;r>-1&&-1==this.getValidPrecedingChars().indexOf(e[r-1]);)r=e.indexOf(t,r+1);return this._findAndCheckPrecedingCharCopy=e,r},this._findLastNonQB=function(e){var t,i,r=-1;if(e.indexOf(this.bMARKER)>-1)for(t=0,i=e.length-1;i>=0;--i)if(e[i]==this._rightBracket)t--;else if(e[i]==this._leftBracket)t++;else if(e[i]==this.bMARKER&&0==t){r=i;break}return r},this._findLastqNotInBrackets=function(e){for(var t=-1,i=!1,r=e.length-1;r>-1;){if("q"==e[r]&&i){t=r;break}e[r]==this._leftBracket?i=!0:e[r]==this._rightBracket&&(i=!1),r--}return t},this._findNextSeparator=function(e,t){for(var i=0,r=!1;!r&&t<e.length;)"q"==e[t]?i++:e[t]==this._rightBracket?i--:0==i&&e[t]==this.getParseArgumentSeparator()&&(r=!0,t--),t++;return t.toString()},this._findNextEndIndex=function(e,t){for(var i=0,r=t,l=!1;!l&&t<e.length;)"["==e[t]?i++:"]"==e[t]&&(0==--i&&(l=!0)),t++;return t-r},this._findNonQB=function(e){var t,i,r=-1;if(e.indexOf(this.bMARKER)>-1)for(t=0,i=0;i<e.length;++i)if(e[i]==this._rightBracket)t--;else if(e[i]==this._leftBracket)t++;else if(e[i]==this.bMARKER&&0==t){r=i;break}return r},this._findRightBracket=function(e,t){for(var i=0,r=!1;!r&&t<e.length;)"q"==e[t]?i++:0==i&&e[t]==this._rightBracket?(r=!0,t--):e[t]==this._rightBracket&&i--,t++;return r?t.toString():"NaN"},this._fromOADate=function(e){var t=new Date;return t.setTime(e*this._millisecondsOfaDay+Date.parse(this._oaDate)),t},this._getDateFromSerialDate=function(e){return this.treat1900AsLeapYear&&e>59&&(e-=1),new Date(this._oaDate.setDate(this._oaDate.getDate()+e))},_weekEndType=["","6,0","0,1","1,2","2,3","3,4","4,5","5,6","","","","0","1","2","3","4","5","6"],this._getDoubleArray=function(e){var t,i,r,l,n,s="",o=[];for(e=this.adjustRangeArg(e),i=this.splitArgsPreservingQuotedCommas(e),r=0;r<i.length;r++)if(i[r].indexOf(":")>-1)for(l=this.getCellsFromArgs(i[r]),n=0;n<l.length;n++)(s="TRUE"==(s=this.getValueFromArg(l[n])).split(this.tic).join("")?"1":"FALSE"==s.split(this.tic).join("")?"0":s).length>0&&(t=this._parseDouble(s),isNaN(t)?o.push(0):o.push(Number(t)));else(s="TRUE"==(s=this.getValueFromArg(i[r])).split(this.tic).join("")?"1":"FALSE"==s.split(this.tic).join("")?"0":s).length>0?(t=this._parseDouble(s),isNaN(Number(t))||o.push(t)):o.push(0);return o},this._getDoubleArrayA=function(e){var t,i,r,l,n,s="",o=[];for(e=this.adjustRangeArg(e),i=this.splitArgsPreservingQuotedCommas(e),r=0;r<i.length;r++)if(i[r].indexOf(":")>-1)for(l=this.getCellsFromArgs(i[r]),n=0;n<l.length;n++)(s=this.getValueFromArg(l[n])).length>0&&(s==this.trueValueStr?t=1:(t=this._parseDouble(s),isNaN(Number(t))),o.push(t));else(s=this.getValueFromArg(i[r]))==this.trueValueStr?t=1:(t=this._parseDouble(s.toString()),isNaN(t)&&(t=0)),o.push(t);return o},this._getFormulaArrayBounds=function(e,t,i){var r,l,n,s,o,a=this.colIndex(this.cell),d=this.rowIndex(this.cell),h=this.getFormulaInfoTable().containsKey(this.cell)?this.getFormulaInfoTable().getItem(this.cell):null;for(r=null!=h?h.getFormulaText():this.parentObject.getValueRowCol==undefined?this.getValueRowCol(this.getSheetID(this.grid)+1,d,a):this.parentObject.getValueRowCol(this.getSheetID(this.grid)+1,d,a),l=1,n=1,s=1;s<=t;s++)if(a-s>0){var c=this._getSheetTokenFromReference(this.cell)+RangeInfo.getAlphaLabel(a-s)+d.toString(),u="";if(u=null!=(g=this.getFormulaInfoTable().containsKey(c)?this.getFormulaInfoTable().getItem(c):null)?g.getFormulaText():this.parentObject.getValueRowCol==undefined?this.getValueRowCol(this.getSheetID(this.grid)+1,d,a-s):this.parentObject.getValueRowCol(this.getSheetID(this.grid)+1,d,a-s),n=a-s,null!=r&&u!=r){n++;break}}for(o=1;o<=i;o++)if(d-o>0){var g;c=this._getSheetTokenFromReference(this.cell)+RangeInfo.getAlphaLabel(n)+(d-o).toString(),u="";if(u=null!=(g=this.getFormulaInfoTable().containsKey(c)?this.getFormulaInfoTable().getItem(c):null)?g.getFormulaText():this.parentObject.getValueRowCol==undefined?this.getValueRowCol(this.getSheetID(this.grid)+1,d-o,n):this.parentObject.getValueRowCol(this.getSheetID(this.grid)+1,d-o,n),l=d-o,null!=r&&u!=r){l++;break}}return this._getFormulaArrayBoundsfirstRowIndex=l,this._getFormulaArrayBoundsfirstColIndex=n,this._getFormulaArrayBoundslastRowIndex=l+t,this._getFormulaArrayBoundslastColIndex=n+i,!0},FormulaArgumentType={None:{},Range:{},CellReference:{},TwoTextWithNumber:{},TextWithNumber:{},Numbers:{},Text:{},Date:{}},this.formulaErrorStringCheck=function(e,t){var i,r,l,n,s,o,a,d,h,c,u,g,p,m=this.splitArgsPreservingQuotedCommas(e);switch(t){case FormulaArgumentType.None:if(""!=e){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._invalid_arguments]}break;case FormulaArgumentType.Range:if(i="",null!=(n=m))for(p=0;p<n.length;p++)if((s=n[p]).indexOf(":")>-1){if(s[0]==this.tic){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return this._errorStrings[1].toString()}for(r=this.getCellsFromArgs(s),l=0;l<r.length;l++){try{i=this.getValueFromArg(l)}catch(e){}if(i.length>0&&this.getErrorStrings().indexOf(i)>-1){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return i}}}else{try{i=this.getValueFromArg(s)}catch(e){}if(i.length>0&&(c=this.formulaErrorStringCheck(i,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(c)>-1))return c}break;case FormulaArgumentType.CellReference:if(null!=(n=m))for(p=0;p<n.length;p++){if(s=n[p],!this._isCellReference(s)&&s[0]==this.tic)return this.getErrorStrings()[1].toString();if(!this._isCellReference(s))return this.getErrorStrings()[5].toString()}break;case FormulaArgumentType.TwoTextWithNumber:if(o=this.formulaErrorStringCheck(m[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(o)>-1)return o;if(a=this.formulaErrorStringCheck(m[1],FormulaArgumentType.Text),this.getErrorStrings().indexOf(a)>-1)return a;if(3==m.length&&(d=this.formulaErrorStringCheck(m[2],FormulaArgumentType.Text),this.getErrorStrings().indexOf(d)>-1))return d;break;case FormulaArgumentType.TextWithNumber:b=0,h=0;var _=this.getValueFromArg(m[0].split(this.tic).join("")),f=Boolean(_);2==m.length&&isNaN("boolean"==typeof this.getValueFromArg(m[1]));if((b=isNaN(this._parseDouble(m[0].split(this.tic).join(""))))&&(S=this.getValueFromArg(m[0]),this.getErrorStrings().indexOf(S)>-1)){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return S}if(2==m.length&&(h=this._parseDouble(m[1].split(this.tic).join("")),isNaN(h)&&(c=this.formulaErrorStringCheck(m[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(c)>-1)))return c;break;case FormulaArgumentType.Text:for(g=m,p=0;p<g.length;p++){_=this.getValueFromArg(g[p]),f=Boolean(_);if((b=isNaN(this._parseDouble(g[p].split(this.tic).join(""))))&&(S=this.getValueFromArg(g[p]),this.getErrorStrings().indexOf(S)>-1)){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return S}}break;case FormulaArgumentType.Numbers:for(u=m,p=0;p<u.length;p++){_=this.getValueFromArg(u[p].split(this.tic).join("")),f=Boolean(_);var b=ej.parseFloat(u[p].split(this.tic).join(""));if(isNaN(b)){if(S=this.getValueFromArg(u[p]),this.getErrorStrings().indexOf(S)>-1){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return S}if(!f&&isNaN(this._parseDouble(S))&&""!=S||u[p].includes(":")&&this._isCellReference(u[p])||S.startsWith(this.tic)){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return this._errorStrings[1].toString()}}}break;case FormulaArgumentType.Date:for(0,g=m,p=0;p<g.length;p++){_=this.getValueFromArg(g[p].split(this.tic).join(""));var C=Boolean(_),S=this.getValueFromArg(g[p]);if(this.getErrorStrings().indexOf(S)>-1){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return S}if(!C&&isNaN(Date.parse(this._stripTics0(S)))&&isNaN(this._parseDouble(this._stripTics0(S)))&&""!=S){if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return this._errorStrings[1].toString()}}}return e},this._getSerialDateFromDate=function(e,t,i){var r,l,n,s=0;for(e<1900&&(e+=1900),r=!1;!r;){for(;t>12;)e++,t-=12;for(r=!0,l=new Date(e,t,1,-1).getDate();i>l;)l=new Date(e,t,1,-1).getDate(),t++,i-=l,r=!1;i<1&&(t--,i=(l=new Date(e,t,1,-1).getDate())-i)}return n=Date.parse(e.toString()+this.getParseDateTimeSeparator()+t.toString()+this.getParseDateTimeSeparator()+i.toString()),isNaN(n)||(s=this._toOADate(new Date(n))),this.treat1900AsLeapYear&&s>59&&(s+=1),s},this._getSerialDateTimeFromDate=function(e){var t=this._toOADate(e);return this.treat1900AsLeapYear&&t>59&&(t+=1),t},this._getSheetTokenFromReference=function(e){var t,i="";if(e.length>2&&e[0]==this.sheetToken){for(t=1,i=this.sheetToken;t<e.length&&e[t]!=this.sheetToken;)i+=e[t],t++;i+=this.sheetToken}return i},this._getValueComputeFormulaIfNecessary=function(e,t,i){var r,l,n,s,o=!1,a=this.getFormulaInfoTable().getItem(this.cell);if(this.parentObject.getValueRowCol==undefined)r=this.getValueRowCol(this.getSheetID(i)+1,e,t);else if(r=this.parentObject.getValueRowCol(this.getSheetID(i)+1,e,t),ej.isNullOrUndefined(r))return this._string_empty;if("}"==(l=null!=r&&0!==r.Length?r:"")[l.length-1]&&"{"==l[0]&&(l=this._substring(l,1,l.length-2)),""==l&&(null==a||a==undefined)||""!=l&&l[0]!=this.getFormulaCharacter()&&"%"!=l[l.length-1])return null!=a&&l==a.getFormulaValue()?a.getFormulaValue():l;if(l.length>0&&l[0]==this.getFormulaCharacter()&&null==a){(a=new FormulaInfo).setFormulaText(r.toString()),this.getDependentFormulaCells().containsKey(this.cell)||this.getDependentFormulaCells().add(this.cell,new HashTable),n=!0;try{a.setParsedFormula(this.parseFormula(l))}catch(e){this._inAPull?(l=e,a=null):a.setFormulaValue(e),n=!1}n&&(a.setFormulaValue(this.computeFormula(a.getParsedFormula())),o=!0),null!=a&&(a.calcID=this._calcID,this.getFormulaInfoTable().containsKey(this.cell)||this.getFormulaInfoTable().add(this.cell,a),l=null!=a.getFormulaValue()?a.getFormulaValue():"")}return null!=a&&(this.getUseFormulaValues()||this.getCalculatingSuspended()&&(!this._inAPull||o)?l=null!=a.getFormulaValue()?a.getFormulaValue():"":o||(this._calcID==a.calcID?l=a.getFormulaValue():(l=this.computeFormula(a.getParsedFormula()),a.setFormulaValue(l),a.calcID=this._calcID))),(""==l||l==undefined)&&(l=""),s=ej.isNullOrUndefined(ej.cultureObject)?this._parseDouble(l):ej.parseFloat(l,0,ej.cultureObject.name),"%"!=l[l.length-1]||isNaN(s)||(l=(Number(s)/100).toString()),l},this._handleEmbeddedEs=function(e){for(var t,i,r=0;r>-1&&(r=e.indexOf(this._string_EP,r))>-1;){if(this._notInBlock(e,r)){for(t=r;t>0&&(this._isDigit(e[t-1])||e[t-1]==this.getParseDecimalSeparator());)t--;if(t!=r&&(0==t||!this._isUpperChar(e[t-1]))){for(i=r+this._string_EP.length;i<e.length&&this._isDigit(e[i]);)i++;i!=r+this._string_EP.length&&(e=e.substring(0,r)+this.char_EP+this._substring(e,r+this._string_EP.length))}}r+=1}for(r=0;r>-1&&(r=e.indexOf(this._string_EM,r))>-1;){if(this._notInBlock(e,r)){for(t=r;t>0&&(this._isDigit(e[t-1])||e[t-1]==this.getParseDecimalSeparator());)t--;if(t!=r&&(0==t||!this._isUpperChar(e[t-1]))){for(i=r+this._string_EM.length;i<e.length&&this._isDigit(e[i]);)i++;i!=r+this._string_EM.length&&(e=e.substring(0,r)+this.char_EM+this._substring(e,r+this._string_EM.length))}}r+=1}for(r=0;r>-1&&(r=e.indexOf(this._string_E,r))>-1&&e[0]!=this.bMARKER;){if(this._notInBlock(e,r)){for(t=r;t>0&&(this._isDigit(e[t-1])||e[t-1]==this.getParseDecimalSeparator());)t--;if(t!=r&&(0==t||!this._isUpperChar(e[t-1]))){for(i=r+this._string_E.length;i<e.length&&this._isDigit(e[i]);)i++;i==r+this._string_E.length||-1!=t&&this._isUpperChar(e[t])||(e=e.substring(0,r)+this.char_EP+this._substring(e,r+this._string_E.length))}}r+=1}return e},this._handleIterations=function(e){this._inHandleIterations=!0;for(var t=0,i=0,r=1,l=!0;r<this._iterationMaxCount-1&&(l||!this._checkUnderTolerance(i,t));)l=!1,this.getIterationValues().containsKey(this.cell)||this.getIterationValues().add(this.cell,"0"),this.getIterationValues().add(this.cell,""==e.getFormulaValue()?"0":e.getFormulaValue()),e.setFormulaValue(this.computeFormula(e.getParsedFormula())),t=i,i=this._parseDouble(e.getFormulaValue()),isNaN(i)&&(i=0),r++;this.getIterationValues.getItem(this.cell,""==e.getFormulaValue()?"0":e.getFormulaValue()),this._inHandleIterations=!1},this._indexOfAny=function(e,t){for(var i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return i;return-1},this._lastIndexOfAny=function(e,t){for(var i=e.length-1;i>-1;i--)if(t.indexOf(e[i])>-1)return i;return-1},this._initLibraryFunctions=function(){this._libraryFunctions=new HashTable,this._addFunction("Countifs","ComputeCOUNTIFS"),this._addFunction("SUM","computeSum"),this._addFunction("EncodeURL","computeEncodeURL"),this._addFunction("CHAR","computeChar"),this._addFunction("CODE","computeCode"),this._addFunction("UNICODE","computeUniCode"),this._addFunction("UNICHAR","computeUniChar"),this._addFunction("UPPER","computeUpper"),this._addFunction("LOWER","computeLower"),this._addFunction("LEN","computeLen"),this._addFunction("MID","computeMid"),this._addFunction("LEFT","computeLeft"),this._addFunction("CLEAN","computeClean"),this._addFunction("REPT","computeRept"),this._addFunction("RIGHT","computeRight"),this._addFunction("REPLACE","computeReplace"),this._addFunction("EXACT","computeExact"),this._addFunction("FIND","computeFind"),this._addFunction("TRIM","computeTrim"),this._addFunction("SEARCH","computeSearch"),this._addFunction("SUBSTITUTE","computeSubstitute"),this._addFunction("PROPER","computeProper"),this._addFunction("T","computeT"),this._addFunction("NUMBERVALUE","computeNumberValue"),this._addFunction("CONCATENATE","computeConcatenate"),this._addFunction("VALUE","computeValue"),this._addFunction("DOLLAR","computeDollar"),this._addFunction("FIXED","computeFixed"),this._addFunction("BIN2DEC","computeBin2Dec"),this._addFunction("BIN2OCT","computeBin2Oct"),this._addFunction("BIN2HEX","computeBin2Hex"),this._addFunction("DEC2BIN","computeDec2Bin"),this._addFunction("DEC2OCT","computeDec2Oct"),this._addFunction("HEX2BIN","computeHex2Bin"),this._addFunction("HEX2OCT","computeHex2Oct"),this._addFunction("BITAND","computeBitAnd"),this._addFunction("BITOR","computeBitOr"),this._addFunction("BITLSHIFT","computeBitLShift"),this._addFunction("BITRSHIFT","computeBitRShift"),this._addFunction("BITXOR","computeBitXor"),this._addFunction("DATE","computeDate"),this._addFunction("DATEVALUE","computeDatevalue"),this._addFunction("DAY","computeDay"),this._addFunction("DAYS","computeDays"),this._addFunction("DAYS360","computeDays360"),this._addFunction("EDATE","computeEDate"),this._addFunction("EOMONTH","computeEOMonth"),this._addFunction("HOUR","computeHour"),this._addFunction("ISOWEEKNUM","computeISOWeeknum"),this._addFunction("MINUTE","computeMinute"),this._addFunction("MONTH","computeMonth"),this._addFunction("NETWORKDAYS","computeNetworkDays"),this._addFunction("NETWORKDAYS.INTL","computeNetworkDaysOintl"),this._addFunction("NOW","computeNow"),this._addFunction("SECOND","computeSecond"),this._addFunction("TIME","computeTime"),this._addFunction("TIMEVALUE","computeTimevalue"),this._addFunction("TODAY","computeToday"),this._addFunction("WEEKDAY","computeWeekday"),this._addFunction("WEEKNUM","computeWeeknum"),this._addFunction("WORKDAY","computeWorkDay"),this._addFunction("WORKDAY.INTL","computeWorkDayOintl"),this._addFunction("YEAR","computeYear"),this._addFunction("ADDRESS","computeAddress"),this._addFunction("AREAS","computeAreas"),this._addFunction("CHOOSE","computeChoose"),this._addFunction("COLUMN","computeColumn"),this._addFunction("COLUMNS","computeColumns"),this._addFunction("FORMULATEXT","computeFormulaText"),this._addFunction("HYPERLINK","computeHyperlink"),this._addFunction("HLOOKUP","computeHLookUp"),this._addFunction("INDEX","computeIndex"),this._addFunction("INDIRECT","computeIndirect"),this._addFunction("LOOKUP","computeLookUp"),this._addFunction("OFFSET","computeOffSet"),this._addFunction("TRANSPOSE","computeTranspose"),this._addFunction("LOGNORM.INV","computeLognormOinv"),this._addFunction("NORM.INV","computeNormOinv"),this._addFunction("NORM.DIST","computeNormOdist"),this._addFunction("NORM.S.DIST","computeNormOsODist"),this._addFunction("NORM.S.INV","computeNormOsOInv"),this._addFunction("PERMUT","computePermut"),this._addFunction("PERMUTATIONA","computePermutationA"),this._addFunction("STANDARDIZE","computeStandardize"),this._addFunction("BINOM.DIST","computeBinomOdist"),this._addFunction("BINOM.INV","computeBinomOInv"),this._addFunction("CHISQ.INV.RT","computeChisqOinvOrt"),this._addFunction("CHISQ.INV","computeChisqOinv"),this._addFunction("CHISQ.DIST.RT","computeChisqOdistOrt"),this._addFunction("F.DIST","computeFOdist"),this._addFunction("GAMMALN","computeGammaln"),this._addFunction("CONFIDENCE.NORM","computeConfidenceOnorm"),this._addFunction("EXPON.DIST","computeExponOdist"),this._addFunction("FISHER","computeFisher"),this._addFunction("FISHERINV","computeFisherInv"),this._addFunction("GAMMALN.PRECISE","computeGammalnOPrecise"),this._addFunction("AVERAGE","computeAverage"),this._addFunction("AVERAGEA","computeAverageA"),this._addFunction("POISSON.DIST","computePoissonODist"),this._addFunction("WEIBULL.DIST","computeWeiBullODist"),this._addFunction("F.INV.RT","computeFOinvOrt"),this._addFunction("T.DIST","computeTOdist"),this._addFunction("MAX","computeMax"),this._addFunction("MAXA","computeMaxa"),this._addFunction("MEDIAN","computeMedian"),this._addFunction("MIN","computeMin"),this._addFunction("MINA","computeMina"),this._addFunction("PERCENTRANK.INC","computePercentrankInc"),this._addFunction("PERCENTILE","computePercentile"),this._addFunction("RANK.EQ","computeRankOEq"),this._addFunction("COUNT","computeCount"),this._addFunction("COUNTA","computeCounta"),this._addFunction("DEVSQ","computeDevsq"),this._addFunction("F.DIST.RT","computeFOdistORt"),this._addFunction("FORECAST","computeForecast"),this._addFunction("GEOMEAN","computeGeomean"),this._addFunction("HARMEAN","computeHarmean"),this._addFunction("INTERCEPT","computeIntercept"),this._addFunction("LARGE","computeLarge"),this._addFunction("SMALL","computeSmall"),this._addFunction("LOGNORM.DIST","computeLognormOdist"),this._addFunction("AVEDEV","computeAvedev"),this._addFunction("COUNTBLANK","computeCountblank"),this._addFunction("STDEV.P","computeStdevOp"),this._addFunction("STDEV.S","computeStdevOS"),this._addFunction("STDEVA","computeStdeva"),this._addFunction("STDEVPA","computeStdevpa"),this._addFunction("T.INV","computeTOinv"),this._addFunction("VAR.P","computeVarp"),this._addFunction("VARA","computeVara"),this._addFunction("VARPA","computeVarpa"),this._addFunction("CORREL","computeCorrel"),this._addFunction("PERCENTILE.EXC","computePercentileExc"),this._addFunction("PERCENTILE.INC","computePercentileOInc"),this._addFunction("TRIMMEAN","computeTrimmean"),this._addFunction("RSQ","computeRsq"),this._addFunction("PEARSON","computePearson"),this._addFunction("CHIDIST","computeChidist"),this._addFunction("MODE.MULT","computeModeOMult"),this._addFunction("NORMINV","computeNormInv"),this._addFunction("ABS","computeAbs"),this._addFunction("ACOS","computeAcos"),this._addFunction("ACOSH","computeAcosh"),this._addFunction("ACOT","computeAcot"),this._addFunction("ACOTH","computeAcoth"),this._addFunction("ARABIC","computeArabic"),this._addFunction("ASIN","computeAsin"),this._addFunction("ATAN","computeAtan"),this._addFunction("ATAN2","computeAtan2"),this._addFunction("BIGMUL","computeBigMul"),this._addFunction("CEILING.MATH","computeCeilingMath"),this._addFunction("CEILING","computeCeiling"),this._addFunction("COMBIN","computeCombin"),this._addFunction("COMBINA","computeCombinA"),this._addFunction("COS","computeCos"),this._addFunction("COSH","computeCosh"),this._addFunction("COT","computeCot"),this._addFunction("CSC","computeCsc"),this._addFunction("CSCH","computeCsch"),this._addFunction("DECIMAL","computeDecimal"),this._addFunction("DEGREES","computeDegrees"),this._addFunction("ISTEXT","computeIsText"),this._addFunction("EXP","computeExp"),this._addFunction("EVEN","computeEven"),this._addFunction("FACT","computeFact"),this._addFunction("FACTDOUBLE","computeFactdouble"),this._addFunction("FLOOR","computeFloor"),this._addFunction("GCD","computeGcd"),this._addFunction("INT","computeInt"),this._addFunction("LCM","computeLcm"),this._addFunction("LN","computeLn"),this._addFunction("LOG","computeLog"),this._addFunction("MUNIT","computeMunit"),this._addFunction("PI","computePI"),this._addFunction("PRODUCT","computeProduct"),this._addFunction("SEC","computeSecant"),this._addFunction("SERIESSUM","computeSeriessum"),this._addFunction("SIGN","computeSign"),this._addFunction("SIN","computeSin"),this._addFunction("SINH","computeSinh"),this._addFunction("SQRT","computeSqrt"),this._addFunction("SUBTOTAL","computeSubTotal"),this._addFunction("SUMIF","computeSumif"),this._addFunction("TRUNC","computeTrunc"),this._addFunction("TRUNCATE","computeTruncate"),this._addFunction("TAN","computeTan"),this._addFunction("LOG10","computeLogTen"),this._addFunction("COTH","computeCoth"),this._addFunction("RADIANS","computeRadians"),this._addFunction("ODD","computeOdd"),this._addFunction("MOD","computeMod"),this._addFunction("RAND","computeRand"),this._addFunction("SECH","computeSecanth"),this._addFunction("AND","computeAnd"),this._addFunction("FALSE","computeFalse"),this._addFunction("IF","computeIf"),this._addFunction("IFERROR","computeIfError"),this._addFunction("NOT","computeNot"),this._addFunction("OR","computeOr"),this._addFunction("TRUE","computeTrue"),this._addFunction("XOR","computeXor"),this._addFunction("IFS","computeIfs"),this._addFunction("CELL","computeCell"),this._addFunction("ERROR.TYPE","computeErrorType"),this._addFunction("INFO","computeInfo"),this._addFunction("ISBLANK","computeIsBlank"),this._addFunction("ISERR","computeIsErr"),this._addFunction("ISERROR","computeIsError"),this._addFunction("ISEVEN","computeIsEven"),this._addFunction("ISFORMULA","computeIsFormula"),this._addFunction("ISLOGICAL","computeIsLogical"),this._addFunction("ISNA","computeIsNA"),this._addFunction("ISNONTEXT","computeIsNonText"),this._addFunction("ISNUMBER","computeIsNumber"),this._addFunction("ISODD","computeIsOdd"),this._addFunction("ISREF","computeIsRef"),this._addFunction("ISTEXT","computeIsText"),this._addFunction("N","computeN"),this._addFunction("NA","computeNA"),this._addFunction("SHEET","computeSheet"),this._addFunction("SHEETS","computeSheets"),this._addFunction("TYPE","computeType"),this._addFunction("ROW","computeRow"),this._addFunction("ROWS","computeRows"),this._addFunction("MATCH","computeMatch"),this._addFunction("PMT","computePmt"),this._addFunction("COUNTIF","computeCountif"),this._addFunction("ROUND","computeRound"),this._addFunction("ROUNDDOWN","computeRoundDown"),this._addFunction("ROUNDUP","computeRoundUp"),this._addFunction("MMULT","computeMmult"),this._addFunction("PV","computePv"),this._addFunction("NORMSDIST","computeNormsDist"),this._addFunction("NORMDIST","computeNormDist"),this._addFunction("SUMPRODUCT","computeSumProduct"),this._addFunction("STDEV","computeStdev"),this._addFunction("VLOOKUP","computeVLookUp"),this._addFunction("ASINH","computeAsinh"),this._addFunction("ATANH","computeAtanh"),this._addFunction("BASE","computeBase"),this._addFunction("AVERAGEIF","computeAverageIf"),this._addFunction("AVERAGEIFS","computeAverageIfS"),this._addFunction("BESSELI","computeBesselI"),this._addFunction("BESSELJ","computeBesselJ"),this._addFunction("BESSELK","computeBesselK"),this._addFunction("BESSELY","computeBesselY"),this._addFunction("TEXT","computeText"),this._addFunction("POWER","computePow")},this._comb=function(e,t){for(var i,r=1,l=e+1;l<=t;++l)r*=l;for(i=1,l=2;l<=t-e;++l)i*=l;return r/i},this._finv=function(e,t,i){for(var r=Math.exp(this._gammaln((t+i)/2)-this._gammaln(t/2)-this._gammaln(i/2)+t/2*Math.log(t/i)),l=r,n=l/2,s=0,o=100,a=3;100==o&&a>0;)for(a--,n=(l/=2)/2,o=0;o<100&&(0,s=1-r*this._fdist(l,t,i),!(Math.abs((s-e)/e)<1e-7));++o)s>e?l+=n:(l-(n/=2)<0&&(n=l/2),l-=n);return 100==o&&(l=-1),l},this._tProbabilityDensity=function(e,t){return this._gammaFunction(.5*t+.5)*Math.pow(1+e*e/t,-.5*t-.5)/(Math.sqrt(t*Math.PI)*this._gammaFunction(.5*t))},this._tCumulativeDensity=function(e,t){if(isNaN(e))return NaN;if(0==e)return.5;if(e>0){var i=t/(e*e+t);return 1-.5*this._rIBetaFunction(i,.5*t,.5)}return 1-this._tCumulativeDensity(-e,t)},this._sign=function(e){return 0===e||isNaN(e)?e:e>0?1:-1},this._var=function(e){for(var t,i,r=0,l=e.length,n=0;n<l;++n)r+=e[n];for(r/=l,t=0,n=0;n<l;++n)t+=(i=e[n]-r)*i;return t/(l-1)},this._tCumulativeDistributionInverse=function(e,t){var i,r,l;if(e<0||e>1)throw"Probability must be between 0 and 1";if(0==e)return Number.NEGATIVE_INFINITY;if(1==e)return Number.POSITIVE_INFINITY;if(.5==e)return 0;switch(t){case 1:return Math.tan(Math.PI*(e-.5));case 2:return n=4*e*(1-e),2*(e-.5)*Math.sqrt(2/n);case 4:var n=4*e*(1-e),s=Math.sqrt(n),o=Math.cos(1/3*Math.acos(s))/s;return 2*this._sign(e-.5)*Math.sqrt(o-1);default:for(i=t>6?this._standardNormalCumulativeDistributionFunctionInverse(e):this._tCumulativeDistributionInverse(e,4),r=0;r<50;r++){if(l=this._tCumulativeDensity(i,t),Math.abs(e-l)<1e-4)return i;i+=(e-l)/this._tProbabilityDensity(i,t)}throw"Solution did not converge"}},this._fdist=function(e,t,i){for(var r,l=32,n=e,s=(n-0)/l,o=s/3,a=this._fdensity(0,t,i)+this._fdensity(n,t,i),d=0,h=1;h<l;h+=2)d+=4*this._fdensity(0+h*s,t,i);for(r=0,h=2;h<l;h+=2)r+=2*this._fdensity(0+h*s,t,i);var c=o*(a+r+d),u=c,g=0;for(g=0;g<10;++g){for(r+=d/2,d=0,s=(n-0)/(l*=2),h=0;h<l;++h)h%2==1&&(d+=this._fdensity(0+s*h,t,i));if(c=(o=s/3)*(a+r+(d*=4)),Math.abs((c-u)/u)<1e-7)break;u=c}return c},this._fdensity=function(e,t,i){return Math.pow(e,(t-2)/2)/Math.pow(1+t*e/i,(t+i)/2)},this._normaldist=function(e,t,i){var r,l,n,s,o=32;e>t?(r=t-(e-t),l=e):(r=e,l=t+(t-e));var a=(l-r)/o,d=a/3,h=this._normaldensity(r,t,i)+this._normaldensity(l,t,i),c=0;for(s=1;s<o;s+=2)c+=4*this._normaldensity(r+s*a,t,i);for(n=0,s=2;s<o;s+=2)n+=2*this._normaldensity(r+s*a,t,i);var u=d*(h+n+c),g=u,p=0;for(p=0;p<10;++p){for(n+=c/2,c=0,a=a=(l-r)/(o*=2),s=0;s<o;++s)s%2==1&&(c+=this._normaldensity(r+a*s,t,i));if(u=(d=a/3)*(h+n+(c*=4)),Math.abs((u-g)/g)<1e-7)break;g=u}return e>t?u+(1-u)/2:(1-u)/2},this._normaldensity=function(e,t,i){return 1/(Math.sqrt(2*Math.PI)*i)*Math.exp(-(e-t)*(e-t)/(2*i*i))},this._standardNormalCumulativeDistribution=function(e){if(e<0)return 1-this._standardNormalCumulativeDistribution(-e);var t=1/(1+.2316419*e);return 1-this._standardNormalProbabilityDensityFunction(e)*(.31938153*t+-.356563782*Math.pow(t,2)+1.781477937*Math.pow(t,3)+-1.821255978*Math.pow(t,4)+1.330274429*Math.pow(t,5))},this._normalinv=function(e,t,i){for(var r=t,l=(r=e<.05?t-2*i:e<.5?t:e<.95?t+2*i:t+5*i)/2,n=0,s=100,o=3;100==s&&o>0;)for(o--,l=(r/=2)/2,s=0;s<100&&(0,n=this._normaldist(r,t,i),!(Math.abs((n-e)/e)<1e-7));++s)n<e?r+=l:(r-(l/=2)<0&&(l=r/2),r-=l);return 100==s&&(r=-1),r},this._normalCumulativeDistributionFunctionInverse=function(e,t,i){return i*this._standardNormalCumulativeDistributionInverse(e)+t},this._standardNormalCumulativeDistributionInverse=function(e){var t;if(e<0||e>1)throw"Probability must be between 0 and 1";if(0==e)return Number.NEGATIVE_INFINITY;if(1==e)return Number.POSITIVE_INFINITY;if(.5==e)return 0;var i,r=-.007784894002430293,l=-.3223964580411365,n=-2.400758277161838,s=-2.549732539343734,o=4.374664141464968,a=2.938163982698783,d=.007784695709041462,h=.3224671290700398,c=2.445134137142996,u=3.754408661907416,g=.02425;return 0<e&&e<g?(((((r*(i=Math.sqrt(-2*Math.log(e)))+l)*i+n)*i+s)*i+o)*i+a)/((((d*i+h)*i+c)*i+u)*i+1):g<=e&&e<=.97575?(((((-39.69683028665376*(t=(i=e-.5)*i)+220.9460984245205)*t-275.9285104469687)*t+138.357751867269)*t-30.66479806614716)*t+2.506628277459239)*i/(((((-54.47609879822406*t+161.5858368580409)*t-155.6989798598866)*t+66.80131188771972)*t-13.28068155288572)*t+1):-(((((r*(i=Math.sqrt(-2*Math.log(1-e)))+l)*i+n)*i+s)*i+o)*i+a)/((((d*i+h)*i+c)*i+u)*i+1)},this._normalProbabilityDensity=function(e,t,i){var r=(e-t)/i;return.398942280401433*Math.exp(-.5*r*r)/i},this._standardNormalProbabilityDensityFunction=function(e){return.398942280401433*Math.exp(-.5*e*e)},this._standardNormalCumulativeDistributionFunction=function(e){if(e<0)return 1-this._standardNormalCumulativeDistributionFunction(-e);var t=1/(1+.2316419*e);return 1-this._standardNormalProbabilityDensityFunction(e)*(.31938153*t+-.356563782*Math.pow(t,2)+1.781477937*Math.pow(t,3)+-1.821255978*Math.pow(t,4)+1.330274429*Math.pow(t,5))},this._standardNormalCumulativeDistributionFunctionInverse=function(e){var t;if(e<0||e>1)throw"Probability must be between 0 and 1";if(0==e)return Number.NEGATIVE_INFINITY;if(1==e)return Number.POSITIVE_INFINITY;if(.5==e)return 0;var i,r=-.007784894002430293,l=-.3223964580411365,n=-2.400758277161838,s=-2.549732539343734,o=4.374664141464968,a=2.938163982698783,d=.007784695709041462,h=.3224671290700398,c=2.445134137142996,u=3.754408661907416,g=.02425;return 0<e&&e<g?(((((r*(i=Math.sqrt(-2*Math.log(e)))+l)*i+n)*i+s)*i+o)*i+a)/((((d*i+h)*i+c)*i+u)*i+1):g<=e&&e<=.97575?(((((-39.69683028665376*(t=(i=e-.5)*i)+220.9460984245205)*t-275.9285104469687)*t+138.357751867269)*t-30.66479806614716)*t+2.506628277459239)*i/(((((-54.47609879822406*t+161.5858368580409)*t-155.6989798598866)*t+66.80131188771972)*t-13.28068155288572)*t+1):-(((((r*(i=Math.sqrt(-2*Math.log(1-e)))+l)*i+n)*i+s)*i+o)*i+a)/((((d*i+h)*i+c)*i+u)*i+1)},this._chiSquaredProbabilityDensityFunction=function(e,t){var i=this._gammaFunction(.5*t);return 1/(Math.pow(2,.5*t)*i)*Math.pow(e,.5*t-1)*Math.exp(-.5*e)},this._binomdist=function(e,t,i){var r,l=1-i,n=(Math.pow(l,e),0),s=1*Math.pow(l,e);if(0==s)return NaN;for(r=0;r<=t;++r)if(n+=s,s=s*i/l*(e-r)/(r+1),!isFinite(s)||isNaN(s)){n=NaN;break}return n},this._gammadensity=function(e,t,i){return Math.pow(i/t,e-1)*Math.exp(-i/t)/(t*Math.exp(this._gammaln(e)))},this.minValue=-1.79769e308,this.maxValue=2147483647,this._charTable=[this._string_empty,"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],this._stdevdotP=function(e){for(var t=e.length,i=0,r=0,l=0,n=0;n<t;++n)i+=e[n];for(i/=t,n=0;n<t;n++)r+=Math.pow(e[n]-i,2),l++;return Math.sqrt(r/l)},this._determinant=function(e,t){var i,r,l,n,s=1,o=0,a=parseInt(t.toString()),d=[a,a];if(1==t)return e[0];for(o=0,n=0;n<t;n++){for(0,l=0,i=0;i<t;i++)for(r=0;r<t;r++)d[r]=0,0!=i&&r!=n&&(d[l]=e[r],l<t-2?l++:(l=0,0));o+=s*e[n]*this._determinant(d,t-1),s*=-1}return o},this._factorialTable=[1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600],this._mean=function(e){return this._mean(e,1)},this._negbinomdensity=function(e,t,i){return this._comb(t-1,e+t-1)*Math.pow(i,t)*Math.pow(1-i,e)},this._sd=function(e,t){var i,r,l,n=e.length;for(t=0,l=0;l<n;++l)t+=e[l];for(t/=n,i=0,r=0,l=0;l<n;++l)i+=(r=e[l]-t)*r;return 1==n?0:Math.sqrt(i/(n-1))},this._betaCumulativeDist=function(e,t,i){return this._rIBetaFunction(e,t,i)},this._betaProbabilityDens=function(e,t,i){var r=this._betaFunction(t,i);return Math.pow(e,t-1)*Math.pow(1-e,i-1)/r},this._critbinom=function(e,t,i){var r=e,l=e,n=1,s=1;do{if(l=Math.floor(l/2)+1,n>=i){if(s=this._binomdist(e,r-1,t),isNaN(s))return this.maxValue;if(s<i&&s>0)break;r-=l}else{if((s=this._binomdist(e,r+1,t))>=i){r+=1;break}r+=l}n=this._binomdist(e,r,t)}while(r<e&&r>0);return r},this._newnormalinv=function(e){var t=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],i=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],r=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],l=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416],n=.02425,s=0,o=0;return e<n?(s=Math.sqrt(-2*Math.log(e)),(((((r[0]*s+r[1])*s+r[2])*s+r[3])*s+r[4])*s+r[5])/((((l[0]*s+l[1])*s+l[2])*s+l[3])*s+1)):.97575<e?(s=Math.sqrt(-2*Math.log(1-e)),-(((((r[0]*s+r[1])*s+r[2])*s+r[3])*s+r[4])*s+r[5])/((((l[0]*s+l[1])*s+l[2])*s+l[3])*s+1)):(((((t[0]*(o=(s=e-.5)*s)+t[1])*o+t[2])*o+t[3])*o+t[4])*o+t[5])*s/(((((i[0]*o+i[1])*o+i[2])*o+i[3])*o+i[4])*o+1)},this._chiinv=function(e,t){for(var i=e,r=Number(i/2),l=0,n=100,s=3;100==n&&s>0;)for(s--,r=(i/=2)/2,n=0;n<100&&(l=1-this._chidist(i,t),!(Math.abs((l-e)/e)<1e-7));++n)l>e?i+=r:(i-(r/=2)<0&&(r=i/2),i-=r);return 100==n&&(i=-1),i},this._chidist=function(e,t){var i,r=[.09654008851,.09563872008,.09384439908,.0911738787,.087652093,.08331192423,.07819389579,.07234579411,.06582222278,.05868409348,.05099805926,.04283589802,.03427386291,.02539206531,.01627439473,.00701861001],l=[.04830766569,.14447196158,.23928736225,.33186860228,.42135127613,.50689990893,.58771575724,.66304426693,.73218211874,.79448379597,.84936761373,.89632115577,.93490607594,.96476225559,.98561151155,.99726386185],n=t/2,s=1/(Math.pow(2,n)*Math.exp(this._gammaln(n)));n-=1;var o,a=(0+e)/2,d=(e-0)/2,h=0;for(i=0;i<16;++i)o=l[i]*d,h=Number(h)+Number(r[i]*(Math.pow(a+o,n)*Math.exp(-(a+o)/2)+Math.pow(a-o,n)*Math.exp(-(a-o)/2)));return Number(s)*Number(h)*Number(d)},this._gammaln=function(e){var t,i=[.918938533204673,.000595238095238,.000793650793651,.002777777777778,.083333333333333],r=e,l=0;if(r<7){for(l=r,r++;r<7;)l*=r,r<7&&r++;l=-Math.log(l)}return t=this._parseDouble((1/(r*r)).toString()),l+(r-this._parseDouble("0.5"))*Math.log(r)-r+i[0]+(((-i[1]*t+i[2])*t-i[3])*t+i[4])/r},this._pearson=function(e,t,i){for(var r=0,l=0,n=0;n<i;++n)r+=e[n],l+=t[n];r/=i,l/=i;var s,o,a=0,d=0,h=0;for(n=0;n<i;++n)a+=(o=e[n]-r)*(s=t[n]-l),d+=o*o,h+=s*s;return a/Math.sqrt(d*h)},this._fProbabilityDensity=function(e,t,i){if(t<=0||i<=0)throw"k1 and k2 must be greater than 0.";return 0==e?0:Math.pow(t*e,.5*t)*Math.pow(i,.5*i)/Math.pow(t*e+i,.5*(t+i))/(e*this._betaFunction(.5*t,.5*i))},this._fCumulativeDensity=function(e,t,i){if(t<=0||i<=0)throw"k1 and k2 must be greater than 0.";if(e<0)throw"x must be greater than 0.";if(0==e)return 0;var r=t*e/(t*e+i),l=this._rIBetaFunction(r,.5*t,.5*i);return Math.min(1,l)},this._rIBetaFunction=function(e,t,i){var r,l,n;if(e<=0)return 0;if(e>=1)return 1;if(t%1==0&&i%1==0&&t+i>0)return this._rIBetaFunction1(e,t,i);if(i%1==0&&t+i<172)return this._rIBetaFunction2(e,t,i);if(t%1==0&&t+i<172)return 1-this._rIBetaFunction2(1-e,i,t);if(.5==t&&.5==i)return 2/Math.PI*Math.atan(Math.sqrt(e/(1-e)));if(.5==t&&i%.5==0)return 1-this._rIBetaFunction(1-e,i,.5);if(t%.5==0&&.5==i){if(t<45){var s=0,o=Math.round(t-.5),a=this._parseDouble(this.computeGammaln("0.5".toString()));for(r=0;r<o;r++)s+=Math.exp(this._gammaln(r+1)-this._gammaln(r+1.5)-a)*Math.pow(e,r);return this._rIBetaFunction(e,.5,.5)-Math.sqrt(e*(1-e))*s}var d=this._betaFunction(t,.5),h=Math.sqrt(1-Math.pow(d*Math.sqrt((t-1)/Math.PI)*this._epsilon,1/(t-1))),c=[.066671344308688,.14945134915058,.21908636251598,.26926671931,.29552422471475,.29552422471475,.26926671931,.21908636251598,.14945134915058,.066671344308688],u=[.013046735791414,.067468316655507,.16029521585049,.28330230293538,.42556283050918,.57443716949081,.71669769706462,.83970478414951,.93253168334449,.98695326420859],g=Math.sqrt(1-e);s=0;for(r=0;r<10;r++)s+=c[r]*Math.pow(1-Math.pow((h-g)*u[r]+g,2),t-1);return(h-g)*Math.exp(this._gammaln(t+.5)-this._gammaln(t)-this._gammaln(.5))*s}if(t%.5==0&&i%.5==0){s=0,o=Math.round(i-.5);var p=this._gammaln(t),m=Math.pow(e,t);for(r=0;r<o;r++)s+=Math.exp(this._gammaln(t+r+.5)-p-this._gammaln(r+1.5))*Math.pow(1-e,r)*m;return l=this._rIBetaFunction(e,t,.5)+Math.sqrt(1-e)*s,Math.max(0,Math.min(1,l))}return e>.5?1-this._rIBetaFunction(1-e,i,t):(n=this._iBetaFunction(e,t,i)/this._betaFunction(t,i),Math.max(0,Math.min(1,n)))},this._rIBetaFunction1=function(e,t,i){var r,l=0,n=t+i-1;if(n<21){for(r=t;r<t+i;r++)l+=Math.pow(e,r)*Math.pow(1-e,n-r)/(this._factorial(r)*this._factorial(n-r));l*=this._factorial(n)}else for(r=t;r<t+i;r++)l+=Math.pow(e,r)*Math.pow(1-e,n-r)*this._combinations(n,r);return Math.max(0,Math.min(1,l))},this._rIBetaFunction2=function(e,t,i){var r,l;if(t+i>172)throw"Cannot currently compute RegularizedIncompleteBetaFunction for a + b > 172";for(r=0,l=1;l<i+1;l++)r+=Math.pow(1-e,l-1)*Math.exp(this._gammaln(t+l-1)-this._gammaln(l));return r*Math.pow(e,t)*Math.exp(-this._gammaln(t))},this._iBetaFunction=function(e,t,i){return 0==e?0:1==e?this._betaFunction(t,i):e<=.9?this._pIBetaFunction(0,e,t,i):e<=.99?this._pIBetaFunction(0,.9,t,i)+this._pIBetaFunction(.9,e,t,i):this._pIBetaFunction(0,.9,t,i)+this._pIBetaFunction(.9,.99,t,i)+this._pIBetaFunction(.99,e,t,i)},this._pIBetaFunction=function(e,t,i,r){var l,n;if(t==e)return 0;if(t<e)return NaN;l=1e3,i<1&&(l=8e4);var s=(t-e)/l,o=e+.5*s,a=0;for(n=0;n<l;n++)a+=Math.pow(o,i-1)*Math.pow(1-o,r-1)*s,o+=s;return a},this._betaFunction=function(e,t){return e+t>143?t>20?2.5066282746310002*Math.pow(e,e-.5)*Math.pow(t,t-.5)/Math.pow(e+t,e+t-.5):this._gammaFunction(t)*Math.pow(e,-t):this._gammaFunction(e)*this._gammaFunction(t)/this._gammaFunction(e+t)},this._gammaFunction=function(e){var t;if(e>143)throw"Cannot currently compute gamma function for z > 143";if(e>0&&e<21&&e%1==0)return this._factorial(Math.round(e-1));if(e>0&&e<11&&e%.5==0)return t=parseInt(e),1.77245385090552*this._factorial(2*t)/(Math.pow(4,t)*this._factorial(t));var i=1+1/(12*e)+1/(288*e*e)-139/(51840*Math.pow(e,3))-571/(2488320*Math.pow(e,4))+163879/(209018880*Math.pow(e,5))+5246819/(75246796800*Math.pow(e,6));return Math.pow(e,e-.5)*Math.exp(-e)*2.5066282746310002*i},this._epsilon=5e-324,this._factorial=function(e){var t,i;if(e<0)throw"Factorial not defined for negative n";if(e>20)throw"Answer will exceed max long";for(t=1,i=e;i>0;i--)t*=i;return t},this._combinations=function(e,t){var i=this._logCombin(e,t),r=Math.exp(i);return Math.round(r)},this._logCombin=function(e,t){return this._logFactorial(e)-this._logFactorial(t)-this._logFactorial(e-t)},this._logFactorial=function(e){for(var t=0,i=2;i<=e;i++)t+=Math.log(i);return t},this._isCellReference=function(e){var t,i,r,l,n;if(""==e||(e=this.setTokensForSheets(e),t=!1,""!=this._sheetToken(e)&&(e=e.split(this.sheetToken).join("")),i=!1,r=!1,e.indexOf(":")!=e.lastIndexOf(":")))return!1;for(l=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),n=0;n<l.length;n++)if(this._isLetter(l[n]))i=!0;else if(this._isDigit(l[n])){if(0===l[n])return!1;r=!0}else{if(":"!=l[n])return!1;i&&r&&(t=!0),i=!1,r=!1}return e.indexOf(":")>-1&&-1==e.indexOf(this.tic)?!!(t&&i&&r)||!(!(i&&!r||!i&&r)||t):!(!i||!r||-1!=e.indexOf(this.tic))},this._isDate=function(e){if("object"==typeof e||null!=ej.parseDate(e)){var t=new Date(Date.parse(e));return t>=this._dateTime1900?t:"NaN"}return"NaN"},this._isDigit=function(e){var t=e.charCodeAt(0);return t>47&&t<58},this._isHLookupCachingEnabled=function(){return 0!=(3&this._enableLookupTableCaching)||0!=(2&this._enableLookupTableCaching)},this._isVLookupCachingEnabled=function(){return 0!=(3&this._enableLookupTableCaching)||0!=(1&this._enableLookupTableCaching)},this._isLetter=function(e){var t=e.charCodeAt(0);return t>=65&&t<=90||t>=97&&t<=122},this._isLetterOrDigit=function(e){var t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122},this._isLookupCachingEnabled=function(){return 0!=(3&this._enableLookupTableCaching)||0!=(1&this._enableLookupTableCaching)||0!=(2&this._enableLookupTableCaching)},this._isOptimizedMatchesEnabled=function(){return 0!=(4&this._enableLookupTableCaching)},this._isRange=function(e){var t,i,r=!1,l=e.indexOf(":");if(l>1&&l<e.length-2&&(t=l-1,this._isDigit(e[t]))){for(i=!1,t--;t>0&&this._isDigit(e[t]);)t--;if(this._isLetter(e[t])){for(t--;t>=0&&this._isLetter(e[t]);)t--;t>-1&&e[t]==this._string_fixedreference[0]&&t--,t<0?i=!0:e[t]==this.sheetToken&&(t-- >1&&e[t]==this.tic[0]?i=0==e.substring(0,t-1).lastIndexOf(this.tic[0]):t>0&&this._isDigit(e[t])&&(i=0==e.substring(0,t).lastIndexOf(this.sheetToken)))}if(i&&((t=l+1)<e.length-6&&e[t]==this.tic[0]&&((t=e.indexOf(this.sheetToken,t+1))<e.length-2&&t++),t<e.length-2&&e[t]==this._string_fixedreference[0]&&t++,this._isLetter(e[t]))){for(t++;t<e.length-1&&this._isLetter(e[t]);)t++;if(this._isDigit(e[t])){for(t++;t<e.length&&this._isDigit(e[t]);)t++;r=t==e.length}}}return r},this._isUpperChar=function(e){var t=e.charCodeAt(0);return t>64&&t<91},this._iisVLookupCachingEnabled=function(){return 0!=(3&this._enableLookupTableCaching)||0!=(1&this._enableLookupTableCaching)},this._mark=function(e,t,i,r,l){var n,s=0;for(l?(s=this._findAndCheckPrecedingChar(e,i,s),e=this._findAndCheckPrecedingCharCopy):s=e.indexOf(i),n=i.length;s>-1;)e=e.substring(0,s)+r+e.substring(s+n),t=t.substring(0,s)+r+t.substring(s+n),l?(s=this._findAndCheckPrecedingChar(e,i,s),e=this._findAndCheckPrecedingCharCopy):s=e.indexOf(i,s);return this._markCopy="",t},this._markColonsInQuotes=function(e){for(var t=!1,i=0;i<e.length;++i)e[i]==this.tic[0]?t=!t:":"==e[i]&&t&&(e=e.split(":").join(this._markerChar));return e},this._markIF=function(e,t){e.indexOf(this.getReservedWordOperators()[this._reservedWord_IF]);var i=e.indexOf(this.getReservedWordOperators()[this._reservedWord_THEN]),r=e.indexOf(this.getReservedWordOperators()[this._reservedWord_ELSE]);if(r>-1&&i>-1){var l=i-(a=this.getReservedWordOperators()[this._reservedWord_IF].length),n=r-(d=i+this.getReservedWordOperators()[this._reservedWord_THEN].length),s=r+this.getReservedWordOperators()[this._reservedWord_ELSE].length,o=t.length-s;e=t="IF(("+this._substring(t,a,l)+")"+this.getParseArgumentSeparator()+"("+this._substring(t,d,n)+")"+this.getParseArgumentSeparator()+"("+this._substring(t,s,o)+"))"}else if(i>-1){var a=0,d=(l=i,i+this.getReservedWordOperators()[this._reservedWord_THEN].length);n=t.length-d+1;e=t="IF(("+this._substring(t,a,l)+")"+this.getParseArgumentSeparator()+"("+this._substring(t,d,n)+"))"}return this._markIFCopy=t,t},this._markLibraryFormulas=function(e){var t,i,r,l,n,s,o,a,d,h,c=e.indexOf(")");if(-1==c)e=this._markNamedRanges(e);else for(;c>-1;){for(t=0,i=c-1;i>-1&&("("!=e[i]||0!=t);)")"==e[i]?t++:")"==e[i]&&t--,i--;if(-1==i)throw this.formulaErrorStrings[this._mismatched_parentheses];for(r=i-1;r>-1&&(this._isLetterOrDigit(e[r])||this._validFunctionNameChars.indexOf(e[r])>-1||e[r]==this.getParseDecimalSeparator());)r--;if((l=i-r-1)>0&&this.getLibraryFunctions().getItem(this._substring(e,r+1,l))!=undefined){if(this._ignoreBracet="AREAS"==this._substring(e,r+1,l),(m=this._substring(e,i,c-i+1)).indexOf("({")>-1&&m.indexOf("})")>-1){for(this._string_empty,n=this._string_empty,s=0;s<m.length;s++){if(o=this._string_empty,"{"==m[s])for(o+=m[s++];"}"!=m[s];)n+=m[s++];o+=n,o+=m[s],this.getNamedRanges().length>0&&n!=this._string_empty&&(this._checkForNamedRange(n.toUpperCase()),this._findNamedRange&&(o=o.split("{").join(this._string_empty)),this._findNamedRange=!1),n=this._string_empty,stringval+=o}m=stringval}m=this._markNamedRanges(m),m=this._swapInnerParens(m),m=this._addParensToArgs(m),e=e.substring(0,r+1)+"q"+this._substring(e,r+1,l)+m.split("(").join(this._leftBracket).split(")").join(this._rightBracket)+e.substring(c+1)}else{if(l>0){if(null!=this.unknownFunction){var u=CalcEngine.getSheetFamilyItem(this.grid),g=this.grid,p=this._sheetToken(this.cell),m=this.cell;for(p.length>0&&(g=u.tokenToParentObject.getItem(p),m=m.substring(m.lastIndexOf(this.sheetToken)+1)),a=u.sheetNameToParentObject.keys(),d=0;d<a.length;d++)if(u.sheetNameToParentObject.getItem(a[d])==g){m=a[d]+this.sheetToken+m;break}if((h=new UnknownFunctionEventArgs).setMissingFunctionName(this._substring(e,r+1,l)),h.setCellLocation(m),this.unknownFunction(this,h),this._ignoreBracet="AREAS"==e.substring(r+1,l),h.getHandled())return h.getResult().toString()}if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._unknown_formula_name]+" "+this._substring(e,r+1,l);return this.getErrorStrings()[5].toString()}m="",i>0&&(m=e.substring(0,i)),m=m+"{"+this._substring(e,i+1,c-i-1)+"}",c<e.length&&(m+=e.substring(c+1)),ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"==this.parentObject.pluginName||(m=this._markNamedRanges(m)),e=m}c=e.indexOf(")")}return e.split("{").join("(").split("}").join(")")},this._swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},this._addParensToArgs=function(e){var t,i,r,l,n,s;if(0==e.length)return this._string_empty;if((t=[]).push(this._parseArgumentSeparator),t.push(this._rightBracket),r=0,-1==(i=e.lastIndexOf(this._parseArgumentSeparator)))e.length>2&&"("==e[0]&&")"==e[e.length-1]&&("{"!=e[1]&&"("!=e[1]?e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1):(l=["+","-","*","/"],i=this._lastIndexOfAny(e,l),0==r&&")"==e[e.length-1]&&(r=e.length-1),r>0&&"{"!=e[i+1]&&"}"==e[i-1]&&(e=(e=e.substr(0,r)+"}"+e.substr(r)).substr(0,i+1)+"{"+e.substr(i+1))));else for(n=!0;i>-1;)(s=this._indexOfAny(e.substring(i+1,e.length),t))>=0?s=i+s+1:-1==s&&")"==e[e.length-1]&&(s=e.length-1),s>0&&"{"!=e[i+1]&&"}"!=e[s-1]&&(e=(e=e.substr(0,s)+"}"+e.substr(s)).substr(0,i+1)+"{"+e.substr(i+1)),i=e.substr(0,i).lastIndexOf(this._parseArgumentSeparator),n&&-1==i&&"("==e[0]&&(i=0,n=!1);return e.split("{}").join(this._string_empty)},this._markNamedRanges=function(e){e.indexOf(")");var t,i,r,l,n,s=[")",this.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"],o=e.length>0&&("("==e[0]||"{"==e[0])?1:0;for(e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!")),t=o,t=-1==e.indexOf("[")||e.indexOf("[")>this._indexOfAny(e.substring(o),s)?this._indexOfAny(e.substring(o),s):this._findNextEndIndex(e,t);t>-1&&t+o<e.length;){if(i="",r=null,this._substring(e,o,t).indexOf("[")>-1?r=this._getTableRange(this._substring(e,o,t)):this.getNamedRanges().containsKey(this._substring(e,o,t))&&(r=this._checkForNamedRange(this._substring(e,o,t))),r==undefined||"string"==typeof r||(r=r.getItem(this._substring(e,o,t))),ej.isNullOrUndefined(r)&&("NaN"!=(i=this._checkIfScopedRange(this._substring(e,o,t)))?(this._findNamedRange=!0,r=i):this._substring(e,o,t).startsWith(this.sheetToken.toString())&&((l=this._substring(e,o,t).indexOf(this.sheetToken,1))>1&&(r=this.getNamedRanges().getItem(this._substring(e.substring(o),l+1,t-l-1)))),!ej.isNullOrUndefined(r)&&this._findNamedRange&&r.indexOf(this._string_fixedreference)>-1&&(r=r.split(this._string_fixedreference).join(this._string_empty))),ej.isNullOrUndefined(r)||(r=r.toUpperCase(),r=this.setTokensForSheets(r),r=this._markLibraryFormulas(r)),ej.isNullOrUndefined(r)||r==this._string_empty)for(o+=t+1;o<e.length&&!this._isUpperChar(e[o])&&e[o]!=this.sheetToken;)o++;else e=e.substring(0,o)+r+e.substring(o+t),o+=r.length+1;for(t=o,o<e.length-1&&"{"==e[o]&&(o+=1),t=-1==e.indexOf("[")||e.indexOf("[")>this._indexOfAny(e.substring(o),s)?this._indexOfAny(e.substring(o),s):this._findNextEndIndex(e,t),t=this._indexOfAny(e.substring(o),s);0==t&&o<e.length-1;)o++,t=this._indexOfAny(e.substring(o),s);(-1==t||e.substring(o).indexOf("[")>-1)&&o<e.length&&(r=e.substring(o).indexOf("[")>-1?this._getTableRange(e.substring(o)):this.getNamedRanges().length>0?this._checkForNamedRange(e.substring(o)):r,ej.isNullOrUndefined(r)&&("NaN"!=(i=this._checkIfScopedRange(e.substring(o)))&&(r=i)),ej.isNullOrUndefined(r)||r==this._string_empty||(r=r.toUpperCase(),r=this.setTokensForSheets(r),null!=(r=this._markLibraryFormulas(r))&&(e=")"==(n=e.substring(o))[n.length-1]?e.substring(0,o)+r+")":e.substring(0,o)+r,o+=r.toString().length+1)),t=o<e.length?this._indexOfAny(e.substring(o),s):-1)}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e},this._markReserveWords=function(e){var t=e.toLowerCase();return(this._isIE8?t.replace(/^\s+|\s+$/g,""):t.trim())[0]==this.getReservedWordOperators()[this._reservedWord_IF]&&(e=this._markIF(t,e),t=this._markIFCopy),e=this._mark(t,e,this.getReservedWordOperators()[this._reservedWord_NOT],this.char_NOTop,!0),t=this._markCopy,e=this._mark(t,e,this.getReservedWordOperators()[this._reservedWord_OR],this.char_ORop,!1),t=this._markCopy,e=this._mark(t,e,this.getReservedWordOperators()[this._reservedWord_AND],this.char_ANDop,!1),t=this._markCopy,e=this._mark(t,e,this.getReservedWordOperators()[this._reservedWord_XOR],this.char_XORop,!1),t=this._markCopy,e},this._markupResultToIncludeInFormula=function(e){return e.length>0&&"-"==e[0]&&!isNaN(this._parseDouble(e))?e="nu"+e.substring(1):e.length>0&&(e[0]==this.tic[0]||e[0]==this.bMARKER||"#"==e[0])||e.startsWith(this.trueValueStr)||e.startsWith(this.falseValueStr)||(isNaN(this._parseDouble(e))?this._isRange(e)||(e=this.tic+e+this.tic):e="n"+(e=e.split(this.getParseArgumentSeparator()).join(String.fromCharCode(32)))),e},this._matchCompare=function(e,t){var i=e.toString(),r=t.toString(),l=this._parseDouble(i),n=this._parseDouble(r);return isNaN(l)||isNaN(n)?i==r?0:i>r?1:-1:l==n?0:l>n?1:-1},this._matchingRightBracket=function(e){for(var t,i,r=-1,l=1,n=0,s=this._sheetToken(e);-1==r&&l<e.length;)e[l]==this._rightBracket?0==n?r=l:0==--n&&l==e.length-1&&(r=l):"q"==e[l]&&((t=l+1)<e.length&&(i=this._processUpperCase(e,t,s),e=this._processUpperCaseFormula,t=this._processUpperCaseIvalue,s=this._processUpperCaseSheet,""!=i&&this.getLibraryFunctions().containsKey(i)&&n++)),l++;return r},this._notInBlock=function(e,t){for(var i=e.indexOf(this.bMARKER),r=!1;i>-1&&i<t;)r=!r,i=e.indexOf(this.bMARKER,i+1);return!r},this._getTopRowIndexFromRange=function(e){var t,i,r,l;return-1==(t=(e=this._markColonsInQuotes(e)).indexOf(":"))?this.rowIndex(e):(i="",(r=e.indexOf(this.sheetToken))>-1&&((l=e.indexOf(this.sheetToken,r+1))>-1&&(i=this._substring(e,r,l-r+1),t=(e=e.replace(i,"")).indexOf(":"))),this.rowIndex(e.substring(0,t)))},this._getTableRange=function(e){var t,i,r,l,n,s,o;if(i=t=(e=e.replace(" ","").toUpperCase()).replace("]","").replace("#DATA",""),t.indexOf(this.getParseArgumentSeparator())>-1&&(i=t.substring(0,t.indexOf(this.getParseArgumentSeparator())).replace("[",""),t=t.replace("[","").replace(this.getParseArgumentSeparator(),"_")),r="",e.indexOf("#THISROW")>-1){if((l=this.getNamedRanges().getItem(t.replace("#THISROW","")))==undefined||"string"==typeof l||(l=l.getItem(t.replace("#THISROW",""))),null==l)return l;l=l.toUpperCase(),n=this.rowIndex(this.cell),l=l.replace(this._string_fixedreference,""),l=this.setTokensForSheets(l),0,(s=this.getNamedRanges().getItem(i.Replace("#THISROW","")))==undefined||"string"==typeof s||(s=s.getItem(i.Replace("#THISROW",""))),s=s.replace(this._string_fixedreference,"").toUpperCase(),s=this.setTokensForSheets(s),o=this._getTopRowIndexFromRange(l),r=this.getCellsFromArgs(l)[n-o]}else if(((t="["==t[t.length-1]?t.replace("[",""):t.replace("[","_")).indexOf("#TOTALS")>-1||t.indexOf("#ALL")>-1||t.indexOf("#HEADERS")>-1||t.indexOf("#DATA")>-1)&&(t=t.replace("#","")),(r=this.getNamedRanges().getItem(t))==undefined||"string"==typeof r||(r=r.getItem(t)),null==r)return null;return r.toUpperCase()},this._calculateArraySize=function(e,t,i,r,l){var n=e.indexOf(":"),s=(this._string_empty,0),o=0;if(l=0,r=0,this._isCellReference(e))if(n>-1){var a=this.rowIndex(e.substr(0,n)),d=this.rowIndex(e.substr(n+1)),h=this.colIndex(e.substr(0,n)),c=this.colIndex(e.substr(n+1));o=c-h+1,(s=d-a+1)>t&&(d-=s-t),o>i&&(c-=o-i),s<t&&(r=s),o<i&&(l=o),e=RangeInfo.getAlphaLabel(h)+a.toString()+":"+RangeInfo.getAlphaLabel(c)+d.toString()}else r=1,l=1;else s=1,o=1,e.indexOf(",")>-1&&-1==e.indexOf(";")?o=this.splitArgsPreservingQuotedCommas(e).length:e.indexOf(";")>-1&&-1==e.indexOf(",")&&(s=this._splitArguments(e,";").length),s<t&&(r=s),o<i&&(l=o);return this._calculateArraySizeheight=t,this._calculateArraySizewidth=i,this._calculateArraySizeminHeight=r,this._calculateArraySizeminWidth=l,e},this._checkForNamedRange=function(e){var t,i,r,l,n,s=this._string_empty;return e.indexOf("[")>-1&&(t=this._getTableRange(e),ej.isNullOrUndefined(t)||(this._findNamedRange=!0,e=t)),"NaN"!=(s=this._checkIfScopedRange(e))?(this._findNamedRange=!0,e=s):(e.indexOf(this.sheetToken)>-1&&(i=CalcEngine.getSheetFamilyItem(this.grid),r=(r=e.split("'").join(this._string_empty)).substr(0,r.indexOf(this.sheetToken)),i.sheetNameToToken.containsKey(r.toUpperCase())&&(l=parseInt(i.sheetNameToToken.getItem(r.toUpperCase()).split(this.sheetToken).join(this._string_empty)),ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName||(n=e.replace(r,this.parentObject.model.sheets[l+1].sheetInfo.text.toUpperCase()).split("'").join(this._string_empty),this.getNamedRanges().length>0&&this.getNamedRanges().contains(n.toUpperCase())&&(e=n)))),this.getNamedRanges().length>0&&this.getNamedRanges().contains(e.toUpperCase())&&(ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName?(e=this._parse(this.getNamedRanges().getItem(e.toUpperCase())),(e=this.setTokensForSheets(e)).indexOf(this._string_fixedreference)>-1&&e.split(this._string_fixedreference).join(this._string_empty)):e=this._parse(this.getNamedRanges().getItem(e.toUpperCase())),this._findNamedRange=!0)),this._findNamedRange&&"!"!=e[0]&&"q"!=e[0]&&"bq"!=e[0]&&((e=this.setTokensForSheets(e)).indexOf(this._string_fixedreference)>-1&&(e=e.split(this._string_fixedreference).join(this._string_empty))),e},this._getTableRange=function(e){var t,i,r,l,n,s,o,a=e.split(this._table_Data).join(this._string_empty);if(a.indexOf(this._parseArgumentSeparator)>-1&&(a.substring(0,a.indexOf(this._parseArgumentSeparator)),a=a.split(this._parseArgumentSeparator).join(this._string_empty)),i=this._string_empty,e.toUpperCase().indexOf(this._table_Row)>-1)if((a=")"==a[a.length-1]?a.replace(")",this._string_empty):a).indexOf(":")>-1){var d=this._string_empty,h=a.toUpperCase().split(this._table_Row),c=this._splitArguments(h[1],":");for(r=0;r<c.length-1;r++){if(c[r]=h[0]+c[r],ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName?t=this.getNamedRanges()[c[r].toUpperCase().split(this._table_Row).join(this._string_empty).split("[[").join("[").split("]]").join("]")]:(this.SetNamedRangeDependency(c[r].toUpperCase(),this.cell),l=this.getNamedRanges()[c[r].toUpperCase()].split(this._table_Row).join(this._string_empty),ej.isNullOrUndefined(l)||(t=this.getNamedRanges()[c[r].toUpperCase()].split(this._table_Row).join(this._string_empty))),ej.isNullOrUndefined(t))return t;t=t.toUpperCase(),t=(t=this.setTokensForSheets(t)).split(this._string_fixedreference).join(this._string_empty),d=this._sheetToken(t.split(this.tic).join(this._string_empty)),i+=r==c.length-1?this._getCellFrom(t):this._getCellFrom(t)+":"}i=d+i}else{if(ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName?t=this.getNamedRanges()[a.toUpperCase().split(this._table_Row).join(this._string_empty).split("[[").join("[").split("]]").join("]")]:(this.SetNamedRangeDependency(a.toUpperCase(),this.cell),l=this.getNamedRanges()[a.toUpperCase()],ej.isNullOrUndefined(l)||(t=this.getNamedRanges()[a.toUpperCase()].split(this._table_Row).join(this._string_empty))),ej.isNullOrUndefined(t))return t;t=t.toUpperCase(),n=this.rowIndex(this.cell),t=t.split(this._string_fixedreference).join(this._string_empty),d=this._sheetToken(t.split(this.tic).join(this._string_empty)),s=this._getTopRowIndex(t),i=this.getCellsFromArgs(t)[n-s]}else if(a=")"==(a="["==a[a.length-1]?a.split("[").join(this._string_empty):a)[a.length-1]?a.split(")").join(this._string_empty):a,ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName?(o=this.getNamedRanges()[a.toUpperCase()],i=ej.isNullOrUndefined(o)?null:o.toString()):(this.SetNamedRangeDependency(a.toUpperCase(),this.cell),o=this.getNamedRanges().getItem(a.toUpperCase()),i=ej.isNullOrUndefined(o)?null:this.getNamedRanges().getItem(a.toUpperCase()).toString().toUpperCase()),null==i)return null;return i.toUpperCase()},this._getTopRowIndex=function(e){var t,i,r,l;return-1==(t=(e=this._markColonsInQuotes(e)).indexOf(":"))&&this.rowIndex(e),i=this._string_empty,(r=e.indexOf(this.sheetToken))>-1&&((l=e.substring(0,r+1).indexOf(this.sheetToken))>-1&&(i=e.substring(r,l-r+1),t=(e=e.split(i,this._string_empty)).indexOf(":"))),this.rowIndex(arg.substring(0,t))},this._markColonsInQuotes=function(e){var t,i,r=!1;if(-1==e.indexOf(":"))return e;for(t=new StringBuilder,i=0;i<e.length;i++)e[i]==this.tic?r=!r:":"==e[i]&&r?ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName?e=e.split(":",this._markerChar):t.append(this._markerChar):t.append(e[i]);return ej.isNullOrUndefined(this.parentObject)||"ejSpreadsheet"!=this.parentObject.pluginName||(e=t.toString()),e},this._parse=function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g=e;if(this._isTextEmpty(g))return g;if(g=this.getFormulaText(g),this.getSupportLogicalOperators()&&(g=this._markReserveWords(g)),this.getFormulaCharacter()!=String.fromCharCode(0)&&this.getFormulaCharacter()==g[0]&&(g=g.substring(1)),this.getNamedRanges().length>0&&(g=this._checkForNamedRange(g),this._findNamedRange=!1),t=this._saveStrings(g),n=0,((g=(g=(g=(g=this._saveStringsText).split(this.braceLeft).join(this.tic)).split(this.braceRight).join(this.tic)).split("-+").join("-"))[g.length-1]!=this.bMARKER||this._indexOfAny(g,this.tokens)!=g.length-2)&&(g=g.toUpperCase()),g.indexOf(this.sheetToken)>-1&&(null!=(i=CalcEngine.getSheetFamilyItem(this.grid)).sheetNameToParentObject&&i.sheetNameToParentObject.length>0))try{g[0]!=this.sheetToken.toString()&&(g=this.setTokensForSheets(g)),r=this._sheetToken(g.split(this.tic).join(this._string_empty)),m=this._checkIfScopedRange(g.split("'").join(this._string_empty).split(this.sheetToken).join(this._string_empty)),ej.isNullOrUndefined(r)&&r!=this._string_empty&&this.getNamedRanges().length>0&&m!=this._string_empty&&(g=m)}catch(e){if(this._rethrowExceptions)throw e;return e}if(this._isRangeOperand)return this._isRangeOperand=!1,this._getCellFrom(this._parseSimple(g));if(l=this._string_empty,g.indexOf("[")>-1){for(n=0;n<g.length;n++){if("["==g[n])for(;"]"!=g[n];)l=l.concat(g[n]),n++;" "!=g[n]&&(l=l.concat(g[n]))}g=l}else if(g.indexOf(" ")>-1&&this.getNamedRanges().length>0){var p=this._string_empty,m=this._string_empty,_=!1,f=this._string_empty,b=!1;for(s=0;s<g.length;s++){for(o=this._string_empty;s!=g.length&&this._isLetterOrDigit(g[s])||s!=g.length&&":"==g[s];)f=f.concat(g[s++]);if((m=this.getNamedRanges().getItem(f.toUpperCase()))!=undefined?(o=o.concat(f),_=!0):this.getLibraryFunctions().getItem(f)!=undefined?o=o.concat(f):f!=this._string_empty&&(o=o.concat(f)),s!=g.length&&" "==g[s]&&0!=s&&this._isLetterOrDigit(g[s-1])|")"==g[s-1]){for(f=this._string_empty,s++;s!=g.length&&this._isLetterOrDigit(g[s])||s!=g.length&&":"==g[s];)f=f.concat(g[s++]);m=this.getNamedRanges().getItem(f.toUpperCase()),_&&!b&&m!=undefined?o=o.concat(" "+f):_&&f.indexOf(":")>-1?o=o.concat(" "+f):m==undefined&&this.getLibraryFunctions().getItem(f)!=undefined&&_?(o=o.concat(" "+f),b=!0):f!=this._string_empty&&(o=o.concat(f))}s!=g.length&&")"==g[s]?(o=o.concat(g[s]),b=!1):s!=g.length&&")"!=g[s]&&" "!=g[s]?o=o.concat(g[s]):s!=g.length&&" "==g[s]&&_&&this._isLetterOrDigit(g[s-1])|")"==g[s-1]?o=o.concat(g[s]):s==g.length||f!=this._string_empty||_||" "==g[s]||(o=o.concat(this._string_empty)),p+=o,f=this._string_empty}g=p}else g=g.split(" ").join("");g=(g=g.split("=>").join(">=")).split("=<").join("<=");try{g=this._markLibraryFormulas(g)}catch(e){if(this._rethrowLibraryComputationExceptions)throw e}if(!this._ignoreBracet)for(;(n=g.indexOf(")"))>-1;){if(-1==(a=g.substring(0,n).lastIndexOf("(")))throw this.formulaErrorStrings[this._mismatched_parentheses];if(a==n-1)throw this.formulaErrorStrings[this._empty_expression];if(d="",(d=this._ignoreBracet?this._substring(g,a,n-a+1):this._substring(g,a+1,n-a-1)).indexOf(":")>-1&&-1==d.indexOf("q")&&-1==d.indexOf("=")&&-1==d.indexOf("[")){d.indexOf(this._string_fixedreference)>-1&&(d=d.split(this._string_fixedreference).join(this._string_empty));try{if((h=this.getCellsFromArgs(d)).length>0)for(c=0;c<h.length;c++)this.updateDependencies(h[c])}catch(e){return this._errorStrings[5]}}g=g.substring(0,a)+this._parseSimple(d)+g.substring(n+1)}if(!this._ignoreBracet&&g.indexOf("(")>-1)throw this.formulaErrorStrings[this._mismatched_parentheses];return u=this._parseSimple(g),null!=t&&t.length>0&&(u=this._setStrings(u,t)),u},this._parseDouble=function(e){var t=ej.parseFloat(e.toString(),0,ej.cultureObject.name);return isNaN(t)?NaN:t},needToContinue=!0,this._parseSimple=function(e){var t=e;if(t.length>0&&"+"==t[0]&&(t=t.substring(1)),"#N/A"==t||"#N~A"==t)return"#N/A";if(t.indexOf("#N/A")>-1&&(t=t.split("#N/A").join("#N~A")),"#DIV/0!"==t||"#DIV~0!"==t)return"#DIV/0!";if(t.indexOf("#DIV/0!")>-1&&(t=t.split("#DIV/0!").join("#DIV~0!")),""==(t=(t=(t=(t=(t=(t=(t=this._handleEmbeddedEs(t)).split(this._string_lesseq).join(this.char_lesseq)).split(this._string_greatereq).join(this.char_greatereq)).split(this._string_noequal).join(this.char_noequal)).split(this._string_fixedreference).join(this._string_empty)).split(this._string_or).join(this.char_or)).split(this._string_and).join(this.char_and)))return t;needToContinue=!0;var i=[this.token_EP,this.token_EM],r=[this.token_or],l=[this.token_multiply,this.token_divide],n=[this.token_add,this.token_subtract],s=[this.token_less,this.token_greater,this.token_equal,this.token_lesseq,this.token_greatereq,this.token_noequal],o=[this.token_NOTop],a=[this.token_ORop,this.token_ANDop,this.token_XORop],d=[this.token_and],h=[this.char_EP,this.char_EM],c=[this.char_or],u=[this.char_multiply,this.char_divide],g=[this.char_add,this.char_subtract],p=[this.char_less,this.char_greater,this.char_equal,this.char_lesseq,this.char_greatereq,this.char_noequal],m=[this.char_NOTop],_=[this.char_ORop,this.char_ANDop,this.char_XORop],f=[this.char_and];return t=this._parseSimpleOperators(t,i,h),t=this._parseSimpleOperators(t,r,c),needToContinue&&(t=this._parseSimpleOperators(t,l,u)),needToContinue&&(t=this._parseSimpleOperators(t,n,g)),needToContinue&&(t=this._parseSimpleOperators(t,s,p)),needToContinue&&(t=this._parseSimpleOperators(t,o,m)),needToContinue&&(t=this._parseSimpleOperators(t,a,_)),needToContinue&&(t=this._parseSimpleOperators(t,d,f)),t.indexOf("#N~A")>-1&&(t=t.split("#N~A").join("#N/A")),t.indexOf("#DIV~0!")>-1&&(t=t.split("#DIV~0!").join("#DIV/0!")),t},this._parseSimpleOperators=function(e,t,i){for(var r,l,n,s,o,a,d,h,c,u,g,p=e,m="",_=0;_<i.length;_++)m+=i[_];(p=(p=(p=p.split("---").join("-").split("--").join("+").split(this.getParseArgumentSeparator()+"-").join(this.getParseArgumentSeparator()+"u").split(this._leftBracket+"-").join(this._leftBracket+"u").split("=-").join("=u")).split(">-").join(">u").split("<-").join("<u").split("/-").join("/u").split("*-").join("*u").split("+-").join("-").split("--").join("-u").split("w-").join("wu").split(this.tic+"-").join(this.tic+"u").toString()).split(",+").join(",").split(this._leftBracket+"+").join(this._leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").toString()).length>0&&"-"==p[0]?(p="0-"+(p=p.substring(1).split("-").join(this.token_ORop)),p=(p=this._parseSimpleOperators(p,[this.token_subtract],[this.char_subtract])).split(this.token_ORop).join("-")):p.length>0&&"+"==p[0]&&(p=p.substring(1));try{if(this._indexOfAny(p,i)>-1)for(;(g=this._indexOfAny(p,i))>-1;){var f="",b="",C=0,S=0,x=0;if(this._supportLogicalOperators&&p[g]==this.char_NOTop)C=g;else{if(g<1&&"-"!=p[g])throw this.formulaErrorStrings[this._operators_cannot_start_an_expression];if(x=g-1,0==g&&"-"==p[g]){p=this.bMARKER+"nu"+p.substring(1)+this.bMARKER;continue}if(p[x]==this.tic[0]){if((u=p.substring(0,x-1).lastIndexOf(this.tic))<0)throw this.formulaErrorStrings[this._cannot_parse];f=this._substring(p,u,x-u+1),C=u}else if(p[x]==this.bMARKER){if((u=this._findLastNonQB(p.substring(0,x-1)))<0)throw this.formulaErrorStrings[this._cannot_parse];f=this._substring(p,u+1,x-u-1),C=u+1}else if(p[x]==this._rightBracket){for(d=0,u=x-1;u>0&&("q"!=p[u]||0!=d);)"q"==p[u]?d--:p[u]==this._rightBracket&&d++,u--;if(u<0)throw this.formulaErrorStrings[this._cannot_parse];f=this._substring(p,u,x-u+1),C=u}else if(this._isDigit(p[x])||"%"==p[x]){for(h=!1,c=!1;x>-1&&(this._isDigit(p[x])||!h&&p[x]==this.getParseDecimalSeparator()||!c&&"%"==p[x]||"u"==p[x]||"_"==p[x]);)p[x]==this.getParseDecimalSeparator()?h=!0:"%"==p[x]&&(c=!0),x-=1;if(x>-1&&h&&p[x]==this.getParseDecimalSeparator())throw this.formulaErrorStrings[this._number_contains_2_decimal_points];if(0==(x+=1)||x>0&&!this._isUpperChar(p[x-1]))f="n"+this._substring(p,x,g-x),C=x;else{for(x-=1;x>-1&&(this._isUpperChar(p[x])||this._isDigit(p[x])||"_"==p[x]);)x-=1;if(x>-1&&"u"==p[x]&&(x-=1),x>-1&&p[x]==this.sheetToken){for(x-=1;x>-1&&p[x]!=this.sheetToken;)x-=1;x>-1&&p[x]==this.sheetToken&&(x-=1)}if(x>-1&&":"==p[x]){for(x-=1;x>-1&&this._isDigit(p[x]);)x-=1;for(;x>-1&&this._isUpperChar(p[x]);)x-=1;if(x>-1&&p[x]==this.sheetToken){for(x--;x>-1&&p[x]!=this.sheetToken;)x--;x>-1&&p[x]==this.sheetToken&&x--}x+=1,f=this._substring(p,x,g-x),f=this._getCellFrom(f)}else x+=1,f=this._substring(p,x,g-x);this.updateDependencies(f),C=x,this.getNamedRanges().length>0&&(f=this._checkForNamedRange(f))}}else{for(;x>=0&&(this._isUpperChar(p[x])||"_"==p[x]||"."==p[x]);)x--;if(f=this._substring(p,x+1,g-x-1),C=x+1,"",this.getNamedRanges().length>0&&(f=this._checkForNamedRange(f)),!this._findNamedRange)if(f==this.trueValueStr)f="n"+this.trueValueStr;else{if(f!=this.falseValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_char_in_front_of]+" "+p[g];return this.getErrorStrings()[5].toString()}f="n"+this.falseValueStr}this._findNamedRange=!1}}if(g==p.length-1)throw this.formulaErrorStrings[this._expression_cannot_end_with_an_operator];if((r="u"==p[x=g+1])&&x++,p[x]==this.tic[0]){if((u=p.substring(x+1).indexOf(this.tic))<0)throw this.formulaErrorStrings[this._cannot_parse];b=this._substring(p,x,u+2),S=u+x+2}else if(p[x]==this.bMARKER){if((u=this._findNonQB(p.substring(x+1)))<0)throw this.formulaErrorStrings[this._cannot_parse];b=this._substring(p,x+1,u),r&&(b+="nu1m"),S=u+x+2}else if("q"==p[x]){for(d=0,u=x+1;u<p.length&&(p[u]!=this._rightBracket||0!=d);)p[u]==this._rightBracket?d++:"q"==p[u]&&d--,u++;if(u==p.length)throw this.formulaErrorStrings[this._cannot_parse];b=this._substring(p,x,u-x+1),r&&(b="u"+b),S=u+1}else if(this._isDigit(p[x])||p[x]==this.getParseDecimalSeparator()){for(h=p[x]==this.getParseDecimalSeparator(),x+=1;x<p.length&&(this._isDigit(p[x])||!h&&p[x]==this.getParseDecimalSeparator());)p[x]==this.getParseDecimalSeparator()&&(h=!0),x+=1;if(x<p.length&&"%"==p[x]&&(x+=1),h&&x<p.length&&p[x]==this.getParseDecimalSeparator())throw this.formulaErrorStrings[this._number_contains_2_decimal_points];b="n"+this._substring(p,g+1,x-g-1),S=x}else{if(!this._isUpperChar(p[x])&&p[x]!=this.sheetToken&&"u"!=p[x]){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_characters_following_an_operator];return this.getErrorStrings()[5].toString()}if(p[x]==this.sheetToken)for(x++;x<p.length&&p[x]!=this.sheetToken;)x++;for(x+=1,l=0,n=!1;x<p.length&&(this._isUpperChar(p[x])||"_"==p[x]||"."==p[x]||"["==p[x]||"]"==p[x]||"#"==p[x]||" "==p[x]||"%"==p[x]||p[x]==this.getParseDecimalSeparator()&&n);)x!=p.length-1&&"["==p[x]&&"["==p[x+1]&&(n=!0),x!=p.length-1&&"]"==p[x]&&"]"==p[x+1]&&(n=!1),x++,l++;if(s=x==p.length||!this._isDigit(p[x]),l>1){for(;x<p.length&&(this._isUpperChar(p[x])||this._isDigit(p[x])||" "==p[x]||"_"==p[x]);)x++;s=!0}for(;x<p.length&&this._isDigit(p[x]);)x+=1;if(x<p.length&&":"==p[x]){if((x+=1)<p.length&&p[x]==this.sheetToken){for(x++;x<p.length&&p[x]!=this.sheetToken;)x+=1;x<p.length&&p[x]==this.sheetToken&&x++}for(;x<p.length&&this._isUpperChar(p[x]);)x+=1;for(;x<p.length&&this._isDigit(p[x]);)x+=1;x-=1,b=this._substring(p,g+1,x-g),b=this._getCellFrom(b)}else x-=1,b=this._substring(p,g+1,x-g),(r="u"==p[x])&&(b="u"+b);if(s&&b.startsWith(this.sheetToken)&&(s=!this._isCellReference(b)),s){if("",this.getNamedRanges().length>0&&(b=this._checkForNamedRange(b)),!this._findNamedRange)if(f==this.trueValueStr)f="n"+this.trueValueStr;else{if(f!=this.falseValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_char_in_front_of]+" "+p[g];return this.getErrorStrings()[5].toString()}f="n"+this.falseValueStr}this._findNamedRange=!1}else this.updateDependencies(b);S=x+1}o=m.indexOf(p[g]),a=this.bMARKER+this._zapBlocks(f)+this._zapBlocks(b)+t[o]+this.bMARKER,C>0&&(a=p.substring(0,C)+a),S<p.length&&(a+=p.substring(S)),p=a=a.split(this.bMARKER2).join(this.bMARKER.toString())}else{if(p[x=p.length-1]==this.bMARKER){if((u=this._findLastNonQB(p.substring(0,x-1)))<0)throw this.formulaErrorStrings[this._cannot_parse]}else if(p[x]==this._rightBracket){for(d=0,u=x-1;u>0&&("q"!=p[u]||0!=d);)"q"==p[u]?d--:p[u]==this._rightBracket&&d++,u--;if(u<0)throw this.formulaErrorStrings[this._bad_library]}else if(this._isDigit(p[x])){for(h=!1,c=!1;x>-1&&(this._isDigit(p[x])||!h&&p[x]==this.getParseDecimalSeparator()||!c&&"%"==p[x]);)p[x]==this.getParseDecimalSeparator()?h=!0:"%"==p[x]&&(c=!0),x-=1;if(x>-1&&h&&p[x]==this.getParseDecimalSeparator())throw this.formulaErrorStrings[this._number_contains_2_decimal_points]}if(p.length>0&&(this._isUpperChar(p[0])||p[0]==this.sheetToken)){var v=!0,w=!0,I=!1;for(u=0;u<p.length;++u)if(p[u]==this.sheetToken){if(u>0&&!I)throw this.formulaErrorStrings[this._missing_sheet];for(I=!0,u++;u<p.length&&this._isDigit(p[u]);)u++;if(u==p.length||p[u]!=this.sheetToken){v=!1;break}}else{if(!w&&this._isLetter(p[u])){v=!1;break}if(!this._isLetterOrDigit(p[u])&&p[u]!=this.sheetToken){v=!1;break}w=this._isUpperChar(p[u])}v&&(this.updateDependencies(p),needToContinue=!1)}}return p}catch(e){return e}},this._pop=function(e){var t,i,r,l=e.pop();if(null!=l){if(l.toString()==this.tic+this.tic)return NaN;if(t=l.toString().split(this.tic).join(""),this.getErrorStrings().indexOf(t)>-1)return this._isErrorString=!0,this.getErrorStrings().indexOf(t);if("#"==t[0]||""==t)return 0;if(t==this.trueValueStr)return 1;if(t==this.falseValueStr)return 0;if(ej.isNullOrUndefined(ej.cultureObject)||"en-US"==ej.cultureObject.name||isNaN(parseFloat(t))||(t=_getLocaleNumberValue(t)),i=ej.isNullOrUndefined(ej.cultureObject)?this._parseDouble(t):ej.parseFloat(t,0,ej.cultureObject.name),!isNaN(i))return i;if(this.getUseDatesInCalculations()&&isNaN(this._parseDouble(l)))return r=this._isDate(t),isNaN(r)?0:this._getSerialDateTimeFromDate(r)}return""==t&&this.getTreatStringsAsZero()?0:null!=l&&l.toString().length>0?Number.NaN:0},this._popString=function(e){var t=e.pop(),i=null!=t?ej.isNullOrUndefined(ej.cultureObject)?this._parseDouble(t.toString()):ej.parseFloat(t.toString(),0,ej.cultureObject.name):NaN;if(null==t)t="";else if(!isNaN(i))return i.toString();return this.removeTics(t.toString())},this._populateNamedRangesNonScoped=function(){null==this._namedRangesNonScoped&&(this._namedRangesNonScoped=new HashTable),this._namedRangesNonScoped.clear();for(var e=0;e<this.namedRanges.keys().length;e++)this._checkAddNonScopedNamedRange(this.namedRanges.keys()[e])},this._processUpperCase=function(e,t,i){for(var r="";t<e.length&&this._isUpperChar(e[t]);)r+=e[t],t+=1;for(;t<e.length&&this._isDigit(e[t]);)r+=e[t],t+=1;if(r,t,t<e.length&&":"==e[t]){if(r+=e[t],(t+=1)<e.length&&e[t]==this.sheetToken)for(r+=e[t],t+=1;t<e.length&&e[t]!=this.sheetToken;)r+=e[t],t+=1;for(;t<e.length&&this._isUpperChar(e[t]);)r+=e[t],t+=1;for(;t<e.length&&this._isDigit(e[t]);)r+=e[t],t+=1;r=i+this._getCellFrom(r)}else r=i+r;return i="",this._processUpperCaseFormula=e,this._processUpperCaseIvalue=t,this._processUpperCaseSheet=i,r},this._saveStrings=function(e){var t,i,r,l,n,s=null,o=this.tic+this.tic,a=0,d=-1;if((d=e.indexOf(this.tic))>-1)for(;d>-1&&d<e.length;)if(null==s&&(s=new HashTable),(t=d+1<e.length?e.indexOf(this.tic,d+1):-1)>-1){if(i=this.tic+this._uniqueStringMarker+a.toString()+this.tic,t<e.length-2&&e[t+1]==this.tic[0]&&-1==(t=e.indexOf(this.tic,t+2)))throw this.formulaErrorStrings[this._mismatched_tics];r=this._substring(e,d,t-d+1),s.add(i,r),r=r.split(o).join(this.tic),a++,e=e.substring(0,d)+i+e.substring(t+1),(d+=i.length)<e.length&&(d=e.indexOf(this.tic,d))}else{if(!(-1==t&&e.indexOf(this.sheetToken)>-1&&d<e.indexOf(this.sheetToken,d)))throw this.formulaErrorStrings[this._mismatched_tics];for(l="",n=e.indexOf(this.sheetToken,d)-1;n>-1&&-1==this.getValidPrecedingChars().indexOf(e[n].toString());n--)l=e[n]+l;if("'"!=l[0]||"'"!=l[l.length-1])throw this.formulaErrorStrings[this._mismatched_tics];if("'"==l[0]&&(l=l.substring(1)),"'"==l[l.length-1]&&(l=l.substring(0,l.length-1)),-1==this.getSortedSheetNames().indexOf(l.toUpperCase()))throw this.formulaErrorStrings[this._missing_sheet];d+1<e.length&&(d=e.indexOf(this.tic,d+1))}return this._saveStringsText=e,s},this._setStrings=function(e,t){for(var i=t.keys(),r=0;r<i.length;r++)e=e.split(i[r]).join(t.getItem(i[r]));return e},this._sheetToken=function(e){var t=0,i="";if(t<e.length&&e[t]==this.sheetToken){for(t++;t<e.length&&e[t]!=this.sheetToken;)t++;i=e.substring(0,t+1)}if(t<e.length)return i;throw this.formulaErrorStrings[this._bad_index]},this._splitArguments=function(e,t){return e.split(t)},this._stripTics0=function(e){return e.length>1&&e[0]==this.tic[0]&&e[e.length-1]==this.tic[0]&&(e=this._substring(e,1,e.length-2)),e},this._substring=function(e,t,i){return e.substring(t,i+t)},this._isTextEmpty=function(e){return null==e||""==e},this._toOADate=function(e){return(e.getTime()-Date.parse(this._oaDate))/this._millisecondsOfaDay},this._zapBlocks=function(e){var t,i;if(e.indexOf(this.bMARKER)>-1)for(t=0,i=e.length-1;i>0;--i)e[i]==this._rightBracket?t--:e[i]==this._leftBracket?t++:e[i]==this.bMARKER&&0==t&&(e=e.substring(0,i-1)+e.substring(i+1));return e},this.addCustomFunction=function(e,t){return e=e.toUpperCase(),this._addFunction(e,t),this._customlibraryFunctions.getItem(e)==undefined&&(this._customlibraryFunctions.add(e,t),!0)},this.UpdateDependentNamedRangeCell=function(e){var t,i,r;if(null!=this.getDependentNamedRangeCells()&&this.getDependentNamedRangeCells().containsKey(e)&&(null!=(t=this.getDependentNamedRangeCells().keys())&&t.length>0))for(i=0;i<t.length;i++){var l,n,s=this.getDependentNamedRangeCells().getItem(t[i]).keys()[0],o=s.indexOf(this.sheetToken),a=this.grid;o>-1?(r=CalcEngine.getSheetFamilyItem(this.grid),this.grid=r.tokenToParentObject.getItem(s.substring(0,o+3)),l=this.rowIndex(s),n=this.colIndex(s)):(l=this.rowIndex(s),n=this.colIndex(s)),this.recalculateRange(RangeInfo.cells(l,n,l,n),this.grid),this.grid=a}},this.RemoveNamedRangeDependency=function(e){this.getDependentNamedRangeCells().containsKey(e)&&(Hashtable(this.getDependentNamedRangeCells()[e]).Clear(),this.getDependentNamedRangeCells().remove(e))},this.SetNamedRangeDependency=function(e,t){var i,r,l=CalcEngine.getSheetFamilyItem(this.grid);null!=l.sheetNameToParentObject&&-1==t.indexOf(this.sheetToken)&&(t=l.GridModelToToken[this.grid]+t),null!=this.getDependentNamedRangeCells()&&this.getDependentNamedRangeCells().containsKey(e)?(i=this.getDependentNamedRangeCells().getItem(e)).containsKey(t)||i.add(t,"0"):((r=new HashTable).add(t,"0"),this.getDependentNamedRangeCells().add(e,r))},this.addNamedRange=function(e,t){return e=e.toUpperCase(),null==this.getNamedRanges().getItem(e)&&(this.getNamedRanges().add(e,t),this.getNameRangeValues().containsKey(e)||this.getNameRangeValues().add(e,t.toString()),(this.getUndefinedNamedRanges().containsKey(e)||this.getUndefinedNamedRanges().containsKey(e.toUpperCase())||this.getUndefinedNamedRanges().containsKey(e.toLowerCase()))&&(this.SetNamedRangeDependency(e.toUpperCase(),this.cell),this.UpdateDependentNamedRangeCell(e.toUpperCase())),this.namedRangesSized=null,this._checkAddNonScopedNamedRange(e),!0)},this.adjustRangeArg=function(e){return e.length>1&&e[0]==this.bMARKER&&e[e.length-1]==this.bMARKER&&-1==this._substring(e,1,e.length-2).indexOf(this.bMARKER)&&(e=this.computedValue(e)),e.length>1&&e[0]==this.tic[0]&&e[e.length-1]==this.tic[0]&&(e=this._substring(e,1,e.length-2)),e},this.clearFormulaDependentCells=function(e){var t,i,r,l,n=this.getDependentFormulaCells().getItem(e);if(null!=n){for(t=n.keys(),i=0;i<t.length;i++)r=t[i],l=this.getDependentCells().getItem(r),this._arrayRemove(l,e),0==l.length&&this.getDependentCells().remove(r);this.getDependentFormulaCells().remove(e)}},this.clearLibraryComputationException=function(){this._libraryComputationException=null},this.colIndex=function(e){var t=0,i=0;if(t<(e=e.toUpperCase()).length&&e[t]==this.sheetToken){for(t++;t<e.length&&e[t]!=this.sheetToken;)t++;t++}for(;t<e.length&&this._isLetter(e[t]);)i=26*i+e[t].charCodeAt(0)-64,t++;return 0==i?-1:i},this.computedValue=function(formula){var _stack,i,sheet,loc,nextIfLoc,sepLoc,ifResult,rightPiece,uFound,d3,family,token,ii,t,name,j,args,functionName,result,isErrorStringValue,errIndex,o,x,s2,d1,s1,val,s,d,cc;if(this._isTextEmpty(formula))return formula;try{if(this.computedValueLevel++,this.computedValueLevel>1&&(this._isInteriorFunction=!0),this.computedValueLevel>this._maximumRecursiveCalls)throw this.computedValueLevel=0,this.formulaErrorStrings[this._too_complex];if(_stack=[],i=0,_stack.length=0,sheet="",this.getAllowShortCircuitIFs()){loc=-1;do{if(i<formula.length&&(i=formula.indexOf(this.iFMarker,i))>-1&&(loc=this._matchingRightBracket(formula.substring(i)),loc>-1)){result="",nextIfLoc=formula.indexOf(this.iFMarker,loc);do{loc=i,sepLoc=this._findNextSeparator(formula,loc),isNaN(sepLoc)||(loc=sepLoc);for(var funcArgs=this._substring(formula,i+this.iFMarker.length,loc-this.iFMarker.length-1),ifArguments=[],argLoc=0,argNo=0;argLoc<funcArgs.length;)sepLoc=this._findNextSeparator(funcArgs,argLoc),isNaN(sepLoc)?argLoc>0&&arguments.push(funcArgs.substring(0,argLoc)):(argLoc=sepLoc,ifArguments.push(funcArgs.substring(0,argLoc)),funcArgs=funcArgs.substring(Number(argLoc)+1),argLoc=0);ifResult=this.getValueFromArg(ifArguments[0]),result=ifResult==this.trueValueStr?this.getValueFromArg(ifArguments[1]):this.getValueFromArg(ifArguments[2]),nextIfLoc=formula.indexOf(this.iFMarker,loc)}while(formula.indexOf(this.iFMarker)>-1&&nextIfLoc>-1);result=this._markupResultToIncludeInFormula(result),rightPiece="",i+loc+1<formula.length&&(rightPiece=formula.substring(i+loc+1)),formula=formula.substring(0,i)+result+rightPiece}}while(formula.indexOf(this.iFMarker)>-1&&loc>-1)}for(i=0;i<formula.length;)if(formula[i]!=this.bMARKER){if(uFound="u"==formula[i],uFound){if(i++,i>=formula.length)continue;if(formula[i]==this.bMARKER&&i++,i>=formula.length)continue}if("%"==formula[i]&&_stack.length>0)o=_stack[0],d=this._parseDouble(o),isNaN(d)||(_stack.pop(),_stack.push(Number(d)/100)),i+=1;else{if(formula[i]==this.sheetToken){for(sheet=formula[i].toString(),i++;i<formula.length&&formula[i]!=this.sheetToken;)sheet+=formula[i],i++;if(!(i<formula.length))continue;sheet+=formula[i],i++}if(0==formula.substring(i).indexOf(this.trueValueStr))_stack.push(this.trueValueStr),i+=this.trueValueStr.length;else if(0==formula.substring(i).indexOf(this.falseValueStr))_stack.push(this.falseValueStr),i+=this.falseValueStr.length;else if(formula[i]==this.tic[0]||"|"==formula[i]){for(3==_stack.length&&(_stack=this._combineStack(formula,i-2,_stack)),s=formula[i].toString(),i++;i<formula.length&&formula[i]!=this.tic[0];)s+=formula[i],i+=1;this._multiTick&&(s=s.split("|").join(this.tic)),_stack.push(s+this.tic),i+=1}else if(this._isUpperChar(formula[i]))if(s=this._processUpperCase(formula,i,sheet),formula=this._processUpperCaseFormula,i=this._processUpperCaseIvalue,sheet=this._processUpperCaseSheet,uFound)s=this.getValueFromParentObjectCell(s),d3=this._parseDouble(s),isNaN(d3)?_stack.push(s):(d3=-d3,_stack.push(d3.toString()));else if(this.getUseFormulaValues()&&this.computedValueLevel>50){if(-1==this._breakedFormulaCells.indexOf(s)&&this.getUseFormulaValues()){family=CalcEngine.getSheetFamilyItem(this.grid),token=this.sheetToken+this.getSheetID(this.grid).toString()+this.sheetToken,s=token+s,this._breakedFormulaCells.add(s),this._tempBreakedFormulaCells.add(s);break}_stack.push("FALSE")}else _stack.push(this.getValueFromParentObjectCell(s));else if("q"==formula[i]){if(formula=this._computeInteriorFunctions(formula),ii=formula.substring(i+1).indexOf(this._leftBracket),!(ii>0)){if(formula[0]==this.bMARKER){i=0,_stack.length=0;continue}throw this.formulaErrorStrings[this._improper_formula]}for(var bracketCount=0,bracketFound=!1,start=ii+i+2,k=start;k<formula.length&&(formula[k]!=this._rightBracket||bracketCount>0);)formula[k]==this._leftBracket?(bracketCount++,bracketFound=!0):formula[k]==this._leftBracket&&bracketCount--,k++;if(bracketFound){var s=this._substring(formula,start,k-start-2),s1="",splits=this.splitArgsPreservingQuotedCommas(s);for(t=0;t<splits.length;t++)s1.length>0&&(s1+=","),j=this._findLastqNotInBrackets(t),s1+=j>0?splits[t].substring(0,j)+this.computedValue(splits[t].substring(j)):this.computedValue(splits[t]);formula=formula.substring(0,start)+s1+formula.substring(k-2)}if(name=this._substring(formula,i+1,ii),"AVG"==name&&this._excelLikeComputations)throw this.formulaErrorStrings[this._bad_index];if(this.getLibraryFunctions().getItem(name)!=undefined){j=formula.substring(i+ii+1).indexOf(this._rightBracket),args=this._substring(formula,i+ii+2,j-1);try{if(functionName=this.getLibraryFunctions().getItem(name),result=this.getCustomLibraryFunctions().getItem(name)!=undefined?eval(functionName)(args,this.parentObject):this[functionName](args),isErrorStringValue=!1,this.getErrorStrings().indexOf(result)>0&&(isErrorStringValue=!0),!ej.isNullOrUndefined(this.parentObject)&&"ejSpreadsheet"==this.parentObject.pluginName&&null!=this.parentObject.model.formulaComputed){if(args={reqType:"formulaComputed",Formula:name,ComputedValue:result,Cell:this.cell,IsErrorString:isErrorStringValue,IsInteriorFunction:this._isInteriorFunction,Handled:!1},this.parentObject._trigger("formulaComputed",args),args.Handled)return this._string_empty;result=args.ComputedValue}_stack.push(result)}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this._libraryComputationException=e,e;return e}i+=j+ii+2}else if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._missing_formula]}else if(this._isDigit(formula[i])||"u"==formula[i]){if(s="",("u"==formula[i]||uFound)&&(s="-",uFound?uFound=!1:i++),i<formula.length&&this._isUpperChar(formula[i]))s+=this.getValueFromParentObjectCell(this._processUpperCase(formula,i,sheet)),formula=this._processUpperCaseFormula,i=this._processUpperCaseIvalue,sheet=this._processUpperCaseSheet;else for(;i<formula.length&&(this._isDigit(formula[i])||formula[i]==this.getParseDecimalSeparator());)s+=formula[i],i+=1;_stack.push(s)}else{if(formula[i]==this._parseArgumentSeparator){i++;continue}switch(formula[i]){case"#":errIndex=0,this.getErrorStrings().indexOf(formula.substring(i)>-1)?(errIndex=-1==formula.indexOf("!")||-1==formula.substring(i).indexOf("!")?formula.indexOf("#N/A")>-1?formula.indexOf("#N/A")+4+i:formula.indexOf("?")+1+i:formula.indexOf("!")+1+i,_stack.push(this._substring(formula,i,errIndex-i))):(errIndex=i+1,_stack.push(this._substring(formula,i,errIndex-i))),i=errIndex;break;case"n":if(i+=1,s="",0==formula.substring(i).indexOf("Infinity"))s="Infinity",i+=s.length;else if(0==formula.substring(i).indexOf("uInfinity"))s="Infinity",i+=s.length+1;else if(0==formula.substring(i).indexOf(this.trueValueStr))s=this.trueValueStr,i+=s.length;else if(0==formula.substring(i).indexOf(this.falseValueStr))s=this.falseValueStr,i+=s.length;else if(i<=formula.length-3&&"NaN"==formula.substring(i,3))i+=3,s="0";else{for(("u"==formula[i]||uFound)&&(s="-",uFound?uFound=!1:i+=1);i<formula.length&&(this._isDigit(formula[i])||formula[i]==this.getParseDecimalSeparator());)s+=formula[i],i+=1;i<formula.length&&"%"==formula[i]?(i+=1,""==s?_stack.length>0&&(o=_stack[0],d=this._parseDouble(o.toString()),isNaN(d)||(_stack.pop(),s=(d/100).toString())):s=(this._parseDouble(s)/100).toString()):i<formula.length-2&&"E"==formula[i]&&("+"==formula[i+1]||"-"==formula[i+1])&&(s+=this._substring(formula,i,4),i+=4)}_stack.push(s);break;case this.token_add:if(d=this._pop(_stack),x=parseInt(d.toString()),!isNaN(x)&&this._isErrorString||(d1=this._pop(_stack),x=parseInt(d1.toString()),!isNaN(x)&&this._isErrorString))return this._isErrorString=!1,this.getErrorStrings()[x].toString();isNaN(d)||isNaN(d1)?_stack.push("#VALUE!"):_stack.push((Number(d1)+Number(d)).toString()),i+=1;break;case this.token_subtract:if(d=this._pop(_stack),x=parseInt(d.toString()),!isNaN(x)&&this._isErrorString||(d1=this._pop(_stack),x=parseInt(d1.toString()),!isNaN(x)&&this._isErrorString))return this._isErrorString=!1,this.getErrorStrings()[x].toString();isNaN(d)||isNaN(d1)?_stack.push("#VALUE!"):_stack.push((d1-d).toString()),i+=1;break;case this.token_multiply:if(d=this._pop(_stack),x=parseInt(d.toString()),!isNaN(x)&&this._isErrorString||(d1=this._pop(_stack),x=parseInt(d1.toString()),!isNaN(x)&&this._isErrorString))return this._isErrorString=!1,this.getErrorStrings()[x].toString();isNaN(d)||isNaN(d1)?_stack.push("#VALUE!"):_stack.push((d1*d).toString()),i+=1;break;case this.token_divide:if(d=this._pop(_stack),x=parseInt(d.toString()),!isNaN(x)&&this._isErrorString||(d1=this._pop(_stack),x=parseInt(d1.toString()),!isNaN(x)&&this._isErrorString))return this._isErrorString=!1,this.getErrorStrings()[x].toString();isNaN(d)||isNaN(d1)?_stack.push("#VALUE!"):0==d?_stack.push(this.getErrorStrings()[3]):_stack.push((d1/d).toString()),i+=1;break;case this.token_EP:d=this._pop(_stack),d1=this._pop(_stack),_stack.push((d1*Math.pow(10,d)).toString()),i+=1;break;case this.token_EM:d=this._pop(_stack),d1=this._pop(_stack),_stack.push((Number(d1)*Math.pow(10,-Number(d))).toString()),i+=1;break;case this.token_less:s1=this._popString(_stack),s2=this._popString(_stack),""==s2&&this.getTreatStringsAsZero()&&""!=s1&&(s2="0"),d=this._parseDouble(s1),d1=this._parseDouble(s2),val=isNaN(d)||isNaN(d1)?"#VALUE!"==s1||"#VALUE!"==s2?"#VALUE!":s2.toUpperCase().split(this.tic).join("").localeCompare(s1.toUpperCase().split(this.tic).join(""))<0?this.trueValueStr:this.falseValueStr:d1<d?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_greater:s1=this._popString(_stack),s2=this._popString(_stack),""==s2&&""!=s1&&(s2=this.getTreatStringsAsZero()?"0":s1+1),d=this._parseDouble(s1),d1=this._parseDouble(s2),val=isNaN(d)||isNaN(d1)?"#VALUE!"==s1||"#VALUE!"==s2?"#VALUE!":s2.toUpperCase().split(this.tic).join("").localeCompare(s1.toUpperCase().split(this.tic).join(""))>0?this.trueValueStr:this.falseValueStr:Number(d1)>Number(d)?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_equal:s1=this._popString(_stack),s2=this._popString(_stack),""==s2&&this.getTreatStringsAsZero()&&""!=s1&&(s2="0"),d=this._parseDouble(s1),d1=this._parseDouble(s2),val=isNaN(d)||isNaN(d1)?"#VALUE!"==s1||"#VALUE!"==s2?"#VALUE!":s1.toUpperCase().split(this.tic).join("")==s2.toUpperCase().split(this.tic).join("")?this.trueValueStr:this.falseValueStr:Number(d1)==Number(d)?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_lesseq:s1=this._popString(_stack),s2=this._popString(_stack),""==s2&&this.getTreatStringsAsZero()&&""!=s2&&(s2="0"),d=this._parseDouble(s1),d1=this._parseDouble(s2),val=isNaN(d)||isNaN(d1)?"#VALUE!"==s1||"#VALUE!"==s2?"#VALUE!":s1.toUpperCase().split(this.tic).join("").localeCompare(s2.toUpperCase().split(this.tic).join(""))<=0?this.trueValueStr:this.falseValueStr:Number(d1)<=Number(d)?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_greatereq:s1=this._popString(_stack),s2=this._popString(_stack),""==s2&&this.getTreatStringsAsZero()&&""!=s1&&(s2="0"),d=this._parseDouble(s1),d1=this._parseDouble(s2),val=isNaN(d)||isNaN(d1)?"#VALUE!"==s1||"#VALUE!"==s2?"#VALUE!":s1.toUpperCase().split(this.tic).join("").localeCompare(s2.toUpperCase().split(this.tic).join(""))>=0?this.trueValueStr:this.falseValueStr:Number(d1)>=Number(d)?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_noequal:s1=this._popString(_stack),s2=this._popString(_stack),""==s2&&this.getTreatStringsAsZero()&&""!=s1&&(s2="0"),d=this._parseDouble(s1),d1=this._parseDouble(s2),val=isNaN(d)||isNaN(d1)?"#VALUE!"==s1||"#VALUE!"==s2?"#VALUE!":s1.toUpperCase().split(this.tic).join("")!=s2.toUpperCase().split(this.tic).join("")?this.trueValueStr:this.falseValueStr:Number(d1)!=Number(d)?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_and:s1=this._popString(_stack),s2="",_stack.length>0&&(s2=this._popString(_stack)),this.getUseNoAmpersandQuotes()?_stack.push(s2+s1):_stack.push(this.tic+s2+s1+this.tic),i+=1;break;case this.token_or:d=this._pop(_stack),d1=this._pop(_stack),_stack.push(Math.pow(d1,d).toString()),i+=1;break;case this.token_ORop:var s1=this._popString(_stack),s2=this._popString(_stack),d=this._parseDouble(s1),d1=this._parseDouble(s2),val;""==s1?s1=this.falseValueStr:isNaN(d)||(s1=0!=Number(s1)?this.trueValueStr:this.falseValueStr),""==s2?s2=this.falseValueStr:isNaN(d1)||(s2=0!=Number(s2)?this.trueValueStr:this.falseValueStr),val=s1.toUpperCase().split(this.tic).join("")==this.trueValueStr||s2.toUpperCase().split(this.tic).join("")==this.trueValueStr?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_ANDop:var s1=this._popString(_stack),s2=this._popString(_stack),d=this._parseDouble(s1),d1=this._parseDouble(s2),val;""==s1?s1=this.falseValueStr:isNaN(d)||(s1=0!=Number(s1)?this.trueValueStr:this.falseValueStr),""==s2?s2=this.falseValueStr:isNaN(d1)||(s2=0!=Number(s2)?this.trueValueStr:this.falseValueStr),val=s1.toUpperCase().split(this.tic).join("")==this.trueValueStr&&s2.toUpperCase().split(this.tic).join("")==this.trueValueStr?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_XORop:var s1=this._popString(_stack),s2=this._popString(_stack),d=this._parseDouble(s1),d1=this._parseDouble(s2),val;""==s1?s1=this.falseValueStr:isNaN(d)||(s1=0!=Number(s1)?this.trueValueStr:this.falseValueStr),""==s2?s2=this.falseValueStr:isNaN(d1)||(s2=0!=Number(s2)?this.trueValueStr:this.falseValueStr),val=s1.toUpperCase().split(this.tic).join("")==this.trueValueStr&&s2.toUpperCase().split(this.tic).join("")!=this.trueValueStr||s2.toUpperCase().split(this.tic).join("")==this.trueValueStr&&s1.toUpperCase().split(this.tic).join("")!=this.trueValueStr?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;case this.token_NOTop:s1=this._popString(_stack),d=this._parseDouble(s1),""==s1?s1=this.falseValueStr:isNaN(d)||(s1=0!=Number(s1)?this.trueValueStr:this.falseValueStr),val=s1.toUpperCase().split(this.tic).join("")==this.falseValueStr?this.trueValueStr:this.falseValueStr,_stack.push(val),i+=1;break;default:if(this.computedValueLevel=0,this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_expression];return this.getErrorStrings()[1].toString()}}}}else i+=1;if(this._checkDanglingStack&&_stack.length>1&&formula.length>1&&(0!=formula.indexOf(this.bmarker.toString())||formula.indexOf(this.bmarker)!=formula.length-1||formula.indexOf(this.bmarker2)>-1))return this.computedValueLevel=0,this.formulaErrorStrings[this._improper_formula];if(0==_stack.length)return"";s="",cc=_stack.length;do{return s=_stack.pop().toString()+s,""==s&&!this.getUseNoAmpersandQuotes()&&this._isCellReference(formula)&&this.getTreatStringsAsZero()?"0":ej.isNullOrUndefined(ej.cultureObject)||"en-US"==ej.cultureObject.name||isNaN(this._parseDouble(s))?s:_getLocaleNumberValue(s)}while(cc>0&&!(s.indexOf(this.FALSEVALUESTR)>-1||s.indexOf(this.tRUEVALUESTR)>1));return ej.isNullOrUndefined(ej.cultureObject)||"en-US"==ej.cultureObject.name||isNaN(this._parseDouble(s))?s:_getLocaleNumberValue(s)}catch(e){if(this.computedValueLevel=0,e.toString().indexOf(this.formulaErrorStrings[this._circular_reference_])>-1||this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException()){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();throw e}if(e.toString().indexOf(this.formulaErrorStrings[this._cell_empty])>-1)return"";if(this.getRethrowLibraryComputationExceptions())throw this._libraryComputationException=e,e;return e}finally{this.computedValueLevel--,this._isInteriorFunction=!1,this.computedValueLevel<0&&(this.computedValueLevel=0)}},this.computeFormula=function(e){if(this.getThrowCircularException())if(this._iterationMaxCount>0){if(0==this.computedValueLevel)this._circCheckList.length=0,this._circCheckList.push(this.cell);else if(this._circCheckList.indexOf(this.cell)>-1)return this.getIterationValues().containsKey(this.cell)||this.getIterationValues().add(this.cell,"0"),this.getIterationValues().getItem(this.cell).toString()}else{if(0==this.computedValueLevel)this._circCheckList.length=0;else if(this._circCheckList.indexOf(this.cell)>-1)throw this.computedValueLevel=0,this._circCheckList.length=0,this.formulaErrorStrings[this._circular_reference_];this._circCheckList.push(this.cell)}var t=this.computedValue(e);return this.getUseNoAmpersandQuotes()&&t.length>1&&t[0]==this.tic[0]&&t[t.length-1]==this.tic[0]&&(t=this._substring(t,1,t.length-2)),t},this.dispose=function(){if(!this._isDisposed){var e=0;null!=this.grid&&(e=this.getSheetID(this.grid)),CalcEngine._tokenCount--,CalcEngine.sheetFamilyID--,null!=CalcEngine._sheetFamiliesList&&CalcEngine._sheetFamiliesList.length>0&&(CalcEngine._sheetFamiliesList[e]=null,CalcEngine._sheetFamiliesList.remove(e)),null!=CalcEngine.modelToSheetID&&CalcEngine.modelToSheetID.length>0&&(CalcEngine.modelToSheetID[e]=null,CalcEngine._sheetFamiliesList.remove(e)),null!=this._formulaInfoTable&&(this._formulaInfoTable.clear(),this._formulaInfoTable=null),null!=this._circCheckList&&(this._circCheckList.length=0,this._circCheckList=null),null!=this._dependentCells&&(this._dependentCells.clear(),this._dependentCells=null),null!=this._dependentFormulaCells&&(this._dependentFormulaCells.clear(),this._dependentFormulaCells=null),null!=this.getIterationValues()&&(this.getIterationValues().clear(),this.getIterationValues(null)),null!=this._libraryFunctions&&(this._libraryFunctions.clear(),this._libraryFunctions=null),null!=this._lookupTables&&(this._lookupTables.clear(),this._lookupTables=null),this.grid=null,null!=this.getLibraryFunctions()&&(this.getLibraryFunctions().clear(),this.setLibraryFunctions(null)),this._isDisposed=!0}},this.getCalcID=function(){return this._calcID},this._getCellFrom=function(e){var t,i,r,l="",n=this.getCellsFromArgs(e),s=n.length-1,o=this.rowIndex(n[0]);if(o==this.rowIndex(n[s])){var a=this.colIndex(n[0]),d=this.colIndex(n[s]),h=this.colIndex(this.cell);h>=a&&h<=d&&(l=RangeInfo.getAlphaLabel(h).toString()+o.toString())}else(t=this.colIndex(n[0]))==this.colIndex(n[s])&&(i=this.rowIndex(n[s]),(r=this.rowIndex(this.cell))>=o&&r<=i&&(l=RangeInfo.getAlphaLabel(t).toString()+r.toString()));return l},this.getCellsFromArgs=function(e){var t,i,r,l,n,s,o,a,d;if(-1==(r=(e=this._markColonsInQuotes(e)).indexOf(":")))return-1==(r=(e=e.split(this._markerChar).join(":")).indexOf(this.getParseArgumentSeparator()))?(t=this.rowIndex(e),i=this.colIndex(e),(l=[]).push(e),l):this.splitArgsPreservingQuotedCommas(e);this.getRowIndexFromName=function(e){var t,i;if(-1==e.indexOf(":")){for(t="",i=0;i<e.length;i++)this._isDigit(e[i])&&(t+=e[i]);return t}};var h="",c=e,u=e.indexOf(this.sheetToken);if(u>-1&&((n=e.indexOf(this.sheetToken,u+1))>-1&&(h=this._substring(e,u,n-u+1),r=(e=e.split(h).join("")).indexOf(":"))),r>0&&this._isLetter(e[r-1]))o=this._rowMaxCount>0?this._rowMaxCount:50,r=(e=e.substring(0,r)+"1:"+e.substring(r+1)+o.toString()).indexOf(":");else if(r>0&&this._isDigit(e[r-1])){for(s=r-2;s>=0&&this._isDigit(e[s]);)s--;-1!=s&&this._isLetter(e[s])||(o=this._columnMaxCount>0?this._columnMaxCount:50,r=(e="A"+e.substring(0,r)+":"+RangeInfo.getAlphaLabel(o)+e.substring(r+1)).indexOf(":"))}if(!this._canGetRowIndex(e.substring(0,r)))return this._ignoreCellValue=!0,e=c,this.splitArgsPreservingQuotedCommas(e);if(t=this.rowIndex(e.substring(0,r)),a=this.rowIndex(this._substring(e,r+1,e.length-r-1)),!(-1!=t||-1==a)==(-1==t||!(-1==a)))throw this.getErrorStrings()[5].toString();i=this.colIndex(e.substring(0,r)),d=this.colIndex(this._substring(e,r+1,e.length-r-1)),t>a&&(r=a,a=t,t=r),i>d&&(r=d,d=i,i=r);var g=[],p=0;for(r=t;r<=a;++r)for(u=i;u<=d;++u)try{g[p++]=h+RangeInfo.getAlphaLabel(u)+r.toString()}catch(e){continue}return g},this.getFormulaRowCol=function(e,t,i){var r,l=CalcEngine.getSheetFamilyItem(e),n=RangeInfo.getAlphaLabel(i)+t.toString();return null!=l.sheetNameToParentObject&&(n=l.parentObjectToToken.getItem(e)+n),this.getFormulaInfoTable().containsKey(n)?(r=this.getFormulaInfoTable.getItem(n).getFormulaText(),this.getFormulaText(r),r):""},this.getFormulaText=function(e){return new FormulaParsing(e).getText()},this.getSheetID=function(e){var t,i,r=CalcEngine.getSheetFamilyItem(e);return null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.length>0&&(t=(t=r.parentObjectToToken.getItem(e)).split("!").join(""),i=this._parseDouble(t),!isNaN(i))?i:-1},this.getStringArray=function(e){for(var t,i=[],r=0,l=!1,n=0;n<e.length;n++)(t=e[n])==this.tic[0]?l=!l:l||t!=this.getParseArgumentSeparator()||(i.push(this._substring(e,r,n-r)),r=n+1);return i.push(e.substring(r)),i},this.getValueFromArg=function(e){var t,i,r,l,n,s,o,a=this._dateTime1900;if(isNaN(e)||(e=e.toString()),this._isTextEmpty(e))return e;if(e[0]==this.tic[0])return a=this._isDate(e.split(this.tic).join("")),this.getExcelLikeComputations()&&this.getUseDatesInCalculations()&&isNaN(this._parseDouble(e.split(this.tic).join("")))&&!isNaN(a)&&!isNaN(a.getDate())&&this._dateTime1900<=a?this._toOADate(a).toString():e;if(e[0]==this.bMARKER||"q"==e[0]||"!"==e[0]||e.indexOf(":")>-1)return e=(e=e.split("{").join("(")).split("}").join(")"),this.computedValue(e);if(e.length>1&&"ub"==e.substring(0,2))return i=(e=(e=e.split("{").join("(")).split("}").join(")")).substring(1),i=this.computedValue(i),r=this._parseDouble(i),isNaN(r)?this.computedValue(e):(r=-r).toString();if(0==e.indexOf("unu")?e="n"+e.substring(3):0==e.indexOf("un")&&(e="-"+e.substring(2)),e=e.split("u").join("-"),!this._isUpperChar(e[0])&&(this._isDigit(e[0])||e[0]==this.getParseDecimalSeparator()||"-"==e[0]||"n"==e[0])){if("n"==e[0]&&(e=e.substring(1)),t=ej.isNullOrUndefined(ej.cultureObject)||"en-US"==ej.cultureObject.name?this._parseDouble(e):ej.isNullOrUndefined(e)?NaN:ej.parseFloat(e.toString(),0,ej.cultureObject.name),!isNaN(t))return this._preserveLeadingZeros?e:t.toString();if(0==e.indexOf(this.trueValueStr)||0==e.indexOf(this.falseValueStr))return e}if(this._ignoreCellValue&&0!=e.indexOf(this.trueValueStr)&&0!=e.indexOf(this.falseValueStr))return this._ignoreCellValue=!1,e;if(l=["+","-","/","*",")",")","{"],-1==this._indexOfAny(e,l)&&this._isUpperChar(e[0])||e[0]==this.sheetToken){if(e!=this.trueValueStr&&e!=this.falseValueStr&&this._isCellReference(e)&&(null!=(n=CalcEngine.getSheetFamilyItem(this.grid)).sheetNameToParentObject&&-1==e.indexOf(this.sheetToken)&&(e=n.parentObjectToToken.getItem(this.grid)+e)),e==this.cell)throw null!=(s=this.getDependentCells().getItem(e))&&s.indexOf(e)>-1&&this._arrayRemove(s,e),this.getDependentFormulaCells().containsKey(this.cell)||this.clearFormulaDependentCells(this.cell),this.formulaErrorStrings[this._circular_reference_]+e;return o=this.getValueFromParentObjectCell(e),a=this._isDate(o),o=o.toString(),e!=this.trueValueStr&&e!=this.falseValueStr&&(t=this._parseDouble(o.split(this.tic).join("")),!this._preserveLeadingZeros&&!this._isCellReference(e)&&o.length>0&&!isNaN(t)&&(o=t.toString()),this.updateDependencies(e)),o==this.tic+this.tic?"NaN":(this.getExcelLikeComputations()&&this.getUseDatesInCalculations()&&!isNaN(a)&&isNaN(this._parseDouble(o))&&!isNaN(a.getDate())&&this._dateTime1900<=a&&(o=this._toOADate(a).toString()),o)}return e=(e=e.split("{").join("(")).split("}").join(")"),e=this._parse(e),t=ej.parseFloat(e.substring(0,e.length-1)),e.indexOf("%")!=e.length-1||isNaN(t)||(e=(Number(t)/100).toString()),this.getErrorStrings().indexOf(e)>-1?e:this.computedValue(e)},this.getValueFromParentObjectCell=function(e){var t,i,r;if(e==this.trueValueStr||e==this.falseValueStr)return e;var l=e.lastIndexOf(this.sheetToken),n=0,s=0,o=this.grid,a=CalcEngine.getSheetFamilyItem(this.grid);if(l>-1&&null!=a.tokenToParentObject)this.grid=a.tokenToParentObject.getItem(e.substring(0,l+1)),n=this.rowIndex(e),s=this.colIndex(e);else if(-1==l){for(t=0;t<e.length&&this._isLetter(e[t]);)t++;if(t==e.length){if(e=e.toLowerCase(),this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[5].toString()}n=this.rowIndex(e),s=this.colIndex(e),this.isSheetMember()&&null!=a.parentObjectToToken&&(e=a.parentObjectToToken.getItem(this.grid)+e)}if(i=""==this.cell||null==this.cell?"":this.cell,this.cell=e,this._iterationMaxCount>0){if(this._circCheckList.indexOf(this.cell)>-1&&this.computedValueLevel>0)return this.grid=o,this.cell=i,this.getIterationValues().containsKey(this.cell)||this.getIterationValues().add(this.cell,"0"),this.getIterationValues().getItem(this.cell).toString();if(this.getIterationValues().containsKey(this.cell)&&this.computedValueLevel>0)return this.getIterationValues.getItem(this.cell).toString()}return r=this._getValueComputeFormulaIfNecessary(n,s,this.grid),this.grid=o,this.cell=i,r},this.getValueFromParentObject=function(e,t,i){var r,l,n=CalcEngine.getSheetFamilyItem(e),s=null==n.parentObjectToToken||0==n.parentObjectToToken.length?"":n.parentObjectToToken.getItem(e).toString();s=s+RangeInfo.getAlphaLabel(i)+t.toString(),r=this.grid,l=this.cell,this.cell=s,this.grid=e;var o=this._getValueComputeFormulaIfNecessary(t,i,e),a=new Date(Date.parse(o)),d=this._parseDouble(o);return this.getExcelLikeComputations()&&this.getUseDatesInCalculations()&&isNaN(d)&&!isNaN(a.getDate())&&this._dateTime1900<=a&&(o=this._toOADate(a).toString()),this.grid=r,this.cell=l,o},this.getValueFromParentObjectRowCol=function(e,t){return this._getValueComputeFormulaIfNecessary(e,t,this.grid)},this.handleIteration=function(e,t){return this.getFormulaInfoTable().containsKey(e),this.getFormulaInfoTable.add(e,t),this._iterationMaxCount>0&&e==this.cell&&this._handleIterations(t),t.getFormulaValue()},this.handleSheetRanges=function(e,t){for(var i,r,l,n,s,o,a,d,h=e.indexOf(this.sheetToken),c=0;h>0;){if((i=this._substring(e,c,h).lastIndexOf(":"))>-1)if(r=this._substring(e,c+i+1,h-i-1).toUpperCase().split("'").join(""),l=this._isIE8?r.replace(/^\s+|\s+$/g,""):r.trim(),t.sheetNameToToken.containsKey(l)){if(n=c+i-1,this._sortedSheetNames.contains(r))n=n-r.length-1;else for(;n>0&&-1==this._markers.indexOf(e[n]);)n--;if(s=this._substring(e,n+1,i-n+c-1).toUpperCase().split("'").join(""),l=this._isIE8?s.replace(/^\s+|\s+$/g,""):s.trim(),t.sheetNameToToken.containsKey(l)){if(o=h+c+1,this._sortedSheetNames.contains(l))o=e.length-1;else for(;o<e.length&&-1==this._markers.indexOf(e[o]);)o++;var u=this._substring(e,c+h+1,o-c-h-1),g=t.sheetNameToToken.getItem(l).toString(),p=t.sheetNameToToken.getItem(l).toString();for(p<g&&(m=g,g=p,p=m),a="",d=0;d<_sortedSheetNames.length;d++){var m=t.sheetNameToToken.getItem(this._sortedSheetNames[d]).toString(),_=parseInt(m.split("!").join("")),f=parseInt(g.split("!").join("")),b=parseInt(p.split("!").join(""));_>f&&_<b&&(a.length>0&&(a+=this.getParseArgumentSeparator()),a+=d+String.fromCharCode(131)+u)}c=(e=e.substring(0,n+1)+a+e.substring(o)).length-o}else c=h+c}else c=h+c;else c=h+c;h=e.substring(c+1).indexOf(this.sheetToken)+1}return e.split(String.fromCharCode(131)).join(this.sheetToken)},this.isSheetMember=function(){var e=CalcEngine.getSheetFamilyItem(this.grid);return null!=e&&e!=undefined&&e.isSheetMember},this.parseAndComputeFormula=function(e){var t,i,r,l,n=e;for(n.length>0&&n[0]==this.getFormulaCharacter()&&(n=n.substring(1)),n.length>0&&"+"==n[0]&&(n=n.substring(1)),n.length>1&&","==n[0]&&n[1]>="0"&&n[1]<="9"&&(n="0,"+n.substring(1)),i=(t=n.split(" ").join("")).indexOf("(");-1!=i&&i<t.length;i++)if(i>0){if(this._isDigit(t[i-1])&&!this._checkHasCharBeforeNumber(t.substring(0,i)))throw this.formulaErrorStrings[this._bad_formula]+" "+t.substring(0,i+1);if(-1==(r=t.substring(i+1).indexOf("(")))break;i+=r}for(i=t.indexOf(")");-1!=i&&i<t.length-1;i++){if(this._isDigit(t[i+1]))throw this.formulaErrorStrings[this._bad_formula]+" "+t.substring(0,i+2);if(-1==(r=t.substring(i+1).indexOf(")")))break;i+=r}return this._multiTick=!1,l=this._parse(n),this.computedValue(l)},this.parseFormula=function(e){var t;if(e.length>0&&e[0]==this.getFormulaCharacter()&&(e=e.substring(1)),e.length>0&&"+"==e[0]&&(e=e.substring(1)),this._isRangeOperand=this._supportRangeOperands&&this._isRange(e),this.getCheckDanglingStack()&&e.split(" ").join("").indexOf(this._braceRightNLeft)>-1)return this.computedValueLevel=0,this.formulaErrorStrings[this._improper_formula];if(t=this._isIE8?e.replace(/^\s+|\s+$/g,""):e.trim(),!ej.isNullOrUndefined(this.parentObject)&&"ejSpreadsheet"==this.parentObject.pluginName){var i=this.rowIndex(this.cell),r=this.colIndex(this.cell),l=this.parentObject.XLEdit.getPropertyValue(i-1,r-1,"hasFormulaArray");this._isArrayFormula=!ej.isNullOrUndefined(l)&&l,this._isArrayFormula&&(t=this._parseLibraryFormula("{"+t+"}"))}return this._parse(t)},this.getUpdatedValueCell=function(e){var t,i,r,l,n,s,o;this._inAPull=!0;var a,d=this.grid,h=this.cell,c=CalcEngine.getSheetFamilyItem(this.grid),u=e.toUpperCase();if(-1==(a=u.indexOf(this.sheetToken))&&""!=this.cell&&this.cell!=undefined?(a=this.cell.indexOf(this.sheetToken,1))>-1&&null!=c.tokenToParentObject&&(u=this.cell.substring(0,a+1)+u,this.grid=c.tokenToParentObject.getItem(this.cell.substring(0,a+1))):a>0&&null!=c.sheetNameToToken&&null!=c.tokenToParentObject&&(u=(s=c.sheetNameToToken.getItem(u.substring(0,a)))+u.substring(a+1),this.grid=c.tokenToParentObject.getItem(s),this.cell=u),this.updateCalcID(),this.getDependentFormulaCells().containsKey(u)||this.getFormulaInfoTable().containsKey(u))this._processedCells.clear(),this.updateDependenciesAndCell(u),this._processedCells.clear(),t=this.getValueFromParentObject(u);else{for(t=this.getValueFromParentObjectCell(u);1==this._breakedFormulaCells.length;)this.updateCalcID(),t=this.getValueFromParentObjectCell(this._breakedFormulaCells[0].toString()),this._breakedFormulaCells.removeAt(0),this.setUseFormulaValues(!0);if(this.getUseFormulaValues()&&(this.isUseFormulaValueChanged=!0,this.setUseFormulaValue(!1)),this._tempBreakedFormulaCells.length>0){for(i=1;i<=this._tempBreakedFormulaCells.length;i++)t=this.getValueFromParentObjectCell(this._tempBreakedFormulaCells[this._tempBreakedFormulaCells.length-i].toString());this._tempBreakedFormulaCells.length=0,t=this.getValueFromParentObjectCell(u)}this.setUseFormulaValues(this.isUseFormulaValueChanged),r=this.ignoreValueChanged,this.ignoreValueChanged=!0,l=this.rowIndex(u),n=this.colIndex(u),this.getPreserveFormula()?""==(s=this._sheetToken(e))?(s="!"+this.getSheetID(this.grid)+"!",null!=(o=this.getFormulaInfoTable().getItem(s+u))&&o!=undefined&&(this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(this.grid)+1,o.getFormulaText(),l,n):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,o.getFormulaText(),l,n))):this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(this.grid)+1,t,l,n):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,t,l,n):this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(this.grid)+1,t,l,n):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,t,l,n),this.ignoreValueChanged=r}return this.grid=d,this.cell=h,this._inAPull=!1,t},this.getUpdatedValueRowCol=function(e,t,i){var r,l,n,s=this.grid,o=CalcEngine.getSheetFamilyItem(this.grid),a=this.sheetToken+e.toString()+this.sheetToken;this.grid=o.tokenToParentObject.getItem(a),this._inAPull=!0,r=a+RangeInfo.getAlphaLabel(i)+t.toString(),this.updateCalcID(),this.getDependentFormulaCells().containsKey(r)||this.formulaInfoTable.containsKey(r)?(this._processedCells.clear(),this.updateDependenciesAndCell(r),this._processedCells.clear()):(l=this.getValueFromParentObjectCell(r),n=this.ignoreValueChanged,this.ignoreValueChanged=!0,this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(this.grid)+1,l,t,i):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,l,t,i),this.ignoreValueChanged=n),this.grid=s,this._inAPull=!1},this.setTokensForSheets=function(e){var t,i,r,l,n=CalcEngine.getSheetFamilyItem(this.grid);if(this.getSupportsSheetRanges()&&(e=this.handleSheetRanges(e,n)),null!=(t=this.getSortedSheetNames()))for(i=0;i<t.length;i++)r=(r=n.sheetNameToToken.getItem(t[i])).split(this.sheetToken).join(this._tempSheetPlaceHolder),l="'"+t[i].toUpperCase()+"'"+this.sheetToken,-1==e.indexOf(l)&&(l=t[i].toUpperCase()+this.sheetToken),e=e.split(l).join(r),l=t[i].toUpperCase()+this.sheetToken,e=e.split(l).join(r);return e.split(this._tempSheetPlaceHolder).join(this.sheetToken)},this.recalculateRange=function(e,t){var i,r;for(this._inRecalculateRange=!0,i=e.getTop();i<=e.getBottom();++i)for(r=e.getLeft();r<=e.getRight();++r)this.parentObject.getValueRowCol!=undefined?this.parentObject.setValueRowCol(this.getSheetID(t)+1,this.parentObject.getValueRowCol(this.getSheetID(t)+1,i,r),i,r):t.setValueRowCol(this.getSheetID(t)+1,t.getValueRowCol(this.getSheetID(t)+1,i,r),i,r);this._inRecalculateRange=!1},this.refresh=function(e){var t,i,r,l,n,s,o;if(!this.getCalculatingSuspended()&&(0==this._dependencyLevel&&this._refreshedCells.clear(),this.getDependentCells().containsKey(e)&&null!=this.getDependentCells().getItem(e))){this._dependencyLevel++;try{var a=CalcEngine.getSheetFamilyItem(this.grid),d=this.getDependentCells().getItem(e),h=this._lockDependencies;for(this._lockDependencies=!0,t=0;t<d.length;t++)if(null!=(i=d[t])){r=this.grid,(l=this._sheetToken(i)).length>0&&(this.grid=a.tokenToParentObject.getItem(l));try{var c=this.rowIndex(i),u=this.colIndex(i),g=this.getFormulaInfoTable().getItem(i);null!=g&&(n=this.cell,this.cell=i,(this.getAlwaysComputeDuringRefresh()||g.calcID!=this._calcID||""==g.getFormulaValue())&&(this.getComputedValue().containsKey(i)?s=this.getComputedValue().getItem(i):(s=this.computeFormula(g.getParsedFormula()),this._computedValue.add(i,s)),s!=g._formulaValue&&this._refreshedCells.containsKey(i)&&this._refreshedCells.remove(i),g._formulaValue=s),g.calcID=this._calcID,this.cell=n,o=this.ignoreValueChanged,this.ignoreValueChanged=!0,this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(this.grid)+1,g.getFormulaValue(),c,u):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,g.getFormulaValue(),c,u),this.ignoreValueChanged=o,this._refreshedCells.containsKey(i)||(this._refreshedCells.add(i,0),this.refresh(i)))}catch(e){continue}this.grid=r}this._lockDependencies=h}finally{this._refreshedCells.containsKey(e)||this._refreshedCells.add(e,0),this._dependencyLevel--,0==this._dependencyLevel&&this._refreshedCells.clear()}}},this.refreshRange=function(e){for(var t,i,r,l,n=e.getTop();n<=e.getBottom();n++)for(t=e.getLeft();t<=e.getRight();t++)i=RangeInfo.getAlphaLabel(t)+n.toString(),this._dependencyLevel=0,r=CalcEngine.getSheetFamilyItem(this.grid),l=this.sheetToken+this.getSheetID(this.grid).toString()+this.sheetToken,null!=r.tokenToParentObject&&r.tokenToParentObject.contains(l)&&(this.grid=r.tokenToParentObject.getItem(l)),i=l+i,this.getComputedValue().clear(),this.refresh(i),this.getComputedValue().clear()},this.registerGridAsSheet=function(e,t,i){var r,l,n;return CalcEngine.modelToSheetID,null==CalcEngine.modelToSheetID&&(CalcEngine.modelToSheetID=new HashTable),(null==CalcEngine.modelToSheetID.getItem(t)||CalcEngine.modelToSheetID.getItem(t)==undefined)&&CalcEngine.modelToSheetID.add(t,i),(r=CalcEngine.getSheetFamilyItem(t)).isSheetMember=!0,l=e.toUpperCase(),null==r.sheetNameToParentObject&&(r.sheetNameToParentObject=new HashTable),null==r.tokenToParentObject&&(r.tokenToParentObject=new HashTable),null==r.sheetNameToToken&&(r.sheetNameToToken=new HashTable),null==r.parentObjectToToken&&(r.parentObjectToToken=new HashTable),r.sheetNameToParentObject.getItem(l)!=undefined?(n=r.sheetNameToToken.getItem(l),r.tokenToParentObject.add(n,t),r.parentObjectToToken.add(t,n)):(n=this.sheetToken+CalcEngine._tokenCount.toString()+this.sheetToken,CalcEngine._tokenCount++,r.tokenToParentObject.add(n,t),r.sheetNameToToken.add(l,n),r.sheetNameToParentObject.add(l,t),r.parentObjectToToken.add(t,n),this.sortedSheetNames=null),e},this.renameSheet=function(e,t){var i,r=CalcEngine.getSheetFamilyItem(t),l="";if(e.includes("/")||e.includes("?")||e.includes("*")||e.includes("[")||e.includes("]")||e.includes(":")||e.includes("\\"))throw"The name does not contain any of following characters:  / ? *  [ ] : \\";l=(l=t.toString()).toUpperCase(),currentSheetName=e.toUpperCase(),i=r.sheetNameToToken.getItem(l),CalcEngine.modelToSheetID.containsKey(t)&&(CalcEngine.modelToSheetID.remove(t),CalcEngine.modelToSheetID.add(e,this._calcID)),r.sheetNameToParentObject.containsKey(l)&&(r.sheetNameToParentObject.remove(l),r.sheetNameToParentObject.add(currentSheetName,e)),r.tokenToParentObject.containsKey(i)&&(r.tokenToParentObject.remove(i),r.tokenToParentObject.add(i,e)),r.sheetNameToToken.containsKey(l)&&(r.sheetNameToToken.remove(l),r.sheetNameToToken.add(currentSheetName,i)),r.parentObjectToToken.containsKey(l)&&(r.parentObjectToToken.remove(l),r.parentObjectToToken.add(e,i))},this.removeFunction=function(e){return this._customlibraryFunctions.getItem(e)!=undefined&&this._customlibraryFunctions.remove(e),null!=this._libraryFunctions.getItem(e)&&(this._libraryFunctions.remove(e),!0)},this.removeNamedRange=function(e){return e=e.toUpperCase(),null!=this.getNamedRanges().getItem(e)&&(this.getNamedRanges().remove(e),this._populateNamedRangesNonScoped(),!0)},this.rowIndex=function(e){var t,i=0,r=!1;if(i<e.length&&e[i]==this.sheetToken){for(i++;i<e.length&&e[i]!=this.sheetToken;)i++;i++}for(;i<e.length&&this._isLetter(e[i]);)r=!0,i++;if(t=parseInt(e.substring(i)),i<e.length&&!isNaN(t))return t;if(r)return-1;throw this.formulaErrorStrings[this._bad_index]},this.splitArgsPreservingQuotedCommas=function(e){var t,i,r,l,n;if(-1==e.toString().indexOf(this.tic))return e.toString().split(this._parseArgumentSeparator);for(t=this._saveStrings(e),i=(e=this._saveStringsText).split(this._parseArgumentSeparator),r=[],l=0;l<i.length;l++)n=i[l],n=this._setStrings(n,t),r.push(n);return r},this.removeTics=function(e){return e.length>1&&e[0]==this.tic[0]&&e[e.length-1]==this.tic[0]&&(-1==this._substring(e,1,e.length-2).indexOf(this.tic)?e=this._substring(e,1,e.length-2):this._multiTick&&(e=this._substring(e,1,e.length-2))),e},this.updateCalcID=function(){this._calcID++,this._calcID==Number.MAX_SAFE_INTEGER&&(this._calcID=Number.MIN_SAFE_INTEGER+1)},this.updateDependencies=function(e){var t,i,r,l,n,s,o,a,d;if(!this._lockDependencies&&this.getUseDependencies())if(t=CalcEngine.getSheetFamilyItem(this.grid),i=this.cell,null!=t.sheetNameToParentObject&&-1==i.indexOf(this.sheetToken)&&(i=t.parentObjectToToken.getItem(this.grid)+i),null!=t.sheetNameToParentObject&&-1==e.indexOf(this.sheetToken)&&(e=t.parentObjectToToken.getItem(this.grid)+e),this.getDependentCells().containsKey(e)){if(-1==(l=this.getDependentCells().getItem(e)).indexOf(i)&&l.push(i),this._addToFormulaDependentCells(e),ej.isNullOrUndefined(this.parentObject)&&"ejSpreadsheet"!=this.parentObject.pluginName&&this.getDependentFormulaCells().containsKey(e)&&null!=(n=this.getDependentFormulaCells().getItem(e)))for(s=n.keys(),o=0;o<s.length;o++)a=s[o],null==(d=this.getDependentCells().getItem(a))&&(d=[],this.getDependentCells().add(a,d)),-1==d.indexOf(i)&&d.push(i)}else{if(l=[],this.getDependentCells().add(e,l),l.push(i),this.getDependentFormulaCells().containsKey(e)&&null!=(n=this.getDependentFormulaCells().getItem(e)))for(s=n.keys(),o=0;o<s.length;o++)a=s[o],null==(d=this.getDependentCells().getItem(a))&&(d=[],this.getDependentCells().add(a,d)),-1==d.indexOf(i)&&d.push(i);if(this._addToFormulaDependentCells(e),this.getDependentCells().containsKey(i)&&(null!=(r=this.getDependentCells().getItem(i))&&r!=l))for(o=0;o<r.length;o++)a=r[o],l.push(a)}},this.updateDependenciesAndCell=function(e){var t,i,r,l,n,s,o,a,d,h,c=this.grid,u=CalcEngine.getSheetFamilyItem(this.grid),g=this._sheetToken(e);if(g.length>0&&(this.grid=u.tokenToParentObject.getItem(g)),this.formulaInfoTable.containsKey(e)){if((t=this.formulaInfoTable[e]).calcID!=this._calcID){if(i=this.cell,this.cell=e,this._iterationMaxCount>0&&this._circCheckList.indexOf(this.cell)>-1?this._handleIterations(t):t.setFormulaValue(this.computeFormula(t.getParsedFormula())),this.getDependentCells().containsKey(e))for(r=this.getDependentCells().getItem(e),l=0;l<r.length;l++)null!=(n=this.FormulaInfoTable.getItem(r[l]))&&n!=undefined&&(n.calcID=Number.MIN_SAFE_INTEGER);t.calcID=this._calcID,this.cell=i}if(s=this.ignoreValueChanged,this.ignoreValueChanged=!0,o=this.rowIndex(e),a=this.colIndex(e),this.getPreserveFormula()&&(this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(this.grid)+1,t.getFormulaText(),o,a):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,t.getFormulaText(),o,a)),this.ignoreValueChanged=s,this.grid=c,this._processedCells.contains(e))return;if(this._processedCells.add(e),this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(this.grid)+1,t.getFormulaValue(),o,a):this.parentObject.setValueRowCol(this.getSheetID(this.grid)+1,t.getFormulaValue(),o,a),this.getDependentFormulaCells().containsKey(e))for(d=this.getDependentFormulaCells().getItem(e).keys(),h=0;h<d.length;h++)this.updateDependenciesAndCell(d[h])}},this.valueChanged=function(e,t,i){var r,l,n,s,o;if(!this.ignoreValueChanged){r=e,this.grid=e;var a=!0,d=CalcEngine.getSheetFamilyItem(r),h=RangeInfo.getAlphaLabel(t.getColIndex())+t.getRowIndex().toString();if(null!=d.sheetNameToParentObject&&d.sheetNameToParentObject.length>0&&(h=d.parentObjectToToken.getItem(r)+h),t.getValue().length>0&&t.getValue()[0]==this.getFormulaCharacter()){if(this.cell=h,n=!0,ej.isNullOrUndefined(i)||(n=i),this.getFormulaInfoTable().containsKey(h)){if(l=this.getFormulaInfoTable().getItem(h),t.getValue()!=l.getFormulaText()||null==l.getParsedFormula()){l.setFormulaText(t.getValue()),this.getDependentFormulaCells().containsKey(this.cell)&&this.clearFormulaDependentCells(this.cell);try{l.setParsedFormula(this.parseFormula(t.getValue()))}catch(e){l.setFormulaValue(e),n=!1}}n&&(a=(s=this.computeFormula(l.getParsedFormula()))!=l.getFormulaValue()||this.getForceRefreshCall(),l.setFormulaValue(s)),l.calcID=this._calcID}else{(l=new FormulaInfo).setFormulaText(t.getValue()),this.getDependentFormulaCells().containsKey(h)||this.getDependentFormulaCells().add(h,new HashTable);try{l.setParsedFormula(this.parseFormula(t.getValue()))}catch(e){l.setFormulaValue(e),n=!1}n&&(l.setFormulaValue(this.computeFormula(l.getParsedFormula())),"#NAME?"!=this.computeIsFormula(l).toString()||this.getNamedRanges().containsKey(l.getFormulaText().split("=")[1].toUpperCase())||this.getUndefinedNamedRanges().add(l.getFormulaText().split("=")[1].toUpperCase())),l.calcID=this._calcID,this.getFormulaInfoTable().containsKey(h),this.getFormulaInfoTable().add(h,l)}this._iterationMaxCount>0&&n&&!this._inHandleIterations&&h==this.cell&&this._handleIterations(l),o=this.ignoreValueChanged,this.ignoreValueChanged=!0,n&&(this.parentObject.setValueRowCol==undefined?this.setValueRowCol(this.getSheetID(r)+1,l.getFormulaValue(),t.getRowIndex(),t.getColIndex()):this.parentObject.setValueRowCol(this.getSheetID(r)+1,l.getFormulaValue(),t.getRowIndex(),t.getColIndex())),this.ignoreValueChanged=o}else!this._inRecalculateRange&&this.getFormulaInfoTable().containsKey(h)&&(this.getFormulaInfoTable().remove(h),this.getDependentFormulaCells().containsKey(h)&&this.clearFormulaDependentCells(h));n&&a&&this.getDependentCells().containsKey(h)&&(this._dependencyLevel=0,this.getComputedValue().clear(),this.refresh(h))}},this.getActiveCell=function(){return this.cell},this.getAllowShortCircuitIFs=function(){return this._allowShortCircuitIFs},this.setAllowShortCircuitIFs=function(e){this._allowShortCircuitIFs=e},this.getAlwaysComputeDuringRefresh=function(){return this._alwaysComputeDuringRefresh},this.setAlwaysComputeDuringRefresh=function(e){this._alwaysComputeDuringRefresh=e},this.getCalculatingSuspended=function(){return this._calculatingSuspended},this.setCalculatingSuspended=function(e){this._calculatingSuspended=e},this.getCheckDanglingStack=function(){return this._checkDanglingStack},this.setCheckDanglingStack=function(e){this._checkDanglingStack=e},this.getCustomLibraryFunctions=function(){return this._customlibraryFunctions},this._computedValue=null,this.getComputedValue=function(){return null==this._computedValue&&(this._computedValue=new HashTable),this._computedValue},this.getDependentCells=function(){if(this.isSheetMember()){var e=CalcEngine.getSheetFamilyItem(this.grid);return null==e.sheetDependentCells&&(e.sheetDependentCells=new HashTable),e.sheetDependentCells}return null==this._dependentCells&&(this._dependentCells=new HashTable),this._dependentCells},this.getDependentFormulaCells=function(){if(this.isSheetMember()){var e=CalcEngine.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new HashTable),e.sheetDependentFormulaCells}return null==this._dependentFormulaCells&&(this._dependentFormulaCells=new HashTable),this._dependentFormulaCells},this.getEnableLookupTableCaching=function(){return this._enableLookupTableCaching},this.setEnableLookupTableCaching=function(e){this._enableLookupTableCaching=e},this.getErrorStrings=function(){return null==this._errorStrings&&(this._errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this._errorStrings},this.setErrorStrings=function(e){this._errorStrings=e},this.getExcelLikeComputations=function(){return this._excelLikeComputations},this.setExcelLikeComputations=function(e){this._excelLikeComputations=e},this.getForceRefreshCall=function(){return this._forceRefreshCall},this.setForceRefreshCall=function(e){this._forceRefreshCall=e},this.getFormulaCharacter=function(){return"\0"==CalcEngine._formulaChar&&(CalcEngine._formulaChar="="),CalcEngine._formulaChar},this.setFormulaCharacter=function(e){CalcEngine._formulaChar=e},this.getFormulaInfoTable=function(){if(this.isSheetMember()){var e=CalcEngine.getSheetFamilyItem(this.grid);return null==e.sheetFormulaInfoTable&&(e.sheetFormulaInfoTable=new HashTable),e.sheetFormulaInfoTable}return null==this._formulaInfoTable&&(this._formulaInfoTable=new HashTable),this._formulaInfoTable},this.getPreserveLeadingZeros=function(){return this._preserveLeadingZeros},this.setPreserveLeadingZeros=function(e){this._preserveLeadingZeros=e},this.getIterationMaxCount=function(){return this._iterationMaxCount},this.setIterationMaxCount=function(e){this._iterationMaxCount=e,this._iterationMaxCount>0&&this.setThrowCircularException(!0)},this.getIterationMaxTolerance=function(){return this._iterationMaxTolerance},this.setIterationMaxTolerance=function(e){this._iterationMaxTolerance=e},this.getIterationValues=function(){return null==this._iterationValues&&(this._iterationValues=new HashTable),this._iterationValues},this.getLibraryComputationException=function(){return this._libraryComputationException},this.getLibraryFunctions=function(){return this._libraryFunctions},this.getLockDependencies=function(){return this._lockDependencies},this.setLockDependencies=function(e){this._lockDependencies=e},this.getMaximumRecursiveCalls=function(){return this._maximumRecursiveCalls},this.setMaximumRecursiveCalls=function(e){this._maximumRecursiveCalls=e},this.getNamedRanges=function(){return null==this.namedRanges&&(this.namedRanges=new HashTable,this._namedRangesNonScoped=new HashTable),this.namedRanges},this.setNamedRanges=function(e){this.namedRanges=e,this._populateNamedRangesNonScoped()},this.getUndefinedNamedRanges=function(){var e=CalcEngine.getSheetFamilyItem(this.grid);return null!=e||e!=undefined?(null==this.undefinedsheetNamedRnages&&(this.undefinedsheetNamedRnages=new HashTable),this.undefinedsheetNamedRnages):(null==this.undefinednamedRange&&(this.undefinednamedRange=new HashTable),this.undefinednamedRange)},this.getNameRangeValues=function(){var e=CalcEngine.getSheetFamilyItem(this.grid);return null!=e||e!=undefined?(null==this.namedRangeValues&&(this.namedRangeValues=new HashTable),this.namedRangeValues):(null==this.rangeValues&&(this.rangeValues=new HashTable),this.rangeValues)},this.getNamedRangesOriginalNames=function(){var e=CalcEngine.getSheetFamilyItem(this.grid);return null!=e||e!=undefined?(null==this.sheetNamedRangesOriginalNames&&(this.sheetNamedRangesOriginalNames=new HashTable),this.sheetNamedRangesOriginalNames):(null==this.namedRangesOriginalNames&&(this.namedRangesOriginalNames=new HashTable),this.namedRangesOriginalNames)},this.getNamedRangeCellCollection=function(){var e=CalcEngine.getSheetFamilyItem(this.grid);return null!=e||e!=undefined?(null==this.sheetNamedRangeCellCollection&&(this.sheetNamedRangeCellCollection=new HashTable),this.sheetNamedRangeCellCollection):(null==this.namerangecellcollection&&(this.namerangecellcollection=new HashTable),this.namerangecellcollection)},this.getDependentNamedRangeCells=function(){var e=CalcEngine.getSheetFamilyItem(this.grid);return null!=e||e!=undefined?(null==this.sheetDependentNamedRangeCells&&(this.sheetDependentNamedRangeCells=new HashTable),this.sheetDependentNamedRangeCells):(null==this.dependentNamedRangeCells&&(this.dependentNamedRangeCells=new HashTable),this.dependentNamedRangeCells)},this.getParseArgumentSeparator=function(){"\0"==this._parseArgumentSeparator&&(this._parseArgumentSeparator=",");return this._isParseArgumentSeparator||","==this._parseArgumentSeparator||(this._parseArgumentSeparator=","),this._parseArgumentSeparator},this.setParseArgumentSeparator=function(e){this._parseArgumentSeparator=e,this._isParseArgumentSeparator=!0},this.getParseDateTimeSeparator=function(){return this._parseDateTimeSeparator},this.setParseDateTimeSeparator=function(e){this._parseDateTimeSeparator=e},this.getParseDecimalSeparator=function(){"\0"==this._parseDecimalSeparator&&(this._parseDecimalSeparator=".");return this._isParseDecimalSeparatorChanged||"."==this._parseDecimalSeparator||(this._parseDecimalSeparator="."),this._parseDecimalSeparator},this.setParseDecimalSeparator=function(e){this._parseDecimalSeparator=e,this._isParseDecimalSeparatorChanged=!0},this.getPreserveFormula=function(){return this._preserveFormula},this.setPreserveFormula=function(e){this._preserveFormula=e},this.getReservedWordOperators=function(){return null==this._reservedWordOperators&&(this._reservedWordOperators=[" or "," and "," xor ","if "," then "," else ","not "]),this._reservedWordOperators},this.setReservedWordOperators=function(e){this._reservedWordOperators=e},this.getRethrowLibraryComputationExceptions=function(){return this._rethrowLibraryComputationExceptions},this.setRethrowLibraryComputationExceptions=function(e){this._rethrowLibraryComputationExceptions=e},this.getRethrowParseExceptions=function(){return this._rethrowExceptions},this.setRethrowParseExceptions=function(e){this._rethrowExceptions=e},this.getRowMaxCount=function(){return this._rowMaxCount},this.setRowMaxCount=function(e){this._rowMaxCount=e},this.getSortedSheetNames=function(){var e=CalcEngine.getSheetFamilyItem(this.grid);return null!=e&&null!=e.sheetNameToToken&&(this._sortedSheetNames=e.sheetNameToToken.keys(),this._sortedSheetNames.sort()),this._sortedSheetNames},this.getSupportLogicalOperators=function(){return this._supportLogicalOperators},this.setSupportLogicalOperators=function(e){this._supportLogicalOperators=e},this.getSupportRangeOperands=function(){return this._supportRangeOperands},this.setSupportRangeOperands=function(e){this._supportRangeOperands=e},this.getSupportsSheetRanges=function(){return this._supportsSheetRanges},this.setSupportsSheetRanges=function(e){this._supportsSheetRanges=e},this.getThrowCircularException=function(){return this._throwCircularException},this.setThrowCircularException=function(e){this._throwCircularException=e},this.getTreatStringsAsZero=function(){return this._treatStringsAsZero},this.setTreatStringsAsZero=function(e){this._treatStringsAsZero=e},this.getUseDatesInCalculations=function(){return this._useDatesInCalcs},this.setUseDatesInCalculations=function(e){this._useDatesInCalcs=e},this.getUseDependencies=function(){return this._useDependencies},this.setUseDependencies=function(e){this._useDependencies=e},this.getUseFormulaValues=function(){return this._useFormulaValues},this.setUseFormulaValues=function(e){this._useFormulaValues=e},this.getUseNoAmpersandQuotes=function(){return this._useNoAmpersandQuotes},this.setUseNoAmpersandQuotes=function(e){this._useNoAmpersandQuotes=e},this.getValidPrecedingChars=function(){return this._validPrecedingChar+this.getParseArgumentSeparator()},this.setValidPrecedingChars=function(e){this._validPrecedingChars=e},this.getEnableFormulaErrorValidation=function(){return this._enableFormulaErrorValidation},this.setEnableFormulaErrorValidation=function(e){this._enableFormulaErrorValidation=e},this.getWeekEndType=function(){return["","6,0","0,1","1,2","2,3","3,4","4,5","5,6","","","","0","1","2","3","4","5","6"]},this.computeSum=function(e){var t,i,r,l,n,s,o,a,d,h,c=0,u=this.splitArgsPreservingQuotedCommas(e);if(!e||0==e.length){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(l)>-1))return l;for(n=0;n<u.length;n++)if((r=u[n]).indexOf(":")>-1){if(r.startsWith(this.tic)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}for(s=this.getCellsFromArgs(r),o=0;o<s.length;o++){try{if(s[o].startsWith(this.tic)&&isNaN(this._parseDouble(s[o]))){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(a=CalcEngine.getSheetFamilyItem(this.grid),ej.isNullOrUndefined(a.parentObjectToToken)?t=this.getValueFromArg(s[o]).split(this.tic).join(""):(d=a.parentObjectToToken.getItem(this.grid)+s[o],h=this.getFormulaInfoTable().getItem(d),t=ej.isNullOrUndefined(h)||ej.isNullOrUndefined(h._formulaText.toUpperCase().match("SUBTOTAL"))?this.getValueFromArg(s[o]).split(this.tic).join(""):"0"),this.getErrorStrings().indexOf(t)>-1){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return t}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(""!=t){if(i=t==this.trueValueStr||t!=this.falseValueStr&&this._parseDouble(t),this.getErrorStrings().indexOf(t)>-1){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return t}ej.isNullOrUndefined(ej.cultureObject)||"en-US"==ej.cultureObject.name||(i=ej.isNullOrUndefined(t)?NaN:ej.parseFloat(t.toString(),0,ej.cultureObject.name)),isNaN(i)?t="":c+=i}}}else{try{if(r.startsWith(this.tic)&&isNaN(this._parseDouble(r))){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(t=this.getValueFromArg(r).split(this.tic).join(""),this.getErrorStrings().indexOf(t)>-1){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return t}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(t.length>0){if(i=t==this.trueValueStr||t!=this.falseValueStr&&this._parseDouble(t),this.getErrorStrings().indexOf(t)>-1)return t;ej.isNullOrUndefined(ej.cultureObject)||"en-US"==ej.cultureObject.name||(i=ej.isNullOrUndefined(t)?NaN:ej.parseFloat(t.toString(),0,ej.cultureObject.name)),isNaN(i)||(c+=i)}}return c.toString()},this.computeDate=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(3!=s||""==e)return this.formulaErrorStrings[this._wrong_number_arguments];if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(i=0;i<s;++i)n[i]=this.getValueFromArg(n[i]);n[0]="TRUE"==n[0].split(this.tic).join("")?"1":"FALSE"==n[0].split(this.tic).join("")?"0":n[0],n[1]="TRUE"==n[1].split(this.tic).join("")?"1":"FALSE"==n[1].split(this.tic).join("")?"0":n[1],n[2]="TRUE"==n[2].split(this.tic).join("")?"1":"FALSE"==n[2].split(this.tic).join("")?"0":n[2];var o=this._parseDouble(n[0]),a=this._parseDouble(n[1]),d=this._parseDouble(n[2]),h=0;if(!isNaN(o)&&!isNaN(a)&&!isNaN(d)){if(o<0){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}for(;a>12;)a-=12,o++;h=this._getSerialDateFromDate(o,a,d)}if(0==h){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return this._excelLikeComputations&&"Invalid Date"!=(r=this._fromOADate(h)).toString()?"msie"!=(l=ej.browserInfo()).name&&"mozilla"!=l.name&&!ej.isNullOrUndefined(l.name)&&this._isInteriorFunction?r.toLocaleDateString():_calculateDate(r.getMonth()+1)+"/"+_calculateDate(r.getDate())+"/"+r.getFullYear():h.toString()},this.computeDatevalue=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(1!=(a=s.length)||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1))return t;if(this._isCellReference(e)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[1].toString()}i=new Date(Date.parse(s[0])),r=this._parseDouble(s[0]);try{if(!isNaN(r)||"Invalid Date"==i.toString())if(r>0)i=this._fromOADate(r);else{var o=e.split(this.getParseDateTimeSeparator()),a=o.length,d="";for(l=0;l<a;++l)o[l]=this.computedValue(o[l]),d+=l<a-1?o[l]+this.getParseDateTimeSeparator():o[l];d=d.split(this.tic).join(this._string_empty),i=new Date(Date.parse(d))}}catch(e){return this.formulaErrorStrings[this.invalid_arguments]}if(-1==s[0].indexOf("2001")&&2001==i.getFullYear()&&i.setFullYear(new Date(Date.now()).getFullYear()),n=this._toOADate(i),isNaN(n)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[1].toString()}return this.treat1900AsLeapYear&&n>59&&(n+=1),Math.round(n).toString()},this.computeDay=function(e){var t,i;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1))return t;var r=1,l=this.getValueFromArg(e).split(this.tic).join(""),n=this._parseDouble(l);if(isNaN(n)){if("Invalid Date"==(i=new Date(Date.parse(l))).toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[1].toString()}r=i.getDate()}else{if(n<1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[4].toString()}r=(i=this._getDateFromSerialDate(n)).getDate()}return r.toString()},this.computeDays=function(e){var t,i,r,l,n,s,o,a,d=this.splitArgsPreservingQuotedCommas(e);if(2!=d.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1)?t:(i="TRUE"==(i=this.getValueFromArg(d[0])).split(this.tic).join("").toUpperCase()?"1":"FALSE"==i.split(this.tic).join("").toUpperCase()?"0":i,r="TRUE"==(r=this.getValueFromArg(d[1])).split(this.tic).join("").toUpperCase()?"1":"FALSE"==r.split(this.tic).join("").toUpperCase()?"0":r,i=""==i||null==i?new Date(Date.parse("1899-12-31")).toDateString():i,r=""==r||null==r?new Date(Date.parse("1899-12-31")).toDateString():r,s=this._parseDouble(i.split(this.tic).join("")),o=this._parseDouble(r.split(this.tic).join("")),l=isNaN(s)?new Date(Date.parse(i)):this._getDateFromSerialDate(s),n=isNaN(o)?new Date(Date.parse(r)):this._getDateFromSerialDate(o),a=l.getTime()-n.getTime(),Math.ceil(a/864e5).toString())},this.computeDays360=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(2!=s&&3!=s||""==e)return this.formulaErrorStrings[this._wrong_number_arguments];if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1))return t;var o,a=0,d=new Date(Date.parse(this.getValueFromArg(n[0]).split(this.tic).join(""))),h=new Date(Date.parse(this.getValueFromArg(n[1]).split(this.tic).join(""))),c=this.getValueFromArg(n[0]),u=this.getValueFromArg(n[1]),g="TRUE"==c.split(this.tic).join("").toUpperCase()?"1":"FALSE"==c.split(this.tic).join("").toUpperCase()?"0":c,p="TRUE"==u.split(this.tic).join("").toUpperCase()?"1":"FALSE"==u.split(this.tic).join("").toUpperCase()?"0":u;if(g=this._parseDouble(g.split(this.tic).join("")),p=this._parseDouble(p.split(this.tic).join("")),isNaN(g)&&isNaN(this._isDate(d))||isNaN(p)&&isNaN(this._isDate(h))){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[1].toString()}return d=g>0?this._getDateFromSerialDate(g):d,h=p>0?this._getDateFromSerialDate(p):h,i=!1,r=this.falseValueStr,3==s&&(r=this.getValueFromArg(n[2])),o=r==this.trueValueStr,31==d.getDate()&&(d=new Date(d.setDate(d.getDate()-1))),31==h.getDate()&&!o&&d.getDate()<30?h=new Date(h.setDate(h.getDate()+1)):31==h.getDate()&&(h=new Date(h.setDate(h.getDate()-1))),h<d&&(i=!0,l=d,d=h,h=l),a=h.getDate()-d.getDate(),a+=30*(h.getMonth()-d.getMonth()),a+=360*(h.getFullYear()-d.getFullYear()),i&&(a=-a),a.toString()},this.computeEDate=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(2!=r.length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(""==r[0]||""==r[1]){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[0].toString()}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(r[0],FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(r[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)))return t;var l=this.getValueFromArg(r[0]).split(this.tic).join(""),n=(parseInt(l),isNaN(l)?new Date(Date.parse(l)):this._fromOADate(parseInt(l))),s=this.getValueFromArg(r[1]).split(this.tic).join(""),o=parseInt(s);if("Invalid Date"==n.toString()&&isNaN(o))try{var a=new Date(Date.now()),d=this._parseDouble(l),h=parseInt(s);if(h<0&&h<d){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}if(0==d)return n=new Date(a.setMonth(a.getMonth()+h)),this.computeDays(a.toLocaleDateString()+this.getParseArgumentSeparator()+n.toLocaleDateString());i=this.dateTime1900,i=this._fromOADate(d),n=new Date(i.setMonth(i.getMonth()+h))}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula]+e;return this.getErrorStrings()[1].toString()}return n=new Date(n.setMonth(n.getMonth()+o)),this.getExcelLikeComputations()?n.toLocaleDateString():parseInt(this._toOADate(n)).toString()},this.computeEOMonth=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(2!=n.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(""==n[0]||""==n[1]){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[0].toString();return this.getErrorStrings()[0].toString()}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(n[0],FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(n[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)))return t;var s=this.getValueFromArg(n[0]).split(this.tic).join(""),o=new Date(s),a=this._parseDouble(this.getValueFromArg(n[1]).split(this.TIC).join(""));if("Invalid Date"==o.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}if(isNaN(a))try{if(new Date(Date.now()),i=parseInt(s),(a=this._parseDouble(this.getValueFromArg(n[1]).split(this.tic).join("")))<0&&i<=0&&a<i){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}return r=parseInt(s),!isNaN(r)&&o.getFullYear()>9999&&(o=this._fromOADate(r)),o=new Date(o.setMonth(o.getMonth()+a)),l=new Date(o.getFullYear(),o.getMonth()+1,1,-1).getDate(),o=new Date(o.getFullYear(),o.getMonth(),l),this.getExcelLikeComputations()?o.toLocaleDateString():this._getSerialDateTimeFromDate(o).toString()},this.computeHour=function(e){var t,i,r;if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=new Date(Date.now()),this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(i)>-1))return i;if(e="TRUE"==(e=(e=this.getValueFromArg(e)).split(this.tic).join(""))?"1":"FALSE"==e?"0":e,t=new Date(Date.parse(e)),parseInt(e)<0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}if("Invalid Date"==t.toString()&&(r=new Date(Date.now()).toLocaleDateString()+" "+e,t=new Date(Date.parse(r))),"Invalid Date"==t.toString()&&(t=this._fromOADate(e)),"Invalid Date"==t.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}return t.getHours().toString()},this.computeISOWeeknum=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(1!=s.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1))return t;if((i=this.getValueFromArg(s[0]))[0]==this.tic&&this._isTextEmpty(i.split(this.tic).join(""))){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}this._isTextEmpty(i)&&(e=this.computeDatevalue(new Date(1990,12,28).toLocaleDateString())),(e.indexOf(":")>-1||!this._isCellReference(this.getValueFromArg(s[0]))&&this.getValueFromArg(this.DateFormatter(s[0])).indexOf(":")>-1)&&(e="0"),r="TRUE"==(r=this.getValueFromArg(s[0]).split(this.tic).join("")).split(this.tic).join("").toUpperCase()?"1":"FALSE"==r.split(this.tic).join("").toUpperCase()?"0":r;new Date(r);var o=this.DateFormatter(r),a=new Date(Date.parse(o));this.dateTime1900;if("Invalid Date"==a.toString())try{l=parseInt(r),r=(a=this._fromOADate(l)).toLocaleDateString()}catch(e){if(this.getRethrowLibraryComputationExceptions())throw"Bad Cell reference";return this.getErrorStrings()[1].toString()}return n=e+this.getParseArgumentSeparator()+"21",(parseInt(this.computeWeeknum(n))-1).toString()},this.DateFormatter=function(e){var t=new Date(e),i=t.getDate(),r=t.getMonth()+1,l=t.getFullYear();return i<10&&(i=+i),r<10&&(r=r),r+"/"+i+"/"+l},this.computeMinute=function(e){var t,i,r;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(i=new Date(Date.now()),e="TRUE"==(e=(e=this.getValueFromArg(e)).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,i=new Date(Date.parse(e)),e<0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}if("Invalid Date"==i.toString()&&(r=new Date(Date.now()).toLocaleDateString()+" "+e,i=new Date(Date.parse(r))),"Invalid Date"==i.toString()&&(i=this._fromOADate(e)),"Invalid Date"==i.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}return i.getMinutes().toString()},this.computeMonth=function(e){var t,i,r,l,n,s=1;if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=new Date(Date.parse(i.split(this.tic).join(""))),l=this._parseDouble(i),!isNaN(l)&&r.getFullYear()>9999&&(r=this._fromOADate(l)),i<0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}if("Invalid Date"==r.toString()&&(r=this._fromOADate(l)),"Invalid Date"==r.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}if("Invalid Date"!=r.toString())s=r.getMonth()+1;else{if(n=this._parseDouble(this.getValueFromArg(e)),isNaN(n))return this.formulaErrorStrings[this._invalid_arguments];n<1?s=1:s=(r=this._getDateFromSerialDate(n)).getMonth()+1}return s.toString()},this.computeNetworkDays=function(e){var t,i,r,l,n,s,o,a,d,h,c=this.splitArgsPreservingQuotedCommas(e),u=c.length,g=[];if(2!=u&&3!=u||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(l)>-1))return l;if(n=this.getValueFromArg(c[0]).split(this.tic).join(""),s=this.getValueFromArg(c[1]).split(this.tic).join(""),""==n||""==s){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[0].toString();return this.getErrorStrings()[0].toString()}var p=new Date(Date.parse(n)),m=new Date(Date.parse(s)),_=this._parseDouble(n);if(!isNaN(_)&&p.getFullYear()>9999&&(p=this._fromOADate(_)),"Invalid Date"==p.toString()&&(p=this._fromOADate(_)),"Invalid Date"==p.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(_=this._parseDouble(s),!isNaN(_)&&m.getFullYear()>9999&&(m=this._fromOADate(_)),"Invalid Date"==m.toString()&&(m=this._fromOADate(_)),"Invalid Date"==m.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(3==u)if((t=c[2]).indexOf(":")>-1)for(o=this.getCellsFromArgs(t),a=0;a<o.length;a++){try{i=this.getValueFromArg(a).split(this.tic).join("")}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}""!=i&&("Invalid Date"!=(r=new Date(Date.parse(i))).toString()&&-1==g.indexOf(r)&&r>p&&r<m&&0!=r.getDay()&&6!=r.getDay()&&g.push(r))}else for(d=this.splitArgsPreservingQuotedCommas(t.split(this.tic).join("")),h=0;h<d.length;h++){try{i=this.getValueFromArg(d[h])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}i.length>0&&("Invalid Date"!=(r=new Date(Date.parse(i))).toString()&&-1==g.indexOf(r)&&r>p&&r<m&&0!=r.getDay()&&6!=r.getDay()&&g.push(r))}var f=0,b=parseInt(this.computeDatevalue(s))-parseInt(this.computeDatevalue(n)),C=p.getDay(),S=m.getDay(),x=C-1,v=7-S;return f=(b=b+x+v)-x-v-2*parseInt(b/7)+1-g.length,(6==S||0==C)&&f--,f.toString()},this.computeNetworkDaysOintl=function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m=this.splitArgsPreservingQuotedCommas(e),_=m.length,f=[];if(2!=_&&_>4||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){for(l=0;l<_;l++)if(2!=l&&(n=this.formulaErrorStringCheck(m[l],FormulaArgumentType.Date),this.getErrorStrings().indexOf(n)>-1))return n;if(_>=3&&(n=this.formulaErrorStringCheck(m[2],FormulaArgumentType.Text),this.getErrorStrings().indexOf(n)>-1))return n}if(s=this.getValueFromArg(m[0]).split(this.tic).join(""),o=this.getValueFromArg(m[1]).split(this.tic).join(""),""==s||""==o){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[0].toString();return this.getErrorStrings()[0].toString()}if(a=new Date(Date.parse(this._fromOADate(s))),d=new Date(Date.parse(this._fromOADate(o))),"Invalid Date"==a.toString()){if(h=this._parseDouble(s),isNaN(h)){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}a=this.fromOADate(h)}if("Invalid Date"==d.toString()){if(h=this._parseDouble(o),isNaN(h)){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}d=this._fromOADate(h)}if(4==_)if(t=m[3],(t=this.adjustRangeArg(t)).indexOf(":")>-1||t.indexOf(",")>-1)for(c=this.getCellsFromArgs(t),u=0;u<c.length;u++){try{i=this.getValueFromArg(c[u]).toString().split(this.tic).join("")}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}""!=i&&("Invalid Date"!=(r=new Date(Date.parse(i))).toString()&&-1==f.indexOf(r)&&r>a&&r>d&&0!=r.getDay()&&6!=r.getDay()&&f.push(r))}else{try{i=this.getValueFromArg(t).split(this.tic).join("")}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}i.length>0&&("Invalid Date"!=(r=new Date(Date.parse(i))).toString()&&-1==f.indexOf(r)&&r>a&&r<d&&0!=r.getDay()&&6!=r.getDay()&&f.push(r))}if(g=parseInt(m[2]),_>2&&!isNaN(g)){if(isNaN(m[2])){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}g=parseInt(m[2])}else g=1;for(var b=this._splitArguments(this.getWeekEndType()[g].toString(),","),C=parseInt(this.computeDatevalue(o))-parseInt(this.computeDatevalue(s))+1,S=C,x=1,v=a;x<C;)p=v.getDay(),b.indexOf(p.toString())>=0?S--:f.indexOf(v)>=0&&S--,v=new Date(v.setDate(v.getDate()+1)),x++;return S.toString()},this.computeNow=function(e){var t,i;this.splitArgsPreservingQuotedCommas(e).length;if(""!=e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return t=new Date(Date.now()),this.getExcelLikeComputations()?"msie"!=(i=ej.browserInfo()).name&&"mozilla"!=i.name&&!ej.isNullOrUndefined(i.name)&&this._isInteriorFunction?t.toLocaleDateString():t.getFullYear()+"/"+_calculateDate(t.getMonth()+1)+"/"+_calculateDate(t.getDate()):this._toOADate(t).toString()},this.computeSecond=function(e){var t,i,r;if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1))return t;if(i=new Date(Date.now()),e="TRUE"==(e=(e=this.getValueFromArg(e)).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,i=new Date(Date.parse(e)),e<0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}if("Invalid Date"==i.toString()&&(r=new Date(Date.now()).toLocaleDateString()+" "+e,i=new Date(Date.parse(r))),"Invalid Date"==i.toString()&&(i=this._fromOADate(e)),"Invalid Date"==i.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}return i.getSeconds().toString()},this.computeTime=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(3!=r.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;r[0]=this.getValueFromArg(r[0]),r[1]=this.getValueFromArg(r[1]),r[2]=this.getValueFromArg(r[2]),r[0]=""==r[0]?"0":r[0],r[0]="TRUE"==r[0].split(this.tic).join("")?"1":"FALSE"==r[0].split(this.tic).join("")?"0":r[0],r[1]=""==r[1]?"0":r[1],r[1]="TRUE"==r[1].split(this.tic).join("")?"1":"FALSE"==r[1].split(this.tic).join("")?"0":r[1],r[2]=""==r[2]?"0":r[2],r[2]="TRUE"==r[2].split(this.tic).join("")?"1":"FALSE"==r[2].split(this.tic).join("")?"0":r[2];var l=this._parseDouble(r[0]),n=this._parseDouble(r[1]),s=this._parseDouble(r[2]),o=0;if(isNaN(l)||isNaN(n)||isNaN(s)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}if(o=(3600*l+60*n+s)/86400,i=new Date(Date.now()).toLocaleDateString()+" "+o,dt=new Date(Date.parse(i)),o<0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}return o.toString()},this.computeTimevalue=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if((i=(i=this.getValueFromArg(l[0]).split(this.tic).join("")).split(this.tic).join("")).indexOf(":")>-1&&(i=(new Date).toLocaleDateString()+" "+i),"Invalid Date"==(r=new Date(Date.parse(i))).toString()&&(e=new Date(Date.now()).toLocaleDateString()+" "+e,r=new Date(Date.parse(e))),"Invalid Date"==r.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}return((3600*r.getHours()+60*r.getMinutes()+r.getSeconds())/86400).toString()},this.computeToday=function(e){var t,i;if(""!=e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return t=new Date(Date.now()),this.getExcelLikeComputations()?"msie"!=(i=ej.browserInfo()).name&&"mozilla"!=i.name&&!ej.isNullOrUndefined(i.name)&&this._isInteriorFunction?t.toLocaleDateString():t.getFullYear()+"/"+_calculateDate(t.getMonth()+1)+"/"+_calculateDate(t.getDate()):this._toOADate(t).toString()},this.computeWeekday=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a.length;if(1!=d&&2!=d||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(a[0],FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1)?t:2==a.length&&this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(a[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)?i:(r="TRUE"==(r=this.getValueFromArg(a[0])).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,l=new Date(Date.parse(r.split(this.tic).join(""))),n=this._parseDouble(r),!isNaN(n)&&l.getFullYear()>9999&&(l=this._fromOADate(n)),a[1]=2==d?a[1]:"1","Invalid Date"==l.toString()&&(l=this._fromOADate(n)),s=parseInt(this.getValueFromArg(a[1])),o=l.getDay(),1==s?o+=1:(0==o&&(o=7),3==s&&(o-=1)),o.toString())},this.computeWeeknum=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(s>3||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(n[0],FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1||2==s&&(t=this.formulaErrorStringCheck(n[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)))return t;if(""==n[0]){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[0].toString();return this.getErrorStrings()[0].toString()}"Invalid Date"==this._fromOADate(this.DateFormatter(this.getValueFromArg(n[0]).split(this.tic).join("")))?(i=this.getValueFromArg(n[0]).split(this.tic).join(""),i=this._fromOADate(i)):i=this.DateFormatter(this.getValueFromArg(n[0]).split(this.tic).join(""));parseInt(i),new Date(i);var o=new Date(Date.parse(i));if("Invalid Date"==o.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}if(r=["","0","1","","","","","","","","","1","2","3","4","5","6","0","","","","1"],2!=s?l=1:""==(l=this.getValueFromArg(n[1]))&&(l=1),Boolean("TRUE"==l||"FALSE"==l)){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}isNaN(l);var a=parseInt(r[l]),d=new Date(o.getFullYear(),0,1),h=d.getDate(),c=h<a?a-h+1:h-a,u=this._fromOADate(this._toOADate(d)-c),g=this._toOADate(o)-this._toOADate(u);return(Math.floor(g/7)+1+a).toString()},this.computeWorkDay=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(2!=o&&o>3||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){for(t=0;t<o;t++)if(1!=t&&(i=this.formulaErrorStringCheck(s[t],FormulaArgumentType.Date),this.getErrorStrings().indexOf(i)>-1))return i;if(i=this.formulaErrorStringCheck(s[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)return i}if(""==s[0]||""==s[1]){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[0].toString()}if("",0,r=3==o?s[0]+this.getParseArgumentSeparator()+s[1]+this.getParseArgumentSeparator()+"1"+this.getParseArgumentSeparator()+s[2]:s[0]+this.getParseArgumentSeparator()+s[1]+this.getParseArgumentSeparator()+"1",l=this.computeWorkDayOintl(r),n=new Date(Date.parse(this._fromOADate(l).toString())),isNaN(Date.parse(l))&&parseInt(l)&&(n=this._fromOADate(l)),"Invalid Date"==n.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[1].toString()}return this._toOADate(n).toString()},this.computeWorkDayOintl=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a.length;if(d>4||d<2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(""==a[0]||""==a[1]){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[0].toString()}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(a[0],FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(a[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)||d>=3&&(t=this.formulaErrorStringCheck(a[2],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)||4==d&&(t=this.formulaErrorStringCheck(a[3],FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1)))return t;var h,c,u=[],g=this.getValueFromArg(a[0]).split(this.tic).join(""),p=new Date(Date.parse(g)),m=this.getValueFromArg(a[1]).split(this.tic).join("");if(!isNaN(Date.parse(g))&&parseInt(g)&&(p=this._fromOADate(g)),isNaN(m)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[1].toString()}if(this._toOADate(p)+m,""==g.split(this.tic).join("")){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[0].toString()}if("Invalid Date"==p.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[1].toString()}if(i=parseInt(m.toString()),4==d)if(h=a[3],(h=this.adjustRangeArg(h)).indexOf(":")>-1||h.indexOf(",")>-1)for(r=this.getCellsFromArgs(h),l=0;l<r.length;l++){try{c=this.getValueFromArg(r[l]).split(this.tic).join("")}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[4].toString()}""!=c&&("Invalid Date"!=(n=new Date(Date.parse(c))).toString()&&-1==u.indexOf(n)&&n>p&&u.push(n.toString()))}else{try{c=this.getValueFromArg(h).split(this.tic).join("")}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[4].toString()}""!=c&&(n=new Date(Date.parse(c)),isNaN(Date.parse(c))&&parseInt(c)&&(n=this._fromOADate(c)),"Invalid Date"!=n.toString()&&-1==u.indexOf(n)&&n>p&&u.push(n))}if(s=parseInt(a[2]),d>2&&!isNaN(s)||(s=1),0==s){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[4].toString()}var _=this._splitArguments(_weekEndType[s].toString(),","),f=0,b=p;if(i<0)for(;f>i;)o=(b=new Date(b.setDate(b.getDate()-1))).getDay(),_.indexOf(o.toString())<0&&u.indexOf(b)<0&&f--;else for(;f<i;)o=(b=new Date(b.setDate(b.getDate()+1))).getDay(),_.indexOf(o.toString())<0&&u.indexOf(b.toString())<0&&f++;return this._toOADate(b).toString()},this.computeYear=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Date),this.getErrorStrings().indexOf(t)>-1))return t;i="TRUE"==(i=this.getValueFromArg(l[0]).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i;var n=parseInt(i),s=new Date(Date.parse(n)),o=ej.browserInfo();if(isNaN(Date.parse(n))&&("msie"==o.name||"mozilla"==o.name||ej.isNullOrUndefined(o.name))&&(r=l[0].split(this.tic),s=new Date(r[1])),!isNaN(n)&&s.getFullYear()>9999&&(s=this._fromOADate(i)),0==n)return"1900";if(n<0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[4].toString()}if(""==i.toString().split(this.tic).join("")){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[0].toString()}if("Invalid Date"==s.toString()){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this.bad_formula];return this.getErrorStrings()[1].toString()}return s.getFullYear().toString()},this.computeChar=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0]).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i),!isNaN(r)&&r>0&&r<256)return String.fromCharCode(i);if(this.getRethrowLibraryComputationExceptions())throw this.getLibraryComputationException();return this._errorStrings[1].toString()},this.computeCode=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.getValueFromArg(l[0]).split(this.tic).join(""),r=parseInt(i),!isNaN(r))return i.charCodeAt(0).toString();if(null==i||""==i){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return l[0].length>4?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}return i.charCodeAt(0).toString()},this.computeUniCode=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(1!=r.length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.getValueFromArg(r[0]),this._isCellReference(r[0])){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if(this._parseDouble(i),"invalid expression"==i||null==i||""==i){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}return i.split(this.tic).join("").charCodeAt(0).toString()},this.computeUpper=function(e){var t;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)?t:this._stripTics0(this.getValueFromArg(e)).toUpperCase()},this.computeLower=function(e){var t;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)?t:this._stripTics0(this.getValueFromArg(e)).toLowerCase()},this.computeLen=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if((1!=n.length||""==e)&&!this._isArrayFormula){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}var s=n[0],o="",a=0;if(this._isArrayFormula){if((t=this._computeArrayInteriorFunction(e,"LEN",this.computeFunctionLevel))!=this._string_empty)return t;s.indexOf(":")>-1&&(s=this.getCellsFromArgs(s)[0])}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1))return i;if(s.indexOf(":")>-1&&s.indexOf(":")>2)for(r=this.getCellsFromArgs(s),l=0;l<r.length;l++){try{o=this.getValueFromArg(r[l].split(this.tic).join(this._string_empty))}catch(e){return e}o!=this._string_empty&&(a+=o[0]==this.tic&&o[o.length-1]==this.tic?o.length-2:o.length)}else s=this._stripTics0(this.getValueFromArg(n[0])),isNaN(parseInt(s))&&("Invalid Date"!=new Date(Date.parse(s))&&(s=this.DateFormatter(s))),a=s[0]==this.tic&&s[s.length-1]==this.tic?s.length-2:s.length;return a.toString()},this.computeMid=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(3!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(l[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(l[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)||(t=this.formulaErrorStringCheck(l[2],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)))return t;i=l[0];var n=(i=this.getValueFromArg(i))[0]==this.tic&&i[i.length-1]==this.tic,s=this.getValueFromArg(l[1]),o=this._parseDouble(l[2]);if(s=this.getValueFromArg(l[1]),r=Number(s)+Number(n?0:-1),""==s){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}return l[1].indexOf("#VALUE!")>-1?"#VALUE!":Number(r)>i.length?"":(i=r+o>i.length?i.substring(r):this._substring(i,r,o),n&&i[0]!=this.tic&&(i=this.tic+i),n&&i&&(i+=this.tic),this._stripTics0(i))},this.computeLeft=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(1!=o&&2!=o||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.TextWithNumber),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this._stripTics0(this.getValueFromArg(s[0])),!this._isCellReference(s[0])&&i.indexOf(this.tic)>-1){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}return r=i[0]==this.tic&&i[i.length-1]==this.tic,l=2==o?s[1]:"1",l=this._stripTics0(l),l="TRUE"==(l=this.computedValue(l)).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,n=Number(l)+Number(r?1:0),n=i.length>=n?n:i.length,(n=i.length>=n?n:i.length)<0?this.getErrorStrings()[1].toString():(0==n?i="":(i=i.substring(0,n),r&&i[i.length-1]!=this.tic&&(i+=this.tic)),this.getUseNoAmpersandQuotes()&&i.length>1&&i[0]==this.tic[0]&&i[i.length-1]==this.tic[0]&&(i=this._substring(i,1,i.length-2)),i)},this.computeRight=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(1!=o&&2!=o||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.TextWithNumber),this.getErrorStrings().indexOf(t)>-1))return t;if(s1=this._stripTics0(this.getValueFromArg(s[0])),!this._isCellReference(s[0])&&-1==s[0].indexOf(this.tic)){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}return i=s1[0]==this.tic&&s1[s1.length-1]==this.tic,r="TRUE"==(r=2==o?this.getValueFromArg(s[1]):"1").split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,l=parseInt(this._stripTics0(r)),isNaN(l)||l<0||r.indexOf("#VALUE!")>-1?"#VALUE!":0==l?"":(l=Number(l)+Number(i?1:0),n=s1.length>=l?s1.length-l:0,s1=s1.substring(n),i&&s1[0]!=this.tic&&(s1=this.tic+s1),s1)},this.computeReplace=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(4!=n.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(t=this.formulaErrorStringCheck(n[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)return t;if(i=this.formulaErrorStringCheck(n[3],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1)return i}var s=this._stripTics0(this.getValueFromArg(n[0])),o=this._stripTics0(this.getValueFromArg(n[3])),a="",d=this.getValueFromArg(n[1]);if(d="TRUE"==d?"1":"FALSE"==d?"0":d,d=this._parseDouble(d),r="TRUE"==(r=this.getValueFromArg(n[2]))?"1":"FALSE"==r?"0":r,r=this._parseDouble(r),!this._isCellReference(n[0])&&n[0][0]!=this.tic||!this._isCellReference(n[3])&&n[3][0]!=this.tic){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if(0==d&&0==r){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(isNaN(d)||isNaN(r)){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}try{if(l="",null==s||""==s)return o;s.length<=d&&d>r?a=s+o:s.length<=d?(l=s,a=s.split(l).join(o)):0==r?a=o+s:(l=this._substring(s,d-1,r),a=s.split(l).join(o))}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}return a},this.computeExact=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(2!=s.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)?t:(i=this.getValueFromArg(s[0]),r=this.getValueFromArg(s[1]),l=this._parseDouble(i),n=this._parseDouble(r),isNaN(l)||(i=l.toString()),isNaN(n)||(r=n.toString()),i.split(this.tic).join("")==r.split(this.tic).join("")?"TRUE":"FALSE")},this.computeFind=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(2!=l.length&&3!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.TwoTextWithNumber),this.getErrorStrings().indexOf(t)>-1))return t;var n=this._stripTics0(this.getValueFromArg(l[0])),s=this._stripTics0(this.getValueFromArg(l[1])),o=1;return 3==l.length&&(i=this.getValueFromArg(l[2]),o=this._parseDouble(i),isNaN(o)&&(o=1)),o<=0||o>s.length?"#VALUE!":(r=s.indexOf(n,o-1))<0?"#VALUE!":(Number(r)+Number(1)).toString()},this.computeSearch=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a.length,h=1;if(2!=d&&3!=d||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.TwoTextWithNumber),this.getErrorStrings().indexOf(i)>-1))return i;if(r=this._stripTics0(this.getValueFromArg(a[0])).toUpperCase(),l=this._stripTics0(this.getValueFromArg(a[1])).toUpperCase(),!this._isCellReference(a[0])&&a[0][0]!=this.tic||!this._isCellReference(a[1])&&a[1][0]!=this.tic){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if(n=r,r.indexOf("*")>-1)r=r.split("*").join("")[0].toString();else if(r.indexOf("?")>-1){for(s=n.substring(0,n.indexOf("?")),o=Number(l.indexOf(s));-1==l.indexOf(n);)for(o=Number(l.substring(o).indexOf(s))+Number(o)+1,n=r;-1!=n.indexOf("?");){if(l.length<=o)return this.getErrorStrings()[1].toString();n=n.substring(0,n.indexOf("?"))+l[o]+r.substring(n.indexOf("?")+1),o++}r=n}if(t=Number(l.indexOf(r))+1,3==d){if(1==(h=parseInt(this.getValueFromArg(a[2])))&&r[0]==l[0])return h;if(!isNaN(h))try{t=Number(l.indexOf(r,h))+1}catch(e){return this.getErrorStrings()[1].toString()}}return 0==t?this.getErrorStrings()[1].toString():t.toString()},this.computeSubstitute=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e);if(3!=o.length&&4!=o.length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation())for(t=0;t<3;t++)if(i=this.formulaErrorStringCheck(o[t],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1)return i;if(4==o.length&&this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(o[3],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1))return i;var a=this._stripTics0(this.getValueFromArg(o[0])),d=this._stripTics0(this.getValueFromArg(o[1])),h=this._stripTics0(this.getValueFromArg(o[2]));if(3==o.length){if(""==d||null==d)return a;a=a.split(d).join(h)}else{if(r=this.getValueFromArg(o[3]),!this._isCellReference(o[3])&&o[3][0]==this.tic){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if(l=parseInt(r),!isNaN(l)){for(n=l,s=-1;n>0&&(s=a.indexOf(d,Number(s)+1))>-1;)n--;0==n&&(a=a.substring(0,s)+h+a.substring(Number(s)+Number(d.length)))}}return a},this.computeUniChar=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(this._stripTics0(i)),isNaN(r)||r<=0){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return i[0]==this.tic?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}return String.fromCharCode(i).toString()},this.computeClean=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments].toString()}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;var n=this.getValueFromArg(l[0]),s="TRUE"==n||"FALSE"==n;if(this.getErrorStrings().indexOf(n)>-1)return n;if(-1==n.indexOf(this.tic)&&!this._isCellReference(e)&&isNaN(this._parseDouble(n))&&!s)return this.getErrorStrings()[5].toString();for(i=0;i<=31;i++)r=this.computeChar(i.toString()),n.indexOf(r)>-1&&(n=n.replace(r,""));return n[0]==this.tic&&n[n.length-1]==this.tic&&(n=this._substring(n,1,n.length-1)),n},this.computeTrim=function(e){var t;if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;for(var i=this._stripTics0(this.getValueFromArg(e)),r=(this.tic,0);i.length!=r;)r=i.length,i=i.split("  ").join(" ");return i},this.computeRept=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(2!=s.length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.TextWithNumber),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this._stripTics0(this.getValueFromArg(s[0])),1,s[1]=this.getValueFromArg(s[1].split(this.tic).join("")),s[1]="TRUE"==s[1].split(this.tic).join("")?"1":"FALSE"==s[1].split(this.tic).join("")?"0":s[1],null==i||""==i||null==s[1]||""==s[1])return"";if((r=parseInt(s[1].split(this.tic).join("")))<0||isNaN(r)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}for(l="",n=0;n<r;n++){if(l.length>32767){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}l=l.concat(i)}return l},this.computeProper=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.getValueFromArg(l[0]),!this._isCellReference(l[0])&&l[0][0]!=this.tic){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}return(r=(i=this._stripTics0(t)).indexOf("'"))>=0&&r<i.length-1&&(i=i.replace(/[']/," '")),/[^a - zA - Z]/.test(i)?i=i.replace(/\w\S*/g,function(e){for(var t=0,i=e[t].toString().toUpperCase().charCodeAt(0);!(i>64&&i<91);)e[++t]!=undefined?i=e[t].toUpperCase().charCodeAt(0):(t--,i=0);return e.substr(0,t)+e.charAt(t).toUpperCase()+e.substr(t+1).toLowerCase()}):/[a - zA - Z0 - 9] + $/.test(i)&&(i=i.replace(/[^a-zA-Z0-9_\\]/,"")),i},this.computeT=function(e){var t,i,r,l,n=0,s=this.splitArgsPreservingQuotedCommas(e);if(s.length>1)for(t=0;t<s.length;t++)if(n++,s[t].indexOf(":")>-1)for(--n,i=this.getCellsFromArgs(t),r=0;r<i.length;r++)n++;if(n>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(l)>-1))return l;var o=this.getValueFromArg(e),a="TRUE"==o||"FALSE"==o;return isNaN(this._parseDouble(o))&&!a&&isNaN(this._isDate(o))&&/[a-zA-Z0-9!#$%&'()*+,/:;<=>?@\^_`{|}~-]/.test(o)?this._stripTics0(o):" "},this.computeNumberValue=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a.length,h=this._parseDecimalSeparator,c=this._parseArgumentSeparator;if(d>3||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this._stripTics0(this.getValueFromArg(a[0])),d>1)try{if(r=a.length>1&&null!=a[2]?this._stripTics0(this.getValueFromArg(a[1])):c,l=a.length>1&&null!=a[2]?this._stripTics0(this.getValueFromArg(a[2])):h,"invalid expression"==r||"invalid expression"==l||(null==r||""==r)&&(null==l||""==l)){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}h=this._stripTics0(r)[0],c=this._stripTics0(l)[0]}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(""==i||null==i)return"0";if(n=i.indexOf(h),(s=i.indexOf(c))>=n&&(-1!=n||-1!=s)&&a.length>2){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(i=(i=(i=(i=i.replace(this.tic,"")).replace(" ","")).replace(c.toString(),"")).replace(h,this._parseDecimalSeparator),o=this.computeValue(i),isNaN(o)||"$"==i[i.length-1]){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}return o},this.computeConcatenate=function(e){var t,i,r="",l=this.splitArgsPreservingQuotedCommas(e);if(!e||0==e.length){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;for(i=0;i<l.length;i++){if(this._isCellReference(l[i])&&-1!=l[i].indexOf(":")){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}l[i],r=r.concat(this._stripTics0(this.getValueFromArg(l[i])))}return r.indexOf("#N/A")>-1&&(r="#N/A"),r},this.computeValue=function(e){var t,i,r,l,n,s="";try{if(1!=(t=this.splitArgsPreservingQuotedCommas(e)).length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1))return i;var o=t[0],a=!1;if(o.indexOf(this.tic)>-1&&(a=!0),(null!=(o=this._stripTics0(this.getValueFromArg(o)))||""!=o)&&!this._isCellReference(o)&&a&&isNaN(this._parseDouble(o.split(",").join("").split("$").join("")))&&(o=o.split(this.tic).join(""),!0),!this._isCellReference(t[0])&&-1==t[0].indexOf(this.tic)&&isNaN(this._parseDouble(o))){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if((null==o||""==o)&&a){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if((null==o||""==o)&&!a){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._invalid_arguments]}if(o.indexOf(":")>-1)return(s=this.computeTimevalue(o)).toString();if("$"==o[0]&&(o=o.split("$").join("")),o.indexOf(",")>-1&&(o=o.split(",").join("")),("%"==o[0]||"%"==o[o.length-1])&&(o=o.split("%").join(""),r=this._parseDouble(o),isNaN(r)||(o=(r/100).toString())),l=new Date(Date.parse(o)),n=this._parseDouble(o),isNaN(n)){if("Invalid Date"==l.toString()){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}s=this._toOADate(l)}else s=n.toString()}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}return s.toString()},this.computeDollar=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o[0],d="2";if(2==o.length&&(d=o[1]),o.length>2||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(a="TRUE"==(a=""==(a=this.getValueFromArg(a))||null==a?"0":a).split(this.tic).join("")?"1":"FALSE"==a.split(this.tic).join("")?"0":a,d="TRUE"==(d=""==(d=this.getValueFromArg(d))||null==d?"0":d).split(this.tic).join("")?"1":"FALSE"==d.split(this.tic).join("")?"0":d,i=this._parseDouble(a),r=!1,isNaN(this._parseDouble(d))){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if((null==a||""==a)&&this._isCellReference(o[0])&&a[0]!=this.tic&&a[a.length-1]!=this.tic&&(i=0,r=!0),isNaN(i)&&!r){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}return l=this._parseDouble(d),n=0,isNaN(l)&&(l=""==d?0:2),l>0?ej.format(i,"c"+l):(s=Math.pow(10,-l),n=Math.round(i/s)*s,ej.format(n,"c0"))},this.computeFixed=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a[0],h="2",c="FALSE";if(a.length>3||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if((i=a.length)>1&&(h=a[1]),i>2&&(c=a[2]),d=this.getValueFromArg(d),h=this.getValueFromArg(h),c=this.getValueFromArg(c),d=""==d||null==d?"0":d,h=""==h||null==h?"0":h,c=""==c||null==c?"0":c,r=this._parseDouble(d),l=this._parseDouble(h),isNaN(l)&&(l=2),n=this._parseDouble(c),isNaN(n))if(c.toUpperCase()==this.falseValueStr)s=!1;else{if(c.toUpperCase()!=this.trueValueStr)return"#NAME?";s=!0}else s=0!=n;return s&&(ej.preferredCulture().numberFormat[","]=""),l>0?ej.format(r,"n"+l):(o=Math.pow(10,-l),r=Math.round(r/o)*o,ej.format(r,"n0"))},this.computeBin2Dec=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(l.length>1||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.getValueFromArg(l[0]).split(this.tic).join(this._string_empty),!/^[01]{1,10}$/.test(i))return this.getErrorStrings()[4].toString();try{return""==i&&(i="0"),r=parseInt(i,2),10==i.length&&"1"==i.substring(0,1)?(parseInt(i.substring(1),2)-512).toString():r.toString()}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}},this.computeBin2Oct=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d="";if(a.length>2||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(a.length>1&&(places=parseInt(this.getValueFromArg(a[1]).split(this.tic).join(""))),this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.getValueFromArg(a[0]).split(this.tic).join(""),!/^[01]{1,10}$/.test(i))return this.getErrorStrings()[4].toString();if(10==(r=a.toString()).length&&"1"==r.substring(0,1)){for(l=10,n="",s=0;s<3;s++){l-=3;var h=this._substring(r,l,3),c=0;for(o=this._parseDouble(parseInt(h,2).toString(8));o>0;c+=parseInt(o%10),o=parseInt(o/10));n=c.toString()+n}return"7777777"+n}if(i<0)return(1073741824+i).toString(8);if(d=parseInt(i,2).toString(8),"undefined"==typeof places)return d;if(isNaN(places))return"#VALUE!";if(places<0)return"#NUM!";if(places=Math.floor(places),!(places>=d.length&&places<=10))throw this.getRethrowLibraryComputationExceptions()?new Error("Parameter is not valid"):(new this.getErrorStrings)[4].toString();for(;places-d.length>0;)d="0"+d,places--;return d},this.computeBin2Hex=function(e){var t,i=0,r=this.splitArgsPreservingQuotedCommas(e),l=this.getValueFromArg(r[0]).split(this.tic).join(this._string_empty),n="";if(r.length>2||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(r.length>1&&(i=this._parseDouble(r[1])),this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if("1111111111"==l)return l.replace("1","F");if(10==l.length&&"1"==l.substring(0,1))return(1073741312+parseInt(l,2).toString(8)).toString();try{if(l.length>10||this._parseDouble(l)<0||isNaN(l)){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if("NaN"==(n=parseInt(l,2).toString(16))&&(n=this.getErrorStrings()[4].toString()),r.length>1)if(i>=n.length&&i<=10)n=this._padLeft("0",i,n);else{if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();n=this.getErrorStrings()[4].toString()}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();if(this.computeIsText(l)!=this.trueValueStr)return""==l?"0":this.getErrorStrings()[4].toString();n=this.getErrorStrings()[5].toString()}return n.toUpperCase()},this.computeDec2Bin=function(e){var t,i,r,l,n=0,s=this.splitArgsPreservingQuotedCommas(e),o="";if(null==e||""==e||s.length>2||s.length<1){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.getValueFromArg(s[0]).split(this.tic).join(this._string_empty),r=s.length>1?this.getValueFromArg(s[1]).split(this.tic).join(this._string_empty):"10",isNaN(this._parseDouble(i))&&isNaN(this._parseDouble(r))){if((null!=i||""!=i)&&this.computeIsText(i)==this.trueValueStr||(null!=r||""!=r)&&this.computeIsText(r)==this.trueValueStr){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(null!=i&&""!=i&&this.computeIsText(i)==this.falseValueStr||null!=i&&""!=i&&this.computeIsText(r)==this.falseValueStr){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(null==i&&""==i||null==r||""==r){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}}try{if(s.length>1&&(l=this.getValueFromArg(s[1]).replace(this.tic,""),n=this._parseDouble(l)),isNaN(i)){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(this._parseDouble(i)<-512||this._parseDouble(i)>511){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(o=(i>>>0).toString(2),!isNaN(this._parseDouble(i))&&this._parseDouble(i)<0&&(o=o.substring(o.length-10)),s.length>1){if(n>10){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}n<=10&&(o=this._padLeft("0",n,o))}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException()}return o},this.computeDec2Oct=function(e){var t,i,r=0,l=this.splitArgsPreservingQuotedCommas(e),n=this.getValueFromArg(l[0]).split(this.tic).join(this._string_empty),s=l.length>1?this.getValueFromArg(l[1]).replace(this.tic,""):"10",o="";if(null==e||""==e||l.length>2||l.length<1){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(isNaN(this._parseDouble(n))||isNaN(this._parseDouble(s))){if((null!=n||""!=n)&&this.computeIsText(n)==this.trueValueStr||(null!=s||""!=s)&&this.computeIsText(s)==this.trueValueStr){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(this.getErrorStrings().indexOf(n)>-1)return n;if(this.getErrorStrings().indexOf(s)>-1)return s;if(null!=n&&""!=n&&this.computeIsText(n)==this.falseValueStr||null!=n&&""!=n&&this.computeIsText(s)==this.falseValueStr){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(null==n&&""==n||null==s||""==s){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[0].toString()}}try{if(l.length>1&&(i=this.getValueFromArg(l[1]).replace(this.tic,""),r=this._parseDouble(i)),this._parseDouble(n)<-536870912||this._parseDouble(n)>536870911){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(this._parseDouble(n)<0)o=parseInt(n>>>0,10).toString(8),!isNaN(this._parseDouble(n))&&this._parseDouble(n)<0&&(o=o.substring(o.length-10));else if(o=parseInt(n,10).toString(8),!isNaN(this._parseDouble(n))&&this._parseDouble(n)<0&&(o=o.substring(o.length-10)),l.length>1){if(r>10){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}r<=10&&(o=this._padLeft("0",r,o))}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException()}return o},this.computeHex2Bin=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(s.length>2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(e==this._parseArgumentSeparator.toString()){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[0].toString()}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(s[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1))return i;if(2==s.length&&this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(s[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(r)>-1))return r;var o,a=this.getValueFromArg(s[0]),d=2==s.length?this.getValueFromArg(s[1]):"0";if(o=this._parseDouble(d),!isNaN(o)&&(o<0||o>10)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}if(Boolean("TRUE"==a||"FALSE"==a)||2==s.length&&Boolean("TRUE"==d||"FALSE"==d)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(""!=a){if(a[0]!=this.tic&&!this._isCellReference(a)&&isNaN(this._parseDouble(a))){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}}else if(this._isCellReference(s[0])&&""==a)return"0";if(a[0]==this.tic&&(null==a.split(this.tic).join("")||""==a.split(this.tic).join("")))return"0";if(d[0]==this.tic){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[1].toString()}if(isNaN(this._parseDouble(d.split(this.tic).join("")))){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if((t=this._parseDouble(d))<0||"-"==a[0]){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}l="",a=a.split(this.tic).join("");try{for(n=0;n<a.length;n++)l+=this._padLeft("0",4,parseInt(a.charAt(n),16).toString(2));if("FFFFFFFFFF"==a.split(this.tic).join(""))return this._parseDouble(a.split("F").join("1"));if(l.length>10||t>10||t<l.length&&0!=t){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(t>=l.length)l=this._padLeft("0",t,l);else if(0!=t){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(!isNaN(this._parseDouble(l))&&this._parseDouble(l)>536870911){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}return l},this.computeHex2Oct=function(e){var t,i,r,l,n,s,o=0,a=this.splitArgsPreservingQuotedCommas(e);if(a.length>2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(e==this._parseArgumentSeparator.toString()){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[0].toString()}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(a[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(2==a.length&&this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(a[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1))return i;if(r=this.getValueFromArg(a[0]),a[0]=a[0].split(this.TIC).join(""),l=2==a.length?this.getValueFromArg(a[1]):"0",""!=r&&r[0]!=this.tic&&!this._isCellReference(r)&&isNaN(this._parseDouble(r))){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[5].toString()}if(Boolean("TRUE"==r||"FALSE"==r)||2==a.length&&Boolean("TRUE"==l||"FALSE"==l)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(r[0]==this.tic&&(null==r.split(this.tic).join("")||""==r.split(this.tic).join("")))return"0";if(r.indexOf(this._parseArgumentSeparator.toString())>-1&&(n=r.indexOf(this._parseArgumentSeparator),r=r.split(this.tic).join("").substring(0,n-1)),s="",isNaN(this._parseDouble(l.split(this.tic).join("")))){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[5].toString()}if((o=this._parseDouble(l))<0||"-"==r[0]){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(a.length>2){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}a.length>1&&(o=this._parseDouble(a[1]));try{if(r=r.split(this.tic).join(""),s=parseInt(r,16).toString(8),!isNaN(this._parseDouble(s))&&s.length>10&&(s=s.substring(s.length-10)),a.length>1){if(!(o>=s.length&&o<=10)){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(s=this._padLeft("0",o,s),!isNaN(this._parseDouble(s))&&this._parseDouble(s)>536870911){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.computeIsText(r)==this.trueValueStr?this.getErrorStrings()[4].toString():""==r?"0":this.getErrorStrings()[4].toString()}return s},this._padLeft=function(e,t,i){var r,l=i.length;if(i.length<t&&e.toString().length>0)for(r=0;r<t-l;r++)i=e.toString().charAt(0).concat(i);return i},this.computeAddress=function(e){var t,i,r,l,n,s,o,a,d,h=this.splitArgsPreservingQuotedCommas(e),c=h.length;if(c>5||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){for(t=0;t<c-1;t++)if(i=this.formulaErrorStringCheck(h[t],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)return i;if(5==c&&(i=this.formulaErrorStringCheck(h[4],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1))return i}if(r=this._string_empty,l="TRUE"==(l=this.getValueFromArg(h[0].split(this.tic).join(this._string_empty))).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,n="TRUE"==(n=this.getValueFromArg(h[1].split(this.tic).join(this._string_empty))).split(this.tic).join("")?"1":"FALSE"==n.split(this.tic).join("")?"0":n,""==l||""==n){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(s=this._parseDouble(l),o=this._parseDouble(n),s<1||o<1){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}var u=c>2?this.getValueFromArg(h[2].split(this.tic).join(this._string_empty)):"1",g=o,p=g%26;if(g=parseInt(g/26),r+=this._charTable[p],(a=(r+=this._charTable[parseInt(g)]).split("").join(",").split(this.getParseArgumentSeparator())).reverse(),r="$"+(d=a.join(""))+"$"+l,c>2)switch(u){case"2":r=d+"$"+l;break;case"3":r="$"+d+l;break;case"4":r=d+l}if(c>3&&("FALSE"==this.getValueFromArg(h[3].split(this.tic).join(this._string_empty))||"0"==this.getValueFromArg(h[3].split(this.tic).join(this._string_empty))))switch(u){case"":case"1":r="R"+s+"C"+o;break;case"2":r="R"+s+"C["+o+"]";break;case"3":r="R["+s+"]C"+o;break;case"4":r="R["+s+"]C["+o+"]"}return c>4&&this.getValueFromArg(h[4].split(this.tic).join(this._string_empty))==this._string_empty&&(h[4]=this.getValueFromArg(h[4]),r=h[4].split(this.tic).join(this._string_empty)+"!"+r),r},this.computeAreas=function(e){var t,i,r,l,n;if(e.indexOf(" ")>0&&(e=e.substring(0,e.indexOf(" "))),!this._isCellReference(e)&&!this.getNamedRanges().containsKey(e)&&!e.indexOf(")")){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.formulaErrorStrings[this._invalid_arguments]}if((t=this._splitArguments(e,")")).length>2){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.getErrorStrings()[1].toString()}if(i=t[0].split("(").join(this._string_empty),this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(i,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(r)>-1))return r;for((l=this.splitArgsPreservingQuotedCommas(i)).length,n=0;n<l.length;n++)if(!this._isCellReference(l[n])){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[5].toString()}return l.length.toString()},this.computeChoose=function(e){var t,i,r,l,n;if((t=this.splitArgsPreservingQuotedCommas(e)).length<2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(t[0],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(l)>-1))return l;if(i="TRUE"==(i=this.getValueFromArg(t[0]).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,i=this.splitArgsPreservingQuotedCommas(i)[0],r=parseInt(i),isNaN(r)||r>t.length-1||r<1)return"#VALUE!";if(this._isInteriorFunction)return t[r];if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(t[r],FormulaArgumentType.Text),this.getErrorStrings().indexOf(l)>-1))return l;if(""==(n=this.getValueFromArg(t[r]))){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[5].toString()}return n},this.computeColumn=function(e){var t,i,r;if(null==e||e==this._string_empty)return this.colIndex(this.cell).toString();if(1!=this.splitArgsPreservingQuotedCommas(e).length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(i)>-1))return i;if(e.indexOf(":")>-1&&this._isArrayFormula){if((r=this._computeArrayInteriorFunction(e,"COLUMN",this.copmuteFunctionLevel))!=this._string_empty)return r;(e=this.getCellsFromArgs(e)[0]).indexOf(":")>-1&&(e=this.getCellsFromArgs(e)[0])}if((t=this.colIndex(e).toString())<=0||!isNaN(this._parseDouble(e))){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[5].toString()}return t},this.computeColumns=function(e){var t,i,r,l,n,s,o;if(1!=(t=this.splitArgsPreservingQuotedCommas(e)).length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(i)>-1))return i;if(-1,this._parseDouble(t[0],-1))return"1";if(t[0].indexOf(this.tic)&&!t[0].indexOf(";")&&!t[0].indexOf(this.getParseArgumentSeparator().toString())||!this._isCellReference(t[0])&&!this.getNamedRanges().containsValue(t[0])&&!e.indexOf(";")&&!e.indexOf(this.getParseArgumentSeparator().toString())){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(l=1,e.indexOf(":")>-1)n=this.getCellsFromArgs(e),r=this.colIndex(n[0].toString()),l=(l=this.colIndex(n[n.length-1].toString())-r+1)>0?l:1;else if(e.indexOf(";")>-1)for(o=this._splitArguments(e.split(this.tic).join(this._string_empty),";"),s=1;s<o.length;s++){if(this.splitArgsPreservingQuotedCommas(o[s-1]).length!=this.splitArgsPreservingQuotedCommas(o[1]).length){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}l=this.splitArgsPreservingQuotedCommas(o[0]).length}else l=(o=this.splitArgsPreservingQuotedCommas(t[0].split(this.tic).join(this._string_empty))).length;return l.toString()},this.computeFormulaText=function(e){var t,i=this.splitArgsPreservingQuotedCommas(e),r=i.length,l=this._string_empty;if(1!=r||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(l="TRUE"==(l=this.getValueFromArg(i[0])).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,this.getNamedRanges().containsValue(l)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}if(t=CalcEngine.getSheetFamilyItem(this.grid),-1==i[0].indexOf(this.sheetToken)&&this.isSheetMember()&&null!=t.parentObjectToToken&&(i[0]=t.parentObjectToToken.getItem(this.grid)+i[0]),!this.getFormulaInfoTable().containsKey(i[0])){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.rowIndex(i[0])<=0?this.getErrorStrings()[5].toString():this.getErrorStrings()[0].toString()}return l=this.getFormulaInfoTable().getItem(i[0]).getFormulaText(),this.getFormulaText(l),l},this.computeHyperlink=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=l.length;if(n>2||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)?t:(i=this._stripTics0(this.getValueFromArg(l[0])),2==n?null==(r=this._stripTics0(this.getValueFromArg(l[1])))?"0":r==this._string_empty?"0":r:i)},this.computeAbs=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=ej.parseFloat(i.split(this.tic).join("")),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return Math.abs(r).toString()},this.computeAcos=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}if(r>1||r<-1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return Math.acos(r).toString()},this.computeAcosh=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("").toUpperCase()?"1":"FALSE"==i.split(this.tic).join("").toUpperCase()?"0":i,i=this._stripTics0(i),r=this._parseDouble(i),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}if(z=Math.log(r+Math.sqrt(r*r-1)),r<=0||z==1/0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return z.toString()},this.computeAcot=function(e){var t,i,r;if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(this.getValueFromArg(e),e="TRUE"==e.split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,i=this._parseDouble(e),r=0,isNaN(i)||(r=i<=0?Math.PI/2-Math.atan(i):Math.atan(1/i)),r.toString())},this.computeAcoth=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(1!=n.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(n[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[5].toString()}if(r<1&&r>-1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}if(l=(Math.log((r+1)/(r-1))/2).toString(),this.computeIsErr(l)==this.trueValueStr){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return l},this.computeArabic=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.getValueFromArg(l[0]),-1!=this.getErrorStrings().indexOf(t))return t;if(i=parseInt(t.split(this.tic).join("").toUpperCase()),!isNaN(i)||!this._isCellReference(l[0])&&l[0][0]!=this.tic){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return isNaN(i)?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}t=t.split(this.tic).join("").toUpperCase();var n=0,s=0,o=0,a=0;for(a=1e3,r=!1,n=1;n<=t.length;n++){switch(this._substring(t,n-1,1)){case"-":r=!0;break;case"I":o=1;break;case"V":o=5;break;case"X":o=10;break;case"L":o=50;break;case"C":o=100;break;case"D":o=500;break;case"M":o=1e3;break;default:if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}s=o>a?s+o-2*a:s+o,a=o}return r&&(s=-s),s.toString()},this.computeAsin=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(1!=s.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(s[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(s[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}if(r>1||r<-1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return l=this._parseDouble(i),n=0,isNaN(l)||(n=Math.asin(l)),n.toString()},this.computeAtan=function(e){var t;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,this._computeMath(e,Math.atan).toString())},this.computeAtan2=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e);if(2!=a.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(0,0,l=this.getValueFromArg(a[0]),n=this.getValueFromArg(a[1]),l="TRUE"==l.split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,o="true"==(n="TRUE"==n.split(this.tic).join("")?"1":"FALSE"==n.split(this.tic).join("")?"0":n),(s="true"==l)?l=s.toString():l==this._string_empty&&(l="0"),o?n=o.toString():n==this._string_empty&&(n="0"),this.getErrorStrings().indexOf(l)>-1)return l;if(this.getErrorStrings().indexOf(n)>-1)return n;if(i=this._parseDouble(l),r=this._parseDouble(n),isNaN(i)||isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(0==r&&0==i){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[3].toString();return this.getErrorStrings()[3].toString()}return Math.atan2(r,i).toString()},this.computeCeilingMath=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(this._isTextEmpty(e)||s>3||s<1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;i="TRUE"==(i=this.getValueFromArg(n[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r="TRUE"==(r=s>1&&0!=n[1].length?this.getValueFromArg(n[1]):"1").split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,l="TRUE"==(l=3==s&&0!=n[2].length?this.getValueFromArg(n[2]):"1").split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l;var o,a,d,h=-1,c=!1,u=!1,g=!1;if(c="true"==i.split(this.tic).join(this._string_empty),u="true"==r.split(this.tic).join(this._string_empty),g="true"==l.split(this.tic).join(this._string_empty),i=c?c.toString():i,r=u?u.toString():r,l=g?g.toString():l,-1!=this.getErrorStrings().indexOf(i))return i;if(-1!=this.getErrorStrings().indexOf(r))return r;if(-1!=this.getErrorStrings().indexOf(l))return l;if(r.indexOf(" ")>-1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}if(r.startsWith(this.tic)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[4].toString()}if(o=this._parseDouble(i),h=this._parseDouble(r),a=this._parseDouble(l),isNaN(o)&&!isNaN(h)&&!isNaN(a)){if(0==o&&!this._isTextEmpty(i)&&this.computeIsText(i)==this.falseValueStr||0==h&&!this._isTextEmpty(r)&&this.computeIsText(r)==this.falseValueStr||0==a&&!this._isTextEmpty(l)&&this.computeIsText(l)==this.falseValueStr){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[5].toString()}if(this._isTextEmpty(i.split(this.tic).join(this._string_empty))&&i[0]==this.tic||this._isTextEmpty(r.split(this.tic).join(this._string_empty))&&r[1]==this.tic||this._isTextEmpty(l.split(this.tic).join(this._string_empty))&&l[2]==this.tic){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(this._isTextEmpty(i.split(this.tic).join(this._string_empty))||this._isTextEmpty(r.split(this.tic).join(this._string_empty))||this._isTextEmpty(l.split(this.tic).join(this._string_empty)))return"0";if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}return o<0&&a<0&&(h=-1),0==o||0==h?"0":(0,(o=this._parseDouble(o.toString()))>0&&(o+=.4999999999),o<0&&-.5>=o-parseInt(o)&&(o-=.4999999999),o=Math.round(o),d=Math.floor(o/h)*h,o<0&&o%2!=0&&0==a&&(d+=h),d.toString())},this.computeCeiling=function(e){var t,i,r,l,n,s,o,a,d=this.splitArgsPreservingQuotedCommas(e),h=d.length;if(2!=h||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(d[0]=this.getValueFromArg(d[0]),i="TRUE"==(i=null==(i=h>1?d[0]:"1")||""==i?"0":i).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,d[1]=this.getValueFromArg(d[1]),r="TRUE"==(r=""==(r=h>1&&0!=d[1].length?d[1]:"0")||null==r?"0":r).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,l=!1,n=!1,l="true"==i.split(this.tic).join(this._string_empty),n="true"==r.split(this.tic).join(this._string_empty),i=l?l.toString():i,(r=n?n.toString():r)==this.trueValueStr)return"1";if(r==this.falseValueStr)return"0";if(r.indexOf(" ")>-1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[1].toString()}if(-1!=this.getErrorStrings().indexOf(i))return i;if(-1!=this.getErrorStrings().indexOf(r))return r;if(o=-1,a=-1,s=this._parseDouble(i),o=this._parseDouble(r),isNaN(s)&&!isNaN(o)){if(0==s&&!this._isTextEmpty(i)&&this.computeIsText(i)==this.falseValueStr||0==o&&!this._isTextEmpty(r)&&this.computeIsText(r)==this.falseValueStr){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_index];return this.getErrorStrings()[5].toString()}if(this._isTextEmpty(i.split(this.tic).join(this._string_empty))&&i[0]==this.tic||this._isTextEmpty(r.split(this.tic).join(this._string_empty))&&r[0]==this.TIC){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this.invalid_arguments];return this.getErrorStrings()[1].toString()}if(this._isTextEmpty(i.split(this.tic).join(this._string_empty))||this._isTextEmpty(r.split(this.tic).join(this._string_empty)))return"0";if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(s=this._parseDouble(i),o=this._parseDouble(r),!isNaN(s)&&!isNaN(o)){if(s>0&&o<0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}if(0==s||0==o)return"0";if(a=Math.floor(s/o)*o,o>0)for(;a<s;)a+=o;else for(;a>s;)a+=o}return a.toString()},this.computeDecimal2=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e);if(a.length>3){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/",!this.getValueFromArg(a[0]).indexOf(this.tic)&&!this._isCellReference(a[0])){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[1].toString()}r=0;try{i=this.getValueFromArg(a[0]).split(this.tic).join(""),r=parseInt(this.getValueFromArg(a[1]).split(this.tic).join(""))}catch(e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_Math_argument]+e;return this.getErrorStrings()[1].toString()}if(r<2||r>t.length){if(this._rethrowLibraryComputationExceptions)throw"Base requested outside range, it should be from 2 - 16";return this.getErrorStrings()[4].toString()}for(i=this._isIE8?i.replace(/^\s+|\s+$/g,""):i.trim(),r<=36&&(i=i.toUpperCase()),n=0,l=0;n<i.length&&!this._isWhiteSpace(i[n]);){if(s=i.substring(n,1),!((o=t.indexOf(s))>=0&&o<r)){if(this._rethrowLibraryComputationExceptions)throw"Base requested outside range, it should be from 2 - 16";return this.getErrorStrings()[4].toString()}l*=r,l+=o,n++}return l.toString()},this.computeCombin=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e);if(2!=a.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(0,l="TRUE"==(l=null==(l=this.getValueFromArg(a[0]).split(this.tic).join(""))||""==l?"0":l).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,n="TRUE"==(n=null==(n=this.getValueFromArg(a[1]).split(this.tic).join(""))||""==n?"0":n).split(this.tic).join("")?"1":"FALSE"==n.split(this.tic).join("")?"0":n,l.split(this.tic).join("")==this._string_empty||n.split(this.tic).join("")==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(i=this._parseDouble(l),r=this._parseDouble(n),isNaN(i)||isNaN(r)){if(this._rethrowLibraryComputationExceptions)return this.formulaErrorStrings[this._invalid_arguments];throw this.getErrorStrings()[1].toString()}if(s=parseInt((r+.1).toString()),(o=parseInt((i+.1).toString()))<s||s<0||o<0||r<0){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[4].toString()}return this._comb(s,o).toString()},this.computeCombinA=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(e.indexOf("u")>-1){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(2!=o||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e.length>15){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return i=""==(i="TRUE"==(i=this.getValueFromArg(s[0]).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i)||0==i?"0":i,i=parseInt(i.split(this.tic).join("")),r=""==(r="TRUE"==(r=this.getValueFromArg(s[1]).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r)||0==r?"0":r,r=parseInt(r.split(this.tic).join("")),0==i&&0==r?l="1":(n=i+r-1+","+(i-1),l=this.computeCombin(n)),l},this.computeCos=function(e){var t;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,this._computeMath(e,Math.cos).toString())},this.computeCosh=function(e){var t,i,r,l,n=this._splitArguments(e,this.getParseArgumentSeparator().toString());if(n.length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(n[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i.split(this.tic).join("")),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(n[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return((l=Math.exp(r))+1/l)/2},this.computeCot=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);l.length;if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if((e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e)[0]==this.tic&&e[length-1]==this.tic&&(e=e.split(this.tic).join("")),e==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(this.computeIsNumber(e)!=this.trueValueStr){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[5].toString()}if(i=(i=e).indexOf("u")?i.split("u").join(this._string_empty):i,this._parseDouble(i)>=134217728){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if("0"==e){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[3].toString();return this.getErrorStrings()[3].toString()}return("#NUM!"!=(r=this._computeMath(e,Math.tan))||"#VALUE!"!=r)&&(r=(1/parseFloat(r)).toString()),r},this.computeCsc=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}if(r>=134217728){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return(1/parseFloat(Math.sin(r))).toString()},this.computeCsch=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i),this.computeIsNumber(e),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}if(0==r){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[3].toString()}return r>709?"0":(2/(Math.exp(r)-Math.exp(-r))).toString()},this.computeDecimal=function(e){var t,i,r,l,n,s,o,a,d=this.splitArgsPreservingQuotedCommas(e);if(d.length>3||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.TextWithNumber),this.getErrorStrings().indexOf(t)>-1))return t;if(""==d[1]){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/",l=0;try{r=this.getValueFromArg(d[0]).split(this.tic).join(""),l=parseInt(this.getValueFromArg(d[1]).split(this.tic).join(""))}catch(e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_Math_argument]+e;return this.getErrorStrings()[1].toString()}if(l<2||l>i.length){if(this._rethrowLibraryComputationExceptions)throw"Base requested outside range, it should be from 2 - 16";return this.getErrorStrings()[4].toString()}for(r=this._isIE8?r.replace(/^\s+|\s+$/g,""):r.trim(),l<=36&&(r=r.toUpperCase()),s=0,n=0;s<r.length;){if(o=this._substring(r,s,1),!((a=i.indexOf(o))>=0&&a<l)){if(this._rethrowLibraryComputationExceptions)throw"Base requested outside range, it should be from 2 - 16";return this.getErrorStrings()[4].toString()}n*=l,n+=a,s++}return n.toString()},this.computeDegrees=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return 0,(180*r/Math.PI).toString()},this.computeExp=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(r.length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(""==(i="TRUE"==(i=this.getValueFromArg(r[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i)&&(e="0"),this._parseDouble(i)>709){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return this._computeMath(e,Math.exp).toString()},this.computeEven=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(n.length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(r="TRUE"==(i=this.getValueFromArg(n[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(r.split(this.tic).join("")),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(n[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return l=Math.sign(r),r=Math.abs(r),((r=Math.ceil(r))%2==1?l*(r+1):l*r).toString()},this.computeFact=function(e){var t,i,r,l,n,s=0;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(r="TRUE"==(i=this.getValueFromArg(e)).split(this.tic).join("").toUpperCase()?"1":"FALSE"==i.split(this.tic).join("").toUpperCase()?"0":i,r=this._parseDouble(r.split(this.tic).join("")),isNaN(r))return this.getErrorStrings()[1].toString();if(r<0)return this.getErrorStrings()[4].toString();if((l=parseInt(r))>12)for(s=this._factorialTable[12],n=13;n<=l;n++)s*=n;else s=this._factorialTable[l];return s.toString()},this.computeFactdouble=function(e){var t,i,r,l,n=1;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1))return i;if(t=parseInt(this.getValueFromArg(e)),isNaN(t))return this.getErrorStrings()[1].toString();if(t<0)return this.getErrorStrings()[4].toString();if(l=r=t,r>3)for(;l>0;)n*=l,l-=2;else n=0==r?1:r;return n.toString()},this.computeFloor=function(e){var t,i=this.splitArgsPreservingQuotedCommas(e);if(2!=i.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;var r=this._parseDouble(this.getValueFromArg(i[0])),l=this._parseDouble(this.getValueFromArg(i[1])),n=0;if(!isNaN(r)&&!isNaN(l)){if(0==r)return n.toString();if(r*l<=0&&!(r<0))return this.formulaErrorStrings[this._invalid_arguments];if(n=Math.ceil(r/l)*l,l>0)for(;n>r;)n-=l;else for(;n<r;)n-=l;.1==l&&(n=r)}return n.toString()},this.computeInt=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(l.length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.getValueFromArg(l[0]),this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1))return i;if(t="TRUE"==t.split(this.tic).join("")?"1":"FALSE"==t.split(this.tic).join("")?"0":t,r=Math.floor(t).toString(),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return t[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return r},this.computeLn=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(r.length>1)return this.formulaErrorStrings[this.invalid_arguments];if(t=this.getValueFromArg(r[0]),(i=this._parseDouble(t))<=0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}if(isNaN(i)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return t[0]==this.tic||this._isCellReference(r[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return Math.log(i).toString()},this.computeLog=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(o>2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.getValueFromArg(s[0]),r=2==o?this.getValueFromArg(s[1]):"10",ej.isNullOrUndefined(ej.cultureObject)||"en-US"==ej.cultureObject.name||(i=ej.isNullOrUndefined(i)||i==this._string_empty?i:ej.parseFloat(i.toString(),0,ej.cultureObject.name).toString(),r=ej.isNullOrUndefined(r)||r==this._string_empty?r:ej.parseFloat(r.toString(),0,ej.cultureObject.name).toString()),""==i||null==i||""==r||null==r){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}if(i="TRUE"==i.split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,l=this._parseDouble(i),n=this._parseDouble(r),l<=0||n<=0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}if(isNaN(l)||isNaN(n)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||r[0]==this.tic?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return(Math.log(l)/Math.LN10/(Math.log(n)/Math.LN10)).toString()},this.computeLogTen=function(e){var t,i,r,l=this._splitArguments(e,this.getParseArgumentSeparator().toString());if(l.length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i.split(this.tic).join("")),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(l[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}if(r<=0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return(this._computeMath(i,Math.log)/Math.LN10).toString()},this.computePI=function(e){if(this.getEnableFormulaErrorValidation()){var t=this.formulaErrorStringCheck(e,FormulaArgumentType.None);return this.formulaErrorStrings[this._invalid_arguments]==t?t:Math.PI.toString()}return Math.PI.toString()},this.computeProduct=function(e){var t,i,r,l,n,s,o,a,d=1,h=!0;if(this.adjustRangeArg(e),r=this.splitArgsPreservingQuotedCommas(e),""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(l)>-1))return l;for(n=0;n<r.length;n++)if(s=r[n],r[n].indexOf(":")>-1)for(o=this.getCellsFromArgs(s),a=0;a<o.length;a++){try{i="TRUE"==(i=this.getValueFromArg(o[a])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i}catch(e){return e}if(i.length>0){if(t=this._parseDouble(i),isNaN(t)){if(this.getErrorStrings().indexOf(i)>-1)return i;if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}d*=t,h=!1}}else{try{i="TRUE"==(i=this.getValueFromArg(r[n])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i}catch(e){return e}if(i.length>0){if(t=this._parseDouble(i),isNaN(t)){if(this.getErrorStrings().indexOf(i)>-1)return i;if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i==this.tic||this._isCellReference(r[n])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}d*=t,h=!1}}return h?"0":d.toString()},this.computeSecant=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(e=this.getValueFromArg(e),1!=r.length){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(e[0]==this.tic&&e[length-1]==this.tic&&(e=e.split(this.tic).join("")),e==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(this.computeIsNumber(e)!=this.trueValueStr){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[5].toString()}if(t=(t=e).indexOf("u")?t.split("u").join(""):t,parseFloat(t)>=134217728){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return("#NUM!"!=(i=this._computeMath(e,Math.cos))||"#VALUE!"!=i)&&(i=(1/parseFloat(i)).toString()),i},this.computeSecanth=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(e=this.getValueFromArg(e),1!=l.length){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e[0]==this.tic&&e[length-1]==this.tic&&(e=e.split(this.tic).join("")),e==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(e=(e="TRUE"==e.split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e).split(this.tic).join(""),this.computeIsNumber(e)==this.trueValueStr&&(i=(i=e).includes("u")?i.replace("u",""):i,parseFloat(i)>=134217728)){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return e=e.includes("-")?e.replace("-",""):e,("#NUM!"!=(r=this._computeMath(e,Math.cosh))||"#VALUE!"!=r)&&(r=(1/parseFloat(r)).toString()),r},this.computeSeriessum=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(4!=n.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(t=0;t<=2;t++)if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(n[t],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1))return i;if(this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(n[3],FormulaArgumentType.Text),this.getErrorStrings().indexOf(r)>-1))return r;var s,o,a,d,h=0,c=0;if(d=n[3].indexOf(";")>-1?this._splitArguments(n[3].split(this.tic).join(""),";"):this.getCellsFromArgs(n[3].split(this.tic).join("")),""==n[0]||""==n[1]||""==n[2]){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[0].toString()}for(s=this._parseDouble(this.getValueFromArg(n[0])),o=this._parseDouble(this.getValueFromArg(n[1])),a=this._parseDouble(this.getValueFromArg(n[2])),l=0;l<d.length;l++){if(h=this._parseDouble(this.getValueFromArg(d[l])),isNaN(h)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}c+=h*Math.pow(s,o+l*a)}if(isNaN(c)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}return c.toString()},this.computeSin=function(e){var t;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,this._computeMath(e,Math.sin).toString())},this.computeSinh=function(e){var t,i,r,l,n=this._splitArguments(e,this.getParseArgumentSeparator().toString());if(n.length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i="TRUE"==(i=this.getValueFromArg(n[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i.split(this.tic).join("")),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(n[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return((l=Math.exp(r))-1/l)/2},this.computeSqrt=function(e){var t;if(this._splitArguments(e,this.getParseArgumentSeparator().toString()).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,this._computeMath(e,Math.sqrt).toString())},this.computeSubTotal=function(e){var t,i,r,l,n=!1,s=this._string_empty,o=this._splitArguments(e,this.getParseArgumentSeparator().toString());if(o.length<2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(o[0],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(r)>-1))return r;if(s=this._isCellReference(o[0])?this.getValueFromArg(o[0]):o[0].toString(),t=this._parseDouble(s),isNaN(t)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[5].toString()}if(((i=parseInt(t.toString()))<1||i>11)&&(i<101||i>111))return this.getErrorStrings()[1].toString();if(n)return"0";switch(s=e.substring(o[0].toString().length+1),n=!0,l=this._string_empty,i){case 1:case 101:l=this.computeAverage(s);break;case 2:case 102:l=this.computeCount(s);break;case 3:case 103:l=this.computeCounta(s);break;case 4:case 104:l=this.computeMax(s);break;case 5:case 105:l=this.computeMin(s);break;case 6:case 106:l=this.computeProduct(s);break;case 7:case 107:l=this.computeStdev(s);break;case 8:case 108:l=this.computeStdevp(s);break;case 9:case 109:l=this.computeSum(s);break;case 10:case 110:l=this.computeVar(s);break;case 11:case 111:l=this.ComputeVarp(s);break;default:l=this.getErrorStrings()[1].toString()}return n=!1,l},this.computeSumif=function(e){var t,i,r,l,n,s,o,a,d,h,c=this.splitArgsPreservingQuotedCommas(e),u=c.length;if(2!=u&&3!=u||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(c[0],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1||3==u&&(t=this.formulaErrorStringCheck(c[2],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)))return t;if(i=c[0],(r=c[1].split(this.tic).join(this._string_empty)).length<1)return"0";l=this.token_equal,r[0]!=this.tic[0]&&-1=="=><".indexOf(r[0])&&(r=this.getValueFromArg(r)),n=r.length>0&&r[0]==this.tic[0]?1:0,s=this.minValue,r.startsWith(">=")?(r=this._substring(r,n+2,r.length-2-2*n),l=this.token_greatereq):r.startsWith("<=")?(r=this._substring(r,n+2,r.length-2-2*n),l=this.token_lesseq):r.startsWith("<")?(r=this._substring(r,n+1,r.length-1-2*n),l=this.token_less):r.startsWith(">")?(r=this._substring(r,n+1,r.length-1-2*n),l=this.token_greater):r.startsWith("=")&&(r=this._substring(r,n+1,r.length-1-2*n)),r=r.split(this.tic).join("");var g=this._parseDouble(r,s),p=2==u?i:c[2],m=this.getCellsFromArgs(i),_=this.getCellsFromArgs(p),f=m.length;if(f>_.length){var b=p.indexOf(":"),C=i.indexOf(":"),S=this.rowIndex(i.substr(0,C)),x=this.colIndex(i.substr(0,C)),v=this.rowIndex(i.substr(C+1)),w=this.colIndex(i.substr(C+1));if(b>-1){var I=this.rowIndex(p.substr(0,b)),y=this.colIndex(p.substr(0,b)),T=this.rowIndex(p.substr(b+1)),L=this.colIndex(p.substr(b+1));I!=T?T+=f-_.length:y!=L&&(L+=f-_.length),I==S&&T==v?L+=w-x:y==x&&L==w?T+=v-S:I==S&&T<=v&&y==L?(T=v,L+=w-x):(T=v,L+=w-x-(L-y)),p=p.substr(0,b+1)+RangeInfo.getAlphaLabel(L)+T.toString()}else{var R=0,O=0;string.Empty;R=this.RowIndex(p),O=this.ColIndex(p),R+=v-S,O+=w-x,p=p+":"+RangeInfo.GetAlphaLabel(O)+R}_=this.getCellsFromArgs(p)}switch(o=0,l){case this.token_equal:for(h=0;h<f;++h)d=this.getValueFromArg(m[h]),a=this._parseDouble(d),d.split(this.tic).join("")!=r&&(isNaN(a)||a!=g)||(d=_[h],d=this.getValueFromArg(d.split(this.tic).join("")),a=this._parseDouble(d.split(this.tic).join("").split("$").join("")),isNaN(a)||(o+=a));break;case this.token_noequal:for(h=0;h<f;++h)d=this.getValueFromArg(m[h]),a=this._parseDouble(d),d.split(this.tic).join("")==r&&(isNaN(a)||a==g)||(d=_[h],d=this.getValueFromArg(d.split(this.tic).join("")),a=this._parseDouble(d.split(this.tic).join("").split("$").join("")),isNaN(a)||(o+=a));break;case this.token_greatereq:for(h=0;h<f;++h)d=this.getValueFromArg(m[h]),a=this._parseDouble(d.split(this.tic).join("").split("$").join("")),(d.localeCompare(r)>=0||!isNaN(a)&&a>=g)&&(d=_[h],d=this.getValueFromArg(d),a=this._parseDouble(d),isNaN(a)||(o+=a));break;case this.token_greater:for(h=0;h<f;++h)d=this.getValueFromArg(m[h]),a=this._parseDouble(d.split(this.tic).join("").split("$").join("")),(d.localeCompare(r)>0||!isNaN(a)&&a>g)&&(d=_[h],d=this.getValueFromArg(d),a=this._parseDouble(d),isNaN(a)||(o+=a));break;case this.token_less:for(h=0;h<f;++h)d=this.getValueFromArg(m[h]),a=this._parseDouble(d.split(this.tic).join("").split("$").join("")),(d.localeCompare(r)<0||!isNaN(a)&&a<g)&&(d=_[h],d=this.getValueFromArg(d),a=this._parseDouble(d),isNaN(a)||(o+=a));break;case this.token_lesseq:for(h=0;h<f;++h)d=this.getValueFromArg(m[h]),a=this._parseDouble(d.split(this.tic).join("").split("$").join("")),(d.localeCompare(r)<=0||!isNaN(a)&&a<=g)&&(d=_[h],d=this.getValueFromArg(d),a=this._parseDouble(d),isNaN(a)||(o+=a))}return o.toString()},this.computeTan=function(e){return this._computeMath(e,Math.tan).toString()},this.computeTrunc=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length,o=0;if(s>2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(2==s&&(o="TRUE"==(o=this.getValueFromArg(n[1])).split(this.tic).join("")?"1":"FALSE"==o.split(this.tic).join("")?"0":o,o=this._parseDouble(o)),i="TRUE"==(i=this.getValueFromArg(n[0])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r=this._parseDouble(i.split(this.tic).join("")),isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return i[0]==this.tic||this._isCellReference(n[0])?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}return l=Math.pow(10,o),((r<0?-1:1)*Math.floor(l*Math.abs(r))/l).toString()},this.computeLognormOdist=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(4!=a||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,s=0;s<a;++s)o[s]=this.getValueFromArg(o[s]).split(this.tic).join(this._string_empty),o[s]="TRUE"==o[s].split(this.tic).join("").toUpperCase()?"1":"FALSE"==o[s].split(this.tic).join("").toUpperCase()?"0":o[s];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),l=this._parseDouble(o[2]),isNaN(i)||isNaN(r)||isNaN(l)){if(this._rethrowLibraryComputationExceptions)throw"#Value! Passsed value is non - numeric";return this.getErrorStrings()[1].toString()}if(i<=0||l<=0){if(this._rethrowLibraryComputationExceptions)throw"#Num! Passsed value is incorrect";return this.getErrorStrings()[4].toString()}return"0"==o[3]?(0,0,n=Math.exp(-Math.pow(Math.log(i)-r,2)/(2*Math.pow(l,2))),n/=i*l*Math.sqrt(2*Math.PI)):n=this._standardNormalCumulativeDistribution((Math.log(i)-r)/l),n.toString()},this.computeLognormOinv=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(3!=a||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,s=0;s<a;++s)o[s]=this.getValueFromArg(o[s]),o[s]=null==o[s]||""==o[s]?"0":o[s],o[s]="TRUE"==o[s].split(this.tic).join("")?"1":"FALSE"==o[s].split(this.tic).join("")?"0":o[s];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),l=this._parseDouble(o[2]),!isNaN(i)&&!isNaN(r)&&!isNaN(l)){if(i<=0||i>=1||l<=0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}n=Math.exp(this._normalinv(i,r,l))}return n.toString()},this.computeNormOinv=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(3!=a||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,s=0;s<a;++s)o[s]=this.getValueFromArg(o[s]).split(this.tic).join(this._string_empty),o[s]=null==o[s]||""==o[s]?"0":o[s],o[s]="TRUE"==o[s].split(this.tic).join("")?"1":"FALSE"==o[s].split(this.tic).join("")?"0":o[s];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),l=this._parseDouble(o[2]),!isNaN(i)&&!isNaN(r)&&!isNaN(l)){if(i>=0&&i<=0||l<=0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments]+this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}n=this._normalCumulativeDistributionFunctionInverse(i,r,l)}return n<=0?this.formulaErrorStrings[this._iterations_dont_converge]:n.toString()},this.computeNormOdist=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a.length;if(4!=d||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,s=0,o=0;o<d;++o)a[o]=this.getValueFromArg(a[o]),a[o]=null==a[o]||""==a[o]?"0":a[o],a[o]="TRUE"==a[o].split(this.tic).join("").toUpperCase()?"1":"FALSE"==a[o].split(this.tic).join("").toUpperCase()?"0":a[o];if(i=this._parseDouble(a[0]),r=this._parseDouble(a[1]),l=this._parseDouble(a[2]),!isNaN(i)&&!isNaN(r)&&!isNaN(l)){if(l<=0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}3!=d&&(n=this._parseDouble(a[3])),s=0==n?this._normalProbabilityDensity(i,r,l):this._normaldist(i,r,l)}return s.toString()},this.computeNormOsODist=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(1!=s&&2!=s){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(i=0,0,r=0;r<s;++r)n[r]=this.getValueFromArg(n[r]).split(this.tic).join(this._string_empty);if(t=this._parseDouble(n[0]),isNaN(t)){if(this._rethrowLibraryComputationExceptions)throw"#VALUE! Passed argument value is non numeric";return this.getErrorStrings()[1].toString()}return 2==s&&(i=n[1]==this.trueValueStr?1:0,l=0,l=this._parseDouble(n[1]),isNaN(l)||(i=1)),(0==i?this._standardNormalProbabilityDensityFunction(t):this._standardNormalCumulativeDistributionFunction(t)).toString()},this.computeNormOsOInv=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e),l=r.length;if(1!=l){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(0,i=0;i<l;++i)r[i]=this.getValueFromArg(r[i]).split(this.tic).join(this._string_empty);if(t=this._parseDouble(r[0]),isNaN(t)){if(this._rethrowLibraryComputationExceptions)throw"#VALUE! Passed argument value is non numeric";return this.getErrorStrings()[1].toString()}if(t<=0||t>=1){if(this._rethrowLibraryComputationExceptions)throw"#NUM! Passed argument value doesnot match with in range level";return this.getErrorStrings()[4].toString()}return this._standardNormalCumulativeDistributionFunctionInverse(t).toString()},this.computePermut=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(2!=n.length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(0,n[0]=this.getValueFromArg(n[0]),n[0]=""==n[0]||null==n[0]?"0":n[0],n[0]="TRUE"==n[0].split(this.tic).join("")?"1":"FALSE"==n[0].split(this.tic).join("")?"0":n[0],n[1]=this.getValueFromArg(n[1]),n[1]=""==n[1]||null==n[1]?"0":n[1],n[1]="TRUE"==n[1].split(this.tic).join("")?"1":"FALSE"==n[1].split(this.tic).join("")?"0":n[1],i=this._parseDouble(this.getValueFromArg(n[0])),r=this._parseDouble(this.getValueFromArg(n[1])),isNaN(i)||isNaN(r))return this.formulaErrorStrings[this._invalid_arguments];var s=parseInt(r+.1),o=parseInt(i+.1),a=1;for(l=o-s+1;l<=o;++l)a*=l;return a.toString()},this.computePermutationA=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(2!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(0,l[0]=this.getValueFromArg(l[0]),l[0]=""==l[0]||null==l[0]?"0":l[0],l[0]="TRUE"==l[0].split(this.tic).join("")?"1":"FALSE"==l[0].split(this.tic).join("")?"0":l[0],l[1]=this.getValueFromArg(l[1]),l[1]=""==l[1]||null==l[1]?"0":l[1],l[1]="TRUE"==l[1].split(this.tic).join("")?"1":"FALSE"==l[1].split(this.tic).join("")?"0":l[1],i=this._parseDouble(l[0]),r=this._parseDouble(l[1]),isNaN(i)||isNaN(r)?this.formulaErrorStrings[this._invalid_arguments]:(r+.1,i+.1,Math.pow(i,r).toString()))},this.computeStandardize=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(3!=a||""==e)return this.formulaErrorStrings[this._wrong_number_arguments];if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(0,n=0,s=0;s<a;++s)o[s]=this.getValueFromArg(o[s]),o[s]=""==o[s]||null==o[s]?"0":o[s],o[s]="TRUE"==o[s].split(this.tic).join("")?"1":"FALSE"==o[s].split(this.tic).join("")?"0":o[s];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),l=this._parseDouble(o[2]),!isNaN(i)&&!isNaN(r)&&!isNaN(l)){if(l<=0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}n=(i-r)/l}return n.toString()},this.computeBinomOdist=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(4!=o||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(0,0,n=0;n<o;++n)s[n]=this.getValueFromArg(s[n]).split(this.tic).join(this._string_empty),s[n]=null==s[n]||""==s[n]?"0":s[n],s[n]=this._stripTics0(s[n]),s[n]="TRUE"==s[n].split(this.tic).join("")?"1":"FALSE"==s[n].split(this.tic).join("")?"0":s[n];if(i=this._parseDouble(s[0]),r=this._parseDouble(s[1]),l=this._parseDouble(s[2]),isNaN(i)||isNaN(r)||isNaN(l)){if(this._rethrowLibraryComputationExceptions)throw"#VALUE! Passed value is nonnumeric";return this.getErrorStrings()[1].toString()}if(i<0||i>r||l<0||l>1){if(this._rethrowLibraryComputationExceptions)throw"#NAME! Passed argument value is not equal to minimum par value";return this.getErrorStrings()[4].toString()}return(0==this._parseDouble(s[3])?this._comb(i,r)*Math.pow(l,i)*Math.pow(1-l,r-i):this._binomdist(r,i,l)).toString()},this.computeChisqOinvOrt=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(2!=o||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(l=0,n=0;n<o;++n)s[n]=this.getValueFromArg(s[n]),s[n]=null==s[n]||""==s[n]?"0":s[n],s[n]="TRUE"==s[n].split(this.tic).join("")?"1":"FALSE"==s[n].split(this.tic).join("")?"0":s[n];if(i=this._parseDouble(s[0]),r=this._parseDouble(s[1]),!isNaN(i)&&!isNaN(r)){if(i<=0||i>1||r<1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}if(1==i)return"0";l=this._chiinv(i,r)}return l.toString()},this.computeChisqOdistOrt=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(2!=o||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(l=0,n=0;n<o;++n)s[n]=this.getValueFromArg(s[n]),s[n]=null==s[n]||""==s[n]?"0":s[n],s[n]="TRUE"==s[n].split(this.tic).join("")?"1":"FALSE"==s[n].split(this.tic).join("")?"0":s[n];if(i=this._parseDouble(s[0]),r=this._parseDouble(s[1]),!isNaN(i)&&!isNaN(r)){if(i<0||r<1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}if(0==i)return r.toString();for(1==r&&this._excelLikeComputations,l=1-this._chidist(i,r),n=0;n<l.toString().length;n++);Math.round(l)}return l.toString()},this.computeFOdist=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e),l=r.length;if(4!=l||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;var n,s,o,a=0;for(i=0;i<l;++i)r[i]=this.getValueFromArg(r[i]).split(this.tic).join(this._string_empty),r[i]="TRUE"==r[i].split(this.tic).join("")?"1":"FALSE"==r[i].split(this.tic).join("")?"0":r[i];if(n=this._parseDouble(r[0]),s=this._parseDouble(r[1]),o=this._parseDouble(r[2]),isNaN(n)||isNaN(s)||isNaN(o)){if(this._rethrowLibraryComputationExceptions)throw"#VALUE! Passed argument value is incorrect";return this.getErrorStrings()[1].toString()}if(s<1||o<1||"-"==n[0]){if(this._rethrowLibraryComputationExceptions)throw"#NUM! Passed argument value is incorrect";return this.getErrorStrings()[4].toString()}return 1==r[3]?a=this._fCumulativeDensity(n,s,o):0==r[3]&&(a=this._fProbabilityDensity(n,s,o)),a.toString()},this.computeGammaln=function(e){var t,i;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,i=0,i=this._parseDouble(e),isNaN(i)||!(i>1)){if(1==i)return"0";if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}return(i=this._gammaln(i)).toString()},this.computeConfidenceOnorm=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(3!=a||""==e){if(this._rethrowLibraryComputationExceptions)throw"Wrong number of arguments";return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,s=0;s<a;++s)o[s]=this.getValueFromArg(o[s]).split(this.tic).join(this._string_empty),o[s]=null==o[s]||""==o[s]?"0":o[s],o[s]="TRUE"==o[s].split(this.tic).join("")?"1":"FALSE"==o[s].split(this.tic).join("")?"0":o[s];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),l=this._parseDouble(o[2]),!isNaN(i)&&!isNaN(r)&&!isNaN(l)){if(i<=0||i>=1||r<=0||l<1){if(this._rethrowLibraryComputationExceptions)throw"Passed argument value is different from minimum par";return this.getErrorStrings()[4].toString()}n=(n=this._excelLikeComputations?this._normalinv(1-i+i/2,0,1):this._newnormalinv(1-i+i/2))*r/Math.sqrt(l)}return n.toString()},this.computeExponOdist=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(3!=a||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(l=0,0,n=0;n<a;++n)o[n]=this.getValueFromArg(o[n]),o[n]=null==o[n]||null==o[n]?"0":o[n],o[n]="TRUE"==o[n].split(this.tic).join("")?"1":"FALSE"==o[n].split(this.tic).join("")?"0":o[n];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),isNaN(i)||isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw"Passed argument value is non-numerical";return this.getErrorStrings()[1].toString()}if(i<0||r<=0){if(this._rethrowLibraryComputationExceptions)throw"Passed argument value is below or equal to 0";return this.getErrorStrings()[4].toString()}return l=o[2]==this.trueValueStr?1:0,s=this._parseDouble(o[2]),isNaN(s)||(l=0),(0==l?r*Math.exp(-r*i):1-Math.exp(-r*i)).toString()},this.computeFisher=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(0,r="TRUE"==(r=this.getValueFromArg(l[0])).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,i=this._parseDouble(r),!(!isNaN(i)&&i>-1&&i<1)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}return(.5*Math.log((1+i)/(1-i))).toString()},this.computeFisherInv=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(1!=s.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(r=0,l="TRUE"==(l=this.getValueFromArg(s[0])).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,i=this._parseDouble(l),isNaN(i)||(r=((n=Math.exp(2*i))-1)/(n+1)),r.toString())},this.computeGammalnOPrecise=function(e){var t,i;if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,i=0,i=this._parseDouble(e.toString()),!isNaN(i)&&i>1)i=this._gammaln(i);else{if(1==i)return"0";if(i<=0){if(this._rethrowLibraryComputationExceptions)throw"Passed Argument value is less than or equal to minimum value 0";return this.getErrorStrings()[4].toString()}}return i.toString()},this.computeLarge=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(2!=n.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(t=this.formulaErrorStringCheck(n[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)return t;if(n[0][0]==this.tic)return this.getErrorStrings()[4].toString();if(i=this.formulaErrorStringCheck(n[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)return i}if(l="TRUE"==(l=this.getValueFromArg(n[1])).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,r=this._parseDouble(l),isNaN(r))return this.formulaErrorStrings[this._invalid_arguments];var s=r,o=this._getDoubleArray(n[0]),a=o.length;return s<1||s>a?this.formulaErrorStrings[this._invalid_arguments]:(o.sort(function(e,t){return isNaN(e)||isNaN(t)?e>t?1:-1:e-t}),o[a-s].toString())},this.computeSmall=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(2!=n.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(t=this.formulaErrorStringCheck(n[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)return t;if(i=this.formulaErrorStringCheck(n[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)return i}if(r="TRUE"==(r=this.getValueFromArg(n[1])).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,l=this._parseDouble(r),isNaN(l))return this.formulaErrorStrings[this._invalid_arguments];var s=l,o=this._getDoubleArray(n[0]),a=o.length;return s<1||s>o.length?this.formulaErrorStrings[this._invalid_arguments]:(o.sort(function(e,t){return isNaN(e)||isNaN(t)?e<t?1:-1:t-e}),o[a-s].toString())},this.computeCounta=function(e){var t,i,r,l,n,s,o,a=0,d=this.splitArgsPreservingQuotedCommas(e);if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(r=0;r<d.length;r++)if((i=d[r]).indexOf(":")>-1)for(l=this.getCellsFromArgs(i),n=0;n<l.length;n++){try{t=this.getValueFromArg(l[n]).split(this.tic).join(this._string_empty)}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}t.length>0&&a++}else if(""==i)a++;else if(this._isLetter(i[0]))(t=this.getValueFromArg(i)).length>0&&a++;else if(i.indexOf(this.getParseArgumentSeparator())>-1)for(s=this.splitArgsPreservingQuotedCommas(i.split(this.tic).join("")),o=0;o<s.length;o++){if(o[0]!=this.tic&&this._isCellReference(s[o])){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this.invalid_arguments];return this.formulaErrorStrings[this.invalid_arguments]}(o.length>0||""==o)&&a++}else r.length>0&&a++;return a.toString()},this.computeAverage=function(e){var t,i,r,l,n,s,o,a=0,d=0,h=[],c=this.splitArgsPreservingQuotedCommas(e);if(c.length<1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(r)>-1))return r;for(l=0;l<c.length;l++)if((h=c[l]).indexOf(":")>-1)for(n=this.getCellsFromArgs(h),s=0;s<n.length;s++){try{i="TRUE"==(i=this.getValueFromArg(n[s]).split(this.tic).join("")).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i}catch(e){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(i.length>0&&!isNaN(i)){if(t=this._parseDouble(i),isNaN(t)){if(-1==this.getErrorStrings().indexOf(i))return i;if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[5].toString();return this.getErrorStrings()[5].toString()}a=Number(a)+Number(t),d++}}else{try{i="TRUE"==(i=this.getValueFromArg(h).split(this.tic).join(this._string_empty)).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,o="TRUE"==(o=this.getValueFromArg(h)).split(this.tic).join("")?"1":"FALSE"==o.split(this.tic).join("")?"0":o}catch(e){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(i.length>0){if(t=this._parseDouble(i),isNaN(t)){if(o[0]==this.tic){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[5].toString();return this.getErrorStrings()[5].toString()}a=Number(a)+Number(t),d++}}return d>0&&(a=Number(a)/Number(d)),a.toString()},this.computeAverageA=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e);if(a.length<1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this._string_empty,0,a==this.trueValueStr||a==this.falseValueStr)return+(a==this.trueValueStr);for(r=0;r<a.length;r++)if(a[r].indexOf(this.getParseArgumentSeparator().toString())>-1)for(l=this.splitArgsPreservingQuotedCommas(a[r].split(this.tic).join(this._string_empty)),n=0,s=0;s<l.length;s++)i=i+(o=l[s])+this.getParseArgumentSeparator().toString(),a[n]=o;else this._isCellReference(a[r])?i+=a[r]+this.getParseArgumentSeparator().toString():i=this._parseDouble(a[r],0)?i+a[r]+this.getParseArgumentSeparator().toString():i+"0"+this.getParseArgumentSeparator().toString();return","==i[i.length-1]&&(i=i.substring(0,i.length-1)),this.computeAverage(i)},this.computeMax=function(e){var t,i,r,l,n,s,o,a=this.minValue;if(this.adjustRangeArg(e),""==(l=this.splitArgsPreservingQuotedCommas(e))){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(n=0;n<l.length;n++)if((r=l[n]).indexOf(":")>-1)for(s=this.getCellsFromArgs(r),o=0;o<s.length;o++){try{i=this.getValueFromArg(s[o]).split(this.tic).join(this._string_empty)}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(i.length>0)if(t=this._parseDouble(i),isNaN(t)){if(-1!=this.getErrorStrings().indexOf(i))return i}else a=Math.max(a,t)}else{try{if(!this._isCellReference(r)&&r[0]==this.tic){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}i="TRUE"==(i=r==this._string_empty?"0":this.getValueFromArg(r)).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(i.length>0)if(t=this._parseDouble(i),isNaN(t)){if(-1!=this.getErrorStrings().indexOf(i))return i}else a=Math.max(a,t)}return a!=this.minValue?a.toString():this._string_empty},this.computeMaxa=function(e){var t,i,r,l,n,s,o,a=this.minValue;if(this.adjustRangeArg(e),r=this.splitArgsPreservingQuotedCommas(e),""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(l)>-1))return l;for(n=0;n<r.length;n++)if(r[n].indexOf(":")>-1)for(s=this.getCellsFromArgs(r[n]),o=0;o<s.length;o++){try{i="TRUE"==(i=this.getValueFromArg(s[o])).split(this.tic).join("").toUpperCase()?"1":"FALSE"==i.split(this.tic).join("").toUpperCase()?"0":i}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException()}if(i.length>0){if(t=0,i.toUpperCase()==this.trueValueStr)t=1;else{if(this.getErrorStrings().indexOf(i)>-1)return i;t=this._parseDouble(i)}a=Math.max(a,t)}}else{try{if(r[n].startsWith(this.tic)||""!=r[n]){if(i="TRUE"==(i=this.getValueFromArg(r[n])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,this.getErrorStrings().indexOf(i)>-1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return i}""==i&&(i="0")}else i="0"}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException()}if(i.length>0){if(t=0,i.toUpperCase()==this.trueValueStr)t=1;else{if(this.getErrorStrings().indexOf(i)>-1)return i;t=this._parseDouble(i)}a=Math.max(a,t)}}return a!=this.minValue?a.toString():this._string_empty},this.computeMedian=function(e){var t,i,r;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1)?t:((i=this._getDoubleArray(e)).sort(function(e,t){return isNaN(e)||isNaN(t)?e>t?1:-1:e-t}),r=parseInt((i.length/2).toString()),"",i.length%2==1?i[r].toString():((i[r]+i[r-1])/2).toString())},this.computeMin=function(e){var t,i,r,l,n,s,o,a,d,h=this.maxValue;if(this.adjustRangeArg(e),r=this.splitArgsPreservingQuotedCommas(e),""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if((l=e.split(";")).length>1){for(o=0;o<l.length;o++)for(n=this.splitArgsPreservingQuotedCommas(l[o]),d=0;d<n.length;d++)if((s="TRUE"==(s=this.getValueFromArg(n[d])).split(this.tic).join("")?"1":"FALSE"==s.split(this.tic).join("")?"0":s).length>0)if(t=this._parseDouble(s),isNaN(t)){if(-1==this.getErrorStrings().indexOf(s))return s}else h=Math.min(h,t);if(h!=this.maxValue)return h.toString()}for(o=0;o<r.length;o++)if(r[o].indexOf(":")>-1)for(a=this.getCellsFromArgs(r[o]),d=0;d<a.length;d++){try{i=this.getValueFromArg(a[d])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(i.length>0)if(t=this._parseDouble(i),isNaN(t)){if(-1!=this.getErrorStrings().indexOf(i))return i}else h=Math.min(h,t)}else{try{if(!this._isCellReference(r[o])&&r[o][0]==this.tic){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}""==(i="TRUE"==(i=r[o]==this._string_empty?"0":this.getValueFromArg(r[o])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i)&&this._isCellReference(r[o])&&(i="0")}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(i.length>0)if(t=this._parseDouble(i),isNaN(t)){if(-1!=this.getErrorStrings().indexOf(i))return i}else h=Math.min(h,t)}return h!=this.maxValue?h.toString():this._string_empty},this.computeMina=function(e){var t,i,r,l,n,s,o,a,d,h,c=this.maxValue;if(this.adjustRangeArg(e),r=this.splitArgsPreservingQuotedCommas(e),l=e.split(";"),""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(n=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(n)>-1))return n;if(l.length>1){for(a=0;a<l.length;a++)for(s=this.splitArgsPreservingQuotedCommas(l[a]),h=0;h<s.length;h++)if((o=this.getValueFromArg(s[h])).length>0){if(t=0,o.toUpperCase()==this.trueValueStr)t=1;else{if(-1==this.getErrorStrings().indexOf(o))return o;o="TRUE"==o.split(this.tic).join("")?"1":"FALSE"==o.split(this.tic).join("")?"0":o,t=this._parseDouble(o)}c=Math.min(c,t)}if(c!=this.maxValue)return c.toString()}for(a=0;a<r.length;a++)if(r[a].indexOf(":")>-1)for(d=this.getCellsFromArgs(r[a]),h=0;h<d.length;h++){try{i="TRUE"==(i=this.getValueFromArg(d[h])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(i.length>0){if(t=0,i.toUpperCase()==this.trueValueStr)t=1;else if(i.toUpperCase()==this.falseValueStr)t=0;else{if(-1!=this.getErrorStrings().indexOf(i))return i;t=this._parseDouble(i)}c=Math.min(c,t)}}else{try{r[a].startsWith(this.tic)||""!=r[a]?""==(i="TRUE"==(i=this.getValueFromArg(r[a])).split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i)&&(i="0"):i="0"}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(i.length>0){if(t=0,i.toUpperCase()==this.trueValueStr)t=1;else{if(this.getErrorStrings().indexOf(i)>-1)return i;t=this._parseDouble(i)}c=Math.min(c,t)}}return c!=this.maxValue?c.toString():this._string_empty},this.computePercentrankInc=function(e){var t,i,r,l,n,s,o,a,d,h,c=this.splitArgsPreservingQuotedCommas(e),u=c.length;if(2!=u&&3!=u||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(""!=c[0]&&""==c[1]||""!=c[1]&&""==c[0]){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[0].toString();return this.getErrorStrings()[0].toString()}if(this.getEnableFormulaErrorValidation()){if(t=this.formulaErrorStringCheck(c[0],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)return t;for(a=1;a<u;a++)if(t=this.formulaErrorStringCheck(c[a],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t}if(r=3,""==(l=this.getValueFromArg(c[1]))&&(l="0"),i=this._parseDouble(l),isNaN(i)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.formulaErrorStrings[this._invalid_arguments]}if(3==u&&(c[2]="TRUE"==c[2].split(this.tic).join("")?"1":"FALSE"==c[2].split(this.tic).join("")?"0":c[2],l=this.getValueFromArg(c[2]),r=this._parseDouble(l),isNaN(r)||r<1)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}for(s=(n=this._getDoubleArray(c[0])).length,n.sort(),o=1,a=0;a<s;++a)if(n[a]==i){for(d=0;d+a<s&&n[d+a]==i;)d++;o=(a-1)/(a+s-a-d-1),a>0&&n[a-1]<i&&(o=(h=a/(s-1))+(o-h)*(1-(i-n[a-1])/(n[a]-n[a-1])));break}return"0."+parseInt(r.toString()),o.toString()},this.computeRankOEq=function(e){var t,i,r,l,n,s,o,a,d=this.splitArgsPreservingQuotedCommas(e),h=d.length;if(2!=h&&3!=h||""==e)return this.formulaErrorStrings[this._wrong_number_arguments];if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(d[0],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(d[1],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)))return t;if(i=0,l=this.getValueFromArg(d[0]),d[0]==this._string_empty||d[1]==this._string_empty||!this._isCellReference(d[1]))return this.getErrorStrings()[4].toString();if(r=this._parseDouble(l),!isNaN(r)){if(n=0,3==h){if(this.getEnableFormulaErrorValidation()&&(s=this.formulaErrorStringCheck(d[2],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(s)>-1))return s;(l="TRUE"==(l=this.getValueFromArg(d[2])).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l)==this._string_empty?l="0":this._parseDouble(l)>1&&(l="1"),n=this._parseDouble(l)}var c=d[1],u=0,g=!1;if(-1==c.indexOf(":"))return this.getErrorStrings()[4].toString();if(c.indexOf(":")>-1){for(o=this.getCellsFromArgs(c),a=0;a<o.length;a++){try{l=this._getDoubleArray(o[a])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}u=this._parseDouble(l.toString()),isNaN(u)||(1==n?u<r?i+=1:u==r&&(g=!0):u>r?i+=1:u==r&&(g=!0))}g&&(i+=1)}}return i.toString()},this.computePercentile=function(e){var t,i,r,l,n,s,o,a,d=this.splitArgsPreservingQuotedCommas(e);if(2!=d.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(d[0],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(d[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)))return t;if(r=this.getValueFromArg(d[1]),i=this._parseDouble(r),isNaN(i)&&(i<0||i>1))return this.formulaErrorStrings[this._invalid_arguments];for(n=(l=this._getDoubleArray(d[0])).length,l.sort(function(e,t){return isNaN(e)||isNaN(t)?e<t?1:-1:e-t}),s=1/(n-1),o=l[n-1],a=0;a<n-1;++a)if((a+1)*s>i){i=(i-a*s)/s,o=l[a]+i*(l[a+1]-l[a]);break}return o.toString()},this.computePoissonODist=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a.length;if(3!=d)return this.formulaErrorStrings[this._wrong_number_arguments];for(0,r=0,o=0;o<d;++o)a[o]=this.getValueFromArg(a[o]);if(t=this._parseDouble(a[0]),i=this._parseDouble(a[1]),!isNaN(t)&&!isNaN(i))if(l=t,0==(a[2]==this.trueValueStr?1:0)){for(n=1,o=2;o<=l;++o)n*=o;r=Math.exp(-i)*Math.pow(i,l)/n}else{for(n=1,r=0,s=1,o=0;o<=l;++o)r+=s/n,n*=o+1,s*=i;r=Math.exp(-i)*r}return r.toString()},this.computeWeiBullODist=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e),d=a.length;if(4!=d||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,!0,s=0;s<d;++s)a[s]=this.getValueFromArg(a[s]).split(this.tic).join(this._string_empty);if(i=this._parseDouble(a[0]),r=this._parseDouble(a[1]),l=this._parseDouble(a[2]),isNaN(i)||isNaN(r)||isNaN(l)){if(this._rethrowLibraryComputationExceptions)throw"Passed argument value is non-numerical";return this.getErrorStrings()[1].toString()}if(i<0||r<=0||l<=0){if(this._rethrowLibraryComputationExceptions)throw"Passed argument value is below 0";return this.getErrorStrings()[4].toString()}if(r.toString().length>=5&&l.toString().length>=3){if(this._rethrowLibraryComputationExceptions)throw"Passed argument length exceeded the minimum length";return this.getErrorStrings()[4].toString()}return 3!=d&&(n=a[3]==this.trueValueStr?1:0,o=0,o=this._parseDouble(a[3]),isNaN(o)||(n=1)),(n=1==n?1-Math.exp(-Math.pow(i/l,r)):Math.pow(i,r-1)*Math.exp(-Math.pow(i/l,r))*r/Math.pow(l,r)).toString()},this.computeFOinvOrt=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(3!=a){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,s=0;s<a;++s)o[s]=this.getValueFromArg(o[s]),o[s]=null==o[s]||""==o[s]?"0":o[s],o[s]="TRUE"==o[s].split(this.tic).join("")?"1":"FALSE"==o[s].split(this.tic).join("")?"0":o[s];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),l=this._parseDouble(o[2]),!isNaN(i)&&i>0&&i<1&&!isNaN(r)&&!isNaN(l)){if((i<0||i>1||r<1||l<1)&&this.getRethrowLibraryComputationExceptions())throw"#NUM! Passed Argument value is less than or equal to minimum value";n=this._finv(i,r,l)}if(n<=0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.getErrorStrings()[4].toString()}return n.toString()},this.computeTOdist=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(3!=o||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(0,l=0,n=0;n<o;++n)s[n]=this.getValueFromArg(s[n]).split(this.tic).join(this._string_empty);if(s[0]=null==s[0]||""==s[0]?"0":s[0],s[0]="TRUE"==s[0].split(this.tic).join("")?"1":"FALSE"==s[0].split(this.tic).join("")?"0":s[0],s[1]=null==s[1]||""==s[1]?"0":s[1],s[1]="TRUE"==s[1].split(this.tic).join("")?"1":"FALSE"==s[1].split(this.tic).join("")?"0":s[1],i=this._parseDouble(s[0]),r=this._parseDouble(s[1]),isNaN(i)||isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw"#VALUE! Passed argument value is incorrect";return this.getErrorStrings()[1].toString()}if(r<1||"-"==i[0]){if(this._rethrowLibraryComputationExceptions)throw"#NUM! Passed argument value is incorrect";return this.getErrorStrings()[4].toString()}return s[2]==this.trueValueStr?l=this._tCumulativeDensity(i,r):s[2]==this.falseValueStr&&(l=this._tProbabilityDensity(i,r)),l.toString()},this.computeAvedev=function(e){var t,i,r,l,n,s,o,a,d,h,c=0,u=[];if(r=this.splitArgsPreservingQuotedCommas(e),""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(n=0;n<r.length;n++)if((l=r[n]).indexOf(":")>-1)for(s=this.getCellsFromArgs(l),o=0;o<s.length;o++){try{t="TRUE"==(t=this.getValueFromArg(s[o]).split(this.tic).join(this._string_empty)).split(this.tic).join("")?"1":"FALSE"==t.split(this.tic).join("")?"0":t}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(t.length>0)if(i=this._parseDouble(t),isNaN(i)){if(this.getErrorStrings().indexOf(t)>0)return t}else c+=i,u.push(i)}else{try{if(t="TRUE"==(t=this.getValueFromArg(l).split(this.tic).join(this._string_empty)).split(this.tic).join("")?"1":"FALSE"==t.split(this.tic).join("")?"0":t,this.getEnableFormulaErrorValidation()&&(a=this.formulaErrorStringCheck(t,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(a)>-1))return a}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(t.length>0)if(i=this._parseDouble(t),isNaN(i)){if(-1==this.getErrorStrings().indexOf(t))return t}else c+=i,u.push(i)}if(u.length>0){for(d=c/u.length,c=0,h=0;h<u.length;++h)c+=Math.abs(u[h]-d);c/=u.length}return c.toString()},this.computeTOinv=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(2!=s||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(0,0,l=0;l<s;++l)n[l]=this.getValueFromArg(n[l]).split(this.tic).join(this._string_empty);if(n[0]=""==n[0]||null==n[0]?"0":n[0],n[0]="TRUE"==n[0].split(this.tic).join("")?"1":"FALSE"==n[0].split(this.tic).join("")?"0":n[0],n[1]=""==n[1]||null==n[1]?"0":n[1],n[1]="TRUE"==n[1].split(this.tic).join("")?"1":"FALSE"==n[1].split(this.tic).join("")?"0":n[1],i=this._parseDouble(n[0]),r=this._parseDouble(n[1]),isNaN(i)||isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw"#VALUE! Passed argument value is incorrect";return this.getErrorStrings()[1].toString()}if(r<1||i<0||"-"==i[0]){if(this._rethrowLibraryComputationExceptions)throw"#NUM! Passed argument value is incorrect";return this.getErrorStrings()[4].toString()}return this._tCumulativeDistributionInverse(i,r).toString()},this.computeChisqOinv=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(2!=s||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(0,l=0;l<s;++l)n[l]=this.getValueFromArg(n[l]),n[l]=null==n[l]||""==n[l]?"0":n[l],n[l]="TRUE"==n[l].split(this.tic).join("")?"1":"FALSE"==n[l].split(this.tic).join("")?"0":n[l];if(i=this._parseDouble(n[0]),r=this._parseDouble(n[1]),!isNaN(i)&&!isNaN(r)){if(i<0||i>=1||r<=0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}return 0==i?"0":this._chiinv(i,r).toString()}},this.computeCount=function(e){var t,i,r,l,n,s,o=0,a=new Date;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(r=this.splitArgsPreservingQuotedCommas(e),l=0;l<r.length;l++)if(r[l].indexOf(":")>-1)for(n=this.getCellsFromArgs(r[l].split(this.tic).join("")),s=0;s<n.length;s++){try{t="TRUE"==(t=this.getValueFromArg(n[s])).split(this.tic).join("")?"1":"FALSE"==t.split(this.tic).join("")?"0":t}catch(e){if(this._rethrowLibraryComputationExceptions)throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(t.length>0){if(t==this.formulaErrorStrings[19]){if(null!=this.geLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[19]}i=this._parseDouble(t),a=new Date(Date.parse(t)),isNaN(i)&&"Invalid Date"==a.toString()||-1!=this.getErrorStrings().indexOf(t)||o++}}else{try{r[l]!=this._string_empty||r[l][0]==this.tic||o++,t="TRUE"==(t=this.getValueFromArg(r[l].split(this.tic).join(""))).split(this.tic).join("")?"1":"FALSE"==t.split(this.tic).join("")?"0":t}catch(e){if(null!=this.getLibraryComputationException())throw this.getLibraryComputationException();throw this.getErrorStrings()[4].toString()}if(t.length>0){if(t[0]==this.formulaErrorStrings[19]){if(null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.formulaErrorStrings[19]}i=this._parseDouble(t),a=new Date(Date.parse(t)),isNaN(i)&&"Invalid Date"==a.toString()||-1!=this.getErrorStrings().indexOf(t)||o++}}return o.toString()},this.computeMod=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(this._isArrayFormula&&e.length>2&&(l[1]=l[l.length-1]),2!=l.length||e==this._string_empty&&!this._isArrayFormula){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;i=l[0],r=l[1],i=this.getValueFromArg(i).split(this.tic).join(this._string_empty),r=this.getValueFromArg(r).split(this.tic).join(this._string_empty),i="TRUE"==i?"1":"FALSE"==i||i==this._string_empty?"0":i,r="TRUE"==r?"1":"FALSE"==r||r==this._string_empty?"0":r;var n=parseFloat(i),s=parseFloat(r),o=0;if(!isNaN(n)&&!isNaN(s)){if(o=n-s*Math.floor(n/s),this.computeIsError(o)==this.trueValueStr){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[3].toString()}return o.toString()}},this.computeRadians=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(r.length>1||r==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(0,e="TRUE"==(i=this.getValueFromArg(e).split(this.tic).join(this._string_empty))?"1":"FALSE"==i||i==this._string_empty?"0":i,e=this._parseDouble(e),isNaN(e)?this.formulaErrorStrings[this._invalid_arguments]:(Math.PI*e/180).toString())},this.computeOdd=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(n.length>1||n==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)?t:(e="TRUE"==(e=this.getValueFromArg(e).split(this.tic).join(this._string_empty))?"1":"FALSE"==e||e==this._string_empty?"0":e,i=this._parseDouble(e),r=0,isNaN(i)||(l=0==i?1:i<0?-1:1,i=Math.abs(i),(parseInt(i)!=i||0==i)&&(i=parseInt(i)+1),r=i%2==0?l*(i+1):l*i),r.toString())},this.computeRand=function(e){this.splitArgsPreservingQuotedCommas(e);var t=this.formulaErrorStringCheck(e,FormulaArgumentType.None);return this.formulaErrorStrings[this._invalid_arguments]==t?t:Math.random().toString()},this.computeCountif=function(e){return this.computeCountIFFunctions(e,!0)},this.computeCountIFFunctions=function(e,t){var r,l,n,s,o,a,d,h,c,u=this.splitArgsPreservingQuotedCommas(e),g=u.length,p=0,m=!1,_=[],f=[],b=[],C=[];for(i=0;i<g;i++)_.push(u[i]),i++,f.push(u[i]);if(r=this.formulaErrorStringCheck(u[0],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(r)>-1&&r==this.getErrorStrings()[1]||""==u[0]||!this._isCellReference(u[0]))return this.formulaErrorStrings[this._invalid_arguments];if(this.getErrorStrings().indexOf(r)>-1)return r;if(l=this.getCellsFromArgs(_[0]),g<2&&_.length==f.length&&!t)return this.formulaErrorStrings[this._wrong_number_arguments];if(_.length!=f.length&&this.getErrorStrings()[1].toString(),2!=g&&3!=g&&t){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.FormulaErrorStrings[this._wrong_number_arguments]);return this.formulaErrorStrings[this._wrong_number_arguments]}for(v=0;v<f.length;v++){if(n=this.token_equal,(s=f[v])[0]!=this.tic[0]&&-1=="=><".indexOf(s[0])&&(s=this.getValueFromArg(s)),v!=_.length-1||t||(m=!0),t&&(m=!0),s.length<1&&t)return"0";if(o=s.length>0&&s[0]==this.tic[0]?1:0,a=Number.MIN_VALUE,s.substring(o).startsWith(">=")?(s=s.substr(o+2,s.length-2-2*o),n=this.token_greatereq):s.substring(o).startsWith("<=")?(s=s.substr(o+2,s.length-2-2*o),n=this.token_lesseq):s.substring(o).startsWith("<>")?(s=s.substr(o+2,s.length-2-2*o),n=this.token_noequal):s.substring(o).startsWith("<")?(s=s.substr(o+1,s.length-1-2*o),n=this.token_less):s.substring(o).startsWith(">")?(s=s.substr(o+1,s.length-1-2*o),n=this.token_greater):s.substring(o).startsWith("=")&&(s=s.substr(o+1,s.length-1-2*o)),s=s.split(this.tic).join(this._string_empty),a=this._parseDouble(s),d=!isNaN(a),(h=this.getCellsFromArgs(_[v])).length!=l.length)return this.getErrorStrings()[1].toString();if(h[0]==this.getErrorStrings()[5]){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._bad_index]);return this.getErrorStrings()[5].toString()}var S,x,w=h.length,I=0,y=!1,T=s.indexOf("*"),L=s;for(index=0;index<w;++index){switch(I=(x=this.getValueFromArg(h[index])).replace(this.tic,"").toUpperCase().localeCompare(s.toUpperCase()),n){case this.token_equal:-1!=(T=s.indexOf("*"))&&(s=s.substring(0,T)),-1!=L.indexOf("*")&&""!=x&&(x=x.replace(this.tic,"").substring(0,T)),S=this._parseDouble(x),y=d?!isNaN(S)&&S==a:!(x==this._string_empty)&&x.replace(this.tic,this._string_empty).toUpperCase()==s.toUpperCase(),"=";break;case this.token_noequal:S=this._parseDouble(x),y=d?!isNaN(S)&&S!=a:!(x==this._string_empty)&&x.replace(this.tic,this._string_empty).toUpperCase()!=s.toUpperCase(),"!=";break;case this.token_greatereq:S=this._parseDouble(x),y=d?!isNaN(S)&&S>=a:!(x==this._string_empty)&&I>=0,">=";break;case this.token_greater:S=this._parseDouble(x),y=d?!isNaN(S)&&S>a:!(x==this._string_empty)&&I>0,">";break;case this.token_less:S=this._parseDouble(x),y=d?!isNaN(S)&&S<a:!(x==this._string_empty)&&I<0,"<";break;case this.token_lesseq:S=this._parseDouble(x),y=d?!isNaN(S)&&S<=a:!(x==this._string_empty)&&I<=0,"<="}if(y)if(t&&m||m&&1==f.length)p++;else if(b.length>0&&0!=v)for(c=b.length,i=0;i<c;i++)ej.isNullOrUndefined(b[i])||this.rowIndex(b[i].toString())!=this.rowIndex(h[index])||(C.push(h[index]),m&&p++);else C.push(h[index])}b=C,C=[]}return p.toString()},this.computeRound=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e),l=r.length;if(""==e){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._wrong_number_arguments]);return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;if(1==l)return e="TRUE"==e.split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,this._computeMath(e,Math.round).toString();var n=0,s=0,o=0,a=this.getValueFromArg(r[0]),d=""==r[1]?"0":this.getValueFromArg(r[1]);return a="TRUE"==a.split(this.tic).join("")?"1":"FALSE"==a.split(this.tic).join("")?"0":a,d="TRUE"==d.split(this.tic).join("")?"1":"FALSE"==d.split(this.tic).join("")?"0":d,""!=a&&""!=d&&(n=this._parseDouble(a),s=this._parseDouble(d),!isNaN(s)&&!isNaN(n)&&s>0?o=n.toFixed(s):(i=Math.pow(10,-s),o=Math.round(n/i)*i)),o.toString()},this.computeRoundDown=function(e){var t,i,r,l,n=0,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(""==e){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._wrong_number_arguments]);return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;if(1==o){if(e="TRUE"==e.split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,n=this._parseDouble(this.getValueFromArg(e).split(this.tic).join(this._string_empty)),!isNaN(n))return n-=.4999999999*Math.sign(n),this.computeRound(String.format("{0}",n))}else if(2!=o)return this.formulaErrorStrings[this._invalid_arguments];return i=this.getValueFromArg(s[0]),r=""==s[1]?"0":this.getValueFromArg(s[1]),i="TRUE"==i.split(this.tic).join("")?"1":"FALSE"==i.split(this.tic).join("")?"0":i,r="TRUE"==r.split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,0,""!=i&&(n=this._parseDouble(i.split(this.tic).join(this._string_empty))),l=this._parseDouble(r.split(this.tic).join(this._string_empty)),n!=Number.NaN?(n-=.4999999999*Math.pow(10,-l)*Math.sign(n),this.computeRound(String.format("{0}{1}{2}",n,this._parseArgumentSeparator,l))):this.getErrorStrings()[1].toString()},this.computeRoundUp=function(e){var t,i=0,r=this.splitArgsPreservingQuotedCommas(e),l=r.length;if(""==e){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._wrong_number_arguments]);return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;if(1==l)return e="TRUE"==e.split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,(i=this._parseDouble(this.getValueFromArg(e).split(this.tic).join(this._string_empty)))>0?i+=.4999999999:i<0&&(i-=.4999999999),i=i.toFixed(0),String.format("{0}",i);if(2!=l)return this.formulaErrorStrings[this._invalid_arguments];var n=0,s=this.getValueFromArg(r[0]),o=""==r[1]?"0":this.getValueFromArg(r[1]);return s="TRUE"==s.split(this.tic).join("")?"1":"FALSE"==s.split(this.tic).join("")?"0":s,o="TRUE"==o.split(this.tic).join("")?"1":"FALSE"==o.split(this.tic).join("")?"0":o,""!=s&&(i=this._parseDouble(s.split(this.tic).join(this._string_empty))),n=this._parseDouble(o.split(this.tic).join(this._string_empty)),(n=Math.ceil(n))>0?(i>0?i+=.4999999999/Math.pow(10,n):i<0&&(i-=.4999999999/Math.pow(10,n)),i=i.toFixed(n)):(i>0?i=i/Math.pow(10,-n)+.49999:i<0&&(i=i/Math.pow(10,-n)-.49999),i=i.toFixed(0)*Math.pow(10,-n)),String.format("{0}",i)},this.computeMmult=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e);if(2!=o.length||""==e){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._wrong_number_arguments]);return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)return t;if(0,!(this._isCellReference(o[0])||this._isCellReference(o[1])||isNaN(this._parseDouble(this._stripTics0(o[0])))&&isNaN(this._parseDouble(this._stripTics0(o[0]))))){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._invalid_arguments]);return this.getErrorStrings()[1].toString()}o[0]=this._stripTics0(o[0]),o[1]=this._stripTics0(o[1]);var a,d,h,c,u,g,p,m=this.getCellsFromArgs(o[0]),_=this.getCellsFromArgs(o[1]),f=0;if(c=parseInt(this.computeRows(o[0])),u=parseInt(this.computeColumns(o[0])),g=parseInt(this.computeRows(o[1])),c!=(p=parseInt(this.computeColumns(o[1])))||g!=u){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._invalid_Math_argument]);return this.getErrorStrings()[0].toString()}var b=[],C=[],S=[];for(a=0;a<=c-1;a++)for(b[a]=[],d=0;d<=u-1;d++){if(b[a][d]=this._parseDouble(this.getValueFromArg(m[f])),isNaN(b[a][d]))return this.getErrorStrings()[1].toString();f++}for(f=0,a=0;a<=g-1;a++)for(C[a]=[],d=0;d<=p-1;d++){if(C[a][d]=this._parseDouble(this.getValueFromArg(_[f])),isNaN(C[a][d]))return this.getErrorStrings()[1].toString();f++}for(a=0;a<=c-1;a++)for(S[a]=[],d=0;d<=p-1;d++)for(h=0;h<=g-1;h++)isNaN(S[a][d])&&(S[a][d]=0),S[a][d]+=b[a][h]*C[h][d];return""==this.cell?S[0][0].toString():(i=this.colIndex(this.cell),r=this.rowIndex(this.cell),this._getFormulaArrayBounds(this.cell,c,u),l=this._getFormulaArrayBoundsfirstRowIndex,n=this._getFormulaArrayBoundsfirstColIndex,this._getFormulaArrayBoundslastRowIndex,this._getFormulaArrayBoundslastColIndex,s=i-n,S[r-l][s].toString())},this.computePv=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=l.length;if(5!=n&&4!=n&&3!=n||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;var s,o,a,d=0,h=0,c=0;for(i=0;i<n;++i)l[i]=this.getValueFromArg(l[i]),l[i]=""==l[i]?"0":l[i],l[i]="TRUE"==l[i].split(this.tic).join("")?"1":"FALSE"==l[i].split(this.tic).join("")?"0":l[i],l[i]=l[i].split(this.tic).join("");return s=this._parseDouble(l[0]),o=this._parseDouble(l[1]),a=this._parseDouble(l[2]),0==s?c:(d=4!=n||isNaN(l[3])?0:this._parseDouble(l[3]),h=n<=5&&!isNaN(l[4])?this._parseDouble(l[4]):0,isNaN(s)||isNaN(o)||isNaN(a)||isNaN(d)||isNaN(h)?this.formulaErrorStrings[this._invalid_arguments]:(c=(a*(1+s*(h=Math.abs(h)>.5?1:0))*(1-(r=Math.pow(1+s,o)))-s*d)/(s*r)).toString())},this.computeNormsDist=function(e){var t,i;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1?t:(i=(e="TRUE"==e.split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e)+", 0, 1, "+this.trueValueStr,this.computeNormDist(i))},this.computeNormDist=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=l.length;if(4!=n){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;var s,o,a,d=0,h=0;for(i=0;i<n;++i)l[i]=this.getValueFromArg(l[i]);var c=l[0],u=l[1],g=l[2],p=l[3];if(c=""==c&&this._treatStringsAsZero?"0":c,u=""==u&&this._treatStringsAsZero?"0":u,c="TRUE"==c.split(this.tic).join("")?"1":"FALSE"==c.split(this.tic).join("")?"0":c,u="TRUE"==u.split(this.tic).join("")?"1":"FALSE"==u.split(this.tic).join("")?"0":u,g="TRUE"==g.split(this.tic).join("")?"1":"FALSE"==g.split(this.tic).join("")?"0":g,p="TRUE"==p.split(this.tic).join("")?"1":"FALSE"==p.split(this.tic).join("")?"0":p,""==g||""==p){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[4].toString()}if(s=this._parseDouble(c.split(this.tic).join(this._string_empty)),o=this._parseDouble(u.split(this.tic).join(this._string_empty)),a=this._parseDouble(g.split(this.tic).join(this._string_empty)),!isNaN(s)&&!isNaN(o)&&!isNaN(a)){if(3!=n&&(r=0,r=this._parseDouble(l[3]),d=isNaN(r)?l[3].split(this.tic).join(this._string_empty).toUpperCase()==this.trueValueStr?1:l[3].split(this.tic).join(this._string_empty).toUpperCase()==this.falseValueStr?0:-1:0==r?0:1),-1==d){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}h=0==d?this._normaldensity(s,o,a):this._normaldist(s,o,a)}return h.toString()},this.computeSumProduct=function(e){var t,i,r,l,n,s,o,a,d,h=0,c=0,u=null;for(this.adjustRangeArg(e),i=this.splitArgsPreservingQuotedCommas(e),r=0;r<i.length;++r){if((l=i[r]).startsWith(this.tic)||!(l.indexOf(":")>-1)){if(d=this.getValueFromArg(l),-1!=this.getErrorStrings().indexOf(d))return d;if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}var g=l.indexOf(":"),p=this.rowIndex(l.substr(0,g)),m=this.rowIndex(l.substr(g+1));if(!(-1!=p||-1==m)==(-1==p||-1!=m)&&this.getErrorStrings()[5].toString(),n=this.colIndex(l.substr(0,g)),s=this.colIndex(l.substr(g+1)),null==u)for(c=(m-p+1)*(s-n+1),u=[],g=0;g<c;++g)u[g]=1;var _=CalcEngine.getSheetFamilyItem(this.grid),f=this._getSheetTokenFromReference(l),b=null==f||""==f?this.grid:_.tokenToParentObject.getItem(f);for(g=0,o=p;o<=m;++o)for(a=n;a<=s;++a){if(t=this.getValueFromParentObject(b,o,a).toString().split(this.tic).join(""),isNaN(t))u[g]=0;else{if(isNaN(u[g]))return this.getErrorStrings()[1].toString();u[g]=u[g]*t}g++}}for(g=0;g<c;++g)h+=u[g];return h.toString()},this.computeStdev=function(e){var t,i,r;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1?t:(e=e.split(this.tic).join(""),(i=this._getDoubleArray(e)).length<2?this.formulaErrorStrings[this._invalid_arguments]:(r=0,this._sd(i,r).toString()))},this.computeVLookUp=function(e){var t,i,r,l,n,s,o,a,d,h=this._isVLookupCachingEnabled(),c=this._isOptimizedMatchesEnabled();if(h&&null==this._lookupTables&&(this._lookupTables=new HashTable),t=this.splitArgsPreservingQuotedCommas(e),i=(i=this.getValueFromArg(t[0])).split(this.tic).join(this._string_empty).toUpperCase(),"#REF!"==(r=t[1].split('"').join(this._string_empty)))return r;if(l=this.getValueFromArg(t[2]).split('"').join(this._string_empty),n=0,n=this._parseDouble(l),this.computeIsLogical(l)==this.trueValueStr)n=this._parseDouble(this.computeN(l));else if(isNaN(n)||"NaN"==l)return"#N/A";if(n<1)return this.getErrorStrings()[1].toString();var u=n,g=!0,p=!0;4==t.length&&(g=p=this.getValueFromArg(t[3])==this.trueValueStr||"1"==this.getValueFromArg(t[3].split(this.tic).join(this._string_empty))),n=this._parseDouble(i),s=!isNaN(n),-1==(o=r.indexOf(":"))&&(o=(r=r+":"+r).indexOf(":"));var m=r.substr(0,o).lastIndexOf(this.sheetToken),_=this.grid,f=CalcEngine.getSheetFamilyItem(this.grid);m>-1&&(this.grid=f.tokenToParentObject.getItem(r.substring(0,m+1)));var b=this.rowIndex(r.substring(0,o)),C=this.rowIndex(r.substring(o+1)),S=this.colIndex(r.substring(0,o));this.colIndex(r.substring(o+1));if(!(-1!=b||-1==C)==(-1==b||-1!=C))return this.getErrorStrings()[5].toString();var x=!0,v="",w=null,I=null;h&&(v=S.toString()+"_"+b.toString()+"_"+C.toString()+"_"+this.grid.GetHashCode(),this._lookupTables.containsKey(v)||(c?((a=new LookUps).setMatchLookUpList(new HashTable),this._lookupTables.add(v,a)):(a=new LookUps,this._lookupTables.add(v,a)),x=!0),w=this._lookupTables.getItem(v).getLinearLookUpList(),c&&(I=this._lookupTables.getItem(v).getMatchLookUpList()));var y="",T=b,L=0,R="",O=0,F=!0,E=!1,D=[];if(h&&c&&I.length>0)I.containsKey(i)&&(T=I.getItem(i),R=i,E=!0);else for(d=b;d<=C;++d)if(h&&c)R=this.getValueFromParentObject(this.grid,d,S).toString().toUpperCase().split('"').join(""),-1==w.indexOf(R)&&w.push(R),c&&!I.containsKey(R)&&I.add(R,d),O=s?this._parseDouble(R):O,(d==C&&I.containsKey(i)||g&&(s?!isNaN(O)&&O>n:R>i))&&(I.containsKey(i)?(T=I.getItem(i),R=i,E=!0):F=!1),F&&!I.containsKey(i)&&(T=d);else{if(!h||d-b>=w.length||x?(R=this.getValueFromParentObject(this.grid,d,S).toString().toUpperCase().split('"').join(""),-1==D.indexOf(R)&&D.push(R),h&&(-1==w.indexOf(R)&&w.push(R),c&&!I.containsKey(R)&&I.add(R,d))):R=w[d-b],O=s?this._parseDouble(R):O,R==i||g&&(s?!isNaN(O)&&O>n:R>i)){if(R.toUpperCase()==i&&(T=d,g=!0,E=!0,L++),!x)break;F=!1}F&&(T=d),x=0==L,g=!0}if(g||R==i){if(null!=w&&w.length>0&&(h||w.sort(),w[0]=""==w[0]?"0":w[0]),null!=D&&D.length>0&&""!=i&&(h||D.sort(),D[0]=""==D[0]?"0":D[0]),!E&&(!s||s&&null!=D&&D.length>0&&this._parseDouble(D[0].toString())>this._parseDouble(i))||!E&&h&&s&&null!=w&&this._parseDouble(w[0].toString())>this._parseDouble(i)||!p&&!E)return this.grid=_,"#N/A";(y=this.getValueFromParentObject(this.grid,T,u+S-1).toString()).length>0&&y[0]==CalcEngine.getFormulaCharacter()&&(y=this.parseFormula(y)),n=this._parseDouble(y),y.length>0&&y[0]!=this.tic[0]&&isNaN(n)&&(y=this.tic+y+this.tic)}else y="#N/A";return this.grid=_,y},this.computeAsinh=function(e){var t,i;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,i=this._parseDouble(e),isNaN(i)){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}return(i=Math.sign(i)*Math.log(Math.abs(i)+Math.sqrt(i*i+1))).toString()},this.computeAtanh=function(e){var t,i,r;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,i=this._parseDouble(e),r=Math.abs(i),isNaN(i)||!(r<1)){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return(i=.5*Math.sign(i)*Math.log((1+r)/(1-r))).toString()},this.computeBase=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(a<2||a>3||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;var d=0,h=0,c=1;try{o[0]=this.getValueFromArg(o[0]),o[1]=this.getValueFromArg(o[1]),o[0]=null==o[0]||""==o[0]?"0":o[0],o[0]="TRUE"==o[0].split(this.tic).join("")?"1":"FALSE"==o[0].split(this.tic).join("")?"0":o[0],o[1]=null==o[1]||""==o[1]?"0":o[1],o[1]="TRUE"==o[1].split(this.tic).join("")?"1":"FALSE"==o[1].split(this.tic).join("")?"0":o[1],3==a&&(o[2]=this.getValueFromArg(o[2]),o[2]=null==o[2]||""==o[2]?"0":o[2],o[2]="TRUE"==o[2].split(this.tic).join("")?"1":"FALSE"==o[2].split(this.tic).join("")?"0":o[2]),d=parseInt(this.getValueFromArg(o[0]).split(this.tic).join("")),h=parseInt(this.getValueFromArg(o[1]).split(this.tic).join("")),c=3==a?parseInt(this.getValueFromArg(o[2]).split(this.tic).join("")):1}catch(e){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[5].toString();return this.getErrorStrings()[5].toString()}if(64,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",d<0||h<2||h>i.length||c<0||c>255){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}for(var u=63,g=Math.abs(d),p=new Array(64);0!=g;)r=parseInt(g%h),p[u--]=i[r],g=parseInt(g/h);for(l=p.slice(u+1,64),n=new StringBuilder,s=0;s<c-l.length;s++)n.append("0");return l=n.toString()+l,d<0&&(l="-"+l),(l=l.split(",").join("")).toString()},this.computeAverageIf=function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=this.splitArgsPreservingQuotedCommas(e),C=b.length,S=0;if(2!=C&&3!=C||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(i=b[0],(r=null==(r=b[1])||""==r?"0":r).length<1)return"0";l=this.token_equal,r[0]!=this.tic[0]&&-1=="=><".indexOf(r[0])&&(r=this.getValueFromArg(r)),n=r.length>0&&r[0]==this.tic[0]?1:0,Number.MIN_VALUE,r.substring(n).startsWith(">=")?(r=r.substr(n+2,r.length-2-2*n),l=this.token_greatereq):r.substring(n).startsWith("<=")?(r=r.substr(n+2,r.length-2-2*n),l=this.token_lesseq):r.substring(n).startsWith("<>")?(r=r.substr(n+2,r.length-2-2*n),l=this.token_noequal):r.substring(n).startsWith("<")?(r=r.substr(n+1,r.length-1-2*n),l=this.token_less):r.substring(n).startsWith(">")?(r=r.substr(n+1,r.length-1-2*n),l=this.token_greater):r.substring(n).startsWith("=")&&(r=r.substr(n+1,r.length-1-2*n)),r=r.split(this.tic).join("");var x=this._parseDouble(r),v=2==C?i:b[2],w=this.getCellsFromArgs(i),I=this.getCellsFromArgs(v);if(w[0]==this.getErrorStrings()[5]||I[0]==this.getErrorStrings()[5]){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[5].toString();return this.getErrorStrings()[5].toString()}if((s=w.length)>I.length&&(o=v.indexOf(":"))>-1){if(a=this.rowIndex(v.substring(0,o)),d=this.rowIndex(v.substring(o+1)),!(-1!=a||-1==d)==(-1==a||-1!=d))return this.getErrorStrings()[5].toString();h=this.colIndex(v.substring(0,o)),c=this.colIndex(v.substr(o+1)),a!=d?d+=s-I.length:h!=c&&(c+=s-I.length),v=v.substring(0,o+1)+RangeInfo.getAlphaLabel(c)+d.toString(),I=this.getCellsFromArgs(v)}switch(u=0,l){case this.token_equal:if(r.indexOf("*")>-1)for(m=r.indexOf("*"),r=r.substring(0,m),_=0;_<s;++_)p=this.getValueFromArg(w[_]),g=this._parseDouble(p),p.split(this.tic).join("").substr(0,m)!=r&&(isNaN(g)||g!=x)||(p=I[_],p=this.getValueFromArg(p),g=this._parseDouble(p),isNaN(g)||(u+=g,S++));else for(_=0;_<s;++_)p=this.getValueFromArg(w[_]),g=this._parseDouble(p),p.split(this.tic).join("")!=r&&(isNaN(g)||g!=x)||(p=I[_],p=this.getValueFromArg(p),g=this._parseDouble(p),isNaN(g)||(u+=g,S++));break;case this.token_noequal:for(_=0;_<s;++_)p=this.getValueFromArg(w[_]),g=this._parseDouble(p),p.split(this.tic).join("")==r&&(isNaN(g)||g==x)||(p=I[_],p=this.getValueFromArg(p),g=this._parseDouble(p),isNaN(g)||(u+=g,S++));break;case this.token_greatereq:for(_=0;_<s;++_)p=this.getValueFromArg(w[_]),g=this._parseDouble(p),isNaN(g)||g>=x&&(p=I[_],p=this.getValueFromArg(p),g=this._parseDouble(p),isNaN(g)||(u+=g,S++));break;case this.token_greater:for(_=0;_<s;++_)p=this.getValueFromArg(w[_]),g=this._parseDouble(p),isNaN(g)||g>x&&(p=I[_],p=this.getValueFromArg(p),g=this._parseDouble(p),isNaN(g)||(u+=g,S++));break;case this.token_less:for(_=0;_<s;++_)p=this.getValueFromArg(w[_]),g=this._parseDouble(p),isNaN(g)||g<x&&(p=I[_],p=this.getValueFromArg(p),g=this._parseDouble(p),isNaN(g)||(u+=g,S++));break;case this.token_lesseq:for(_=0;_<s;++_)p=this.getValueFromArg(w[_]),g=this._parseDouble(p),isNaN(g)||g<=x&&(p=I[_],p=this.getValueFromArg(p),g=this._parseDouble(p),isNaN(g)||(u+=g,S++))}if(f=u/S,this.computeIsErr(f.toString())==this.trueValueStr){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[3].toString()}return f.toString()},this.computeAverageIfS=function(e){for(var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_=this.splitArgsPreservingQuotedCommas(e),f=_.length,b=0,C=[],S=[],x=1;x<f;x++)C.push(_[x]),x++,S.push(_[x]);if(f<3&&C.length==S.length)return this.formulaErrorStrings[this._wrong_number_arguments];var w=_[0],I=0,y=(this.getCellsFromArgs(_[0]),this.getCellsFromArgs(w)),T=!1;for(v=0;v<S.length;v++){if(t=this.token_equal,(i=S[v])[0]!=this.tic[0]&&-1=="=><".indexOf(i[0])&&(i=this.getValueFromArg(i)),v==C.length-1&&(T=!0),r=i.length>0&&i[0]==this.tic[0]?1:0,l=Number.MIN_VALUE,i.substring(r).startsWith(">=")?(i=i.substr(r+2,i.length-2-2*r),t=this.token_greatereq):i.substring(r).startsWith("<=")?(i=i.substr(r+2,i.length-2-2*r),t=this.token_lesseq):i.substring(r).startsWith("<>")?(i=i.substr(r+2,i.length-2-2*r),t=this.token_noequal):i.substring(r).startsWith("<")?(i=i.substr(r+1,i.length-1-2*r),t=this.token_less):i.substring(r).startsWith(">")?(i=i.substr(r+1,i.length-1-2*r),t=this.token_greater):i.substring(r).startsWith("=")&&(i=i.substr(r+1,i.length-1-2*r)),i=i.split(this.tic).join(""),l=this._parseDouble(i),!isNaN(l),(n=this.getCellsFromArgs(C[v]))[0]==this.getErrorStrings()[5]||y[0]==this.getErrorStrings()[5])return this.getErrorStrings()[5].toString();if((s=n.length)>y.length&&(x=w.indexOf(":"))>1){if(o=this.rowIndex(w.substring(0,x)),a=this.rowIndex(w.substring(x+1)),!(-1!=o||-1==a)==(-1==o||-1!=a))return this.getErrorStrings()[5].toString();d=this.colIndex(w.substring(0,x)),h=this.colIndex(w.substr(x+1)),o!=a?a+=s-y.length:d!=h&&(h+=s-y.length),w=w.substring(0,x+1)+RangeInfo.getAlphaLabel(h)+a.toString(),y=this.getCellsFromArgs(w)}switch(t){case this.token_equal:if(i.indexOf("*")>-1)for(g=i.indexOf("*"),i=i.substring(0,g),p=0;p<s;++p)u=this.getValueFromArg(n[p]),c=this._parseDouble(u),u.split(this.tic).join("").substr(0,g)==i||!isNaN(c)&&c==l?null!=y[p]&&(u=y[p],u=this.getValueFromArg(u),c=this._parseDouble(u),!isNaN(c)&&T&&(I+=c,b++)):y[p]=null;else for(p=0;p<s;++p)u=this.getValueFromArg(n[p]),c=this._parseDouble(u),u.split(this.tic).join("").substr(0,p)==i||!isNaN(c)&&c==l?null!=y[p]&&(u=y[p],u=this.getValueFromArg(u),c=this._parseDouble(u),!isNaN(c)&&T&&(I+=c,b++)):y[p]=null;break;case this.token_noequal:for(p=0;p<s;++p)u=this.getValueFromArg(n[p]),c=this._parseDouble(u),u.split(this.tic).join("")!=i||!isNaN(c)&&c!=l?null!=y[p]&&(u=y[p],u=this.getValueFromArg(u),c=this._parseDouble(u),!isNaN(c)&&T&&(I+=c,b++)):y[p]=null;break;case this.token_greatereq:for(p=0;p<s;++p)u=this.getValueFromArg(n[p]),c=this._parseDouble(u),isNaN(c)||(c>=l?null!=y[p]&&(u=y[p],u=this.getValueFromArg(u),c=this._parseDouble(u),!isNaN(c)&&T&&(I+=c,b++)):y[p]=null);break;case this.token_greater:for(p=0;p<s;++p)u=this.getValueFromArg(n[p]),c=this._parseDouble(u),isNaN(c)||(c>l?null!=y[p]&&(u=y[p],u=this.getValueFromArg(u),c=this._parseDouble(u),!isNaN(c)&&T&&(I+=c,b++)):y[p]=null);break;case this.token_less:for(p=0;p<s;++p)u=this.getValueFromArg(n[p]),c=this._parseDouble(u),isNaN(c)||(c<l?null!=y[p]&&(u=y[p],u=this.getValueFromArg(u),c=this._parseDouble(u),!isNaN(c)&&T&&(I+=c,b++)):y[p]=null);break;case this.token_lesseq:for(p=0;p<s;++p)u=this.getValueFromArg(n[p]),c=this._parseDouble(u),isNaN(c)||(c<=l?null!=y[p]&&(u=y[p],u=this.getValueFromArg(u),c=this._parseDouble(u),!isNaN(c)&&T&&(I+=c,b++)):y[p]=null)}}if(m=I/b,this.computeIsErr(m.toString())==this.trueValueStr){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[3].toString()}return m.toString()},this.computeBesselI=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o="",a="";if(s.length>2||s.length<=1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(o=(o=this.getValueFromArg(s[0])).split(this.tic).join(""),a=(a=this.getValueFromArg(s[1])).split(this.tic).join(""),t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;try{if(0==this._parseDouble(o))return"0.0";if(this._parseDouble(a)<0){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[4].toString()}if(""==o||""==a)return this.getErrorStrings()[0].toString();if(this.computeIsText(o)==this.trueValueStr||this.computeIsText(a)==this.trueValueStr)return this.getErrorStrings()[5].toString();if(o==this.trueValueStr||a==this.trueValueStr||o==this.falseValueStr||a==this.falseValueStr)return this.getErrorStrings()[1].toString();if(this._parseDouble(o)<2&&this._parseDouble(o)>1){var d=2/Math.abs(this._parseDouble(o)),h=0,c=0,u=1;for(i=Math.round(2*(this._parseDouble(a)+Math.sqrt(this._acc*this._parseDouble(a))));i>0;--i)r=c+i*d*u,c=u,u=r,Math.abs(u)>this._bingo&&(h*=this._bigni,u*=this._bigni,c*=this._bigni),l=this.computeRound(i.toString()),n=this.computeRound(a),parseInt(l)==parseInt(n)&&(h=c);return(h*=this.besseli0(this._parseDouble(o))/u)==Number.POSITIVE_INFINITY||isNaN(h)?this.getErrorStrings()[4].toString():(this._parseDouble(o)<0&&parseInt(a)%2==0?-h:h).toString()}d=2/Math.abs(this._parseDouble(o)),h=0,c=0,u=1;for(i=Math.round(2*(this._parseDouble(a)+Math.sqrt(this._acc*this._parseDouble(a))));i>0;--i)r=c+i*d*u,c=u,u=r,Math.abs(u)>this._bingo&&(h*=this._bigni,u*=this._bigni,c*=this._bigni),(l=this.computeRound(i.toString()))==(n=this.computeRound(a))&&(h=c);return h*=this.besseli0(this._parseDouble(o))/u,this._parseDouble(o)<.9&&this._parseDouble(o)>0?this.besseli0(this._parseDouble(o)).toString():h==Number.POSITIVE_INFINITY||isNaN(h)?this.getErrorStrings()[4].toString():(this._parseDouble(o)<0&&parseInt(a)%2!=0?-h:h).toString()}catch(e){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException("The Parameters are not correct");return this.computeIsText(o)==this.trueValueStr||this.computeIsText(a)==this.trueValueStr?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}},this.computeBesselJ=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n="",s="";if(l.length>2||l.length<=1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(n=(n=this.getValueFromArg(l[0])).split(this.tic).join(""),s=(s=this.getValueFromArg(l[1])).split(this.tic).join(""),t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;var o,a,d,h,c,u,g,p,m,_=1e-10;try{if(0==this._parseDouble(s))return this.j0(n).toString();if(1==this._parseDouble(s))return this.j1(n).toString();if(this._parseDouble(s)<0){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[4].toString()}if(""==n||""==s)return this.getErrorStrings()[0].toString();if(this.computeIsText(n)==this.trueValueStr||this.computeIsText(s)==this.trueValueStr)return this.getErrorStrings()[5].toString();if(n==this.trueValueStr||s==this.trueValueStr||n==this.falseValueStr||s==this.falseValueStr)return this.getErrorStrings()[1].toString();if(0==(a=Math.abs(this._parseDouble(n))))return"0";if(this._parseDouble(n)<.9&&this._parseDouble(s)<.9)g=2/a,p=h=this.j0(a.toString());else if(a>this._parseDouble(s)){for(g=2/a,h=this.j0(a.toString()),d=this.j1(a.toString()),o=1;o<this._parseDouble(s);o++)c=o*g*d-h,h=d,d=c;p=d}else if(this._parseDouble(n)<2&&this._parseDouble(s)<2){for(g=2/a,m=!1,c=p=u=0,d=1,o=Math.round(2*(this._parseDouble(s)+parseInt(Math.sqrt(40*this._parseDouble(s)))/2));o>0;o--)h=o*g*d-c,c=d,d=h,Math.abs(d)>1e10&&(d*=_,c*=_,p*=_,u*=_),m&&(u+=d),m=!m,i=this.computeRound(o.toString()),r=this.computeRound(s),parseInt(i)<=parseInt(r)&&(p=c);p/=u=2*u-d}else{for(g=2/a,m=!1,c=p=u=0,d=1,o=2*(this._parseDouble(s)+parseInt(Math.sqrt(40*this._parseDouble(s)))/2);o>0;o--)h=o*g*d-c,c=d,d=h,Math.abs(d)>1e10&&(d*=_,c*=_,p*=_,u*=_),m&&(u+=d),m=!m,(i=this.computeRound(o.toString()))==(r=this.computeRound(s))&&(p=c);p/=u=2*u-d}return(this._parseDouble(n)<0&&this._parseDouble(s)%2==1?-p:p).toString()}catch(e){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException("The Parameters are not correct");return this.computeIsText(x)==this.trueValueStr||this.computeIsText(s)==this.trueValueStr?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}},this.computeBesselK=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e),l="",n="";2==r.length&&r.indexOf("u");if(r.length>2||r.length<=1||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(l=(l=this.getValueFromArg(r[0])).split(this.tic).join(""),n=(n=this.getValueFromArg(r[1])).split(this.tic).join(""),t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;if(2==r.length&&this.computeIsNumber(r[1])!=this.trueValueStr,""==l&&""==n){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException("Passed arguments contains invalid argument");return this.getErrorStrings()[0].toString()}if(2==r.length)l=(l=this.getValueFromArg(r[0])).split(this.tic).join(""),n=(n=this.getValueFromArg(r[1])).split(this.tic).join("");else{if(1!=r.length)return this.formulaErrorStrings[10].toString();l=this.getValueFromArg(r[0]),n="0"}var s,o=0,a=0,d=0,h=0,c=0,u=0,g=0,p=0,m=0,_=0,f=0,b=0,C=0,S=0,x=0,v=0,w=0,I=.5772156649015329;try{if(s=this._parseDouble(n)<0?"-"+n.toString():n,this._parseDouble(l)<0||this._parseDouble(n)<0){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[4].toString()}if(""==l||""==n)return this.getErrorStrings()[0].toString();if(this.computeIsText(l)==this.trueValueStr||this.computeIsText(n)==this.trueValueStr)return this.getErrorStrings()[5].toString();if(l==this.trueValueStr||n==this.trueValueStr||l==this.falseValueStr||n==this.falseValueStr)return this.getErrorStrings()[1].toString();if(this._parseDouble(l)<=9.55){if(_=0,p=.25*this._parseDouble(l)*this._parseDouble(l),f=1,b=0,S=1,v=2/this._parseDouble(l),this._parseDouble(s)>0){for(b=-I,o=1,s=parseInt(this._parseDouble(s)).toString(),w=1;w<=this._parseDouble(s)-1;w++)b+=1/o,f*=o+=1;if(S=v,1==this._parseDouble(s))_=1/this._parseDouble(l);else{for(a=1,g=d=f/this._parseDouble(s),m=-p,c=1,w=1;w<=this._parseDouble(s)-1;w++)g+=u=(d/=this._parseDouble(s)-w)*(c*=m)/(a*=w),S*=v;g*=.5,u=Math.abs(g),_=g*S}}x=2*Math.log(.5*this._parseDouble(l)),C=-I,0==this._parseDouble(s)?(b=C,u=1):(b+=1/this._parseDouble(s),u=1/f),g=(C+b-x)*u,o=1;do{u*=p/(o*(o+this._parseDouble(s))),g+=((C+=1/o)+(b+=1/(o+this._parseDouble(s)))-x)*u,o+=1}while(this._parseDouble(Math.abs(u/g))>this.machineepsilon);return g=.5*g/S,this._parseDouble(s)%2!=0&&(g=-g),(_+=g).toString()}if(this._parseDouble(l)>this._parseDouble(Math.log(this.maxrealnumber)))return(0).toString();b=4*(o=this._parseDouble(s))*o,C=1,p=8*this._parseDouble(l),f=1,g=u=1,w=0;do{if(u=u*(m=b-C*C)/(f*p),d=Math.abs(u),w>=this._parseDouble(s)&&this._parseDouble(d)>this._parseDouble(h))break;h=d,g+=u,f+=1,C+=2,w+=1}while(this._parseDouble(Math.abs(u/g))>this.machineepsilon);return i="-"+l,(Math.exp(this._parseDouble(i))*Math.sqrt(Math.PI/(2*this._parseDouble(l)))*g).toString()}catch(e){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException("The Parameters are not correct");return this.computeIsText(l)==this.trueValueStr||this.computeIsText(n)==this.trueValueStr?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}},this.computeBesselY=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a="",d="";2==o.length&&o.indexOf("u");if(o.length>2||o.length<=1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(a=(a=this.getValueFromArg(o[0])).split(this.tic).join(""),d=(d=this.getValueFromArg(o[1])).split(this.tic).join(""),t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)return t;if(2==o.length&&this.computeIsNumber(o[1])!=this.trueValueStr,""==a&&""==d){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException("Passed arguments contains invalid argument");return this.getErrorStrings()[0].toString()}if(2==o.length)a=(a=this.getValueFromArg(o[0])).split(this.tic).join(""),d=(d=this.getValueFromArg(o[1])).split(this.tic).join("");else{if(1!=o.length)return this.formulaErrorStrings[10].toString();a=this.getValueFromArg(o[0]),d="0"}try{if(this._parseDouble(a)<0||this._parseDouble(d)<0){if(this._rethrowLibraryComputationExceptions)throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[4].toString()}if(""==a||""==d)return this.getErrorStrings()[0].toString();if(this.computeIsText(a)==this.trueValueStr||this.computeIsText(d)==this.trueValueStr)return this.getErrorStrings()[5].toString();if(a==this.trueValueStr||d==this.trueValueStr||a==this.falseValueStr||d==this.falseValueStr)return this.getErrorStrings()[1].toString();if(0==this._parseDouble(a))return this.y0(this._parseDouble(a)).toString();if(1==this._parseDouble(d))return this.y1(this._parseDouble(a)).toString();if(this._parseDouble(a)<2&&this._parseDouble(a)>1)return n=2/this._parseDouble(a),i=this.y1(this._parseDouble(a)),r=this.y0(this._parseDouble(a)),i.toString();for(n=2/this._parseDouble(a),i=this.y1(this._parseDouble(a)),r=this.y0(this._parseDouble(a)),s=1;s<this._parseDouble(d);s++)l=s*n*i-r,r=i,i=l;return i.toString()}catch(e){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException("The Parameters are not correct");return this.computeIsText(x)==this.trueValueStr||this.computeIsText(nn)==this.trueValueStr?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}},this.computeText=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(2!=l.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException(this.formulaErrorStrings[this._wrong_number_arguments]);return this.formulaErrorStrings[this._wrong_number_arguments]}var n=l[0],s=l[1],o=this._dateTime1900,a=this.formulaErrorStringCheck(e,FormulaArgumentType.Text);if(this.getErrorStrings().indexOf(a)>-1)return a;if(n=this.getValueFromArg(n),(s=(s=this.getValueFromArg(s)).split(this.tic).join(""))==this._string_empty)return this._string_empty;if(n==this._string_empty&&s.length>0&&(s.toUpperCase().indexOf("M")>-1||s.toUpperCase().indexOf("D")>-1||s.toUpperCase().indexOf("Y")>-1||s.toUpperCase().indexOf("S")>-1||s.toUpperCase().indexOf("T")>-1)&&(n=o.toString()),t=this._parseDouble(n),isNaN(t)&&"NaN"!=this._isDate(new Date(n))&&(t=this._toOADate(new Date(n))),o=Date.parse(n.split(this.tic).join("")),!isNaN(t)||!isNaN(o)){if("["==s[0]&&-1!=this.nativeFormats.indexOf(s))return this.tic+n+this.tic;if(s.length>0&&(s.toUpperCase().indexOf("M")>-1||s.toUpperCase().indexOf("D")>-1||s.toUpperCase().indexOf("Y")>-1||s.toUpperCase().indexOf("S")>-1||s.toUpperCase().indexOf("T")>-1)){var d=(s=s.split("Y").join("y").split("D").join("d").split("H").join("h").split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),h=!1,c=!1,u=0,g=0,p=0,m=0;for(u=0;u<d.length;)"s"==(i=d[u])&&"M"==d[p]&&(d[p]="m","M"==d[p-1]&&(d[p-1]="m")),this._isLetter(i)?(p=u,"M"==i&&(g++,m++)):m>1&&m++,"M"==i&&h&&(d[u]="m",c=!0,1==g),"h"==i?h=!0:this._isLetter(i)&&"M"!=i&&"h"!=i&&!c&&(h=!1,c=!1),u++;s=(s=new String(d)).split(",").join("").split("\n").join(" "),r=this._fromOADate(t),0==t&&(r=o),n=ej.format(r,s,"en-US")}else n=ej.format(t,s,"en-US")}return this.tic+n+this.tic},this.computePow=function(e){var t,i,r,l,n,s,o=0;if(2!=this.splitArgsPreservingQuotedCommas(e).length||e==this._string_empty){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException(this.formulaErrorStrings[this._wrong_number_arguments]);return this.formulaErrorStrings[this._wrong_number_arguments]}if(n=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(n)>-1)return n;if(s=this.splitArgsPreservingQuotedCommas(e),r=this.getValueFromArg(s[0]),l=this.getValueFromArg(s[1]),""==r&&""==l){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[4].toString()}if(r=""==r&&this._treatStringsAsZero?"0":r,l=""==l&&this._treatStringsAsZero?"0":l,r="TRUE"==this.getValueFromArg(r).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r,l="TRUE"==this.getValueFromArg(l).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,t=this._parseDouble(r),i=this._parseDouble(l),!isNaN(t)&&!isNaN(i)){if(0==t&&i<0){if(this.getRethrowLibraryComputationExceptions())throw new ArgumentException(this.formulaErrorStrings[this._bad_formula]);return this.getErrorStrings()[3].toString()}o=Math.pow(t,i)}return o.toString()},this.j0=function(e){var t;if((t=Math.abs(this._parseDouble(e)))<8)return(n=57568490574+(i=this._parseDouble(e)*this._parseDouble(e))*(i*(651619640.7+i*(i*(77392.33017+-184.9052456*i)-11214424.18))-13362590354))/(s=57568490411+i*(1029532985+i*(9494680.718+i*(59272.64853+i*(267.8532712+1*i)))));var i,r=8/t,l=t-.785398164,n=1+(i=r*r)*(i*(2734510407e-14+i*(2.093887211e-7*i-2073370639e-15))-.001098628627),s=i*(.0001430488765+i*(i*(7.621095161e-7-9.34935152e-8*i)-6911147651e-15))-.01562499995;return Math.sqrt(.636619772/t)*(Math.cos(l)*n-r*Math.sin(l)*s)},this.j1=function(e){var t,i,r,l,n,s,o;return(t=Math.abs(this._parseDouble(e)))<8?(i=this._parseDouble(e)*this._parseDouble(e),(r=this._parseDouble(e)*(72362614232+i*(i*(242396853.1+i*(i*(15704.4826+-30.16036606*i)-2972611.439))-7895059235)))/(l=144725228442+i*(2300535178+i*(18583304.74+i*(99447.43394+i*(376.9991397+1*i)))))):(s=t-2.356194491,r=1+(i=(n=8/t)*n)*(.00183105+i*(i*(2457520174e-15+-2.40337019e-7*i)-3516396496e-14)),l=.04687499995+i*(i*(8449199096e-15+i*(1.05787412e-7*i-8.8228987e-7))-.0002002690873),o=Math.sqrt(.636619772/t)*(Math.cos(s)*r-n*Math.sin(s)*l),this._parseDouble(e)<0&&(o=-o),o)},this.y0=function(e){if(e<8)return(l=(t=e*e)*(7062834065+t*(t*(10879881.29+t*(228.4622733*t-86327.92757))-512359803.6))-2957821389)/(n=40076544269+t*(745249964.8+t*(7189466.438+t*(47447.2647+t*(226.1030244+1*t)))))+.636619772*this.j0(e.toString())*Math.log(e);var t,i=8/e,r=e-.785398164,l=1+(t=i*i)*(t*(2734510407e-14+t*(2.093887211e-7*t-2073370639e-15))-.001098628627),n=t*(.0001430488765+t*(t*(7.621095161e-7+-9.34945152e-8*t)-6911147651e-15))-.01562499995;return Math.sqrt(.636619772/e)*(Math.sin(r)*l+i*Math.cos(r)*n)},this.y1=function(e){if(e<8)return(l=e*((t=e*e)*(127527439e4+t*(t*(734926455.1+t*(8511.937935*t-4237922.726))-51534381390))-4900604943e3))/(n=249958057e5+t*(424441966400+t*(3733650367+t*(22459040.02+t*(102042.605+t*(354.9632885+t))))))+.636619772*(this.j1(e.toString())*Math.log(e)-1/e);var t,i=8/e,r=e-2.356194491,l=1+(t=i*i)*(.00183105+t*(t*(2457520174e-15+-2.40337019e-7*t)-3516396496e-14)),n=.04687499995+t*(t*(8449199096e-15+t*(1.05787412e-7*t-8.8228987e-7))-.0002002690873);return Math.sqrt(.636619772/e)*(Math.sin(r)*l+i*Math.cos(r)*n)},this.besseli0=function(e){var t=0,i=0,r=0,l={b0:0,b1:0,b2:0};return this._parseDouble(e)<this._parseDouble(0)&&(e=-e),this._parseDouble(e)<=this._parseDouble(8)?(t=e/2-2,this.besselmfirstcheb(-4.4153416464793395e-18,l),this.besselmnextcheb(t,3.3307945188222384e-17,l),this.besselmnextcheb(t,-2.431279846547955e-16,l),this.besselmnextcheb(t,1.715391285555133e-15,l),this.besselmnextcheb(t,-1.1685332877993451e-14,l),this.besselmnextcheb(t,7.676185498604936e-14,l),this.besselmnextcheb(t,-4.856446783111929e-13,l),this.besselmnextcheb(t,2.95505266312964e-12,l),this.besselmnextcheb(t,-1.7268262914415555e-11,l),this.besselmnextcheb(t,9.675809035373237e-11,l),this.besselmnextcheb(t,-5.189795601635263e-10,l),this.besselmnextcheb(t,2.6598237246823866e-9,l),this.besselmnextcheb(t,-1.300025009986248e-8,l),this.besselmnextcheb(t,6.046995022541919e-8,l),this.besselmnextcheb(t,-2.670793853940612e-7,l),this.besselmnextcheb(t,11173875391201037e-22,l),this.besselmnextcheb(t,-44167383584587505e-22,l),this.besselmnextcheb(t,16448448070728896e-21,l),this.besselmnextcheb(t,-5754195010082104e-20,l),this.besselmnextcheb(t,.00018850288509584165,l),this.besselmnextcheb(t,-.0005763755745385824,l),this.besselmnextcheb(t,.0016394756169413357,l),this.besselmnextcheb(t,-.004324309995050576,l),this.besselmnextcheb(t,.010546460394594998,l),this.besselmnextcheb(t,-.02373741480589947,l),this.besselmnextcheb(t,.04930528423967071,l),this.besselmnextcheb(t,-.09490109704804764,l),this.besselmnextcheb(t,.17162090152220877,l),this.besselmnextcheb(t,-.3046826723431984,l),this.besselmnextcheb(t,.6767952744094761,l),i=.5*(l.b0-l.b2),Math.exp(e)*i):(r=32/e-2,this.besselmfirstcheb(-7.233180487874754e-18,l),this.besselmnextcheb(r,-4.830504485944182e-18,l),this.besselmnextcheb(r,4.46562142029676e-17,l),this.besselmnextcheb(r,3.461222867697461e-17,l),this.besselmnextcheb(r,-2.8276239805165836e-16,l),this.besselmnextcheb(r,-3.425485619677219e-16,l),this.besselmnextcheb(r,1.7725601330565263e-15,l),this.besselmnextcheb(r,3.8116806693526224e-15,l),this.besselmnextcheb(r,-9.554846698828307e-15,l),this.besselmnextcheb(r,-4.150569347287222e-14,l),this.besselmnextcheb(r,1.54008621752141e-14,l),this.besselmnextcheb(r,3.8527783827421426e-13,l),this.besselmnextcheb(r,7.180124451383666e-13,l),this.besselmnextcheb(r,-1.7941785315068062e-12,l),this.besselmnextcheb(r,-1.3215811840447713e-11,l),this.besselmnextcheb(r,-3.1499165279632416e-11,l),this.besselmnextcheb(r,1.1889147107846439e-11,l),this.besselmnextcheb(r,4.94060238822497e-10,l),this.besselmnextcheb(r,3.3962320257083865e-9,l),this.besselmnextcheb(r,2.266668990498178e-8,l),this.besselmnextcheb(r,2.0489185894690638e-7,l),this.besselmnextcheb(r,28913705208347567e-22,l),this.besselmnextcheb(r,6889758346916825e-20,l),this.besselmnextcheb(r,.0033691164782556943,l),this.besselmnextcheb(r,.8044904110141088,l),i=.5*(l.b0-l.b2),Math.exp(e)*i/Math.sqrt(e))},this.besselmfirstcheb=function(e,t){t.b0=e,t.b1=0,t.b2=0},this.besselmnextcheb=function(e,t,i){i.b2=i.b1,i.b1=i.b0,i.b0=e*i.b1-i.b2+t},this.computeFOdistORt=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e),l=r.length;if(3!=l||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;var n,s=0,o=0;for(i=0;i<l;++i)r[i]=this.getValueFromArg(r[i]).split(this.tic).join(""),r[i]=null==r[i]||""==r[i]?"0":r[i],r[i]="TRUE"==r[i].split(this.tic).join("")?"1":"FALSE"==r[i].split(this.tic).join("")?"0":r[i];if(n=this._parseDouble(r[0]),s=this._parseDouble(r[1]),o=this._parseDouble(r[2]),isNaN(n)||isNaN(s)||isNaN(o)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this.invalid_Math_argument];return this._formulaErrorStrings[this._invalid_Math_argument]}if(n<0||s<1||o<1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this._errorStrings[4].toString()}return(1-Math.exp(this._gammaln((s+o)/2)-this._gammaln(s/2)-this._gammaln(o/2)+s/2*Math.log(s/o))*this._fdist(n,parseInt(s.toString()),parseInt(o.toString()))).toString()},this.computeGeomean=function(e){var t,i,r,l,n,s,o,a=1,d=0;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(this.adjustRangeArg(e),r=this.splitArgsPreservingQuotedCommas(e),l=0;l<r.length;l++)if(r[l].indexOf(":")>-1){if(l[0]==this.tic){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}for(n=this.getCellsFromArgs(r[l]),s=0;s<n.length;s++){try{t=this.getValueFromArg(n[s])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(t.length>0)if(i=this._parseDouble(t),isNaN(i)){if(-1==this.getErrorStrings().indexOf(t))return t}else d++,a*=i}}else{try{t=this.getValueFromArg(r[l])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(t.length>0){if(this.getEnableFormulaErrorValidation()&&(o=this.formulaErrorStringCheck(t,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(o)>-1))return o;if(i=this._parseDouble(t),isNaN(i)){if(-1==this.getErrorStrings().indexOf(t))return t}else d++,a*=i}}return d>0&&(a=Math.pow(a,1/d)),a.toString()},this.computeHarmean=function(e){var t,i,r,l,n,s,o,a=0,d=0;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(this.adjustRangeArg(e),r=this.splitArgsPreservingQuotedCommas(e),l=0;l<r.length;l++)if(r[l].indexOf(":")>-1){if(l[0]==this.tic){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}for(n=this.getCellsFromArgs(r[l]),s=0;s<n.length;s++){try{t=this.getValueFromArg(n[s])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(t.length>0)if(i=this._parseDouble(t),isNaN(i)||0==i){if(-1==this.getErrorStrings().indexOf(t))return t}else d++,a+=1/i}}else{try{t=this.getValueFromArg(r[l])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return e}if(t.length>0){if(this.getEnableFormulaErrorValidation()&&(o=this.formulaErrorStringCheck(t,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(o)>-1))return o;if(i=this._parseDouble(t),isNaN(i)||0==i){if(this.getErrorStrings().indexOf(t))return t}else d++,a+=1/i}}return d>0&&(a=d/a),a.toString()},this.computeIntercept=function(e){var t,i,r,l,n,s,o,a=this.splitArgsPreservingQuotedCommas(e);if(2!=a.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(value1=this.getValueFromArg(a[0]),value2=this.getValueFromArg(a[1]),value1.toString().toUpperCase()==this.trueValueStr||value1.toString().toUpperCase()==this.falseValueStr||value2.toString().toUpperCase()==this.trueValueStr||value2.toString().toUpperCase()==this.falseValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}var d=this._getDoubleArray(a[0]),h=this._getDoubleArray(a[1]),c=h.length;if(c<=0||c!=d.length)return this.formulaErrorStrings[this._wrong_number_arguments];for(i=0,r=0,o=0;o<c;++o)i+=h[o],r+=d[o];for(i/=c,r/=c,l=0,n=0,o=0;o<c;++o)l+=(s=h[o]-i)*(d[o]-r),n+=s*s;return(r-l/n*i).toString()},this.computeCountblank=function(e){var t,i,r,l,n,s,o,a,d=0;if(this.adjustRangeArg(e),i=this.splitArgsPreservingQuotedCommas(e),""==e||i.length>1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(l=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(l)>-1))return l;for(n=0;n<i.length;n++)if((r=i[n]).indexOf(":")>-1)for(s=this.getCellsFromArgs(r),o=0;o<s.length;o++){try{t=this.getValueFromArg(s[o])}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}t==this._string_empty&&d++}else{try{t=this.getValueFromArg(i)}catch(e){if(this._rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException())throw this.getLibraryComputationException();return this.getErrorStrings()[4].toString()}if(!this._isCellReference(r)){if(a=this._parseDouble(t),!isNaN(a)||this.getErrorStrings.indexOf(t)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments].toString();return this.formulaErrorStrings[this._invalid_arguments].toString()}if(t.split(this.tic).join(this._string_empty)==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments].toString();return this.formulaErrorStrings[this._invalid_arguments].toString()}if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[5].toString();return this.getErrorStrings()[5].toString()}t==this._string_empty&&d++}return d.toString()},this.computeDevsq=function(e){this.splitArgsPreservingQuotedCommas(e);var t,i,r,l,n,s=this._getDoubleArray(e),o=s.length;if(""==e)return this.formulaErrorStrings[this._wrong_number_arguments];if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(i)>-1))return i;if(s.length<=0){if(null!=this.getLibraryComputationException())throw this.formulaErrorStrings[this._bad_formula];throw this.getErrorStrings()[4].toString()}for(r=0,n=0;n<o;++n)r+=s[n];for(r/=o,l=0,n=0;n<o;++n)l+=(t=s[n]-r)*t;return l.toString()},this.computeForecast=function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m=this.splitArgsPreservingQuotedCommas(e);if(3!=m.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(m[0],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(g=1;g<=2;g++)if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(m[g],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1))return i;if(n="TRUE"==(n=this.getValueFromArg(m[0])).split(this.tic).join("")?"1":"FALSE"==n.split(this.tic).join("")?"0":n,r=this._parseDouble(n),isNaN(r)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(s=this._getDoubleArray(m[1]),(a=(o=this._getDoubleArray(m[2])).length)<=0||a!=s.length)return this.formulaErrorStrings[this._wrong_number_arguments];for(d=0,h=0,g=0;g<a;++g)d+=o[g],h+=s[g];for(d/=a,h/=a,c=0,u=0,g=0;g<a;++g)c+=(l=o[g]-d)*(s[g]-h),u+=l*l;return(h-(p=c/u)*d+p*r).toString()},this.computeStdevOp=function(e){var t,i;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1))return t;if((i=this._getDoubleArrayA(e)).length<2){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.formulaErrorStrings[this.invalid_arguments]}return this._stdevdotP(i).toString()},this.computeStdevOS=function(e){var t,i;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1))return t;if((i=this._getDoubleArrayA(e)).length<2){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this.formulaErrorStrings[this.invalid_arguments]}return 0,this._sd(i,0).toString()},this.computeStdeva=function(e){var t,i,r;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1)?t:(i=this._getDoubleArrayA(e)).length<2?this.formulaErrorStrings[this._invalid_arguments]:(r=0,this._sd(i,r).toString())},this.computeStdevpa=function(e){var t,i,r,l;if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1)?t:(r=(i=this._getDoubleArrayA(e)).length)<2?this.formulaErrorStrings[this._invalid_arguments]:(l=0,(this._sd(i,l)*Math.sqrt(r-1)/Math.sqrt(r)).toString())},this.computeVarp=function(e){var t=this._getDoubleArray(e.split(this.tic).join(this._string_empty)),i=t.length;return((i-1)*this._var(t)/i).toString()},this.computeVara=function(e){var t=this._getDoubleArrayA(e);return this._var(t).toString()},this.computeVarpa=function(e){var t=this._getDoubleArrayA(e),i=t.length;return((i-1)*this._var(t)/i).toString()},this.computeCorrel=function(e){var t,i,r,l,n,s,o,a,d,h,c=this.splitArgsPreservingQuotedCommas(e);if(2!=c.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.getValueFromArg(c[0]),r=this.getValueFromArg(c[1]),null==i||""==i||null==r||""==r){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this._errorStrings[1].toString()}if(l=this._getDoubleArray(c[0]),(s=(n=this._getDoubleArray(c[1])).length)<=0||s!=l.length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this._errorStrings[0].toString()}for(o=0,a=0,d=0;d<s;++d)o+=n[d],a+=l[d];o/=s,a/=s;var u=0,g=0,p=0,m=0,_=0;for(d=0;d<s;++d)u+=(m=n[d]-o)*(_=l[d]-a),g+=m*m,p+=_*_;if(h=(u/Math.sqrt(g*p)).toString(),this.computeIsError(h)==this.trueValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this._errorStrings[3].toString()}return(u/Math.sqrt(g*p)).toString()},this.computeNegbinomODist=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(4!=o)return this.formulaErrorStrings[this._wrong_number_arguments];for(l=0,n=0;n<o;++n)s[n]=this.getValueFromArg(s[n]);return i=this._parseDouble(s[0]),t=this._parseDouble(s[1]),r=this._parseDouble(s[2]),isNaN(i)||isNaN(t)||isNaN(r)||(l=this._negbinomdensity(parseInt(i.toString()),parseInt(t.toString()),r)),l.toString()},this.computePercentileExc=function(e){var t,i,r,l,n,s,o,a,d=this.splitArgsPreservingQuotedCommas(e);if(2!=d.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(t=this.formulaErrorStringCheck(d[0],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)return t;if(i=this.formulaErrorStringCheck(d[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)return i}if(l=this.getValueFromArg(d[1]),n=this.getValueFromArg(d[0]),null==l||""==l||""==n||null==n||Boolean("TRUE"==l||"FALSE"==l)||Boolean("TRUE"==n||"FALSE"==n)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}if(r=this._parseDouble(l),isNaN(r)&&(r<0||r>1))return this.formulaErrorStrings[this._invalid_arguments];if(0==(s=this._parseDouble(l))||s<=0||s>=1){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if((o=this._getDoubleArray(d[0])).length,o.sort(function(e,t){return isNaN(e)||isNaN(t)?e<t?1:-1:e-t}),a=o.length,r<=this._parseDouble((1/(a+1)).toString())||r>=this._parseDouble((a/(a+1)).toString())){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return(r*(a+1)).toString()},this.computePercentileOInc=function(e){var t,i,r,l,n,s,o,a,d,h,c=this.splitArgsPreservingQuotedCommas(e);if(2!=c.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(c[0],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(c[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)))return t;if(r=this.getValueFromArg(c[1]),l=this.getValueFromArg(c[0]),null==r||""==r||null==l||""==l||Boolean("TRUE"==r||"FALSE"==r)||Boolean("TRUE"==l||"FALSE"==l)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}if(i=this._parseDouble(r),isNaN(i)&&(i<0||i>1))return this.formulaErrorStrings[this._invalid_arguments];if(0==(n=this._parseDouble(r))||n<0||n>1){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}for(o=(s=this._getDoubleArray(c[0])).length,s.sort(function(e,t){return e-t}),a=1/(o-1),d=s[o-1],h=0;h<o-1;++h)if((h+1)*a>i){i=(i-h*a)/a,d=s[h]+i*(s[h+1]-s[h]);break}return d.toString()},this.computeTrimmean=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e);if(2!=o.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(t=this.formulaErrorStringCheck(o[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)return t;if(i=this.formulaErrorStringCheck(o[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)return i}if(l="TRUE"==(l=this.getValueFromArg(o[1])).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l,r=this._parseDouble(l),isNaN(r)&&(r="1"),r>=1||0==r||r<0){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}var a=this._getDoubleArray(o[0]),d=a.length,h=parseInt((r*d).toString());for(h=parseInt(h/2),a.sort(function(e,t){return isNaN(e)||isNaN(t)?e>t?1:-1:e-t}),n=0,d-=h,s=h;s<d;++s)n+=a[s];return(n/(d-h)).toString()},this.computePearson=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(2!=r.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1))return t;if(null==r[0]||""==r[0]||null==r[1]||""==r[1]||Boolean("TRUE"==r[0]||"FALSE"==r[0])||Boolean("TRUE"==r[1]||"FALSE"==r[1])){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}var l=this._getDoubleArray(r[0]),n=this._getDoubleArray(r[1]),s=l.length;if(s<=0||!isNaN(l)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[4].toString()}if(i=this._pearson(n,l,s).toString(),this.computeIsErr(i)==this.trueValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[3].toString()}return i},this.computeRsq=function(e){var t,i,r;if(2!=this.splitArgsPreservingQuotedCommas(e).length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1))return t;if(i=this.computePearson(e).toString(),r=0,r=this._parseDouble(i),isNaN(r)){if(-1!=this.getErrorStrings().indexOf(i))return i}else r*=r;return r.toString()},this.computeHLookUp=function(e){var t,i,r,l,n,s,o,a,d,h,c,u=this._isHLookupCachingEnabled(),g=this._isOptimizedMatchesEnabled();if(u&&null==this._lookupTables&&(this.lookupTables=new HashTable),(t=this.splitArgsPreservingQuotedCommas(e)).length>4||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(i=this.formulaErrorStringCheck(t[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1||(i=this.formulaErrorStringCheck(t[1],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(i)>-1))return i;for(o=2;o<t.length;o++)if(i=this.formulaErrorStringCheck(t[o],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1)return i}r=(r=this.getValueFromArg(t[0])).split(this.tic).join("").toUpperCase();var p=t[1].split('"').join(""),m=this.getValueFromArg(t[2]).split(this.tic).join(""),_=this._parseDouble(m);if(isNaN(_))return"#N/A";l=parseInt(m),n=!0,4==t.length&&(n=this.getValueFromArg(t[3])==this.trueValueStr),_=this._parseDouble(r),s=!!n&&!isNaN(_),-1==(o=p.indexOf(":"))&&(o=(p=p+":"+p).indexOf(":"));var f=p.substring(0,o).lastIndexOf(this.sheetToken),b=this.grid,C=CalcEngine.getSheetFamilyItem(this.grid);if(f>-1&&(this.grid=C.tokenToParentObject.getItem(p.substring(0,f+1))),a=this.rowIndex(p.substring(0,o)),d=this.rowIndex(p.substring(o+1)),!(-1!=a||-1==d)==(-1==a||-1!=d))return this.getErrorStrings()[5].toString();var S=this.colIndex(p.substring(0,o)),x=this.colIndex(p.substring(o+1)),v=!1,w="",I=null,y=null;u&&(w=a.toString()+"_"+S.toString()+"_"+x.toString()+"_"+this.grid.GetHashCode(),this._lookupTables.containsKey(w)||(g?((h=new LookUps).setMatchLookUpList(new HashTable),this._lookupTables.add(w,h)):(h=new LookUps,this._lookupTables.add(w,h)),v=!0),I=this._lookupTables.getItem(w).getLinearLookUpList(),g&&(y=this._lookupTables.getItem(w).getMatchLookUpList()));var T="",L=S,R="",O=0,F=!0,E=!1;if(u&&g&&y.containsKey(r))L=y.getItem(r),R=r;else for(c=S;c<=x;++c){if(!u||c-S>=I.length||v?(R=this.getValueFromParentObject(this.grid,a,c).toString().toUpperCase().split('"').join(""),u&&(I.push(R),g&&y.add(R,c))):R=I[c-S],O=s?this._parseDouble(R):O,R==r||n&&(s?!isNaN(O)&&O>_:R>r)){if(R==r&&(L=c,n=!0,E=!0),!v)break;F=!1}F&&(L=c),n=v=!0}if(n||R==r){if(!E&&!s)return this.grid=b,"#N/A";if(l+a-1>d)return"#REF!";(T=this.getValueFromParentObject(this.grid,l+a-1,L).toString()).length>0&&T[0]==this.getFormulaCharacter()&&(T=this.parseFormula(T)),_=this._parseDouble(T),T.length>0&&T[0]!=this.tic[0]&&isNaN(_)&&(T=T)}else T="#N/A";return this.grid=b,T},this.computeIndex=function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=this.splitArgsPreservingQuotedCommas(e),C=b.length;if(C<2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(b[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1||3==C&&(t=this.formulaErrorStringCheck(b[2],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1)))return t;if(this._isTextEmpty(b[0])||this._isTextEmpty(b[1])||3==C&&this._isTextEmpty(b[2])){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[bad_formula];return this.getErrorStrings()[1].toString()}if(-1==(r=(i=(i=b[0]).split(this.tic).join("")).indexOf(":")))if(this._isCellReference(i))i=i+":"+i;else{if(!(i.indexOf(";")>-1))return this._findArrayIndex(i,b);try{if(!((l=this._splitArguments(i,";"))[0].indexOf(",")>-1))return this._findArrayIndex(i,b);var S=[],x=parseInt(this.splitArgsPreservingQuotedCommas(l[0]).length);for(r=0;r<l.length;r++){if(S[r]=[],x!=(n=this.splitArgsPreservingQuotedCommas(l[r])).length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(v=0;v<x;v++)n[v]="TRUE"==n[v].split(this.tic).join("")?"1":"FALSE"==n[v].split(this.tic).join("")?"0":n[v],S[r][v]=this._parseDouble(this.getValueFromArg(n[v]))}if(s=-1,o=-1,b[1]=this.getValueFromArg(b[1]),b[1]="TRUE"==b[1].split(this.tic).join("")?"1":"FALSE"==b[1].split(this.tic).join("")?"0":b[1],s=this._parseDouble(b[1]),3==C&&(b[2]=this.getValueFromArg(b[2]),b[2]="TRUE"==b[2].split(this.tic).join("")?"1":"FALSE"==b[2].split(this.tic).join("")?"0":b[2],o=this._parseDouble(b[2])),3==C&&s>=0&&o>=0)return 0==s&&0!=o?S[parseInt(s)][parseInt(o)-1].toString():0==o&&0!=s?S[parseInt(s)-1][parseInt(o)].toString():0==o&&0==s?S[0][0].toString():S[parseInt(s)-1][parseInt(o)-1].toString();if(s>=0)return 0==s?S[0][0].toString():S[parseInt(s)-1][0].toString()}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_Math_argument];return this.getErrorStrings()[2].toString()}}return r=i.indexOf(":"),e.indexOf("#N/A")>-1||e.indexOf("#N~A")>-1?"#N/A":e.indexOf("#DIV/0!")>-1||e.indexOf("#DIV~0!")>-1?"#DIV/0!":(a=this._getSheetTokenFromReference(i),b[1]=1==C||""==b[1]?"1":b[1],b[2]=C<=2||""==b[2]?"1":b[2],b[1]=this.getValueFromArg(b[1]),b[1]="TRUE"==b[1].split(this.tic).join("")?"1":"FALSE"==b[1].split(this.tic).join("")?"0":b[1],d=parseInt(b[1]),h=isNaN(d)?-1:d,b[2]=this.getValueFromArg(b[2]),b[2]="TRUE"==b[2].split(this.tic).join("")?"1":"FALSE"==b[2].split(this.tic).join("")?"0":b[2],d=parseInt(b[2]),c=isNaN(d)?-1:d,-1==h||-1==c?"#REF":(u=this.rowIndex(i.substring(0,r)),g=this.rowIndex(i.substring(r+1)),!(-1!=u||-1==g)==(-1==u||-1!=g)?this.getErrorStrings()[5].toString():(p=this.colIndex(i.substring(0,r)),m=this.colIndex(i.substring(r+1)),h>g-u+1||c>m-p+1?"#REF":(h=this.rowIndex(i.substring(0,r))+h-1,c=this.colIndex(i.substring(0,r))+c-1,_=a+RangeInfo.getAlphaLabel(c)+h,f=this.getValueFromArg(_),this._isTextEmpty(f)?"0":f))))},this._findArrayIndex=function(e,t){var i,r,l=this._string_empty,n=-1,s=t.length;if(i=e.indexOf(";")>-1?this._splitArguments(e,";"):this.splitArgsPreservingQuotedCommas(e),t[1]=this.getValueFromArg(t[1]),t[1]="TRUE"==t[1].split(this.tic).join("")?"1":"FALSE"==t[1].split(this.tic).join("")?"0":t[1],r=this._parseDouble(t[1]),3==s&&(t[2]=this.getValueFromArg(t[2]),t[2]="TRUE"==t[2].split(this.tic).join("")?"1":"FALSE"==t[2].split(this.tic).join("")?"0":t[2],n=this._parseDouble(t[2])),3==s&&r>=0&&1==r&&n>=0)i.length>=n&&(l=0==parseInt(n)?i[0]:i[parseInt(n)-1]);else{if(!(r>=0)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(!(i.length>=r)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[2].toString()}l=0==parseInt(r)?i[0]:i[parseInt(r)-1]}return l},this.computeIndirect=function(e){var t,i,r,l,n,s,o;if(e[e.length-1]==this.bMARKER&&(e=this.getValueFromArg(e)),(i=(t=this.splitArgsPreservingQuotedCommas(e)).length)>2||0==i||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(t[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(r)>-1||2==i&&(r=this.formulaErrorStringCheck(t[1],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(r)>-1)))return r;if(t[0]=t[0].toUpperCase(),t[0]=this.setTokensForSheets(t[0]),""!=(l=this._sheetToken(t[0].split(this.tic).join("")))&&(t[0]=t[0].split(l).join("")),2==t.length&&t[1]==this.falseValueStr){var a=t[0][0]==this.tic&&t[0][e[0].length-1]==this.tic,d=t[0].toUpperCase().split(this.tic).join("").split(":"),h=d[0].split("R").join("C").split("C"),c=h.indexOf("");if(c>-1&&h.splice(c,1),h.length>2)return this.getErrorStrings()[2].toString();t[0]=RangeInfo.getAlphaLabel(parseInt(h[1]))+h[0],2==d.length&&((null!=(n=this._sheetToken(d[1]))||""!=n)&&(d[1]=d[1].split(n).join("")),h=d[0].split("R").join("C").split("C"),t[0]+=":"+RangeInfo.getAlphaLabel(parseInt(h[1]))+h[0]),a&&(t[0]=this.tic+t[0]+this.tic)}if(s="",t[0][0]==this.tic)s=l+t[0].split(this.tic).join("");else if(this._isCellReference(t[0])){if(o="",null==(s=this.getValueFromArg(l+t[0]))||""==s)return"0";if(this._isInteriorFunction)return this._isInteriorFunction=!this._isInteriorFunction,t[0].split(this._string_fixedreference).join("");if(o=this._checkIfScopedRange(s.toUpperCase()),this.getNamedRanges().containsKey(s.toUpperCase()))s=(s=(s=this.getNamedRanges().getItem(s.toUpperCase())).toUpperCase()).split(this._string_fixedreference).join(""),(s=this.setTokensForSheets(s))[0]!=this.sheetToken&&(s=l+s);else{if("NaN"==o)return this._isCellReference(s)?this.getValueFromArg(s):s.indexOf(!1)?this.getErrorStrings()[2].toString():s;s=(s=(s=o).toUpperCase()).split(this._string_fixedreference).join(""),(s=this.setTokensForSheets(s))[0]!=this.sheetToken&&(s=l+s)}}else s=t[0];if(!this._isCellReference(s.split(this._string_fixedreference).join("")))if(o="",o=this._checkIfScopedRange(s.toUpperCase()),this.getNamedRanges().containsKey(s.toUpperCase()))(s=this.getNamedRanges().getItem(s.toUpperCase()))[0]!=this.sheetToken&&(s=l+s);else{if("NaN"==o)return this.getErrorStrings()[2].toString();(s=o)[0]!=this.sheetToken&&(s=l+s)}return s.indexOf(":")>-1&&this._isInteriorFunction||this.computedValueLevel>1?(this._isInteriorFunction=!this._isInteriorFunction,s.split(this._string_fixedreference).join("")):this.getValueFromArg(s)},this.computeLookUp=function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S=this._isHLookupCachingEnabled(),x=(this._isOptimizedMatchesEnabled(),{value:!1});if(S&&null==this._lookupTables&&(this.lookupTables=new HashTable),(t=this.splitArgsPreservingQuotedCommas(e)).length>3||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(i=this.formulaErrorStringCheck(t[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1)return i;for(L=1;L<t.length;L++)if(i=this.formulaErrorStringCheck(t[L],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(i)>-1)return i}r=(r=this.getValueFromArg(t[0])).split(this.tic).join("").toUpperCase();var v=0,w="",I=t[1].split('"').join(""),y=(this.getValueFromArg(t[0]),[]),T=[];if(2==t.length)if(t[1],this.splitArgsPreservingQuotedCommas(t[1]),t[1].indexOf(";")>-1)if(1==(l=this._splitArguments(t[1],";")).length)for(o=this.splitArgsPreservingQuotedCommas(l[0].toUpperCase()),a=0;a<o.length;a++)y.push(this.getValueFromArg(o[a]).toUpperCase()),T.push(this.getValueFromArg(o[a]).toUpperCase());else if(2==l.length){for(s=this.splitArgsPreservingQuotedCommas(l[0].toUpperCase()),n=this.splitArgsPreservingQuotedCommas(l[1].toUpperCase()),a=0;a<s.length;a++)y.push(this.getValueFromArg(s[a]).toUpperCase());for(a=0;a<n.length;a++)T.push(this.getValueFromArg(n[a]).toUpperCase())}else for(C=0;C<l.length;C++)s=this.splitArgsPreservingQuotedCommas(l[C].toUpperCase()),y.push(this.getValueFromArg(s[0]).toUpperCase()),T.push(this.getValueFromArg(s[1]).toUpperCase());else if(t[1].indexOf(":")>-1)for(d=this.getCellsFromArgs(t[1]),c=0;c<d.length;c++)y.push(this.getValueFromArg(d[c]).toUpperCase()),T.push(this.getValueFromArg(d[c]).toUpperCase());else for(o=this.splitArgsPreservingQuotedCommas(t[1].toUpperCase()),a=0;a<o.length;a++)y.push(this.getValueFromArg(o[a]).toUpperCase()),T.push(this.getValueFromArg(o[a]).toUpperCase());else if(3==t.length){if(I.indexOf(":")>-1){var L=I.indexOf(":"),R=this.colIndex(I.substr(0,L)),O=this.colIndex(I.substr(L+1,I.length-L-1));for(v=O>R?O-R+1:R-O+1,d=this.getCellsFromArgs(I),c=0;c<d.length;c++)try{y.push(this.getValueFromArg(d[c]))}catch(e){return this.getErrorStrings()[0].toString()}}else for(h=this.splitArgsPreservingQuotedCommas(t[1]),c=0;c<h.length;c++)try{y.push(this.getValueFromArg(h[c]))}catch(e){return this.getErrorStrings()[0].toString()}if(m=t[2],I.indexOf(":")>-1&&-1==m.indexOf(":")||this.getCellsFromArgs(t[1]).length>this.getCellsFromArgs(t[2]).length?m=this.getResultRange(I,m,x):x.value=!0,!this._isCellReference(m))return this.getErrorStrings()[0].toString();if(m.indexOf(":")>-1)for(d=this.getCellsFromArgs(m),c=0;c<d.length;c++)try{T.push(this.getValueFromArg(d[c]))}catch(e){return this.getErrorStrings()[0].toString()}else for(h=this.splitArgsPreservingQuotedCommas(t[1]),c=0;c<h.length;c++)try{T.push(this.getValueFromArg(h[c]))}catch(e){return this.getErrorStrings()[0].toString()}}if(-1==y.indexOf(r)){for(u=y[0],g=0,p=0;p<y.length;p++)if(m=this._parseDouble(r),isNaN(m)){if(y[p]>u&&r>y[p]&&u>r||r>y[p])u=r>y[p]?y[p]:y[p+1],g++;else if(0!=g)break}else _=this._parseDouble(y[p]),!isNaN(_)&&m>=_&&(u=y[p],g++);if(0==g)return this.getErrorStrings()[0].toString();r=u}if(f=0,b=0,3==t.length&&t[2].indexOf(":")>-1){for(C=0;C<y.length;C++)if(y[C]==r){b=y.indexOf(r);break}w=x.value?T[b]:T[b/v]}else{for(C=0;C<y.length;C++)if(y[C]==r)v=y.indexOf(r),f++;else if(0!=f)break;w=T[v+f-1]}return x.value=!1,w},this.getResultRange=function(e,t,i){var r,l=this._string_empty,n=e.indexOf(":"),s=this.rowIndex(e.substr(0,n)),o=this.rowIndex(e.substr(n+1)),a=this.colIndex(e.substr(0,n)),d=this.colIndex(e.substr(n+1)),h=0,c=0;if(s==o)h=this.rowIndex(t),c=this.colIndex(t)+(d-a);else{if(a!=d)return t;h=this.rowIndex(t),c=this.colIndex(t)+(o-s)}return l=RangeInfo.getAlphaLabel(c),t.indexOf(":")>-1?(r=t.indexOf(":"),h=this.rowIndex(t.substr(0,r)),l=t.substr(0,r)+":"+l+h):l=t+":"+l+h,i.value=!0,l},this.computeOffSet=function(e){var t,i,r,l,n,s,o,a,d,h=this.splitArgsPreservingQuotedCommas(e),c=h.length;if(c<3||c>5||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()){if(t=this.formulaErrorStringCheck(h[0],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)return t;for(i=1;i<c;i++)if(i<=c&&(t=this.formulaErrorStringCheck(h[i],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t}var u=h[0],g=this._parseDouble(this.getValueFromArg(h[1])),p=isNaN(g)?-1:parseInt(g.toString());g=this._parseDouble(this.getValueFromArg(h[2])),r=isNaN(g)?-1:parseInt(g.toString()),l=c>=4?h[3]:"-1",g=parseInt(this.getValueFromArg(l)),n=isNaN(g)?1:g,s=5==c?h[4]:"-1",g=parseInt(this.getValueFromArg(s));var m=isNaN(g)?1:g,_=u.indexOf(":"),f=-1==_;f&&(_=(u=u+":"+u).indexOf(":")),f=f&&m<=1&&n<=1,-1==m&&(f=!0);var b=this._getSheetTokenFromReference(u),C=this.rowIndex(u.substring(0,_))+p;this.rowIndex(u.substring(_+1));return!(-1!=this.rowIndex(u.substring(0,_))||-1!=this.rowIndex(u.substring(_+1)))==(-1==this.rowIndex(u.substring(0,_))||-1!=this.rowIndex(u.substring(_+1)))?this.getErrorStrings()[5].toString():(o=this.colIndex(u.substring(0,_))+r,a=this.colIndex(u.substring(_+1))+r,C<=0||o<=0?this.getErrorStrings()[2].toString():((n>0&&m<0||n<1&&m>1)&&(C=this.rowIndex(this.cell)),a==parseInt(this.computeColumn(u))-1&&(f=!0),d=b+RangeInfo.getAlphaLabel(o)+C,f?this.computedValue(d):d+":"+RangeInfo.getAlphaLabel(o+m-1)+(C+n-1)))},this.computeTranspose=function(e){var t,i,r,l,n,s,o,a,d,h=this.splitArgsPreservingQuotedCommas(e);if(1!=h.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(!this._isCellReference(e)&&!this.getNamedRanges().containsKey(e)&&-1==e.indexOf(";")){if(1==(o=this._splitArguments(e.split(this.tic).join(""),";")).length)return this.getValueFromArg(this.splitArgsPreservingQuotedCommas(o[0])[0]);if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.formulaErrorStrings[this._invalid_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(1!=(h=this.splitArgsPreservingQuotedCommas(e)).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(s="",e.indexOf(";")>-1){for(o=this._splitArguments(e.split(this.tic).join(""),";"),a=1;a<o.length;a++)if(this.splitArgsPreservingQuotedCommas(o[a-1]).length!=this.splitArgsPreservingQuotedCommas(o[1]).length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}s=this.splitArgsPreservingQuotedCommas(o[0])[0]}else{d=this.getCellsFromArgs(e),i=this.rowIndex(d[0].toString()),r=this.rowIndex(d[d.length-1].toString()),l=this.colIndex(d[0].toString()),n=this.colIndex(d[d.length-1].toString());var c,u,g=this.cell,p=this.colIndex(g),m=this.rowIndex(g),_=r-i+1,f=n-l+1;this._getFormulaArrayBounds(this.cell,_,f),c=this._getFormulaArrayBoundsfirstRowIndex,u=this._getFormulaArrayBoundsfirstColIndex,this._getFormulaArrayBoundslastRowIndex,this._getFormulaArrayBoundslastColIndex;var b=m-c,C=p-u,S=e.indexOf(":");-1==S&&(S=(e=e+":"+e).indexOf(":"));var x=e.substring(0,S).lastIndexOf(this.sheetToken),v=this.grid,w=CalcEngine.getSheetFamilyItem(this.grid);x>-1&&(this.grid=w.tokenToParentObject[e.substring(0,x+1)]),s=this._getValueComputeFormulaIfNecessary(i+C,l+b,this.grid),this.grid=v}return(null==s||""==s)&&(s="0"),s},this.computeEncodeURL=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(1!=r.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(!this._isCellReference(r[0])&&!this.getNamedRanges().containsKey(r[0])&&-1==r[0].indexOf(this.tic)&&isNaN(this._parseDouble(r[0]))&&!Boolean("TRUE"==r[0]||"FALSE"==r[0])){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[5]}return i=this._stripTics0(this.getValueFromArg(r[0])),encodeURIComponent(i)},this.ComputeCOUNTIFS=function(e){return this.computeCountIFFunctions(e,!1)},this.computeAnd=function(e){var t,i,r,l,n,s,o,a=!0;if(null==e||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.formulaErrorStrings[this._bad_formula]}for(r=this.splitArgsPreservingQuotedCommas(e),l=0;l<r.length;l++){if(r[l]==this.tic){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if(r[l].indexOf(":")>-1)for(cells=this.getCellsFromArgs(r[l]),n=0;n<cells.length;n++){if(this.getErrorStrings().indexOf(cells[n])>-1)return cells[n];if(cells[n][0]==this.tic){if(this.getRethrowLibraryComputationExceptions)throw(new this.getErrorStrings)[5].toString();return this.getErrorStrings()[5].toString()}try{if(t=this.getValueFromArg(cells[n]),this.getErrorStrings().indexOf(t)>-1)return t}catch(e){if(this.rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}a&=""==t||(t.split(this.tic).join("").toUpperCase()==this.trueValueStr||(i=this._parseDouble(t))&&0!=i)}else{try{if(t=this.getValueFromArg(r[l]),this.getErrorStrings().indexOf(t)>-1)return t;if(s=Date.parse(t.split(this.tic).join("")),i=this._parseDouble(t.split(this.tic).join("")),!isNaN(s))return this.trueValueStr;if(isNaN(i)&&t!=this._string_empty&&t.split(this.tic).join("").toUpperCase()!=this.trueValueStr&&t.split(this.tic).join("").toUpperCase()!=this.falseValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this._isCellReference(r[l])||t[0]==this.tic?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}}catch(e){if(this.getRethrowLibraryComputationExceptions()&&null!=this.getLibraryComputationException())throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}o=this._parseDouble(t),a&=t.split(this.tic).join("").toUpperCase()==this.trueValueStr||!isNaN(o)&&0!=i}}return a?this.trueValueStr:this.falseValueStr},this.computeFalse=function(e){var t=this.splitArgsPreservingQuotedCommas(e);if(t.length>0&&""!=t){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.falseValueStr},this.computeIf=function(e){var t,i,r,l=this._string_empty,n=this.splitArgsPreservingQuotedCommas(e);if(this.getErrorStrings().indexOf(e)>0)return e;if(1==n.length||n.length>3||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(!(n.length<=3))return this.formulaErrorStrings[this._requires_3_args];try{if(l=this.getValueFromArg(n[0]),-1!=this.getErrorStrings().indexOf(l))return l;if(!this._isCellReference(n[0])&&!isNaN("boolean"==typeof l)&&l.startsWith(this.tic)||this._isCellReference(n[0])&&l.startsWith(this.tic)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(l.split(this.tic).join("")==this.trueValueStr||(t=this._parseDouble(l))&&0!=t){if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(n[1],FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1))return i;if(""==(l=this.getValueFromArg(n[1]))&&this.getTreatStringsAsZero())return"0";l==this._string_empty||l[0]!=this.tic[0]||this._isCellReference(n[1])||(l=l.split(this.tic[0]).join(this._string_empty))}else if(l.split(this.tic).join(this._string_empty)==this.falseValueStr&&n.length<3)l=this.falseValueStr;else if(l.split(this.tic).join(this._string_empty)==this.falseValueStr||l==this._string_empty||(t=this._parseDouble(l))&&0==t){if((l=3==n.length&&this.getValueFromArg(n[2]))==this._string_empty&&this.getTreatStringsAsZero())return"0";if(l==this._string_empty||l[0]!=this.tic[0]||this._isCellReference(n[2])||(l=l.split(this.tic[0]).join(this._string_empty)),-1!=this.getErrorStrings().indexOf(l))return l}else{if(n.indexOf(this.tic)>-1){var s=n[0].indexOf(this.tic)+1,o=n[0].lastIndexOf(this.tic)-1,a=n[0].substring(s,o-s+1);for(r=0;r<this.formulaErrorStrings.length;r++)if(a===r)return r}l="NaN"}}catch(e){if(this.rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException)throw this.getLibraryComputationException;return e}return l},this.computeIfs=function(e){var t,r,l=this._string_empty,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;if(s%2!=0)throw new Error("You have entered too few arguments in this function");for(i=0;i<s;i++){if(l=this.getValueFromArg(n[i]).split(this.tic).join(this._string_empty),-1!=this.getErrorStrings().indexOf(l))return l;if(t=l.split(this.tic).join("").toUpperCase(),r=this._parseDouble(t),!this._isCellReference(n[0])&&t!=this.trueValueStr&&t!=this.falseValueStr&&l[0]==this.TIC||this._isCellReference(n[0])&&l[0]==this.tic||t!=this.trueValueStr&&t!=this.falseValueStr&&isNaN(r)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}if(i++,t==this.trueValueStr||!isNaN(r))return this.getValueFromArg(n[i]).split(this.tic).join(this._string_empty)}return this.getErrorStrings()[0].toString()},this.computeIfError=function(e){var t,i=e.split(this.getParseArgumentSeparator()),r=i[0];if(2!=i.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(i[1],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(r[0]==this.tic)return this.getValueFromArg(i[0]);try{if(r[0]==this.bMARKER&&(r=r.replace(this.bMARKER," "),"NAN"==(r=this._isIE8?r.replace(/^\s+|\s+$/g,""):r.trim())[0]||"-NAN"==r[0]||"INFINITY"==r[0]||"-INFINITY"==r[0]||"#"==r[0]||"n#"==r[0]))return this.getValueFromArg(i[1]);r=i[0],r=this.getValueFromArg(r).toUpperCase().split(this.tic).join(this._string_empty)}catch(e){r=r.toUpperCase()}return"NAN"==r[0]||"-NAN"==r[0]||"INFINITY"==r[0]||"-INFINITY"==r[0]||"#"==r[0]||"n#"==r[0]?this.getValueFromArg(i[1]):this.getValueFromArg(i[0])},this.computeIfNA=function(e){var t=this.splitArgsPreservingQuotedCommas(e),i=t.length,r=this._string_empty;if(2!=i)return this.getFormulaErrorStrings();if(this.computeIsNA(t[0])==this.trueValueStr){if(-1==this.tic.indexOf(t[1])&&!this._isCellReference(t[1])&&!this._parseDouble(t[0])&&!this.namedRanges.containsKey(t[1]))return this.getErrorStrings()[5].toString();r=this.getValueFromArg(t[1])}else if(this._isRange(t[0]))r=this.getErrorStrings()[1].toString();else{if(-1==this.tic.indexOf(t[0])&&!this._isCellReference(t[0])&&!this._parseDouble(t[0])&&!this.NamedRanges.ContainsKey(t[0]))return this.getErrorStrings()[5].toString();r=this.getValueFromArg(t[0])}return r[0]==this.tic&&r[length-1]==this.tic&&(r=this.substring(r,1,r.length-2)),r},this.computeNot=function(e){var t,i=e,r=[this.getParseArgumentSeparator(),":"];if(e.length>0&&this._indexOfAny(e,r)>-1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}try{if(i=this.getValueFromArg(i),-1!=this.getErrorStrings().indexOf(i))return i;if(i==this.trueValueStr)i=this.falseValueStr;else if(i==this.falseValueStr)i=this.trueValueStr;else{if(isNaN(t=this._parseDouble(i))){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}i=Math.abs(t)>1e-10?this.falseValueStr:this.trueValueStr}}catch(e){if(this.rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException)throw this.getLibraryComputationException;return e}return i},this.computeOr=function(e){var t,i,r,l,n=this.falseValueStr,s=this.splitArgsPreservingQuotedCommas(e);if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(r=0;r<s.length;r++)if(s[r].indexOf(":")>-1&&this._isCellReference(r))for(cells=this.getCellsFromArgs(s[r]),l=0;l<cells.length;l++){try{if(t=this.getValueFromArg(cells[l]),-1!=this.getErrorStrings().indexOf(t))return t}catch(e){if(this.rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException)throw this.getLibraryComputationException;return e}n|=t==this.trueValueStr||i==this._parseDouble(t)&&0!=i}else{try{if(t=this.getValueFromArg(s[r]),-1!=this.getErrorStrings().indexOf(t))return t;if(i=this._parseDouble(t.split(this.tic).join("")),isNaN(i)&&t!=this._string_empty&&t.split(this.tic).join("").toUpperCase()!=this.trueValueStr&&t.split(this.tic).join("").toUpperCase()!=this.falseValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this._isCellReference(s[r])||t[0]==this.tic?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}}catch(e){if(this.rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException)throw this.getLibraryComputationException;return e}n|=t==this.trueValueStr||i==this._parseDouble(t)&&0!=i}return n?this.trueValueStr:this.falseValueStr},this.computeTrue=function(){return this.trueValueStr},this.computeXor=function(e){var t,i,r,l,n,s=!1,o=this.splitArgsPreservingQuotedCommas(e);if(""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(r=0;r<o.length;r++)if(o[r].indexOf(":")>-1&&this._isCellReference(r))for(l=this.getCellsFromArgs(o[r]),n=0;n<l.length;n++){try{if(t=this.getValueFromArg(l[n]),-1!=this.getErrorStrings().indexOf(t))return t}catch(e){if(this.rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException)throw this.getLibraryComputationException;return e}i=this._parseDouble(t),s^=t==this.trueValueStr^(!isNaN(i)&&0!=i)}else{try{if(t=this.getValueFromArg(o[r]),-1!=this.getErrorStrings().indexOf(t))return t;if(d=this._parseDouble(t.split(this.tic).join("")),isNaN(d)&&t!=this._string_empty&&t.split(this.tic).join("").toUpperCase()!=this.trueValueStr&&t.split(this.tic).join("").toUpperCase()!=this.falseValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this._isCellReference(o[r])||t[0]==this.tic?this.getErrorStrings()[1].toString():this.getErrorStrings()[5].toString()}}catch(e){if(this.rethrowLibraryComputationExceptions&&null!=this.getLibraryComputationException)throw this.getLibraryComputationException;return e}i=this._parseDouble(t),s^=t==this.trueValueStr^(!isNaN(i)&&0!=i)}return s?this.trueValueStr:this.falseValueStr},this.computeCell=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(l.length>2||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(l[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1||2==l.length&&(t=this.formulaErrorStringCheck(l[1],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)))return t;if(i="",2==l.length){if(!this._isCellReference(l[1])&&!this.namedRanges.containsKey(l[1])){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[5].toString()}i=l[1]}else i=this.cell;switch(r="",l[0].split(this.tic).join(this._string_empty).toLowerCase()){case"address":r=this.rowIndex(i).toString()+this.getParseArgumentSeparator()+this.colIndex(i).toString(),r=this.computeAddress(r);break;case"col":r=this.computeColumn(i);break;case"contents":r=this.getValueFromArg(i);break;case"filename":r="Not Supported";break;case"row":r=this.computeRow(i);break;case"type":r=this.computeIsBlank(i)==this.trueValueStr?"b":this.computeIsText(i)==this.trueValueStr?"l":"v"}if(""==r){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}return r.toString()},this.computeErrorType=function(e){var t,i=this._string_empty;if(1!=this._splitArguments(e,this.getParseArgumentSeparator()).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1)?t:(i=this._isCellReference(e)?this.getValueFromArg(e):e).length>1&&i[0]==this.tic[0]&&i[i.length-1]==this.tic[0]?"#N/A":"#NULL!"==i?"1":"#DIV/0!"==i?"2":"#VALUE!"==i?"3":"#REF!"==i?"4":"#NAME?"==i?"5":"#NUM!"==i?"6":"#N/A"==i?"7":"#GETTING_DATA"==i?"8":"#N/A"},this.computeInfo=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e);if(1!=n.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;switch(i=this._stripTics0(this.getValueFromArg(n[0])).toLowerCase(),r=this._string_empty,i){case"directory":r=window.location.toString();break;case"numfile":r=null!=this.getSortedSheetNames()&&0==CalcEngine._sheetFamiliesList.length?this.getSortedSheetNames().length.toString():"1";break;case"origin":l=this.rowIndex(this.cell).toString()+this.getParseArgumentSeparator()+this.colIndex(this.cell).toString(),r="$A: "+this.computeAddress(l);break;case"osversion":r=navigator.platform.toString();break;case"recalc":r=this._alwaysComputeDuringRefresh?"Automatic":"Manual";break;case"release":r=this.System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.toString();break;case"system":switch(navigator.appVersion.indexOf()){case navigator.platform:r="unix";break;case navigator.platform:r="mac";break;default:r="pcdos"}break;default:if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}return r},this.computeIsBlank=function(e){if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return""==this.getValueFromArg(e)?this.trueValueStr:this.falseValueStr},this.computeIsErr=function(e){if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return(e=this.getValueFromArg(e).toUpperCase().split(this.tic).join(this._string_empty)).count,(e.startsWith("NAN")||e.startsWith("-NAN")||e.startsWith("INFINITY")||e.startsWith("-INFINITY")||e.startsWith("#")||e.startsWith("n#"))&&!e.startsWith("#N/A")?this.trueValueStr:this.falseValueStr},this.computeIsError=function(e){if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}try{e=this.getValueFromArg(e).toUpperCase().split(this.tic).join(this._string_empty)}catch(e){return this.trueValueStr}return 0==e.indexOf("NAN")||0==e.indexOf("-NAN")||0==e.indexOf("INFINITY")||1==e.indexOf("-INFINITY")||0==e.indexOf("#")||0==e.indexOf("n#")?this.trueValueStr:this.falseValueStr},this.computeIsEven=function(e){this._string_empty;var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e);if(1!=s.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=this.getValueFromArg(s[0]),i=parseInt(t.split(this.tic).join("")),this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(r)>-1))return r;if(l=new Date(Date.parse(t)),isNaN(i)&&"invalid Date"!=l.toString()&&(i=this._toOADate(l)),n=i,isNaN(i)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}return n%2==0?this.trueValueStr:this.falseValueStr},this.computeIsFormula=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e),l=r.length,n=this._string_empty;if(1!=l||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1))return t;if(n=this.getValueFromArg(r[0]),this.namedRanges.containsValue(n)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[1].toString()}return i=CalcEngine.getSheetFamilyItem(this.grid),this.isSheetMember()&&null!=i.parentObjectToToken&&(r[0]=i.parentObjectToToken.getItem(this.grid)+r[0]),this.getFormulaInfoTable().containsKey(r[0])?this.trueValueStr:this.falseValueStr},this.computeIsLogical=function(e){if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return(e=this.getValueFromArg(e))==this.falseValueStr||e==this.trueValueStr?this.trueValueStr:this.falseValueStr},this.computeIsNA=function(e){if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(e=this.getValueFromArg(e),-1!=this.getErrorStrings().indexOf(e.toUpperCase()))return"#N/A"==e.toUpperCase()?this.trueValueStr:this.falseValueStr;try{e=this.getValueFromArg(e).toUpperCase()}catch(e){return this.falseValueStr}return"#N/A"==e[0]?this.trueValueStr:this.falseValueStr},this.computeIsNonText=function(e){if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return this.computeIsText(e)==this.trueValueStr?this.falseValueStr:this.trueValueStr},this.computeIsNumber=function(e){if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return e=this.getValueFromArg(e),isNaN(this._parseDouble(e))?this.falseValueStr:this.trueValueStr},this.computeIsRef=function(e){var t=this.splitArgsPreservingQuotedCommas(e);if(t.length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(1!=t.length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return((this.namedRanges.containsKey(e)||this._isCellReference(e))&&e[0]!=this.tic&&e[length-1]!=this.tic).toString().toUpperCase()},this.computeIsOdd=function(e){var t,i=this._string_empty,r=0,l=this._splitArguments(e,this.getParseArgumentSeparator()),n=l.length,s=[this.getParseArgumentSeparator(),":"];if(1!=n||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e!=this._string_empty){if(-1!=this._indexOfAny(e,s))return"#VALUE!";if(i=this.getValueFromArg(l[0]),r=parseInt(i.split(this.tic).join(this._string_empty)),isNaN(r)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}return r%2!=0?this.trueValueStr:this.falseValueStr}return this.trueValueStr},this.computeIsText=function(e){var t,i;if(this.splitArgsPreservingQuotedCommas(e).length>1||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return i=(t=this._isCellReference(e))?this.getValueFromArg(e):e,(t||i[0]==this.tic)&&i.length>0&&isNaN(this._parseDouble(i))?this.trueValueStr:this.falseValueStr},this.computeN=function(e){var t,i,r=this._string_empty,l=0;if(1!=this._splitArguments(e,this.getParseArgumentSeparator()).length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(i)>-1))return i;if(r=this.getValueFromArg(e),t=new Date(Date.parse(r)),this._parseDouble(r))return(l=this._parseDouble(r)).toString();if(new Date(Date.parse(r))&&(l=this._getSerialDateTimeFromDate(t)),r==this.trueValueStr)l=1;else{if(r!=this.falseValueStr)return this.getErrorStrings().indexOf(r)>-1||this.formulaErrorStrings.indexOf(r)>-1?r:isNaN(l)?"0":l.toString();l=0}return l.toString()},this.computeNA=function(e){var t=this.splitArgsPreservingQuotedCommas(e);if(t.length>0&&""!=t){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}return"#N/A"},this.computeSheet=function(e){var t,i,r,l,n=this.splitArgsPreservingQuotedCommas(e),s=n.length;this._string_empty;if(s>1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1))return t;if(null==(i=null==(i=n[0].toUpperCase())||i==this._string_empty?this.cell:i)||i==this._string_empty)return"1";if(this.getErrorStrings().indexOf(i)>-1)return i;if(!this._isCellReference(i)&&!this.namedRanges.containsKey(i)&&this.getSortedSheetNames().indexOf(i)>-1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[0].toString()}var o=CalcEngine.getSheetFamilyItem(this.grid),a=this._getSheetTokenFromReference(i),d=0;if(null!=a&&a!=this._string_empty||-1!=this.getSortedSheetNames().indexOf(i)||i.indexOf(this.sheetToken.toString()))if(a.length>0)d=parseInt(a.split(this.sheetToken).join(this._string_empty))+1;else try{for(r=0;r<o.tokenToParentObject.length;r++)if(o.sheetNameToParentObject.getItem(i.split(this.tic).join(this._string_empty))==o.tokenToParentObject.values()[r]){l=o.tokenToParentObject.values()[r],d=this.getSheetID(l)+1;break}}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[2].toString()}else d=this.getSheetID(this.grid)+1;return d.toString()},this.computeSheets=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=l.length;this._string_empty;if(n>1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(t=0,i=l[0].toUpperCase(),this.getErrorStrings().indexOf(i)>-1)return i;if(null==i||i==this._string_empty)return this.getSortedSheetNames().length.toString();if(this.getEnableFormulaErrorValidation()){if(r=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(r)>-1)return r}else{if(""==i.split(this.tic).join(this._string_empty)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[5].toString()}if(!this._isCellReference(i)&&!this.namedRanges.containsKey(i)&&this.getSortedSheetNames().indexOf(i)>-1){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._bad_formula];return this.getErrorStrings()[0].toString()}}try{t=(this._splitArguments(i,"!").length-1)/2}catch(e){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[2].toString();return this.getErrorStrings()[2].toString()}return t.toString()},this.computeType=function(e){var t,i=this.splitArgsPreservingQuotedCommas(e),r=0;if(1!=i.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(null==(t=this.getValueFromArg(i[0]))||t==this._string_empty){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}return e.indexOf(this.getParseArgumentSeparator())>-1?r=64:this.computeIsNumber(t)==this.trueValueStr?r=1:this.computeIsLogical(t)==this.trueValueStr?r=4:this.getErrorStrings().indexOf(t)>-1?r=16:this.computeIsText(t)==this.trueValueStr&&(r=2),r.toString()},this.computeRow=function(e){var t,i,r=this.splitArgsPreservingQuotedCommas(e);if(1!=r.length){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1))return t;if(r[0]==this._string_empty)return this.rowIndex(this.cell).toString();if(!this._isCellReference(r[0])&&!this.namedRanges.containsKey(r[0])){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(e.indexOf(":")>-1&&this._isArrayFormula){if((i=this._computeArrayInteriorFunction(e,"ROW",this.computeFunctionLevel))!=this._string_empty)return i;e=this.getCellsFromArgs(e)[0]}return e.indexOf(":")>-1&&(e=this.getCellsFromArgs(e)[0]),this.rowIndex(e).toString()},this.computeRows=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e);if(1!=o.length||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1))return t;if(r=1,o[0].indexOf(":")>-1)l=this.getCellsFromArgs(e),i=this.rowIndex(l[0].toString()),r=(r=this.rowIndex(l[l.length-1].toString())-i+1)>0?r:1;else if(o[0].indexOf(";")>-1)for(n=this._splitArguments(e.split(this.tic).join(this._string_empty),";"),s=1;s<n.length;s++){if(this.splitArgsPreservingQuotedCommas(n[s-1]).length!=this.splitArgsPreservingQuotedCommas(n[1]).length){if(this.getRethrowLibraryComputationExceptions())throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}r=n.length}return r.toString()},this.computePmt=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=l.length;if(n<3||n>5||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;var s,o,a,d=0,h=0,c=0;for(i=0;i<n;i++)l[i]=this.getValueFromArg(l[i].split(this.tic).join(this._string_empty)),l[i]=null==l[i]||""==l[i]?"0":l[i],l[i]="TRUE"==l[i].split(this.tic).join("")?"1":"FALSE"==l[i].split(this.tic).join("")?"0":l[i];if(s=this._parseDouble(l[0]),o=this._parseDouble(l[1]),a=this._parseDouble(l[2]),4==n&&(d=this._parseDouble(l[3])),5==n&&(h=this._parseDouble(l[4])),isNaN(s)&&isNaN(o)&&isNaN(a)&&isNaN(d)&&isNaN(h)){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}if(0==o){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[4].toString()}return h=Math.abs(h)>.5?1:0,0==s?c=1*(d+a)/((1+s*h)*(1-(o+1))):c=s*(d+a*(r=Math.pow(1+s,o)))/((1+s*h)*(1-r)),this.computeDollar(c.toString())},this.computeMatch=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(a>3||""==e){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(o[0],FormulaArgumentType.Text),this.getErrorStrings().indexOf(t)>-1||(t=this.formulaErrorStringCheck(o[1],FormulaArgumentType.CellReference),this.getErrorStrings().indexOf(t)>-1)))return t;var d=o[1].split(this.tic).join(this._string_empty),h=(d.indexOf(":"),1);if(3==a){if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(o[2],FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1))return i;if(l=(l=this.getValueFromArg(o[2])).split(this.tic).join(this._string_empty),r=this._parseDouble(l),h=isNaN(r)?1:r,l==this.falseValueStr)h=0;else if(l==this.trueValueStr)h=1;else if(l.includes(this.tic)&&this.computeIsText(l)==this.trueValueStr){if(this.getRethrowLibraryComputationExceptions())throw this.formulaErrorStrings[this._invalid_arguments];return this.getErrorStrings()[1].toString()}}var c,u=this.getValueFromArg(o[0].split(this.tic).join(this._string_empty)).toUpperCase(),g=this.getCellsFromArgs(this._stripTics0(d)),p=1;for(n=0;n<g.length&&(s=g[n],c=this.getValueFromArg(s).split(this.tic).join(this._string_empty).toUpperCase(),0!=h&&1!=h||c!=u);n++){if(1==h&&this._matchCompare(u,c)<0){p--;break}if(-1==h&&this._matchCompare(u,c)>0){p--;break}p++}return 0!=h&&p==g.length+1&&(p=g.length),p>0&&p<=g.length?p.toString():this.getErrorStrings()[0].toString()},this.computeBitAnd=function(e){var t,i=this.splitArgsPreservingQuotedCommas(e),r=null,l=null;try{if(2!=i.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(r=(r="TRUE"==(r=null==(r=this.getValueFromArg(i[0]))||""==r?"0":r).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r).split(this.tic).join(this._string_empty),l=(l="TRUE"==(l=null==(l=this.getValueFromArg(i[1]))||""==l?"0":l).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l).split(this.tic).join(this._string_empty),r<0||l<0){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return(this._parseDouble(r)&this._parseDouble(l)).toString()}catch(e){if(this._rethrowLibraryComputationExceptions)throw"The parameters are not correct";return this.computeIsText(r)==this.trueValueStr||this.computeIsText(l)==this.trueValueStr?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}},this.computeBitOr=function(e){var t,i=this.splitArgsPreservingQuotedCommas(e),r=null,l=null;try{if(2!=i.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(r=(r="TRUE"==(r=null==(r=this.getValueFromArg(i[0]))||""==r?"0":r).split(this.tic).join("")?"1":"FALSE"==r.split(this.tic).join("")?"0":r).split(this.tic).join(this._string_empty),l=(l="TRUE"==(l=null==(l=this.getValueFromArg(i[1]))||""==l?"0":l).split(this.tic).join("")?"1":"FALSE"==l.split(this.tic).join("")?"0":l).split(this.tic).join(this._string_empty),r<0||l<0){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return(this._parseDouble(r)|this._parseDouble(l)).toString()}catch(e){if(this._rethrowLibraryComputationExceptions)throw"The parameters are not correct";return this.computeIsText(r)==this.trueValueStr||this.computeIsText(l)==this.trueValueStr?this.getErrorStrings()[5].toString():this.getErrorStrings()[1].toString()}},this.computeBitLShift=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=null,s=null;try{if(2!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(r)>-1))return r;if(n=(n="TRUE"==(n=null==(n=this.getValueFromArg(l[0]))||""==n?"0":n).split(this.tic).join("")?"1":"FALSE"==n.split(this.tic).join("")?"0":n).split(this.tic).join(this._string_empty),s=(s="TRUE"==(s=null==(s=this.getValueFromArg(l[1]))||""==s?"0":s).split(this.tic).join("")?"1":"FALSE"==s.split(this.tic).join("")?"0":s).split(this.tic).join(this._string_empty),t=this._parseDouble(n),i=this._parseDouble(s),t>0xffffffffffff||Math.abs(i)>53||t<0){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return(i>=0?t<<i:t>>-i).toString()}catch(e){if(this._rethrowLibraryComputationExceptions)throw"The parameters are not correct";return this.computeIsText(n)==this.trueValueStr||this.computeIsText(s)==this.trueValueStr?this.getErrorStrings()[5].toString():""==n||""==s?this.getErrorStrings()[1].toString():this._parseDouble(n)<0||this._parseDouble(s)<0?this.getErrorStrings()[4].toString():this.getErrorStrings()[1].toString()}},this.computeBitRShift=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=null,s=null;try{if(2!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(r)>-1))return r;if(n=(n="TRUE"==(n=null==(n=this.getValueFromArg(l[0]))||""==n?"0":n).split(this.tic).join("")?"1":"FALSE"==n.split(this.tic).join("")?"0":n).split(this.tic).join(this._string_empty),s=(s="TRUE"==(s=null==(s=this.getValueFromArg(l[1]))||""==s?"0":s).split(this.tic).join("")?"1":"FALSE"==s.split(this.tic).join("")?"0":s).split(this.tic).join(this._string_empty),t=this._parseDouble(n),i=this._parseDouble(s),t>0xffffffffffff||Math.abs(i)>53||t<0){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return(i>=0?t>>i:t<<-i).toString()}catch(e){if(this._rethrowLibraryComputationExceptions)throw"The parameters are not correct";return this.computeIsText(n)==this.trueValueStr||this.computeIsText(s)==this.trueValueStr?this.getErrorStrings()[5].toString():""==n||""==s?this.getErrorStrings()[1].toString():this._parseDouble(n)<0||this._parseDouble(s)<0?this.getErrorStrings()[4].toString():this.getErrorStrings()[1].toString()}},this.computeBitXor=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e),n=null,s=null;try{if(2!=l.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(r=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(r)>-1))return r;if(n=(n="TRUE"==(n=null==(n=this.getValueFromArg(l[0]))||""==n?"0":n).split(this.tic).join("")?"1":"FALSE"==n.split(this.tic).join("")?"0":n).split(this.tic).join(this._string_empty),s=(s="TRUE"==(s=null==(s=this.getValueFromArg(l[1]))||""==s?"0":s).split(this.tic).join("")?"1":"FALSE"==s.split(this.tic).join("")?"0":s).split(this.tic).join(this._string_empty),t=this._parseDouble(n),i=this._parseDouble(s),t>0xffffffffffff||i>0xffffffffffff||t<0||i<0){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}return(t^i).toString()}catch(e){if(this._rethrowLibraryComputationExceptions)throw"The parameters are not correct";return this.computeIsText(n)==this.trueValueStr||(this.computeIsText(s),this.trueValueStr),this.getErrorStrings()[1].toString()}},this.computeBinomOInv=function(e){var t,i=this.splitArgsPreservingQuotedCommas(e);if(3!=i.length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;var r,l,n,s=0,o=this.getValueFromArg(i[0]),a=this.getValueFromArg(i[1]),d=this.getValueFromArg(i[2]);if(""==o&&(i[0]=o="0"),""==a||""==d){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(r=this._parseDouble(o.split(this.tic).join("")),l=this._parseDouble(a.split(this.tic).join("")),n=this._parseDouble(d.split(this.tic).join("")),0==r)return"0";if(r<0||l<=0||l>=1||n<=0||n>=1){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(!(l>0&&l<1&&n>=0&&n<1)){if(r<=0||l<=0||l>=1||n<0||n>1){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[1].toString();return this.getErrorStrings()[1].toString()}if((s=this._critbinom(r,l,n))==this.maxValue){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._calculation_overflow];return this.formulaErrorStrings[this._calculation_overflow]}return s.toString()},this.computeChidist=function(e){var t,i,r,l,n,s=this.splitArgsPreservingQuotedCommas(e),o=s.length;if(2!=o||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(i=0,r=0;r<o;++r)s[r]=this.getValueFromArg(s[r]),s[r]=this._stripTics0(s[r]);if(s[0]=null==s[0]||""==s[0]?"0":s[0],s[1]=null==s[1]||""==s[1]?"0":s[1],s[0]="TRUE"==s[0].split(this.tic).join("")?"1":"FALSE"==s[0].split(this.tic).join("")?"0":s[0],s[1]="TRUE"==s[1].split(this.tic).join("")?"1":"FALSE"==s[1].split(this.tic).join("")?"0":s[1],l=this._parseDouble(s[0]),n=this._parseDouble(s[1]),!isNaN(l)&&!isNaN(n)){if(l<0||n<1){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if(0==l)return"1";if(n<1)return this._excelLikeComputations?this.getErrorStrings()[4].toString():this.formulaErrorStrings[this._invalid_arguments];i=1-this._chidist(l,n)}return i.toString()},this.computeModeOMult=function(e){var t,i,r;if(e==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Range),this.getErrorStrings().indexOf(t)>-1))return t;var l=this._getDoubleArray(e),n=l.slice(),s=l.length;if(s<=1)return this._errorStrings[0].toString();l.sort();var o,a=[],h=0,c=0;for(i=1;i<s;i++)l[i]==l[i-1]?h++:(h>c?(c=h,o=l[i-1],a.length=0,a.push(o)):h==c&&a.push(l[i-1]),h=0);if(h>c&&(c=h,o=l[i-1],a.length=0,a.push(o)),c>0){if(h==c&&a.push(l[i-1]),a.length>1)for(r=0;r<n.lenght;r++)if(a.indexof(n[r])>-1){o=d;break}return o.toString()}return this._errorStrings[0].toString()},this.computeMunit=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e);if(1!=o.length||o==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i=(i=this.getValueFromArg(o[0]).split(this.tic).join(this._string_empty))==this.trueValueStr?1:i==this.falseValueStr?0:i,(r=parseInt(i))<=0||isNaN(r)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._bad_formula];return this._errorStrings[1].toString()}for(l=[],n=0;n<r;n++)for(l[n]=[],s=0;s<r;s++)l[n][s]=n==s?1:0;return l[0][0].toString()},this.computeSign=function(e){var t,i,r,l,n,s,o=0;if(this.splitArgsPreservingQuotedCommas(e).length>1||e==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(i=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(i)>-1))return i;if((e=(e=this.getValueFromArg(e).split(this.tic).join(this._string_empty))==this.trueValueStr?"1":e==this.falseValueStr?"0":e).length>0&&!this._isLetter(e[0])&&(-1==e.indexOf(":")||-1==e.indexOf(this._parseArgumentSeparator)))r=parseFloat(e),isNaN(r)||(o=Math.sign(r));else if(e.length>0&&(e[0]==this.bMARKER||"u"==e[0]||"n"==e[0]||this._indexOfAny(e,this.tokens))){e=(e=e.replace("{","(")).replace("}",")");try{t=this.computeValue(e)}catch(e){return e.message}if(s=parseFloat(t),isNaN(s))return this.formulaErrorStrings[this._invalid_arguments];o=Math.Sign(s)}else for(l=this.getCellsFromArgs(e),n=0;n<l.length;n++){try{t=this.getValueFromArg(l[n])}catch(e){return e.message}if(t.length>0&&(s=parseFloat(t),!isNaN)){o=Math.sign(s);break}}return o.toString()},this.computeBigMul=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(2!=l.length){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(l[0]=l[0].toString()==this.trueValueStr?1:l[0].toString()==this.falseValueStr?0:l[0].split(this.tic).join(this._string_empty),l[1]=l[1].toString()==this.trueValueStr?1:l[1].toString()==this.falseValueStr?0:l[1].split(this.tic).join(this._string_empty),this.computeIsNumber(l[0]).toString()!=this.trueValueStr||this.computeIsNumber(l[1]).toString()!=this.trueValueStr){if(this._rethrowLibraryComputationExceptions)throw this._errorStrings[4].toString();return this._errorStrings[4].toString()}if(e.length>150){if(this._rethrowLibraryComputationExceptions)throw this._errorStrings[4].toString();return this._errorStrings[4].toString()}return i=(i=this.getValueFromArg(l[0])).toString()==this.trueValueStr?1:i.toString()==this.falseValueStr?0:i,i=parseInt(i),r=(r=this.getValueFromArg(l[1])).toString()==this.trueValueStr?1:r.toString()==this.falseValueStr?0:r,(i*(r=parseInt(r))).toString()},this.computeNormInv=function(e){var t,i,r,l,n,s,o=this.splitArgsPreservingQuotedCommas(e),a=o.length;if(3!=a||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;for(n=0,s=0;s<a;++s)o[s]=this.getValueFromArg(o[s]).split(this.tic).join(this._string_empty),o[s]=null==o[s]||o[s]==this._string_empty?"0":o[s],o[s]="TRUE"==o[s]?"1":"FALSE"==o[s]?"0":o[s];if(i=this._parseDouble(o[0]),r=this._parseDouble(o[1]),l=this._parseDouble(o[2]),!isNaN(i)&&!isNaN(r)&&!isNaN(l)){if(i<=0||i>=1||l<=0){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments]+this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}n=this._normalinv(i,r,l)}return n<=0?this.formulaErrorStrings[this._iterations_dont_converge]:n.toString()},this.computeGcd=function(e){var t,i,r,l,n,s,o,a=0,d=this.splitArgsPreservingQuotedCommas(e),h=[];if(e==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}for(i=0;i<d.length;i++)if(d[i].indexOf(":")>-1)for(r=this.getCellsFromArgs(d[i]),l=0;l<r.length;l++){if(n=this.getValueFromArg(r[l]),this._errorStrings.indexOf(n)>-1){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[_invalid_arguments];return n}if(a=parseFloat(n.split(this.tic).join(this._string_empty)),!((!isNaN(a)||r[l].length>0)&&a>0)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[_invalid_arguments];return this._errorStrings[4].toString()}h.push(a)}else{if(s=this.getValueFromArg(d[i]).split(this.tic).join(this._string_empty),this._errorStrings.indexOf(s)>-1&&this._rethrowLibraryComputationExceptions)return n;if(!this._isCellReference(d[i])&&s==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._invalid_arguments];return this._errorStrings[1].toString()}if(a=parseFloat(s),isNaN(a)){if(!this._isCellReference(d[i])&&!d[i].startsWith(this.tic)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[_invalid_arguments];return this._errorStrings[5].toString()}if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[_invalid_arguments];return this._errorStrings[1].toString()}if(!(a>=0)){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[_invalid_arguments];return this._errorStrings[4].toString()}a=parseInt(a),h.push(a)}if(1==h.length)return h[0].toString();for(o=0;o<h.length;o++){for(;0!=h[1];)t=h[0]%h[1],h[0]=h[1],h[1]=t;h.length>2&&o<h.length-2&&(h[1]=h[o+2])}return h[0].toString()},this.computeLcm=function(e){var t,i,r,l,n,s,o,a,d,h,c,u=0,g=this._string_empty,p=(e=this.adjustRangeArg(e),this.splitArgsPreservingQuotedCommas(e));if(e==this._string_empty){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(p.length>0)for(r=0;r<p.length;r++)if(0,p[r].indexOf(":")>-1)for(0,l=this.getCellsFromArgs(p[r]),n=0;n<l.length;n++)0;for(s=[],o=0;o<p.length;o++)if(p[o].indexOf(":")>-1)for(a=this.getCellsFromArgs(p[o]),d=0;d<a.length;d++){if(t=parseFloat(this.getValueFromArg(a[d]).split(this.tic).join(this._string_empty)),isNaN(t))return this.getErrorStrings()[1].toString();if(parseInt(t),!(a[d].length>0&&t>=0))return this.getErrorStrings()[4].toString();s[u]=parseInt(t),u++}else{if(h=this.getValueFromArg(p[o]).split(this.tic).join(this._string_empty),this._errorStrings.indexOf(h)>-1)return h;if(t=parseFloat(h),isNaN(t))return this.getErrorStrings()[1].toString();if(!(p[u].length>0&&t>=0))return this.getErrorStrings()[4].toString();s[u]=parseInt(t),u++}return 1==s.length?s[0].toString():(c=s[0]*s[1],g=s[0].toString()+this._parseArgumentSeparator+s[1].toString(),i=this.computeGcd(g),(c/parseInt(i)).toString())},this.computeTruncate=function(e){var t,i,r,l=this.splitArgsPreservingQuotedCommas(e);if(1!=l.length){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(e.length>15){if(this._rethrowLibraryComputationExceptions)throw this._errorStrings[4].toString();return this._errorStrings[4].toString()}return i=this._string_empty,e=(r=this.getValueFromArg(l[0]).split(this.tic).join(this._string_empty))==this.trueValueStr?1:r==this.falseValueStr?0:r,r=parseFloat(e),isNaN(r)&&r>=0&&(i=r),i.toString()},this.computeCoth=function(e){var t,i,r,l;if(1!=this.splitArgsPreservingQuotedCommas(e).length||""==e){if(this._rethrowLibraryComputationExceptions)throw this.formulaErrorStrings[this._wrong_number_arguments];return this.formulaErrorStrings[this._wrong_number_arguments]}if(this.getEnableFormulaErrorValidation()&&(t=this.formulaErrorStringCheck(e,FormulaArgumentType.Numbers),this.getErrorStrings().indexOf(t)>-1))return t;if(i=!1,e="TRUE"==(e=this.getValueFromArg(e)).split(this.tic).join("")?"1":"FALSE"==e.split(this.tic).join("")?"0":e,this.computeIsNumber(e)==this.trueValueStr&&((r=e).includes("-")&&(i=!0),r=r.includes("u")?r.replace("u",""):r,this._parseDouble(r)>=134217728)){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[4].toString();return this.getErrorStrings()[4].toString()}if("0"==e){if(this._rethrowLibraryComputationExceptions)throw this.getErrorStrings()[3].toString();return this.getErrorStrings()[3].toString()}return e=e.includes("-")?e.replace("-",""):e,("#NUM!"!=(l=this._computeMath(e,Math.tanh))||"#VALUE!"!=l)&&(l=(1/parseFloat(l)).toString()),i&&(l="-"+l),l},this._initLibraryFunctions()},CalcEngine.CalcEngine=function(){},CalcEngine.getFormulaCharacter=function(){return"\0"==this._formulaChar&&(this._formulaChar="="),this._formulaChar},CalcEngine._formulaChar="=",CalcEngine.sheetFamilyID=0,CalcEngine._tokenCount=0,CalcEngine.modelToSheetID=null,CalcEngine._sheetFamiliesList=null,CalcEngine._defaultFamilyItem=null,CalcEngine.createSheetFamilyID=function(){return this.sheetFamilyID==Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},CalcEngine.getSheetFamilyItem=function(e){if(0==this.sheetFamilyID)return null==CalcEngine._defaultFamilyItem&&(CalcEngine._defaultFamilyItem=new GridSheetFamilyItem),CalcEngine._defaultFamilyItem;null==CalcEngine._sheetFamiliesList&&(CalcEngine._sheetFamiliesList=new HashTable);var t=CalcEngine.modelToSheetID.getItem(e);return CalcEngine._sheetFamiliesList.containsKey(t)||CalcEngine._sheetFamiliesList.add(t,new GridSheetFamilyItem),CalcEngine._sheetFamiliesList.getItem(t)},CalcEngine.resetSheetFamilyID=function(){this.sheetFamilyID=0,null!=CalcEngine.modelToSheetID&&(CalcEngine.modelToSheetID.clear(),CalcEngine.modelToSheetID=null),null!=CalcEngine._sheetFamiliesList&&(CalcEngine._sheetFamiliesList.clear(),CalcEngine._sheetFamiliesList=null,this.resetSheetIDs())},CalcEngine.resetSheetIDs=function(){this._tokenCount=0},CalcEngine.unregisterGridAsSheet=function(e,t){var i,r=CalcEngine.getSheetFamilyItem(t),l=e.toUpperCase();null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.containsKey(l)&&(r.sheetNameToParentObject.remove(l),i=r.sheetNameToToken.getItem(l),r.sheetNameToToken.remove(l),r.tokenToParentObject.remove(i),r.parentObjectToToken.remove(t))},CalcEngine})(jQuery,Syncfusion),function(e){e[e.None=0]="None",e[e.VLOOKUP=1]="VLOOKUP",e[e.HLOOKUP=2]="HLOOKUP",e[e.Both=3]="Both",e[e.OptimizeForMatches=4]="OptimizeForMatches"}(LookupCachingMode||(LookupCachingMode={})),function(e){e[e.FormulaSet=0]="FormulaSet",e[e.NonFormulaSet=1]="NonFormulaSet",e[e.CalculatedValueSet=2]="CalculatedValueSet"}(FormulaInfoSetAction||(FormulaInfoSetAction={})),CalcQuickBase=function(){function e(e){this.resetStaticMembers=e,this._calcQuickID=0,this._controlModifiedFlags=null,this._dataStore=null,this._engine={},this._keyToRowsMap=null,this._keyToVectors=null,this._nameToControlMap=null,this._rowsToKeyMap=null,this._isValueSetEventChanged=!1,this._autoCalc=!1,this._isIE8=!1,this._cellPrefix="!0!A",this._checkKeys=!0,this._disposeEngineResource=!0,this._ignoreChanges=!1,this._leftBrace="{",this._tic='"',this._leftBracket="[",this._rightBracket="]",this._validLeftChars="+-*/><=^(&,",this._validRightChars="+-*/><=^)&,",this.getKeyValue=function(e){if(e=e.toUpperCase(),this.getDataStore().containsKey(e)){var t=this.getDataStore().getItem(e),i=t.getFormulaText();if(i.length>0&&i[0]==CalcEngine.getFormulaCharacter()&&t.calcID!=this.getEngine().getCalcID()){this.getEngine().cell=this._cellPrefix+this.getKeyToRowsMap().getItem(e).toString(),i=i.substring(1);try{t.setParsedFormula(this.getEngine().parseFormula(this._markKeys(i)))}catch(i){if(this.getCheckKeys())return t.setFormulaValue(i.Message),t.calcID=this.getEngine().getCalcID(),null!=this._valueSetEvent&&this._valueSetEvent.trigger(this,new ValueSetEventArgs(e,t.getFormulaValue(),2)),this.getDataStore().getItem(e).getFormulaValue()}try{t.setFormulaValue(this.getEngine().computeFormula(t.getParsedFormula()))}catch(e){if(this.getThrowCircularException()&&0==e.toString().indexOf(this.getEngine().formulaErrorStrings[this.getEngine().circular_reference_]))throw e}t.calcID=this.getEngine().getCalcID(),null!=this._valueSetEvent&&this._valueSetEvent.trigger(this,new ValueSetEventArgs(e,t.getFormulaValue(),2))}return this.getEngine().getThrowCircularException()&&this.getEngine().getIterationMaxCount()>0&&t.setFormulaValue(this.getEngine().handleIteration(this.getEngine().cell,t)),this.getDataStore().getItem(e).getFormulaValue()}return this.getKeyToVectors().containsKey(e)?this.getKeyToVectors().getItem(e).toString():""},this.setKeyValue=function(e,t){var i,r,l,n,s,o;if(e=e.toUpperCase(),i=this._isIE8?t.toString().replace(/^\s+|\s+$/g,""):t.toString().trim(),!this.getDataStore().containsKey(e)||0==i.indexOf(this._leftBrace)){if(0==i.indexOf(this._leftBrace)){this.getKeyToVectors().containsKey(e)||this.getKeyToVectors().add(e,""),i=i.substr(1,i.length-2);var a=this.getKeyToRowsMap().length+1,d=i.split(this.getEngine().getParseArgumentSeparator()),h="A"+a+":A"+(a+d.length-1);for(this.getKeyToVectors()[e]=h,r=0;r<d.length;r++)l="Q_"+(this.getKeyToRowsMap().length+1),this.getDataStore().add(l,new FormulaInfo),this.getKeyToRowsMap().add(l,this.getKeyToRowsMap().length+1),this.getRowsToKeyMap().add(this.getRowsToKeyMap().length+1,l),(n=this.getDataStore().getItem(l)).setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(this.parseAndCompute(d[r]));return}this.getDataStore().add(e,new FormulaInfo),this.getKeyToRowsMap().add(e,this.getKeyToRowsMap().length+1),this.getRowsToKeyMap().add(this.getRowsToKeyMap().length+1,e)}this.getKeyToVectors().containsKey(e)&&this.getKeyToVectors().remove(e),s=this.getDataStore().getItem(e),!this.ignoreChanges&&null!=s.getFormulaText()&&s.getFormulaText().length>0&&s.getFormulaText()!=i&&(o=this._cellPrefix+this.getKeyToRowsMap().getItem(e).toString(),null!=this.getEngine().getDependentFormulaCells().getItem(o)&&this.getEngine().clearFormulaDependentCells(o)),i.length>0&&i[0]==CalcEngine.getFormulaCharacter()?(s.setFormulaText(i),null!=this._valueSetEvent&&this._valueSetEvent.trigger(this,new ValueSetEventArgs(e,s.getFormulaValue(),2))):s.getFormulaValue()!=i&&(s.setFormulaText(""),s.setParsedFormula(""),s.setFormulaValue(i),null!=this._valueSetEvent&&this._valueSetEvent.trigger(this,new ValueSetEventArgs(e,s.getFormulaValue(),2))),this.getAutoCalc()&&this.updateDependencies(e)},this.resetKeys=function(){this.getDataStore().clear(),this.getKeyToRowsMap().clear(),this.getRowsToKeyMap().clear(),this.getKeyToVectors().clear(),this.getNameToControlMap().clear()},this._checkAdjacentPiece=function(e,t,i){var r=!0;return(e=this._isIE8?e.replace(/^\s+|\s+$/g,""):e.trim()).length>0&&(r=t.indexOf(e[i?0:e.length-1])>-1),r},this.createEngine=function(){return new CalcEngine(this)},this.dispose=function(){this._dataStore=null,this._rowsToKeyMap=null,this._keyToRowsMap=null,this._keyToVectors=null,this._controlModifiedFlags=null,this._nameToControlMap=null,this.getDisposeEngineResource()&&(this._engine.getDependentFormulaCells().clear(),this._engine.getDependentCells().clear(),null!=this._engine&&this._engine.dispose(),this._engine=null)},this.tryParseAndCompute=function(e){var t="";try{t=this.parseAndCompute(e)}catch(e){t=e.message}return t},this.getFormula=function(e){return e=e.toUpperCase(),this.getDataStore().containsKey(e)?this.getDataStore().getItem(e).getFormulaText():""},this.getValueRowCol=function(e,t){var i,r=this.getRowsToKeyMap().getItem(t).toString(),l=this.getKeyValue(r).toString();return null!=l&&"%"==l[l.length-1]&&l.length>1&&(i=this._parseDouble(l.substring(0,l.length-1)),isNaN(i)&&(l=(Number(i)/100).toString())),l},this.initCalcQuick=function(e){this._dataStore=new HashTable,this._rowsToKeyMap=new HashTable,this._keyToRowsMap=new HashTable,this._keyToVectors=new HashTable,this._controlModifiedFlags=new HashTable,this._nameToControlMap=new HashTable;var t=CalcEngine.createSheetFamilyID();this._engine=this.createEngine(),e&&(CalcEngine.resetSheetFamilyID(),this._engine.getDependentFormulaCells().clear(),this._engine.getDependentCells().clear()),this._cellPrefix="!"+t+"!A",this._engine.registerGridAsSheet(RangeInfo.getAlphaLabel(this.getCalcQuickID()),this,t),this._engine.setCalculatingSuspended(!0),this._engine.ignoreValueChanged=!0,this._isIE8="msie"==ej.browserInfo().name&&"8.0"==ej.browserInfo().version},this._markKeys=function(e){for(var t,i,r,l,n=e.indexOf(this._leftBracket);n>-1;)if(i="",(t=e.substring(n).indexOf(this._rightBracket)-1)>0)if(i=e.substring(n+1,t+n+1).toUpperCase(),this.getKeyToVectors().containsKey(i)){if(r=n+t+2<e.length?e.substring(n+t+2):"",this.getCheckKeys()&&!this._checkAdjacentPiece(r,this._validRightChars,!0))throw"not followed properly"+i;if(l=n>0?e.substring(0,n):"",this.getCheckKeys()&&!this._checkAdjacentPiece(l,this._validLeftChars,!1))throw"not followed properly"+i;n=(e=l+this.getKeyToVectors().getItem(i).toString()+r).indexOf(this._leftbraket)}else{if(!this.getKeyToRowsMap().containsKey(i)){if(e.toUpperCase().indexOf(this._tic+this._leftBracket+i+this._rightBracket+this.tic)>0)break;throw"Unknown key: "+i}if(r=n+t+2<e.length?e.substring(n+t+2):"",this.getCheckKeys()&&!this._checkAdjacentPiece(r,this._validRightChars,!0))throw"not followed properly"+i;if(l=n>0?e.substring(0,n):"",this.getCheckKeys()&&!this._checkAdjacentPiece(l,this._validLeftChars,!1))throw"not followed properly"+i;n=(e=l+"A"+this.getKeyToRowsMap().getItem(i).toString()+r).indexOf(this._leftBracket)}else n=-1;return e},this.parseAndCompute=function(e){return e.length>0&&e[0]==this.getEngine().getFormulaCharacter()&&(e=e.substring(1)),this.getEngine().parseAndComputeFormula(this._markKeys(e))},this.refreshAllCalculations=function(){var e,t;if(this.getAutoCalc()){for(this.setDirty(),this.ignoreChanges=!0,e=0;e<this.getDataStore().keys().length;e++){var i=this.getDataStore().keys()[e],r=this.getDataStore().getItem(i),l=r.getFormulaText();l.length>0&&l[0]==this.getEngine().getFormulaCharacter()&&r.calcID!=this.getEngine().getCalcID()&&(l=l.substring(1),this.getEngine().cell=this._cellPrefix+this.getKeyToRowsMap().getItem(i).toString(),r.setParsedFormula(this.getEngine().parseFormula(this._markKeys(l))),r.setFormulaValue(this.getEngine().computeFormula(r.getParsedFormula())),r.calcID=this.getEngine().getCalcID(),t=parseInt(this.getKeyToRowsMap().getItem(i)),this.getEngine().valueChanged(this,new ValueChangedArgs(t,1,r.getFormulaValue()))),null!=this._valueSetEvent&&this._valueSetEvent.trigger(this,new ValueSetEventArgs(i,r.getFormulaValue(),2))}this.ignoreChanges=!1}},this.setDirty=function(){this.getEngine().updateCalcID()},this.setValueRowCol=function(){},this.updateDependencies=function(e){var t,i,r,l;if(this.getAutoCalc()&&(t=this._cellPrefix+this.getKeyToRowsMap().getItem(e).toString(),i=this.getEngine().getDependentCells().getItem(t),this.setDirty(),null!=i))for(r=0;r<i.length;r++)(l=i[r].indexOf("A"))>-1&&(l=parseInt(i[r].substring(l+1)),e=this.getRowsToKeyMap().getItem(l).toString(),this.ignoreChanges=!0,this.setKeyValue(e,this.getKeyValue(e)),this.ignoreChanges=!1)},this.initCalcQuick(e)}return e.prototype.getAutoCalc=function(){return this._autoCalc},e.prototype.setAutoCalc=function(e){this._autoCalc=e,this.getEngine().setCalculatingSuspended(!e),this.getEngine().setUseDependencies(e),e&&this.setDirty()},e.prototype.getCalcQuickID=function(){return this._calcQuickID++,this._calcQuickID==Number.MAX_VALUE&&(this._calcQuickID=1),this._calcQuickID},e.prototype.getCheckKeys=function(){return this._checkKeys},e.prototype.setCheckKeys=function(e){this._checkKeys=e},e.prototype.getControlModifiedFlags=function(){return this._controlModifiedFlags},e.prototype.getDataStore=function(){return this._dataStore},e.prototype.getDisposeEngineResource=function(){return this._disposeEngineResource},e.prototype.setDisposeEngineResource=function(e){this._disposeEngineResource=e},e.prototype.getEngine=function(){return this._engine},e.prototype.getFormulaCharacter=function(){return this.getEngine().getFormulaCharacter()},e.prototype.setFormulaCharacter=function(e){this.getEngine().setFormulaCharacter(e)},e.prototype.getKeyToRowsMap=function(){return this._keyToRowsMap},e.prototype.getKeyToVectors=function(){return this._keyToVectors},e.prototype.getNameToControlMap=function(){return this._nameToControlMap},e.prototype.getRowsToKeyMap=function(){return this._rowsToKeyMap},e.prototype.getThrowCircularException=function(){return this.getEngine().getThrowCircularException()},e.prototype.setThrowCircularException=function(e){this.getEngine().setThrowCircularException(e)},e.prototype.getValueSetEventHandler=function(){return null==this._valueSetEvent&&(this._valueSetEvent=new ValueSetEvent),this._valueSetEvent.getValueSet()},e.prototype.setValueSetEventHandler=function(e){null==this._valueSetEvent&&(this._valueSetEvent=new ValueSetEvent),this._valueSetEvent.setValueSet(e)},e}(),window.CalcQuick=function(e){function t(){e.apply(this,arguments),this.registerControlArray=function(e){for(var t=0;t<e.length;t++)this.registerControl(e[t]);this.setAutoCalc(!0)},this.registerControl=function(e){var t;if(0==this.getNameToControlMap().length&&this.setValueSetEventHandler(this.calcQuickValueSet),this.getControlModifiedFlags().containsKey(e.id)||this.getNameToControlMap().containsKey(e.id))throw"error";this.getControlModifiedFlags().add(e.id,!1),this.getNameToControlMap().add(e.id.toUpperCase(),e.id),this.setKeyValue(e.id,e.value),"select-one"==e.type?(t=$.proxy(this.controlTextChanged,this,this),e.onchange=t):(t=$.proxy(this.controlTextChanged,this,this),this._isIE8?e.onpropertychange=t:e.oninput=t),t=$.proxy(this.controlLeave,this,this),e.onblur=t},this.calcQuickValueSet=function(e,t){if(e.getNameToControlMap().containsKey(t.getKey())){var i=e.getNameToControlMap().getItem(t.getKey());document.getElementById(i).value=t.getValue()}},this.controlTextChanged=function(e,t){var i=e._isIE8?event.srcElement:t.target;null!=i&&!e.ignoreChanges&&e.getControlModifiedFlags().containsKey(i.id)&&(e.getControlModifiedFlags().items[i.id]=!0)},this.controlLeave=function(e,t){var i=e._isIE8?event.srcElement:t.target;null!=i&&this.getControlModifiedFlags().containsKey(i.id)&&e.getControlModifiedFlags().getItem(i.id)&&(e.setKeyValue(i.id,i.value),e.getControlModifiedFlags().items[i.id]=!1)}}return window.__calcQuickextends(t,e),t}(CalcQuickBase),window.ValueSetEventArgs=function(){function e(e,t,i){this._id=e,this._val=t,this._action=i}return e.prototype.getAction=function(){return this._action},e.prototype.setAction=function(e){this._action=e},e.prototype.getKey=function(){return this._id},e.prototype.setKey=function(e){this._id=e},e.prototype.getValue=function(){return this._val},e.prototype.setValue=function(e){this._val=e},e}(),function(e){e[e.FormulaSet=0]="FormulaSet",e[e.NonFormulaSet=1]="NonFormulaSet",e[e.CalculatedValueSet=2]="CalculatedValueSet"}(FormulaInfoSetAction||(FormulaInfoSetAction={})),FormulaInfoHashtable=function(){return function(){this.get=function(){return new FormulaInfo},this.set=function(){return new FormulaInfo}}}(),HashTable=function(){return function(){this.length=0,this.items=[],this.add=function(e,t){return this.previous=void 0,this.containsKey(e)?this.previous=this.items[e]:this.length++,this.items[e]=t,this.previous},this.clear=function(){this.items={},this.length=0},this.contains=function(e){return this.items.hasOwnProperty(e)},this.containsKey=function(e){return this.items.hasOwnProperty(e)},this.containsValue=function(e){return!(!this.items.hasOwnProperty(e)||void 0==this.items[e])},this.getItem=function(e){return this.containsKey(e)?this.items[e]:void 0},this.keys=function(){var e=[];for(var t in this.items)this.containsKey(t)&&e.push(t);return e},this.remove=function(e){return this.containsKey(e)?(this.previous=this.items[e],this.length--,delete this.items[e],this.previous):void 0},this.values=function(){var e=[];for(var t in this.items)this.containsKey(t)&&e.push(this.items[t]);return e},this.each=function(e){for(var t in this.items)this.containsKey(t)&&e(t,this.items[t])}}}(),window.RangeInfo=function(){function e(e,t,i,r){this.top=e,this.bottom=i,this.left=t,this.right=r,this.getBottom=function(){return this.bottom},this.setBottom=function(e){this.bottom=e},this.getTop=function(){return this.top},this.setTop=function(e){this.top=e},this.getLeft=function(){return this.left},this.setLeft=function(e){this.left=e},this.getRight=function(){return this.right},this.setRight=function(e){this.right=e}}return e.cells=function(t,i,r,l){return new e(t,i,r,l)},e.getAlphaLabel=function(e){for(var t,i,r,l=[],n=0;e>0&&n<9;)e--,t="A".charCodeAt(0),l[n]=String.fromCharCode(e%26+t),e=parseInt((e/26).toString()),n++;for(i=[],r=0;r<n;r++)i[n-r-1]=l[r];return i.join("")},e}(),window.GridSheetFamilyItem=function(){return function(){this.isSheetMember=!1,this.parentObjectToToken=null,this.sheetDependentCells=null,this.sheetDependentFormulaCells=null,this.sheetFormulaInfoTable=null,this.sheetNameToParentObject=null,this.sheetNameToToken=null,this.tokenToParentObject=null}}(),window.FormulaInfo=function(){return function(){this.calcID=Number.MIN_SAFE_INTEGER+1,this.getFormulaText=function(){return this._formulaText},this.setFormulaText=function(e){this._formulaText=e},this.getFormulaValue=function(){return this._formulaValue},this.setFormulaValue=function(e){this._formulaValue=e},this.getParsedFormula=function(){return this._parsedFormula},this.setParsedFormula=function(e){this._parsedFormula=e},Number.MIN_SAFE_INTEGER}}(),window.ValueChangedArgs=function(){return function(e,t,i){this.row=e,this.col=t,this.value=i,this.getRowIndex=function(){return this.row},this.setRowIndex=function(e){this.row=e},this.getColIndex=function(){return this.col},this.setColIndex=function(e){this.col=e},this.getValue=function(){return this.value},this.setValue=function(e){this.value=e}}}(),window.FormulaParsing=function(){return function(e){this._text=e,this.getText=function(){return this._text},this.setText=function(e){this._text=e}}}(),window.UnknownFunctionEventArgs=function(){return function(){this.getMissingFunctionName=function(){return this.m_missingFunctionName},this.setMissingFunctionName=function(e){this.m_missingFunctionName=e},this.getCellLocation=function(){return this.m_cellLocation},this.setCellLocation=function(e){this.m_cellLocation=e},this.getResult=function(){return this.result},this.setResult=function(e){this.result=e},this.getHandled=function(){return this.handled},this.setHandled=function(e){this.handled=e}}}(),window.LookUps=function(){return function(){this.getLinearLookUpList=function(){return this._linearLookUpList},this.setLinearLookUpList=function(e){this._linearLookUpList=e},this.getMatchLookUpList=function(){return this._matchLookUpList},this.setMatchLookUpList=function(e){this._matchLookUpList=e}}}(),window.ValueSetEvent=function(){function e(){}return e.prototype.getValueSet=function(){return this.eventFn},e.prototype.setValueSet=function(e){this.eventFn=e},e.prototype.trigger=function(){for(var e,t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];e={},this.getValueSet().apply(e,t||[])},e}()})},2049:function(e,t,i){var r,l,n;
/*!
*  filename: ej.spreadsheet.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.spreadsheet.min.js
*  version : 17.2.0.46
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(s){l=[i(94),i(159),i(4),i(21),i(124),i(16),i(15),i(2036),i(66),i(97),i(55),i(155),i(47),i(122),i(221),i(31),i(98),i(222),i(95),i(92),i(228),i(93),i(226),i(48),i(96),i(157),i(227),i(225),i(1041),i(416),i(1022)],void 0===(n="function"==typeof(r=s)?r.apply(t,l):r)||(e.exports=n)}(function(){(function(e,t,i){t.widget("ejSpreadsheet","ej.Spreadsheet",{_rootCSS:"e-spreadsheet",element:null,_excelFilter:null,validTags:["div"],model:null,_requiresID:!0,defaults:{allowFreezing:!0,enableContextMenu:!0,allowEditing:!0,allowResizing:!0,allowMerging:!0,allowWrap:!0,allowUndoRedo:!0,allowClipboard:!0,allowDataValidation:!0,allowConditionalFormats:!0,allowSearching:!0,allowKeyboardNavigation:!0,allowAutoFill:!0,allowSelection:!0,allowSorting:!0,allowDragAndDrop:!0,allowCellType:!0,allowAutoCellType:!1,allowCharts:!0,enablePersistence:!1,allowCellFormatting:!0,allowFormulaBar:!0,showRibbon:!0,showPager:!0,allowComments:!0,allowFiltering:!0,allowInsert:!0,allowDelete:!0,allowFormatPainter:!0,allowHyperlink:!0,allowImport:!0,allowFormatAsTable:!0,allowAutoSum:!0,enablePivotTable:!1,allowLockCell:!0,enableTouch:!0,allowOverflow:!0,allowClear:!0,allowSparkline:!1,isReadOnly:!1,isGridMode:!1,columnCount:21,rowCount:20,rowHeight:20,columnWidth:64,sheetCount:1,undoRedoStep:20,activeSheetIndex:1,apWidth:300,activationPanelWidth:300,_isActPanelVisible:!1,isImport:!1,cssClass:"",userName:"",locale:"en-US",pageSize:"A4",sparkDiv:"",sheets:[],nameManager:[],customFormulas:[],currentViewData:null,query:null,create:null,actionBegin:null,actionComplete:null,beforeCellFormat:null,cellFormatting:null,beforeOpen:null,beforePrint:null,beforeDrop:null,drop:null,cellEdit:null,pagerClick:null,cellClick:null,_pivotPrint:null,tabClick:null,tabSelect:null,_createPivotTable:null,beforePanelOpen:null,load:null,loadComplete:null,editRangeBegin:null,editRangeComplete:null,cellHover:null,menuClick:null,contextMenuClick:null,ribbonClick:null,dragStart:null,drag:null,cellSave:null,beforeCellSelect:null,cellSelected:null,autoFillBegin:null,autoFillComplete:null,openFailure:null,onImport:null,onExport:null,beforeImport:null,beforeBatchSave:null,keyUp:null,keyDown:null,dragShape:null,resizeStart:null,resizeEnd:null,refresh:null,beforeEditComment:null,beforeTabClick:null,scrollStop:null,formulaComputed:null,scrollSettings:{width:"100%",height:"100%",allowScrolling:!0,scrollMode:"infinite",isResponsive:!0,allowVirtualScrolling:!0,allowSheetOnDemand:!1},pageSettings:{pageCount:10,currentPage:1,pagerHeight:26},exportSettings:{allowExporting:!0,enableFormulaCalculation:!1,excelUrl:null,csvUrl:null,pdfUrl:null,password:null},pictureSettings:{allowPictures:!0,height:220,width:440},selectionSettings:{selectionType:"default",selectionUnit:"multirange",enableAnimation:!1,animationType:"linear",animationTime:.001,activeCell:""},chartSettings:{height:220,width:440},formatSettings:{allowFontFamily:!0,allowDecimalPlaces:!0,allowCellBorder:!0},autoFillSettings:{fillType:"fillseries",showFillOptions:!0},importSettings:{importMapper:"",importUrl:"",password:"",allowSheetOnDemand:!1,importOnLoad:!1},printSettings:{allowPageSetup:!0,allowPageSize:!1,allowPrinting:!0},ribbonSettings:{enableOnDemand:!1,applicationTab:{type:t.Ribbon.ApplicationTabType.Backstage,menuSettings:{isAppend:!1,dataSource:[]}}}},dataTypes:{pageSize:"enum",sheets:"array",nameManager:"array",scrollSettings:{scrollMode:"enum"},selectionSettings:{selectionType:"enum",selectionUnit:"enum",animationType:"enum"},autoFillSettings:{fillType:"enum"}},_dataSource:function(e){return this.getSheet(e).dataSource},getSheet:function(e){return this.model.sheets[this._getSheetIndex(e)]},getSheets:function(){return this.model.sheets},getSheetElement:function(e){return this.element.find("#"+this._id+"_"+this.getSheet(e).sheetInfo.value)},getDataSettings:function(e){var t,i=[],r=this.getSheet(e),l=r.rangeSettings.length;if(l)for(;l--;)(t=r.rangeSettings[l]).dataSource&&i.push(t);return i.length?i:r.dataSource?[r]:null},_getJSSheetHeader:function(e){return this._sheets[e]._sheetHeader},_setJSSheetHeader:function(e,t){this._sheets[t]._sheetHeader=e},_getInputBox:function(){return this._inputBox},_setInputBox:function(e){this._inputBox=e},_getIndexBox:function(){return this._indexBox},_setIndexBox:function(e){this._indexBox=e},_getJSSheetRowHeader:function(e){return this._sheets[e]._sheetRowHeader},_setJSSheetRowHeader:function(e,t){this._sheets[t]._sheetRowHeader=e},_getJSSheetRowHeaderContent:function(e){return this._sheets[e]._sheetRowHeaderContent},_setJSSheetRowHeaderContent:function(e,t){this._sheets[t]._sheetRowHeaderContent=e},_getJSSheetContent:function(e){return this._sheets[e]._sheetContent},_setJSSheetContent:function(e,t){this._sheets[t]._sheetContent=e},_getContent:function(e){return this._sheets[e]._content},_setContent:function(e,t){this._sheets[t]._content=e},getPager:function(){return this._spreadSheetPager},setPager:function(e){this._spreadSheetPager=e},getFooter:function(){return this._footer},setFooter:function(e){this._footer=e},getMainPanel:function(){return this._mainPanel},setMainPanel:function(e){this._mainPanel=e},getGroupPanel:function(){return this._groupPanel},setGroupPanel:function(e){this._groupPanel=e},getActivationPanel:function(){return this._activationPanel},setActivationPanel:function(e){this._activationPanel=e},getActiveSheetIndex:function(){return this.model.activeSheetIndex},setActiveSheetIndex:function(e){this.model.activeSheetIndex=e},getRows:function(e){return this._sheets[e]._Rows},setRows:function(e,t){this._sheets[t]._Rows=e},getFrozenRows:function(e){return this.getSheet(this._getSheetIndex(e)).frozenRows},setFrozenRows:function(e,t){this.model.isReadOnly||(this.getSheet(this._getSheetIndex(t)).frozenRows=e)},getFrozenColumns:function(e){return this.getSheet(e).frozenColumns},setFrozenColumns:function(e,t){this.model.isReadOnly||(this.getSheet(t).frozenColumns=e)},setFocusTopElem:function(e){this._focusTopElem=e},getFocusTopElem:function(){return this._focusTopElem},setFocusRightElem:function(e){this._focusRightElem=e},getFocusRightElem:function(){return this._focusRightElem},setFocusBottomElem:function(e){this._focusBottomElem=e},getFocusBottomElem:function(){return this._focusBottomElem},setFocusLeftElem:function(e){this._focusLeftElem=e},getFocusLeftElem:function(){return this._focusLeftElem},setAutoFillElem:function(e){this._autoFillElem=e},getAutoFillElem:function(){return this._autoFillElem},_setAutoFillOptElem:function(e){this._autoFillOptElem=e},_getAutoFillOptElem:function(){return this._autoFillOptElem},_getColWidth:function(e,t){return this.getSheet(t).columnsWidthCollection[e]},_getRowHeight:function(e,t){return this.getSheet(t).rowsHeightCollection[e]},setActiveCell:function(e,i,r){var l,n=this.getSheet(r||this.getActiveSheetIndex());"string"==typeof e&&(e=(l=this.getRangeIndices(e))[0],i=l[1]),n._activeCell=t.isNullOrUndefined(e)&&t.isNullOrUndefined(i)?n._startCell:{rowIndex:e,colIndex:i}},getActiveCell:function(e){return this.getSheet(this._getSheetIndex(e))._activeCell},_setFormulaSuggElem:function(e){this._formulaSuggElem=e},_getFormulaSuggElem:function(){return this._formulaSuggElem},_setRowHdrTBody:function(e,t){this._sheets[t]._rowHdrTBody=e},_getRowHdrTBody:function(e){return this._sheets[e]._rowHdrTBody},_setContTBody:function(e,t){this._sheets[t]._contTBody=e},_getContTBody:function(e){return this._sheets[e]._contTBody},_init:function(){var e=this.model.importSettings;this._initBegin(),this.model.allowImport&&(e.importUrl.length||e.importOnLoad)?this.import({url:e.importUrl,password:e.password,allowSheetOnDemand:e.allowSheetOnDemand}):(this.showWaitingPopUp(),this._initBase(),this._initComplete(),this._isSSLoaded=!0),this._isAutoWHMode&&this._setElemDimension(),!this.model.isGridMode||this.getSheet(this.getActiveSheetIndex())._isDataManager||t.isNullOrUndefined(this.getDataSettings(this.getActiveSheetIndex()))||this._gridModeScroll(!0),this.addClass(this.element,this.model.cssClass),this._cssClass=this.model.cssClass},_initBegin:function(){var i,r="touch-action",l=this.model.scrollSettings,n=t.preferredCulture(this.model.locale).calendar.patterns;t.support.stableSort=!1,this._isInitLoad=!0,this._isDefaultLocked=!1,this._isSSLoaded=!1,this._computeFormula=!0,this.model.isGridMode&&(l.scrollMode="normal",this.model.showRibbon=!1,this.model.allowFormulaBar=!1,this.model.allowDragAndDrop=!1,this.model.allowResizing=!1,this.model.allowFreezing=!1,this.model.allowImport=!1),this._isAutoWHMode=!l.allowScrolling,this._isAutoWHMode&&(l.isResponsive=!1,l.scrollMode="normal",l.allowVirtualScrolling=!1),this._minWidth=280,this._minHeight=200,this._isAutoWHMode||this.element.css({height:l.height,width:l.width}),(!this.model.isGridMode||this.model.isGridMode&&this.model.scrollSettings.allowScrolling)&&this.element.css({"min-height":this._minHeight,"min-width":this._minWidth}),this._updateResponsiveSettings(),this._isAutoWHMode||l.isResponsive||(l.width.toString().indexOf("%")>-1&&(l.width=this._responsiveWidth),l.height.toString().indexOf("%")>-1&&(l.height=this._responsiveHeight),this.element.css({height:l.height,width:l.width})),this._browserDetails=t.browserInfo(),this.localizedLabels=t.getLocalizedConstants(this.sfType,this.model.locale),this.element.attr("tabindex",0),"msie"===this._browserDetails.name&&(r="-ms-"+r),this.element.css(r,"double-tap-zoom pinch-zoom"),i=t.buildTag("div#"+this._id+"_wait","",{position:"absolute"}),e(document.body).append(i),i.ejWaitingPopup({showOnInit:!1,target:this.element}),n.dT=n.d+" "+n.T,"en-US"!=this.model.locale&&(n.d&&(t.Spreadsheet.CellFormat.shortdate="{0:"+n.d+"}"),n.D&&(t.Spreadsheet.CellFormat.longdate="{0:"+n.D+"}"),n.T&&(t.Spreadsheet.CellFormat.time="{0:"+n.T+"}"))},_initBase:function(){var e,i=this.model.locale,r=t.preferredCulture(i);this._refreshModel(this.isImport||this.model.isImport?this._impData.model:this._isRefresh?this.model:null),this._isRefresh?this._updateCellType():this._initProps(),e=this.getCalcEngine(),"en-US"!==i&&(","===r.numberFormat["."]&&e.setParseArgumentSeparator(";"),e.setParseDecimalSeparator(r.numberFormat["."])),this._tabMode||this._phoneMode||this.model.isGridMode||(this._minHeight=400,this.element.css({"min-height":this._minHeight})),this._initCSSTag(),this._initLayout(),this._wireEvents("_on"),this._isInitLoad=!1},_initProps:function(){var i=this.model,r=t.spreadsheetFeatures;this.XLClipboard=new r.clipboard(this),this.XLEdit=new r.editing(this),this.XLPrint=new r.print(this),this.XLRibbon=new r.ribbon(this),this.XLScroll=new r.scroller(this),i.allowDragAndDrop&&(this.XLDragDrop=new r.dragAndDrop(this)),i.allowKeyboardNavigation&&(this.XLCellNav=new r.cellNavigation(this)),i.allowFiltering&&(this.XLFilter=new r.filter(this)),i.allowAutoFill&&(this.XLDragFill=new r.dragFill(this)),(i.allowCellFormatting||i.allowFormatAsTable||i.allowFormatPainter)&&(this.XLFormat=new r.cellFormatting(this)),i.allowCellFormatting&&(this.XLCellFrmtDlg=new r.formatCellDialog(this)),i.allowConditionalFormats&&(this.XLCFormat=new r.cFormat(this)),i.allowSearching&&(this.XLSearch=new r.findnreplace(this)),i.allowCharts&&(this.XLChart=new r.chart(this)),i.allowSparkline&&(this.XLSparkline=new r.sparkLine(this)),i.exportSettings.allowExporting&&(this.XLExport=new r.exporting(this)),i.allowSorting&&(this.XLSort=new r.sorting(this)),i.allowFreezing&&(this.XLFreeze=new r.freezepane(this)),i.allowComments&&(this.XLComment=new r.comments(this)),i.allowSelection&&(this.XLSelection=new r.selection(this)),(i.allowCharts||i.pictureSettings.allowPictures)&&(this.XLShape=new r.shape(this)),i.allowResizing&&(this.XLResize=new r.resizing(this)),i.enableContextMenu&&(this.XLCMenu=new r.contextmenu(this)),i.allowDataValidation&&(this.XLValidate=new r.validation(this)),i.allowCellType&&(this.XLCellType=new r.cellType(this)),i.enablePivotTable&&(this.XLPivot=new r.pivot(this)),r.math&&e.extend(t.Spreadsheet.prototype,r.math),this._initPvtProps(),this._initFATProps(),this.model.customFormulas.length&&this._updateCustomFormulas(this.model.customFormulas,"add"),this.model.nameManager.length&&this._refreshNameMngr(this.model.nameManager)},_initPvtProps:function(){var i=1,r={rowIndex:0,colIndex:0},l=this._getLocStr("AutoFillOptions").split("/"),n=this.getActiveSheetIndex(),s=t.preferredCulture(this.model.locale).numberFormat;for(this._dataContainer=this.isImport||this.model.isImport?e.extend(!0,{},this._impData.dataContainer):{sheets:{},sheetCellType:{},hashCode:[],sharedData:[],cellType:[],valData:[],cFormatData:[],customCellStyle:{}},this._newSIndex=1,this.isImport=this.isImport||!1,this.mergeCenter=!1,this.isDirty=!1,this._calcID=CalcEngine.createSheetFamilyID(),this._calcEngine=new CalcEngine(this,this._calcID),this._calcEngine.setUseDependencies(!0),this._calcEngine.setExcelLikeComputations(!0),this._calcEngine.setUseDatesInCalculations(!0),this._calcEngine.setEnableFormulaErrorValidation(!0),this._calcEngine.setCalculatingSuspended(e("#"+this._id+"_CalcManual").find("span").hasClass("e-ss-calcauto")),this._sheets=[],this._cellProp=["value","value2","type","cFormatRule","range","thousandSeparator","rule","format","border","picture","chart","calcValue","align","hyperlink","formats","borders","tformats","tborders","isFilterHeader","filterState","tableName","comment","formatStr","decimalPlaces","cellType","isFilterHighlight","pivot","sparkline","hasFormulaArray","hasMultipleFormulaArray","formulaRange","customFormat"],this.model.isGridMode&&(this.model.sheets=this.model.sheets.splice(n-1,1)),this.isImport||this.model.isImport||(this.model.sheets.splice(0,0,{}),this._updateCellType()),this.model.isGridMode&&(this.model.sheetCount=1);i<=this.model.sheetCount;)this.isImport||this.model.isImport||(this._dataContainer.sheets[i]={}),this._sheetSettings(i),this._newSIndex++,i++;this._detachTable=null,this._isPrint=!1,this._isSheetInsert=!1,this._isSheetRename=!1,this._isTableRename=!1,this._tableClassName=null,this._isSheetNavigate=!1,this._sheetCopy={isSheetCopy:!1,sheetContent:null},this._alertDialog={element:null,action:null},this._dataManager=null,this._isUndo=!1,this._undoCollection=[],this._redoCollection=[],this._ctrlKeyCount=0,this._formulaRange=[],this._formulaHeight=36,this._isSort=!1,this._isPaste=!1,this._isFATResize=!1,this._isDisplayHeader=!1,this._currencySymbol=s.currency.symbol||"$",this._percentSymbol=s.percent.symbol||"%",this._decimalSeparator=s["."]||".",this.operators={"<":function(e,t){return e<t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<=":function(e,t){return e<=t},"==":function(e,t){return e===t},"!=":function(e,t){return e!==t},"!":function(e){return!e},"=":function(e){return e}},this.parse={parseInt:function(e){return parseInt(e)},parseFloat:function(e){return parseFloat(e)},parseDate:function(e){return new Date(e).getTime()},parseTime:function(e){return new Date("01/01/1990 "+e).getTime()},length:function(e){return"^"===e.charAt(0)?parseInt(e.split("^")[1]):e.length}},this._selMergeCells=[],this._mergeType="merge-cells",this._delCells=[],this._deletedText=[],this._removeMergeColl=[],this._insData={},this._deletedDimension=[],this._insDelStatus="",this._isUndoRedo=!1,this._indexBox=null,this._inputBox=null,this._focusTopElem=null,this._focusRightElem=null,this._focusBottomElem=null,this._focusLeftElem=null,this._dStartCell=r,this._dEndCell=r,this._pStartCell=r,this._pEndCell=r,this._pFillCell=r,this._borderFocus=["e-focusright","e-focusbottom"],this._cutFocus=["e-cutright","e-cutbottom"],this._autoFillFocus=["e-autofillright","e-autofillbottom"],this._formulaBorder=[["e-bborderright","e-bborderbottom"],["e-rborderright","e-rborderbottom"],["e-vborderright","e-vborderbottom"],["e-gborderright","e-gborderbottom"],["e-pborderright","e-pborderbottom"],["e-oborderright","e-oborderbottom"]],this._ctrlFormulaBorder=[["e-bctrlborderright","e-bctrlborderbottom"],["e-rctrlborderright","e-rctrlborderbottom"],["e-vctrlborderright","e-vctrlborderbottom"],["e-gctrlborderright","e-gctrlborderbottom"],["e-pctrlborderright","e-pctrlborderbottom"],["e-octrlborderright","e-octrlborderbottom"]],this._borderTypes=[{id:"bottomborder",text:this._getLocStr("BottomBorder"),parentId:null,sprite:"e-icon e-ss-bottomborder"},{id:"topborder",text:this._getLocStr("TopBorder"),parentId:null,sprite:"e-icon e-ss-topborder"},{id:"leftborder",text:this._getLocStr("LeftBorder"),parentId:null,sprite:"e-icon e-ss-leftborder"},{id:"rightborder",text:this._getLocStr("RightBorder"),parentId:null,sprite:"e-icon e-ss-rightborder"},{id:"noborder",text:this._getLocStr("NoBorder"),parentId:null,sprite:"e-icon e-ss-noborder"},{id:"allborder",text:this._getLocStr("AllBorder"),parentId:null,sprite:"e-icon e-ss-allborder"}],this._datePattern=["year","month","day","hours","minutes","seconds"],this._styleColl={},this._borderStyle="solid",this._borderColor="#000000",this._borderStyles=["solid","dashed","dotted","double"],this._ddlCell=null,this._cOpt={},this._shapeChange=!1,this._dupDetails=!1,this._paste=!1,this._autoFillElem=null,this._autoFillOptElem=null,this._fillOptionMenuData=[{id:"copycells",text:l[0],parentId:null,sprite:"e-icon e-ss-fillselect"},{id:"fillseries",text:l[1],parentId:null,sprite:"e-icon e-ss-filloption"},{id:"fillformattingonly",text:l[2],parentId:null,sprite:"e-icon e-ss-filloption"},{id:"fillwithoutformatting",text:l[3],parentId:null,sprite:"e-icon e-ss-filloption"},{id:"flashfill",text:l[4],parentId:null,sprite:"e-icon e-ss-filloption"}],this._formulaSuggElem=null,this._isFormulaSuggestion=!1,this._shiftKeyEnabled=!1,this._preventctrlkey=!1,this._rAlign="e-ralign",this._cAlign="e-calign",this._chartBorder=[["e-rcborderright","e-rcborderbottom"],["e-vcborderright","e-vcborderbottom"],["e-bcborderright","e-bcborderbottom"]],this._selectionBorder=["e-selecttop","e-selectright","e-selectbottom","e-selectleft"],this._autofillBorder=["e-autofilltop","e-autofillright","e-autofillbottom","e-autofillleft"],this._thinBorder=["e-thinborderright","e-thinborderbottom"],this._rcRegx=new RegExp("\\be-rc.*\\b","g"),this._formatRegx=new RegExp("\\be-format.*?\\b","g"),this._borderRegx=new RegExp("\\be-border.*?\\b","g"),this._formulaChanged=[],this._ref=[],this._nmRef=[],this._prevText="",this._prevVal="",this._dlgHLClick=!1,this._selectDataval={},this._undoInputobj={},this._cureditedCell="",this._colHeaderHeight=22,this._rowHeaderWidth=30,this._scrollerHeight=18,this._scrollerWidth=18,this._bufferCnt=5,this._maxRowCnt=1048576,this._maxColCnt=16384,this._impData=this._impData||null,this._isNew=!1,this._isSheetReq=!1,this._intrnlReq=!1,this._isTableBrdrEnd=!1,this._isFilterApplied=!1,this._commentCount=0,this._tableCnt=1,this._uploadImage=!1,this._responsiveWidth=0,this._responsiveHeight=0,this._celltypes=[],this._reqCnt=0,this._resCnt=0,this._pageClickArgs=null,this._gotoPageArgs=null,this._updateFormulaCollection(),this._isRibbonClick=!1,this._intrnlUpdate=!1,this._isPvtNameEdit=!1,this._hlColor="#428bca",this._isFilter=!1,this._isShowHide=!1,this._insRows={},this._isTotalRow=!1,this._scrollReverse=!1,this._phoneMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth<420,this._tabMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth>419&&document.documentElement.clientWidth<617,this._dlgHeight=this._responsiveHeight-2,this._dlgWidth=this._responsiveWidth-2,this._isTouchEvt=!1,this._isTouchMoveSel=!1,this._isTouchScroll=!1,this._isScrolling=!1,this._startXY=null,this._touchArgs=null,this._isResized=!1,this._isRibbonDestroyed=!1,this._resizeColl=[],this._delWrapColl={},this._isInsdel=!1,this._canOverflow=!0,this.preventFilterPopup=!1,this._FATStyles={},this._isFiltered=!1,this._dautoFillCell={rowIndex:0,colIndex:0},this._isPublic=!1,this._fRow={rowAdj:!0,fRowCnt:0},this._fCol={colAdj:!0,fColCnt:0},this.isPasteValuesOnly=!1,this._isSaveAsJSON=!1,this._cssClass="",this._hideRowColl=[],this._isSort=!1,this._isKeyCtrlShftF2=!1,this._isSelIdxChange=!1,this._isRefresh=!1,this._clkCellObj={rowIndex:0,colIndex:0},this._copySheet=!1,this._isCopyPaste=!1,this._overFlowRowIdx=!1,this._tableRangesFormula={},this._tableFormulaCollection={},this._hasFormulaArray=!1,this._hasMultipleFormulaArray=!1,this._formulaArray=!1,this._isFormulaCln=!1,this._copyColumns={},this._isSameRowColumn=!1,this._prevCellTypes={},this._curCellTypes={},this._cellTypesUndo={},this._cellTypesRedo={},this._prevChartDetails={},this._curChartDetails={},this._chartRedo={},this._chartUndo={},this._isDataSrcMethod=!1,this._isallowScrollingSetModel=!1,this._isallowVirtualScrollingSetModel=!1,this._isGridModeSettings={},this._isGridModeWidthChange=!1,this._prevValData={},this._curValData={},this._valDataUndo={},this._valDataRedo={},this._isTrigCellSave=!1,this._ddCellSave=!1,this._saveTriggered=!1},_initFATProps:function(){var e,t,i="w:bold",r="c:#FFFFFF",l="c:#000000",n="c:#2F75B5",s="c:#ED7D31",o="c:#FFC000",a="1px solid #000000",d="1px solid #2f75b5",h="1px solid #ED7D31",c="1px solid #FFC000",u="b:#D9D9D9",g="b:#DDEBF7",p="b:#FCE4D6",m="b:#FFF2CC",_="b:#000000",f="b:#FFE2C6",b="b:#FFF1BF",C="b:#000000",S="b:#D7D7D7",x="b:#FFC000",v="b:#5B9BD5",w="b:#Ed7D31",I="hl?"+i+";"+l+";bo:tb-"+a+"&cl?"+u+";"+l+","+l+"&cb?b-"+a+"/hl?"+i+";bo:tb-"+d+";"+n+"&cl?"+g+";"+n+","+n+"&cb?b-"+d+"/hl?"+i+";bo:tb-"+h+";"+s+"&cl?"+p+";"+s+","+s+"&cb?b-"+h+"/hl?"+i+";bo:tb-"+c+";"+o+"&cl?"+m+";"+o+","+o+"&cb?b-"+c+"/hl?"+i+";"+_+";"+r+";bo:o-"+a+"&cl?bo:t-"+a+";"+l+"&cb?o-"+a+"/hl?bo:o-"+d+";"+i+";"+v+";"+r+"&cl?bo:t-"+d+";"+l+"&cb?o-"+d+"/hl?"+i+";b:#EB7E2F;"+r+";bo:o-"+h+"&cl?bo:t-"+h+";"+l+"&cb?o-"+h+"/hl?"+i+";"+x+";"+r+";bo:o-"+c+"&cl?bo:t-"+c+";"+l+"&cb?o-"+c+"/hl?"+i+";bo:gb-"+a+";"+l+"&cl?"+u+";"+l+","+l+"&cb?gb-"+a+"/hl?"+i+";bo:gb-"+d+";"+l+"&cl?"+g+";"+l+","+l+"&cb?gb-"+d+"/hl?"+i+";bo:gb-"+h+";"+l+"&cl?"+p+";"+l+","+l+"&cb?gb-"+h+"/hl?"+i+";bo:gb-"+c+";"+l+"&cl?"+m+";"+l+","+l+"&cb?gb-"+c+"/hl?"+i+";"+_+";"+r+"&cl?b:#A6A6A6;"+l+","+u+";"+l+"/hl?"+i+";"+v+";"+r+"&cl?b:#BDD7EE;"+l+","+g+";"+l+"/hl?"+i+";"+w+";"+r+"&cl?b:#F8CBAD;"+l+","+p+";"+l+"/hl?"+i+";"+x+";"+r+"&cl?b:#FFE699;"+l+","+m+";"+l+"/hl?"+i+";"+S+";"+l+";bo:gb-"+a+"&cl?b:#A7A7A7;"+l+","+S+";"+l+"&cb?gb-"+a+"/hl?"+i+";b:#DBECF6;"+l+";bo:gb-"+d+"&cl?b:#BED8F1;"+l+","+g+";"+l+"&cb?gb-"+d+"/hl?"+i+";"+f+";"+l+";bo:gb-"+h+"&cl?b:#F6CAAD;"+l+","+f+";"+l+"&cb?gb-"+h+"/hl?"+i+";"+b+";"+l+";bo:gb-"+c+"&cl?b:#FDE18D;"+l+","+b+";"+l+"&cb?gb-"+c+"/hl?"+i+";"+C+";"+r+"&cl?b:#404040;"+r+",b:#737373;"+r+"/hl?"+i+";"+C+";"+r+"&cl?b:#2F75B5;"+r+","+v+";"+r+"/hl?"+i+";"+C+";"+r+"&cl?b:#C65911;"+r+","+w+";"+r+"/hl?"+i+";"+C+";"+r+"&cl?b:#BF8F00;"+r+","+x+";"+r,y=["Light1","Light2","Light3","Light5","Light8","Light9","Light10","Light12","Light15","Light16","Light17","Light19","Medium8","Medium9","Medium10","Medium12","Medium22","Medium23","Medium24","Medium26","Dark1","Dark2","Dark3","Dark5"];for(I=I.split("/"),e=0,t=y.length;e<t;)this._FATStyles["TableStyle"+y[e]]={format:this.XLRibbon._getFormatAsTableInput(I[e]),formatName:"TableStyle"+y[e]},e++;this.XLFormat._formatAsTableStyle=this._FATStyles["TableStyle"+y[0]]},_updateResponsiveSettings:function(){var e="msie"===t.browserInfo().name&&"8.0"===t.browserInfo().version,i=this.element[0].getClientRects()[0];this._responsiveHeight=Math.floor(e?this.element[0].offsetHeight:i?i.height:0),this._responsiveWidth=Math.floor(e?this.element[0].offsetWidth:i?i.width:0)},_gridModeScroll:function(e){var t,i,r,l,n=this.getActiveSheetIndex(),s=this.getSheet(n),o=this.getSheetElement(n),a=this._getContent(n),d=a.find("#"+this._id+"_content"),h=this._footer.outerHeight(!0),c=this._scrollerHeight,u=this._scrollerWidth,g=s._vPortWth,p=s._vPortHgt,m=0,_=0,f=a.find("#vscrollBar"),b=a.find("#hscrollBar");if(l=t=d.find(".e-table").width(),r=i=d.find(".e-table").height(),this.model.scrollSettings.allowScrolling){if(this.getObjectLength(this._isGridModeSettings)&&(this._isGridModeSettings.width<=t&&(t=this._isGridModeSettings.width,s._vPortWth=g=this._isGridModeSettings.vPortWt,_=this._isGridModeSettings.cWt),this._isGridModeSettings.height<=i&&(i=this._isGridModeSettings.height,s._vPortHgt=p=this._isGridModeSettings.vPortHt,m=this._isGridModeSettings.cHt)),("none"==a.find("#vscrollBar")[0].style.display||m>=r)&&(o.find(".e-spreadsheetheader").hasClass("e-scrollcss")&&(o.find(".e-spreadsheetheader").removeClass("e-scrollcss"),o.find(".e-spreadsheetheader")[0].style.width=parseInt(o.find(".e-spreadsheetheader")[0].style.width)+18+"px"),u=0),("none"==a.find("#hscrollBar")[0].style.display||_>=l)&&(o.find(".e-spreadsheetrowheader").hasClass("e-scrollrowcss")&&(o.find(".e-spreadsheetrowheader").removeClass("e-scrollrowcss"),o.find(".e-spreadsheetrowheader")[0].style.height=parseInt(o.find(".e-spreadsheetrowheader")[0].style.height)+18+"px"),c=0),t>g&&this.model.scrollSettings.allowScrolling)return;s._isNavigated||(o.find(".e-spreadsheetrowheader")[0].style.height=i+"px",o.find(".e-rowheadercontent")[0].style.height=i+"px",a[0].style.height=i+"px",d[0].style.height=i+"px"),t>g&&(t=g+17,u=0),s._isNavigated||(o.find(".e-spreadsheetcontent")[0].style.width=t+u+this._rowHeaderWidth+"px",d[0].style.width=t+"px"),i>p&&(i=p+17,c=0),s._isNavigated||(this.element.find(".e-spreadsheetmainpanel")[0].style.height=i+this._colHeaderHeight+h+"px",this.element.find(".e-spreadsheetgrppanel")[0].style.height=i+this._colHeaderHeight+h+"px",o.find(".e-spreadsheetrowheader")[0].style.height=i+"px",o.find(".e-rowheadercontent")[0].style.height=i+"px",a[0].style.height=i+"px",d[0].style.height=i+"px"),this.element.css({"min-height":"0",width:t+u+(s.showHeadings?this._rowHeaderWidth:0)+2+"px",height:i+c+(s.showHeadings?this._colHeaderHeight:0)+2+h+"px"})}e&&(this._isGridModeSettings={cHt:d.height(),cWt:d.width(),vPortWt:s._vPortWth,vPortHt:s._vPortHgt,width:t,height:i}),s._contWidth=t+u,s._contHeight=i+c,!this.model.scrollSettings.allowVirtualScrolling||s._isNavigated||e||(f&&(f[0].style.display="none"),b&&(b[0].style.display="none"),u&&(s._contWidth=s._contWidth+18,d[0].style.width=t+18+"px"),c&&(s._contHeight=s._contHeight+18,d[0].style.height=i+18+"px"),this.XLScroll._refreshScroller(n,"refresh","all"),u&&(s._contWidth=s._contWidth-18),c&&(s._contHeight=s._contHeight-18),s._virtualBlockRowCnt=Math.ceil(s._vPortHgt/s.rowHeight)+this._bufferCnt,this._refreshViewport(0,n)),s._isNavigated=!0},_getElementDimension:function(){var t,i,r,l,n,s=0,o=0;return this.model.showRibbon&&(t=(r=e("#"+this._id+"_Ribbon").data("ejRibbon")).element[0].offsetWidth,s=r.element[0].offsetHeight),this.model.allowFormulaBar&&(o=(l=e("#"+this._id+"_formulabar")[0]).offsetHeight,t||(t=l.offsetWidth)),i=(n=this.element.find(".e-spreadsheetmainpanel")[0]).offsetHeight,t||(t=n.offsetWidth),{width:t+2,height:s+o+i+1}},_sheetSettings:function(i){var r,l,n,s,o,a,d,h,c;if(this._isSheetReq?l=this.getSheet(i):(a=this.getSheet(i),o=this._generateSheetName(this._newSIndex),l=this.model.sheets[i]={colCount:a&&a.colCount||this.model.columnCount,rowCount:a&&a.rowCount||this.model.rowCount,_formulaCollection:{},columnsWidthCollection:[],_colWidthCollection:[],_ofColWidthColl:[],rowsHeightCollection:[],_rowHeightCollection:[],_rowIdxColl:[],_spreadSheetPager:null,showHeadings:!(a&&!this.isUndefined(a.showHeadings))||a.showHeadings,showGridlines:!(a&&!this.isUndefined(a.showGridlines))||a.showGridlines,dataSource:a&&a.dataSource||null,_jsonData:a?a.dataSource instanceof t.DataManager?null:a.dataSource:null,_dataManager:a&&a.dataSource instanceof t.DataManager?a.dataSource:null,query:a&&a.query||null,primaryKey:a&&a.primaryKey||"",startCell:a&&a.startCell||"A1",topLeftCell:a&&a.topLeftCell||"A1",fieldAsColumnHeader:a&&a.fieldAsColumnHeader||!1,showHeader:!a||!1!==a.showHeader,headerStyles:a&&a.headerStyles||null,batchChanges:{added:[],changed:[],deleted:[]},range:[0,0,0,0],fields:[],_isDataManager:!1,_isOffline:!1,_hasDataSrc:!1,columns:a&&a.columns||[],_columnStyles:{},_rowStyles:{},cellTypes:a&&a.cellTypes||[],rows:a&&a.rows||null,_excelFilter:null,filterSettings:{filteredColumns:[],maxFilterChoices:1e3,filteredRange:[],range:"",tableRange:[]},paperSettings:{paperOrientation:"Portrait",pageSize:"PaperLetter",bottomMargin:"0.75",headerMargin:"0.3",footerMargin:"0.3",leftMargin:"0.7",rightMargin:"0.7",topMargin:"0.75"},frozenRows:a&&a.frozenRows||0,frozenColumns:a&&a.frozenColumns||0,_frozenRows:a&&a.frozenRows&&a.frozenRows+1||1,_frozenColumns:a&&a.frozenColumns&&a.frozenColumns+1||1,_fHMergeRows:[],_fHMergeCols:[],paneTopLeftCell:a&&a.paneTopLeftCell||"A1",_selectedRange:{},_selectedCellColors:[],columnWidth:a&&a.columnWidth||this.model.columnWidth,rowHeight:this.model.rowHeight,_frozenHeight:0,_frozenWidth:0,_firstRow:{idx:0,value:0},_firstCol:{idx:0,value:0},_topRow:{idx:0,value:0},_bottomRow:{idx:0,value:0},_leftCol:{idx:0,value:0},_rightCol:{idx:0,value:0},_filterColl:{},_filteredColumns:[],_commentColl:{},_mergeColl:{},_unmergeColl:{},_delmergeColl:{},_hideMergeColl:{},_clrMergeColl:[],_clrWrapColl:[],_selectedCells:[],selectedRange:[0,0,0,0],tableManager:{},_header:{},_selectedCellIndexes:[],_startCell:{rowIndex:0,colIndex:0},_endCell:{rowIndex:0,colIndex:0},_activeCell:{rowIndex:0,colIndex:0},_autoFillCell:{rowIndex:0,colIndex:0},rangeSettings:a&&a.rangeSettings||[],sheetInfo:{text:o,value:this._getLocStr("Sheet")+this._newSIndex,isVisible:!0},_multipleFiltering:!1,_multifilterIdx:[],_filteredByColor:"",staticWidth:0,_fRow:0,_fCol:0,hideColsCollection:{},hideRowsCollection:a&&a.hideRowsCollection||[],_hiddenFreezeRows:[],_hiddenFreezeCols:[],_filterHRowsColl:[],_restrictedHeightRows:[],filteredRowsCollection:[],_rHeightCollection:[],_frHiddenHeight:0,_fpHiddenHeight:0,_fpHiddenWidth:0,_pTarget:{},_cSpan:1,_rSpan:1,usedRange:{rowIndex:0,colIndex:0},mergedCells:[],shapeMngr:{picture:{},chart:{},sharedPics:[],sparkline:{}},formulaRange:{},pivotMngr:{pivot:{}},_nmValue:{},_nmEdit:!1,_wrapHtCollection:{},_isChartBorderDrawn:!1,_virtualBlockCnt:0,_virtualBlockRowCnt:0,_virtualContBlockIdx:1,_virtualTopTBodyHgt:0,_virtualBottomTBodyHgt:0,_virtualTBodyHgt:0,_scrollTop:0,_scrollLeft:0,_virtualRowIdx:[],_virtualTopTBodyOffset:{top:0,bottom:0},_virtualContTBodyOffset:{top:0,bottom:0},_virtualBottomTBodyOffset:{top:0,bottom:0},_virtualDataLoadedBlks:[],_virtualDataMngrLoadedBlks:[1,2],_isVirtualTopReached:!0,_isVirtualEndReached:!1,_isLoaded:!1,_isNavigated:!1,_isImpSLoad:!1,_isRowSelected:!1,_isColSelected:!1,_isSheetSelected:!1,isSheetProtected:!1,_contWidth:0,_isRangeSelected:!1,_isEmptyActiveCell:!1,_isMultiSelect:!1,_isImported:this.isImport,_isRequested:!1,_goToCollection:{multiple:!1,selected:[]},_showLockCellAlert:!1,_reqCnt:0,_resCnt:0,_templateColCount:0,_isTemplate:!1,_cFormatFormula:{},_isVPRendered:!1,_isDataMoved:!1,_vPortHgt:0,_vPortWth:0,cFormatRule:a&&a.cFormatRule||[],mergeCells:a&&a.mergeCells||[],hideRows:a&&a.hideRows||[],hideColumns:a&&a.hideColumns||[],border:a&&a.border||[],isResized:!1,_isOpened:!1,_wrapColl:{},_formatColl:{},_isFreezed:!1,_ftopRowIdx:0,_fleftColIdx:0,_contScrollTop:0,_contScrollLeft:0,_fDivTop:0,_fDivLeft:0,_isRibCollapsed:!1,_wrapValColl:{rows:{},cols:{}},_refrshObj:{},_scopeRanges:{}},this._initRangeSettings(i),s=l.sheetInfo.value,this._sheets[i]={_contentColGroup:null,_content:null,_sheetRowHeaderContent:null,_sheetHeader:null,_sheetRowHeader:null,_sheetContent:null,_Rows:null,_contTBody:null,_rowHdrTBody:null},this._calcEngine.registerGridAsSheet(s,s,this._calcID)),(this.isImport||this.model.isImport)&&(n=this._impData.model.sheets[i],r=this.getRangeIndices(n.topLeftCell||"A1"),l.sheetInfo.text=n.sheetInfo.text,l.sheetInfo.isVisible=!!this.isUndefined(n.sheetInfo.isVisible)||n.sheetInfo.isVisible,this.model.importSettings.allowSheetOnDemand&&i!==this.getActiveSheetIndex()||(l._isRequested=!0),l._isRequested)){if(n.paperSettings&&(l.paperSettings=e.extend({},l.paperSettings,n.paperSettings)),n.usedRange&&(n.usedRange.rowIndex&&(l.usedRange.rowIndex=n.usedRange.rowIndex),n.usedRange.colIndex&&(l.usedRange.colIndex=n.usedRange.colIndex)),n._startCell&&(n._startCell.rowIndex&&(l._startCell.rowIndex=n._startCell.rowIndex),n._startCell.colIndex&&(l._startCell.colIndex=n._startCell.colIndex)),n._endCell&&(n._endCell.rowIndex&&(l._endCell.rowIndex=n._endCell.rowIndex),n._endCell.colIndex&&(l._endCell.colIndex=n._endCell.colIndex)),n._activeCell&&(n._activeCell.rowIndex&&(l._activeCell.rowIndex=n._activeCell.rowIndex),n._activeCell.colIndex&&(l._activeCell.colIndex=n._activeCell.colIndex)),n.columnsWidthCollection&&(l.columnsWidthCollection=n.columnsWidthCollection),n.rowsHeightCollection){for(d=0,h=(c=n.hideRowsCollection||[]).length;d<h;d++)n.rowsHeightCollection[parseInt(c[d])]=0;l.rowsHeightCollection=e.extend(!0,[],n.rowsHeightCollection)}t.isNullOrUndefined(n.showGridlines)||(l.showGridlines=n.showGridlines),n.hideRowsCollection&&(l.hideRowsCollection=n.hideRowsCollection||[]),n.formulaRange&&(l.formulaRange=n.formulaRange||{}),n.shapeMngr.picture.length&&(l.shapeMngr.sharedPics=n.shapeMngr.sharedPics),n.isSheetProtected&&(l.isSheetProtected=n.isSheetProtected),n._restrictedHeightRows&&(l._restrictedHeightRows=n._restrictedHeightRows||[]),n._isColSelected&&(l._isColSelected=n._isColSelected),n._isRowSelected&&(l._isRowSelected=n._isRowSelected),!1===n.showHeadings&&(l.showHeadings=!1),n.frozenRows&&(l.frozenRows=l._frozenRows=r[0]+n.frozenRows,l._frozenRows=l.frozenRows+1),n.frozenColumns&&(l.frozenColumns=l._frozenColumns=r[1]+n.frozenColumns,l._frozenColumns=l.frozenColumns+1)}},_generateSheetName:function(e){var t,i,r,l,n=1,s=this.model.sheets,o=this._getLocStr("Sheet");for(r=(l=s[e])&&l.sheetName||o+e,t=1,i=s.length;t<i;t++)s[t].sheetInfo&&r===s[t].sheetInfo.text&&(t=0,r=l&&l.sheetName?l.sheetName+n++:o+ ++e);return r},_initRangeSettings:function(e){var i,r=this.getSheet(e),l=r.rangeSettings.length;if(l)for(;l--;)(i=r.rangeSettings[l]).dataSource&&(i._jsonData=i._dataManager=null,i.dataSource instanceof t.DataManager?i._dataManager=i.dataSource:i._jsonData=i.dataSource,0!=i.showHeader&&(i.showHeader=!0))},_initCSSTag:function(){if(!document.getElementById(this._id+"_sscustomformat")){(this.isImport||this.model.isImport)&&(this._dataContainer.hashCode=[]);var e,t,i,r=0;if(i=this._renderStyleTag("custom"),(this.isImport||this.model.isImport)&&this._refreshImpStyles(this._impData.dataContainer.hashCode),this.XLFormat)for(t=(e="s:11pt/b:#FFC7CE;c:#82012A;f:calibri;s:11pt/b:#C6EED2;c:#0A7043;f:calibri;s:11pt/b:#FEEC9B;c:#826717;f:calibri;s:11pt/f:Calibri;w:bold;v:top;s:11pt/f:calibri;s:18pt/b:#DDE5F6;f:calibri;s:11pt/b:#FDE0D2;f:calibri;s:11pt/b:#EEEEEC;f:calibri;s:11pt/b:#FEF4CD;f:calibri;s:11pt/b:#9CC0E7;f:calibri;s:11pt/b:#F9AD7B;f:calibri;s:11pt/b:#C9C9C9;f:calibri;s:11pt/b:#FED965;f:calibri;s:11pt/b:#559AD9;c:#FFFFFF;f:calibri;s:11pt/b:#EB7E2F;c:#FFFFFF;f:calibri;s:11pt/b:#A5A5A5;c:#FFFFFF;f:calibri;s:11pt/b:#FDBF01;c:#FFFFFF;f:calibri;s:11pt".split("/")).length;r<t;)this.XLFormat._createFormatClass(this._getStyleAsJSON(e[r]),null,!0),r++;e=".e-spreadsheet .e-hide, .e-spreadsheet .e-mc-hide, .e-spreadsheet .e-fr-hide, .e-spreadsheet .e-fc-hide, .e-spreadsheet .e-c-hide, .e-spreadsheet .e-r-hide, .e-spreadsheet .e-col-hide{ display: none}",e+=".e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-redft { background-color: #FFC7CE; color: #9C0055;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-yellowft { background-color: #FFEB9C; color: #9C6500;}",e+=".e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-greenft { background-color: #C6EFCE;   color: #006100;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-redf { background-color: #FFC7CE;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-redt { color: #9C0055;}",e+=".e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-hlcell { background-color: #FFFF00; color: #FF0000;} .e-js.e-spreadsheet .e-spreadsheetmainpanel .e-rowcell.e-goto-blank { background-color: #C6C6C6;}",i.styleSheet?i.styleSheet.cssText+=e:i.appendChild(document.createTextNode(e))}this._renderStyleTag("showhide")},_initEditForm:function(){var e,i,r;(e=t.buildTag("input","",{display:"none"},{id:this._id+"_AutoComplete"})).addClass("e-hide"),this.element.append(e),this.XLEdit._renderAutoComplete(e,"",null,!0),e.data("ejAutocomplete")._setListPosition=function(){},i=t.buildTag("form","",{width:1,height:1,display:"none"},{id:this._id+"EditForm"}),r=t.buildTag("input","",{width:1,height:1,overflow:"hidden",opacity:0},{id:this._id+"_ValElem"}),i.append(r),r.data("id",this._id),this.element.append(i)},_getStyleAsJSON:function(e){var t,i,r=0,l={},n={b:"background-color",c:"color",f:"font-family",s:"font-size",w:"font-weight",v:"vetical-align",bo:"border"};for(i=(e=e.split(";")).length;r<i;)l[n[(t=e[r].split(":"))[0]]]="bo"===t[0]?this.XLRibbon._getBorderObj(t[1].split("-")[0],t[1].split("-")[1]):t[1],r++;return l},_initLayout:function(){this.model.showRibbon&&(this.XLRibbon._renderRibbon(),this._tabMode&&e("#"+this._id+"_Ribbon").ejRibbon("collapse")),this.model.allowFormulaBar&&this._renderFormulaBar(),this._renderFUpload(),this._renderLayout()},_renderLayout:function(){var e,i,r=this.getDataSettings(this.getActiveSheetIndex());if(this.model.isGridMode&&t.isNullOrUndefined(r))return this._renderAlertdlg(),this._showAlertDlg("Alert","GridDataSourceAlert","",630),void this.element.css({height:0,width:0,"min-height":0,"min-width":0});for(this._renderPanel(),this._initTags(),this._initDependencies(),this._renderFooter(),this._refreshSheetLayout(),this.model.scrollSettings.allowVirtualScrolling||this.model.scrollSettings.allowSheetOnDemand?e=i=this.getActiveSheetIndex():(e=1,i=this.model.sheetCount);e<=i;)this._initSheet(e),e++},_renderPanel:function(){var e,i,r=this.model.scrollSettings;e=t.buildTag("div.e-spreadsheetgrppanel","",{},{id:this._id+"GroupPanel"}),this.setGroupPanel(e),i=t.buildTag("div.e-spreadsheetmainpanel",this._renderDIV("e-spreadsheet-list",""),{},{id:this._id+"MainPanel"}),e.append(i),this.setMainPanel(i),i=t.buildTag("div.e-spreadsheetactpanel","",{height:r.height,width:this.model.activationPanelWidth-1,display:"none"},{id:this._id+"ActivationPanel"}),e.append(i),this.setActivationPanel(i),this.element.append(e)},_refreshSheetLayout:function(){var t,i,r,l,n=-1,s=this.model.pageSettings.pagerHeight+1;this._updateResponsiveSettings(),this.XLRibbon._ribbonState&&(n=e("#"+this._id+"_Ribbon").find(".e-content:eq(1)").height()),r=this._phoneMode?e("#"+this._id+"_Ribbon").height():e("#"+this._id+"_Ribbon").find(".e-header").height()+n+2,i=this.model.allowFormulaBar?this._formulaHeight:0,l=r&&this.model.showRibbon&&e("#"+this._id+"_Ribbon").is(":visible")?r:0,this.model.showPager&&this.element.find(".e-spreadsheetfooter").is(":visible")||(s=1),t=this._responsiveHeight-(l+i+2),"msie"==this._browserDetails.name||this._isAutoWHMode||this.element.find(".e-spreadsheet-list").height(t-s)},_initTags:function(){var e=t.buildTag("span#"+this._id+"_emptySpan"),i=t.buildTag("div#"+this._id+"_emptyDiv");this.element.find(".e-spreadsheetmainpanel")[0].insertBefore(e[0],this.element.find(".e-spreadsheetmainpanel").find(".e-spreadsheet-list")[0]),this.element.find(".e-spreadsheetmainpanel")[0].insertBefore(i[0],this.element.find(".e-spreadsheetmainpanel").find(".e-spreadsheet-list")[0]),this._refreshGlobalSpan()},_refreshGlobalSpan:function(t,i){(t=t||document.getElementById(this._id+(i?"_emptyDiv":"_emptySpan"))).textContent="",t.className="","msie"===this._browserDetails.name&&"8.0"===this._browserDetails.version?e(t).removeAttr("style").text(""):t.removeAttribute("style")},_initSheet:function(e){var t,i=0,r=this.getSheet(e),l=this.getDataSettings(e);if(this._updateResponsiveSettings(),this._initViewPort(e),l&&!this._sheetCopy.isSheetCopy)for(t=l.length;i<t;)this._initDataSrc(e,r,l[i]),i++;r._reqCnt===r._resCnt&&this._renderSheet(e)},_initViewPort:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=-1,C=this._dataContainer.sheets,S=this.model.scrollSettings,x=this.getSheet(i);if(r=l=s=o=a=d=h=f=0,S.allowScrolling&&(s=this._scrollerHeight,o=this._scrollerWidth),x.showHeadings&&(a=this._colHeaderHeight,d=this._rowHeaderWidth),this.model.showRibbon&&(n=this.getSheet(this.getActiveSheetIndex())._isRibCollapsed?0:n=e("#"+this._id+"_Ribbon_home").height(),l=(l=this.element.find(".e-box.e-addborderbottom.e-header").height()+n+2)<189?l:188),this.model.allowFormulaBar&&(h=this._formulaHeight),this.model.showPager&&this.element.find(".e-spreadsheetfooter").is(":visible")&&(b=this.model.pageSettings.pagerHeight),this.getActivationPanel().is(":visible")&&(r=this.getActivationPanel().width()),x._vPortHgt=this._responsiveHeight-(l+h+a+b+s),x._vPortWth=this._responsiveWidth-(r+o+d),S.allowVirtualScrolling&&(f=x._virtualBlockRowCnt,x._virtualBlockRowCnt=Math.ceil(x._vPortHgt/x.rowHeight)+this._bufferCnt,x._hasDataSrc&&f<x._virtualBlockRowCnt))for(c=x._virtualBlockRowCnt,g=(u=x._virtualDataLoadedBlks).length,p=0;p<g;p++)for(m=(_=u[p]*c)-c+1;m<=_;m++)t.isNullOrUndefined(C[i][m])&&this._refreshDataSrc([m,0,m,x.usedRange.colIndex,i])},_initDataSrc:function(e,i,r){var l,n={sheetIndex:e,lockWorkbookCells:!1,computeFormula:this._computeFormula};r._dataManager?(this._trigger("load",n),this._isDefaultLocked=n.lockWorkbookCells,this._computeFormula=n.computeFormula,r._dataManager instanceof t.DataManager&&(r._dataManager.ready?(l=this,i._reqCnt++,this._reqCnt++,r._dataManager.ready.done(function(){l._initDataMngr(e,i,r)})):this._initDataMngr(e,i,r))):r._jsonData&&(r.count=r._jsonData.length)},_initDataMngr:function(e,i,r){var l,n,s,o,a,d,h=0,c=this;if(r._isDataManager=!0,r._isOffline=r._dataManager.dataSource.offline,r.query||(r.query=new t.Query),r.query.requiresCount(),this.model.scrollSettings.allowVirtualScrolling){if(o=r.query.queries,l=o.length)for(;l--;)"onTake"===(n=o[l]).fn?(h=n.e.nos,o.splice(l,1)):"onSkip"===n.fn&&(r._skip=n.e.nos);d=2*i._virtualBlockRowCnt,r.startCell&&((s=this.getRangeIndices(r.startCell))[0]&&(d-=s[0]-0)),h&&h<d&&(d=h),r.query.take(d)}(a=r._dataManager.executeQuery(r.query)).done(function(t){(l=t.count||t.result.length)&&(r._jsonData=t.result,r.count=c.model.isGridMode?t.result&&t.result.length>0?t.result.length:1:h||l),c._isDataSrcMethod?(i.fieldAsColumnHeader?(i.columns=[],c._initTmplColumns(e),c.refreshContent(e),this._isDataSrcMethod=!1):(c.refreshContent(e),this._isDataSrcMethod=!1),c._isAutoWHMode&&c._setElemDimension(),c.model.isGridMode&&!c._isAutoWHMode&&this._gridModeScroll(!0)):(c._respHandler(e),c.model.isGridMode&&!c._isAutoWHMode&&c._gridModeScroll(!0))}),a.fail(function(){c._respHandler(e)}),r._dataManager.isDataAvailable||(i._reqCnt++,this._reqCnt++)},_respHandler:function(e){var t=this.getSheet(e);t._resCnt++,this._resCnt++,t._reqCnt===t._resCnt&&this._renderSheet(e),this._initComplete(),this._isAutoWHMode&&this._setElemDimension()},_renderSheet:function(i){var r,l,n,s,o,a,d,h=this.getActiveSheetIndex(),c=this.getSheet(i),u=c.sheetInfo.value,g={},p=this.element.find("#"+this._id+"_"+u),m={sheetIndex:i,lockWorkbookCells:this._isDefaultLocked,computeFormula:this._computeFormula};for(this._resizeColl[i-1]=!1,this._isInitLoad&&this._trigger("load",m),this._isDefaultLocked=m.lockWorkbookCells,this._computeFormula=m.computeFormula,this._initTmplColumns(i),r=1===p.length?p:t.buildTag("div.e-sheet e-hide ","",{},{id:this._id+"_"+u}),a=0,d=(o=this._renderContent(i)).length;a<d;a++)r.append(o[a]);p.length||(this.model.allowFreezing&&(s=this.XLFreeze._getHFreeze()),s?s.before(r):this.element.find(".e-spreadsheet-list").append(r)),!1===c.showGridlines&&e("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").ejCheckBox({checked:c.showGridlines}),this.model.enableContextMenu&&(this.XLCMenu._initContextMenu(),this.XLCMenu._initColorDialog(),this.XLCMenu._initCMenuFooter()),this._updateResponsiveSettings(),this._removeClass(r,"e-hide"),g.width=this._responsiveWidth,g.height=this._responsiveHeight,this.model.showRibbon&&!this._isAutoWHMode&&(this._tabMode||this._responsiveHeight<280)&&e("#"+this._id+"_Ribbon").ejRibbon("collapse"),this._setSheetWidthHeight(i,g,null,"refresh","initial"),this._refreshCellBinding(i),this._refreshImpResRowHght(i),this.refreshContent(i),i===h&&this._updateHiddenRows(h),this._initializePicture(i),this.model.allowCellType&&this.model.allowAutoCellType&&this._celltypes.length&&this._processCellTypes(this._celltypes,i),this.model.allowCellType&&!this.model.scrollSettings.allowVirtualScrolling&&this.XLCellType._rangeCellTypes(c.cellTypes,i),c._isImported&&!this._sheetCopy.isSheetCopy&&(this.setActiveSheetIndex(i),this._refreshImpSheets(i),this.setActiveSheetIndex(h)),i!==h?r.hide():this._initSelection(),this._initSheetModel(i),(this.isImport||this.model.isImport)&&c._isFreezed&&(n=this._impData.model.sheets[i],l=this.getRangeIndices(n.paneTopLeftCell),this._isFrozen(c.frozenRows)&&this.XLScroll._vScroller(i).scroll(this._getRowOffsetTop(c,l[0])-c._frozenHeight),this._isFrozen(c.frozenColumns)&&this.XLScroll._hScroller(i).scroll(this._getColOffsetLeft(c,l[1])-c._frozenWidth)),c._isLoaded=!0,!this._isSheetInsert&&(this._pageClickArgs||this._gotoPageArgs)&&this._pageLoadComplete(i),this.getSheet(h)._isOpened=!0,this.model.showRibbon&&("hidden"===e("#"+this._id+"_Ribbon")[0].style.overflow&&(e("#"+this._id+"_Ribbon")[0].style.overflow="",this.model.showRibbon&&this.XLRibbon._refreshBackstageHeight()),c._isRibCollapsed=!this.XLRibbon._ribbonState),this._isAutoWHMode&&i==h&&this._autoSSWidthHeight(i)},_initSheetModel:function(e){var t,i,r,l,n=this.getSheet(e),s=this.getFrozenRows(e),o=this.getFrozenColumns(e);!1===n.showHeadings&&this.showHeadings(n.showHeadings),n._isImported&&(l=this._impData.model.sheets[e],t=this.getRangeIndices(l.topLeftCell||"A1")),i=n._isImported?t[0]:this._isFrozen(s)&&n._bottomRow.idx<=s?s-1:0,r=n._isImported?t[1]:this._isFrozen(o)&&n._rightCol.idx<=o?o-1:0,this.model.scrollSettings.allowScrolling&&(i>0&&this.XLScroll._vScroller(e).scroll(this._getRowOffsetTop(n,i)),r>0&&this.XLScroll._hScroller(e).scroll(this._getColOffsetLeft(n,r))),this.model.allowFreezing&&(this._isFrozen(s)&&this._isFrozen(o)?this.XLFreeze.freezePanes(s,o):this._isFrozen(s)?this.XLFreeze._freeze(s):this._isFrozen(o)&&this.XLFreeze._freeze(null,o))},_initTmplColumns:function(e){for(var t,i,r,l=this.getSheet(e),n=l.columns.length,s=0;s<n;s++)l.columns[s].field&&l.columns[s].text&&(this._copyColumns[l.columns[s].field]=l.columns[s]);if(n&&(l.columns=[]),!this._sheetCopy.isSheetCopy&&!l.rangeSettings.length&&l.dataSource&&l._jsonData&&l.fieldAsColumnHeader&&(r=l._jsonData[0],s=this.getRangeIndices(l.startCell)[1]+1,r)){for(i in r)r.hasOwnProperty(i)&&(t=r[i],"object"==typeof r[i]&&(i=this._iterateComplxObj(r[i],i).prop),l.columns[s-1]={field:this._generateHeaderText(s),text:i,type:null!=t?t.getDay?"date":typeof t:null},s++);l.colCount=l._templateColCount=l.columns.length,l._isTemplate=!0}},_refreshCellBinding:function(e){var t,i,r,l,n,s,o,a,d=this.getSheet(e),h=d.mergeCells,c=d.hideRows;if(h.length)for(l=0,r=h.length;l<r;l++)for(s=(n=this.getRangeIndices(h[l]))[2]-n[0]+1,o=n[3]-n[1]+1,t=0;t<s;t++)for(i=0;i<o;i++)a=0==t&&0==i?{merge:{isMerge:!0,mRange:h[l],isCenterAlign:!1,mSpan:{colSpan:o,rowSpan:s}}}:{isMHide:!0,mergeIdx:{rowIndex:n[0],colIndex:n[1]}},this.XLEdit._updateDataContainer({rowIndex:n[0]+t,colIndex:n[1]+i},{dataObj:a,sheetIdx:e,skipCell:!0});if(c.length&&this.model.scrollSettings.allowVirtualScrolling)for(t=0,r=c.length;t<r;t++)this._cellBindHiddenRows(c[t],c,e)},_cellBindHiddenRows:function(e,t,i){var r,l,n=this.getSheet(i),s=this.XLEdit;n.hideRowsCollection.push(e),this.XLScroll._getRowHeights(i,t.sort()[0]),l=0===e?{rowIndex:e,colIndex:0}:{rowIndex:e-1,colIndex:0},r={rowIndex:e,colIndex:0},s._updateDataContainer(l,{dataObj:{hRow:!0},sheetIdx:i,skipCell:!0}),s._updateDataContainer(r,{dataObj:{isRHide:!0},sheetIdx:i,skipCell:!0})},_updateHiddenRows:function(e){var i,r,l,n,s,o,a,d=this.getSheet(e),h=d.hideRows,c=d.cFormatRule,u=d.hideColumns,g=d.border;if(h.length&&!this.model.scrollSettings.allowVirtualScrolling)for(i=0,r=h.length;i<r;i++)o=h[i],n=(l=this.getRows(e))[1],s=l[0],this.addClass(n[o],"e-r-hide"),this.addClass(s[o],"e-r-hide"),o>0&&this.addClass(s.eq(o-1).find("td")[0],"e-hrow"),this._cellBindHiddenRows(o,h,e);if(u.length&&!this.model.scrollSettings.allowVirtualScrolling){for(i=0,r=u.length;i<r;i++)d.hideColsCollection[u[i]]||this._updateHiddenColumns({rowIndex:0,colIndex:u[i]},e);this.XLScroll._getColWidths(e,u.sort()[0])}if(!t.isNullOrUndefined(c)&&c.length)for(i=0,r=d.cFormatRule.length;i<r;i++)a=d.cFormatRule[i],this.XLCFormat._cFormat(a.action,a.inputs[0],a.inputs[1],a.color,a.bgColor,a.range,e);if(g.length&&!this.model.scrollSettings.allowVirtualScrolling)for(i=0,r=g.length;i<r;i++)this._updateCellBorder(g[i],e)},_updateHiddenColumns:function(e,t){var i=e.colIndex,r=this.getSheet(t),l={isCHide:!0},n=this._getJSSheetHeader(t),s=n.find("th"),o=n.find("col"),a=this._getContent(t).find("col");r.hideColsCollection[i]=r.columnWidth,r.columnsWidthCollection[i]=0,0===i&&(l.hCol=!0),this._writeRule(i,t),this.addClass(s[i],"e-hide"),this.addClass(o[i],"e-hide"),this.addClass(a[i],"e-hide"),n.find("th:eq("+(i-1)+")").hasClass("e-hide")||this.addClass(n.find("th:eq("+(i-1)+")")[0],"e-hcol"),this.XLEdit._updateDataContainer({rowIndex:0,colIndex:i},{dataObj:l,sheetIdx:t,skipCell:!0}),i>0&&this.isUndefined(this.XLEdit.getPropertyValue(0,i-1,"isCHide"))&&this.XLEdit._updateDataContainer({rowIndex:0,colIndex:i-1},{dataObj:{hCol:!0},sheetIdx:t,skipCell:!0})},_renderContent:function(e){var i=[],r=t.buildTag("div.e-spreadsheetheader"),l=t.buildTag("div.e-headercontent"),n=t.buildTag("div.e-spreadsheetcolumnheader e-icon e-ss-selectall  e-ss-cursor","",{},{}),s=t.buildTag("div.e-spreadsheetcontentcontainer","",{"-webkit-tap-highlight-color":"rgba(0,0,0,0)"}),o=t.buildTag("div#"+this._id+"_content.e-content e-ss-cursor"),a=t.buildTag("div.e-spreadsheetrowheader","",{float:"left",width:"30px"},{}),d=t.buildTag("div.e-rowheadercontent");return this._isAutoWHMode&&(o.addClass("e-rmvbtmbdr"),l.addClass("e-rmvrghtbdr"),d.addClass("e-rmvbtmbdr")),this._setJSSheetHeader(r,e),r.append(n),r.append(l),i.push(r),r=t.buildTag("div.e-spreadsheetcontent"),this._setJSSheetContent(r,e),this._setContent(s,e),this._setJSSheetRowHeader(a,e),this._setJSSheetRowHeaderContent(d,e),a.append(d),s.append(o),r.append(a),r.append(s),i.push(r),i},refreshContent:function(e){this._refreshContent(e)},_refreshContent:function(e,t){e=e||this.getActiveSheetIndex();var i,r,l,n,s=this.model.scrollSettings.allowVirtualScrolling,o=this._getJSSheetContent(e).find(".e-spreadsheetcontentcontainer > .e-content");this._initDataRange(e),this._refreshRowColCnt(e),l=this._renderHeaderColumns(e),this._getJSSheetHeader(e).find(".e-headercontent").html(l),this._refreshTemplates(e),n=this._renderHdrRows(e),this._getJSSheetRowHeaderContent(e).html(n),o.find(".e-table")[0]&&o.find(".e-table").eq(0).remove(),o.prepend(this._renderContTable(e)),this._initViewPortCont(e),this._isAutoWHMode?this._isInitLoad||this._autoSSWidthHeight(e):t||this.XLScroll._refreshScroller(e,"refresh","all"),s||t||(this.XLScroll._getFirstRow(e),this.XLScroll._getFirstColumn(e)),i=this._getContTBody(e).find("tr"),r=this._getRowHdrTBody(e).find("tr"),this.setRows([r,i],e)},_autoSSWidthHeight:function(t,i){var r={},l=e("#"+this._id+"_Ribbon").data("ejRibbon");t=t||this._getSheetIndex(),this._responsiveWidth=this._dlgWidth=r.width=this.getSheet(t).showHeadings?this._getContTBody(t).width()+this._getJSSheetRowHeader(t).width():this._getContTBody(t).width(),this.model.showRibbon&&r.width<=480?(r.width=480,this._getContent(t).find(".e-content").removeClass("e-rmvrghtbdr")):i||this._getContent(t).find(".e-content").addClass("e-rmvrghtbdr"),i||this._setSheetWidthHeight(t,r,null,"refresh"),this.model.showRibbon&&(r.width<=480&&this._alignFormulaBar(r.width),this.XLRibbon._refreshBackstageHeight(),l.setModel({width:r.width})),this._responsiveHeight=this._dlgHeight=r.height=this.element.height()},_initDataRange:function(e){var t,i,r,l,n,s,o,a=0,d=this.getSheet(e),h=this.getDataSettings(e);if(h)for(t=h.length;a<t;)(r=h[a])._jsonData&&(r.batchChanges=d.batchChanges,r.fields=this.getObjectKeys(r._jsonData[0]),(i=r.startCell?this._toIntrnlRange(r.startCell,e):[0,0,0,0])[2]=i[0]+(!r.fieldAsColumnHeader&&r.showHeader?r.count:r.count-1),i[3]=i[1]+this.getObjectLength(r._jsonData[0])-1,r.range=i,s=i[2],o=i[3],(this._isAutoWHMode||d.usedRange.rowIndex<s)&&(d.usedRange.rowIndex=s),(this._isAutoWHMode||d.usedRange.colIndex<o)&&(d.usedRange.colIndex=o),l=s+1,n=o+1,this._isPublic||((this._isAutoWHMode||d.rowCount<l)&&(d.rowCount=l),(this._isAutoWHMode||d.colCount<=n)&&(d.colCount=n),this.model.isGridMode&&(d.usedRange.rowIndex<l&&(d.rowCount=l),d.usedRange.colIndex<n&&(d.colCount=n))),d._hasDataSrc=!0),a++},_renderStyleTag:function(e){var t,i;return t=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0],(i=document.createElement("style")).type="text/css","custom"==e?(i.setAttribute("id",this._id+"_sscustomformat"),t.appendChild(i)):"showhide"!==e||document.getElementById(this._id+"_sshide")||(i.setAttribute("id",this._id+"_sshide"),t.appendChild(i)),i},_renderHeaderColumns:function(i){for(var r,l,n,s,o,a=document.createElement("thead"),d=this.getSheet(i),h=this.getObjectKeys(this._copyColumns),c=h.length,u=this._copyColumns,g=0;g<c;g++)o=this._generateColCount(h[g])-1,d.columns[o]?d.columns[o].text=u[h[g]].text:d.colCount>o&&u[h[g]].field&&(d.columns[o]=u[h[g]]);return s=this._renderHeaderCol(i,0,d.colCount),l=t.buildTag("table.e-table")[0],this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?e(l).width(this._getEntireColWidth(i)):this.addClass(l,"e-ss-hdrspacing"),n=s[1],r=s[0],a.appendChild(r),l.appendChild(n),l.appendChild(a),l},_renderHeaderCol:function(e,i,r){var l,n,s,o,a,d,h,c,u=0,g=[],p=i,m=this.getSheet(e),_=document.createElement("tr"),f=document.createElement("colgroup");for(_.className="e-columnheader",this.isImport||this.model.isImport||(m._colWidthCollection.length=0,m._ofColWidthColl.length=0),this.model.scrollSettings.allowScrolling||"infinite"!=this.model.scrollSettings.scrollMode||(m.columnsWidthCollection=[]),m._colWidthCollection.push(u),m._ofColWidthColl.push(u);p<r;)l="e-headercell",a="col",c=m.columnsWidthCollection[p],this.isUndefined(c)&&(c=m.columnsWidthCollection[p]=m.columnWidth),p!=r-1&&(u=m._colWidthCollection[m._colWidthCollection.length-1]+c,m._colWidthCollection.push(u),m._ofColWidthColl.push(u)),this.model.allowSelection&&this._inColumn(m.selectedRange,p)&&(l+=" e-colhighlight",m._isColSelected&&(l+=" e-colselected")),c<1?(a+=".e-hide",l+=" e-hide"):m._hiddenFreezeCols.indexOf(p)>-1&&(a+=".e-fcol-hide",l+=" e-fcol-hide"),(this.isImport||this.model.isImport||m._isLoaded)&&this.XLEdit.getPropertyValue(0,p,"hCol")&&(l+=" e-hcol"),(n=document.createElement("th")).className=l,d=h=this._generateHeaderText(p+1),m.fieldAsColumnHeader&&m.columns[p]&&(d=m.columns[p].text),(s=document.createElement("div")).className="e-headercelldiv",s.innerHTML=d,n.appendChild(s),o=t.buildTag(a,"",{width:c},{}),_.appendChild(n),f.appendChild(o[0]),this._sheetCopy.isSheetCopy||m.columns[p]||(m.columns[p]={field:h,text:h,type:null}),p++;return g.push(_),g.push(f),g},_getWidth:function(e,t,i){for(var r=0,l=this.getSheet(i);e<=t;e++)r+=l.columnsWidthCollection[e];return r},_getEntireColWidth:function(e){var t=this.getSheet(e);return this._getIdxWithOffset(null,this._getLastColIdx(t)).xOffset+t.columnsWidthCollection[t.columnsWidthCollection.length-1]},_getLastColIdx:function(e){for(var t=e.colCount-1;t>-1&&(t in e.hideColsCollection||-1!==e._hiddenFreezeCols.indexOf(t));)t--;return t},_getIdxWithOffset:function(e,i,r,l,n){l=l||[];var s,o,a,d,h,c,u,g={},p=t.Spreadsheet.HideTypes,m=this.getSheet(n);if(d=h=c=u=0,!t.isNullOrUndefined(e)){if(r)for(a=m.rowsHeightCollection.length;d<a;){if(s=o=!1,-1===l.indexOf(p.Default)&&m.hideRowsCollection.indexOf(d)>-1&&(s=!0),-1===l.indexOf(p.Freeze)&&m._hiddenFreezeRows.indexOf(d)>-1&&(o=!0),!s&&!o){if((c+=m.rowsHeightCollection[d])>e){h=d;break}u=c}d++}else{for(;d<e;)s=o=!1,-1===l.indexOf(p.Default)&&m.hideRowsCollection.indexOf(d)>-1&&(s=!0),-1===l.indexOf(p.Freeze)&&m._hiddenFreezeRows.indexOf(d)>-1&&(o=!0),s||o||(u+=m.rowsHeightCollection[d]),d++;h=e}g.rowIdx=h,g.yOffset=u}if(!t.isNullOrUndefined(i)){if(r)for(d=h=c=u=0,a=m.columnsWidthCollection.length;d<a;){if(s=o=!1,-1===l.indexOf(p.Default)&&d in m.hideColsCollection&&(s=!0),-1===l.indexOf(p.Freeze)&&m._hiddenFreezeCols.indexOf(d)>-1&&(o=!0),!s&&!o){if((c+=m.columnsWidthCollection[d])>i){h=d;break}u=c}d++}else{for(;d<i;)s=o=!1,-1===l.indexOf(p.Default)&&d in m.hideColsCollection&&(s=!0),-1===l.indexOf(p.Freeze)&&m._hiddenFreezeCols.indexOf(d)>-1&&(o=!0),s||o||(u+=m.columnsWidthCollection[d]),d++;h=i}g.colIdx=h,g.xOffset=u}return g},_getEntireRowHeight:function(e){var t=this.getSheet(e);return t._rowHeightCollection[t._rowHeightCollection.length-1]+t.rowsHeightCollection[t.rowsHeightCollection.length-1]},_renderHdrRows:function(e){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=this.getSheet(e),S=this.model.scrollSettings.allowVirtualScrolling;if(p=t.buildTag("table.e-table","<colgroup><col style='width: 30px;'></colgroup>",{}),this.addClass(p[0],"e-ss-rowhdrspacing"),!this._sheetCopy.isSheetCopy){for(d=_=0,b=C.rows,i=0,o=C.rowCount,C._rowHeightCollection=[],C._rowIdxColl=[],C._rowHeightCollection.push(d);i<o;)(m=C.rowsHeightCollection[i])||(m=C.rowsHeightCollection[i]=C.rowHeight),!S||-1===C.hideRowsCollection.indexOf(i)&&-1===C._hiddenFreezeRows.indexOf(i)?C._rowIdxColl.push(i):m=0,i!=o-1&&C._rowHeightCollection.push(C._rowHeightCollection[C._rowHeightCollection.length-1]+m),i++;if(b){for(f=-1,s=b.length,g="mozilla"===this._browserDetails.name?2:1,r=0;r<s;r++){for(n=(h=b[r]).cells.length,this.isUndefined(h.index)||(_=h.index),d=h.height||C.rowHeight,C.rowHeight<d&&(C.rowsHeightCollection[_]=d,-1===f&&(f=_)),l=0;l<n;l++)(c=h.cells[l]).style&&c.style["font-size"]&&(u=document.getElementById(this._id+"_emptySpan"),a=this.XLFormat._createFormatClass(c.style),this.addClass(u,a),u.textContent=c.value,(d=u.offsetHeight+g)>C.rowsHeightCollection[_]&&(C.rowsHeightCollection[_]=d,-1===f&&(f=_)),this._refreshGlobalSpan(u)),this.isUndefined(c.value)||(C._hasDataSrc=!0);_++}-1!==f&&this.XLScroll._getRowHeights(e,f,!0)}}return S?p.append("<tbody class='e-ss-virtualtop'></tbody><tbody></tbody><tbody class='e-ss-virtualbottom'></tbody>"):p.append("<tbody>"+this._renderRowHdr(C._rowIdxColl,e)+"</tbody>"),this._setRowHdrTBody(p.find("tbody").eq(S?1:0),e),p},_renderRowHdr:function(i,r){for(var l,n,s=0,o=[],a=this.getSheet(r),d=i?i.length:a.rowCount;s<d;)l=i?i[s]:s,(t.isNullOrUndefined(this.XLEdit.getPropertyValue(l,0,"isFilterHide",r))||t.isNullOrUndefined(this.XLEdit.getPropertyValue(l,0,"isRHide",r)))&&((n={height:a.rowsHeightCollection[l]<this.model.rowHeight?this.model.rowHeight:a.rowsHeightCollection[l],rowidx:l}).className=this.XLEdit.getPropertyValue(l,0,"hRow",r)?"e-rowheader e-hrow ":"e-rowheader",this.XLEdit.getPropertyValue(l,0,"isFilterHighlight",r)&&(n.className+=" e-filterhiglight"),n.wrap=this.XLEdit.getPropertyValue(l,0,"wrapRow",r)?" e-sswraprow":"",this.model.allowSelection&&this._inRow(a.selectedRange,l)&&(n.className+=" e-rowhighlight",a._isRowSelected&&(n.className+=" e-rowselected")),o.push(n)),s++;return e.render[this._id+"JSONRowHdrTemplate"+r](o)},_refreshDataSrc:function(e,t){var i,r,l,n,s,o,a,d,h,c,u,g,p,m=0,_=this.getSheet(t),f=this.getDataSettings(t);if(g=p=!1,!_.rangeSettings.length&&_.dataSource&&(p=!0),f)for(d=f.length;m<d;){if((a=f[m]).range)if(c=a.range,g=p?!a.fieldAsColumnHeader&&a.showHeader:a.showHeader,a.headerStyles&&this.getObjectLength(a.headerStyles)&&this.model.allowCellFormatting&&(h=this.XLFormat._createFormatClass(a.headerStyles)),e)for(i=e[0],r=e[2],n=e[3];i<=r;){if(this._inRow(c,i))for(l=e[1];l<=n;)this._inColumn(c,l)&&(u=a.fields[l-a.range[1]],g&&i===c[0]?(o=a._jsonData[i-a.range[0]])&&this._refreshCell(i,l,t,a,o,u,!1,h):(o=a._jsonData[i-(a.range[0]+(g?1:0))])&&this._refreshCell(i,l,t,a,o,u,!0)),l++;i++}else{if(i=0,r=c[0],n=c[1],l=c[2],g){for(s in o=a._jsonData[i])this._refreshCell(r,n,t,a,o,s,!1,h),n++;r++}for(;r<=l;){for(s in o=a._jsonData[i],n=c[1],o)this._refreshCell(r,n,t,a,o,s,!0),n++;i++,r++}}m++}},_refreshCell:function(e,t,i,r,l,n,s,o){var a,d=this._iterateComplxObj(l[n],n),h=this.getSheet(i),c=this._dataContainer;(a=this.XLEdit._parseValue(s?d.value:d.prop,{rowIndex:e,colIndex:t})).sheetIdx=i,r.rangeName&&(a.rangeName=r.rangeName),s?r.primaryKey===n&&(a.isReadOnly=!0):(o&&(a.format=o,a.formats=r.headerStyles),!h.rangeSettings.length&&h.dataSource&&(a.isReadOnly=!0)),h.showHeader&&e&&this.isFormula(l[n])&&(this.XLEdit._refreshCalcEngine(e,t,!0,l[n],i),a.value2=c.sharedData[c.sheets[i][e][t].value2]),h.showHeader&&e&&l[n]&&"'"==l[n][0]&&(a.value2=a.value2.substr(1)),this.XLEdit._updateDataContainer({rowIndex:e,colIndex:t},{dataObj:a,sheetIdx:i,skipCell:!0})},_iterateComplxObj:function(e,t,i){var r,l,n,s=i||t,o={prop:s,value:e};if(this._isObject(e))for(r in n=".",e){if(l=e[r],this.isUndefined(l))return o;if(!e.hasOwnProperty(r)||!this._isObject(l)||this._isDateTime(l))return o.prop+=n+r,o.value=l,o;s+=n+r,o=this._iterateComplxObj(l,r,s)}return o},_refreshCellData:function(t,i){var r,l,n,s,o,a,d,h,c,u,g,p,m=0,_=this.getSheet(i),f=_.rows,b=_.hideColumns,C=_.border;if(f){for(r=0,g=f.length;r<g;r++){if(a=0,n=f[r],o=f[r].cells,n.index&&(m=n.index),(!t||this._inRow(t,m))&&o)for(l=0,p=o.length;l<p;l++)(s=o[l]).index&&(a=s.index),(!t||this._inColumn(t,a))&&((d=this.isUndefined(s.value)?{}:s.format&&"text"==s.format.type?{type:"text",value:s.value,value2:s.value}:this.XLEdit._parseValue(s.value,{rowIndex:m,colIndex:a})).value=this.isUndefined(d.value)?this.isUndefined(this.XLEdit.getPropertyValue(m,a))?"":this.XLEdit.getPropertyValue(m,a):d.value,(c=this.isFormula(d.value))&&this.XLEdit._refreshCalcEngine(m,a,!0,d.value,i),s.format&&(u=this.XLFormat._getFormatObj(s.format),d.type=s.format.type,d.formatStr=u.format.formatStr,d.decimalPlaces=u.format.decimalPlaces,d.thousandSeparator=!!u.format.thousandSeparator),d.value2=this.XLFormat._format(c?this.XLEdit.getPropertyValue(m,a,"value2"):d.value,{formatStr:d.formatStr,type:d.type,thousandSeparator:d.thousandSeparator,decimalPlaces:d.decimalPlaces,cellObj:d}),s.hyperlink&&(d.hyperlink=s.hyperlink.webAddr?-1===s.hyperlink.webAddr.indexOf("http")?{webAddr:"http://"+s.hyperlink.webAddr}:{webAddr:s.hyperlink.webAddr}:{cellAddr:s.hyperlink.cellAddr+"_"+s.hyperlink.sheetIndex||i},d.formats={color:this._hlColor}),s.comment&&(h=(this.model.userName.length?this.model.userName:this._getLocStr("UserName"))+":\n",d.comment={value:h+(s.comment.value||""),isVisible:s.comment.isVisible||!1}),s.isLocked&&(d.isLocked=!0,this.protectSheet(!0)),s.style&&(s.style.fontWeight&&(s.style["font-weight"]=s.style.fontWeight,delete s.style.fontWeight),s.style.backgroundColor&&(s.style["background-color"]=s.style.backgroundColor,delete s.style.backgroundColor),d.formats=e.extend(d.formats,s.style)),d.formats&&(d.format=this.XLFormat._createFormatClass(d.formats)),this.XLEdit._updateDataContainer({rowIndex:m,colIndex:a},{dataObj:d,sheetIdx:i,skipCell:!0}),this.XLEdit._refreshCellAlignment({cellIdx:{rowIndex:m,colIndex:a},value:d.value,type:d.type}),c||this.XLEdit._refreshCalcEngine(m,a,!1,null,i)),a++;m++}this.model.scrollSettings.allowVirtualScrolling&&(_._virtualTBodyHgt=_._rowHeightCollection[_._rowHeightCollection.length-1]+_.rowsHeightCollection[_.rowsHeightCollection.length-1])}if(b.length&&this.model.scrollSettings.allowVirtualScrolling){for(r=0,g=b.length;r<g;r++)_.hideColsCollection[b[r]]||this._updateHiddenColumns({rowIndex:0,colIndex:b[r]},i);this.XLScroll._getColWidths(i,b.sort()[0])}if(C.length&&this.model.scrollSettings.allowVirtualScrolling)for(r=0,g=C.length;r<g;r++)this._updateCellBorder(C[r],i)},_updateCellBorder:function(e,t){var i,r,l,n,s=this.getRangeIndices(e.range);if(l={top:{top:"1px solid"},right:{right:"1px solid"},bottom:{bottom:"1px solid"},left:{left:"1px solid"},outside:{top:"1px solid",right:"1px solid",bottom:"1px solid",left:"1px solid"},allborder:{top:"1px solid",right:"1px solid",bottom:"1px solid",left:"1px solid"},thickbox:{top:"2px solid",right:"2px solid",bottom:"2px solid",left:"2px solid"},thickbottom:{bottom:"2px solid"},topandbottom:{top:"1px solid",bottom:"1px solid"},topandthickbottom:{top:"1px solid",bottom:"2px solid"}}[e.type],(n=this.getObjectKeys(l)).length)for(i=0,r=n.length;i<r;i++)l[n[i]]=l[n[i]].concat(" "+e.color);l.skipCell=!0,l.sheetIdx=t,"allborder"===e.type?this.XLFormat._applyAllBorderCss(l,s):this.XLFormat._applyBorderCss(l,s)},_renderContTable:function(i){var r;return this._sheetCopy.isSheetCopy?r=e(this._sheetCopy.sheetContent):(r=t.buildTag("table.e-table",this._sheets[i]._contentColGroup.outerHTML),this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?e(r).width(this._getEntireColWidth(i)):this.addClass(r,"e-ss-rowhdrspacing"),this.model.scrollSettings.allowVirtualScrolling?r.append("<tbody class='e-ss-virtualtop'></tbody><tbody></tbody><tbody class='e-ss-virtualbottom'></tbody>"):r.append("<tbody></tbody>")),this._setContTBody(r.find("tbody").eq(this.model.scrollSettings.allowVirtualScrolling?1:0),i),r},_initViewPortCont:function(e){var t,i=this.getSheet(e);this.model.scrollSettings.allowVirtualScrolling?this._refreshViewport(this._initLoad?0:this._isFrozen(this.getFrozenRows())?i._contScrollTop:i._scrollTop,e):(t=this.getRangeData({property:["value","value2","comment","hyperlink","format","border","type","isFilterHide","isRHide","isFHide","isFilterHeader","isFilterVisible","filterState","isMHide","merge","hRow","isLocked","wrap","isOverflow","align","picture","cFormatRule","isOfBrdr","formatStr"],sheetIdx:e,rowIdxs:i._rowIdxColl,withRowIdx:!0}),this._getContTBody(e).html(this._renderData(t,e)),this.model.allowComments&&this.XLComment._updateCmntArrowPos(null,e),this.model.allowCellType&&this.XLCellType._rangeCellTypes(i.cellTypes,e),this.model.allowSparkline&&this.XLSparkline._refreshContentWithSparkline(e)),i._isVPRendered=!0},_processCellTypes:function(e,t){for(var i=[],r=0,l=e.length;r<l;r++)"DatePicker"===e[r].cellType.type?i.push({range:this._getAlphaRange(t,e[r].rowIndex,e[r].colIndex,e[r].rowIndex,e[r].colIndex),settings:{type:e[r].cellType.type,value:e[r].value}}):i.push({range:this._getAlphaRange(t,e[r].rowIndex,e[r].colIndex,e[r].rowIndex,e[r].colIndex),settings:{type:e[r].cellType.type,isChecked:e[r].cellType.isChecked}});this.XLCellType._rangeCellTypes(i,t),this._celltypes=[]},_initDependencies:function(){var t=this.model;this._renderAlertdlg(),this._renderAlertDlgContent(e("#"+this._id+"_alertdlg"),"Alert",""),this._initEditForm(),t.allowClipboard&&this.XLClipboard._initCopyPaste(),t.allowEditing&&(this.XLEdit._processEditing(),this.getMainPanel().append(this.XLEdit._editElem),this.XLEdit._editElem.hide()),this._renderDDownList(),this.clearUndoRedo(),t.showRibbon&&this.XLRibbon._disableButtons(["clearfilter"],"ejButton"),t.allowDataValidation&&this.XLValidate._addDVMethod(),t.enableContextMenu&&this.XLCMenu._initCMenuFooter(),t.allowFiltering&&this.XLFilter._renderExcelFilter(),t.allowFreezing&&this.XLFreeze._initFreeze()},_initComplete:function(){this._reqCnt===this._resCnt&&(this._isRefresh||this._trigger("loadComplete",{}),this.isDirty=!1,this.clearUndoRedo(),this.hideWaitingPopUp(),this.XLRibbon.updateRibbonIcons())},_showDialog:function(t,i){var r,l,n="e-dialog",s=this.model;switch(t){case this._id+"_Ribbon_Home_Styles_ConditionalFormatting":!(l=e("#"+this._id+"_CFDialog")).length&&s.allowConditionalFormats&&(l=this.XLRibbon._initCFDialog()),l.ejDialog("open");break;case this._id+"_chartname":(l=e("#"+this._id+"_chartnamedlg")).length||this.XLRibbon._renderChartNameDlg();break;case this._id+"_Ribbon_ChartDesign_Type_ChangeChartType":(l=e("#"+this._id+"_charttypedlg")).length||(l=this.XLRibbon._renderChartTypeDialog());break;case this._id+"_ImportPasswordDialog":(l=e("#"+this._id+"_ImportPasswordDialog")).length||(l=this._importPasswordDlg()),l.ejDialog("open");break;case this._id+"_Ribbon_Insert_Links_Hyperlink":this.model.isReadOnly||(s.allowHyperlink&&!this._hasClass(document.getElementById(this._id+"_HLDialog"),n)&&this.XLRibbon._initHLDialog(),this._hlDlgOpen());break;case this._id+"_Ribbon_SparklineDesign_Sparkline_EditData":this.XLSparkline._initSparklineDialog(),this.XLSparkline._renderSparklineDialog(),this.XLSparkline._renderSparklineDesignDlg();break;case this._id+"_Ribbon_Others_Cells_InsertCellOptions":s.allowInsert&&(this._hasClass(document.getElementById(this._id+"_insertdeletedlg"),n)||this._renderInsertDeleteDialog(),this._refreshInsDelDialog("Insert"));break;case this._id+"_Ribbon_Insert_Sparkline_Column":case this._id+"_Ribbon_Insert_Sparkline_Line":case this._id+"_Ribbon_Insert_Sparkline_Pie":case this._id+"_Ribbon_Insert_Sparkline_Area":case this._id+"_Ribbon_Insert_Sparkline_Winloss":s.allowSparkline&&!this._hasClass(document.getElementById(this._id+"_SparklineDialog"),n)&&(this.XLSparkline._initSparklineDialog(),this.XLSparkline._renderSparklineDialog());break;case this._id+"_Ribbon_Others_Cells_DeleteCellOptions":s.allowDelete&&(this._hasClass(document.getElementById(this._id+"_insertdeletedlg"),n)||this._renderInsertDeleteDialog("delete"),this._refreshInsDelDialog("Delete"));break;case this._id+"_FormatCells":s.allowCellFormatting&&!this._hasClass(document.getElementById(this._id+"_formatdlg"),n)&&this.XLCellFrmtDlg._renderCellFrmtDlg(),this.XLCellFrmtDlg._initFormatCellDlg();break;case this._id+"_MoveorCopy":this._hasClass(document.getElementById(this._id+"_moveCopyDlg",n))||this._initMoveCopyDlg(),this._renderMoveCopyDlg();break;case this._id+"_UnhideSheet":this._hasClass(document.getElementById(this._id+"_UnhideDlg",n))||this._initUnhideDlg(),this._renderUnhideDlg();break;case this._id+"_Ribbon_Data_DataTools_DataValidation":case this._id+"_Ribbon_Data_DataTools_DataValidationOptions":this.model.allowDataValidation&&!this._hasClass(document.getElementById(this._id+"_ValDialog"),n)&&(r=this.XLRibbon._initValDialog(),this.XLRibbon._renderValDialog(r));break;case this._id+"_Filter":document.getElementById(this._id+i+"_excelDlg")||document.getElementById(this._id+"_filter_custom_"+i)||this.XLFilter._renderFilterDialogs(i);break;case this._id+"_Ribbon_Review_Changes_ProtectWorkbook":this._hasClass(document.getElementById(this._id+"_PasswordDialog"),n)||this._passwordDlg();break;case this._id+"_Ribbon_Insert_Tables_Table":s.allowFormatAsTable&&!this._hasClass(document.getElementById(this._id+"_fatnamedlg"),n)&&this.XLRibbon._renderFATNameDlg();break;case this._id+"_Ribbon_Insert_Tables_PivotTable":s.enablePivotTable&&!this._hasClass(document.getElementById(this._id+"_PvtDialog"),n)&&(this.XLRibbon._initPvtDialog(),this.XLRibbon._renderPvtDialog());break;case this._id+"_Ribbon_Others_Editing_FindSelect":s.allowSearching&&!this._hasClass(document.getElementById(this._id+"_FRDialog"),n)&&(this.XLRibbon._initFRDialog(),this.XLRibbon._renderFRDialog(),this.model.isReadOnly||(r=this.XLRibbon._initGoToDialog(),this.XLRibbon._renderGoToDialog(r))),this.model.isReadOnly?e("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option",{disabledItemIndex:[1,2]}):e("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option",{enabledItemIndex:[1,2]});break;case this._id+"_Ribbon_ChartDesign_Data_SelectData":s.allowCharts&&!this._hasClass(document.getElementById(this._id+"_chartrangedlg",n))&&this.XLChart._renderChartRangeDialog();break;case this._id+"_Ribbon_Others_NameManager":document.getElementById(this._id+"_nmdlg")?e("#"+this._id+"_nmgrid").ejGrid("option",{dataSource:this.model.nameManager}):this.XLRibbon._renderNameManagerDlg();break;case this._id+"_Ribbon_Design_Tools_ResizeTable":document.getElementById(this._id+"_fatresizetabledlg")||this.XLRibbon._renderFATResizeTableDlg();break;case"exportxl":case"exportcsv":case"exportpdf":document.getElementById(this._id+"_ExportFileNameDialog")||this.XLExport._exportFileNameDlg();break;case this._id+"_CustomCellDialog":document.getElementById(this._id+"_CustomCellDialog")?this.XLFormat._styleDlgOpen():(this.XLFormat._customStyleDlg(),this.XLFormat._styleDlgOpen())}},_generateHeaderText:function(e){return e/26>1?this._generateHeaderText(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt("Z"):64+e%26):String.fromCharCode(64+e)},_generateColCount:function(e){var t,i=0;for(t=(e=e.split("").reverse().join("")).length-1;t>=0;t--)i+=(e[t].charCodeAt(e[t])-64)*Math.pow(26,t);return i},_getSheetIndex:function(e){return e||this.getActiveSheetIndex()},_getSheetIdxFromSheetValue:function(e){for(var t=1,i=this.model.sheets,r=i.length-1;t<=r;){if(i[t].sheetInfo.value.toLowerCase()===e.toLowerCase())return t;t++}return-1},getAlphaRange:function(e,t,i,r){return this.isUndefined(i)&&this.isUndefined(r)&&(i=e,r=t),this._getAlphaRange(null,e,t,i,r)},_getAlphaRange:function(e,t,i,r,l){return i+=1,l+=1,(t+=1)===(r+=1)&&i===l?this._generateHeaderText(i)+t:this._generateHeaderText(i)+t+":"+this._generateHeaderText(l)+r},_getProperAlphaRange:function(e,t,i,r,l){var n=this._getAlphaRange(e,t,i,r,l);return-1===n.indexOf(":")?n+":"+n:n},_getDollarAlphaRange:function(e,t){var i=this.getActiveSheetIndex(),r=this.getSheet(i).sheetInfo.text,l=r.match(/\s/g)?"'"+r+"'":r;return t&&!this.isRange(e)?l+"!$"+this._generateHeaderText(e[1]+1)+"$"+(e[0]+1):l+"!$"+this._generateHeaderText(e[1]+1)+"$"+(e[0]+1)+":$"+this._generateHeaderText(e[3]+1)+"$"+(e[2]+1)},_toIntrnlRange:function(e,t){return e?this._isString(e)&&(e=this.getRangeIndices(e)):e=this.getSheet(t).selectedRange,e},_getMaxRowColCnt:function(e,t,i){var r,l,n,s=0,o=0,a=i||1,d=i?i+1:e.length;for(e=e||this.model.sheets;a<d;)n=e[a],t&&n.usedRange?(r=n.usedRange.rowIndex,l=n.usedRange.colIndex):(r=n.rowCount,l=n.colCount),s<r&&(s=r),o<l&&(o=l),a++;return{rowCount:s,colCount:o}},_generateEJMenu:function(e,i,r){return{menuType:"normal"===e?t.MenuType.NormalMenu:t.MenuType.ContextMenu,orientation:"vertical"===i?t.Orientation.Vertical:t.orientation.Horizontal,cssClass:r}},_generateEJDD:function(t,i,r,l,n,s){return{dataSource:t,fields:i,selectedItemIndex:r,width:l,cssClass:"e-"+this._id+"-ddl",change:e.proxy(this.XLRibbon._frTypeChange,this,s)}},_heightWidthCalculation:function(t,i){var r,l=this.getActivationPanel(),n=l.is(":visible");this._isDisplayHeader?(r=e("#"+this._id+"_Ribbon").height(),this._isDisplayHeader=!1):r=this.XLRibbon._ribbonState?this.element.find(".e-ribbon").height()-1:this.element.find(".e-ribbon .e-header").height(),this._refreshSheetWithScreen(t),this._updateResponsiveSettings(),this.model.isGridMode&&!this.model.scrollSettings.allowScrolling&&(this._responsiveHeight=this._minHeight),this._initViewPort(t),this._setSheetWidthHeight(t,{width:this._responsiveWidth,height:this._responsiveHeight},r,"refresh",i.action),n&&l.height(this.getMainPanel().height()-1),this.refreshContent(t)},_refreshSheetWithScreen:function(t){e("#"+this._id+"GroupPanel")[0].style.height="0px",e("#"+this._id+"MainPanel")[0].style.height="0px",this.model.allowFormulaBar&&(this.element.find(".e-formulabar")[0].style.width="0px"),this.getSheetElement(t).find(".e-spreadsheetcontentcontainer")[0].style.height="0px",this.getSheetElement(t).find(".e-spreadsheetrowheader")[0].style.height="0px"},_refreshWidthHeight:function(i,r,l,n){var s,o,a,d,h,c,u,g,p=1,m=0,_=this._getContent(i),f=this.model.pageSettings.pagerHeight+1,b=this.getSheet(i),C=this._getJSSheetRowHeader(i),S=-1,x=e("#"+this._id+"_Ribbon").ejRibbon("instance");return d=this.model.showRibbon?x.model.selectedItemIndex<1?1:x.model.selectedItemIndex:0,this.XLRibbon._ribbonState&&(S=e("#"+this._id+"_Ribbon").find(".e-content:eq("+d+")").height()),h=this._phoneMode?e("#"+this._id+"_Ribbon").height():e("#"+this._id+"_Ribbon").find(".e-header").height()+S+2,a=this.model.allowFormulaBar&&this.element.find("#"+this._id+"_formulabar").is(":visible")?this._formulaHeight:0,l=h&&this.model.showRibbon&&e("#"+this._id+"_Ribbon").is(":visible")?h:0,b.showHeadings&&(p=22,m=C.width()),this._isAutoWHMode&&b.showHeadings||(o=r.height-(l+a+1),this.getGroupPanel().height(o-1),this.getMainPanel().height(o-1),this.model.showPager&&("initial"===n||this.element.find(".e-spreadsheetfooter").is(":visible"))||(f=1),c="chrome"===this._browserDetails.name?1:2,r.height=r.height-(p+f+a+l+c),this.element.find(".e-spreadsheet-list")[0].style.height=""),this.model._isActPanelVisible?r.width=r.width-(this.model.activationPanelWidth+2):t.isNullOrUndefined(r.isActPanel)||r.isActPanel||(r.width=r.width+this.model.activationPanelWidth+2),u=this.model.scrollSettings,this.getMainPanel().width(!this.model._isActPanelVisible&&u.isResponsive?"100%":r.width),_.find("#hscrollBar").length>0&&(_.find("#hscrollBar").remove(),C.removeClass("e-scrollrowcss"),this._getJSSheetRowHeaderContent(i).height(r.height),this._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").height(r.height-1)),_.find("#vscrollBar").length>0&&(g=b._scrollTop,_.find("#vscrollBar").data("ejScrollBar").scroll(0),b._scrollTop=g,_.find("#vscrollBar").remove(),this._getJSSheetHeader(i).removeClass("e-scrollcss"),this._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").width(u.isResponsive?r.width-2:r.width)),this._isAutoWHMode&&b.showHeadings||(_.height(r.height),C.height(r.height)),this._getJSSheetContent(i).width(u.isResponsive?"100%":r.width),(s=this.getFooter())&&s.width(u.isResponsive?"100%":r.width),this._alignFormulaBar(this._responsiveWidth),this._initViewPort(i),this.model.allowFreezing&&this.XLFreeze._refreshFreeze(),r.width=r.width-m,r.height=r.height-0,r},_setSheetWidthHeight:function(t,i,r,l,n){var s,o,a,d,h,c,u=this.getSheet(t),g=this._getContent(t),p=this._getJSSheetRowHeader(t),m=this.model.scrollSettings.isResponsive,_=u.showHeadings?p.width():0;m?("initial"!=n&&"resize"!=l&&(this._refreshSheetWithScreen(t),this._updateResponsiveSettings(),i={width:this._responsiveWidth,height:this._responsiveHeight}),this._resizeColl[t-1]=this._isResized,"resize"!==l||this.model.allowResizing&&(!this.model.allowResizing||this.XLResize._resizeStart)||"toggleBtn"==n||(this.model.activationPanelWidth=Math.floor(i.width/3)),c=this._refreshWidthHeight(t,e.extend(!0,{},i),r,n,l),this._updateResponsiveSettings(),"resize"!==l||this.model.allowResizing&&(!this.model.allowResizing||this.XLResize._resizeStart)||"toggleBtn"==n||(this.model.activationPanelWidth=Math.floor(i.width/3)),i=c):(this._isAutoWHMode||(i.width=i.width-2),i=this._refreshWidthHeight(t,e.extend(!0,{},i),r,n,l)),this.getMainPanel().width(!this.model._isActPanelVisible&&m?"100%":i.width+_),this.model.scrollSettings.allowScrolling&&(this.model._isActPanelVisible&&(i.width+=2),this._renderScroller(t,e.extend(!0,{},i),n),o=g.find("#vscrollBar"),s=g.find("#hscrollBar"),o.length>0&&this._getJSSheetHeader(t).addClass("e-scrollcss"),s.length>0&&(h=g.height(),p.height(h-18),this._getJSSheetRowHeaderContent(t).height(h-("none"===s[0].style.display?0:18)),p.addClass("e-scrollrowcss")),"initial"!=n&&(d=o.data("ejScrollBar"),a=s.data("ejScrollBar"),d.scroll(u._scrollTop),a.scroll(u._scrollLeft))),u.showHeadings||g.find(".e-content")[this.model.allowFormulaBar?"addClass":"removeClass"]("e-viewbrdr"),this._isAutoWHMode||(this._dlgWidth=this._phoneMode||this._tabMode||this._responsiveWidth<350?this._responsiveWidth-2:this._responsiveWidth/2,this._dlgHeight=this._phoneMode||this._tabMode||this._responsiveHeight<350?this._responsiveHeight-2:this._responsiveHeight/1.5)},setWidthToColumns:function(e,i){var r,l,n,s,o,a,d,h,c,u=i||this.getActiveSheetIndex(),g=this.getSheet(u),p=0,m=!1;if(!this.isUndefined(g)&&!this.model.isGridMode){for("object"==typeof e[0]&&(m=!0),g._isLoaded&&(l=this._getContent(u).find("col"),n=this._getJSSheetHeader(u).find("col")),d=0,h=e.length;d<h;d++)if(s=m?e[d].width:e[d],o=m?e[d].colIndex:d,a=this.XLEdit._getPropWithCellIdx([0,o,g.rowCount-1,o],"isOfBrdr",u),0===s&&(s=64),s<g.columnsWidthCollection[o]&&this.XLEdit.getPropertyValue(0,o,"wrapCol"))p+=s;else for(g._isLoaded&&(t.isNullOrUndefined(n[o])||(n[o].style.width=s+"px",l[o].style.width=s+"px")),p+=s,this.XLShape&&this.XLShape._refreshShapePosOnResize(o,s,!0,u),this.XLEdit.getPropertyValue(0,o,"isCHide",u)?(g.hideColsCollection[o]=s,g.columnsWidthCollection[o]=0):g.columnsWidthCollection[o]=s,this.XLScroll._getColWidths(u,o),c=0;c<a.length;c++)r=a[c],this._textClip(r.rowIdx,r.colIdx,"delete","",!0),this._textClip(r.rowIdx,r.colIdx,"add","",!0);g.staticWidth=p,g._isLoaded&&this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(u,"refresh","horizontal"),g._isFreezed&&(this.XLFreeze._refreshFreezeRowDiv(),this.XLFreeze._refreshFreezeColDiv()),(!g._isImported||g._isLoaded)&&(this.model.allowSelection&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this._isAutoWHMode&&this._autoSSWidthHeight())}},setHeightToRows:function(e){this._setHeightToRows(e)},_setHeightToRows:function(e,t){var i,r,l,n,s,o=this.getActiveSheetIndex(),a=this.getSheet(o),d=!1,h=this.getRows(o),c=h[1],u=h[0];for("object"==typeof e[0]&&(d=!0),n=0,s=e.length;n<s;n++)r=d?e[n].height:e[n],l=d?e[n].rowIndex:n,0===r&&(r=22),r<a.rowsHeightCollection[l]&&this.XLEdit.getPropertyValue(l,0,"wrapRow")||(this._isRowViewable(o,l)&&-1!=l&&(c[i=this._getRowIdx(l,o)].style.height=r+"px",u[i].style.height=r+"px"),this.XLShape&&this.XLShape._refreshShapePosOnResize(l,r,!1,o),a.rowsHeightCollection[l]=r);t||(this.model.scrollSettings.allowScrolling&&(this.XLScroll._getRowHeights(o,1),this.XLScroll._getFirstRow(o)),this.model.allowSelection&&(!a._isImported||a._isLoaded)&&(this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()))},_refreshRowColCnt:function(e){var i,r,l,n,s,o,a,d=this.model.scrollSettings,h=d.scrollMode===t.Spreadsheet.scrollMode.Infinite,c=this.getSheet(e);s=o=a=0,c.rowCount>this._maxRowCnt&&(c.rowCount=this._maxRowCnt),i=this._getMaxHgt(e,this.isImport||this.model.isImport),h&&(i<(o=c._vPortHgt+this._bufferCnt*c.rowHeight)&&(l=o-i,s=Math.ceil(l/c.rowHeight),c.rowCount+=s,i+=s*c.rowHeight)),d.allowVirtualScrolling&&(n=c.rowCount-(c.hideRowsCollection.length+(this.isImport||this.model.isImport?c._hiddenFreezeRows.length:0)),d.allowScrolling&&h&&((l=n%c._virtualBlockRowCnt)&&(s=c._virtualBlockRowCnt-l,c.rowCount+=s,n+=s,i+=s*c.rowHeight)),c._virtualBlockCnt=Math.ceil(n/c._virtualBlockRowCnt),c._virtualTBodyHgt=i),c.colCount>this._maxColCnt?c.colCount=this._maxColCnt:d.allowScrolling&&h&&(a=c._vPortWth+this._bufferCnt*c.columnWidth,(r=this.isImport||this.model.isImport?this._getMaxWth(e):c.colCount*c.columnWidth)<a&&(l=a-r,c.colCount+=Math.ceil(l/c.columnWidth)))},_getMaxHgt:function(e,t,i){var r,l,n,s=this.getSheet(e);if(l=n=0,t)for(r=s.rowsHeightCollection.length;l<r;)i&&-1!==s.hideRowsCollection.indexOf(l)||(n+=s.rowsHeightCollection[l]),l++;else n=(s.rowCount-(s.hideRowsCollection.length+s._hiddenFreezeRows.length))*s.rowHeight;return n},_getMaxWth:function(e){for(var t=0,i=0,r=this.getSheet(e),l=r.columnsWidthCollection.length;i<l;)t+=r.columnsWidthCollection[i],i++;return t},_refreshTemplates:function(i,r,l,n){for(var s,o,a,d=t.isNullOrUndefined(l)?0:l,h={},c=this.getSheet(i),u=t.buildTag("colgroup"),g=this.model.scrollSettings.allowVirtualScrolling,p=t.isNullOrUndefined(n)?c.colCount:n,m=g?"<tr style = 'height: {{:height}}px' data-idx = '{{:rowidx}}'>":"<tr style = 'height: {{:height}}px'>";d<p;)s=c.columnsWidthCollection[d],a=this._generateHeaderText(d+1),o=document.createElement("col"),s<1?o.setAttribute("class","e-hide"):c._hiddenFreezeCols.indexOf(d)>-1&&o.setAttribute("class","e-fcol-hide"),o.style.width=s+"px",m+="<td class='{{:"+a+"_className}}' rowspan= {{:"+a+"_rspan}} colspan= {{:"+a+"_cspan}} style={{:"+a+"_Colors}} >{{:"+a+"_value}}</td>",u.append(o),d++;h[this._id+"JSONTemplate"+i]=m+"</tr>",r||(h[this._id+"JSONRowHdrTemplate"+i]=g?"<tr class='{{:wrap}}' style='height:{{:height}}px' data-idx='{{:rowidx}}'><td class='{{:className}}'>{{:rowidx + 1}}</td></tr>":"<tr class='{{:wrap}}' style='height:{{:height}}px'><td class='{{:className}}'>{{:rowidx + 1}}</td></tr>"),e.templates(h),this._sheets[i]._contentColGroup=u.get(0)},_renderData:function(i,r,l,n,s,o,a){var d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j,M=" ",V=[],B=this.getSheet(r),H=t.preferredCulture(this.model.locale),X=s?n:B.colCount,U=B._goToCollection,z=U.selected.length,q="e-redft e-yellowft e-greenft e-redf e-redt",G=this._dataContainer.sheets[r];if(E=0,F=o||0,i)for(C=(m=i.data).length/X;F<C;){for(u={},d=E,S=i.rowIdx[F],x=s?l:0;d<E+X;){if(g=m[d]){if(c=(v=this._generateHeaderText(x+1))+"_value",u[h=v+"_className"]="e-rowcell e-wrapword ",B.showGridlines||(u[h]+=" e-hborder"),!s&&!U.multiple&&z&&U.selected.indexOf(S+":"+x)>-1&&(u[h]+=" e-selected"),x in B.hideColsCollection&&(u[h]+=" e-soverflow"),B._hiddenFreezeCols.indexOf(x)>-1&&(u[h]+=" e-fcol-hide"),!s&&this.model.allowSelection&&this.inRange(B.selectedRange,S,x)&&(T=!0,U.multiple&&(T=!1,z&&U.selected.indexOf(S+":"+x)>-1&&(T=!0)),T&&(u[h]+=" e-selected"),B._activeCell.rowIndex===S&&B._activeCell.colIndex===x&&(u[h]+=" e-activecell")),this.model.allowCellType&&this.model.allowAutoCellType&&(("shortdate"==g.type||"longdate"==g.type)&&this._celltypes.push({rowIndex:S,colIndex:x,sheetIndex:r,cellType:{type:"DatePicker"},value:g.value2}),g.value2&&["true","yes","false","no"].indexOf(g.value2.toLowerCase())>-1&&this._celltypes.push({rowIndex:S,colIndex:x,sheetIndex:r,cellType:{type:"CheckBox",isChecked:["yes","true"].indexOf(g.value2.toLowerCase())>-1}})),(this.isImport||this.model.isImport)&&"date"==g.type&&this.XLFormat.addCustomFormatSpecifier(null,g.formatStr&&g.formatStr.replace(/^\{0\:|\}$/g,""),g.type),("shortdate"==g.type||"longdate"==g.type||"date"==g.type||"time"==g.type)&&!this._isDateTime(g.value)&&Date.parse(g.value)&&(g.value=new Date(g.value)),g.format&&(u[h]+=M+g.format,this._isClassHasProperty(g.format,"text-align","right")&&!g.merge&&(u[h]+=" e-rightalign")),g.border&&(u[h]+=M+g.border),g.align){if(g.align===t.Spreadsheet.Align.Center)u[h]+=M+this._cAlign;else if(g.align===t.Spreadsheet.Align.Right&&("object"==typeof g.value&&this._isDateTime(g.value)||this.isNumber(this.isFormula(g.value)?G[S][x].calcValue?G[S][x].calcValue:g.value2:g.value)))u[h]+=M+this._rAlign;else if(g.align==t.Spreadsheet.Align.Right&&"time"==g.type&&g.formatStr)for(D in H.calendar.patterns)if(H.calendar.patterns[D]==g.formatStr.replace(/^\{0\:|\}$/g,"")){u[h]+=M+this._rAlign;break}}else this._isGeneral(g.type)&&("object"==typeof g.value&&this._isDateTime(g.value)||this.isNumber(g.value)||this.isFormula(g.value))&&this.isNumber(g.value2)&&(u[h]+=M+this._rAlign);if(g.isMHide&&(u[h]+=" e-mc-hide",u[h]+=" e-moverflow"),g.isOfBrdr&&(u[h]+=" e-ofbrdr"),!1===g.isOverflow&&(u[h]+=" e-overflow"),_=v+"_rspan",f=v+"_cspan",g.merge?(b=g.merge.mSpan,u[_]=b.rowSpan,u[f]=b.colSpan,u[h]+=" e-moverflow",g.merge.isCenterAlign&&(u[h]+=M+this._cAlign)):(u[_]=1,u[f]=1),g.cFormatRule)for(j=g.cFormatRule.length,D=0;D<j;D++)"true"===(y=g.cFormatRule[D].split("_"))[8]&&(y[4].length>0&&q.indexOf(y[4])>-1?u[h]+=" e-"+y[4]:(u[v+"_Colors"]=this.isUndefined(u[v+"_Colors"])?"":u[v+"_Colors"],q.indexOf(y[4])<0&&(u[v+"_Colors"]+="color:"+y[4]+";"),q.indexOf(y[5])<0&&(u[v+"_Colors"]+="background-color:"+y[5]+";")));if(p=t.isNullOrUndefined(g.value2)?"":g.value2,g.wrap&&(R=this._dataContainer.sheets[r],this.isUndefined(R[S])&&(R[S]={}),this.isUndefined(R[S][0])&&(R[S][0]={}),R[S][x].wrap||(R[S][x].wrap=!0),this.model.allowWrap?(u[h]+=" e-sswraptext",R[S][0].wrapRow=!0,this.isUndefined(R[0])&&(R[0]={}),this.isUndefined(R[0][x])?R[0][x]={wrapCol:!0,wrapWidth:B.columnsWidthCollection[x]}:(R[0][x].wrapCol=!0,R[0][x].wrapWidth=B.columnsWidthCollection[x]),B._wrapColl[S]&&(!B._wrapColl[S]||B._wrapColl[S][x])||(this._wrapTextLenCln([{rowIndex:S,colIndex:x}],B,"renderdata",r),this._wrapCollection(S,x,this._getWrapCellHeight(r,S,x).rowHt,r))):R[S][x].wrap=!1),g.hyperlink)N="",A=this.XLEdit.getPropertyValue(S,x,"formats"),t.isNullOrUndefined(A)||(N=A["text-decoration"]),s?(u[h]+=" e-hyperlinks",u[c]=p):u[c]=g.hyperlink.webAddr?N?String.format("<a href={0} class='e-hyperlinks' target='_blank'>{1}</a>",g.hyperlink.webAddr,p):String.format("<a href={0} class='e-hyperlinks' style = 'text-decoration: none' target='_blank'>{1}</a>",g.hyperlink.webAddr,p):N?String.format("<a class='e-hyperlinks'>{0}</a>",p):String.format("<a class='e-hyperlinks' style = 'text-decoration: none'>{0}</a>",p);else if(g.merge){for(k=0,D=(P=this.getRangeIndices(g.merge.mRange))[0];D<=P[2];D++)i.rowIdx.indexOf(D)<0&&k++;u[c]="<div id ="+this._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(Math.floor(B._rowHeightCollection[S+(g.merge.mSpan.rowSpan-k)]-B._rowHeightCollection[S])-1)+"px'"+(this._isClassHasProperty(g.format,"text-align","right")?">":" class = 'e-rightalign'>")+p+"</div>"}else u[c]=p;g.comment&&(u[h]+=" e-commentcell",O=g.comment.isVisible?"visible":"none",u[c]=String.format("<span class='e-comment'><span class='e-celltoparrow'></span><textarea class='e-comment-txtarea' style='display:{0};z-index:9;text-align:left'>{1}</textarea></span>",O,g.comment.value)+u[c]),g.rule&&g.rule.isApply&&!this.XLValidate._checkValidation(u[c],g.rule.customVal.split("_"),!0,r)&&(u[h]+=" e-hlcell"),!g.isFilterHeader||this.isUndefined(B._filterColl[S])||this.isUndefined(B._filterColl[S][x])||(w="e-icon e-spanfilter e-filterspan "+B._filterColl[S][x].status,L=g.isFilterVisible?"display: visible":"display: none",u[c]=String.format('<span class="{0}" style="{1}"></span>',w,L)+u[c],u[h]=u[h].replace("e-ralign",""),M=M.replace("e-ralign","")),g.altTxt&&!g.wrap&&(u[h]+=" e-alt-unwrap"),"string"==typeof p&&p.indexOf("<")>-1&&(u[c]=u[c].replace(/</g,"&lt;"))}x++,d++}u.rowidx=S,I=B.rowsHeightCollection[S],u.height=this.isUndefined(I)||I<this.model.rowHeight?this.model.rowHeight:I,V.push(u),E=d,F++}else for(C=F+(C=this.model.scrollSettings.allowVirtualScrolling?B._virtualBlockRowCnt:a||B.rowCount);F<C;){for(u={},d=0;d<X;)u[h=(v=this._generateHeaderText(d+1))+"_className"]="e-rowcell e-wrapword ",d++;I=B.rowsHeightCollection[F],u.height=this.isUndefined(I)||I<this.model.rowHeight?this.model.rowHeight:I,u.rowidx=S,V.push(u),F++}return e.render[this._id+"JSONTemplate"+r](V)},_isGeneral:function(e){return this.isUndefined(e)&&(e=t.Spreadsheet.CellType.General),e===t.Spreadsheet.CellType.General},_isFormulaError:function(e){for(var t=["#NA","#DIV/0!","#NAME?","circular reference","TypeError","wrong"],i=0,r=t.length;i<r;i++)if("string"==typeof e&&e.indexOf(t[i])>-1)return!0;return!1},_refreshViewport:function(e,t){var i,r,l,n,s,o,a,d,h,c,u=this.getSheet(t),g=this.XLShape._getCellIndexFromOffset(e,0);u._virtualContBlockIdx=this._getVirtualBlockIdx(t,g.rowIndex).idx,l=(u._virtualContBlockIdx-1)*u._virtualBlockRowCnt,s=this._getRowIdx(l,t,!0),n=u._virtualContBlockIdx*u._virtualBlockRowCnt,a=this._getRowIdx(n,t,!0),u._virtualContTBodyOffset.top=this._getRowOffsetTop(u,s),1===u._virtualBlockCnt?(u._virtualTopTBodyOffset.top=u._virtualTopTBodyOffset.bottom=u._virtualTopTBodyHgt=0,u._virtualBottomTBodyOffset.top=u._virtualBottomTBodyOffset.bottom=u._virtualBottomTBodyHgt=0,u._virtualContTBodyOffset.bottom=this._getRowOffsetBottom(u._rowIdxColl[u._rowIdxColl.length-1],t),r=u._rowIdxColl,u._isVirtualTopReached=u._isVirtualEndReached=!0):1===u._virtualContBlockIdx?(u._virtualTopTBodyOffset.top=u._virtualTopTBodyOffset.bottom=u._virtualTopTBodyHgt=0,u._virtualContTBodyOffset.bottom=u._virtualBottomTBodyOffset.top=this._getRowOffsetTop(u,a),d=this._getRowIdx(n+(u._virtualBlockRowCnt-1),t,!0),u._virtualBottomTBodyOffset.bottom=this._getRowOffsetBottom(d,t),u._virtualBottomTBodyHgt=u._virtualTBodyHgt-(u._virtualContTBodyOffset.bottom-u._virtualContTBodyOffset.top+(u._virtualBottomTBodyOffset.bottom-u._virtualBottomTBodyOffset.top)),r=u._rowIdxColl.slice(0,u._rowIdxColl.indexOf(d)+1),u._isVirtualTopReached=!0,u._isVirtualEndReached=!1):u._virtualContBlockIdx===u._virtualBlockCnt?(h=(u._virtualContBlockIdx-2)*u._virtualBlockRowCnt,u._virtualBottomTBodyOffset.top=u._virtualBottomTBodyOffset.bottom=u._virtualBottomTBodyHgt=0,o=this._getRowIdx(l+(u._virtualBlockRowCnt-1),t,!0),u._virtualContTBodyOffset.bottom=this._getRowOffsetBottom(o,t),c=this._getRowIdx(h,t,!0),u._virtualTopTBodyOffset.top=this._getRowOffsetTop(u,c),u._virtualTopTBodyOffset.bottom=u._virtualContTBodyOffset.top,u._virtualTopTBodyHgt=u._virtualTBodyHgt-(u._virtualContTBodyOffset.bottom-u._virtualContTBodyOffset.top+(u._virtualTopTBodyOffset.bottom-u._virtualTopTBodyOffset.top)),r=u._rowIdxColl.slice(u._rowIdxColl.indexOf(c),u._rowIdxColl.indexOf(o)+1),u._isVirtualEndReached=!0,u._isVirtualTopReached=!1):(h=l-u._virtualBlockRowCnt,c=this._getRowIdx(h,t,!0),u._virtualTopTBodyOffset.top=this._getRowOffsetTop(u,c),u._virtualTopTBodyOffset.bottom=u._virtualContTBodyOffset.top,u._virtualContTBodyOffset.bottom=u._virtualBottomTBodyOffset.top=this._getRowOffsetTop(u,a),d=this._getRowIdx(n+(u._virtualBlockRowCnt-1),t,!0),u._virtualBottomTBodyOffset.bottom=this._getRowOffsetBottom(d,t),u._virtualTopTBodyHgt=e-(u._virtualTopTBodyOffset.bottom-u._virtualTopTBodyOffset.top+(e-u._virtualContTBodyOffset.top)),u._virtualBottomTBodyHgt=u._virtualTBodyHgt-u._virtualBottomTBodyOffset.bottom,r=u._rowIdxColl.slice(u._rowIdxColl.indexOf(c),u._rowIdxColl.indexOf(d)+1),u._isVirtualTopReached=u._isVirtualEndReached=!1),i=this.getRangeData({property:["value","value2","comment","hyperlink","rule","cFormatRule","format","border","type","isFilterHide","isRHide","isFHide","isFilterHeader","isFilterVisible","filterState","isMHide","merge","hRow","isLocked","wrap","isOverflow","align","isOfBrdr","altTxt","formatStr","cellType"],sheetIdx:t,rowIdxs:r,withRowIdx:!0}),this._getRowHdrTBody(t).html(this._renderRowHdr(i.rowIdx,t)),this._getContTBody(t).html(this._renderData(i,t)),this._refreshRows(t),this._refreshTBodiesHgt(t),this.model.allowComments&&this.XLComment._updateCmntArrowPos(null,t),u._virtualRowIdx=i.rowIdx,this.model.allowCellType&&this.XLCellType._rangeCellTypes(u.cellTypes,t),this.model.allowSparkline&&this.XLSparkline._refreshContentWithSparkline(t),this._refreshViewVar(e,u._isLoaded?null:0,t)},refreshOverflow:function(e,t){this._refreshOverflow(e,t)},_refreshOverflow:function(e,t){t=this._getSheetIndex(t);var i,r,l,n,s,o,a,d=this.getSheet(t),h=this._dataContainer.sheets[t];if(e=e||[0,0,d.usedRange.rowIndex,d.usedRange.colIndex],!((s=this.XLEdit._getPropWithCellIdx(e,"value2")).length<1))for(a=s[s.length-1].colIdx,i=s.length-1;i>-1;i--)l=s[i].rowIdx,n=s[i].colIdx,this.model.allowOverflow?(a===n&&(o=this.getObjectKeys(h[l])),this._textClip(l,n,"add","",!0,o)):(this._isRowViewable(t,l)&&(r=this.getCell(l,n)[0]),this._removeClass(r,"e-overflow"),a===n&&(o=this.getObjectKeys(h[l])),this._textClip(l,n,"delete","",!0,o),this.addClass(r,"e-overflow"),this.XLEdit._updateDataContainer({rowIndex:l,colIndex:n},{dataObj:{isOverflow:!1},skipCell:!0}))},_getVirtualBlockIdx:function(e,t,i){for(var r=1,l={},n=this.getSheet(e),s=this._getRowIdx(t,e,!1,!0);r<=n._virtualBlockCnt;){if(s<r*n._virtualBlockRowCnt){l.idx=r;break}r++}if(i)for(r=0;++r;)if(t<r*n._virtualBlockRowCnt){l.orgIdx=r;break}return l},_getBlockInfo:function(e,t,i){var r,l=this.getSheet(t),n=[0,0,0,l.colCount-1];return r=this._getVirtualBlockIdx(t,e,i),n[0]=l._virtualBlockRowCnt*(r.idx-1),n[2]=l._virtualBlockRowCnt*r.idx-1,r.range=n,i&&((n=[0,0,0,l.colCount-1])[0]=l._virtualBlockRowCnt*(r.orgIdx-1),n[2]=l._virtualBlockRowCnt*r.orgIdx-1,r.orgRange=n),r},_getRowOffsetTop:function(e,t){return e._rowHeightCollection[t]},_getRowOffsetBottom:function(e,t){return this.getSheet(t)._rowHeightCollection[e]+this.getSheet(t).rowsHeightCollection[e]},_getColOffsetLeft:function(e,t){return e._colWidthCollection[t]},getCellIdx:function(e){return this._getCellIdx(e)},_getCellIdx:function(e){return{rowIndex:this.model.scrollSettings.allowVirtualScrolling?Number(e.parentNode.attributes.getNamedItem("data-idx").value):e.parentNode.rowIndex,colIndex:e.cellIndex}},_getMidCell:function(){var e,t={},i=this.getSheet();return e=i._bottomRow.idx-i._topRow.idx+1,t.rowIdx=i._topRow.idx+Math.floor(e/2),e=i._rightCol.idx-i._leftCol.idx+1,t.colIdx=i._leftCol.idx+Math.floor(e/2),t},_removeRange:function(t,i){var r=this.getActiveSheetIndex(),l=this._getRowHdrTBody(r),n=e(this._getRowHdrTBody(r)[0].rows),s=this._getContTBody(r),o=e(this._getContTBody(r)[0].rows);n.splice(t,i),o.splice(t,i),this.setRows([n,o],r),s.html(o),l.html(n),this._getContent(r).find(".e-ss-sparkline").remove(),this._getContent(r).find(".e-ddl").remove()},_refreshTBodiesHgt:function(e){e=this._getSheetIndex(e);var t=this.getSheet(e),i=this._getJSSheetRowHeaderContent(e)[0].getElementsByTagName("tbody"),r=this._getContent(e)[0].getElementsByTagName("tbody");i[0].style.height=r[0].style.height=(t._virtualTopTBodyHgt<this.model.rowHeight?0:t._virtualTopTBodyHgt)+"px",i[2].style.height=r[2].style.height=t._virtualBottomTBodyHgt+"px"},_renderTD:function(e,t,i){return String.format("<td class='{0}' style='{1}' >{2}</td>",e,t,i)},_renderDIV:function(e,t,i){return i?String.format("<div class='{0}' title='{2}'>{1}</div>",e,t,i):String.format("<div class='{0}'>{1}</div>",e,t)},_renderTR:function(e,t,i){var r="height:"+(this._sheetCopy.isSheetCopy?this.getSheet(i).rowsHeightCollection[t]:this.model.rowHeight)+"px";return String.format("<tr style='{0}'>"+e+"</tr>",r)},_renderFooter:function(){var i,r,l=this.model.scrollSettings,n=t.buildTag("div.e-spreadsheetfooter","",{display:this.model.showPager?"block":"none"}),s=t.buildTag("table.e-table","",{},{}),o=e(document.createElement("tbody")),a=e(document.createElement("tr")),d=e(document.createElement("td"));this._updateResponsiveSettings(),i=l.isResponsive?"100%":this._responsiveWidth-2,d.append(this._renderSpreadSheetPager()),d.find(".e-pagercontainer").append(t.buildTag("div#"+this._id+"_AddSheet.e-new e-icon e-default","",null,{title:this._getLocStr("NewSheet")})),a.append(d),o.append(a),s.append(o),n.append(s),this.getMainPanel().append(n),this._refreshSpreadSheetPager(),r=this.element.find(".e-spreadsheetfooter").outerHeight(),this.model.showPager&&r>this.model.pageSettings.pagerHeight&&(this.model.pageSettings.pagerHeight=r<37?r:36),n.width(i).height(this.model.showPager?this.model.pageSettings.pagerHeight:0),this.element.find(".e-spreadsheetfooter .e-table").height(this.model.pageSettings.pagerHeight),this.setFooter(n)},gotoPage:function(t,r){var l,n,s;if((r||!(t>this.model.sheetCount))&&!(t<1)){var o,a,d,h,c,u,g=this.model.sheets,p=this.getPager(),m={},_=this._impData,f={reqType:"gotoSheet",gotoIndex:t,newSheet:r,prevSheetIdx:this.getActiveSheetIndex()},b=!this.XLRibbon._ribbonState,C={reqType:f.reqType,gotoSheetIndex:f.gotoIndex,isNewSheet:f.newSheet,prevSheetIndex:f.prevSheetIdx,action:"gotopage",type:"actionBegin"},S=p.ejPager("option","totalRecordsCount"),x=this.model.sheetCount;r&&(r=!(t<=x)),r&&(x+1<t&&(t=x+1),S==x&&p.ejPager("option",{totalRecordsCount:S+1})),this._gotoPageArgs=e.extend(!0,{},f),this._isSheetNavigate=!r,this._trigActionBegin(C)||(this.setActiveSheetIndex(t),this.model.pageSettings.currentPage=t,a=g[t],r||this.isNumber(a.colCount)||(a.colCount=this.model.columnCount),r||a._isRequested||!a._isImported?(this.element.find(".e-sheet").hide(),r&&(this._addSheet(t),(a=g[t])._isNavigated=!0),this._isSheetInsert&&(o=p.ejPager("option","currentPage"),this._swapSheetDtCntr(g.length-1,o),this.model.activeSheetIndex=t=o,this._isSheetInsert=!1),this._isNew||(this.model.scrollSettings.allowVirtualScrolling||this.model.scrollSettings.allowSheetOnDemand)&&!a._isLoaded||this._isallowScrollingSetModel||this._isallowVirtualScrollingSetModel?(this.showWaitingPopUp(),this._initSheet(t),this.model.isGridMode&&!r&&this._gridModeScroll(),this._isallowScrollingSetModel=!1,this._isallowVirtualScrollingSetModel=!1):(this.element.find("#"+this._id+"_"+a.sheetInfo.value).show(),this.model.scrollSettings.allowVirtualScrolling||r||a._isOpened||this._refreshOverflow(i,t),this.model.isGridMode&&!r&&this._gridModeScroll(),r||this._initSelection(),this._isAutoWHMode&&(this._autoSSWidthHeight(),a._isOpened||this._refreshOverflow(i,t)),this._gotoPageArgs&&this._pageLoadComplete(t)),this.model.isGridMode&&(l=this.getSheetElement(t),"none"==(n=this._getContent(t)).find("#vscrollBar")[0].style.display&&l.find(".e-spreadsheetheader").hasClass("e-scrollcss")&&(l.find(".e-spreadsheetheader").removeClass("e-scrollcss"),l.find(".e-spreadsheetheader")[0].style.width=parseInt(l.find(".e-spreadsheetheader")[0].style.width)+18+"px"),"none"==n.find("#hscrollBar")[0].style.display&&l.find(".e-spreadsheetrowheader").hasClass("e-scrollrowcss")&&(l.find(".e-spreadsheetrowheader").removeClass("e-scrollrowcss"),l.find(".e-spreadsheetrowheader")[0].style.height=parseInt(l.find(".e-spreadsheetrowheader")[0].style.height)+18+"px")),a._isResized&&(this._refreshSheetWithScreen(t),this._updateResponsiveSettings(),m.width=this._responsiveWidth,m.height=this._responsiveHeight,this._setSheetWidthHeight(t,m,null,"refresh"),a._isResized=!1),this.model.scrollSettings.allowVirtualScrolling||a._isOpened||this._updateHiddenRows(t),this.model.allowFreezing&&this.XLFreeze._refreshFreeze(),this._isSheetNavigate=!1):this._importSheet(t),a._isOpened=!0,this.isImport||this.model.isImport||this.hideActivationPanel(),_&&!this._isExport&&!a._isImpSLoad&&a._isImported&&(d=_.model.sheets[t]._scrollTop,h=_.model.sheets[t]._scrollLeft,d>0&&this.XLScroll._vScroller(t).scroll(d),h>0&&this.XLScroll._hScroller(t).scroll(h),a._isImpSLoad=!0),c=this.getActiveCell(t),(u=this.XLEdit.getPropertyValue(c.rowIndex,c.colIndex,"rule",t))&&"list"===u.type&&this._setddlCell(),a._isRibCollapsed!=b&&(this._heightWidthCalculation(this.getActiveSheetIndex(),e.extend(!0,{},this.model.scrollSettings)),a._isRibCollapsed=b),this._isAutoWHMode&&(s=this._getElementDimension(),this.element.css({height:s.height,width:s.width})),this.XLRibbon._updateScopeRange(),this.XLRibbon._updateUseInFormulaTrgt(),this.XLEdit._refreshAutoComplete(),a._isImported&&!a._isLoaded||this._isUndoRedo||this._isExport||(C={sheetIndex:t,reqType:f.reqType,gotoSheetIndex:f.gotoIndex,isNewSheet:f.newSheet,prevSheetIndex:f.prevSheetIdx,action:"gotopage",type:"actionComplete"},this._trigActionComplete(C)))}},insertSheet:function(){if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode){var e=this.getPager(),t=e.ejPager("option","totalRecordsCount")+1;e.ejPager("option",{totalRecordsCount:t}),this._isSheetInsert=!0,this.gotoPage(t,!0),this._setSheetFocus()}},_renameSheet:function(i){var r=this.element.find(".e-currentitem"),l=t.buildTag("input#"+this._id+"_Sheet_RenamePanel","",{width:r.width()+5+"px",padding:0},{type:"input",value:i||this.getSheet(this.getActiveSheetIndex()).sheetInfo.text,maxlength:"31"});r.hide(),l.insertAfter(r).select().focus(),this._isSheetRename=!0,this.model.showRibbon&&this.XLRibbon._disableRibbonIcons(),this.model.enableContextMenu&&e("#"+this._id+"_contextMenuFooter").data("ejMenu")._contextMenuEvents("_off")},deleteSheet:function(e,t){if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode){var i,r=this.getActiveSheetIndex(),l={index:e,alertStatus:t,sheetIndex:r,reqType:"delete",type:"actionBegin",action:"deleteSheet"};this._trigActionBegin(l)||(i=this._getSheetNames(!0).length,e=l.index||r,i>1?(e!==r&&this.gotoPage(e,!1),this.getObjectLength(this._dataContainer.sheets[e])&&l.alertStatus?this._showAlertDlg("","SheetDeleteAlert","sheetDeleteActn",470):this._removeSheet(e)):this._showAlertDlg("Alert","SheetDeleteErrorAlert","",430),l.type="actionComplete",this._trigActionComplete(l))}},hideSheet:function(t){if(!this.model.isReadOnly&&!this.model.isGridMode){var i=this._getSheetNames(!0),r=this._getSheetNames(),l=e.isNumeric(t)?t:this._getSheetIndexByName(t)||this.getActiveSheetIndex();i.length>1?(r[l-1].isVisible=!1,this.gotoPage(this._getNxtVisibleSheet(l,null,i))):this._showAlertDlg("Alert","SheetDeleteErrorAlert","",377)}},unhideSheet:function(t){if(!this.model.isReadOnly&&!this.model.isGridMode){var i=this._getSheetNames(),r=e.isNumeric(t)?t:this._getSheetIndexByName(t);i[r-1].isVisible||(i[r-1].isVisible=!0,this.gotoPage(r)),this.hideWaitingPopUp()}},_getNxtVisibleSheet:function(e,t,i){var r=this._getSheetNames(),l=r.length,n="<=",s=1,o=this._getSheetNames(!0),a=r[e-1].value===(i&&i[i.length-1].value||o[o.length-1].value);for((t||a)&&(l=0,n=">=",s=-1);this.operators[n](e,l);){if(r[e-1].isVisible)return e;e+=s}},_renderSpreadSheetPager:function(){var t,i,r={},l=e(document.createElement("div"));return this.model.pageSettings.change=e.proxy(this._spreadSheetPagerClickHandler,this),this.model.pageSettings.totalRecordsCount=this.model.sheetCount,this.model.pageSettings.locale=this.model.locale,e.extend(r,this.model.pageSettings),r.currentPage=this.getActiveSheetIndex(),r.pageSize=1,r.showGotoPage=!1,this.setPager(l),l.ejPager(r),(t=l.data("ejPager"))._$first[0].title=this._getLocStr("Firstsheet"),t._$last[0].title=this._getLocStr("Lastsheet"),t._$next[0].title=this._getLocStr("Nextsheet"),t._$prev[0].title=this._getLocStr("Prevsheet"),l.find(".e-parentmsgbar").remove(),(i=l.find(".e-pagercontainer")[0]).appendChild(l.find("a.e-PP")[0]),i.appendChild(l.find(".e-numericcontainer")[0]),i.appendChild(l.find("a.e-NP")[0]),l},_getPageCount:function(){var t=this.model.scrollSettings.isResponsive,i=this.model.pageSettings.pageCount;if(t){var r,l,n,s,o=0,a=this.getPager(),d=a.find(".e-currentitem"),h=a.find(".e-numericcontainer"),c=this._getSheetNames(),u=a.width(),g=250,p=h.children(":visible"),m=this.getActiveSheetIndex(),_=e(p[0]).data("index"),f=!0;for((l="msie"===this._browserDetails.name&&"8.0"===this._browserDetails.version)?(n=e("#"+this._id+"_emptySpan")).css({"font-size":d.css("font-size"),"font-family":d.css("font-family")}):(s=document.createElement("canvas").getContext("2d")).font=d.css("font-size")+" "+d.css("font-family");m>_-1;){if(u<=(g+=l?n.text(c[m-1].text).width()+19:s.measureText(c[m-1].text).width+19))return o||1;m--,o++}for(m=this.getActiveSheetIndex();f;){if(r=this.isUndefined(c[m])?this._getLocStr("Sheet")+m:c[m].text,u<=(g+=l?n.text(r).width()+19:s.measureText(r).width+19)){f=!1;break}m++,o++}return l&&this._refreshGlobalSpan(),o||1}return i},_spreadsheetPagerCustomBtnHandler:function(e){var t=this.getPager().ejPager("option","currentPage");this._spreadSheetPagerClickHandler({currentPage:t,event:e,isInteraction:!0})},_spreadSheetPagerClickHandler:function(i){var r;if(i.isInteraction){var l,n,s,o=!1,a=this,d=e(i.event.target),h=a.getPager().data("ejPager");if(a._filterClose(d),!d.hasClass("e-new")||!a.model.exportSettings.password)return(a.model.allowComments&&a.XLComment._isCommentEdit||a.XLEdit._isEdit||!a.model.allowInsert||a.model.isReadOnly)&&(i.event&&(d.hasClass("e-pager")||d.hasClass("e-new"))||a.element.find(".e-field-validation-error").length)?void 0:(a.model.allowComments&&a.XLComment._isCommentEdit&&a.XLComment._updateCurCmntVal(),a.XLEdit._isEdit&&!a.XLEdit._isFormulaEdit?a.XLEdit.saveCell():((r=a.element.find("#"+a._id+"_Edit").text()).substr(r.length-1).indexOf(",")>-1?({rowIndex:0,colIndex:0},{rowIndex:0,colIndex:0}):(a._dStartCell,a._dEndCell),a.XLSelection._clearBorder(a._arrayAsString(a._ctrlFormulaBorder.concat(a._formulaBorder))),this.element.focus()),!t.isNullOrUndefined(i.event)&&(d.hasClass("e-prevpage")||d.hasClass("e-nextpage")||d.hasClass("e-firstpagedisabled")||d.hasClass("e-lastpagedisabled"))&&(i.currentPage=a._getNxtVisibleSheet(i.currentPage,d.hasClass("e-prevpage")||d.hasClass("e-lastpage")||d.hasClass("e-lastpagedisabled"))),(s={activeSheet:a.getActiveSheetIndex(),gotoSheet:i.currentPage,newSheet:i.event&&d.hasClass("e-new")}).newSheet?(n=(l=a.getPager()).ejPager("option","totalRecordsCount")+1,s.gotoSheet=n):s.gotoSheet=i.currentPage,i.currentPage=s.gotoSheet,!t.isNullOrUndefined(i.event)&&i.event.target.id.indexOf("_Sheet_RenamePanel")>-1||a._isSheetRename&&!a._updateSheetNames(null,!1)||h._prevPageNo===i.currentPage?void 0:(s.newSheet&&(l.ejPager("option",{totalRecordsCount:n,currentPage:n}),i.currentPage=n,o=!0),a._pageClickArgs=e.extend(!0,{},s),a.gotoPage(i.currentPage,o),e(i.event.target).hasClass("e-pager")||(a._completeAction({reqType:"paging",sheetIndex:s.activeSheet,nSheetIndex:i.currentPage}),a._trigActionComplete({reqType:"paging",sheetIndex:s.activeSheet,newSheetIndex:i.currentPage})),!1))}},_pageLoadComplete:function(t){var i,r,l=this.getSheet(t),n="option",s="checked",o=this._gotoPageArgs,a=this.model.allowSelection;if(a&&t!==o.prevSheetIdx&&(this.XLSelection._isGridBordering||this.XLSelection._isOutsideBordering)&&(this._getContent(o.prevSheetIdx).find("div:first-child").removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor"),this.XLSelection._isGridBordering=this.XLSelection._isOutsideBordering=!1),(!l._isImported||l._isLoaded)&&this.model.enableContextMenu&&this.XLCMenu.hideCMenu(),this._refreshSpreadSheetPager(o.newSheet),a&&this.getSheetElement(t).find(".e-ss-activeimg").length&&this.XLSelection._cleanUp(!0),this.model.showRibbon&&(this._updateRibbonTab(l._activeCell),this.isImport||this.model.isImport||(this.model.allowLockCell&&(l.isSheetProtected||this.XLEdit._isFormulaEdit?this.XLRibbon._disableRibbonIcons():this.XLRibbon._enableRibbonIcons(),this.XLRibbon._updateRibbonIcons()),this.model.allowComments&&this.XLComment._updateCmntRibIcons()),e("#"+this._id+"_Ribbon_PageLayout_Show_Headings").ejCheckBox(n,s,l.showHeadings),e("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").ejCheckBox(n,s,l.showGridlines)),this.model.allowCellFormatting&&(i=this.getSheetElement(t).find(".e-content")[0],this.XLFormat._formatEnable?(this._removeClass(i,"e-ss-cursor"),this.addClass(i,"e-ss-fpcursor")):(this.addClass(i,"e-ss-cursor"),this._removeClass(i,"e-ss-fpcursor"))),this._pageClickArgs){if(this._pageClickArgs.activeSheet=this.getActiveSheetIndex(),this._trigger("pagerClick",this._pageClickArgs))return!1;this.model.scrollSettings.isResponsive&&this._isResized&&!this._resizeColl[t-1]&&(this._refreshSheetonResize(),this._resizeColl.toString().indexOf("f")<0&&(this._isResized=!1,this._resizeColl.fill(!1)))}this.hideWaitingPopUp(),this._pageClickArgs=this._gotoPageArgs=null,r={gotoSheetIndex:o.gotoIndex,isNewSheet:o.newSheet,prevSheetIndex:o.prevSheetIdx,reqType:o.reqType},this._trigActionComplete(r)},_createTemplateElement:function(t,i){var r=document.createElement("script");return r.id=(this._id+t+i.field+e.inArray(i,this.getSheet(t).columns)+"_Template").split(" ").join(""),r.type="text/x-jsrender",r.text=i.templateContent?i.templateContent:e(i.templateID).html(),e("body").append(r),e(i.templateID).hide(),r},_refreshSpreadSheetPager:function(e){var t=this.getPager(),i={currentPage:this.getActiveSheetIndex()},r=t.height();(this.isImport||this.model.isImport||this._isNew||null===t)&&(i.totalRecordsCount=this.model.sheetCount),(e||this._isInitLoad||this._isSheetInsert||this._isNew)&&(this.model.pageSettings.pageCount=i.pageCount=this._getPageCount()),t.ejPager("option",i).ejPager("refreshPager"),this._updatePageContainer(t,i.currentPage),r!==t.height()&&(i.pageCount=this._getPageCount(),t.ejPager("option",i).ejPager("refreshPager"),this._updatePageContainer(t,i.currentPage)),this.model.isGridMode&&(document.getElementById(this._id+"_AddSheet").style.display="none"),this.model.allowInsert||this.addClass(document.getElementById(this._id+"_AddSheet"),"e-disable")},_updatePageContainer:function(t,i){var r,l,n,s,o,a,d=0,h=0,c=t.data("ejPager"),u=this.model.sheets,g=t.find(".e-numericcontainer").children(":visible"),p=c.model.pageCount,m=[c._$first[0],c._$prev[0]],_=["e-firstpagedisabled e-disable","e-firstpage e-default","e-prevpagedisabled e-disable","e-prevpage e-default"],f=[c._$last[0],c._$next[0]],b=["e-lastpagedisabled e-disable","e-lastpage e-default","e-nextpagedisabled e-disable","e-nextpage e-default"],C=g.length,S=d+1===C;for(c._$next[0].className=c._$next[0].className.replace("-2x",""),c._$prev[0].className=c._$prev[0].className.replace("-2x","");d<C;){if(o=(a=u[n=(s=e(g[d])).data("index")].sheetInfo).text,S){for(var x,v,w,I=t.outerWidth(),y=!0,T=o,L=3,R="msie"===this._browserDetails.name&&"8.0"===this._browserDetails.version;y;)R?((x=e("#"+this._id+"_emptySpan")).css({"font-size":s.css("font-size"),"font-family":s.css("font-family")}),v=248+(x.text(T).width()+19)):((w=document.createElement("canvas").getContext("2d")).font=s.css("font-size")+" "+s.css("font-family"),v=248+(w.measureText(T).width+19)),I<=v&&o.length>=L?T=o.slice(0,o.length-L++)+"...":(y=!1,o=T);R&&this._refreshGlobalSpan()}s.text(o),a.isVisible?l=n%p:s.hide(),!r&&a.isVisible&&(r=n%p),d++}if(r===i)for(d=0;d<2;d++)this.addClass(m[d],_[h]),this._removeClass(m[d],_[h+1]),h+=2;if(h=0,l===i)for(d=0;d<2;d++)this.addClass(f[d],b[h]),this._removeClass(f[d],b[h+1]),h+=2},_updateSheetNames:function(i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A=this.getPager().find(".e-currentitem"),P=this.model.sheets,k=e("#"+this._id+"_Sheet_RenamePanel"),j=!0,M=[],V=[],B=/'[^'"]*'(?=(?:[^"]*"[^"]*")*[^"]*$)/g;if(t.isNullOrUndefined(i)&&(i=k.val().trim()),n=P[A.data("index")].sheetInfo.text,l={sheetIdx:this.getActiveSheetIndex(),reqType:"renameSheet",prevName:n,newName:i,type:"actionBegin",action:"updatesheetnames"},this._trigActionBegin(l)&&(r=!0),i=l.newName,r)return k.remove(),A.show(),this.model.showRibbon&&this.XLRibbon._enableRibbonIcons(),this.model.enableContextMenu&&e("#"+this._id+"_contextMenuFooter").data("ejMenu")._contextMenuEvents("_on"),this._isSheetRename=!1,!1;if(i.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*"))&&(i=!1),!i)return this._showAlertDlg("Alert",["SheetRenameEmptyAlert","SheetRenameEmptyCharExceedAlert","SheetRenameEmptySplCharAlert","SheetRenameEmptyBlankAlert"],"sheetRenameActn",500),!1;for(S=1,h=P.length;S<h;S++)A.text()!==P[S].sheetInfo.text&&i.toLowerCase()===P[S].sheetInfo.text.toLowerCase()&&(j=!1);if(j){if(this.model.enablePivotTable&&this.XLPivot._updateSheetName(i),P[A.data("index")].sheetInfo.text=i){for(F in k.remove(),A.show(),w=(a=this._calcEngine).getDependentCells().items)w.hasOwnProperty(F)&&V.push(F);for(c=V,u=this._getSheetNames(),S=0;S<c.length;S++)for(g=w[c[S]],D=0;D<g.length;D++){if(p=a.getFormulaInfoTable().items[g[D]])for(p=p.getFormulaText(),x=0;x<u.length;x++)u[x].text!==u[x].value&&(b=new RegExp(u[x].value+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),p.match(B)&&(this.XLEdit._singleQuote=!0),p.match(b)&&(p=p.replace(b,x+"/"),M.push(x),C=!0));if(C){for(v=0;v<M.length;)b=new RegExp(M[v]+'/(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),p=isNaN(u[M[v]].text)&&/^[a-zA-Z0-9- ]*$/.test(u[M[v]].text)&&!u[v].text.match("\\s+")?p.replace(b,u[M[v]].text):p.replace(b,this.XLEdit._singleQuote?u[M[v]].text:"'"+u[M[v]].text+"'"),v++,this.XLEdit._singleQuote=!1;m=a.rowIndex(g[D])-1,_=a.colIndex(g[D])-1,f=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+(parseInt(g[D].split("!")[1])+1)),this.XLEdit._updateDataContainer({rowIndex:m,colIndex:_},{dataObj:{value:p},sheetIdx:f}),C=!1}}this._isSheetRename=!1}for(this._refreshSpreadSheetPager(!0),this.model.allowFormulaBar&&this.updateFormulaBar(),R=this.getSheet(f),S=0,y=(d=this.model.nameManager).length;S<y;S++){for(o=(o=d[S].refersto).split(","),E=[],T=d[S].scope,D=0,N=o.length;D<N;D++)T&&T.indexOf(n)>-1&&(d[S].scope=T.replace(n,i.match(/\s/g)?"'"+i+"'":i),this._calcEngine.removeNamedRange(n+"!"+d[S].name),this._calcEngine.addNamedRange(i+"!"+d[S].name,d[S].refersto.replace("=",""))),o[D]&&o[D].indexOf(n)>-1&&(o[D]=o[D].replace(/[\']/g,""),E.push(o[D].replace(n,i.match(/\s/g)?"'"+i+"'":i)));d[S].refersto=E.join(",")}for(S=0,L=(V=this.getObjectKeys(R._scopeRanges)).length;S<L;S++)O=R._scopeRanges[V[S]].name,o=R._scopeRanges[V[S]].refersto,O&&O.indexOf(n)>-1&&(R._scopeRanges[V[S]].name=O.replace(n,i.match(/\s/g)?"'"+i+"'":i)),o&&o.indexOf(n)>-1&&(o=o.replace(/[\']/g,""),R._scopeRanges[V[S]].refersto=o.replace(n,i.match(/\s/g)?"'"+i+"'":i));for(S in I=R.tableManager)this.XLFormat._updateTableFormula("updateRange",I[S],f);return this.model.showRibbon&&(this.XLRibbon._enableRibbonIcons(),(s=e("#"+this._id+"_nmgrid").data("ejGrid"))&&(s.refreshContent(),e("#"+this._id+"_nmrange").val(""))),this.model.enableContextMenu&&e("#"+this._id+"_contextMenuFooter").data("ejMenu")._contextMenuEvents("_on"),l={sheetIdx:this.getActiveSheetIndex(),reqType:"renameSheet",prevName:n,newName:i,type:"actionComplete",action:"updatesheetnames"},this._trigActionComplete(l),!0}this._showAlertDlg("Alert","SheetRenameAlert","sheetRenameActn",325),R._isImported&&!R._isLoaded||this._isUndoRedo||this._isExport||(this._completeAction(l),this._trigActionComplete(l))},_getSheetIndexByName:function(e){var t,i,r=this._getSheetNames();for((e=e&&e.replace(/^'|'$/g,""))&&(e=e.toLowerCase()),t=0,i=r.length;t<i;t++)if(r[t].text.toLowerCase()===e)return t+1;return!1},_removeSheet:function(t){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=this.model.sheetCount,C=this._dataContainer.sheets,S=this.model.sheets,x=[],v=[];if(b>1){if(h=S[t].sheetInfo.value,this._getAutoFillOptElem().appendTo(this.element),this.element.find("#"+this._id+"_"+h).remove(),b===this.getActiveSheetIndex()){for(i=1;i<b;i++)if(S[t-i].sheetInfo.isVisible){this.setActiveSheetIndex(t-i);break}}else this.setActiveSheetIndex(t);for((this._swapSheetDtCntr(t,b),b in C&&delete C[b],this._sheets.splice(b,1),S.splice(b,1),b=--this.model.sheetCount,this.getPager().ejPager("option",{totalRecordsCount:b,pageCount:this._getPageCount()}),this.gotoPage(this.getActiveSheetIndex(),!1),this._getAutoFillOptElem().appendTo(this._getJSSheetContent(this.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content")),this._rebindScrollEvnt(),i=0,m=(c=this.model.nameManager).length);i<m;i++)c[i].refersto.indexOf(h)>-1&&(v.push(c[i].name),"Workbook"!=c[i].scope?c.splice(i,1):c[i].refersto="#REF!");for(i in p=(u=this._calcEngine).getDependentCells().items)p.hasOwnProperty(i)&&x.push(i);for(i=0;i<x.length;i++)for(n=p[x[i]],l=0;l<n.length;l++)if(s=u.getFormulaInfoTable().items[n[l]],d=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+(parseInt(n[l].split("!")[1])+1)),s&&d>-1)for(o=s.getFormulaText(),a=new RegExp(h+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi"),o.match(a)&&(o=o.replace(a,"#REF"),this.XLEdit._updateDataContainer({rowIndex:u.rowIndex(n[l])-1,colIndex:u.colIndex(n[l])-1},{dataObj:{value:o},sheetIdx:d}),u.refresh(s.getParsedFormula())),_=0,f=v.length;_<f;_++)o.indexOf(v[_])>-1&&u.refresh(s.getParsedFormula());if(this.model.showRibbon&&((g=e("#"+this._id+"_nmgrid").data("ejGrid"))&&(g.refreshContent(),e("#"+this._id+"_nmrange").val(""))),r={sheetIndex:t,reqType:"remove-sheet"},this.clearUndoRedo(),this._trigActionComplete(r))return}},_rebindScrollEvnt:function(){for(var e=1;e<=this.model.sheetCount;e++)this.getSheet(e)._isLoaded&&(this._getJSSheetContent(e).find(".e-spreadsheetcontentcontainer > .e-content").off("scroll"),this.element.find("#"+this._id+"_"+this.model.sheets[e].sheetInfo.value).find(".e-headercontent").off("scroll"),this._refreshScrollerEvent(e))},_getSheetNames:function(e){for(var t=[],i=this.model.sheets,r=1,l=i.length;r<l;r++)(this.isUndefined(e)||(!e||i[r].sheetInfo.isVisible)&&(e||!i[r].sheetInfo.isVisible))&&t.push(i[r].sheetInfo);return t},_initMoveCopyDlg:function(){var e,i,r,l,n,s,o,a,d,h=this._id+"_moveCopyDlg";e=t.buildTag("div#"+h,"",{display:"none"}),i=t.buildTag("div#"+h+"_sheetContent.e-dlgctndiv e-dlg-fields",t.buildTag("label.e-dlg-fields",this._getLocStr("Beforesheet"))),a=t.buildTag("div.e-dlg-fields"),s=t.buildTag("ul#"+h+"_list"),i.append(a.append(s)),o=t.buildTag("input#"+h+"_createcopy"),i.append(o),o.ejCheckBox({cssClass:"e-dlg-fields"}),o.parent().append(t.buildTag("label",this._getLocStr("CreateaCopy"),{"margin-left":6})),e.append(i),n=t.buildTag("div#"+h+"_btndiv.e-dlg-btnfields"),d=t.buildTag("div.e-dlg-btnctnr"),r=t.buildTag("input#"+h+"_okbtn",""),l=t.buildTag("input#"+h+"_cnlbtn"),r.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,click:t.proxy(this._moveCopyBtnClick,this,"ok"),cssClass:"e-ss-okbtn",width:60}),l.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._moveCopyBtnClick,this,"cancel"),showRoundedCorner:!0,width:60}),n.append(d.append(r,l)),e.append(n),this.element.append(e),e.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("MoveorCopy"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg e-ss-movedlg"}),s.ejListBox({dataSource:this._getSheetNames(),height:"197px",width:"250px",fields:{text:"text",value:"value"}})},_renderMoveCopyDlg:function(){var t=e("#"+this._id+"_moveCopyDlg"),i=e("#"+this._id+"_moveCopyDlg_list").data("ejListBox"),r=this._getSheetNames();r.push({text:this._getLocStr("MoveToEnd"),value:this._getLocStr("MoveToEnd")}),t.ejDialog("open"),i.model.dataSource=r,i.option("fields",{dataSource:r}),i.unSelectAll(),i.selectItemByIndex(0)},_initUnhideDlg:function(){var e,i,r,l,n,s,o,a=this._id+"_UnhideDlg";e=t.buildTag("div#"+a,"",{display:"none"}),i=t.buildTag("div#"+a+"_sheetContent.e-dlgctndiv e-dlg-fields",t.buildTag("label.e-dlg-fields",this._getLocStr("UnhideDlgText"))),s=t.buildTag("ul#"+a+"_list"),i.append(s),e.append(i),n=t.buildTag("div#"+a+"_btndiv.e-dlg-btnfields"),o=t.buildTag("div.e-dlg-btnctnr"),r=t.buildTag("input#"+a+"_okbtn"),l=t.buildTag("input#"+a+"_cnlbtn"),r.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._unhideBtnClick,this,"ok"),cssClass:"e-ss-okbtn"}),l.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._unhideBtnClick,this,"cancel"),showRoundedCorner:!0,width:"25%"}),n.append(o.append(r,l)),e.append(n),this.element.append(e),e.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("UnhideSheet"),width:280,height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg"}),s.ejListBox({dataSource:this._getSheetNames(),height:"197px",width:"250px",fields:{text:"text",value:"value"}})},_renderUnhideDlg:function(){var t=e("#"+this._id+"_UnhideDlg"),i=e("#"+this._id+"_UnhideDlg_list").data("ejListBox"),r=this._getSheetNames(!1);r.length>0&&(t.ejDialog("open"),i.model.dataSource=r,i.option("fields",{dataSource:r}),i.unselectAll(),i.selectItemByIndex(0))},_moveCopyBtnClick:function(i){switch(i){case"ok":var r,l,n,s,o,a,d=!1,h=2,c=e(this.element).find(".e-currentitem"),u=e("#"+this._id+"_moveCopyDlg_list").data("ejListBox"),g=e("#"+this._id+"_moveCopyDlg_createcopy").data("ejCheckBox"),p=u.getSelectedItems()[0].text,m=u.getIndexByText(p),_=this.model.sheets;if(!g.isChecked()&&p===c.text())return e("#"+this._id+"_moveCopyDlg").ejDialog("close"),void this._setSheetFocus();for(n=1;n<_.length;n++)p===_[n].sheetInfo.text&&(l=n),c.text()===_[n].sheetInfo.text&&(a=n);if(r={reqType:"moveSheet",toSheetIndex:m,fromSheetIndex:a,isCopy:g.isChecked(),type:"actionBegin",action:i},this._trigActionBegin(r))return e("#"+this._id+"_moveCopyDlg").ejDialog("close"),!1;if(m=r.toSheetIndex,a=r.fromSheetIndex,g.isChecked()){for(null===c.text().match(".*[ ]+[(]+[0-9]+[)]$")?o=c.text()+" ("+h+")":-1!==c.text().lastIndexOf(" ")&&(h=parseInt(c.text().substring(c.text().lastIndexOf("(")+1,c.text().lastIndexOf(")"))),o=c.text().substring(0,c.text().lastIndexOf(" "))+" ("+h+")");!d;){for(o=o.substring(0,o.lastIndexOf(" "))+" ("+h+")",n=1,s=_.length;n<s;n++)o===_[n].sheetInfo.text&&h++;h===parseInt(o.substring(o.lastIndexOf("(")+1,o.lastIndexOf(")")))&&(d=!0)}this._copySheet=!0,this._copySheetProcess(a,o),this._copySheet=!1,a=this.model.sheetCount,t.isNullOrUndefined(l)&&(l=a)}else!t.isNullOrUndefined(l)&&l>a&&(l-=1);if(t.isNullOrUndefined(l)&&(l=m),!g.isChecked()&&l===a){e("#"+this._id+"_moveCopyDlg").ejDialog("close"),this._setSheetFocus();break}this._swapSheetDtCntr(a,l),e("#"+this._id+"_moveCopyDlg").ejDialog("close"),l<=a&&(m+=1),this.getPager().ejPager("option",{currentPage:m}),this.gotoPage(m,!1),this._rebindScrollEvnt(),r={reqType:"moveSheet",toSheetIndex:m,fromSheetIndex:a,isCopy:g.isChecked()},this._trigActionComplete(r),g._unChecked(),g._isChecked=!1,this._setSheetFocus();break;case"cancel":e("#"+this._id+"_moveCopyDlg").ejDialog("close")}},_unhideBtnClick:function(t){if("ok"===t){var i=e("#"+this._id+"_UnhideDlg_list").data("ejListBox");this.unhideSheet(i.getSelectedItems()[0].text)}e("#"+this._id+"_UnhideDlg").ejDialog("close")},_swapSheetDtCntr:function(e,t){var i,r,l,n,s=this._dataContainer.sheets,o=this.model.sheets,a=this._sheets,d=this._getLocStr("Sheet"),h=[{}];for(r in s)s.hasOwnProperty(r)&&(h[parseInt(o[r].sheetInfo.value.replace(d,""))]=s[r]);for(o.splice(t,0,o.splice(e,1)[0]),a.splice(t,0,a.splice(e,1)[0]),l=1,n=o.length;l<n;l++)i=parseInt(o[l].sheetInfo.value.replace(d,"")),this._dataContainer.sheets[l]=h[i];this.clearUndoRedo()},_copySheetProcess:function(t,i){var r,l,n,s,o,a,d,h,c,u,g,p,m=this.getPager(),_=m.ejPager("option","totalRecordsCount")+1,f=this.model.sheets;for(this._impData&&this.XLExport._renderAll(),m.ejPager("option",{totalRecordsCount:_,currentPage:_}),f.push(e.extend(!0,{},f[t])),f[f.length-1]._isImported=!1,this._sheetCopy={isSheetCopy:!0,sheetContent:this._getContent(t).find(".e-table").clone(!0).get(0),sheetIndex:t},f[a=this.model.sheetCount+1].sheetInfo.text=i,d=f[a].sheetInfo.value=this._getLocStr("Sheet")+this._newSIndex,this._newSIndex++,this.setActiveSheetIndex(a),this._dataContainer.sheets[a]=e.extend(!0,{},this._dataContainer.sheets[t]),this._sheets[a]={_contentColGroup:null,_content:null,_sheetRowHeaderContent:null,_sheetHeader:null,_sheetRowHeader:null,_sheetContent:null,_Rows:null},this._initSheet(a),this.model.sheetCount++,this._sheetCopy={isSheetCopy:!1,sheetContent:null,sheetIndex:null},this._calcEngine.registerGridAsSheet(d,d,this._calcID),u=f[a].usedRange,n=0;n<=u.rowIndex;n++)for(s=0;s<=u.colIndex;s++)(l=this.XLEdit.getPropertyValue(n,s,"value"))&&this.isFormula(l)&&this.XLEdit._refreshCalcEngine(n,s,!0,l,a);for(h=f[a].shapeMngr.picture,o=this.getObjectLength(h),n=1;n<=o;n++)c=h[this._id+"_picture"+n],this.XLShape._createPicture(a,{rowIndex:c.rowIndex,colIndex:c.colIndex},this.getSheet(a).shapeMngr.sharedPics[c.data],c.top,c.left,c.width,c.height,null,c.bcolor,c.bstyle,c.bwidth);if(!this.model.scrollSettings.allowVirtualScrolling)for(n=0,o=(g=this._getContent(a).find(".e-commentcell")).length;n<o;n++)p=e(g[n]),r=this._getCellIdx(e(".e-commentcell")[0]),p.removeClass("e-commentcell")&&this.XLComment.setComment([r.rowIndex,r.colIndex,r.rowIndex,r.colIndex],null,!1);this.model.allowComments&&this.XLComment._updateCmntArrowPos()},showActivationPanel:function(e){var t,i=this.getActiveSheetIndex(),r=this.getActivationPanel();if(!this.model.enablePivotTable||this._phoneMode)return!1;if(this.isUndefined(e))this._getContent(i).find(".e-ss-activepivot").length&&this.XLPivot._displayActPanel&&(this.model._isActPanelVisible=!0,this._setSheetWidthHeight(i,{width:this._responsiveWidth,height:this._responsiveHeight,isActPanel:!0},null,"refresh"),this._refreshActivationPanel());else if((t=this.getSheet(i).rangeSettings[e]).showPanel){if(this._trigger("beforePanelOpen",{activationPanel:r,range:t,sheetIndex:i}))return!1;this.model._isActPanelVisible=!0,this._setSheetWidthHeight(i,{width:this._responsiveWidth,height:this._responsiveHeight,isActPanel:!0},null,"refresh"),this._refreshActivationPanel()}this.model.showPager&&this._refreshSpreadSheetPager(!0)},_refreshActivationPanel:function(){var e=this.getActivationPanel(),t=this.getMainPanel().height(),i=e.data("ejScroller");e.width(this.model.activationPanelWidth-1).height(t),e.find(".e-ss-pivotfield").hide(),e.find("#"+this._id+"_PivotTableSchema_"+this._getContent(this.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).show(),e.find(".e-ss-pivotfield").width(this.model.activationPanelWidth-20),e.show(),this.getActivationPanel().find("#"+this._id+"_PivotTableSchema_"+this._getContent(this.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).data("ejPivotSchemaDesigner")._reSizeHandler(),i&&(i.option({width:this.model.activationPanelWidth-1,height:t}),i.refresh())},hideActivationPanel:function(){var e=this.getActivationPanel();e.is(":visible")&&(e.find(".e-ss-pivotfield").hide(),this.model._isActPanelVisible=!1,e.hide(),this._isNew||this._setSheetWidthHeight(this.getActiveSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight},null,"refresh"),this.model.showPager&&this._refreshSpreadSheetPager(!0))},_addSheet:function(e){this._sheetSettings(e),this._dataContainer.sheets[e]={},this._initSheet(e),this._newSIndex++,this.model.sheetCount++},addNewSheet:function(){!this.model.allowInsert||this.model.isReadOnly||this.model.isGridMode||this.element.find(".e-pager .e-new").click()},_createFocusElement:function(){this.setFocusTopElem(e("<div class='e-focustop e-hide' ></div>")),this.setFocusRightElem(e("<div class='e-focusright e-hide' ></div>")),this.setFocusBottomElem(e("<div class='e-focusbottom e-hide' ></div>")),this.setFocusLeftElem(e("<div class='e-focusleft e-hide' ></div>"))},_createAutoFillElement:function(){var i,r=this._getJSSheetContent(this.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content");this.model.allowAutoFill&&(i=e("<div class='e-autofill e-hide'></div>"),r.append(i),this.setAutoFillElem(i)),this.element.append(t.buildTag("ul.e-spreadsheet","",{width:"auto"},{id:this._id+"_ctxtmenu"})),i=e("<div class='e-splitspan e-hide' title="+this._getLocStr("AutoFillTitle")+"><button id="+this._id+"_dragfilloptionbtn type='button'></button></div>"),r.append(i),this._setAutoFillOptElem(i),this._initializeSplitButton()},_initializeSplitButton:function(){this._getAutoFillOptElem().find("button").ejSplitButton({size:"normal",contentType:"imageonly",targetID:this._id+"_ctxtmenu",prefixIcon:"e-icon e-ss-autofill",isSeparator:!1,buttonMode:t.ButtonMode.Dropdown,imagePosition:t.ImagePosition.ImageLeft,arrowPosition:t.ArrowPosition.Right,fields:{dataSource:this._fillOptionMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},beforeOpen:e.proxy(this.model.allowAutoFill&&this.XLDragFill._autoFillClick,this),itemSelected:e.proxy(this.model.allowAutoFill&&this.XLDragFill._autoFillOptionClick,this),width:"42px",height:"24px",cssClass:"e-spreadsheet e-autofillbtn"})},_renderFormulaBar:function(t){var i,r,l="<div id="+this._id+"_formulabar class='e-formulabar' ><div id="+this._id+"_indexbox class='e-indexbox' title='"+this._getLocStr("NameBox")+"'></div><div class='e-inputbox' ><input id="+this._id+"_inputbox type='text' title='"+this._getLocStr("FormulaBar")+"'/></div></div>";t?this.model.showRibbon?e("#"+this._id+"_Ribbon").after(l):this.element.prepend(l):this.element.append(l),this._setIndexBox(e("#"+this._id+"_indexbox")),i=e("#"+this._id+"_inputbox"),this._setInputBox(i),this.XLEdit._renderAutoComplete(i,"",26),this._alignFormulaBar(),(r=this.element.find(".e-formulabar").height())>36&&(this._formulaHeight=r),this.model.isReadOnly&&(this.element.find(".e-formulabar")[0].disabled=!0)},_alignFormulaBar:function(e){var t,i,r,l=this.model.scrollSettings;e=e||this._responsiveWidth,this.element.find(".e-formulabar").width(l.isResponsive?e-2:e),i=(e=parseInt(e))-((t=e/10)+24),(r=this.element.find(".e-inputbox")).hide(),r.width(Math.floor(i)),this.element.find(".e-indexbox").width(Math.floor(t)),r.show()},hideFormulaBar:function(){if(e("#"+this._id+"_formulabar").hide(),!this._isInitLoad){this._setSheetWidthHeight(this._getSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight});for(var t=1,i=this.model.sheets.length;t<i;t++)this.getSheet(t)._isResized=t!=this.getActiveSheetIndex()}},showFormulaBar:function(){if(this.model.allowFormulaBar){e("#"+this._id+"_formulabar").show(),this._setSheetWidthHeight(this._getSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight});for(var t=1,i=this.model.sheets.length;t<i;t++)this.getSheet(t)._isResized=t!=this.getActiveSheetIndex();this.updateFormulaBar()}},_getlocaleNumVal:function(e,i){if(e="object"!=typeof e&&Number(e)?Number(e):t.isNullOrUndefined(e)||"object"==typeof e?null:t.parseFloat(e+"",this.model.locale),!t.isNullOrUndefined(e)&&!isNaN(e)&&i){var r=t.preferredCulture(this.model.locale).numberFormat,l=e.toString();"."!=r["."]&&l.indexOf(r["."])<0&&(e=l.replace(".",r["."]))}return e},_getEditValOfDateTime:function(e,i){var r=this.XLEdit.getPropertyValue(e,i,"type"),l=this.getRangeData({range:[e,i,e,i],property:["value","value2"]})[0];return this._isDateTime(l.value)?"longdate"==r||"date"==r?-1==["12:00:00 AM","0:00:00"].indexOf(l.value.toLocaleTimeString())?this.formatting("{0:"+t.preferredCulture(this.model.locale).calendar.patterns.dT+"}",l.value,this.model.locale):this.formatting("{0:"+t.preferredCulture(this.model.locale).calendar.patterns.d+"}",l.value,this.model.locale):"1/1/1990"!=l.value.toLocaleDateString()&&-1==["12:00:00 AM","0:00:00"].indexOf(l.value.toLocaleTimeString())||"time"==r&&"1/1/1990"!=l.value.toLocaleDateString()?this.formatting("{0:"+t.preferredCulture(this.model.locale).calendar.patterns.dT+"}",l.value,this.model.locale):l.value2:l.value2},updateFormulaBar:function(){if(this.model.allowFormulaBar){var i,r,l,n,s,o,a,d=this.getActiveSheetIndex(),h=this.getSheet(d)._activeCell,c=this._getContent(d).find(".e-ss-activeimg")[0];r=this.getRangeData({range:[h.rowIndex,h.colIndex,h.rowIndex,h.colIndex],property:["value","value2","isLocked"]})[0],t.isNullOrUndefined(r)?i="":(i=t.isNullOrUndefined(r.value)?"":r.value,o=this.XLEdit.getPropertyValue(h.rowIndex,h.colIndex,"hasFormulaArray"),a=this.XLEdit.getPropertyValue(h.rowIndex,h.colIndex,"hasMultipleFormulaArray"),(!this.XLEdit._isEdit&&(o||a)||this._formulaArray)&&(i="{"+i+"}")),this._isDateTime(i)&&(i=this._getEditValOfDateTime(h.rowIndex,h.colIndex)),"en-US"!==this.model.locale&&this.isNumber(i)&&(n=t.preferredCulture(this.model.locale).numberFormat,s=new RegExp("\\"+n[","]+"\\d{3}"),i+="","."==n[","]&&(s.test(i)||r.value!=r.value2)&&(i=this._getlocaleNumVal(i,!0))),"percentage"===this.XLEdit.getPropertyValue(h.rowIndex,h.colIndex,"type")&&(i=this.isFormula(r.value)?r.value:r.value2,(!this.XLEdit._isEdit&&(o||a)||this._formulaArray)&&(i="{"+i+"}")),this._getInputBox().val(i),this.XLEdit.getPropertyValue(h.rowIndex,h.colIndex,"isReadOnly")||this.model.allowLockCell&&this.getSheet(d).isSheetProtected&&r.isLocked?this._getInputBox().attr("readonly","readonly"):this._getInputBox().prop("readonly",!1),l=c&&(c.id.indexOf(this._id+"_picture")>-1||c.id.indexOf(this._id+"_chart")>-1)?c.id.replace(e(c).data("parentID")+"_",""):this._generateHeaderText(h.colIndex+1)+(h.rowIndex+1),this._getIndexBox().html(l)}},_initSelection:function(){var e,i=this.model,r=this.getActiveSheetIndex(),l=this.getSheet(r),n=this._getJSSheetContent(r).find(".e-spreadsheetcontentcontainer > .e-content"),s=i.selectionSettings.selectionType,o=t.Spreadsheet.SelectionType,a=i.selectionSettings.activeCell;i.allowSelection&&(this.getFocusTopElem()||this._createFocusElement(),n.append(this.getFocusTopElem(),this.getFocusRightElem(),this.getFocusBottomElem(),this.getFocusLeftElem()),a&&(e=this.getRangeIndices(a),!this.isRange(e)&&e[0]<l.rowCount&&e[1]<l.colCount&&(l._startCell=l._endCell=l._activeCell={rowIndex:e[0],colIndex:e[1]})),l._isImported&&!l._isLoaded||!l._selectedCells.length?(this.XLSelection._processBoundary(),s===o.Row||l._isRowSelected?this.XLSelection.selectRows(l._startCell.rowIndex,l._endCell.rowIndex):s===o.Column||l._isColSelected?this.XLSelection.selectColumns(l._startCell.colIndex,l._endCell.colIndex):this.XLSelection.selectRange(l._startCell,l._endCell)):(this.XLSelection.selectRange(l._selectedCells[0],l._selectedCells[l._selectedCells.length-1]),this.XLSelection._refreshBorder())),i.allowAutoFill&&(this.getAutoFillElem()||this._createAutoFillElement(),this.getAutoFillElem().appendTo(n),this.XLDragFill.positionAutoFillElement(),i.autoFillSettings.showFillOptions&&i.allowAutoFill&&(this._getAutoFillOptElem().appendTo(n),this.XLDragFill.hideAutoFillOptions())),i.allowSelection&&l._isFreezed&&this.XLFreeze._refreshSelection()},_updateRibbonTab:function(t){var i,r,l=this.getActiveSheetIndex(),n=e("#"+this._id+"_Ribbon").data("ejRibbon"),s=this.XLRibbon,o=this.element.find(".e-ribbon .e-contextual a:visible"),a=o.length,d=n.element.find("#"+this._id+"_Ribbon_togglebutton");if(t&&(r=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"tableName",l)),a)for(;a--;)n.hideTab(o[a].text);s._toggleAnalyzeTab(),d.is(":visible")&&d.hasClass("e-ribbonpin")&&this._refreshSheetonResize(),(i=this._getContent(l).find(".e-ss-activeimg")).length?i[0].id.indexOf("chart")>-1?this.XLRibbon._chartDesignTabUpdate(i):this.XLRibbon._formatTabUpdate():r?s._designTabUpdate(this._getTableID(r),t):this._getContent(l).find(".e-ss-activepivot").length&&(s._analyzeTabUpdate(),this.XLSelection._cleanUp(!0),this.getActivationPanel().find("#"+this._id+"_PivotTableSchema_"+this._getContent(l).find(".e-ss-activepivot")[0].id).show(),this.showActivationPanel())},_updateCellType:function(){var e,i=t.Spreadsheet.CellType;for(e in i)this._dataContainer.cellType.push(i[e])},_updateFormulaCollection:function(){var e,t=this._calcEngine.getLibraryFunctions(),i=[];for(e in t.items)i.push({text:"="+e,display:e});this._formulaCollection=i},_renderScroller:function(e,t,i){this.XLScroll._createScroller(e,t,i),this._refreshScrollerEvent(e)},_refreshScrollerEvent:function(i){this._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").scroll(t.proxy(function(t){var i=this.getActiveSheetIndex(),r=this.getSheet(i),l=this._isFrozen(this.getFrozenColumns(i))?e(t.target).scrollLeft():r._scrollLeft;this._getJSSheetHeader(i).find(".e-headercontent").scrollLeft(l),this._getJSSheetRowHeaderContent(i).scrollTop(e(t.currentTarget).scrollTop())},this)),this.element.find("#"+this._id+"_"+this.model.sheets[i].sheetInfo.value).find(".e-headercontent").scroll(t.proxy(function(t){var i=this.getActiveSheetIndex(),r=this._isFrozen(this.getFrozenColumns(i))?e(t.target).scrollLeft():this.getSheet(i)._scrollLeft;this._getContent(i).find(".e-content").scrollLeft(r),this.getSheet(i)._scrollLeft=this._getContent(i).find(".e-content").scrollLeft()},this))},_clickHandler:function(i){if(this.XLEdit._isFEdit=!1,this._hasClass(i.target,"e-ssfilter"))this._excelFilter._openedFltr&&e(this._excelFilter._openedFltr).is(":visible")?this._excelFilter.closeXFDialog():this.XLFilter._filterClickHandler(i);else{if("TD"===i.target.tagName&&e(i.target).parents("div")[0].className.indexOf("e-content")>-1&&i.target.className.indexOf("e-rowcell")>-1&&e(i.target).find(".e-chk-image").length<1&&(this._clkCellObj=this._getCellIdx(i.target)),("svg"===i.target.localName||"path"===i.target.localName||"rect"===i.target.localName||"circle"===i.target.localName||"div"===i.target.localName&&i.target.className.indexOf("e-sparkline")>-1)&&(this._clkCellObj=this._getCellIdx(e(i.target).closest("td")[0])),"DIV"===i.target.tagName&&i.target.id.indexOf("_Merge")>-1&&(this._clkCellObj=this._getCellIdx(i.target.parentElement)),this._isExport||!this.model.cellClick)return!1;var r,l,n,s,o=i.target,a=this.getActiveSheetIndex();if("TD"===i.target.tagName&&e(i.target).parents("div")[0].className.indexOf("e-content")>-1&&i.target.className.indexOf("e-rowcell")>-1&&e(i.target).find(".e-chk-image").length<1){if(l=o.cellIndex,n=e.inArray(e(o).closest("tr").get(0),this.getRows(a)[1]),r={columnName:(s=this.getSheet(a).columns[l]).field,value:this.XLEdit.getPropertyValue(n,l),columnIndex:l,rowIndex:n,columnObject:s,cell:o,eventArgs:i,event:i,target:i.target},this.isFormula(r.value)&&(r.calcValue=this.XLEdit.getPropertyValue(n,l,"calcValue")),this._trigger("cellClick",r))return!1}else if(!t.isNullOrUndefined(e(i.target).parents("div"))&&e(i.target).parents("div")[0].className.indexOf("e-content")>-1&&(i.target.className.indexOf("e-rowcell")>-1||i.target.parentElement.className.indexOf("e-rowcell")>-1)&&e(i.target).find(".e-chk-image").length<1&&(o=e(i.target).parents("td").get(0),!t.isNullOrUndefined(o)&&(l=o.cellIndex,n=e.inArray(e(o).closest("tr").get(0),this.getRows(a)[1]),r={columnName:(s=this.getSheet(a).columns[l]).field,value:this.XLEdit.getPropertyValue(n,l),columnIndex:l,rowIndex:n,columnObject:s,cell:o,eventArgs:i,event:i,target:i.target},this.isFormula(r.value)&&(r.calcValue=this.XLEdit.getPropertyValue(n,l,"calcValue")),this._trigger("cellClick",r))))return!1}},_wireEvents:function(t){var i=this.element,r=this._id;this.model.enableTouch&&"_on"==t&&parseInt(this._browserDetails.version)>8?this._wireTouchEvts("_on"):this._wireTouchEvts("_off"),this[t](i,"mousedown",".e-spreadsheetcontentcontainer .e-content, .e-spreadsheetrowheader, .e-spreadsheetheader, .e-spreadsheetactpanel, .e-ribbon, .e-spreadsheetcontentcontainer .e-vscroll, .e-spreadsheetcontentcontainer .e-hscroll",this._mouseDownHandler),this[t](i,"mousemove",this._mouseMoveHandler),this[t](i,"mouseup",this._mouseUpHandler),this[t](i,"keydown",this._keyDownHandler),this[t](i,"keyup",this._keyUpHandler),this[t](i,"click",".e-spreadsheetcontentcontainer .e-content,.e-spreadsheetrowheader,.e-spreadsheetheader,.e-spreadsheetactpanel, .e-ss-object, .e-ss-sparkline",this._clickHandler),this[t](i,e.isFunction(e.fn.doubletap)&&this.model.enableTouch&&parseInt(this._browserDetails.version)>8&&!this._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",".e-spreadsheetcontentcontainer, .e-spreadsheetheader, .e-spreadsheetrowheader, .e-numericcontainer .e-numericitem, .e-ss-sparkline",this._dblClickHandler),this[t](i,"mouseleave",".e-spreadsheetrowheader, .e-spreadsheetheader, .e-viewhdrlbl, .e-vheading, .e-viewlinlbl, .e-vgridlines",this._mouseLeaveHandler),this[t](i,"mouseover",".e-spreadsheetcontentcontainer .e-content .e-rowcell, .e-viewhdrlbl, .e-vheading, .e-viewlinlbl, .e-vgridlines, .e-rowheadercontent, .e-vscrollbar, .e-hscrollbar, .e-spreadsheetfooter, .e-spreadsheetheader",this._mouseHoverHandler),this.model.allowFormulaBar&&this.XLEdit&&this[t](this._getInputBox(),"input",this.XLEdit._formulaBoxInputChange),this[t](e(".e-ss-"+r+".e-chartcell"),"click",this._chartClickHandler),this[t](e("#"+r+"_cellstyles"),"click",this._cellStyleClick),this[t](e("#"+r+"_formatastable"),"click",this._formatAsTableClick),this[t](e("#"+r+"_nmuseinformula"),"click",".e-nmuseinformularow",this._useInFormulaClick),this[t](e("#"+r+"_AddSheet"),"click",this._spreadsheetPagerCustomBtnHandler),this.model.scrollSettings.allowScrolling&&this.XLScroll&&this[t](this.element.find(".e-spreadsheet-list"),"mousewheel DOMMouseScroll",e.proxy(this.XLScroll._spreadMouseWheel,this.XLScroll)),this.model.scrollSettings.isResponsive&&this[t](e(window),"resize",e.proxy(this._resizeHandler,this))},_wireTouchEvts:function(e){("msie"!=this._browserDetails.name||-1===["11.0","10.0"].indexOf(this._browserDetails.version))&&this[e](this.element,this._getBrowserEvt(),".e-spreadsheetcontentcontainer .e-content, .e-spreadsheetrowheader, .e-spreadsheetheader, .e-spreadsheetactpanel, .e-ribbon, .e-spreadsheetcontentcontainer .e-vscroll, .e-spreadsheetcontentcontainer .e-hscroll",this._mouseDownHandler),this[e](this.element,this._getBrowserEvt("move"),this._mouseMoveHandler),this[e](this.element,this._getBrowserEvt("end"),this._mouseUpHandler),this[e](this.element,"swipeleft swiperight",".e-spreadsheetfooter",this._swipeHandler)},_getBrowserEvt:function(e,t){return"move"===e?this._browserDetails.isMSPointerEnabled?this._browserDetails.pointerEnabled?"pointermove":"MSPointerMove":t?"mousemove":"touchmove":"end"===e?this._browserDetails.isMSPointerEnabled?this._browserDetails.pointerEnabled?"pointerup":"MSPointerUp":t?"mouseup":"touchend":this._browserDetails.isMSPointerEnabled?this._browserDetails.pointerEnabled?"pointerdown":"MSPointerDown":"touchstart"},_swipeHandler:function(e){var t=this.getActiveSheetIndex();this.gotoPage("swiperight"===e.type?--t:++t)},_isTouchEvent:function(e){return!(!this.model.enableTouch||!(e.type.indexOf("touch")>-1||e.type.indexOf("pointer")>-1)||"mouse"===e.originalEvent.pointerType||4===e.originalEvent.pointerType)},_getOriginalEvt:function(e){return e.originalEvent.changedTouches?e.originalEvent.changedTouches[0]:e.originalEvent},_allChartType:function(t){e("#"+this._id+"_allchart").find(".e-chartimg").removeClass("e-chartselect"),e(t.target).addClass("e-chartselect")},refreshSpreadsheet:function(){this._responsiveHeight>350&&(this._refreshSheetonResize(),this.model.showRibbon&&e("#"+this._id+"_Ribbon").data("ejRibbon")._ribbonResize())},refresh:function(){this._isRefresh=!0,this._destroy();for(var e=1;e<=this.model.sheetCount;e++)this.model.sheets[e]._isLoaded=!1;this.addClass(this.element[0],this._rootCSS+" e-js"),this._init(),this._isRefresh=!1},_resizeHandler:function(){var e,t=this;t.element.is(":hidden")||(e&&clearTimeout(e),e=setTimeout(function(){t._refreshSheetonResize();for(var e=1,i=t.model.sheets.length;e<i;e++)t.getSheet(e)._isResized=e!=t.getActiveSheetIndex()},100))},_refreshSheetonResize:function(){var i,r,l,n,s,o,a,d,h,c,u,g=this.getActiveSheetIndex(),p=e(".e-ddl-popup:visible[id^="+this._id+"]"),m=e("#"+this._id+"_inputbox_suggestion"),_=this._phoneMode,f=e(".e-ss-colorpicker:visible[id^="+this._id+"]"),b=e(".e-menu:visible[id^="+this._id+"]");if(this._resizeColl[g-1]=this._isResized=!0,this.element.find(".e-inputbox").hide(),t.isNullOrUndefined(this._getFormulaSuggElem())||(this._isFormulaSuggestion=!1,this._getFormulaSuggElem().hide()),t.isNullOrUndefined(m[0])||"block"!=m[0].style.display||(this._isFormulaSuggestion=!1,m.hide()),this.model.enablePivotTable&&this.hideActivationPanel(),this._phoneMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth<420,this._tabMode=this.model.scrollSettings.isResponsive&&document.documentElement.clientWidth>419&&document.documentElement.clientWidth<617,l={width:this._responsiveWidth,height:this._responsiveHeight},this.model.showRibbon&&(this._tabMode||this._responsiveHeight<280)&&e("#"+this._id+"_Ribbon").ejRibbon("collapse"),this.getSheet(g)._virtualRowIdx=[],this._refreshSheetWithScreen(g),this._updateResponsiveSettings(),this._initViewPort(g),this.refreshContent(g),l.width=this._responsiveWidth,l.height=this._responsiveHeight,this._setSheetWidthHeight(g,l,null,"refresh"),i=this._getContTBody(g).find("tr"),r=this._getRowHdrTBody(g).find("tr"),this.setRows([r,i],g),this._dlgWidth=this._phoneMode||this._tabMode||this._responsiveWidth<350?this._responsiveWidth-2:this._responsiveWidth/1.5,this._dlgHeight=this._phoneMode||this._tabMode||this._responsiveHeight<350?this._responsiveHeight-2:this._responsiveHeight/1.2,this.model._isActPanelVisible&&this._refreshActivationPanel(),this.element.find(".e-inputbox").show(),this.model.showPager&&(this._isSheetRename&&(a=(o=this.getPager().find("#"+this._id+"_Sheet_RenamePanel")).val(),o.remove()),this._refreshSpreadSheetPager(!0),this._isSheetRename&&this._renameSheet(a)),this._phoneMode&&(e("#"+this._id+"_CFormat").css("width",""),e("#"+this._id+"_Ribbon_Border").css("width",""),e("#"+this._id+"_indexbox").css({"text-overflow":"ellipsis",overflow:"hidden"})),this.model.showRibbon&&(this.XLRibbon._refreshBackstageHeight(),this._phoneMode&&!_&&this.XLRibbon._hideRibbonElem()),p.length&&((n=p[0].id.split("_",5).join("_")).length&&((s=e("#"+n)).hasClass("e-dropdownlist")&&s.ejDropDownList("hidePopup"))),b.length&&((n=b[0].id.split("_",5).join("_")).length&&((s=e("#"+n)).hasClass("e-split")&&s.hide())),f.length&&((n=f[0].id.split("_",5).join("_")).length&&((s=e("#"+n)).hasClass("e-colorpicker")&&s.ejColorPicker("hide"))),this._isResized=!1,this._isRibbonDestroyed){if(d=e("#"+this._id+"_Ribbon").ejRibbon("instance"),this.model.ribbonSettings.enableOnDemand)this.XLRibbon._createTabControls(d.getTabText(d.model.selectedItemIndex));else if(this.model.showRibbon)for(c=0,u=(h=[this._getLocStr("HOME"),this._getLocStr("DATATAB"),this._getLocStr("PAGELAYOUT"),this._getLocStr("OTHERS")]).length;c<u;c++)this.XLRibbon._updateRibCustomCss(h[c]);this._on(e(".e-ss-"+this._id+".e-chartcell"),"click",this._chartClickHandler),this._on(e("#"+this._id+"_cellstyles"),"click",this._cellStyleClick),this._on(e("#"+this._id+"_formatastable"),"click",this._formatAsTableClick)}this._isRibbonDestroyed=!1,this._trigger("refresh")},_chartClickHandler:function(t){var i=e(t.target),r=e.extend(!0,{},e(t.target).data());i.parents().eq(1).hide(),this.XLChart.createChart(null,r)},_useInFormulaClick:function(t){var i,r,l,n=!1,s=t.target.textContent,o=this.getActiveSheetIndex(),a=this.getActiveCell(o),d=this.XLEdit._editElem,h=d.text();if(l=this.XLEdit.getPropertyValue(a.rowIndex,a.colIndex,"mergeIdx"),this._intrnlReq=!0,this.XLEdit.editCell(l?l.rowIndex:a.rowIndex,l?l.colIndex:a.colIndex,!0),this._intrnlReq=!1,"="===h)d.text("="+s);else{if(i=(r=this.XLDragFill._parseFormula(h)).length){for(;i--;){if(","===r[i]||"("===r[i]){r.splice(i+1,0,s),n=!0;break}if(this._isCellReference(r[i])||this.isNumber(r[i])){r[i]=s,n=!0;break}}s=n?r.join(""):s}d.text("="+s)}d.focusEnd(),e("#"+this._id+"_nmuseinformula").hide()},_formatAsTableClick:function(t){var i,r,l=t.target,n=this.getActiveSheetIndex(),s=this.getSheet(n)._selectedCells;0!==s.length&&("e-formatastablecell"===l.parentNode.className&&(i=this.XLEdit.getPropertyValue(s[0].rowIndex,s[0].colIndex,"tableName",n),this._showDialog(this._id+"_Ribbon_Insert_Tables_Table"),i?(this.XLFormat._formatAsTableStyle=this._FATStyles[l.parentNode.id.replace(/ /g,"")],this.XLFormat._createTable(this._getTableID(i),this.XLFormat._formatAsTableStyle)):s.length>1?(r=e("#"+this._id+"_fatname"),e("#"+this._id+"_fatnamedlg").ejDialog("open"),e("#"+this._id+"_fatheader").data("ejCheckBox").option("checked",!1),r.val("Table"+this._tableCnt).focus().setInputPos(r.val().length),this.model.allowCellFormatting&&(this.XLFormat._formatAsTableStyle=this._FATStyles[l.parentNode.id.replace(/ /g,"")])):this._showAlertDlg("Alert","FormatAsTableAlert",null,445)),(l.className.indexOf("back")>-1||"e-formatastablecell"===l.parentNode.className)&&e("#"+this._id+"_Ribbon_Home_Styles_FormatAsTable").length&&e("#"+this._id+"_Ribbon_Home_Styles_FormatAsTable").data("ejSplitButton")._hidePopup())},_borderSelectionClick:function(t){var i,r,l={ID:t.target.parentNode.id},n=t.target,s=this.getActiveSheetIndex(),o=this.getSheet(s)._selectedCells;0!==o.length&&(this._borderStyles.indexOf(l.ID)>-1&&this.XLRibbon._updateBordeStyle(l),i=this._borderColor||"#000000",r=this._getAlphaRange(s,o[0].rowIndex,o[0].colIndex,o[o.length-1].rowIndex,o[o.length-1].colIndex),this.model.allowSelection&&(this.XLSelection._isOutsideBordering||this.XLSelection._isGridBordering)?!(this._borderStyles.indexOf(l.ID)>-1)&&l.ID.indexOf("bordercolor")<0&&(this.XLSelection._isOutsideBordering=this.XLSelection._isGridBordering=!1):this.setBorder({type:l.ID,color:i,style:this._borderStyle},r),(n.className.indexOf("back")>-1||"e-bordercell"===n.parentNode.className)&&e("#"+this._id+"_bordercontainer").hide())},_getTableID:function(e,t){var i,r=this.getSheet(this.getActiveSheetIndex()).tableManager;if(t){for(i in r)if(t===r[i].name)return Number(i)}else for(i in r)if(e.indexOf("e-table"+i)>-1)return Number(i)},_cellStyleClick:function(i){var r,l,n=this.model.sheets[this.getActiveSheetIndex()].selectedRange,s=i.target.className,o=i.target.innerHTML,a=this.XLFormat.getFormatClass(s),d=this._dataContainer,h={range:n,sheetIdx:this.getActiveSheetIndex(),reqType:"cell-styles",type:"actionBegin",action:i.target.innerHTML};this._trigActionBegin(h)||(r={range:n=h.range,sheetIndex:this.getActiveSheetIndex(),reqType:"cell-styles",opr:i.target.innerHTML,beforeFormat:this.getRangeData({range:n,property:["format","formats"]})},s.indexOf("e-cellstylecell")>-1&&t.isNullOrUndefined(d.customCellStyle[o])&&this.XLFormat.updateUniqueFormat(a,n,i.target.innerHTML),s.indexOf("e-cellstylecell")>-1&&!t.isNullOrUndefined(d.customCellStyle[o])&&(l={style:d.customCellStyle[o].style},e.extend(l,d.customCellStyle[o].NumFormat),this.XLFormat.format(l)),s.indexOf("e-cellstylecell")>-1&&o===this._getLocStr("NewCellStyle")&&this._showDialog(this._id+"_CustomCellDialog"),(s.indexOf("e-cellstylecell")>-1||s.indexOf("back")>-1)&&e("#"+this._id+"_Ribbon_Home_Styles_CellStyles").length&&e("#"+this._id+"_Ribbon_Home_Styles_CellStyles").data("ejSplitButton")._hidePopup(),r.afterFormat=this.getRangeData({range:n,property:["format","formats"]}),this.isUndoRedo||(this._completeAction(r),this._trigActionComplete(r)),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons())},_mouseHoverHandler:function(t){var i,r=t.target;"svg"!=t.target.localName&&"rect"!==t.target.localName&&"path"!==t.target.localName&&(this._hasClass(t.target,"e-viewhdrlbl")||this._hasClass(t.target,"e-vheading")?this.element.find(".e-vheading .e-chk-act, .e-vheading .e-chk-inact").addClass("e-chkhover"):this._hasClass(t.target,"e-viewlinlbl")||this._hasClass(t.target,"e-vgridlines")?this.element.find(".e-vgridlines .e-chk-act, .e-vgridlines .e-chk-inact").addClass("e-chkhover"):this.model.allowDragAndDrop&&this.XLDragDrop._allowDragAndDrop&&(e(t.target).parents(".e-vscrollbar").length>0||t.target.className.indexOf("e-rowheader")>-1||e(t.target).parents(".e-spreadsheetfooter").length>0||t.target.className.indexOf("e-headercell")>-1||t.target.className.indexOf("e-spreadsheetfooter")>-1||e(t.target).parents(".e-hscrollbar").length>0||this.getSheet()._isFreezed&&t.target.className.indexOf("e-rowcell")>-1)?this.XLDragDrop._scrollHover(t):this._hasClass(t.target,"e-rowcell")&&(i=this._getCellIdx(r),this._trigger("cellHover",{target:r,event:t,cellIndex:i})))},_mouseDownHandler:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=!0,S="e-ss-sparkline",x="e-ss-object",v="e-ss-pivot",w=i.target,I=e(w),y=this.getActiveSheetIndex(),T=this.getSheet(y),L=e("#"+this._id+"_Ribbon").data("ejRibbon");if(i.currentTarget.className.indexOf("e-ribbon")<0&&this.element.find(".e-bordercontainer").hide(),this.element.find("#"+this._id+"ddl_popup").has(w).length)return!1;if(this._isTouchEvt=this._isTouchEvent(i),this._isTouchEvt&&(this._touchArgs=i,this._startXY=this._setXY(i,navigator.userAgent.indexOf("WebKit")>-1),this.model.allowDragAndDrop&&this.XLDragDrop._dragtouch(this._startXY[0],this._startXY[1]),!this._hasClass(w,"e-autofill")&&this.model.allowAutoFill&&(n=this._hasClass(w,"e-headercell")?10:20,l=(r=this._setXY(i))[1],r=r[0],r=Math.abs(r-this.getAutoFillElem().offset().left),l=Math.abs(l-this.getAutoFillElem().offset().top),r<=n&&r>=0&&l<=n&&l>=0&&(I=this.getAutoFillElem(),w=i.target=I[0]))),I.parents(".e-ribbon").length||I.parents(".e-vscroll").length||I.parents(".e-hscroll").length)this._excelFilter&&(this.XLFilter._isSearchEdit=!1,this._excelFilter.closeXFDialog());else if(this._hasClass(w,"e-ssddl"))this._ddlopen(i);else{if(i.target=this._changeTargetWithOffset(i),this.model.allowCharts&&T._isChartBorderDrawn&&this.XLChart._clearChartRange(this._arrayAsString(this._chartBorder)),this.model.allowSparkline&&T._isSparklineBorder&&this.XLSparkline._clearSparkline(this._arrayAsString(this._chartBorder)),(this.model.pictureSettings.allowPictures||this.model.allowCharts)&&(I.hasClass(x)||e(I).parents("."+x).length))I.hasClass(x)||(w=i.target=e(I).parents("."+x)[0]),this.XLShape._shapeMouseDown(i);else if(this.model.allowSparkline&&(I.hasClass(S)||e(I).parents("."+S).length))for(I.hasClass(S)||(C=!1),("svg"==w.localName||"rect"==w.localName||"path"==w.localName)&&(this.sparkDiv=e(I).parents("."+S)[0]||I[0]),g=this._getCellIdx(e(this.sparkDiv).closest("td")[0]),this.model.showRibbon&&this.model.allowSparkline&&(this.sparkDiv.id.indexOf("Line")>-1||this.sparkDiv.id.indexOf("Area")>-1||this.sparkDiv.id.indexOf("Pie")>-1||this.sparkDiv.id.indexOf("Column")>-1||this.sparkDiv.id.indexOf("Winloss")>-1)?this.XLSparkline._sparklineDesignTabUpdate(this.sparkDiv.id):this.model.showRibbon&&this.model.allowSparkline&&(L.model.selectedItemIndex===this.XLRibbon._getTabIndex("sparklinedesign")||L.isVisible(this._getLocStr("SPARKLINEDESIGN")))&&this.XLSparkline._toggleSparklineDesignTab(),w=i.target=this.sparkDiv,this.performSelection({rowIndex:g.rowIndex,colIndex:g.colIndex},{rowIndex:g.rowIndex,colIndex:g.colIndex}),this.XLShape._shapeType="sparkline",S=this.getSheet(this.getActiveSheetIndex()).shapeMngr.sparkline,f=0,b=(p=this.getObjectKeys(S)).length;f<b;f++)p[f]==w.id&&(_=S[p[f]],m=this.getRangeIndices(_.DataRange),this.XLSelection._focusBorder({rowIndex:m[0],colIndex:m[1]},{rowIndex:m[2],colIndex:m[3]},["e-bcborderright","e-bcborderbottom"]),this.getSheet(this.getActiveSheetIndex())._isSparklineBorder=!0);else C=!1,this.XLShape._shapeROStart&&this.XLShape._shapeRSStart||this._getContent(y).find(".e-ss-activeimg").removeClass("e-ss-activeimg e-ss-imgcresize e-ss-imgrresize");if(("TD"===w.nodeName||"TH"===w.nodeName)&&(this.XLRibbon._isPanelVisible=!1),this.model.enablePivotTable&&(this._isPvtNameEdit&&(this._isPvtNameEdit=!1,this.XLPivot._changePvtName()),I.hasClass(v)||I.parents("."+v).length?(I.hasClass(v)||(w=i.target=I.parents("."+v)[0]),this.XLPivot._pivotMouseDown(i)):I.parents(".e-ss-pivotfield").length||I.hasClass("e-ss-pivotfield")||I.hasClass("e-vhandle")||I.hasClass("e-hhandle")||"col-resize"===I.css("cursor")||(this.hideActivationPanel(),this.getSheetElement(y).find(".e-ss-activepivot").removeClass("e-ss-activepivot"))),h=w.className,-1===w.id.indexOf("picture")&&this.model.showRibbon&&(L.model.selectedItemIndex===this.XLRibbon._getTabIndex("format")||L.isVisible(this._getLocStr("FORMAT")))&&this.XLRibbon._toggleFormatTab(),this.model.showRibbon&&w.id.indexOf("chart")>-1?this.XLRibbon._chartDesignTabUpdate(e(w)):this.model.showRibbon&&(L.model.selectedItemIndex===this.XLRibbon._getTabIndex("cdesign")||L.isVisible(this._getLocStr("CHARTDESIGN")))&&this.XLRibbon._toggleChartDesignTab(),this.model.showRibbon&&this.model.allowSparkline&&(w.id.indexOf("Line")>-1||w.id.indexOf("Area")>-1||w.id.indexOf("Pie")>-1||w.id.indexOf("Column")>-1||w.id.indexOf("Winloss")>-1)?this.XLSparkline._sparklineDesignTabUpdate(this.sparkDiv.id):this.model.showRibbon&&this.model.allowSparkline&&(L.model.selectedItemIndex===this.XLRibbon._getTabIndex("sparklinedesign")||L.isVisible(this._getLocStr("SPARKLINEDESIGN")))&&this.XLSparkline._toggleSparklineDesignTab(),this.XLEdit._isEdit&&"TD"!=w.nodeName&&!this._hasClass(w,"e-autofill"))return;if(this.model.allowDragAndDrop&&this.XLDragDrop._isDragAndDropStart&&"e-autofill"!==h&&h.indexOf("e-filterspan")<0&&this.XLDragDrop._dMouseDown(i),this.model.allowResizing&&!this.XLEdit._isEdit&&(e(w).hasClass("e-headercelldiv")||e(w).hasClass("e-headercell")?this.XLResize._headerMouseDown(i):e(w).hasClass("e-rowheader")?this.XLResize._rowMouseDown(i):(e(w).hasClass("e-spreadsheetactpanel")||e(w).parents(".e-spreadsheetactpanel").length)&&this.XLResize._apMouseDown(i)),e(w).parents("div.e-spreadsheetactpanel").length>0)return;if(this.model.allowEditing&&this.XLEdit._isEdit&&"="===this.XLEdit._editElem.html()&&(this._isFormulaSuggestion=!1,this.XLEdit._isFormulaEdit=!0),!(!this.XLEdit._isEdit||(this._isFormulaSuggestion||!this.XLEdit._isFormulaEdit)&&this.XLEdit.saveCell())&&!this.XLEdit._isFormulaEdit)return!1;this.model.allowComments&&!I.hasClass("e-pager")&&this.getSheetElement(y).find(".e-commentcell").length&&this.XLComment._commentMouseDownHandler(i),"SPAN"!==w.tagName&&"A"!==w.tagName||t.isNullOrUndefined(I.parent("td")[0])?"TD"===w.tagName&&this._hasClass(w,"e-rowcell")?(a=w,o=this._getCellIdx(a),this.model.showRibbon&&this.XLRibbon.updateRibbonIcons()):o=this.getActiveCell():(a=I.parent("td")[0],o=this._getCellIdx(a)),"A"===w.tagName?(T._activeCell=o,this.model.allowSelection&&(this.XLSelection.selectRange(o,o),this.XLDragFill&&this.XLDragFill.positionAutoFillElement()),3!==i.which&&this._hlClick(this.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"hyperlink",y))):(2!==i.button||3!==i.which||-1===this.getSheetElement(y).find(".e-selected, .e-colselected .e-headercelldiv, .e-rowselected").index(w))&&this.model.allowSelection&&!C&&(t.isNullOrUndefined(this.XLDragDrop)||!this.XLDragDrop._allowDragAndDrop)&&(this.XLResize&&this.XLResize._resizeStart||I.hasClass("e-comment-txtarea")||I.hasClass(v)||e(I).parents("."+v).length||this.XLSelection._selectionMouseDownHandler(i)),this._filterClose(i.target),this._undoInputobj={},"TD"!==w.tagName||t.isNullOrUndefined(e(w).parents("div")[0])||"e-content"!==e(w).parents("div")[0].className||this.displayActivationPanel(this.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"range")),"TD"===w.tagName&&w.className.indexOf("e-rowheader")<0&&(t.isNullOrUndefined(this._ddlCell)||(this.element.find("#"+this._id+"ddl").ejDropDownList("hidePopup"),this.element.find("#"+this._id+"ddlspan").remove(),this._ddlCell=null)),"TD"===w.tagName&&this._hasClass(w,"e-rowcell")&&(u=this._getCellIdx(w),t.isNullOrUndefined(this.XLEdit.getPropertyValue(u.rowIndex,u.colIndex,"rule",y))||this._setddlCell(i)),this.model.showRibbon&&this.model.allowSparkline&&w.id.indexOf("sparkline")>-1&&this.XLSparkline._sparklineDesignTabUpdate(this.sparkDiv.id),this._isTableRename&&(this.XLFormat._renameTable(this._tableClassName),this._isTableRename=!1),this._isSheetRename&&this._updateSheetNames(null,!1),this.element.find("#"+this._id+"ddl").ejDropDownList("hidePopup"),this._hasClass(w,"e-rowcell")&&(c=this.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"tableName",y)),c?(s=this._getTableID(c),this.isNumber(s)&&this.XLRibbon._designTabUpdate(s,o)):this.model.showRibbon&&(L.model.selectedItemIndex===this.XLRibbon._getTabIndex("design")||L.isVisible(this._getLocStr("Design")))&&this.XLRibbon._toggleDesignTab(o),this.model.allowEditing&&(a=T._activeCell,this.XLEdit._isEdit&&i.target.id!==this._id+"_inputbox"&&((d=e(i.target).hasClass("e-ss-input")||!this.XLEdit._isFBarFocused?this.element.find("#"+this._id+"_Edit"):this._getInputBox())&&(i.target.id!==d[0].id&&d.focus().setInputPos(d[0].selectionStart,d[0].selectionEnd),d.hasClass("e-ss-input")&&(this.XLEdit._isFBarFocused=!1))),this.model.allowComments&&this.XLComment._isCommentEdit||this._isSheetRename||i.target.id!==this._id+"_inputbox"||(i.target.readOnly?this._setSheetFocus():(this.XLEdit._isEdit||this.XLEdit.editCell(a.rowIndex,a.colIndex,!0),this._getInputBox().focus(),this.XLEdit._isFBarFocused=!0)))}},_renderDDownList:function(){e("#"+this._id+"ddl").length<1&&this.element.append(t.buildTag("input.e-"+this._id+"-ddl","","",{id:this._id+"ddl",style:"display:none"})),e("#"+this._id+"ddl").ejDropDownList({fields:{id:"Types",text:"text",value:"text"},beforePopupShown:e.proxy(this._drppopupshow,this),cssClass:"e-"+this._id+"-ddl e-ss-ddlwrap",width:.1,height:.1,change:e.proxy(this._changeddl,this)}),e(document.body).append(e("#"+this._id+"ddl_popup_wrapper"))},_setddlCell:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=[],S=[],x=[],v=this.getActiveSheetIndex(),w=this.getCalcEngine().getNamedRanges();if(t.isNullOrUndefined(i)||"mousedown"!==i.type?(d=this.getActiveCell(),h=e("#"+this._id+"GroupPanel").find("div.e-content")[0]):(d=this._getCellIdx(i.target),h=i.currentTarget),(a=this.XLEdit.getPropertyValue(d.rowIndex,d.colIndex,"rule",v))&&(o=a.customVal.split("_"),a&&o.indexOf("list")>0)){if(this._ddlCell=d,m=[],(p=a.customVal.split("_list")[0]).startsWith("=")&&p.indexOf(",")<0){for(C=e.trim(p.replace("=","")),(g=w.getItem(C.toUpperCase()))&&(C=g),C.indexOf("!")>-1&&(_=C.split("!"),v=g?this._getSheetIdxFromSheetValue(_[0]):this._getSheetIndexByName(_[0]),C=_[1]),C.indexOf("$")>-1&&(C=C.split("$").join("")),C.indexOf(":")<0&&(C=C+":"+C),s=this.getRangeIndices(C),f=this._getMultiRangeCells(s),r=0,n=(b=this.getRangeData({range:[f[0].rowIndex,f[0].colIndex,f[f.length-1].rowIndex,f[f.length-1].colIndex],property:["value","value2"],sheetIdx:v})).length;r<n;r++)t.isNullOrUndefined(b[r].value)||t.isNullOrUndefined(b[r].value2)?(m.push(""),S.push("")):(m.push(b[r].value),S.push(b[r].value2));m.length||(m.push(p),S.push(p))}else p.indexOf(",")>-1?S=m=p.split(","):((m=[]).push(p),S.push(p));for(r=0,n=m.length;r<n;r++)x[r]={id:r+1,text:S[r],value:m[r]};(d=this.getCell(d.rowIndex,d.colIndex))&&(l={top:d[0].offsetTop,left:d[0].offsetLeft},h.insertAdjacentHTML("beforeEnd","<span id='"+this._id+"ddlspan' class='e-icon e-ssddl e-spanddl e-ddlspan' role='button'></span>"),u=e("#"+this._id+"ddlspan"),c=d.height()-(u.height()+3),u.css({top:l.top+c,left:l.left+d.width()+3}),e("#"+this._id+"ddl").ejDropDownList("option","dataSource",x))}},_drppopupshow:function(){if(this._ddlCell){var t=this.getCell(this._ddlCell.rowIndex,this._ddlCell.colIndex);e("#"+this._id+"ddl_popup").css({width:this.getActiveCellElem().width()+20,"font-size":"11",top:t.position().top,left:t.position().left})}},_ddlPosition:function(){if(this._ddlCell){var t,i=this.getCell(this._ddlCell.rowIndex,this._ddlCell.colIndex),r={top:i[0].offsetTop,left:i[0].offsetLeft};(t=e("#"+this._id+"ddlspan")).css({top:r.top+i.height()-(t.height()+3),left:r.left+i.width()+3})}},_changeddl:function(e){if(this._ddlCell&&this.model.allowEditing){var t=this.getActiveCell(),i=e.model.dataSource[e.itemId].value,r=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex),l={cellIndex:t,value:i,prevValue:r,sheetIdx:this.getActiveSheetIndex(),reqType:"list-value"};if(this._trigger("cellSave",l))return;this.XLEdit._updateCellValue(l.cellIndex,l.value),this.getActiveCellElem().hasClass("e-hlcell")&&this.XLValidate.highlightInvalidData(),this._trigrDdlActnCmplt(l.value,r,e.itemId),this.model.allowFormulaBar&&this.updateFormulaBar()}},_trigrDdlActnCmplt:function(e,t,i){if(null!==this.model.actionComplete){var r,l,n,s,o,a,d,h,c,u=this.getActiveCell(),g=this.getActiveSheetIndex();if(n=this.XLEdit.getPropertyValue(u.rowIndex,u.colIndex,"rule",g),s={reqType:"edit",sheetIndex:g,currValue:e,prevValue:t,rowIndex:u.rowIndex,colIndex:u.colIndex,hasValidation:!0,rule:n,isRefreshVal:!1,isDropDownAction:!0},!this._trigActionBegin(s)){if("list"==n.type&&""!==e&&("="==(o=n.customVal.split("_")[0])[0]&&o.indexOf(",")<0)){if(s.isRefrsVal=!0,a=(o=o.replace("=","")).split("!"),s.refrValSheetIdx=1==a.length?g:this._getSheetIndexByName(a[0]),(r=1==a.length?a[0]:a[1]).indexOf("$")>-1&&(r=r.replace(/\$/g,"")),l=this.getRangeIndices(r),this.isUndefined(i))for(c=(d=this.getRangeData({range:l})).length,h=0;h<c;h++)d[h].value==e&&(i=parseInt(h));s.refrValCellAddr=l[0]===l[2]?this.getAlphaRange(l[0],l[1]+i):this.getAlphaRange(l[0]+i,l[1])}this._trigActionComplete(s)}}},_ddlopen:function(i){var r,l,n,s=this.getActiveSheetIndex(),o=this.getActiveCell(s),a=this.getSheet(s).rowsHeightCollection[o.rowIndex];if(this.XLEdit._isEdit&&"true"===this.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"rule").customVal.split("_")[2])return!1;this.XLEdit.saveCell(),l=e("#"+this._id+"ddl").data("ejDropDownList"),n=this.getCell(this._ddlCell.rowIndex,this._ddlCell.colIndex),i.stopPropagation(),t.isNullOrUndefined(l)||(l._isPopupShown()?l._hideResult():(l._showResult(),e("#"+this._id+"ddl_popup").css({width:this.getActiveCellElem().width()+20,"font-size":"11",top:20,left:100}),r=this._getXYPos(n,e("#"+this._id+"ddl_popup"),a,0),e("#"+this._id+"ddl_popup_list_wrapper").css({top:r.yPos+a,left:r.xPos})))},_mouseMoveHandler:function(i){i.target=this._changeTargetWithOffset(i);var r,l,n=e(i.target);this._isTouchEvt=this._isTouchEvent(i),this._isTouchEvt&&(i.preventDefault(),r=this._setXY(i,navigator.userAgent.indexOf("WebKit")>-1),this.model.allowDragAndDrop&&this.XLDragDrop._dragtouch(r[0],r[1])),!this.model.allowResizing||!("Col"===this.XLResize._resizeType||n.hasClass("e-headercelldiv")||n.hasClass("e-headercell")||n.hasClass("e-reSizeColbg"))||this.XLEdit._isEdit||this.XLCMenu&&this.XLCMenu._isMenuOpened?!this.model.allowResizing||"Row"!==this.XLResize._resizeType&&!n.hasClass("e-rowheader")&&!n.hasClass("e-reSizeRowbg")||this.XLEdit._isEdit||this.XLCMenu&&this.XLCMenu._isMenuOpened?this.model.allowResizing&&("AP"===this.XLResize._resizeType||n.hasClass("e-spreadsheetactpanel")||n.parents(".e-spreadsheetactpanel").length>0)?this.XLResize._apMouseMove(i):(this.model.pictureSettings.allowPictures||this.model.allowCharts)&&(n.hasClass("e-ss-object")||n.parents(".e-ss-object").length||this.XLShape._shapeROStart||this.XLShape._shapeRSStart||n.hasClass("e-ss-imgvisual"))&&this.XLShape._imgMouseMove(i):this.XLResize._rMouseMove(i):this.XLResize._cMouseMove(i),this.model.allowSelection&&this.model.allowDragAndDrop&&t.spreadsheetFeatures.dragAndDrop&&n.parents(".e-spreadsheetmainpanel").length&&n.hasClass("e-rowcell")&&!this.XLEdit._isEdit&&-1===this._getJSSheetHeader(this.getActiveSheetIndex())[0].querySelector(".e-spreadsheetcolumnheader").className.indexOf("e-sheetselected")&&this.XLDragDrop._dMouseMove(i),this.model.allowComments&&!this.XLComment._isCommentEdit&&this.getSheetElement(this.getActiveSheetIndex()).find(".e-commentcell").length>0&&this.XLComment._commentMouseMove(i),t.isNullOrUndefined(i.target.parentNode)||i.target.id.indexOf("_svg")<0&&this._isString(i.target.parentNode.className)&&i.target.parentNode.className.indexOf("e-content")<0&&!e(i.target).is("td.e-rowcell")&&this.XLShape._shapeMouseUp(i),this._isTouchEvt&&!this._isSelected(i.target)&&!this._isTouchMoveSel&&this._touchArgs&&!this._isUniqueTarget(this._touchArgs,i)&&n.parents(".e-table").length&&n.parents(".e-spreadsheetcontentcontainer").length&&!this.XLDragDrop._allowDragAndDrop&&(l=this._getClientDiff(this._startXY,r),this._scrollContent(l),this._startXY=r,this._touchArgs=i,this._isTouchScroll=!0)},_mouseLeaveHandler:function(t){this._hasClass(t.target,"e-viewhdrlbl")||this._hasClass(t.target,"e-vheading")?this.element.find(".e-vheading .e-chk-act, .e-vheading .e-chk-inact").removeClass("e-chkhover"):this._hasClass(t.target,"e-viewlinlbl")||this._hasClass(t.target,"e-vgridlines")?this.element.find(".e-vgridlines .e-chk-act,.e-vgridlines .e-chk-inact").removeClass("e-chkhover"):this.model.allowResizing&&e(".e-ss-colresize, .e-ss-rowresize").removeClass("e-ss-colresize e-ss-rowresize")},_mouseUpHandler:function(t){var i=e(t.target),r=this.getActiveSheetIndex(),l=this.XLScroll._vScroller(r),n=this.XLScroll._hScroller(r);this.model.allowResizing&&("Col"===this.XLResize._resizeType?this.XLResize._cMouseUp(t):"Row"===this.XLResize._resizeType?this.XLResize._rMouseUp(t):"AP"===this.XLResize._resizeType&&this.XLResize._apMouseUp(t)),this.model.showRibbon&&!this._phoneMode&&this.element.find(".e-ribbonpin").is(":visible")&&e(t.target).parents(".e-ribbon").length<=0&&e("#"+this._id+"_Ribbon").ejRibbon("collapse"),this.model.allowDragAndDrop&&this.XLDragDrop._allowDragAndDrop&&this.XLDragDrop._dMouseUp(t),this.model.allowComments&&this.XLComment._isCommentEdit&&this.getActiveCellElem().find("textarea").focus(),this._isSheetRename&&e("#"+this._id+"_Sheet_RenamePanel").focus(),this.model.pictureSettings.allowPictures&&this.XLShape._shapeMouseUp(t),this.model.enablePivotTable&&this.XLPivot._pivotMouseUp(t),this._hasClass(i[0],"e-vhandle")||this._hasClass(i[0],"e-vhandlespace")||this._hasClass(i[0],"e-vup")||this._hasClass(i[0],"e-vdown")?this._trigger("scrollStop",{scrollData:l._scrollData,position:l.model.value,reqType:"vertical"}):(this._hasClass(i[0],"e-hhandle")||this._hasClass(i[0],"e-hhandlespace")||this._hasClass(i[0],"e-hdown")||this._hasClass(i[0],"e-hup"))&&this._trigger("scrollStop",{scrollData:l._scrollData,position:n.model.value,reqType:"horizontal"})},_scrollContent:function(e,i){var r,l,n=this.getActiveSheetIndex(),s=this.getSheet(n);e.x&&(r=i?e.x:s._scrollLeft+e.x,l=this.XLScroll._hScroller(n),r<0?r=0:this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?e.x>0&&l.model.maximum<r+l._scrollData.handle&&(r=l.model.maximum):l._scrollData.step=e.x<0?-1:1,s._scrollLeft!=r&&l.scroll(r)),e.y&&(r=i?e.y:s._scrollTop+e.y,l=this.XLScroll._vScroller(n),r<0?r=0:this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal?e.y>0&&l.model.maximum<r&&(r=l.model.maximum):l._scrollData.step=e.y<0?-1:1,(r||s._scrollTop!=r)&&l.scroll(r))},_keyDownHandler:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S=!0,x=!1,v=this.getActiveSheetIndex(),w=this.element.find("#"+this._id+"_AutoComplete").data("ejAutocomplete"),I=e("#"+this._id+"_Ribbon").data("ejRibbon"),y=this.getSheet(v),T=y._activeCell;if(!this._trigger("keyDown",{event:i,isEdit:this.model.allowEditing&&this.XLEdit._isEdit,isCommentEdit:this.model.allowComments&&this.XLComment._isCommentEdit,isSheetRename:this._isSheetRename,sheetIndex:this._getSheetIndex()})){if(this._getContent(v).find(".e-ss-activeimg").length&&(e(i.target).hasClass("e-numerictextbox")&&13===i.keyCode&&i.preventDefault(),x=!0,(s=document.activeElement.id).indexOf(this._id+"_Ribbon_Format_Size_PictureHeight")<0&&s.indexOf(this._id+"_Ribbon_Format_Size_PictureWidth")<0&&this.XLShape._imgKeyDown(i)),navigator.platform.toLowerCase().indexOf("mac")>-1&&i.metaKey)return void(67==i.keyCode?this.XLClipboard.copy():86==i.keyCode?this.XLClipboard.paste():88==i.keyCode&&this.XLClipboard.cut());if(w.showSuggestionBox&&w.suggestionList){if(38===i.keyCode)return w._removeListHover(),w._activeItem=w._activeItem>1?w._activeItem-1:w._listSize,w._addListHover(),void w._targetFocus();if(40===i.keyCode)return w._removeListHover(),w._activeItem=w._activeItem<w._listSize?w._activeItem+1:1,void w._addListHover()}if(i.target.id.indexOf("_Edit")>-1&&this.model.allowKeyboardNavigation&&(this.XLCellNav._canKeyBoardNavigate=!0),this.XLEdit._editElem&&(o=this.XLEdit._editElem.text()),i.target.id.indexOf("_Edit")>-1&&9===i.keyCode&&0===o.indexOf("=")&&o.indexOf(")")!=o.length-1)return i.preventDefault(),!w.suggestionList.is(":visible")&&this.model.allowKeyboardNavigation?(this._isFormulaSuggestion&&(39===i.keyCode||37===i.keyCode||13===i.keyCode&&!i.altKey)&&this.XLEdit.saveCell(),this.XLCellNav._selectionKeyDownHandler(i),void(T=this.getSheet(v)._activeCell)):(l=u=w.getActiveText(),u.indexOf("(worksheet)")>-1&&(u=l.split(" (worksheet)")[0]),o.endsWith("[")&&this._tableRangesFormula[o.split("[")[0].slice(1)]?l=o+l.slice(1):this.XLEdit._isNamedRange(u)||(l+="("),this.XLEdit._editElem.text(l),this.model.allowFormulaBar&&this._getInputBox().val(l),i.target.id.indexOf("_Edit")>-1&&this.XLEdit._editElem.focusEnd(),void(this.XLCellNav._canKeyBoardNavigate=!1));if(this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"wrap")&&this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"merge")&&46===i.keyCode&&(this.getCell(T.rowIndex,T.colIndex,v).find("#"+this._id+"_Merge")[0].textContent=""),i.target.id.indexOf("_Custom")<0&&i.target.id.indexOf("_Ribbon")<0){if(i.stopImmediatePropagation(),this.model.allowFiltering&&this.XLFilter._isSearchEdit&&27!==i.keyCode)return!0;if(e(i.target).parents(".e-formulabar").length&&this.XLEdit._isEdit&&this.model.allowKeyboardNavigation&&(this.XLCellNav._isNavigate=13===i.keyCode),this._isSheetRename||this.XLEdit._isEdit||this.XLComment&&this.XLComment._isCommentEdit||!this.model.allowClipboard||this.XLClipboard._copyPasteHandler(i),x||this._isSheetRename||(this.XLComment&&this.XLComment._isCommentEdit?this.model.allowKeyboardNavigation&&(this.XLCellNav._isNavigate=!1):this.model.allowEditing&&(-1===document.activeElement.id.indexOf("_inputbox")||27===i.keyCode)&&this.XLEdit._editingHandler(i)),this.isFormula(o)&&i.ctrlKey&&i.shiftKey&&13===i.keyCode){for(this._hasFormulaArray=!0,c=(a=this._getSelectedCells()).range,g=this._getAlphaRange(v,c[0],c[1],c[2],c[3]),t.isNullOrUndefined(y.formulaRange[o])&&(y.formulaRange[g]=o),p=0,m=a.selCells.length;p<m;p++)m>1&&(this._hasMultipleFormulaArray=!0),d=a.selCells[p].rowIndex,h=a.selCells[p].colIndex,T.rowIndex==d&&T.colIndex==h&&this.XLEdit.saveCell(),this.XLEdit._updateCellValue({rowIndex:d,colIndex:h},o),this._dataContainer.sheets[v][d][h].formulaRange=g;this._hasFormulaArray=!1,this._hasMultipleFormulaArray=!1}if(27==i.keyCode&&this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"hasFormulaArray")?(_=this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"hasFormulaArray"),f=this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"hasMultipleFormulaArray"),(_||f)&&(this._formulaArray=!0,this.model.allowFormulaBar&&this.updateFormulaBar(),this._formulaArray=!1)):this._isFormulaSuggestion&&(39===i.keyCode||37===i.keyCode||13===i.keyCode&&!i.altKey)?this.XLEdit.saveCell():this.XLEdit._isFormulaEdit||9!==i.keyCode&&(13!==i.keyCode||i.altKey)&&37!==i.keyCode&&38!==i.keyCode&&39!==i.keyCode&&40!==i.keyCode||(S=!(this.XLEdit._isEdit&&this.model.allowKeyboardNavigation&&this.XLCellNav._isNavigate)||this.XLEdit.saveCell()),e(i.target).hasClass("e-field-validation-error")||i.target.id==this._id+"_Ribbon_Home_Font_FontFamily_wrapper"||i.target.id==this._id+"_Ribbon_Home_Number_NumberFormat_wrapper"||i.target.id==this._id+"_Ribbon_Home_Font_FontSize_wrapper")return!0;if(this.model.allowDataValidation&&this.XLValidate._isErrorVisible&&(37===i.keyCode||39===i.keyCode||38===i.keyCode||40===i.keyCode))return this.XLValidate._isErrorVisible=!1,!0;if(!S&&!this.XLEdit._isFormulaEdit||13===i.keyCode&&i.altKey)return!1;!this.model.allowKeyboardNavigation||x||this._isSheetRename||(this.model.allowComments&&this.XLComment._isCommentEdit||e(i.target).parents(".e-formulabar").length&&9!==i.keyCode&&(13!==i.keyCode||i.altKey)||(this.XLEdit._isFormulaEdit&&(v!=(C=(b=this.XLEdit._editElem.closest(".e-sheet")).length&&this._getSheetIdxFromSheetValue(b[0].id.replace(this._id+"_","")))&&(9===i.keyCode||13===i.keyCode)&&(this.XLSelection._clearBorder(this._formulaBorder.join(" ").replace(/,/g," ")+" "+this._ctrlFormulaBorder.join(" ").replace(/,/g," ")),this.gotoPage(C))),this.XLCellNav._selectionKeyDownHandler(i)),T=this.getSheet(v)._activeCell,this._keyboardShortCuts(i)),this.model.allowUndoRedo&&(this.model.allowComments&&!this.XLComment._isCommentEdit?this._undoRedoOperation(i):this.model.allowComments||this._undoRedoOperation(i)),this.XLEdit._isFormulaEdit&&9===i.keyCode&&!this.XLCellNav._canKeyBoardNavigate&&(this.XLCellNav._canKeyBoardNavigate=!0)}if(i.target.id===this._id+"_Ribbon_Analyze_PivotTable_PivotTableName")return this._isPvtNameEdit=!0,!0;if(this._isPvtNameEdit&&(this._isPvtNameEdit=!1,this.XLPivot._changePvtName()),"DIV"!==i.target.tagName||this.XLEdit._isEdit||t.isNullOrUndefined(this._ddlCell)||(this.element.find("#"+this._id+"ddl").ejDropDownList("hidePopup"),this.element.find("#"+this._id+"ddlspan").remove(),this._ddlCell=null),n=this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"tableName",v),i.target.id===this._id+"_Ribbon_Design_Properties_TableName"){if(this._isTableRename=!0,this._tableClassName=this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"tableName")||"",!this._isTableRename||13!==i.keyCode&&9!==i.keyCode&&27!==i.keyCode)return;13===i.keyCode&&i.preventDefault(),this.XLFormat._renameTable(this._tableClassName)}n&&0===this._getContent(v).find(".e-ss-activeimg").length?(r=this._getTableID(n),this.isNumber(r)&&this.XLRibbon._designTabUpdate(r,T)):this.model.showRibbon&&(I.model.selectedItemIndex===this.XLRibbon._getTabIndex("design")||I.isVisible(this._getLocStr("Design")))&&this.XLRibbon._toggleDesignTab(T),this.XLEdit._isEdit||t.isNullOrUndefined(this.XLEdit.getPropertyValue(T.rowIndex,T.colIndex,"rule",v))||this._setddlCell(i),this._isSheetRename&&(13===i.keyCode||9===i.keyCode||27===i.keyCode)&&(i.preventDefault(),this._updateSheetNames(null,27===i.keyCode)&&this._setSheetFocus()),w.suggestionList.is(":visible")&&(""===this.XLEdit._editElem.text()||13===i.keyCode)&&w._hideResult(),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons()}},_keyUpHandler:function(e){var t=this.element.find("#"+this._id+"_Edit").text();this.model.allowEditing&&this.XLEdit._isEdit&&t.indexOf("=")>-1&&t.length>0&&-1==t.indexOf(")")&&(this.XLEdit._isFEdit||(this.XLCellNav._isNavigate=!0),40!==e.keyCode&&38!==e.keyCode&&t.length>1&&((t=t.replace("=","")).endsWith("[")&&this._tableRangesFormula[t.split("[")[0]]?(this.XLEdit._refreshAutoComplete(t.split("[")[0]),this._isFormulaCln=!0,this.XLEdit._captureEditing(!0)):(this._isFormulaCln&&(this.XLEdit._refreshAutoComplete(),this._isFormulaCln=!1),this.XLEdit._captureEditing()))),this._trigger("keyUp",{event:e,isEdit:this.model.allowEditing&&this.XLEdit._isEdit,isCommentEdit:this.model.allowComments&&this.XLComment._isCommentEdit,isSheetRename:this._isSheetRename,sheetIndex:this._getSheetIndex()})},_dblClickHandler:function(t){var i,r,l,n,s;if(this.XLEdit._isFEdit=!1,"A"!==t.target.tagName)if(this._hasClass(t.target,"e-numericitem")){if(this.XLEdit&&this.XLEdit._isEdit&&this.getActiveCellElem().find(".e-error").length)return;this._isSheetRename||this._renameSheet()}else{if(t.target.id.indexOf("chart")>-1||this._hasClass(t.target,"e-comment-txtarea")||this._hasClass(t.target,"e-filterspan")||e(t.target).parents(".e-ss-pivot").length)return;if(l=this.getActiveSheetIndex(),n=this.getSheet(l),t.target=this._changeTargetWithOffset(t),!this.model.allowEditing||!this.model.allowSelection)return;if(this.XLSelection._isOutsideBordering||this.XLSelection._isGridBordering)return(i=this._getContent(l).find("div:first-child")).addClass("e-ss-cursor"),i.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor"),this.XLSelection.selectRange(n._startCell,n._endCell),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),void(this.XLSelection._isOutsideBordering=this.XLSelection._isGridBordering=!1);if(!this.XLEdit._isEdit&&(e(t.target).hasClass("e-rowcell")||e(t.target).parents("td").hasClass("e-rowcell"))&&!this._hasClass(e(t.target),"e-readonly")&&!e(t.target).hasClass("e-cellreadonly")){if(s=this._clkCellObj,this._isTouchEvt&&t.preventDefault(),e(".e-cdata").length&&e(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),e(t.target).closest("#"+this._id+"EditForm").length)return;r=t.target.id.length<1?this._getCellIdx(t.target):this._getCellIdx(e(t.target).parents("td")[0]),s.rowIndex==r.rowIndex&&s.colIndex==r.colIndex&&this.XLEdit.editCell(r.rowIndex,r.colIndex,!0)}this.model.allowResizing&&(e(t.target).hasClass("e-headercell")||e(t.target).hasClass("e-headercelldiv"))&&("col-resize"===e(t.target).css("cursor")||this._isTouchEvt)&&(e(t.target).hasClass("e-headercelldiv")&&(t.target=t.target.parentNode),this.XLResize._resizeToFitWidth(t)),this.model.allowResizing&&(e(t.target).hasClass("e-ss-rowresize")||this._isTouchEvt&&e(t.target).hasClass("e-rowheader"))&&this.XLResize._resizeToFitHeight(t)}},_setAndSelectActiveCell:function(e,t,i){this.setActiveCell(e,t),this._selectActiveCell(e,t,"",i)},_selectActiveCell:function(e,t,i,r){var l=this.getActiveSheetIndex(),n=i?{rowIndex:i.rowIndex,colIndex:i.colIndex}:{rowIndex:e,colIndex:t},s=this.getSheet(l);if(this.model.allowSelection&&this.model.allowKeyboardNavigation&&this.model.scrollSettings.allowScrolling){switch(this.XLEdit.getPropertyValue(e,t,"mergeIdx")?(s._activeCell=s._endCell=s._startCell=n,this.XLSelection._processBoundary(),s._activeCell=s._startCell,this.XLSelection.selectRange(s._startCell,s._endCell)):this.XLSelection.selectRange(this._getAlphaRange(l,e,t,n.rowIndex,n.colIndex)),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),r){case"Home":this._scrollContent({x:[i?i.colIndex*s.columnWidth:0]-s._scrollLeft});break;case"End":s._isFreezed?this.XLCellNav._navToCell(e,t):(e<s._topRow.idx||e>s._bottomRow.idx||t<s._leftCol.idx||t>s._rightCol.idx)&&this.XLScroll.scrollToCell(this._getAlphaRange(l,e,t,n.rowIndex,n.colIndex));break;case"Ctrl + Home":case"Ctrl + Shift + Home":this.XLScroll.scrollToCell(this._getAlphaRange(l,e,t,n.rowIndex,n.colIndex))}this.XLScroll._getFirstColumn(l)}},_pageUpDown:function(e){if(!this._isAutoWHMode){var i,r,l,n,s,o,a=0,d=this.getActiveCell(),h=this.getActiveSheetIndex(),c=this.getSheet(h),u=this.model.scrollSettings.allowVirtualScrolling;l=c._rowHeightCollection[d.rowIndex],c.rowCount-1===c._bottomRow.idx&&1===e||(this._isFrozen(c.frozenRows)?d.rowIndex>c.frozenRows&&c._ftopRowIdx===c.frozenRows:0===c._topRow.idx)&&-1===e||(n=c._bottomRow.value+c.rowsHeightCollection[c._bottomRow.idx],this._isFrozen(c.frozenRows)&&(d.rowIndex<c.frozenRows&&1===e&&(l=c._rowHeightCollection[c.frozenRows]),a=1===e?this._getRowOffsetTop(c,c.frozenRows):this._getIdxWithOffset(c._ftopRowIdx,null,!1,["freeze"]).yOffset),i=l+(s=e*(n-(a||c._topRow.value)))>0?l+s:0,a?1===e?(o=d.rowIndex>c._ftopRowIdx?this._getIdxWithOffset(d.rowIndex).yOffset-c._frozenHeight:0,d.rowIndex<c.frozenRows?this._scrollContent({y:e*(n-c.rowsHeightCollection[c._bottomRow.idx]-a)+1}):this._scrollContent({y:this._getIdxWithOffset(c._bottomRow.idx,null,!1,["freeze"]).yOffset-c._frozenHeight},!0),i=this._getIdxWithOffset(c._ftopRowIdx).yOffset+o):(o=d.rowIndex>c._ftopRowIdx?this._getIdxWithOffset(d.rowIndex).yOffset-c._frozenHeight:0,d.rowIndex>c.frozenRows&&u?this._scrollContent({y:a-(n-c.rowsHeightCollection[c._bottomRow.idx])+1},!0):this._scrollContent({y:i+c.rowsHeightCollection[c._bottomRow.idx]-c._frozenHeight+1},!0),i=this._getIdxWithOffset(c._ftopRowIdx).yOffset+o):1===e&&this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&c._bottomRow.value+this.model.rowHeight+c._vPortHgt>=c._rowHeightCollection[c._rowHeightCollection.length-1]?i=c._rowHeightCollection[c._rowHeightCollection.length-1]:this._scrollContent({y:e*(n-c._scrollTop)}),r=this._getIdxWithOffset(i,c._colWidthCollection[d.colIndex],!0),this._setAndSelectActiveCell(r.rowIdx,r.colIdx))}},_keyboardShortCuts:function(i){var r,l,n,s,o;if(this.model.allowEditing&&this.XLEdit._isEdit||this.model.allowComments&&this.XLComment._isCommentEdit&&27!==i.keyCode)return!1;var a,d,h,c=this.XLFormat,u=this.getActiveSheetIndex(),g=this.getSheet(u),p=g._selectedCells,m=!1;if(this.model.allowLockCell&&g.isSheetProtected&&(m=!0),!i.ctrlKey&&!i.shiftKey)switch(i.keyCode){case 33:i.preventDefault(),this._pageUpDown(-1);break;case 34:i.preventDefault(),this._pageUpDown(1);break;case 36:i.preventDefault(),this._setAndSelectActiveCell(this.getActiveCell(u).rowIndex,this._isFrozen(g.frozenColumns)?g._frozenColumns-1:0,"Home")}if(i.ctrlKey&&!i.shiftKey){if(!this.element.find("#"+this._id+"_Ribbon .e-ribbonbackstagepage").is(":visible"))switch(i.keyCode){case 65:i.preventDefault(),this.model.allowSelection&&(a=this.getActiveCellElem(),this.selectAll(),t.isNullOrUndefined(this.XLCellNav)||this.XLCellNav._updateActiveCell(e(a[0]).closest("tr").index(),a[0].cellIndex,{keyCode:i.keyCode}),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement());break;case 66:i.preventDefault(),m||this._toggleFontPrpty("bold");break;case 68:case 82:i.preventDefault(),this.model.allowAutoFill&&this.XLDragFill._fillRange(68===i.keyCode);break;case 73:i.preventDefault(),m||this._toggleFontPrpty("italic");break;case 75:i.preventDefault(),this.model.allowHyperlink&&!m&&this._showDialog(this._id+"_Ribbon_Insert_Links_Hyperlink");break;case 85:i.preventDefault(),m||this._toggleFontPrpty("underline");break;case 32:if(i.preventDefault(),!this.model.allowSelection)return;r=p[0].colIndex,l=p[p.length-1].colIndex,d={rowIndex:0,colIndex:r},h={rowIndex:g.rowCount-1,colIndex:l},this.model.allowSelection&&this.XLSelection.selectRange(d,h),g._startCell=d,g._endCell=h,g._isColSelected=!0,t.isNullOrUndefined(this.XLCellNav)||this.XLCellNav._updateActiveCell(p[0].rowIndex,r),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();break;case 35:i.preventDefault(),h=this._getUsedRangeFromSheet(u).endCell,this._setAndSelectActiveCell(h.rowIndex,h.colIndex,"End");break;case 36:i.preventDefault(),this._setAndSelectActiveCell(this._isFrozen(g.frozenRows)?g._frozenRows-1:0,this._isFrozen(g.frozenColumns)?g._frozenColumns-1:0,"Ctrl + Home");break;case 49:i.preventDefault(),this._showDialog(this._id+"_FormatCells");break;case 53:i.preventDefault(),m||this._toggleFontPrpty("line-through");break;case 56:i.shiftKey||m||(i.preventDefault(),this._hideColumn(g._startCell.colIndex,g._endCell.colIndex));break;case 57:i.shiftKey||(i.preventDefault(),m||this._hideRow(g._startCell.rowIndex,g._endCell.rowIndex,"isRHide"));break;case 220:i.shiftKey||(i.preventDefault(),this.model.allowSearching&&this.XLSearch._applyGotoRowDiff());break;case 90:case 89:i.preventDefault();break;case 114:i.preventDefault(),this.model.showRibbon&&!m&&this.XLRibbon._openNameManagerDlg();break;case 70:i.preventDefault(),this._showDialog(this._id+"_Ribbon_Others_Editing_FindSelect"),e("#"+this._id+"_FRDialog").ejDialog("open"),this.XLRibbon._refreshFRDlg(),e("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option","selectedItemIndex",0);break;case 71:i.preventDefault(),this._showDialog(this._id+"_Ribbon_Others_Editing_FindSelect"),e("#"+this._id+"_GoDialog").ejDialog("open"),e("#"+this._id+"_GoToDlgTab").ejTab("option","selectedItemIndex",0);break;case 72:i.preventDefault(),this._showDialog(this._id+"_Ribbon_Others_Editing_FindSelect"),e("#"+this._id+"_FRDialog").ejDialog("open"),this.XLRibbon._refreshFRDlg(),e("#"+this._id+"_FRDialog_FPDlgTab").ejTab("option","selectedItemIndex",1)}switch(i.keyCode){case 80:i.preventDefault(),this.XLPrint.printSheet();break;case 79:if(i.preventDefault(),this.model.allowImport){if(this.model.importSettings.importMapper.length<1)return void this._showAlertDlg("Alert","ImportExportUrl","",266);this.isDirty&&"msie"!==this._browserDetails.name?this._showAlertDlg("","ImportAlert","Open",470,135):e("#"+this._id+"_file .e-uploadinput").click()}break;case 83:i.preventDefault(),this.model.exportSettings.allowExporting&&(this._showDialog("exportxl"),e("#"+this._id+"_ExportFileNameDialog").ejDialog("open"),this.XLExport._exportType="Excel")}}if(i.ctrlKey&&i.shiftKey){if(!this.element.find("#"+this._id+"_Ribbon .e-ribbonbackstagepage").is(":visible"))switch("mozilla"===this._browserDetails.name&&173===i.keyCode&&(i.keyCode=189),i.keyCode){case 192:i.preventDefault(),m||c.format({type:"general"});break;case 52:i.preventDefault(),m||c.format({type:"currency"});break;case 53:i.preventDefault(),m||c.format({type:"percentage"});break;case 54:i.preventDefault(),m||c.format({type:"scientific"});break;case 51:i.preventDefault(),m||c.format({type:"shortdate"});break;case 50:i.preventDefault(),m||c.format({type:"time"});break;case 49:i.preventDefault(),m||c.format({type:"number"});break;case 55:i.preventDefault(),this.model.allowCellFormatting&&this.model.formatSettings.allowCellBorder&&!m&&this.XLFormat.applyBorder({top:"1px solid #000000",right:"1px solid #000000",bottom:"1px solid #000000",left:"1px solid #000000"});break;case 189:i.preventDefault(),this.model.allowCellFormatting&&this.model.formatSettings.allowCellBorder&&!m&&this.XLFormat.applyBorder("noborder");break;case 73:i.preventDefault(),this.model.allowInsert&&!m&&this._showDialog(this._id+"_Ribbon_Others_Cells_InsertCellOptions");break;case 68:i.preventDefault(),this.model.allowDelete&&!m&&this._showDialog(this._id+"_Ribbon_Others_Cells_DeleteCellOptions");break;case 113:i.preventDefault(),n=e("#"+this._id+"_Ribbon").data("ejRibbon"),this.model.showRibbon&&(n._isCollapsed?(n.expand(),n._removeRibbonPin(),this._isKeyCtrlShftF2=!0):n.collapse());break;case 56:i.preventDefault(),!m&&this.model.allowSelection&&this._showColumn(p[0].colIndex,p[p.length-1].colIndex);break;case 57:i.preventDefault(),!m&&this.model.allowSelection&&this._showRow(p[0].rowIndex,p[p.length-1].rowIndex,"isRHide");break;case 79:i.preventDefault(),this.XLSearch._applyGotoComments();break;case 220:i.preventDefault(),this.XLSearch._applyGotoColDiff();break;case 36:i.preventDefault(),h=this.getActiveCell(u),this._selectActiveCell(0,0,h,"Ctrl + Shift + Home")}}else if(i.shiftKey)32===i.keyCode?(i.preventDefault(),this.model.allowSelection&&(d={rowIndex:s=p[0].rowIndex,colIndex:0},h={rowIndex:p[p.length-1].rowIndex,colIndex:g.colCount-1},this.XLSelection.selectRange(d,h),g._startCell=d,g._endCell=h,g._isRowSelected=!0,t.isNullOrUndefined(this.XLCellNav)||this.XLCellNav._updateActiveCell(s,p[0].colIndex),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement())):113===i.keyCode?(this._dupDetails=!0,i.preventDefault(),a=this.getActiveCellElem(),this.model.allowComments&&!m&&(this._isRibbonClick=!0,a.hasClass("e-commentcell")?this.XLComment.editComment():this.XLComment.setComment(),this._isRibbonClick=!1),this._dupDetails=!1):122===i.keyCode&&(i.preventDefault(),this.addNewSheet());else if(27===i.keyCode){if(this.model.allowComments&&this.XLComment._isCommentEdit&&(this.XLComment._updateCurCmntVal(),this.XLComment._updateCmntRibIcons()),this.model.allowContextMenu&&(this.XLCMenu._isMenuOpened||e("#"+this._id+"_contextMenuColumnHeader").is(":visible")||e("#"+this._id+"_contextMenuRowHeader").is(":visible"))&&this.XLCMenu.hideCMenu(),this.model.allowFiltering&&this._excelFilter&&this._excelFilter._openedFltr&&e(this._excelFilter._openedFltr).is(":visible")){if((o=this._excelFilter._menuWrap.data("ejMenu")).element.find(".e-mhover li:visible").length)return void(o._isContextMenuOpen||o._closeMenu());this.XLFilter._isSearchEdit=!1,this._excelFilter.closeXFDialog()}this._setSheetFocus()}else i.altKey&&(112===i.keyCode&&this.model.showRibbon&&this.model.allowCharts&&!m?(i.preventDefault(),this.XLChart.createChart(null,{type:"column",enable3D:!1,marker:{visible:!1}})):84===i.keyCode&&this.model.showRibbon&&!this.XLRibbon._isDirtySelect&&!m&&this.model.allowFormatAsTable&&(this._showDialog(this._id+"_Ribbon_Insert_Tables_Table"),i.preventDefault(),this.XLRibbon._openFATDlg()))},_triggerTBtnClick:function(t){e("#"+t).data("ejToggleButton").buttontag.click()},_toggleFontPrpty:function(e){var t,i,r,l,n=this.getActiveCell(),s=this.XLFormat,o={style:{}};t=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"format"),r=!this.isUndefined(t)&&this.XLFormat.getFormatFromHashCode(t),i="bold"===e?"font-weight":"italic"===e?"font-style":"text-decoration","Line-through"===(l=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())&&(l="StrikeThrough"),r[i]===e?(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).ejToggleButton("option","toggleState",!1),o.style[i]="none"):"text-decoration"!==i||"underline"!==r[i]&&"line-through"!==r[i]?"text-decoration"!==i||"line-through underline"!==r[i]&&"underline line-through"!==r[i]?(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).ejToggleButton("option","toggleState",!0),o.style[i]=e):(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).ejToggleButton("option","toggleState",!1),r[i]=r[i].split(" ").join(""),o.style[i]=r[i].replace(e,"")):(this.model.showRibbon&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).length&&this.element.find("#"+this._id+"_Ribbon_Home_Font_"+l).ejToggleButton("option","toggleState",!0),o.style[i]="underline"===r[i]?e+" "+r[i]:r[i]+" "+e),s.format(o)},_getLocStr:function(e){return this.localizedLabels[e]},_checkIndicesInContainer:function(e,t,i,r){var l=this._dataContainer.sheets;return e in l&&t in l[e]&&i in l[e][t]&&(!r||r in l[e][t][i])},_textFormatting:function(t){switch(t){case"wrapText":var i=e("#"+this._id+"_Ribbon_Home_Alignment_WrapText").data("ejToggleButton");i&&this.setWrapText(i.model.toggleState?"wrap":"unwrap",null)}},wrapText:function(e){this.model.allowWrap&&!this.model.isReadOnly&&this.setWrapText("wrap",e)},unWrapText:function(e){this.model.allowWrap&&!this.model.isReadOnly&&this.setWrapText("unwrap",e)},setWrapText:function(i,r){var l,n,s;if(this.model.allowWrap&&!this.model.isReadOnly){var o,a,d,h,c,u,g,p,m,_,f=this.getActiveSheetIndex(),b=this.getSheet(f),C=0,S=this.model.rowHeight,x=this.getRows(f)[0],v=b.rowsHeightCollection,w=b._wrapHtCollection,I=!1,y=b._clrWrapColl,T=[],L="msie"===this._browserDetails.name&&"8.0"===this._browserDetails.version;if(a=this._getRangeArgs(r,"object"),0!==(o=this._getSelectedCells(f,a).selCells).length){for(g=o.length>1?this._getProperAlphaRange(f,o[0].rowIndex,o[0].colIndex,o[o.length-1].rowIndex,o[o.length-1].colIndex):this._getAlphaRange(f,o[0].rowIndex,o[0].colIndex,o[o.length-1].rowIndex,o[o.length-1].colIndex),this._updateWrapCol(i,o,b,f),l=0,n=o.length;l<n;l++)if(I=this.XLEdit.getPropertyValue(o[l].rowIndex,o[l].colIndex,"wrap"),o[l].colIndex===a[1]&&(m=this._dataContainer.sheets[f],_=this.getObjectKeys(m[o[l].rowIndex])),this._isPaste||("unwrap"!==i||I)&&("wrap"!==i||!I)){if("unwrap"===i&&I)this._isUndoRedo||y.push({rowIdx:o[l].rowIndex,colIdx:o[l].colIndex}),this._isRowViewable(f,o[l].rowIndex)&&(d=this.getCell(o[l].rowIndex,o[l].colIndex),h=o[l].rowIndex,c=o[l].colIndex,d&&this._removeClass(d[0],"e-sswraptext"),this._removeClass(x[h],"e-sswraprow"),this.XLEdit.getPropertyValue(o[l].rowIndex,o[l].colIndex,"altTxt")&&this.addClass(d[0],"e-alt-unwrap"),h in b._wrapColl&&c in b._wrapColl[h]&&(delete b._wrapColl[h][c],u=t.max(this._getObjectValues(b._wrapColl[h])),p=this._getFormattedHeight(f,h),(!u||u<p)&&(u=p),e.isEmptyObject(b._wrapColl[h])&&delete b._wrapColl[h])),this.XLEdit._clearDataContainer({cellIdx:o[l],property:["wrap"]}),this.XLEdit._clearDataContainer({cellIdx:{rowIndex:o[l].rowIndex,colIndex:0},property:["wrapRow"]}),this.XLEdit._clearDataContainer({cellIdx:{rowIndex:0,colIndex:o[l].colIndex},property:["wrapCol","wrapWidth"]}),C=this._getWrapCellHeight(f,o[l].rowIndex,o[l].colIndex,u),this._textClip(o[l].rowIndex,o[l].colIndex,"add",null,null,_);else if("wrap"===i&&!I){if(this.XLEdit.getPropertyValue(o[l].rowIndex,o[l].colIndex,"isFilterHeader"))continue;this._textClip(o[l].rowIndex,o[l].colIndex,"delete",null,null,_),this._wrapCollection(o[l].rowIndex,o[l].colIndex,v[o[l].rowIndex],f),this.XLEdit._updateDataContainer({rowIndex:o[l].rowIndex,colIndex:o[l].colIndex},{dataObj:{wrap:!0}}),this._isRowViewable(f,o[l].rowIndex)&&((d=this.getCell(o[l].rowIndex,o[l].colIndex))&&d.length>0&&((L?d.is(":visible"):"table-cell"==window.getComputedStyle(d[0]).display)||this._isPaste)&&this.model.allowResizing&&!this.XLResize._preventRowResize(o[l].rowIndex)&&(this.addClass(d[0],"e-sswraptext"),this.XLEdit.getPropertyValue(o[l].rowIndex,o[l].colIndex,"altTxt")&&this._removeClass(d[0],"e-alt-unwrap"))),(C=this.XLEdit.getPropertyValue(o[l].rowIndex,o[l].colIndex,"mergeIdx")?this._getWrapCellHeight(f,o[l].rowIndex,o[l].colIndex,b.rowsHeightCollection[o[l].rowIndex]):this._getWrapCellHeight(f,o[l].rowIndex,o[l].colIndex)).rowHt<S&&(C.rowHt=S),S=C.rowHt,this._wrapCollection(o[l].rowIndex,o[l].colIndex,C.cellHt,f),this.XLEdit._updateDataContainer({rowIndex:o[l].rowIndex,colIndex:o[l].colIndex},{dataObj:{wrap:!0}}),w[o[l].rowIndex]=l>0&&o[l].rowIndex===o[l-1].rowIndex?w[o[l-1].rowIndex]:w[o[l].rowIndex]=v[o[l].rowIndex],t.isNullOrUndefined(this.XLEdit.getPropertyValue(o[l].rowIndex,0,"wrapCol"))&&this.XLEdit._updateDataContainer({rowIndex:0,colIndex:o[l].colIndex},{dataObj:{wrapCol:!0,wrapWidth:this.getSheet(f).columnsWidthCollection[o[l].colIndex]}})}C.rowHt>0&&(o[l].colIndex===a[3]||this.XLEdit.getPropertyValue(o[l].rowIndex,o[l].colIndex,"merge"))&&(T.push({rowIndex:o[l].rowIndex,height:C.rowHt}),S=0,"wrap"!==i||I||t.isNullOrUndefined(this.XLEdit.getPropertyValue(o[l].rowIndex,0,"wrapRow"))&&this.XLEdit._updateDataContainer({rowIndex:o[l].rowIndex,colIndex:0},{dataObj:{wrapRow:!0}})),o[l].colIndex===a[3]&&(S=0),C=0}this._setHeightToRows(T,!0),this.model.allowFreezing&&b.frozenRows&&(this.XLFreeze._refreshFRowResize(b.frozenRows-1),this.isImport||this.model.isImport||!b._isLoaded||this.XLFreeze._refreshSelection()),this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this.model.scrollSettings.allowScrolling&&this.XLScroll._getRowHeights(f,o[0].rowIndex+1,null,!0),(!b._isImported||b._isLoaded)&&(s={sheetIndex:f,selectedCell:o,reqType:"textwrap",operation:i,range:g},this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(f,"refresh","all"),this.model.allowSelection&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this._isUndoRedo||this._dupDetails||(this._completeAction(s),this._trigActionComplete(s)))}}},_getWrapCellHeight:function(e,t,i,r){var l,n,s,o,a=0,d=0,h=this.getSheet(e),c=h.rowsHeightCollection,u=h.columnsWidthCollection;if(n=this.XLEdit.getPropertyValue(t,i,"merge"),a=c[t],d=u[i],n){for(l=t+1;l<t+n.mSpan.rowSpan;l++)a+=c[l];for(l=i+1;l<i+n.mSpan.colSpan;l++)d+=u[l]}return n?(a=this._getRowHeight(t,e),s=r||a):(o=h._wrapValColl.rows[t]&&h._wrapValColl.rows[t][i]?this._detailsFromGlobalSpan(t,i,"height",this.XLEdit.getPropertyValue(t,i,"value2"),d):this.model.rowHeight,a=s=(s=r||o)<this.model.rowHeight?this.model.rowHeight:s),{cellHt:s,rowHt:a}},_wrapTextLenCln:function(t,i,r,l){var n,s,o,a,d,h,c=t.length-1,u=this.getRangeData({range:[t[0].rowIndex,t[0].colIndex,t[c].rowIndex,t[c].colIndex],property:["value2","formats","altTxt","type"]}),g=t[c].rowIndex-t[0].rowIndex,p=t[c].colIndex-t[0].colIndex,m=0,_=i.columnsWidthCollection,f=0,b=!1,C=0;if(this.model.scrollSettings.allowVirtualScrolling&&(g=g>i._virtualBlockRowCnt?this._getRowIdx(i._virtualContBlockIdx*i._virtualBlockRowCnt+(i._virtualBlockRowCnt-1),l,!0):g),"isFitWidth"===r&&(b=!0),"msie"===this._browserDetails.name&&"8.0"===this._browserDetails.version)for(a=e("#"+this._id+"_emptySpan"),h={},n=0;n<=g;n++)for(s=0;s<=p;s++)h={},u[m].value2&&(b||(f=i._wrapValColl.rows[t[m].rowIndex]?this._getObjectValues(i._wrapValColl.rows[t[m].rowIndex])[0]:_[t[m].colIndex]),u[m].formats?(h["font-size"]=u[m].formats["font-size"]?u[m].formats["font-size"]:"11pt",h["font-family"]=u[m].formats["font-family"]?u[m].formats["font-family"]:"Calibri",h["font-weight"]=u[m].formats["font-weight"]?u[m].formats["font-weight"]:"normal"):h={"font-size":"11pt","font-family":"Calibri","font-weight":"normal"},a.css(h),o=a.text(u[m].value2).width(),!b&&"wrap"!=r&&i._wrapColl[t[m].rowIndex]&&i._wrapColl[t[m].rowIndex][t[m].colIndex]<=this.model.rowHeight&&_[t[m].colIndex]<o&&this._wrapCollection(t[m].rowIndex,t[m].colIndex,this._detailsFromGlobalSpan(t[m].rowIndex,t[m].colIndex,"height",u[m].value2,_[t[m].colIndex]),l),(f<o||u[m].altTxt)&&(f=o,b?(i._wrapValColl.cols[t[m].colIndex]={},i._wrapValColl.cols[t[m].colIndex][t[m].rowIndex]=o):(i._wrapValColl.rows[t[m].rowIndex]={},i._wrapValColl.rows[t[m].rowIndex][t[m].colIndex]=o))),m++;else for(n=0;n<=g;n++)for(s=0;s<=p;s++)d=!0,u[m].value2&&(b||(f=_[t[m].colIndex]),o=this._getTextContentWidth(u[m],"accounting"==u[m].type?e.trim(u[m].value2):u[m].value2),"wrap"==r&&i._wrapValColl.rows[t[m].rowIndex]&&i._wrapValColl.rows[t[m].rowIndex][C]>o&&(d=!1),!b&&"wrap"!=r&&i._wrapColl[t[m].rowIndex]&&i._wrapColl[t[m].rowIndex][t[m].colIndex]<=this.model.rowHeight&&_[t[m].colIndex]<o&&this._wrapCollection(t[m].rowIndex,t[m].colIndex,this._detailsFromGlobalSpan(t[m].rowIndex,t[m].colIndex,"height",u[m].value2,_[t[m].colIndex]),l),f<o&&d&&(f=o,b?(i._wrapValColl.cols[t[m].colIndex]={},i._wrapValColl.cols[t[m].colIndex][t[m].rowIndex]=o):(i._wrapValColl.rows[t[m].rowIndex]={},i._wrapValColl.rows[t[m].rowIndex][t[m].colIndex]=o,C=t[m].colIndex))),m++},_getTextContentWidth:function(e,i){var r,l="";return r=document.createElement("canvas").getContext("2d"),t.isNullOrUndefined(e.formats)?l="11pt Calibri":(e.formats["font-weight"]&&(l+=e.formats["font-weight"]+" "),l+=e.formats["font-size"]?e.formats["font-size"]+" ":"11pt ",l+=e.formats["font-family"]?e.formats["font-family"]+" ":"Calibri "),r.font=l,r.measureText(i).width+5},_updateWrapCol:function(t,i,r,l,n){var s,o,a,d,h,c;if("wrap"===t)this._wrapTextLenCln(i,r,t,l);else for(s=r._wrapColl,o=i.length,a=i[0].rowIndex;a<=i[o-1].rowIndex;a++){if("unwrap"===t)for(r._wrapValColl.rows[a]&&delete r._wrapValColl.rows[a],s=e.extend(!0,{},r._wrapColl),d=i[0].colIndex;d<=i[o-1].colIndex;d++)s[a]&&s[a][d]&&delete s[a][d];if(s[a])for(c=(h=this.getObjectKeys(s[a])).length,d=0;d<c;d++)this._wrapTextLenCln([{rowIndex:a,colIndex:h[d]}],r,t,l)}"updatecellvalue"===t&&(this._isRowViewable(l,n)&&(this.getRows(l)[1][this._getRowIdx(n)].style.height=r.rowsHeightCollection[n]+"px"),this.model.allowSelection&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement())},_wrapCollection:function(e,t,i,r){var l=this.getSheet(r||this.getActiveSheetIndex());this.model.scrollSettings.allowVirtualScrolling&&e>this._getRowIdx(l._virtualContBlockIdx*l._virtualBlockRowCnt+(l._virtualBlockRowCnt-1),r,!0)||(l._wrapColl[e]||(l._wrapColl[e]={}),l._wrapColl[e][t]=i,l.rowsHeightCollection[e]<i&&!this._isInMrgeRnge(e,t,!l._isLoaded)&&(l.rowsHeightCollection[e]=i,this.model.scrollSettings.allowScrolling&&this.XLScroll._getRowHeights(r,e,!0),this._getRowHdrTBody(r).find('tr[data-idx="'+e+'"]').height(i)))},_isInMrgeRnge:function(e,t,i){if(!i)return this.XLEdit.getPropertyValue(e,t,"merge");var r,l,n=this._getSheetIndex(),s=this._impData?this._impData.model.sheets[n].mergedCells:[];for(s||(s=[]),r=0;r<s.length;r++)if((l=this.getRangeIndices(s[r].range))[0]<=e&&l[2]>=e&&l[1]<=t&&l[3]>=t)return!0;return!1},_setWrapHeight:function(t,i,r,l,n,s){var o,a,d=r[i],h=this.getSheet(t),c=h.rowsHeightCollection;c[i]>0?o=c[i]:(-1===h.hideRowsCollection.indexOf(i)||"visible"===s)&&(a=e(r[i].outerHTML).attr("id","ss"),n[0].insertBefore(a[0],n[0].childNodes[0]),o=n[0].rows[0].getBoundingClientRect().height,n[0].rows[0].parentNode.removeChild(n[0].rows[0])),o=o<20?20:o,parseInt(d.style.height)<o&&(d.style.height=o+"px",e(l[i])[0].style.height=o+"px",h.rowsHeightCollection[i]=o)},_setRowHdrHeight:function(e,t){var i,r=this._getRowIdx(t),l=this.getSheet(e),n=this.getRows(e),s=l.rowsHeightCollection[t];this._isRowViewable(e,t)&&(parseInt(n[0][r].style.height)!=s&&(n[0][r].style.height=s+"px",this.model.allowSelection&&(i=this._intrnlReq,this._intrnlReq=!0,this.XLSelection.refreshSelection(),l._isFreezed&&this.XLFreeze._refreshSelection(),this._intrnlReq=i),(!l._isImported||l._isLoaded)&&this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()))},_refreshRangeTRHght:function(e,t){for(var i=t[0]<1?t[0]:t[0]-1,r=this.getSheet(e),l=i;l<=t[2];l++)this._setRowHdrHeight(e,l);this.XLScroll._getRowHeights(e,i),(!r._isImported||r._isLoaded)&&this.model.allowSelection&&this.XLSelection._refreshBorder()},_renderAlertdlg:function(){var i,r,l,n="<div class='e-dlg-btnctnr' id=",s=this._id+"_alertdlg",o={text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._alertOkClick,this),enabled:!0,cssClass:"e-ss-okbtn"};document.getElementById(this._id+"_alertdlg")||(r="<input id="+this._id+"_dialog_Ok ></input><input id="+this._id+"_dialog_Can style= 'margin-left: 10'; ></input>",i="<input id="+this._id+"_dialog_alertOk > </input>",l=e("<div id="+s+" class='e-alertdlg' style= 'display : none;'>"+("<div class='e-alertdlgcontent' id="+s+"_dlgcontent > </div>"+"<div class='e-dlg-btnfields' id="+s+"_dlgbtncontent >"+(n+s+"_condiv >"+r+"</div>")+(n+s+"_alertdiv >"+i+"</div>")+"</div>")+"</div>"),this.element[0].appendChild(l[0]),e("#"+this._id+"_dialog_alertOk").ejButton(o),e("#"+this._id+"_dialog_Ok").ejButton(o),e("#"+this._id+"_dialog_Can").ejButton({text:this._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._alertCanClick,this)}))},alert:function(t){var i=e("#"+this._id+"_alertdlg");this._renderAlertDlgContent(i,"Alert",t),i.ejDialog("open")},_renderAlertDlgContent:function(e,i,r,l,n,s){var o=e.find("#"+this._id+"_alertdlg_dlgcontent"),a=e.find("#"+this._id+"_alertdlg_condiv"),d=e.find("#"+this._id+"_alertdlg_alertdiv");this._tabMode||this._phoneMode?n>this._responsiveWidth/1.2&&(n=this._responsiveWidth/1.2):n=n||400,s=s||"","Alert"===i?(a.hide(),d.show()):(a.show(),d.hide()),o.text(""),o.html(r),e.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,enableAnimation:!1,allowKeyboardNavigation:!1,title:this._getLocStr("Title"),width:n,height:"auto",minHeight:0,cssClass:"e-ss-dialog e-"+this._id+"-dlg"+s,open:t.proxy(this._alertDlgOpen)}),this._alertDialog={element:e,action:l}},_alertDlgOpen:function(){this.element.find("input:visible:first").focus()},_alertOkClick:function(){var t,i,r=this.getActiveSheetIndex(),l=this._isUndoRedo;switch(this._alertDialog.element.ejDialog("close"),this._alertDialog.action){case"findPrevComment":this.gotoPage(this.model.sheetCount,!1),t=this.model.sheets[this.model.sheetCount],this.XLComment._updateCurrentCell(t.rowCount-1,t.colCount-1),this.XLComment.findPrevComment(),this._alertDialog.action=null;break;case"findNextComment":this.gotoPage(1,!1),this.XLComment._updateCurrentCell(0,0),this.XLComment.findNextComment(),this._alertDialog.action=null;break;case"sheetRenameActn":e("#"+this._id+"_Sheet_RenamePanel").select().focus();break;case"sheetDeleteActn":this._removeSheet(r),this._alertDialog.action=null;break;case"New":this.blankWorkbook();break;case"Open":e("#"+this._id+"_file .e-uploadinput").click();break;case"MergeCells":this._mergeCells(r,this.model.sheets[r]._selectedCells,{},[]),this._alertDialog.action=null;break;case"MergeAcrossCells":this._mergeAcrossCells(r,this.model.sheets[r]._selectedCells),this._alertDialog.action=null;break;case"MergeInsertDelete":this._refreshMergeCells(),this._alertDialog.action=null;break;case"InvalidChartTitleActn":e("#"+this._id+"_chartnamedlg").find("input:first").focus();break;case"ConvertToRange":this.XLFormat._convertToRange({});break;case"TotalRow":this._isUndoRedo=this._dupDetails=!0,this.insertEntireRow(this._insRows.startRow,this._insRows.endRow),this.XLFormat._calculateTotalRow(r,null,!0,!1,!0),this._isUndoRedo=l;break;case"Drop":i=this.getSheet(r),this.XLDragDrop.moveRangeTo([i._startCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex],[this._dStartCell.rowIndex,this._dStartCell.colIndex,this._dEndCell.rowIndex,this._dEndCell.colIndex]),i._startCell=this._dStartCell,i._endCell=this._dEndCell,this._trigger("drop",{sheetIndex:r,target:this.XLDragDrop._target,currentCell:this.XLDragDrop._dragAndDropCell,dragAndDropRange:{startCell:i._startCell,endCell:i._endCell}});break;case"FormulaAlert":this.XLEdit._editElem.focus();break;case"NMUniqueNameAlert":case"NMNameAlert":document.getElementById(this._id+"_nmgridname")&&document.getElementById(this._id+"_nmgridname").focus();break;case"NMRangeAlert":document.getElementById(this._id+"_nmgridrefersto")&&document.getElementById(this._id+"_nmgridrefersto").focus();break;case"OpenValDlg":e("#"+this._id+"_ValDialog").ejDialog("open");break;case"cellStyleAlert":this._showDialog(this._id+"_CustomCellDialog");break;case"multipleArrayFormula":var n=this.XLEdit._editCell,s=this.getActiveCell(r).rowIndex,o=this.getActiveCell(r).colIndex,a=this.XLEdit.getPropertyValue(s,o,"value2");this.element.find("#"+this._id+"_Edit").hide(),this.XLEdit._refreshTextNode(n[0],a),this.model.showRibbon&&this.XLRibbon._enableRibbonIcons(),this._formulaArray=!0,this.model.allowFormulaBar&&this.updateFormulaBar(),this._formulaArray=!1,this.XLEdit._isEdit=!1;break;default:this._setSheetFocus()}},blankWorkbook:function(){var t;this._isNew=!0,this._destroy(),this._dataContainer.sheets[1]={},this.clearUndoRedo(),this._updateCellType(),this.model.sheetCount=1,this.model.activeSheetIndex=1,this._sheetSettings(1),this._newSIndex++,this._initCSSTag(),this.gotoPage(1,!1),this.model.allowLockCell&&this.protectSheet(!1),(t=e("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").data("ejToggleButton"))&&(t.option("toggleState",!1),this.model.exportSettings.password=null,e("#"+this._id+"_AddSheet").removeClass("e-disable")),this.XLRibbon._toggleFormatTab(),this.XLRibbon._toggleChartDesignTab(),this.XLRibbon._toggleAnalyzeTab(),this._refreshSpreadSheetPager(),this.hideWaitingPopUp(),this._isNew=!1},_alertCanClick:function(){var t,i=this._alertDialog;switch(("findNextComment"==i.action||"findPrevComment"==i.action)&&e(this.getActiveCellElem()).find(".e-comment-txtarea").css("display","inline-table"),"TotalRow"==i.action&&e("#"+this._id+"_Ribbon_Design_TableStyleOptions_TotalRow").length&&(this.XLRibbon._isSetModel=!0,e("#"+this._id+"_Ribbon_Design_TableStyleOptions_TotalRow").data("ejCheckBox").option("checked",!1),this.XLRibbon._isSetModel=!1),i.element&&i.element.ejDialog("close"),i.action){case"Drop":t=this.getSheet(this.getActiveSheetIndex()),this.performSelection(t._startCell,t._endCell)}this.hideWaitingPopUp()},_showAlertDlg:function(t,i,r,l,n){var s,o=e("#"+this._id+"_alertdlg"),a="Alert",d={reqType:"alert",action:r};if(i instanceof Array?"SheetRenameEmptyAlert"===i[0]?s="<ul><li>"+this._getLocStr(i[0])+"</li><li>"+this._getLocStr(i[1])+"</li><li>"+this._getLocStr(i[2])+"\\ / ? * ["+this._getLocStr("OR")+"  ] </li><li>"+this._getLocStr(i[3])+"</li></ul>":"ClipboardAccessError"===i[0]&&(s=this._getLocStr(i[0])+"<br /><br />"+this._getLocStr(i[1])+"  = Ctrl + X <br />"+this._getLocStr(i[2])+"  = Ctrl + C <br />"+this._getLocStr(i[3])+"  = Ctrl + V"):(s=0===i.indexOf("T-")?i.slice(2):this._getLocStr(i))||(s=i),this._trigActionBegin(d))return this._alertDialog.action=r,void this._alertCanClick();t===a?this._renderAlertDlgContent(o,a,s,r,l,n):this._renderAlertDlgContent(o,"",s,r,l,n),o.ejDialog("open")},_isSheetsDirty:function(){var e=1,t=this._dataContainer.sheets,i=this.getObjectLength(t)+1;if(this.model.nameManager.length||this.getObjectLength(t)>1)return!0;for(;e<i;){if(this.getObjectLength(t[e]))return!0;e++}return!1},getCell:function(t,i,r){r=this._getSheetIndex(r);var l=0,n=this.getSheet(r);return this.model.scrollSettings.allowVirtualScrolling&&(l=1,-1===(t=this._getRowIdx(t,r)))?null:(this.isImport||this.model.isImport||n._isImported||this._isPrint)&&this._detachTable?e(this._detachTable[0].tBodies[l].rows[t].cells[i]):this._getContTBody(r)?e(this._getContTBody(r)[0].rows[t].cells[i]):null},getRange:function(i,r,l){r=this._getSheetIndex(r);var n,s,o,a,d,h,c,u=(i=this._getRangeArgs(i,"object",r))[0],g=i[1],p=i[2],m=i[3],_=[],f=this.getSheet(r);if(o=(this.isImport||this.model.isImport||f._isImported)&&this._detachTable?e(this._detachTable[0].tBodies[1].rows):e(this._getContTBody(r)[0].rows),u>p&&(d=u,u=p,p=d),g>m&&(d=g,g=m,m=d),this.model.scrollSettings.allowVirtualScrolling)for(n=u;n<=p;n++)(s=this._getRowIdx(n))>-1&&(a=e(o[s].cells),c=m===g?[a[m]]:"8.0"===this._browserDetails.version?a.slice(g,m+1).toArray():a.slice(g,m+1),t.merge(_,c));else for(h=(o=p!==u?o.slice(u,p+1):o.eq(p)).length,n=0;n<h;n++)l&&this._isHiddenRow(n,r)||(a=e(o[n].cells),c=m===g?[a[m]]:"8.0"===this._browserDetails.version?a.slice(g,m+1).toArray():a.slice(g,m+1),t.merge(_,c));return e(_)},getRangeIndices:function(e){var t,i=(e=(e=-1===e.indexOf(":")?e+":"+e:e).replace(/\$/g,"")).split(":"),r=[];return t=i[0].split(/[A-Z]/i),r.push(parseInt(t[t.length-1])-1),r.push(this._generateColCount(i[0].split(/[0-9]/)[0].toUpperCase())-1),t=i[1].split(/[A-Z]/i),r.push(parseInt(t[t.length-1])-1),r.push(this._generateColCount(i[1].split(/[0-9]/)[0].toUpperCase())-1),this.swapRange(r),r},swapRange:function(e){return e[0]>e[2]&&t.dataUtil.swap(e,0,2),e[1]>e[3]&&t.dataUtil.swap(e,1,3),e},updateRange:function(e,t){this._updateRangeValue(e,t,!t.range)},_updateRangeValue:function(e,t,r){var l;if(!this.model.isReadOnly){var n,s,o,a,d,h,c,u,g,p=[],m=[],_=t.dataSource,f=_.length,b=this.getObjectLength(_[0]);if(c=t.startCell,t.range?p=t.range:(h=c.split(/[A-Z]/i),p.push(parseInt(h[h.length-1])-1),p.push(this._generateColCount(c.split(/[0-9]/)[0].toUpperCase())-1),p.push(p[0]+f-(t.showHeader?0:1)),p.push(p[1]+b-1)),u=this._getSelectedRange({rowIndex:p[0],colIndex:p[1]},{rowIndex:p[2],colIndex:p[3]}),d=this._getContent(e),g=this._getJSSheetContent(e).find(".e-spreadsheetcontentcontainer > .e-content >table"),this.model.allowAutoCellType&&this.model.allowCellType||g.detach(),t.showHeader)for(a in _[0])m.push(a);for(s=0;s<f;s++)if(_[s]!=i)for(a in _[0])m.push(_[s][a]);for(this._dupDetails=!0,n=0,o=u.length;n<o;n++)this.XLEdit._updateCell(u[n],m[n],e),t.showHeader&&n<b&&(p=t.startCell+":"+(this._generateHeaderText(u[u.length-1].colIndex+1)+(u[0].rowIndex+1)),t.headerStyles&&this.XLFormat.format({style:t.headerStyles},p));if(r&&(this.model.sheets[e].rangeSettings.push(t),this._initRangeSettings(e),t.count=t._jsonData.length,this._isPublic=!0,this._initDataRange(e),this._isPublic=!1),this._dupDetails=!1,this.model.allowAutoCellType&&this.model.allowCellType||d.find(".e-content").append(g),this._isUndoRedo||(l={sheetIndex:e,reqType:"update-range",rangeSettings:t,isHighlightData:!1},this._completeAction(l),this._trigActionComplete(l)),l.isHighlightData&&(this._pushHighlightData([u[0].rowIndex,u[0].colIndex,u[u.length-1].rowIndex,u[u.length-1].colIndex]),this.XLClipboard._highLightRange.length&&"hl-data"!=l.operation)){for(o=this.XLClipboard._highLightRange.length,n=0;n<o;n++)this.XLValidate.highlightInvalidData(this.XLClipboard._highLightRange[n]);this.XLClipboard._highLightRange=[]}}},editRange:function(t,i){var r,l,n,s,o,a,d,h,c=this.getActiveSheetIndex(),u=this.getSheet(c).rangeSettings[t],g=this.getRangeIndices(u.range),p=this.getRange(g);for(this._trigger("editRangeBegin",{range:u,sheetIndex:c}),u.cssClass&&p.addClass(u.cssClass),u.readOnly&&p.addClass("e-readonly"),o=this._getContent(c),(d=this._getJSSheetContent(c).find(".e-spreadsheetcontentcontainer > .e-content >table")).detach(),r=0,n=p.length;r<n;r++)s=p[r],h=e(s),e.trim(t).length&&this.XLEdit._updateDataContainer({rowIndex:s.parentNode.rowIndex,colIndex:s.cellIndex},{dataObj:{range:t}}),"string"==typeof(a=i(s,s.cellIndex,r))?this.XLEdit._updateCell({rowIndex:s.parentNode.rowIndex,colIndex:s.cellIndex},a):"object"==typeof a&&(0!==a.Value.indexOf("=")?this.XLEdit._updateCell({rowIndex:s.parentNode.rowIndex,colIndex:s.cellIndex},a.Value):this.XLEdit._updateCellValue({rowIndex:s.parentNode.rowIndex,colIndex:s.cellIndex},a.Value),h.data("value2",a.Value2),h.data("type",a.NumberFormat),a.StyleIndex>1&&h.addClass(this._styleColl[a.StyleIndex]));for(o.find(".e-content").append(d),l=g[0];l<g[2]+1;l++)this._setRowHdrHeight(c,l);this._trigger("editRangeComplete",{range:u,sheetIndex:c}),this.XLScroll._getRowHeights(c,g[0])},removeRange:function(e){this.clearRange(e),delete this.getSheet(this.getActiveSheetIndex()).rangeSettings[e]},clearRange:function(e){if(!this.model.isReadOnly){var t,i,r=this.getSheet(this.getActiveSheetIndex()).rangeSettings[e];t=this.getRangeIndices(r.range),i=this.getRange(t),r.cssClass&&i.removeClass(r.cssClass),r.readOnly&&i.removeClass("e-readonly"),this.clearRangeData(null,["range","value","type","value2"],i),i.empty()}},getObjectLength:function(e){var t,i=0;if(e=Object.prototype.toString.call(e)===Object.prototype.toString()?e:{},Object.keys)return Object.keys(e).length;for(t in e)e.hasOwnProperty(t)&&i++;return i},getObjectKeys:function(e){var t,i=[];if(e=Object.prototype.toString.call(e)===Object.prototype.toString()?e:{},!Object.keys){for(t in e)e.hasOwnProperty(t)&&i.push(t);return i}if(Object.keys)return Object.keys(e)},toArrayLowerCase:function(e){for(var t=0;t<e.length;t++)e[t]=e[t].toString().toLowerCase();return e},_isValueAlreadyExist:function(e,t,i){for(var r=0,l=e.length;r<l;){if(e[r][t]===i)return!0;r++}return!1},addClass:function(e,t){if(e&&"svg"!==e.localName&&"path"!==e.localName&&"rect"!==e.localName){(e instanceof jQuery||e instanceof Array)&&(e=e[0]);var i=e.className;-1===i.indexOf(t)&&(e.className=i+" "+t)}},_removeClass:function(e,t){e&&((e instanceof jQuery||e instanceof Array)&&(e=e[0]),e.className=t?e.className.replace(new RegExp(t,"g"),"").replace(/ +/g," "):"")},_hasClass:function(e,t){return!!e&&((e instanceof jQuery||e instanceof Array)&&(e=e[0]),!(!e||this._isAnimatedString(e.className))&&e.className.indexOf(t)>-1)},isUndefined:function(e){return e===i},_isString:function(e){return"string"==typeof e},_isEmptyString:function(e){return!e.toString().length},_isObject:function(e){return"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)},_getObjectValues:function(e){var t,i=[];for(t in e=Object.prototype.toString.call(e)===Object.prototype.toString()?e:{})e.hasOwnProperty(t)&&i.push(e[t]);return i},_isAnimatedString:function(e){return"[object SVGAnimatedString]"===Object.prototype.toString.call(e)},_isBool:function(e){return"TRUE"===(e=(e+="").toUpperCase())||"FALSE"===e},isRange:function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},_isMultiRange:function(e){return!this._isString(e)&&!this.isNumber(e[0])},inRange:function(e,t,i){return e&&t>=e[0]&&t<=e[2]&&i>=e[1]&&i<=e[3]},_inRow:function(e,t){return e&&t>=e[0]&&t<=e[2]},_inColumn:function(e,t){return e&&t>=e[1]&&t<=e[3]},_isUniqueRange:function(e,t){return e.toString()===t.toString()},_isUniqueTarget:function(e,t){var i=this._getOriginalEvt(t),r=document.elementFromPoint(i.clientX,i.clientY);return e.target===r},_getClientDiff:function(e,t){return{x:e[0]-t[0],y:e[1]-t[1]}},hasSpan:function(e){return!!this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"merge")},_isFrozen:function(e){return e>0},_isSelected:function(t){return!!(this._hasClass(t,"e-selected")||this._hasClass(t,"e-rowselected")||this._hasClass(t,"e-colselected")||e(t).parents(".e-colselected").length)},_getMergedIdx:function(e,t){var i,r,l,n,s,o,a,d,h,c=this.getActiveSheetIndex(),u=this.XLEdit.getPropertyValue(e,t,"merge",c);if(d=h=0,u){if(u.mRange){if(i=this.getRangeIndices(u.mRange),(a=this.getSheet(c)).hideRowsCollection.length&&(r=i[0],(l=i[2])-r>1))for(o=r+1;o<l;)this.XLEdit.getPropertyValue(o,0,["isRHide"],c)&&d++,o++;if(this.getObjectLength(a.hideColsCollection)&&(n=i[1],(s=i[3])-n>1))for(o=n+1;o<s;)this.XLEdit.getPropertyValue(0,o,["isCHide"],c)&&h++,o++}if(u.mSpan)return{rowIndex:e+u.mSpan.rowSpan+d-1,colIndex:t+u.mSpan.colSpan+h-1}}return{rowIndex:e,colIndex:t}},_getMergeParent:function(e,t){var i=this.XLEdit.getPropertyValue(e,t,"mergeIdx");return i?{rowIndex:i.rowIndex,colIndex:i.colIndex}:{rowIndex:e,colIndex:t}},_getCellInfo:function(e,t){var i,r,l,n,s,o=this.getSheet(this._getSheetIndex(t)),a=0,d=0;if(i=this.model.allowFreezing&&e.rowIndex>=o._frozenRows?o._rowHeightCollection[e.rowIndex]-(o._rowHeightCollection[o._ftopRowIdx]-o._rowHeightCollection[o._frozenRows-1]):o._rowHeightCollection[e.rowIndex],r=this.model.allowFreezing&&e.colIndex>=o._frozenColumns?o._colWidthCollection[e.colIndex]-(o._colWidthCollection[o._fleftColIdx]-o._colWidthCollection[o._frozenColumns-1]):o._colWidthCollection[e.colIndex],l=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"merge")){for(n=l.mSpan,s=0;s<n.rowSpan;s++)d+=-1===o.hideRowsCollection.indexOf(e.rowIndex+s)?o.rowsHeightCollection[e.rowIndex+s]:0;for(s=0;s<n.colSpan;s++)a+=o.columnsWidthCollection[e.colIndex+s]}else d=-1===o.hideRowsCollection.indexOf(e.rowIndex)?o.rowsHeightCollection[e.rowIndex]:0,a=o.columnsWidthCollection[e.colIndex];return{top:i-1,left:r-1,height:d,width:a}},_getRowIdx:function(e,t,i,r){var l,n=this.getSheet(t);return i?(l=n._rowIdxColl[e],e=this.isUndefined(l)?n._rowIdxColl[n._rowIdxColl.length-1]:l):r?e=-1===(l=n._rowIdxColl.indexOf(e))?e:l:this.model.scrollSettings.allowScrolling&&this.model.scrollSettings.allowVirtualScrolling&&(e=n._virtualRowIdx.indexOf(e)),e},_getMinRowIdx:function(e){for(var t=0;t<e.rowCount;t++)if(-1===e.hideRowsCollection.indexOf(t)&&-1===e._hiddenFreezeRows.indexOf(t))return t;return 0},_arrayAsString:function(e){return e.join(" ").replace(/,/g," ")},_rangeHasData:function(e){var t,i,r;for(e=this.swapRange(e),i=(t=this._getSelectedRange({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[2],colIndex:e[3]})).length;i--;)if(r=t[i],this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex))return!0;return!1},_isTableRange:function(e,t,i){i=this._getSheetIndex(i);var r,l=this.getSheet(i).tableManager;for(r in l)if(this.inRange(l[r].range,e,t))return!0;return!1},_hasCellStyle:function(e,t,i){for(var r=["borders","formats"],l=r.length;l--;)if(this.XLEdit.getPropertyValue(e,t,r[l],i))return!0;return!1},_isHiddenRow:function(e,t){return this.XLEdit.getPropertyValue(e,0,"isFilterHide",t)||this.XLEdit.getPropertyValue(e,0,"isRHide",t)||!1},_refreshViewVar:function(e,i,r){r=this._getSheetIndex(r);var l=this.getSheet(r);t.isNullOrUndefined(e)||(l._topRow.idx=this.XLShape._getCellIndexFromOffset(e,null,r).rowIndex,l._topRow.value=this._getRowOffsetTop(l,l._topRow.idx),l._bottomRow.idx=l._rowIdxColl[l._topRow.idx+(l._virtualBlockRowCnt-this._bufferCnt-1)],l._bottomRow.value=this._getRowOffsetTop(l,l._bottomRow.idx),l.topLeftCell=this.getAlphaRange(l._topRow.idx,l._leftCol.idx)),t.isNullOrUndefined(i)||(l._leftCol.idx=this.XLShape._getCellIndexFromOffset(null,i,r).colIndex,l._leftCol.value=this._getColOffsetLeft(l,l._leftCol.idx),l._rightCol.idx=this.XLShape._getCellIndexFromOffset(null,i+l._vPortWth,r).colIndex||l.colCount-1,l._rightCol.value=this._getColOffsetLeft(l,l._rightCol.idx),l.topLeftCell=this.getAlphaRange(l._topRow.idx,l._leftCol.idx))},_getFormatString:function(e,i){var r=t.Spreadsheet.CellFormat[e];return this.isNumber(i)&&!t.isNullOrUndefined(r)&&(r="{0:"+r.substr(3,1)+i+"}"),r||""},_refreshVrtlBlocks:function(e){e=this._getSheetIndex(e);for(var t,i,r=["_virtualTopTBodyOffset","_virtualContTBodyOffset","_virtualBottomTBodyOffset"],l=this.getSheet(e),n=i=0;n<3;)(n||l._isVirtualTopReached)&&1!==n&&(2!==n||l._isVirtualEndReached)||(t=l._virtualRowIdx[i],l[r[n]].top=this._getRowOffsetTop(l,t),i+=l._virtualBlockRowCnt,t=l._virtualRowIdx[i-1],l[r[n]].bottom=this._getRowOffsetBottom(t,e)),n++;l._virtualTBodyHgt=l._rowHeightCollection[l._rowHeightCollection.length-1]+l.rowsHeightCollection[l.rowsHeightCollection.length-1]},getRangeDataAsObject:function(e,i,r){var l,n,s,o,a,d,h,c,u,g=t.Spreadsheet.CellType,p=this._dataContainer,m=p.sheets[this.getActiveSheetIndex()],_=[],f=[],b=[];for(e.rowIndex>i.rowIndex?(d=i.rowIndex,h=e.rowIndex):(d=e.rowIndex,h=i.rowIndex),e.colIndex>i.colIndex?(c=i.colIndex,u=e.colIndex):(c=e.colIndex,u=i.colIndex);d<=h;){if(!r||!this._isHiddenRow(d)){for(o={},a={},l=c;l<=u;l++)n=this._generateHeaderText(l+1),d in m&&l in m[d]&&(s=m[d][l],o[n]=p.sharedData[s.value],a[n]=-1===[g.General,g.Text].indexOf(p.cellType[s.type])?s.value2:p.sharedData[s.value2]);_.push(o),f.push(a)}d++}return b.push(_),b.push(f),b},getRangeDataAsJSON:function(e,i,r,l){var n,s,o,a,d,h,c,u,g,p=t.Spreadsheet.CellType,m=this._dataContainer,_=m.sheets[l||this.getActiveSheetIndex()],f=[],b=!0,C=[];for(e.rowIndex>i.rowIndex?(d=i.rowIndex,h=e.rowIndex):(d=e.rowIndex,h=i.rowIndex),e.colIndex>i.colIndex?(c=i.colIndex,u=e.colIndex):(c=e.colIndex,u=i.colIndex);d<=h;){if(!r||!this._isHiddenRow(d)){for(a={},n=c;n<=u;n++)b?d in _&&n in _[d]&&(o=_[d][n],C[n]=this.isUndefined(o.type)||-1!==[p.General,p.Text].indexOf(m.cellType[o.type])?m.sharedData[o.value2]:o.value2):(s=C[n],d in _&&n in _[d]?(o=_[d][n],g=this.isUndefined(o.type)||-1!==[p.General,p.Text].indexOf(m.cellType[o.type])?m.sharedData[o.value2]:[p.Currency,p.Accounting,p.Percentage].indexOf(m.cellType[o.type])>-1?m.sharedData[o.value]:o.value2,a[s]=t.isNullOrUndefined(g)?"":this.isNumber(g)?parseInt(g):g):a[s]="");!b&&this.getObjectLength(a)&&f.push(a)}d++,b&&(b=!1)}return f},_getColorFromFormat:function(e){var i,r,l,n=[];return t.isNullOrUndefined(e)||(r=(i=e.replace("e-format","").toLowerCase()).startsWith("6n")?"#"+i.substr(2,6):"#"+i.substr(6,6),l="#"+i.substr(0,6),n.push(l),n.push(r)),n},getRangeData:function(e){(e=e||{}).sheetIdx=this._getSheetIndex(e.sheetIdx),e.range=this._toIntrnlRange(e.range,e.sheetIdx),e.property=e.property||["value","value2","type","formatStr","decimalPlaces","thousandSeparator","range","format","border","comment","hyperlink","picture","cFormatRule","rule","chart","isLocked","wrap","formats","cellType","altTxt"];var i,r,l,n,s,o,a,d=0,h=[],c=[],u=this.getSheet(e.sheetIdx);if(e.rowIdxs)for(i=e.rowIdxs.length;d<i;)this._pushRowData(e,e.rowIdxs[d],0,u.colCount-1,c,h),d++;else for(a=!1,this.model.scrollSettings.allowVirtualScrolling&&e.skipHiddenRow&&!t.isNullOrUndefined(e.virtualRowIdx)?(a=!0,n=(l=e.virtualRowIdx)+(e.virtualRowCount-1),s=u.colCount-1):(l=e.range[0],n=e.range[2],s=e.range[3]);l<=n;)o=this._isHiddenRow(l,e.sheetIdx),a&&o?n++:e.skipHiddenRow&&o||(r=a?0:e.range[1],this._pushRowData(e,l,r,s,c,h,!0)),l++;return e.withRowIdx?{rowIdx:h,data:c}:c},_pushRowData:function(e,t,i,r,l,n,s){var o,a,d,h,c="value",u=this._intrnlUpdate,g=this._dataContainer,p=g.sheets[e.sheetIdx];if(s||this.XLEdit._refreshContainer(t,e.sheetIdx),p[t])if(e.valueOnly)for(;i<=r;)o="",(h=p[t][i])&&c in h&&(o=g.sharedData[h[c]],e.skipDateTime&&this._isDateTime(o)?o=this.XLEdit.getPropertyValue(t,i,"value2",e.sheetIdx):e.skipFormula&&this.isFormula(o)&&(o=this.XLEdit.getPropertyValue(t,i,"calcValue",e.sheetIdx)||this.XLEdit.getPropertyValue(t,i,"value2",e.sheetIdx),this.isUndefined(o)&&(o=this.XLEdit.getPropertyValue(t,i,"value2",e.sheetIdx),o=this.XLEdit._parseValue(o).value))),e.skipEmptyCell&&(this.isUndefined(o)||!o.toString().length)||l.push(o),i++;else{for(this._intrnlUpdate=!0;i<=r;){if(h=p[t][i]){for(d in a={},h)e.property.indexOf(d)>-1&&(a[d]=this.XLEdit.getPropertyValue(t,i,d,e.sheetIdx));(!e.skipEmptyCell||this.getObjectLength(a))&&l.push(a)}else e.skipEmptyCell||l.push({});i++}this._intrnlUpdate=u}else if(!e.skipEmptyCell)for(;i<=r;)e.valueOnly?l.push(""):l.push({}),i++;n.push(t)},_processBindings:function(e){if(this.model.query=new t.Query,this._trigger("actionBegin",e))return!0;if(this._ensureDataSource(e),"sorting"===e.action){if(this.XLSort._sortComplete(e),this._isUndoRedo||(this._completeAction(e),this._trigActionComplete(e)),e.isHighlightData&&(this._pushHighlightData([e.range[0],e.range[1],e.range[2],e.range[3]]),this.XLClipboard._highLightRange.length&&"hl-data"!=e.operation)){for(var i=0,r=this.XLClipboard._highLightRange.length;i<r;i++)this.XLValidate.highlightInvalidData(this.XLClipboard._highLightRange[i]);this.XLClipboard._highLightRange=[]}}else this._completeAction(e),this._trigActionComplete(e)},_ensureDataSource:function(e){var r,l,n,s,o,a,d,h,c,u,g=this.getActiveSheetIndex(),p=this.getSheet(g);if("filtering"===e.action||"clearfiltering"===e.action||"filterbycell"===e.requestType){for(r=null==p.filterSettings.filteredRange?this._dataSource(g):p.filterSettings.filteredRange,c=0,u=(h=p.filterSettings.tableRange).length;c<u;c++)if(h[c].tableID===e.tableID){h[c].filteredRange=r;break}if(this._dataManager=t.DataManager(r),r instanceof t.DataManager||(this.model.currentViewData=r),this.model.query.requiresCount(),e.filteredcolumns.length){for(n in o=this._excelFilter._predicates[g],l=r[0],o)l.hasOwnProperty(n)&&(a=o[n]),a=o[n],s=s!=i?s.and(a):a;t.isNullOrUndefined(s)||this.model.query.where(s),r instanceof t.DataManager||(d=this._dataManager.executeLocal(this.model.query),this._filteredRecordsCount=d.count,this.model.currentViewData=d.result)}}else"sorting"===e.requestType&&(this._dataManager=t.DataManager(e.rangeData),e.rangeData instanceof t.DataManager||(this.model.currentViewData=e.rangeData),this.model.query.sortBy(e.columnName,e.sortDirection),e.rangeData instanceof t.DataManager||(d=this._dataManager.executeLocal(this.model.query),this.model.currentViewData=d));this._dataManager=null},_toArrayData:function(e){for(var t,i,r=0,l=[],n=e.length;r<n;){if(i=e[r],this.getObjectLength(i))for(t in i)l.push(i[t]);else l.push("");r++}return l},_updateRangeStyle:function(e,t,i){for(var r=this._getSelectedRange({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[2],colIndex:e[3]}),l=0;l<r.length;l++)this.model.allowCellFormatting&&this.XLFormat._hasFormat(t[l].format)&&(this.XLFormat._updateFormatClass(r[l],t[l].format),this.XLEdit._updateDataContainer(r[l],{dataObj:{formats:t[l].formats},sheetIdx:this.getActiveSheetIndex(),status:i}))},updateRangeData:function(e,i){var r,l,n;if(!this.model.isReadOnly&&((e=this._getRangeArgs(e,"object")).length&&(e.startCell={rowIndex:e[0],colIndex:e[1]},e.endCell={rowIndex:e[2],colIndex:e[3]}),r=this._getSelectedRange(e.startCell,e.endCell),(l=this._toArrayData(i)).length===r.length))for(n=0;n<r.length;n++)t.isNullOrUndefined(l[n])||this.XLEdit._updateCellValue(this.getCell(r[n].rowIndex,r[n].colIndex),l[n])},dataSource:function(e,t){var i,r,l,n=this.getActiveSheetIndex(),s=this.getSheet(n);if(this._isDataSrcMethod=!0,e.dataSource)for(s.rangeSettings=[],s._virtualDataLoadedBlks=[],s._virtualRowIdx=[],s.dataSource=e,s._dataManager=e,this._isInitLoad=!0,this.model.allowOverflow=!1,s._isVPRendered=!1,s.fieldAsColumnHeader=t||!1,(i=this.getDataSettings(n))._dataManager=e,r=0,l=i.length;r<l;)this._initDataSrc(n,s,i[r]),r++;else s.rangeSettings=[{dataSource:e}],s._isVPRendered=!1,s._virtualRowIdx=[],this._dataContainer.sheets[n]={},s.fieldAsColumnHeader=t||!1,this._initRangeSettings(n),s.rangeSettings[0].count=s.rangeSettings[0]._jsonData.length,s._virtualDataLoadedBlks=[],this.model.scrollSettings.allowScrolling?this._refreshContent(n):this.model.scrollSettings.allowScrolling||(this._initDataRange(n),this._setScrolling(this.model.scrollSettings.allowScrolling)),this.model.scrollSettings.allowVirtualScrolling?this._setVirtualScrolling(!0):this.model.scrollSettings.allowVirtualScrolling||(this._initDataRange(n),s._isDataMoved=!0,this._canOverflow=!1,this._refreshDataSrc(null,n),this._refreshCellData(null,n),this._canOverflow=!0,this._refreshOverflow(),this._setVirtualScrolling(!1));this._isAutoWHMode&&this._setElemDimension()},_setElemDimension:function(){var e=this._getElementDimension();this.element.css({height:e.height,width:e.width})},updateData:function(e,i,r){var l;if(!this.model.isReadOnly){var n,s,o,a,d,h,c,u,g,p,m=0,_="clear-format",f={},b=this._cellProp,C=this.getActiveSheetIndex();for(n=(i=this._getRangeArgs(i,"object"))[0],s=i[2],a=i[3];n<=s;){for(o=i[1];o<=a;){if(u=(g=e[m]).value,h=this.getCell(n,o,C),"wrap"in g&&(c=!0,delete g.wrap),this._ddCellSave){if(l={cellIndex:{rowIndex:n,colIndex:o},value:g.value,sheetIdx:C,reqType:"drag-drop"},this._trigger("cellSave",l))return;l.value?g.value=l.value:delete g.value,u!=l.value&&(g.value2=l.value&&l.value.toString())}this.XLEdit._updateDataContainer({rowIndex:n,colIndex:o},{dataObj:g}),c&&this.setWrapText("wrap",i),c=!1,h&&(b[13]in g&&((p=g.hyperlink)&&(r===_?h.find("a").css({color:this._hlColor,"text-decoration":"underline"}).addClass("e-hyperlinks"):p.webAddr?h.html(t.buildTag("a",g.value2,"",{href:p.webAddr,target:"_blank",class:"e-hyperlinks"})):h.html(t.buildTag("a",g.value2,"",{class:"e-hyperlinks"})))),b[6]in g&&(g.rule.isApply?this.addClass(h[0],"e-hlcell"):this._removeClass(h[0],"e-hlcell")),r===_&&(g.formatStr&&(f.formatStr=g.formatStr),g.type&&(f.type=g.type),t.isNullOrUndefined(g.decimalPlaces)||(f.decimalPlaces=g.decimalPlaces),t.isNullOrUndefined(g.thousandSeparator)||(f.thousandSeparator=g.thousandSeparator),this.XLFormat.format(f,[n,o,n,o])),b[21]in g&&this.XLComment._updateCmntFrmCntnr(n,o),b[0]in g&&(d=g.value,this.XLEdit._refreshCalcEngine(n,o,this.isFormula(d),d))),m++,o++}n++}}},updateUniqueData:function(e,t,i,r){if(!this.model.isReadOnly){var l,n={dataObj:e},s=(t=this._getRangeArgs(t,"object"))[0],o=t[2],a=t[3];for(i&&(n.skipCell=i),n.sheetIdx=r;s<=o;){for(l=t[1];l<=a;)this.XLEdit._updateDataContainer({rowIndex:s,colIndex:l},n),l++;s++}}},_getCellValue:function(e,t,i){var r=this._dataContainer,l=this._dataContainer.sharedData,n=(i=i||this.getActiveSheetIndex(),r.sheets[i][e]&&r.sheets[i][e][t]);return{value:n&&n.value&&l[n.value],value2:n&&n.value2&&l[n.value2]}},clearRangeData:function(e,i,r,l,n,s){if(!this.model.isReadOnly){var o,a,d,h,c,u,g,p=this.getActiveSheetIndex();for(e=this._getRangeArgs(e,"object",p),i=i||["value","value2","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","isFilterHighlight"],o=e[0],d=e[2],h=e[3];o<=d;){if(!l||!this._isHiddenRow(o))for(a=e[1];a<=h;){if(c={rowIndex:o,colIndex:a},g=this._getCellValue(c.rowIndex,c.colIndex).value,this._overFlowRowIdx=!0,this._isTrigCellSave&&""!=g&&!t.isNullOrUndefined(g)&&i.indexOf("value")>-1&&(u={cellIndex:c,value:"",prevValue:this._getCellValue(c.rowIndex,c.colIndex).value,sheetIdx:p,reqType:"clear"},this._trigger("cellSave",u)))return;this.XLEdit._clearDataContainer({cellIdx:{rowIndex:c.rowIndex,colIndex:c.colIndex},property:i,status:n,skipCell:s}),a++}this._overFlowRowIdx=!1,i.indexOf("wrap")>-1&&this._setRowHdrHeight(p,o),o++}this._isTrigCellSave=!1}},_getArrayRangeCells:function(e){return e?(e=this.swapRange(e),this.getRange(e)):this._getContent(this.getActiveSheetIndex()).find(".e-selected")},_getAlphaRangeCells:function(e){return e?(e=this.getRangeIndices(e),this.getRange(e)):this._getContent(this.getActiveSheetIndex()).find(".e-selected")},_getMultiRangeCells:function(e){var t,i,r,l,n;if(e){if(t=0,r=[],l=[],this._isString(e))l.push(this.getRangeIndices(e));else if(this.isNumber(e[0]))l.push(e);else for(n=e.length;t<n;)i=e[t],l.push(Array.isArray(i)?i:this.getRangeIndices(i)),t++;for(t=0,n=l.length;t<n;)i=l[t],r=r.concat(this._getSelectedRange({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]})),t++}else e=this._getRangeArgs(e,"object"),r=this._getSelectedCells(this.getActiveSheetIndex(),e).selCells;return r},_completeAction:function(e){var i,r,l,n,s,o,a,d,h,c,u,g,p=this.getActiveSheetIndex(),m=this.getSheet(p);if("filter"===e.reqType||"filterbycolor"===e.reqType){if("apply-filter"!==e.operation&&"remove-filter"!==e.operation&&"clearfilter"!==e.operation)for(n=e.model.currentViewData,r={sheetIndex:p,range:m._selectedRange,currentViewData:n,fieldName:e.currentFilteringColumn,ejpredicate:e.ejpredicate,activeCell:e.activeCell,filteredValue:e.filteredValue,filterCollection:e.filteredcolumns,requestType:e.requestType,reqType:e.reqType,selectedCell:e.selectedCell,action:e.action,operation:"filter",selectedDataSource:m.selectedDataSource,tableID:e.tableID,filteredCells:e.filteredCells,fltrdIdxes:[],selRange:e.selRange},c=0,i=n.length;c<i;c++)r.fltrdIdxes.push(r.range.startRow+m.filterSettings.filteredRange.indexOf(n[c]));else r="remove-filter"===e.operation||"clearfilter"===e.operation?e:{sheetIndex:p,filteredCells:e.filteredCells,reqType:"filter",operation:"apply-filter",tableID:e.tableID,fRange:this.getSheet(p).filterSettings.range};r.rowIndex=e.rowIndex,r.colIndex=e.colIndex}else if(e.requestType===t.Spreadsheet.Actions.Sorting){for(h=[],d=e.filterIcon.length>0?e.range[0]-1:e.range[0],c=0;c<e.filterIcon.length;c++)a=this.XLFilter._getFilterHeader(p,d,e.filterIcon[c].colIndex),s=t.isNullOrUndefined(a)?"":a.status.indexOf("-asc")>-1?"-asc":a.status.indexOf("-dsc")>-1?"-dsc":"",o=e.filterIcon[c].colIndex===this._generateColCount(e.columnName)-1?"ascending"===e.sortDirection?"-asc":"-dsc":"",h.push({rowIdx:d,colIdx:e.filterIcon[c].colIndex,prevIcon:s,currIcon:o});r={sheetIndex:p,filterIcons:h,isSortByFilter:e.isSortByFilter,colSelected:e.colSelected,range:e.range,columnName:e.columnName,rangeData:e.rangeData,reqType:"sort",direction:e.sortDirection,operation:"unsort"}}else if("sortbycolor"===e.requestType||"filterbycolor"===e.requestType){if((r={sheetIndex:p,operation:e.operation,oprType:e.oprType,requestType:e.requestType,action:e.action,bgcolor:e.bgcolor,fgcolor:e.fgcolor,tableID:e.tableID,reqType:e.requestType,sortRange:e.sortRange}).columnName="sortbycolor"===e.requestType?e.sortColumn:e.filterColumn,"filterbycolor"===e.requestType){for(g=this._generateColCount(r.columnName),l=[],c=e.range.endRow;c>=e.range.startRow;c--)u=this.XLEdit.getPropertyValue(c,g-1,"formats"),t.isNullOrUndefined(u)||("filterbgcolor"===e.operation?t.isNullOrUndefined(u["background-color"])||e.bgcolor.toLowerCase()===u["background-color"].toLowerCase()&&l.push(c):t.isNullOrUndefined(u.color)||e.fgcolor.toLowerCase()===u.color.toLowerCase()&&l.push(c));r.fltrdIdxes=l,r.rowIndex=e.range.startRow-1,r.colIndex=g-1}}else r=e;!this.model.allowUndoRedo||this._isPublic||"sortbycolor"===r.requestType||this._dupDetails||this.updateUndoRedoCollection(r),("filtering"===e.requestType||"filterbycolor"===e.requestType||"sortbycolor"===e.requestType||"filterbycell"===e.requestType)&&"apply-filter"!==e.operation&&"remove-filter"!==e.operation&&this.sendDataRenderingRequest(r,this.getActiveSheetIndex()),this.model.allowAutoFill&&"find-replace"!==e.reqType&&this.element.find(".e-ss-activeimg").length<1&&!m._isFreezed&&this.XLDragFill.positionAutoFillElement(),!this.model.allowUndoRedo||this._isPublic||this.XLComment&&this.XLComment._isCommentEdit||this._updateUndoRedoIcons(),"paging"!==e.reqType&&"edit"===e.reqType&&e.hasValidation&&this._trigrDdlActnCmplt(e.cValue,e.pValue)},updateUndoRedoCollection:function(e){this._isUndoRedo||"update-range"===e.reqType||(this._undoCollection.push(e),this._redoCollection=[]),this._undoCollection.length>this.undoRedoStep&&this._undoCollection.splice(0,1),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this._updateUndoRedoIcons()},_trigActionBegin:function(e){return!this._isSaveAsJSON&&!this._isRefresh&&this._trigger("actionBegin",e)},_trigActionComplete:function(e){return!this._isSaveAsJSON&&!this._isRefresh&&this._trigger("actionComplete",e)},_updateUndoRedoIcons:function(){if(this.model.showRibbon&&this.model.allowUndoRedo){if(e("#"+this._id+"_Ribbon_Home_Actions_Undo").length&&e("#"+this._id+"_Ribbon_Home_Actions_Redo").length&&!this.model.isReadOnly){var t=e("#"+this._id+"_Ribbon_Home_Actions_Undo").data("ejButton"),i=e("#"+this._id+"_Ribbon_Home_Actions_Redo").data("ejButton");t&&(this._undoCollection.length?t.enable():t.disable()),i&&(this._redoCollection.length?i.enable():i.disable()),this.XLEdit._isEdit||this.XLComment&&this.XLComment._isCommentEdit||this._isSheetRename||!document.activeElement||!(document.activeElement.id.indexOf(this._id+"_Ribbon")<0)||this._setSheetFocus()}}else this.XLComment&&this.XLComment._isCommentEdit||this._setSheetFocus()},_filterMergeCells:function(e,t){for(var i,r,l,n=this.getActiveSheetIndex(),s=this._dataContainer.sheets[n],o=this.getObjectKeys(s[e]),a=!1,d=0;d<o.length;d++)(l=this.XLEdit.getPropertyValue(e,o[d],"mergeIdx"))&&(i=l,a=!0);a&&((r=this.getCell(i.rowIndex,i.colIndex)[0]).rowSpan="incr"===t?r.rowSpan+1:r.rowSpan-1)},_isRowVisible:function(e,t){var i=this._dataContainer.sheets[e];return!(t in i)||!(0 in i[t]&&(i[t][0].isRHide||i[t][0].isFRHide))},_selectFirstCell:function(e,t,i,r){var l=this.getSheet(e);return l._isImported&&!l._isLoaded||r||(r=!r,this.performSelection({rowIndex:t,colIndex:i},{rowIndex:t,colIndex:i})),r},_clearAllMergeCells:function(t,i,r,l,n,s){var o,a,d,h,c,u,g,p=this.getSheet(t),m=!1,_=this._dupDetails,f=p._mergeColl,b=p._unmergeColl,C={isCancel:!1,isAlert:!0};for(this._dupDetails=!0,(d=this.getObjectKeys(f)).length<1&&(m=!0),c=0,u=d.length;c<u;c++)for(h=this.getObjectKeys(f[d[c]]),g=0;g<h.length;g++)o=e.extend(!0,{},this.XLEdit.getPropertyValue(d[c],h[g],"merge")),a=this.getRangeIndices(o.mRange),(C=this._checkFilterMerge(t,a,i,r,l,n,s,"merge",m,d[c],h[g],o)).isClear&&(d[c]in b||(p._unmergeColl[d[c]]={}),p._unmergeColl[d[c]][h[g]]={type:f[d[c]][h[g]],merge:o,isClear:!0},this.unmergeCells(o.mRange,!0)),C.isClear=!1;return this._dupDetails=_,{isCancel:C.isCancel,isAlert:C.isAlert}},_checkFilterMerge:function(e,t,i,r,l,n,s,o,a,d,h,c){var u,g=this._getSelectedCells(e,[i,l,i+r-1,l+n-1]).range,p=!1;return s.indexOf("shift")>-1||"merge"!=o&&(s.indexOf("insert")>-1||s.indexOf("delete")>-1)?("merge"===o&&(this._removeMergeColl=[]),s.indexOf("Bottom")>-1||s.indexOf("Up")>-1||"merge"!=o&&s.indexOf("Row")>-1?(l>=t[1]||t[3]>=l+n-1||s.indexOf("Row")>-1?(i>=t[2]||i<=t[2])&&(l<t[1]&&l+n-1<t[1]?a=!0:l>t[3]&&l+n-1>t[3]?a=!0:this._isTotalRow||l!==t[1]||t[3]!==l+n-1||(p=!0,a=!0),!a&&i>=t[2]&&(a=!0)):l<t[1]&&t[3]<l+n-1&&(a=!0,p=!0),"merge"!==o||this._isUndoRedo||s.indexOf("Up")>-1&&this.XLEdit._rangeHasProperty(g,"merge")&&(this._showAlertDlg("Alert","MergePreventInsertDelete","MergePreventInsertDelete",450),p=!1,u=!0)):(s.indexOf("Right")>-1||s.indexOf("Left")>-1||"merge"!=o&&s.indexOf("Column")>-1)&&(i>=t[0]||t[2]>=i+r-1||s.indexOf("Column")>-1?(l>=t[3]||l<=t[3])&&(i<t[0]&&i+r-1<t[0]?a=!0:i>t[2]&&i+r-1>t[2]?a=!0:i===t[0]&&t[2]===i+r-1&&(p=!0,a=!0),!a&&l>t[3]&&(a=!0)):i<t[0]&&t[2]<i+r-1&&(a=!0,p=!0),"merge"!==o||this._isUndoRedo||s.indexOf("Left")>-1&&this.XLEdit._rangeHasProperty(g,"merge")&&(this._showAlertDlg("Alert","CtrlKeyErrorAlert","CtrlKeyErrorAction",450),p=!1,u=!0)),"merge"!==o||a||p||this._removeMergeColl.push({type:(void 0)[d][h],merge:c})):(this._isUndoRedo&&(a=!0),(-1===i||-1!=i&&t[0]<=i&&t[2]>i)&&(p=!0),(-1===l||-1!=l&&t[1]<=l&&t[3]>l)&&(p=!0)),{isClear:p,isAlert:a,isCancel:u}},_checkTableApplied:function(e,t,i,r,l,n){var s,o,a,d,h=this.getSheet(e).tableManager,c=this.getObjectKeys(h);for(this._isTableApplied=!1,a=0,d=c.length;a<d;a++)if(o=h[c[a]].range,s=this._checkFilterMerge(e,o,t,i,r,l,n,"filter",!1),this._isTableApplied=!s.isAlert,this._isTableApplied)return!0;return!1},_checkChartApplied:function(e,t,i,r,l){for(var n,s,o=0,a=0,d=this.getSheet(e).shapeMngr.chart,h=this.getObjectKeys(d),c=!1,u=0,g=h.length;u<g;u++){for(c=(s=d[h[u]]).isChartSeries,n=s.range;o<l;){if(this._inColumn(n,i)||c&&this.XLChart._isSeriesRange(s,t,i))return!0;i++,o++}for(;a<r;){if(this._inRow(n,t)||c&&this.XLChart._isSeriesRange(s,t,i))return!0;t++,a++}return!1}return!1},_refreshAllMergeCells:function(e,i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f,b=this.getSheet(e),C=!1,S=b._unmergeColl,x=this._dupDetails;for(d=this.getObjectKeys(S),this._dupDetails=!0,m=0,_=d.length;m<_;m++)for(h=this.getObjectKeys(S[d[m]]),f=0;f<h.length;f++)o=b._unmergeColl[d[m]][h[f]].merge,this.mergeCenter="center"===b._unmergeColl[d[m]][h[f]].type,p=b._unmergeColl[d[m]][h[f]].isClear,c=this.getRangeIndices(o.mRange),(i>-1||l>-1)&&(t.isNullOrUndefined(c)||(s.indexOf("Shift")>-1?(this._unMergeRange=o.mRange,this._showAlertDlg("","MergeCellsAlert","MergeCellsInsertAlert",498)):(i>-1&&(c[0]===c[2]&&(C=!0),(!C||p)&&(u=c[0],g=c[2],i<=c[0]&&(u="insert"===s?c[0]+r:c[0]-r),i<=c[2]&&(g="insert"===s?c[2]+r:c[2]-r),u<=g&&(c[0]=u),g>=u&&(c[2]=g))),l>-1&&(c[1]===c[3]&&(C=!0),(!C||p)&&(u=c[1],g=c[3],l<=c[1]&&(u="insert"===s?c[1]+n:c[1]-n),l<=c[3]&&(g="insert"===s?c[3]+n:c[3]-n),u<=g&&(c[1]=u),g>=u&&(c[3]=g))),!C||C&&"insert"===s?(a=this._getAlphaRange(e,c[0],c[1],c[2],c[3]),this.mergeCells(a,!0),delete b._unmergeColl[d[m]][h[f]],C=!1):b._unmergeColl[d[m]][h[f]].isClear=!1)));this._dupDetails=x},_clearMergeColl:function(e,t,i){e[t]&&delete e[t][i],this.getObjectKeys(e[t]).length<1&&delete e[t]},_refreshSHMergeCells:function(i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j,M,V,B,H,X=this.getSheet(i),U=e.extend(!0,{},X._mergeColl),z=0,q=!1,G=[],W=!1;if(S=this.getObjectKeys(U),u=X._isFreezed?"column"===n?X._fHMergeCols:X._fHMergeRows:"column"===n?this.getObjectKeys(X.hideColsCollection):X.hideRowsCollection,"hide"===s)for(j=0,M=S.length;j<M;j++)for(V=0,B=(x=this.getObjectKeys(U[S[j]])).length;V<B;V++)if(g=!1,v=this.XLEdit.getPropertyValue(S[j],x[V],"merge"),!(this.getObjectKeys(v).length<1)){for(w=this.getRangeIndices(v.mRange),b="column"===n?w[1]:w[0],C="column"===n?w[3]:w[2],o=b;o<=C;o++)if(r.indexOf(o)>-1){g=!0;break}if(g){if(this._dupDetails=!0,p=r[0],_=(m=r[r.length-1])-p+1,this.mergeCenter="center"===U[S[j]][x[V]].type,D=(A=U[S[j]][x[V]].oldRange)||v.mRange,this.unmergeCells(v.mRange),m<b)b+=_,C+=_;else{if(C<p)continue;for(z=0,I=!1,L=0,a=r.length,o=0;o<a;o++)r[o]>=b&&r[o]<=C&&z++,r[o]===b&&(I=!0),T="column"===n?r[o].toString():r[o],u.indexOf(T)>-1&&L++;for(r.indexOf(b)>-1&&(I=!0),y=0,H=b;H<=C;H++)"column"===n&&(H=H.toString()),u.indexOf(H)>-1&&y++;(b===C||y===C-b+1)&&(q=!0),I&&!q&&(b=b+z+(y-L))}c=this.XLEdit.getPropertyValue(parseInt(S[j]),parseInt(x[V]),"value2"),R="row"===n?b:w[0],F="row"===n?C:w[2],O="column"===n?b:w[1],E="column"===n?C:w[3],q?S[j]in X._delmergeColl?X._delmergeColl[S[j]][x[V]]={type:U[S[j]][x[V]].type,merge:v,oldRange:D}:(X._delmergeColl[S[j]]={},X._delmergeColl[S[j]][x[V]]={type:U[S[j]][x[V]].type,merge:v,oldRange:D}):(R==F&&O==E?S[j]in X._delmergeColl?X._delmergeColl[S[j]][x[V]]={type:U[S[j]][x[V]].type,merge:v,oldRange:D}:(X._delmergeColl[S[j]]={},X._delmergeColl[S[j]][x[V]]={type:U[S[j]][x[V]].type,merge:v,oldRange:D}):this.mergeCells(this._getAlphaRange(i,R,O,F,E),!0),X._mergeColl[R]&&X._mergeColl[R][O]&&(X._mergeColl[R][O].oldRange=D),this._updateMergeColl(i,R,O,U[S[j]][x[V]].type,"hide"===s),(m+1===R&&"row"===n||m+1===O&&"column"===n)&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(R,O))&&(this.XLEdit.updateCellValue({rowIndex:R,colIndex:O},c),X._wrapColl[parseInt(S[j])]&&X._wrapColl[parseInt(S[j])][parseInt(x[V])]&&(this._wrapCollection(R,O,X._wrapColl[parseInt(S[j])][parseInt(x[V])],i),this._isRowViewable(i,R)?G.push({rowIndex:R,height:X.rowsHeightCollection[parseInt(S[j])]}):X.rowsHeightCollection[R]=X.rowsHeightCollection[parseInt(S[j])]))),this.mergeCenter=!1}}if("show"===s)for(this.getObjectLength(X._delmergeColl)>0&&(U=e.extend(!0,U,X._delmergeColl)),d=(S=this.getObjectKeys(U)).length,j=0;j<d;j++)for(h=(x=this.getObjectKeys(U[S[j]])).length,V=0;V<h;V++){if(g=!1,f=U[S[j]][x[V]].mergeType,v=U[S[j]][x[V]].merge,this.getObjectKeys(v).length<1&&(v=this.XLEdit.getPropertyValue(S[j],x[V],"merge")),this.getObjectKeys(v).length>0){for(w=this.getRangeIndices(v.mRange),b="column"===n?w[1]:w[0],C="column"===n?w[3]:w[2],(A=U[S[j]][x[V]].oldRange)?(N=this.getRangeIndices(A),P="column"===n?N[1]:N[0],k="column"===n?N[3]:N[2]):(P=b,k=C),p=r[0],m=r[r.length-1],o=p;o<=m;o++)if(o>=P&&o<=k){g=!0;break}if(!g)continue;for("merge-cells"===f&&(this._dupDetails=!0,_=m-p+1,m<b&&(this.mergeCenter=v.isCenterAlign,this.unmergeCells(v.mRange),_!=l&&(C-=_),b-=_,R="row"===n?b:w[0],F="row"===n?C:w[2],O="column"===n?b:w[1],E="column"===n?C:w[3],R==F&&O==E||this.mergeCells(this._getAlphaRange(i,R,O,F,E),!0),this._updateMergeColl(i,R,O,U[S[j]][x[V]].type,"hide"===s),X._mergeColl[R][O].oldRange=A)),W=!1,a=r.length,o=0;o<a;o++)if("row"===n&&w[0]<=r[o]||"column"===n&&w[1]<=r[o]){W=!0;break}if(W){for(this.mergeCenter=v.isCenterAlign,this.unmergeCells(v.mRange),w=this.getRangeIndices(v.mRange),_=0,H=b;H<=C&&("column"===n&&(H=H.toString()),u.indexOf(H)>-1);H++)_++;b+=_,"column"===n?w[1]=b:w[0]=b,w[0]==w[2]&&w[1]==w[3]||this.mergeCells(this._getAlphaRange(i,w[0],w[1],w[2],w[3]),!0),this._updateMergeColl(i,w[0],w[1],U[S[j]][x[V]].type,!0),X._mergeColl[w[0]][w[1]].oldRange=A,w[0]==w[2]&&w[1]==w[3]||this._clearMergeColl(X._delmergeColl,S[j],x[V])}}this.mergeCenter=!1}this.model.showRibbon&&this._isScrolling&&this.XLRibbon._updateRibbonIcons(),this._dupDetails=!1},_getSpanFromMCells:function(e,t,i){var r=this.getSheet(this.getActiveSheetIndex())._hideMergeColl;return this.isUndefined(r[e])||this.isUndefined(r[e][t])?0:"row"===i?r[e][t].rowspan:r[e][t].colspan},_setSpanToMCells:function(e,t,i,r){var l=this.getSheet(this.getActiveSheetIndex())._hideMergeColl;this.isUndefined(l[e])&&(l[e]={}),this.isUndefined(l[e][t])&&(l[e][t]={}),"row"===i?l[e][t].rowspan=r:l[e][t].colspan=r},sendDataRenderingRequest:function(r,l){for(var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A=!1,P=this._rAlign,k=this.getSheet(l),j=this.model.scrollSettings.allowVirtualScrolling,M=k._selectedRange,V=[],B=k.filteredRowsCollection,H=k.filterSettings.tableRange,X=[],U=[],z=this.getSheetElement(l)[0].querySelectorAll(".e-spreadsheetcolumnheader"),q=e(this._getJSSheetHeader(l)[0].querySelectorAll("colgroup")[0].outerHTML).attr("id","ss"),G=this.getSheetElement(l)[0].querySelectorAll(".e-rowheadercontent td"),W=0,K=H.length;W<K;W++)if(H[W].tableID==r.tableID){m=W;break}if(j&&(a=k.hideRowsCollection),this._dupDetails=!0,!t.isNullOrUndefined(r)&&("filter"==r.reqType||r.action.indexOf("clearfiltering")>-1&&"filterbycolor"==r.reqType)){if(u=this._generateColCount(r.fieldName)-1,o=e.inArray(r.fieldName,k._filteredColumns),r.action.indexOf("clearfiltering")>-1?k._filteredColumns.splice(o,1):o<0&&k._filteredColumns.push(r.fieldName),M=r.range,X=H[m].hiddenIdx,d=r.currentViewData,r.requestType.indexOf("filtering")>-1||r.requestType.indexOf("filterbycell")>-1||-1===r.action.indexOf("clearfiltering")||r.action.indexOf("clearfiltering")>-1&&"filterbycolor"==r.reqType){for(h=k.filterSettings.filteredRange,d.length<1&&V.push(h[h.length-1].idx+1),W=0,K=d.length;W<K;W++)(o=h.indexOf(d[W]))>-1&&V.push(h[o].idx);for(H[m].fltrdIdxes=V,s=g=0===M.startRow?0:M.startRow;s<=M.endRow;s++){for(b=!1,n=0,c=V.length;n<c;n++)V[n]==s&&(b=!0);b?(t.isNullOrUndefined(this._dataContainer.sheets[l][s])||t.isNullOrUndefined(this._dataContainer.sheets[l][s][0])||(delete this._dataContainer.sheets[l][s][0].isFilterHide,delete this._dataContainer.sheets[l][s][0].filterID,k._filterHRowsColl.indexOf(s)>-1&&k._filterHRowsColl.splice(k._filterHRowsColl.indexOf(s),1)),j?(a.indexOf(s)>-1&&(this._refreshSHMergeCells(l,[s],1,"row","show"),a.splice(a.indexOf(s),1)),g=0===s?0:s-1,this.XLEdit.getPropertyValue(g,0,"hRow")&&(delete this._dataContainer.sheets[l][g][0].hRow,B.indexOf(s)>-1&&B.splice(B.indexOf(s),1))):(this._dupDetails=this._isFilter=!0,this._showRow(s+1,s,i,i,z,q,G),this._dupDetails=this._isFilter=!1,B.indexOf(s)>-1&&B.splice(B.indexOf(s),1),k._isImported&&!k._isLoaded||A||(A=!A,this.performSelection({rowIndex:s,colIndex:u},{rowIndex:s,colIndex:u})))):(t.isNullOrUndefined(this.XLEdit.getPropertyValue(s,0,"isRHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(s,0,"isFHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(s,0,"isFilterHide"))&&(this.XLEdit._updateDataContainer({rowIndex:s,colIndex:0},{dataObj:{isFilterHide:!0,filterID:r.tableID}}),B.indexOf(s)<0&&B.push(s),p=!0),j?(p&&(a.push(s),p=!1,this._refreshSHMergeCells(l,[s],1,"row","hide")),g=0===s?0:s-1,this.XLEdit._updateDataContainer({rowIndex:g,colIndex:0},{dataObj:{hRow:!0}}),B.indexOf(s)<0&&B.push(s)):(this._dupDetails=this._isFilter=!0,this._hideRow(s,s,"isFilterHide"),this._dupDetails=this._isFilter=!1,-1===B.indexOf(s)&&B.push(s)))}g=0===M.startRow?0:M.startRow-1,j&&(!k._isImported||k._isLoaded)&&(this.refreshContent(l),this.performSelection({rowIndex:g,colIndex:u},{rowIndex:g,colIndex:u})),!j&&this._hideRowColl.length&&(this._getRowHdrTBody(l).append(this._renderRowHdr(this._hideRowColl,l)),this._getContTBody(l).append(e(this._renderData(i,l,0,k.colCount,!1,this._hideRowColl[0],this._hideRowColl.length))),this._hideRowColl=[]),this.XLScroll._getRowHeights(l,g),"clearfiltering"===r.action&&(k._filteredByColor=-1,this._excelFilter.closeXFDialog()),this.model.allowFiltering&&this.XLFilter._updateFilterIcons(g,M.startRow,u,r.action),H[m].hiddenIdx=e.extend(!0,[],X),X=[]}}else if(!t.isNullOrUndefined(r)&&("sortbycolor"===r.requestType||"filterbycolor"===r.requestType))if(C=[],x=[],u=this._generateColCount(r.columnName)-1,r.prev={},r.cur={},r.oprType.indexOf("Put")<0&&(k._filterColl[M.startRow-1][u].status.indexOf("e-ssfilter")>-1&&"filterbycolor"===r.requestType?this._isRowViewable(l,M.startRow-1)&&(this.getCell(M.startRow-1,u).removeClass(P),this.XLFilter._changeFilterIcon({rowIndex:M.startRow-1,colIndex:u},"filter",this.XLEdit.getPropertyValue(M.startRow-1,u,"filterState"))):k._filterColl[M.startRow-1][u].status.indexOf("-asc")&&(r.prev.icon=k._filterColl[M.startRow-1][u].status,this._isRowViewable(l,M.startRow-1)&&(this.getCell(M.startRow-1,u),this.XLFilter._changeSortIcon({rowIndex:M.startRow-1,colIndex:u},"ascending")),r.cur.icon=k._filterColl[M.startRow-1][u].status)),"sortbycolor"===r.requestType){for(v=[M.startRow,u,M.endRow,u],c=(w=this.getRangeData({range:v,skipHiddenRow:!0})).length,W=0;W<c;W++)S=w[W].formats,t.isNullOrUndefined(S)||("sortbgcolor"===r.operation?t.isNullOrUndefined(S["background-color"])||r.bgcolor===S["background-color"].toLowerCase()&&C.push(W):t.isNullOrUndefined(S.color)||r.fgcolor===S.color.toLowerCase()&&C.push(W));if(("PutCellColor"===r.oprType||"PutFontColor"===r.oprType)&&(v=r.sortRange),this.isUndefined(r.tableID))for(I=[],R=v[1];R<=v[3];R++)I.push(R);else I=H[m].multifilterIdx;for(v=[M.startRow,I[0],M.endRow,I[I.length-1]],w=this.getRangeData({range:v,skipHiddenRow:!0}),r.prev.data=e.extend(!0,[],w),v.colIndex=u,r.range=v,n=0,K=I.length;n<K;n++){for(y=[],T=[],v=[M.startRow,I[n],M.endRow,I[n]],w=this.getRangeData({range:v,skipHiddenRow:!0}),L=C.length-1;L>=0;L--)y.push(w.splice(C[L],1)[0]);T=y.reverse().concat(w),y.length>0&&(this._isSort=!0,this._dupDetails=!0,this.XLComment.deleteComment(v,null,!0,null),this._removeHyperlink(null,null,!0,v),this.clearRangeData(v,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0),this.XLFormat.removeStyle(v,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0}),this._isSort=!1,this._dupDetails=!1,this.XLEdit.updateCellWithContainer(T,v,l,!0))}v=[M.startRow,I[0],M.endRow,I[I.length-1]],r.cur.data=e.extend(!0,[],this.getRangeData({range:v,skipHiddenRow:!0})),this.updateUndoRedoCollection(r)}else{for(x=[],X=[],H[m].fltrdIdxes=V=r.fltrdIdxes,s=g=0===M.startRow?0:M.startRow;s<=M.endRow;s++){for(b=!1,n=0,c=V.length;n<c;n++)V[n]==s&&(b=!0);b?(E=this.XLEdit.getPropertyValue(s,u,"value2"),E=t.isNullOrUndefined(E)?"":E,_={field:r.columnName,value:E,predicate:"or",operator:"equal",matchcase:!1},f=t.Predicate(r.columnName,"equal",E),this.XLEdit.getPropertyValue(s,0,"filterID")===r.tableID&&(delete this._dataContainer.sheets[l][s][0].isFilterHide,delete this._dataContainer.sheets[l][s][0].filterID,j?(a.splice(a.indexOf(s),1),this._refreshSHMergeCells(l,[s],1,"row","show")):(this._dupDetails=this._isFilter=!0,this._showRow(s+1,s,i,i,z,q,G),this._dupDetails=this._isFilter=!1,B.indexOf(s)>-1&&B.splice(B.indexOf(s),1),k._isImported&&!k._isLoaded||A||(A=!A,this.performSelection({rowIndex:s,colIndex:u},{rowIndex:s,colIndex:u})))),x.push(_),U.push(_),F=(O=U[0]).from):(t.isNullOrUndefined(this.XLEdit.getPropertyValue(s,0,"isRHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(s,0,"isFHide"))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(s,0,"isFilterHide"))&&(this.XLEdit._updateDataContainer({rowIndex:s,colIndex:0},{dataObj:{isFilterHide:!0,filterID:r.tableID}}),p=!0),j?p&&(a.push(s),this._refreshSHMergeCells(l,[s],1,"row","hide")):(this._dupDetails=this._isFilter=!0,this._hideRow(s,s,"isFilterHide"),this._dupDetails=this._isFilter=!1,-1===B.indexOf(s)&&B.push(s)),p=!1)}for(j&&(!k._isImported||k._isLoaded)&&(this.refreshContent(l),this.performSelection({rowIndex:V[0],colIndex:u},{rowIndex:V[0],colIndex:u})),!j&&this._hideRowColl.length&&(this._getRowHdrTBody(l).append(this._renderRowHdr(this._hideRowColl,l)),this._getContTBody(l).append(e(this._renderData(i,l,0,k.colCount,!1,this._hideRowColl[0],this._hideRowColl.length))),this._hideRowColl=[]),this.XLScroll._getRowHeights(l,g),r.filterCollection=x,f=O.ejpredicate?O.ejpredicate:t.Predicate(O.field,O.operator,O.value,!O.matchcase),n=1;n<U.length;n++)f=U[n].ejpredicate!=i?f[U[n].predicate](U[n].ejpredicate):f[U[n].predicate](U[n].field,U[n].operator,U[n].value,!U[n].matchcase);t.isNullOrUndefined(H[m].predicate[r.columnName])&&(H[m].predicate[r.columnName]={}),H[m].filteredColumns=x,H[m].predicate[r.columnName]=F?{from:O.from,take:O.take}:f,H[m].hiddenIdx=e.extend(!0,[],X),X=[]}t.isNullOrUndefined(r)||"filter"!==r.action&&"filtering"!==r.action&&"filterbycolor"!==r.action?"clearfiltering"===r.action&&(r.tableID>-1&&k.filterSettings.tableRange[m].filterColumnName.pop(r.fieldName),this.XLFilter._fltrRowHighlight(M.startRow,M.endRow,"clear",r.tableID,r.filterCollection.length)):(r.tableID>-1&&k.filterSettings.tableRange[m].filterColumnName.push(r.fieldName),this.XLFilter._fltrRowHighlight(M.startRow,M.endRow,"add",r.tableID,r.filterCollection.length)),this._dupDetails=!1,this.model.showRibbon&&this.model.allowFiltering&&(D=e("#"+this._id+"_Ribbon_Data_SortFilter_ClearFilter").data("ejButton"),N={rowIndex:this.getActiveCell().rowIndex,colIndex:this.getActiveCell().colIndex},this.XLRibbon._changeClrFltrStatus(D,"button",N)),this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(l,"refresh","vertical","filter")},_filterClose:function(t){this.model.allowFiltering&&!this._hasClass(t,"e-filterspan")&&e(t).parents(".e-excelfilter").length<1&&this._excelFilter._openedFltr&&e(this._excelFilter._openedFltr).is(":visible")&&(this._excelFilter.closeXFDialog(),this.XLFilter._isSearchEdit=!1)},showPager:function(e){this.model.showPager=e,this.element.find(".e-spreadsheetfooter").css("display",e?"block":"none"),this._setSheetWidthHeight(this.getActiveSheetIndex(),{width:this._responsiveWidth,height:this._responsiveHeight})},_refreshClipboard:function(e,t){var i=this.model,r=this._id;e.length&&(i.allowFormatPainter&&i.allowCellFormatting||e.find("#"+r+"_Ribbon_home_Clipboard")[t](),e.find("#"+r+"_Ribbon_home_Clipboard_1")[t](),e.find("#"+r+"_Ribbon_home_Clipboard_Home_Clipboard_Cut")[t](),e.find("#"+r+"_Ribbon_home_Clipboard_Home_Clipboard_Copy")[t]())},_setScrolling:function(t){var i,r,l=1,n=this.model.sheetCount,s=this.getActiveSheetIndex(),o={};if(o.width=this._responsiveWidth,o.height=this._responsiveHeight,t)for(;l<=n;)i=this.getSheet(l),r=this.getSheetElement(l),i._isLoaded&&(this._isAutoWHMode=!t,this.model.scrollSettings.scrollMode="infinite",this._renderScroller(l,o,"initial"),e.extend(!0,o,this.model.scrollSettings),this.element.height(o.height).width(o.width),e("#"+this._id+"_Ribbon").ejRibbon("option",{width:o.width}),this._updateResponsiveSettings(),this._setSheetWidthHeight(l,{height:this._responsiveHeight,width:this._responsiveWidth}),r.find("#"+this._id+"_content").removeClass("e-rmvrghtbdr")),l++;else{for(this._isAutoWHMode=!t,this._isallowScrollingSetModel=!0,this.model.scrollSettings.isResponsive=t;l<=n;)i=this.getSheet(l),r=this.getSheetElement(l),i._isLoaded&&(i._isVPRendered=!1,this.model.scrollSettings.isResponsive=!1,this.model.scrollSettings.scrollMode="normal",this.model.scrollSettings.allowVirtualScrolling=!1,this._isAutoWHMode=!t,this.setActiveSheetIndex(l),this._isInitLoad=!0,i._isDataMoved=!0,r.find("#"+this._id+"_content").find(".e-table").empty(),this._sheets[l]._contTBody=null,this._refreshDataSrc(null,l),this._refreshCellData(null,l),this._canOverflow=!0,this._refreshOverflow(),this.refreshContent(l),r.find(".e-spreadsheetrowheader")[0].style.height="",r.find(".e-rowheadercontent")[0].style.height="",this.element.find(".e-spreadsheetmainpanel")[0].style.height="",this.element.find(".e-spreadsheetgrppanel")[0].style.height="",r.find(".e-spreadsheetcontent")[0].style.height="",r.find(".e-spreadsheetcontentcontainer")[0].style.height="",r.find("#"+this._id+"_content")[0].style.height="",e("#"+this._id)[0].style.minHeight="",this._updateResponsiveSettings(),l==s&&this._autoSSWidthHeight(l),this._setElemDimension()),l++;this._isInitLoad=!1,this.setActiveSheetIndex(s)}},_setScrollMode:function(e){var i=this.getActiveSheetIndex(),r={};r.width=this._responsiveWidth,r.height=this._responsiveHeight,"normal"===e?t.Spreadsheet.scrollMode.Normal:t.Spreadsheet.scrollMode.Infinite,this.setActiveSheetIndex(1),this.refreshContent(1),this.setActiveSheetIndex(i)},_setVirtualScrolling:function(e){var t,i=1,r=this.model.sheetCount,l=this.getActiveSheetIndex(),n={};if(n.width=this._responsiveWidth,n.height=this._responsiveHeight,e)for(;i<=r;)(t=this.getSheet(i))._isLoaded&&(t._virtualBlockRowCnt=Math.ceil(t._vPortHgt/t.rowHeight)+this._bufferCnt,this._isInitLoad=!0,this.setActiveSheetIndex(i),this.refreshContent(i)),i++;else for(this._isallowVirtualScrollingSetModel=!0;i<=r;)(t=this.getSheet(i))._isLoaded&&(this.setActiveSheetIndex(i),this.refreshContent(i)),i++;this.setActiveSheetIndex(l)},_setModel:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=this.getActiveSheetIndex(),S=this.model,x=this._id,v=e("#"+x+"_Ribbon").ejRibbon("instance"),w=this.model.showRibbon?v.element:[];for(l in i)switch(r=i[l],l){case"allowClipboard":r?(this._refreshClipboard(w,"show"),t.isNullOrUndefined(this.XLClipboard)&&(this.XLClipboard=new t.spreadsheetFeatures.clipboard(this)),this.XLClipboard._initCopyPaste()):this._refreshClipboard(w,"hide");break;case"activeSheetIndex":this.gotoPage(r,!1);break;case"pageSettings":this.isUndefined(i.pageSettings.currentPage)||this.gotoPage(i.pageSettings.currentPage,!1),this.isUndefined(i.pageSettings.pageCount)||(this.getPager().ejPager("option","pageCount",i.pageSettings.pageCount),this._refreshSpreadSheetPager(!0));break;case"allowComments":r?(t.isNullOrUndefined(this.XLComment)&&(this.XLComment=new t.spreadsheetFeatures.comments(this)),w.length&&w.find("#"+x+"_Ribbon_review_Comments").show(),this.XLComment._updateCmntRibIcons()):this.model.showRibbon&&w.find("#"+x+"_Ribbon_review_Comments").hide();break;case"allowFormatPainter":S.allowCellFormatting&&(r?(S.allowClipboard||w.find("#"+x+"_Ribbon_home_Clipboard").show(),t.isNullOrUndefined(this.XLFormat)&&(this.XLFormat=new t.spreadsheetFeatures.cellFormatting(this)),w.length&&w.find("#"+x+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").show()):w.length&&(S.allowClipboard||w.find("#"+x+"_Ribbon_home_Clipboard").hide(),w.length&&w.find("#"+x+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").hide()));break;case"allowFormulaBar":r?(n=e("#"+this._id+"_formulabar")).length?this.showFormulaBar():(this._renderFormulaBar(!0),this._setSheetWidthHeight(C,{width:this._responsiveWidth,height:this._responsiveHeight})):this.hideFormulaBar();break;case"allowHyperlink":w.length&&(r?w.find("#"+x+"_Ribbon_insert_Links").show():w.find("#"+x+"_Ribbon_insert_Links").hide());break;case"enableContextMenu":r&&t.isNullOrUndefined(this.XLCMenu)&&(this.XLCMenu=new t.spreadsheetFeatures.contextmenu(this),this.XLCMenu._initContextMenu(),this.XLCMenu._initColorDialog(),this.XLCMenu._initCMenuFooter());break;case"allowEditing":r?(t.isNullOrUndefined(this.XLEdit)&&(this.XLEdit=new t.spreadsheetFeatures.editing(this)),this.model.showRibbon&&w.length&&w.find("#"+x+"_Ribbon_home_Editing").show(),this.XLEdit._processEditing(),this.model.enableContextMenu&&this.XLCMenu._enableMenuOpt(["RenameSheet"],"contextMenuFooter")):(w.length&&w.find("#"+x+"_Ribbon_home_Editing").hide(),this.model.enableContextMenu&&this.XLCMenu._disableMenuOpt(["RenameSheet"],"contextMenuFooter"));break;case"allowResizing":r&&t.isNullOrUndefined(this.XLResize)&&(this.XLResize=new t.spreadsheetFeatures.resizing(this));break;case"allowDataValidation":r?(w.find("#"+x+"_Ribbon_data_DataTools").show(),t.isNullOrUndefined(this.XLValidate)&&(this.XLValidate=new t.spreadsheetFeatures.validation(this),this.XLRibbon._renderValDialog(this.XLRibbon._initValDialog()),this.XLValidate._addDVMethod())):w.length&&w.find("#"+x+"_Ribbon_data_DataTools").hide();break;case"allowConditionalFormats":r?(w.find("#"+x+"_Ribbon_home_Styles_Home_Styles_ConditionalFormatting").show(),this.XLRibbon._initCFDialog(),t.isNullOrUndefined(this.XLCFormat)&&(this.XLCFormat=new t.spreadsheetFeatures.cFormat(this))):w.length&&w.find("#"+x+"_Ribbon_home_Styles_Home_Styles_ConditionalFormatting").hide();break;case"allowSearching":this.model.allowSearching=r,r?(t.isNullOrUndefined(this.XLSearch)&&(this.XLSearch=new t.spreadsheetFeatures.findnreplace(this)),w.length&&w.find("#"+x+"_Ribbon_others_Editing").show()):w.length&&w.find("#"+x+"_Ribbon_others_Editing").hide();break;case"pictureSettings":for(o in r)switch(o){case"allowPictures":S.pictureSettings.allowPictures=r[o],r[o]?(t.isNullOrUndefined(this.XLShape)&&(this.XLShape=new t.spreadsheetFeatures.shape(this)),w.length&&w.find("#"+x+"_Ribbon_insert_Illustrations").show()):w.length&&w.find("#"+x+"_Ribbon_insert_Illustrations").hide()}break;case"showRibbon":for(this.model.showRibbon=r,h=e("#"+x+"_Ribbon"),r?(h.length?h.show():this.XLRibbon._renderRibbon(!0),"hidden"===(w=(v=e("#"+x+"_Ribbon").ejRibbon("instance")).element)[0].style.overflow&&(w[0].style.overflow=""),e._data(e(".e-ss-"+this._id+".e-chartcell")[0],"events")||this._on(e(".e-ss-"+this._id+".e-chartcell"),"click",this._chartClickHandler),e._data(e("#"+this._id+"_cellstyles")[0],"events")||this._on(e("#"+this._id+"_cellstyles"),"click",this._cellStyleClick),e._data(e("#"+this._id+"_formatastable")[0],"events")||this._on(e("#"+this._id+"_formatastable"),"click",this._formatAsTableClick)):h.hide(),this.refreshSpreadsheet(),c=1,u=S.sheets.length;c<u;c++)S.sheets[c]._isResized=c!=C;break;case"isGridMode":h=e("#"+x+"_Ribbon"),n=e("#"+this._id+"_formulabar"),r?(this.model.showRibbon=!r,this.model.allowFormulaBar=!r,h.length&&h.hide(),n.length&&this.hideFormulaBar()):(h.show(),this.showFormulaBar());break;case"exportSettings":for(s in"menu"===S.ribbonSettings.applicationTab.type&&(g=e("#"+x+"_Menu").data("ejMenu")),r)switch(s){case"allowExporting":S.exportSettings.allowExporting=r[s],r[s]?((S.exportSettings.excelUrl||S.exportSettings.csvUrl||S.exportSettings.pdfUrl)&&(w.length&&w.find("#saveas_backStageTab").show(),g&&g.enableItemByID("Save")),t.isNullOrUndefined(this.XLExport)&&(this.XLExport=new t.spreadsheetFeatures.exporting(this))):(w.length&&w.find("#saveas_backStageTab").hide(),w.length&&w.find("#"+x+"_Ribbon_BackStage_saveas").hide(),g&&g.disableItemByID("Save"));break;case"excelUrl":S.exportSettings.excelUrl=r[s],r[s]?(w.length&&w.find("#saveas_backStageTab").show(),w.find("#"+x+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").show(),g&&g.enableItemByID("ExportXL")):(w.find("#"+x+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").hide(),g&&g.disableItemByID("ExportXL"));break;case"csvUrl":S.exportSettings.csvUrl=r[s],r[s]?(w.length&&w.find("#saveas_backStageTab").show(),w.find("#"+x+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").show(),g&&g.enableItemByID("ExportCsv")):(w.find("#"+x+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").hide(),g&&g.disableItemByID("ExportCsv"));break;case"pdfUrl":S.exportSettings.pdfUrl=i[l][s],r[s]?(w.length&&w.find("#saveas_backStageTab").show(),w.find("#"+x+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").show(),g&&g.enableItemByID("ExportPdf")):(w.find("#"+x+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").hide(),g&&g.disableItemByID("ExportPdf"))}break;case"allowKeyboardNavigation":r&&t.isNullOrUndefined(this.XLCellNav)&&(this.XLCellNav=new t.spreadsheetFeatures.cellNavigation(this));break;case"allowAutoFill":r?(t.isNullOrUndefined(this.XLDragFill)?(this.XLDragFill=new t.spreadsheetFeatures.dragFill(this),this._createAutoFillElement()):this.getAutoFillElem().show(),this.XLDragFill.positionAutoFillElement()):(this.getAutoFillElem().hide(),this.XLDragFill.hideAutoFillOptions());break;case"autoFillSettings":for(a in r)switch(a){case"fillType":S.allowAutoFill&&(S.autoFillSettings.fillType=r[a]);break;case"showFillOptions":S.allowAutoFill&&(r.showFillOptions?this._removeClass(this._getAutoFillOptElem(),"e-hide"):this.XLDragFill.hideAutoFillOptions(),S.autoFillSettings.showFillOptions=r.showFillOptions)}break;case"allowSelection":r&&t.isNullOrUndefined(this.XLSelection)&&(this.XLSelection=new t.spreadsheetFeatures.selection(this),this._initSelection());break;case"allowDragAndDrop":r&&t.isNullOrUndefined(this.XLDragDrop)&&(this.XLDragDrop=new t.spreadsheetFeatures.dragAndDrop(this));break;case"allowCellFormatting":r?((S.allowConditionalFormats||S.allowFormatAsTable)&&w.find("#"+x+"_Ribbon_home_Styles").show(),w.length&&(w.find("#"+x+"_Ribbon_home_Font").show(),w.find("#"+x+"_Ribbon_home_Number").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_TopAlign").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_MiddleAlign").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_BottomAlign").show(),w.find("#"+x+"_Ribbon_separator_Home_Alignment_BottomAlign").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_AlignLeft").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_AlignCenter").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_AlignRight").show(),w.find("#"+x+"_Ribbon_separator_Home_Alignment_AlignRight").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_DecreaseIndent").show(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_IncreaseIndent").show(),w.find("#"+x+"_Ribbon_home_Styles_Home_Styles_CellStyles").show(),S.allowFormatPainter&&w.find("#"+x+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").show(),S.allowClipboard&&w.find("#"+x+"_Ribbon_home_Clipboard").show()),t.isNullOrUndefined(this.XLFormat)&&(this.XLFormat=new t.spreadsheetFeatures.cellFormatting(this)),t.isNullOrUndefined(this.XLCellFrmtDlg)&&(this.XLCellFrmtDlg=new t.spreadsheetFeatures.formatCellDialog(this)),0===e("#"+x+"_formatdlg").length&&this.XLCellFrmtDlg._renderCellFrmtDlg()):w.length&&(w.find("#"+x+"_Ribbon_home_Font").hide(),w.find("#"+x+"_Ribbon_home_Number").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_TopAlign").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_MiddleAlign").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_BottomAlign").hide(),w.find("#"+x+"_Ribbon_separator_Home_Alignment_BottomAlign").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_AlignLeft").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_AlignCenter").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_AlignRight").hide(),w.find("#"+x+"_Ribbon_separator_Home_Alignment_AlignRight").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_DecreaseIndent").hide(),w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_IncreaseIndent").hide(),w.find("#"+x+"_Ribbon_home_Styles_Home_Styles_CellStyles").hide(),w.find("#"+x+"_Ribbon_home_Clipboard_Home_Clipboard_FormatPainter").hide(),S.allowClipboard||w.find("#"+x+"_Ribbon_home_Clipboard").hide(),S.allowConditionalFormats||S.allowFormatAsTable||w.find("#"+x+"_Ribbon_home_Styles").hide());break;case"allowImport":w.length&&(r?w.find("#open_backStageTab").show():w.find("#open_backStageTab").hide());break;case"importSettings":for(d in"menu"===S.ribbonSettings.applicationTab.type&&(g=e("#"+x+"_Menu").data("ejMenu")),r)switch(d){case"importMapper":r[d]?(S.importSettings.importMapper=r[d],w.length&&w.find("#open_backStageTab").show(),g&&g.enableItemByID("Open")):(w.length&&w.find("#open_backStageTab").hide(),g&&g.disableItemByID("Open"));break;case"importUrl":S.importSettings.importUrl=r[d];break;case"password":S.importSettings.password=r[d]}break;case"allowSorting":if(p=document.getElementById(x+"number_MenuItem"),m=document.getElementById(x+"string_MenuItem"),g=e("#"+x+"_Ribbon_SortFilter").data("ejMenu"),r?(t.isNullOrUndefined(this.XLSort)&&(this.XLSort=new t.spreadsheetFeatures.sorting(this)),w.length&&(w.find("#"+x+"_Ribbon_data_SortFilter_1").show(),w.find("#"+x+"_Ribbon_data_Sort").show(),w.find("#"+x+"_Ribbon_home_Editing_1").show()),g&&g.enableItemByID("Ribbon_SortAtoZ"),g&&g.enableItemByID("Ribbon_SortZtoA")):w.length&&(w.find("#"+x+"_Ribbon_data_SortFilter_1").hide(),this.model.allowFiltering||(w.find("#"+x+"_Ribbon_data_Sort").hide(),w.find("#"+x+"_Ribbon_home_Editing_1").hide()),g&&g.disableItemByID("Ribbon_SortAtoZ"),g&&g.disableItemByID("Ribbon_SortZtoA")),this.model.allowFiltering)for(c=0;c<3;c++)t.isNullOrUndefined(p)||(p.childNodes[c].style.display=this.model.allowSorting?2===c?"block":"inline":"none"),t.isNullOrUndefined(m)||(m.childNodes[c].style.display=this.model.allowSorting?2===c?"block":"inline":"none");break;case"formatSettings":if(S.allowCellFormatting)for(_ in r)switch(_){case"allowFontFamily":S.formatSettings.allowFontFamily=r[_],w.length&&(r[_]?w.find("#"+x+"_Ribbon_home_Font_Home_Font_FontFamily").show():w.find("#"+x+"_Ribbon_home_Font_Home_Font_FontFamily").hide());break;case"allowDecimalPlaces":S.formatSettings.allowDecimalPlaces=r[_],w.length&&(r[_]?(w.find("#"+x+"_Ribbon_home_Number_Home_Number_IncreaseDecimal").show(),w.find("#"+x+"_Ribbon_home_Number_Home_Number_DecreaseDecimal").show(),w.find("#"+x+"_Ribbon_separator_Home_Number_CommaStyle").show()):(w.find("#"+x+"_Ribbon_home_Number_Home_Number_IncreaseDecimal").hide(),w.find("#"+x+"_Ribbon_home_Number_Home_Number_DecreaseDecimal").hide(),w.find("#"+x+"_Ribbon_separator_Home_Number_CommaStyle").hide()));break;case"allowCellBorder":S.formatSettings.allowCellBorder=r[_],w.length&&(r[_]?(w.find("#"+x+"_Ribbon_separator_border").show(),w.find("#"+x+"_Ribbon_home_Font_Home_Font_Border").show()):(w.find("#"+x+"_Ribbon_separator_border").hide(),w.find("#"+x+"_Ribbon_home_Font_Home_Font_Border").hide()))}break;case"sheets":for(u=r.length,c=0;c<u;c++)for(f in r[c]){if(this.model.sheetCount<c+1&&r.length>C)return;switch(f){case"showGridlines":c+1===C?this._showGridlines(r[c].showGridlines,C):this.getSheet(c+1).showGridlines=r[c].showGridlines;break;case"showHeadings":c+1===C?this._showHeadings(r[c].showHeadings,C):this.getSheet(c+1).showHeadings=r[c].showHeadings}}break;case"scrollSettings":t.isNullOrUndefined(i.scrollSettings)||(t.isNullOrUndefined(i.scrollSettings.allowScrolling)||(S.scrollSettings.allowScrolling=i.scrollSettings.allowScrolling,this._setScrolling(i.scrollSettings.allowScrolling)),t.isNullOrUndefined(i.scrollSettings.allowVirtualScrolling)||(S.scrollSettings.allowVirtualScrolling=i.scrollSettings.allowVirtualScrolling,this._setVirtualScrolling(i.scrollSettings.allowVirtualScrolling)),t.isNullOrUndefined(i.scrollSettings.isResponsive)||(S.scrollSettings.isResponsive=i.scrollSettings.isResponsive),t.isNullOrUndefined(i.scrollSettings.scrollMode)||this._setScrollMode(i.scrollSettings.scrollMode),t.isNullOrUndefined(i.scrollSettings.width)||(S.scrollSettings.width=i.scrollSettings.width),t.isNullOrUndefined(i.scrollSettings.height)||(S.scrollSettings.height=i.scrollSettings.height));break;case"allowFiltering":g=e("#"+x+"_Ribbon_SortFilter").data("ejMenu"),r?(w.length&&(w.find("#"+x+"_Ribbon_data_SortFilter_2").show(),w.find("#"+x+"_Ribbon_data_Sort").show(),w.find("#"+x+"_Ribbon_home_Editing_1").show()),g&&g.enableItemByID("Ribbon_Filter"),t.isNullOrUndefined(this.XLFilter)&&(this.XLFilter=new t.spreadsheetFeatures.filter(this)),this.XLFilter._renderExcelFilter()):w.length&&(this.model.allowSorting||(w.find("#"+x+"_Ribbon_data_Sort").hide(),w.find("#"+x+"_Ribbon_home_Editing_1").hide()),w.find("#"+x+"_Ribbon_data_SortFilter_2").hide(),g&&g.disableItemByID("Ribbon_Filter"));break;case"allowInsert":r?(w.length&&!S.allowDelete&&w.find("#"+x+"_Ribbon_others_Cells").show(),w.length&&w.find("#"+x+"_Ribbon_others_Cells_1").show(),this.getPager().find(".e-new").removeClass("e-disable"),S.enableContextMenu&&(this.XLCMenu._enableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter"),this.XLCMenu._enableMenuOpt(["Insert"],"contextMenuCell"),this.XLCMenu._enableMenuOpt(["Insert"],"contextMenuColumnHeader"),this.XLCMenu._enableMenuOpt(["Insert"],"contextMenuRowHeader"))):(w.length&&!S.allowDelete&&w.find("#"+x+"_Ribbon_others_Cells").hide(),w.length&&w.find("#"+x+"_Ribbon_others_Cells_1").hide(),this.getPager().find(".e-new").addClass("e-disable"),S.enableContextMenu&&(this.XLCMenu._disableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter"),this.XLCMenu._disableMenuOpt(["Insert"],"contextMenuCell"),this.XLCMenu._disableMenuOpt(["Insert"],"contextMenuColumnHeader"),this.XLCMenu._disableMenuOpt(["Insert"],"contextMenuRowHeader")));break;case"allowDelete":r?(!S.allowInsert&&w.length&&w.find("#"+x+"_Ribbon_others_Cells").show(),w.length&&w.find("#"+x+"_Ribbon_others_Cells_2").show(),S.enableContextMenu&&this._getSheetNames(!0).length>1&&(this.XLCMenu._enableMenuOpt(["DeleteSheet"],"contextMenuFooter"),this.XLCMenu._enableMenuOpt(["Delete"],"contextMenuCell"),this.XLCMenu._enableMenuOpt(["Delete"],"contextMenuColumnHeader"),this.XLCMenu._enableMenuOpt(["Delete"],"contextMenuRowHeader"))):(!S.allowInsert&&w.length&&w.find("#"+x+"_Ribbon_others_Cells").hide(),w.length&&w.find("#"+x+"_Ribbon_others_Cells_2").hide(),S.enableContextMenu&&(this.XLCMenu._disableMenuOpt(["DeleteSheet"],"contextMenuFooter"),this.XLCMenu._disableMenuOpt(["Delete"],"contextMenuCell"),this.XLCMenu._disableMenuOpt(["Delete"],"contextMenuColumnHeader"),this.XLCMenu._disableMenuOpt(["Delete"],"contextMenuRowHeader")));break;case"allowFreezing":r?(t.isNullOrUndefined(this.XLFreeze)&&(this.XLFreeze=new t.spreadsheetFeatures.freezepane(this),this.XLFreeze._initFreeze()),w.length&&w.find("#"+x+"_Ribbon_others_Window").show()):w.length&&w.find("#"+x+"_Ribbon_others_Window").hide();break;case"allowMerging":w.length&&(r?w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_Merge").show():w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_Merge").hide());break;case"allowWrap":w.length&&(r?w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_WrapText").show():w.find("#"+x+"_Ribbon_home_Alignment_Home_Alignment_WrapText").hide());break;case"allowUndoRedo":w.length&&(r?w.find("#"+x+"_Ribbon_home_Actions").show():w.find("#"+x+"_Ribbon_home_Actions").hide());break;case"frozenRows":S.allowFreezing&&this.XLFreeze.freezeRows(r);break;case"frozenColumns":S.allowFreezing&&this.XLFreeze.freezeColumns(r);break;case"freezePanes":S.allowFreezing&&this.XLFreeze.freezePanes(r.rowIndex,r.colIndex);break;case"allowFormatAsTable":r?(S.enablePivotTable||w.find("#"+x+"_Ribbon_insert_Tables").show(),t.isNullOrUndefined(this.XLFormat)&&(this.XLFormat=new t.spreadsheetFeatures.cellFormatting(this)),w.length&&(w.find("#"+x+"_Ribbon_home_Styles_Home_Styles_FormatAsTable").show(),w.find("#"+x+"_Ribbon_insert_Tables_Insert_Tables_Table").show())):w.length&&(S.enablePivotTable||w.find("#"+x+"_Ribbon_insert_Tables").hide(),w.find("#"+x+"_Ribbon_home_Styles_Home_Styles_FormatAsTable").hide(),w.find("#"+x+"_Ribbon_insert_Tables_Insert_Tables_Table").hide());break;case"enablePivotTable":w.length&&(r?(t.isNullOrUndefined(this.XLPivot)&&(this.XLPivot=new t.spreadsheetFeatures.pivot(this)),w.length&&w.find("#"+x+"_Ribbon_insert_Tables_Insert_Tables_PivotTable").show()):(w.length&&w.find("#"+x+"_Ribbon_insert_Tables_Insert_Tables_PivotTable").hide(),this.hideActivationPanel(),this.XLRibbon._toggleAnalyzeTab(),this.getSheetElement(C).find(".e-ss-activepivot").removeClass("e-ss-activepivot")));break;case"allowAutoSum":w.length&&(r?w.find("#"+x+"_Ribbon_home_Editing_Home_Editing_AutoSum").show():w.find("#"+x+"_Ribbon_home_Editing_Home_Editing_AutoSum").hide());break;case"allowCharts":r?((t.isNullOrUndefined(this.XLChart)||t.isNullOrUndefined(this.XLShape))&&(this.XLShape=new t.spreadsheetFeatures.shape(this),this.XLChart=new t.spreadsheetFeatures.chart(this)),w.length&&w.find("#"+x+"_Ribbon_insert_Charts").show()):w.length&&w.find("#"+x+"_Ribbon_insert_Charts").hide();break;case"allowSparkline":r?(t.isNullOrUndefined(this.XLSparkline)&&(this.XLSparkline=new t.spreadsheetFeatures.sparkLine(this)),v=e("#"+this._id+"_Ribbon").data("ejRibbon"),this.XLRibbon._contextualTabCollection[4]&&this.XLRibbon._tabCollection[1].groups[4]?(v.hideTab("Sparkline Design"),w.find("#"+x+"_Ribbon_insert_SparklineCharts").show()):this.XLRibbon._contextualTabCollection[4]||this.XLRibbon._tabCollection[1].groups[4]||(this.XLSparkline._renderSparklineTab(),v.addTabGroup(2,this.XLSparkline._tabInsert(),4),this.XLRibbon._tabCollection[1].groups.push(this.XLSparkline._tabInsert()),v.addContextualTabs(this.XLSparkline._contextualTabInsert(),11),this.XLRibbon._contextualTabCollection.push(this.XLSparkline._contextualTabInsert()),v.hideTab("Sparkline Design"))):(w.find("#"+x+"_Ribbon_insert_SparklineCharts").hide(),v.hideTab("Sparkline Design"));break;case"printSettings":for(b in r)switch(b){case"allowPrinting":S.printSettings.allowPrinting=r[b],r[b]?(this.XLPrint=new t.spreadsheetFeatures.print(this),w.length&&(w.find("#"+x+"_Ribbon_pagelayout_Print").show(),w.find("#print_backStageTab").show())):w.length&&(w.find("#print_backStageTab").hide(),w.find("#"+x+"_Ribbon_pagelayout_Print").hide());break;case"allowPageSize":S.printSettings.allowPageSize=r[b],w.length&&(r[b]?w.find("#"+x+"_Ribbon_pagelayout_PageLayout").show():w.find("#"+x+"_Ribbon_pagelayout_PageLayout").hide())}break;case"allowLockCell":w.length&&(r?(w.find("#"+x+"_Ribbon_review_Changes_Review_Changes_ProtectSheet").show(),w.find("#"+x+"_Ribbon_review_Changes_Review_Changes_LockCell").show()):(w.find("#"+x+"_Ribbon_review_Changes_Review_Changes_ProtectSheet").hide(),w.find("#"+x+"_Ribbon_review_Changes_Review_Changes_LockCell").hide()));break;case"undoRedoStep":this.undoRedoStep=r;break;case"enableTouch":this._wireTouchEvts(r?"_on":"_off");break;case"showPager":this.showPager(i[l]),this._refreshSpreadSheetPager();break;case"allowOverflow":this._refreshOverflow();break;case"allowClear":w.length&&(r?w.find("#"+x+"_Ribbon_home_Editing_Home_Editing_Clear").show():w.find("#"+x+"_Ribbon_home_Editing_Home_Editing_Clear").hide());break;case"isReadOnly":this._readOnly();break;case"locale":this.model.locale=i[l],this._destroy(),this.model.sheets.splice(0,1),this.addClass(this.element[0],this._rootCSS+" e-js"),this._init();break;case"allowCellType":r&&(this.XLCellType=new t.spreadsheetFeatures.cellType(this));break;case"activationPanelWidth":this.model.apWidth=r,this.getActivationPanel().width(r-1);break;case"cssClass":this.element.removeClass(this._cssClass).addClass(i[l]);break;case"ribbonSettings":this.model.ribbonSettings.applicationTab.type=i.ribbonSettings.applicationTab.type,e("#"+this._id+"_Menu")[0].style.display="menu"===i.ribbonSettings.applicationTab.type?"block":"none",this.XLRibbon._refreshBSItems(i.ribbonSettings.applicationTab.type),this.XLRibbon._menuCustomize(),v.setModel({applicationTab:this.XLRibbon._appTabCollection}),"backstage"===i.ribbonSettings.applicationTab.type&&(this.XLRibbon._isAppTabCreate=!1)}w.length&&v.model&&(S.allowAutoSum||S.allowFiltering||S.allowUndoRedo||S.allowSorting||S.allowClipboard||S.allowFormatPainter||S.allowCellFormatting||S.allowMerging||S.allowWrap||S.allowConditionalFormats||S.allowFormatAsTable?v.showTab(this._getLocStr("HOME")):v.hideTab(this._getLocStr("HOME")),S.allowFormatAsTable||S.allowPictures||S.allowHyperlink||S.allowCharts||S.allowSparkline?v.showTab(this._getLocStr("INSERT")):v.hideTab(this._getLocStr("INSERT")),S.allowDataValidation||S.allowFiltering||S.allowSorting?v.showTab(this._getLocStr("DATATAB")):v.hideTab(this._getLocStr("DATATAB")),S.printSettings.allowPrinting?v.showTab(this._getLocStr("PAGELAYOUT")):v.hideTab(this._getLocStr("PAGELAYOUT")),S.allowComments||S.allowLockCell?v.showTab(this._getLocStr("REVIEW")):v.hideTab(this._getLocStr("REVIEW")),S.allowFreezing||S.allowInsert||S.allowDelete||S.allowSearching?v.showTab(this._getLocStr("OTHERS")):v.hideTab(this._getLocStr("OTHERS")))},import:function(t){var i,r,l,n;if(this.model.allowImport){if(i={},r={},t.dataContainer||(this.model.allowCellFormatting&&this.XLFormat&&this.getObjectLength(this.XLFormat._customFontFamily)>0&&(r.customFontFamily=this.XLFormat._customFontFamily),this._isDefaultLocked&&(r.ExcelLikeLockedCells=!0),this.getObjectLength(r)&&(t.dataContainer=JSON.stringify(r))),t.password&&t.password.length&&(i.password=t.password),t.file&&t.file.name&&(i.fileName=t.file.name),this.model.beforeImport&&this._trigger("beforeImport",i))return!1;i.password&&i.password.length&&(t.password=i.password),l=this,n={type:"POST",data:this._import(t),async:!!this.isUndefined(t.async)||t.async,url:this.model.importSettings.importMapper,success:function(e){l.element&&l._importSuccess(e)},error:function(e,t){l._importFailed({type:t,xhr:{status:e.status,statusText:e.statusText}})}},("msie"!==this._browserDetails.name||"9.0"!==this._browserDetails.version||n.data.append)&&(n.processData=!1,n.contentType=!1),e("#"+this._id+"_Ribbon_BackStage").hide(),l.showWaitingPopUp(),e.ajax(n)}},_import:function(e){if(window.FormData&&this._isObject(e)){var t,i=new FormData;for(t in e)"async"!=t&&i.append(t,e[t]);return i}return e},_importSuccess:function(e){var t,i=["UnsupportedFile","IncorrectPassword","InvalidUrl","NeedPassword","CancellationRequested","ImportPreventedOnUnknownFormula"];if(this._renderAlertdlg(),i.indexOf(e)>-1){switch(e){case i[0]:case i[1]:case i[2]:case i[4]:case i[5]:this._showAlertDlg("Alert",e,"",null,110);break;case i[3]:this._showDialog(this._id+"_ImportPasswordDialog"),this.model.importSettings.password=""}this.hideWaitingPopUp()}else{if(t={data:e,reqType:"importing"},this._trigActionBegin(t))return void this.hideWaitingPopUp();e=t.data,this.loadFromJSON(JSON.parse(e))}},loadFromJSON:function(t){var i,r,l,n,s,o,a,d,h;if(this.isImport=!0,this.model.isImport=!0,(i=this.model.isReadOnly)&&(this.model.isReadOnly=!1),e("#"+this._id+"_file").ejUploadbox("option","autoUpload",!0),this._isSheetReq)r=Number(this.getObjectKeys(t.dataContainer.sheets)[0]),this._refreshImpStyles(t.dataContainer.hashCode),this._impData.dataContainer=e.extend(!0,{},t.dataContainer),this._impData.dataContainer.sheets=this._dataContainer.sheets,this._impData.dataContainer.cellType=this._dataContainer.cellType,this._impData.dataContainer.sheets[r]=t.dataContainer.sheets[r],this._impData.model.sheets[r]=t.sheet,this._dataContainer=e.extend(!0,{},this._impData.dataContainer),this._dataContainer.sheetCellType={},this._refreshModel(t.sheet,!0,r),this._sheetSettings(r),this._intrnlReq||this.gotoPage(r,!1),this._isSheetReq=!1;else{if("string"==typeof t.model&&(t.model=JSON.parse(t.model)),"string"==typeof t.dataContainer&&(t.dataContainer=JSON.parse(t.dataContainer)),this.getObjectLength(t.model.sheets[0])&&t.model.sheets.unshift({}),n=1,(o=t.model&&t.model.nameManager)&&o.length)for(a=0,d=o.length;a<d;a++)o[a].refersto=this._decode(o[a].refersto);if(this.model.scrollSettings.allowVirtualScrolling||(l=this._getMaxRowColCnt(t.model.sheets,!0)),this.model.scrollSettings.allowVirtualScrolling||t.dataContainer.sharedData.length<50001&&l.rowCount<10001&&l.colCount<126){if(this._impData=t,s={importData:t},this._trigger("onImport",s))return!1;if(this._isInitLoad)this._initBase();else{for(this._destroy(),this._refreshModel(t.model),this._dataContainer=e.extend(!0,{},t.dataContainer),this._dataContainer.sheetCellType={},this._initCSSTag();n<=this.model.sheetCount;)this._sheetSettings(n),this._newSIndex++,n++;for(n=1;n<=this.model.sheetCount;)this.model.scrollSettings.allowVirtualScrolling||this.model.importSettings.allowSheetOnDemand||this._initSheet(n),n++;this._refreshNameMngr(t.model.nameManager),this.gotoPage(this.getActiveSheetIndex(),!1),this._isRibbonDestroyed=!1}this._calcEngine.setCalculatingSuspended(t.model.isManualCalculation||!1),this._trigger("loadComplete"),this.clearUndoRedo()}else this._showAlertDlg("Alert","HugeDataAlert")}for(h=this.getObjectKeys(t.dataContainer.customCellStyle),n=0;n<h.length;n++)this.XLFormat.addNewCustomStyle(h[n],t.dataContainer.customCellStyle[h[n]]);this._intrnlReq||(this.isImport=!1,this.model.isImport=!1),this._intrnlReq=!1,this._renderDDownList(),this.hideWaitingPopUp(),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this.model.isReadOnly=i,this._isSSLoaded=!0},_importFailed:function(e){var t={failureType:e.type};e.xhr?(t.status=e.xhr.status,t.statusText=e.xhr.statusText):t.statusText=e.error,this.hideWaitingPopUp(),this._trigger("openFailure",t)},_importSheet:function(e,t){var i={},r=this.model.importSettings;this._isSheetReq=!0,(i={sheetIndex:e,allowSheetOnDemand:r.allowSheetOnDemand,password:r.password,async:t}).dataContainer=JSON.stringify({hashCode:this._dataContainer.hashCode,sharedData:this._dataContainer.sharedData,valData:this._dataContainer.valData,cFormatData:this._dataContainer.cFormatData}),this.import(i),this.getSheet(e)._isRequested=!0},_decode:function(t){return e("<div/>").html(t).text()},_refreshModel:function(e,t,i){var r,l,n,s=1;if(e)if(t)(n=this.model.sheets[this._getSheetIndex(i)]).rowCount=e.rowCount||this.defaults.rowCount,n.colCount=e.colCount||this.defaults.colCount;else{if(this.model.sheetCount=e.sheetCount||this.defaults.sheetCount,this.model.activeSheetIndex=e.activeSheetIndex||this.defaults.activeSheetIndex,this.model.rowHeight=e.rowHeight||this.defaults.rowHeight,this.model.columnWidth=e.columnWidth||this.defaults.columnWidth,!this._isRefresh)for(this.model.sheets=[{}],r=e.sheets.length;s<r;)l={rowCount:(n=e.sheets[s]).rowCount||this.defaults.rowCount,colCount:n.colCount||this.defaults.colCount},this.model.sheets.push(l),s++;e.nameManager&&e.nameManager.length&&(this.model.nameManager=e.nameManager)}else r=this.model.sheets.length,this.model.sheetCount<r&&(this.model.sheetCount=r);300===this.model.apWidth&&300!==this.model.activationPanelWidth?this.model.apWidth=this.model.activationPanelWidth:300!==this.model.apWidth&&300===this.model.activationPanelWidth&&(this.model.activationPanelWidth=this.model.apWidth)},_refreshImpStyles:function(e){for(var t,i,r=0,l=e.length;r<l;)i=e[r],-1===this._dataContainer.hashCode.indexOf(i)&&(-1===i.indexOf("e-format")?(this._dataContainer.hashCode.push(i),i.length<25&&this.XLFormat._writeCssRules(i,this.XLFormat._getCssPropertyAsString({border:this.XLFormat.getBorderFromHashCode(i)}))):(t=this.XLFormat.getFormatFromHashCode(i),this.XLFormat._createFormatClass(t))),r++},_refreshImpSheets:function(t){var i=this._impData.model.sheets[t];this._refreshImpTable(i.tableManager),this._refreshImpCells(t),this._refreshImpCF(t),this.model.allowMerging&&i.mergedCells&&this._refreshImpMC(i.mergedCells),this.model.allowFiltering&&i.filterSettings&&i.filterSettings.range&&this.XLFilter._filterCellRange(t,i.filterSettings.range),this._refreshImpHC(i.hideColsCollection),this._refreshImpHR(i.hideRowsCollection),this._refreshOverflow(),this.model.allowCellType&&this._refreshSheetCellTypes(this._impData.dataContainer.sheetCellType,t),this._refreshShapePosOnImp(i.shapeMngr,t),this._refreshImpCharts(i.shapeMngr.chart),this._refreshImpSparkline(i.shapeMngr.sparkline,t),this._refreshImpPics(i.shapeMngr,t),this._refreshImpPvts(i.pivotMngr,t),this.XLComment._updateCmntArrowPos(),!1===i.showGridlines&&e("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").ejCheckBox({checked:i.showGridlines}),i.isSheetProtected&&this.protectSheet(!0)},_refreshImpCells:function(e){for(var t,i,r,l,n,s,o=0,a=this.getSheet(e),d=a.usedRange,h=this.XLEdit._getPropWithCellIdx([0,0,d.rowIndex,d.colIndex],"value",e,!0),c=h.length;o<c;)i=h[o],(r=this.XLEdit.getPropertyValue(i.rowIdx,i.colIdx,"formulaRange"))&&(this.XLEdit._formulaArrayRange=this.getRangeIndices(r)),this.XLEdit._refreshCalcEngine(i.rowIdx,i.colIdx,!0,i.value,e),this.XLEdit._formulaArrayRange="",o++;if(this.model.allowCellFormatting){for(o=0,c=(h=this.XLEdit._getPropWithCellIdx([0,0,d.rowIndex,d.colIndex],"type",e)).length;o<c;)n=(i=h[o]).rowIdx,s=i.colIdx,t=this.getRangeData({range:[n,s,n,s],property:["value","formatStr"]})[0],"accounting"==i.value&&a.columnsWidthCollection[s]>a.columnWidth&&t.value&&!this.isFormula(t.value)&&(l=this.toAccounting(t.formatStr,t.value),this.XLEdit._updateDataContainer({rowIndex:n,colIndex:s},{dataObj:{type:"accounting",value2:l},sheetIdx:e})),o++;if(this.model.formatSettings.allowCellBorder)for(o=0,c=(h=this.XLEdit._getPropWithCellIdx([0,0,d.rowIndex,d.colIndex],"borders",e)).length;o<c;)i=h[o],this.XLFormat.applyBorder(i.value,[i.rowIdx,i.colIdx,i.rowIdx,i.colIdx]),o++}},_refreshSheetCellTypes:function(e,t){var i,r,l=[];if(!(this.getObjectLength(e)<1)){for(i=1,r=this.getObjectLength(e[t]);i<=r;i++)l.push({range:e[t][i].settings.range,settings:e[t][i].settings});this.XLCellType._rangeCellTypes(l,t,!0)}},_refreshImpCF:function(e){if(this.model.allowConditionalFormats)for(var t,i,r=this._impData.dataContainer.cFormatData.length,l=0;l<r;l++)t=this._impData.dataContainer.cFormatData[l].split("_"),(i=Number(t[5]))===e&&(this.XLCFormat._cFormat(t[0],t[1],t[2],t[3],t[4],t[6],i,this.getRangeIndices(t[6])),this._impData.dataContainer.cFormatData.splice(l,1),r=this._impData.dataContainer.cFormatData.length,l--)},_refreshImpMC:function(e){var t,i=e.length;if(i)for(;i--;)(t=e[i]).isCenterAlign&&(this.mergeCenter=!0),this.mergeCells(t.range,!0),this.mergeCenter=!1},_refreshImpHC:function(e){var t,i=this.getObjectKeys(e),r=i.length;if(r)for(;r--;)t=parseInt(i[r]),this._hideColumn(t,t)},_refreshImpResRowHght:function(e){for(var t,i,r,l,n,s,o,a,d,h,c,u,g=this.getSheet(e),p=g._restrictedHeightRows,m=this._dataContainer.sheets[e],_=this._dataContainer.hashCode,f=!0,b=[],C=this._impData&&this._impData.model.sheets[e]&&this._impData.model.sheets[e].mergedCells?this._impData.model.sheets[e].mergedCells:this._copySheet?g.mergedCells:[],S=0;S<C.length;S++)a=this.getRangeIndices(C[S].range),b.push(a);for(i=this.element.find("#"+this._id+"_emptyDiv"),t=0;t<p.length;t++)for(l in o=m[n=p[t]])if((h=this._dataContainer.sharedData[o[l].value])&&!this.isFormula(h)&&(s=o[l].formats)){if(r=_[s],o[l].wrap){for(c=0,u=b.length;c<u;c++)if((a=b[c])[0]<=n&&a[2]>=n&&a[1]<=l&&a[3]>=l){f=!1;break}f&&(i.width(g.columnsWidthCollection[l]-3),r+=" e-sswraptext")}this.addClass(i[0],r),i.text(h),d=i[0].offsetHeight+1,g.rowsHeightCollection[n]<d&&(g.rowsHeightCollection[n]=d),this._refreshGlobalSpan(null,!0),f=!0}},_refreshImpHR:function(e){var t,i,r,l=this.getActiveSheetIndex(),n=this.getSheet(l);e=e||[];var s,o=this.getRows(l),a=o[1],d=o[0],h=this._getJSSheetRowHeaderContent(l),c=h.find("tr");for(t=0,s=e.length;t<s;t++)r=(i=parseInt(e[t]))?i-1:0,this.isUndefined(this.XLEdit.getPropertyValue(r,0,"isRHide"))&&this.XLEdit._updateDataContainer({rowIndex:r,colIndex:0},{dataObj:{hRow:!0}}),this.model.scrollSettings.allowVirtualScrolling?this.addClass(h.find("[idx ="+r+"] .e-rowheader")[0],"e-hrow"):(this.addClass(c.find(".e-rowheader")[r],"e-hrow"),this.addClass(a[i],"e-r-hide"),this.addClass(d[i],"e-r-hide")),this.XLScroll._getRowHeights(l,n.hideRowsCollection.sort()[0])},_refreshImpTable:function(e){var t,i,r,l=this.getObjectLength(e);if(this.model.allowFormatAsTable&&l)for(;l--;)t=(r=e[l]).range,(i=this.XLFormat._getTableLayoutFromName(r.formatName))||(i=this.XLFormat._formatAsTableStyle,r.formatName=i.formatName),r.totalRow&&(t[2]=t[2]-1),this.XLFormat._isTableNameAdded=!0,this.XLFormat.createTable({header:!0,name:r.name,format:i.format,formatName:r.formatName,showHeaderRow:r.showHeaderRow,totalRow:r.totalRow},this._getAlphaRange(this.getActiveSheetIndex(),t[0],t[1],t[2],t[3])),this.XLFormat._isTableNameAdded=!1},_refreshImpCharts:function(e){var i,r,l,n,s,o,a;if(this.model.allowCharts)for(l=0,n=this.getObjectLength(e);l<n;){if(s=!1,r=e["chart"+l],i=this.getSheet(r.dataSheetIdx),r.dataSheetIdx!=this.getActiveSheetIndex()&&i._isImported&&!i._isRequested&&(this._intrnlReq=!0,this._importSheet(r.dataSheetIdx,!1)),!t.isNullOrUndefined(r.series))for(o=0,a=r.series.length;o<a;o++)if(!t.isNullOrUndefined(r.series[o].trendlines)&&r.series[o].trendlines.length>0){s=!0;break}s?this.XLChart.createChart(r.range,{type:r.commonSeriesOptions.type,enable3D:r.enable3D,marker:r.commonSeriesOptions.marker,top:r.top,left:r.left,height:r.size.height,width:r.size.width,title:r.title,legend:r.legend,primaryYAxis:r.primaryYAxis,primaryXAxis:r.primaryXAxis||{labelIntersectAction:"wrapByWord"},dataSheetIdx:r.dataSheetIdx,series:r.series,seriesRange:r.seriesRange,isRowColSwitched:r.isRowColSwitched}):this.XLChart.createChart(r.series?null:r.range,{type:r.commonSeriesOptions.type,enable3D:r.enable3D,marker:r.commonSeriesOptions.marker,top:r.top,left:r.left,height:r.size.height,width:r.size.width,title:r.title,legend:r.legend,primaryYAxis:r.primaryYAxis,primaryXAxis:r.primaryXAxis||{labelIntersectAction:"wrapByWord"},dataSheetIdx:r.dataSheetIdx,series:r.series,seriesRange:r.seriesRange,isRowColSwitched:r.isRowColSwitched}),l++}},_refreshImpSparkline:function(e,t){if(this.model.allowSparkline)for(var i,r,l,n,s,o=0,a=this.getObjectKeys(e),d=[];o<a.length;){for(s=e[a[o]],r=this._getCellInfo({rowIndex:s.rowIndex,colIndex:s.colIndex},s.sheetIdx),i=0,n=(l=this.getRangeData({range:this._getRangeArgs(s.DataRange,Array,s.SheetIndex),property:["value"],sheetIdx:s.SheetIndex})).length;i<n;i++)d.push(parseInt(l[i].value));s.dataSource=d,this.XLSparkline._createSparkline(s,r,t),d=[],o++}},_refreshImpPics:function(e,t){if(this.model.pictureSettings.allowPictures)for(var i,r=0,l=this.getObjectKeys(e.picture),n=l.length;r<n;)(i=e.picture[l[r]]).sheetIdx=t,this.getSheet(t)._isUpdated?(i.imgData=e.sharedPics[i.data],this.XLShape._refreshPictureElement(i)):this.XLShape._createPicture(t,null,e.sharedPics[i.data],i.top,i.left,i.width,i.height,null,i.bcolor,i.bstyle,i.bwidth,i),r++},_refreshShapePosOnImp:function(e,t){var i,r,l,n,s,o=e.chart,a=e.picture,d=this.getSheet(t),h=d._rowHeightCollection,c=d.rowsHeightCollection,u=this._impData?this._impData.model.sheets[t].rowsHeightCollection:[];if(!this.getObjectLength(a)&&!this.getObjectLength(o))return!1;for(i=0;i<u.length;i++)if(u[i]!==c[i]){for(l in r=c[i]-u[i],n=h[i+1]-r,a)(s=a[l].top)>n&&(a[l].top=s+r);for(l in o)(s=o[l].top)>n&&(o[l].top=s+r)}},_refreshImpPvts:function(e,t){if(this.model.enablePivotTable&&e)for(var i,r,l=0,n=this.getObjectLength(e.pivot),s=this.getObjectKeys(e.pivot);l<n;)r={rows:(i=e.pivot[s[l]]).rows,columns:i.columns,values:i.values,filters:i.filters},this.getSheet(t)._isUpdated?this.XLPivot._refreshPivotElement(i.dataSheetName+"!"+this._getProperAlphaRange(this._getSheetIndexByName(i.dataSheetName),i.dataRange[0],i.dataRange[1],i.dataRange[2],i.dataRange[3]),this.getSheet(i.sheetIdx).sheetInfo.text+"!"+this._getProperAlphaRange(i.sheetIdx,i.rowIndex,i.colIndex,i.rowIndex,i.colIndex),s[l],r,i):this.XLPivot.createPivotTable(i.dataSheetName+"!"+this._getProperAlphaRange(this._getSheetIndexByName(i.dataSheetName),i.dataRange[0],i.dataRange[1],i.dataRange[2],i.dataRange[3]),this.getSheet(i.sheetIdx).sheetInfo.text+"!"+this._getProperAlphaRange(i.sheetIdx,i.rowIndex,i.colIndex,i.rowIndex,i.colIndex),s[l],r,i),l++;this._isExport||this._getContent(t).find(".e-ss-activepivot").removeClass("e-ss-activepivot"),this.hideActivationPanel()},_refreshNameMngr:function(e){var t=(e=e||this.model.nameManager).length;if(this.model.showRibbon){if(t)for(;t--;)this.XLRibbon._addNamedRange(e[t].name,e[t].refersto,e[t].comment,e[t].sheetIndex,e[t].scope);this.XLRibbon._updateUseInFormulaTrgt()}this.model.nameManager=e,this.XLEdit._refreshAutoComplete()},_getBorderInput:function(e){e=e.split("_");for(var t=4,i={},r=["top","right","bottom","left"];t--;)e[t].length&&(i[r[t]]=e[t]);return i},_refreshHashCode:function(e){for(var t,i=(e=e||this._dataContainer.hashCode).length;i--;)-1===(t=e[i]).indexOf("e-format")&&-1===t.indexOf("e-border")&&(e[i]="")},clearUndoRedo:function(){this._undoCollection=[],this._redoCollection=[],this._updateUndoRedoIcons()},_initializePicture:function(e){this._getJSSheetContent(e).find(".e-spreadsheetcontentcontainer > .e-content").append(t.buildTag("div.e-ss-imgvisual"))},_getShapePositionInManager:function(e,t,i,r){for(var l=this.getActiveSheetIndex(),n=this._dataContainer.sheets[l][e][t],s=0,o=n.length;s<o&&n[r][s].id!==i;s++);return s},_swapVal:function(e){var t=e.prev;e.prev=e.cur,e.cur=t},_getValue:function(e,t){for(var i,r=e.length;r--;)if((i=e[r]).value===t)return i.value},_isRowViewable:function(e,t){var i=this.getSheet(e),r=i._isVPRendered;return this.model.scrollSettings.allowVirtualScrolling&&(r=i._virtualRowIdx.indexOf(t)>-1),r},_isColumnViewable:function(){return!0},_undoRedoOperation:function(t){var i,r,l=this.getActiveCell();90!==t.which&&90!==t.keyCode||!t.ctrlKey?(89===t.which||89===t.keyCode)&&t.ctrlKey&&(t.preventDefault(),t.target.id.indexOf("_Edit")>-1||t.target.id.indexOf("_input")>-1?l.rowIndex===this._undoInputobj.rowIndex&&l.colIndex===this._undoInputobj.colIndex&&(t.target.id.indexOf("_Edit")>-1?t.target.textContent=this._undoInputobj.value:e("#"+this._id+"_Edit")[0].textContent=this._undoInputobj.value,this.model.allowFormulaBar&&this._getInputBox().val(this._undoInputobj.value)):(this._isUndo=!1,this._performUndoRedo())):(t.preventDefault(),t.target.id.indexOf("_Edit")>-1||t.target.id.indexOf("_input")>-1?(i=this.XLEdit.getCurrentEditCellData())!==this._cureditedCell&&(r=i,t.target.id.indexOf("_Edit")>-1?t.target.textContent=this._cureditedCell:e("#"+this._id+"_Edit")[0].textContent=this._cureditedCell,this.model.allowFormulaBar&&this._getInputBox().val(this._cureditedCell),this._undoInputobj={value:r,rowIndex:l.rowIndex,colIndex:l.colIndex}):(this._isUndo=!0,this._performUndoRedo()))},undo:function(){this._isUndo=!0,this._performUndoRedo()},redo:function(){this._isUndo=!1,this._performUndoRedo()},_performUndoRedo:function(){var e,i,r=this._isUndo?this._undoCollection.pop():this._redoCollection.pop();if(!t.isNullOrUndefined(r)){switch(r.sheetIndex!==this.getActiveSheetIndex()&&this.gotoPage(r.sheetIndex,null),this._isUndoRedo=!0,r.reqType){case"auto-fill":this._undoForAutoFill(r);break;case"auto-sum":this._undoForAutoSum(r);break;case"cell-format":this._undoForFormat(r);break;case"cell-styles":this._undoForStyle(r);break;case"clear-all":this._undoForClAll(r);break;case"clear-comment":this._undoForClComment(r);break;case"clear-content":this._undoForClContent(r);break;case"clear-format":this._undoForClFormat(r);break;case"clear-link":this._undoForCLLink(r);break;case"comment":this._undoForComment(r);break;case"cond-format":this._undoForCondFormat(r);break;case"copy-paste":this._isCopyPaste=!0,this._undoForCopyPaste(r),this._isCopyPaste=!1;break;case"cut-paste":this._isCopyPaste=!0,this._undoForCutPaste(r),this._isCopyPaste=!1;break;case"delete":this._undoForDel(r);break;case"edit":this._undoForEdit(r);break;case"filter":this._undoForFilter(r);break;case"filterbycolor":this._undoForFilterByColor(r);break;case"find-replace":this._undoForFind(r);break;case"format-painter":this._undoForFormatPaint(r);break;case"format-table":this._undoForFormatTable(r);break;case"hyperlink":this._undoForHyperlink(r);break;case"insert":this._undoForIns(r);break;case"merge-cells":this._undoForMerge(r);break;case"paging":i=r.nSheetIndex,r.nSheetIndex=r.sheetIndex,r.sheetIndex=i;break;case"pivotgrid":this._undoForPivot(r);break;case"resize-column":this._undoForResizeCol(r);break;case"resize-row":this._undoForResizeRow(r);break;case"resize-fit-height":this._undoForResizeFHeight(r);break;case"resize-fit-width":this._undoForResizeFWidth(r);break;case"reorder-cells":this._undoForReOrder(r);break;case"show-hide":this._undoForShowHide(r);break;case"shape":this._undoForShape(r);break;case"sort":this._undoForSort(r);break;case"sortbycolor":this._undoForSortByColor(r);break;case"textwrap":this._undoForTextWrap(r);break;case"validation":this._undoForValidation(r);break;case"sparkline":this.XLSparkline._undoForSparkline(r)}if(this._isUndo?this._redoCollection.push(r):this._undoCollection.push(r),e={sheetIdx:r.sheetIndex,reqType:this._isUndo?"undo":"redo",operation:r},this._undoCollection.length>this.undoRedoStep&&this._undoCollection.splice(0,1),this._redoCollection.length>this.undoRedoStep&&this._redoCollection.splice(0,1),this._updateUndoRedoIcons(),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this._isUndoRedo=!1,this._isUndo=!1,this.model.allowSelection&&"shape"!=r.reqType&&this.XLSelection._refreshBorder(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this._trigActionComplete(e))return}},_undoForAutoFill:function(t){var i,r=this.getSheet(t.sheetIndex);if(this._isUndo){if(this.clearRangeData(t.range,this._cellProp),this.model.allowCellFormatting&&(this.XLFormat.removeStyle(t.range),this.XLFormat.updateFormat(t.bFormat,t.range),this.XLResize))for(i=t.range[0];i<=t.range[2];i++)this.XLResize.setRowHeight(i,t.bHeight[i]);this.updateData(e.extend(!0,[],t.bData),t.range),"flash-fill"==t.actionType&&this.updateData(e.extend(!0,[],t.bdData),t.bRange),t.colSel?this.XLSelection.selectColumns(r._startCell.colIndex,r._endCell.colIndex):t.rowSel?this.XLSelection.selectRows(r._startCell.rowIndex,r._endCell.rowIndex):this.performSelection({rowIndex:t.bRange[0],colIndex:t.bRange[1]},{rowIndex:t.bRange[2],colIndex:t.bRange[3]})}else{for(this.model.allowCellFormatting&&(this.XLFormat.removeStyle(t.range),this.XLFormat.updateFormat(t.aFormat,t.range)),this.updateData(e.extend(!0,[],t.aData),t.range),this.XLCFormat.refreshCFormat(),"flash-fill"==t.actionType&&this.updateData(e.extend(!0,[],t.adData),t.bRange),i=t.range[0];i<=t.range[2];i++)this.XLResize.setRowHeight(i,t.aHeight[i]);this.performSelection({rowIndex:t.bRange[0],colIndex:t.bRange[1]},{rowIndex:t.range[2],colIndex:t.range[3]})}},_undoForAutoSum:function(t){var i,r,l,n,s=this._dataContainer.sheets[t.sheetIndex];if(this._isUndo){for(l=0,n=t.updCell.length;l<n;l++)i=this.getCell(t.updCell[l].rowIndex,t.updCell[l].colIndex,t.sheetIndex),this._clearFormula(t.updCell[l].rowIndex,t.updCell[l].colIndex),this.clearRangeData([t.updCell[l].rowIndex,t.updCell[l].colIndex,t.updCell[l].rowIndex,t.updCell[l].colIndex],["value2"],null,!0),r=e.extend(!0,{},t.updCell[l].pObj),s[t.updCell[l].rowIndex][t.updCell[l].colIndex]=r,i.text(t.updCell[l].pValue);this.performSelection(t.range)}else this.XLRibbon.autoSum(t.oprType,t.range)},_undoForClAll:function(t){var i,r;if(this._isPaste=this._dupDetails=!0,this._isUndo){for(this.updateData(e.extend(!0,[],t.bData),t.range),this.XLFormat.updateFormat(e.extend(!0,[],t.bBorder),t.range),i=0,r=t.wrapColl.length;i<r;i++)this.setWrapText("wrap",[t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx,t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx]);for(i=0,r=t.mergeColl.length;i<r;i++)this.mergeCenter=t.mergeColl[i].mergeObj.isCenterAlign,this.mergeCells(t.mergeColl[i].mergeObj.mRange,!0)}else this.model.showRibbon&&this.XLRibbon._isMergeSelect&&this.XLRibbon._isFilterSelect.status?(this.clearRangeData(t.range,["value","value2","hyperlink","cFormatRule","comment"],"",!1),this.XLFormat.removeStyle(null,{cellStyle:!0,format:!0})):this.clearRangeData(t.range,["value","value2","format","formats","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","comment","cFormatRule","border"]),this.setWrapText("unwrap",t.range),this.unmergeCells(t.range);this._isPaste=this._dupDetails=!1,t.tblObj&&(this._isUndo?(this.XLClipboard._isCut=!0,this.XLFormat.createTable(t.tblObj,t.tblObj.range),this.XLClipboard._isCut=!1):(this.XLFormat.removeTable(t.tblObj.tblId),this.clearRangeData(t.range,["value","value2","format","formats","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","comment","cFormatRule"]),this.XLFormat.removeStyle(t.range,{cellStyle:!0,tableStyle:!0,format:!0,border:!0}),this.XLRibbon._toggleDesignTab(this.getActiveCell()))),this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t.range),this.model.allowDataValidation&&!this._isUndo&&this.XLValidate.clearDV(),this.model.allowFormulaBar&&this.updateFormulaBar()},_undoForClComment:function(e){var t,r,l,n,s;if(e.selectedCell.length){if(r={rowIndex:e.selectedCell[0].rowIndex,colIndex:e.selectedCell[0].colIndex},l={rowIndex:e.selectedCell[e.selectedCell.length-1].rowIndex,colIndex:e.selectedCell[e.selectedCell.length-1].colIndex},this._isUndo)for(n=0,s=e.selectedCell.length;n<s;n++)t={rowIndex:e.selectedCell[n].rowIndex,colIndex:e.selectedCell[n].colIndex},this.XLEdit._updateDataContainer({rowIndex:e.selectedCell[n].rowIndex,colIndex:e.selectedCell[n].colIndex},{dataObj:{comment:e.selectedCell[n].prevComment}}),this.XLSelection.selectRange(t,t),this.XLComment.setComment(),this.XLComment._updateCurCmntVal();else this.XLSelection.selectRange(r,l),this.XLComment.deleteComment(i,null,!1,"clear");this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()}},_undoForClContent:function(t){this._isUndo?this.updateData(e.extend(!0,[],t.bData),t.range):this.clearRangeData(t.range,["value","value2","type","hyperlink"],t.reqType),this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t.range),this.model.allowFormulaBar&&this.updateFormulaBar()},_undoForClFormat:function(t){if(this._isUndo){for(var i=0,r=t.wrapColl.length;i<r;i++)this.setWrapText("wrap",[t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx,t.wrapColl[i].rowIdx,t.wrapColl[i].colIdx]);for(i=0,r=t.mergeColl.length;i<r;i++)this.mergeCenter=t.mergeColl[i].mergeObj.isCenterAlign,this.mergeCells(t.mergeColl[i].mergeObj.mRange,!0);this.updateData(e.extend(!0,[],t.bData),t.range,t.reqType)}else this.XLRibbon._isMergeSelect&&this.XLRibbon._isFilterSelect.status?(this.clearRangeData(t.range,["decimalPlaces","thousandSeparator","hyperlink","cFormatRule"],"",!1,t.reqType),this.XLFormat.removeStyle(null,{cellStyle:!0,format:!0})):this.clearRangeData(t.range,["format","formats","border","type","formatstr","decimalPlaces","thousandSeparator","hyperlink","cFormatRule"],"",!1,t.reqType),this.setWrapText("unwrap",t.range),this.unmergeCells(t.range);this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t.range)},_undoForCLLink:function(e){var i,r,l,n,s={rowIndex:e.selectedCell[0].rowIndex,colIndex:e.selectedCell[0].colIndex},o={rowIndex:e.selectedCell[e.selectedCell.length-1].rowIndex,colIndex:e.selectedCell[e.selectedCell.length-1].colIndex};if(this.setActiveCell(e.selectedCell[0].rowIndex,e.selectedCell[0].colIndex),this.XLSelection.selectRange(s,o),this._isUndo)for(i=0,r=e.selectedCell.length;i<r;i++)e.selectedCell[i].prevLink&&(n=this.getCell(e.selectedCell[i].rowIndex,e.selectedCell[i].colIndex),e.selectedCell[i].prevLink.webAddr?n.html(t.buildTag("a.e-hyperlinks",e.selectedCell[i].prevText,"",{href:e.selectedCell[i].prevLink.webAddr,target:"_blank"})):n.html(t.buildTag("a.e-hyperlinks",e.selectedCell[i].prevText,"")),this.isUndefined(e.selectedCell[i].prevLink.cellAddr)?this.XLEdit._updateDataContainer({rowIndex:e.selectedCell[i].rowIndex,colIndex:e.selectedCell[i].colIndex},{dataObj:{hyperlink:{webAddr:e.selectedCell[i].prevLink.webAddr}}}):this.XLEdit._updateDataContainer({rowIndex:e.selectedCell[i].rowIndex,colIndex:e.selectedCell[i].colIndex},{dataObj:{hyperlink:{cellAddr:e.selectedCell[i].prevLink.cellAddr}}}));else this._removeHyperlink("clear",e.selectedCell);for(this.XLSelection.selectRange(s,o),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),i=0,r=e.selectedCell.length;i<r;i++)l=e.selectedCell[i].prevLink,e.selectedCell[i].prevLink=e.selectedCell[i].curLink,e.selectedCell[i].curLink=l},_undoForComment:function(e){var t,i,r,l,n,s;for(i={rowIndex:e.selectedCell[0].rowIndex,colIndex:e.selectedCell[0].colIndex},r={rowIndex:e.selectedCell[e.selectedCell.length-1].rowIndex,colIndex:e.selectedCell[e.selectedCell.length-1].colIndex},n=0,s=e.selectedCell.length;n<s;n++)t={rowIndex:e.selectedCell[n].rowIndex,colIndex:e.selectedCell[n].colIndex},this.XLSelection.selectRange(t,t),this.getSheet(e.sheetIndex)._startCell=t,"add"===e.action?(e.selectedCell[n].prevComment=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"comment"),this.XLComment&&this.XLComment.deleteComment()):"edit"===e.action?(this._isRowViewable(e.sheetIndex,t.rowIndex)&&this.getCell(t.rowIndex,t.colIndex).find(".e-comment-txtarea").val(e.selectedCell[n].prevComment.value),this.XLComment._updateCurCmntVal(),l=e.selectedCell[n].prevComment,e.selectedCell[n].prevComment=e.selectedCell[n].curComment,e.selectedCell[n].curComment=l):(this.XLEdit._updateDataContainer(t,{dataObj:{comment:e.selectedCell[n].prevComment}}),this.XLComment.setComment([t.rowIndex,t.colIndex,t.rowIndex,t.colIndex],null,!1),this.XLSelection.selectRange(t,t),this.XLComment._updateCurCmntVal(),l=e.selectedCell[n].prevComment,e.selectedCell[n].prevComment=e.selectedCell[n].curComment,e.selectedCell[n].curComment=l);"add"===e.action?e.action="delete":"delete"===e.action&&(e.action="add"),this.XLSelection.selectRange(i,r),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForCondFormat:function(e){var i,r,l,n,s,o,a,d,h,c,u,g=[];if(e.range=e.data,this._isUndo){if("add"===e.action){for(u=this._getSelectedRange({rowIndex:e.range[0],colIndex:e.range[1]},{rowIndex:e.range[2],colIndex:e.range[3]}),a=this.XLEdit.getPropertyValue(u[0].rowIndex,u[0].colIndex,"cFormatRule"),e.poppedRule=a[a.length-1],i=0,l=u.length;i<l;i++){if(h=this.XLEdit.getPropertyValue(u[i].rowIndex,u[i].colIndex,"cFormatRule"),!this.isUndefined(h))for(h.pop(),r=0,s=h.length;r<s;r++)o=h[r],0===g.length?(d=o.indexOf("true")>-1?o.replace("_true",""):o.replace("_false",""),g.push(d)):g=this._addCondFormatRule(g,o);this._isRowViewable(e.sheetIndex,u[i].rowIndex)&&((c=this.getCell(u[i].rowIndex,u[i].colIndex,e.sheetIndex)).removeClass("e-redft e-yellowft e-greenft e-redf e-redt"),c[0].style.color="",c[0].style.backgroundColor="",c.removeClass("e-cformat"))}for(this.clearRangeData(e.range,["cFormatRule"],u),i=0,l=g.length;i<l;i++)d=g[i].split("_"),this.XLCFormat._cFormat(d[0],d[2],d[3],d[4],d[5],d[6],e.sheetIndex,e.range)}else if("clear"===e.action)for(i=0,l=e.rule.length;i<l;i++)for(r=0,n=e.rule[i].length;r<n;r++)this.XLCFormat.setCFRule(e.rule[i][r])}else"add"===e.action?t.isNullOrUndefined(e.poppedRule)||(d=e.poppedRule.split("_"),this.XLCFormat._cFormat(d[0],d[2],d[3],d[4],d[5],d[6],e.sheetIndex,e.range)):"clear"===e.action&&(e.selection?this.XLCFormat.clearCF(e.range):this.XLCFormat.clearCF())},_getCopyText:function(e){for(var t,i,r,l=[],n=0,s=e.length;n<s;n++)for(t=0,i=(r=e[n].split("\t")).length;t<i;t++)l.push(r[t]);return l},_cutShape:function(t,i,r,l){for(var n,s,o,a=["picture","chart"],d=0,h=a.length;d<h;d++)if(a[d]in t)for(this.XLShape._picCellIdx={rowIndex:i.rowIndex,colIndex:i.colIndex},n=0,s=t[a[d]].length;n<s;n++)o=e.extend(!0,{},r[a[d]][t[a[d]][n]]),this.XLShape._deleteShape(l,this.element.find("#"+o.id))},_pasteShape:function(t,i,r,l){for(var n,s,o,a,d,h=["picture","chart"],c=0,u=h.length;c<u;c++)if(h[c]in t){for(n=0,s=t.picture.length;n<s;n++)o=e.extend(!0,{},r[h[c]][t[h[c]][n]]),1===this.XLChart._shapeCnt||this.XLChart._shapeCnt--,"picture"===h[c]?(d=this._id+"_picture",this.XLShape._createPicture(l,{rowIndex:i.rowIndex,colIndex:i.colIndex},r.sharedPics[o.data],o.top,o.left,o.width,o.height,parseInt(o.id.replace(d,"")))):(a=o.range,this.XLChart.createChart(this._getAlphaRange(l,a[0],a[1],a[2],a[3]),o));"chart"===h[c]&&this.XLSelection.selectRange({rowIndex:a[0],colIndex:a[1]},{rowIndex:a[2],colIndex:a[3]},l)}},_undoForCopyPaste:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T={},L=this._dataContainer,R=this.getSheet(i.pSheetIndex).shapeMngr;if("shape"===i.operation)r=i.pShapeId.indexOf("picture")>-1?"picture":"chart",l=e.extend(!0,{},i.pasteCell.obj),t.isNullOrUndefined(l)||(this.XLShape._picCellIdx={rowIndex:i.pasteCell.rowIndex,colIndex:i.pasteCell.colIndex},"chart"===r?"chart"in l&&(this._isUndo?(T=e.extend(!0,{},R.chart[i.pShapeId]),t.isNullOrUndefined(L.sheets[i.pSheetIndex][i.pasteCell.rowIndex])&&(L.sheets[i.pSheetIndex][i.pasteCell.rowIndex]={}),L.sheets[i.pSheetIndex][i.pasteCell.rowIndex][i.pasteCell.colIndex]=l,this.XLShape._deleteShape(i.pSheetIndex,this.element.find("#"+T.id))):(this.setActiveCell(i.pasteCell.rowIndex,i.pasteCell.colIndex,i.pSheetIndex),(T=e.extend(!0,{},i.pasteCell.shapeObj)).isChartSeries?this.XLChart.createChart(null,T):(p=T.range,this.XLChart.createChart(this._getAlphaRange(i.sheetIndex,p[0],p[1],p[2],p[3]),T),this.XLSelection.selectRange({rowIndex:p[0],colIndex:p[1]},{rowIndex:p[2],colIndex:p[3]},i.cSheetIndex)))):"picture"in l&&(this._isUndo?(T=e.extend(!0,{},R.picture[i.pShapeId]),t.isNullOrUndefined(L.sheets[i.pSheetIndex][i.pasteCell.rowIndex])&&(L.sheets[i.pSheetIndex][i.pasteCell.rowIndex]={}),L.sheets[i.pSheetIndex][i.pasteCell.rowIndex][i.pasteCell.colIndex]=l,this.XLShape._deleteShape(i.pSheetIndex,this.element.find("#"+T.id))):(T=e.extend(!0,{},i.pasteCell.shapeObj),f=this._id+"_picture",this.XLShape._createPicture(i.pSheetIndex,{rowIndex:i.pasteCell.rowIndex,colIndex:i.pasteCell.colIndex},R.sharedPics[T.data],T.top,T.left,T.width,T.height,parseInt(T.id.replace(f,"")),T.bcolor,T.bstyle,T.bwidth)))),this.XLScroll._getRowHeights(i.pSheetIndex,i.pasteCell.rowIndex);else{for(x=!1,v=[],L=this._dataContainer,this._getCopyText(i.text),this._dupDetails=!0,this.element.find(".e-cdata").length&&e("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),this.setActiveSheetIndex(i.pSheetIndex),a=0,d=i.pasteCells.length;a<d;a++)S=i.pasteCells[a],l=t.isNullOrUndefined(L.sheets[i.pSheetIndex][S.rowIndex])?{}:L.sheets[i.pSheetIndex][S.rowIndex][S.colIndex],this._isUndo||"merge"in S.prevObj&&(this.mergeCenter=S.prevObj.merge.isCenterAlign,this.mergeCells(S.prevObj.merge.mRange,!0)),this._isRowViewable(i.pSheetIndex,S.rowIndex)&&(h=this.getCell(S.rowIndex,S.colIndex,i.pSheetIndex)[0],this._isUndo||l&&!l.selIdxChange&&(h.textContent=v[a],this._removeClass(h,"e-cellreadonly")),x=!0),t.isNullOrUndefined(l)||(this._cutShape(l,S,R,i.pSheetIndex),c=this._generateHeaderText(S.colIndex+1)+(S.rowIndex+1),"wrap"in l&&this.setWrapText("unwrap",c+":"+c),this.model.allowSparkline&&"sparkline"in l&&(this.XLSparkline._removeSparklineElem(S.rowIndex,S.colIndex,i.pSheetIndex),o=this.XLEdit.getPropertyValue(S.rowIndex,S.colIndex,"sparkline",i.pSheetIndex),S.newSparklineProp=e.extend(!0,{},this.getSheet(i.pSheetIndex).shapeMngr.sparkline[o])),"merge"in l&&this._isUndo&&(S.newObj=e.extend(!0,{},L.sheets[i.pSheetIndex][S.rowIndex][S.colIndex]),this.unmergeCells(this._getAlphaRange(i.pSheetIndex,S.rowIndex,S.colIndex,S.rowIndex,S.colIndex)),this.getCell(S.rowIndex,S.colIndex,i.pSheetIndex).prop("rowspan",1).prop("colspan",1),"merge"in S.prevObj&&(this.mergeCenter=S.prevObj.merge.isCenterAlign,this.mergeCells(S.prevObj.merge.mRange,!0),this.mergeCenter=!1))),x&&this._isUndo&&("cellType"in l||(h.textContent=""),this._removeClass(h,"e-commentcell")),t.isNullOrUndefined(L.sheets[i.pSheetIndex][S.rowIndex])&&(L.sheets[i.pSheetIndex][S.rowIndex]={}),t.isNullOrUndefined(L.sheets[i.pSheetIndex][S.rowIndex][S.colIndex])||(b=L.sheets[i.pSheetIndex][S.rowIndex][S.colIndex].overflow),this.model.allowCellFormatting&&this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0,border:!0}),L.sheets[i.pSheetIndex][S.rowIndex][S.colIndex]=e.extend(!0,{},S.prevObj),b&&(L.sheets[i.pSheetIndex][S.rowIndex][S.colIndex].overflow=b),this._textClip(S.rowIndex,S.colIndex,"delete"),this._setRowHdrHeight(i.pSheetIndex,S.rowIndex),l=t.isNullOrUndefined(L.sheets[i.pSheetIndex][S.rowIndex])?{}:L.sheets[i.pSheetIndex][S.rowIndex][S.colIndex],m=S.rowIndex,_=S.colIndex,this._applyCommentLink(l,{rowIndex:S.rowIndex,colIndex:S.colIndex},m,_),this._isPaste=!0,t.isNullOrUndefined(l)||(this._pasteShape(l,{rowIndex:m,colIndex:_},R,i.pSheetIndex),"cellType"in l&&(this._isUndo?(this._removeClass(h,"e-cellreadonly"),l.cTypeObj&&this.model.allowCellType&&((C=this._dataContainer.sheetCellType[l.cellType]).text="",C.dataSource&&(C.field="text")),this.XLCellType._renderControls(S.rowIndex,S.colIndex,i.pSheetIndex,C,!0)):((C=this._dataContainer.sheetCellType[l.cellType]).text="",this.model.allowCellType&&this.XLCellType._renderControls(S.rowIndex,S.colIndex,i.pSheetIndex,C,!0))),this.model.allowSparkline&&"sparkline"in l&&(this.getSheet(i.pSheetIndex).shapeMngr.sparkline[l.sparkline[0]]=S.prevSparklineProp,this._isRowViewable(i.cSheetIndex,S.rowIndex)&&(this._getContent(i.cSheetIndex).find("#"+S.prevSparklineProp.id).length||(w=this._getCellInfo({rowIndex:S.rowIndex,colIndex:S.colIndex},i.cSheetIndex),this.XLSparkline._createSparkline(S.prevSparklineProp,w,i.pSheetIndex)))),c=this._generateHeaderText(S.colIndex+1)+(S.rowIndex+1),"wrap"in l&&(this.XLEdit._clearDataContainer({cellIdx:S,property:["wrap"]}),this.setWrapText("wrap",c+":"+c)),this._isPaste=!1),u=S.prevObj,S.prevObj=S.newObj,S.newObj=u,I=S.prevSparklineProp,S.prevSparklineProp=S.newSparklineProp,S.newSparklineProp=I;if(i.isSpecial&&(this.model.allowCellFormatting&&(this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0}),this.isUndefined(i.pasteBorder.prevBorder)||this.XLFormat.updateFormat(i.pasteBorder.prevBorder,i.pasteBorder.range,"format")),g=i.pasteBorder.prevBorder,i.pasteBorder.prevBorder=i.pasteBorder.newBorder,i.pasteBorder.newBorder=g),!t.isNullOrUndefined(i.pfat))for(n=0,s=(y=i.pfat.ptable).length;n<s;n++)t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),this._isUndo?(this.XLFormat.removeTable(y[n].id),this.XLFormat.removeStyle(y[n].range)):(y[n].header=!0,this.XLFormat.createTable(y[n],y[n].range)));t.isNullOrUndefined(i.filter)||(this.XLFilter.clearFilter(),this.XLFilter.filter(i.filter)),this._dupDetails=!1}"shape"!==i.operation&&(this._isUndo?(t.isNullOrUndefined(i.cSheetIndex)||this.setActiveSheetIndex(i.cSheetIndex),i.cutCells.length>0&&this.XLSelection._focusBorder(i.cutCells[0],i.cutCells[i.cutCells.length-1],this._cutFocus),this.setActiveSheetIndex(i.pSheetIndex),this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1])):(t.isNullOrUndefined(i.cSheetIndex)||this.setActiveSheetIndex(i.cSheetIndex),i.cutCells.length>0&&this.XLSelection._focusBorder(i.cutCells[0],i.cutCells[i.cutCells.length-1],this._cutFocus),this.setActiveSheetIndex(i.pSheetIndex),i.pasteCells.length>0&&this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1])),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this.XLScroll._getRowHeights(i.pSheetIndex,i.pasteCells[0].rowIndex))},_undoForCutPaste:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O={},F=this._dataContainer,E=this.getSheet(i.pSheetIndex).shapeMngr;if("shape"===i.operation)r=i.pShapeId.indexOf("picture")>-1?"picture":"chart",l=e.extend(!0,{},i.pasteCell.obj),t.isNullOrUndefined(l)||(this.XLShape._picCellIdx={rowIndex:i.pasteCell.rowIndex,colIndex:i.pasteCell.colIndex},O=e.extend(!0,{},E[r][i.pShapeId]),t.isNullOrUndefined(F.sheets[i.pSheetIndex][i.pasteCell.rowIndex])&&(F.sheets[i.pSheetIndex][i.pasteCell.rowIndex]={}),F.sheets[i.pSheetIndex][i.pasteCell.rowIndex][i.pasteCell.colIndex]=l,this.XLShape._deleteShape(i.pSheetIndex,this.element.find("#"+O.id))),l=e.extend(!0,{},i.cutCell.obj),r=i.cShapeId.indexOf("picture")>-1?"picture":"chart",t.isNullOrUndefined(l)||(this.setActiveCell(i.cutCell.rowIndex,i.cutCell.colIndex,i.cSheetIndex),"chart"===r?"chart"in l&&(b=(O=e.extend(!0,{},i.cutCell.shapeObj)).range,this.setActiveSheetIndex(i.cSheetIndex),this.XLChart.createChart(O.isChartSeries?null:this._getAlphaRange(i.sheetIndex,b[0],b[1],b[2],b[3]),O),this.setActiveSheetIndex(i.sheetIndex),O.isChartSeries||this.XLSelection.selectRange({rowIndex:b[0],colIndex:b[1]},{rowIndex:b[2],colIndex:b[3]},i.cSheetIndex)):"picture"in l&&(O=e.extend(!0,{},i.cutCell.shapeObj),d=this._id+"_picture",this.XLShape._createPicture(i.cSheetIndex,{rowIndex:i.cutCell.rowIndex,colIndex:i.cutCell.colIndex},E.sharedPics[O.data],O.top,O.left,O.width,O.height,parseInt(O.id.replace(d,"")),O.bcolor,O.bstyle,O.bwidth))),this.XLShape._picCellIdx={rowIndex:i.cutCell.rowIndex,colIndex:i.cutCell.colIndex},u=i.pasteCell,i.pasteCell=i.cutCell,i.cutCell=u,g=i.pShapeId,i.pShapeId=i.cShapeId,i.cShapeId=g;else{for(v=[],this.element.find(".e-cdata").length&&e("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),this._getCopyText(i.text),p=0,m=i.pasteCells.length;p<m;p++)t.isNullOrUndefined(i.pSheetIndex)||(this.isUndefined(F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex])||(l=F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex]),f=this._generateHeaderText(i.pasteCells[p].colIndex+1)+(i.pasteCells[p].rowIndex+1),"wrap"in l&&this.setWrapText("unwrap",f+":"+f),this._isRowViewable(i.pSheetIndex,i.pasteCells[p].rowIndex)&&(h=this.getCell(i.pasteCells[p].rowIndex,i.pasteCells[p].colIndex,i.pSheetIndex)[0],this.model.allowSparkline&&"sparkline"in l&&(this.XLSparkline._removeSparklineElem(i.pasteCells[p].rowIndex,i.pasteCells[p].colIndex,i.pSheetIndex),I=this.XLEdit.getPropertyValue(i.pasteCells[p].rowIndex,i.pasteCells[p].colIndex,"sparkline",i.pSheetIndex),i.pasteCells[p].newSparklineProp=e.extend(!0,{},this.getSheet(i.pSheetIndex).shapeMngr.sparkline[I])),h.textContent="",this._removeClass(h,"e-commentcell")),this.isUndefined(l)||(this._cutShape(l,i.pasteCells[p],E,i.pSheetIndex),"merge"in l&&(this._isUndo?(e.extend(!0,i.pasteCells[p].newObj,F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex]),this.setActiveSheetIndex(i.pSheetIndex),this.unmergeCells(l.merge.mRange),this.getCell(i.pasteCells[p].rowIndex,i.pasteCells[p].colIndex,i.pSheetIndex).prop("rowspan",1).prop("colspan",1),"merge"in i.pasteCells[p].prevObj&&(this.mergeCenter=i.pasteCells[p].prevObj.merge.isCenterAlign,this.mergeCells(i.pasteCells[p].prevObj.merge.mRange,!0),this.mergeCenter=!1)):(this.setActiveSheetIndex(i.pSheetIndex),this.unmergeCells(l.merge.mRange,!0),"merge"in i.pasteCells[p].prevObj&&(this.mergeCenter=i.pasteCells[p].prevObj.merge.isCenterAlign,this.mergeCells(i.pasteCells[p].prevObj.merge.mRange,!0),this.mergeCenter=!1),this.setActiveSheetIndex(i.cSheetIndex),this.unmergeCells(this._getAlphaRange(i.pSheetIndex,i.cutCells[p].rowIndex,i.cutCells[p].colIndex,i.cutCells[p].rowIndex,i.cutCells[p].colIndex)),b=this.getRangeIndices(i.cutCells[p].prevObj.merge.mRange),this.XLSelection.selectRange({rowIndex:b[0],colIndex:b[1]},{rowIndex:b[2],colIndex:b[3]},i.sheetIndex))),"cellType"in l&&(this._removeClass(h,"e-cellreadonly"),l.cTypeObj&&this.model.allowCellType&&((w=this._dataContainer.sheetCellType[l.cellType]).text="",w.dataSource&&(w.field="text")),this.XLCellType._renderControls(u.rowIndex,u.colIndex,i.pSheetIndex,w,!0))),this.isUndefined(F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex])&&(F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex]={}),t.isNullOrUndefined(F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex])||(n=F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex].overflow),this.model.allowCellFormatting&&this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0,border:!0}),F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex].wrap&&(c=!0),F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex]=e.extend(!0,{},i.pasteCells[p].prevObj),this._textClip(i.pasteCells[p].rowIndex,i.pasteCells[p].colIndex,"delete"),this.isUndefined(F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex])||(n&&(F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex].overflow=n),this._setRowHdrHeight(i.pSheetIndex,i.pasteCells[p].rowIndex),l=F.sheets[i.pSheetIndex][i.pasteCells[p].rowIndex][i.pasteCells[p].colIndex],S=i.pasteCells[p].rowIndex,x=i.pasteCells[p].colIndex,this._applyCommentLink(l,{rowIndex:S,colIndex:x},S,x),c&&(l.wrap=c),this._isPaste=!0,t.isNullOrUndefined(l)||(this._pasteShape(l,{rowIndex:S,colIndex:x},E,i.pSheetIndex,i.sheetIndex),f=this._generateHeaderText(x+1)+(S+1),"wrap"in l&&(this.XLEdit._clearDataContainer({cellIdx:i.pasteCells[p],property:["wrap"]}),this.setWrapText("wrap",f+":"+f)))),_=i.pasteCells[p].prevObj,i.pasteCells[p].prevObj=i.pasteCells[p].newObj,i.pasteCells[p].newObj=_,y=i.pasteCells[p].prevSparklineProp,i.pasteCells[p].prevSparklineProp=i.pasteCells[p].newSparklineProp,i.pasteCells[p].newSparklineProp=y,this._isPaste=!1);for(p=0;p<i.cutCells.length;p++)t.isNullOrUndefined(i.cSheetIndex)||(C=i.cutCells[p],this._isRowViewable(i.cSheetIndex,C.rowIndex)&&(this.getCell(C.rowIndex,C.colIndex,i.cSheetIndex)[0].textContent=v[p]),this.setActiveSheetIndex(i.cSheetIndex),l=t.isNullOrUndefined(F.sheets[i.cSheetIndex][C.rowIndex])?{}:F.sheets[i.cSheetIndex][C.rowIndex][C.colIndex],t.isNullOrUndefined(l)||this._cutShape(l,C,E,i.cSheetIndex),t.isNullOrUndefined(F.sheets[i.cSheetIndex][C.rowIndex])&&(F.sheets[i.cSheetIndex][C.rowIndex]={}),t.isNullOrUndefined(F.sheets[i.cSheetIndex][C.rowIndex][C.colIndex])||(n=F.sheets[i.cSheetIndex][C.rowIndex][C.colIndex].overflow),C.prevObj.tableName&&delete C.prevObj.tableName,F.sheets[i.cSheetIndex][C.rowIndex][C.colIndex]=e.extend(!0,{},C.prevObj),this.getObjectLength(n)>0&&(F.sheets[i.cSheetIndex][C.rowIndex][C.colIndex].overflow=n)&&(n={}),_=C.prevObj,C.prevObj=C.newObj,C.newObj=_,y=C.prevSparklineProp,C.prevSparklineProp=C.newSparklineProp,C.newSparklineProp=y,S=C.rowIndex,x=C.colIndex,this._setRowHdrHeight(i.cSheetIndex,S),this.XLScroll._getRowHeights(i.cSheetIndex,S),l=t.isNullOrUndefined(F.sheets[i.cSheetIndex][S])?{}:F.sheets[i.cSheetIndex][S][x],this._applyCommentLink(l,{rowIndex:S,colIndex:x},S,x),this._isPaste=!0,t.isNullOrUndefined(l)||(this._pasteShape(l,{rowIndex:S,colIndex:x},E,i.cSheetIndex),"merge"in l&&(this.mergeCenter=l.merge.isCenterAlign,this.mergeCells(l.merge.mRange,!0),this.mergeCenter=!1),"cellType"in l&&((w=this._dataContainer.sheetCellType[l.cellType]).text="",this.model.allowCellType&&this.XLCellType._renderControls(C.rowIndex,C.colIndex,i.pSheetIndex,w,!0)),this.model.allowSparkline&&"sparkline"in l&&(this.getSheet(i.pSheetIndex).shapeMngr.sparkline[l.sparkline[0]]=C.newSparklineProp,this._isRowViewable(i.cSheetIndex,C.rowIndex)&&(this._getContent(i.cSheetIndex).find("#"+C.newSparklineProp.id).length||this.XLSparkline._refreshSparklineClipboard(C.rowIndex,C.colIndex,i.pSheetIndex,i.cSheetIndex,!0))),this._dupDetails=!0,f=this._generateHeaderText(C.colIndex+1)+(C.rowIndex+1),"wrap"in l&&(this.XLEdit._clearDataContainer({cellIdx:C,property:["wrap"]}),this.setWrapText("wrap",f+":"+f)),this._dupDetails=!1),this._isPaste=!1);if(this.XLScroll._getRowHeights(i.pSheetIndex,i.pasteCells[0].rowIndex<i.cutCells[0].rowIndex?i.pasteCells[0].rowIndex:i.cutCells[0].rowIndex),this.model.allowCellFormatting&&!t.isNullOrUndefined(i.pSheetIndex)&&(this.setActiveSheetIndex(i.pSheetIndex),this.XLFormat.removeStyle(i.pasteBorder.range,{cellStyle:!0,tableStyle:!0,format:!0}),this.isUndefined(i.pasteBorder.prevBorder)||this.XLFormat.updateFormat(i.pasteBorder.prevBorder,i.pasteBorder.range,"format")),a=i.pasteBorder.prevBorder,i.pasteBorder.prevBorder=i.pasteBorder.newBorder,i.pasteBorder.newBorder=a,this.model.allowCellFormatting&&!t.isNullOrUndefined(i.cSheetIndex)&&(this.setActiveSheetIndex(i.cSheetIndex),i.isSpecial&&this.XLFormat.removeStyle(i.cutBorder.range,{cellStyle:!0,tableStyle:!0,format:!0}),i.cutBorder.prevBorder&&this.XLFormat.updateFormat(i.cutBorder.prevBorder,i.cutBorder.range,"format")),a=i.cutBorder.prevBorder,i.cutBorder.prevBorder=i.cutBorder.newBorder,i.cutBorder.newBorder=a,!t.isNullOrUndefined(i.pfat)){var D,N,A,P=i.pfat.table,k=i.pfat.minRowIdx,j=i.pfat.minColIdx,M=i.pfat.range;for(s=0,o=P.length;s<o;s++)N=P[s].range,t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),A=P[s].tblObj.tblId,D=i.pfat.ptable[s].range,this.XLFormat.removeTable(A),this.XLFormat.removeStyle(D)),t.isNullOrUndefined(i.cSheetIndex)||(this.setActiveSheetIndex(i.cSheetIndex),this.XLClipboard._isCut=!0,this._isUndo?(this.XLFormat.createTable(P[s].tblObj,P[s].range),P[s].tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,A,P[s].tblObj.fnNumber,P[s].range,!0)):(D=this.getRangeIndices(this._getAlphaRange(i.cSheetIndex,N[0]+k-M[0],N[1]+j-M[1],k-M[0]+N[2],j-M[1]+N[3])),this.XLFormat.createTable(P[s].tblObj,D),P[s].tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,A,P[s].tblObj.fnNumber,D,!0)),this.XLClipboard._isCut=!1)}t.isNullOrUndefined(i.filter)||(this.XLFilter.clearFilter(),this.XLFilter.filter(i.filter))}"shape"!==i.operation&&(this._isUndo?(t.isNullOrUndefined(i.cSheetIndex)||(this.setActiveSheetIndex(i.cSheetIndex),this.XLSelection.selectRange(i.cutCells[0],i.cutCells[i.cutCells.length-1])),t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1]))):(t.isNullOrUndefined(i.pSheetIndex)||(this.setActiveSheetIndex(i.pSheetIndex),this.XLSelection._focusBorder(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1],this._cutFocus),this.XLSelection.selectRange(i.pasteCells[0],i.pasteCells[i.pasteCells.length-1])),t.isNullOrUndefined(i.cSheetIndex)||(this.setActiveSheetIndex(i.cSheetIndex),this.XLSelection.selectRange(i.cutCells[0],i.cutCells[i.cutCells.length-1])))),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),T=i.pasteCells,i.pasteCells=i.cutCells,i.cutCells=T,L=i.pasteBorder,i.pasteBorder=i.cutBorder,i.cutBorder=L,R=i.cSheetIndex,i.cSheetIndex=i.pSheetIndex,i.pSheetIndex=R},_undoForDel:function(t){switch(this._delCells=e.extend(!0,[],t.delCells),this._deletedText=e.extend(!0,[],t.text),this._removeMergeColl=e.extend(!0,[],t.removeMerge),this._deletedDimension=e.extend(!0,[],t.deletedDimension),this._isUndo&&(this._fRow.fRowCnt=t.fRow.fRowCnt,this._fCol.fColCnt=t.fCol.fColCnt,this._fRow.rowAdj=t.fRow.rowAdj,this._fCol.colAdj=t.fCol.colAdj,this._nmRef=t.nmref),e.extend(!0,this._cellTypesUndo,t.prevCellTypes),e.extend(!0,this._cellTypesRedo,t.curCellTypes),e.extend(!0,this._chartUndo,t.prevChartDetails),e.extend(!0,this._chartRedo,t.curChartDetails),e.extend(!0,this._valDataUndo,t.prevValData),e.extend(!0,this._valDataRedo,t.curValData),t.action){case"deleteShiftUp":this.deleteShiftUp(t.startCell,t.endCell);break;case"deleteShiftLeft":this.deleteShiftLeft(t.startCell,t.endCell);break;case"deleteRow":this.deleteEntireRow(t.startCell.rowIndex,t.endCell.rowIndex);break;case"deleteColumn":this.deleteEntireColumn(t.startCell.colIndex,t.endCell.colIndex)}},_undoForEdit:function(e){var i,r,l,n,s,o,a,d,h,c,u=e.cFormatRule,g={rowIndex:e.rowIndex,colIndex:e.colIndex},p=this.getRows(e.sheetIndex);if(this.setActiveCell(e.rowIndex,e.colIndex,e.sheetIndex),this.XLSelection.selectRange(e.startCell,e.endCell),this._isRowViewable(e.sheetIndex,e.rowIndex)&&(c=(h=this.getCell(e.rowIndex,e.colIndex)).find("a").css("text-decoration"),e.altwrap&&(this._isUndo?(this.XLEdit._clearDataContainer({cellIdx:g,property:["altTxt"]}),this.unWrapText([e.rowIndex,e.colIndex,e.rowIndex,e.colIndex])):(this.XLEdit._updateDataContainer(g,{dataObj:{altTxt:!0}}),this.wrapText([e.rowIndex,e.colIndex,e.rowIndex,e.colIndex])))),r=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"hyperlink",e.sheetIndex),t.isNullOrUndefined(r)||(l=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"value2"),e.action=l.length<1?"add":"delete",e.reqType="edit",g.prevLink=r,g.prevText=l,e.selectedCell=[]),d=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"comment"),this.XLEdit._updateCellValue({rowIndex:e.rowIndex,colIndex:e.colIndex},e.pValue),this._dupDetails=!0,u&&u.length){for(i=0,a=u.length;i<a;i++)o=u[i].split("_"),this.XLCFormat._cFormat(o[0],o[2],o[3],o[4],o[5],o[6]);this.XLCFormat.refreshCFormat(this._getAlphaRange(e.sheetIndex,e.rowIndex,e.colIndex,e.rowIndex,e.colIndex))}e.prevFrmtObj&&e.curFrmtObj&&(n=this._isUndo?e.prevFrmtObj:e.curFrmtObj,this.XLFormat.format(n,this._getAlphaRange(e.sheetIndex,e.rowIndex,e.colIndex,e.rowIndex,e.colIndex))),this._dupDetails=!1,this._textClip(e.rowIndex,e.colIndex,e.pValue.length>0?"add":"delete"),t.isNullOrUndefined(d)||(this.XLEdit._updateDataContainer({rowIndex:e.rowIndex,colIndex:e.colIndex},{dataObj:{comment:d}}),this.XLComment.setComment(),this.XLComment._updateCurCmntVal()),this._isRowViewable(e.sheetIndex,e.rowIndex)&&(r&&r.webAddr?h.html(t.buildTag("a",h.text(),"",{href:r.webAddr,target:"_blank",class:"e-hyperlinks"})):h.html(t.buildTag("a",h.text(),"",{class:"e-hyperlinks"})),h.find("a").css("text-decoration",c),h.removeClass("e-commentcell")),t.isNullOrUndefined(r)||(g.curLink=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"hyperlink"),g.curText=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"value2"),e.selectedCell.push(g)),e.prevHeight!=e.newHeight&&(this.getSheet(e.sheetIndex).rowsHeightCollection[e.rowIndex]=e.prevHeight,this._isRowViewable(e.sheetIndex,e.rowIndex)&&(p[0][e.rowIndex].style.height=e.prevHeight+"px",p[1][e.rowIndex].style.height=e.prevHeight+"px"),this._setRowHdrHeight(e.sheetIndex,e.rowIndex),this.XLScroll._getRowHeights(e.sheetIndex,e.rowIndex),s=e.newHeight,e.newHeight=e.prevHeight,e.prevHeight=s),s=e.cValue,e.cValue=e.pValue,e.pValue=s,this.XLEdit._isEdit=!1,s=e.previousValue,e.previousValue=e.value,e.value=s,this.model.allowFormulaBar&&this.updateFormulaBar(),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForFilter:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_=!1,f=[],b=[],C=i.sheetIndex||this.getActiveSheetIndex(),S=this._dataContainer.sheets[C];if("filter"===i.operation&&"filterbycell"!==i.requestType)if(this._isUndo){for(l=this._undoCollection.length-1;l>=0;l--){if("filter"===this._undoCollection[l].reqType&&this._undoCollection[l].tableID===i.tableID&&"filtering"===this._undoCollection[l].action&&"apply-filterIcon"!==this._undoCollection[l].status&&this._undoCollection[l].rowIndex===i.rowIndex&&this._undoCollection[l].colIndex===i.colIndex){for(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],r=this._undoCollection[l],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,r.tableID),l=0,n=r.filterCollection.length;l<n;l++)f.push(r.filterCollection[l]);this.model.sheets[r.sheetIndex].filterSettings.filteredColumns=f,t.isNullOrUndefined(this._excelFilter._predicates[r.sheetIndex][r.fieldName])&&(this._excelFilter._predicates[r.sheetIndex][r.fieldName]={}),this._excelFilter._predicates[r.sheetIndex][r.fieldName]=r.ejpredicate,this.model.sheets[r.sheetIndex]._selectedRange=r.range,this.XLFilter._filterHandler(r),_=!0;break}if("filter"===this._undoCollection[l].reqType&&this._undoCollection[l].tableID===i.tableID&&"clearfiltering"===this._undoCollection[l].action){delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],r=this._undoCollection[l],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,r.tableID),_=!0;break}if("filterbycell"===this._undoCollection[l].requestType&&this._undoCollection[l].rowIndex===i.rowIndex&&this._undoCollection[l].colIndex===i.colIndex){r=this._undoCollection[l],delete this._excelFilter._predicates[r.sheetIndex][r.fieldName],this.XLFilter._clearFilterColumn(r.fieldName,"","","Or",null,null,r.tableID),e.extend(!0,b,r.selCells),this.XLFilter._filterActiveCell(r.sheetIndex,r.activeCell,b,r.filteredValue,r.selRange),_=!0;break}}_||(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID))}else{for(f=[],delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),l=0,n=i.filterCollection.length;l<n;l++)f.push(i.filterCollection[l]);this.model.sheets[i.sheetIndex].filterSettings.filteredColumns=f,t.isNullOrUndefined(this._excelFilter._predicates[i.sheetIndex][i.fieldName])&&(this._excelFilter._predicates[i.sheetIndex][i.fieldName]={}),this._excelFilter._predicates[i.sheetIndex][i.fieldName]=i.ejpredicate,i.filterCollection.length&&this.XLFilter._filterHandler(i)}else if(this._isUndo){if("apply-filter"===i.operation&&"filterbycell"!==i.requestType)for(l=0,n=i.filteredCells.length;l<n;l++)s=i.filteredCells[l].rowIndex,o=i.filteredCells[l].colIndex,(a=this.getCell(s,o,i.sheetIndex)).find(".e-ssfilter").remove(),this._removeClass(a[0],"e-filterhdr"),this.addClass(a[0],"e-wrapword"),(this.isNumber(a.text())||"datetime"===this.XLEdit._parseValue(a.text(),{rowIndex:s,colIndex:o}).type||"currency"===this.XLEdit._parseValue(a.text(),{rowIndex:s,colIndex:o}).type||"percentage"===this.XLEdit._parseValue(a.text()).type)&&a.addClass(this._rAlign),delete S[s][o].isFilterHeader,delete S[s][o].filterState,delete S[s][o].isFilterVisible,this.XLEdit.getPropertyValue(s,o,"isFilterWrap")&&this.setWrapText("wrap",this._getAlphaRange(C,s,o,s,o));if("filterbycell"===i.requestType&&(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),!this.isUndefined(i.filteredCells)))for(l=0,n=i.filteredCells.length;l<n;l++)(a=this.getCell(i.filteredCells[l].rowIndex,i.filteredCells[l].colIndex,i.sheetIndex)).find(".e-ssfiltered, .e-ssfilter").remove(),this._removeClass(a[0],"e-filterhdr"),this.addClass(a[0],"e-wrapword"),(this.isNumber(a.text())||"datetime"===this.XLEdit._parseValue(a.text(),{rowIndex:i.filteredCells[l].rowIndex,colIndex:i.filteredCells[l].colIndex}).type||"currency"===this.XLEdit._parseValue(a.text(),{rowIndex:i.filteredCells[l].rowIndex,colIndex:i.filteredCells[l].colIndex}).type||"percentage"===this.XLEdit._parseValue(a.text(),{rowIndex:i.filteredCells[l].rowIndex,colIndex:i.filteredCells[l].colIndex}).type)&&a.addClass(this._rAlign);if(this.model.sheets[i.sheetIndex].filterSettings.range="","apply-filter"===i.operation&&"filterbycell"!=i.requestType||"filterbycell"===i.requestType&&!this.isUndefined(i.filteredCells)){for(l=0,n=(d=this.model.sheets[i.sheetIndex].filterSettings.tableRange).length;l<n;l++)if(d[l].tableID===i.tableID){h=l;break}i.filterRange=d.splice(h,1)[0]}if("remove-filter"===i.operation){if(c=this._undoCollection[this._undoCollection.length-1],u=this.getSheet(i.sheetIndex),"filterbycell"===c.requestType)e.extend(!0,b,c.selCells),this.XLFilter._filterActiveCell(c.sheetIndex,c.activeCell,b,c.filteredValue,c.selRange);else for(l=0,n=i.filteredCells.length;l<n;l++)g=this.XLFilter._getFilterIcon(),this.XLFilter._applyFilterIcon(i.filteredCells[l],g);for(u._selectedRange=i.selRange,u.filterSettings.filteredRange=i.fltrdRange,u.filterSettings.filteredColumns=i.filteredCols,u.filterSettings.range=i.fRange,u.filterSettings.tableRange.push(i.filterRange),p=0,m=i.filterCollection.length;p<m;p++)this._excelFilter._predicates[i.sheetIndex][i.filterCollection[p].fieldName]=i.filterCollection[p].predicate,this.XLFilter._filterHandler(i.filterCollection[p])}}else if("remove-filter"===i.operation&&("filterbycell"===i.requestType?(this._isRowViewable(i.sheetIndex,i.activeCell.rowIndex)&&this.getCell(i.activeCell.rowIndex,i.activeCell.colIndex).find("span.e-ssfilter").remove(),delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),e.extend(!0,b,i.selectedCell),this.XLFilter._filterActiveCell(i.sheetIndex,i.activeCell,b,i.filteredValue,i.selRange)):this.XLFilter.clearFilter("remove")),"filter"===i.operation&&"filterbycell"===i.requestType&&(delete this._excelFilter._predicates[i.sheetIndex][i.fieldName],this.XLFilter._clearFilterColumn(i.fieldName,"","","Or",null,null,i.tableID),e.extend(!0,b,i.selectedCell),this.XLFilter._filterActiveCell(i.sheetIndex,i.activeCell,b,i.filteredValue,i.selRange)),"apply-filter"===i.operation){for(u=this.getSheet(i.sheetIndex),l=0,n=i.filteredCells.length;l<n;l++)g=this.XLFilter._getFilterIcon(),this.XLFilter._applyFilterIcon({rowIndex:i.filteredCells[l].rowIndex,colIndex:i.filteredCells[l].colIndex},g);u.filterSettings.range=i.fRange,u.filterSettings.tableRange.push(i.filterRange)}},_undoForFilterByColor:function(e){var t,i,r=[];for(r.push(e),t=this._isUndo?this._undoCollection:r,delete this._excelFilter._predicates[e.sheetIndex][e.columnName],e.columnName&&this.XLFilter._clearFilterColumn(e.columnName,"","","Or",null,null,e.tableID),i=t.length-1;i>=0;i--)if(("filterbycolor"===t[i].reqType||"filter"===t[i].reqType)&&t[i].tableID===e.tableID&&t[i].rowIndex===e.rowIndex&&t[i].colIndex===e.colIndex){this.XLFilter._filterHandler(t[i]);break}},_undoForFind:function(e){var t,i,r,l;switch(e.operation){case"replace":this.XLEdit._updateCellValue({rowIndex:e.rowIndex,colIndex:e.colIndex},e.prevData.value,null,e.sheetIndex),l=e.prevData,e.prevData=e.newData,e.newData=l,this.XLSelection.selectRange({rowIndex:e.rowIndex,colIndex:e.colIndex},{rowIndex:e.rowIndex,colIndex:e.colIndex});break;case"replaceAll":for(i=0,r=e.selectedCell.length;i<r;i++)this.XLEdit._updateCellValue({rowIndex:e.selectedCell[i].rowIndex,colIndex:e.selectedCell[i].colIndex},e.selectedCell[i].prevData.value,null,e.selectedCell[i].sheetIndex),l=e.selectedCell[i].prevData,e.selectedCell[i].prevData=e.selectedCell[i].newData,e.selectedCell[i].newData=l;break;case"blanks":case"conditions":case"validations":case"formulas":case"rowdiff":case"coldiff":case"comments":case"constants":for(i=0,r=e.selectedCell.length;i<r;i++)t=this.getCell(e.selectedCell[i].rowIndex,e.selectedCell[i].colIndex,e.sheetIndex),this._isUndo?"coldiff"===t.operation||"rowdiff"===t.operation?e.selectedCell[i].isApply?t.removeClass("e-selected"):t.addClass("e-selected"):e.selectedCell[i].isApply?t.addClass("e-selected"):t.removeClass("e-selected"):t.removeClass("e-selected")}this.model.allowFormulaBar&&this.updateFormulaBar()},_undoForFormat:function(i){var r,l,n,s,o,a,d,h,c=!1,u=this._dataContainer.sheets[i.sheetIndex],g="";if(t.isNullOrUndefined(i.process))for("style"===i.oprType&&(this.XLFormat.removeStyle(i.range,{cellStyle:!0,format:!0}),g="e-format",!t.isNullOrUndefined(i.process)&&i.process.indexOf("border")>-1&&(g="e-border"),a=new RegExp("\\b"+g+".*?\\b","g")),d=0,h=i.selectedCell.length;d<h;d++)r=i.selectedCell[d],this._isRowViewable(i.sheetIndex,r.rowIndex)&&(n=this.getCell(r.rowIndex,r.colIndex)[0],c=!0),t.isNullOrUndefined(u[r.rowIndex])&&(u[r.rowIndex]={}),t.isNullOrUndefined(u[r.rowIndex][r.colIndex])&&(u[r.rowIndex][r.colIndex]={}),e.extend(!0,u[r.rowIndex][r.colIndex],i.selectedCell[d].beforeFormat),c&&("format"===i.oprType?(s=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2"),this.XLEdit._refreshTextNode(n,t.isNullOrUndefined(s)?"":s),this.XLEdit._refreshCellAlignment({cellIdx:{rowIndex:r.rowIndex,colIndex:r.colIndex}})):(l="e-format"===g?this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"format"):this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"border"),n.className=n.className.replace(a,""),l=t.isNullOrUndefined(l)?"":l,this.addClass(n,l))),i.selectedCell[0].colIndex===i.selectedCell[d].colIndex&&this.model.allowResizing&&(this._isUndo?this.XLResize.setRowHeight(i.selectedCell[d].rowIndex,i.selectedCell[d].bRowHeight):this.XLResize.setRowHeight(i.selectedCell[d].rowIndex,i.selectedCell[d].aRowHeight)),o=i.selectedCell[d].beforeFormat,i.selectedCell[d].beforeFormat=i.selectedCell[d].afterFormat,i.selectedCell[d].afterFormat=o,c=!1;if(!t.isNullOrUndefined(i.process)&&i.process.indexOf("border")>-1&&(this.XLFormat.removeStyle(i.range,{cellStyle:!0,tableStyle:!0,format:!1,border:!0}),this._isUndo?this.XLFormat.updateFormat(i.beforeFormat,i.range):"noborder"===i.process?this.XLFormat.format({border:{}},i.range):this.XLFormat.applyBorder(e.extend(!0,{},i.options),i.range),o=i.beforeFormat,i.beforeFormat=i.afterFormat,i.afterFormat=o,i.prevHeight.length)){for(d=0,h=i.prevHeight.length;d<h;d++)this.XLResize.setRowHeight(i.prevHeight[d][0],i.prevHeight[d][1]);o=i.prevHeight,i.prevHeight=i.newHeight,i.newHeight=o}i.status="undo-cellformat",this.performSelection(i.range)},_undoForFormatPaint:function(t){var i,r,l,n;for(this.XLCFormat.clearCF(t.range),this.XLFormat.removeStyle(t.range),this.updateData(e.extend(!0,[],t.beforeData),t.range),this.XLCFormat.refreshCFormat(t.range),r=0,n=t.unwrapCells.length;r<n;r++)this.setWrapText("unwrap",this._getAlphaRange(t.sheetIndex,t.unwrapCells[r].rowIndex,t.unwrapCells[r].colIndex,t.unwrapCells[r].rowIndex,t.unwrapCells[r].colIndex));for(r=0,l=t.wrapCells.length;r<l;r++)this.setWrapText("wrap",this._getAlphaRange(t.sheetIndex,t.wrapCells[r].rowIndex,t.wrapCells[r].colIndex,t.wrapCells[r].rowIndex,t.wrapCells[r].colIndex));i=t.unwrapCells,t.unwrapCells=t.wrapCells,t.wrapCells=i,i=t.beforeData,t.beforeData=t.afterData,t.afterData=i},_undoForFormatTable:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x=0,v=i.sheetIndex,w=this.getSheet(v).tableManager,I=i.header,y=e("#"+this._id+"_Ribbon").data("ejRibbon");switch(i.action){case"Design_Tools_ConvertToRange":if(this._isUndo)for(w[i.tableID]={name:i.name,range:i.beforeRange,format:i.format,formatName:i.formatName},this.performSelection(this._getAlphaRange(v,i.beforeRange[0],i.beforeRange[1],i.beforeRange[2],i.beforeRange[3])),this.XLFilter._filterTable(v,i.tableID),this.updateUniqueData({tableName:"e-table"+i.tableID},w[i.tableID].range),w[i.tableID].isFilter=i.isFilter,w[i.tableID].firstColumn=i.firstColumn,w[i.tableID].lastColumn=i.lastColumn,w[i.tableID].totalRow=i.totalRow,w[i.tableID].fnNumber=i.fnNumber,this.getSheet(v)._header[i.tableID]=I,g=this._getDollarAlphaRange(w[i.tableID].range,!0),this.XLRibbon.addNamedRange(i.name,g,null,v),this.XLFormat._updateTableFormula("addRange",w[i.tableID],v),_=(m=this.getObjectKeys(this._tableRangesFormula[i.name])).length,this._tableFormulaCollection[i.name]=[],r=0;r<_;r++)this._tableFormulaCollection[i.name].push({text:"["+m[r]+"]",display:m[r]});else i.tableID in w&&(this.XLFormat.removeTable(i.tableID),this.XLFilter._clearFilterTable(v,i.tableID),delete w[i.tableID],delete this.model.sheets[v]._header[i.tableID]);break;case"filtericon":f=e("#"+i.id).data("ejCheckBox"),b=i.tableId,i.check?f.option("checked",!1):f.option("checked",!0),w[b].isFilter=!i.check,i.check=!i.check;break;case"firstlastcolumn":C=e("#"+i.id).data("ejCheckBox"),i.check?(this.XLFormat.format({style:{"font-weight":"normal"}},i.range),C.option("checked",!1)):(this.XLFormat.format({style:{"font-weight":"bold"}},i.range),C.option("checked",!0)),w[i.tableId][i.prop]=!i.check,i.check=!i.check;break;case"totalrow":e("#"+i.id).ejCheckBox("option",{checked:!i.check}),i.check=!i.check;break;case"Design_Tools_ResizeTable":if(this._isUndo){for(this._isFATResize=!0,i.afterRange=e.extend(!0,[],i.afterRange),i.totalRow&&(this._dupDetails=!0,this.XLFormat._calculateTotalRow(v,i.tableId,!1),i.beforeRange[2]-=1,w[i.tableId].range[2]-=1),a=w[i.tableId].name,this.XLFormat.removeTable(i.tableId),this.XLFormat.removeStyle(i.afterRange),n=i.beforeRange[3]-i.beforeRange[1]+1,d=I[i.tableId].header?this.getRangeData({range:i.beforeRange}):this.getRangeData({range:i.beforeRange}).splice(n,this.getRangeData({range:i.beforeRange}).length),this.clearRangeData(i.beforeRange),I[i.tableId].header?this.updateData(d,[i.beforeRange[0],i.beforeRange[1],i.beforeRange[2],i.beforeRange[3]]):this.updateData(d,[i.beforeRange[0],i.beforeRange[1],i.beforeRange[2]-1,i.beforeRange[3]]),S={header:I[i.tableId].header,tblId:i.tableId,name:a,range:i.beforeRange,format:i.format,formatName:i.formatName,firstColumn:i.firstColumn,lastColumn:i.lastColumn,isFilter:i.isFilter,totalRow:i.totalRow},this.XLClipboard._isCut=!0,I[i.tableId].header?this.XLFormat.createTable(S,i.beforeRange):this.XLFormat.createTable(S,[i.beforeRange[0],i.beforeRange[1],i.beforeRange[2]-1,i.beforeRange[3]]),i.totalRow&&(this._dupDetails=!0,this.XLFormat._calculateTotalRow(v,i.tableId,!0),i.beforeRange=w[i.tableId].range),p=this.getSheet(v).filterSettings.tableRange,x=0;x<p.length;x++)if(p[x].tableID==i.tableId){p[x].endRow=p[x].selectedRange.endRow=i.beforeRange[2];break}this.XLClipboard._isCut=!1,this._isFATResize=!1}else this._isFATResize=!0,i.beforeRange=e.extend(!0,[],i.beforeRange),i.totalRow&&(this.XLFormat._calculateTotalRow(v,i.tableId,!1),i.afterRange=w[i.tableId].range=[i.afterRange[0],i.afterRange[1],i.afterRange[2]-1,i.afterRange[3]]),a=w[i.tableId].name,this.XLFormat.removeTable(i.tableId),this.XLFormat.removeStyle(i.beforeRange),n=i.beforeRange[3]-i.beforeRange[1]+1,d=I[i.tableId].header?this.getRangeData({range:i.afterRange}):this.getRangeData({range:i.afterRange}).splice(n,this.getRangeData({range:i.afterRange}).length),this.clearRangeData(i.afterRange),I[i.tableId].header?this.updateData(d,i.afterRange):this.updateData(d,[i.afterRange[0],i.afterRange[1],i.afterRange[2]-1,i.afterRange[3]]),S={header:I[i.tableId].header,tblId:i.tableId,name:a,range:i.beforeRange,format:i.format,formatName:i.formatName,firstColumn:i.firstColumn,lastColumn:i.lastColumn,isFilter:i.isFilter,totalRow:i.totalRow},this.XLClipboard._isCut=!0,I[i.tableId].header?this.XLFormat.createTable(S,i.afterRange):this.XLFormat.createTable(S,[i.afterRange[0],i.afterRange[1],i.afterRange[2]-1,i.afterRange[3]]),this.XLFilter._extendFilterRange(i.tableId,i.afterRange),i.totalRow&&(this.XLFormat._calculateTotalRow(v,i.tableId,!0),i.afterRange=w[i.tableId].range),this.XLClipboard._isCut=!1,this._isFATResize=!1;break;case"renaming":this.XLRibbon.removeNamedRange(w[i.tableId].name),document.getElementById(this._id+"_Ribbon_Design_Properties_TableName")&&(document.getElementById(this._id+"_Ribbon_Design_Properties_TableName").value=w[i.tableId].name=this._isUndo?i.prevName:i.newName),this.XLRibbon.addNamedRange(w[i.tableId].name,i.range,null,v),y.showTab(this._getLocStr("Design"));break;default:if(this._isUndo){if(a=w[i.tableID].name,this.XLFormat.removeTable(i.tableID),this.XLFormat.removeStyle(i.afterRange),i.tableStyle.header)for(r=0,l=i.beforeRangeHeader.length;r<l;r++)t.isNullOrUndefined(i.beforeRangeHeader[r].value2)?this.XLEdit._updateCellValue(this._getCellIdx(i.pcells[r]),""):this.isNumber(i.pcells[r].innerHTML)&&this.XLEdit._refreshCellAlignment({cellIdx:this._getCellIdx(i.pcells[r])});else n=i.afterRange[3]-i.afterRange[1]+1,this.clearRangeData(i.afterRange),this.updateData(e.extend(!0,[],i.beforeRangeData),i.afterRange);if(this.XLFormat.updateFormat(i.beforeFormat,i.afterRange),c=(h=i.beforeMergeRange).length)for(;x<c;)(u=h[x].value)&&(s=this.getRangeIndices(u.mRange),o=this._getSelectedRange({rowIndex:s[0],colIndex:s[1]},{rowIndex:s[2],colIndex:s[3]}),this.mergeCenter=u.isCenterAlign,this._mergeCells(i.sheetIndex,o,{},[])),x++}else this.XLFormat.createTable(i.tableStyle,i.beforeRange)}},_autosumFormatUpdate:function(e,t,i,r){var l,n={},s=this.getActiveSheetIndex();"general"!==e.type&&(this._dupDetails=!0,n.type=e.type,l=i?this._getAlphaRange(s,t[2]+1,t[3],t[2]+1,t[3]):this._getAlphaRange(s,t[0],t[1],t[2],t[3]),r?this.XLFormat.format({type:"general"},l+":"+l):this.XLFormat.format(n,l+":"+l),this._dupDetails=!1)},_undoForHyperlink:function(e){var t,i,r,l,n,s={rowIndex:e.selectedCell[e.selectedCell.length-1].rowIndex,colIndex:e.selectedCell[e.selectedCell.length-1].colIndex},o={rowIndex:e.selectedCell[0].rowIndex,colIndex:e.selectedCell[0].colIndex};for(this.setActiveCell(e.selectedCell[0].rowIndex,e.selectedCell[0].colIndex),this.XLSelection.selectRange(o,s),"add"===e.action?this._removeHyperlink(e.reqType,e.selectedCell):(e.action,this._setLink(e.selectedCell)),t=0,i=e.selectedCell.length;t<i;t++)r=e.selectedCell[t].prevLink,e.selectedCell[t].prevLink=e.selectedCell[t].curLink,e.selectedCell[t].curLink=r,l=e.selectedCell[t].prevText,e.selectedCell[t].prevText=e.selectedCell[t].curText,e.selectedCell[t].curText=l,n=e.selectedCell[t].prevColor,e.selectedCell[t].prevColor=e.selectedCell[t].curColor,e.selectedCell[t].curColor=n;"add"===e.action?e.action="delete":"delete"===e.action&&(e.action="add"),this.XLSelection.selectRange(o,s),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForIns:function(t){switch(e.extend(!0,this._delCells,t.delCells),e.extend(!0,this._deletedText,t.text),e.extend(!0,this._removeMergeColl,t.removeMerge),e.extend(!0,this._cellTypesUndo,t.prevCellTypes),e.extend(!0,this._cellTypesRedo,t.curCellTypes),e.extend(!0,this._chartUndo,t.prevChartDetails),e.extend(!0,this._chartRedo,t.curChartDetails),e.extend(!0,this._valDataUndo,t.prevValData),e.extend(!0,this._valDataRedo,t.curValData),t.action){case"insertShiftRight":this.insertShiftRight(t.startCell,t.endCell);break;case"insertShiftBottom":this.insertShiftBottom(t.startCell,t.endCell);break;case"insertRow":this.insertEntireRow(t.startCell.rowIndex,t.endCell.rowIndex);break;case"insertColumn":this.insertEntireColumn(t.startCell.colIndex,t.endCell.colIndex)}},_undoForMerge:function(e){var i,r,l,n,s,o,a,d;switch(this._delCells=e.hideCells,this._selMergeCells=[],e.action){case"merge-all":case"merge-across":case"un-merge":for(o=0,a=e.mCells.length;o<a;o++)n=t.isNullOrUndefined(e.mCells[o].prevObj)?{}:t.isNullOrUndefined(e.mCells[o].prevObj.merge)?{}:e.mCells[o].prevObj.merge,s=t.isNullOrUndefined(e.mCells[o].curObj)?{}:t.isNullOrUndefined(e.mCells[o].curObj.merge)?{}:e.mCells[o].curObj.merge,"un-merge"===e.action?t.isNullOrUndefined(n.mRange)||(i=this.getRangeIndices(n.mRange),r=this._getSelectedRange({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]}),this.mergeCenter=n.isCenterAlign,this._mergeCells(e.sheetIndex,r,{},[])):(l=this._getHiddenRowColumnCount(e.sheetIndex,s.mRange),this._unMergeAllCells(e.sheetIndex,o,e.mCells,[],l.hRow,l.hCol)),d=e.mCells[o].prevObj,e.mCells[o].prevObj=e.mCells[o].curObj,e.mCells[o].curObj=d;if("un-merge"!==e.action)for(o=0,a=e.mCells.length;o<a;o++)n=t.isNullOrUndefined(e.mCells[o].prevObj)?{}:t.isNullOrUndefined(e.mCells[o].prevObj.merge)?{}:e.mCells[o].prevObj.merge,s=t.isNullOrUndefined(e.mCells[o].curObj)?{}:t.isNullOrUndefined(e.mCells[o].curObj.merge)?{}:e.mCells[o].curObj.merge,t.isNullOrUndefined(s.mRange)||(i=this.getRangeIndices(s.mRange),r=this._getSelectedRange({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]}),this.mergeCenter=s.isCenterAlign,this._mergeCells(e.sheetIndex,r,{},[]));e.action="un-merge"===e.action?"merge-all":"un-merge"}i=this._getSelectedCells(e.sheetIndex,e.range).range,r=this._getSelectedRange({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]}),this.performSelection(r[0],r[r.length-1]),this._delCells=[]},_undoForReOrder:function(i){var r,l,n=this.getSheet(i.sheetIndex);if(this._isUndo){for(this.XLComment&&this.XLComment.deleteComment(),r=i.destinationRange[0];r<=i.destinationRange[2];r++)for(l=i.destinationRange[1];l<=i.destinationRange[3];l++)this.XLEdit.getPropertyValue(r,l,"wrap")&&this.setWrapText("unwrap",this._getAlphaRange(i.sheetIndex,r,l,r,l));this.clearRangeData(i.destinationRange,i.property),this.XLFormat.removeStyle(i.destinationRange),this.XLCFormat.clearCF(i.destinationRange),this.isUndefined(i.tblObj)||(this.XLFormat.removeTable(i.tblObj.tblId),this.XLClipboard._isCut=!0,this.XLFormat.createTable(i.tblObj,i.sourceRange),i.tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,i.tblObj.tblId,i.tblObj.fnNumber,i.sourceRange,!1),this.XLClipboard._isCut=!1),this.updateData(e.extend(!0,[],i.sourceData),i.sourceRange),this.updateData(e.extend(!0,[],i.destinationData),i.destinationRange),i.tRange&&(this._dupDetails=!0,this.XLFilter.clearFilter("remove"),this.XLFilter.filter(i.tRange),this._dupDetails=!1),this.XLFormat.updateFormat(i.sourceFormat,i.sourceRange),this.XLFormat.updateFormat(i.destinationFormat,i.destinationRange),this.isUndefined(i.sourceCFormat)||i.sourceCFormat instanceof Array||this.XLCFormat.setCFRule(i.sourceCFormat),this.setActiveCell(i.sourceRange[0],i.sourceRange[1]),this.XLSelection.selectRange({rowIndex:i.sourceRange[0],colIndex:i.sourceRange[1]},{rowIndex:i.sourceRange[2],colIndex:i.sourceRange[3]},i.sheetIndex),n._startCell={rowIndex:i.sourceRange[0],colIndex:i.sourceRange[1]},n._endCell={rowIndex:i.sourceRange[2],colIndex:i.sourceRange[3]},this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this.setHeightToRows(i.prevDestRowHt)}else{for(this.XLSelection.selectRange({rowIndex:i.sourceRange[0],colIndex:i.sourceRange[1]},{rowIndex:i.sourceRange[2],colIndex:i.sourceRange[3]},i.sheetIndex),this.XLComment&&this.XLComment.deleteComment(),r=i.sourceRange[0];r<=i.sourceRange[2];r++)for(l=i.sourceRange[1];l<=i.sourceRange[3];l++)this.XLEdit.getPropertyValue(r,l,"wrap")&&this.setWrapText("unwrap",this._getAlphaRange(i.sheetIndex,r,l,r,l));this.clearRangeData(i.sourceRange,i.property),this.clearRangeData(i.destinationRange,i.property),t.isNullOrUndefined(this.XLEdit.getPropertyValue(i.destinationRange[0],i.destinationRange[1],"tableName"))&&this.XLFormat.removeStyle(i.destinationRange),this.isUndefined(i.tblObj)||(this.XLFormat.removeTable(i.tblObj.tblId),this.XLClipboard._isCut=!0,this.XLFormat.createTable(i.tblObj,i.destinationRange),this.XLClipboard._isCut=!1),t.isNullOrUndefined(this.XLEdit.getPropertyValue(i.sourceRange[0],i.sourceRange[1],"tableName"))&&this.XLFormat.removeStyle(i.sourceRange),this.XLCFormat.clearCF(i.sourceRange),this.updateData(e.extend(!0,[],i.sourceData),i.destinationRange),i.tRange&&(this._dupDetails=!0,this.XLFilter.clearFilter("remove"),this.XLFilter.filter(i.destinationRange),this._dupDetails=!1),this.XLFormat.updateFormat(i.sourceFormat,i.destinationRange),i.tblObj&&i.tblObj.totalRow&&this.XLFormat._updateTotalRow(i.sheetIndex,i.tblObj.tblId,i.tblObj.fnNumber,i.destinationRange,!1),this.isUndefined(i.destinationCFormat)||i.destinationCFormat instanceof Array||this.XLCFormat.setCFRule(i.destinationCFormat),this.setHeightToRows(i.destHeight),this.setActiveCell(i.destinationRange[0],i.destinationRange[1]),this.XLSelection.selectRange({rowIndex:i.destinationRange[0],colIndex:i.destinationRange[1]},{rowIndex:i.destinationRange[2],colIndex:i.destinationRange[3]},i.sheetIndex),n._startCell={rowIndex:i.destinationRange[0],colIndex:i.destinationRange[1]},n._endCell={rowIndex:i.destinationRange[2],colIndex:i.destinationRange[3]},this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()}},_undoForPivot:function(e){var t=this._isUndo?this._undoCollection:this._redoCollection,i={curOperation:e,prevOperation:t[t.length-1],isUndo:this._isUndo};this._trigger("_readUndoRedo",i)},_undoForResizeCol:function(e){this.XLResize._resizeColumnUsingDiff(e.oldWidth,e.newWidth,e.cols);var t=e.oldWidth;e.oldWidth=e.newWidth,e.newWidth=t,this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForResizeRow:function(e){this.XLResize._resizeRowUsingDiff(e.oldHeight,e.newHeight,e.rows);var t=e.oldHeight;e.oldHeight=e.newHeight,e.newHeight=t,this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForResizeFHeight:function(e){var t=this._isUndo,i=e.newHeight;e.newHeight=e.oldHeight,e.oldHeight=i,this.XLResize.setRowHeight(e.rowIndex,e.newHeight),this._isUndo?this.XLEdit._clearDataContainer({sheetIdx:e.sheetIndex,cellIdx:{rowIndex:e.rowIndex,colIndex:0},property:["isFitHeight"]}):this.XLEdit._updateDataContainer({rowIndex:e.rowIndex,colIndex:0},{dataObj:{isFitHeight:!0}}),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this._isUndo=t},_undoForResizeFWidth:function(e){var t=this.getCell(0,e.colIndex).get(0),i=this._isUndo,r=e.newWidth;e.newWidth=t.offsetWidth===e.oldWidth?e.newWidth:e.oldWidth,e.oldWidth=r,this.XLResize._applyWidth(e.target,e.sheetIndex,e.colIndex,e.newWidth),this.XLScroll._getColWidths(e.sheetIndex,e.colIndex),this._isUndo?this.XLEdit._clearDataContainer({sheetIdx:e.sheetIndex,cellIdx:{rowIndex:0,colIndex:e.colIndex},property:["isFitWidth"]}):this.XLEdit._updateDataContainer({rowIndex:0,colIndex:e.colIndex},{dataObj:{isFitWidth:!0}}),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this._isUndo=i},_undoForShape:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_=0,f=this.getSheet(i.sheetIndex).shapeMngr;switch(this.model.showRibbon&&(o=this.XLRibbon._chartThemes),"chartType"!=i.action&&"create"!==i.action&&"remove"!==i.action&&"edit"!==i.action&&"border"!==i.action&&"resetpicture"!==i.action&&"changepicture"!==i.action&&"picturesize"!==i.action&&"chartTheme"!==i.action&&"chartType"!==i.action&&"selectData"!==i.action&&(r=e("#"+i.cid).data("ejChart"),l=this.getSheet(i.sheetIndex).shapeMngr.chart[this.XLEdit.getPropertyValue(i.rowIndex,i.colIndex,"chart")[0]]),i.action){case"create":this.XLShape._picCellIdx=this.XLShape._getCellIndexFromOffset(i.position.top,i.position.left),this.XLShape._deleteShape(i.sheetIndex,e("#"+i.id)),i.action="remove";break;case"remove":"picture"===i.shapeType?(this.XLShape._createPicture(i.sheetIndex,i.actCell,i.img,i.position.top,i.position.left,i.position.width,i.position.height,i.cnt,i.bcolor,i.bstyle,i.bwidth),this.XLRibbon._formatTabUpdate(),e(i.actCell).addClass("e-activecell")):(i.options.isChartSeries||(this.XLSelection.selectRange({rowIndex:i.range[0],colIndex:i.range[1]},{rowIndex:i.range[0],colIndex:i.range[1]},i.sheetIndex),this.setActiveCell(i.range[0],i.range[1],i.sheetIndex)),this.XLChart.createChart(i.options.isChartSeries?null:this._getAlphaRange(i.sheetIndex,i.range[0],i.range[1],i.range[2],i.range[3]),i.options,i.id)),i.action="create";break;case"edit":var b,C,S,x,v,w,I=this._dataContainer.sheets[i.sheetIndex],y=i.id.split("_")[1].replace(/[0-9]/g,""),T={};e("#"+i.id).css({left:i.prev.left,top:i.prev.top,height:i.prev.height,width:i.prev.width}),"chart"===y&&this.XLChart.resizeChart(i.id,i.prev.height,i.prev.width),i.visualImg.hide(),this.XLShape._picCellIdx=this.XLShape._getCellIndexFromOffset(i.prev.top,i.prev.left),w=this.XLShape._getCellIndexFromOffset(i.cur.top,i.cur.left),x=this._getShapePositionInManager(w.rowIndex,w.colIndex,i.id,y),T[y]=i.obj[y][x],"resize"!=i.actionType&&(this.getObjectLength(I[w.rowIndex][w.colIndex])<2&&I[w.rowIndex][w.colIndex][y].length<2?delete I[w.rowIndex][w.colIndex]:I[w.rowIndex][w.colIndex][y].length<2?delete I[w.rowIndex][w.colIndex][y]:(I[w.rowIndex][w.colIndex][y].some(function(e,t){if(T.id===e.id)return v=t,!0}),I[w.rowIndex][w.colIndex][y].splice(v,1))),this.XLEdit._updateDataContainer({rowIndex:this.XLShape._picCellIdx.rowIndex,colIndex:this.XLShape._picCellIdx.colIndex},{dataObj:T}),this.getCell(this.XLShape._picCellIdx.rowIndex,this.XLShape._picCellIdx.colIndex,i.sheetIndex).addClass("e-activecell"),this.model.showRibbon&&this.element.find(".e-ss-activeimg").length<1&&("picture"===y?this.XLRibbon._toggleFormatTab():this.XLRibbon._toggleChartDesignTab()),this.XLRibbon._setShapeWidthHeight({width:i.prev.width,height:i.prev.height,shapeType:y}),this._swapVal(i);break;case"PHAxis":case"PVAxis":a="PHAxis"==i.action?"primaryXAxis":"primaryYAxis",d="PHAxis"===i.action?"xAxis":"yAxis",i.visibility=!i.visibility,r.option(a,{visible:i.visibility}),l[d].visible=i.visibility;break;case"PX":case"PY":a="PX"==i.action?"primaryXAxis":"primaryYAxis",d="PX"===i.action?"xAxis":"yAxis",t.isNullOrUndefined(i.prev.text)&&(i.prev.text=""),r.option(a,{title:{text:i.prev.text}}),l[d].title.text=i.prev.text,this._swapVal(i);break;case"CT":r.option("title",{textAlignment:i.prev.align,text:i.prev.text}),l.title={text:i.prev.text,textAlignment:i.prev.align},this._swapVal(i);break;case"DLNone":r.option({series:i.prev.series}),l.dataLabel={visible:i.prev.series[0].marker.dataLabel.visible},this._swapVal(i);break;case"DL":r.option({series:i.prev.series}),l.dataLabel={visible:i.prev.series[0].marker.dataLabel.visible,vAlign:i.prev.series[0].marker.dataLabel.verticalTextAlignment,tPosn:i.prev.series[0].marker.dataLabel.textPosition},this._swapVal(i);break;case"PMajorH":i.visibility=!i.visibility,r.option("primaryYAxis",{majorGridLines:{visible:i.visibility}}),l.yAxis.majorGridLines={visible:i.visibility};break;case"PMajorV":i.visibility=!i.visibility,r.option("primaryXAxis",{majorGridLines:{visible:i.visibility}}),l.xAxis.majorGridLines={visible:i.visibility};break;case"PMinorH":i.visibility=!i.visibility,r.option("primaryYAxis",{minorGridLines:{visible:i.visibility},minorTicksPerInterval:5,minorTickLines:{visible:i.visibility}}),l.yAxis.minorGridLines={visible:i.visibility};break;case"PMinorV":i.visibility=!i.visibility,r.option("primaryXAxis",{minorGridLines:{visible:i.visibility},minorTicksPerInterval:5,minorTickLines:{visible:i.visibility}}),l.xAxis.minorGridLines={visible:i.visibility};break;case"LNone":i.visibility=!i.visibility,r.option("legend",{visible:i.visibility}),l.legend.visible=i.visibility;break;case"Legend":r.option("legend",{position:i.prev.position}),l.legend.position=i.prev.position,this._swapVal(i);break;case"width":b={width:i.prev.width,height:i.prev.height,shapeType:"chart"},S=e("#"+r._id),r.option("size",e.extend(!0,{},b)),S[0].style.height=i.prev.height+"px",S[0].style.width=i.prev.width+"px",l.width=i.prev.width,l.height=i.prev.height,this.XLRibbon._setShapeWidthHeight(b),this._swapVal(i);break;case"height":b={width:i.prev.width,height:i.prev.height,shapeType:"chart"},S=e("#"+r._id),r.option("size",e.extend(!0,{},b)),S[0].style.height=i.prev.height+"px",S[0].style.width=i.prev.width+"px",l.width=i.prev.width,l.height=i.prev.Height,this.XLRibbon._setShapeWidthHeight(b),this._swapVal(i);break;case"srcolumn":r.model.series.length=0,l.isRowColSwitched=!l.isRowColSwitched,h={xRange:l.xRange,yRange:l.yRange,lRange:l.lRange,isRowColSwitched:l.isRowColSwitched,dataSheetIdx:l.dataSheetIdx},c=this.XLChart._processChartSeries(h),r.option({series:c.series}),this.getActiveSheetIndex()===l.dataSheetIdx&&this.XLChart._focusChartRange(c.xRange,c.yRange,c.lRange),l.xAxis.range=c.xRange,l.yAxis.range=c.yRange,l.legend.range=c.lRange;break;case"border":C=e("#"+i.id),this._removeClass(C[0],i.curClass),this.addClass(C[0],i.prevClass),u=i.prevClass,i.prevClass=i.curClass,i.curClass=u;break;case"resetpicture":C=e("#"+i.id),g=new RegExp("\\be-shapebdr.*?\\b","g"),this._isUndo?C[0].className.match(g)&&this.XLShape.changePictureBorder(C[0].id,i.prev.bwidth,i.prev.bstyle,i.prev.bcolor):C[0].className=C[0].className.replace(g,""),"resetpicture"!==i.actionType&&(C.css({width:i.prev.width,height:i.prev.height}),this.XLShape._selectImg(C),this.XLShape._updateShapeObj(C[0])),this._swapVal(i);break;case"changepicture":I=this._dataContainer,e("#"+i.id).css("background-image","url('"+i.prev.img+"')"),f.picture[i.prev.pcIdx].data=i.prev.data,this._swapVal(i);break;case"picturesize":C=e("#"+i.id),b={width:i.prev.width,height:i.prev.height,shapeType:"picture"},C.css(b),this.XLRibbon._setShapeWidthHeight(b),this._swapVal(i);break;case"chartTheme":for(n=this.element.find("#"+this._id+"_chart").val(),s=e("#"+this._id+"_Ribbon_ChartDesign_ChartThemes_ChartThemes").data("ejDropDownList"),i.prev.theme.indexOf("dark")>-1?e("#"+n).addClass("e-ss-charttheme"):e("#"+n).removeClass("e-ss-charttheme"),this.XLChart.refreshChart(n,{theme:i.prev.theme}),p=0,m=o.length;m>p;p++)if(i.prev.theme===o[p].value.toLowerCase()){_=p;break}s&&s.option({selectedItemIndex:_}),this._swapVal(i);break;case"chartType":this.XLChart.refreshChart(i.chartId,{type:i.prev.chartType,enable3D:i.prev.enable3D,marker:i.prev.marker}),this._swapVal(i);break;case"selectData":this.XLChart.changeDataRange(document.getElementById(this._id+"_chart").value,i.prev.xRange,i.prev.yRange,i.prev.lRange),this._swapVal(i)}},_undoForShowHide:function(e){var t,i,r,l,n,s,o;if("row"===e.operation){for(r=this._getJSSheetRowHeaderContent(e.sheetIndex),"show"===e.action?this._hideRow(e.hideRows[0],e.hideRows[e.hideRows.length-1],"isRHide"):this._showRow(e.hideRows[0],e.hideRows[e.hideRows.length-1],"isRHide"),t=0,i=e.remBRows.length;t<i;t++)this.addClass(r.find("td")[e.remBRows[t]],"e-hrow"),this.XLEdit._updateDataContainer({rowIndex:e.remBRows[t],colIndex:0},{dataObj:{hRow:!0}});for(t=0,i=e.addBRows.length;t<i;t++)this._removeClass(r.find("td")[e.addBRows[t]],"e-hrow"),this._dataContainer.sheets[e.sheetIndex][e.addBRows[t]][0].hRow;this.setActiveCell(e.bSelect.startRow,0),e.bSelect.startRow===e.bSelect.endRow?this.XLSelection.selectRow(e.bSelect.startRow,e.sheetIndex):this.XLSelection.selectRows(e.bSelect.startRow,e.bSelect.endRow,e.sheetIndex),n=e.addBRows,e.addBRows=e.remBRows,e.remBRows=n}else{for(l=this._getJSSheetHeader(e.sheetIndex).find("th"),"show"===e.action?this._hideColumn(e.hideCols[0],e.hideCols[e.hideCols.length-1]):this._showColumn(e.hideCols[0],e.hideCols[e.hideCols.length-1]),t=0,i=e.remBCols.length;t<i;t++)this.XLEdit._updateDataContainer({rowIndex:0,colIndex:e.remBCols[t]},{dataObj:{hCol:!0}}),this.addClass(l[e.remBCols[t]],"e-hcol");for(t=0,i=e.addBCols.length;t<i;t++)this._removeClass(l[e.addBCols[t]],"e-hcol"),this._dataContainer.sheets[e.sheetIndex][0][e.addBCols[t]].hCol;this.setActiveCell(0,e.bSelect.startCol),e.bSelect.startCol===e.bSelect.endCol?this.XLSelection.selectColumn(e.bSelect.startCol,e.sheetIndex):this.XLSelection.selectColumns(e.bSelect.startCol,e.bSelect.endCol,e.sheetIndex),s=e.addBCols,e.addBCols=e.remBCols,e.remBCols=s}e.action="show"===e.action?"hide":"show",o=e.bSelect,e.bSelect=e.aSelect,e.aSelect=o,this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForSort:function(e){var t,i,r,l,n=this.getSheet(e.sheetIndex)._filterColl;if("unsort"===e.operation?(this._dupDetails=!0,this.XLComment.deleteComment(e.range,null,!0,null),this._removeHyperlink(null,null,!0,e.range),this.clearRangeData(e.range,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0),this.XLFormat.removeStyle(e.range,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0}),this.XLEdit.updateCellWithContainer(e.rangeData,e.range,e.sheetIndex,!0),this.XLSort._refreshRowHeight(e.range,e.rangeData),this._dupDetails=!1,e.operation="sort"):(this.XLSort._isSortByFilter=e.isSortByFilter,this.XLSort.sortByRange(e.range,e.columnName,e.direction),e.operation="unsort"),e.isSortByFilter)for(l=0;l<e.filterIcons.length;l++)(r=n[e.filterIcons[l].rowIdx][e.filterIcons[l].colIdx]).status=r.status.indexOf("-asc")>1?r.status.replace("-asc",e.filterIcons[l].prevIcon):r.status.indexOf("-dsc")>1?r.status.replace("-dsc",e.filterIcons[l].prevIcon):r.status+e.filterIcons[l].prevIcon,this._isRowViewable(e.sheetIndex,e.filterIcons[l].rowIdx)&&((i=this.getCell(e.filterIcons[l].rowIdx,e.filterIcons[l].colIdx).find(".e-filterspan")[0]).className=i.className.indexOf("-asc")>1?i.className.replace("-asc",e.filterIcons[l].prevIcon):i.className.indexOf("-dsc")>1?i.className.replace("-dsc",e.filterIcons[l].prevIcon):i.className.indexOf("e-ssfiltered")>-1?i.className.replace("e-ssfiltered","e-ssfiltered"+e.filterIcons[l].prevIcon):i.className.replace("e-ssfilter","e-ssfilter"+e.filterIcons[l].prevIcon)),t=e.filterIcons[l].prevIcon,e.filterIcons[l].prevIcon=e.filterIcons[l].currIcon,e.filterIcons[l].currIcon=t},_undoForSortByColor:function(e){var t,i=e.range,r=e.prev.data,l=this._generateColCount(e.columnName)-1;this.XLComment.deleteComment(i,null,!0,null),this._isSort=!0,this._dupDetails=!0,this._removeHyperlink(null,null,!0,i),this._isSort=!1,this._dupDetails=!1,this.clearRangeData(i,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0),this.XLFormat.removeStyle(i,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0}),this.XLEdit.updateCellWithContainer(r,i,e.sheetIndex,!0),e.oprType.indexOf("Put")<0&&((t=this.getCell(i[0]-1,l).find(".e-filterspan")).length>0&&(t[0].className=t[0].className.replace(e.cur.icon,e.prev.icon))),this._swapVal(e)},_undoForStyle:function(e){this.XLFormat.updateUniqueFormat(e.beforeFormat,e.range,e.opr),this._updateRangeStyle(e.range,e.beforeFormat);var t=this.changePosition(e.beforeFormat,e.afterFormat);this._refreshRangeTRHght(this.getActiveSheetIndex(),e.range),e.beforeFormat=t[1],e.afterFormat=t[0],this._isUndoRedo=!0,e.status="undo-cellstyles"},_undoForTextWrap:function(e){"wrap"===e.operation?(this.setWrapText("unwrap",e.range),e.operation="unwrap"):(this.setWrapText("wrap",e.range),e.operation="wrap"),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()},_undoForValidation:function(e){var i,r,l,n,s,o,a=this.getRangeIndices(e.range);if(this.performSelection({rowIndex:a[0],colIndex:a[1]},{rowIndex:a[2],colIndex:a[3]}),"cl-hl-data"===e.operation)this.XLValidate.highlightInvalidData(e.range),e.operation="hl-data";else if("apply-validation"===e.operation){for(o=[],i=0,r=(l=e.selectedCell).length;i<r;i++)s=this.XLEdit.getPropertyValue(l[i].rowIndex,l[i].colIndex,"rule"),n=this.changePosition(l[i].prevRule,s),e.selectedCell[i].prevRule=n[1],t.isNullOrUndefined(n[0])||this.XLEdit._updateDataContainer({rowIndex:l[i].rowIndex,colIndex:l[i].colIndex},{dataObj:{rule:n[0]}}),o.push(l[i]);t.isNullOrUndefined(n[0])&&this.clearRangeData(null,["rule"],o)}else if("hl-data"===e.operation)this.XLValidate.clearHighlightedValData(e.range),e.operation="cl-hl-data";else if(this._isUndo){for(i=0,r=e.selectedCell.length;i<r;i++)this.XLEdit._updateDataContainer({rowIndex:e.selectedCell[i].rowIndex,colIndex:e.selectedCell[i].colIndex},{dataObj:{rule:e.selectedCell[i].rules}});e.hlStatus&&this.XLValidate.highlightInvalidData(e.range)}else this.XLValidate.clearDV(e.range)},_applyCommentLink:function(i,r,l,n){var s,o,a,d,h,c,u=this._dataContainer,g=u.cFormatData,p=!1,m=this.getActiveSheetIndex();if(this._isRowViewable(m,r.rowIndex)&&(o=this.getCell(r.rowIndex,r.colIndex),p=!0,e(o).removeClass("e-redft e-yellowft e-greenft e-redf e-redt"),o.hasClass("e-cformat")&&(o[0].style.color="",o[0].style.backgroundColor="",o.removeClass("e-cformat"))),i){if(a=this.isNumber(i.value2)?u.sharedData[i.value2]:i.value2,i=e.extend(!0,{},i),this.XLEdit._updateCellValue(r,a),"cFormatRule"in i)for(h=0,c=i.cFormatRule.length;h<c;h++)d=g[h].split("_"),this.XLCFormat._cFormat(d[0],d[2],d[3],d[4],d[5],null,null,[l,n,l,n]);"hyperlink"in i&&(s=i.hyperlink,p&&(s&&!s.webAddr?o.html(t.buildTag("a.e-hyperlinks",this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2",m),"")):o.html(t.buildTag("a.e-hyperlinks",this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2",m),"",{href:s.webAddr,target:"_blank"})))),"comment"in i&&(p&&o.removeClass("e-commentcell"),this.XLComment.setComment([r.rowIndex,r.colIndex,r.rowIndex,r.colIndex],null,!1))}},changePosition:function(e,i){var r=[];return r.push(i),r.push(e),t.swap(r,0,1),r},_addValidationRule:function(t,i){var r,l,n=[];for(e.extend(!0,n,t),r=0,l=t.length;r<l;r++)t[r].customVal!==i.customVal&&t[r].required!==i.required&&t[r].Number!==i.number&&n.push(i);return n},_addCondFormatRule:function(t,i){var r,l,n=!1,s=[];for(e.extend(!0,s,t),r=0,l=t.length;r<l;r++)if(i=i.indexOf("true")>-1?i.replace("_true",""):i.replace("_false",""),t[r]===i){n=!0;break}return n||s.push(i),s},getCellClass:function(e){var t=this._formatRegx;return e&&e.className.indexOf("e-format")>-1?e.className.match(t)[0]:""},_renderInsertDeleteDialog:function(){var e,i,r,l,n,s,o=this._id+"_insertdeletedlg";e=t.buildTag("div#"+o,"",{display:"none"}),i=t.buildTag("div#"+o+"_content.e-dlg-fields e-dlgctndiv"),e.append(i),n=t.buildTag("div#"+o+"_btndiv.e-dlg-btnfields"),s=t.buildTag("div"),r=t.buildTag("input#"+o+"_okbtn","",{"margin-left":4}),l=t.buildTag("input#"+o+"_cantn"),r.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._insertDeleteOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),l.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._insertDeleteCancel,this),showRoundedCorner:!0,width:60}),n.append(s.append(r,l)),e.append(n),e.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg e-ss-insdeldlg",minWidth:150})},_refreshInsDelDialog:function(t){var i,r,l,n=e("#"+this._id+"_insertdeletedlg");n.ejDialog({title:this._getLocStr(t)}),n.ejDialog("open"),this._insDelStatus=t.toLowerCase(),r=e("#"+n[0].id+"_content"),l="insert"===this._insDelStatus?["ShiftRight","ShiftBottom","EntireRow","EntireColumn"]:["ShiftLeft","ShiftUp","EntireRow","EntireColumn"],r.children().empty(),this._createRadioButton(n,r,l),i="insert"===this._insDelStatus?"ShiftBottom":"ShiftLeft",e("#"+n[0].id+"_"+i).ejRadioButton({checked:!0}),n.find("input[type='submit']:first").focus()},_createRadioButton:function(e,i,r){var l,n,s,o,a,d,h;for(s=t.buildTag("table"),d=0,h=r.length;d<h;d++)o=t.buildTag("tr"),a=t.buildTag("td"),n=t.buildTag("label",this._getLocStr(r[d]),{"padding-bottom":4},{for:e[0].id+"_"+r[d]}),l=t.buildTag("input#"+e[0].id+"_"+r[d],"",{},{type:"radio",name:"inserdelete"}),a.append(l),o.append(a),(a=t.buildTag("td")).append(n),l.ejRadioButton({size:"medium"}),o.append(a),s.append(o);i.append(s)},_getSelectedOption:function(t){for(var i=this._id+"_insertdeletedlg",r=0,l=0;l<4;l++)if(e("#"+i+"_"+t[l]).data("ejRadioButton").model.checked){r=l;break}return r},_insertDeleteOk:function(){var t,i;this._isUndo=!1,this._isUndoRedo=!1,this._delCells=[],this._deletedText=[],this._removeMergeColl=[],this._deletedDimension=[];var r,l,n=this.getActiveSheetIndex(),s=this.model.sheets[n]._selectedCells[0],o=this.model.sheets[n]._selectedCells[this.model.sheets[n]._selectedCells.length-1];for(this._insDelStatus.indexOf("insert")>-1?(r=["ShiftRight","ShiftBottom","EntireRow","EntireColumn"])[l=this._getSelectedOption(r)].indexOf("ShiftRight")>-1?this.insertShiftRight(s,o):r[l].indexOf("ShiftBottom")>-1?this.insertShiftBottom(s,o):r[l].indexOf("EntireRow")>-1?this.insertEntireRow(s.rowIndex,o.rowIndex):this.insertEntireColumn(s.colIndex,o.colIndex):(r=["ShiftLeft","ShiftUp","EntireRow","EntireColumn"])[l=this._getSelectedOption(r)].indexOf("ShiftLeft")>-1?this.deleteShiftLeft(s,o):r[l].indexOf("ShiftUp")>-1?this.deleteShiftUp(s,o):r[l].indexOf("EntireRow")>-1?this.deleteEntireRow(s.rowIndex,o.rowIndex):this.deleteEntireColumn(s.colIndex,o.colIndex),e("#"+this._id+"_insertdeletedlg").ejDialog("close"),t=this.model.sheets[this.model.activeSheetIndex].shapeMngr.chart,i=0;i<t.length;i++)this.XLChart._refreshChart(t[i])},_insertDeleteCancel:function(){e("#"+this._id+"_insertdeletedlg").ejDialog("close")},_undoredoDetails:function(t,i,r,l,n){var s={sheetIndex:t,startCell:i,endCell:r,reqType:l,action:n,delCells:e.extend(!0,[],this._delCells),text:this._deletedText,deletedDimension:this._deletedDimension,removeMerge:this._removeMergeColl,fRow:e.extend(!0,{},this._fRow),fCol:e.extend(!0,{},this._fCol),nmref:this._nmRef,prevCellTypes:this._prevCellTypes,curCellTypes:this._curCellTypes,prevChartDetails:this._prevChartDetails,curChartDetails:this._curChartDetails,prevValData:this._prevValData,curValData:this._curValData};this.isImport||this.model.isImport||this._isExport||this._intrnlReq||(this._completeAction(s),this._trigActionComplete(s)),this._removeMergeColl=[],this._delCells=[],this._nmRef=[],this._fRow.fRowCnt=0,this._fCol.fColCnt=0,this._fRow.rowAdj=!0,this._fCol.colAdj=!0},_getRangeFrmFormula:function(e){var t=e.substring(e.indexOf("(")+1,e.indexOf(")")),i=new RegExp("^\\b[a-zA-Z][0-9]*:[a-zA-Z][0-9]*\\b$","g");if(i.test(t))return t;if(t.indexOf(",")>1){if(i.test(t.split(",")[1]))return t.split(",")[1];if(i.test(t.replace(",",":")))return t.replace(",",":")}},_refreshNamedRange:function(e,i,r,l){for(var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S=this.getActiveSheetIndex(),x=this.model.nameManager,v=x.length,w=0;w<v;w++){for(_=[],n=0,b=(f=x[w].refersto.split(",")).length;n<b;n++)u=0==n?this.XLRibbon._getAddrFromDollarAddr(f[n].replace("=","")):this.XLRibbon._getAddrFromDollarAddr(f[n].trim()),c=this._getRangeArgs(u[1]),a=r+e-1,d="",g=!1,h=x[w].name.toUpperCase(),p=l?c[0]:c[1],m=l?c[2]:c[3],C=this._getSelectedCells().range,("shiftBottom"==i||"shiftUp"==i)&&(l=C[0]==c[0]&&C[1]==c[1]),S===u[0]&&r<=m&&("insertRow"==i||"insertColumn"==i||"shiftRight"==i||"shiftBottom"==i?(s=r<=p?p+e:p,o=m+e,g=!0):("deleteRow"==i||"deleteColumn"==i||"shiftLeft"==i||"shiftUp"==i)&&(a<p?(s=p-e,o=m-e):r>p&&a<=m?(s=p,o=m-e):(this._nmRef[h]=x[w].refersto,d="#REF!")),d||(d=l?this._getDollarAlphaRange([s,c[1],o,c[3]],!0):this._getDollarAlphaRange([c[0],s,c[2],o],!0))),this._isUndo&&("insertRow"==i||"insertColumn"==i||"shiftRight"==i||"shiftBottom"==i)&&(t.isNullOrUndefined(this._nmRef[h])?p==m&&p>-1&&!g&&(s=p,o=m+e,d=l?this._getDollarAlphaRange([s,c[1],o,c[3]],!0):this._getDollarAlphaRange([c[0],s,c[2],o],!0)):(d=this._nmRef[h],delete this._nmRef[h])),h&&d&&(_.push(0==n?"="+d:d),x[w].scope.toUpperCase()!=this._getLocStr("Workbook").toUpperCase()&&(h=x[w].scope.toUpperCase()+"!"+h),this._calcEngine.removeNamedRange(h),this._calcEngine.addNamedRange(h,d.replace("=","")));x[w].refersto=_.join(",")}},_refreshFormula:function(e,t,i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_=this.getActiveSheetIndex(),f=this.XLEdit.getPropertyValue(e,t,"value"),b=this.getSheet(_),C=[],S=!1;if((!this._isUndo||"true"!==this._formulaChanged.pop())&&this.isFormula(f)){if("delete"===r)for(c=1;c<=i;c++)C.push(n+c);for(u=this.XLDragFill._parseFormula(f),c=0;c<u.length;c++)if(g=u[c].trim(),this._isCellReference(g)){if((m=c&&u[c-1].trim())&&"!"==m[m.length-1]&&(m=m.replace(/['!]/g,""))!=b.sheetInfo.text)continue;d=this.getRangeIndices(g),s="column"===l?"insert"===r?d[3]+i:d[3]-i:"insert"===r?d[2]+i:d[2]-i,o="column"===l?"insert"===r?d[1]+i:d[1]-i:"insert"===r?d[0]+i:d[0]-i,"column"===l?n>d[1]&&(o=d[1]):n>d[0]&&(o=d[0]),"column"===l?n>d[3]&&(s=d[3]):n>d[2]&&(s=d[2]),o>-1?a="column"===l?this._getAlphaRange(_,d[0],o,d[2],s):this._getAlphaRange(_,o,d[1],s,d[3]):(a="#REF!",S=!0),"delete"===r&&(p=parseInt("row"===l?g.replace(/[A-Z]/g,""):this._generateColCount(g.replace(/[0-9]/g,""))),C.indexOf(p)>-1&&(a="#REF!",S=!0)),u[c]=a}else"#REF!"==g&&(S=!0);return S&&!this._isUndo&&this._ref.push(f),f=S&&this._isUndo?this._ref.pop():"="+u.join(""),h=new ValueChangedArgs(e+1,t+1,this.XLEdit._parseSheetRef(f)),this._intrnlUpdate=!0,this._calcEngine.valueChanged(b.sheetInfo.value,h),this.XLEdit._updateDataContainer({rowIndex:e,colIndex:t},{dataObj:{value:f}}),this._intrnlUpdate=!1,this._applyFormula(_,e,t),this._isUndo||(void 0===a?this._formulaChanged.push("true"):this._formulaChanged.push("false")),!0}},_applyFormula:function(e,i,r){var l=this.getSheet(e),n=l._formulaCollection[i];t.isNullOrUndefined(n)&&(l._formulaCollection[i]={}),l._formulaCollection[i][r]=this._calcEngine.getFormulaInfoTable().getItem(this._calcEngine.cell)},_clearFormula:function(e,t){var i,r,l,n,s=this.getCalcEngine(),o=this.getActiveSheetIndex(),a=this.getSheet(o),d=this.XLEdit.getPropertyValue(e,t,"value");this.isFormula(d)&&(r=a._formulaCollection[e][t],l=(n=s.getFormulaInfoTable().values()).indexOf(r),i=s.getFormulaInfoTable().keys()[l],n.splice(l,1),s.getFormulaInfoTable().remove(i),s.clearFormulaDependentCells(i),delete a._formulaCollection[e][t])},_refreshValAndCF:function(e,t,i,r,l,n,s){var o,a,d,h,c,u,g,p=this.getActiveSheetIndex(),m=this._dataContainer.sheets[p],_=this._dataContainer.cFormatData;this.isUndefined(i)||this.isUndefined(r)?delete m[e][t]:(this.isUndefined(i)||(m[e][t]={rule:i}),this.isUndefined(r)||((o=_[r[0]]).indexOf("true")>-1?(g=o.replace("true","false"),u=_.indexOf()):(g=o.replace("false","true"),u=_.indexOf(g)),d=o.split("_")[5],c=this.getRangeIndices(d),s.indexOf("Bottom")>-1||s.indexOf("Row")>-1?c[2]=c[2]+l:c[3]=c[3]+n,h=this._getAlphaRange(p,c[0],c[1],c[2],c[3]),o=o.replace(d,h),g=g.replace(d,h),_[r[0]]=o,_[u]=g,a=o.replace("true","false"),_.indexOf(a)<0&&_.push(a),m[e][t]={cFormatRule:[_.indexOf(a)]}))},_refreshRows:function(e){var t=this._getRowHdrTBody(e).find("tr"),i=this._getContTBody(e).find("tr");this.setRows([t,i],e)},_refreshFilterColl:function(t,i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_=this.getSheet(t),f=_._filterColl,b=this.getObjectKeys(f);if("row"===l)if("insert"===n)for(a=b.length-1;a>=0;a--)(o=parseInt(b[a]))>=i&&(_._filterColl[o+r]=e.extend(!0,{},_._filterColl[o]),delete _._filterColl[o]);else for(a=0;a<b.length;a++)(o=parseInt(b[a]))>=i&&(_._filterColl[o-r]=e.extend(!0,{},_._filterColl[o]),delete _._filterColl[o]);else for(g=!1,p=this.model.scrollSettings.allowVirtualScrolling,a=0;a<b.length;a++)if(o=parseInt(b[a]),h=this.getObjectKeys(_._filterColl[o]),"insert"===n)for(u=!1,m=h.length-1;m>=0;m--)g=1===(s=h[m]-h[m-(0===m?0:1)])||0===s,((d=parseInt(h[m]))>=i||u)&&(u=!0,_._filterColl[o][d].status.indexOf("filtered")>-1&&((c=e.inArray(this._generateHeaderText(d+1),_._filteredColumns))>-1&&_._filteredColumns.splice(c,1),e.inArray(this._generateHeaderText(d+r+1),_._filteredColumns)<0&&_._filteredColumns.push(this._generateHeaderText(d+r+1))),_._filterColl[o][d+r]=e.extend(!0,{},_._filterColl[o][d]),(p||this._isUndoRedo)&&g?(_._filterColl[o][d].status="e-ssfilter",this.XLEdit._updateDataContainer({rowIndex:o,colIndex:d},{dataObj:{isFilterHeader:!0,filterState:"filter",isFilterVisible:!0},sheetIdx:t})):delete _._filterColl[o][d],g||(u=!1));else for(m=0;m<h.length;m++)(d=parseInt(h[m]))>=i&&(_._filterColl[o][d].status.indexOf("filtered")>-1&&((c=e.inArray(this._generateHeaderText(d+1),_._filteredColumns))>-1&&_._filteredColumns.splice(c,1),e.inArray(this._generateHeaderText(d-r+1),_._filteredColumns)<0&&_._filteredColumns.push(this._generateHeaderText(d-r+1))),d-r>=0&&(_._filterColl[o][d-r]=e.extend(!0,{},_._filterColl[o][d])),delete _._filterColl[o][d])},_refreshDataContainer:function(r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j,M,V,B,H,X,U,z,q,G,W,K,J,Q,Y,$,Z,ee,te=0,ie=0,re=0,le=0,ne=this._dataContainer.sheets[r],se=this.model.scrollSettings.allowVirtualScrolling,oe=this.getSheet(r),ae=oe.usedRange,de=this.getFrozenRows(),he=this.getFrozenColumns(),ce=this._dataContainer.valData;for(C=parseInt(this.getObjectKeys(ne)[this.getObjectLength(ne)-1]),J=oe.rowsHeightCollection,K=oe.columnsWidthCollection,c=0;c<=C;c++)t.isNullOrUndefined(ne[c])||(b=this.getObjectKeys(ne[c]),(ie=parseInt(b[b.length-1]))>te&&(te=ie));if(T=l.startCol<=te?l.colCount+l.startCol:te-1,I=l.status.indexOf("shift")>-1?T:te-1,y=l.status.indexOf("shift")>-1?l.rowCount+l.startRow:C,n=l.startRow,s=l.startRow+l.rowCount-1,o=l.startCol,a=l.startCol+l.colCount-1,this._isFrozen(de-1)&&de>n){for(c=oe._frozenRows-1;c<oe._ftopRowIdx;c++)re+=oe.rowsHeightCollection[c];this._scrollContent({y:-re})}if(this._isFrozen(he-1)&&he>o){for(c=oe._frozenColumns-1;c<oe._fleftColIdx;c++)le+=oe.columnsWidthCollection[c];this._scrollContent({x:-le})}switch(l.status){case"insertRow":for(this._refreshNamedRange(l.rowCount,l.status,l.startRow,!0),c=C,p=l.startRow;c>=p;c--){if(!t.isNullOrUndefined(ne[c])){if(ne[c+l.rowCount]=e.extend(!0,{},ne[c]),!t.isNullOrUndefined(ne[c+l.rowCount]))for(u=0,m=(O=this.getObjectKeys(ne[c+l.rowCount])).length;u<m;u++)this._clearFormula(c,O[u]),this._checkIndicesInContainer(r,c,O[u],"wrap")&&(this._wrapCollection(c+l.rowCount,O[u],oe._wrapColl[c][O[u]],r),delete oe._wrapColl[c][O[u]]),c>=n&&c<=s?(d=this._checkIndicesInContainer(r,n,O[u],"rule")?this._dataContainer.sheets[r][n][O[u]].rule:i,h=this._checkIndicesInContainer(r,n,O[u],"cFormatRule")?this._dataContainer.sheets[r][n][O[u]].cFormatRule:i,this._refreshValAndCF(c,O[u],d,h,l.rowCount,0,l.status),se||n<1||this.addClass(this.getCell(c,O[u])[0],this.XLFormat.getFormatClass(this.getCell(n-1,O[u])[0].className,!1))):delete ne[c][O[u]],this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c+l.rowCount,parseInt(O[u]),l.rowCount,"row","insert",r),(k=this._refreshFormula(c+l.rowCount,parseInt(O[u]),l.rowCount,"insert","row",l.startRow,!1))||this.XLEdit._refreshCalcEngine(c+l.rowCount,parseInt(O[u]));this.getObjectLength(ne[c])<1&&delete ne[c]}J[c+l.rowCount]=J[c],J[c]=this.model.rowHeight,oe._rowIdxColl[c+l.rowCount]=oe._rowIdxColl[c]+l.rowCount}if(this._refreshHideRowColCollection(oe.hideRowsCollection,l.startRow,l.rowCount,"row","insert"),this._refreshFilterColl(r,l.startRow,l.rowCount,"row","insert"),this._isUndo&&this._delCells.length>0){for(F=(L=this._delCells)[L.length-1].row-L[0].row,c=0,p=L.length;c<p;c++){for(ne[L[c].row]=L[c].value,u=0,m=(O=this.getObjectKeys(ne[L[c].row])).length;u<m;u++)this._refreshFormula(L[c].row,parseInt(O[u]),F,"insert","row","",!1),this.XLEdit._refreshCalcEngine(L[c].row,parseInt(O[u])),this._checkIndicesInContainer(r,L[c].row,O[u],"wrap")&&this._wrapCollection(L[c].row,O[u],this._delWrapColl[L[c].row][O[u]],r);J[L[c].row]=L[c].height}this._delWrapColl={}}if(this.model.allowFreezing&&this._isFrozen(de)&&(n<de||this._isUndo&&this._fRow.fRowCnt>0)&&(S=oe.frozenRows+(this._fRow.fRowCnt>0?this._fRow.fRowCnt:l.rowCount),x=oe.frozenColumns,this._fRow.fRowCnt=0,this._fRow.rowAdj||(S-=1,this._fRow.rowAdj=!this._fRow.rowAdj),this._isFrozen(he)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(S,x)):this.XLFreeze.freezeRows(S)),this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else for(this._prevValData=e.extend(!0,[],ce),H=0,p=ce.length;H<p;H++)X=ce[H].split("_"),U=this.getRangeIndices("list"===X[1]?X[3]:X[6]),l.startRow<=U[2]&&l.startCol<=U[3]&&(l.startRow>U[0]&&(M=l.startRow-U[0],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[0]+(M-1),U[3]),this._highlightValidationRng(X,H,n+l.rowCount,U[1],U[2]+l.rowCount,U[3])),l.startRow<=U[0]&&this._highlightValidationRng(X,H,U[0]+l.rowCount,U[1],U[2]+l.rowCount,U[3])),this._curValData=e.extend(!0,[],ce);if(this._isUndo)oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),g=0,p=oe.cellTypes.length;g<p;g++)j=this.getRangeIndices(oe.cellTypes[g].range),l.startRow<=j[2]&&l.startCol<=j[3]&&(l.startRow>j[0]&&(M=l.startRow-j[0],V={range:this.getAlphaRange(j[0],j[1],j[0]+(M-1),j[3]),settings:oe.cellTypes[g].settings},oe.cellTypes[oe.cellTypes.length]=V,oe.cellTypes[g].range=this.getAlphaRange(n+l.rowCount,j[1],j[2]+l.rowCount,j[3])),l.startRow<=j[0]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0]+l.rowCount,j[1],j[2]+l.rowCount,j[3]))),this._curCellTypes=e.extend(!0,[],oe.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(l)}this.XLScroll._getRowHeights(r,l.startRow);break;case"insertColumn":for(z=!1,this._refreshNamedRange(l.colCount,l.status,l.startCol,!1),c=0;c<=y;c++)for(u=te,p=l.startCol;u>=p;u--)E=D=null,0==c&&(t.isNullOrUndefined(ne[0])||t.isNullOrUndefined(ne[0][u])||"isCHide"in ne[0][u]&&(this._deleteRule(u,r),z=!0)),t.isNullOrUndefined(ne[c])||(t.isNullOrUndefined(ne[c][u])||(t.isNullOrUndefined(ne[c][u+l.colCount])||(t.isNullOrUndefined(ne[c][u+l.colCount].picture)||(E=ne[c][u+l.colCount].picture),t.isNullOrUndefined(ne[c][u+l.colCount].chart)||(D=ne[c][u+l.colCount].chart)),ne[c][u+l.colCount]=ne[c][u],t.isNullOrUndefined(ne[c][u].picture)&&t.isNullOrUndefined(ne[c][u].chart)||(t.isNullOrUndefined(ne[c][u].picture)||(E=ne[c][u].picture),t.isNullOrUndefined(ne[c][u].chart)||(D=ne[c][u].chart)),t.isNullOrUndefined(ne[c][u+l.colCount])||(t.isNullOrUndefined(E)||(ne[c][u+l.colCount].picture=E),t.isNullOrUndefined(D)||(ne[c][u+l.colCount].chart=D)),ne[c][u].wrap&&(this._wrapCollection(c,u+l.colCount,oe._wrapColl[c][u],r),delete oe._wrapColl[c][u])),this._clearFormula(c,u),u>=o&&u<=a?(d=this._checkIndicesInContainer(r,c,o,"rule")?this._dataContainer.sheets[r][c][o].rule:i,h=this._checkIndicesInContainer(r,c,o,"cFormatRule")?this._dataContainer.sheets[r][c][o].cFormatRule:i,this._refreshValAndCF(c,u,d,h,0,l.colCount,l.status),se||!o<1&&this.addClass(this.getCell(c,u)[0],this.XLFormat.getFormatClass(this.getCell(c,o-1)[0].className,!1))):delete ne[c][u],!t.isNullOrUndefined(ne[c][u])||t.isNullOrUndefined(E)&&t.isNullOrUndefined(D)||(ne[c][u]={}),t.isNullOrUndefined(E)||(ne[c][u].picture=E),t.isNullOrUndefined(D)||(ne[c][u].chart=D),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c,u+l.colCount,l.colCount,"column","insert",r),(k=this._refreshFormula(c,u+l.colCount,l.colCount,"insert","column",l.startCol,!1))||this.XLEdit._refreshCalcEngine(c,u+l.colCount)),0===c&&(z&&(this._writeRule(u+l.colCount,r),z=!1),se&&!this._isUndoRedo&&(K[u+l.colCount]=K[u],K[u]=oe.columnWidth));if(this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else for(this._prevValData=e.extend(!0,[],ce),H=0,p=ce.length;H<p;H++)X=ce[H].split("_"),(U=this.getRangeIndices("list"===X[1]?X[3]:X[6]))[0]==U[2]&&U[1]==U[3]?l.startCol<=U[1]&&this._highlightValidationRng(X,H,U[0],U[1]+l.colCount,U[2],U[3]+l.colCount):(U[1]==U[3]||U[0]!=U[2]&&U[1]!=U[2]||U[0]==U[2])&&(l.startCol<=U[1]&&this._highlightValidationRng(X,H,U[0],U[1]+l.colCount,U[2],U[3]+l.colCount),l.startCol>U[1]&&l.startCol<=U[3]&&this._highlightValidationRng(X,H,U[0],U[1],U[2],U[3]+l.colCount)),this._curValData=e.extend(!0,[],ce);if(this._refreshHideRowColCollection(oe.hideColsCollection,l.startCol,l.colCount,"column","insert"),this._refreshFilterColl(r,l.startCol,l.colCount,"column","insert"),this.model.allowFreezing&&this._isFrozen(he)&&(o<he||this._isUndo&&this._fCol.fColCnt>0)&&(S=oe.frozenRows,x=oe.frozenColumns+(this._fCol.fColCnt>0?this._fCol.fColCnt:l.colCount),this._fCol.fColCnt=0,this._fCol.colAdj||(x-=1,this._fCol.colAdj=!this._fCol.colAdj),this._isFrozen(de)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(S,x)):this.XLFreeze.freezeColumns(x)),this._isUndo)oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),g=0,p=oe.cellTypes.length;g<p;g++)(j=this.getRangeIndices(oe.cellTypes[g].range))[0]==j[2]&&j[1]==j[3]?l.startCol<=j[1]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0],j[1]+l.colCount,j[2],j[3]+l.colCount)):(j[0]==j[2]&&l.startCol>j[1]&&(M=l.startCol-j[1],V={range:this.getAlphaRange(j[0],j[1],j[2],j[1]+(M-1)),settings:oe.cellTypes[g].settings},oe.cellTypes[oe.cellTypes.length]=V,oe.cellTypes[g].range=this.getAlphaRange(j[0],o+l.colCount,j[2],j[3]+l.colCount)),j[1]==j[3]&&l.startCol<=j[1]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0],j[1]+l.colCount,j[2],j[3]+l.colCount))),this._curCellTypes=e.extend(!0,[],oe.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(l)}if(this._isUndo&&this._delCells.length>0)for(F=(L=this._delCells)[L.length-1].col-L[0].col,g=0,p=L.length;g<p;g++)t.isNullOrUndefined(ne[L[g].row])&&(ne[L[g].row]={}),ne[L[g].row][L[g].col]=L[g].value,this._refreshFormula(L[g].row,L[g].col,F,"insert","column","",!1),this.XLEdit._refreshCalcEngine(L[g].row,L[g].col),L[g].value.wrap&&this._wrapCollection(L[g].row,L[g].col,L[g].height,r);break;case"deleteRow":for(this._refreshNamedRange(l.rowCount,l.status,l.startRow,!0),this._delCells=[],R=[],c=0;c<l.startRow;c++)for(u=0,p=(O=this.getObjectKeys(ne[c])).length;u<p;u++)(k=this._refreshFormula(c,parseInt(O[u]),l.rowCount,"delete","row",l.startRow,!1))||this.XLEdit._refreshCalcEngine(c,parseInt(O[u]));for(c=l.startRow;c<=C;c++){if(c<l.startRow+l.rowCount){if(this._delCells.push({row:c,value:e.extend(!0,{},ne[c]),height:J[c]}),!t.isNullOrUndefined(ne[c]))for(u=0,p=(O=this.getObjectKeys(ne[c])).length;u<p;u++)this._checkIndicesInContainer(r,c,O[u],"wrap")&&(this._delWrapColl[c]||(this._delWrapColl[c]={}),this._delWrapColl[c][O[u]]=e.extend(!0,{},oe._wrapColl[c][O[u]]),delete oe._wrapColl[c][O[u]]),ne[c][O[u]]={};ne[c]={},R.push({row:c})}if(!t.isNullOrUndefined(ne[c+l.rowCount])){for(ne[c]=e.extend(!0,{},ne[c+l.rowCount]),u=0,p=(O=this.getObjectKeys(ne[c])).length;u<p;u++)this._checkIndicesInContainer(r,c+l.rowCount,O[u],"wrap")&&(this._wrapCollection(c,O[u],oe._wrapColl[c+l.rowCount][O[u]],r),delete oe._wrapColl[c+l.rowCount][O[u]]),this._clearFormula(c+l.rowCount,O[u]),ne[c+l.rowCount][O[u]]={},this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c,O[u],l.rowCount,"row","delete",r),(k=this._refreshFormula(c,parseInt(O[u]),l.rowCount,"delete","row",l.startRow,!1))||this.XLEdit._refreshCalcEngine(c,parseInt(O[u]));ne[c+l.rowCount]={},R.push({row:c+l.rowCount})}this.isUndefined(J[c+l.rowCount])||(J[c]=J[c+l.rowCount],J[c+l.rowCount]=this.model.rowHeight,oe._rowIdxColl[c]=oe._rowIdxColl[c+l.rowCount]-l.rowCount)}for(this.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(J.splice(J.length-l.rowCount,l.rowCount),oe._rowHeightCollection.splice(oe._rowHeightCollection.length-l.rowCount,l.rowCount)),this._refreshHideRowColCollection(oe.hideRowsCollection,l.startRow,l.rowCount,"row","delete"),g=0,p=R.length;g<p;g++)0===this.getObjectLength(ne[R[g].row])&&(this._clearFormula(R[g].row,R[g].col),delete ne[R[g].row]);if(this._refreshFilterColl(r,l.startRow,l.rowCount,"row","delete"),this.XLScroll._getRowHeights(r,l.startRow),this.model.allowFreezing&&this._isFrozen(de)&&n<de){if(s>=de)for(c=n;c<de;c++)this._fRow.fRowCnt++;else this._fRow.fRowCnt=0;S=oe.frozenRows-(this._fRow.fRowCnt>0?this._fRow.fRowCnt:l.rowCount),v=oe.frozenRows-(this._fRow.fRowCnt>0?this._fRow.fRowCnt:l.rowCount)-oe._topRow.idx,x=oe.frozenColumns,this._fRow.rowAdj=v>1,this._isFrozen(he)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(this._fRow.rowAdj?S:S+1,x)):this.XLFreeze.freezeRows(this._fRow.rowAdj?S:1)}if(this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else{for(this._prevValData=e.extend(!0,[],ce),H=0,p=ce.length;H<p;H++)X=ce[H].split("_"),U=this.getRangeIndices("list"===X[1]?X[3]:X[6]),B=this.getAlphaRange(U[0]-l.rowCount,U[1],U[2]-l.rowCount,U[3]),U[0]==U[2]&&U[1]==U[3]?l.startRow<U[0]?(X[6]=B,ce[H]=X.join("_"),this._isSameRowColumn&&(oe.cellTypes[g-1].range=B)):l.startRow==U[0]&&l.startCol<=U[1]&&(ce[H]=[]):(U[1]==U[3]&&l.startRow>=U[0]&&this._highlightValidationRng(X,H,U[0],U[1],U[2]-l.rowCount,U[3]),U[0]==U[2]&&(l.startRow==U[0]&&(ce[H]={}),l.startRow<U[0]&&(X[6]=B,ce[H]=X.join("_")))),U[0]!=U[2]&&U[1]!=U[2]&&(l.startRow<=U[0]&&this._highlightValidationRng(X,H,U[0]-l.rowCount,U[1],U[2]-l.rowCount,U[3]),l.startRow>U[0]&&l.startRow<=U[2]&&this._highlightValidationRng(X,H,U[0],U[1]-l.rowCount,U[2],U[3]));this._dataContainer.valData=ce.filter(function(e){return Object.keys(e).length>0}),this._curValData=e.extend(!0,[],this._dataContainer.valData)}if(this._isUndo)oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),g=0,p=this._prevCellTypes.length;g<p;g++)j=this.getRangeIndices(this._prevCellTypes[g].range),B=this.getAlphaRange(j[0]-l.rowCount,j[1],j[2]-l.rowCount,j[3]),j[0]==j[2]&&j[1]==j[3]?l.startRow<j[0]?(oe.cellTypes[g].range=B,this._isSameRowColumn&&(oe.cellTypes[g-1].range=B)):l.startRow==j[0]&&l.startCol<=j[1]&&(oe.cellTypes[g]={}):(j[1]==j[3]&&l.startRow>=j[0]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0],j[1],j[2]-l.rowCount,j[3])),j[0]==j[2]&&(l.startRow==j[0]&&(oe.cellTypes[g]={}),l.startRow>j[0]&&(oe.cellTypes[g].range=B)));oe.cellTypes=oe.cellTypes.filter(function(e){return Object.keys(e).length>0}),this._curCellTypes=e.extend(!0,[],oe.cellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l)}break;case"deleteColumn":for(this._delCells=[],R=[],q=!1,G=e.extend(!0,{},ne[0]),this._refreshNamedRange(l.colCount,l.status,l.startCol,!1),c=0;c<=y;c++){for(u=l.startCol;u<=te;u++)E=D=null,0==c&&(t.isNullOrUndefined(G)||t.isNullOrUndefined(G[u])||"isCHide"in G[u]&&(this._deleteRule(u,r),q=!0)),u<l.startCol+l.colCount&&(t.isNullOrUndefined(ne[c])||t.isNullOrUndefined(ne[c][u])||(this._delCells.push({row:c,col:u,value:e.extend(!0,{},ne[c][u],ne[c][u].wrap?oe._wrapColl[c][u]:J[c])}),this._clearFormula(c,u),ne[c][u]={},t.isNullOrUndefined(this._delCells[this._delCells.length-1])||(N=this._delCells.length-1,t.isNullOrUndefined(this._delCells[N].value.picture)||(ne[c][u].picture=this._delCells[N].value.picture),t.isNullOrUndefined(this._delCells[N].value.chart)||(ne[c][u].chart=this._delCells[N].value.chart)),R.push({row:c,col:u}),oe._wrapColl[c]&&delete oe._wrapColl[c][u])),t.isNullOrUndefined(ne[c])||t.isNullOrUndefined(ne[c][u+l.colCount])||(ne[c][u]=e.extend(!0,{},ne[c][u+l.colCount]),ne[c][u+l.colCount].wrap&&(this._wrapCollection(c,u,oe._wrapColl[c][u+l.colCount],r),delete oe._wrapColl[c][u+l.colCount]),t.isNullOrUndefined(ne[c][u+l.colCount].picture)||(E=ne[c][u+l.colCount].picture),t.isNullOrUndefined(ne[c][u+l.colCount].chart)||(D=ne[c][u+l.colCount].chart),this._clearFormula(c,u+l.colCount),ne[c][u+l.colCount]={},t.isNullOrUndefined(E)||(ne[c][u+l.colCount].picture=E),t.isNullOrUndefined(D)||(ne[c][u+l.colCount].chart=D),t.isNullOrUndefined(this._delCells[this._delCells.length-1])||(N=this._delCells.length-1,t.isNullOrUndefined(this._delCells[N].value.picture)||(ne[c][u].picture=this._delCells[N].value.picture),t.isNullOrUndefined(this._delCells[N].value.chart)||(ne[c][u].chart=this._delCells[N].value.chart)),R.push({row:c,col:u+l.colCount}),(k=this._refreshFormula(c,u,l.colCount,"delete","column",l.startCol,!1))||this.XLEdit._refreshCalcEngine(c,u),se||this.XLComment&&(this._isRowViewable(r,c)&&this._removeClass(this.getCell(c,u),"e-commentcell"),this.XLComment._updateCmntFrmCntnr(c,u))),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c,u,l.colCount,"column","delete",r),0==c&&q&&(this._writeRule(u-l.colCount,r),q=!1);for(g=0,p=R.length;g<p;g++)0===this.getObjectLength(ne[R[g].row][R[g].col])&&(this._clearFormula(R[g].row,R[g].col),delete ne[R[g].row][R[g].col]);R=[]}if(this._refreshHideRowColCollection(oe.hideColsCollection,l.startCol,l.colCount,"column","delete"),this.model.allowFreezing&&this._isFrozen(he)&&o<he){if(a>=he)for(c=o;c<he;c++)this._fCol.fColCnt++;else this._fCol.fColCnt=0;S=oe.frozenRows,x=oe.frozenColumns-(this._fCol.fColCnt>0?this._fCol.fColCnt:l.colCount),w=oe.frozenColumns-(this._fCol.fColCnt>0?this._fCol.fColCnt:l.colCount)-oe._leftCol.idx,this._fCol.colAdj=w>1,this._isFrozen(de)?(this.XLFreeze.unfreezePanes(),this.XLFreeze.freezePanes(S,this._fCol.colAdj?x:x+1)):this.XLFreeze.freezeColumns(this._fCol.colAdj?x:1)}if(this._refreshFilterColl(r,l.startCol,l.colCount,"column","delete"),this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else{for(this._prevValData=e.extend(!0,[],ce),H=0,p=ce.length;H<p;H++)X=ce[H].split("_"),U=this.getRangeIndices("list"===X[1]?X[3]:X[6]),B=this.getAlphaRange(U[0],U[1]-l.colCount,U[2],U[3]-l.colCount),U[0]==U[2]&&U[1]==U[3]?l.startCol<U[1]?this._isSameRowColumn?(X[6]=B,ce[H-1]=X.join("_"),H==ce.length-1&&(ce.pop(),this._isSameRowColumn=!1)):(X[6]=B,ce[H]=X.join("_")):l.startRow<=U[0]&&l.startCol==U[1]&&(ce[H]=[]):(U[1]==U[3]&&(l.startCol==U[1]?ce[H]=[]:l.startCol<U[1]&&(X[6]=B,ce[H]=X.join("_"))),U[0]==U[2]&&l.startCol<=U[1]&&this._highlightValidationRng(X,H,U[0],U[1],U[2],U[3]-l.colCount),U[0]!=U[2]&&U[1]!=U[3]&&(l.startCol<U[1]?(X[6]=B,ce[H]=X.join("_")):l.startCol>=U[1]&&l.startCol<U[3]&&this._highlightValidationRng(X,H,U[0],U[1],U[2],U[3]-l.colCount)));this._dataContainer.valData=ce.filter(function(e){return Object.keys(e).length>0}),this._curValData=e.extend(!0,{},this._dataContainer.valData)}if(this._isUndo)oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),g=0,p=this._prevCellTypes.length;g<p;g++)j=this.getRangeIndices(this._prevCellTypes[g].range),B=this.getAlphaRange(j[0],j[1]-l.colCount,j[2],j[3]-l.colCount),j[0]==j[2]&&j[1]==j[3]?l.startCol<j[1]?this._isSameRowColumn?(oe.cellTypes[g-1].range=B,oe.cellTypes[g-1].settings=oe.cellTypes[g].settings,g==oe.cellTypes.length-1&&(oe.cellTypes.pop(),this._isSameRowColumn=!1)):oe.cellTypes[g].range=B:l.startRow<=j[0]&&l.startCol==j[1]&&(oe.cellTypes[g]={}):(j[1]==j[3]&&(l.startCol==j[1]&&(t.isNullOrUndefined(oe.cellTypes[g+1])||(oe.cellTypes[g]=e.extend(!0,{},oe.cellTypes[g+1]),this._isSameRowColumn=!0)),l.startCol<j[1]&&(this._isSameRowColumn?(oe.cellTypes[g-1].range=B,oe.cellTypes[g-1].settings=oe.cellTypes[g].settings,g==oe.cellTypes.length-1&&(oe.cellTypes.pop(),this._isSameRowColumn=!1)):oe.cellTypes[g].range=B)),j[0]==j[2]&&l.startCol<=j[1]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0],j[1],j[2],j[3]-l.colCount)));oe.cellTypes=oe.cellTypes.filter(function(e){return Object.keys(e).length>0}),this._curCellTypes=e.extend(!0,{},oe.cellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l)}break;case"shiftRight":for(this._refreshNamedRange(l.colCount,l.status,l.startCol,!1),c=l.startRow;c<y;c++)for(u=te,p=l.startCol;u>=p;u--)t.isNullOrUndefined(ne[c])||t.isNullOrUndefined(ne[c][u])||(ne[c][u+l.colCount]=e.extend(!0,{},ne[c][u]),ne[c][u].wrap&&(this._wrapCollection(c,u+l.colCount,oe._wrapColl[c][u],r),delete oe._wrapColl[c][u]),this._clearFormula(c,u),u>=o&&u<=a?(this._checkIndicesInContainer(r,c,o,"rule")&&(d=this._dataContainer.sheets[r][c][o].rule),this._checkIndicesInContainer(r,c,o,"cFormatRule")&&(h=this._dataContainer.sheets[r][c][o].cFormatRule),this._refreshValAndCF(c,u,d,h,0,l.colCount,l.status),o<1||this.addClass(this.getCell(c,u)[0],this.XLFormat.getFormatClass(this.getCell(c,o-1)[0].className,!1))):delete ne[c][u],(k=this._refreshFormula(c,u+l.colCount,l.colCount,"insert","column",l.startCol,!0))||this.XLEdit._refreshCalcEngine(c,u+l.colCount),k||this.XLEdit._refreshCalcEngine(c,u),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c,u+l.colCount,l.colCount,"column","insert",r));if(this._isUndo&&this._delCells.length>0)for(F=(L=this._delCells)[L.length-1].col-L[0].col,g=0,p=L.length;g<p;g++)ne[L[g].row][L[g].col]=L[g].value,this._refreshFormula(L[g].row,L[g].col,F,"insert","column",l.startRow,!1),this.XLEdit._refreshCalcEngine(L[g].row,L[g].col),se||this.XLComment&&this.XLComment._updateCmntFrmCntnr(L[g].row,L[g].col),L[g].value.wrap&&this._wrapCollection(L[g].row,L[g].col,L[g].height,r);if(this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else for(this._prevValData=e.extend(!0,[],ce),p=ce.length,H=0;H<p;H++)X=ce[H].split("_"),U=this.getRangeIndices("list"===X[1]?X[3]:X[6]),B=this.getAlphaRange(U[0],U[1]+l.colCount,s,U[3]+l.colCount),U[1]==U[3]&&U[0]==U[2]?U[1]>=l.startCol&&U[0]==l.startRow&&this._highlightValidationRng(X,H,n,U[1]+l.colCount,n,U[3]+l.colCount):(U[1]==U[3]&&U[1]>=l.startCol&&(l.startRow==U[0]?U[0]==U[2]&&U[1]==U[3]?this._highlightValidationRng(X,H,n,U[1]+l.colCount,n,U[3]+l.colCount):(ce[ce.length]=[],this._highlightValidationRng(X,H,n,n+l.rowCount,j[1],j[2],j[3])):l.startRow<U[2]&&l.startCol<=U[1]&&(M=l.startRow-U[0],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[0]+(M-1),U[3]),this._highlightValidationRng(X,H,n+l.rowCount,U[1],U[2],U[3]),this._highlightValidationRng(X,ce[ce.length],n,U[1]+l.colCount,s,U[3]+l.colCount))),U[0]==U[2]&&l.startCol<=U[3]&&l.startRow==U[2]&&(l.startCol>U[1]&&(M=l.startCol-U[1],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[2],U[1]+(M-1)),this._highlightValidationRng(X,H,U[0],o+l.colCount,U[2],U[3]+l.colCount)),l.startCol<U[1]&&this._highlightValidationRng(X,H,U[0],U[1]+l.colCount,U[2],U[3]+l.colCount))),this._curValData=e.extend(!0,[],ce);if(this._isUndo)delete oe.cellTypes,oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)delete oe.cellTypes,oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),p=oe.cellTypes.length,g=0;g<p;g++)j=this.getRangeIndices(oe.cellTypes[g].range),V={range:this.getAlphaRange(j[0],j[1]+l.colCount,s,j[3]+l.colCount),settings:oe.cellTypes[g].settings},j[1]==j[3]&&j[0]==j[2]?j[1]>=l.startCol&&j[0]==l.startRow&&(oe.cellTypes[g].range=this.getAlphaRange(n,j[1]+l.colCount,n,j[3]+l.colCount)):(j[1]==j[3]&&j[1]>=l.startCol&&(l.startRow==j[0]?j[0]==j[2]&&j[1]==j[3]?oe.cellTypes[g].range=this.getAlphaRange(n,j[1]+l.colCount,n,j[3]+l.colCount):(oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(n+l.rowCount,j[1],j[2],j[3])):l.startRow<j[2]&&l.startCol<=j[1]&&(M=l.startRow-j[0],V.range=this.getAlphaRange(j[0],j[1],j[0]+(M-1),j[3]),V.settings=oe.cellTypes[g].settings,oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(n+l.rowCount,j[1],j[2],j[3]),V.range=this.getAlphaRange(n,j[1]+l.colCount,s,j[3]+l.colCount),V.settings=oe.cellTypes[g].settings,oe.cellTypes[oe.cellTypes.length]=V)),j[0]==j[2]&&l.startCol<=j[3]&&l.startRow==j[2]&&(l.startCol>j[1]&&(M=l.startCol-j[1],V.range=this.getAlphaRange(j[0],j[1],j[2],j[1]+(M-1)),V.settings=oe.cellTypes[g].settings,oe.cellTypes[oe.cellTypes.length]=V,oe.cellTypes[g].range=this.getAlphaRange(j[0],o+l.colCount,j[2],j[3]+l.colCount)),l.startCol<j[1]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0],j[1]+l.colCount,j[2],j[3]+l.colCount)))),this._curCellTypes=e.extend(!0,[],oe.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(l)}break;case"shiftLeft":for(this._refreshNamedRange(l.colCount,l.status,l.startCol,!1),this._delCells=[],R=[],c=l.startRow;c<y;c++){for(u=l.startCol;u<=te;u++)u<l.startCol+l.colCount&&!t.isNullOrUndefined(ne[c])&&(t.isNullOrUndefined(ne[c][u])||(this._delCells.push({row:c,col:u,value:e.extend(!0,{},ne[c][u]),height:ne[c][u].wrap?oe._wrapColl[c][u]:J[c]}),this._clearFormula(c,u),ne[c][u].wrap&&delete oe._wrapColl[c][u],ne[c][u]={},R.push({row:c,col:u}))),t.isNullOrUndefined(ne[c])||t.isNullOrUndefined(ne[c][u+l.colCount])||(ne[c][u]=e.extend(!0,{},ne[c][u+l.colCount]),ne[c][u+l.colCount].wrap&&(this._wrapCollection(c,u,oe._wrapColl[c][u+l.colCount],r),delete oe._wrapColl[c][u+l.colCount]),A=this.getCell(c+l.rowCount,u),P=this.getCell(c,u),A&&(_=A[0].outerHTML,this.clearTextNode(A)),P&&(f=P[0].outerHTML,this.clearTextNode(P,this.XLEdit.getPropertyValue(c,u,"value2"))),R.push({row:c,col:u+l.colCount}),this._clearFormula(c,u+l.colCount),ne[c][u+l.colCount]={},k=this._refreshFormula(c,u,l.colCount,"delete","column",l.startCol,!0),A&&(A[0].outerHTML=_),P&&(P[0].outerHTML=f),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c,u,l.colCount,"column","delete",r)),k||this.XLEdit._refreshCalcEngine(c,u);for(p=R.length,g=0;g<p;g++)0===this.getObjectLength(ne[R[g].row][R[g].col])&&(this._clearFormula(R[g].row,R[g].col),this.XLEdit._refreshCalcEngine(R[g].row,R[g].col),delete ne[R[g].row][R[g].col]);R=[]}if(this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else{for(this._prevValData=e.extend(!0,[],ce),p=ce.length,H=0;H<p;H++)X=ce[H].split("_"),U=this.getRangeIndices("list"===X[1]?X[3]:X[6]),B=this.getAlphaRange(U[0],U[1]-l.colCount,U[0],U[3]-l.colCount),U[1]==U[3]&&U[0]==U[2]?l.startRow==U[0]&&l.startCol==U[1]?ce[H]=[]:l.startCol<=U[1]&&l.startRow==U[0]&&this._highlightValidationRng(X,H,n,U[1]-l.colCount,s,U[3]-l.colCount):U[1]==U[3]&&U[1]>=l.startCol&&(l.startRow==U[0]?U[0]==U[2]&&U[1]==U[3]?this._highlightValidationRng(X,H,n,j[1]-l.colCount,s,j[3]-l.colCount):(ce[ce.length]=[],this._highlightValidationRng(X,H,U[0]+l.rowCount,U[1],U[2],U[3])):l.startRow<U[2]&&l.startCol<=U[1]&&(M=l.startRow-j[0],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[0]+(M-1),U[3]),this._highlightValidationRng(X,H,U[0]+l.rowCount,U[1],U[2],U[3]),this._highlightValidationRng(X,ce[ce.length],n,U[1]-l.colCount,s,U[3]-l.colCount)));this._dataContainer.valData=ce.filter(function(e){return Object.keys(e).length>0}),this._curValData=e.extend(!0,[],this._dataContainer.valData)}if(this._isUndo)delete oe.cellTypes,oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)delete oe.cellTypes,oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),p=this._prevCellTypes.length,g=0;g<p;g++)j=this.getRangeIndices(this._prevCellTypes[g].range),V={range:this.getAlphaRange(j[0],j[1]-l.colCount,j[0],j[3]-l.colCount),settings:oe.cellTypes[g].settings},j[1]==j[3]&&j[0]==j[2]?l.startRow==j[0]&&l.startCol==j[1]?oe.cellTypes[g]={}:l.startCol<=j[1]&&l.startRow==j[0]&&(oe.cellTypes[g].range=this.getAlphaRange(n,j[1]-l.colCount,s,j[3]-l.colCount)):j[1]==j[3]&&j[1]>=l.startCol&&(l.startRow==j[0]?j[0]==j[2]&&j[1]==j[3]?oe.cellTypes[g].range=this.getAlphaRange(n,j[1]-l.colCount,s,j[3]-l.colCount):(oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(j[0]+l.rowCount,j[1],j[2],j[3])):l.startRow<j[2]&&l.startCol<=j[1]&&(M=l.startRow-j[0],V.range=this.getAlphaRange(j[0],j[1],j[0]+(M-1),j[3]),V.settings=oe.cellTypes[g].settings,oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(j[0]+l.rowCount,j[1],j[2],j[3]),V.range=this.getAlphaRange(n,j[1]-l.colCount,s,j[3]-l.colCount),V.settings=this.getAlphaRange(n,j[1]-l.colCount,s,j[3]-l.colCount),oe.cellTypes[oe.cellTypes.length]=e.extend(!0,[],V)));oe.cellTypes=oe.cellTypes.filter(function(e){return Object.keys(e).length>0}),this._curCellTypes=e.extend(!0,[],oe.cellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l)}break;case"shiftBottom":for(this._refreshNamedRange(l.rowCount,l.status,l.startRow,!0),K=this.getSheet(r).columnsWidthCollection,J=this.getSheet(r).rowsHeightCollection,c=C,p=l.startRow;c>=p;c--){for(W=this._checkIndicesInContainer(r,c,0,"wrapRow"),u=l.startCol;u<I;u++)t.isNullOrUndefined(ne[c])||t.isNullOrUndefined(ne[c][u])||(t.isNullOrUndefined(ne[c+l.rowCount])&&(ne[c+l.rowCount]={}),W&&(Q=oe._wrapColl[c][u],J[c+l.rowCount]=t.max([Q,J[c+l.rowCount]]),this._checkIndicesInContainer(r,c+l.rowCount,0,"wrapRow")||this.XLEdit._updateDataContainer({rowIndex:c+l.rowCount,colIndex:0},{dataObj:{wrapRow:!0}}),this._wrapCollection(c+l.rowCount,u,Q,r)),ne[c+l.rowCount][u]=e.extend(!0,{},ne[c][u]),this._clearFormula(c,u),c>=n&&c<=s?(this._checkIndicesInContainer(r,n,u,"rule")&&(d=this._dataContainer.sheets[r][n][u].rule),this._checkIndicesInContainer(r,n,u,"cFormatRule")&&(h=this._dataContainer.sheets[r][n][u].cFormatRule),this._refreshValAndCF(c,u,d,h,l.rowCount,0,l.status),se||n<1||this.addClass(this.getCell(c,u)[0],this.XLFormat.getFormatClass(this.getCell(n-1,u)[0].className,!1))):delete ne[c][u],W&&delete oe._wrapColl[c][u],k=this._refreshFormula(c+l.rowCount,u,l.rowCount,"insert","row",l.startRow,!0),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c+l.rowCount,u,l.rowCount,"row","insert",r)),k||this.XLEdit._refreshCalcEngine(c,u),k||this.XLEdit._refreshCalcEngine(c+l.rowCount,u);W&&(J[c]=t.max(this._getObjectValues(oe._wrapColl[c])),J[c]||(J[c]=this.model.rowHeight),this.getObjectLength(oe._wrapColl[c])||delete this._dataContainer.sheets[r][c][0].wrapRow),t.isNullOrUndefined(ne[c])||0===this.getObjectLength(ne[c])&&delete ne[c]}if(this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else for(this._prevValData=e.extend(!0,[],ce),H=0,p=ce.length;H<p;H++)X=ce[H].split("_"),U=this.getRangeIndices("list"===X[1]?X[3]:X[6]),B=this.getAlphaRange(U[0]+l.rowCount,U[1],U[2]+l.rowCount,U[3]),l.startRow<=U[2]&&l.startCol<=U[3]&&(l.startCol==U[1]&&l.startRow==U[0]?(X[6]=B,ce[H]=X.join("_")):(U[1]==U[3]&&(l.startRow>U[0]&&(M=l.startRow-U[0],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[0]+(M-1),U[3]),this._highlightValidationRng(X,H,n+l.rowCount,U[1],U[2]+l.rowCount,U[3])),l.startRow<U[0]&&(X[6]=B,ce[H]=X.join("_"))),U[0]==U[2]&&(l.startCol>U[1]&&(M=l.startCol-U[1],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[2],U[1]+(M-1)),this._highlightValidationRng(X,H,U[0],o+l.colCount,U[2],U[3]+l.colCount)),o<U[1]&&this._highlightValidationRng(X,H,U[0],U[1]+l.rowCount,U[2],U[3]+l.rowCount)))),this._curValData=e.extend(!0,{},ce);if(this._isUndo)oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),p=oe.cellTypes.length,g=0;g<p;g++)j=this.getRangeIndices(oe.cellTypes[g].range),V={range:this.getAlphaRange(j[0]+l.rowCount,j[1],j[2]+l.rowCount,j[3]),settings:oe.cellTypes[g].settings},l.startRow<=j[2]&&l.startCol==j[3]&&(l.startCol==j[1]&&l.startRow==j[0]?oe.cellTypes[g].range=V.range:(j[1]==j[3]&&(l.startRow>j[0]&&(M=l.startRow-j[0],V.range=this.getAlphaRange(j[0],j[1],j[0]+(M-1),j[3]),oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(n+l.rowCount,j[1],j[2]+l.rowCount,j[3])),l.startRow<j[0]&&(oe.cellTypes[g].range=V.range)),j[0]==j[2]&&(l.startCol>j[1]&&(M=l.startCol-j[1],V.range=this.getAlphaRange(j[0],j[1],j[2],j[1]+(M-1)),V.settings=oe.cellTypes[g].settings,oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(j[0],o+l.colCount,j[2],j[3]+l.colCount)),o<j[1]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0],j[1]+l.rowCount,j[2],j[3]+l.rowCount))))),this._curCellTypes=e.extend(!0,{},oe.cellTypes);this.model.allowCellType&&this.XLCellType._refreshCellType(l)}if(this._isUndo&&this._delCells.length>0)for(F=(L=this._delCells)[L.length-1].row-L[0].row,c=0,p=L.length;c<p;c++)Y=L[c].row,$=L[c].col,t.isNullOrUndefined(ne[Y])&&(ne[Y]={}),ne[Y][$]=L[c].value,this._refreshFormula(Y,$,F,"insert","row",l.startRow,!0),this.XLEdit._refreshCalcEngine(Y,$),W=this._checkIndicesInContainer(r,Y,0,"wrapRow"),Z=L[c].value.wrap,(W||Z)&&(Q=Z?L[c].height:this.model.rowHeight,J[Y]=t.max([Q,J[Y]]),this._checkIndicesInContainer(r,Y,0,"wrapRow")||this.XLEdit._updateDataContainer({rowIndex:Y,colIndex:0},{dataObj:{wrapRow:!0}}),this._wrapCollection(Y,$,Q,r)),se||this.XLComment&&this.XLComment._updateCmntFrmCntnr(Y,$);break;case"shiftUp":for(this._refreshNamedRange(l.rowCount,l.status,l.startRow,!0),R=[],K=this.getSheet(r).columnsWidthCollection,J=this.getSheet(r).rowsHeightCollection,c=l.startRow;c<=C;c++){for(ee=this._checkIndicesInContainer(r,c,0,"wrapRow"),W=this._checkIndicesInContainer(r,c+l.rowCount,0,"wrapRow"),u=l.startCol;u<I;u++)c<l.startRow+l.rowCount&&!t.isNullOrUndefined(ne[c])&&(t.isNullOrUndefined(ne[c][u])||(this._delCells.push({row:c,col:u,value:e.extend(!0,{},ne[c][u]),height:ee?oe._wrapColl[c][u]:J[c]}),this._clearFormula(c,u),ne[c][u]={},R.push({row:c,col:u}),ee&&delete oe._wrapColl[c][u])),t.isNullOrUndefined(ne[c+l.rowCount])?J[c+l.rowCount]=this.model.rowHeight:t.isNullOrUndefined(ne[c+l.rowCount][u])||(t.isNullOrUndefined(ne[c])&&(ne[c]={}),ne[c][u]=e.extend(!0,{},ne[c+l.rowCount][u]),W&&(this._wrapCollection(c,u,oe._wrapColl[c+l.rowCount][u],r),delete oe._wrapColl[c+l.rowCount][u]),A=this.getCell(c+l.rowCount,u),P=this.getCell(c,u),A&&(_=A[0].outerHTML,this.clearTextNode(A)),P&&(f=P[0].outerHTML,this.clearTextNode(P,this.XLEdit.getPropertyValue(c,u,"value2"))),this._clearFormula(c+l.rowCount,u),ne[c+l.rowCount][u]={},R.push({row:c+l.rowCount,col:u}),k=this._refreshFormula(c,u,l.rowCount,"delete","row",l.startRow,!0),A&&(A[0].outerHTML=_),P&&(P[0].outerHTML=f),this.model.allowSparkline&&this.XLSparkline._refreshSparklineForInsDel(c,u,l.colCount,"column","delete",r)),k||this.XLEdit._refreshCalcEngine(c,u);ee&&this.getObjectLength(oe._wrapColl[c])<1&&delete this._dataContainer.sheets[r][c][0].wrapRow,W&&(this.XLEdit._updateDataContainer({rowIndex:c,colIndex:0},{dataObj:{wrapRow:!0}}),J[c+l.rowCount]=t.max(this._getObjectValues(oe._wrapColl[c+l.rowCount])),J[c+l.rowCount]||(J[c+l.rowCount]=this.model.rowHeight),this.getObjectLength(oe._wrapColl[c+l.rowCount])||delete this._dataContainer.sheets[r][c+l.rowCount][0].wrapRow),(ee||W)&&(J[c]=t.max(this._getObjectValues(oe._wrapColl[c])),J[c]||(J[c]=this.model.rowHeight))}for(g=0,p=R.length;g<p;g++)0===this.getObjectLength(ne[R[g].row][R[g].col])&&(this._clearFormula(R[g].row,R[g].col),delete ne[R[g].row][R[g].col]),0===this.getObjectLength(ne[R[g].row])&&delete ne[R[g].row];if(this._isUndo)this._dataContainer.valData=e.extend(!0,[],l.prevValData);else if(!this._isUndo&&this._isUndoRedo)this._dataContainer.valData=e.extend(!0,[],l.curValData);else{for(this._prevValData=e.extend(!0,[],ce),H=0,p=ce.length;H<p;H++)X=ce[H].split("_"),U=this.getRangeIndices("list"===X[1]?X[3]:X[6]),B=this.getAlphaRange(n-l.rowCount,a,n-l.rowCount,a),l.startRow<=U[2]&&l.startCol==U[3]&&(U[1]==U[3]&&U[0]==U[2]?l.startRow==U[0]&&l.startCol==U[1]?ce[H]=[]:l.startCol==U[1]&&l.startRow<=U[0]&&this._highlightValidationRng(X,H,U[0]-l.rowCount,U[1],U[2]-l.rowCount,U[3]):(U[1]==U[3]&&(U[1]==l.startCol&&(ce[ce.length]=[],this._highlightValidationRng(X,H,n,U[1],U[2]-l.rowCount,U[3])),l.startRow>U[0]&&(M=l.startRow-U[0],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[0]+(M-1),U[3]),this._highlightValidationRng(X,H,n-l.rowCount,U[1],U[2]-l.rowCount,U[3])),l.startRow<U[0]&&this._highlightValidationRng(X,H,U[0]-l.rowCount,U[1],U[2]-l.rowCount,U[3])),U[0]==U[2]&&(l.startCol>U[1]&&(M=l.startCol-U[1],this._highlightValidationRng(X,ce[ce.length],U[0],U[1],U[2],U[1]+(M-1)),this._highlightValidationRng(X,H,U[0],o-l.colCount,U[2],U[3]-l.colCount)),l.startCol<U[1]&&this._highlightValidationRng(X,H,U[0],U[1]-l.rowCount,U[2],U[3]-l.rowCount))));this._dataContainer.valData=ce.filter(function(e){return Object.keys(e).length>0}),this._curValData=e.extend(!0,{},this._dataContainer.valData)}if(this._isUndo)oe.cellTypes=e.extend(!0,[],l.prevCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else if(!this._isUndo&&this._isUndoRedo)oe.cellTypes=e.extend(!0,[],l.curCellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(l);else{for(this._prevCellTypes=e.extend(!0,[],oe.cellTypes),p=this._prevCellTypes.length,g=0;g<p;g++)j=this.getRangeIndices(this._prevCellTypes[g].range),V={range:this.getAlphaRange(n-l.rowCount,a,n-l.rowCount,a),settings:oe.cellTypes[g].settings},l.startRow<=j[2]&&l.startCol==j[3]&&(j[1]==j[3]&&j[0]==j[2]?l.startRow==j[0]&&l.startCol==j[1]?oe.cellTypes[g]={}:l.startCol==j[1]&&l.startRow<=j[0]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0]-l.rowCount,j[1],j[2]-l.rowCount,j[3])):(j[1]==j[3]&&(j[1]==l.startCol&&(oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(n,j[1],j[2]-l.rowCount,j[3])),l.startRow>j[0]&&(M=l.startRow-j[0],V.range=this.getAlphaRange(j[0],j[1],j[0]+(M-1),j[3]),V.settings=oe.cellTypes[g].settings,oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(n-l.rowCount,j[1],j[2]-l.rowCount,j[3])),l.startRow<j[0]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0]-l.rowCount,j[1],j[2]-l.rowCount,j[3]))),j[0]==j[2]&&(l.startCol>j[1]&&(M=l.startCol-j[1],V.range=this.getAlphaRange(j[0],j[1],j[2],j[1]+(M-1)),V.settings=oe.cellTypes[g].settings,oe.cellTypes[oe.cellTypes.length]=e.extend(!0,{},V),oe.cellTypes[g].range=this.getAlphaRange(j[0],o-l.colCount,j[2],j[3]-l.colCount)),l.startCol<j[1]&&(oe.cellTypes[g].range=this.getAlphaRange(j[0],j[1]-l.rowCount,j[2],j[3]-l.rowCount)))));oe.cellTypes=oe.cellTypes.filter(function(e){return Object.keys(e).length>0}),this._curCellTypes=e.extend(!0,{},oe.cellTypes),this.model.allowCellType&&this.XLCellType._refreshCellType(j,l)}}l.status.indexOf("insert")>-1&&(ae.rowIndex=ae.rowIndex+l.rowCount,ae.colIndex=ae.colIndex+l.colCount,this.getSheet(r).usedRange=ae)},refreshArrayformulaInsDel:function(i,r,l,n,s,o){var a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R=this.getActiveSheetIndex(),O=[],F=this._dataContainer.sheets[R];if(b=(C=this.getSheet(R).usedRange).rowIndex,f=C.colIndex,m=this.XLEdit.getPropertyValue(b,f,"value"),i.startCol<=f&&!((h=this.getRangeIndices(o))[1]<i.startCol||h[0]<i.startRow)){for(g=this.XLDragFill._parseFormula(o),a=0;a<g.length;a++)this._isCellReference(g[a])&&(v=this.getRangeIndices(g[a]),c="column"===r?"insert"===l?v[3]+n:v[3]-n:"insert"===l?v[2]+n:v[2]-n,u="column"===r?"insert"===l?v[1]+n:v[1]-n:"insert"===l?v[0]+n:v[0]-n,"column"===r?s>v[1]&&(u=v[1]):s>v[0]&&(u=v[0]),"column"===r?s>v[3]&&(c=v[3]):s>v[2]&&(c=v[2]),_=u>-1?"column"===r?this._getAlphaRange(R,v[0],u,v[2],c):this._getAlphaRange(R,u,v[1],c,v[3]):"#REF!",g[a]=_);if(d=this.getSheet(R).formulaRange[o],"delete"===l)for(a=1;a<=n;a++)O.push(s+a);for(x=this.XLDragFill._parseFormula(d),y=0;y<x.length;y++)w=x[y].trim(),this._isCellReference(w)&&(v=this.getRangeIndices(w),c="column"===r?"insert"===l?v[3]+n:v[3]-n:"insert"===l?v[2]+n:v[2]-n,u="column"===r?"insert"===l?v[1]+n:v[1]-n:"insert"===l?v[0]+n:v[0]-n,"column"===r?s>v[1]&&(u=v[1]):s>v[0]&&(u=v[0]),"column"===r?s>v[3]&&(c=v[3]):s>v[2]&&(c=v[2]),_=u>-1?"column"===r?this._getAlphaRange(R,v[0],u,v[2],c):this._getAlphaRange(R,u,v[1],c,v[3]):"#REF!","delete"===l&&(I=parseInt("row"===r?w.replace(/[A-Z]/g,""):this._generateColCount(w.replace(/[0-9]/g,""))),O.indexOf(I)>-1&&(_="#REF!")),x[y]=_);for(p=e.extend(!0,{},this.getSheet(R).formulaRange[o]),p=g.join(""),m=x.join(""),delete this.getSheet(R).formulaRange[o],this.getSheet(R).formulaRange[p]=m,T=(S=this.getRangeIndices(o))[0];T<=S[2];T++)for(L=S[1];L<=S[3];L++)t.isNullOrUndefined(F[T])||(t.isNullOrUndefined(F[T][L])?(F[T][L]={},F[T][L].formulaRange=p):F[T][L].formulaRange=p);this.XLEdit._formulaArrayRange=p}},_undoInsDelMerge:function(){if(this._isUndo){this._dupDetails=!0;for(var e=0,t=this._removeMergeColl.length;e<t;e++)this.mergeCenter=this._removeMergeColl[e].merge.isCenterAlign,this.mergeCells(this._removeMergeColl[e].merge.mRange,!0);this._dupDetails=!1}},_updateCommentColl:function(e){this.getSheet(e)._commentColl={},this._isInsdel=!0,this.XLComment._updateCmntArrowPos(),this._isInsdel=!1},insertShiftRight:function(e,t){var i,r,l,n,s,o,a,d,h;if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode&&(r={startCell:e,endCell:t,sheetIndex:i=this.getActiveSheetIndex(),reqType:"insert",action:"insertShiftRight",type:"actionBegin"},!this._trigActionBegin(r))){for(!1,e=r.startCell,t=r.endCell,this._isUndo?(l="shiftLeft",this._insDelStatus="delete"):(l="shiftRight",this._insDelStatus="insert"),o={startCol:e.colIndex,colCount:t.colIndex-e.colIndex+1,startRow:e.rowIndex,rowCount:t.rowIndex-e.rowIndex+1,status:l,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},s=(a=this.getObjectKeys(this.getSheet(i).formulaRange)).length,h=0;h<s;h++)if(n=a[h],d=this.getRangeIndices(a[h]),e.rowIndex<=d[0]&&t.rowIndex>=d[2]&&e.colIndex<=d[1]&&t.colIndex<=d[3])this.refreshArrayformulaInsDel(o,"column","insert",o.colCount,o.startCol,n);else if(e.rowIndex>=d[0]&&t.rowIndex<=d[2]&&e.colIndex<=d[1]&&t.colIndex<=d[3])return void this._showAlertDlg("Alert","ArrayaFormula",430);this.model.allowFiltering&&this.XLFilter._checkFilterApplied(i,e.rowIndex,o.rowCount,e.colIndex,o.colCount,l),this._checkTableApplied(i,e.rowIndex,o.rowCount,e.colIndex,o.colCount,l),this._isChartApplied=this._checkChartApplied(i,e.rowIndex,e.colIndex,o.rowCount,o.colCount),this._isChartApplied||(this._isFilterApplied||this._isTableApplied?this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630):(this._clearAllMergeCells(i,e.rowIndex,o.rowCount,e.colIndex,o.colCount,l).isAlert?this._insertShiftRight(i,e,t,o):(this._insData={sheetIdx:i,startCell:e,endCell:t,value:o},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge()),this._insDelStatus="",this.model.allowFormulaBar&&this.updateFormulaBar())}},_insertShiftRight:function(t,i,r,l){var n,s,o,a,d,h,c=r.colIndex-i.colIndex+1,u=this.getRows(t)[1],g=this._getJSSheetHeader(t).find("col"),p=this._getContent(t).find("col");if(this._updateWrapCol("insertShiftRight",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,this.getSheet(t),t),this._isUndo){for(o=i.rowIndex;o<=r.rowIndex;o++)for(s=(n=e(u[this._getRowIdx(o)]).find("td")).length-1,a=i.colIndex;a<=s-c;a++)n[a].outerHTML=n[a+c].outerHTML;for(d=s;d>s-c;d--)for(g.eq(d).remove(),p.eq(d).remove(),h=0;h<u.length;h++)e(u[this._getRowIdx(h)]).find("td:eq("+d+")").remove()}else this.XLScroll._createNewColumn(t,i,r,"shift");this.performSelection(i,r),this._refreshDataContainer(t,l),this._isInsdel=!0,this.model.allowCellType&&this.XLCellType._rangeCellTypes(this.getSheet(t).cellTypes,t),this._isInsdel=!1,this._isUndo?this._refreshAllMergeCells(t,-1,0,i.colIndex,l.colCount,"delete"):this._refreshAllMergeCells(t,-1,0,i.colIndex,l.colCount,"insert"),this.model.allowComments&&this._updateCommentColl(t),this.model.allowComments&&(this.XLComment._curCommentHCell=null),this._isUndoRedo||this._undoredoDetails(t,i,r,"insert","insertShiftRight"),this._refreshRows(t)},insertShiftBottom:function(e,t){var i,r,l,n,s,o,a,d,h;if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode&&(r={startCell:e,endCell:t,sheetIndex:i=this.getActiveSheetIndex(),reqType:"insert",action:"insertShiftBottom",type:"actionBegin"},!this._trigActionBegin(r))){for(!1,e=r.startCell,t=r.endCell,l=this._isUndo?"shiftUp":"shiftBottom",n={startCol:e.colIndex,colCount:t.colIndex-e.colIndex+1,startRow:e.rowIndex,rowCount:t.rowIndex-e.rowIndex+1,status:l,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},d=0,h=(s=this.getObjectKeys(this.getSheet(i).formulaRange)).length;d<h;d++)if(a=s[d],o=this.getRangeIndices(s[d]),e.colIndex<=o[1]&&t.colIndex<=o[3]&&e.rowIndex<=o[0]&&t.rowIndex<=o[2])this.refreshArrayformulaInsDel(n,"row","insert",n.rowCount,n.startRow,a);else if(e.colIndex>=o[1]&&t.colIndex>=o[3]&&e.rowIndex<=o[0]&&t.rowIndex<=o[2])return void this._showAlertDlg("Alert","ArrayaFormula",430);if(this._isChartApplied=this._checkChartApplied(i,e.rowIndex,e.colIndex,n.rowCount,n.colCount),!this._isChartApplied){if(this.model.allowFiltering&&this.XLFilter._checkFilterApplied(i,e.rowIndex,n.rowCount,e.colIndex,n.colCount,l),this._checkTableApplied(i,e.rowIndex,n.rowCount,e.colIndex,n.colCount,l),this._isFilterApplied||this._isTableApplied)if(this._isTotalRow){if(!this._isUndoRedo)return this._showAlertDlg("","TotalRowAlert","TotalRow",630),!0;this._isUndoRedo=this._dupDetails=!0,this._isUndo||this.insertEntireRow(this._insRows.startRow,this._insRows.endRow),this._isUndoRedo=!1}else this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630);else this._clearAllMergeCells(i,e.rowIndex,n.rowCount,e.colIndex,n.colCount,l).isAlert?this._insertShiftBottom(i,e,t,n):(this._insData={sheetIdx:i,startCell:e,endCell:t,value:n},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge();this._insDelStatus=""}}},_insertShiftBottom:function(t,i,r,l){var n,s,o,a,d,h=this.model.scrollSettings.allowVirtualScrolling;if(this._updateWrapCol("insertShiftBottom",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,this.getSheet(t),t),this._refreshDataContainer(t,l),this._isInsdel=!0,h)this._refreshViewport(this.getSheet(t)._scrollTop,t);else{var c,u,g,p=this.getSheet(t).rowsHeightCollection,m=this.getRows(t),_=m[1],f=m[0];if(this._isUndo){for(_=this._getContent(t).find("tbody").get(0).rows,n=i.rowIndex,a=_.length;n<a;n++){if(c=n+(r.rowIndex-i.rowIndex+1),g=e(_[n]).find("td"),c<_.length)for(u=e(_[c]).find("td"),s=i.colIndex;s<=r.colIndex;s++)g[s].outerHTML=u[s].outerHTML,u[s].innerHTML="";_[n].style.height=p[n]+"px",f[n].style.height=p[n]+"px"}for(s=i.colIndex;s<=r.colIndex;s++)for(d=a-1-(r.rowIndex-i.rowIndex+1),o=a-1;o>d;o--)e(_[o]).remove(),e(f[o]).remove(),this.model.sheets[t].rowCount=this.model.sheets[t].rowCount-1;this.XLScroll._refreshScroller(1,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"all")}else{for(n=i.rowIndex;n<=r.rowIndex;n++)this.XLScroll._createNewRow(t,-1,-1,"insert");for(n=_.length-1;n>=i.rowIndex;n--){if(c=n-(r.rowIndex-i.rowIndex+1),g=e(_[n]).find("td"),c>=i.rowIndex)for(u=e(_[c]).find("td"),s=i.colIndex;s<=r.colIndex;s++)g[s].outerHTML=u[s].outerHTML,u[s].innerHTML="",g[s].className=u[s].className,u[s].className="e-rowcell e-wrapword";_[n].style.height=p[n]+"px",f[n].style.height=p[n]+"px"}}this._isInsdel=!1,this._refreshRows(t)}this.XLScroll._getRowHeights(t,i.rowIndex),this.performSelection(i,r),this.model.allowComments&&this._updateCommentColl(t),this.model.allowComments&&(this.XLComment._curCommentHCell=null),this._isUndo?this._refreshAllMergeCells(t,i.rowIndex,l.rowCount,-1,0,"delete"):this._refreshAllMergeCells(t,i.rowIndex,l.rowCount,-1,0,"insert"),this._isUndoRedo||this._dupDetails||this._undoredoDetails(t,i,r,"insert","insertShiftBottom"),this.model.allowFormulaBar&&this.updateFormulaBar()},insertEntireRow:function(t,i){var r,l,n,s,o,a;if(this.model.allowInsert&&!this.model.isReadOnly){var d,h,c=this.getActiveSheetIndex(),u={startRow:t,endRow:i,sheetIndex:c,reqType:"insert",action:"insertRow",type:"actionBegin"},g=!1;if(!this._trigActionBegin(u)){var p,m,_,f,b,C,S,x=this.model.scrollSettings.allowVirtualScrolling,v=this.getSheet(c),w=v._isRowSelected,I=v._selectedCells,y=I[0].colIndex,T=I[I.length-1].colIndex;for(t=u.startRow,i=u.endRow,this._updateWrapCol("insertEntireRow",I,v,c),this._isUndo?(b="deleteRow",this._insDelStatus="delete"):(b="insertRow",this._insDelStatus="insert"),C={startCol:0,colCount:v.colCount,startRow:t,rowCount:i-t+1,status:b,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},f=(S=this.getObjectKeys(this.getSheet(c).formulaRange)).length,r=0;r<f;r++){if(_=S[r],m=this.getRangeIndices(_),!(C.startRow<=m[0]))return void this._showAlertDlg("Alert","ArrayaFormula",430);this.refreshArrayformulaInsDel(C,"row","insert",C.rowCount,C.startRow,_)}if(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(c,t,C.rowCount,0,v.colCount,b))return void this._showAlertDlg("Alert","InsertDeleteAlert",440);for(this._clearAllMergeCells(c,t,C.rowCount,-1,0,b),this._isUndo&&this.XLShape&&this.XLShape._refreshChartdataInsDel(C,C.rowCount,C.startRow,c),f=(d=this.getSheet(c).cellTypes).length,l=0;l<f;l++)if((h=this.getRangeIndices(d[l].range))[3]-h[1]>=1){h[2]>t&&(g=!0);break}if(g?(this._showAlertDlg("Alert","CellTypeInsertDeleteAlert",440),g=!1):this._refreshDataContainer(c,C),this._isInsdel=!0,this._isUndo?this._batchDeleteRow(t,i,c,!0):this._batchAddRow(t,i,c),x)this.model.allowFiltering&&this.XLFilter._updateFilterCollection(c,t,i-t,"row",this._insDelStatus),v.rowCount=this._isUndo?v.rowCount-C.rowCount:v.rowCount+C.rowCount,this.refreshContent(c);else{if(this._isUndo){for(s=(n=this.getRows(c))[1],o=n[0],p=i;p>=t;p--)e(s[p]).remove(),e(o[p]).remove(),v.rowCount=v.rowCount-1;for(p=0,f=(a=o.find("td")).length;p<f;p++)e(a[p]).text(p+1)}else for(p=t;p<=i;p++)this.XLScroll._createNewRow(c,p,0,"insert");this.model.allowFiltering&&this.XLFilter._updateFilterCollection(c,t,i-t,"row",this._insDelStatus),this.XLScroll._getRowHeights(c,t),this._refreshRows(c)}this._isInsdel=!1,this._isFrozen(v.frozenRows)&&(t<v._frozenRows||i<v._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv(),this._isUndo?this._refreshAllMergeCells(c,t,C.rowCount,-1,0,"delete"):this._refreshAllMergeCells(c,t,C.rowCount,-1,0,"insert"),w?this.XLSelection.selectRows(t,i):this.performSelection({rowIndex:t,colIndex:y},{rowIndex:i,colIndex:T}),this.model.allowComments&&this._updateCommentColl(c),this._isUndoRedo||this._dupDetails||this._undoredoDetails(c,{rowIndex:t,colIndex:0},{rowIndex:i,colIndex:v.colCount-1},"insert","insertRow"),this.XLShape&&(this._isUndo?this.XLShape._refreshChartdataInsDel(C,C.rowCount,C.startRow,c,!0):this.XLShape._refreshChartdataInsDel(C,C.rowCount,C.startRow,c)),this._insDelStatus="",this.model.allowFormulaBar&&this.updateFormulaBar(),this._isAutoWHMode&&this._setElemDimension()}}},insertEntireColumn:function(e,t){var i,r,l,n,s,o,a,d;if(this.model.allowInsert&&!this.model.isReadOnly&&!this.model.isGridMode&&(r={startCol:e,endCol:t,sheetIndex:i=this.getActiveSheetIndex(),reqType:"insert",action:"insertColumn",type:"actionBegin"},!this._trigActionBegin(r))){var h,c,u,g,p,m,_,f,b=this.model.scrollSettings.allowVirtualScrolling,C=this.getSheet(i),S=C._isColSelected,x=C._selectedCells,v=x[0].rowIndex,w=x[x.length-1].rowIndex,I=C.columnsWidthCollection;if(e=r.startCol,t=r.endCol,this._updateWrapCol("insertEntireColumn",x,C,i),this._isUndo?(this._insDelStatus="delete",c="deleteColumn"):(c="insertColumn",this._insDelStatus="insert"),!C._isTemplate||!(e<C._templateColCount||t<C._templateColCount)){for(u={startCol:e,colCount:t-e+1,startRow:0,rowCount:C.rowCount,status:c,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevChartDetails:this._chartUndo,curChartDetails:this._chartRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},s=0,o=(m=this.getObjectKeys(this.getSheet(i).formulaRange)).length;s<o;s++){if(f=m[s],_=this.getRangeIndices(f),!(u.startCol<=_[1]))return void this._showAlertDlg("Alert","ArrayaFormula",430);this.refreshArrayformulaInsDel(u,"column","insert",u.colCount,u.startCol,f)}if(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(i,u.startRow,C.rowCount,e,u.colCount,c))return void this._showAlertDlg("Alert","InsertDeleteAlert",440);if(this._clearAllMergeCells(i,-1,0,e,u.colCount,c),this._isUndo&&this.XLShape&&this.XLShape._refreshChartdataInsDel(u,u.colCount,u.startCol,i,!1),"deleteColumn"===c&&b)for(h=t;h>=e;h--)I.splice(h,1),I.push(C.columnWidth);if(g={rowIndex:v,colIndex:e},p={rowIndex:w,colIndex:t},this._isInsdel=!0,b){for(a=!1,o=(l=this.getSheet(i).cellTypes).length,d=0;d<o;d++)if((n=this.getRangeIndices(l[d].range))[3]-n[1]>=1){n[3]>e&&(a=!0);break}a?(this._showAlertDlg("Alert","CellTypeInsertDeleteAlert",440),a=!1):(this._refreshDataContainer(i,u),this.refreshContent(i))}else this.XLScroll._createNewColumn(i,g,p,"insert"),this._refreshDataContainer(i,u);this._isInsdel=!1,this._isUndo?this._refreshAllMergeCells(i,-1,0,e,u.colCount,"delete"):this._refreshAllMergeCells(i,-1,0,e,u.colCount,"insert"),this.model.allowFiltering&&this.XLFilter._updateFilterCollection(i,e,t-e,"column",this._insDelStatus),this._isFrozen(C.frozenColumns)&&(e<C._frozenColumns||t<C._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv(),this.model.allowComments&&this._updateCommentColl(i),this._refreshRows(i),(this._isFrozen(C.frozenRows)||this._isFrozen(C.frozenColumns))&&this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),this._isAutoWHMode&&this._autoSSWidthHeight(i),this.XLShape&&(this._isUndo,this.XLShape._refreshChartdataInsDel(u,u.colCount,u.startCol,i,!0)),S?this.XLSelection.selectColumns(e,t):this.performSelection(g,p),this._isUndoRedo||this._undoredoDetails(i,g,p,"insert","insertColumn"),this._insDelStatus="",this.model.allowFormulaBar&&this.updateFormulaBar()}}},deleteShiftLeft:function(e,t){var i,r,l,n,s,o,a,d,h;if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode&&(r={startCell:e,endCell:t,sheetIndex:i=this.getActiveSheetIndex(),reqType:"delete",action:"deleteShiftLeft",type:"actionBegin"},!this._trigActionBegin(r))){for(l=!1,e=r.startCell,t=r.endCell,this._isUndo?(this._insDelStatus="insert",n="shiftRight"):(this._insDelStatus="delete",n="shiftLeft"),s={startCol:e.colIndex,colCount:t.colIndex-e.colIndex+1,startRow:e.rowIndex,rowCount:t.rowIndex-e.rowIndex+1,status:n,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},d=0,h=(o=this.getObjectKeys(this.getSheet(i).formulaRange)).length;d<h;d++)if(a=this.getRangeIndices(o[d]),e.colIndex<=a[1])return void this._showAlertDlg("Alert","ArrayaFormula",430);this._isChartApplied=this._checkChartApplied(i,e.rowIndex,e.colIndex,s.rowCount,s.colCount),this._isChartApplied||(this.model.allowFiltering&&this.XLFilter._checkFilterApplied(i,e.rowIndex,s.rowCount,e.colIndex,s.colCount,n),this._checkTableApplied(i,e.rowIndex,s.rowCount,e.colIndex,s.colCount,n),this._isFilterApplied||this._isTableApplied?this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630):((l=this._clearAllMergeCells(i,e.rowIndex,s.rowCount,e.colIndex,s.colCount,n)).isAlert?l.isCancel||this._deleteShiftLeft(i,e,t,s):(this._insData={sheetIdx:i,startCell:e,endCell:t,value:s},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge()),this._insDelStatus="")}},_deleteShiftLeft:function(t,i,r,l){var n,s,o,a,d,h,c=r.colIndex-i.colIndex+1,u=this.getRows(t)[1],g=[];if(this._updateWrapCol("deleteShiftLeft",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,this.getSheet(t),t),this._isUndo)for(e.extend(!0,g,this._deletedText),n=i.rowIndex;n<=r.rowIndex;n++){for(h=this._getRowIdx(n),d=(a=e(u[h]).find("td")).length-1-c;d>i.colIndex-1;d--)a[d+c].outerHTML=a[d].outerHTML;for(s=i.colIndex;s<=r.colIndex;s++)a[s].outerHTML=g.shift()}else for(this._insDelStatus="delete",n=i.rowIndex;n<=r.rowIndex;n++){for(h=this._getRowIdx(n),a=e(u[h]).find("td"),s=i.colIndex;s<=r.colIndex;s++)g.push(a[s].outerHTML);for(o=a.length,d=i.colIndex;d<o-c;d++)a[d].outerHTML=a[d+c].outerHTML}this.performSelection(i,r),this._refreshDataContainer(t,l),this._isInsdel=!0,this.model.allowCellType&&this.XLCellType._rangeCellTypes(this.getSheet(t).cellTypes,t),this._isInsdel=!1,this.model.allowComments&&(this.XLComment._curCommentHCell=null),this._deletedText=g,this.model.allowComments&&this._updateCommentColl(t),this._isUndo?this._refreshAllMergeCells(t,-1,0,i.colIndex,l.colCount,"insert"):this._refreshAllMergeCells(t,-1,0,i.colIndex,l.colCount,"delete"),this._isUndoRedo||this._undoredoDetails(t,i,r,"delete","deleteShiftLeft"),this._refreshRows(t),this.model.allowFormulaBar&&this.updateFormulaBar()},deleteShiftUp:function(e,t){var i,r,l,n,s;if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode&&(r={startCell:e,endCell:t,sheetIndex:i=this.getActiveSheetIndex(),reqType:"delete",action:"deleteShiftUp",type:"actionBegin"},!this._trigActionBegin(r))){if(l=!1,e=r.startCell,t=r.endCell,n=this._isUndo?"shiftBottom":"shiftUp",s={startCol:e.colIndex,colCount:t.colIndex-e.colIndex+1,startRow:e.rowIndex,rowCount:t.rowIndex-e.rowIndex+1,status:n,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"hasFormulaArray"))return void this._showAlertDlg("Alert","ArrayaFormula","multipleArrayFormula",430);if(this._isChartApplied=this._checkChartApplied(i,e.rowIndex,e.colIndex,s.rowCount,s.colCount),!this._isChartApplied){if(this.model.allowFiltering&&this.XLFilter._checkFilterApplied(i,e.rowIndex,s.rowCount,e.colIndex,s.colCount,n),this._checkTableApplied(i,e.rowIndex,s.rowCount,e.colIndex,s.colCount,n),this._isFilterApplied||this._isTableApplied){if(this._isTotalRow)return;this._showAlertDlg("Alert","InsertDeleteAlert","InsertDeleteAlert",630)}else(l=this._clearAllMergeCells(i,e.rowIndex,s.rowCount,e.colIndex,s.colCount,n)).isAlert?l.isCancel||this._deleteShiftUp(i,e,t,s):(this._insData={sheetIdx:i,startCell:e,endCell:t,value:s},this._isUndoRedo?this._refreshMergeCells():this._showAlertDlg("Alert","MergeInsertAlert","MergeInsertDelete",498)),this._undoInsDelMerge();this._insDelStatus=""}}},_deleteShiftUp:function(t,i,r,l){var n,s,o,a,d,h=this.model.scrollSettings.allowVirtualScrolling,c=[],u=this.getSheet(t);if(this._refreshDataContainer(t,l),this._isInsdel=!0,this._updateWrapCol("deleteShiftUp",this._getSelectedCells(t,[i.rowIndex,i.colIndex,r.rowIndex,r.colIndex]).selCells,u,t),h)this._refreshViewport(u._scrollTop,t);else{var g,p,m=u.rowsHeightCollection,_=this.getRows(t),f=_[1],b=_[0];if(!this._isUndo||this._isTotalRow)for(n=i.rowIndex,o=f.length;n<o;n++){if(a=n+(r.rowIndex-i.rowIndex+1),d=this._getRowIdx(n),g=e(f[d]).find("td"),a<f.length)for(p=e(f[this._getRowIdx(a)]).find("td"),s=i.colIndex;s<=r.colIndex;s++)c.push(g[s].outerHTML),g[s].outerHTML=p[s].outerHTML,p[s].innerHTML="";f[d].style.height=m[n]+"px",b[d].style.height=m[n]+"px"}else{for(e.extend(!0,c,this._deletedText),n=f.length-1;n>=i.rowIndex;n--){if(a=n-(r.rowIndex-i.rowIndex+1),d=this._getRowIdx(n),g=e(f[d]).find("td"),a>=i.rowIndex)for(p=e(f[this._getRowIdx(a)]).find("td"),s=i.colIndex;s<=r.colIndex;s++)g[s].outerHTML=p[s].outerHTML,p[s].innerHTML="";f[d].style.height=m[n]+"px",b[d].style.height=m[n]+"px"}for(n=i.rowIndex;n<=r.rowIndex;n++)for(g=e(f[this._getRowIdx(n)]).find("td"),s=i.colIndex;s<=r.colIndex;s++)g[s].outerHTML=c.shift()}this._refreshRows(t)}this._isInsdel=!1,this.XLScroll._getRowHeights(t,i.rowIndex),this.performSelection(i,r),this.model.allowComments&&this._updateCommentColl(t),this.model.allowComments&&(this.XLComment._curCommentHCell=null),this._deletedText=c,this._isUndo?this._refreshAllMergeCells(t,i.rowIndex,l.rowCount,-1,0,"insert"):this._refreshAllMergeCells(t,i.rowIndex,l.rowCount,-1,0,"delete"),this._isUndoRedo||this._dupDetails||this._undoredoDetails(t,i,r,"delete","deleteShiftUp"),this.model.allowFormulaBar&&this.updateFormulaBar()},deleteEntireRow:function(t,i){var r,l,n;if(this.model.allowDelete&&!this.model.isReadOnly&&(l={startRow:t,endRow:i,sheetIndex:r=this.getActiveSheetIndex(),reqType:"delete",action:"deleteRow",type:"actionBegin"},!this._trigActionBegin(l))){var s,o,a,d,h,c=this.model.scrollSettings.allowVirtualScrolling,u=this.getSheet(r),g=u._selectedCells,p=g[0].colIndex,m=g[g.length-1].colIndex,_=u.rowsHeightCollection;if(t=l.startRow,i=l.endRow,this.model.isGridMode){if(i-t+1==u.rowCount||u.showHeader&&u.rowCount<3||1==(u.showHeader&&u.rowCount-(i-t+1)))return void this._showAlertDlg("Alert","GridModeRecordsCount",430);if(u.showHeader&&(0==t||0==i))return void this._showAlertDlg("Alert","GridModeDataHeader",430)}for(this._updateWrapCol("deleteEntireRow",g,u,r),this._isUndo?(this._insDelStatus="insert",d="insertRow"):(d="deleteRow",this._insDelStatus="delete"),x={startCol:0,colCount:u.colCount,startRow:t,rowCount:i-t+1,status:d,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},a=(h=this.getObjectKeys(this.getSheet(r).formulaRange)).length,n=0;n<a;n++){if(s=h[n],t==this.getRangeIndices(s)[2])return void this._showAlertDlg("Alert","ArrayaFormula",430);this.refreshArrayformulaInsDel(x,"row","delete",x.rowCount,x.startRow,s)}if(!this._isUndoRedo&&(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(r,t,x.rowCount,0,u.colCount,d)))return void this._showAlertDlg("Alert","InsertDeleteAlert",440);if(!this._isUndo&&this.XLShape&&this.XLShape._refreshChartdataInsDel(x,x.rowCount,x.startRow,r,!1),this._clearAllMergeCells(r,t,x.rowCount,-1,0,d),this._refreshDataContainer(r,x),this._isInsdel=!0,this._isUndo?this._batchAddRow(t,i,r,!0):this._batchDeleteRow(t,i,r),c||this.model.isGridMode)"normal"===this.model.scrollSettings.scrollMode&&(u.rowCount=this._isUndo?u.rowCount+x.rowCount:u.rowCount-x.rowCount),this.refreshContent(r);else{var f,b,C,S,x,v=[],w=this.getRows(r),I=w[1],y=w[0];if(this._isUndo){for(e.extend(!0,v,this._deletedText),o=t;o<=i;o++)b=this._getRowIdx(o),S=v.pop(),e(I[b]).before(S),C=this.XLScroll._rowHeaderTemplate(1,_[o]),e(y[b]).before(C),u.rowCount=u.rowCount+1;this._refreshRows(r)}else for(o=i;o>=t;o--)b=this._getRowIdx(o),v.push(I[b].outerHTML),e(I[b]).remove(),e(y[b]).remove(),u.rowCount=u.rowCount-1,this.XLScroll._createNewRow(r,-1,-1,"insert");for(o=0,a=(f=e(this.getRows(r)[0]).find("td")).length;o<a;o++)e(f[o]).text(o+1);this._refreshRows(r)}this._isInsdel=!1,this._isFrozen(u.frozenRows)&&(t<u._frozenRows||i<u._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv(),(this.model.isGridMode&&i==u.rowCount||u.showHeader&&u.rowCount<3)&&(t=i=u.rowCount-1),u._isRowSelected?this.XLSelection.selectRows(t,i):this.performSelection({rowIndex:t,colIndex:p},{rowIndex:i,colIndex:m}),this._deletedText=v,this.model.allowComments&&this._updateCommentColl(r),this._isUndo?this._refreshAllMergeCells(r,t,x.rowCount,-1,0,"insert"):this._refreshAllMergeCells(r,t,x.rowCount,-1,0,"delete"),this.model.allowFiltering&&this.XLFilter._updateFilterCollection(r,t,i-t,"row",this._insDelStatus),this.XLScroll._getRowHeights(r,t),this._isUndoRedo||this._dupDetails||this._undoredoDetails(r,{rowIndex:t,colIndex:0},{rowIndex:i,colIndex:u.colCount-1},"delete","deleteRow"),this.XLShape&&(this._isUndo?this.XLShape._refreshChartdataInsDel(x,x.rowCount,x.startRow,r):this.XLShape._refreshChartdataInsDel(x,x.rowCount,x.startRow,r,!0)),this._insDelStatus="",this.model.allowFormulaBar&&this.updateFormulaBar(),this.model.isGridMode&&this._setElemDimension()}},deleteEntireColumn:function(i,r){var l,n,s,o,a;if(this.model.allowDelete&&!this.model.isReadOnly&&!this.model.isGridMode&&(n={startCol:i,endCol:r,sheetIndex:l=this.getActiveSheetIndex(),reqType:"delete",action:"deleteColumn",type:"actionBegin"},!this._trigActionBegin(n))){var d,h,c,u,g,p,m,_,f,b,C,S=0,x=this.getFrozenColumns(),v=this.getSheet(l),w=this.getRows(l)[1],I=this._getContent(l).find("col"),y=this._getJSSheetHeader(l).find("col"),T=this._getJSSheetHeader(l).find("th"),L=v._selectedCells,R=L[0].rowIndex,O=L[L.length-1].rowIndex,F=[],E=this.XLScroll._colGroupTemplate(1),D=v.columnsWidthCollection,N=this.model.scrollSettings.allowVirtualScrolling,A=N?this._getContent(l).find("tbody").get(1):this._getContent(l).find("tbody").get(0);if(i=n.startCol,r=n.endCol,this._updateWrapCol("deleteEntireRow",L,v,l),this._isUndo?(_="insertColumn",this._insDelStatus="insert"):(_="deleteColumn",this._insDelStatus="delete"),!v._isTemplate||!(i<v._templateColCount||r<v._templateColCount)){for(f={startCol:i,colCount:r-i+1,startRow:0,rowCount:v.rowCount,status:_,prevCellTypes:this._cellTypesUndo,curCellTypes:this._cellTypesRedo,prevChartDetails:this._chartUndo,curChartDetails:this._chartRedo,prevValData:this._valDataUndo,curValData:this._valDataRedo},g=(m=this.getObjectKeys(this.getSheet(l).formulaRange)).length,s=0;s<g;s++){if(h=m[s],i==(d=this.getRangeIndices(h))[1]||i==d[3])return void this._showAlertDlg("Alert","ArrayaFormula",430);this.refreshArrayformulaInsDel(f,"column","delete",f.colCount,f.startCol,h)}if(!this._isUndoRedo&&(this.XLRibbon._isDirtySelect||this.model.allowFiltering&&this.XLFilter._checkFilterApplied(l,f.startRow,f.rowCount,0,v.colCount,_)))return void this._showAlertDlg("Alert","InsertDeleteAlert",440);if(this._clearAllMergeCells(l,-1,0,i,f.colCount,_),this._isUndo){for(F=e.extend(!0,F,this._deletedText),o=0,c=w.length-1;c>=0;c--){for(p=e(w[c]).find("td"),u=i;u<=r;u++)p.eq(u-o).before(F.pop()),o++;o=0}for(u=i;u<=r;u++)I.eq(u-o).before(F.pop()),T.eq(u-o).before("<th class='e-headercell'><div class='e-headercelldiv'></div></th>"),y.eq(u-o).before(F.pop()),o++;C=D.splice(0,i),t.merge(C,this._deletedDimension.reverse()),t.merge(C,D),v.columnsWidthCollection=C,this._deletedDimension=[],this.XLShape&&this.XLShape._refreshChartdataInsDel(f,f.colCount,f.startCol,l,!1)}else{if(this.XLShape&&this.XLShape._refreshChartdataInsDel(f,f.colCount,f.startCol,l,!1),this._deletedDimension=[],this._isFrozen(x)&&x>=i){for(c=v._frozenColumns-1;c<v._fleftColIdx;c++)S+=v.columnsWidthCollection[c];this._scrollContent({x:-S})}for(u=r;u>=i;u--)F.push(y[u].outerHTML),F.push(I[u].outerHTML),this._deletedDimension.push(D.splice(u,1)[0]),y.eq(u).remove(),I.eq(u).remove(),y.parent().append(E),I.parent().append(E),D.push(v.columnWidth);for(c=0,g=w.length;c<g;c++)for(p=e(w[c]).find("td"),u=r;u>=i;u--)b=this.XLScroll._columnTemplate(),e(w[c]).append(b),F.push(p[u].outerHTML),e(A.rows[c]).find("td:eq("+u+")").remove()}for(this.XLScroll._getColWidths(l,i),this._isFrozen(v.frozenColumns)&&(i<v._frozenColumns||r<v._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv(),this.model.allowFiltering&&this.XLFilter._updateFilterCollection(l,i,r-i,"column",this._insDelStatus),v.colCount=I.length,T=this._getJSSheetHeader(l).find("th"),this._refreshDataContainer(l,f),this._isInsdel=!0,c=0,g=T.length;c<g;c++)this._checkIndicesInContainer(l,0,c,"hCol")&&(a="e-hcol"),this._checkIndicesInContainer(l,0,c,"isCHide")&&(a+="e-hide"),this._removeClass(T[c],"e-hcol"),this._removeClass(T[c],"e-hide"),this.addClass(T[c],a),a="",e(T[c]).find("div").text(this._generateHeaderText(c+1));N&&this.refreshContent(l),this._isInsdel=!1,this._isUndo?this._refreshAllMergeCells(l,-1,0,i,f.colCount,"insert"):this._refreshAllMergeCells(l,-1,0,i,f.colCount,"delete"),this._deletedText=F,this.model.allowComments&&this._updateCommentColl(l),this._refreshRows(l),this.XLShape&&this.XLShape._refreshChartdataInsDel(f,f.colCount,f.startCol,l,!0),v._isColSelected?this.XLSelection.selectColumns(i,r):this.performSelection({rowIndex:R,colIndex:i},{rowIndex:O,colIndex:r}),this._isUndoRedo||this._undoredoDetails(l,{rowIndex:0,colIndex:i},{rowIndex:v.rowCount-1,colIndex:r},"delete","deleteColumn"),this._insDelStatus="",this.model.allowFormulaBar&&this.updateFormulaBar()}}},_getSelectedRange:function(e,t){for(var i,r,l=[],n=this.swapRange([e.rowIndex,e.colIndex,t.rowIndex,t.colIndex]),s=n[0],o=n[2];s<=o;){for(i=n[1],r=n[3];i<=r;)l.push({rowIndex:s,colIndex:i}),i++;s++}return l},performSelection:function(e,t){var i,r,l,n,s,o=this.getActiveSheetIndex(),a=this.getSheet(o),d=a._selectedCells;if("string"!=typeof e&&this.getObjectLength(e)||(e={rowIndex:(i=this._getRangeArgs(e,"object"))[0],colIndex:i[1]},t={rowIndex:i[2],colIndex:i[3]}),JSON.stringify(e)===JSON.stringify(d[0])&&JSON.stringify(t)==JSON.stringify(d[d.length-1]))return a._startCell=e,a._endCell=t,this.model.allowSelection&&this.XLSelection._refreshBorder(),void this._updateContextualTab(o);this.setActiveCell(e.rowIndex,e.colIndex),this.model.allowSelection&&(r=this.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"merge"),l=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"merge"),r&&(e={rowIndex:(n=this.getRangeIndices(r.mRange))[0],colIndex:n[1]}),l&&(t={rowIndex:(s=this.getRangeIndices(l.mRange))[2],colIndex:s[3]}),this.XLSelection.selectRange(e,t)),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement(),a._startCell=e,a._endCell=t,this._updateContextualTab(o)},_updateContextualTab:function(t){var i,r,l,n=this.getSheet(t)._startCell;this.model.showRibbon&&!this._isScrolling&&(this.XLRibbon._updateRibbonIcons(),i=this.XLEdit.getPropertyValue(n.rowIndex,n.colIndex,"tableName",t),l=e("#"+this._id+"_Ribbon").data("ejRibbon"),i?(r=this._getTableID(i),this.isNumber(r)&&this.XLRibbon._designTabUpdate(r,n)):this.model.showRibbon&&((l.model.selectedItemIndex===this.XLRibbon._getTabIndex("design")||l.isVisible(this._getLocStr("Design")))&&this.XLRibbon._toggleDesignTab(n),(l.model.selectedItemIndex===this.XLRibbon._getTabIndex("format")||l.isVisible(this._getLocStr("FORMAT")))&&this.XLRibbon._toggleFormatTab(n),(l.model.selectedItemIndex===this.XLRibbon._getTabIndex("chartdesign")||l.isVisible(this._getLocStr("CHARTDESIGN")))&&this.XLRibbon._toggleChartDesignTab(n),(l.model.selectedItemIndex===this.XLRibbon._getTabIndex("analyze")||l.isVisible(this._getLocStr("ANALYZE")))&&this.XLRibbon._toggleAnalyzeTab(n),(this.model.allowSparkline&&l.model.selectedItemIndex===this.XLRibbon._getTabIndex("sparklinedesign")||l.isVisible(this._getLocStr("SPARKLINEDESIGN")))&&this.XLSparkline._toggleSparklineDesignTab(n)))},_checkRowCol:function(e,i){if(0!==e&&0!==i)return t.isNullOrUndefined(i)&&(i=e),{start:e,end:i}},hideRow:function(e,t){if(!this.model.isGridMode){var i=this._checkRowCol(e,t);this._hideRow(i.start-1,i.end-1,"isRHide")}},showRow:function(e,t){if(!this.model.isGridMode){var i=this._checkRowCol(e,t);this._showRow(i.start,i.end,"isRHide")}},hideColumn:function(e,t){if(!this.model.isGridMode){var i=this._checkRowCol(e,t);this._hideColumn(i.start-1,i.end-1)}},showColumn:function(e,t){if(!this.model.isGridMode){var i=this._checkRowCol(e,t);this._showColumn(i.start,i.end)}},_hideRow:function(e,i,r,l){var n,s,o=this.getActiveSheetIndex(),a=this.getSheet(o),d=this.getRows(o),h=d[1],c=d[0],u=this.model.scrollSettings,g=u.allowVirtualScrolling,p=a.hideRowsCollection,m=[];for(this._isUndoRedo||l||(this.XLEdit._updateDataContainer({rowIndex:e?e-1:e,colIndex:0},{dataObj:{hRow:!0}}),g||this.addClass(this._getJSSheetRowHeaderContent(o).find(".e-rowheader")[e?e-1:e],"e-hrow")),n=e;n<=i;n++)"isRHide"===r&&this.XLEdit._updateDataContainer({rowIndex:n,colIndex:0},{dataObj:{isRHide:!0}}),m.push(n),-1===p.indexOf(n)&&(p.push(n),g||(this._isRowViewable(o,n)&&(this.addClass(h[n],"e-r-hide"),this.addClass(c[n],"e-r-hide")),u.allowScrolling&&u.scrollMode===t.Spreadsheet.scrollMode.Infinite&&(!a._isImported||a._isLoaded)&&(this._isFilter?(a.rowsHeightCollection.push(this.model.rowHeight),this._hideRowColl.push(a.rowCount++)):this.XLScroll._createNewRow(o,-1,-1,"insert"))),this.XLShape&&this.XLShape._refreshShapePosOnResize(n,0,!1,o));this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(e,i,!0,!0),this._isFilter||this.XLScroll._getRowHeights(o,e),this._showHideRows(o,a,m,e,i,g,"hide"),a._isImported&&!a._isLoaded||this._isFilter||this._isExport||(this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this._isFrozen(a.frozenRows)&&(e<a._frozenRows||i<a._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv(),this.model.scrollSettings.allowScrolling&&!g&&this.XLScroll._refreshScroller(o,"refresh","vertical"),this._isUndoRedo||l||(a._activeCell.rowIndex=i+1,s={sheetIndex:o,reqType:"show-hide",action:"hide",operation:"row",bSelect:{startRow:e,endRow:i},aSelect:{startRow:i+1,endRow:i+1},addBRows:e?[e-1]:[e],remBRows:[],hideRows:m},this._completeAction(s),this._trigActionComplete(s))),l||this._isFilter||(this.XLSelection.selectRow(i+1,o),this.model.allowAutoFill&&this.XLDragFill.hideAutoFillElement())},_showRow:function(i,r,l,n,s,o,a){for(var d,h,c,u=this.getActiveSheetIndex(),g=!1,p=this._isUndoRedo?i:i-1>0?i-1:0,m=p,_=this.getSheet(u),f=this.getRows(u),b=f[1],C=f[0],S=[],x=[],v=_.rowsHeightCollection,w=_.hideRowsCollection,I=t.buildTag("table#wrapTable.e-table",{}),y=this._dataContainer.sheets[u],T=this.model.scrollSettings.allowVirtualScrolling;m<=r;){if(w.indexOf(m)>-1){g=!0;break}m++}if(!g)return!1;for(s=s||this.getSheetElement(u)[0].querySelectorAll(".e-spreadsheetcolumnheader"),o=o||e(this._getJSSheetHeader(u)[0].querySelectorAll("colgroup")[0].outerHTML).attr("id","ss"),a=a||this.getSheetElement(u)[0].querySelectorAll(".e-rowheadercontent td"),T||(I.append(o),this.element[0].insertBefore(I[0],this.element[0].childNodes[0])),this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(i,r,!0),m=p;m<=r;m++)(d=w.indexOf(m))>-1&&("isRHide"===l&&delete y[m][0].isRHide,S.push(m),w.splice(d,1),T||(this._removeClass(b[m],"e-r-hide"),this._removeClass(C[m],"e-r-hide")),!this._isUndoRedo&&m>0&&!n?(x.push(m-1),delete y[m-1][0].hRow,T||this._removeClass(a[m-1],"e-hrow")):0!==m||n||(delete y[0][0].hRow,T||(s.height(20.5),this._removeClass(s[0],"e-hrow"))),this.XLShape&&this.XLShape._refreshShapePosOnResize(m,2*v[m],!1,u)),T||(this._setWrapHeight(u,m,b,C,I,"visible"),I.remove()),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement();this._isFilter||this.XLScroll._getRowHeights(u,p),this._showHideRows(u,_,S,i,r,T,"show"),n||_._isImported&&!_._isLoaded||this._isUndoRedo||this._isFilter||(i<r?(this.setActiveCell(i,0),this.XLSelection.selectRows(i,r,u),h={startRow:i,endRow:r}):i>0&&(this.setActiveCell(i-1,0),this.XLSelection.selectRow(i-1,u),h={startRow:i-1,endRow:i-1}),this.XLDragFill.positionAutoFillElement(),c={sheetIndex:u,reqType:"show-hide",action:"show",operation:"row",bSelect:{startRow:i,endRow:r},aSelect:h,addBRows:[],remBRows:x,hideRows:S},this._completeAction(c),this._trigActionComplete(c)),this._isFrozen(_.frozenRows)&&(i<_._frozenRows||r<_._frozenRows)&&this.XLFreeze._refreshFreezeRowDiv(),this._isFilter||((!_._isImported||_._isLoaded)&&this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(u,"refresh","vertical"))},_showHideRows:function(e,t,i,r,l,n,s){n&&("show"===s&&this.refreshContent(e),this._refreshViewport(this._isFrozen(t.frozenRows)?t._contScrollTop:t._scrollTop,e)),this._refreshSHMergeCells(e,i,l-r+1,"row",s),n&&"hide"===s&&this.refreshContent(e),t.selectedRange[0]<r&&t.selectedRange[2]>l&&(this.model.allowSelection&&this.XLSelection.selectRange(t._activeCell,t._activeCell),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement())},_colgroupRefresh:function(t){var i,r,l,n;this.model.allowResizing&&(i=this._getJSSheetHeader(t).find("colgroup"),r=this._getContent(t).find("colgroup")),l=e(i).clone(),n=e(r).clone(),e(r).remove(),e(i).remove(),e(l).prependTo(this._getJSSheetHeader(t).find(".e-table")),e(n).prependTo(this._getContent(t).find(".e-table"))},_updateFilterIcon:function(e,i,r){t.isNullOrUndefined(r)&&(r=this.getActiveSheetIndex());for(var l,n,s=this.getSheet(r).filterSettings.tableRange,o=0,a=s.length;o<a;o++)e>=(n=s[o].multifilterIdx)[0]&&e<=n[n.length-1]&&(l=s[o].startRow-1,this._isRowViewable(r,l)&&("hide"===i?this.addClass(this.getCell(l,e).find(".e-filterspan")[0],"e-hide"):this._removeClass(this.getCell(l,e).find(".e-filterspan")[0],"e-hide")),this.XLEdit._updateDataContainer({rowIndex:l,colIndex:e},{dataObj:{isFilterVisible:"hide"!=i}}))},_hideColumn:function(e,i){for(var r,l,n,s,o,a,d=!1,h=this.getActiveSheetIndex(),c=this._getJSSheetHeader(h).find("th"),u=this._getJSSheetHeader(h).find("col"),g=this.getSheet(h),p=g.hideColsCollection,m=[],_=[],f=this._getContent(h).find("col"),b=g._filterColl,C=g.columnsWidthCollection,S=this.element.find(".e-spreadsheetcolumnheader"),x=e;x<=i;x++)if(this._getContent(h).find(".e-rowcell:nth-child("+(x+1)+")").addClass("e-soverflow"),o=this.XLEdit.getPropertyValue(0,x,"isCHide"),this._isColumnViewable(h,x)&&(d=!0),t.isNullOrUndefined(o))for(this.XLShape&&this.XLShape._refreshShapePosOnResize(x,0,!0,h),this.XLEdit._updateDataContainer({rowIndex:0,colIndex:x},{dataObj:{isCHide:!0}}),this._writeRule(x,h),d&&(this.addClass(c[x],"e-hide"),this.addClass(u[x],"e-hide"),this.addClass(f[x],"e-hide")),m.push(x),p[x]=C[x],C[x]=0,r=0,l=(s=this.getObjectKeys(b)).length;r<l;r++)t.isNullOrUndefined(b[s[r]])||t.isNullOrUndefined(this.XLEdit.getPropertyValue(s[r],x,"isSpanHide"))&&this.XLEdit._updateDataContainer({rowIndex:s[r],colIndex:x},{dataObj:{isSpanHide:!0}});this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(e,i,!1,!0),this._isUndoRedo||(e?_.push(e-1):_.push(e),this._isColumnViewable(h,e)&&(0===e?(S.width(28),this.addClass(S[h-1],"e-hfcol"),this.XLEdit._updateDataContainer({rowIndex:0,colIndex:0},{dataObj:{hCol:!0}})):(this.XLEdit._updateDataContainer({rowIndex:0,colIndex:e-1},{dataObj:{hCol:!0}}),this.addClass(this._getJSSheetHeader(h).find("th:eq("+(e-1)+")")[0],"e-hcol")))),this._refreshSHMergeCells(h,m,i-e+1,"column","hide"),this.XLScroll._getColWidths(h,e),this._isFrozen(g.frozenColumns)&&(this.XLScroll._refreshContHgt(h),(e<g._frozenColumns||i<g._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv()),this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(h,"refresh","horizontal"),!g._isImported||g._isLoaded?(C.length-1===i?(this.XLSelection.selectColumn(i-1,h),this.setActiveCell(0,i-1),n={startCol:i-1,endCol:i-1}):(n={startCol:i+1,endCol:i+1},this.setActiveCell(0,i+1),this.XLSelection.selectColumn(i+1,h)),this.XLDragFill&&this.XLDragFill.positionAutoFillElement(),this._isUndoRedo||(a={sheetIndex:h,reqType:"show-hide",action:"hide",operation:"column",bSelect:{startCol:e,endCol:i},aSelect:n,hideCols:m,addBCols:_,remBCols:[]},this._completeAction(a),this._trigActionComplete(a)),this.model.allowComments&&this.XLComment._updateCmntArrowPos()):this.setActiveCell(0,0),this._browserDetails.name.indexOf("msie")>-1&&this._colgroupRefresh(h)},_showColumn:function(e,t){var i,r,l,n=this.getActiveSheetIndex(),s=this._isUndoRedo?e:e-1>0?e-1:0,o=this.getSheet(n),a=o.hideColsCollection,d=[],h=!1,c=[],u=this._getJSSheetHeader(n).find("th"),g=this._getContent(n).find("col"),p=this._getJSSheetHeader(n).find("col"),m=o.columnsWidthCollection,_=this.element.find(".e-spreadsheetcolumnheader");for(this.model.allowCellFormatting&&this.XLFormat._refreshHiddenBorder(e,t),i=s;i<=t;i++)this._getContent(n).find(".e-rowcell:nth-child("+(i+1)+")").removeClass("e-soverflow"),i in a&&(this._deleteRule(i,n),this._isColumnViewable(n,i)&&(h=!0),h&&(this._removeClass(u[i],"e-hide"),this._removeClass(p[i],"e-hide"),this._removeClass(g[i],"e-hide"),g[i].style.width=a[i]+"px",p[i].style.width=a[i]+"px"),m[i]=a[i],delete a[i],delete this._dataContainer.sheets[n][0][i].isCHide,this.model.allowFiltering&&this._updateFilterIcon(i,"show",n),d.push(i),!this._isUndoRedo&&i>0?(h&&this._removeClass(u.get(i-1),"e-hcol"),delete this._dataContainer.sheets[n][0][i-1].hCol,c.push(i-1)):0===i&&(_.width(29),this._removeClass(_[n-1],"e-hfcol"),delete this._dataContainer.sheets[n][0][0].hCol),this.XLShape&&this.XLShape._refreshShapePosOnResize(i,2*m[i],!0,n));this._refreshSHMergeCells(n,d,t-e+1,"column","show"),this.XLScroll._getColWidths(n,s),this._isUndoRedo||o._isImported&&!o._isLoaded||(e<t?(this.XLSelection.selectColumns(e,t,n),r={startCol:e,endCol:t}):(this.XLSelection.selectColumn(s,n),r={startCol:s,endCol:s}),this.XLDragFill&&this.XLDragFill.positionAutoFillElement(),l={sheetIndex:n,reqType:"show-hide",action:"show",operation:"column",bSelect:{startCol:e,endCol:t},aSelect:r,addBCols:[],remBCols:c,hideCols:d},this._completeAction(l),this._trigActionComplete(l)),this._browserDetails.name.indexOf("msie")>-1&&this._colgroupRefresh(n),(!o._isImported||o._isLoaded)&&this.model.allowComments&&this.XLComment._updateCmntArrowPos(),this._isFrozen(o.frozenColumns)&&(e<o._frozenColumns||t<o._frozenColumns)&&this.XLFreeze._refreshFreezeColDiv(),this.model.scrollSettings.allowScrolling&&this.XLScroll._refreshScroller(n,"refresh","horizontal")},_refreshHideRowColCollection:function(e,t,i,r,l){var n,s;if("row"===r){for(s=0;s<e.length;s++)if(e[s]>=t+i){"insert"===l?e[s]+=i:e[s]-=i;break}}else for(s=(n=this.getObjectKeys(e)).length-1;s>=0;s--)if(n[s]>=t+i){"insert"===l?(e[parseInt(n[s])+i]=e[n[s]],delete e[n[s]]):(e[parseInt(n[s])-i]=e[n[s]],delete e[n[s]]);break}},_destroySheet:function(e){this.element.find("#"+this._id+"_"+this.model.sheets[e].sheetInfo.value).empty()},_destroy:function(){var t,i,r=1;if(this.isImport||this.model.isImport||this._isNew){for(;r<=this.model.sheetCount;)delete e.templates[this._id+"JSONTemplate"+r],delete e.templates[this._id+"JSONRowHdrTemplate"+r],t=this.getSheet(r).sheetInfo.value,CalcEngine.unregisterGridAsSheet(t,t),r++;if(this.model.sheets=[],this.model.nameManager=[],this._sheets=[],this.getActivationPanel().empty(),this.model.enablePivotTable&&(this.XLPivot._hasPvtField=!1),this.isDirty=!1,this.isImport||this.model.isImport){if(this._detachTable=null,this._updateFormulaCollection(),this.XLFormat._isHeaderAdded){for(r=0;r<2;r++)e("#"+this._id+"_cellstyles").children().eq(0).remove();this.XLFormat._isHeaderAdded=!1}}else document.getElementById(this._id+"_nmgrid")&&e("#"+this._id+"_nmgrid").ejGrid("option",{dataSource:[]}),this._dataContainer={sheets:{},hashCode:[],sharedData:[],cellType:[],valData:[],cFormatData:[],customCellStyle:{}},this.XLRibbon._updateUseInFormulaTrgt(),this.XLEdit._refreshAutoComplete();this.element.append([this.getFocusTopElem(),this.getFocusRightElem(),this.getFocusBottomElem(),this.getFocusLeftElem(),this.getAutoFillElem(),this._getAutoFillOptElem()]),this.element.find(".e-spreadsheet-list .e-sheet").remove(),document.getElementById(this._id+"ddl")&&e("#"+this._id+"ddl").data("ejDropDownList").destroy(),e("#"+this._id+"ddl").remove(),this._tableCnt=this._newSIndex=1,this.XLChart&&(this.XLChart._shapeCnt=1),CalcEngine._tokenCount=0,this._isVPRendered=!1}else this._wireEvents("_off"),this._destroySubControls(),this.element.empty(),this.element.css({height:"",width:"","min-height":"","min-width":""}),this.element.removeAttr("tabindex"),this.element.removeEleEmptyAttrs(),this._removeClass(this.element[0],"e-spreadsheet e-js"),this.model.cssClass.length&&this._removeClass(this.element[0],this.model.cssClass),e("#"+this._id+" _formatastable").parent().remove(),e("#"+this._id+" _cellstyles").parent().remove(),e("#"+this._id+"_Ribbon_Home_Font_BorderColor_popup").remove();this._isRefresh||(e("#"+this._id+"_sscustomformat").remove(),document.getElementById(this._id+"_sshide")&&(document.getElementById(this._id+"_sshide").outerHTML=""),(i=this.getCalcEngine()).getFormulaInfoTable().clear(),i.getDependentCells().clear(),i.getDependentFormulaCells().clear(),i.getNamedRanges().clear(),i.getDependentNamedRangeCells().clear(),this._tableFormulaCollection={},this._tableRangesFormula={}),this._isRibbonDestroyed=!0},_destroySubControls:function(){var t,i,r,l,n,s,o=this._id;if((i=e("span.e-"+o+"-ddl input.e-dropdownlist")).length)for(l=0,n=i.length;l<n;l++)(r=e(i[l]).data("ejDropDownList"))&&r.destroy();if(this.model.allowFiltering){(s=e(".e-"+this._id+"_customddl")).length&&s.ejDropDownList("destroy").remove();var a=e("#"+this._id+"_filter_custom_string_acString"),d=e("#"+this._id+"_filter_custom_number_acString"),h=e("#"+this._id+"_filter_custom_date_acString");a.length&&a.ejAutocomplete("destroy").remove(),d.length&&d.ejNumericTextbox("destroy").remove(),h.length&&h.ejDatePicker("destroy").remove()}e("#"+this._id+"_colordlg_cpicker").ejColorPicker("destroy").remove(),this.model.showRibbon&&(this.XLRibbon&&this.XLRibbon._rbnDestroy({destroy:!0}),e(".e-"+this._id+"-spltbtn").ejSplitButton("destroy"),e("#"+this._id+"_Ribbon").ejRibbon("destroy")),document.getElementById(this._id+"_nmgrid")&&e("#"+this._id+"_nmgrid").ejGrid("destroy"),(t=e(".e-"+o+"-dlg")).length&&t.remove(),this.model.allowFormulaBar&&e("#"+this._id+"_inputbox").ejAutocomplete("destroy"),e("#"+this._id+"_AutoComplete").ejAutocomplete("destroy"),this.model.allowAutoFill&&e("#"+this._id+"_dragfilloptionbtn").ejSplitButton("destroy"),this.model.enableContextMenu&&(e("#"+this._id+"_contextMenuCell").ejMenu("destroy").remove(),e("#"+this._id+"_contextMenuColumnHeader").ejMenu("destroy").remove(),e("#"+this._id+"_contextMenuRowHeader").ejMenu("destroy").remove(),e("#"+this._id+"_contextMenuFooter").ejMenu("destroy").remove(),e(".e-"+o+"-cmenu").remove()),this.model.allowFiltering&&(this._excelFilter&&this._excelFilter.resetExcelFilter(),e("#"+this._id+"number_excelDlg").remove(),e("#"+this._id+"string_excelDlg").remove(),e("#"+this._id+"date_excelDlg").remove()),e("#"+this._id+"_copyPaste").remove(),e("#"+this._id+"_wait").ejWaitingPopup("destroy"),e("#"+this._id+"_wait").remove(),this.XLRibbon._isAppTabCreate=!1,this.XLRibbon._isHomeTabCreate=!1,this.XLRibbon._isInsertTabCreate=!1,this.XLRibbon._isDataTabCreate=!1,this.XLRibbon._isPageLayoutTabCreate=!1,this.XLRibbon._isReviewTabCreate=!1,this.XLRibbon._isOthersTabCreate=!1,this.XLRibbon._isDesignTabCreate=!1,this.XLRibbon._isFormatTabCreate=!1,this.XLRibbon._isChartTabCreate=!1,this.XLRibbon._analyzeTabCreate=!1,this.XLRibbon._isHomeTabTrgt=!1,this.XLRibbon._isInsertTabTrgt=!1,this.XLRibbon._isDataTabTrgt=!1,this.XLRibbon._isPageLayoutTabTrgt=!1,this.XLRibbon._isOthersTabTrgt=!1,this.XLRibbon._isChartTabTrgt=!1,this.XLRibbon._analyzeTabTrgt=!1,this.XLRibbon._isFormatTabTrgt=!1,this.XLRibbon._isDesignTabTrgt=!1,this._focusTopElem=null,this._focusRightElem=null,this._focusBottomElem=null,this._focusLeftElem=null,this._autoFillElem=null,this._autoFillOptElem=null},_getXYPos:function(e,t,i,r){var l=this.element.offset().top,n=this.element.offset().left,s=t.height(),o=t.width(),a=e.offset().left-n,d=e.offset().top-l;return d+i+s>this._responsiveHeight?d=d-(d+i+s-this._responsiveHeight)+(l-6):d+=l,d<l&&(d+=l-d),a+r+o>this._responsiveWidth?a=a-(a+r+o-this._responsiveWidth)+(n-6):a+=n+r,a<n&&(a+=n-a),{xPos:a,yPos:d}},getValueRowCol:function(e,t,i){var r,l,n,s;return e=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+e),l=this.getSheet(e),n=this.getRangeData({range:[t-1,i-1,t-1,i-1],property:["value","type","customFormat"],sheetIdx:e})[0],-1==e?"#REF!":(l._isImported&&!l._isRequested&&(this._intrnlReq=!0,this._importSheet(e,!1)),r=n.value,"en-US"!=this.model.locale&&!this.isFormula(r)&&this.isNumber(r)&&(r=this._getlocaleNumVal(r,!0)),(this.isFormula(r)||"shortdate"==n.type||"longdate"==n.type||"date"==n.type||"time"==n.type)&&(r=(r=this.XLEdit.getPropertyValue(t-1,i-1,"value2",e)).replace(this._currencySymbol,""),"time"==n.type&&(r="1/1/1990 "+r),("%"==r[0]||"%"==r[r.length-1])&&(r=r.split("%").join(""),s=parseFloat(r),isNaN(s)||(r=(s/100).toString())),r=r.replace(this._percentSymbol,"")),n.customFormat&&r.toString().indexOf("(")>-1&&(r="currency"==n.type?n.customFormat.indexOf(")")>-1?"-"+r.split(/[()$]/g)[2]:"-"+r.split("$")[1]:n.customFormat.indexOf(")")>-1?"-"+r.split(/[(\)]/)[1]:+r),r)},setValueRowCol:function(e,i,r,l){var n;if(l--,-2!==--r||-2!==l){var s,o,a,d,h,c,u,g,p,m,_={rowIndex:r,colIndex:l},f=!1,b=!0,C=!1;if("string"==typeof i&&(i=i.replace(/^\"|\"$/g,"")),"object"==typeof i&&(i=i.toString()),e=this._getSheetIdxFromSheetValue(this._getLocStr("Sheet")+e),o=this.getRangeData({range:[r,l,r,l],property:["value","formatStr","type","thousandSeparator","decimalPlaces","customFormat"],sheetIdx:e})[0],!t.isNullOrUndefined(o.value))for(g=0,p=(c=this.XLDragFill._parseFormula(o.value)).length;g<p;g++)if((u=c[g]).indexOf(":")>-1&&(u=u.split(":")[0]),this._isCellReference(u)){u=u.replace(/\$/g,""),"text"==this.getRangeData({range:this.getRangeIndices(u),property:["type"]})[0].type&&(b=!1);break}m=this.XLEdit._parseValue(i,{rowIndex:r,colIndex:l}),b&&o.formatStr&&!this._isFormulaError(i)&&(i=isNaN(parseInt(i))&&!isNaN(Date.parse(i))?new Date(i):m.value,a=this.XLFormat._format(i,{formatStr:o.formatStr,type:o.type,thousandSeparator:o.thousandSeparator,decimalPlaces:o.decimalPlaces})),b&&"fraction"==o.type&&(a=this.XLFormat._format(i,{type:o.type})),a=t.isNullOrUndefined(a)?i:a,!this._isInitLoad||this.isImport||this.model.isImport||(f=!0),d={value2:a,calcValue:m.value},t.isNullOrUndefined(o.value)||"DATE"==(c=this.XLDragFill._parseFormula(o.value)[0])&&(d.type=m.type),o.type&&(d.type=o.type),h={isRefCells:!0,calcValue:d.calcValue,value:o.value,rowIndex:r,colIndex:l},(this._saveTriggered||this._isInitLoad||this.isImport||this.model.isImport||!this._trigger("cellSave",h))&&(this._isInitLoad||this.isImport||this.model.isImport||this.getSheet(e)._isLoaded||(s=this.XLEdit.getPropertyValue(r,l,"tableName",e),!this.XLFormat._isFAT&&s&&(n=this.XLEdit.getPropertyValue(r,l,"value2",e),d.value2=this.XLFormat._updateTableColName(r,l,n,d.value2,e,s))),"(#,##0);#,##0"==o.customFormat&&d.value2.indexOf("-")>-1&&(C=!0),o.customFormat&&(d.value2=o.customFormat.indexOf(")")>-1&&!C&&"number"==o.type?"("+(d.value2.indexOf("-")>-1?d.value2.split("-")[1]:d.value2)+")":d.value2.indexOf("-")>-1?d.value2.split("-")[1]:d.value2),this.XLEdit._updateDataContainer(_,{dataObj:d,sheetIdx:e,skipCell:f}),this.XLEdit._refreshCellAlignment({cellIdx:_,value:i,type:o.type}))}},getActiveCellElem:function(e){e=this._getSheetIndex(e);var t=this.getSheet(e);return this.getCell(t._activeCell.rowIndex,t._activeCell.colIndex,e)},_pushHighlightData:function(e){for(var t,i,r,l=e[0],n=this._dataContainer.valData,s=0;s<n.length;s++){for(r="list"==n[s].split("_")[1]?n[s].split("_")[3]:n[s].split("_")[6],t=this.getRangeIndices(r);e[0]<=e[2];){for(i=e[1];i<=e[3];i++)this.inRange(t,e[0],i)&&-1==this.XLClipboard._highLightRange.indexOf(r)&&this.XLClipboard._highLightRange.push(r);e[0]++}e[0]=l}},_highlightValidationRng:function(e,t,i,r,l,n){e[6]=this.getAlphaRange(i,r,l,n),this._dataContainer.valData[t]=e.join("_")},_hlDlgOpen:function(){var t,i=this.getActiveSheetIndex(),r=this.getActiveCellElem(i);if(!r.length||!this.model.allowEditing)return!1;if(this.XLEdit._rangeHasProperty(this.getSheet(i).selectedRange,"cellType"))this._showAlertDlg("Alert","CellTypeAlert","CellTypeAlert",372);else{var l,n,s,o,a=this._id,d=e("#"+a+"_Ribbon_webAddress"),h=e("#"+a+"_Ribbon_cellAddress"),c=e("#"+a+"_Ribbon_findText"),u=this.XLEdit.getPropertyValue(r.parent("tr").index(),r[0].cellIndex,"hyperlink",i),g=e("#"+a+"_Ribbon_cellText");e("#"+a+"_HLDialog").ejDialog("open"),this._responsiveHeight<365&&e("#"+this._id+"_HLDialog_wrapper").css("top","0px"),(o=e("#"+a+"_Ribbon_sheentName").data("ejTreeView")).option("fields",{dataSource:this.XLRibbon._sheetData()}),l=e("#"+a+"_HLDialogTab").data("ejTab"),g.attr("disabled",!1),c.attr("disabled",!1),this.isUndefined(u)?0===l.model.selectedItemIndex?(d.val("http://"),g.val("")):(o.selectNode(i+1),g.val(o.getText(i+1)+"!A1"),h.val("A1")):(this.isUndefined(u.webAddr)?l.option({selectedItemIndex:1}):l.option({selectedItemIndex:0}),this.isUndefined(u.cellAddr)?(d.val(u.webAddr),h.val("A1")):(h.val(u.cellAddr.split("_")[0]),s=parseInt(u.cellAddr.split("_")[1])+1,o.selectNode(s),d.val("http://"))),e.validator&&(e("#"+a+"_Form_Ribbon_cellAddress").validate().resetForm(),e("#"+a+"_Form_Ribbon_webAddress").validate().resetForm()),c.val(""),n=this.XLEdit.getPropertyValueByElem(r),this.isUndefined(n)||(t=this.XLEdit.getPropertyValueByElem(r,"type"),this.isFormula(n)||t&&t.indexOf("date")>-1||e.isNumeric(n)||t&&t.indexOf("time")>-1?(g.val(this._getLocStr("HyperLinkHide")),c.val(this._getLocStr("HyperLinkHide")),g.attr("disabled",!0),c.attr("disabled",!0)):(g.val(n),c.val(n)))}},_setLink:function(i){var r,l,n,s,o,a,d,h,c,u,g,p=this.getActiveSheetIndex(),m=this.getActiveCell(p);o=this.getSheet(p).selectedRange,e("#"+this._id+"_HLDialog").length||this.XLRibbon._initHLDialog(),g=e("#"+this._id+"_HLDialogTab").ejTab("option","selectedItemIndex"),r=e("#"+this._id+"_Ribbon_cellText").val(),l=e("#"+this._id+"_Ribbon_cellAddress").val(),n=e("#"+this._id+"_Ribbon_findText").val(),s=e("#"+this._id+"_Ribbon_webAddress").val(),d=e("#"+this._id+"_Ribbon_sheentName").data("ejTreeView"),a=this._getSheetIndexByName(d.getSelectedNode().text()||this._getSheetNames()[this.getActiveSheetIndex()-1].text),r.length||n.length||(r=d.getSelectedNode().text()+"!"+l,n=s),u=this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex),this._prevText=t.isNullOrUndefined(u)?"":this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"value2"),this._prevVal=t.isNullOrUndefined(u)?"":this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"value"),c=this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"type")&&(this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"type").indexOf("date")>-1||this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"type").indexOf("time")>-1)?this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"value2"):e.isNumeric(u)||this.isFormula(u)?u:0===g?n:r,this._isUndoRedo&&(c=i[0].prevText),this._dupDetails=!0,this.XLEdit._updateCellValue(m,c),this._dupDetails=!1,(this.isFormula(c)||e.isNumeric(c))&&(c=this.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"value2")),h=0===g?{webAddr:s,text:c}:{cellAddr:l,text:c},this.setHyperlink(this._getAlphaRange(p,o[0],o[1],o[2],o[3]),h,a,i),this._dlgHLClick=!1},_getRangeArgs:function(e,i,r){return t.isNullOrUndefined(e)&&(e=this.getSheet(r).selectedRange),e.indexOf("!")>-1&&(3==e.split("!").length?e=(e=e.split("!"))[1].split(":")[0].replace(/\$/g,"")+":"+e[2]:e=e.split("!")[1].replace(/\$/g,"")),i===typeof e?e:"object"==typeof e?this._getAlphaRange(this.getActiveSheetIndex(),e[0],e[1],e[2],e[3]):this.getRangeIndices(e)},setHyperlink:function(i,r,l,n){var s;if((!this.model.isGridMode||!(l>1))&&(i=this._getRangeArgs(i,"string"),this.model.allowHyperlink&&!this.model.isReadOnly)){if(s={range:i,address:r.webAddr,text:r.text,sheetIndex:l,reqType:"hyperlink",action:"add",type:"actionBegin"},this.XLEdit._rangeHasProperty(i,"cellType"))return void this._showAlertDlg("Alert","CellTypeAlert","CellTypeAlert",372);if(this._trigActionBegin(s))return;i=s.range,r.webAddr=s.address,r.text=s.text,l=s.sheetIndex;var o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w=this.getActiveSheetIndex(),I=this.getSheet(w),y=[],T=this._getAlphaRangeCells(i),L={sheetIndex:this.getActiveSheetIndex(),reqType:"hyperlink"};if(g=this._getRangeArgs(i,"object"),p=this._getSelectedCells(L.sheetIndex,g).selCells,L.action=t.isNullOrUndefined(this.XLEdit.getPropertyValue(p[0].rowIndex,p[0].colIndex,"hyperlink"))?"add":"edit",this._isUndoRedo)for(C=0,S=p.length;C<S;C++)!n||t.isNullOrUndefined(n[C])||t.isNullOrUndefined(n[C].prevLink)||(this.XLEdit._updateDataContainer({rowIndex:p[C].rowIndex,colIndex:p[C].colIndex},{dataObj:{hyperlink:n[C].prevLink}}),this._isRowViewable(l,p[C].rowIndex)&&(x=e(T[C]).text(),e(T[C]).find("a").remove(),T[C].lastChild?T[C].lastChild.textContent="":e(T[C]).text(""),0===C?t.isNullOrUndefined(this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"hyperlink").cellAddr)?e(T[C]).append(t.buildTag("a",n[C].prevText,"",{href:this.XLEdit.getPropertyValueByElem(e(T[C]),"hyperlink").webAddr,target:"_blank"})):e(T[C]).append(t.buildTag("a",n[C].prevText,"")):t.isNullOrUndefined(this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"hyperlink").cellAddr)?e(T[C]).append(t.buildTag("a",x,"",{href:this.XLEdit.getPropertyValueByElem(e(T[C]),"hyperlink").webAddr,target:"_blank"})):e(T[C]).append(t.buildTag("a",x,"")),e(T[C]).find("a").addClass("e-hyperlinks")),this._dupDetails=!0,this.XLFormat.format({style:{color:this._hlColor}}),this._dupDetails=!1);else{for(t.isNullOrUndefined(r.webAddr)?(a=r.cellAddr,o=t.isNullOrUndefined(r.text)?this.XLEdit.getPropertyValue(p[0].rowIndex,p[0].colIndex,"value2"):r.text,a.indexOf("!")>-1&&(l=(m=a.split("!"))[0].indexOf("=")>-1?this._getSheetIndexByName(m[0].split("=")[1]):this._getSheetIndexByName(m[0]),a=m[1]),a.indexOf("$")>-1&&(a=a.split("$").join("")),_=t.isNullOrUndefined(o)?a:o):(c=r.webAddr,h=t.isNullOrUndefined(r.text)?this.XLEdit.getPropertyValue(p[0].rowIndex,p[0].colIndex,"value2"):r.text,_=t.isNullOrUndefined(h)?c:h),this._dupDetails=!0,this._dlgHLClick||(v=this.XLEdit.getPropertyValue(p[0].rowIndex,p[0].colIndex,"value2"),this._prevText=t.isNullOrUndefined(v)?"":v,this._prevVal=t.isNullOrUndefined(v)?"":this.XLEdit.getPropertyValue(p[0].rowIndex,p[0].colIndex,"value"),this.XLEdit._updateCellValue({rowIndex:p[0].rowIndex,colIndex:p[0].colIndex},_)),C=0,S=p.length;C<S;C++)y.push({rowIndex:p[C].rowIndex,colIndex:p[C].colIndex,prevLink:this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"hyperlink"),prevColor:this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"formats")});for(this.isUndefined(s.text)||this.XLEdit._updateCellValue(p[0],s.text),this.isUndefined(a)?this.updateUniqueData({hyperlink:{webAddr:c}},g):this.updateUniqueData({hyperlink:{cellAddr:a+"_"+l}},g),C=0,S=p.length;C<S;C++)b=this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"value2"),y[C].prevText=0===C?this._prevText:b,y[C].prevVal=0===C?this._prevVal:this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"value"),this._isRowViewable(w,p[C].rowIndex)&&(e(T.eq(C).find("a")).remove(),this.XLEdit._refreshTextNode(T[C]),u=!0),(f=this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"hyperlink",w)).cellAddr?(b=0===C?o:b,u&&T.eq(C).append(t.buildTag("a",b,"")),y[C].curText=o):(b=0===C?h:b,u&&!this.isUndefined(T[C])&&T.eq(C).append(t.buildTag("a",b,"",{href:f.webAddr,target:"_blank"})),y[C].curText=h),y[C].curLink=this.XLEdit.getPropertyValue(p[C].rowIndex,p[C].colIndex,"hyperlink"),u&&e(T[C]).find("a").addClass("e-hyperlinks");this.XLFormat.format({style:{color:this._hlColor}},i),this._dupDetails=!1,L.selectedCell=y,d={sheetIndex:this.getActiveSheetIndex(),range:i,linkData:r,reqType:"hyperlink",selectedCell:L.selectedCell,action:L.action},I._isImported&&(!I._isLoaded||this._isExport)||(this._completeAction(L),this._trigActionComplete(d))}}},removeHyperlink:function(e,i,r,l,n){var s,o;if(!this.model.allowHyperlink||this.model.isReadOnly)return!1;if(o={range:e,sheetIndex:s=this.getActiveSheetIndex(),reqType:t.isNullOrUndefined(r)?"hyperlink":"clear-link",type:"actionBegin",action:t.isNullOrUndefined(r)?"delete":"clear-link"},!this._trigActionBegin(o)){var a,d,h,c,u,g,p=[],m=this._dupDetails,_=this.getSheet(s),f=[],b={sheetIndex:s,reqType:"hyperlink",action:"delete",range:o.range};for(a=0,d=(u=this._getMultiRangeCells(o.range)).length;a<d;a++)n&&this._isHiddenRow(u[a].rowIndex)||(h={rowIndex:u[a].rowIndex,colIndex:u[a].colIndex,prevLink:this.XLEdit.getPropertyValue(u[a].rowIndex,u[a].colIndex,"hyperlink"),prevText:this.XLEdit.getPropertyValue(u[a].rowIndex,u[a].colIndex,"value2"),prevVal:this.XLEdit.getPropertyValue(u[a].rowIndex,u[a].colIndex,"value"),prevColor:this.XLEdit.getPropertyValue(u[a].rowIndex,u[a].colIndex,"formats")},this._dupDetails=!0,h.prevLink&&(i?this.XLFormat.format({style:{"text-decoration":"underline"}},this._getAlphaRange(s,u[a].rowIndex,u[a].colIndex,u[a].rowIndex,u[a].colIndex)):(t.isNullOrUndefined(l)||this.isUndefined(l[a].prevColor)||(c=l[a].prevColor.color),this.XLFormat.format({style:{color:this.isUndefined(c)?"#444445":c,"text-decoration":"none"}},this._getAlphaRange(s,u[a].rowIndex,u[a].colIndex,u[a].rowIndex,u[a].colIndex))),h.curColor=this.XLEdit.getPropertyValue(u[a].rowIndex,u[a].colIndex,"formats")),this._dupDetails=m,this.clearRangeData([u[a].rowIndex,u[a].colIndex,u[a].rowIndex,u[a].colIndex],["hyperlink"]),this._isUndoRedo||(h.curLink=this.XLEdit.getPropertyValue(u[a].rowIndex,u[a].colIndex,"hyperlink")),this._isUndoRedo&&!this._dupDetails&&(t.isNullOrUndefined(l[a].prevText)||this.XLEdit._updateDataContainer({rowIndex:u[a].rowIndex,colIndex:u[a].colIndex},{dataObj:{value2:l[a].prevText,value:l[a].prevVal},sheetIdx:s})),this._isUndoRedo||(h.curText=this.XLEdit.getPropertyValue(u[a].rowIndex,u[a].colIndex,"value2")),!this._isUndoRedo||this._dupDetails||t.isNullOrUndefined(l[a].prevLink)||(this.XLEdit._updateDataContainer({rowIndex:u[a].rowIndex,colIndex:u[a].colIndex},{dataObj:{hyperlink:l[a].prevLink}}),g={rowIndex:l[a].rowIndex,colIndex:l[a].colIndex},this.XLSelection.selectRange(g,g),this._setLink([l[a]]),p.push(a)),f.push(h));for(a=0,d=p.length;a<d;a++)u.splice(p[a],1);b.selectedCell=f,b.reqType=t.isNullOrUndefined(r)?"hyperlink":"clear-link",_._isImported&&!_._isLoaded||this._isUndoRedo||this._dupDetails||this._isExport||(this._completeAction(b),this._trigActionComplete(b))}},_removeHyperlink:function(e,t,i,r){var l=this.getActiveSheetIndex();r=r||this.getSheet(l).selectedRange,this.removeHyperlink(this._getAlphaRange(l,r[0],r[1],r[2],r[3]),"clear"===e,e,t,i)},_openLink:function(){var e=this.getActiveSheetIndex(),t=this.getSheetElement(e).find(".e-activecell");this._hlClick(this.XLEdit.getPropertyValue(t.closest("tr").index(),t[0].cellIndex,"hyperlink",e))},_hlClick:function(e){var t,i,r,l,n,s,o,a,d,h=this.getActiveSheetIndex(),c=this.getSheet(h),u=this.getActiveCell(h),g={rowIndex:u.rowIndex,colIndex:u.colIndex,cellAddr:e.cellAddr,webAddr:e.webAddr,target:"_blank",action:"hyperlinkclick",sheetIndex:h,reqType:"hyperlink-click",type:"cellClick"};this.model.enableContextMenu&&this.XLCMenu.hideCMenu(),this._trigger("cellClick",g)||(o=g.target,a=g.webAddr,(d=g.cellAddr)?(n=(s=d.split("_"))[0].indexOf("$")>-1?s[0].split("$").join(""):s[0],r={rowIndex:(t=this.getRangeIndices(n))[0],colIndex:t[1]},l={rowIndex:t[2],colIndex:t[3]},i=Number(s[1]),this.gotoPage(i,!1),c._activeCell=r,this.XLSelection.selectRange(r,l,i),c._startCell=r,c._endCell=l,this.XLScroll._scrollSelectedPosition(i,r),this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement()):(r={rowIndex:c._activeCell.rowIndex,colIndex:c._activeCell.colIndex},c._startCell=r,c._endCell=r,this._isValidUrl(a)?window.open(a,o):this._showAlertDlg("Alert","HyperLinkAlert")))},_isValidUrl:function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},showWaitingPopUp:function(){e("#"+this._id+"_wait").data("ejWaitingPopup").show()},hideWaitingPopUp:function(){e("#"+this._id+"_wait").data("ejWaitingPopup").hide()},_getSelRange:function(e){var t,i;return t=e[0],i=e[e.length-1],this._generateHeaderText(t.colIndex+1)+(t.rowIndex+1)+":"+this._generateHeaderText(i.colIndex+1)+(i.rowIndex+1)},_getSelectedCells:function(e,i){var r,l,n=this.getSheet(e||this.getActiveSheetIndex());return t.isNullOrUndefined(i)?(r=n._selectedCells).length>0?(i=this._getSelRange(r),l=this.getRangeIndices(i)):(l=[0,0,0,0],r=[{rowIndex:0,colIndex:0}]):(l=this._getRangeArgs(i,"object"),r=this._getSelectedRange({rowIndex:l[0],colIndex:l[1]},{rowIndex:l[2],colIndex:l[3]})),{range:l,selCells:r}},_getHiddenCells:function(i,r,l,n){var s,o,a,d,h=this._dataContainer.sheets[i];return t.isNullOrUndefined(n[l.rowIndex])&&(n[l.rowIndex]={}),t.isNullOrUndefined(n[l.rowIndex][l.colIndex])&&(n[l.rowIndex][l.colIndex]={value:{},text:""}),t.isNullOrUndefined(h[l.rowIndex])||(n[l.rowIndex][l.colIndex].value=e.extend(!0,{},h[l.rowIndex][l.colIndex]),s=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2",i),o=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"wrap",i),a=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"wrapRow",i),this.isUndefined(this.XLEdit.getPropertyValue(l.rowIndex,l.colIndex,"border",i))&&this.isUndefined(this.XLEdit.getPropertyValue(l.rowIndex,l.colIndex,"format",i))?delete h[l.rowIndex][l.colIndex]:((d=this.getObjectKeys(this._dataContainer.sheets[i][l.rowIndex][l.colIndex])).splice(d.indexOf("border"),1),d.splice(d.indexOf("format"),1),this.XLEdit._clearDataContainer({cellIdx:{rowIndex:l.rowIndex,colIndex:l.colIndex},property:d})),n[l.rowIndex][l.colIndex].text=t.isNullOrUndefined(s)?"":s,(o||a)&&(t.isNullOrUndefined(h[l.rowIndex])&&(h[l.rowIndex]={}),t.isNullOrUndefined(h[l.rowIndex][l.colIndex])&&(h[l.rowIndex][l.colIndex]={}),o&&(h[l.rowIndex][l.colIndex].wrap=o),a&&(h[l.rowIndex][l.colIndex].wrapRow=a))),this._isRowViewable(i,r.rowIndex)&&(r=this.getCell(r.rowIndex,r.colIndex,i).empty()),n},_getRowSpan:function(e,i){for(var r=0,l=i[0].rowIndex,n=i[i.length-1].rowIndex;l<=n;l++)t.isNullOrUndefined(this.XLEdit.getPropertyValue(l,0,"isRHide",e))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(l,0,"isFHide",e))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(l,0,"isFilterHide",e))&&-1===this.getSheet(e)._fHMergeRows.indexOf(l)&&(r+=1);return r},_getColSpan:function(e,i){for(var r=0,l=i[0].colIndex,n=i[i.length-1].colIndex;l<=n;l++)t.isNullOrUndefined(this.XLEdit.getPropertyValue(0,l,"isCHide",e))&&-1===this.getSheet(e)._fHMergeCols.indexOf(l.toString())&&(r+=1);return r},_getHiddenRowColumnCount:function(e,i){var r,l,n,s=this.getRangeIndices(i),o=0,a=0,d=this.model.scrollSettings.allowVirtualScrolling;for(d||(n=this._getJSSheetHeader(e).find("col")),r=s[0];r<=s[2];r++)t.isNullOrUndefined(this.XLEdit.getPropertyValue(r,0,"isRHide",e))&&t.isNullOrUndefined(this.XLEdit.getPropertyValue(r,0,"isFHide",e))||(o+=1);for(l=s[1];l<=s[3];l++)(d||!d&&this._hasClass(n[l],"e-hide")||!t.isNullOrUndefined(this.XLEdit.getPropertyValue(0,l,"isCHide",e)))&&(a+=1);return{hRow:o,hCol:a}},_updateMergeColl:function(e,i,r,l,n,s,o,a){var d=this.getSheet(e),h=d._mergeColl;t.isNullOrUndefined(h[i])?(h[i]={},h[i][r]={}):t.isNullOrUndefined(h[i][r])&&(h[i][r]={}),h[i][r].type=l,a&&(h[i][r].mergeType=a),n&&(h[i][r].isSamePosn=n),d.mergedCells.push({isCenterAlign:o,range:s})},mergeCells:function(e,i){var r,l,n,s,o,a,d,h,c,u=1,g=1,p=[],m=this.getActiveSheetIndex(),_=this.getSheet(m),f=!1,b=this._getRangeArgs(e,"object",m),C=b[2]-b[0]||b[3]-b[1];if(this.model.allowMerging&&this.model.allowSelection&&C&&!(this.getSheetElement(m).find(".e-ss-activeimg").length>0)&&(!_._isLoaded||!this.model.isReadOnly)){if(a=this._getSelectedCells(m,b).selCells,this._selMergeCells=[],this._mergeType="merge-cells",(!_._isImported||_._isLoaded)&&!this._isUndoRedo)if(this.performSelection(b),this.mergeCenter){for(f=!1,o=a.length,r=0;r<o;r++)n=this.XLEdit.getPropertyValue(a[r].rowIndex,a[r].colIndex,"merge",m),t.isNullOrUndefined(n)||(u=n.mSpan.rowSpan,g=n.mSpan.colSpan,(u>1||g>1)&&(d=this._getHiddenRowColumnCount(m,this.XLEdit.getPropertyValue(a[r].rowIndex,a[r].colIndex,"merge").mRange),this._unMergeAllCells(m,r,a,p,d.hRow,d.hCol),f=!0));!f||this._dupDetails||this._isUndoRedo||(t.isNullOrUndefined(e)&&(e=this._getSelRange(a)),s={sheetIndex:m,cells:a,range:e,reqType:"merge-cells",action:"un-merge",operation:"un-merge",mCells:p},this._completeAction(s),this._trigActionComplete(s),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this.performSelection(b))}else for(o=a.length,r=0;r<o;r++)if(n=this.XLEdit.getPropertyValue(a[r].rowIndex,a[r].colIndex,"merge",m),t.isNullOrUndefined(n)||(u=n.mSpan.rowSpan,g=n.mSpan.colSpan),1===u&&1===g){f=!1;break}for(_._isImported&&!_._isLoaded||this._isUndoRedo||!this._rangeHasData(b)||i||f||!C?f||this._mergeCells(m,a,{},[]):this._showAlertDlg("","MergeCellsAlert","MergeCells",498),o=(e=this.getObjectKeys(_.formulaRange)).length,l=0;l<o;l++)h=e[l],c=this.getRangeIndices(h),b[3]==c[3]&&this._showAlertDlg("Alert","ArrayaFormula",430)}},_mergeCells:function(i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f,b,C,S=this._dataContainer.sheets[i],x={},v=this.getSheet(i),w=this.XLEdit;if(o=h=r[0].rowIndex,c=r[0].colIndex,f=this.XLEdit.getPropertyValue(h,c,"format"),this.model.scrollSettings.allowVirtualScrolling||(p=this._getJSSheetHeader(i).find("col")),(t.isNullOrUndefined(w.getPropertyValue(h,0,"isFRHide"))||t.isNullOrUndefined(w.getPropertyValue(h,0,"isRHide")))&&p&&p.eq(c).hasClass("e-fc-hide"))return{hideCell:[],mCells:[]};for(s={rowSpan:this._getRowSpan(i,r),colSpan:this._getColSpan(i,r)},t.isNullOrUndefined(S[h])||t.isNullOrUndefined(S[h][c])||(delete S[h][c].isMHide,delete S[h][c].mergeIdx),this._isRowViewable(i,h)&&((u=this.getCell(h,c))[0].colSpan=s.colSpan,u[0].rowSpan=s.rowSpan,u[0].className=u[0].className.replace("e-mc-hide",""),this.mergeCenter&&u.addClass("e-calign "),u.hasClass("e-commentcell")&&this.model.allowComments&&this.XLComment._updateCmntArrowPos(u)),this._selMergeCells.push(r[0]),this._textClip(r[0].rowIndex,r[0].colIndex,"add"),this._textClip(r[0].rowIndex,r[0].colIndex,"delete","",!0),this._isRowViewable(i,r[0].rowIndex)&&this.addClass(this.getCell(r[0].rowIndex,r[0].colIndex)[0],"e-moverflow"),b=1,C=r.length;b<C;b++)this._isRowViewable(i,r[b].rowIndex)&&(g=this.getCell(r[b].rowIndex,r[b].colIndex),this._hasClass(g[0],"e-mc-hide")||this.addClass(g[0],"e-mc-hide"),this.addClass(g[0],"e-moverflow")),o!==r[b].rowIndex&&-1==v.hideRowsCollection.indexOf(r[b].rowIndex)&&(o=r[b].rowIndex),this._textClip(r[b].rowIndex,r[b].colIndex,"add"),this._textClip(r[b].rowIndex,r[b].colIndex,"delete","",!0),l=this._getHiddenCells(i,{rowIndex:r[b].rowIndex,colIndex:r[b].colIndex},r[b],l),this.isUndefined(f)?this.XLEdit._updateDataContainer({rowIndex:r[b].rowIndex,colIndex:r[b].colIndex},{dataObj:{isMHide:!0,mergeIdx:{rowIndex:h,colIndex:c}},sheetIdx:i}):this.XLEdit._updateDataContainer({rowIndex:r[b].rowIndex,colIndex:r[b].colIndex},{dataObj:{isMHide:!0,mergeIdx:{rowIndex:h,colIndex:c},format:f},sheetIdx:i}),this._selMergeCells.push(r[b]);return d=this._getSelRange(r),t.isNullOrUndefined(S[h])||e.extend(!0,x,S[h][c]),v._activeCell=r[0],(!v._isImported||v._isLoaded)&&this.performSelection(r[0],r[r.length-1]),this.XLEdit._updateDataContainer({rowIndex:h,colIndex:c},{dataObj:{merge:{mSpan:s,isMerge:!0,mRange:d,isCenterAlign:this.mergeCenter}}}),_=this._getMCellBorderProps(this.getRangeIndices(d)),this.getObjectLength(_)&&this.XLFormat._applyBorderCss(_,this.getRangeIndices(d)),this._updateMergeColl(i,h,c,this.mergeCenter?"center":"merge",null,d,this.mergeCenter,this._mergeType),n.push({rowIndex:h,colIndex:c,prevObj:x,curObj:e.extend(!0,{},S[h][c])}),w.getPropertyValue(h,c,"wrap")&&(m=this._getWrapCellHeight(i,h,c).rowHt,(this._getRowHeight(h,i)<=m||v._isImported||!v._isLoaded)&&(this.setHeightToRows([{rowIndex:h,height:m}]),this._wrapCollection(h,c,m.cellHt,i))),v._isImported&&!v._isLoaded||this._isUndoRedo||this._dupDetails||this._paste||"merge-cells"!==this._mergeType||((a={sheetIndex:i,cells:[{rowIndex:h,colIndex:c}],range:d,reqType:"merge-cells",action:"merge-all",hideCells:l,mCells:n}).operation=this.mergeCenter?"merge-center":"merge-all",this._paste||(this._completeAction(a),this._trigActionComplete(a))),this.model.showRibbon&&!this._isScrolling&&this.XLRibbon._updateRibbonIcons(),this.mergeCenter=!1,this._paste=!1,this.XLEdit._updateUsedRange(h+s.rowSpan,c+s.colSpan,i),{hideCells:l,mCells:n}},mergeAcrossCells:function(e,t){if(!this.model.isReadOnly){var i,r=this.getActiveSheetIndex(),l=this.getSheet(r),n=this._getRangeArgs(e,"object",r),s=n[2]-n[0]||n[3]-n[1],o=n[3]-n[1];!this.model.allowMerging||this.getSheetElement(r).find(".e-ss-activeimg").length>0||!s||this.model.isReadOnly||(this._selMergeCells=[],i=this._getSelectedCells(r,n),this.isUndefined(e)||this.performSelection(n),this._isUndoRedo||!this._rangeHasData(n)||l._isImported&&!l._isLoaded||t||!o?o&&this._mergeAcrossCells(r,i.selCells):this._showAlertDlg("","MergeCellsAlert","MergeAcrossCells",498),this.performSelection(n),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons())}},_mergeAcrossCells:function(i,r){var l,n,s,o,a,d,h,c,u,g=1,p=1,m=!0,_=[],f={mCells:[],hideCells:{}},b=this.getSheet(i);for(this._mergeType="merge-across",l=0,s=r.length;l<s;l++){if(o=this.XLEdit.getPropertyValue(r[l].rowIndex,r[l].colIndex,"merge",i),t.isNullOrUndefined(o)||(g=o.mSpan.rowSpan,p=o.mSpan.colSpan),1===g&&1===p){m=!1;break}g>1&&(m=!1)}if(!m)for(c=r[0].rowIndex,u=r[r.length-1].rowIndex,d=r[0].colIndex,h=r[r.length-1].colIndex,l=c;l<=u;l++){for(_=[],n=d;n<=h;n++)_.push({rowIndex:l,colIndex:n});f=this._mergeCells(i,_,f.hideCells,f.mCells)}b._isImported&&!b._isLoaded||this._isUndoRedo||this._dupDetails||(a={sheetIndex:i,cells:e.extend(!0,[],this._selMergeCells),range:this._getSelRange(r),reqType:"merge-cells",action:"merge-across",operation:"merge-across",hideCells:f.hideCells,mCells:f.mCells},this._paste||(this._completeAction(a),this._trigActionComplete(a)),this._paste=!1),this._mergeType="merge-cells",this.performSelection(r[0],r[r.length-1])},_getMCellBorderProps:function(e){for(var t,i,r,l,n,s={},o=["bottom","right"],a=0;a<o.length;a++)for(l=(i=o[a])==o[0]?[e[2],e[1],e[2],e[3]]:[e[0],e[3],e[2],e[3]],n=this.getRangeData({range:l,property:["border"]}),t=0;t<n.length;t++){if(!n[t].border){delete s[i];break}if(!(r=this.XLFormat.getBorderFromHashCode(n[0].border))[i]){delete s[i];break}if(s[i]&&s[i]!=r[i]){delete s[i];break}s[i]=r[i]}return(n=this.XLEdit.getPropertyValue(e[0],e[1],"borders"))&&(n.top&&(s.top=n.top),n.left&&(s.left=n.left)),s},unmergeCells:function(e){var i,r;if(!this.model.isReadOnly){var l,n,s,o,a=this.getActiveSheetIndex(),d=this.getSheet(a),h=[],c=d._clrMergeColl,u=this._getRangeArgs(e,"object",a);if(this.model.allowMerging&&!(this.getSheetElement(a).find(".e-ss-activeimg").length>0)&&!this.model.isReadOnly){for(this._selMergeCells=[],i=0,r=(l=this._getSelectedCells(a,u).selCells).length;i<r;i++)o=this.XLEdit.getPropertyValue(l[i].rowIndex,l[i].colIndex,"merge",a),this.isUndefined(o)||(s=this._getHiddenRowColumnCount(a,o.mRange),h=this._unMergeAllCells(a,i,l,h,s.hRow,s.hCol),c.push({rowIdx:l[i].rowIndex,colIdx:l[i].colIndex,mergeObj:o}));t.isNullOrUndefined(e)&&(e=this._getSelRange(l)),d._isLoaded&&this.performSelection(u),d._isImported&&!d._isLoaded||this._isUndoRedo||this._dupDetails||this._isExport||(n={sheetIndex:a,cells:l,range:e,reqType:"merge-cells",action:"un-merge",operation:"un-merge",mCells:h},this._completeAction(n),this._trigActionComplete(n)),this.model.showRibbon&&!this._isScrolling&&this.XLRibbon._updateRibbonIcons()}}},_unMergeAllCells:function(i,r,l,n,s,o){var a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y=1,T=1,L=!1,R=this._dataContainer.sheets[i],O={},F=this.getSheet(i),E=!1;if(b=l[r].rowIndex,C=l[r].colIndex,S=this.getRows(i)[0],I=this.model.sheets[i].mergedCells,m=this.getCell(b,C),c=this.XLEdit.getPropertyValue(b,C,"merge",i),!t.isNullOrUndefined(c))for(y=c.mSpan.rowSpan,T=c.mSpan.colSpan,(E=this.XLEdit.getPropertyValue(b,C,"borders",i))&&(!E||E.right&&E.bottom)||this.XLEdit._clearDataContainer({cellIdx:{rowIndex:b,colIndex:C},property:["border"]}),E&&E.bottom&&1===y&&this.XLFormat._updateFormatClass({rowIndex:b,colIndex:C},this.XLFormat._getBorderHashCode(E),!0),h=0;h<I.length;h++)I[h].range==c.mRange&&I.splice(h,1);if(T>1||y>1)for(v=R[b][C],e.extend(!0,O,v),delete v.merge,this._clearMergeColl(F._mergeColl,b,C),this._isRowViewable(i,b)&&(m=this.getCell(b,C),this.XLEdit.getPropertyValue(b,C,"cellType",i)||(u=m.find("#"+this._id+"_Merge")).length&&(m[0].innerHTML=u[0].innerHTML,u.remove()),t.isNullOrUndefined(c.isCenterAlign)||m.removeClass("e-calign"),m[0].colSpan=m[0].rowSpan=1,F._isLoaded&&(w=m[0].offsetHeight,e(S[b]).height()<w&&(this.setHeightToRows([{rowIndex:b,height:w}]),this._updateFormatColl(i,b,C,w)),this.XLScroll._getRowHeights(i,b))),n.push({rowIndex:b,colIndex:C,prevObj:O,curObj:e.extend(!0,{},R[b][C])}),x=[],a=b;a<b+y+s;a++)for(d=C;d<C+T+o;d++)this._selMergeCells.push({rowIndex:a,colIndex:d}),L=!1,this._isRowViewable(i,a)&&(f=this.getCell(a,d,i),L=!0),t.isNullOrUndefined(this.XLEdit.getPropertyValue(a,d,"isMHide",i))||(this._isUndoRedo&&(p=this.XLEdit.getPropertyValue(a,d,"merge",i),t.isNullOrUndefined(p)||(p.mergeSpan.rowSpan>1||p.mergeSpan.colSpan>1)&&(x.push({rowIndex:a,colIndex:d,rowSpan:p.mergeSpan.rowSpan,colSpan:p.mergeSpan.colSpan}),R[a][d].merge.mSpan={rowSpan:1,colSpan:1},f[0].rowSpan=1,f[0].colSpan=1)),g=this.XLEdit.getPropertyValue(a,d,"mergeIdx",i),t.isNullOrUndefined(g)||g.rowIndex===b&&g.colIndex===C&&(L&&(f.removeClass("e-mc-hide"),f[0].rowSpan=1,f[0].colSpan=1),delete R[a][d].isMHide,delete R[a][d].mergeIdx)),this._isUndoRedo&&!t.isNullOrUndefined(this._delCells)&&(t.isNullOrUndefined(this._delCells[a])||t.isNullOrUndefined(this._delCells[a][d])||t.isNullOrUndefined(R[a])||(_=!t.isNullOrUndefined(R[a][d])&&R[a][d].overflow,R[a][d]=this._delCells[a][d].value,_&&(R[a][d].overflow=_),L&&f.text(this._delCells[a][d].text),c=this.XLEdit.getPropertyValue(a,d,"merge"),!t.isNullOrUndefined(c)&&c.isMerge&&this.mergeCells(c.mRange,!0))),L&&f.hasClass("e-commentcell")&&this.model.allowComments&&this.XLComment._updateCmntArrowPos(f),L&&(this._removeClass(f[0],"e-moverflow"),f.text().length>0?this._textClip(a,d,"add"):this._textClip(a,d,"delete")),t.isNullOrUndefined(R[a])||(this.getObjectLength(R[a][d])<1&&delete R[a][d],this.getObjectLength(R[a])<1&&delete R[a]);return n},_refreshMergeCells:function(){var e,t,i,r;for(this._dupDetails=!0,t=0,i=(e=this._removeMergeColl).length;t<i;t++)this.unmergeCells(e[t].merge.mRange,!0);switch(this._dupDetails=!1,(r=this._insData).value.status){case"shiftRight":this._insertShiftRight(r.sheetIdx,r.startCell,r.endCell,r.value);break;case"shiftBottom":this._insertShiftBottom(r.sheetIdx,r.startCell,r.endCell,r.value);break;case"shiftUp":this._deleteShiftUp(r.sheetIdx,r.startCell,r.endCell,r.value);break;case"shiftLeft":this._deleteShiftLeft(r.sheetIdx,r.startCell,r.endCell,r.value)}},_showHeadings:function(e,t){if(!this.model.isReadOnly){t=t||this.getActiveSheetIndex();var i,r,l=this.getSheet(t),n=this._getJSSheetHeader(t),s=this._getContent(t).find(".e-content"),o=this._getJSSheetRowHeader(t),a=this.getFrozenRows(),d=this.getFrozenColumns();l.showHeadings=e,this._isDisplayHeader=!0,l.showHeadings?(o.show(),n.show(),s.removeClass("e-viewbrdr")):(o.hide(),n.hide(),s.addClass("e-viewbrdr")),this._heightWidthCalculation(t,{action:l._isLoaded?"":"initial"}),this.model.showRibbon&&((i=this.element.find("#"+this._id+"_Ribbon_PageLayout_Show_Headings").data("ejCheckBox"))&&(e?i._checked():i._unChecked())),this.model.allowFreezing&&l._isFreezed&&(this.XLFreeze.unfreezePanes(),this._isFrozen(a)&&this._isFrozen(d)?this.XLFreeze.freezePanes(a,d):this._isFrozen(a)?this.XLFreeze.freezeRows(a):this._isFrozen(d)&&this.XLFreeze.freezeColumns(d)),r={reqType:"headings",showHeadings:e,sheetIndex:t},this._trigActionComplete(r)}},showHeadings:function(e){this._showHeadings(e)},showGridlines:function(e){this._showGridlines(e)},_showGridlines:function(e,t){if(!this.model.isReadOnly){t=t||this.getActiveSheetIndex();var i,r,l=this.getSheet(t),n=this._getContent(t).find(".e-rowcell");this.model.showRibbon&&((i=this.element.find("#"+this._id+"_Ribbon_PageLayout_Show_Gridlines").data("ejCheckBox"))&&(e?i._checked():i._unChecked())),l.showGridlines=e,l.showGridlines?n.removeClass("e-hborder"):n.addClass("e-hborder"),r={reqType:"gridlines",showGridlines:e,sheetIndex:t},this._trigActionComplete(r)}},setSheetFocus:function(){this._isPublic=!0,this._setSheetFocus(),this._isPublic=!1},_setSheetFocus:function(){if(this._isSSLoaded||this._isPublic){if(!this._hasClass(document.activeElement,"e-datepicker"))if("msie"==t.browserInfo().name)try{this.element[0].setActive()}catch(e){}else this.element.focus();this._isInitLoad||window.scrollTo(window.pageXOffset,window.pageYOffset)}},_diffNumbers:function(e,t){return e-t},_isValidDate:function(e){var t,i;return!!/^\d{1,4}[\.|\/|-]\d{1,2}[\.|\/|-]\d{1,4}$/.test(e)&&((t=(e=e.replace(/0*(\d*)/gi,"$1")).split(/[\.|\/|-]/))[0]=t[0]-1,t[2].length<4&&(t[2]=parseInt(t[2])<50?2e3+parseInt(t[2]):1900+parseInt(t[2])),(i=new Date(t[2],t[0],t[1])).getDate()==t[1]&&i.getMonth()==t[0]&&i.getFullYear()==t[2])},_isValidTime:function(e){for(var t,i,r,l,n=0,s=!1,o=0,a=e.length;o<a;o++){if(((t=e.substring(o,o+1))<"0"||t>"9")&&":"!=t&&" "!=t&&"a"!=t&&"A"!=t&&"p"!=t&&"P"!=t&&"m"!=t&&"M"!=t)return!1;":"==t&&n++,("p"==t||"P"==t||"a"==t||"A"==t)&&(s=!0)}return!(n<1||n>2)&&(i=e.substring(0,e.indexOf(":")),!(parseFloat(i)<0||parseFloat(i)>23)&&((!s||!(parseFloat(i)<1||parseFloat(i)>12))&&(r=2==n?e.substring(e.indexOf(":")+1,e.lastIndexOf(":")):e.substring(e.indexOf(":")+1,e.length),!(parseFloat(r)<0||parseFloat(r)>59)&&(l=2==n?e.substring(e.lastIndexOf(":")+1,e.length):"00",!(parseFloat(l)<0||parseFloat(l)>59)))))},_setXY:function(e,t){var i=0,r=0;return t=t?"page":"client","mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type?(i=e[t+"X"],r=e[t+"Y"]):"touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type?(i=e.originalEvent.changedTouches[0][t+"X"],r=e.originalEvent.changedTouches[0][t+"Y"]):("MSPointerMove"===e.type||"pointermove"===e.type||"MSPointerUp"===e.type||"pointerup"===e.type||"MSPointerDown"===e.type||"pointerdown"===e.type)&&(i=e.originalEvent[t+"X"],r=e.originalEvent[t+"Y"]),[i,r]},_getSelectedItems:function(e,i,r){var l,n,s,o;return e=e||this.getActiveSheetIndex(),o=this.getSheet(e),t.isNullOrUndefined(r)&&t.isNullOrUndefined(i)?(l=o._selectedCells,n=o._startCell,s=o._endCell,r=this._generateHeaderText(n.colIndex+1)+(n.rowIndex+1)+":"+this._generateHeaderText(s.colIndex+1)+(s.rowIndex+1)):(i=this.isUndefined(i)?this.getRangeIndices(r):i,l=this.getRange(i,e),r=this._generateHeaderText(i[1]+1)+(i[0]+1)+":"+this._generateHeaderText(i[3]+1)+(i[2]+1)),[l,r]},setBorder:function(e,t){var i;if(this.model.allowCellFormatting&&!this.model.isReadOnly){(t=this._getRangeArgs(t))[0]===t[2]&&t[1]===t[3]&&((i=this.XLEdit.getPropertyValue(t[0],t[1],"merge"))&&(t=i.mRange));var r,l,n,s,o,a,d="",h=!1,c=e.style,u=e.type,g=e.color,p=this._getContent(this.getActiveSheetIndex()).find("div:first-child");if(this.model.allowSelection||"drawborder"!==u&&"drawbordergrid"!==u)switch(l=["bottom","top","left","right","outside","allborder"],n=["thickbox","thickbottom","doublebottom","topandbottom","topandthickbottom","topanddoublebottom"],s={top:{top:""},right:{right:""},bottom:{bottom:""},left:{left:""},outside:{top:"",right:"",bottom:"",left:""},thickbox:{top:"2px solid",right:"2px solid",bottom:"2px solid",left:"2px solid"},thickbottom:{bottom:"2px solid"},doublebottom:{bottom:"3px double"},topandbottom:{top:"1px solid",bottom:"1px solid"},topandthickbottom:{top:"1px solid",bottom:"2px solid"},topanddoublebottom:{top:"1px solid",bottom:"3px double"}},o={solid:"1px solid",dashed:"1px dashed",dotted:"1px dotted",double:"3px double"},this.model.allowSelection&&(this.XLSelection._isGridBordering=this.XLSelection._isOutsideBordering=!1),!0){case l.indexOf(u)>-1:for(r in a=s[(h=u===l[5])?l[4]:u])a[r]=o[c]+" "+g;h&&(a.isGridBorder=h),a.property=e,this.XLFormat.applyBorder(a,t);break;case n.indexOf(u)>-1:for(r in a=s[u])d="",d=2===a[r].split(" ").length?d+a[r]+" "+g:d+a[r]+" "+c+" "+g,a[r]=d;a.property=e,this.XLFormat.applyBorder(a,t);break;case"noborder"===u:this.XLFormat.applyBorder("noborder",t);break;case"drawborder"===u:this.XLSelection._isOutsideBordering=!0,p.removeClass("e-ss-cursor"),p.addClass("e-ss-drwbrdrcursor"),this.XLSelection._cleanUp(!0);break;case"drawbordergrid"===u:this.XLSelection._isGridBordering=!0,p.removeClass("e-ss-cursor"),p.addClass("e-ss-drwbrdrgridcursor"),this.XLSelection._cleanUp(!0)}}},clearBorder:function(e){this.model.isReadOnly||(e=this._getRangeArgs(e,"object"),this.XLFormat.removeStyle(e,{cellStyle:!0,tableStyle:!0,border:!0}))},clearHyperlinks:function(){this.model.allowClear&&!this.model.isReadOnly&&this._removeHyperlink("clear")},clearComments:function(e){this.model.allowClear&&!this.model.isReadOnly&&this.model.allowComments&&this.XLComment.deleteComment(i,e,!1,"clear")},clearAllFormat:function(i){var r,l;if(this.model.allowClear&&!this.model.isReadOnly&&(l={range:i,sheetIndex:r=this.getActiveSheetIndex(),reqType:"clear-format",type:"actionBegin",action:"clearformat"},!this._trigActionBegin(l))){var n,s,o,a=this._dataContainer.sheets[r],d=[],h=this.getSheet(r),c=this._getRangeArgs(l.range,"object"),u={sheetIndex:r,reqType:"clear-format",range:c};u.bData=e.extend(!0,[],this.getRangeData({range:c,property:["format","tformats","type","formatStr","decimalPlaces","thousandSeparator","formats","hyperlink","cFormatRule"]})),this._dupDetails=!0,s=this.getObjectKeys(a),d[0]=c[0]>parseInt(s[0])?c[0]:parseInt(s[0]),d[2]=c[2]<parseInt(s[s.length-1])?c[2]:parseInt(s[s.length-1]),o=this.getObjectKeys(a[d[2]]),d[1]=c[1]>parseInt(o[0])?c[1]:parseInt(o[0]),d[3]=c[3]<parseInt(o[o.length-1])?c[3]:parseInt(o[o.length-1]),t.isNullOrUndefined(s)||"partial"!==this._checkTableRange(this._getAlphaRange(r,d[0],d[1],d[2],d[3])).status&&(this.clearRangeData(c,["format","formatStr","decimalPlaces","thousandSeparator","formats","hyperlink","cFormatRule","border"],"",!1,u.reqType),this.clearBorder(i),this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(c),h._clrWrapColl=[],h._clrMergeColl=[],this._isPaste=!0,this.setWrapText("unwrap",c),this._isPaste=!1,this.unmergeCells(c),u.wrapColl=e.extend(!0,[],h._clrWrapColl),u.mergeColl=e.extend(!0,[],h._clrMergeColl),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),this._dupDetails=!1,this._isUndoRedo||(this._completeAction(u),n={sheetIndex:u.sheetIndex,reqType:u.reqType,range:u.range,prevData:u.bData,prevMergeColl:u.mergeColl,prevWrapColl:u.wrapColl},this._trigActionComplete(n)))}},clearContents:function(t){var i,r,l,n,s;this.model.isReadOnly||(r={range:t,sheetIndex:i=this.getActiveSheetIndex(),reqType:"clear-content",type:"actionBegin",action:"clearContent"},this._trigActionBegin(r))||(t=this._getRangeArgs(r.range,"object"),n=this.getRangeData({range:t,property:["value","value2","type","hyperlink"]}),s={sheetIndex:i,reqType:"clear-content",range:t,bData:e.extend(!0,[],n)},this.model.allowClear&&!this._isPropExists([t],"isReadOnly",i)&&(this.clearRangeData(t,["value","value2","hyperlink"],"",!1,s.reqType),this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(t),this._completeAction(s),l={sheetIndex:s.sheetIndex,reqType:s.reqType,range:s.range,prevData:s.bData},this._trigActionComplete(l),this._setSheetFocus(),this.model.allowFormulaBar&&this.updateFormulaBar()))},clearAll:function(i){var r,l;if(!this.model.isReadOnly&&(l={range:i,sheetIndex:r=this.getActiveSheetIndex(),reqType:"clear-all",type:"actionBegin",action:"clearall"},!this._trigActionBegin(l))){var n,s,o,a,d,h=this.getSheet(r),c=[],u=this._getRangeArgs(l.range,"object"),g={sheetIndex:r,reqType:"clear-all",range:u},p=this._dataContainer.sheets[r];if(this.model.allowClear&&!this._isPropExists([u],"isReadOnly",r)&&(this._dupDetails=!0,n=this.getObjectKeys(p),c[0]=u[0]>parseInt(n[0])?u[0]:parseInt(n[0]),c[2]=u[2]<parseInt(n[n.length-1])?u[2]:parseInt(n[n.length-1]),s=this.getObjectKeys(p[c[2]]),c[1]=u[1]>parseInt(s[0])?u[1]:parseInt(s[0]),c[3]=u[3]<parseInt(s[s.length-1])?u[3]:parseInt(s[s.length-1]),a=this._getAlphaRange(r,c[0],c[1],c[2],c[3]),!t.isNullOrUndefined(n)&&!t.isNullOrUndefined(s))){if(g.bData=e.extend(!0,[],this.getRangeData({range:u,property:["value","value2","hyperlink","merge","rule","cFormatRule","comment","format","formatStr","formats","tformat","decimalPlaces","thousandSeparator","type","borders","tborders"],sheetIdx:r})),g.bBorder=this.XLFormat.getHashCodeClassAsArray(u),"full"===(d=this._checkTableRange(a)).status)g.tblObj=d.tableObj,g.tblObj.tblId=d.tblId,g.tblObj.header=!0,this.XLFormat.removeTable(g.tblObj.tblId);else if("partial"===d.status)return;this.clearRangeData(u,["value","value2","hyperlink","cFormatRule","comment","format","formats","formatStr","decimalPlaces","thousandSeparator","border"],"",!1),this.clearBorder(a),this.model.allowFiltering&&this.XLFilter.clearFilter("remove"),h._clrMergeColl=[],h._clrWrapColl=[],this.model.allowConditionalFormats&&this.XLCFormat.refreshCFormat(u),this.model.allowDataValidation&&this.XLValidate.clearDV(),this._isPaste=!0,this.setWrapText("unwrap",u),this._isPaste=!1,this.unmergeCells(u),g.mergeColl=e.extend(!0,[],h._clrMergeColl),g.wrapColl=e.extend(!0,[],h._clrWrapColl),this._dupDetails=!1,this.model.showRibbon&&(this.XLRibbon._updateRibbonIcons(),this.XLRibbon._toggleDesignTab(this.getActiveCell())),this._completeAction(g),o={sheetIndex:g.sheetIndex,reqType:g.reqType,range:g.range,prevData:g.bData,prevBorder:g.bBorder,tblObj:g.tblObj,mergeColl:g.mergeColl,wrapColl:g.wrapColl},this._trigActionComplete(o)}}},_checkTableRange:function(e,t){var i,r,l,n,s,o=this.getActiveSheetIndex(),a=this.model.sheets[o],d=this.getRangeIndices(e);return t?n=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"tableName"):(s=this.XLEdit._getPropWithCellIdx(d,"tableName")).length&&(n=s[0].value),n?(i=this._getTableID(n),l=(r=a.tableManager[i]).range,e===this._getAlphaRange(o,l[0],l[1],l[2],l[3])?{status:"full",tableObj:r,tblId:i}:{status:"partial"}):{status:"no-table"}},_checkFilterRange:function(e,t){var i,r,l,n,s,o=this.getActiveSheetIndex(),a=this.getSheet(o),d=this.getRangeIndices(e),h=a.filterSettings.tableRange;if(t?l=this.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"isFilterHeader"):(n=this.XLEdit._getPropWithCellIdx(d,"isFilterHeader")).length&&(l=n[0].value),l){for(s=0;s<h.length;s++)if(-1===h[s].tableID)return r=h[s],e===(i=this._getAlphaRange(o,r.startRow-1,r.multifilterIdx[0],r.endRow,r.multifilterIdx[r.multifilterIdx.length-1]))?{status:"full",tRange:i,tblId:-1}:{status:"partial"};return{status:"no-table"}}return{status:"no-table"}},clearTextNode:function(e,i){if(!t.isNullOrUndefined(e)&&!this.model.isReadOnly){var r=this.getActiveSheetIndex(),l=e[0].parentNode.rowIndex,n=e[0].cellIndex,s=this._dataContainer.sheets[r],o=e[0].childNodes[e[0].childNodes.length-1];i=i||"",this._checkIndicesInContainer(r,l,n,"rule")&&"list"===s[l][n].rule.type||t.isNullOrUndefined(o)||o.hasChildNodes("a")||(e[0].lastChild.textContent=i)}},_isClassHasProperty:function(e,t,i){var r=this.XLFormat.getFormatFromHashCode(e);return!(!r[t]||r[t].toLowerCase()!==i)},_changeTargetWithOffset:function(t){var i,r=e(t.target),l=t.offsetX||t.pageX-r.offset().left;if(this._hasClass(document.activeElement,"e-datepicker")&&"mouseup"===t.type&&e("#"+this._id).focus(),r.is("a")&&(i=t.target,t.target=t.target.parentNode),r.is("#"+this._id+"_Merge"))return r.parents().closest("td")[0];if(this._hasClass(r.parents().closest("td"),"e-cellreadonly"))return this._hasClass(r,"e-datepicker")&&"mouseup"===t.type&&r.focus(),r.parents().closest("td")[0];if(r.is("td")&&this._hasClass(r,"e-cellreadonly")&&r.find(".e-chk-image").length>0&&"mouseup"===t.type)return e("#"+r.find(".e-checkbox")[0].id).ejCheckBox("instance")._checkedHandler(),t.target;if((l>t.target.offsetWidth||l<0)&&r.is("td")&&r.parents(".e-spreadsheetmainpanel").length&&this._hasClass(r,"e-rowcell")){var n=this.getSheet(this.getActiveSheetIndex()),s=this._getCellIdx(t.target),o=n._colWidthCollection[s.colIndex]+l,a=n._rowHeightCollection[s.rowIndex];return i&&this.addClass(i,"e-rmanchor"),this.getCell(this.XLShape._getCellIndexFromOffset(a,o).rowIndex,this.XLShape._getCellIndexFromOffset(a,o).colIndex)[0]}return i?(this._removeClass(i,"e-rmanchor"),i):(this._removeClass(r.find("a")[0],"e-rmanchor"),t.target)},_textClip:function(e,i,r,l,n,s){var o,a,d,h,c,u=this.getActiveSheetIndex();if(this._canOverflow&&!this.XLEdit.getPropertyValue(e,i,"merge")&&!this.XLEdit.getPropertyValue(e,i,"wrap")){var g,p,m,_,f,b,C,S,x,v,w,I,y=!1,T=!1,L=!1,R=!1,O=this.XLEdit,F=this.getSheet(u),E=F._isLoaded||this.isImport||this.model.isImport,D=this.getCell(e,i),N=O.getPropertyValue(e,i,"format",u);if(D&&(m=D[0]),this._isClassHasProperty(N,"text-align","right")&&(L=!0),!(O.getPropertyValue(e,i,"cellType",u)>-1)){if(this._dupDetails||(this._dupDetails=y=!0),s||(v=this._dataContainer.sheets[u],s=this.getObjectKeys(v[e])),"add"===r){if(!this.model.allowOverflow)return this.addClass(m,"e-overflow"),O._updateDataContainer({rowIndex:e,colIndex:i},{dataObj:{isOverflow:!1},skipCell:!0}),void(y&&(this._dupDetails=!1));if(this._removeClass(m,"e-overflow"),this.clearRangeData([e,i,e,i],["isOverflow"],"","","",!0),O.getPropertyValue(e,i+1,"value2",u)&&!L&&(T=!0),T||(S=F._ofColWidthColl,w=m?this.XLFormat.getFormatFromHashCode(this.XLFormat.getFormatClass(m.className)):{},l||(I=document.getElementById(this._id+"_emptySpan"),this.addClass(I,"e-rowcell e-wrapword"),this.addClass(I,N),I.textContent=O.getPropertyValue(e,i,"value2",u),l="text-indent"in w?Math.round(4/3*Number(w[t.Spreadsheet.SupportedStyles.TextIndent].replace("pt",""))+this._detailsFromGlobalSpan(e,i,"width",I.textContent,null,!0)):I.offsetWidth),this._refreshGlobalSpan(I),p=this.XLShape._getCellIndexFromOffset(null,S[i]+l,u,!0).colIndex-i),!n&&O.getPropertyValue(e,i,"value2",u)&&(x=O.getPropertyValue(e,i,"overflow",u),!t.isNullOrUndefined(x)&&x.rowIndex===e))if((C=this.getCell(x.rowIndex,x.colIndex))&&this.addClass(C[0],"e-overflow"),O._updateDataContainer({rowIndex:x.rowIndex,colIndex:x.colIndex},{dataObj:{isOverflow:!1},skipCell:!0}),x.colIndex<i)for(d=x.cellCount,c=0;c<=d;c++)h=[],0!==c&&h.push("overflow"),c!==d&&(_=this.getCell(e,x.colIndex+c),E&&_&&this._removeClass(_[0],"e-ofbrdr"),h.push("isOfBrdr")),this.clearRangeData([e,x.colIndex+c,e,x.colIndex+c],h,"","","",!0);else for(c=x.cellCount;c>0;c--)_=this.getCell(e,x.colIndex-c),E&&_&&this._removeClass(_[0],"e-ofbrdr"),this.clearRangeData([e,x.colIndex-c,e,x.colIndex-c],["isOfBrdr","overflow"],"","","",!0);if(L||T){for(d=i-p,c=i-1;c>=d;c--)if((b=O.getPropertyValue(e,c,"overflow",u))&&b.colIndex!==i&&!R&&(R=!0,this._textClip(b.rowIndex,b.colIndex,"delete","",!0),(D=this.getCell(b.rowIndex,b.colIndex))&&this.addClass(D[0],"e-overflow")),O.getPropertyValue(e,c,"value2",u)){T=!0;break}}else for(c=1;c<=p;c++)if(O.getPropertyValue(e,i+c,"value2",u)||O.getPropertyValue(e,i+c,"merge",u)||O.getPropertyValue(e,i+c,"isMHide",u)||O.getPropertyValue(e,i+c,"overflow",u)&&O.getPropertyValue(e,i+c,"overflow",u).colIndex!==i){T=!0;break}if(T)this.addClass(m,"e-overflow"),O._updateDataContainer({rowIndex:e,colIndex:i},{dataObj:{isOverflow:!1},skipCell:!0});else if(0!==p)for(c=0;c<=p;c++)f=L?i-c:i+c,c&&O._updateDataContainer({rowIndex:e,colIndex:f},{dataObj:{overflow:{rowIndex:e,colIndex:i,cellCount:p}},skipCell:!0}),((!L||L&&0!==c)&&c!==p||c===p&&L)&&(E&&this._isRowViewable(u,e)&&this.addClass(this.getCell(e,f)[0],"e-ofbrdr"),O._updateDataContainer({rowIndex:e,colIndex:f},{dataObj:{isOfBrdr:!0},skipCell:!0}))}else if("delete"===r){if(this._hasClass(m,"e-overflow"))this._removeClass(m,"e-overflow"),this.clearRangeData([e,i,e,i],["isOverflow"],"","","",!0);else if(L){if(b=O.getPropertyValue(e,i-1,"overflow",u),!t.isNullOrUndefined(b)&&b.colIndex===i)for(d=i-b.cellCount,a=i-1;a>=d;a--)E&&((_=this.getCell(e,a))&&this._removeClass(_[0],"e-ofbrdr")),this.clearRangeData([e,a,e,a],["isOfBrdr","overflow"],"","","",!0)}else if(b=O.getPropertyValue(e,i+1,"overflow",u),!t.isNullOrUndefined(b)&&b.colIndex===i)for(d=i+1+b.cellCount,a=i;a<d;a++)h=[],a!==i&&h.push("overflow"),a!==d&&(E&&((_=this.getCell(e,a))&&this._removeClass(_[0],"e-ofbrdr")),h.push("isOfBrdr")),this.clearRangeData([e,a,e,a],h,"","","",!0);if(!n&&this.model.allowOverflow){for(a=s.indexOf(i.toString())-1;a>-1;a--)if(E&&(g=this.getCell(e,s[a])),O.getPropertyValue(e,s[a],"value2",u)||O.getPropertyValue(e,s[a],"isMHide",u)){this._hasClass(g,"e-overflow")&&(g&&this._removeClass(g[0],"e-overflow"),this.clearRangeData([e,s[a],e,s[a]],["isOverflow"],"","","",!0),this._textClip(e,parseInt(s[a]),"add",null,null,s));break}for(o=s.length,a=s.indexOf(i.toString())+1;a<o;a++)if(E&&(g=this.getCell(e,s[a])),O.getPropertyValue(e,s[a],"value2",u)||O.getPropertyValue(e,s[a],"isMHide",u)){N=O.getPropertyValue(e,s[a],"format",u),this._hasClass(g,"e-overflow")&&this._isClassHasProperty(N,"text-align","right")&&(g&&this._removeClass(g[0],"e-overflow"),this.clearRangeData([e,s[a],e,s[a]],["isOverflow"],"","","",!0),this._textClip(e,parseInt(s[a]),"add",null,null,s));break}}}y&&(this._dupDetails=!1)}}},selectAll:function(e){if(this.model.allowSelection){var i,r,l,n,s=[],o=[],a=[],d=[],h=!1,c=0,u=this.XLEdit,g=this.getActiveCell(),p=g.rowIndex,m=g.colIndex,_=this.getActiveSheetIndex(),f=this._dataContainer.sheets[_],b=this.getObjectKeys(f),C=this.getSheet(_),S=this._getUsedRangeFromSheet(_,!1),x=S.rowCount+S.colCount;if(C._startCell.rowIndex!==C._endCell.rowIndex||C._startCell.colIndex!==C._endCell.colIndex&&C._isMultiSelect){var v={rowIndex:C._startCell.rowIndex,colIndex:C._startCell.colIndex},w={rowIndex:C._endCell.rowIndex,colIndex:C._endCell.colIndex},I={rowIndex:C._startCell.rowIndex,colIndex:C._startCell.colIndex},y={rowIndex:C._endCell.rowIndex,colIndex:C._endCell.colIndex};for(h=!0,r=1;r<x;r++){for(l=I.colIndex;l<y.colIndex+2;l++)(u.getPropertyValue(I.rowIndex-1,l,"value2",_)||this._getDataObj(I.rowIndex-1,l,"mergeIdx",_))&&(v.colIndex=I.colIndex<l?I.colIndex:l,w.colIndex=y.colIndex>l?y.colIndex:l,v.rowIndex=I.rowIndex<I.rowIndex-1?I.rowIndex:I.rowIndex-1);for(l=I.rowIndex;l<y.rowIndex+2;l++)(u.getPropertyValue(l,y.colIndex+1,"value2",_)||this._getDataObj(l,y.colIndex+1,"mergeIdx",_))&&(w.rowIndex=y.rowIndex>l?y.rowIndex:l);for(l=y.colIndex;l>I.colIndex-2;l--)(u.getPropertyValue(y.rowIndex+1,l,"value2",_)||this._getDataObj(y.rowIndex+1,l,"mergeIdx",_))&&(w.rowIndex=y.rowIndex>y.rowIndex+1?y.rowIndex:y.rowIndex+1,v.colIndex=I.colIndex<l?I.colIndex:l);for(l=y.rowIndex;l>I.rowIndex-2;l--)(u.getPropertyValue(y.rowIndex+1,l,"value2",_)||this._getDataObj(y.rowIndex+1,l,"mergeIdx",_))&&(w.rowIndex=y.rowIndex>y.rowIndex+1?y.rowIndex:y.rowIndex+1,v.colIndex=I.colIndex<l?I.colIndex:l);if(w.colIndex===y.colIndex&&w.rowIndex===y.rowIndex&&v.rowIndex===I.rowIndex&&v.colIndex===I.colIndex){if(1===r){C._isRangeSelected=!0;break}C._isRangeSelected=!1;break}I={rowIndex:v.rowIndex,colIndex:v.colIndex},y={rowIndex:w.rowIndex,colIndex:w.colIndex}}}if(!C._isRangeSelected&&!h){for(v={rowIndex:p,colIndex:m},w={rowIndex:p,colIndex:m},I={rowIndex:p,colIndex:m},y={rowIndex:p,colIndex:m},r=1;r<x+1;r++){for(l=-c;l<c+1;l++)(u.getPropertyValue(p+l,m+r,"value2",_)||this._getDataObj(p+l,m+r,"mergeIdx",_))&&(w.rowIndex=w.rowIndex>p+l?w.rowIndex:p+l,w.colIndex=w.colIndex>m+r?w.colIndex:m+r);for((u.getPropertyValue(p+r,m+r,"value2",_)||this._getDataObj(p+r,m+r,"mergeIdx",_))&&(w.rowIndex=w.rowIndex>p+r?w.rowIndex:p+r,w.colIndex=w.colIndex>m+r?w.colIndex:m+r),l=-c;l<c+1;l++)(u.getPropertyValue(p+r,m+l,"value2",_)||this._getDataObj(p+r,m+l,"mergeIdx",_))&&(w.rowIndex=w.rowIndex>p+r?w.rowIndex:p+r,w.colIndex=w.colIndex>m+l?w.colIndex:m+l);if(!u.getPropertyValue(p,m,"value2",_)&&w.colIndex===y.colIndex&&w.rowIndex===y.rowIndex&&v.rowIndex===I.rowIndex&&v.colIndex===I.colIndex&&0===c){C._isRangeSelected=!0;break}for((u.getPropertyValue(p+r,m-r,"value2",_)||this._getDataObj(p+r,m-r,"mergeIdx",_))&&(w.rowIndex=w.rowIndex>p+r?w.rowIndex:p+r,v.colIndex=v.colIndex<m-r?v.colIndex:m-r),l=-c;l<c+1;l++)(u.getPropertyValue(p+l,m-r,"value2",_)||this._getDataObj(p+l,m-r,"mergeIdx",_))&&(v.rowIndex=v.rowIndex<p+l?v.rowIndex:p+l,v.colIndex=v.colIndex<m-r?v.colIndex:m-r,w.rowIndex=w.rowIndex>p+l?w.rowIndex:p+l);for((u.getPropertyValue(p-r,m-r,"value2",_)||this._getDataObj(p-r,m-r,"mergeIdx",_))&&(v.rowIndex=v.rowIndex<p-r?v.rowIndex:p-r,v.colIndex=v.colIndex<m-r?v.colIndex:m-r),l=-c;l<c+1;l++)(u.getPropertyValue(p-r,m+l,"value2",_)||this._getDataObj(p-r,m+l,"mergeIdx",_))&&(v.rowIndex=v.rowIndex<p-r?v.rowIndex:p-r,v.colIndex=v.colIndex<m+l?v.colIndex:m+l,w.colIndex=w.colIndex>m+l?w.colIndex:m+l);if((u.getPropertyValue(p-r,m+r,"value2",_)||this._getDataObj(p-r,m+r,"mergeIdx",_))&&(v.rowIndex=v.rowIndex<p-r?v.rowIndex:p-r,w.colIndex=w.colIndex>m+r?w.colIdx:m+r),w.colIndex===y.colIndex&&w.rowIndex===y.rowIndex&&v.rowIndex===I.rowIndex&&v.colIndex===I.colIndex){if(0!==c){C._isRangeSelected=!1;break}C._isRangeSelected=!0;break}I={rowIndex:v.rowIndex,colIndex:v.colIndex},y={rowIndex:w.rowIndex,colIndex:w.colIndex},c++,s.push(w.colIndex),o.push(v.rowIndex),a.push(w.rowIndex),d.push(v.colIndex)}for(d=t.dataUtil.mergeSort(t.distinct(d)),v.colIndex=d[d.length-1],n=d.length-1;n>-1&&d[n-1]===d[n]-1;n--)v.colIndex=d[n-1];for(a=t.dataUtil.mergeSort(t.distinct(a)),w.rowIndex=a[0],n=0,i=a.length-1;n<i&&a[n+1]===a[n]+1;n++)w.rowIndex=a[n+1];for(o=t.dataUtil.mergeSort(t.distinct(o)),v.rowIndex=o[o.length-1],n=o.length-1;n>-1&&o[n-1]===o[n]-1;n--)v.rowIndex=o[n-1];for(s=t.dataUtil.mergeSort(t.distinct(s)),w.colIndex=s[0],n=0,i=s.length-1;n<i&&s[n+1]===s[n]+1;n++)w.colIndex=s[n+1];for(n=0,i=s.length-1;n<i&&s[n+1]===s[n]+1;n++)w.colIndex=s[n+1]}C._isEmptyActiveCell||(!C._isRangeSelected&&!b.length<1?(this.XLSelection.selectRange(v,w,_,e),C._isMultiSelect=!1,C._startCell=v,C._endCell=w,C._isRangeSelected=!0,C._isEmptyActiveCell=!u.getPropertyValue(p,m,"value2",_)):(this.XLSelection.selectSheet(),C._isRangeSelected=!0))}},multiSelection:function(e){for(var t,i,r=e.split(","),l=this._getJSSheetContent(this.getActiveSheetIndex()),n=0;n<r.length;n++)if(l.find("td[class *='activecell']")&&n>0){for(l.find("td[class *='activecell']").removeClass("e-activecell"),l.find("td[class *='focus']").removeClass("e-focustop e-focusleft"),t=(e=this._getRangeArgs(r[n].trim()))[0];t<=e[2];t++)for(i=e[1];i<=e[3];i++)this.getRange([t,i,t,i]).addClass("e-selected");this.getCell(e[0],e[1]).addClass("e-activecell"),this.XLSelection._focusRange({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[0],colIndex:e[1]},this._selectionBorder),this.model.allowAutoFill&&this.XLDragFill.hideAutoFillElement()}else this.XLSelection.selectRange(r[n])},_getDataObj:function(e,t,i,r){var l=this._dataContainer.sheets[r||this.getActiveSheetIndex()];return!(!l[e]||!l[e][t])&&l[e][t][i]},_getUsedRangeFromSheet:function(e,t){e=this._getSheetIndex(e);for(var i,r=this.getSheet(e),l=this._dataContainer.sheets[e],n=this.getObjectKeys(l),s={rowIndex:parseInt(n[0])||0,colIndex:0},o={rowIndex:parseInt(n[n.length-1])||0,colIndex:0},a=n.length,d=0;d<a;d++)i=this.getObjectKeys(l[parseInt(n[d])]),0===d?(s.colIndex=parseInt(i[0]),o.colIndex=parseInt(i[i.length-1])):(s.colIndex=s.colIndex<parseInt(i[0])?s.colIndex:parseInt(i[0]),o.colIndex=o.colIndex>parseInt(i[i.length-1])?o.colIndex:parseInt(i[i.length-1]));return o.rowIndex<r.usedRange.rowIndex&&(o.rowIndex=r.usedRange.rowIndex),o.colIndex<r.usedRange.colIndex&&(o.colIndex=r.usedRange.colIndex),t?this._getAlphaRange(e,s.rowIndex,s.colIndex,o.rowIndex,o.colIndex):{startCell:s,endCell:o,rowCount:o.rowIndex-s.rowIndex+1,colCount:o.colIndex-s.colIndex+1}},sheetRename:function(e){this.model.isReadOnly||this._updateSheetNames(e)},_isSubMenuOpen:function(){for(var t=["_formatastable","_cellstyles","_Ribbon_CElement","_contextMenuCell","_contextMenuColumnHeader","_contextMenuRowHeader","_contextMenuFooter"],i=0,r=t.length;i<r;){if(e("#"+this._id+t[i]).is(":visible"))return!0;i++}return!1},copySheet:function(e,i,r){if(!this.model.isReadOnly&&!this.model.isGridMode){var l,n,s,o,a,d=this._getSheetIndex(d),h=!1,c=2,u=this.model.sheets,g=this.element.find(".e-numericcontainer").children().eq(e-1),p=i;if(!r&&u[p].sheetInfo.text===g.text())return void this._setSheetFocus();for(n=1,s=u.length;n<s;n++)u.length-1!==p&&u[p].sheetInfo.text===u[n].sheetInfo.text&&(l=n),g.text()===u[n].sheetInfo.text&&(a=n);if(r){for(null===g.text().match(".*[ ]+[(]+[0-9]+[)]$")?o=g.text()+" ("+c+")":g.text().lastIndexOf(" ")>-1&&(c=parseInt(g.text().substring(g.text().lastIndexOf("(")+1,g.text().lastIndexOf(")"))),o=g.text().substring(0,g.text().lastIndexOf(" "))+" ("+c+")");!h;){for(o=o.substring(0,o.lastIndexOf(" "))+" ("+c+")",n=1,s=u.length;n<s;n++)o===u[n].sheetInfo.text&&c++;c===parseInt(o.substring(o.lastIndexOf("(")+1,o.lastIndexOf(")")))&&(h=!0)}this._copySheetProcess(a,o),a=this.model.sheetCount,t.isNullOrUndefined(l)&&(l=a)}else!t.isNullOrUndefined(l)&&l>a&&(l-=1);t.isNullOrUndefined(l)&&(l=p),r||l!==a?(this._swapSheetDtCntr(a,l),this.getPager().ejPager("option",{currentPage:p}),this.gotoPage(p,!1),this._setSheetFocus()):this._setSheetFocus()}},getHyperlink:function(e){return this.XLEdit.getPropertyValueByElem(e,"hyperlink",this.getActiveSheetIndex())},getComment:function(e){return this.XLEdit.getPropertyValueByElem(e,"comment",this.getActiveSheetIndex())},saveAsJSON:function(){var t,i,r,l,n,s,o,a;if(!this.model.isReadOnly){var d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R=1,O=[],F=["_activeCell","_endCell","_startCell","colCount","rowHeight","columnWidth","columnsWidthCollection","rowsHeightCollection","rowCount","frozenColumns","frozenRows","styleIndex","usedRange","sheetName","dataAttribute","filterSettings","tableManager","sheetInfo","hideColsCollection","hideRowsCollection","mergedCells","showGridlines","showHeadings","isSheetProtected","shapeMngr","pivotMngr","chart","rangeSettings","cellTypes","startCell","primaryKey","showHeader","fieldAsColumnHeader","headerStyles","rows","paneTopLeftCell"],E=["type","value","value2","decimalPlaces","format","formats","borders","formatStr","comment","hyperlink","rule","cFormatRule","wrap","merge","picture","chart","pivot","thousandSeparator","isLocked","align","isRHide"];for(I in this._isSaveAsJSON=!0,this._isExport=!0,this.model.exportSettings.allowExporting&&this.XLExport._renderAll(),this._isExport=!1,_=(d={dataContainer:e.extend(!0,{},this._dataContainer),model:e.extend(!0,{},this.model)}).model,(m=d.dataContainer).hashCode.length,v=m.sheetCellType,m.sheetCellType={},m.hashCode)(S=m.hashCode[I]).indexOf("e-border")>-1&&S.length<25&&O.push(S);for(I=0;I<O.length;I++)m.hashCode.splice(m.hashCode.indexOf(O[I]),1);for(f in m[I="sheets"])for(b in m[I][f]){for(C in m[I][f][b]){for(S in m[I][f][b][C])["format","formats","borders"].indexOf(S)>-1&&(t=this._dataContainer.hashCode[this._dataContainer[I][f][b][C][S]],m[I][f][b][C][S]=m.hashCode.indexOf(t)),E.indexOf(S)<0&&delete m[I][f][b][C][S];this.getObjectLength(m[I][f][b][C])||delete m[I][f][b][C]}this.getObjectLength(m[I][f][b])||delete m[I][f][b]}for(I in _)_[I]===this.defaults[I]||Object.prototype.toString.call(_[I])===Object.prototype.toString()?delete _[I]:Array.isArray(_[I])&&(_[I].length||delete _[I]);for(c=_.sheets;R<c.length;){for(I in p=c[R]){switch(I){case"frozenColumns":case"frozenRows":0===p[I]&&delete p[I];break;case"fieldAsColumnHeader":case"isSheetProtected":p[I]||delete p[I];break;case"showHeadings":case"showGridlines":case"showHeader":p[I]&&delete p[I];break;case"filterSettings":for(S in p[I])"range"===S?this._isEmptyString(p[I][S])&&delete p[I][S]:delete p[I][S];break;case"sheetInfo":for(S in p[I])if("text"!==S){if("isVisible"===S&&!p[I][S])continue;delete p[I][S]}break;case"_startCell":case"_endCell":case"_activeCell":case"usedRange":for(S in p[I])0===p[I][S]&&delete p[I][S];break;case"columnWidth":64===p[I]&&delete p[I];break;case"rowHeight":20===p[I]&&delete p[I];break;case"primaryKey":p[I].length||delete p[I];break;case"startCell":"A1"===p[I]&&delete p[I]}F.indexOf(I)<0||null===p[I]?delete p[I]:Object.prototype.toString.call(p[I])===Object.prototype.toString()?this.getObjectLength(p[I])||delete p[I]:Array.isArray(p[I])&&(p[I].length||delete p[I])}if(h=c[R].shapeMngr.chart,x={},this.getObjectLength(h)){for(I in y=0,h){if(r={commonSeriesOptions:{type:(i=e.extend(!0,{},h[I])).type,marker:i.marker},enable3D:i.enable3D,top:i.top,left:i.left,size:{width:i.width,height:i.height},title:i.title,legend:i.legend,primaryXAxis:i.primaryXAxis,primaryYAxis:i.primaryYAxis,dataSheetIdx:i.dataSheetIdx,animation:i.animation,isRowColSwitched:i.isRowColSwitched,colIndex:i.colIndex,rowIndex:i.rowIndex,theme:i.theme},i.range&&(r.range=this._getAlphaRange(R,i.range[0],i.range[1],i.range[2],i.range[3])),i.series)for(r.series=[],L=0,T=i.series.length;L<T;L++){for(n=[],l=0,s=i.series[L].points.length;l<s;l++)n.push({x:i.series[L].points[l].x,y:i.series[L].points[l].y,size:i.series[L].points[l].size});r.series.push({name:i.series[L].name,points:n})}i.seriesRange&&(r.seriesRange=i.seriesRange),i.colIndex&&i.rowIndex?m.sheets[R][i.rowIndex][i.colIndex].chart=[]:m.sheets[R][i.activeCell.rowIndex][i.activeCell.colIndex].chart=[],x["chart"+y]=r,y++}c[R].shapeMngr.chart=x}if(u=c[R].tableManager,g={},this.getObjectLength(u)){for(I in y=0,u){for(delete(o=e.extend(!0,{},u[I])).format,L=0,a=_.nameManager.length;L<a;L++)_.nameManager[L].name===o.name&&_.nameManager.splice(parseInt(L),1);g[y]=o,y++}c[R].tableManager=g}for(I in p.cellTypes=[],this.getObjectLength(v)&&(m.sheetCellType[R]={}),y=1,v)S=v[I],this.getObjectLength(S)&&(w=S.id.split("_")[2],R===(f=parseInt(w.match(/[0-9]+/)[0]))&&(delete S.id,S.range=w.replace(/[0-9]+/,""),m.sheetCellType[R][y]={settings:S},v[I]={},y++));c[R]._scrollTop=this.getSheet(R)._scrollTop,c[R]._scrollLeft=this.getSheet(R)._scrollLeft,R++}return _.isManualCalculation=this._calcEngine.getCalculatingSuspended(),this._isSaveAsJSON=!1,_.sheets.shift(),d}},_isvalidRange:function(e){return new RegExp(/^\$?(?:\b[a-z]{1,3})\$?(?:\d{1,7}):\$?(?:\b[a-z]{1,3})\$?(?:\d{1,7})$/i).test(e)},_renderFUpload:function(){this.element.append(t.buildTag("div","",{height:"0px"},{id:this._id+"_file"})),e("#"+this._id+"_file").ejUploadbox({width:"0px",height:"0px",uploadName:"file",autoUpload:!0,showFileDetails:!1,dialogAction:{content:this.element},saveUrl:this.model.importSettings.importMapper,fileSelect:e.proxy(this._fileSelect,this),complete:e.proxy(this._changeImport,this),error:e.proxy(this._importFailed,this)}),e("#"+this._id+"_file_SelectButton").hide()},_fileSelect:function(t){if(t.files.length){var i,r=t.files[0],l=r.extension;if(this._uploadImage&&(".xlsx"===l||".csv"===l)||!this._uploadImage&&("msie"===this._browserDetails.name&&parseInt(this._browserDetails.version)<10?l.indexOf("jpg")>-1||l.indexOf("png")>-1||l.indexOf("jpeg")>-1||l.indexOf("gif")>-1:r.rawFile.type.indexOf("image")>-1))return this._showAlertDlg("Alert","CorrectFormat","",290),this._uploadImage=!1,!1;"msie"===this._browserDetails.name&&parseInt(this._browserDetails.version)<10||this._uploadImage?this.showWaitingPopUp():((i=e("#"+this._id+"_file")).ejUploadbox("option","autoUpload",!1),this.import({file:r.rawFile,password:this.model.importSettings.password,allowSheetOnDemand:this.model.importSettings.allowSheetOnDemand}),i.find(".e-uploadinput").val(""),t.cancel=!0),this._uploadImage=!1}},_changeImport:function(t){var i,r=e("#"+this._id+"_file").data("ejUploadbox");("msie"===this._browserDetails.name&&parseInt(this._browserDetails.version)<10?t.files[0].extension.indexOf("jpg")>-1||t.files[0].extension.indexOf("png")>-1||t.files[0].extension.indexOf("jpeg")>-1||t.files[0].extension.indexOf("gif")>-1:t.files.rawFile.type.indexOf("image")>-1)?(r.updialog.ejDialog("close"),this.XLShape._insertPicture(t),this.model.showRibbon&&this.XLRibbon._formatTabUpdate(),r.option("autoUpload",!0)):(i="msie"===this._browserDetails.name&&parseInt(this._browserDetails.version)<10?t.responseText:t.xhr.response,r.updialog.ejDialog("close"),this._importSuccess(i)),this.hideWaitingPopUp()},_dlgBeforeOpen:function(){this.hideWaitingPopUp(),e("#"+this._id+"_workBookName").text("'"+e("#"+this._id+"_file").data("ejUploadbox")._files[0].name+"'"+this._getLocStr("Protect"))},_dlgOk:function(){var t,i=e("#"+this._id+"_PasswordDialog").data("ejDialog"),r=e("#"+this._id+"_xlpassword"),l=e("#"+this._id+"_confirmpassword");t=e("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").data("ejToggleButton"),"Protect Workbook"===i.model.title?r.val().length&&l.val().length?r.val()===l.val()?(this.model.exportSettings.password=r.val(),e("#"+this._id+"_AddSheet").addClass("e-disable"),e("#"+this._id+"_confirm").hide(),i.option("title",this._getLocStr("UnProtectWorkbook"))):(e("#"+this._id+"_confirm").show(),this._showAlertDlg("Alert","PasswordAlert1"),t&&t.option("toggleState",!1),i.option("title",this._getLocStr("ProtectWorkbook"))):(e("#"+this._id+"_confirm").show(),t&&t.option("toggleState",!1),i.option("title",this._getLocStr("ProtectWorkbook")),this._showAlertDlg("Alert","PasswordAlert2")):"Unprotect Workbook"===i.model.title&&(this.model.exportSettings.password===r.val()?(e("#"+this._id+"_AddSheet").removeClass("e-disable"),this.model.exportSettings.password=null,e("#"+this._id+"_confirm").show(),i.option("title",this._getLocStr("ProtectWorkbook"))):(i.option("title",this._getLocStr("UnProtectWorkbook")),t&&t.option("toggleState",!0),this._showAlertDlg("Alert","PasswordAlert3"))),r.val(""),l.val(""),e("#"+this._id+"_PasswordDialog").ejDialog("close")},_passwordDlg:function(){var e,i,r,l,n,s;e=t.buildTag("div","","",{id:this._id+"_PasswordDialog"}),n=t.buildTag("div.e-dlg-btnfields"),s=t.buildTag("div.e-dlg-btnctnr"),i="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields'><td><label>"+this._getLocStr("Password")+":</label></td><td><input id ='"+this._id+"_xlpassword' type ='password' class = 'ejinputtext'/></td></tr><tr class= 'e-dlgtd-fields' id ='"+this._id+"_confirm'><td><label>"+this._getLocStr("ConfirmPassword")+"</label></td><td><input id ='"+this._id+"_confirmpassword' type ='password'  class = 'ejinputtext'/></td></tr></table></div>",e.append(i),r=t.buildTag("input","","",{type:"submit"}),l=t.buildTag("input"),r.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),l.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,this),showRoundedCorner:!0,width:60}),n.append(s.append(r,l)),e.append(n),e.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("ProtectWorkbook"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg e-ss-pwddlg",close:t.proxy(this._dlgCancel,this)})},_importPasswordDlg:function(){var i,r,l,n,s,o;return i=t.buildTag("div","","",{id:this._id+"_ImportPasswordDialog"}),s=t.buildTag("div.e-dlg-btnfields"),o=t.buildTag("div.e-dlg-btnctnr"),r="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields'><td><label id ='"+this._id+"_workBookName' ></label></td></tr><tr class= 'e-dlgtd-fields'><td><label>"+this._getLocStr("Password")+":</label></td><td><input id ='"+this._id+"_importpassword' type ='password'  class = 'ejinputtext'/></td></tr></table></div>",i.append(r),l=t.buildTag("input","","",{type:"submit"}),n=t.buildTag("input"),l.ejButton({text:this._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._importDlgOk,this),enabled:!0}),n.ejButton({text:this._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,this),showRoundedCorner:!0,width:60}),s.append(o.append(l,n)),i.append(s),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:this._getLocStr("Password"),beforeOpen:e.proxy(this._dlgBeforeOpen,this),width:420,height:"auto",cssClass:"e-ss-dialog e-"+this._id+"-dlg",close:t.proxy(this._dlgCancel,this)}),i},_dlgCancel:function(){this._showDialog(this._id+"_Ribbon_Review_Changes_ProtectWorkbook");var t=e("#"+this._id+"_PasswordDialog").data("ejDialog");"Protect Workbook"===t.model.title?e("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").ejToggleButton("option","toggleState",!1):"Unprotect Workbook"===t.model.title&&e("#"+this._id+"_Ribbon_Review_Changes_ProtectWorkbook").ejToggleButton("option","toggleState",!0),e("#"+this._id+"_confirmpassword").val(""),e("#"+this._id+"_xlpassword").val(""),e("#"+this._id+"_importpassword").val(""),e("#"+this._id+"_PasswordDialog").ejDialog("close"),e("#"+this._id+"_ImportPasswordDialog").ejDialog("close")},_importDlgOk:function(){var t={},i=e("#"+this._id+"_importpassword");this.model.importSettings.password=i.val(),i.val(""),e("#"+this._id+"_ImportPasswordDialog").ejDialog("close"),t.file=e("#"+this._id+"_file").data("ejUploadbox")._files[0].rawFile,t.password=this.model.importSettings.password,t.allowSheetOnDemand=this.model.importSettings.allowSheetOnDemand,this.import(t)},lockCells:function(e,t){if(!this.model.isReadOnly){var i,r,l=this.getActiveSheetIndex(),n=this.getSheet(l);if(r=0!=t,this.model.allowLockCell&&!n.isSheetProtected){if(i={sheetIdx:l,reqType:"lockCells",range:e=this._getRangeArgs(e,"object",l),isLock:r,type:"actionBegin",action:"lock-cells"},this._trigActionBegin(i))return;if(e=i.range,r=i.isLock,this._isDefaultLocked&&(r=!r),r?this.updateUniqueData({isLocked:!0},e):this.clearRangeData(e,["isLocked"]),this.model.showRibbon&&this.XLRibbon._updateRibbonIcons(),i={sheetIdx:l,reqType:"lockCells",range:e,isLocked:r,type:"actionComplete",action:"lock-cells"},this._trigActionComplete(i))return}}},protectSheet:function(t){if(!this.model.isReadOnly&&!this.model.isGridMode){var i,r,l,n=this.getActiveSheetIndex(),s=this.getSheet(n),o=this.XLRibbon;if(r=!1!==t,this.XLEdit._isEdit&&this.XLEdit.saveCell(),this.model.allowLockCell){if(i={reqType:"protectSheet",isProtect:t,sheetIdx:n,type:"actionBegin",action:"protect-sheet"},this._trigActionBegin(i))return;if(r=i.isProtect,s.isSheetProtected=r,this.model.showRibbon&&((l=e("#"+this._id+"_Ribbon_Review_Changes_LockCell").data("ejToggleButton"))&&l.option("enabled",!r),r?o._disableRibbonIcons():o._enableRibbonIcons(),o._updateRibbonIcons()),s._showLockCellAlert=!0,this.model.allowFormulaBar&&this.updateFormulaBar(),this.model.allowUndoRedo&&(this.model.sheetCount>1?this._removeUndoRedoForCurSheet(n,"undo"):(this._undoCollection=[],this._redoCollection=[])),i={reqType:"protectSheet",isSheetProtected:t,sheetIdx:n,type:"actionComplete",action:"protect-sheet"},!this._isSheetNavigate&&this._trigActionComplete(i))return}}},_readOnly:function(){var e=this.XLRibbon,t=this.element.find("#"+this._id+"_Ribbon_BackStage"),i=this.element.find("#"+this._id+"_inputbox");this.model.isReadOnly?(e._disableRibbonIcons(),e.enableRibbonItems(["Spreadsheet_Ribbon_Home_Clipboard_Copy","Spreadsheet_Ribbon_Review_Comments_ShowAllComments","Spreadsheet_Ribbon_Others_Editing_FindSelect"]),this.XLCMenu&&this.XLCMenu._disableMenuOpt(["Replace","GoTo","GoToSpecial","Formulas","Comments","CFormat","Constants","DataValidation"],"Ribbon_FindRep"),t.length&&(t.find("#saveas_backStageTab").hide(),t.find("#print_backStageTab").hide()),this.addClass(this.element.find("#"+this._id+"_AddSheet")[0],"e-disable"),i.length&&(i[0].disabled=!0)):(e._enableRibbonIcons(),this.XLCMenu&&this.XLCMenu._enableMenuOpt(["Replace","GoTo","GoToSpecial","Formulas","Comments","CFormat","Constants","DataValidation"],"Ribbon_FindRep"),t.length&&(t.find("#saveas_backStageTab").show(),t.find("#print_backStageTab").show()),this._removeClass(this.element.find("#"+this._id+"_AddSheet")[0],"e-disable"),i.length&&(i[0].disabled=!1))},_isPropExists:function(e,t,i,r){for(var l,n,s,o,a,d=0,h=!1;d<e.length;){for(n=(l=this.swapRange(e[d]))[0],s=l[2];n<=s;){for(o=l[1],a=l[3];o<=a;){if(this.XLEdit.getPropertyValue(n,o,t,i)){r||("isLocked"===t?this._popUplockCellAlert():"isReadOnly"===t&&this._showAlertDlg("Alert","ReadOnly","",400)),h=!0;break}o++}if(h)break;n++}if(h)break;d++}return h},_isCellProtected:function(e,t,i){return this.model.allowLockCell&&this.getSheet(this.getActiveSheetIndex()).isSheetProtected&&this.XLEdit.getPropertyValue(e,t,"isLocked")?(i&&this._popUplockCellAlert(),!0):this.XLEdit.getPropertyValue(e,t,"isReadOnly")?(this._showAlertDlg("Alert","ReadOnly","",400),!0):void 0},_popUplockCellAlert:function(){this.getSheet(this.getActiveSheetIndex())._showLockCellAlert&&this._showAlertDlg("Alert","LockAlert","",500)},_removeUndoRedoForCurSheet:function(e,t){var i="undo"===t?this._undoCollection:this._redoCollection,r=i.length;if(r)for(;r--;)e===i[r].sheetIndex&&i.splice(r,1);"undo"===t&&this._removeUndoRedoForCurSheet(e,"redo")},_detailsFromGlobalSpan:function(i,r,l,n,s,o){var a,d,h,c="e-rowcell e-wrapword ",u=this.getRangeData({range:[i,r,i,r],property:["format","border","wrap"]})[0],g=u.format,p=u.border,m=u.wrap;return h=!t.isNullOrUndefined(s),n=n||"K",a=e(h?"#"+this._id+"_emptyDiv":"#"+this._id+"_emptySpan"),s&&(a[0].style.width=s-4+"px"),t.isNullOrUndefined(g)||(c+=g+" "),t.isNullOrUndefined(p)?a[0].className.indexOf("e-rowcell")>-1&&(a[0].style.borderRight=0):c+=p+" ",t.isNullOrUndefined(m)||(c+="e-sswraptext"),this.addClass(a[0],c),a[0].className.indexOf("e-rowcell")>-1&&(a[0].style.padding=0),a.text(n),"height"===l?(d="msie"===this._browserDetails.name&&"8.0"===this._browserDetails.version?Math.ceil(a.outerHeight()):a[0].getBoundingClientRect().height,!o&&this.model.rowHeight>d&&(d=this.model.rowHeight)):(d="msie"===this._browserDetails.name&&"8.0"===this._browserDetails.version?Math.ceil(a.outerWidth()):a[0].getBoundingClientRect().width,!o&&this.model.columnWidth>d&&(d=this.model.columnWidth)),this._refreshGlobalSpan(null,h),d},_writeRule:function(e,t){var i,r;t=this.getSheetElement(t).index()+1,r="#"+this._id+" .e-sheet:nth-child("+t+") .e-content td.e-rowcell:nth-of-type("+(e+1)+")",(i=document.getElementById(this._id+"_sshide")).sheet.insertRule(r+"{display: none}",i.sheet.cssRules.length)},_deleteRule:function(e,t){var i,r,l,n;t=this.getSheetElement(t).index()+1;var s=(i=document.getElementById(this._id+"_sshide")).sheet.cssRules,o=" .e-sheet:nth-child("+t+") ",a=".e-rowcell:nth-of-type("+(e+1)+")";for("msie"===this._browserDetails.name&&(o=" :nth-child("+t+").e-sheet ",a=":nth-of-type("+(e+1)+").e-rowcell"),r="#"+this._id+o+".e-content td"+a,l=0,n=s.length;l<n;l++)if(s[l].selectorText===r){i.sheet.deleteRule(l);break}},_refreshRowHeight:function(e,t){var i=this.XLEdit.getPropertyValue(t,0,"pHeight"),r=this.getSheet(e);this.isUndefined(i)||(this.XLEdit._updateDataContainer({rowIndex:t,colIndex:0},{dataObj:{cHeight:i,pHeight:r.rowsHeightCollection[t]}}),r.rowsHeightCollection[t]=i,this._isRowViewable(e,t)&&(this.getRows(e)[1][this._getRowIdx(t)].style.height=i+"px"))},_batchAddRow:function(e,t,i,r){var l,n,s,o,a,d=0,h=e,c=this.getDataSettings(i);if(c)for(;h<=t;){for(;d<c.length;)o=(n=c[d]).range,a=n.batchChanges.deleted,h>o[0]&&h<=o[2]+1?(s=o[0]?this._getPosDiff(h,o[0]):h,!n.fieldAsColumnHeader&&n.showHeader&&(s-=1),l=this._getRowData(h,o[1],o[3],n),n._jsonData.splice(s,0,l),n._isDataManager&&(r?a.length?a.pop():a.push(l):n.batchChanges.added.push(n._jsonData[s])),o[2]++,n.count++):h<=o[0]&&(o[2]++,o[0]++),d++;d=0,h++}},_batchDeleteRow:function(e,t,i,r){var l,n,s,o,a,d,h=0,c=t,u=this.getDataSettings(i);if(u)for(;c>=e;){for(;h<u.length;)o=(n=u[h]).range,a=n.batchChanges.added,c>=o[0]&&c<=o[2]?(s=o[0]?this._getPosDiff(c,o[0]):c,!n.fieldAsColumnHeader&&n.showHeader&&(s-=1),l=n._jsonData.splice(s,1)[0],n._isDataManager&&(r?a.length?(d=a.indexOf(l))>-1&&a.splice(d,1):a.push(l):n.batchChanges.deleted.push(l)),o[2]--,n.count--):c<o[0]&&(o[2]--,o[0]--),h++;h=0,c--}},_updateBatchDetails:function(t,i,r){var l,n,s,o,a,d,h,c,u=!0,g=0,p=this.getDataSettings(r);if(p)for(;g<p.length;){if((s=(c=p[g]).range)&&this.inRange(s,t,i)){h=c.batchChanges.changed,l=s[0]?this._getPosDiff(t,s[0]):t,n=s[1]?this._getPosDiff(i,s[1]):i,!c.fieldAsColumnHeader&&c.showHeader&&(t===s[0]?u=!1:l-=1),u&&(d=c._jsonData[l],o=c.fields[n],a=this.getRangeData({range:[t,i,t,i],valueOnly:!0,sheetIdx:r,skipFormula:!0})[0],(this.isUndefined(a)||this._isEmptyString(a))&&(a=null),d&&d[o]!==a&&(d[o]=a,!c.primaryKey||o!==c.primaryKey||this.XLEdit.getPropertyValue(t,i,"isReadOnly",r)||this.isUndefined(a)||this.XLEdit._updateDataContainer({rowIndex:t,colIndex:i},{dataObj:{isReadOnly:!0}}),c._isDataManager&&-1===e.inArray(d,h)&&-1===e.inArray(d,c.batchChanges.added)&&h.push(d)));break}g++}},_getRowData:function(e,i,r,l){for(var n,s={},o=i,a=0,d=l.fields;o<=r;)n=this.getRangeData({range:[e,o,e,o],valueOnly:!0,skipDateTime:!0})[0],this._isEmptyString(n)&&(n=null),l.primaryKey&&d[a]===l.primaryKey&&t.isNullOrUndefined(n)&&(n=0),s[d[a]]=n,o++,a++;return s},saveBatchChanges:function(e){var t,i,r,l,n=0,s=this,o=this.getSheet(e),a=this.getDataSettings(e);if(a)for(;n<a.length;)(t=a[n])._isDataManager&&(i={sheetIdx:e,dataSetting:t,batchChanges:l=t.batchChanges},!this._trigger("beforeBatchSave",i)&&(l.changed.length||l.added.length||l.deleted.length)&&(r=t._dataManager.saveChanges(l,t.primaryKey,t.query._fromTable),t._isOffline||(this.showWaitingPopUp(),r.done(function(){o._resCnt++,o._reqCnt===o._resCnt&&s.hideWaitingPopUp()}),r.fail(function(){o._resCnt++,o._reqCnt===o._resCnt&&s.hideWaitingPopUp()}),o._reqCnt++,t.batchChanges={added:[],changed:[],deleted:[]}))),n++},setReadOnly:function(e){this.updateUniqueData({isReadOnly:!0},e);var t={reqType:"setreadonly",range:e,sheetIndex:this.getActiveSheetIndex()};this._trigActionComplete(t)},removeReadOnly:function(e){this.clearRangeData(e,["isReadOnly"])},_updateCustomFormulas:function(e,t){for(var i,r=this._calcEngine,l=0,n=e.length;l<n;l++)"add"===t&&this.isUndefined(this.getCalcEngine().getLibraryFunctions().getItem(e[l].formulaName))&&!this.XLEdit._isNamedRange("="+e[l].formulaName)?(i=r.addCustomFunction(e[l].formulaName,e[l].functionName),this._formulaCollection.push({text:"="+e[l].formulaName,display:e[l].formulaName})):"delete"===t&&r.getCustomLibraryFunctions().contains(e[l].formulaName)?i=r.removeFunction(e[l].formulaName,e[l].functionName):this._showAlertDlg("Alert","CorrectFormula","FormulaAlert",372);return i},addCustomFormula:function(e,t){this.model.isReadOnly||this._updateCustomFormulas([{formulaName:e,functionName:t}],"add")&&(this.model.customFormulas.push({formulaName:e,functionName:t}),this.XLEdit._refreshAutoComplete())},removeCustomFormula:function(e,t){var i,r,l;if(!this.model.isReadOnly&&this._updateCustomFormulas([{formulaName:e.toUpperCase(),functionName:t}],"delete")){for(i=0,l=(r=this.model.customFormulas).length;i<l;i++)r[i].formulaName===e&&r.splice(1,parseInt(i));this._updateFormulaCollection(),this.XLEdit._refreshCalcEngine(null,null,!1,null,null),this.XLEdit._refreshAutoComplete()}},getValueFromFormulaArg:function(e){var t,i,r,l,n,s,o=1,a=this._calcEngine,d={},h=[];for(l=0,n=(i=e.split(a.getParseArgumentSeparator())).length;l<n;l++)h=h.concat(i[l].indexOf(":")>-1?a.getCellsFromArgs(i[l]):[i[l]]);for(t=0,s=h.length;t<s;t++)r=a.getValueFromArg(h[t]),d["arg"+o]=this.XLEdit._parseValue(r).value,h.indexOf(r)>-1&&'"'===r[0]&&'"'===r[r.length-1]&&(d["arg"+o]=r.substring(1,r.length-1)),o++;return d},getCalcEngine:function(){return this._calcEngine},_updateFormatColl:function(e,t,i,r){var l=this.getSheet(e)._formatColl;r>this.model.rowHeight?(this.isUndefined(l[t])&&(l[t]={}),l[t][i]=r):(t in l&&i in l[t]&&delete l[t][i],l[t]&&this.getObjectLength(l[t])<1&&delete l[t])},_getFormattedHeight:function(e,i){var r=this.getSheet(e);return t.max(this._getObjectValues(r._formatColl[i]))||this.model.rowHeight},getVisibleCellDetails:function(){var e=this.getSheet();return{topLeftCell:e.topLeftCell,rowCount:e._bottomRow.idx-e._topRow.idx,colCount:e._rightCol.idx-e._leftCol.idx}}}),t.Spreadsheet.Locale=t.Spreadsheet.Locale||{},t.Spreadsheet.Locale.default=t.Spreadsheet.Locale["en-US"]={Cut:"Cut",Copy:"Copy",FormatPainter:"Format Painter",Paste:"Paste",PasteValues:"Paste Values Only",PasteSpecial:"Paste",Filter:"Filter",FilterContent:"Turn on filtering for the selected cells.",FilterSelected:"Filter by Selected Cell's value",Sort:"Sort",Clear:"Clear",ClearContent:"Delete everything in the cell, or remove just the formatting, contents, comments or hyperlinks.",ClearFilter:"Clear Filter",ClearFilterContent:"Clear the filter and sort state for the current range of data.",SortAtoZ:"Sort A to Z",SortAtoZContent:"Lowest to Highest.",SortZtoA:"Sort Z to A",SortZtoAContent:"Highest to Lowest.",SortSmallesttoLargest:"Sort Smallest to Largest",SortLargesttoSmallest:"Sort Largest to Smallest",SortOldesttoNewest:"Sort Oldest to Newest",SortNewesttoOldest:"Sort Newest to Oldest",Insert:"Insert",InsertTitle:"Insert Cells",InsertContent:"Add new cells, rows, or columns to your workbook.",MultipleInsertContent:"FYI: To insert multiple rows or columns at a time, select multiple rows or columns in the sheet, and click Insert.",InsertSBContent:"Add cells, rows, columns, or sheets to your workbook.",Delete:"Delete",DeleteTitle:"Delete Cells",DeleteContent:"Delete cells, rows, columns, or sheets from your workbook.",MultipleDeleteContent:"FYI: To delete multiple rows or columns at a time, select multiple rows or columns in the sheet, and click Delete.",FindSelectTitle:"Find & Select",FindSelectContent:"Click to see options for finding text in your document.",CalculationOptions:"Calculation Options",CalcOptTitle:"Calculation Options",CalcOptContent:"Choose to calculate formulas automatically or manually.",CalcOptRecalcContent:"If you make a change that affects a value, Spreadsheet will automatically recalculate it.",CalculateSheet:"Calculate Sheet",CalculateNow:"Calculate Now",CalculateNowContent:"Calculate the entire workbook now.",CalculateNowTurnOffContent:"You only need to use this if automatic calculation is turned off.",CalculateSheetContent:"Calculate the active sheet now.",CalculateSheetTurnOffContent:"You only need to use this if automatic calculation is turned off.",Title:"Spreadsheet",ColorPicker:"Color Picker",Ok:"OK",Cancel:"Cancel",Alert:"We couldn't do this for the selected range of cells. Select a single cell within a range of data and then try again.",HeaderAlert:"The command could not be completed as you are attempting to filter with the filter header. Select a single cell in the filter range and try the command again.",FlashFillAlert:"All the data next to your selection was checked and there was no pattern for filling in values.",Formatcells:"Format Cells",FontFamily:"Font",FFContent:"Pick a new font for your text.",FontSize:"Font Size",FSContent:"Change the size of your text.",IncreaseFontSize:"Increase Font Size",IFSContent:"Make your text a bit bigger.",DecreaseFontSize:"Decrease Font Size",DFSContent:"Make your text a bit smaller.",Bold:"Bold",Italic:"Italic",Underline:"Underline",Linethrough:"Linethrough",FillColor:"Fill Color",FontColor:"Font Color",TopAlign:"Top Align",TopAlignContent:"Align text to the top.",MiddleAlign:"Middle Align",MiddleAlignContent:"Align text so that it is centered between the top and bottom of the cell.",BottomAlign:"Bottom Align",BottomAlignContent:"Align text to the bottom.",WrapText:"Wrap Text",WrapTextContent:"Wrap extra-long text into multiple lines so you can see all of it.",AlignLeft:"Align Left",AlignLeftContent:"Align your content to the left.",AlignCenter:"Center",AlignCenterContent:"Center your content.",AlignRight:"Align Right",AlignRightContent:"Align your content to the right.",IncreaseIndent:"Increase Indent",IncreaseIndentContent:"Move your content farther away from the cell border.",DecreaseIndent:"Decrease Indent",DecreaseIndentContent:"Move your content closer to the cell border.",Undo:"Undo",Redo:"Redo",NumberFormat:"Number Format",NumberFormatContent:"Choose the format for your cells, such as percentage, currency, date or time.",AccountingStyle:"Accounting Style",AccountingStyleContent:"Format as dollar accounting number format.",PercentageStyle:"Percent Style",PercentageStyleContent:"Format as a percent.",CommaStyle:"Comma Style",CommaStyleContent:"Format with a thousands separator.",IncreaseDecimal:"Increase Decimal",IncreaseDecimalContent:"Show more decimal places for a more precise value.",DecreaseDecimal:"Decrease Decimal",DecreaseDecimalContent:"Show fewer decimal places.",AutoSum:"AutoSum",AutoSumTitle:"Sum",AutoSumContent:"Automatically add a quick calculation to your worksheet, such as sum or average.",Fill:"Fill",ExportXL:"Excel",ExportCsv:"CSV",ExportPdf:"PDF",BackgroundColor:"Fill Color",BGContent:"Color the background of the cells to make them stand out.",ColorContent:"Change the color of your text.",Border:"Border",BorderContent:"Apply borders to the currently selected cells.",BottomBorder:"Bottom Border",TopBorder:"Top Border",LeftBorder:"Left Border",RightBorder:"Right Border",OutsideBorder:"Outside Borders",NoBorder:"No Border",AllBorder:"All Borders",ThickBoxBorder:"Thick Box Border",ThickBottomBorder:"Thick Bottom Border",BottomDoubleBorder:"Bottom Double Border",TopandBottomDoubleBorder:"Top and Bottom Double Border",TopandThickBottomBorder:"Top and Thick Bottom Border",DrawBorderGrid:"Draw Border Grid",DrawBorder:"Draw Border",TopandBottomBorder:"Top and Bottom Border",BorderColor:"Line Color",BorderStyle:"Line Style",Number:"Number is used for general display of numbers. Currency and Accounting offer specialized formatting for monetary value.",General:"General format cells have no specific number format.",Currency:"Currency formats are used for general monetary values. Use Accounting formats to align decimal points in a column.",Accounting:"Accounting formats line up the currency symbols and decimal points in a column.",Text:"Text format cells are treated as text even when a number is in the cell. The cell is displayed exactly as entered.",Percentage:"Percentage formats multiply the cell value by 100 and displays the result with a percent symbol.",CustomMessage:"Type number format code, using one of existing codes as a starting point.",Fraction:"Fraction is used to indicate a part of a whole number or a ratio between two numbers.",Scientific:"Scientific is used to represent a decimal number between 1 and 10 multiplied by ten, so the large numbers using less digits.",Type:"Type:",CustomFormatAlert:"Enter a valid format",Date:"Date formats display date and time serial numbers as date values.",Time:"Time formats display date and time serial numbers as date values.",File:"FILE",New:"New",Open:"Open",SaveAs:"Save As",Print:"Print",PrintContent:"Print the current sheet.",PrintSheet:"Print Sheet",PrintSelected:"Print Selected",PrintSelectedContent:"Select an area on the sheet you would like to print.",HighlightVal:"Format Invalid Data",ClearVal:"Clear Validation",Validation:"Validation",DataValidation:"Data Validation",DVContent:"Pick from a list of rules to limit the type of data that can be entered in a cell.",PageSize:"Page Size",PageSizeContent:"Choose a page size for your document.",FormatCells:"FormatCells",ConditionalFormat:"Conditional Formatting",CFContent:"Easily spot trends and patterns in your data using colors to visually highlight important values.",And:"and",With:"with",GTTitle:"Greater Than",GTContent:"Format cells that are GREATER THAN:",LTTitle:"Less Than",LTContent:"Format cells that are LESS THAN:",BWTitle:"Between",BWContent:"Format cells that are BETWEEN:",EQTitle:"Equal To",EQContent:"Format cells that are EQUAL TO:",DateTitle:"A Date Occurring",DateContent:"Format cells that contain a DATE:",ContainsTitle:"Text That Contains",ContainsContent:"Format cells that contain the text:",GreaterThan:"Greater Than",LessThan:"Less Than",Between:"Between",EqualTo:"Equal To",TextthatContains:"Text that Contains",DateOccurring:"A Date Occurring",ClearRules:"Clear Rules",ClearRulesfromSelected:"Clear Rules from Selected Cells",ClearRulesfromEntireSheets:"Clear Rules from Entire Sheet",CellStyles:"Cell Styles",CellStylesContent:"A colorful style is a great way to make important data stand out on the sheet.",CellStyleHeaderText:"Good, Bad and Neutral/Titles and Headings/Themed Cell Styles",Custom:"Type the number format code, using one of the existing codes as starting point.",CellStyleGBN:"Normal/Bad/Good/Neutral",CellStyleTH:"Heading 4/Title",Accent:"Accent",Style:"Style",FormatAsTable:"Format As Table",FormatasTable:"Format as Table",FATContent:"Quickly convert a range of cells to a table with its own style.",FATHeaderText:"Light/Medium/Dark",FATNameDlgText:"Table Name:/My table has headers",InvalidReference:"The range you have specified is invalid",ResizeAlert:"The specified range is invalid. The top of the table must remain in the same row, and the resulting table must overlap the original table. Specify a valid range.",RangeNotCreated:"Increasing the row beyond the maximum sheet rowcount is restricted in Format as Table.",ResizeRestrictAlert:"Increase or decrease of column count and decrease of row count is restricted in Format as Table.",FATResizeTableText:"Enter new data range for your table:",FATReizeTableNote:"Note: The headers must remain in the same row and the resulting table range must overlap the original table range.",FormatAsTableAlert:"Cannot create a table with a single row. A table must have at least two rows, one for the table header, and one for data",FormatAsTableTitle:"Light 1/Light 2/Light 3/Light 5/Light 8/Light 9/Light 10/Light 12/Light 15/Light 16/Light 17/Light 19/Medium 8/Medium 9/Medium 10/Medium 12/Medium 22/Medium 23/Medium 24/Medium 26/Dark 1/Dark 2/Dark 3/Dark 5",NewTableStyle:"New Table Style",ResizeTable:"Resize Table",ResizeTableContent:"Resize this table by adding or removing rows and columns.",ConvertToRange:"Convert to Range",ConvertToRangeContent:"Convert this table into a normal range of cells.",ConverToRangeAlert:"Do you want to convert the table to a normal range?",TableID:"Table ID:",Table:"Table",TableContent:"Create a table to organize and analyze related data.",TableStyleOptions:"First Column/Last Column/Total Row/Filter Button",Format:"Format",NameManager:"Name Manager",NameManagerContent:"Create, edit, delete and find all the names used in the workbook.",NameManagerFormulaContent:"Names can be used in formulas as substitutes for cell references.",DefinedNames:"Defined Names",DefineName:"Define Name",DefineNameContent:"Define and apply names.",UseInFormula:"Use In Formula",UseInFormulaContent:"Choose a name used in this workbook and insert it into the current formula.",RefersTo:"Refers To",Name:"Name",Scope:"Scope",NMNameAlert:"The name that you entered is not valid./Reason for this can include:/The name does not begin with a letter or an underscore/The name contains a space or other invalid characters/The name conflicts with a spreadsheet built-in name or the name of another object in the workbook",NMUniqueNameAlert:"The name entered already exists. Enter a unique name.",NMRangeAlert:"Enter a valid range",FORMULAS:"FORMULAS",Value:"Values",DataValue:"Values:",Formula:"Formulas",MissingParenthesisAlert:"Your formula is missing a parenthesis--) or (. Check the formula, and then add the parenthesis in the appropriate place.",UnsupportedFile:"Unsupported File",IncorrectPassword:"Unable to open the file or worksheet with the given password",InvalidUrl:"Please specify proper URL",Up:"Up",Down:"Down",Sheet:"Sheet",Workbook:"Workbook",Rows:"By Rows",Columns:"By Columns",FindReplace:"Find Replace",FindnReplace:"Find and Replace",Find:"Find",Replace:"Replace",FindLabel:"Find what:",ReplaceLabel:"Replace with:",ReplaceAll:"Replace All",Close:"Close",FindNext:"Find Next",FindPrev:"Find Prev",Automatic:"Automatic",Manual:"Manual",Settings:"Settings",MatchCase:"Match case",MatchAll:"Match entire cell contents",Within:"Within:",Search:"Search:",Lookin:"Look in:",ShiftRight:"Shift cells right",ShiftBottom:"Shift cells down",EntireRow:"Entire row",EntireColumn:"Entire column",ShiftUp:"Shift cells up",ShiftLeft:"Shift cells left",Direction:"Direction:",GoTo:"Go To",GoToName:"Go to:",Reference:"Reference:",Special:"Special",Select:"Select",Comments:"Comments",Formulas:"Formulas",Constants:"Constants",RowDiff:"Row differences",ColDiff:"Column differences",LastCell:"Last cell",CFormat:"Conditional formats",Blanks:"Blanks",GotoError:"Error",GotoLogicals:"Logicals",GotoNumbers:"Numbers",GotoText:"Text",FindSelect:"Find & Select",Comment:"Comment",NewComment:"New",InsertComment:"Insert Comment",EditComment:"Edit",DeleteComment:"Delete Comment",DeleteCommentContent:"Delete the selected comment.",HideComment:"Hide Comment",Next:"Next",NextContent:"Jump to the next comment.",Previous:"Previous",PreviousContent:"Jump to the previous comment.",ShowHide:"Show/Hide Comment",ShowHideContent:"Show or hide the comment on the active cell.",ShowAll:"Show All Comments",ShowAllContent:"Display all comments in the sheet.",UserName:"User Name",Hide:"Hide",Unhide:"Unhide",Add:"Add",DropAlert:"Do you want to replace the existing data?",PutCellColor:"Put Selected Cell Color To The Top",PutFontColor:"Put Selected Font Color To The Top",WebPage:"Web Page",WorkSheet:"Worksheet Reference",SheetReference:"Sheet Reference",InsertHyperLink:"Insert Hyperlink",HyperLink:"Hyperlink",EditLink:"Editlink",OpenLink:"Openlink",HyperlinkText:"Text:",RemoveLink:"Removelink",WebAddress:"Web Address:",CellAddress:"Cell Reference:",SheetIndex:"Select a place in this document",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearContents:"Clear Contents",ClearComments:"Clear Comments",ClearHyperLinks:"Clear Hyperlinks",SortFilter:"Sort & Filter",SortFilterContent:"Organize your data so it's easier to analyze.",NumberStart:"Minimum:",NumberEnd:"Maximum:",DecimalStart:"Minimum:",DecimalEnd:"Maximum:",DateStart:"Start Date:",DateEnd:"End Date:",ListStart:"Source:",FreeText:"Show error after invalid data is entered",ListEnd:"Cell Reference:",TimeStart:"Start Time:",TimeEnd:"End Time:",TextLengthStart:"Minimum:",TextLengthEnd:"Maximum:",CommentFindEndAlert:"Spreadsheet reached the end of the workbook. Do you want to continue reviewing from the beginning of the workbook?",InsertSheet:"Insert",DeleteSheet:"Delete",RenameSheet:"Rename",MoveorCopy:"Move or Copy",HideSheet:"Hide",UnhideSheet:"Unhide",SheetRenameAlert:"That name is already taken. Try a different one.",SheetRenameEmptyAlert:"You typed an invalid name for a sheet. Make sure that:",SheetRenameEmptyCharExceedAlert:"The name that you type does not exceed 31 characters.",SheetRenameEmptySplCharAlert:"The name does not contain any of the following characters: ",SheetRenameEmptyBlankAlert:"You did not leave the name blank.",SheetDeleteAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",SheetDeleteErrorAlert:"A workbook must contain at least one visible worksheet. To hide, delete, or move the selected sheet, you must first insert a new sheet or unhide a sheet that is already hidden.",CtrlKeyErrorAlert:"That command cannot be used on  multiple selections.",ClipboardAccessError:"Your browser can't access the clipboard, so use these shortcuts:",MoveToEnd:"Move To End",Beforesheet:"Before sheet:",CreateaCopy:"Create a copy",AutoFillOptions:"Copy Cells/Fill Series/Fill Formatting Only/Fill Without Formatting/Flash Fill",NumberValidationMsg:"Enter only digits",DateValidationMsg:"Enter only date",Required:"Required",TimeValidationMsg:"The value you entered for the Time is invalid.",CellAddrsValidationMsg:"Reference is not valid.",PivotTable:"Pivot Table",PivotTableContent:"Easily arrange and summarize complex data in a PivotTable.",NumberTab:"Number",AlignmentTab:"Alignment",FontTab:"Font",FillTab:"Fill",TextAlignment:"Text alignment",Horizontal:"Horizontal:",Vertical:"Vertical:",Indent:"Indent",TextControl:"Text Control",FontGroup:"Font:",FontStyle:"Font style",Size:"Size:",PSize:"Page size",Effects:"Effects",Color:"Color",StrikeThrough:"Strikethrough",Overline:"Overline",NormalFont:"Normal font",Preview:"Preview",Line:"Line",Presets:"Presets",None:"None",Outline:"Outline",AllSide:"All sides",InsCells:"Insert Cells",InsRows:"Insert Sheet Rows",InsCols:"Insert Sheet Columns",InsSheet:"Insert Sheet",DelCells:"Delete Cells",DelRows:"Delete Sheet Rows",DelCols:"Delete Sheet Columns",DelSheet:"Delete Sheet",HyperLinkAlert:"The address of this site is not valid.Check the address and try again.",ReplaceData:"All done. We made / replacements.",NotFound:"We couldn't find what you were looking for. Select settings tab for more ways to search",Data:"Data:",Allow:"Allow:",IgnoreBlank:"Ignore blank",NotFind:"Unable to find the match to replace",FreezeTopRow:"Freeze Top Row",FreezeFirstColumn:"Freeze First Column",UnFreezePanes:"Unfreeze Panes",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",ImageValAlert:"Upload image files only",Pictures:"Pictures",PicturesTitle:"From File",PicturesContent:"Insert pictures from computer or from other computers that you are connected to.",ImportAlert:"Are you sure you want to destroy the current workbook without saving and open a new workbook?",UnmergeCells:"Unmerge Cells",MergeCells:"Merge Cells",MergeAcross:"Merge Across",MergeAndCenter:"Merge & Center",MergeAndCenterContent:"Combine and center the contents of the selected cells in a new larger cell.",MergeCellsAlert:"Merging Cells keeps only upper left cell value and discards the other values.",MergeInsertAlert:"This operation will causes some merged cells to unmerge. Do you wish to continue?",Axes:"Axes",PHAxis:"Primary Horizontal",PVAxis:"Primary Vertical",AxisTitle:"Axis Title",CTNone:"None",CTCenter:"Center",CTFar:"Far",CTNear:"Near",DataLabels:"Data Labels",DLNone:"None",DLCenter:"Center",DLIEnd:"Inside End",DLIBase:"Inside Base",DLOEnd:"Outside End",ErrorBar:"Error Bars",Gridline:"Gridlines",PMajorH:"Primary Major Horizontal",PMajorV:"Primary Major Vertical",PMinorH:"Primary Minor Horizontal",PMinorV:"Primary Minor Vertical",Legend:"Legends",LNone:"None",LLeft:"Left",LRight:"Right",LBottom:"Bottom",LTop:"Top",ChartTitleDlgText:"Enter Title",ChartTitle:"Title",InvalidTitle:"You typed an invalid name for the Title.",CorrectFormat:"Select the correct Format File",ResetPicture:"Reset Picture",ResetPictureContent:"Discard all of the formatting changes made to this picture.",PictureBorder:"Picture Border",PictureBorderContent:"Pick the color, width, and line style for the outline of your shape.",ResetSize:"Reset Picture & Size",Height:"Height",Width:"Width",ThemeColor:"Theme Colors",NoOutline:"No Outline",Weight:"Weight",Dashes:"Dashes",ColumnChart:"Column",ColumnChartTitle:"Insert Column Chart",ColumnChartContent:"Use this chart type to visually compare values across a few categories.",BarChart:"Bar",BarChartTitle:"Insert Bar Chart",BarChartContent:"Use this chart type to visually compare values across a few categories when the chart shows duration or the category text is long.",StockChart:"Radar",StockChartTitle:"Insert Radar Chart",StockChartContent:"Use this chart type to show values relative to a center point.",LineChart:"Line",LineChartTitle:"Insert Line Chart",LineChartContent:"Use this chart type to show trends over time (years, months, and days) or categories.",AreaChart:"Area",AreaChartTitle:"Insert Area Chart",AreaChartContent:"Use this chart type to show trends over time (years, months, and days) or categories. Use it to highlight the magnitude of change over time.",ComboChart:"Combo",PieChart:"Pie",PieChartTitle:"Insert Pie/Doughnut Chart",PieChartContent:"Use this chart type to show proportions of a whole. Use it when the total of your numbers is 100%.",ScatterChart:"Scatter",ScatterChartTitle:"Insert Scatter (X, Y) Chart",ScatterChartContent:"Use this chart type to show the relationship between sets of values.",ClusteredColumn:"Clustered&nbsp;Column",StackedColumn:"Stacked&nbsp;Column",ClusteredBar:"Clustered&nbsp;Bar",StackedBar:"Stacked&nbsp;Bar",Radar:"Radar",RadarMarkers:"Radar&nbsp;with&nbsp;Markers",LineMarkers:"Line&nbsp;with&nbsp;Markers",Area:"Area",StackedArea:"Stacked&nbsp;Area",Pie:"Pie",Doughnut:"Doughnut",Scatter:"Scatter",ChartRange:"Chart Range",XAxisRange:"Enter X-axis range:",YAxisRange:"Enter Y-axis range:",LegendRange:"Enter legend range:",YAxisMissing:"Enter Y-axis range to create chart",InvalidYAxis:"Y-axis range must be within the selected range",InvalidXAxis:"X-axis range must be within the selected range",InvalidLegend:"Legend range must be within the selected range",InvalidXAxisColumns:"X-axis range should be within a single column",FreezePanes:"Freeze Panes",FreezePanesContent:"Freeze a portion of the sheet to keep it visible while you scroll through the rest of the sheet.",PasteContent:"Add content on the Clipboard to your document.",PasteSplitContent:"Pick a paste option, such as keeping formatting or pasting only content.",CutContent:"Remove the selection and put it on the Clipboard so you can paste it somewhere else.",CopyContent:"Put a copy of the selection on the Clipboard so you can paste it somewhere else.",FPTitle:"Format Painter",FPContent:"Like the look of a particular selection? You can apply that look to other content in the document.",BoldContent:"Make your text bold.",ItalicContent:"Italicize your text.",ULineContent:"Underline your text.",LineTrContent:"Cross something out by drawing a strike through it.",UndoContent:"Undo your last action.",RedoContent:"Redo your last action.",HyperLinkTitle:"Add a Hyperlink",HyperLinkContent:"Create a link in your document for quick access to webpages and files.",HyperLinkPlaceContent:"Hyperlinks can also take you to places in your document.",NewCommentTitle:"Insert a Comment",NewCommentContent:"Add a note about this part of the document.",RefreshTitle:"Refresh",RefreshContent:"Get the latest data from the source connected to the active cell",FieldListTitle:"Field List",FieldListContent:"Show or hide the Field List.",FieldListRemoveContent:"The field list allows you to add and remove fields from your PivotTable report",AddChartElement:"Add Chart Element",AddChartElementContent:"Add elements to the created chart.",SwitchRowColumn:"Switch Row/ Column",SwitchRowColumnContent:"Swap the data over the axis.",MergeAlert:"We can't do that to a merged cell.",UnhideDlgText:"Unhide Sheet:",ChartThemes:"Chart Themes",ChartThemesContent:"Pick a new theme for your chart.",ChangePicture:"Change Picture",ChangePictureContent:"Change to a different picture, preserving the formatting and size of the current picture.",ChangeChartType:"Change Chart Type",SelectData:"Select Data",SelectDataContent:"Change the data range included in the chart.",Sum:"Sum",Average:"Average",CountNumber:"Count Numbers",Max:"Max",Min:"Min",ChartTypeContent:"Change to a different chart type.",AllCharts:"All Charts",defaultfont:"Default",LGeneral:"General",LCurrency:"Currency",LAccounting:"Accounting",LDate:"Date",LTime:"Time",LPercentage:"Percentage",LFraction:"Fraction",LScientific:"Scientific",LText:"Text",LCustom:"Custom",LShortdate:"Short Date",LLongdate:"Long Date",FormatSample:"Sample",Category:"Category:",Top:"Top",Center:"Center",Bottom:"Bottom",Left:"Left (Indent)",Right:"Right",Justify:"Justify",GeneralTxt:"General format cells have no specific number format.",NegativeNumbersTxt:"Negative Numbers",ThousandSeparatorTxt:"Use 1000 Separator",DecimalPlacesTxt:"Decimal Places:",TextTxt:"Text format cells are treated as text even when a number is in the cell. The cell is displayed exactly as entered.",BoldItalic:"Bold Italic",Regular:"Regular",HyperLinkHide:"<<Selection in Document>>",InvalidSheetIndex:"Specify proper SheetIndex",HugeDataAlert:"File too large to open.",ImportExportUrl:"Give import/export URL and try again.",BetweenAlert:"The Maximum must be greater or equal to the Minimum.",BorderStyles:"Solid/Dashed/Dotted/Double",FPaneAlert:"Freeze Pane is not applied for the First Cell",ReplaceNotFound:"Spreadsheet cannot find a match.",BlankWorkbook:"Blank workbook",SaveAsExcel:"Save As Excel",SaveAsCsv:"Save As CSV",SaveAsPdf:"Save As PDF",Design:"DESIGN",NewName:"New Name",FormulaBar:"Formula Bar",NameBox:"Name Box",NumberValMsg:"Decimal values cannot be used for number conditions.",NumberAlertMsg:"Enter only digits.",ListAlert:"Cell range is incorrect, Please enter correct cell range.",ListValAlert:"The list source must be a delimited list, or a reference to single row or column.",ListAlertMsg:"The value you entered is not valid",AutoFillTitle:"AutoFillOptions",NewSheet:"New Sheet",FullSheetCopyPasteAlert:"We can't paste because the Copy area and paste area aren't the same size.",Heading:"Headings",Gridlines:"Gridlines",Firstsheet:"Scroll to the first sheet",Lastsheet:"Scroll to the last sheet",Nextsheet:"Scroll to the next sheet",Prevsheet:"Scroll to the previous sheet",ProtectWorkbook:"Protect Workbook",UnProtectWorkbook:"Unprotect Workbook",ProtectWBContent:"Keep others from making structural changes to your workbook",Password:"Password",ConfirmPassword:"Reenter password to proceed:",PasswordAlert1:"Confirmation password is not identical.",PasswordAlert2:"Please enter a password.",PasswordAlert3:"The password you supplied is not correct. Verify that the CAPS LOCK key is off and be sure to use the correct capitalization.",Protect:"is protected.",Lock:"LockCell",Unlock:"UnlockCell",Protectsheet:"Protect Sheet",ProtectSheetToolTip:"Prevent unwanted changes from others by limiting their ability to edit",Unprotect:"Unprotect Sheet",LockAlert:"The cell you are trying to change is on protected sheet. To make changes, click Unprotect Sheet in the Review tab.",InsertDeleteAlert:"This operation is not allowed. The operation is attempting to shift cells in a table/Filter range on your worksheet.",CreateRule:"New Rule",NewRule:"New Formatting Rule",NewRuleLabelContent:"Format values where this formula is true:",ReadOnly:"The range you are trying to change contains readonly cells.",CreatePivotTable:"Create PivotTable",Range:"Range:",ChoosePivotTable:"Choose where you want the PivotTable to be placed",NewWorksheet:"New Worksheet",ExistingWorksheet:"Existing Worksheet",Location:"Location:",Refresh:"Refresh",PivotRowsAlert:"This command requires at least two rows of source data. You cannot use the command on a selection in only one row.",PivotLabelsAlert:"The PivotTable field name is not valid, To create a PivotTable report, you must use data that is organized as a list with labeled columns. If you are changing the name of a PivotTable field, you must type a new name for the field.",FieldList:"Field List",MergeSortAlert:"To do this, all the merged cells need to be the same size.",FormulaSortAlert:"The sort range with formula cannot be sorted.",MergePreventInsertDelete:"This operation is not allowed. The operation is attempting to shift a merge cells on your worksheet.",FormulaRuleMsg:"Please enter correct format.",MovePivotTable:"Move PivotTable",MovePivotTableContent:"Move the PivotTable to another location in the workbook.",ClearAllContent:"Remove fields and filters.",ChangeDataSource:"Modify",ChangeDataSourceContent:"Change the source data for this PivotTable",ChangePivotTableDataSource:"Change PivotTable Data Source",TotalRowAlert:"This operation is not allowed. The operation is attempting to shift cells in a table on your worksheet. Click OK to proceed with entire row.",CellTypeAlert:"This operation is not allowed in cell type applied range.",PivotOverlapAlert:"A PivotTable report cannot overlap another PivotTable report",NoCellFound:"No cells were found",MoreValidationAlert:"The selection contains more than one type of validation. Erase current settings and continue ?",CorrectArgument:"Please enter the correct argument",CorrectFormula:"Please enter the correct formula",CorrectCellAddress:"Please enter the correct cell address",ChartType:"Chart Type",NumberValidationAlert:"The Maximum must be greater than or equal to Minimum",DateValidationAlert:"The End Date must be greater than or equal to Start Date",TimeValidationAlert:"The End Time must be greater than or equal to Start Time",NewRuleAlert:"There's a problem with this formula",DragAlert:"The command could not be completed as you are attempting to move cells within the filter range. Select a range out of the filter range and try the command again.",OR:"or",HOME:"HOME",INSERT:"INSERT",DATATAB:"DATA",PAGELAYOUT:"PAGE LAYOUT",REVIEW:"REVIEW",OTHERS:"OTHERS",FORMAT:"Format",DESIGN:"DESIGN",CHARTDESIGN:"Chart Design",ANALYZE:"Analyze",FileName:"File Name",Save:"Save",SaveFile:"Save the file ",HighlightCellRules:"Highlight Cell Rules",LightRedFillDark:"Light Red Fill with Dark Red Text",YellowFillDark:"Yellow Fill with Dark Yellow Text",GreenFillDark:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Column:"Column",Bar:"Bar",DataValidationType:"Number/Decimal/Date/Time/TextLength/List",DataValidationAction:"greater than/greater than or equal to/less than/less than or equal to/equal to/not equal to/between/not between",FilterAlert:"This will remove a filtered range on your worksheet. To complete this task, please remove auto filters.",cellStyleAlert:"This style name already exists",modifyCellStyleAlert:"This style name does not exists",Modify:"Modify",StyleName:"Style Name",Clipboard:"Clipboard",Font:"Font",Actions:"Actions",Styles:"Styles",Editing:"Editing",Tables:"Tables",Illustrations:"Illustrations",Links:"Links",Charts:"Charts",DataTools:"Data Tools",Show:"Show",PageLayout:"Page Layout",Changes:"Changes",Window:"Window",Cells:"Cells",Calculation:"Calculation",Properties:"Properties",Tools:"Tools",TableStyleOption:"Table Style Options",ChartLayouts:"Chart Layouts",ChartDesignData:"Data",ChartDesignType:"Type",ChartDesignSize:"Size",Adjust:"Adjust",FormatSize:"Size",AnalyzePivotTable:"PivotTable",DataSource:"DataSource",Apply:"Apply",FATTitlePrefix:"Table Style ",NewCellStyle:"New Cell Style",HighPoint:"High Point",LowPoint:"Low Point",FirstPoint:"First Point",LastPoint:"Last Point",NegativePoint:"Negative Points",Markers:"Markers",NegativePoints:"Negative Points",LineSparklineTitle:"Insert Line Sparkline",LineSparklineContent:"Sparklines are mini charts placed in a single cells,each representing a row of data in your selection",ColumnSparklineTitle:"Insert Column Sparkline",ColumnSparklineContent:"Sparklines are mini charts placed in a single cells,each representing a row of data in your selection",WinLossSparklineTitle:"Insert Win/Loss Sparkline",WinLossSparklineContent:"Sparklines are mini charts placed in a single cells,each representing a row of data in your selection",SparklineColor:"Sparkline Color",SparklineColorTitle:"Sparkline Color",SparklineColorContent:"Specify the color of the sparklines in the selected sparkline group",MarkerColor:"Marker Color",MarkerColorContent:"Change the color for negative points, markers, and all other points for selected sparkline group",ChooseDataRange:"Choose the Data Range",ChooseLocationRange:"Choose the Location Range",DataRange:"Data Range",LocationRange:"Location Range",EmptyDLRnge:"Data Source or Location reference is not valid",SourceDataRange:"Select a source data range for the sparkline",SparklineAlert:"Location reference is not valid because the cells are not all in same column or same row. Select cells that are all in single row or single column.",SparklineDataAlert:"Enter the Correct Data Format",SparklineLocAlert:"The reference for the location or data range is not valid",SDataRangeAlert:"Data Source reference is not valid",LineAlert:"Cannot create the line chart for single value",EditData:"Edit Data",EditDataContent:"Edit Group Location & Data",EditSingleSparklineData:"Edit Single Sparkline Data",EditSparklineData:"Edit Sparkline Data",HiddenEmptyCells:"Hidden & Empty Cells",SwitchRowCol:"Switch Row/Column",CreateSparkline:"Create Sparkline",SelectDataSource:"Select a source data range for the sparkline",SPARKLINEDESIGN:"Sparkline Design",CancellationRequested:"Couldn't open within the timeout specified",ArrayaFormula:"You can't change part of an array",ArrayaFormulaTableAlert:"Multi-cell array formulas aren't allowed in tables",PivotTableName:"PivotTable Name",ValueFieldSettings:"Value Field Settings",FieldTab:"Summarize Values By",SummarizeValue:"Summarize Value Field By",SummarizeChooseType:"Choose the type of calculation that you want to use to summarize data from the selected field",FieldValue:"Source Name:",ImportPreventedOnUnknownFormula:"This file cannot be loaded since it contains unsupported formulas.",CellTypeInsertDeleteAlert:"Couldn't insert the row/column for multiple range celltypes",GridModeRecordsCount:"Grid mode must contains atleast one record",GridModeDataHeader:"Grid mode must contains data header",GridDataSourceAlert:"DataSource must not be empty at initial load since columns are generated from dataSource in Spreadsheet grid mode"},t.Spreadsheet.scrollMode={Normal:"normal",Infinite:"infinite"},t.Spreadsheet.AutoFillOptions={CopyCells:"copycells",FillSeries:"fillseries",FillFormattingOnly:"fillformattingonly",FillWithoutFormatting:"fillwithoutformatting",FlashFill:"flashfill"},t.Spreadsheet.autoFillDirection={Up:"up",Right:"right",Down:"down",Left:"left"},t.Spreadsheet.pageSize={A4:"A4",A3:"A3",Letter:"Letter"},t.Spreadsheet.Actions={Sorting:"sorting",Selection:"selection",AutoFill:"autofill",CellNavigation:"cellnavigation",Filtering:"filtering"},t.Spreadsheet.exportType={Excel:"Excel",Csv:"Csv",Pdf:"Pdf"},t.Spreadsheet.CustomCellType={Button:"Button",CheckBox:"CheckBox",DropDownList:"DropDownList",DatePicker:"DatePicker"},t.Spreadsheet.CellType={String:"string",Number:"number",Custom:"custom",Formula:"formula",Time:"time",LongDate:"longdate",ShortDate:"shortdate",Scientific:"scientific",Fraction:"fraction",Text:"text",General:"general",Accounting:"accounting",Currency:"currency",Percentage:"percentage",Date:"date",DateTime:"datetime"},t.Spreadsheet.SupportedStyles={FontFamily:"font-family",FontSize:"font-size",FontStyle:"font-style",FontWeight:"font-weight",TextAlign:"text-align",TextDecoration:"text-decoration",VerticalAlign:"vertical-align",TextIndent:"text-indent"},t.Spreadsheet.Validation={">":"GreaterThan",">=":"GreaterOrEqualTo","<":"LessThan","<=":"LessThanOrEqualTo","==":"EqualTo","!=":"NotEqualTo","!":"Not","=":""},t.Spreadsheet.ValidationText={">":"greater than",">=":"greater than or equal to","<":"less than","<=":"less than or equal to","==":"equal to","!=":"not equal to","!":" not","=":""},t.Spreadsheet.msg=" ",t.Spreadsheet.getMsg=function(){return t.Spreadsheet.msg},t.Spreadsheet.SelectionType={Row:"row",Column:"column",Default:"default"},t.Spreadsheet.SelectionUnit={Single:"single",Range:"range",MultiRange:"multirange"},t.Spreadsheet.Align={Left:"left",Right:"right",Center:"center"},t.Spreadsheet.CFormatRule={GreaterThan:"greaterthan",LessThan:"lessthan",Between:"between",EqualTo:"equalto",TextContains:"textcontains",DateOccur:"dateoccur"},t.Spreadsheet.ContextMenu={Cell:"cell",RowHeader:"rowheader",ColumnHeader:"columnheader",Footer:"footer"},t.Spreadsheet.CFormatHighlightColor={RedFillwithDarkRedText:"redft",YellowFillwithDarkYellowText:"yellowft",GreenFillwithDarkGreenText:"greenft",RedFill:"redf",RedText:"redt"},t.Spreadsheet.BorderType={Top:"top",Left:"left",Right:"right",Bottom:"bottom",OutSide:"outside",AllBorder:"allborder",ThickBox:"thickbox",ThickBottom:"thickbottom",TopandBottom:"topandbottom",TopandThickBottom:"topandthickbottom"},t.Spreadsheet.ChartProperties={PrimaryHorizontal:"PHAxis",PrimaryVertical:"PVAxis",PrimaryHorizontalAxisTitle:"PHAxisTitle",PrimaryVerticalAxisTitle:"PVAxisTitle",TitleNone:"CTNone",TitleCenter:"CTCenter",TitleFar:"CTFar",TitleNear:"CTNear",DataLabelNone:"DLNone",DataLabelCenter:"DLCenter",DataLabelInsideBase:"DLIBase",DataLabelInsideEnd:"DLIEnd",DataLabelOutsideEnd:"DLOEnd",PrimaryMajorHorizontal:"PMajorH",PrimaryMajorVertical:"PMajorV",PrimaryMinorHorizontal:"PMinorH",PrimaryMinorVertical:"PMinorV",LegendsNone:"LNone",LegendsLeft:"LLeft",LegendsRight:"LRight",LegendsBottom:"LBottom",LegendsTop:"LTop"},t.Spreadsheet.HideTypes={Default:"default",Freeze:"freeze"}})(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.selection=function(e){this.XLObj=e,this._isRightClick=!1,this._colhdrClick=!1,this._rowhdrClick=!1,this._aFillDownHandler=!1,this._isOutsideBordering=!1,this._isGridBordering=!1,this._isRowSelected=!1,this._isColSelected=!1,this._isEndReached=!0,this._canTouchMove=!1},t.spreadsheetFeatures.selection.prototype={_selectionMouseDownHandler:function(i){var r,l,n=this.XLObj,s=n.getSheet(),o=i.target;n._isTouchEvt?("msie"===n._browserDetails.name&&i.preventDefault(),(n._isSelected(i.target)||n._hasClass(i.target,"e-autofill"))&&(r=n._getBrowserEvt("move"),this._canTouchMove=!0),l=n._getBrowserEvt("end")):(i.preventDefault(),r=n._getBrowserEvt("move",!0),l=n._getBrowserEvt("end",!0)+" mouseleave"),n._on(e(document),l,this._mouseUpHandler),3===i.which||2===i.button||n.model.selectionSettings.selectionUnit===t.Spreadsheet.SelectionUnit.Single?this._isRightClick=!0:r&&n._on(n.element,r,this._mouseMoveHandler),"TD"==o.tagName?(n.XLEdit._isFormulaEdit?(i.ctrlKey&&(this._clearBorder(n._arrayAsString(n._ctrlFormulaBorder)),n._ctrlKeyCount=n._formulaRange.length),n._dStartCell=n._getCellIdx(o)):i.shiftKey&&-1!=s._startCell.rowIndex?s._endCell=n._getCellIdx(o):(s._startCell=n._getCellIdx(o),s._activeCell=n._getCellIdx(o)),o.className.indexOf("e-rowheader")>-1&&(this._rowhdrClick=!0)):"TH"==o.parentNode.tagName?(i.shiftKey&&-1!=s._startCell.rowIndex?s._endCell={rowIndex:0,colIndex:o.parentNode.cellIndex}:(s._startCell={rowIndex:0,colIndex:o.parentNode.cellIndex},s._activeCell={rowIndex:0,colIndex:o.parentNode.cellIndex}),o.className.indexOf("e-headercelldiv")>-1&&(this._colhdrClick=!0)):"e-autofill"==o.className&&(this._aFillDownHandler=!0)},_mouseMoveHandler:function(i){var r,l,n,s,o,a=this,d=a.XLSelection,h=a.getActiveSheetIndex(),c=a.getSheet(h),u=i.target,g=a.model.selectionSettings.selectionType,p=t.Spreadsheet.SelectionType,m=e(i.target).get(0);if(!a._isTouchEvt||(a._isTouchMoveSel=!0,l=a._getOriginalEvt(i),u=document.elementFromPoint(l.clientX,l.clientY)))if(e(u).hasClass("e-rowcell")||e(u).hasClass("e-rowheader")){if(this.XLSelection._isEndReached=!1,a._getContent(h).find("td[class *='border']").removeClass(a._ctrlFormulaBorder[a._ctrlKeyCount%6].join(" ")),a.XLEdit._isFormulaEdit)return i.ctrlKey,a._dEndCell=a._getCellIdx(u),void d._processFormulaRange(a._ctrlFormulaBorder,!0);if(d._aFillDownHandler&&0===e(u).parents(".e-rowheadercontent").length){if(a.model.allowAutoFill)return n=a._getCellIdx(i.target),void(c._isFreezed&&n.rowIndex<=c.frozenRows&&c._hiddenFreezeRows.indexOf(c.frozenRows)>-1?d._scrollCalculation(h,u,{position:"vertical",action:"Decrement"}):c._isFreezed&&n.colIndex<=c.frozenColumns&&c._hiddenFreezeCols.indexOf(c.frozenColumns)>-1?d._scrollCalculation(h,u,{position:"horizontal",action:"Decrement"}):a.XLDragFill._selectAutoFillRange(u))}else if(c._startCell=c._activeCell,c._endCell=a._getCellIdx(u),c._isFreezed&&a.XLFreeze._selectionScroll(),d._processBoundary(),e(u).parents(".e-spreadsheetcontentcontainer").length>0){if(i.ctrlKey&&a.model.selectionSettings.selectionType===t.Spreadsheet.SelectionType.Default&&a.model.selectionSettings.selectionUnit===t.Spreadsheet.SelectionUnit.MultiRange)return(o=a._getContent(a.getActiveSheetIndex())).find("td[class *='activecell']").removeClass("e-activecell"),o.find("td[class *='focus']").removeClass("e-focusright e-focusbottom"),s=a.swapRange([c._startCell.rowIndex,c._startCell.colIndex,c._endCell.rowIndex,c._endCell.colIndex]),a.getRange(s).addClass("e-ctrlselected"),d._focusRange(c._startCell,c._endCell,a._selectionBorder),void(a.model.allowAutoFill&&a.XLDragFill.hideAutoFillElement());g===p.Row||d._rowhdrClick?d.selectRows(c._startCell.rowIndex,c._endCell.rowIndex):g===p.Column||d._colhdrClick?d.selectColumns(c._startCell.colIndex,c._endCell.colIndex):d.selectRange(c._startCell,c._endCell,u),c._isFreezed&&a.XLFreeze._refreshSelection()}else{if(!(e(u).parents(".e-rowheadercontent").length>0))return;d._colhdrClick||d._rowhdrClick?(g===p.Column?d.selectColumns(0,c.colCount-1):d.selectRows(c._startCell.rowIndex,c._endCell.rowIndex),c._isFreezed&&a.XLFreeze._refreshSelection()):(r={position:"horizontal",action:"Decrement"},d._scrollCalculation(h,u,r))}}else if(t.isNullOrUndefined(u.parentNode)||"TH"!=u.parentNode.tagName)if(m.id.indexOf("sparkline")>1||m.id.indexOf("chart")<1&&(u.className.indexOf("e-hhandlespace")>-1||u.className.indexOf("e-hhandle")>-1||u.className.indexOf("e-hup")>-1||u.className.indexOf("e-hdown")>-1))r={position:"vertical",action:"Increment"},d._scrollCalculation(h,u,r);else{if(!(m.id.indexOf("chart")<1&&(u.className.indexOf("e-vhandlespace")>-1||u.className.indexOf("e-vhandle")>-1||u.className.indexOf("e-vup")>-1||u.className.indexOf("e-vdown")>-1)))return;r={position:"horizontal",action:"Increment"},d._scrollCalculation(h,u,r)}else c._endCell={rowIndex:0,colIndex:u.parentNode.cellIndex},c._startCell=c._activeCell,c._isFreezed&&a.XLFreeze._selectionScroll(),d._processBoundary(),d._colhdrClick||d._rowhdrClick?(g===p.Row?d.selectRows(0,c.rowCount-1):d.selectColumns(c._startCell.colIndex,c._endCell.colIndex),c._isFreezed&&a.XLFreeze._refreshSelection()):(r={position:"vertical",action:"Decrement"},d._scrollCalculation(h,u,r))},_mouseUpHandler:function(i){i.target=this._changeTargetWithOffset(i);var r,l,n,s,o,a,d,h,c,u,g,p,m,_=!0,f=this,b=f.XLSelection,C=f.getActiveSheetIndex(),S=f.getSheet(C),x=S.selectedRange,v=f.getSheetElement(C),w=f.model.selectionSettings.selectionType,I=S._startCell,y=S._endCell,T=t.Spreadsheet.SelectionType,L=f._getJSSheetContent(C).find(".e-spreadsheetcontentcontainer > .e-content"),R=!1;if(f.XLEdit._isEdit||f._setSheetFocus(),f._isTouchEvt?(p=f._getBrowserEvt("end"),b._canTouchMove&&(g=f._getBrowserEvt("move")),f._isTouchMoveSel=!1):(g=f._getBrowserEvt("move",!0),p=f._getBrowserEvt("end",!0)+" mouseleave"),g&&f._off(f.element,g,b._mouseMoveHandler),f._off(e(document),p,b._mouseUpHandler),f._isTouchEvt){if(!b._aFillDownHandler&&f._isTouchScroll||!b._canTouchMove&&!f._isUniqueTarget(f._touchArgs,i))return void(b._canTouchMove=f._isTouchScroll=!1);if(b._canTouchMove=f._isTouchScroll=!1,m=f._getOriginalEvt(i),!(r=document.elementFromPoint(m.clientX,m.clientY)))return void(this.model.allowAutoFill&&this.XLDragFill.positionAutoFillElement())}if(r=r||i.target,l=e(r),"TD"==r.tagName||"INPUT"==r.tagName&&!l.parents(".e-formulabar").length||b._aFillDownHandler){if(l.parents(".e-rowheadercontent").length&&(b._isOutsideBordering=b._isGridBordering=!1,L.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor")),f._preventctrlkey=i.ctrlKey,f.XLEdit._isFormulaEdit)return L.find("td[class *='border']").removeClass(f._ctrlFormulaBorder.join(" ").replace(/,/g," ")),i.ctrlKey?(f._dEndCell=f._getCellIdx(r),b._processFormulaRange(f._formulaBorder)):(b._clearBorder(f._formulaBorder.join(" ").replace(/,/g," ")+" "+f._ctrlFormulaBorder.join(" ").replace(/,/g," ")),f._ctrlKeyCount=0,f._dEndCell=f._getCellIdx(r),b._processFormulaRange(f._formulaBorder),f._formulaRange=[]),void f._formulaRange.push(f._getProperAlphaRange(C,f._dStartCell.rowIndex,f._dStartCell.colIndex,f._dEndCell.rowIndex,f._dEndCell.colIndex));if(b._aFillDownHandler){if(d="TD"===r.tagName?f._getCellIdx(r):f._dautoFillCell,f.model.allowAutoFill&&(h=f.XLDragFill._getAutoFillRange(d)),!h||!h.fillRange)return b._aFillDownHandler=!1,void(f.XLDragFill&&f.XLDragFill.positionAutoFillElement());if(o=f.swapRange(h.fillRange),f.model.allowLockCell&&f.getSheet(C).isSheetProtected&&f._isPropExists([o],"isLocked",C)&&(_=!1),_&&f._isPropExists([o],"isReadOnly",C)&&(_=!1),!_)return b._aFillDownHandler=!1,f.XLSelection.selectRange(I,y),R=!0,void f.XLDragFill.positionAutoFillElement();"direction"in h?(f._pStartCell=S._startCell,f._pEndCell=S._endCell,f._pFillCell=d,f.inRange(S.selectedRange,d.rowIndex,d.colIndex)?f.clearRangeData(null,null,e(b.getSelectedCells()).not(".e-autofillcell")):f.model.allowAutoFill&&f.XLDragFill.autoFill({dataRange:S.selectedRange,fillRange:h.fillRange,direction:h.direction,fillType:f.model.autoFillSettings.fillType}),S._startCell=h.startCell,S._endCell=h.endCell):b._aFillDownHandler=!1,b.refreshSelection(f.swapRange([h.startCell.rowIndex,h.startCell.colIndex,h.endCell.rowIndex,h.endCell.colIndex]))}else if(b._isOutsideBordering||b._isGridBordering){if(s="double"==f._borderStyle?"3px "+f._borderStyle+" "+f._borderColor:"1px "+f._borderStyle+" "+f._borderColor,b._isRightClick?S._endCell=S._startCell:(S._startCell=S._activeCell,S._endCell=f._getCellIdx(r),b._processBoundary()),!l.parents(".e-spreadsheetcontentcontainer").length)return;c={top:s,right:s,bottom:s,left:s},b._isGridBordering&&(c.isGridBorder=!0),f.XLFormat.applyBorder(c,f.swapRange([S._startCell.rowIndex,S._startCell.colIndex,S._endCell.rowIndex,S._endCell.colIndex])),b._cleanUp(!0)}else if("INPUT"==r.tagName&&l.parents("tr").length?S._endCell=b._isRightClick?S._startCell:f._getCellIdx(l.parents("td")[0]):b._isRightClick?S._endCell=S._startCell:(S._startCell=S._activeCell,S._endCell=f._getCellIdx(r),b._processBoundary()),l.parents(".e-spreadsheetcontentcontainer").length){if(i.ctrlKey&&f.model.selectionSettings.selectionType===t.Spreadsheet.SelectionType.Default&&f.model.selectionSettings.selectionUnit===t.Spreadsheet.SelectionUnit.MultiRange)return L.find("td[class *='activecell']").removeClass("e-activecell"),L.find("td[class *='focus']").removeClass("e-focustop e-focusleft"),L.find("td[class *='ctrlselected']").removeClass("e-ctrlselected"),x=f.swapRange([S._startCell.rowIndex,S._startCell.colIndex,S._endCell.rowIndex,S._endCell.colIndex]),f.getRange(x).addClass("e-selected"),f.getCell(S._activeCell.rowIndex,S._activeCell.colIndex).addClass("e-activecell"),b._focusRange(S._startCell,S._endCell,f._selectionBorder),f.model.allowAutoFill&&f.XLDragFill.hideAutoFillElement(),f.getSheet(C)._selectedCells.push(f._getSelectedRange(f.getSheet(C)._startCell,f.getSheet(C)._endCell)),void(f.model.showRibbon&&f.model.allowComments&&v.find(".e-selected.e-commentcell").length&&f.XLRibbon._enableButtons(["Review_Comments_DeleteComment"],"ejButton"));w===T.Row||b._rowhdrClick?b.selectRows(S._startCell.rowIndex,S._endCell.rowIndex):w===T.Column||b._colhdrClick?b.selectColumns(S._startCell.colIndex,S._endCell.colIndex):b.selectRange(S._startCell,S._endCell,r),R=!0,S._isFreezed&&f.XLFreeze._refreshSelection()}else{if(!l.parents(".e-rowheadercontent").length)return;(b._colhdrClick||b._rowhdrClick)&&(w===T.Column?b.selectColumns(0,S.colCount-1):b.selectRows(S._startCell.rowIndex,S._endCell.rowIndex),R=!0,b._hdrClick=!1),b._isOutsideBordering=b._isGridBordering=!1,L.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor")}"TD"===r.tagName&&f.model.showRibbon&&((u=e("#"+f._id+"_Ribbon_clearfilter").data("ejButton"))&&f.XLRibbon._changeClrFltrStatus(u,"button",f._getCellIdx(r)))}else b._aFillDownHandler||t.isNullOrUndefined(r.parentNode)||"TH"!=r.parentNode.tagName?"object"!=typeof r.className&&r.className&&r.className.indexOf("e-spreadsheetcolumnheader")>-1&&(b.selectSheet(!0),b._isOutsideBordering=b._isGridBordering=!1,L.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor")):(S._startCell=S._activeCell,S._endCell=b._isRightClick?S._startCell:{rowIndex:0,colIndex:r.parentNode.cellIndex},b._processBoundary(),(b._colhdrClick||b._rowhdrClick)&&(w===T.Row?b.selectRows(0,S.rowCount-1):b.selectColumns(S._startCell.colIndex,S._endCell.colIndex),R=!0),b._isOutsideBordering=b._isGridBordering=!1,L.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor").addClass("e-ss-cursor"));f.model.allowCellFormatting&&f.XLFormat._formatEnable&&f.XLFormat._fPMouseUp(i),f.model.showRibbon&&!R&&(f.XLEdit._isEdit?f.XLRibbon._disableRibbonIcons():f.XLRibbon._updateRibbonIcons()),!f.model.allowAutoFill||b._isOutsideBordering||b._isGridBordering||f.XLDragFill.positionAutoFillElement(b._aFillDownHandler),b._isRightClick=b._aFillDownHandler=!1,b._colhdrClick=b._rowhdrClick=!1,f.model.showRibbon&&(n=e("#"+f._id+"_Ribbon_merge").data("ejSplitButton"),t.isNullOrUndefined(n)||!f.model.allowLockCell||S.isSheetProtected||(f.XLRibbon._isDirtySelect?n.option("enabled",!1):n.option("enabled",!0))),f.model.allowEditing&&this.XLEdit._isEdit&&(a=f.getSheet(C)._startCell,f.getCell(a.rowIndex,a.colIndex).find(".e-ss-input").focus())},_processBoundary:function(){var e,t,i,r,l,n,s=[],o=this.XLObj,a=o.getActiveSheetIndex(),d=o.getSheet(a),h=d._startCell,c=d._endCell,u=o.swapRange([h.rowIndex,h.colIndex,c.rowIndex,c.colIndex]);for(d._startCell={rowIndex:u[0],colIndex:u[1]},d._endCell={rowIndex:u[2],colIndex:u[3]},e=(r=(r=(r=(r=o._getSelectedRange({rowIndex:u[0],colIndex:u[1]},{rowIndex:u[0],colIndex:u[3]})).concat(o._getSelectedRange({rowIndex:u[0],colIndex:u[3]},{rowIndex:u[2],colIndex:u[3]}))).concat(o._getSelectedRange({rowIndex:u[2],colIndex:u[1]},{rowIndex:u[2],colIndex:u[3]}))).concat(o._getSelectedRange({rowIndex:u[0],colIndex:u[1]},{rowIndex:u[2],colIndex:u[1]}))).length;e--&&(i=r[e],l=o.XLEdit.getPropertyValue(r[e].rowIndex,r[e].colIndex,"mergeIdx",a),n=(i.rowIndex+":"+i.colIndex).toString(),t=o.hasSpan(i)&&-1===s.indexOf(n)&&(s.push(n),this._updateRange(i,u)),l&&(n=(l.rowIndex+":"+l.colIndex).toString(),-1===s.indexOf(n)&&(s.push(n),t=this._updateRange(l,u))),!t););t&&this._processBoundary()},_updateRange:function(e,t){var i=this.XLObj,r=i.getActiveSheetIndex(),l=i.getSheet(r),n=t.slice(0),s=i._getMergedIdx(e.rowIndex,e.colIndex),o=e.rowIndex,a=e.colIndex,d=s.rowIndex,h=s.colIndex;return o<t[0]&&(t[0]=o),a<t[1]&&(t[1]=a),d>t[2]&&(t[2]=d),h>t[3]&&(t[3]=h),t[0]!=n[0]||t[1]!=n[1]||t[2]!=n[2]||t[3]!=n[3]?(l._startCell={rowIndex:t[0],colIndex:t[1]},l._endCell={rowIndex:t[2],colIndex:t[3]},!0):void 0},selectRange:function(e,t,i,r){var l,n,s,o,a,d,h,c,u,g,p=e,m=this.XLObj;if(m.model.allowSelection){if(m._isObject(e)||(p={rowIndex:(e=m._getRangeArgs(e,"object"))[0],colIndex:e[1]},t={rowIndex:e[2],colIndex:e[3]}),g=m.getActiveSheetIndex(),u=m.getSheet(g),(h=m.model.scrollSettings.allowVirtualScrolling)&&(u._goToCollection={multiple:!1,selected:[]}),c=u.selectedRange,o=m.swapRange([p.rowIndex,p.colIndex,t.rowIndex,t.colIndex]),(a=!(m.isImport||m.model.isImport)&&(!u._isImported||u._isLoaded))&&m.model.beforeCellSelect&&(l={prevRange:c,currRange:o,sheetIdx:g},i&&(l.target=i),!m._intrnlReq&&m._trigger("beforeCellSelect",l)))return!1;if(m._dStartCell=p,m._dEndCell=t,u.selectedRange=o.slice(0),m._isScrolling||this._cleanUp(!1),m.model.scrollSettings.allowScrolling&&h&&u._isColSelected&&(-1===u._virtualRowIdx.indexOf(o[0])&&(o[0]=u._virtualRowIdx[0]),-1===u._virtualRowIdx.indexOf(o[2])&&(o[2]=u._virtualRowIdx[u._virtualRowIdx.length-1])),(d=m.isUndefined(r))&&(s=(n=m.getRange(o)).length))for(;s--;)m.addClass(n[s],"e-selected");m.inRange(u.selectedRange,u._activeCell.rowIndex,u._activeCell.colIndex)||(u._activeCell={rowIndex:u.selectedRange[0],colIndex:u.selectedRange[1]}),u._activeCell=m._getMergeParent(u._activeCell.rowIndex,u._activeCell.colIndex),m._isRowViewable(g,u._activeCell.rowIndex)&&m.addClass(m.getCell(u._activeCell.rowIndex,u._activeCell.colIndex)[0],"e-activecell"),d&&(this._focusRange(p,t,m._selectionBorder),this._highlightHeader(o)),u._selectedCells=m._getSelectedRange(p,t),m.model.allowFormulaBar&&!m.XLEdit._isFormulaEdit&&m.updateFormulaBar(),m.XLDragFill&&m.XLDragFill.positionAutoFillElement(),d&&(m.model.enableContextMenu||m.model.showRibbon)&&m.XLRibbon._dirtySelect(n),m._isMultiSelect=!0,m.model.showRibbon&&!m._isScrolling&&m.XLRibbon._updateRibbonIcons(),m._isSheetNavigate||(u._isEmptyActiveCell=u._isRangeSelected=u._isRowSelected=u._isColSelected=u._isSheetSelected=!1),a&&m.model.cellSelected&&(l={selectedRange:u.selectedRange,target:i,sheetIdx:g},m._intrnlReq||m._trigger("cellSelected",l))}},selectRow:function(e){var t=this.XLObj,i=t.getSheet(t.getActiveSheetIndex());t.model.allowSelection&&(i._startCell={rowIndex:e,colIndex:0},i._endCell={rowIndex:e,colIndex:i.colCount-1},this.selectRange(i._startCell,i._endCell),this._selectRow(t._getRowIdx(e),"e-rowselected"),i._isRowSelected=!0,this._isRowSelected=!0)},selectRows:function(e,t){var i,r=this.XLObj;r.model.allowSelection&&((i=r.getSheet(r.getActiveSheetIndex()))._startCell={rowIndex:e,colIndex:0},i._endCell={rowIndex:t,colIndex:i.colCount-1},this.selectRange(i._startCell,i._endCell),this._markHeaderSelection([i._startCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex],"row"),i._isRowSelected=!0,this._isRowSelected=!0)},selectColumn:function(e){var t,i=this.XLObj;i.model.allowSelection&&((t=i.getSheet(i.getActiveSheetIndex()))._startCell={rowIndex:0,colIndex:e},t._endCell={rowIndex:t.rowCount-1,colIndex:e},this.selectRange(t._startCell,t._endCell),this._selectColumn(e,"e-colselected"),t._isColSelected=!0,this._isColSelected=!0)},selectColumns:function(e,t){var i,r=this.XLObj;r.model.allowSelection&&((i=r.getSheet(r.getActiveSheetIndex()))._startCell={rowIndex:0,colIndex:e},i._endCell={rowIndex:i.rowCount-1,colIndex:t},this.selectRange(i._startCell,i._endCell),this._markHeaderSelection([i._startCell.rowIndex,i._startCell.colIndex,i._endCell.rowIndex,i._endCell.colIndex],"column"),i._isColSelected=!0,this._isColSelected=!0)},selectSheet:function(e){var t,i,r=this.XLObj,l=r.getActiveSheetIndex(),n=r.getSheet(l),s=r.getActiveCell();r.model.allowSelection&&(e&&(t=n._topRow.idx,i=n._leftCol.idx,(s.rowIndex!=t||s.colIndex!=i)&&(n._activeCell={rowIndex:n._topRow.idx,colIndex:n._leftCol.idx},r.XLScroll.scrollToCell(r._getRangeArgs([t,i,t,i])))),n._startCell={rowIndex:0,colIndex:0},n._endCell={rowIndex:n.rowCount-1,colIndex:n.colCount-1},this.selectRange(n._startCell,n._endCell),r.element.find(".e-spreadsheetcolumnheader").addClass("e-sheetselected"),n._isSheetSelected=!0)},refreshSelection:function(e){var t=this.XLObj;e=t._getRangeArgs(e,"object");var i=t.getSheet(t.getActiveSheetIndex()),r=e[0],l=e[1],n=e[2],s=e[3];i._isRowSelected?this.selectRows(r,n):i._isColSelected?this.selectColumns(l,s):i._isSheetSelected?this.selectSheet():this.selectRange({rowIndex:r,colIndex:l},{rowIndex:n,colIndex:s})},getSelectedCells:function(e){return this.XLObj._getContent(this.XLObj._getSheetIndex(e))[0].querySelectorAll("td.e-selected")},_select:function(e,t){var i=this.XLObj.getCell(e.rowIndex,e.colIndex);i&&i.addClass(t)},_selectRow:function(e,t){var i=this.XLObj._getJSSheetRowHeaderContent(this.XLObj.getActiveSheetIndex()).find("td:eq("+e+")");i&&i.addClass(t)},_selectRows:function(e,t,i){var r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(o),d=s._getJSSheetRowHeaderContent(o).find("td");if(l=s._getRowIdx(e),n=s._getRowIdx(t),-1===l){if(!(e<a._virtualRowIdx[0]))return;l=0}if(-1===n){if(r=a._virtualRowIdx.length-1,!(t>a._virtualRowIdx[r]))return;n=r}if(r=(d=l!==n?d.slice(l,n+1):d.eq(n)).length)for(;r--;)s.addClass(d[r],i)},_selectColumn:function(e,t){var i=this.XLObj._getJSSheetHeader(this.XLObj.getActiveSheetIndex()).find("th:eq("+e+")");i&&i.addClass(t)},_selectColumns:function(e,t,i){var r,l=this.XLObj,n=l._getJSSheetHeader(l.getActiveSheetIndex()).find("th");if(r=(n=t!==e?n.slice(e,t+1):n.eq(t)).length)for(;r--;)l.addClass(n[r],i)},_focusBorder:function(e,t,i){var r=this.XLObj,l=r.swapRange([e.rowIndex,e.colIndex,t.rowIndex,t.colIndex]),n=l[0],s=l[1],o=l[2],a=l[3];n&&r.getRange([n-1,s,n-1,a]).addClass(i[1]),r.getRange([n,a,o,a]).addClass(i[0]),r.getRange([o,s,o,a]).addClass(i[1]),s&&r.getRange([n,s-1,o,s-1]).addClass(i[0])},_focusRange:function(e,t,i){for(var r,l=4,n=this.XLObj,s=[n.getFocusTopElem(),n.getFocusRightElem(),n.getFocusBottomElem(),n.getFocusLeftElem()],o=["e-focustop ","e-focusright ","e-focusbottom ","e-focusleft "];l--;)r=s[l][0],n._removeClass(r),n.addClass(r,o[l]+i[l]);this._refreshBorder(n.swapRange([e.rowIndex,e.colIndex,t.rowIndex,t.colIndex]))},_refreshBorder:function(e){for(var t,i,r,l,n,s="e-hide",o=4,a=(e=e||this.XLObj.getSheet().selectedRange)[0],d=e[1],h=this.XLObj,c=this._focusInfo(e),u=h.getFocusTopElem(),g=h.getFocusRightElem(),p=h.getFocusBottomElem(),m=h.getFocusLeftElem(),_=[u,g,p,m],f=l=c.topLeft.top,b=c.topRight.left+c.topRight.width-c.topLeft.left,C=c.topRight.top,S=c.topRight.left+c.topRight.width,x=c.bottomRight.top+c.bottomRight.height-C,v=c.bottomLeft.top+c.bottomLeft.height,w=c.bottomRight.left+c.bottomRight.width-c.bottomLeft.left,I=v-l,y=r=n=c.topLeft.left;o--;)h._removeClass(_[o][0],s);h.model.selectionSettings.enableAnimation?(t=h.model.selectionSettings.animationType,i=h.model.selectionSettings.animationTime,a?u.animate({top:l.toString(),left:n.toString(),width:b.toString()},i,t):u.addClass(s),g.animate({top:C.toString(),left:S.toString(),height:x.toString()},i,t),p.animate({top:v.toString(),left:y.toString(),width:w.toString()},i,t),d?m.removeClass(s).animate({top:f.toString(),left:r.toString(),height:I.toString()},i,t):m.addClass(s)):(u&&(a?(u[0].style.top=l+"px",u[0].style.left=n+"px",u[0].style.width=b+"px"):u.addClass(s)),g&&(g[0].style.top=C+"px",g[0].style.left=S+"px",g[0].style.height=x+"px"),p&&(p[0].style.top=v+"px",p[0].style.left=y+"px",p[0].style.width=w+"px"),m&&(d?(m[0].style.top=f+"px",m[0].style.left=r+"px",m[0].style.height=I+"px"):m.addClass(s)))},_focusInfo:function(e){var t={},i=e[0],r=e[1],l=e[2],n=e[3],s=this.XLObj;return t.topLeft=s._getCellInfo({rowIndex:i,colIndex:r}),t.topRight=s._getCellInfo(r===n?{rowIndex:i,colIndex:n}:s._getMergedIdx(i,n)),t.bottomLeft=s._getCellInfo({rowIndex:l,colIndex:r}),t.bottomRight=s._getCellInfo(s._getMergedIdx(l,n)),t},_highlightHeader:function(e){this._selectRows(e[0],e[2],"e-rowhighlight"),this._selectColumns(e[1],e[3],"e-colhighlight")},_hideShowSelElem:function(e){var t=this.XLObj,i="block"===e?"_removeClass":"addClass";t.model.allowSelection&&(t[i](t.getAutoFillElem()[0],"e-hide"),t[i](t.getFocusBottomElem()[0],"e-hide"),t[i](t.getFocusTopElem()[0],"e-hide"),t[i](t.getFocusLeftElem()[0],"e-hide"),t[i](t.getFocusRightElem()[0],"e-hide"))},_markHeaderSelection:function(e,t){var i,r,l=this.XLObj;if(i=(e=l.swapRange(e))[0],"row"===t)for(r=e[2];i<=r;)l._isRowViewable(l.getActiveSheetIndex(),i)&&this._selectRow(l._getRowIdx(i),"e-rowselected"),i++;else for(i=e[1],r=e[3];i<=r;)this._selectColumn(i,"e-colselected"),i++},_processFormulaRange:function(e){var t,i=this.XLObj,r=i.getActiveSheetIndex(),l=i._dStartCell,n=i._dEndCell,s=i._getContent(r).find(".e-editedcell");this._focusBorder(l,n,e[i._ctrlKeyCount%6]),i.model.allowAutoFill&&(t=i._getAlphaRange(r,l.rowIndex,l.colIndex,n.rowIndex,n.colIndex),i.XLDragFill.hideAutoFillElement(),i.XLEdit._updateFormulaCellRange(t)),i.XLEdit._isCellEdit?i.XLEdit._focusElements(s):i._getInputBox().focus()},_scrollCalculation:function(e,i,r){var l,n,s,o,a,d=this.XLObj;d.model.scrollSettings.allowVirtualScrolling||(o=d.getSheet(d.getActiveSheetIndex()),d.XLSelection._isEndReached=!0,l=setInterval(function(){if(n=d.XLScroll._hScroller(e),s=d.XLScroll._vScroller(e),d.XLSelection._isEndReached){if("horizontal"===r.position)"Increment"==r.action?(Math.ceil(parseFloat(n.element.find(".e-hhandle").css("left")))+Math.ceil(parseFloat(n.element.find(".e-hhandle").width()))>=n.element.find(".e-hhandlespace").width()-2?d.model.scrollSettings.scrollMode!=t.Spreadsheet.scrollMode.Normal?d.XLScroll._scrollX(e):clearInterval(l):n.scroll(n.value()+o.columnWidth,!0),d.XLShape._shapeROStart||d.XLShape._shapeRSStart||(o._endCell.colIndex=o.colCount-1)):((a=n.value()-o.columnWidth)<0&&(a=0),n.value()>=0&&n.scroll(a,!0),d.XLSelection._aFillDownHandler&&(o._endCell.colIndex=o._leftCol.idx),o._frozenColumns>1&&(o._startCell=o._activeCell,o._endCell.rowIndex=o.selectedRange[2]===o._startCell.rowIndex?o.selectedRange[0]:o.selectedRange[2],o._endCell.colIndex=o._fleftColIdx));else if("vertical"===r.position)if("Increment"==r.action)Math.ceil(parseFloat(s.element.find(".e-vhandle").css("top")))+Math.ceil(parseFloat(s.element.find(".e-vhandle").height()))>=s.element.find(".e-vhandlespace").height()-2?d.model.scrollSettings.scrollMode!=t.Spreadsheet.scrollMode.Normal?d.XLScroll._scrollY(e):clearInterval(l):s.scroll(s.value()+d.model.rowHeight,!0),d.XLShape._shapeROStart||d.XLShape._shapeRSStart||(o._endCell.rowIndex=o.rowCount-1);else if((a=s.value()-d.model.rowHeight)<0&&(a=0),s.value()>0&&s.scroll(a,!0),!d.XLShape._shapeROStart&&!d.XLShape._shapeRSStart){if(o._topRow.idx<1&&o._ftopRowIdx+1===o._frozenRows)return;o._startCell=o._activeCell,o._endCell.rowIndex=o._frozenRows>1?o._ftopRowIdx:o._topRow.idx-1,o._endCell.colIndex=o._frozenRows>1?o.selectedRange[3]===o._startCell.colIndex?o.selectedRange[1]:o.selectedRange[3]:i.parentNode.cellIndex}d.XLShape._shapeROStart||d.XLShape._shapeRSStart||(d.XLSelection._aFillDownHandler?d.XLDragFill._selectAutoFillRange(null,o._endCell):d.XLSelection.selectRange(o._startCell,o._endCell))}else clearInterval(l)},200),"msie"===d._browserDetails.name&&"8.0"===d._browserDetails.version?(i.attachEvent("onmouseup",function(){clearInterval(l)}),document.attachEvent("onmouseup",function(){clearInterval(l)})):(i.addEventListener("mouseup",function(){clearInterval(l)}),document.addEventListener("mouseup",function(){clearInterval(l)})))},_cleanUp:function(e){var t,i,r=!1,l="e-hide",n=this.XLObj,s=n.getActiveSheetIndex(),o=n.getSheet(s),a=n.getFocusTopElem(),d=n.getSheetElement(s);for(n.model.allowAutoFill&&n.XLDragFill._autoFillCleanUp(),o._isSheetSelected&&!n.model.scrollSettings.allowVirtualScrolling&&(r=!0,d.detach()),t=(i=d.find(".e-selected,.e-rowselected,.e-colselected,.e-rowhighlight,.e-colhighlight,.e-sheetselected,.e-activecell")).length;t--;)i[t].className=i[t].className.replace(new RegExp("e-activecell|e-selected|e-rowhighlight|e-colhighlight|e-rowselected|e-colselected|e-sheetselected","g"),"").replace(/ +/g," ");r&&n.getMainPanel(s).find(".e-spreadsheet-list").append(d),e&&a&&(n.addClass(a[0],l),n.addClass(n.getFocusRightElem()[0],l),n.addClass(n.getFocusBottomElem()[0],l),n.addClass(n.getFocusLeftElem()[0],l)),o._selectedCells=[]},clearAll:function(e){this._cleanUp(!e)},_clearBorder:function(e){var t=this.XLObj;t._getContent(t.getActiveSheetIndex()).find("td[class *='border']").removeClass(e)}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.filter=function(e){this.XLObj=e,this._isSearchEdit=!1,this._isDecimal=!1,this._colName="",this._colType="",this._tableId=""},t.spreadsheetFeatures.filter.prototype={_renderExcelFilter:function(){var e=this.XLObj,i={instance:e,showSortOptions:e.model.allowSorting,maxFilterLimit:e.model.sheets[e.getActiveSheetIndex()].filterSettings.maxFilterChoices,filterHandler:t.proxy(this._filterHandler,this),cancelHandler:t.proxy(this._cancelHandler,this),customFilterHandler:t.proxy(this._customFilterHandler,this),enableComplexBlankFilter:!1,blankValue:"",interDeterminateState:!0};e._excelFilter=new t.excelFilter(i),e.element.append(t.buildTag("div#"+e._id+"_filter_custom.e-filterdlg.e-"+e._id+"-dlg","",{display:"none"}))},_customFilterHandler:function(){var t=this.XLObj;this._isDecimal&&(e("#"+t._id+"number_CustomValue1").ejNumericTextbox("option",{decimalPlaces:2}),e("#"+t._id+"number_CustomValue2").ejNumericTextbox("option",{decimalPlaces:2}))},_renderFilterDialogs:function(t){var i=this.XLObj;document.getElementById(i._id+"_filter_custom").className.indexOf("e-dialog")<0&&this._renderCustomFilter(),i._excelFilter.renderDialog(t),this._refreshCustomFilter(t),i.element.find(".e-excelfilter.e-dlgcontainer").hide(),e(document.body).append(e("#"+i._id+t+"_excelDlg"))},_createSelection:function(e,t,i,r){for(var l,n,s=this.XLObj,o=s.getSheet(e).usedRange.rowIndex,a=t,d=t;d<=o&&(l=s.XLEdit.getPropertyValue(d,0,"isHide"),n=s.XLEdit.getPropertyValue(d,i,"value2",e),!s.XLEdit.getPropertyValue(d,i,"tableName",e));d++){if(!l&&!s.XLEdit.getPropertyValue(d,i,"isMHide")&&!n&&d>=t)return{endRowIndex:d,filteredIndex:r};!l&&n?(a=d+1,r.push(d)):a=a}return{endRowIndex:a,filteredIndex:r}},_getSelectedRangeData:function(e,i,r,l){var n,s,o,a,d,h,c,u=this.XLObj,g=u.getActiveSheetIndex(),p=u.getSheet(g),m=[],_=[],f=[],b=u._dataContainer,C=b.sheets[g],S=u.getSheet(g)._multifilterIdx;for(-1===r&&(p.filterSettings.range=u._generateHeaderText(S[0]+1)+e.rowIndex+":"+u._generateHeaderText(S[S.length-1]+1)+(i.rowIndex+1)),p._multipleFiltering&&(i.colIndex=p._multifilterIdx[p._multifilterIdx.length-1]),o=e.rowIndex;o<=i.rowIndex;o++){for(n={},a=e.colIndex;a<=i.colIndex;a++)s=u._generateHeaderText(a+1),o in C&&(!(0 in C[o])||0 in C[o]&&t.isNullOrUndefined(C[o][0].isRHide)&&t.isNullOrUndefined(C[o][0].isFHide))&&(!(0 in C[o])||0 in C[o]&&(t.isNullOrUndefined(C[o][0].isFilterHide)||!t.isNullOrUndefined(C[o][0].isFilterHide)&&C[o][0].filterID===r))&&(n.idx=o,o in C&&a in C[o]?(d=C[o][a],a===l&&(h=u.XLEdit.getPropertyValue(o,a,"formats"),t.isNullOrUndefined(h)||(c={id:a,background:h["background-color"],foreground:h.color},_.push(c))),n[s]=t.isNullOrUndefined(b.sharedData[d.value])?"":u._isDateTime(b.sharedData[d.value])?d.value2:b.sharedData[u.isFormula(b.sharedData[d.value])?d.value2:d.value]):n[s]=""),!(o in C)&&o<i.rowIndex&&(n.idx=o,n[s]="");u.getObjectLength(n)>0&&(f.push(n),m.push(o))}p._selectedCellColors=_,p._selectedRange={startRow:e.rowIndex,endRow:i.rowIndex,dataSourceIndexes:m},p.filterSettings.filteredRange=f},_getColumnType:function(t,i,r,l){for(var n,s="string",o=i;o<r;o++){if(n=this.XLObj.XLEdit.getPropertyValue(o,l,"value",t),"text"==this.XLObj.XLEdit.getPropertyValue(o,l,"type",t)||!e.isNumeric(n))return"string";this._isDecimal||(this._isDecimal=n%1!=0),s="number"}return s},_getColumnByField:function(e,t){for(var i=this.XLObj.getSheet(e),r=0;r<i.columns.length&&i.columns[r].field!==t;r++);return r===i.columns.length?null:i.columns[r]},_checkEmptyText:function(e){for(var i=this.XLObj,r=i.model.sheets[e]._selectedCells,l=0,n=r.length;l<n;l++)if(!t.isNullOrUndefined(i.XLEdit.getPropertyValue(r[l].rowIndex,r[l].colIndex,"value",e)))return!0;return i._showAlertDlg("Alert","Alert",null,440),!1},_getFilterIcon:function(){var e=t.buildTag("span .e-icon","",{});return e.addClass("e-spanfilter e-filterspan e-ssfilter"),e},filterByActiveCell:function(){var e,t=this.XLObj,i=t.getActiveSheetIndex();if(t.model.allowFiltering&&!t.model.isReadOnly){var r=t.model.sheets[i]._activeCell,l=t.getCell(r.rowIndex,r.colIndex),n=t.model.sheets[i]._selectedCells;this._checkEmptyText(i)&&(l.find("span").is(".e-ssfiltered, .e-ssfilter, .e-ssfilter-asc, .e-ssfiltered-asc, .e-ssfilter-dsc, .e-ssfiltered-dsc")?t._showAlertDlg("Alert","HeaderAlert","",440):(e=t.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value",i),e=t._isDateTime(e)?t.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2",i):e,this._filterActiveCell(i,r,n,e)))}},_filterActiveCell:function(e,t,i,r,l){var n=this.XLObj,s=n.getSheet(e);s._activeCell=t,this._filterByValue(e,l,s.columns[t.colIndex].field,"or","equal",r,i),n.model.allowComments&&n.XLComment._updateCmntArrowPos(),n.model.isGridMode&&n._isAutoWHMode&&n._setElemDimension()},_filterByValue:function(i,r,l,n,s,o,a){var d,h,c,u,g,p,m,_,f,b,C,S,x,v=this.XLObj,w=-1,I=v.XLEdit.getColumnIndexByField(l),y=v.getSheet(i);if(t.isNullOrUndefined(r)?a=a:(d=v.getRangeIndices(r),a=v._getSelectedRange({rowIndex:d[0]+1,colIndex:d[1]},{rowIndex:d[2],colIndex:d[3]})),h=a[0],!t.isNullOrUndefined(r)&&(f=v.XLEdit.getPropertyValue(h.rowIndex,h.colIndex,"value2",i),t.isNullOrUndefined(f)||f!==o))for(m=d[0];m<d[2];m++)if(f=v.XLEdit.getPropertyValue(m,I,"value2",i),!t.isNullOrUndefined(f)&&f===o){h={rowIndex:m,colIndex:I};break}for(C={currentFilteringColumn:l,action:"filter",predicated:n,requestType:"filterbycell",reqType:"filter",filteredValue:o,selCells:e.extend(!0,[],a),activeCell:h},b=this._applyFilterByValue(i,h,a,o),v._excelFilter._predicates[i]={},c={field:l,value:o,predicate:n,operator:s,matchcase:!1},v._excelFilter._predicates[i][l]=t.Predicate(l,s,o),y.filterSettings.filteredColumns.push(c),u=t.DataManager(y.filterSettings.filteredColumns),g=(new t.Query).where("field",t.FilterOperators.equal,l),m=0,_=(p=u.executeLocal(g)).length;m<_;m++)(w=e.inArray(p[m],y.filterSettings.filteredColumns))>-1&&y.filterSettings.filteredColumns.splice(w,1);if(y.filterSettings.filteredColumns.push(c),C.filteredcolumns=b.filteredColumns=y.filterSettings.filteredColumns,b.filteredColumns.length<1)for(m=(S=b.multifilterIdx)[0];m<=S[S.length-1];m++)x=v._generateHeaderText(m+1),t.isNullOrUndefined(b.fColumns[x])||(b.fColumns[x]=[]);else b.fColumns[l]=e.extend(!0,[],b.filteredColumns);b.predicate=v._excelFilter._predicates[i],C.tableID=b.tableID,C.filteredCells=b.filteredCells,v.XLSelection._refreshBorder(),C.operation="filterbycell",C.selRange=v._getAlphaRange(i,b.startRow-1,b.multifilterIdx[0],b.endRow,b.multifilterIdx[b.multifilterIdx.length-1]),v._processBindings(C)&&(y.filterSettings.filteredColumns=void 0)},_applyFilterByValue:function(i,r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=this.XLObj,S=C.getSheet(i),x=[],v=S.filterSettings.tableRange,w=[],I=!1,y=C.getSheet(i)._filterColl;for(d=(d=C.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tableName",i))?C._getTableID(d):-1,g=0,m=v.length;g<m;g++)if(v[g].tableID===d){c=g;break}if(!t.isNullOrUndefined(c)&&v[c].tableID===d&&-1!==v[c].selectedCellIndexes.indexOf(r.colIndex)&&v[g].startRow<=r.rowIndex&&v[g].endRow>=r.rowIndex)h=v[c],S.filterSettings.filteredRange=v[c].filteredRange,S._selectedRange=v[c].selectedRange,h.action="filtering";else{for(S._multipleFiltering=!1,S._multifilterIdx=[],C._dupDetails=!0,this.clearFilter("remove"),C._dupDetails=!1,g=(_=C.getObjectKeys(y)).length-1;g>=0;g--)for(p=(f=C.getObjectKeys(y[g])).length-1;p>=0;p--)C._isRowViewable(i,_[g])&&((b=C.getCell(_[g],f[p])).find(".e-filterspan").remove(),b.removeClass("e-filterhdr")),delete y[_[g]][f[p]];if(l.length<2||l[0].rowIndex===l[l.length-1].rowIndex){for(s=-1,o=l[l.length-1].rowIndex,g=l[0].rowIndex;g>=0;g--)if(t.isNullOrUndefined(C.XLEdit.getPropertyValue(g,l[0].colIndex,"value2"))){s=g;break}s=-1===s?1:s+2,n={rowIndex:o=this._createSelection(i,o,l[0].colIndex,[]).endRowIndex-1,colIndex:r.colIndex},this._getSelectedRangeData({rowIndex:s,colIndex:r.colIndex},n,-1,r.colIndex)}else s=r.rowIndex,n={rowIndex:o=this._createSelection(i,l[l.length-1].rowIndex,l[0].colIndex,[]).endRowIndex-1,colIndex:r.colIndex},this._getSelectedRangeData({rowIndex:s,colIndex:r.colIndex},n,-1,r.colIndex);for(g=l[0].colIndex,m=l[l.length-1].colIndex;g<=m;g++)x.push(g),a=this._getFilterIcon(),u={rowIndex:(s=0===s?1:s)-1,colIndex:g},this._applyFilterIcon(u,a),w.push(u);for(C.XLScroll._getColWidths(i,l[0].colIndex),x.length>1&&(S._multipleFiltering=!0),S._multifilterIdx=x,S._selectedCellIndexes=x,g=0,m=v.length;g<m;g++)if(v[g].tableID===d){c=g,I=!0;break}I?((h=v[c]).startRow=r.rowIndex,h.endRow=n.rowIndex,h.multiFiltering=S._multipleFiltering,h.multifilterIdx=S._multifilterIdx,h.selectedCellIndexes=S._multifilterIdx,h.selectedRange=e.extend(!0,{},S._selectedRange),h.filteredRange=e.extend(!0,{},S.filterSettings.filteredRange),h.hiddenIdx=[],h.flterdIdxes=[],h.fColumns={},h.tableID=d,h.filterCollection=[],h.action="filtering"):(S.filterSettings.tableRange.push({action:"filtering",filterCollection:[],startRow:s,endRow:n.rowIndex,tableID:-1,fColumns:{},flterdIdxes:[],multiFiltering:S._multipleFiltering,multifilterIdx:S._multifilterIdx,selectedCellIndexes:S._multifilterIdx,selectedRange:e.extend(!0,{},S._selectedRange),filteredRange:S.filterSettings.filteredRange,hiddenIdx:[]}),h=v[v.length-1]),h.filteredCells=w}return h},clearFilter:function(i){var r,l=this.XLObj;if(!l.model.isReadOnly){var n,s,o,a,d,h,c,u,g,p=!1,m=!1,_=l.getActiveSheetIndex(),f=l.getSheet(_),b=e.extend(!0,{},f._filterColl),C=l._dupDetails,S=f.filterSettings.tableRange,x=-1,v=[],w=l._dataContainer.sheets[_],I=l.getObjectKeys(b),y=[],T=f.filterSettings.filteredRange,L=f.filterSettings.filteredColumns;if(S.length){for(o=0;o<S.length;o++)if(-1===S[o].tableID){x=o,m=!0;break}if(m){for(s=S[x].selectedRange,o=I.length-1;o>=0;o--)for(a=(u=l.getObjectKeys(b[I[o]])).length-1;a>=0;a--)h=parseInt(I[o]),c=parseInt(u[a]),t.isNullOrUndefined(l.XLEdit.getPropertyValue(h,c,"tableName",_))&&(v.push({rowIndex:h,colIndex:c}),b[I[o]][u[a]].status.indexOf("e-ssfiltered")>-1&&(n=l.model.sheets[_].columns[u[a]].field,y.push({fieldName:n,filterCollection:S[x].filterCollection,action:"filtering",tableID:-1,predicate:l._excelFilter._predicates[_][n]}),delete l._excelFilter._predicates[_][n],l._dupDetails=!0,this._clearFilterColumn(n,"","","Or","","",-1),l._dupDetails=!1,p=!0),"remove"===i&&(delete b[I[o]][u[a]],delete w[I[o]][u[a]].isFilterHeader,delete w[I[o]][u[a]].filterState,delete w[I[o]][u[a]].isFilterVisible,l._isRowViewable(_,h)&&(g=l.getCell(h,c),e.isNumeric(l.XLEdit.getPropertyValue(h,c))&&g.addClass(l._rAlign),g.find(".e-filterspan").remove(),l.addClass(g[0],"e-wrapword"),l.XLEdit.getPropertyValue(h,c,"isFilterWrap")&&l.setWrapText("wrap",l._getAlphaRange(_,h,c,h,c)),l._removeClass(g[0],"e-filterhdr"))));"remove"===i&&(l._dupDetails=C,f._filterColl=b,x>-1&&(d=S.splice(x,1)[0]),l.model.allowComments&&l.XLComment._updateCmntArrowPos(),l._isUndoRedo||l._dupDetails||(r={sheetIndex:_,operation:"remove-filter",status:i,process:"apply-filter",filteredCells:v,requestType:"filter",reqType:"filter",fRange:l.getSheet(_).filterSettings.range,filterRange:d,filterCollection:y,filteredCols:L,fltrdRange:T,selRange:s},l._completeAction(r),l._trigActionComplete(r))),p&&e("#"+l._id+"_Ribbon_Data_SortFilter_ClearFilter").ejButton("disable")}}}},filter:function(e){var i=this.XLObj;if(i.model.allowFiltering&&!i.model.isReadOnly){var r,l,n,s,o,a,d,h,c=i.getActiveSheetIndex(),u=i.getSheet(c),g=!1,p=u._activeCell,m=u.filterSettings.tableRange;for(u._multipleFiltering=!1,u._multifilterIdx=[],r=i.XLEdit.getPropertyValue(p.rowIndex,p.colIndex,"tableName",c),t.isNullOrUndefined(r)||(r=i._getTableID(r)),s=0,o=m.length;s<o;s++)-1===m[s].tableID&&(g=!0),n=s;if(h={range:i._getRangeArgs(e,"string"),reqType:t.Spreadsheet.Actions.Filtering,sheetIndex:c},i._trigActionBegin(h))return!0;if(e=h.range,g&&(this.clearFilter("remove"),u.filterSettings.filteredRange=[],u._selectedRange={},u._selectedCellIndexes=[],u.filterSettings.filteredColumns=[],i._excelFilter._predicates[c]={}),!t.isNullOrUndefined(r)&&r>-1){for(a=m[n].startRow,s=0,o=(l=m[n].multifilterIdx).length;s<o;s++)d=this._getFilterHeader(c,a,l[s]),!t.isNullOrUndefined(d)&&d.status.indexOf("e-ssfiltered")>-1&&this._clearFilterColumn(u.columns[s].field,"","","","","",r);this._clearFilterTableIcon(c,r),g=!0}if(g){if(h={sheetIdx:c,reqType:"clear-Filter"},i._trigActionComplete(h))return}else this._filterCellRange(c,e);i._isFiltered=!g,i.model.allowComments&&i.XLComment._updateCmntArrowPos()}},_applyFilterIcon:function(e,t){var i,r=this.XLObj,l=this.XLObj._rAlign,n=r.getActiveSheetIndex(),s=e.rowIndex,o=e.colIndex,a=r.getSheet(n),d=r._isRowViewable(n,s),h=a._filterColl,c=!1;d&&((i=r.getCell(s,o,n))[0].insertBefore(t[0],i[0].childNodes[i[0].childNodes.length-1]),i.addClass("e-filterhdr"),i.removeClass("e-ralign")),r.XLEdit.getPropertyValue(s,o,"wrap",n)&&(c=!0,r.setWrapText("unwrap",r._getAlphaRange(n,s,o,s,o))),r.XLEdit._updateDataContainer({rowIndex:s,colIndex:o},{dataObj:{isFilterHeader:!0,filterState:"filter",isFilterVisible:!0,isFilterWrap:c},sheetIdx:n}),r.isNumber(r.model.allowFiltering&&r.XLEdit.getPropertyValue(s,o,"value2",n))&&d&&r._removeClass(i[0],l),s in h||(h[s]={}),o in h[s]||(h[s][o]={}),h[s][o].status="e-ssfilter",h[s][o].isTable=t[0].className.indexOf("e-ft")>-1},_filterCellRange:function(e,i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f=this.XLObj,b=!1,C=[],S=-1,x=!1,v=0,w=f.getSheet(e),I=[],y=!1,T=[],L=[],R=!1,O={sheetIndex:e,reqType:"filter",operation:"apply-filter"},F={sheetIndex:e,range:i,reqType:"filter",type:"actionBegin",action:"filtercellrange"};if(!f._trigActionBegin(F)){if(i=F.range,t.isNullOrUndefined(i)){if(!f.model.allowSelection)return;r=w._selectedCells}else u=f.getRangeIndices(i),r=f._getSelectedRange({rowIndex:u[0],colIndex:u[1]},{rowIndex:u[2],colIndex:u[3]});if(r.length<2&&(_=r,t.isNullOrUndefined(i)||f.performSelection(i,e),f.selectAll(!1),r=w._selectedCells,y=!0),f.XLRibbon._dirtySelect(),!f.XLRibbon._isDirtySelect&&0!=r.length){for(a=r[0].colIndex,h=r[r.length-1].colIndex;a<=h;a++){if(C.push(a),S=r[0].rowIndex,y)w._isSheetSelected||(T.push(a),w._multifilterIdx.push(a),b=!0);else{if(!x||C.length>0)for(d=S,c=r[r.length-1].rowIndex;d<=c;d++)f._isRowVisible(e,d)&&(f.XLEdit.getPropertyValue(d,a,"value2",e)||T.length&&f.XLEdit.getPropertyValue(0,a,"isCHide",e))&&((-1===S||S>d)&&(S=d),x=!0,b=!0,R=!0),S<d&&0===v&&I.push(d);R&&(T.push(a),w._multifilterIdx.push(a),R=!1)}v++}if(T.length>1&&(w._multipleFiltering=!0),L=[],b){for(a=0,h=T.length;a<h;a++)o=this._getFilterIcon(),this._applyFilterIcon({rowIndex:S,colIndex:T[a]},o),L.push({rowIndex:S,colIndex:T[a]});for(g={rowIndex:S+1,colIndex:r[0].colIndex},p={rowIndex:r[r.length-1].rowIndex},w._selectedRange={startRow:g.rowIndex,endRow:p.rowIndex,dataSourceIndexes:I},this._getSelectedRangeData(g,r[r.length-1],-1,g.colIndex),w._selectedCellIndexes=C,O={sheetIndex:e,filteredCells:L,reqType:"filter",operation:"apply-filter",tableID:-1,type:"actionBegin"},a=0,h=(s=w.filterSettings.tableRange).length;a<h;a++)-1===s[a].tableID&&(l=!0,n=a);l?((m=w.filterSettings.tableRange[n]).startRow=g.rowIndex,m.endRow=p.rowIndex,m.multiFiltering=w._multipleFiltering,m.multifilterIdx=w._multifilterIdx,m.selectedCellIndexes=w._multifilterIdx,m.selectedRange=w._selectedRange,m.filteredRange=w.filterSettings.filteredRange,m.filteredColumns=w.filterSettings.filteredColumns,m.predicate=f._excelFilter._predicates[e],m.hiddenIdx=[],m.flterdIdxes=[],m.fColumns={},m.filterColumnName=[],m.filterCollection=[]):w.filterSettings.tableRange.push({filterCollection:[],startRow:g.rowIndex,endRow:p.rowIndex,tableID:-1,multiFiltering:w._multipleFiltering,multifilterIdx:w._multifilterIdx,selectedCellIndexes:w._multifilterIdx,selectedRange:w._selectedRange,filteredRange:w.filterSettings.filteredRange,filteredColumns:w.filterSettings.filteredColumns,fColumns:{},predicate:{},hiddenIdx:[],fltrdIdxes:[],filterColumnName:[]}),f.XLScroll._getColWidths(e,w._multifilterIdx[0]),w._isImported&&!w._isLoaded||f._isExport||(i=_?[_[0].rowIndex,_[0].colIndex,_[_.length-1].rowIndex,_[_.length-1].colIndex]:f.isUndefined(i)?[r[0].rowIndex,r[0].colIndex,r[r.length-1].rowIndex,r[r.length-1].colIndex]:f.getRangeIndices(i),f._completeAction(O),f._trigActionComplete(O),t.isNullOrUndefined(i)||f.performSelection(i,e))}else f._showAlertDlg("Alert","Alert","",440)}}},openFilterDialog:function(e){var t,i=this.XLObj;i.model.isReadOnly||("string"==typeof e&&(e=i.getRangeIndices(e)),(t=i.getCell(e[0],e[1]).find("span.e-filterspan")).length>0&&this._filterClickHandler({target:t[0]}))},_filterClickHandler:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y=this.XLObj,T=e(i.target),L=y.getActiveSheetIndex(),R=y.getSheet(L),O=!1,F=[],E={},D=["showItems","hideItems"];if(s=y._generateHeaderText(i.target.parentNode.cellIndex+1),this._isDecimal=!1,!(y.model.allowLockCell&&y.getSheet(L).isSheetProtected||y.preventFilterPopup)){if(T[0].className.indexOf("e-ssfiltered")>-1&&(O=!0),g=i.target.parentNode.cellIndex,T[0].className.indexOf("e-ssfilter")>-1){for(f=y.model.sheets[L].filterSettings.tableRange,r=y._getCellIdx(T.parent()[0]),l=y.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"tableName"),m=t.isNullOrUndefined(l)?-1:parseInt(l.replace("e-table","")),d=0,h=f.length;d<h;d++)f[d].tableID===m&&(x=d,f[d].multiFiltering?(c=f[d].multifilterIdx[0],u=f[d].multifilterIdx[f[d].multifilterIdx.length-1]):c=u=i.target.parentNode.cellIndex,C={rowIndex:f[d].startRow,colIndex:c},S={rowIndex:f[d].endRow,colIndex:u},R._multipleFiltering=f[d].multiFiltering,R._multifilterIdx=f[d].multifilterIdx,_=R._selectedRange=f[d].selectedRange,R.filterSettings.filteredRange=f[d].filteredRange,R._selectedCellIndexes=f[d].selectedCellIndexes);if(-1===m){if(n=(v=this._createSelection(L,_.endRow,g,_.dataSourceIndexes)).endRowIndex>_.endRow?v.endRowIndex-1:v.endRowIndex,_.endRow!=n)for(d=_.endRow+1;d<=n;d++)p={field:s,value:y.XLEdit.getPropertyValue(d,g,"value2",L),matchcase:!1,operator:"equal",predicate:"or"},R.filterSettings.filteredColumns.push(p),f[x].filteredColumns.push(p),f[x].selectedRange.endRow=n;S={rowIndex:n,colIndex:g},f[x].selectedRange=R._selectedRange={startRow:C.rowIndex,endRow:S.rowIndex,dataSourceIndexes:v.filteredIndex},f[x].endRow=n}for(this._getSelectedRangeData(C,S,m,g),o=R.columns,a=this._getColumnType(L,_.startRow,_.endRow,g),d=0,h=o.length;d<h;d++)if(o[d].field===s){y._$colType=a,y._$curFieldName=o[d].field;break}for(y._showDialog(y._id+"_Filter",y._$colType),b=y._getXYPos(T,e("#"+y._id+y._$colType+"_excelDlg"),18,18),d=0,h=(f=y.model.sheets[L].filterSettings.tableRange).length;d<h;d++)f[d].tableID===m&&(F=f[d].filteredColumns,E=f[d].predicate);y._excelFilter._predicates[L]=E,this._isSearchEdit=!0,e.extend(!0,y._excelFilter._columnsFiltered,R._filteredColumns),y._phoneMode||y._tabMode?this._openNormalFilterDlg(s,y._$colType,m,x):y._excelFilter.openXFDialog({field:s,dataSource:R.filterSettings.filteredRange?R.filterSettings.filteredRange:R.dataSource,position:{X:b.xPos,Y:b.yPos},type:y._$colType,format:y._$colFormat,filteredColumns:F,sortedColumns:[],key:L,tableID:m,selectedColors:R._selectedCellColors,isFiltered:O,blank:"",enableColor:!0,filteredByColor:R._filteredByColor})}w=e("#"+y._id+"string_MenuItem").data("ejMenu"),I=e("#"+y._id+"number_MenuItem").data("ejMenu"),w&&w[y.model.allowSorting?D[0]:D[1]](w.element.find("li:lt(4)")),I&&I[y.model.allowSorting?D[0]:D[1]](I.element.find("li:lt(4)"))}},_cancelHandler:function(){this._isSearchEdit=!1},applyFilter:function(e){var i=this.XLObj,r=e.predicate||t.Predicate(e.field,e.operator,e.value,!e.matchcase),l=[],n=i.getActiveSheetIndex();i._isFiltered||i.XLFilter.filter(e.filterRange),t.isNullOrUndefined(i._excelFilter._predicates[n])&&(i._excelFilter._predicates[n]={},i._excelFilter._predicates[n][e.field]={}),i._excelFilter._predicates[n][e.field]=r,e.filterCollection?l=e.filterCollection:l.push({actualFilterOperator:e.operator,actualFilterValue:e.value,actualPredicate:e.predicate,field:e.field,isCustom:!0,matchcase:e.matchcase,operator:e.operator,predicate:e.predicate,value:e.value}),this._filterHandler({action:"filtering",fieldName:e.field,tableID:e.tableID||-1,ejpredicate:r,filterCollection:l})},_filterHandler:function(i){var r,l,n,s,o,a,d,h,c;if(!(i.originalEvent&&(r=i.originalEvent.target.parentElement.className,r&&r.indexOf("hdr")>-1))){var u,g,p,m,_,f,b,C,S,x,v=!1,w=-1,I={},y=this.XLObj,T=y.getActiveSheetIndex(),L=y.getSheet(T),R=[],O={},F=L.columnsWidthCollection[L.colCount-1],E=y.element.find("#vscrollBar").width();for(I.requestType="sorting"===i.action||"filterbycolor"===i.action?i.action:"filtering",p=L.filterSettings.tableRange,y.XLFilter._isSearchEdit=!1,u=0,g=p.length;u<g;u++)p[u].tableID===i.tableID&&(e.extend(!0,R,p[u].filteredColumns),O=p[u].predicate,v=!0,w=u);if("clearfiltering"===i.action&&"filterbycolor"===i.reqType&&(I.requestType=p[w].action),I.tableID=i.tableID,"filtering"===i.action||"clearfiltering"===i.action){for(I.rowIndex=p[w].startRow-1,I.colIndex=y._generateColCount(i.fieldName)-1,f=t.DataManager(R),b=(new t.Query).where("field",t.FilterOperators.equal,i.fieldName),C=f.executeLocal(b),I.filteredColumns=R,u=0,g=C.length;u<g;u++)(S=e.inArray(C[u],R))>=0&&R.splice(S,1);"clearfiltering"===i.action?delete y._excelFilter._predicates[T][i.fieldName]:t.merge(R,i.filterCollection),O=y._excelFilter._predicates[T]}if(v)if(p[w].filteredColumns=R,p[w].filterCollection=i.filterCollection,p[w].predicate=O,p[w].action=i.action,R.length<1)for(u=(l=p[w].multifilterIdx)[0];u<=l[l.length-1];u++)n=y._generateHeaderText(u+1),t.isNullOrUndefined(p[w].fColumns[n])||(p[w].fColumns[n]=[]);else p[w].fColumns[i.fieldName]=e.extend(!0,[],R);if(_=L.filterSettings.tableRange[w].selectedRange,s=L.filterSettings.tableRange[w].selectedCellIndexes,o=L._filterColl,"filtering"===i.action||"clearfiltering"===i.action)I.currentFilteringColumn=i.fieldName,I.ejpredicate=i.ejpredicate,I.filterCollection=e.extend(!0,[],i.filterCollection),I.action=i.action,I.reqType="filterbycolor"===I.requestType?I.requestType:"filter",I.sheetIndex=T,I.filteredcolumns=R,I.predicate=O;else if("sorting"===i.action){if(!y.model.allowSorting)return;if(I.requestType=I.action=i.action,m=y.XLEdit.getColumnIndexByField(i.sortDetails.field),y.XLSort._isSortByFilter=!0,y.XLSort.sortByRange(y.swapRange([_.startRow,s[0],_.endRow,s[s.length-1]]),i.sortDetails.field,i.sortDetails.direction,i.tableID))return;for(this._changeSortIcon({rowIndex:_.startRow-1,colIndex:m},i.sortDetails.direction),u=0,g=s.length;u<g;u++)s[u]!=m&&(o[_.startRow-1][s[u]].status.indexOf("-asc")>-1||o[_.startRow-1][s[u]].status.indexOf("-dsc")>-1)&&(o[_.startRow-1][s[u]].status="e-ssfilter",y._isRowViewable(T,_.startRow-1)&&(x=y.getCell(_.startRow-1,s[u]).find(".e-filterspan")[0],y._removeClass(x,"e-ssfilter-asc"),y._removeClass(x,"e-ssfilter-dsc"),y.addClass(x,"e-ssfilter")))}else{if(I.requestType=I.action=i.action,I.range=L._selectedRange,y.model.allowSorting&&y.XLSort._sortRangeAlert([_.startRow,s[0],_.endRow,s[s.length-1]]))return;"sortbycolor"===i.action?(I.sortColumn=i.sortDetails.field,I.operation=i.sortDetails.operation,a=i.sortDetails.color.replace("rgb(","").replace(")","").split(",")):(y._isUndoRedo?(I.filterColumn=i.columnName,I.operation=i.operation):(I.filterColumn=i.filterDetails.field,I.operation=i.filterDetails.operation,a=i.filterDetails.color.replace("rgb(","").replace(")","").split(",")),I.tableID=i.tableID,y.model.sheets[T]._filteredByColor=I.filterColumn),y._isUndoRedo||(d=a[0],h=a[1],c=a[2]),"sortbgcolor"===I.operation||"filterbgcolor"===I.operation?I.bgcolor=y._isUndoRedo?i.bgcolor:this._convertrgbtohex(parseInt(d),parseInt(h),parseInt(c)):I.fgcolor=y._isUndoRedo?i.fgcolor:this._convertrgbtohex(parseInt(d),parseInt(h),parseInt(c))}I.oprType="filter",I.selRange=y._getAlphaRange(T,p[w].startRow-1,p[w].multifilterIdx[0],p[w].endRow,p[w].multifilterIdx[p[w].multifilterIdx.length-1]),"sorting"!==i.action&&y._processBindings(I),"clearfiltering"===i.action&&(y.XLRibbon._isFilterSelect.status=!1),y.model.allowComments&&y.XLComment._updateCmntArrowPos(),y.model.allowSelection&&y.XLSelection._refreshBorder(),y.model.showRibbon&&y.XLRibbon._refreshRibbonIcons(),y._isFrozen(y.getFrozenRows())&&y.XLFreeze._refreshFreezeRowDiv(),y.model.isGridMode&&(y._isAutoWHMode&&y._setElemDimension(),y.model.scrollSettings.allowScrolling&&("none"!=y.element.find("#vscrollBar")[0].style.display||y._isGridModeWidthChange?y._isGridModeWidthChange&&(y.setWidthToColumns([{colIndex:L.colCount-1,width:F-E}]),y._isGridModeWidthChange=!1):(y.getSheetElement(T).find(".e-spreadsheetheader").removeClass("e-scrollcss"),y.setWidthToColumns([{colIndex:L.colCount-1,width:F+E}]),y._isGridModeWidthChange=!0)))}},_convertrgbtohex:function(e,t,i){return"#"+(16777216+(e<<16)+(t<<8)+i).toString(16).slice(1)},_clearFilterColumn:function(i,r,l,n,s,o,a){var d,h,c,u,g,p,m,_,f,b,C=this.XLObj,S={},x=C.getActiveSheetIndex(),v=C.getSheet(x),w=!1,I={},y=v.filterSettings.tableRange,T=[];for(S.requestType=t.Grid.Actions.Filtering,S.currentFilterObject=[],Array.isArray(r)||(r=e.makeArray(r)),Array.isArray(l)||(l=e.makeArray(l)),this._currentFilterColumn=this._getColumnByField(x,i),f=0,b=r.length;f<b;f++)if(I={field:i,operator:r[f],value:l[f],matchcase:s,predicate:n,actualFilterValue:o},!w){for(h=0,c=y.length;h<c;h++)y[h].tableID===a&&(d=y[h],e.extend(!0,T,y[h].filteredColumns),C._excelFilter._predicates[x]=y[h].predicate,v.filterSettings.filteredRange=v.filterSettings.tableRange[h].filteredRange,v._selectedCellIndexes=y[h].selectedCellIndexes,v._selectedRange=y[h].selectedRange,v._multifilterIdx=y[h].multifilterIdx);for(u=t.DataManager(T),g=(new t.Query).where("field",t.FilterOperators.equal,I.field),h=0,c=(p=u.executeLocal(g)).length;h<c;h++)-1!==(m=e.inArray(p[h],T))&&T.splice(m,1)}(_=e.inArray(i,v._filteredColumns))>-1&&v._filteredColumns.splice(_,1),C._isUndoRedo&&C.isUndefined(d)||(w=!0,delete C._excelFilter._predicates[x][i],d.filteredColumns=T,d.predicate=C._excelFilter._predicates[x],S.currentFilterObject.push(I),S.filterCollection=T,S.currentFilteringColumn=i,S.filteredcolumns=T,S.action="clearfiltering",S.reqType="filter",S.tableID=a,S.selRange=C._getAlphaRange(x,d.startRow-1,d.multifilterIdx[0],d.endRow,d.multifilterIdx[d.multifilterIdx.length-1]),C._processBindings(S)&&(v.filterSettings.filteredColumns.reverse().splice(0,r.length),v.filterSettings.filteredColumns.reverse()),C.model.allowComments&&C.XLComment._updateCmntArrowPos(),C.model.allowSelection&&C.XLSelection._refreshBorder())},_getFilterHeader:function(e,i,r){var l=this.XLObj.getSheet(e)._filterColl;if(!t.isNullOrUndefined(l[i])&&!t.isNullOrUndefined(l[i][r]))return l[i][r]},_filterTable:function(i,r,l){var n,s,o,a,d,h,c,u,g=this.XLObj,p=g.getSheet(i),m=[],_=!1,f=!1;for(p._multipleFiltering=!1,p._multifilterIdx=[],d=l?l.endCell:e.extend(!0,{},p._endCell),c=(h=l?l.startCell:e.extend(!0,{},p._startCell)).colIndex;c<=d.colIndex;c++)a=this._getFilterHeader(i,h.rowIndex,c),!t.isNullOrUndefined(a)&&a.status.indexOf("e-ssfilter")>-1?_=!0:(o="e-ft"+r,(s=this._getFilterIcon()).addClass(o),this._applyFilterIcon({rowIndex:h.rowIndex,colIndex:c},s),m.push(c),p._multifilterIdx.push(c));if(g.XLScroll._getColWidths(i,h.colIndex),!_)if(m.length>1&&(p._multipleFiltering=!0,f=!0),h.rowIndex=h.rowIndex+1,this._getSelectedRangeData(h,d,r,h.colIndex),g._isFATResize){if(u=(n=p.filterSettings.tableRange).length,n.length)for(c=0;c<u;c++)if(n[c].tableID===r){n[c].endRow=d.rowIndex;break}g._isFATResize=!1}else p.filterSettings.tableRange.push({filterCollection:[],startRow:h.rowIndex,endRow:d.rowIndex,tableID:r,multiFiltering:f,multifilterIdx:m,selectedCellIndexes:m,selectedRange:e.extend(!0,{},p._selectedRange),filteredRange:p.filterSettings.filteredRange,filteredColumns:p.filterSettings.filteredColumns,fColumns:{},predicate:{},hiddenIdx:[],filterColumnName:[]})},_clearFilterTable:function(e,t,i){var r,l,n;for(l=0,n=(r=this.XLObj.getSheet(e||this.getActiveSheetIndex()).filterSettings.tableRange).length;l<n;l++)r[l].tableID===t&&(this._clearAllFilter(e,l,i),n=r.length)},_clearAllFilter:function(i,r,l){var n,s,o,a,d,h,c,u,g=this.XLObj,p=g._dataContainer.sheets[i],m=g.getSheet(i),_=m.filterSettings.tableRange;for(m._selectedRange=_[r].selectedRange,h=_[r].multifilterIdx,c=_[r].startRow,o=0,a=h.length;o<a;o++)d=m.columns[h[o]].field,u=g.XLEdit.getPropertyValue(c-1,h[o],"filterState"),!t.isNullOrUndefined(u)&&u.indexOf("filtered")>-1&&this._clearFilterColumn(d,"","","Or","","",_[r].tableID),l||(g._isRowViewable(i,c-1)&&(n=g.getCell(c-1,h[o]),g.addClass(n[0],"e-wrapword"),s=n.find(".e-filterspan"),e(s).remove(),n.removeClass("e-filterhdr")),p[c-1][h[o]]&&(delete p[c-1][h[o]].isFilterHeader,delete p[c-1][h[o]].filterState),delete m._filterColl[c-1][h[o]]);l||_.splice(r,1)},_clearFilterTableIcon:function(e,t){for(var i,r,l,n,s,o,a,d=this.XLObj,h=d.getSheet(e),c=h.filterSettings.tableRange,u=0,g=c.length;u<g;u++)if(c[u].tableID===t)for(h._selectedRange=c[u].selectedRange,h.filterSettings.filteredRange=c[u].filteredRange,l=c[u].multifilterIdx,n=c[u].startRow,s=0,o=l.length;s<o;s++)i=d.XLEdit.getPropertyValue(n-1,l[s],"isFilterVisible"),d._isRowViewable(e,n-1)&&(r=(a=d.getCell(n-1,l[s])).find(".e-filterspan"),i?(r.hide(),d._removeClass(a[0],"e-filterhdr")):(d.addClass(a[0],"e-filterhdr"),r.show())),d.XLEdit._updateDataContainer({rowIndex:n-1,colIndex:l[s]},{dataObj:{isFilterVisible:!i}})},_insertFilterIcon:function(e,t,i){var r;r=this._getFilterIcon(),i.tableID>-1&&this.XLObj.XLEdit._updateDataContainer({rowIndex:e,colIndex:t},{dataObj:{tableName:"e-table"+i.tableID}}),this._applyFilterIcon({rowIndex:e,colIndex:t},r)},_changeFilterIcon:function(e,t,i){var r,l,n,s=!1,o=this.XLObj,a=e.rowIndex,d=e.colIndex,h=o._rAlign,c=o.getActiveSheetIndex();n=this._getFilterHeader(c,a,d).status,o._isRowViewable(c,a)&&(r=(l=o.getCell(a,d)).find(".e-filterspan")[0],l.removeClass(h),s=!0),"filter"===t?i.indexOf("filtered")<0&&(o.XLEdit._updateDataContainer({rowIndex:a,colIndex:d},{dataObj:{filterState:i.replace("filter","filtered")}}),o.getSheet(c)._filterColl[a][d].status=n.replace("e-ssfilter","e-ssfiltered"),s&&(r.className=r.className.replace("e-ssfilter","e-ssfiltered"))):(o.XLEdit._updateDataContainer({rowIndex:a,colIndex:d},{dataObj:{filterState:i.replace("filtered","filter")}}),o.getSheet(c)._filterColl[a][d].status=n.replace("e-ssfiltered","e-ssfilter"),s&&!o.isUndefined(r)&&(r.className=r.className.replace("e-ssfiltered","e-ssfilter")))},_changeSortIcon:function(e,t){var i,r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=!1,d=s.getSheet(o)._filterColl;r=(l=d[e.rowIndex][e.colIndex].status).indexOf("e-ssfiltered")>-1?12:10,n=l.substr(0,r),s._isRowViewable(o,e.rowIndex)&&(r=(l=(i=s.getCell(e.rowIndex,e.colIndex).find(".e-filterspan")[0]).className).indexOf("e-ssfilter")+r,a=!0),"ascending"===t?(d[e.rowIndex][e.colIndex].status=n+"-asc",a&&(i.className=l.substr(0,r)+"-asc")):(d[e.rowIndex][e.colIndex].status=n+"-dsc",a&&(i.className=l.substr(0,r)+"-dsc"))},_extendFilterRange:function(e,t){var i,r,l,n,s=this.XLObj,o=s.getSheet(s.getActiveSheetIndex()).filterSettings.tableRange;if(o.length)for(l=0,n=o.length;l<n;l++)if(o[l].tableID==e){if(o[l].endRow<t[2]&&(r=o[l].selectedRange.dataSourceIndexes,o[l].endRow=o[l].selectedRange.endRow=t[2],r[r.length-1]<o[l].endRow))for(i=r[r.length-1],n=o[l].endRow;i<n;i++)r.push(i+1);break}},_updateFilterIcons:function(t,i,r,l){for(var n,s,o=this.XLObj,a=e("#"+o._id+"numberSelectAll").ejCheckBox("instance"),d=!a&&a.model.checked,h=e("#"+o._id+"stringSelectAll").ejCheckBox("instance"),c=!h&&h.model.checked,u=t;u<=i;u++){s={rowIndex:u,colIndex:r},(n=o.XLEdit.getPropertyValue(u,r,"filterState")).indexOf("filtered")>-1&&("clearfiltering"==l||d||c)?this._changeFilterIcon(s,"filtered",n):n.indexOf("filtered")<0&&"clearfiltering"!=l&&this._changeFilterIcon(s,"filter",n);break}},_fltrRowHighlight:function(t,i,r){var l,n,s,o=this.XLObj,a=o.getActiveSheetIndex(),d=o._getJSSheetRowHeaderContent(a),h=d.find("table tr:gt("+(t-1)+"):lt("+(i-t+1)+")"),c=o.model.sheets[a].filterSettings.tableRange,u=o.model.sheets[a].filteredRowsCollection;if(o.model.scrollSettings.allowVirtualScrolling&&(h=d.find("table tr").filter(function(){return e(this).attr("data-idx")>=t&&e(this).attr("data-idx")<=i})),"clear"===r){if(h.find("td[class *='filterhiglight']").removeClass("e-filterhiglight"),o.clearRangeData([t,0,i,0],["isFilterHighlight"]),u.length)for(s=0;s<u.length;s++)for(n=0,l=c.length;n<l;n++)u[s]>=c[n].startRow&&u[s]<=c[n].endRow&&!o.XLEdit.getPropertyValue(u[s],0,"isRHide")&&(o.updateUniqueData({isFilterHighlight:!0},[c[n].startRow,0,c[n].endRow,0]),o.model.scrollSettings.allowVirtualScrolling?d.find("table tr").filter(function(){return e(this).attr("data-idx")>=c[n].startRow&&e(this).attr("data-idx")<=c[n].endRow}).find("td").addClass("e-filterhiglight"):d.find("table tr:gt("+(c[n].startRow-1)+"):lt("+(c[n].endRow-c[n].startRow+1)+")").find("td").addClass("e-filterhiglight"))}else"add"===r&&(h.find("td").addClass("e-filterhiglight"),o.updateUniqueData({isFilterHighlight:!0},[t,0,i,0]))},_checkFilterApplied:function(e,t,i,r,l,n){var s,o,a,d,h=this.XLObj,c=h.getSheet(e).filterSettings.tableRange;for(h._isFilterApplied=!1,a=0,d=c.length;a<d;a++)if(o=!1,c[a].filteredColumns.length?(s=h._checkFilterMerge(e,[c[a].startRow-1,c[a].multifilterIdx[0],c[a].endRow,c[a].multifilterIdx[c[a].multifilterIdx.length-1]],t,i,r,l,n,"filter",o),h._isFilterApplied=!s.isAlert):h._isFilterApplied=!1,h._isFilterApplied)return!0;return!1},_updateFilterCollection:function(i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f,b,C,S,x=this.XLObj,v=x.getSheet(i),w=v.filterSettings.tableRange;if(l+=1,"row"===n)for(o=0,h=w.length;o<h;o++)_=(m=w[o]).multifilterIdx,"insert"===s?r<=m.endRow&&(m.endRow=m.endRow+l,r<m.startRow?(m.startRow=m.startRow+l,m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:l,isInsertBefore:!0})):m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:l})):r<=m.endRow&&(m.endRow=m.endRow-l,r<m.startRow?(m.startRow=m.startRow-l,m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:-l,isInsertBefore:!0})):m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:-l})),g={rowIndex:m.startRow,colIndex:_[0]},p={rowIndex:m.endRow,colIndex:_[_.length-1]},this._getSelectedRangeData(g,p,m.tableID),m.selectedRange=e.extend(!0,{},v._selectedRange),m.filteredRange=e.extend(!0,{},v.filterSettings.filteredRange);else for(o=0,h=w.length;o<h;o++){if(_=(m=w[o]).multifilterIdx,S=e.extend(!0,[],_),C=0,this._updateFilteredColumns(o,r,l,s),"insert"===s){if(r<=_[0]){for(a=_.length-1;a>=0;a--)_[C]=_[C]+l,C++;m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:l,isInsertBefore:!0})}else if(r<=_[_.length-1])for(m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:l}),a=S[S.length-1],c=S[S.length-1]+l;a<=c;a++)-1===_.indexOf(a)&&_.push(a)}else if(r<=_[0]){for(a=0;a<_.length;a++)_[a]=_[a]-l;m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:-l,isInsertBefore:!0})}else if(r<=_[_.length-1]){for(d=r,u=_[_.length-1];d<=u;d++)b=x._generateHeaderText(d+1),f=x.XLEdit.getPropertyValue(m.startRow-1,d,"filterState"),!t.isNullOrUndefined(f)&&f.indexOf("filtered")>-1&&this._clearFilterColumn(b,"","","Or","","",m.tableID);_.splice(_.length-l,l),m.tableID>-1&&x.XLFormat._refreshTableRowCol({tid:m.tableID,pos:n,cnt:-l})}g={rowIndex:m.startRow,colIndex:_[0]},p={rowIndex:m.endRow,colIndex:_[_.length-1]},this._getSelectedRangeData(g,p,m.tableID),m.selectedRange=e.extend(!0,{},v._selectedRange),m.filteredRange=e.extend(!0,{},v.filterSettings.filteredRange),_.length<2&&(m.multiFiltering=!1)}},_updateFilteredColumns:function(t,i,r,l){for(var n,s,o,a,d,h,c,u,g,p,m=this.XLObj,_=m.getActiveSheetIndex(),f=m.getSheet(_).filterSettings.tableRange[t],b=e.extend(!0,[],f.filteredColumns),C=e.extend(!0,{},f.fColumns),S=e.extend(!0,{},f.fColumns),x=0,v=b.length;x<v;x++)i<=(n=m.XLEdit.getColumnIndexByField(f.filteredColumns[x].field))&&("delete"===l?i===n?b.splice(x,1):b[x].field=m._generateHeaderText(n-r+1):b[x].field=m._generateHeaderText(n+r+1));for(f.filteredColumns=b,c=m.getObjectKeys(C),f.predicate=f.predicate,x=c.length-1;x>=0;x--)for(p=m.XLEdit.getColumnIndexByField(c[x]),u=i;u<i+r;u++)if(u<=p){for(s=e.extend(!0,[],C[c[x]]),g=0;g<s.length;g++)u<=(n=m.XLEdit.getColumnIndexByField(s[g].field))&&("delete"===l?u===n?s.splice(x,1):s[g].field=m._generateHeaderText(n-r+1):s[g].field=m._generateHeaderText(n+r+1));o=m.XLEdit.getColumnIndexByField(c[x]),d=m._generateHeaderText(o+1),"delete"===l?(a=o-r,u===o?(delete f.predicate[d],delete S[d]):(S[h=m._generateHeaderText(a+1)]=s,delete S[d],f.predicate[h]=m._excelFilter.generatePredicate(s),delete f.predicate[d])):(a=o+r,S[h=m._generateHeaderText(a+1)]=s,delete S[d],f.predicate[h]=m._excelFilter.generatePredicate(s),delete f.predicate[d])}f.fColumns=S},_renderCustomFilter:function(){var i=this.XLObj,r=i._id+"_filter_custom",l=e("#"+r),n=t.buildTag("div#"+r+"_content"),s=t.buildTag("input#"+r+"_filterBtn.e-filter",{},{},{type:"button",value:"Filter"}),o=t.buildTag("input#"+r+"_clearBtn.e-clear",{},{},{type:"button",value:"Clear"});l.append(n.append(t.buildTag("div.e-fltrbtndiv").append(s).append(o))),this._createButton("filter",s),this._createButton("clear",o),l.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("Filter"),width:"100%",height:"100%",cssClass:"e-ss-dialog e-"+i._id+"-dlg",open:function(){e("#"+i._id+"_formatdlg_okbtn").focus()},close:t.proxy(this._customFltrDlgClose,this)})},_customFltrDlgClose:function(){e("#"+this.XLObj._id+"_filter_custom_"+this._colType).hide()},_refreshCustomFilter:function(i){var r=this.XLObj,l=r._id+"_filter_custom",n=t.buildTag("input#"+l+"_"+i+"_ddinput.e-"+r._id+"_customddl",{},{},{type:"text"}),s=t.buildTag("input#"+l+"_"+i+"_acString.e-filterval",{},{height:"26px",width:"100%"},{type:"text"});switch(e("#"+l+"_content").prepend(t.buildTag("div#"+l+"_"+i,"",{display:"none"}).append(t.buildTag("div.e-operdiv").append(n)).append(t.buildTag("div.e-textdiv").append(s))),n.ejDropDownList({dataSource:[{text:"Equal",value:"equal"},{text:"Not Equal",value:"notequal"},{text:"Less Than",value:"lessthan"},{text:"Less Than Or Equal",value:"lessthanorequal"},{text:"Greater Than",value:"greaterthan"},{text:"Greater Than Or Equal",value:"greaterthanorequal"},{text:"Between",value:"between"}],width:"100%",fields:{id:"value",text:"text",value:"value"},select:e.proxy(this._onNumFormatSelect,this),selectedItemIndex:0}),i){case"string":n.ejDropDownList("option",{dataSource:[{text:"Equal",value:"equal"},{text:"Not Equal",value:"notequal"},{text:"Starts With",value:"startswith"},{text:"Ends With",value:"endswith"},{text:"Contains",value:"contains"}],selectedItemIndex:0}),s.ejAutocomplete({width:"100%",height:26,enableDistinct:!0});break;case"number":s.ejNumericTextbox({showSpinButton:!1,height:"26px",decimalPlaces:2,width:"100%"});break;case"boolean":s.ejCheckBox({});break;case"date":s.ejDatePicker({width:"100%"})}},_createButton:function(e,i){var r="filter"==e?t.proxy(this._fltrBtnHandler,this):t.proxy(this._fltrClrHandler,this);i.ejButton({size:"normal",type:"button",height:22,width:60,click:r,showRoundedCorner:!0})},_fltrBtnHandler:function(){var i=this.XLObj,r=i.getActiveSheetIndex(),l=i._id+"_filter_custom",n=e("#"+l+"_"+this._colType+"_ddinput").ejDropDownList("model.value"),s=e("#"+l+"_"+this._colType+"_acString").val(),o={action:"filtering",filterCollection:[{field:this._colName,matchcase:!0,operator:n,value:s,predicate:"or"}],fieldName:this._colName,ejpredicate:{field:this._colName,operator:n,value:s,isComplex:!1,ignoreCase:!1},tableID:this._tableId};i._excelFilter._predicates[r][this._colName]=t.Predicate(this._colName,n,s),this._filterHandler(o),e("#"+l).ejDialog("close"),e("#"+l+"_"+this._colType).hide()},_fltrClrHandler:function(){var t=this.XLObj._id+"_filter_custom";this._clearFilterColumn(this._colName,"","","Or","","",this._tableId),e("#"+t).ejDialog("close"),e("#"+t+"_"+this._colType).hide()},_openNormalFilterDlg:function(t,i,r,l){var n=this.XLObj,s=n._id+"_filter_custom";e("#"+s+"_"+i).show(),e("#"+s).ejDialog("open"),e("#"+s+"_"+i+"_ddinput").ejDropDownList("option",{selectedItemIndex:0}),this._colName=t,this._colType=i,this._tableId=r,"string"===i&&e("#"+s+"_"+i+"_acString").ejAutocomplete("option",{fields:{key:this._colName,text:this._colName},dataSource:n.getSheet(n.getActiveSheetIndex()).filterSettings.tableRange[l].filteredRange})}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.ribbon=function(e){var t,i;this.XLObj=e,this._appTabCollection={},this._tabCollection=[],this._contextualTabCollection=[],this._smallBtnHeight=25,this._mediumBtnHeight=35,this._bigBtnHeight=75,this._splitBtnHeight=75,this._dropDownHeight=25,this._ribbonState=!0,this._isSetModel=!1,this._isDesignTab=!0,this._isDirtySelect=!1,this._isMergeSelect=!1,this._isFirstColumn=!1,this._isFilterSelect={},this._hasTitle="",this._isNmgrid="",this._sparklineDesignType="",this._isEditGroupLocationClick=!1,this._isEditSingleSparklineClick=!1,this._isPanelVisible=!1,this._ctrlCreated=!1,this._homeBtnIds=["Home_Clipboard_Paste","Home_Font_IncreaseFontSize","Home_Font_DecreaseFontSize","Home_Alignment_DecreaseIndent","Home_Alignment_IncreaseIndent","Home_Number_IncreaseDecimal","Home_Number_DecreaseDecimal","Home_Actions_Undo","Home_Actions_Redo","Home_Number_Accounting","Home_Number_CommaStyle","Home_Number_Percentage","Home_Clipboard_Cut","Home_Clipboard_Copy"],this._homeSptBtnIds=["Home_Clipboard_PasteOptions","Home_Font_Border","Home_Styles_ConditionalFormatting","Home_Styles_FormatAsTable","Home_Styles_CellStyles","Others_Editing_FindSelect","Home_Editing_Clear","Home_Alignment_Merge","Home_Editing_SortFilter","Home_Editing_AutoSum"],this._homeToggleBtnIds=["Home_Font_Bold","Home_Font_Italic","Home_Font_Underline","Home_Font_StrikeThrough","Home_Alignment_AlignLeft","Home_Alignment_AlignRight","Home_Alignment_AlignCenter","Home_Alignment_TopAlign","Home_Alignment_MiddleAlign","Home_Alignment_BottomAlign","Home_Alignment_WrapText","Home_Clipboard_FormatPainter"],this._homeDdIds=["Home_Number_NumberFormat","Home_Font_FontSize","Home_Font_FontFamily"],this._homeCpIds=["Home_Font_FillColor","Home_Font_FontColor"],this._insertBtnIds=["Insert_Tables_PivotTable","Insert_Tables_Table","Insert_Links_Hyperlink","Insert_Illustrations_Pictures","Insert_Sparkline_Line","Insert_Sparkline_Column","Insert_Sparkline_Winloss"],this._insertSptBtnIds=["Insert_Charts_ColumnChart","Insert_Charts_BarChart","Insert_Charts_StockChart","Insert_Charts_LineChart","Insert_Charts_AreaChart","Insert_Charts_PieChart","Insert_Charts_ScatterChart"],this._dataBtnIds=["Data_SortFilter_SortAtoZ","Data_SortFilter_SortZtoA","Data_SortFilter_Filter","Data_SortFilter_ClearFilter","Data_DataTools_DataValidation"],this._dataSptBtnIds=["Data_DataTools_DataValidationOptions"],this._pageLayChckBxIds=["PageLayout_Show_Headings","PageLayout_Show_Gridlines"],this._pageLayBtnIds=["PageLayout_PageLayout_PageSize","PageLayout_Print_Print","PageLayout_Print_PrintSelected"],this._pageLaySptBtnIds=["PageLayout_PageLayout_PageSizeOptions"],this._reviewTglBtnIds=["Review_Changes_ProtectSheet","Review_Changes_ProtectWorkbook","Review_Changes_LockCell"],this._cmntBtnIds=["Review_Comments_NewComment","Review_Comments_DeleteComment","Review_Comments_PreviousComment","Review_Comments_NextComment","Review_Comments_ShowHideComment"],this._cmntTglBtnIds=["Review_Comments_ShowAllComments"],this._othersBtnIds=["Others_Cells_InsertCell","Others_Cells_DeleteCell","Others_Formulas_NameManager","Others_Formulas_DefineName","Others_CalCulation_CalculateNow","Others_CalCulation_CalculateSheet"],this._othersSptBtnIds=["Others_Cells_InsertCellOptions","Others_Cells_DeleteCellOptions","Others_Editing_FindSelect","Others_Window_FreezePanes","Others_CalCulation_CalculationOptions"],this._contextualBtnIds=["Design_Tools_ResizeTable","Design_Tools_ConvertToRange"],this._contextualInputIds=["Ribbon_Design_Properties_TableName"],this._contextualCheckBoxIds=["Design_TableStyleOptions_FirstColumn","Design_TableStyleOptions_LastColumn","Design_TableStyleOptions_TotalRow","Design_TableStyleOptions_FilterColumn"],this._protectStateBtnIds=["Home_Clipboard_Cut","Home_Clipboard_Copy","Others_Editing_FindSelect","Home_Clipboard_Paste","Home_Clipboard_PasteOptions","Home_Actions_Undo","Home_Actions_Redo","Review_Changes_ProtectSheet","Review_Changes_ProtectWorkbook","PageLayout_Print_Print","PageLayout_Print_PrintSelected","Others_Cells_InsertCellOptions","Others_Cells_DeleteCellOptions","Others_Cells_InsertCell","Others_Cells_DeleteCell"],this._chartDesignBtnIds=["ChartDesign_Data_SwitchRowColumn","ChartDesign_Data_SelectData","ChartDesign_Type_ChangeChartType"],this._chartDesignSptBtnIds=["ChartDesign_ChartLayouts_AddChartElement"],this._chartDesignDdIds=["ChartDesign_ChartThemes_ChartThemes"],this._sparklineDesignSptBtnIds=["SparklineDesign_Sparkline_EditData","SparklineDesign_Style_SparklineColor","SparklineDesign_Style_MarkerColor"],this._formatBtnIds=["Format_Adjust_ChangePicture"],this._formatSptBtnIds=["Format_Adjust_ResetPicture","Format_Border_PictureBorder"],this._pasteMenuData=[{id:"PasteSpecial",text:e._getLocStr("PasteSpecial"),parentId:null},{id:"PasteValues",text:e._getLocStr("PasteValues"),parentId:null}],this._fontFamily=[{value:"1",text:"Angsana New"},{value:"2",text:"Arial"},{value:"3",text:"Arial Black"},{value:"4",text:"Batang"},{value:"5",text:"Book Antiqua"},{value:"6",text:"Browallia New"},{value:"7",text:"Calibri"},{value:"8",text:"Cambria"},{value:"9",text:"Candara"},{value:"10",text:"Century"},{value:"11",text:"Comic Sans MS"},{value:"12",text:"Consolas"},{value:"13",text:"Constantia"},{value:"14",text:"Corbel"},{value:"15",text:"Cordia New"},{value:"16",text:"Courier"},{value:"17",text:"Courier New"},{value:"18",text:"DilleniaUPC"},{value:"19",text:"Dotum"},{value:"20",text:"FangSong"},{value:"21",text:"Garamond"},{value:"22",text:"Georgia"},{value:"23",text:"Gulim"},{value:"24",text:"GungSuh"},{value:"25",text:"KaiTi"},{value:"26",text:"JasmineUPC"},{value:"27",text:"Malgun Gothic"},{value:"28",text:"Mangal"},{value:"29",text:"Meiryo"},{value:"30",text:"Microsoft JhengHei"},{value:"31",text:"Microsoft YaHei"},{value:"32",text:"MingLiu"},{value:"33",text:"MingLiU_HKSCS"},{value:"34",text:"MS Gothic"},{value:"35",text:"MS Mincho"},{value:"36",text:"MS PGothic"},{value:"37",text:"MS PMincho"},{value:"38",text:"PMingliU"},{value:"39",text:"PMingLiU-ExtB"},{value:"40",text:"SimHei"},{value:"41",text:"SimSun"},{value:"42",text:"SimSun-ExtB"},{value:"43",text:"Tahoma"},{value:"44",text:"Times"},{value:"45",text:"Times New Roman"},{value:"46",text:"Trebuchet MS"},{value:"47",text:"Verdana"},{value:"48",text:"Yu Gothic"},{value:"49",text:"Yu Mincho"}],this._fontSize=[{value:"8pt",text:"8"},{value:"9pt",text:"9"},{value:"10pt",text:"10"},{value:"11pt",text:"11"},{value:"12pt",text:"12"},{value:"14pt",text:"14"},{value:"16pt",text:"16"},{value:"18pt",text:"18"},{value:"20pt",text:"20"},{value:"22pt",text:"22"},{value:"24pt",text:"24"},{value:"26pt",text:"26"},{value:"28pt",text:"28"},{value:"36pt",text:"36"},{value:"48pt",text:"48"},{value:"72pt",text:"72"}],this._fontStyle=[{value:"1",text:"Normal"},{value:"2",text:"Bold"},{value:"3",text:"Italic"},{value:"4",text:"Bold Italic"}],this._mergeMenuData=[{id:"MergeAndCenter",text:e._getLocStr("MergeAndCenter"),parentId:null,sprite:"e-icon e-ss-mergecenter"},{id:"MergeAcross",text:e._getLocStr("MergeAcross"),parentId:null,sprite:"e-icon e-ss-mergeacross"},{id:"MergeCells",text:e._getLocStr("MergeCells"),parentId:null,sprite:"e-icon e-ss-merge"},{id:"UnmergeCells",text:e._getLocStr("UnmergeCells"),parentId:null,sprite:"e-icon e-ss-unmerge"}],this._sortFltrMenuData=[{id:"Ribbon_SortAtoZ",text:this.XLObj._getLocStr("SortAtoZ"),parentId:null,sprite:"e-icon e-ssdrop-sortatoz"},{id:"Ribbon_SortZtoA",text:this.XLObj._getLocStr("SortZtoA"),parentId:null,sprite:"e-icon e-ssdrop-sortztoa"},{id:"Ribbon_Filter",text:this.XLObj._getLocStr("Filter"),parentId:null,sprite:"e-icon e-ssdrop-filter"},{id:"Ribbon_ClearFilter",text:this.XLObj._getLocStr("ClearFilter"),parentId:null,sprite:"e-icon e-ssdrop-clearfilter"}],this._findMenuData=[{id:"Find",text:e._getLocStr("Find")+"...",parentId:null,sprite:"e-icon e-ss-find"},{id:"Replace",text:e._getLocStr("Replace")+"...",parentId:null,sprite:"e-icon e-ss-replace"},{id:"GoTo",text:e._getLocStr("GoTo")+"...",parentId:null,sprite:"e-icon e-ss-goto"},{id:"GoToSpecial",text:e._getLocStr("GoTo")+" "+e._getLocStr("Special")+"...",parentId:null},{id:"Formulas",text:e._getLocStr("Formulas"),parentId:null},{id:"Comments",text:e._getLocStr("Comments"),parentId:null},{id:"CFormat",text:e._getLocStr("ConditionalFormat"),parentId:null},{id:"Constants",text:e._getLocStr("Constants"),parentId:null},{id:"DataValidation",text:e._getLocStr("DataValidation"),parentId:null}],this._calcOptData=[{id:this.XLObj._id+"_CalcAuto",text:e._getLocStr("Automatic"),parentId:null,sprite:"e-icon e-ss-calcauto"},{id:this.XLObj._id+"_CalcManual",text:e._getLocStr("Manual"),parentId:null,sprite:"e-icon"}],this._valMenuData=[{id:"Validation",text:e._getLocStr("DataValidation")+"...",parentId:null,sprite:"e-icon e-ss-validation"},{id:"HighlightVal",text:e._getLocStr("HighlightVal"),parentId:null,sprite:"e-icon e-ss-hlval"},{id:"ClearHLVal",text:e._getLocStr("ClearFormats"),parentId:null,sprite:"e-icon e-ss-clearval"},{id:"ClearVal",text:e._getLocStr("ClearVal"),parentId:null,sprite:"e-icon e-ss-clearval"}],this._pageSizes=[{id:"A4",text:"A4",parentId:null,sprite:"e-icon e-ss-A4size"},{id:"A3",text:"A3",parentId:null,sprite:"e-icon e-ss-A3size"},{id:"Letter",text:"Letter",parentId:null,sprite:"e-icon e-ss-lettersize"}],this._viewMenuData=[{id:"freezePanes",text:e._getLocStr("FreezePanes"),parentId:null,sprite:"e-icon e-ss-frzpane"},{id:"FreezeTopRow",text:e._getLocStr("FreezeTopRow"),parentId:null,sprite:"e-icon e-ss-frzrow"},{id:"FreezeFirstColumn",text:e._getLocStr("FreezeFirstColumn"),parentId:null,sprite:"e-icon e-ss-frzcln"}],this._insertMenuData=[{id:"InsertCells",text:e._getLocStr("InsCells")+"...",parentId:null,sprite:"e-icon e-ssr-inscell"},{id:"InsertSheetRows",text:e._getLocStr("InsRows"),parentId:null,sprite:"e-icon e-ssr-insrow"},{id:"InsertSheetColumns",text:e._getLocStr("InsCols"),parentId:null,sprite:"e-icon e-ssr-inscol"},{id:"InsertSheet",text:e._getLocStr("InsSheet"),parentId:null,sprite:"e-icon e-ssr-inssheet"}],this._resetPicture=[{id:"resetpicture",text:e._getLocStr("ResetPicture"),parentId:null,sprite:"e-icon e-ss-resetpicture"},{id:"resetsize",text:e._getLocStr("ResetSize"),parentId:null,sprite:"e-icon e-ss-resetpicture"}],t=e._getLocStr("BorderStyles").split("/"),this._borderMenuData=[{id:"bottom",text:e._getLocStr("BottomBorder"),parentId:null,sprite:"e-icon e-ss-bottom"},{id:"top",text:e._getLocStr("TopBorder"),parentId:null,sprite:"e-icon e-ss-top"},{id:"left",text:e._getLocStr("LeftBorder"),parentId:null,sprite:"e-icon e-ss-left"},{id:"right",text:e._getLocStr("RightBorder"),parentId:null,sprite:"e-icon e-ss-right"},{id:"noborder",text:e._getLocStr("NoBorder"),parentId:null,sprite:"e-icon e-ss-noborder"},{id:"allborder",text:e._getLocStr("AllBorder"),parentId:null,sprite:"e-icon e-ss-allborder"},{id:"outside",text:e._getLocStr("OutsideBorder"),parentId:null,sprite:"e-icon e-ss-outside"},{id:"thickbox",text:e._getLocStr("ThickBoxBorder"),parentId:null,sprite:"e-icon e-ss-thickbox"},{id:"doublebottom",text:e._getLocStr("BottomDoubleBorder"),parentId:null,sprite:"e-icon e-ss-doublebottom"},{id:"thickbottom",text:e._getLocStr("ThickBottomBorder"),parentId:null,sprite:"e-icon e-ss-thickbottom"},{id:"topandbottom",text:e._getLocStr("TopandBottomBorder"),parentId:null,sprite:"e-icon e-ss-topandbottom"},{id:"topandthickbottom",text:e._getLocStr("TopandThickBottomBorder"),parentId:null,sprite:"e-icon e-ss-topandthickbottom"},{id:"topanddoublebottom",text:e._getLocStr("TopandBottomDoubleBorder"),parentId:null,sprite:"e-icon e-ss-topanddoublebottom"},{id:"drawborder",text:e._getLocStr("DrawBorder"),parentId:null,sprite:"e-icon e-ss-drawborder"},{id:"drawbordergrid",text:e._getLocStr("DrawBorderGrid"),parentId:null,sprite:"e-icon e-ss-drawbordergrid"},{id:e._id+"_bordercolor",text:e._getLocStr("BorderColor"),parentId:null},{id:e._id+"_Ribbon_borderstyle",text:e._getLocStr("BorderStyle"),parentId:null},{id:e._id+"_Ribbon_bordercolor",text:"",parentId:e._id+"_bordercolor"},{id:"solid",text:t[0],parentId:e._id+"_Ribbon_borderstyle"},{id:"dashed",text:t[1],parentId:e._id+"_Ribbon_borderstyle"},{id:"dotted",text:t[2],parentId:e._id+"_Ribbon_borderstyle"},{id:"double",text:t[3],parentId:e._id+"_Ribbon_borderstyle"}],this._cFormatMenuData=[{id:e._id+"_HLCellRules",text:e._getLocStr("HighlightCellRules"),parentId:null,sprite:"e-icon e-ss-hlcellrules"},{id:"greaterthan",text:e._getLocStr("GreaterThan")+"...",parentId:e._id+"_HLCellRules",sprite:"e-icon e-ss-greaterthan"},{id:"lessthan",text:e._getLocStr("LessThan")+"...",parentId:e._id+"_HLCellRules",sprite:"e-icon e-ss-lessthan"},{id:"between",text:e._getLocStr("Between")+"...",parentId:e._id+"_HLCellRules",sprite:"e-icon e-ss-between"},{id:"equalto",text:e._getLocStr("EqualTo")+"...",parentId:e._id+"_HLCellRules",sprite:"e-icon e-ss-equalto"},{id:"textcontains",text:e._getLocStr("TextthatContains")+"...",parentId:e._id+"_HLCellRules",sprite:"e-icon e-ss-textcontains"},{id:"dateoccur",text:e._getLocStr("DateOccurring")+"...",parentId:e._id+"_HLCellRules",sprite:"e-icon e-ss-dateoccur"},{id:e._id+"_CreateRule",text:e._getLocStr("CreateRule"),parentId:null,sprite:"e-icon e-ss-createrule"},{id:e._id+"_ClearRules",text:e._getLocStr("ClearRules"),parentId:null,sprite:"e-icon e-ss-clearrules"},{id:"clearselected",text:e._getLocStr("ClearRulesfromSelected"),parentId:e._id+"_ClearRules"},{id:"clearall",text:e._getLocStr("ClearRulesfromEntireSheets"),parentId:e._id+"_ClearRules"}],this._textAlign=[{value:"1",text:"Left"},{value:"2",text:"Center"},{value:"3",text:"Right"}],this._verticalAlign=[{value:"1",text:"Top"},{value:"2",text:"Middle"},{value:"3",text:"Bottom"}],i=e._getLocStr("DataValidationAction").split("/"),this._actions=[{value:"Greater",text:i[0]},{value:"GreaterOrEqual",text:i[1]},{value:"Less",text:i[2]},{value:"LessOrEqual",text:i[3]},{value:"Equal",text:i[4]},{value:"NotEqual",text:i[5]},{value:"Between",text:i[6]},{value:"NotBetween",text:i[7]}],i=e._getLocStr("DataValidationType").split("/"),this._types=[{value:"number",text:i[0]},{value:"decimal",text:i[1]},{value:"date",text:i[2]},{value:"time",text:i[3]},{value:"text",text:i[4]},{value:"list",text:i[5]}],this._cFormatData={greaterthan:["GTTitle","GTContent"],lessthan:["LTTitle","LTContent"],between:["BWTitle","BWContent"],equalto:["EQTitle","EQContent"],textcontains:["ContainsTitle","ContainsContent"],dateoccur:["DateTitle","DateContent"]},this._styles=[{value:"redft",text:e._getLocStr("LightRedFillDark")},{value:"yellowft",text:e._getLocStr("YellowFillDark")},{value:"greenft",text:e._getLocStr("GreenFillDark")},{value:"redf",text:e._getLocStr("RedFill")},{value:"redt",text:e._getLocStr("RedText")}],this._currentCFormat="",this._addrList=[],this._within=[{value:"sheet",text:e._getLocStr("Sheet")},{value:"workbook",text:e._getLocStr("Workbook")}],this._sType=[{value:"columns",text:e._getLocStr("Columns")},{value:"rows",text:e._getLocStr("Rows")}],this._vType=[{value:"value",text:e._getLocStr("Value")},{value:"formula",text:e._getLocStr("Formula")},{value:"comment",text:e._getLocStr("Comments")}],this._direction=[{value:"down",text:e._getLocStr("Down")},{value:"up",text:e._getLocStr("Up")}],this._gotoRBtnSet1=["Comments","Blanks","LastCell","Formulas","Constants"],this._gotoRBtnSet2=["RowDiff","ColDiff","CFormat","DataValidation"],this._gotoChkBox=["GotoNumbers","GotoText","GotoLogicals","GotoError"],this._numberFormat=[{value:"General",text:e._getLocStr("LGeneral")},{value:"Number",text:e._getLocStr("NumberTab")},{value:"Currency",text:e._getLocStr("LCurrency")},{value:"Accounting",text:e._getLocStr("LAccounting")},{value:"Percentage",text:e._getLocStr("LPercentage")},{value:"Text",text:e._getLocStr("LText")},{value:"Shortdate",text:e._getLocStr("LShortdate")},{value:"Longdate",text:e._getLocStr("LLongdate")},{value:"Time",text:e._getLocStr("LTime")},{value:"Scientific",text:e._getLocStr("LScientific")},{value:"Fraction",text:e._getLocStr("LFraction")},{value:"Custom",text:e._getLocStr("LCustom")}],this._deleteMenuData=[{id:"DeleteCells",text:e._getLocStr("DelCells")+"...",parentId:null,sprite:"e-icon e-ssr-delcell"},{id:"DeleteSheetRows",text:e._getLocStr("DelRows"),parentId:null,sprite:"e-icon e-ssr-delrow"},{id:"DeleteSheetColumns",text:e._getLocStr("DelCols"),parentId:null,sprite:"e-icon e-ssr-delcol"},{id:"DeleteSheet",text:e._getLocStr("DelSheet"),parentId:null,sprite:"e-icon e-ssr-delsheet"}],this._clearMenuData=[{id:"Clear_All",text:e._getLocStr("ClearAll"),parentId:null,sprite:"e-icon e-ss-clear"},{id:"Clear_Formats",text:e._getLocStr("ClearFormats"),parentId:null,sprite:"e-icon e-ss-clearformat"},{id:"Clear_Contents",text:e._getLocStr("ClearContents"),parentId:null},{id:"Clear_Comments",text:e._getLocStr("ClearComments"),parentId:null},{id:"Clear_Hyperlinks",text:e._getLocStr("ClearHyperLinks"),parentId:null}],this._autosumMenuData=[{id:"Sum",text:e._getLocStr("Sum"),parentId:null,sprite:"e-icon e-ss-autosum"},{id:"Average",text:e._getLocStr("Average"),parentId:null},{id:"Count",text:e._getLocStr("CountNumber"),parentId:null},{id:"Max",text:e._getLocStr("Max"),parentId:null},{id:"Min",text:e._getLocStr("Min"),parentId:null}],this._chartThemes=[{value:"flatlight",text:"Flat Light"},{value:"flatdark",text:"Flat Dark"},{value:"azure",text:"Azure"},{value:"azuredark",text:"Azure Dark"},{value:"lime",text:"Lime"},{value:"limedark",text:"Lime Dark"},{value:"saffron",text:"Saffron"},{value:"saffrondark",text:"Saffron Dark"}],this._isCustomCellStyleReset=!1,this.allButtonIds=["Home_Clipboard_Paste","Home_Font_IncreaseFontSize","Home_Font_DecreaseFontSize","Home_Alignment_DecreaseIndent","Home_Alignment_IncreaseIndent","Home_Number_IncreaseDecimal","Home_Number_DecreaseDecimal","Home_Actions_Undo","Home_Actions_Redo","Home_Number_Accounting","Home_Number_CommaStyle","Home_Number_Percentage","Home_Clipboard_Cut","Home_Clipboard_Copy","Insert_Tables_PivotTable","Insert_Tables_Table","Insert_Links_Hyperlink","Insert_Illustrations_Pictures","Insert_Sparkline_Line","Insert_Sparkline_Column","Insert_Sparkline_Winloss","Data_SortFilter_SortAtoZ","Data_SortFilter_SortZtoA","Data_SortFilter_Filter","Data_SortFilter_ClearFilter","Data_DataTools_DataValidation","PageLayout_PageLayout_PageSize","PageLayout_Print_Print","PageLayout_Print_PrintSelected","Review_Comments_NewComment","Review_Comments_DeleteComment","Review_Comments_PreviousComment","Review_Comments_NextComment","Review_Comments_ShowHideComment","Others_Cells_InsertCell","Others_Cells_DeleteCell","Others_Formulas_NameManager","Others_Formulas_DefineName","Others_CalCulation_CalculateNow","Others_CalCulation_CalculateSheet","Design_Tools_ResizeTable","Design_Tools_ConvertToRange","ChartDesign_Data_SwitchRowColumn","ChartDesign_Data_SelectData","ChartDesign_Type_ChangeChartType","Format_Adjust_ChangePicture"],this.allSplitButtonIds=["Home_Clipboard_PasteOptions","Home_Font_Border","Home_Styles_ConditionalFormatting","Home_Styles_FormatAsTable","Home_Styles_CellStyles","Others_Editing_FindSelect","Home_Editing_Clear","Home_Alignment_Merge","Home_Editing_SortFilter","Home_Editing_AutoSum","Insert_Charts_ColumnChart","Insert_Charts_BarChart","Insert_Charts_StockChart","Insert_Charts_LineChart","Insert_Charts_AreaChart","Insert_Charts_PieChart","Insert_Charts_ScatterChart","Data_DataTools_DataValidationOptions","PageLayout_PageLayout_PageSizeOptions","Others_Cells_InsertCellOptions","Others_Cells_DeleteCellOptions","Others_Editing_FindSelect","Others_Window_FreezePanes","Others_CalCulation_CalculationOptions","ChartDesign_ChartLayouts_AddChartElement","Format_Adjust_ResetPicture","Format_Border_PictureBorder","SparklineDesign_Style_MarkerColor","SparklineDesign_Style_SparklineColor","SparklineDesign_Sparkline_EditData"],this.allToggleButtonIds=["Home_Font_Bold","Home_Font_Italic","Home_Font_Underline","Home_Font_StrikeThrough","Home_Alignment_AlignLeft","Home_Alignment_AlignRight","Home_Alignment_AlignCenter","Home_Alignment_TopAlign","Home_Alignment_MiddleAlign","Home_Alignment_BottomAlign","Home_Alignment_WrapText","Home_Clipboard_FormatPainter","Review_Comments_ShowAllComments","Review_Changes_ProtectSheet","Review_Changes_ProtectWorkbook","Review_Changes_LockCell"],this.allDropDownIds=["ChartDesign_ChartThemes_ChartThemes","Home_Number_NumberFormat","Home_Font_FontSize","Home_Font_FontFamily"],this.colorPickerIds=["Home_Font_FillColor","Home_Font_FontColor"],this.checkBoxIds=["PageLayout_Show_Headings","PageLayout_Show_Gridlines","Design_TableStyleOptions_FirstColumn","Design_TableStyleOptions_LastColumn","Design_TableStyleOptions_TotalRow","Design_TableStyleOptions_FilterColumn"],this.InputIds=["Ribbon_Design_Properties_TableName"],this._fileMenuData=[{id:"File",text:e._getLocStr("File"),parentId:null},{id:"New",text:e._getLocStr("New"),parentId:"File",sprite:"e-icon e-ss-newsheet"},{id:"Open",text:e._getLocStr("Open")+"...",parentId:"File",sprite:"e-icon e-ss-open"},{id:"Save",text:e._getLocStr("SaveAs"),parentId:"File",sprite:"e-icon e-ss-saveas"},{id:"Print",text:e._getLocStr("Print"),parentId:"File",sprite:"e-icon e-ssm-print"},{id:"ExportXL",text:e._getLocStr("ExportXL"),parentId:"Save",sprite:"e-icon e-ssm-exportxl"},{id:"ExportCsv",text:e._getLocStr("ExportCsv"),parentId:"Save",sprite:"e-icon e-ssm-exportcsv"},{id:"ExportPdf",text:e._getLocStr("ExportPdf"),parentId:"Save",sprite:"e-icon e-ssm-exportpdf"},{id:"PrintSheet",text:e._getLocStr("PrintSheet"),parentId:"Print",sprite:"e-icon e-ssm-print"},{id:"PrintSelected",text:e._getLocStr("PrintSelected"),parentId:"Print",sprite:"e-icon e-ssm-printselected"}],this._isAppTabCreate=!1,this._isHomeTabCreate=!1,this._isInsertTabCreate=!1,this._isDataTabCreate=!1,this._isPageLayoutTabCreate=!1,this._isReviewTabCreate=!1,this._isOthersTabCreate=!1,this._isDesignTabCreate=!1,this._isFormatTabCreate=!1,this._isChartTabCreate=!1,this._analyzeTabCreate=!1,this._isSparklineTabCreate=!1,this._isHomeTabTrgt=!1,this._isInsertTabTrgt=!1,this._isDataTabTrgt=!1,this._isPageLayoutTrgtTab=!1,this._isReviewTabTrgt=!1,this._isOthersTabTrgt=!1,this._isDesignTabTrgt=!1,this._isFormatTabTrgt=!1,this._isChartTabTrgt=!1,this._analyzeTabTrgt=!1,this._isSparklineTrgt=!1,this._scopeBookCln={}},t.spreadsheetFeatures.ribbon.prototype={_renderChartTypeDialog:function(){var e,i,r,l,n,s,o,a,d,h,c=this.XLObj,u=c._id+"_charttypedlg";return e=t.buildTag("div#"+u+".e-chartdialog","",{},{overflow:"hidden"}),i=t.buildTag("div#"+u+"_allcharttab.e-chtdlgtab"),d=t.buildTag("div.e-dlg-fields e-dlgctndiv"),s=t.buildTag("ul .e-ul","",""),a=t.buildTag("a",c._getLocStr("AllCharts"),{},{href:"#"+c._id+"_allchart"}),o=t.buildTag("li",a),e.append(d.append(i.append(s.append(o)))),n=t.buildTag("div#"+u+"_btndiv.e-dlg-btnfields"),h=t.buildTag("div.e-dlg-btnctnr"),r=t.buildTag("input#"+u+"_okbtn","",{},{type:"button"}),l=t.buildTag("input#"+u+"_cantn","",{},{type:"button"}),r.ejButton({text:c._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._chartTypeOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),l.ejButton({text:c._getLocStr("Cancel"),click:t.proxy(this._chartTypeCancel,this),showRoundedCorner:!0,width:60}),n.append(h.append(r,l)),e.append(n),c.element.append(e),i.ejTab({cssClass:"e-ss-dlgtab",width:"100%",height:"auto"}),this._renderAllChartTab(),e.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:c._getLocStr("ChartType"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-charttype-dlg e-ss-mattab e-"+c._id+"-dlg",close:t.proxy(this._dialogClose,this)}),e},_renderAllChartTab:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m=[],_="",f="",b=this.XLObj,C=b._id,S=C+"_chartdlg_allcharttab",x=["Column-6","Bar-6","Radar-2","Line-2","Area-3","Pie-3","Scatter-1"];for(u=t.buildTag("div#"+S+"_content.e-ss-leftdiv",""),a=t.buildTag("div#"+S+"_content.e-chtdlgcontent e-ss-rightdiv","",{overflow:"auto"}),g=t.buildTag("ul #"+S+"_list .e-ul"),n=0,s=x.length;n<s;n++)f+="<li><span class='e-icon e-ss-dlg"+(d=x[n].split("-")[0]).toLowerCase()+"chart'></span>"+b._getLocStr(d)+"</li>",m.push(d);for(g.append(e(f)),p=t.buildTag("div#"+C+"_allchart_table.e-ss-maindiv","",{cellspacing:"0",cellpadding:"0",display:"table",width:"100%"}),e("#"+C+"_allchart").append(p),p.append(u.append(g)),this._createChartList(m),p.append(a),r=0,s=x.length;r<s;r++){switch((o=x[r].split("-"))[0]){case"Column":c=[b._getLocStr("ClusteredColumn"),b._getLocStr("StackedColumn"),"100%&nbsp;"+b._getLocStr("StackedColumn"),"3-D&nbsp;"+b._getLocStr("ClusteredColumn"),"3-D&nbsp;"+b._getLocStr("StackedColumn"),"3-D&nbsp;100%&nbsp;"+b._getLocStr("StackedColumn")];break;case"Bar":c=[b._getLocStr("ClusteredBar"),b._getLocStr("StackedBar"),"100%&nbsp;"+b._getLocStr("StackedBar"),"3-D&nbsp;"+b._getLocStr("ClusteredBar"),"3-D&nbsp;"+b._getLocStr("StackedBar"),"3-D&nbsp;100%&nbsp;"+b._getLocStr("StackedBar")];break;case"Radar":c=[b._getLocStr("Radar"),b._getLocStr("RadarMarkers")];break;case"Line":c=[b._getLocStr("Line"),b._getLocStr("LineMarkers")];break;case"Area":c=[b._getLocStr("Area"),b._getLocStr("StackedArea"),"100%&nbsp;"+b._getLocStr("StackedArea")];break;case"Pie":c=[b._getLocStr("Pie"),"3-D&nbsp;"+b._getLocStr("Pie"),b._getLocStr("Doughnut")];break;case"Scatter":c=[b._getLocStr("Scatter")]}for(d=o[0].toLowerCase(),h=t.buildTag("div#"+C+"_"+d+"chart"),i=1,l=parseInt(o[1]);i<=l;i++)_+="<div class='e-chartimg e-dlg"+d+"chart"+i+"' title='"+c[i-1]+"'></div>";a.append(h.append(_)),e("#"+C+"_"+d+"chart").find(".e-dlg"+d+"chart1").addClass("e-chartselect"),h.hide(),_=""}b._on(e("#"+C+"_allchart").find(".e-chartimg"),"click",b._allChartType),e("#"+C+"_columnchart").show()},_createChartList:function(i){var r,l=this.XLObj,n=l._id+"_chartdlg_allcharttab",s=e("#"+n+"_list"),o=t.buildTag("div.e-ss-drpdiv");r=t.buildTag("input#"+n+"_input"),e("#"+l._id+"_allchart").prepend(o.append(r)),r.ejDropDownList({dataSource:i,width:"100%",fields:{id:"value",text:"text",value:"text"},select:e.proxy(this._onChartChange,this),selectedItemIndex:0}),s.ejListBox({selectedItemIndex:0,width:"120",height:"250",fields:{text:"text",value:"value"},select:e.proxy(this._onChartChange,this),allowMultiSelection:!1})},_onChartChange:function(t){for(var i=this.XLObj,r=t.value?t.value.toLowerCase():t.text.toLowerCase(),l=["column","bar","radar","line","area","pie","scatter"],n=0;n<l.length;n++)e("#"+i._id+"_"+l[n]+"chart").hide();e("#"+i._id+"_"+r+"chart").show(),e("#"+i._id+"_allchart").find(".e-chartimg").removeClass("e-chartselect"),e("#"+i._id+"_"+r+"chart").find(".e-dlg"+r+"chart1").addClass("e-chartselect")},_initValDialog:function(){var e,i,r,l,n,s,o,a,d,h,c=this.XLObj;e=t.buildTag("div#"+c._id+"_ValDialog"),i=t.buildTag("div#"+c._id+"_ValDialog_valDlgTab"),d=t.buildTag("div.e-dlg-fields e-dlgctndiv"),s=t.buildTag("ul .e-ul"),a=t.buildTag("a",c._getLocStr("Settings"),{},{href:"#"+c._id+"_Validation"}),o=t.buildTag("li",a),s.append(o),i.append(s),e.append(d.append(i)),n=t.buildTag("div#"+c._id+"btnDiv.e-dlg-btnfields"),h=t.buildTag("div.e-dlg-btnctnr"),r=t.buildTag("input#"+c._id+"Dialog_OkBtn","",{},{type:"button"}),l=t.buildTag("input#"+c._id+"Dialog_CancelBtn","",{},{type:"button"}),r.ejButton({text:c._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._valDlgBtnClick,this,"ok"),enabled:!0,cssClass:"e-ss-okbtn"}),l.ejButton({text:c._getLocStr("Cancel"),click:t.proxy(this._valDlgBtnClick,this,"cancel"),showRoundedCorner:!0,width:60}),n.append(h.append(r,l)),c.element.append(e.append(n)),i.ejTab({width:"100%",height:"auto",cssClass:"e-ss-dlgtab"}),this._renderValDialog(),e.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:c._getLocStr("DataValidation"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-valdlg e-ss-mattab e-"+c._id+"-dlg",close:t.proxy(this._dialogClose,this)}),this._dialogValidate("_ValDialog")},_initCFDialog:function(){var e,i,r,l,n,s,o=this.XLObj;return e=t.buildTag("div#"+o._id+"_CFDialog"),o.element.append(e),i=t.buildTag("div#"+o._id+"_CondFormat.e-dlgctndiv"),e.append(i),n=t.buildTag("div#"+o._id+"cfBtnDiv.e-dlg-btnfields"),s=t.buildTag("div.e-dlg-btnctnr"),r=t.buildTag("input#"+o._id+"cfDialog_OkBtn","",{},{type:"button"}),l=t.buildTag("input#"+o._id+"cfDialog_CancelBtn","",{},{type:"button"}),r.ejButton({text:o._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._dlgCFOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),l.ejButton({text:o._getLocStr("Cancel"),click:t.proxy(this._dlgCFCancel,this),showRoundedCorner:!0,width:"25%"}),n.append(s.append(r,l)),e.append(n),e.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:o._getLocStr("ConditionalFormat"),width:"auto",cssClass:"e-ss-dialog e-ss-cfdlg e-"+o._id+"-dlg",close:t.proxy(this._dialogClose,this)}),e},_initHLDialog:function(){var i,r,l,n,s,o,a,d,h,c,u=this.XLObj;i=t.buildTag("div#"+u._id+"_HLDialog"),r=t.buildTag("div#"+u._id+"_HLDialogTab"),h=t.buildTag("div.e-dlg-fields e-dlgctndiv"),l=t.buildTag("ul .e-ul"),s=t.buildTag("a",u._getLocStr("WebPage"),{},{href:"#"+u._id+"_Web"}),n=t.buildTag("li",s),l.append(n),s=t.buildTag("a",u._getLocStr("WorkSheet"),{},{href:"#"+u._id+"_Doc"}),n=t.buildTag("li",s),l.append(n),r.append(l),i.append(h.append(r)),o=t.buildTag("div#"+u._id+"hlBtnDiv.e-dlg-btnfields"),c=t.buildTag("div.e-dlg-btnctnr"),a=t.buildTag("input#"+u._id+"hlDialog_OkBtn","",{},{type:"button"}),d=t.buildTag("input#"+u._id+"hlDialog_CancelBtn","",{},{type:"button"}),a.ejButton({text:u._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgHLOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),d.ejButton({text:u._getLocStr("Cancel"),click:t.proxy(this._dlgHLCancel,this),showRoundedCorner:!0,width:60}),o.append(c.append(a,d)),i.append(o),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:u._getLocStr("InsertHyperLink"),width:"auto",cssClass:"e-ss-dialog e-ss-hyperlinkdlg e-ss-mattab e-"+u._id+"-dlg",close:t.proxy(this._dialogClose,this),open:t.proxy(function(){var t=e("#"+u._id+"_Ribbon_webAddress"),i=e("#"+u._id+"_Ribbon_cellAddress");t.focus().setInputPos(t.val().length),i.focus().setInputPos(i.val().length)})}),r.ejTab({width:"100%",itemActive:t.proxy(this._hlTabChange,this),cssClass:"e-ss-dlgtab"}),this._renderHLDialog()},_initFRDialog:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m=this.XLObj;i=t.buildTag("div#"+m._id+"_FRDialog"),r=t.buildTag("div#"+m._id+"_FRDialog_FPDlgTab"),c=t.buildTag("div.e-dlg-fields e-dlgctndiv"),d=t.buildTag("ul .e-ul"),u=t.buildTag("a",m._getLocStr("Find"),{},{href:"#"+m._id+"_Find"}),h=t.buildTag("li",u),d.append(h),u=t.buildTag("a",m._getLocStr("Replace"),{},{href:"#"+m._id+"_Replace"}),h=t.buildTag("li",u),d.append(h),u=t.buildTag("a",m._getLocStr("Settings"),{},{href:"#"+m._id+"_Settings"}),h=t.buildTag("li",u),d.append(h),r.append(d),i.append(c.append(r)),o=t.buildTag("div#"+m._id+"btnFRDiv.e-dlg-btnfields"),a=t.buildTag("div.e-dlg-btnctnr"),g=t.buildTag("input#"+m._id+"FR_ReplaceBtn","",{"margin-left":0},{type:"button"}),p=t.buildTag("input#"+m._id+"FR_ReplaceAllBtn","",{},{type:"button"}),l=t.buildTag("input#"+m._id+"FR_NextBtn","",{},{type:"button"}),n=t.buildTag("input#"+m._id+"FR_PrevBtn","",{},{type:"button"}),s=t.buildTag("input#"+m._id+"FR_CloseBtn","",{},{type:"button"}),g.ejButton({text:m._getLocStr("Replace"),showRoundedCorner:!0,width:55,click:t.proxy(this._btnFROnClick,this,"FR_ReplaceBtn"),enabled:!0}).css("visibility","hidden"),p.ejButton({text:m._getLocStr("ReplaceAll"),showRoundedCorner:!0,click:t.proxy(this._btnFROnClick,this,"FR_ReplaceAllBtn"),enabled:!0}).css("visibility","hidden"),l.ejButton({text:m._getLocStr("FindNext"),showRoundedCorner:!0,width:69,click:t.proxy(this._btnFROnClick,this,"FR_NextBtn"),enabled:!0}),n.ejButton({text:m._getLocStr("FindPrev"),showRoundedCorner:!0,width:69,click:t.proxy(this._btnFROnClick,this,"FR_PrevBtn"),enabled:!0}),s.ejButton({text:m._getLocStr("Close"),click:t.proxy(this._btnFROnClick,this,"FR_CloseBtn"),showRoundedCorner:!0,width:47}),o.append(a.append(g,p,l,n,s)),i.append(o),i.ejDialog({showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:m._getLocStr("FindnReplace"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-mattab e-ss-frdlg e-"+m._id+"-dlg",close:t.proxy(this._dialogClose,this),open:t.proxy(function(){m._phoneMode?(e("#"+m._id+"FR_ReplaceBtn").hide(),e("#"+m._id+"FR_ReplaceAllBtn").hide()):(e("#"+m._id+"FR_ReplaceBtn").show(),e("#"+m._id+"FR_ReplaceAllBtn").show());var t=e("#"+m._id+"_Ribbon_textFind");t.focus().setInputPos(t.val().length)})}),r.ejTab({width:"100%",itemActive:t.proxy(this._findTabChange,this),cssClass:"e-ss-dlgtab"})},_initGoToDialog:function(){var e,i,r,l,n,s,o,a,d,h,c=this.XLObj;e=t.buildTag("div#"+c._id+"_GoDialog"),i=t.buildTag("div#"+c._id+"_GoToDlgTab"),d=t.buildTag("div.e-dlg-fields e-dlgctndiv"),l=t.buildTag("ul .e-ul"),s=t.buildTag("a",c._getLocStr("GoTo"),{},{href:"#"+c._id+"_GoTo"}),n=t.buildTag("li",s),l.append(n),s=t.buildTag("a",c._getLocStr("GoTo")+" "+c._getLocStr("Special"),{},{href:"#"+c._id+"_GoToSp"}),n=t.buildTag("li",s),l.append(n),i.append(l),e.append(d.append(i)),r=t.buildTag("div#"+c._id+"btnDiv.e-dlg-btnfields"),h=t.buildTag("div.e-dlg-btnctnr"),e.append(r.append(h)),o=t.buildTag("input#"+c._id+"Dialog_GoOkBtn","",{},{type:"button"}),a=t.buildTag("input#"+c._id+"Dialog_GoCancelBtn","",{},{type:"button"}),o.ejButton({text:c._getLocStr("Ok"),showRoundedCorner:!0,width:"23%",click:t.proxy(this._gotoBtnClick,this,"ok"),cssClass:"e-ss-okbtn"}),a.ejButton({text:c._getLocStr("Cancel"),click:t.proxy(this._gotoBtnClick,this,"cancel"),showRoundedCorner:!0,width:60}),h.append(o,a),c.element.append(e)},_initPvtDialog:function(){var e,i,r,l,n,s=this.XLObj;e=t.buildTag("div#"+s._id+"_PvtDialog"),s.element.append(e),e.append(t.buildTag("div#"+s._id+"_Pivot.e-dlgctndiv")),l=t.buildTag("div#"+s._id+"pvtBtnDiv.e-dlg-btnfields"),n=t.buildTag("div.e-dlg-btnctnr"),i=t.buildTag("input#"+s._id+"PvtDialog_OkBtn"),r=t.buildTag("input#"+s._id+"PvtDialog_CancelBtn"),i.ejButton({text:s._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._dlgPvtOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),r.ejButton({text:s._getLocStr("Cancel"),click:t.proxy(this._dlgPvtCancel,this),showRoundedCorner:!0,width:"25%"}),l.append(n.append(i,r)),e.append(l),e.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:s._getLocStr("CreatePivotTable"),width:"auto",cssClass:"e-ss-dialog e-"+s._id+"-dlg e-ss-pvtdlg",close:t.proxy(this._dialogClose,this)})},_dialogClose:function(){this.XLObj._setSheetFocus()},_beforeDlgClose:function(t){e("#"+this.XLObj._id+"_nmgrid_dialogEdit_overLay").length&&(t.cancel=!0)},_homeTabObj:function(){var e,i=this.XLObj,r="imagetop",l={id:"home",text:i._getLocStr("HOME"),groups:[]},n=i._id;e={id:"Clipboard",text:i._getLocStr("Clipboard"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Home_Clipboard_Paste","paste","textandimage","e-icon e-ssr-paste",45,this._mediumBtnHeight,"Paste","PasteContent",!1,r,""," (Ctrl+V)"),this._generateSplitBtn("Home_Clipboard_PasteOptions","Paste","textandimage",n+"_Ribbon_Paste",{dataSource:this._pasteMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,45,this._mediumBtnHeight,"bottom","","dropdown","e-ssr-pastesbtn","Paste","PasteSplitContent"," (Ctrl+V)")]},{groups:[this._generateBtn("Home_Clipboard_Cut","Cut","textandimage","e-icon e-ssr-cut",58,this._smallBtnHeight,"Cut","CutContent","","",""," (Ctrl+X)"),this._generateBtn("Home_Clipboard_Copy","Copy","textandimage","e-icon e-ssr-copy",67,this._smallBtnHeight,"Copy","CopyContent","","",""," (Ctrl+C)"),this._generateToggleBtn("Home_Clipboard_FormatPainter","FormatPainter","textandimage","e-icon e-ss-formatpainter","FPTitle",110,this._smallBtnHeight,"FPContent")]}]},l.groups.push(e),e={id:"Font",text:i._getLocStr("Font"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateDD("Home_Font_FontFamily","FontFamily",this._fontFamily,"7",150,this._smallBtnHeight,"FontFamily","FFContent"),this._generateDD("Home_Font_FontSize","FontSize",this._fontSize,"11pt",65,this._smallBtnHeight,"FontSize","FSContent"),this._generateBtn("Home_Font_IncreaseFontSize","IncreaseFontSize","imageonly","e-icon e-ss-increasefontsize","",this._smallBtnHeight,"IncreaseFontSize","IFSContent"),this._generateBtn("Home_Font_DecreaseFontSize","DecreaseFontSize","imageonly","e-icon e-ss-decreasefontsize","",this._smallBtnHeight,"DecreaseFontSize","DFSContent")]},{groups:[this._generateToggleBtn("Home_Font_Bold","Bold","imageonly","e-icon e-ss-bold","Bold","",this._smallBtnHeight,"BoldContent","","","","","",""," (Ctrl+B)"),this._generateToggleBtn("Home_Font_Italic","Italic","imageonly","e-icon e-ss-italic","Italic","",this._smallBtnHeight,"ItalicContent","","","","","",""," (Ctrl+I)"),this._generateToggleBtn("Home_Font_Underline","Underline","imageonly","e-icon e-ss-underline","Underline","",this._smallBtnHeight,"ULineContent","","","","","",""," (Ctrl+U)"),this._generateToggleBtn("Home_Font_StrikeThrough","Linethrough","imageonly","e-icon e-ss-linethrough","Linethrough",25,this._smallBtnHeight,"LineTrContent",!0,"","","","",""," (Ctrl+5)"),this._generateSplitBtn("Home_Font_Border","Border","imageonly",n+"_Ribbon_Border",{dataSource:this._borderMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-bottom",!0,37,this._smallBtnHeight,"","","","e-borderbtn","Border","BorderContent"),this._generateCustomControl(n+"_Ribbon_Home_Font_FillColor","BackgroundColor","BackgroundColor","BGContent"),this._generateCustomControl(n+"_Ribbon_Home_Font_FontColor","FontColor","Color","ColorContent")]}]},l.groups.push(e),e={id:"Alignment",text:i._getLocStr("AlignmentTab"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateToggleBtn("Home_Alignment_TopAlign","TopAlign","imageonly","e-icon e-ss-topalign","TopAlign","","","TopAlignContent"),this._generateToggleBtn("Home_Alignment_MiddleAlign","MiddleAlign","imageonly","e-icon e-ss-middlealign","MiddleAlign","","","MiddleAlignContent"),this._generateToggleBtn("Home_Alignment_BottomAlign","BottomAlign","imageonly","e-icon e-ss-bottomalign","BottomAlign","","","BottomAlignContent",!0),this._generateToggleBtn("Home_Alignment_WrapText","WrapText","textandimage","e-icon e-ss-wraptext","WrapText",85,25,"WrapTextContent")]},{groups:[this._generateToggleBtn("Home_Alignment_AlignLeft","AlignLeft","imageonly","e-icon e-ss-alignleft","AlignLeft","","","AlignLeftContent"),this._generateToggleBtn("Home_Alignment_AlignCenter","AlignCenter","imageonly","e-icon e-ss-aligncenter","AlignCenter","","","AlignCenterContent"),this._generateToggleBtn("Home_Alignment_AlignRight","AlignRight","imageonly","e-icon e-ss-alignright","AlignRight","","","AlignRightContent",!0),this._generateSplitBtn("Home_Alignment_Merge","MergeAndCenter","textandimage",n+"_Ribbon_Merge",{dataSource:this._mergeMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-merge",!1,136,25,"right","","","e-spreadsheet e-mergebtn","MergeAndCenter","MergeAndCenterContent")]},{groups:[this._generateBtn("Home_Alignment_DecreaseIndent","DecreaseIndent","imageonly","e-icon e-ss-decreaseindent","",this._smallBtnHeight,"DecreaseIndent","DecreaseIndentContent"),this._generateBtn("Home_Alignment_IncreaseIndent","IncreaseIndent","imageonly","e-icon e-ss-increaseindent","",this._smallBtnHeight,"IncreaseIndent","IncreaseIndentContent")]}]},l.groups.push(e),e={id:"Actions",text:i._getLocStr("Actions"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Home_Actions_Undo","Undo","textandimage","e-icon e-ss-undo",40,this._bigBtnHeight,"Undo","UndoContent",!1,r,""," (Ctrl+Z)"),this._generateBtn("Home_Actions_Redo","Redo","textandimage","e-icon e-ss-redo",40,this._bigBtnHeight,"Redo","RedoContent",!1,r,""," (Ctrl+Y)")]}]},l.groups.push(e),e={id:"Number",text:i._getLocStr("NumberTab"),alignType:t.Ribbon.alignType.rows,enableGroupExpander:!0,content:[{groups:[this._generateDD("Home_Number_NumberFormat","NumberFormat",this._numberFormat,"General",125,this._smallBtnHeight,"NumberFormat","NumberFormatContent")]},{groups:[this._generateBtn("Home_Number_Accounting","AccountingStyle","imageonly","e-icon e-ss-accounting","",this._smallBtnHeight,"AccountingStyle","AccountingStyleContent"),this._generateBtn("Home_Number_Percentage","PercentageStyle","imageonly","e-icon e-ss-percentage","",this._smallBtnHeight,"PercentageStyle","PercentageStyleContent"),this._generateBtn("Home_Number_CommaStyle","CommaStyle","imageonly","e-icon e-ss-comma","",this._smallBtnHeight,"CommaStyle","CommaStyleContent",!0),this._generateBtn("Home_Number_IncreaseDecimal","IncreaseDecimal","imageonly","e-icon e-ss-increasedecimal","",this._smallBtnHeight,"IncreaseDecimal","IncreaseDecimalContent"),this._generateBtn("Home_Number_DecreaseDecimal","DecreaseDecimal","imageonly","e-icon e-ss-decreasedecimal","",this._smallBtnHeight,"DecreaseDecimal","DecreaseDecimalContent")]}]},l.groups.push(e),e={id:"Styles",text:i._getLocStr("Styles"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateSplitBtn("Home_Styles_ConditionalFormatting","ConditionalFormat","textandimage",n+"_CFormat",{dataSource:this._cFormatMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-condformat",!1,75,this._splitBtnHeight,"bottom",r,"dropdown","e-spreadsheet e-cformatbtn","ConditionalFormat","CFContent"),this._generateSplitBtn("Home_Styles_FormatAsTable","FormatasTable","textandimage",n+"_formatastable","","e-icon e-ssr-formatastable",!1,65,this._splitBtnHeight,"bottom",t.ImagePosition.ImageTop,"dropdown","e-spreadsheet e-formatastablebtn","FormatAsTable","FATContent"),this._generateSplitBtn("Home_Styles_CellStyles","CellStyles","textandimage",n+"_cellstyles","","e-icon e-ssr-cellstyles",!1,55,this._splitBtnHeight,"bottom",t.ImagePosition.ImageTop,"dropdown","e-spreadsheet e-cellstylebtn","CellStyles","CellStylesContent")]}]},l.groups.push(e),e={id:"Editing",text:i._getLocStr("Editing"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Home_Editing_SortFilter","SortFilter","textandimage",n+"_Ribbon_SortFilter",{dataSource:this._sortFltrMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-sortfilter",!1,50,this._splitBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-sortfltrbtn","SortFilter","SortFilterContent")]},{groups:[this._generateSplitBtn("Home_Editing_AutoSum","AutoSum","textandimage",n+"_Ribbon_AutoSum",{dataSource:this._autosumMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-autosum",!1,100,25,"right","","","e-spreadsheet e-autosumbtn","AutoSumTitle","AutoSumContent"),this._generateSplitBtn("Home_Editing_Clear","Clear","textandimage",n+"_Ribbon_Clear",{dataSource:this._clearMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-clear",!1,80,25,"right","","dropdown","e-spreadsheet e-clearbtn","Clear","ClearContent")]}]},l.groups.push(e),this._tabCollection.push(l)},_insertTabObj:function(){var e,i=this.XLObj,r="imagetop",l={id:"insert",text:i._getLocStr("INSERT"),groups:[]},n=i._id;e={id:"Tables",text:i._getLocStr("Tables"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Insert_Tables_PivotTable","PivotTable","textandimage","e-icon e-ssr-pivottable",65,this._bigBtnHeight,"PivotTable","PivotTableContent",!1,r),this._generateBtn("Insert_Tables_Table","Table","textandimage","e-icon e-ssr-table",50,this._bigBtnHeight,"Table","TableContent",!1,r)]}]},l.groups.push(e),e={id:"Illustrations",text:i._getLocStr("Illustrations"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Insert_Illustrations_Pictures","Pictures","textandimage","e-icon e-ssr-pictures",50,this._bigBtnHeight,"PicturesTitle","PicturesContent",!1,r,"")]}]},l.groups.push(e),e={id:"Links",text:i._getLocStr("Links"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Insert_Links_Hyperlink","HyperLink","textandimage","e-icon e-ssr-hyperlink",60,this._bigBtnHeight,"HyperLinkTitle",["HyperLinkContent","HyperLinkPlaceContent"],!1,r,""," (Ctrl+K)")]}]},l.groups.push(e),e={id:"Charts",text:i._getLocStr("Charts"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateSplitBtn("Insert_Charts_ColumnChart","ColumnChart","imageonly",n+"_Ribbon_ColumnChart","","e-icon e-ss-colchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","ColumnChartTitle","ColumnChartContent"),this._generateSplitBtn("Insert_Charts_BarChart","BarChart","imageonly",n+"_Ribbon_BarChart","","e-icon e-ss-barchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","BarChartTitle","BarChartContent"),this._generateSplitBtn("Insert_Charts_StockChart","StockChart","imageonly",n+"_Ribbon_StockChart","","e-icon e-ss-stockchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","StockChartTitle","StockChartContent")]},{groups:[this._generateSplitBtn("Insert_Charts_LineChart","LineChart","imageonly",n+"_Ribbon_LineChart","","e-icon e-ss-linechart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","LineChartTitle","LineChartContent"),this._generateSplitBtn("Insert_Charts_AreaChart","AreaChart","imageonly",n+"_Ribbon_AreaChart","","e-icon e-ss-areachart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","AreaChartTitle","AreaChartContent"),this._generateSplitBtn("Insert_Charts_PieChart","PieChart","imageonly",n+"_Ribbon_PieChart","","e-icon e-ss-piechart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","PieChartTitle","PieChartContent")]},{groups:[this._generateSplitBtn("Insert_Charts_ScatterChart","ScatterChart","imageonly",n+"_Ribbon_ScatterChart","","e-icon e-ss-scterchart",!1,41,this._smallBtnHeight,"bottom","ej.ImagePosition.ImageTop","dropdown","e-spreadsheet e-chartbtn","ScatterChartTitle","ScatterChartContent")]}]},l.groups.push(e),i.model.allowSparkline&&l.groups.push(i.XLSparkline._tabInsert()),this._tabCollection.push(l)},_dataTabObj:function(){var e,i=this.XLObj,r={id:"data",text:i._getLocStr("DATATAB"),groups:[]};e={id:"SortFilter",text:i._getLocStr("SortFilter"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Data_SortFilter_SortAtoZ","SortAtoZ","textandimage","e-icon e-ssr-sortatoz",90,this._smallBtnHeight,"SortAtoZ","SortAtoZContent",!1,"","e-datapadding"),this._generateBtn("Data_SortFilter_SortZtoA","SortZtoA","textandimage","e-icon e-ssr-sortztoa",90,this._smallBtnHeight,"SortZtoA","SortZtoAContent",!1,"","e-datapadding")]},{groups:[this._generateBtn("Data_SortFilter_Filter","Filter","textandimage","e-icon e-ssr-filter",60,this._smallBtnHeight,"Filter","FilterContent",!1,"","e-datapadding"),this._generateBtn("Data_SortFilter_ClearFilter","ClearFilter","textandimage","e-icon e-ss-clearfilter",90,this._smallBtnHeight,"ClearFilter","ClearFilterContent",!1,"","e-datapadding")]}]},r.groups.push(e),e={id:"DataTools",text:i._getLocStr("DataTools"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Data_DataTools_DataValidation","Validation","imageonly","e-icon e-ssr-validation",70,39,"DataValidation","DVContent",!1,"imagetop"),this._generateSplitBtn("Data_DataTools_DataValidationOptions","DataValidation","textandimage",i._id+"_Ribbon_Validation",{dataSource:this._valMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,70,this._mediumBtnHeight,"bottom","","dropdown","e-ssr-validationsbtn","DataValidation","DVContent")]}]},r.groups.push(e),this._tabCollection.push(r)},_pageTabObj:function(){var e,i=this.XLObj,r="imagetop",l={id:"pagelayout",text:i._getLocStr("PAGELAYOUT"),groups:[]};e={id:"Show",text:i._getLocStr("Show"),alignType:t.Ribbon.alignType.rows,width:105,content:[{groups:[{contentID:i._id+"_Ribbon_pagesetupleft",type:t.Ribbon.type.custom,height:80}]}]},l.groups.push(e),e={id:"PageLayout",text:i._getLocStr("PageLayout"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("PageLayout_PageLayout_PageSize","size","imageonly","e-icon e-ssr-pagesize",65,44,"size","PageSizeContent",!1,r,""),this._generateSplitBtn("PageLayout_PageLayout_PageSizeOptions","PageSize","textandimage",i._id+"_Ribbon_PageSize",{dataSource:this._pageSizes,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,65,this._mediumBtnHeight,"bottom","","dropdown","e-ssr-pagesizesbtn","PageSize","PageSizeContent")]}]},l.groups.push(e),e={id:"Print",text:i._getLocStr("Print"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("PageLayout_Print_Print","Print","textandimage","e-icon e-ssr-print",50,this._bigBtnHeight,"Print","PrintContent",!1,r,"")]},{groups:[this._generateBtn("PageLayout_Print_PrintSelected","PrintSelected","textandimage","e-icon e-ssr-printselected",55,this._bigBtnHeight,"PrintSelected","PrintSelectedContent",!0,r,"")]}]},l.groups.push(e),this._tabCollection.push(l)},_reviewTabObj:function(){var e,i=this.XLObj,r="imagetop",l={id:"review",text:i._getLocStr("REVIEW"),groups:[]};e={id:"Comments",text:i._getLocStr("Comments"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Review_Comments_NewComment","New","textandimage","e-icon e-ssr-newcmnt",49,this._bigBtnHeight,"NewCommentTitle","NewCommentContent",!1,r)]},{groups:[this._generateBtn("Review_Comments_DeleteComment","Delete","textandimage","e-icon e-ssr-deletecmnt",49,this._bigBtnHeight,"DeleteComment","DeleteCommentContent",!1,r)]},{groups:[this._generateBtn("Review_Comments_PreviousComment","Previous","textandimage","e-icon e-ssr-previouscmnt",49,this._bigBtnHeight,"Previous","PreviousContent",!1,r)]},{groups:[this._generateBtn("Review_Comments_NextComment","Next","textandimage","e-icon e-ssr-nextcmnt",49,this._bigBtnHeight,"Next","NextContent",!1,r)]},{groups:[this._generateBtn("Review_Comments_ShowHideComment","ShowHide","textandimage","e-icon e-ssr-showhidecmnt",160,this._smallBtnHeight,"ShowHide","ShowHideContent",!1,"imageLeft","e-ssr-cmntcolbtn"),this._generateToggleBtn("Review_Comments_ShowAllComments","ShowAll","textandimage","e-icon e-ssr-showallcmnt","ShowAll",155,this._smallBtnHeight,"ShowAllContent",!1,"e-ssr-cmntcolbtn")]}]},l.groups.push(e),e={id:"Changes",text:i._getLocStr("Changes"),alignType:t.Ribbon.alignType.row,content:[{groups:[this._generateToggleBtn("Review_Changes_ProtectSheet","Protectsheet","textandimage","e-icon e-ssr-protectsheet","Protectsheet",60,this._bigBtnHeight,"ProtectSheetToolTip",!1,"e-ssr-protectsheetbtn","imagetop","Unprotect"),this._generateToggleBtn("Review_Changes_ProtectWorkbook","ProtectWorkbook","textandimage","e-icon e-ssr-protect","ProtectWorkbook",60,this._bigBtnHeight,"ProtectWBContent",!1,"e-ssr-cmntcolbtn","imagetop"),this._generateToggleBtn("Review_Changes_LockCell","Lock","textandimage","e-icon e-ssr-protlockcell","lock",90,this._smallBtnHeight,"Lock",!1,"e-ssr-lockbtn","","Unlock","e-icon e-ssr-protunlockcell")]}]},l.groups.push(e),this._tabCollection.push(l)},_otherTabObj:function(){var e,i=this.XLObj,r="imagetop",l={id:"others",text:i._getLocStr("OTHERS"),groups:[]},n=i._id,s=t.ContentType;e={id:"Window",text:i._getLocStr("Window"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Others_Window_FreezePanes","FreezePanes","textandimage",i._id+"_Ribbon_FPane",{dataSource:this._viewMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-frzpane",!1,55,this._splitBtnHeight,"bottom",r,"dropdown","e-spreadsheet e-fpanebtn","FreezePanes","FreezePanesContent")]}]},l.groups.push(e),e={id:"Formulas",text:i._getLocStr("Formula"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Others_Formulas_NameManager","NameManager",s.TextAndImage,"e-icon e-ssr-namemngr",55,this._bigBtnHeight,"NameManager",["NameManagerContent","NameManagerFormulaContent"],!1,r,"")]},{groups:[this._generateBtn("Others_Formulas_DefineName","DefineName",s.TextAndImage,"e-icon e-ssr-definename",110,25,"DefineName","DefineNameContent"),this._generateSplitBtn("Others_Formulas_UseInFormula","UseInFormula","textandimage",i._id+"_nmuseinformula","","e-icon e-ssr-useformula",!1,125,25,t.ArrowPosition.Bottom,t.ImagePosition.ImageLeft,"dropdown","e-spreadsheet e-useinformulabtn","UseInFormula","UseInFormulaContent")]}]},l.groups.push(e),e={id:"Cells",text:i._getLocStr("Cells"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Others_Cells_InsertCell","Insert","imageonly","e-icon e-ssr-insert",54,40,"InsertTitle",["InsertContent","MultipleInsertContent"],!1,r),this._generateSplitBtn("Others_Cells_InsertCellOptions","Insert","textandimage",n+"_Ribbon_Ins",{dataSource:this._insertMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,54,this._mediumBtnHeight,"bottom","","dropdown","e-insertsbtn","InsertTitle","InsertSBContent")]},{groups:[this._generateBtn("Others_Cells_DeleteCell","Delete","imageonly","e-icon e-ssr-delete",54,40,"DeleteTitle",["DeleteContent","MultipleDeleteContent"],!1,r),this._generateSplitBtn("Others_Cells_DeleteCellOptions","Delete","textandimage",n+"_Ribbon_Del",{dataSource:this._deleteMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"",!1,54,this._mediumBtnHeight,"bottom","","dropdown","e-deletesbtn","DeleteTitle",["DeleteContent","MultipleDeleteContent"])]}]},l.groups.push(e),e={id:"Editing",text:i._getLocStr("Editing"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateSplitBtn("Others_Editing_FindSelect","FindSelect","textandimage",n+"_Ribbon_FindRep",{dataSource:this._findMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-findselect",!1,55,this._splitBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-findbtn","FindSelectTitle","FindSelectContent")]}]},l.groups.push(e),e={id:"Calculation",text:i._getLocStr("Calculation"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Others_CalCulation_CalculationOptions","CalculationOptions","textandimage",n+"_Ribbon_CalcOpt",{dataSource:this._calcOptData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ss-calcopt",!1,67,this._splitBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-coptbtn","CalcOptTitle",["CalcOptContent","CalcOptRecalcContent"])]},{groups:[this._generateBtn("Others_CalCulation_CalculateNow","CalculateNow",s.TextAndImage,"e-icon e-ss-calcnow",110,30,"CalculateNow",["CalculateNowContent","CalculateNowTurnOffContent"]),this._generateBtn("Others_CalCulation_CalculateSheet","CalculateSheet",s.TextAndImage,"e-icon e-ss-calcsheet",110,30,"CalculateSheet",["CalculateSheetContent","CalculateSheetTurnOffContent"])]}]},l.groups.push(e),this._tabCollection.push(l)},_renderRibbon:function(i){var r,l,n,s=this.XLObj,o=s._id,a=s.element,d=s.model,h=t.buildTag("div","","",{id:o+"_Ribbon"}),c=[s._getLocStr("HOME"),s._getLocStr("INSERT"),s._getLocStr("DATATAB"),s._getLocStr("PAGELAYOUT"),s._getLocStr("REVIEW"),s._getLocStr("OTHERS")];if(i?a.prepend(h):a.append(h),a.append(t.buildTag("ul","",{display:"none"},{id:o+"_Menu"})),r=t.SplitButton.prototype._documentClick,t.SplitButton.prototype._documentClick=function(t){e(t.target).is(".e-formatastable")||e(t.target).is(".e-formatastable-adaptive")||e(t.target).is(".e-cellstyles")||e(t.target).is(".e-cellstyles-adaptive")||r.call(this,t)},n=[s._getLocStr("HOME"),s._getLocStr("INSERT"),s._getLocStr("PAGELAYOUT"),s._getLocStr("DATATAB"),s._getLocStr("OTHERS"),s._getLocStr("FORMAT"),s._getLocStr("DESIGN"),s._getLocStr("CHARTDESIGN"),s._getLocStr("ANALYZE"),s._getLocStr("SPARKLINEDESIGN")],s.model.ribbonSettings.enableOnDemand&&!s._isRibbonDestroyed)this._createTrgtElement(s._getLocStr("HOME"));else for(l=0;l<n.length;l++)this._createTrgtElement(n[l],h);if(s._isRefresh||(this._menuCustomize(),this._homeTabObj(),this._insertTabObj(),this._dataTabObj(),this._pageTabObj(),this._reviewTabObj(),this._otherTabObj(),this._contextualTabObj()),h.attr("style","overflow:hidden"),h.height(0),h.width(0),h.ejRibbon({width:"100%",allowResizing:!0,applicationTab:this._appTabCollection,tabs:this._tabCollection,contextualTabs:this._contextualTabCollection,tabClick:e.proxy(this._onTabClick,this),tabSelect:e.proxy(this._onTabSelect,this),create:e.proxy(this._onControlCreated,this),collapse:e.proxy(this._onCollapse,this),backstageItemClick:e.proxy(this._onBackStageItemClick,this),groupExpand:e.proxy(this._onGroupExpander,this),pinState:e.proxy(this._onRibbonPin,this),expand:e.proxy(this._onRibbonExpand,this),groupClick:e.proxy(this._onRibbonGroupClick,this),_destroyed:e.proxy(this._rbnDestroy,this),enableOnDemand:s.model.ribbonSettings.enableOnDemand,beforeTabClick:e.proxy(this._onBeforeTabClick,this)}),h.css("height","auto"),h.width("100%"),d.scrollSettings.isResponsive&&(h.ejRibbon("option",{allowResizing:!0}),(s._phoneMode||s._tabMode)&&"landscape"===s._orientation&&h.ejRibbon("collapse")),s.model.ribbonSettings.enableOnDemand&&!s._isRibbonDestroyed)this._homeTabControls(),this._updateRibCustomCss(s._getLocStr("HOME")),this._isHomeTabCreate=!0,this._hideRibbonElem(s._getLocStr("HOME"));else for(this._isHomeTabCreate=!0,this._isInsertTabCreate=!0,this._isDataTabCreate=!0,this._isPageLayoutTabCreate=!0,this._isReviewTabCreate=!0,this._isOthersTabCreate=!0,this._isDesignTabCreate=!0,this._isFormatTabCreate=!0,this._isChartTabCreate=!0,this._analyzeTabCreate=!0,this._isAppTabCreate=!0,this._isSparklineTabCreate=!0,e("#"+o+"_Ribbon_review_Comments_5").css("vertical-align","middle"),l=0;l<6;l++)1!==l&&4!==l&&this._updateRibCustomCss(c[l]),this._hideRibbonElem(c[l]);this._hideOtherControls()},_createTabControls:function(t){var i=this.XLObj;switch(t){case i._getLocStr("HOME"):this._isHomeTabCreate||(this._homeTabControls(),this._isHomeTabCreate=!0,i._on(e("#"+i._id+"_cellstyles"),"click",i._cellStyleClick),i._on(e("#"+i._id+"_formatastable"),"click",i._formatAsTableClick),this._updateRibCustomCss(t),this._hideRibbonElem(t));break;case i._getLocStr("INSERT"):this._isInsertTabCreate||(this._isInsertTabCreate=!0,i._on(e(".e-"+i._id+".e-chartcell"),"click",i._chartClickHandler),this._hideRibbonElem(t));break;case i._getLocStr("DATATAB"):this._isDataTabCreate||(this._isDataTabCreate=!0,this._updateRibCustomCss(t),this._hideRibbonElem(t));break;case i._getLocStr("PAGELAYOUT"):this._isPageLayoutTabCreate||(this._pageTabControls(),this._isPageLayoutTabCreate=!0,this._updateRibCustomCss(t),this._hideRibbonElem(t));break;case i._getLocStr("REVIEW"):this._isReviewTabCreate||(e("#"+i._id+"_Ribbon_review_Comments_5").css("vertical-align","middle"),this._isReviewTabCreate=!0,this._hideRibbonElem(t));break;case i._getLocStr("OTHERS"):this._isOthersTabCreate||(this._othersTabControls(),this._isOthersTabCreate=!0,this._updateRibCustomCss(t),i._on(e("#"+i._id+"_nmuseinformula"),"click",".e-nmuseinformularow",i._useInFormulaClick),this._hideRibbonElem(t));break;case i._getLocStr("FORMAT"):this._isFormatTabCreate||(this._isFormatTabCreate=!0);break;case i._getLocStr("DESIGN"):this._isDesignTabCreate||(this._isDesignTabCreate=!0);break;case i._getLocStr("CHARTDESIGN"):this._isChartTabCreate||(this._isChartTabCreate=!0);break;case i._getLocStr("ANALYZE"):this._analyzeTabCreate||(this._isFormatTabCreate=!0);break;case i._getLocStr("SPARKLINEDESIGN"):this._isSparklineTabCreate||(this._isSparklineTabCreate=!0)}},_createTrgtElement:function(t,i){var r=this.XLObj;switch(i=i||e("#"+r._id+"_Ribbon"),t){case r._getLocStr("HOME"):this._isHomeTabTrgt||this._homeTabTrgtElem(),this._isHomeTabTrgt=!0;break;case r._getLocStr("INSERT"):this._isInsertTabTrgt||this._onTabCreate(),this._isInsertTabTrgt=!0;break;case r._getLocStr("DATATAB"):this._isDataTabTrgt||this._dataTabTrgtElem(),this._isDataTabTrgt=!0;break;case r._getLocStr("PAGELAYOUT"):this._isPageLayoutTabTrgt||this._pageTabTrgtElem(i),this._isPageLayoutTabTrgt=!0;break;case r._getLocStr("OTHERS"):this._isOthersTabTrgt||this._othersTabTrgtElem(),this._isOthersTabTrgt=!0;break;case r._getLocStr("CHARTDESIGN"):this._isChartTabTrgt||this._renderChartDesignTab(),this._isChartTabTrgt=!0;break;case r._getLocStr("ANALYZE"):this._analyzeTabTrgt||this._renderAnalyzeTab(),this._analyzeTabTrgt=!0;break;case r._getLocStr("FORMAT"):this._isFormatTabTrgt||this._renderFormatTab(),this._isFormatTabTrgt=!0;break;case r._getLocStr("DESIGN"):this._isDesignTabTrgt||this._renderDesignTab(),this._isDesignTabTrgt=!0;break;case r._getLocStr("SPARKLINEDESIGN"):r.model.allowSparkline&&(this._isSparklineTrgt||r.XLSparkline._renderSparklineTab()),this._isSparklineTrgt=!0}},_onTabCreate:function(){var t=this.XLObj,i=t.element,r=e("#"+t._id+"_Ribbon");i.append(this._chartType("ColumnChart",6,2,2,["column","stackingcolumn","stackingcolumn100","column","stackingcolumn","stackingcolumn100"],[t._getLocStr("ClusteredColumn"),t._getLocStr("StackedColumn"),"100%&nbsp;"+t._getLocStr("StackedColumn"),"3-D&nbsp;"+t._getLocStr("ClusteredColumn"),"3-D&nbsp;"+t._getLocStr("StackedColumn"),"3-D&nbsp;100%&nbsp;"+t._getLocStr("StackedColumn")])),i.append(this._chartType("BarChart",6,2,2,["bar","stackingbar","stackingbar100","bar","stackingbar","stackingbar100"],[t._getLocStr("ClusteredBar"),t._getLocStr("StackedBar"),"100%&nbsp;"+t._getLocStr("StackedBar"),"3-D&nbsp;"+t._getLocStr("ClusteredBar"),"3-D&nbsp;"+t._getLocStr("StackedBar"),"3-D&nbsp;100%&nbsp;"+t._getLocStr("StackedBar")])),i.append(this._chartType("StockChart",2,2,2,["radar","radar"],[t._getLocStr("Radar"),t._getLocStr("RadarMarkers")])),i.append(this._chartType("LineChart",2,2,3,["line","line"],[t._getLocStr("Line"),t._getLocStr("LineMarkers")])),i.append(this._chartType("AreaChart",3,3,3,["Area","stackingarea","stackingarea100"],[t._getLocStr("Area"),t._getLocStr("StackedArea"),"100%&nbsp;"+t._getLocStr("StackedArea")])),i.append(this._chartType("PieChart",3,3,4,["pie","pie","doughnut"],[t._getLocStr("Pie"),"3-D&nbsp;"+t._getLocStr("Pie"),t._getLocStr("Doughnut")])),i.append(this._chartType("ScatterChart",1,2,2,["scatter"],[t._getLocStr("Scatter")])),r.append("<div id='"+t._id+"_nmuseinformula' class='e-nmuseinformula' style='width:125px'></div>")},_rbnDestroy:function(i){var r=this.XLObj,l=r._id,n="#"+l+"_Ribbon_Home_Font_FillColor",s="#"+l+"_Ribbon_Home_Font_FontColor",o="#"+l+"_Ribbon_PictureColor",a="#"+l+"_Ribbon_SparklineColor",d="#"+l+"_Ribbon_MarkerNegativePoint",h="#"+l+"_Ribbon_MarkerHighPoint",c="#"+l+"_Ribbon_MarkerLowPoint",u="#"+l+"_Ribbon_Home_Font_BorderColor",g="#"+l+"_Ribbon_BorderCP",p=e("#"+l+"_Ribbon").ejRibbon("instance"),m=p.getTabText(p.model.selectedItemIndex),_=r.model.ribbonSettings.enableOnDemand;if(e(n).data("ejColorPicker")&&e(n).ejColorPicker("destroy"),e(s).data("ejColorPicker")&&e(s).ejColorPicker("destroy"),e(o).data("ejColorPicker")&&e(o).ejColorPicker("destroy"),e(u).data("ejColorPicker")&&e(u).ejColorPicker("destroy"),e(a).data("ejColorPicker")&&e(a).ejColorPicker("destroy"),e(d).data("ejColorPicker")&&e(d).ejColorPicker("destroy"),e(h).data("ejColorPicker")&&e(h).ejColorPicker("destroy"),e(c).data("ejColorPicker")&&e(c).ejColorPicker("destroy"),e("#"+l+"_Ribbon_Home_Font_BorderColor_Presets").parent().remove(),e(g).data("ejColorPicker")&&e(g).ejColorPicker("destroy"),i&&!i.destroy){if(r._off(e("#"+l+"_cellstyles"),"click",r._cellStyleClick),r._off(e("#"+l+"_formatastable"),"click",r._formatAsTableClick),e(u)[0].style.display="none",r._off(e(".e-"+l+".e-chartcell"),"click",r._chartClickHandler),!_||this._isHomeTabTrgt&&m===r._getLocStr("HOME")){var f=r.element,b=l+"_Ribbon_"+"Home_Font_";f.append(t.buildTag("input","",{display:"none"},{id:b+"FillColor",type:"text"})),f.append(t.buildTag("input","",{display:"none"},{id:b+"FontColor",type:"text"})),f.append(t.buildTag("input","",{display:"none"},{id:b+"BorderColor",type:"text"})),f.append(t.buildTag("div.e-spreadsheet e-formatastable","",{display:"none"},{id:r._id+"_formatastable"})),r.element.append(this._renderCellStyles())}else this._isHomeTabTrgt=!1;!_||this._isInsertTabTrgt&&m===r._getLocStr("INSERT")?this._onTabCreate():this._isInsertTabTrgt=!1,this._isHomeTabCreate=this._isInsertTabCreate=this._isDataTabCreate=this._isPageLayoutTabCreate=this._isReviewTabCreate=!1,this._isOthersTabCreate=this._isDesignTabCreate=this._isFormatTabCreate=this._isChartTabCreate=this._isSparklineTabCreate=this._analyzeTabCreate=this._isAppTabCreate=!1,r._isRibbonDestroyed=!0}else e(document.body).append(e("#"+l+" _formatastable").parent()),e(document.body).append(e("#"+l+" _cellstyles").parent())},_updateRibCustomCss:function(e){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_=this.XLObj,f=_._id,b=0,C="Options";switch(e){case _._getLocStr("HOME"):var S="e-ssr-colpickHprt",x="_Ribbon_Home_Font",v="_Ribbon_home_Font_Home_Font_",w="_Ribbon_home_Clipboard_Home_Clipboard_Paste",I=["e-mergebtn","e-borderbtn","e-autosumbtn"],y=[f+v+"FontFamily",f+v+"FontSize"],T=["e-ssr-fontfamily","e-ssr-fontsize"];for(c=[f+w+C],h=[f+w],d=[f+"_Ribbon_home_Clipboard_1"],u=[" e-ssr-pastebtnHprt"],_.addClass(document.getElementById(f+x+"_FillColorWrapper").children[0],S),_.addClass(document.getElementById(f+x+"_FontColorWrapper").children[0],S),l=_.element[0].querySelectorAll(".e-ssr-colpickHprt .e-color-container,.e-ssr-colpickHprt .e-select");b<4;)_.addClass(l[b],"e-ssr-colorcontainer"),b++;for(b=0;b<3;)_.addClass(document.querySelectorAll("."+I[b])[0].parentNode,"e-ssr-horizontalprt"),b++;for(b=0;b<2;)_.addClass(document.getElementById(y[b]),T[b]),b++;break;case _._getLocStr("DATATAB"):c=[f+(g="_Ribbon_data_DataTools_Data_DataTools_DataValidation")+C],h=[f+g],d=[f+"_Ribbon_data_DataTools_1"],u=[" e-ssr-dtvaldtnHprt"];break;case _._getLocStr("PAGELAYOUT"):for(y=["ej"+f+(m="_Ribbon_PageLayout_Show_")+"Headings","ej"+f+m+"Gridlines"],T=["e-vheading","e-vgridlines"],c=[f+(p="_Ribbon_pagelayout_PageLayout_PageLayout_PageLayout_PageSize")+C],h=[f+p],d=[f+"_Ribbon_pagelayout_PageLayout_1"],u=[" e-ssr-pagesizebtnHprt"," e-ssr-sizebtnHprt"],b=0;b<2;)_.addClass(document.getElementById(y[b]),T[b]),b++;break;case _._getLocStr("OTHERS"):var L="InsertCell",R="_Ribbon_others_Cells_Others_Cells_",O="DeleteCell";c=[f+R+L+C,f+R+O+C],h=[f+R+L,f+R+O],d=[f+"_Ribbon_others_Cells_1",f+"_Ribbon_others_Cells_2"],u=[" e-ssr-insertbtnHprt"," e-ssr-deletebtnHprt"]}for(b=0,a=d.length;b<a;)o=document.getElementById(d[b]),r=document.getElementById(h[b]),t=document.getElementById(h[b]),i=document.getElementById(c[b]),(n=document.createElement("span")).className="e-ssr-verticalHparent"+u[b],n.style.display="inherit",o.insertBefore(n,r),n.appendChild(t),n.appendChild(i)," e-ssr-pagesizebtnHprt"===u[0]&&((s=document.createElement("span")).className="e-ssr-verticalHparent"+u[b+1],s.style.display="inherit",s.appendChild(n),o.appendChild(s)),b++},_hideOtherControls:function(){for(var t=0,i=["CElement","SElement","Paste","Border","Merge","SortFilter","Clear","ColumnChart","BarChart","Validation","PageSize","FPane","Ins","Del","FindRep","PastePic","PictureBorder","AutoSum","ResetPic","PictureBorder","StockChart","LineChart","AreaChart","PieChart","ScatterChart","color_Presets","PictureColor_Presets","Home_Font_BorderColor_Presets"];t--;)e("#"+this._id+"_Ribbon_"+i[t]).hide();for(t=0,i=["CFormat","formatastable","cellstyles","ctxtmenu"];t--;)e("#"+this._id+"_"+i[t]).hide()},_renderAppTab:function(){var e,i=this.XLObj,r=[];e=(e=(e="<div  id='"+i._id+"_backstagetabnew' style='display:none' class='e-ssr-bstabnew'><div class='e-ssr-bscontent' title='"+i._getLocStr("BlankWorkbook")+"'><div class='e-ssr-bsnewtmpl' ><button id='"+i._id+"_bstab_new_blank' type='button' class = 'e-rbn-button' ></button></div></div></div>").concat("<div id='"+i._id+"_backstagetabsaveas' style='display:none' class='e-ssr-bstabsaveas'><div class='e-ssr-bscontent'><div class='e-ssr-bssaveasopt'><button id='"+i._id+"_bstab_saveas_excel' type='button' class = 'e-rbn-button'></button><span>"+i._getLocStr("SaveAsExcel")+"</span></div><div class='e-ssr-bssaveasopt'><button id='"+i._id+"_bstab_saveas_csv' type='button' class = 'e-rbn-button'></button><span>"+i._getLocStr("SaveAsCsv")+"</span></div><div class='e-ssr-bssaveasopt'><button id='"+i._id+"_bstab_saveas_pdf' type='button' class = 'e-rbn-button'></button><span>"+i._getLocStr("SaveAsPdf")+"</span></div></div></div>")).concat("<div id='"+i._id+"_backstagetabprint' style='display:none' class='e-ssr-bstabprint'><div class='e-ssr-bscontent'><div class='e-ssr-bsprintopt'><button id='"+i._id+"_bstab_print_sheet' type='button' class = 'e-rbn-button'></button><span>"+i._getLocStr("PrintSheet")+"</span></div><div class='e-ssr-bsprintopt'><button id='"+i._id+"_bstab_print_selected' type='button' class = 'e-rbn-button'></button><span>"+i._getLocStr("PrintSelected")+"</span></div></div></div>"),i.element.append(e),r.push({id:"new",text:i._getLocStr("New"),itemType:t.Ribbon.itemType.tab,contentID:i._id+"_backstagetabnew"}),r.push({id:"open",text:i._getLocStr("Open")+"...",itemType:t.Ribbon.itemType.tab}),r.push({id:"saveas",text:i._getLocStr("SaveAs"),itemType:t.Ribbon.itemType.tab,contentID:i._id+"_backstagetabsaveas"}),r.push({id:"print",text:i._getLocStr("Print"),itemType:t.Ribbon.itemType.tab,contentID:i._id+"_backstagetabprint"}),this._appTabCollection={type:t.Ribbon.applicationTabType.backstage,backstageSettings:{text:i._getLocStr("File"),headerWidth:124,height:i._responsiveHeight-2,width:i._responsiveWidth-3,pages:r}}},_onBackStageItemClick:function(t){var i,r,l,n,s;if(this._isAppTabCreate||(this._appTabControls(),this._isAppTabCreate=!0),n=(i=this.XLObj).model.ribbonSettings.applicationTab,i.XLEdit._isEdit&&i.XLEdit.saveCell(),i.XLComment&&i.XLComment._isCommentEdit&&i.XLComment._updateCurCmntVal(),!i._isSheetRename||i._updateSheetNames(null,!1)){if("menu"===n.type){if(r={element:t.element},i._trigger("menuClick",r))return!1;"Open"===t.ID?(i.XLEdit._isEdit&&i.XLEdit.saveCell(),this._bSBtnClickHandler(t.ID.toLowerCase(),t)):this._bSBtnClickHandler(t.ID.toLowerCase(),t)}if("backstage"===n.type)if("backstageItemClick"===t.type){if(l={id:t.id,text:t.text,type:t.type,target:t.target,prop:t.model},i._trigger("menuClick",l))return!1;"open_backStageTab"===t.id&&(i.XLEdit._isEdit&&i.XLEdit.saveCell(),this._bSBtnClickHandler("open",t))}else{if(l={e:t.e,type:t.type,status:t.status,target:t.target,id:t.target.id},i._trigger("menuClick",l))return!1;e("#"+i._id+"_Ribbon").ejRibbon("hideBackstage"),i._phoneMode&&e("#"+i._id+"_Ribbon").ejRibbon("goToMainContent"),s=t.model.prefixIcon,this._bSBtnClickHandler(s.indexOf("blank")>-1?s.split("-")[2]:s.split("-")[3],t)}}else i.element.find("#"+i._id+"_Ribbon").ejRibbon("hideBackstage")},_bSBtnClickHandler:function(t,i){var r,l=this.XLObj,n=l.getActiveSheetIndex(),s={id:i.id||i.ID||i.target.id,status:i.status,prop:i.model,model:l.model};if(l._trigger("ribbonClick",s))return!1;switch(e("#"+l._id+"_Ribbon").ejRibbon("hideBackstage"),t){case"open":if(l.isDirty)l._showAlertDlg("confirm","ImportAlert","Open",470);else{if(l.model.importSettings.importMapper.length<1)return void l._showAlertDlg("Alert","ImportExportUrl");e("#"+l._id+"_file .e-uploadinput").click(),"msie"!=l._browserDetails.name&&"edge"!=l._browserDetails.name&&e("#"+l._id+"_Ribbon_BackStage").show(),e("#"+l._id+"_Ribbon").find(".e-backstagetitlecontent").text("").append("Open")}break;case"new":case"blank":l._isSheetsDirty()&&l._showAlertDlg("confirm","DestroyAlert","New",470);break;case"exportxl":case"exportcsv":case"exportpdf":l._showDialog(t),e("#"+l._id+"_ExportFileNameDialog").ejDialog("open"),r=t.split("export")[1],l.XLExport._exportType=r.indexOf("xl")>-1?"Excel":r.charAt(0).toUpperCase()+r.slice(1);break;case"print":case"printsheet":l.XLPrint.printSheet(n);break;case"printselected":l.XLPrint.printSelection(n)}},_contextualTabObj:function(){var e,i=this.XLObj,r=i._id,l="imagetop";e={backgroundColor:"#FCFBEB",borderColor:"#F2CC1C",tabs:[{id:"design",text:i._getLocStr("Design"),groups:[{id:"Properties",text:i._getLocStr("Properties"),alignType:t.Ribbon.alignType.rows,type:"custom",contentID:r+"_Ribbon_Design_Properties_TableProperties"},{id:"Tools",text:i._getLocStr("Tools"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Design_Tools_ResizeTable","ResizeTable","textandimage","e-icon e-ssr-resizetable",101,this._smallBtnHeight,"ResizeTable","ResizeTableContent"),this._generateBtn("Design_Tools_ConvertToRange","ConvertToRange","textandimage","e-icon e-ssr-range",130,this._smallBtnHeight,"ConvertToRange","ConvertToRangeContent")]}]},{id:"TableStyleOptions",text:i._getLocStr("TableStyleOption"),alignType:t.Ribbon.alignType.rows,type:"custom",contentID:r+"_Ribbon_Design_TableStyleOptions"}]}]},this._contextualTabCollection.push(e),e={backgroundColor:"#EAF6BD",borderColor:"#90AA3C",tabs:[{id:"chartdesign",text:i._getLocStr("CHARTDESIGN"),groups:[{id:"ChartLayouts",text:i._getLocStr("ChartLayouts"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("ChartDesign_ChartLayouts_AddChartElement","AddChartElement","textandimage",r+"_Ribbon_CElement","","e-icon e-ssr-celements",!0,65,this._bigBtnHeight,"bottom","imagetop","dropdown","e-spreadsheet e-chartlayoutbtn","AddChartElement","AddChartElementContent")]}]},{id:"Data",text:i._getLocStr("ChartDesignData"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("ChartDesign_Data_SwitchRowColumn","SwitchRowColumn","textandimage","e-icon e-ssr-srcolumn",72,this._bigBtnHeight,"SwitchRowColumn","SwitchRowColumnContent","","imagetop"),this._generateBtn("ChartDesign_Data_SelectData","SelectData","textandimage","e-icon e-ssr-selectdata",50,this._bigBtnHeight,"SelectData","SelectDataContent",!1,l)]}]},{id:"Type",text:i._getLocStr("ChartDesignType"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("ChartDesign_Type_ChangeChartType","ChartType","textandimage","e-icon e-ssr-charttype",65,this._bigBtnHeight,"ChartType","ChartTypeContent",!1,l)]}]},{id:"ChartThemes",text:i._getLocStr("ChartThemes"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateDD("ChartDesign_ChartThemes_ChartThemes","ChartThemes",this._chartThemes,"1",130,this._smallBtnHeight,"ChartThemes","ChartThemesContent")]}]},{id:"Size",text:i._getLocStr("ChartDesignSize"),alignType:t.Ribbon.alignType.columns,content:[{groups:[{contentID:r+"_Ribbon_ChartDesign_Size_ChartSize",enableSeparator:!0,type:t.Ribbon.type.custom,height:80}]}]}]}]},this._contextualTabCollection.push(e),i.model.allowSparkline&&this._contextualTabCollection.push(i.XLSparkline._contextualTabInsert()),e={backgroundColor:"#FCFBEB",borderColor:"#F2CC1C",tabs:[{id:"format",text:i._getLocStr("FORMAT"),groups:[{id:"Adjust",text:i._getLocStr("Adjust"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Format_Adjust_ChangePicture","ChangePicture","textandimage","e-icon e-ssr-changepicture",120,this._mediumBtnHeight,"ChangePicture","ChangePictureContent"),this._generateSplitBtn("Format_Adjust_ResetPicture","ResetPicture","textandimage",r+"_Ribbon_ResetPic",{dataSource:this._resetPicture,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"},"e-icon e-ssr-resetpicture",!1,120,this._mediumBtnHeight,"left","","dropdown","e-ss-resetpictbtn","ResetPicture","ResetPictureContent")]}]},{id:"Border",text:i._getLocStr("Border"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateSplitBtn("Format_Border_PictureBorder","PictureBorder","textandimage",r+"_Ribbon_PictureBorder","","e-icon e-ssr-pictureborder",!1,120,this._mediumBtnHeight,"left","","dropdown","e-ss-pictbrdrbtn","PictureBorder","PictureBorderContent")]}]},{id:"Size",text:i._getLocStr("FormatSize"),alignType:t.Ribbon.alignType.columns,type:"custom",contentID:r+"_Ribbon_Format_Size_PictureSize"}]}]},this._contextualTabCollection.push(e),e={backgroundColor:"#FCF0F7",borderColor:"#C9599C",tabs:[{id:"analyze",text:i._getLocStr("ANALYZE"),groups:[{id:"PivotTable",text:i._getLocStr("AnalyzePivotTable"),alignType:t.Ribbon.alignType.rows,type:"custom",contentID:r+"_pvttableproperties"},{id:"DataSource",text:i._getLocStr("DataSource"),alignType:t.Ribbon.alignType.rows,content:[{groups:[this._generateBtn("Analyze_DataSource_Refresh","Refresh","textandimage","e-icon e-ssr-datarefresh",50,this._bigBtnHeight,"RefreshTitle","RefreshContent",!1,l),this._generateBtn("Analyze_DataSource_ChangeDataSource","ChangeDataSource","textandimage","e-icon e-ssr-changedatasource",50,this._bigBtnHeight,"ChangeDataSource","ChangeDataSourceContent",!1,l)]}]},{id:"Actions",text:i._getLocStr("Actions"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateBtn("Analyze_Actions_ClearAll","ClearAll","textandimage","e-icon e-ssr-pivotclearall",75,this._smallBtnHeight,"ClearAll","ClearAllContent",!1,"","e-datapadding"),this._generateBtn("Analyze_Actions_MovePivotTable","MovePivotTable","textandimage","e-icon e-ssr-movepivottable",120,this._smallBtnHeight,"MovePivotTable","MovePivotTableContent",!1,"","e-datapadding")]}]},{id:"Show",text:i._getLocStr("Show"),alignType:t.Ribbon.alignType.columns,content:[{groups:[this._generateToggleBtn("Analyze_Show_FieldList","FieldList","textandimage","e-icon e-ssr-fieldlist","FieldListTitle",50,this._bigBtnHeight,["FieldListContent","FieldListRemoveContent"],!1,"",l,null,null,!0)]}]}]}]},this._contextualTabCollection.push(e)},_onRibbonPin:function(t){var i,r=this.XLObj,l=e.extend(!0,{},r.model.scrollSettings);this._ribbonState=!0,r.getSheet(r.getActiveSheetIndex())._isRibCollapsed=!1,t.action="toggleBtn",r.model._isActPanelVisible=this._isPanelVisible,r._isAutoWHMode?(this._refreshBackstageHeight(),i=r._getElementDimension(),r.element.css({height:i.height,width:i.width})):r._heightWidthCalculation(r.getActiveSheetIndex(),l,t),r.model._isActPanelVisible&&r._refreshActivationPanel()},_onRibbonExpand:function(t){var i,r=this.XLObj,l=e.extend(!0,{},r.model.scrollSettings);t.action="toggleBtn","expand"===t.type&&"dblclick"===t.clickType||r._isKeyCtrlShftF2||r._phoneMode?(this._ribbonState=!0,r.getSheet(r.getActiveSheetIndex())._isRibCollapsed=!1,r._isAutoWHMode?(this._refreshBackstageHeight(),i=r._getElementDimension(),r.element.css({height:i.height,width:i.width})):r._heightWidthCalculation(r.getActiveSheetIndex(),l,t),this.XLObj.model._isActPanelVisible&&r._refreshActivationPanel(),r._isKeyCtrlShftF2=!1):this.XLObj.model._isActPanelVisible&&(r.getActivationPanel().hide(),this._isPanelVisible=r.model._isActPanelVisible,r.model._isActPanelVisible=!1,r._heightWidthCalculation(r.getActiveSheetIndex(),l,t))},_onRibbonGroupClick:function(t){var i,r,l=this.XLObj;l._phoneMode&&(e(t.target).parents(".e-resizegroupdiv").length>0||t.target.className.indexOf("e-resizegroupdiv")>-1||t.target.className.indexOf("e-ribdownarrow")>-1||t.target.className.indexOf("e-ribuparrow")>-1||t.target.className.indexOf("e-ribleftarrow")>-1)&&(i=e.extend(!0,{},l.model.scrollSettings),this._ribbonState=!0,t.action="toggleBtn",l.model._isActPanelVisible=this._isPanelVisible,l._isAutoWHMode?(this._refreshBackstageHeight(),r=l._getElementDimension(),l.element.css({height:r.height,width:r.width})):l._heightWidthCalculation(l.getActiveSheetIndex(),i,t),l.model._isActPanelVisible&&l._refreshActivationPanel())},_hideTabs:function(){for(var t=e("#"+this.XLObj._id+"_Ribbon").ejRibbon("instance"),i=["",this.XLObj._getLocStr("Design"),this.XLObj._getLocStr("CHARTDESIGN"),this.XLObj._getLocStr("FORMAT"),this.XLObj._getLocStr("ANALYZE"),this.XLObj._getLocStr("SPARKLINEDESIGN")],r=i.length;r-=1;)t.hideTab(i[r])},_renderDesignTab:function(){var t=this.XLObj,i="",r=t._getLocStr("TableStyleOptions").split("/"),l=t._id+"_Ribbon_Design_TableStyleOptions";t.element.append("<input id="+t._id+'_tableid type="text" style = "display:none"/>'),i=(i="<div id="+t._id+'_Ribbon_Design_Properties_TableProperties><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell">Table Name:</div></div><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell"><input type="text" id='+t._id+'_Ribbon_Design_Properties_TableName class="ejinputtext" style="width:86px;opacity:0.7;height: 18px;text-indent: 3px;padding-left: 0px;box-sizing: content-box;" /></div></div></div>')+"<div id="+l+'><div class="e-tablestyleoptionsrow" ><div class="e-tablestyleoptionscell"><input id='+l+'_FirstColumn type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+l+'_FirstColumn">'+r[0]+'</label></div><div class="e-tablestyleoptionscell" ><input id='+l+'_LastColumn type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+l+'_LastColumn">'+r[1]+'</label></div></div><div class="e-tablestyleoptionsrow" ><div class="e-tablestyleoptionscell"><input id='+l+'_TotalRow type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+l+'_TotalRow">'+r[2]+'</label></div><div class="e-tablestyleoptionscell" ><input id='+l+'_FilterColumn type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+l+'_FilterColumn">'+r[3]+"</label></div></div></div>",t.element.append(i),e("#"+l+"_FirstColumn").ejCheckBox({change:this._ribbonClickHandler}),e("#"+l+"_LastColumn").ejCheckBox({change:this._ribbonClickHandler}),e("#"+l+"_TotalRow").ejCheckBox({change:this._ribbonClickHandler}),e("#"+l+"_FilterColumn").ejCheckBox({change:this._ribbonClickHandler})},_renderFormatTab:function(){var i=this.XLObj,r=i._id,l=i.element,n=r+"_Ribbon",s=n+"_Format_Size_";l.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:n+"_ResetPic"})),l.append(this._borderPicture()),l.append("<div id="+s+"PictureSize class= e-ss-numeric style='display:none'><table><tr><td style='padding-right:4px;'>"+i._getLocStr("Height")+": </label></td><td style='padding-bottom:3px;'><input id='"+s+"PictureHeight' type='text' /></td></tr><tr><td><labe>"+i._getLocStr("Width")+": </label></td><td><input id='"+s+"PictureWidth' type='text' /></td></tr></table></div>"),e("#"+s+"PictureHeight").ejNumericTextbox({name:"numeric",value:100,minValue:25,incrementStep:5,change:e.proxy(this._pictureSizeChange,this,"PictureWidth")}),e("#"+s+"PictureWidth").ejNumericTextbox({name:"numeric",value:100,minValue:25,incrementStep:5,change:e.proxy(this._pictureSizeChange,this,"PictureHeight")}),e("#"+n+"_PictureColor").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:this._ribbonClickHandler}),e("#"+n+"_PictureColorWrapper").hide(),e("#"+n+"_PictureColor_popup").css({display:"block"}),e("#"+r+"picturecolor ul li").find("a").remove(),e("#"+r+"picturecolor ul li").append(e("#"+n+"_PictureColor_popup"))},_renderAnalyzeTab:function(){var e=this.XLObj;e.element.find("#"+e._id+"_Ribbon_analyze_PivotTable_content").width(132),e.element.find("#"+e._id+"_pvttableproperties").length||e.element.append("<div id="+e._id+'_pvttableproperties style="display:none" ><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell">'+e._getLocStr("PivotTableName")+':</div></div><div class="e-tablepropertiesrow" ><div class="e-tablepropertiescell"><input type="text" id='+e._id+'_Ribbon_Analyze_PivotTable_PivotTableName class="ejinputtext" style="width:106px;opacity:0.7;height: 18px;text-indent: 3px;" /></div></div></div>')},_renderChartDesignTab:function(){var t=this.XLObj,i=t.element,r=t._id,l=r+"_Ribbon_ChartDesign_Size_";i.append(this._chartElementTag()),i.append("<div id="+l+"ChartSize class= e-ss-numeric style='width: 180;height: 80;'><table><tr><td><label class ='e-icon e-ssr-chartheight' style='width:25;height:25;display: visible' id = "+r+"_Ribbon_chartheightlbl /></td><td><input id='"+l+"ChartHeight' type='text' /></td></tr><tr><td><label class ='e-icon e-ssr-chartwidth' style='width: 180;height: 80;' id = "+r+"_Ribbon_chartwidthlbl /></td><td><input id='"+l+"ChartWidth' type='text' /></td></tr></table></div>"),e("#"+l+"ChartWidth").ejNumericTextbox({name:"numeric",value:200,minValue:180,decimalPlaces:1,incrementStep:5,change:this._ribbonClickHandler}),e("#"+l+"ChartHeight").ejNumericTextbox({name:"numeric",value:200,minValue:180,decimalPlaces:1,incrementStep:5,change:this._ribbonClickHandler})},_renderNameManagerDlg:function(){var i=this.XLObj,r="<div id = '"+i._id+"_nmdlg' style=display:'none'; ><div class='e-dlgctndiv' style='width: 100%;' ><div class='e-dlg-fields e-nmdlg-content' style='width: 100%;'><div class='e-ss-nm-dlg-grid' style='height: 180px;'><div id='"+i._id+"_nmgrid' style=display:'none';></div></div></div><div class='e-dlg-fields'><label class='e-dlg-fields'>"+i._getLocStr("RefersTo")+":</label><input type='text' class='e-nmrange ejinputtext' id='"+i._id+"_nmrange' disabled='true' /></div><div class='e-dlg-btnfields' ><div class='e-dlg-btnctnr'><button id='"+i._id+"_nmclose' >"+i._getLocStr("Close")+"</button></div></div></div></div>";r=r+"<script id='"+i._id+"_nmeditortemplate' class='e-hide' type='text/x-jsrender' ><div class='e-dlg-fields e-dlgctndiv'><table cellpadding='0' cellspacing='0'><tr><td>"+i._getLocStr("Name")+":</td><td><input id='"+i._id+"_nmgridname' type='text' class='ejinputtext' name='name' value='{{: name}}'/></td></tr><tr class='e-dlgtd-fields'><td>"+i._getLocStr("Scope")+":</td><td><input class='ejinputtext' id='"+i._id+"_nmgridscope' type='text' name='scope' value='"+i._getLocStr("Workbook")+"'/></td></tr><tr class='e-dlgtd-fields'><td>"+i._getLocStr("Comment")+":</td><td><textarea id='"+i._id+"_nmgridcomment' class='e-ss-textarea' style=' resize: none; height: 44px; width: 100%;' name='comment' value='{{: comment}}'>{{: comment}}</textarea></td></tr><tr class='e-dlgtd-fields'><td>"+i._getLocStr("RefersTo")+":</td><td><input type='text' class='ejinputtext' id='"+i._id+"_nmgridrefersto' name = 'refersto' value='{{: refersto}}' /></td></tr></table></div><\/script>",i.element.append(r),e("#"+i._id+"_nmclose").ejButton({showRoundedCorner:!0,width:68,click:e.proxy(this._nmdlgClose,i)}),this._renderNMGrid(),e("#"+i._id+"_nmdlg").ejDialog({enableResize:!1,showOnInit:!1,title:i._getLocStr("NameManager"),enableModal:!0,width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-nmdlg e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this),beforeClose:t.proxy(this._beforeDlgClose,this),open:t.proxy(this._nmDlgOpen,this)})},_renderNMDDownList:function(){var t=this.XLObj;e("#"+t._id+"_nmgridscope").ejDropDownList({dataSource:this._nameMSheetNames(),width:"100%",height:"44px"})},_nameMSheetNames:function(){var e,t,i=this.XLObj,r=[],l=[],n=i._getSheetNames();for(l[0]={value:"Workbook",text:i._getLocStr("Workbook")},e=1,t=n.length;e<=t;e++)n[e-1].isVisible&&(r[e]=n[e-1].text,l[e]={value:r[e],text:r[e]});return l},_renderNMGrid:function(){var i=this.XLObj;e("#"+i._id+"_nmgrid").ejGrid({locale:i.model.locale,dataSource:i.model.nameManager.slice(0),allowScrolling:!0,allowSorting:!0,enableAltRow:!1,isResponsive:!0,minWidth:400,allowPaging:!1,scrollSettings:{height:"100%"},cssClass:"e-ss-dialog e-ss-grid e-"+i._id+"-dlg",selectionType:t.Grid.SelectionType.Single,editSettings:{allowAdding:!0,allowDeleting:!1,editMode:t.Grid.EditMode.DialogTemplate,dialogEditorTemplateID:"#"+i._id+"_nmeditortemplate"},toolbarSettings:{showToolbar:!0,toolbarItems:[t.Grid.ToolBarItems.Add]},actionBegin:e.proxy(this._nmActionBegin,i),actionComplete:e.proxy(this._nmActionComplete,i),rowSelected:e.proxy(this._nmRecordSelected,i),columns:[{field:"name",headerText:i._getLocStr("Name"),isPrimaryKey:!0,width:100},{field:"refersto",headerText:i._getLocStr("RefersTo"),width:120},{field:"scope",headerText:i._getLocStr("Scope"),width:80},{field:"comment",headerText:i._getLocStr("Comment"),width:100}]})},_updateNMRange:function(){var t=this.XLObj;e("#"+t._id+"_nmgridEditForm").find("#"+t._id+"_nmgridrefersto").val("="+t._getDollarAlphaRange(t.getSheet(t.getActiveSheetIndex()).selectedRange,!0))},_nmdlgClose:function(){e("#"+this._id+"_nmdlg").ejDialog("close")},_nmRecordSelected:function(t){e("#"+this._id+"_nmdlg").find(".e-nmrange").val(t.data.refersto)},_nmDlgOpen:function(){var t=this.XLObj;"DefineName"===this._isNmgrid&&(e("#"+t._id+"_nmgrid").ejGrid("instance").addRecord(),e("#"+t._id+"_nmgridEditForm input")[0].focus()),this._isNmgrid=""},_nmActionBegin:function(e){var t,i,r,l=0,n=!1,s=this.getSheet(this.getActiveSheetIndex());if("save"===e.requestType&&e.data.refersto){if((r=e.data).sheetIndex=this._getSheetIndexByName(e.data.refersto.split("!")[0].replace(/[=\']/g,"")),e.cancel=!0,!r.sheetIndex)return void this._showAlertDlg("Alert","InvalidSheetIndex","NMRangeAlert",275);if(s._nmEdit)for(i in s._nmValue){for(t=this.model.nameManager.length;l<t;){if(this.model.nameManager[l].name===s._nmValue.name){this.model.nameManager.splice(l,1),this._calcEngine.removeNamedRange(s._nmValue.name);break}l++}for(l=this._formulaCollection.length;l--;)if(this._formulaCollection[l].display===s._nmValue.name){n=!0,this._formulaCollection.splice(l,1);break}if(n)break}this.XLRibbon._validateNamedRange(r.name,r.refersto,r.scope)?e.cancel=!1:n&&this.model.nameManager.push(s._nmValue)}"beginedit"===e.requestType&&(s._nmEdit=!0,s._nmValue={name:e.model.dataSource[e.model.selectedRowIndex].name,refersto:e.model.dataSource[e.model.selectedRowIndex].refersto,comment:e.model.dataSource[e.model.selectedRowIndex].comment,sheetIndex:e.model.dataSource[e.model.selectedRowIndex].sheetIndex,scope:e.model.dataSource[e.model.selectedRowIndex].scope})},_nmActionComplete:function(t){var i,r,l=e("#"+this._id+"_nmgrid").data("ejGrid");switch(t.requestType){case"add":(i=e("#"+this._id+"_nmgrid_dialogEdit").data("ejDialog")).model.open=e.proxy(this.XLRibbon._updateNMRange(),this),i.option("allowDraggable",!1),i.option("title",this._getLocStr("NewName")),(r=e("#"+this._id+"_nmgridEditForm").find("input[type='button']:first")).data("ejButton").option({text:this._getLocStr("Ok"),cssClass:"e-ss-okbtn"}),r.parent().addClass("e-dlg-btnfields").css("text-align","right"),this.XLRibbon._renderNMDDownList();break;case"save":this.XLRibbon._addNamedRange(t.data.name,t.data.refersto,t.data.comment,t.data.sheetIndex,t.data.scope);break;case"delete":this.XLRibbon._removeNamedRange(l,t.data.name,t.data.scope);break;case"cancel":l.element.focus()}},_updateNamedRanges:function(e,t,i,r){var l=this.XLObj;t=l.XLEdit._parseSheetRef(t,!0),r.toUpperCase()===l._getLocStr("Workbook").toUpperCase()?(l._calcEngine.addNamedRange(e,t.replace("=","")),this._scopeBookCln[e]={isName:!0}):l._calcEngine.addNamedRange(r+"!"+e,t.replace("=","")),this._updateScopeRange(),i||l.XLEdit._refreshAutoComplete()},_updateUseInFormulaTrgt:function(){for(var t,i,r=0,l=this.XLObj,n="",s=e("#"+l._id+"_nmuseinformula"),o=l.model.nameManager,a=o.length,d=l.getActiveSheetIndex();r<a;)o[r].scope.toUpperCase()!==l._getLocStr("Workbook").toUpperCase()&&(t=l._getSheetIndexByName(o[r].scope),i=l.getSheet(d)._scopeRanges),(o[r].scope.toUpperCase()===l._getLocStr("Workbook").toUpperCase()||d===t&&i&&i[o[r].name]&&!i[o[r].name].isSameName)&&(n=n+"<div class='e-nmuseinformularow' style = 'color:#333333'>"+o[r].name+"</div>"),r++;n.length?e("#"+l._id+"_Ribbon_Others_Formulas_UseInFormula").ejSplitButton("enable"):e("#"+l._id+"_Ribbon_Others_Formulas_UseInFormula").ejSplitButton("disable"),s.html("<div>"+n+"</div>")},addNamedRange:function(i,r,l,n,s){var o,a,d=this.XLObj;n=n||d.getActiveSheetIndex(),o=e("#"+d._id+"_nmgrid").data("ejGrid"),a={name:i,refersTo:r,comment:l,scope:t.isNullOrUndefined(s)?"workbook":s,sheetIndex:n,reqType:"named-range",type:"actionBegin",action:"addNamedRange"},d._trigActionBegin(a)||(i=a.name,r=a.refersTo,l=a.comment,s=a.scope,this._validateNamedRange(i,r,s)&&(o?(o.addRecord({name:i,refersto:r,comment:l||"",scope:s||"WorkBook",sheetIndex:n}),o.refreshContent()):this._addNamedRange(i,r,l,n,s)))},_addNamedRange:function(e,i,r,l,n){var s,o,a,d=this.XLObj;l=l||d.getActiveSheetIndex();var h={name:e,refersTo:i,comment:r,scope:t.isNullOrUndefined(n)?"workbook":n,sheetIndex:l,reqType:"named-range",type:"actionBegin",action:"addNamedRange"},c=d.model.nameManager,u=c.length;if(!d._trigActionBegin(h)){for(e=h.name,i=h.refersTo,r=h.comment,n=h.scope?h.scope:"workbook",o=(o=d._getSheetIndexByName(n))||l,n.toUpperCase()!==d._getLocStr("Workbook").toUpperCase()&&((a=d.getSheet(o))._scopeRanges[e]?(a._scopeRanges[e].name=n+"!"+e,a._scopeRanges[e].refersto=i):a._scopeRanges[e]={name:n+"!"+e,refersto:i}),s=0;s<u;s++)c[s].name.toUpperCase()===e.toUpperCase()&&("WORKBOOK"===c[s].scope.toUpperCase()&&"WORKBOOK"!==n.toUpperCase()||"WORKBOOK"!==c[s].scope.toUpperCase()&&"WORKBOOK"===n.toUpperCase())&&(o=n.toUpperCase()===d._getLocStr("Workbook").toUpperCase()?d._getSheetIndexByName(c[s].scope):d._getSheetIndexByName(n),d.getObjectLength(d.getSheet(o)._scopeRanges[e])||(d.getSheet(o)._scopeRanges[e]={}),d.getSheet(o)._scopeRanges[e].isSameName=!0);d.isImport||d.model.isImport||d.model.nameManager.push({name:e,refersto:i,comment:r,sheetIndex:l,scope:n}),this._updateNamedRanges(e,i,!1,n),d.isImport||d.model.isImport||this._updateUseInFormulaTrgt(),d._isSheetNavigate||d._trigActionComplete(h)}},removeNamedRange:function(t,i){if(t){var r,l=this.XLObj,n=e("#"+l._id+"_nmgrid").data("ejGrid");if(i=i||"workbook",n)n.option("editSettings",{allowDeleting:!0}),n.deleteRecord("name",{name:t,scope:i}),n.option("editSettings",{allowDeleting:!1});else{if((r=this._validateNameManager(t,i))<0)return;l.model.nameManager.splice(r,1),this._removeNamedRange(n,t,i)}}},_removeNamedRange:function(e,t,i){var r,l,n,s,o=this.XLObj;if(e&&(o.model.nameManager=e.model.dataSource.slice(0)),l=o.model.nameManager,i.toUpperCase()===o._getLocStr("Workbook").toUpperCase()?delete this._scopeBookCln[t]:(s=t,t=(n=o.getSheet(o._getSheetIndexByName(i))._scopeRanges)[t].name,delete n[s]),o._calcEngine.removeNamedRange(t),o._updateFormulaCollection(),r=l.length)for(;r--;)o._formulaCollection.push({text:"="+l[r].name,display:l[r].name});this._updateUseInFormulaTrgt()},_updateScopeRange:function(){var e,t=this.XLObj,i=t.model.nameManager,r=i.length,l=t.getActiveSheetIndex(),n=t.getSheet(l);for(t._updateFormulaCollection(),e=0;e<r;e++)(i[e].scope.toUpperCase()===t._getLocStr("Workbook").toUpperCase()||t._getSheetIndexByName(i[e].scope)===l)&&(n._scopeRanges[i[e].name]&&n._scopeRanges[i[e].name].isSameName&&i[e].scope.toUpperCase()!==t._getLocStr("Workbook").toUpperCase()?t._formulaCollection.push({text:"="+i[e].name+" (worksheet)",display:i[e].name+"(worksheet)"}):t._formulaCollection.push({text:"="+i[e].name,display:i[e].name}))},_validateNamedRange:function(e,t,i){var r,l,n,s,o,a=this.XLObj,d="NMRangeAlert",h="NMNameAlert",c="NMUniqueNameAlert";if(r=this._validateDollarRange(t),e&&e.length>0&&(l=/^([a-zA-Z_0-9]){0,255}$/.test(e)&&this._validateLibraryFunctions(e)),n=this._validateNameManager(e,i),a._isUndoRedo||r&&l&&n<0||a.XLFormat._isTableNameAdded)return!0;r?l?(s=a._getLocStr(c),o=c):(s=a._getLocStr(h).split("/")[0],o=h):(s=a._getLocStr(d),o=d),a._showAlertDlg("Alert","T-"+s,o,370)},_validateLibraryFunctions:function(e){var i,r=[],l=this.XLObj.getCalcEngine().getLibraryFunctions();for(i in e=t.isNullOrUndefined(e)?"":e.toString().toUpperCase(),l.items)r.push(i);for(i=r.length;i--;)if(r[i]===e)return!1;return!0},_validateNameManager:function(e,i){var r=0,l=this.XLObj.model.nameManager,n=l.length;for(e=t.isNullOrUndefined(e)?"":e.toString().toUpperCase(),i=i||"Workbook";r<n;){if(l[r].scope.toUpperCase()===i.toUpperCase()&&l[r].name.toUpperCase()===e)return r;r++}return-1},_validateDollarRange:function(e){try{if(e&&e.indexOf("!")>-1)return e=e.split("!")[1].replace(/\$/g,""),this.XLObj.getRangeIndices(e),!0}catch(e){return!1}},_renderFormatAsTable:function(){for(var t,i,r,l=this.XLObj,n=0,s=[11,19],o=0,a="",d="",h=l._getLocStr("FATHeaderText").split("/"),c=l._getLocStr("FormatAsTableTitle").split("/"),u=["Light1","Light2","Light3","Light5","Light8","Light9","Light10","Light12","Light15","Light16","Light17","Light19","Medium8","Medium9","Medium10","Medium12","Medium22","Medium23","Medium24","Medium26","Dark1","Dark2","Dark3","Dark5"];n<24;)a+=l._renderDIV("e-formatastablecell",'<div class="e-ss-cellstyles-'+(n+1)+'" ></div>'),n===s[o]&&(a+="</br>",o++),n++;for(n=0,a=a.split("</br>");n<2*h.length;)d+=l._renderDIV(n%2==0?"e-formatastableheader":"e-formatastablecontent",n%2==0?h[n/2]:a[0]),n%2!=0&&a.shift(),n++;for((t=document.getElementById(l._id+"_formatastable")).innerHTML=d,n=0,r=(i=(t=e(t)).find(".e-formatastablecell")).length;n<r;)e(i[n]).attr("id","Table Style "+u[n]),e(i[n]).attr("title",l._getLocStr("FATTitlePrefix")+c[n]),n++;return l.XLFormat&&(l.XLFormat._formatAsTableStyle=l._FATStyles.TableStyleLight1),t.find(".e-formatastableheader:eq(0)").append("<span id ='"+l._id+"_formatastable_back' class = 'e-formatastable-back e-icon e-ss-leftarrow'/>"),t.data("ejMenu").model.open=function(){t.scrollTop(0)},t},_renderFATNameDlg:function(){var i,r=this.XLObj,l=r._getLocStr("FATNameDlgText").split("/"),n={showRoundedCorner:!0,width:"27%",click:e.proxy(this._fatNameDlgBtnClick,this)};i="<div id="+r._id+'_fatnamedlg><div class="e-dlg-fields e-dlgctndiv e-ss-nmdlg"><table cellspacing="0" cellpadding="0"><tr><td>'+l[0]+'</td><td><input id="'+r._id+'_fatname" class="ejinputtext" /></td></tr><tr class="e-dlgtd-fields"><td></td><td><input type="checkbox" id="'+r._id+'_fatheader" style="background-color:#ffffff"/> <label for="'+r._id+'_fatheader" class="e-ss-fathdr">'+l[1]+'</label></td></tr></table></div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+r._id+"_fatnamedlgok>"+r._getLocStr("Ok")+"</button><button id="+r._id+"_fatnamedlgcancel>"+r._getLocStr("Cancel")+"</button></div></div></div>",r.element.append(i),e("#"+r._id+"_fatheader").ejCheckBox(),e("#"+r._id+"_fatnamedlgok").ejButton(n),e("#"+r._id+"_fatnamedlgok").ejButton("option","cssClass","e-ss-okbtn"),e("#"+r._id+"_fatnamedlgcancel").ejButton(n),e("#"+r._id+"_fatnamedlg").ejDialog({showOnInit:!1,width:"auto",showRoundedCorner:!0,title:r._getLocStr("FormatAsTable"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+r._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_renderChartNameDlg:function(){var i,r=this.XLObj,l=r._getLocStr("ChartTitleDlgText"),n={showRoundedCorner:!0,width:"23%",click:e.proxy(this._chartNameDlgBtnClick,this)};i="<div id="+r._id+'_chartnamedlg ><div class="e-dlg-fields e-dlgctndiv"><table cellpadding="0" cellspacing="0"><tr><td>'+l+'</td><td><input id="'+r._id+'_chartname" class="ejinputtext" /></td></tr></table></div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+r._id+"_chartnamedlgok >"+r._getLocStr("Ok")+"</button><button id="+r._id+"_chartnamedlgcancel>"+r._getLocStr("Cancel")+"</button></div></div>",r.element.append(i),e("#"+r._id+"_chartnamedlgok").ejButton(n),e("#"+r._id+"_chartnamedlgok").ejButton("option","cssClass","e-ss-okbtn"),e("#"+r._id+"_chartnamedlgcancel").ejButton(n),e("#"+r._id+"_chartnamedlg").ejDialog({showOnInit:!1,width:"334px",minHeight:"auto",showRoundedCorner:!0,title:r._getLocStr("ChartTitle"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+r._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_renderFATResizeTableDlg:function(){var i=this.XLObj,r={showRoundedCorner:!0,width:"15%",click:e.proxy(this._fatResizeTableBtnClick,this)},l="<div id="+i._id+'_fatresizetabledlg ><div class="e-dlgctndiv"><table><tr><td>'+i._getLocStr("FATResizeTableText")+'</td><td style="width: 50%;"><input id="'+i._id+'_fatresizetablerange" class="ejinputtext" style="margin-left: 2px;"></td></tr></table><div class="e-dlg-fields">'+i._getLocStr("FATReizeTableNote")+'</div></div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+i._id+"_fatresizetabledlgok >"+i._getLocStr("Ok")+"</button><button id="+i._id+"_fatresizetabledlgcancel >"+i._getLocStr("Cancel")+"</button></div></div></div>";i.element.append(l),e("#"+i._id+"_fatresizetabledlgok").ejButton(r),e("#"+i._id+"_fatresizetabledlgok").ejButton("option","cssClass","e-ss-okbtn"),e("#"+i._id+"_fatresizetabledlgcancel").ejButton(r),e("#"+i._id+"_fatresizetabledlg").ejDialog({showOnInit:!1,width:"494px",showRoundedCorner:!0,title:i._getLocStr("ResizeTable"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+i._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_fatResizeTableBtnClick:function(t){var i=this.XLObj,r=document.getElementById(i._id+"_fatresizetablerange").value,l=i.getActiveSheetIndex(),n=document.getElementById(i._id+"_tableid").value,s=i.getSheet(l).tableManager,o={sheetIndex:l,reqType:"format-table",action:"Design_Tools_ResizeTable",tableId:n},a=!0;t.model.text===i._getLocStr("Ok")&&(i._isvalidRange(r)?((o=this._resizeTable(r,n,l,o)).afterRange=i.getRangeIndices(r),o.format=s[n].format,o.formatName=s[n].formatName,o.header=e.extend(!0,{},i.model.sheets[l]._header),o.isFilter=s[n].isFilter,o.firstColumn=s[n].firstColumn,o.lastColumn=s[n].lastColumn,o.totalRow=s[n].totalRow,i.XLSelection.selectRange(s[n].range),i._completeAction(o),i._trigActionComplete(o)):(a=!1,i._showAlertDlg("Alert","InvalidReference","",375))),a&&e("#"+i._id+"_fatresizetabledlg").ejDialog("close")},_resizeTable:function(t,i,r,l){var n,s,o,a=this.XLObj,d=a.getSheet(r).tableManager;return l=l||{sheetIndex:r,reqType:"format-table",action:"Design_Tools_ResizeTable",tableId:i},t=-1!=t.indexOf(":")?a.getRangeIndices(t):a._getRangeArgs(t,"object"),(n=this._validateResizeRange(t,d[i].range))?a._showAlertDlg("Alert",n,"",500):(l.beforeRange=e.extend(!0,[],d[i].range),d[i].totalRow?(o=e("#"+a._id+"_Ribbon_Design_TableStyleOptions_TotalRow").data("ejCheckBox"),a._dupDetails=!0,o.option("checked",!1),d[i].range=[t[0],t[1],t[2]-1,t[3]]):d[i].range=t,this._isFilterSelect.isFiltered&&a.XLFilter._clearFilterTable(r,parseInt(i),!0),a.XLFormat._isFAT=!0,a.XLFormat._createTable(i,{format:d[i].format}),a.XLFormat._isFAT=!1,a.XLFilter._extendFilterRange(i,d[i].range),a.XLFormat._updateTableFormula("updateRange",d[i],r),d[i].range[2]==t[2]-1&&(a._dupDetails=!0,o.option("checked",!0)),d[i].firstColumn&&(a._dupDetails=!0,s=a._getProperAlphaRange(r,d[i].range[0]+1,d[i].range[1],d[i].range[2],d[i].range[1]),a.XLFormat.format({style:{"font-weight":"bold"}},s),a._dupDetails=!1),d[i].lastColumn&&(a._dupDetails=!0,s=a._getProperAlphaRange(r,d[i].range[0]+1,d[i].range[3],d[i].range[2],d[i].range[3]),a.XLFormat.format({style:{"font-weight":"bold"}},s),a._dupDetails=!1)),a.XLSelection.selectRange(d[i].range),l},_firstLastColumn:function(e,i){var r,l,n=this.XLObj,s="",o=n.getSheet(i).tableManager;r=n._dataContainer.sheets[i][o[e].range[0]][o[e].range[1]],e in o&&(l=o[e].range,l=this._isFirstColumn?n._getProperAlphaRange(i,l[0]+1,l[1],l[2],l[1]):n._getProperAlphaRange(i,l[0]+1,l[3],l[2],l[3]),this._isFirstColumn?(s="firstColumn",t.isNullOrUndefined(o[e].firstColumn)?o[e][s]=!0:delete o[e].firstColumn,r.firstColumn=!!t.isNullOrUndefined(r.firstColumn)):(s="lastColumn",t.isNullOrUndefined(o[e].lastColumn)?o[e][s]=!0:delete o[e].lastColumn,r.lastColumn=!!t.isNullOrUndefined(r.lastColumn)),n._dupDetails=!0,n.XLFormat.format({style:{"font-weight":o[e][s]?"bold":"normal"}},l),n._dupDetails=!1)},_totalRow:function(e,i){var r=this.XLObj,l=r.getSheet(i).tableManager;t.isNullOrUndefined(l[e].totalRow)?r.XLFormat._calculateTotalRow(i,e,!0,!0):r.XLFormat._calculateTotalRow(i,e,!1,!1)},_fatNameDlgBtnClick:function(t){var i,r,l,n=this.XLObj,s=n._id;e("#"+s+"_fatnamedlg").ejDialog("close"),t.model.text===n._getLocStr("Ok")&&(r=n._getSelectedCells().selCells[0].rowIndex,l=n._getSelectedCells().selCells[0].colIndex,n.XLEdit.getPropertyValue(r,l,"hasFormulaArray",n.getActiveSheetIndex())?n._showAlertDlg("Alert","ArrayaFormulaTableAlert",430):(i={header:e("#"+s+"_fatheader").ejCheckBox("checked"),name:document.getElementById(s+"_fatname").value,format:n.XLFormat._formatAsTableStyle.format},n.XLFormat._formatAsTableStyle.formatName&&(i.formatName=n.XLFormat._formatAsTableStyle.formatName),n.XLFormat.createTable(i)))},_validateResizeRange:function(e,t){var i=this.XLObj;return e.length?e[0]!=t[0]||e[1]!=t[1]?"ResizeAlert":e[3]!=t[3]||e[2]<t[2]?"ResizeRestrictAlert":e[2]>i.getSheet(i.getActiveSheetIndex()).rowCount?"RangeNotCreated":void 0:"InvalidReference"},_chartNameDlgBtnClick:function(t,i,r){var l,n,s,o=this.XLObj,a=o.getActiveSheetIndex(),d=o.getSheet(a).shapeMngr.chart[o.XLEdit.getPropertyValue(o.XLShape._picCellIdx.rowIndex,o.XLShape._picCellIdx.colIndex,"chart")[0]],h=o._id,c=document.getElementById(h+"_chart").value;if(l=e("#"+c).data("ejChart"),n={sheetIndex:a,reqType:"shape",shapeType:"chart",cid:c,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex,prev:{},cur:{}},s=i||document.getElementById(h+"_chartname").value,t.model.text===o._getLocStr("Ok")){if(!s.length)return void o._showAlertDlg("Alert","InvalidTitle","InvalidChartTitleActn",375);switch(o._hasTitle){case"PX":l.option("primaryXAxis",{title:{text:s}}),d.xAxis.title.text=s,n.action="PX",n.operation=r||"PHAxisTitle";break;case"PY":l.option("primaryYAxis",{title:{text:s}}),d.yAxis.title.text=s,n.action="PY",n.operation=r||"PVAxisTitle";break;case"CT":l.option("title",{text:s}),d.title.text=s,n.action=n.operation="CT"}}n.prev.text=o._cOpt.prevText,"CT"==o._hasTitle&&(n.prev.align=o._cOpt.prevAlign,n.cur.align=o._cOpt.curAlign),n.cur.text=s,o._completeAction(n),o._trigActionComplete(n),o._cOpt={},document.getElementById(h+"_chartname").value="",e("#"+h+"_chartnamedlg").ejDialog("close")},_designTabUpdate:function(t,i){var r=this.XLObj;if(r.model.showRibbon){var l,n=r._id,s=e("#"+r._id+"_Ribbon").ejRibbon("instance"),o=r.getSheet(r.getActiveSheetIndex()).tableManager;s.showTab(r._getLocStr("Design")),this._isDesignTab&&!s._isCollapsed&&s.option({selectedItemIndex:this._getTabIndex("design")}),document.getElementById(r._id+"_Ribbon_Design_Properties_TableName")&&(document.getElementById(r._id+"_Ribbon_Design_Properties_TableName").value=o[t].name),document.getElementById(r._id+"_tableid")&&(document.getElementById(r._id+"_tableid").value=t),this._isSetModel=!0,e("#"+n+"_Ribbon_Design_TableStyleOptions_TotalRow").data("ejCheckBox").option({checked:!!o[t].totalRow}),e("#"+n+"_Ribbon_Design_TableStyleOptions_FirstColumn").data("ejCheckBox").option({checked:!!o[t].firstColumn}),e("#"+n+"_Ribbon_Design_TableStyleOptions_LastColumn").data("ejCheckBox").option({checked:!!o[t].lastColumn}),e("#"+n+"_Ribbon_Design_TableStyleOptions_FilterColumn").data("ejCheckBox").option({enabled:!!r.model.allowFiltering}),e("#"+n+"_Ribbon_Design_TableStyleOptions_FilterColumn").data("ejCheckBox").option({checked:!!o[t].isFilter}),this._isSetModel=!1,(l=e("#"+r._id+"_Ribbon_Data_SortFilter_ClearFilter").data("ejButton"))&&this._changeClrFltrStatus(l,"button",i)}},_formatTabUpdate:function(){var t=this.XLObj;if(t.model.showRibbon){var i=e("#"+t._id+"_Ribbon").ejRibbon("instance"),r=t.element.find("#"+t._id+"_Ribbon_Format_Size_PictureHeight"),l=t.element.find("#"+t._id+"_Ribbon_Format_Size_PictureWidth");i.showTab(t._getLocStr("FORMAT")),t._shapeChange=!0,r.length&&r.ejNumericTextbox("option","value",t.element.find(".e-ss-activeimg").height()),l&&l.ejNumericTextbox("option","value",t.element.find(".e-ss-activeimg").width()),t.model.showRibbon&&!i._isCollapsed&&i.option({selectedItemIndex:t.XLRibbon._getTabIndex("format")}),t._shapeChange=!1}},_analyzeTabUpdate:function(){var t,i,r=this.XLObj;if(!r.model.enablePivotTable)return!1;t=r.element.find("#"+r._id+"_Ribbon_Analyze_PivotTable_PivotTableName"),i=e("#"+r._id+"_Ribbon").data("ejRibbon"),t.length&&t.val(r.XLPivot.names[r._getContent(r.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id]),r.model.showRibbon&&(i.showTab(r._getLocStr("ANALYZE")),i._isCollapsed||i.option({selectedItemIndex:r.XLRibbon._getTabIndex("analyze")}))},_chartDesignTabUpdate:function(t){var i,r,l=this.XLObj;if(l.model.showRibbon){var n=e("#"+l._id+"_Ribbon").data("ejRibbon"),s=t.get(0).id,o=t.get(0).offsetLeft,a=t.get(0).offsetTop,d=t.ejChart("model"),h=n.element.find("#"+l._id+"_Ribbon_ChartDesign_ChartThemes_ChartThemes");i=l._getIdxWithOffset(a,o,!0),l.XLShape._picCellIdx={rowIndex:i.rowIdx,colIndex:i.colIdx},n.showTab(l._getLocStr("CHARTDESIGN")),r=l.XLChart._getShapeObj(s,"chart").isChartSeries?"disable":"enable",e("#"+l._id+"_Ribbon_ChartDesign_Data_SelectData").ejButton(r),e("#"+l._id+"_Ribbon_ChartDesign_Data_SwitchRowColumn").ejButton(r),n._isCollapsed||n.option({selectedItemIndex:l.XLRibbon._getTabIndex("chartdesign")}),document.getElementById(l._id+"_chart").value=s,this._isSetModel=!0,this._setShapeWidthHeight({height:d.size.height,width:d.size.width,shapeType:"chart"}),h.length&&h.ejDropDownList("setSelectedValue",t.ejChart("option","theme")),this._isSetModel=!1,l.model.allowFormulaBar&&l.updateFormulaBar()}},_setShapeWidthHeight:function(t){var i,r,l=this.XLObj;"chart"==t.shapeType?(i=e("#"+l._id+"_Ribbon_ChartDesign_Size_ChartWidth").data("ejNumericTextbox"),r=e("#"+l._id+"_Ribbon_ChartDesign_Size_ChartHeight").data("ejNumericTextbox")):(i=e("#"+l._id+"_Ribbon_Format_Size_PictureWidth").data("ejNumericTextbox"),r=e("#"+l._id+"_Ribbon_Format_Size_PictureHeight").data("ejNumericTextbox")),l._shapeChange=!0,l.model.showRibbon&&(r.option({value:t.height}),i.option({value:t.width})),l._shapeChange=!1},changeDimension:function(t){var i,r,l,n,s,o,a=this.XLObj,d=a.getActiveSheetIndex(),h={sheetIndex:d,reqType:"shape",rowIndex:a.XLShape._picCellIdx.rowIndex,colIndex:a.XLShape._picCellIdx.colIndex,actionType:"shapechange"};"picture"==t.shapeType?(s=(i=a.getSheetElement(d).find(".e-ss-activeimg")).length?i[0]:e("#"+t.id),h.prev={width:s.width(),height:s.height()},r=e("#"+t.id),l={width:t.width,height:t.height},r.css(l),h.action="picturesize",h.shapeType="picture",h.cur={width:s.width(),height:s.height()}):(o=e("#"+t.id).data("ejChart"),h.prev={width:o.model.size.width,height:o.model.size.height},l={width:t.width.toString(),height:t.height.toString()},n=o.element,o.option("size",l),n[0].style.height=t.height+"px",n[0].style.width=t.width+"px",h.action="width",h.shapeType="chart",h.cid=t.id,h.cur={width:o.model.size.width,height:o.model.size.height}),a._completeAction(h),a._trigActionComplete(h),this._setShapeWidthHeight(t)},_toggleDesignTab:function(i){var r,l,n=this.XLObj,s=n.getActiveSheetIndex();n.model.showRibbon&&(l=e("#"+n._id+"_Ribbon").data("ejRibbon"),(t.isNullOrUndefined(n.XLEdit.getPropertyValue(i.rowIndex,i.colIndex,"tableName"))||n.getSheetElement(s).find(".e-ss-activeimg").length)&&(l.hideTab(n._getLocStr("Design")),l._isCollapsed||l.option({selectedItemIndex:1}))),r=e("#"+n._id+"_Ribbon_Data_SortFilter_ClearFilter").data("ejButton"),this._changeClrFltrStatus(r,"button",i)},_toggleChartDesignTab:function(){this._toggleContextualTab(this.XLObj._getLocStr("CHARTDESIGN"))},_toggleFormatTab:function(){this._toggleContextualTab(this.XLObj._getLocStr("FORMAT"))},_toggleAnalyzeTab:function(){this._toggleContextualTab(this.XLObj._getLocStr("ANALYZE"))},_toggleContextualTab:function(t){var i,r=this.XLObj;r.model.showRibbon&&((i=e("#"+r._id+"_Ribbon").data("ejRibbon")).hideTab(t),i._isCollapsed||i.option({selectedItemIndex:1}))},_getTabIndex:function(t){if(this.XLObj.model.showRibbon){for(var i=e("#"+this.XLObj._id+"_Ribbon").ejRibbon("model"),r=i.tabs,l=i.contextualTabs,n=0;n<l.length;)r=r.concat(l[n].tabs),n++;for(n=r.length;n--;)if(r[n].id===t)return++n}},_getFormatAsTableInput:function(e){var t,i,r,l,n=this.XLObj,s=0,o=0,a=[],d={hl:"headerLayout",cl:"contentLayout",hb:"headerBorder",cb:"contentBorder"},h={};for(e=e.split("&");s<e.length;){if(t=(r=e[s].split("?"))[0],i=r[1],"hl"===t)h[d[t]]=n._getStyleAsJSON(i,!0);else if("cl"===t){for(l=i.split(",");o<l.length;)a.push(l[o].length?n._getStyleAsJSON(l[o],!0):{}),o++;h[d[t]]=a}else"cb"===t&&(l=i.split("-"),h[d[t]]={border:this._getBorderObj(l[0],l[1])});s++}return h},_getBorderObj:function(e,t){var i,r={t:{top:""},r:{right:""},b:{bottom:""},l:{left:""},o:{top:"",right:"",bottom:"",left:""},tb:{top:"",bottom:""},gb:{top:"",right:"",bottom:"",left:""}};for(i in r[e])r[e][i]=t;return"gb"===e&&(r[e].isGridBorder=!0),r[e]},_renderCellStyles:function(){for(var i,r,l,n=1,s=1,o=0,a=4,d=[],h="e-cellstylecell ",c="",u=this.XLObj,g=u._dataContainer.hashCode,p=u._getLocStr("CellStyleHeaderText").split("/"),m=u._getLocStr("CellStyleGBN").split("/"),_=[g[0],g[1],g[2],g[3]],f=u._getLocStr("CellStyleTH").split("/"),b=g.slice(4,6),C=g.slice(6,18);o<a;)r=m[o],c+=u._renderDIV(h+_[o],r,r),o++;for(d.push(c),c="",o=0,a=2;o<a;)r=f[o],c=1===o?c+'<div class="'+h+b[o]+'"  style="font-size: 11pt;" title="'+r+'">'+r+"</div>":c+u._renderDIV(h+b[o],r,r),o++;for(d.push(c),c="",o=0,a=12;o<a;)o>=0&&o<4?r="20% - "+u._getLocStr("Accent")+(o+1):o>=4&&o<8?(r="60% - "+u._getLocStr("Accent")+n,n++):(r=u._getLocStr("Accent")+s,s++),c+=u._renderDIV(h+C[o],r,r),o++;for(d.push(c),c="",o=0;o<2*p.length;)i=o%2,c+=u._renderDIV(0===i?"e-cellstyleheader":"e-cellstylecontent",0===i?p[o/2]:d[0]),0!=i&&d.shift(),o++;return(l=e("<div id="+u._id+'_cellstyles class="e-spreadsheet e-cellstyles" style="display:none;">'+c+"</div>")).find(".e-cellstyleheader:eq(0)").append("<span id ='"+u._id+"_cellstyles_back' class = 'e-cellstyles-back e-icon e-ss-leftarrow'/>"),l.append(t.buildTag("div.e-cellstyleheader"),t.buildTag("div.e-cellstylecell e-format6N6N2N111N1N1N1N1N",u._getLocStr("NewCellStyle"),"",{title:u._getLocStr("NewCellStyle")})),l},_homeTabTrgtElem:function(){var e=this.XLObj,i=e._id,r=e.element,l=i+"_Ribbon_",n=l+"Home_Font_";r.append(t.buildTag("input","",{display:"none"},{id:n+"FillColor",type:"text"})),r.append(t.buildTag("input","",{display:"none"},{id:n+"FontColor",type:"text"})),r.append(t.buildTag("input","",{display:"none"},{id:n+"BorderColor",type:"text"})),r.append(t.buildTag("div.e-spreadsheet e-formatastable","",{display:"none"},{id:e._id+"_formatastable"})),r.append(this._renderCellStyles()),r.append(t.buildTag("ul","",{display:"none"},{id:i+"_Ribbon_Merge"})),r.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:l+"Paste"})),r.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:l+"Border"})),r.append(t.buildTag("ul.e-spreadsheet","",{display:"none"},{id:i+"_CFormat"})),r.append(t.buildTag("ul","",{display:"none"},{id:l+"Clear"})),r.append(t.buildTag("ul","",{display:"none"},{id:l+"SortFilter"})),r.append(t.buildTag("ul","",{display:"none"},{id:l+"AutoSum"}))},_pageTabTrgtElem:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_=this.XLObj,f=_._id,b=_.element,C=f+"_Ribbon_",S=C+"PageLayout_Show_";i=_.isUndefined(i)?e("#"+f+"_Ribbon").data("ejRibbon").element:i,b.append(t.buildTag("ul","",{display:"none"},{id:C+"PageSize"})),r=t.buildTag("div","",{width:"140",height:"80",display:"none"},{id:C+"pagesetup"}),l=t.buildTag("div","",{width:"70",height:"80",float:"left"},{id:C+"pagesetupleft"}),n=t.buildTag("table"),d=t.buildTag("tr"),h=t.buildTag("tr"),s=t.buildTag("td","",{padding:"6px 0px 6px 6px"}),o=t.buildTag("td","",{padding:"6px 0px 6px 6px"}),a=t.buildTag("td","",{padding:"6px 0px 6px 6px"}),c=t.buildTag("td","",{padding:"6px 0px 6px 6px"}),u=t.buildTag("label.e-viewlinlbl","",{width:"40"},{id:C+"pagesetup_viewgrdlnlbl",for:S+"Gridlines"}),g=t.buildTag("label.e-viewhdrlbl","",{width:"40",display:"visible"},{id:C+"pagesetup_viewhdrlbl",for:S+"Headings"}),p=t.buildTag("input","","",{id:S+"Headings",type:"checkbox"}),m=t.buildTag("input","","",{id:S+"Gridlines",type:"checkbox"}),s.append(m),o.append(u),d.append(s).append(o),a.append(p),c.append(g),h.append(a).append(c),n.append(h).append(d),l.append(n),r.append(l),i.append(r)},_othersTabTrgtElem:function(){var e=this.XLObj,i=e._id,r=e.element,l=i+"_Ribbon_";r.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:l+"FPane"})),r.append(t.buildTag("ul","",{width:"auto"},{id:l+"Ins"})),r.append(t.buildTag("ul","",{width:"auto"},{id:l+"Del"})),r.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:l+"FindRep"})),r.append(t.buildTag("ul","",{display:"none"},{id:l+"CalcOpt"}))},_dataTabTrgtElem:function(){var e=this.XLObj;e.element.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:e._id+"_Ribbon_Validation"}))},_formatTabTrgtElem:function(){var e=this.XLObj;e.element.append(t.buildTag("ul","",{width:"auto",display:"none"},{id:e._id+"_Ribbon_ResetPic"}))},_onBeforeTabClick:function(e){this.XLObj.model.ribbonSettings.enableOnDemand&&this._createTrgtElement(e.activeHeader.innerText)},_onTabClick:function(e){var t=this.XLObj,i=e.activeHeader.innerText;t._trigger("beforeTabClick",e),-1!==e.prevActiveIndex&&t.model.allowComments&&t.model.allowEditing&&(t.XLEdit._isEdit||t.XLComment._isCommentEdit||t._isSheetRename||!t.getSheet(t.getActiveSheetIndex()).isSheetProtected)&&!this._isDirtySelect&&this._enableRibbonIcons(e.activeIndex),t.model.ribbonSettings.enableOnDemand&&this._createTabControls(i),t._trigger("tabClick",e)},_onCollapse:function(t){var i,r=this.XLObj,l=e.extend(!0,{},r.model.scrollSettings);r.getSheet(r.getActiveSheetIndex())._isRibCollapsed=!0,(this._ribbonState||t.isMobile)&&(r._phoneMode||(this._ribbonState=!1),t.action="toggleBtn",r._isAutoWHMode?(this._refreshBackstageHeight(),i=r._getElementDimension(),r.element.css({height:i.height,width:i.width})):r._heightWidthCalculation(r.getActiveSheetIndex(),l,t),r.model._isActPanelVisible&&r._refreshActivationPanel())},_onTabSelect:function(t){var i,r,l=this.XLObj,n=l.getSheet(l.getActiveSheetIndex());l.model.showRibbon&&(l.XLEdit._isEdit||l.model.allowComments&&l.XLComment._isCommentEdit||l._isSheetRename||n.isSheetProtected?this._disableRibbonIcons():this._enableRibbonIcons(),this._updateRibbonIcons(),l.model.isReadOnly&&l._readOnly(),l._phoneMode&&(i=e.extend(!0,{},l.model.scrollSettings),this._ribbonState=!0,t.action="toggleBtn",l.model._isActPanelVisible=this._isPanelVisible,l._isAutoWHMode?(this._refreshBackstageHeight(),r=l._getElementDimension(),l.element.css({height:r.height,width:r.width})):l._heightWidthCalculation(l.getActiveSheetIndex(),i,t))),l.XLEdit.getPropertyValue(n._activeCell.rowIndex,n._activeCell.colIndex,"tableName")&&(this._isDesignTab=t.activeIndex==this._getTabIndex("design")||t.activeIndex==this._getTabIndex("format")||t.activeIndex==this._getTabIndex("chartdesign")),l._trigger("tabSelect",t)},_valDTypeOnChange:function(t){var i=this.XLObj;e.validator&&e("#"+i._id+"_Form_ValDialog").validate().resetForm(),"Between"===t.value||"NotBetween"===t.value?(e("#"+i._id+"_Ribbon_lbMax").show(),e("#"+i._id+"_Ribbon_btnMax").show(),e("#"+i._id+"_Ribbon_lbMin").text(i._getLocStr("NumberStart"))):(e("#"+i._id+"_Ribbon_lbMax").hide(),e("#"+i._id+"_Ribbon_btnMax").hide(),e("#"+i._id+"_Ribbon_lbMin").text(i._getLocStr("DataValue"))),this._dialogValidate("_ValDialog")},_valTypeOnChange:function(t){var i=this.XLObj,r=e("#"+i._id+"_Ribbon_ddAction").data("ejDropDownList");r.enable(),"list"===t.model.dataSource[t.model.selectedItemIndex].value?(e("#"+i._id+"_Ribbon_lbMax").hide(),e("#"+i._id+"_Ribbon_btnMax").hide(),r.disable()):("Between"===r._selectedValue||"NotBetween"===r._selectedValue)&&(e("#"+i._id+"_Ribbon_lbMax").show(),e("#"+i._id+"_Ribbon_btnMax").show()),e("#"+i._id+"_Ribbon_lbMin").text(i._getLocStr(t.selectedText+"Start")),e("#"+i._id+"_Ribbon_lbMax").text(i._getLocStr(t.selectedText+"End")),this._dialogValidate("_ValDialog")},_valDlgBtnClick:function(t){var i,r,l,n,s,o,a,d=this.XLObj;if("ok"===t&&e.validator&&e("#"+d._id+"_Form_ValDialog").valid()){var h,c=e("#"+d._id+"_Ribbon_blank").data("ejCheckBox"),u=e("#"+d._id+"_Ribbon_freetext").data("ejCheckBox").isChecked(),g=e("#"+d._id+"_Ribbon_ddType").data("ejDropDownList"),p=e("#"+d._id+"_Ribbon_ddAction").data("ejDropDownList"),m=d.getCalcEngine().getNamedRanges();if("List"===g._selectedValue)if(n=l=e("#"+d._id+"_Ribbon_btnMin").val(),i=e("#"+d._id+"_alertdlg"),l.indexOf("=")>-1){if(l=l.split("=")[1],(h=m.getItem(l.toUpperCase()))&&(l=h),l.indexOf("!")>-1&&(s=l.split("!"),r=h?d._getSheetIdxFromSheetValue(s[0]):d._getSheetIndexByName(s[0]),l=s[1]),!1===r)return d._renderAlertDlgContent(i,"Alert",d._getLocStr("ListAlert"),"ListValidation"),void(d._alertDialog.element.ejDialog("open")&&i.focus());if(l.indexOf("$")>-1&&(l=l.split("$").join("")),l.indexOf(":")<0&&(l=l+":"+l),r=d.isUndefined(r)?d.getActiveSheetIndex():r,a=d.getSheet(r),o=d.getRangeIndices(l),isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||isNaN(o[3])||a.colCount<=o[3]||a.rowCount<=o[2])return d._renderAlertDlgContent(i,"Alert",d._getLocStr("ListAlert"),"ListValidation"),void(d._alertDialog.element.ejDialog("open")&&i.focus());if(o[2]!==o[0]&&o[3]!==o[1])return d._renderAlertDlgContent(i,"Alert",d._getLocStr("ListValAlert"),"ListValidation"),void(d._alertDialog.element.ejDialog("open")&&i.focus());d.XLValidate.applyDVRules(null,["list",n],this._types[g.selectedIndexValue].value,c.isChecked(),u)}else d.XLValidate.applyDVRules(null,["list",n],this._types[g.selectedIndexValue].value,c.isChecked(),u);else d.XLValidate.applyDVRules(null,[this._actions[p.selectedIndexValue].value,e("#"+d._id+"_Ribbon_btnMin").val(),e("#"+d._id+"_Ribbon_btnMax").val()],this._types[g.selectedIndexValue].value,c.isChecked(),u);d._setddlCell()}else e.validator||(t="cancel");("cancel"===t||"ok"===t&&e.validator&&e("#"+d._id+"_Form_ValDialog").valid())&&(e("#"+d._id+"_Ribbon_ddType").data("ejDropDownList").option({selectedItemIndex:0}),e("#"+d._id+"_Ribbon_ddAction").data("ejDropDownList").option({selectedItemIndex:6}),e("#"+d._id+"_Ribbon_blank").data("ejCheckBox").option({checked:!0}),e("#"+d._id+"_Ribbon_freetext").data("ejCheckBox").option({checked:!0}),e("#"+d._id+"_Ribbon_btnMin").val(""),e("#"+d._id+"_Ribbon_btnMax").val(""),e("#"+d._id+"_ValDialog").ejDialog("close"),d._setSheetFocus())},_renderValDialog:function(){var i,r,l,n,s,o,a,d,h=this.XLObj;if(e("#"+h._id+"_Ribbon_MainDiv").length<1){i=t.buildTag("div.e-dlgctndiv","",{},{height:"100%"}),r=t.buildTag("div.e-dlg-fields","",{},{id:h._id+"_Ribbon_MainDiv"}),e("#"+h._id+"_Validation").append(i),e("#"+h._id+"_Validation").append(r),n=t.buildTag("label.e-dlg-fields",h._getLocStr("Allow")),r.append(n),s=t.buildTag("input.e-"+h._id+"-ddl","","",{id:h._id+"_Ribbon_ddType",type:"text"}),r.append(s),s.ejDropDownList({dataSource:this._types,fields:{id:"Types",text:"text",value:"text"},selectedItemIndex:1,cssClass:"e-"+h._id+"-ddl",width:"100%",change:e.proxy(this._valTypeOnChange,this)});var c=t.buildTag("input#"+h._id+"_Ribbon_blank"),u=t.buildTag("label",h._getLocStr("IgnoreBlank"),{},{for:h._id+"_Ribbon_blank"}),g=t.buildTag("table.e-val-chk"),p=t.buildTag("tr"),m=t.buildTag("td","",{},{width:30});m.append(c),p.append(m),(m=t.buildTag("td")).append(u),p.append(m),g.append(p),c.ejCheckBox(),c=t.buildTag("input#"+h._id+"_Ribbon_freetext"),u=t.buildTag("label#"+h._id+"_Ribbon_lblfreetext",h._getLocStr("FreeText"),{},{for:h._id+"_Ribbon_lblfreetext"}),p=t.buildTag("tr#"+h._id+"_val_freetext"),(m=t.buildTag("td","",{},{width:30})).append(c),p.append(m),(m=t.buildTag("td")).append(u),p.append(m),g.append(p),r.append(g),c.ejCheckBox({checked:!0}),n=t.buildTag("label.e-dlg-fields").text(h._getLocStr("Data")),r.append(n),o=t.buildTag("input.e-"+h._id+"-ddl","","",{id:h._id+"_Ribbon_ddAction",type:"text"}),r.append(o),o.ejDropDownList({dataSource:this._actions,fields:{id:"Types",text:"text",value:"value"},selectedItemIndex:6,cssClass:"e-"+h._id+"-ddl",width:"100%",change:e.proxy(this._valDTypeOnChange,this)}),l=t.buildTag("div.e-dlgctndiv e-dlg-fields","",{},{id:h._id+"_Ribbon_SubDiv"}),g=t.buildTag("table"),p=t.buildTag("tr"),m=t.buildTag("td"),n=t.buildTag("label.e-dlg-fields","","",{id:h._id+"_Ribbon_lbMin"}).text(h._getLocStr("NumberStart")),g.append(p.append(m.append(n))),p=t.buildTag("tr"),m=t.buildTag("td"),a=t.buildTag("input.ejinputtext","",{width:"100%"},{id:h._id+"_Ribbon_btnMin",type:"text",name:h._id+"_valMin"}),g.append(p.append(m.append(a))),p=t.buildTag("tr"),m=t.buildTag("td"),n=t.buildTag("label.e-dlg-fields","","",{id:h._id+"_Ribbon_lbMax"}).text(h._getLocStr("NumberEnd")),g.append(p.append(m.append(n))),p=t.buildTag("tr"),m=t.buildTag("td"),d=t.buildTag("input.ejinputtext","",{width:"100%"},{id:h._id+"_Ribbon_btnMax",type:"text",name:h._id+"_valMax"}),g.append(p.append(m.append(d))),i.append(r,l.append(g)),e("#"+h._id+"_Ribbon_SubDiv").wrapInner('<form id="'+h._id+'_Form_ValDialog" onsubmit="return false"></form>')}},_dialogValidate:function(t,i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=this.XLObj,C=b._id,S=e("#"+C+"_Form"+t);if(e.validator){switch(S.validate({errorElement:"div",wrapper:"div",errorPlacement:function(e,t){e.insertAfter(t.closest("input")),e.children().addClass("e-dlg-field-validation-error"),e.css({position:"relative"}),e.offset({left:t.offset().left,top:t.offset().top+19})},onfocusout:function(e){this.element(e)}}),p=e("#"+C+"_Ribbon_ddAction").ejDropDownList("getValue"),t){case"_ValDialog":r=e("#"+C+"_Ribbon_ddType").data("ejDropDownList").getSelectedValue();break;case"_CFDialog":r=i===C+"_CreateRule"?"formulaRule":i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();break;case"_GoToDiv":case"_Ribbon_PvtRange":case"_Ribbon_PvtLocation":case"_Ribbon_SparklineRange":case"_Ribbon_SparklineLocation":case"_datarange":case"_Ribbon_cellAddress":r="cellAddr";break;case"_xlFileName":case"_Ribbon_webAddress":r="webAddr"}for(e("#"+C+"_Form"+t).validate().resetForm(),h=[],d=e("#"+C+"_Form"+t).find("input").length,a={required:!0,date:!0,messages:{date:b._getLocStr("DateValidationMsg"),required:b._getLocStr("RequiredField")}},s={required:!0,celladdr:!0},c={required:!0,numberVal:!0},_={required:!0,number:!0,messages:{required:b._getLocStr("RequiredField"),number:b._getLocStr("NumberValidationMsg")}},u={required:!0,time:!0},o={required:!0},m={required:!0,betweentype:!0},f={required:!0,formularule:!0},e.validator.addMethod("time",function(e){return""===e||e.match(/^(([0-1]?[0-9])|([2][0-3])):([0-5]?[0-9])(:([0-5]?[0-9]))?(\s(AM|am|PM|pm))?$/)},b._getLocStr("TimeValidationMsg")),e.validator.addMethod("date",function(e,t){var i=e.split("/");return this.optional(t)||!/Invalid|NaN/.test(new Date(/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())?e:i[1]+"/"+i[0]+"/"+i[2]))},b._getLocStr("DateValidationMsg")),e.validator.addMethod("celladdr",function(t,i){var r,l,n,s=e(i).data("parentID"),o=e("#"+s).data("ejSpreadsheet"),a=!0;return e("#"+o._id+"_Ribbon_sheentName").length&&(l=e("#"+o._id+"_Ribbon_sheentName").ejTreeView("option","selectedNode")),(o.isUndefined(l)||l<0)&&(l=o.getActiveSheetIndex()),t.indexOf("=")>-1&&(t=t.split("=")[1]),t.indexOf("!")>-1&&(g=t.split("!"),l=o._getSheetIndexByName(g[0]),t=g[1]),l<1&&(a=!1),n=o.getSheet(l),t.indexOf("$")>-1&&(t=t.split("$").join("")),r=o.getRangeIndices(t),r=n.colCount<=r[3]||n.rowCount<=r[2]?null:t,(t.match(/^(?:\bxfXF[a-zA-D]|xX[a-eA-E][a-zA-Z]|[a-wA-W][a-zA-Z]{2}|[a-zA-Z]{2}|[a-zA-Z])\$?(?:104857[0-6]|10485[0-6]\d|1048[0-4]\d{2}|104[0-7]\d{3}|10[0-3]\d{4}|[1-9]\d{1,5}|[1-9]):(?:\bxfXF[a-zA-D]|xX[a-eA-E][a-zA-Z]|[a-wA-W][a-zA-Z]{2}|[a-zA-Z]{2}|[a-zA-Z])\$?(?:104857[0-6]|10485[0-6]\d|1048[0-4]\d{2}|104[0-7]\d{3}|10[0-3]\d{4}|[1-9]\d{1,5}|[1-9])$/)||t.match(/^(?:\bxfXF[a-zA-D]|xX[a-eA-E][a-zA-Z]|[a-wA-W][a-zA-Z]{2}|[a-zA-Z]{2}|[a-zA-Z])\$?(?:104857[0-6]|10485[0-6]\d|1048[0-4]\d{2}|104[0-7]\d{3}|10[0-3]\d{4}|[1-9]\d{1,5}|[1-9])$/)&&a)&&r},b._getLocStr("CellAddrsValidationMsg")),e.validator.addMethod("betweentype",function(t,i){var r=i.id.split("_")[0],l=e("#"+i.id.split("_")[0]+"_Ribbon_ddType").ejDropDownList("getSelectedValue"),n=e("#"+r+"_Ribbon_btnMin").val(),s=e("#"+i.id.split("_")[0]+"_Ribbon_btnMax").val();return(""===n||""===s||parseFloat(n)>parseFloat(s))&&(t=null),"Date"===l&&Date.parse(n)>Date.parse(s)&&(t=null),"Time"===l&&new Date("01/01/1990 "+n).getTime()>new Date("01/01/1990 "+s).getTime()&&(t=null),t},b._getLocStr("BetweenAlert")),e.validator.addMethod("numberVal",function(t){if(e.isNumeric(t))return parseFloat(t)%1!=0&&(t=null),e.validator.messages.numberVal=b._getLocStr("NumberValMsg"),t;e.validator.messages.numberVal=b._getLocStr("NumberAlertMsg")},e.validator.messages.numberVal),e.validator.addMethod("formularule",function(e){return""===e||e.startsWith("=")&&e.indexOf("!")<0},b._getLocStr("FormulaRuleMsg")),l=0,n=d;l<n;l++){switch(h[l]=e("#"+C+"_Form"+t).find("input")[l].id,r){case"Date":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",a);break;case"Time":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",u);break;case"Number":case"TextLength":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",c);break;case"Decimal":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",_);break;case"List":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",o);break;case"cellAddr":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",s);break;case"webAddr":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",o);break;case"formulaRule":e("#"+h[l]).rules("remove"),e("#"+h[l]).rules("add",f)}"List"!==r&&("Between"===p||"NotBetween"===p)&&e("#"+C+"_Ribbon_btnMax").rules("add",m)}}},_renderCFDialog:function(i){var r,l,n,s,o,a,d=this.XLObj;o=e("#"+d._id+"_CFDialog").data("ejDialog"),i.ID===d._id+"_CreateRule"?o.option({title:d._getLocStr("NewRule")}):o.option({title:d._getLocStr(this._cFormatData[i.ID][0])}),e("#"+d._id+"_Ribbon_CFSubDiv").length<1&&(l=t.buildTag("div.e-dlg-fields","",{},{id:d._id+"_Ribbon_CFSubDiv"}),n=t.buildTag("label.e-dlg-fields").text(d._getLocStr("With")),l.append(n),a=t.buildTag("input.e-"+d._id+"-ddl","",{},{id:d._id+"_Ribbon_ddStyle",type:"text"}),l.append(a),a.ejDropDownList({dataSource:this._styles,fields:{id:"Types",text:"text",value:"value"},selectedItemIndex:0,cssClass:"e-"+d._id+"-ddl",width:"100%",change:e.proxy(this._ddOnChange,this)}),e("#"+d._id+"_CondFormat").append(l),e("#"+d._id+"_CondFormat").addClass("e-cfdiv")),e("#"+d._id+"_Ribbon_CFMainDiv").length>0&&e("#"+d._id+"_Ribbon_CFMainDiv").remove(),r=t.buildTag("div.e-dlg-fields","","",{id:d._id+"_Ribbon_CFMainDiv"}),e("#"+d._id+"_CondFormat").prepend(r),"between"==i.ID&&(s=t.buildTag("input.ejinputtext","",{},{id:d._id+"_Ribbon_input2",type:"text"}),r.prepend(s),n=t.buildTag("label.e-dlg-fields").text(d._getLocStr("And")).css("display","table"),r.prepend(n)),s=t.buildTag("input.ejinputtext","",{},{id:d._id+"_Ribbon_input1",type:"text"}),r.prepend(s),n=i.ID===d._id+"_CreateRule"?t.buildTag("label.e-dlg-fields").text(d._getLocStr("NewRuleLabelContent")):t.buildTag("label.e-dlg-fields").text(d._getLocStr(this._cFormatData[i.ID][1])),r.prepend(n),("aboveavg"===i.ID||"belowavg"===i.ID)&&s.hide(),e("#"+d._id+"_Ribbon_CFMainDiv").wrapInner('<form id="'+d._id+'_Form_CFDialog" onsubmit="return false"></form>'),this._dialogValidate("_CFDialog",i.ID)},_dlgCFOk:function(){var t,i,r=this.XLObj;e("#"+r._id+"_Form_CFDialog").valid()&&(t=e("#"+r._id+"_Ribbon_ddStyle").data("ejDropDownList"),i=r.XLRibbon._currentCFormat===r._id+"_CreateRule"?"formularule":r.XLRibbon._currentCFormat,r.XLCFormat._cFormat(i,e("#"+r._id+"_Ribbon_input1").val(),e("#"+r._id+"_Ribbon_input2").val(),t.getSelectedValue()),e("#"+r._id+"_CFDialog").ejDialog("close"),r._setSheetFocus())},_dlgCFCancel:function(){var t=this.XLObj;e("#"+t._id+"_Form_CFDialog").validate().resetForm(),e("#"+t._id+"_CFDialog").ejDialog("close"),t._setSheetFocus()},_sheetData:function(){var e,t,i=this.XLObj,r=[],l=[],n=i._getSheetNames();for(l[0]={id:1,name:i._getLocStr("SheetReference"),hasChild:!0,expanded:!0},e=1,t=n.length;e<=t;e++)n[e-1].isVisible&&(r[e]=n[e-1].text,l[e]={id:e+1,pid:1,name:r[e],hasChild:!0,expanded:!0});return l},_renderHLDialog:function(){var i,r,l,n,s,o,a,d,h,c,u=this.XLObj;e("#"+u._id+"_Ribbon_WebDiv").length<1&&(i=t.buildTag("div.e-dlgctndiv","",{},{id:u._id+"_Ribbon_WebDiv"}),a=t.buildTag("table","",{},{cellpadding:0,cellspacing:0}),d=t.buildTag("tr"),c=t.buildTag("td","",{width:"32%"}),a.append(d.append(c)),r=t.buildTag("label",u._getLocStr("HyperlinkText")),c.append(r),c=t.buildTag("td"),l=t.buildTag("input.ejinputtext","",{},{id:u._id+"_Ribbon_findText",type:"text"}),d.append(c.append(l)),d=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td"),a.append(d.append(c)),r=t.buildTag("label",u._getLocStr("WebAddress"),"",{id:u._id+"_Ribbon_address"}),c.append(r),c=t.buildTag("td"),l=t.buildTag("input.ejinputtext","",{},{id:u._id+"_Ribbon_webAddress",type:"text"}),d.append(c.append(l)),e("#"+u._id+"_Web").append(i.append(a)),n=t.buildTag("div.e-dlgctndiv","","",{id:u._id+"_Ribbon_DocDiv"}),h=t.buildTag("div.e-dlg-fields"),a=t.buildTag("table"),d=t.buildTag("tr"),c=t.buildTag("td","",{width:"32%"}),a.append(d.append(c)),r=t.buildTag("label",u._getLocStr("HyperlinkText")),c.append(r),c=t.buildTag("td"),l=t.buildTag("input.ejinputtext","",{},{id:u._id+"_Ribbon_cellText",type:"text"}),d.append(c.append(l)),d=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td"),a.append(d.append(c)),r=t.buildTag("label",u._getLocStr("CellAddress")),c.append(r),c=t.buildTag("td"),(l=t.buildTag("input.ejinputtext","",{},{id:u._id+"_Ribbon_cellAddress",type:"text"})).data("parentID",u._id),d.append(c.append(l)),o=t.buildTag("div.e-dlg-fields","","",{id:u._id+"_Ribbon_Sheet"}),n.append(h.append(a),o),r=t.buildTag("label",u._getLocStr("SheetIndex")),o.append(r),s=t.buildTag("div","","",{id:u._id+"_Ribbon_sheentName"}),o.append(s),s.ejTreeView({fields:{id:"id",parentId:"pid",text:"name",hasChild:"hasChild",dataSource:this._sheetData(),expanded:"expanded"},nodeSelect:e.proxy(this._sheetSelect,u),height:90}),e("#"+u._id+"_Doc").append(n),e("#"+u._id+"_Ribbon_cellAddress").wrap("<form id='"+u._id+"_Form_Ribbon_cellAddress' onsubmit='return false'></form>"),this._dialogValidate("_Ribbon_cellAddress"),e("#"+u._id+"_Ribbon_webAddress").wrap("<form id='"+u._id+"_Form_Ribbon_webAddress' onsubmit='return false'></form>"),this._dialogValidate("_Ribbon_webAddress"))},_sheetSelect:function(t){var i,r,l=this._getSheetNames(),n=e("#"+this._id+"_Ribbon_cellAddress"),s=e("#"+this._id+"hlDialog_OkBtn").data("ejButton"),o=e("#"+this._id+"_Ribbon_cellText");if(t.model.selectedNode>0)for(n.attr("disabled",!1),s.enable(),n.focus().setInputPos(1),i=0,r=l.length;i<r;i++)l[i].text===o.val().split("!")[0]&&o.val(t.value+"!"+n.val());else n.attr("disabled",!0),s.disable()},_dlgHLOk:function(){var t=this.XLObj;e("#"+t._id+"_Form_Ribbon_cellAddress").valid()&&e("#"+t._id+"_Form_Ribbon_webAddress").valid()&&(this.XLObj._dlgHLClick=!0,t._setLink(),this._dlgHLCancel())},_dlgHLCancel:function(){e("#"+this.XLObj._id+"_HLDialog").ejDialog("close")},_renderFRDialog:function(){var i,r,l,n,s,o,a,d,h,c,u=this.XLObj;e("#"+u._id+"_Ribbon_FindDiv").length<1&&(i=t.buildTag("div.e-dlgctndiv e-ss-finddiv","",{height:"auto"},{id:u._id+"_Ribbon_FindDiv"}),e("#"+u._id+"_Find").append(i),d=t.buildTag("table"),h=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td","",{width:"30%"}),d.append(h.append(c)),r=t.buildTag("label",u._getLocStr("FindLabel"),"",{id:u._id+"_Ribbon_lbFind"}),c.append(r),c=t.buildTag("td"),l=t.buildTag("input.ejinputtext","","",{id:u._id+"_Ribbon_textFind",type:"text"}),c.append(l),h.append(c),h=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td"),d.append(h.append(c)),r=t.buildTag("label",u._getLocStr("ReplaceLabel"),"",{id:u._id+"_Ribbon_lbReplace"}),c.append(r),c=t.buildTag("td"),n=t.buildTag("input.ejinputtext","","",{id:u._id+"_Ribbon_textReplace",type:"text"}),c.append(n),h.append(c),i.append(d),e("#"+u._id+"_Ribbon_lbReplace").hide(),e("#"+u._id+"_Ribbon_textReplace").hide(),a=t.buildTag("div.e-dlgctndiv e-ss-stgdiv","",{},{id:u._id+"_Ribbon_SettingsDiv"}),d=t.buildTag("table"),h=t.buildTag("tr"),c=t.buildTag("td","",{width:"50%"}),d.append(h.append(c)),s=t.buildTag("input#"+u._id+"_Ribbon_Case"),r=t.buildTag("label",u._getLocStr("MatchCase"),{},{for:u._id+"_Ribbon_Case"}),c.append(s),c.append(r),s.ejCheckBox(),c=t.buildTag("td"),s=t.buildTag("input#"+u._id+"_Ribbon_AllContent"),r=t.buildTag("label",u._getLocStr("MatchAll"),{},{for:u._id+"_Ribbon_AllContent"}),c.append(s),s.ejCheckBox(),c.append(r),h.append(c),h=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td"),d.append(h.append(c)),r=t.buildTag("label").text(u._getLocStr("Within")),c.append(r),c=t.buildTag("td"),r=t.buildTag("label").text(u._getLocStr("Search")),c.append(r),h.append(c),h=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td"),d.append(h.append(c)),o=t.buildTag("input","","",{id:u._id+"_Ribbon_ddWithin",type:"text"}),c.append(o),o.ejDropDownList(u._generateEJDD(this._within,{id:"Types",text:"text",value:"value"},0,110,25)),c=t.buildTag("td"),o=t.buildTag("input","","",{id:u._id+"_Ribbon_ddSearch",type:"text"}),c.append(o),o.ejDropDownList(u._generateEJDD(this._sType,{id:"Types",text:"text",value:"value"},0,120,25)),h.append(c),h=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td"),d.append(h.append(c)),r=t.buildTag("label",u._getLocStr("Lookin")),c.append(r),c=t.buildTag("td"),r=t.buildTag("label",u._getLocStr("Replace")+" "+u._getLocStr("Direction")),h.append(c.append(r)),h=t.buildTag("tr.e-dlgtd-fields"),c=t.buildTag("td"),d.append(h.append(c)),o=t.buildTag("input","","",{id:u._id+"_Ribbon_ddLookin",type:"text"}),c.append(o),o.ejDropDownList(u._generateEJDD(this._vType,{id:"Types",text:"text",value:"value"},0,110,25,"Type")),c=t.buildTag("td"),o=t.buildTag("input","","",{id:u._id+"_Ribbon_ddDirection",type:"text"}),h.append(c.append(o)),o.ejDropDownList(u._generateEJDD(this._direction,{id:"Types",text:"text",value:"value"},0,120,25)),e("#"+u._id+"_Settings").append(a.append(d)))},_frTypeChange:function(t,i){"Type"===t&&"comment"===i.value?(e("#"+this._id+"_Ribbon_textReplace").attr("disabled",!0),e("#"+this._id+"FR_ReplaceBtn").ejButton("disable"),e("#"+this._id+"FR_ReplaceAllBtn").ejButton("disable")):(e("#"+this._id+"_Ribbon_textReplace").prop("disabled",!1),e("#"+this._id+"FR_ReplaceBtn").ejButton("enable"),e("#"+this._id+"FR_ReplaceAllBtn").ejButton("enable"))},_hlTabChange:function(t){var i=this.XLObj,r=e("#"+i._id+"_Ribbon_sheentName").data("ejTreeView"),l=i.getActiveSheetIndex(),n=e("#"+i._id+"_Doc"),s=e("#"+i._id+"_Web"),o=e("#"+i._id+"_Ribbon_webAddress"),a=e("#"+i._id+"_Ribbon_findText"),d=e("#"+i._id+"_Ribbon_cellAddress"),h=e("#"+i._id+"_Ribbon_cellText"),c=i.getActiveCell(l),u=i.XLEdit.getPropertyValue(c.rowIndex,c.colIndex,"hyperlink",l);switch(t.activeIndex){case 0:o.focus().setInputPos(o.val().length),a.val(h.val()),n.hide(),s.show(),e("#"+i._id+"hlDialog_OkBtn").ejButton("enable");break;case 1:d.val().length||d.val("A1"),n.show(),s.hide(),u&&u.cellAddr&&(l=parseInt(u.cellAddr.split("_")[1])),r.selectNode(l+1),a.val().length?h.val(a.val()):h.val(r.getText(l+1)+"!A1"),d.focus().setInputPos(d.val().length)}},_findTabChange:function(t){var i,r=this.XLObj;switch(t.activeIndex){case 0:i=e("#"+r._id+"_Ribbon_FindDiv"),e("#"+r._id+"_Ribbon_lbReplace").hide(),e("#"+r._id+"_Ribbon_textReplace").hide(),e("#"+r._id+"FR_ReplaceBtn").css("visibility","hidden"),e("#"+r._id+"FR_ReplaceAllBtn").css("visibility","hidden"),e("#"+r._id+"_Find").append(i),e("#"+r._id+"FR_PrevBtn").show(),e("#"+r._id+"FR_NextBtn").show(),e("#"+r._id+"_Ribbon_textFind").focus().setInputPos(e("#"+r._id+"_Ribbon_textFind").val().length),r._phoneMode?(e("#"+r._id+"FR_ReplaceBtn").hide(),e("#"+r._id+"FR_ReplaceAllBtn").hide()):(e("#"+r._id+"FR_ReplaceBtn").show(),e("#"+r._id+"FR_ReplaceAllBtn").show());break;case 1:i=e("#"+r._id+"_Ribbon_FindDiv"),e("#"+r._id+"_Ribbon_lbReplace").show(),e("#"+r._id+"_Ribbon_textReplace").show(),e("#"+r._id+"FR_ReplaceBtn").css("visibility","visible").show(),e("#"+r._id+"FR_ReplaceAllBtn").css("visibility","visible").show(),r._phoneMode?(e("#"+r._id+"FR_PrevBtn").hide(),e("#"+r._id+"FR_NextBtn").hide()):(e("#"+r._id+"FR_PrevBtn").show(),e("#"+r._id+"FR_NextBtn").show()),e("#"+r._id+"_Replace").append(i),e("#"+r._id+"_Ribbon_textFind").focus().setInputPos(e("#"+r._id+"_Ribbon_textFind").val().length);break;case 2:e("#"+r._id+"FR_PrevBtn").hide(),e("#"+r._id+"FR_NextBtn").hide(),e("#"+r._id+"FR_ReplaceBtn").css("visibility","hidden"),e("#"+r._id+"FR_ReplaceAllBtn").css("visibility","hidden"),e("#"+r._id+"_Ribbon_ddWithin").focus(),r._phoneMode?e("#"+r._id+"_Ribbon_SettingsDiv").find("td:eq(1)").hide():e("#"+r._id+"_Ribbon_SettingsDiv").find("td:eq(1)").show()}},_gotoTabChange:function(t){var i=this.XLObj;0==t.activeIndex&&e("#"+i._id+"_textRef").focus().setInputPos(e("#"+i._id+"_textRef").val().length)},_btnFROnClick:function(t){var i=this.XLObj;i.showWaitingPopUp();var r=i.getActiveSheetIndex(),l=i.getSheet(r)._startCell.rowIndex,n=i.getSheet(r)._startCell.colIndex,s=e("#"+i._id+"_Ribbon_Case").data("ejCheckBox").isChecked(),o=e("#"+i._id+"_Ribbon_AllContent").data("ejCheckBox").isChecked(),a=this._within[e("#"+i._id+"_Ribbon_ddWithin").data("ejDropDownList").selectedIndexValue].value,d=this._sType[e("#"+i._id+"_Ribbon_ddSearch").data("ejDropDownList").selectedIndexValue].value,h=this._vType[e("#"+i._id+"_Ribbon_ddLookin").data("ejDropDownList").selectedIndexValue].value,c=this._direction[e("#"+i._id+"_Ribbon_ddDirection").data("ejDropDownList").selectedIndexValue].value;switch(t){case"FR_NextBtn":case"FR_PrevBtn":i.XLSearch._findCount=0,("FR_NextBtn"===t?i.XLSearch._findNext(e("#"+i._id+"_Ribbon_textFind").val(),r,s,o,h,a,d):i.XLSearch._findPrev(e("#"+i._id+"_Ribbon_textFind").val(),r,s,o,h,a,d))||(i.XLSearch._updateSelection(l,n,r),i.hideWaitingPopUp(),i._showAlertDlg("Alert","NotFound"));break;case"FR_ReplaceBtn":i.XLSearch._replaceData(e("#"+i._id+"_Ribbon_textFind").val(),e("#"+i._id+"_Ribbon_textReplace").val(),r,s,o,h,c,a,d);break;case"FR_ReplaceAllBtn":i.XLSearch._replaceAllData(e("#"+i._id+"_Ribbon_textFind").val(),e("#"+i._id+"_Ribbon_textReplace").val(),s,o,h,a);break;case"FR_CloseBtn":e("#"+i._id+"_FRDialog").ejDialog("close"),i._setSheetFocus()}i.hideWaitingPopUp()},_renderGoToDialog:function(){var i,r,l,n,s,o,a=this.XLObj;e("#"+a._id+"_GoToDlgTab").ejTab({width:"100%",itemActive:t.proxy(this._gotoTabChange,this),cssClass:"e-ss-dlgtab"}),e("#"+a._id+"_GoToDiv").length<1&&(i=t.buildTag("div.e-dlgctndiv","",{},{id:a._id+"_GoToDiv"}),e("#"+a._id+"_GoTo").append(i),o=t.buildTag("div.e-dlg-fields"),l=t.buildTag("label.e-dlg-fields",a._getLocStr("GoToName")),n=t.buildTag("ul#"+a._id+"_GotoAddr"),i.append(o.append(l,n)),e("#"+a._id+"_GotoAddr").ejListBox({dataSource:this._addrList,height:"120",width:"100%",selected:e.proxy(this._gotoValChange,this),fields:{id:"Types",text:"text",value:"value"}}),o=t.buildTag("div.e-dlg-fields"),l=t.buildTag("label.e-dlg-fields",a._getLocStr("Reference")),(s=t.buildTag("input.ejinputtext","","",{id:a._id+"_textRef",type:"text"})).data("parentID",a._id),i.append(o.append(l,s)),r=t.buildTag("div#"+a._id+"_GoToSpDiv.e-dlgctndiv e-ss-gotosp-content","",""),o=t.buildTag("div.e-dlg-fields e-dlgctndiv"),e("#"+a._id+"_GoToSp").append(r.append(o)),e("#"+a._id+"_GoToSp").css({overflow:"auto",height:"auto"}),l=t.buildTag("label.e-dlg-fields").text(a._getLocStr("Select")).css("display","table"),o.append(l),this._renderGotoSp(o,this._gotoRBtnSet1,this._gotoRBtnSet2,this._gotoChkBox),e("#"+a._id+"_GoDialog").ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,width:"auto",allowKeyboardNavigation:!1,title:a._getLocStr("GoTo"),cssClass:"e-ss-dialog e-ss-gotodlg e-ss-mattab e-"+a._id+"-dlg",close:t.proxy(this._dialogClose,this),open:t.proxy(function(){var t=e("#"+a._id+"_textRef");t.focus().setInputPos(t.val().length)})}),e("#"+a._id+"_GoToDiv").wrapInner('<form id="'+a._id+'_Form_GoToDiv" onsubmit="return false"></form>'),this._dialogValidate("_GoToDiv"))},_renderGotoSp:function(i,r,l,n){for(var s,o,a,d,h,c=this.XLObj,u=c._id+"_gotoSpDiv",g=t.buildTag("table"),p=0;p<r.length;p++)a=t.buildTag("tr","",{height:35}),d=t.buildTag("td"),s=t.buildTag("input#"+u+"_"+r[p],"",{},{type:"radio",name:"gotospecial"}),d.append(s),a.append(d),s.ejRadioButton({size:"medium",change:e.proxy(this._rBtnOnClick,this,r[p])}),d=t.buildTag("td","",{width:100}),o=t.buildTag("label",c._getLocStr(r[p]),{},{for:u+"_"+r[p]}),d.append(o),a.append(d),c.isUndefined(l[p])||(d=t.buildTag("td"),s=t.buildTag("input#"+u+"_"+l[p],"",{},{type:"radio",name:"gotospecial"}),d.append(s),a.append(d),s.ejRadioButton({size:"medium",change:e.proxy(this._rBtnOnClick,this,l[p])}),d=t.buildTag("td"),o=t.buildTag("label",c._getLocStr(l[p]),{},{for:u+"_"+l[p]}),d.append(o),a.append(d)),g.append(a);for(p=0;p<n.length;p+=2)a=t.buildTag("tr.e-ss-gotosp-chk"),d=t.buildTag("td"),h=t.buildTag("input#"+c._id+"_"+n[p]),d.append(h),a.append(d),d=t.buildTag("td"),o=t.buildTag("label",c._getLocStr(n[p]),{},{for:c._id+"_"+n[p]}),d.append(o),a.append(d),h.ejCheckBox({checked:!0,enabled:!1}),d=t.buildTag("td"),h=t.buildTag("input#"+c._id+"_"+n[p+1]),d.append(h),a.append(d),d=t.buildTag("td"),o=t.buildTag("label",c._getLocStr(n[p+1]),{},{for:c._id+"_"+n[p+1]}),d.append(o),a.append(d),h.ejCheckBox({checked:!0,enabled:!1}),g.append(a);i.append(g),e("#"+u+"_Blanks").ejRadioButton("option",{checked:!0})},_renderPvtDialog:function(){var i,r,l,n,s,o,a=this.XLObj;e("#"+a._id+"_Ribbon_PvtDiv").length<1&&(i=t.buildTag("div.e-dlgctndiv","",{},{id:a._id+"_Ribbon_PvtDiv"}),l=t.buildTag("table","",{},{cellpadding:0,cellspacing:0}),n=t.buildTag("tr.e-ss-changerange"),s=t.buildTag("td",""),r=t.buildTag("label",a._getLocStr("Range")),s.append(r),n.append(s),s=t.buildTag("td",""),(o=t.buildTag("input.ejinputtext","",{},{id:a._id+"_Ribbon_PvtRange",type:"text"})).data("parentID",a._id),n.append(s.append(o)),l.append(n),n=t.buildTag("tr.e-ss-movepvttbl"),s=t.buildTag("td"),r=t.buildTag("label",a._getLocStr("ChoosePivotTable")),s.append(r),s.attr("colspan",2),l.append(n.append(s)),n=t.buildTag("tr.e-ss-movepvttbl"),(s=t.buildTag("td")).attr("colspan",2),o=t.buildTag("input#"+a._id+"_dlg_newsheet","",{},{type:"radio",name:"sheet"}),s.append(o),r=t.buildTag("label"," "+a._getLocStr("NewWorksheet")),s.append(r),l.append(n.append(s)),o.ejRadioButton({size:"medium",checked:!0,change:e.proxy(this._rBtnPvtOnClick,this,"new")}),n=t.buildTag("tr.e-ss-movepvttbl"),(s=t.buildTag("td")).attr("colspan",2),o=t.buildTag("input#"+a._id+"_dlg_existsheet","",{},{type:"radio",name:"sheet"}),s.append(o),r=t.buildTag("label"," "+a._getLocStr("ExistingWorksheet")),s.append(r),l.append(n.append(s)),o.ejRadioButton({size:"medium",change:e.proxy(this._rBtnPvtOnClick,this,"existing")}),n=t.buildTag("tr.e-ss-movepvttbl"),s=t.buildTag("td"),r=t.buildTag("label",a._getLocStr("Location")),s.append(r),n.append(s),s=t.buildTag("td"),(o=t.buildTag("input.ejinputtext","",{},{id:a._id+"_Ribbon_PvtLocation",type:"text"})).data("parentID",a._id),n.append(s.append(o)),l.append(n),e("#"+a._id+"_Pivot").append(i.append(l)),e("#"+a._id+"_Ribbon_PvtLocation").wrap("<form id='"+a._id+"_Form_Ribbon_PvtLocation' onsubmit='return false'></form>").prop("disabled",!0),this._dialogValidate("_Ribbon_PvtLocation"),e("#"+a._id+"_Ribbon_PvtRange").wrap("<form id='"+a._id+"_Form_Ribbon_PvtRange' onsubmit='return false'></form>"),this._dialogValidate("_Ribbon_PvtRange"))},_dlgPvtOk:function(){var t,i=this.XLObj,r=e("#"+i._id+"_PvtDialog");e("#"+i._id+"_Form_Ribbon_PvtRange").valid()&&e("#"+i._id+"_Form_Ribbon_PvtLocation").valid()&&((t=i.XLPivot._checkRange(e("#"+i._id+"_Ribbon_PvtRange").val(),e("#"+i._id+"_Ribbon_PvtLocation").val())).isRows?i._showAlertDlg("Alert","PivotRowsAlert","",450):t.isHeader?i._showAlertDlg("Alert","PivotLabelsAlert","",550):t.isOverlap?i._showAlertDlg("Alert","PivotOverlapAlert","",450):(e("#"+i._id+"_PvtDialog").ejDialog("close"),r.find(".e-ss-changerange:visible").length&&r.find(".e-ss-movepvttbl:visible").length?i.XLPivot.createPivotTable(e("#"+i._id+"_Ribbon_PvtRange").val(),e("#"+i._id+"_Ribbon_PvtLocation").val(),null):r.find(".e-ss-changerange:visible").length?i.XLPivot._changeDataSource():i.XLPivot._movePivotTable()))},_dlgPvtCancel:function(){var t=this.XLObj;e("#"+t._id+"_PvtDialog").ejDialog("close"),t._setSheetFocus()},_rBtnPvtOnClick:function(t){var i=this.XLObj,r=e("#"+i._id+"_Ribbon_PvtRange"),l=e("#"+i._id+"_Ribbon_PvtLocation");l.prop("disabled","new"===t),"new"===t?(r.focus().setInputPos(r.val().length),e("#"+this.XLObj._id+"_Form_Ribbon_PvtLocation").validate().resetForm()):l.setInputPos(l.val().length)},_rBtnOnClick:function(t){var i,r=this.XLObj;if("Formulas"===t||"Constants"===t)for(i=0;i<this._gotoChkBox.length;i++)e("#"+r._id+"_"+this._gotoChkBox[i]).data("ejCheckBox").option({enabled:!0});else for(i=0;i<this._gotoChkBox.length;i++)e("#"+r._id+"_"+this._gotoChkBox[i]).data("ejCheckBox").option({enabled:!1})},_gotoValChange:function(t){e("#"+this.XLObj._id+"_textRef").val(t.model.value)},_getAddrFromDollarAddr:function(e){var t,i;return e.indexOf("!")>-1&&(i=e.split("!"),t=this.XLObj._getSheetIndexByName(i[0]),e=i[1]),e.indexOf("$")>-1&&(e=e.split("$").join("")),e.indexOf(":")<0&&(e=e+":"+e),[t,e=e.replace("=","")]},_gotoBtnClick:function(t){var i=this.XLObj;switch(t){case"ok":e("#"+i._id+"_Form_GoToDiv").valid()&&(e("#"+i._id+"_GoToDlgTab").data("ejTab").model.selectedItemIndex?i.XLSearch._applyGoToRule(e("#"+i._id+"_GoToSpDiv").find(".e-circle_01").parents("div")[0].id.split("ej"+i._id+"_gotoSpDiv_")[1].toLowerCase(),e("#"+i._id+"_"+this._gotoChkBox[0]).data("ejCheckBox").isChecked(),e("#"+i._id+"_"+this._gotoChkBox[1]).data("ejCheckBox").isChecked(),e("#"+i._id+"_"+this._gotoChkBox[2]).data("ejCheckBox").isChecked(),e("#"+i._id+"_"+this._gotoChkBox[3]).data("ejCheckBox").isChecked()):i.XLSearch.goTo(e.trim(e("#"+i._id+"_textRef").val().toString())),e("#"+i._id+"_GoDialog").ejDialog("close"));break;case"cancel":e.validator&&e("#"+i._id+"_Form_GoToDiv").validate().resetForm(),e("#"+i._id+"_GoDialog").ejDialog("close")}i._setSheetFocus()},_borderPicture:function(){var e=this.XLObj;return"<ul id="+e._id+"_Ribbon_PictureBorder style='display:none' class='e-ss-pictureborder'><li id='"+e._id+"picturecolor'><a>"+e._getLocStr("ThemeColor")+"</a><ul><li><input id='"+e._id+"_Ribbon_PictureColor'></input></li></ul></li><li id='nooutline' class='picturecolor'><a>"+e._getLocStr("NoOutline")+"</a></li><li id='weight' class='picturecolor'><a>"+e._getLocStr("Weight")+"</a><ul><li id='1px'><a>1px</a></li><li id='2px'><a>2px</a></li><li id='3px'><a>3px</a></li></ul></li><li id='dashes' class='picturecolor'><a>"+e._getLocStr("Dashes")+"</a><ul><li id='solid'><a><div style='border:2px solid black'></div></a></li><li id='dotted'><a><div style='border:2px dotted black'></div></a></li><li id='dashed'><a><div style='border:2px dashed black'></div></a></li></ul></li></ul>"},_chartElementTag:function(){var e=this.XLObj,t="<ul id="+e._id+'_Ribbon_CElement class="e-spreadsheet" style="display:none">';return t+='<li class="axes" id="Axes"><a><span class="e-ss-chartimg e-icon e-ss-axes"></span>'+e._getLocStr("Axes")+'</a><ul><li class="phaxis e-ss-cmenuitem" id="PHAxis"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-phaxis"></span>'+e._getLocStr("PHAxis")+'</a></li><li class="pvaxis e-ss-cmenuitem" id="PVAxis"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pvaxis"></span>'+e._getLocStr("PVAxis")+"</a></li></ul></li>",t+='<li class="axistitle" id="AxisTitle"><a><span class="e-ss-chartimg e-icon e-ss-axistitle"></span>'+e._getLocStr("AxisTitle")+'</a><ul><li class="phaxistitle e-ss-cmenuitem" id="PHAxisTitle"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-phaxistitle"></span>'+e._getLocStr("PHAxis")+'</a></li><li class="pvaxistitle e-ss-cmenuitem" id="PVAxisTitle"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pvaxistitle"></span>'+e._getLocStr("PVAxis")+"</a></li></ul></li>",t+='<li class="charttitle" id="ChartTitle"><a><span class="e-ss-chartimg e-icon e-ss-charttitle"></span>'+e._getLocStr("ChartTitle")+'</a><ul><li class="ctnone e-ss-cmenuitem" id="CTNone"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctnone"></span>'+e._getLocStr("CTNone")+'</a></li><li class="ctcenter e-ss-cmenuitem" id="CTCenter"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctcenter"></span>'+e._getLocStr("CTCenter")+'</a></li><li class="ctfar e-ss-cmenuitem" id="CTFar"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctfar"></span>'+e._getLocStr("CTFar")+'</a></li><li class="ctnear e-ss-cmenuitem" id="CTNear"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ctnear"></span>'+e._getLocStr("CTNear")+"</a></li></ul></li>",t+='<li class="datalabels" id="DataLabels"><a><span class="e-ss-chartimg e-icon e-ss-datalabels"></span>'+e._getLocStr("DataLabels")+'</a><ul><li class="dlnone e-ss-cmenuitem" id="DLNone"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dlnone"></span>'+e._getLocStr("DLNone")+'</a></li><li class="dlcenter e-ss-cmenuitem" id="DLCenter"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dlcenter"></span>'+e._getLocStr("DLCenter")+'</a></li><li class="dliend e-ss-cmenuitem" id="DLIEnd"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dliend"></span>'+e._getLocStr("DLIEnd")+'</a></li><li class="dlibase e-ss-cmenuitem" id="DLIBase"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dlibase"></span>'+e._getLocStr("DLIBase")+'</a></li><li class="dloend e-ss-cmenuitem" id="DLOEnd"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-dloend"></span>'+e._getLocStr("DLOEnd")+"</a></li></ul></li>",(t+='<li class="gridline" id="Gridline"><a><span class="e-ss-chartimg e-icon e-ss-gridline"></span>'+e._getLocStr("Gridline")+'</a><ul><li class="pmajorh e-ss-cmenuitem" id="PMajorH"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pmajorh"></span>'+e._getLocStr("PMajorH")+'</a></li><li class="pmajorv e-ss-cmenuitem" id="PMajorV"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pmajorv"></span>'+e._getLocStr("PMajorV")+'</a></li><li class="pminorh e-ss-cmenuitem" id="PMinorH"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon  e-ss-pminorh"></span>'+e._getLocStr("PMinorH")+'</a></li><li class="pminorv e-ss-cmenuitem" id="PMinorV"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-pminorv"></span>'+e._getLocStr("PMinorV")+"</a></li></ul></li>")+'<li class="legend" id="Legend"><a><span class="e-ss-chartimg e-icon e-ss-legend"></span>'+e._getLocStr("Legend")+'</a><ul><li class="lnone e-ss-cmenuitem" id="LNone"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lnone"></span>'+e._getLocStr("LNone")+'</a></li><li class="lright e-ss-cmenuitem" id="LRight"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lright"></span>'+e._getLocStr("LRight")+'</a></li><li class="lleft e-ss-cmenuitem" id="LLeft"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lleft"></span>'+e._getLocStr("LLeft")+'</a></li><li class="lbottom e-ss-cmenuitem" id="LBottom"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-lbottom"></span>'+e._getLocStr("LBottom")+'</a></li><li class="ltop e-ss-cmenuitem" id="LTop"><a class="e-ss-chartlayout"><span class="e-ss-chartimg e-icon e-ss-ltop"></span>'+e._getLocStr("LTop")+"</a></li></ul></li>"},_cpClickHandler:function(t){var i=this.XLObj;"Ribbon_Home_Font_FillColor"===t?i.XLFormat.format({style:{"background-color":e("#"+i._id+"_Ribbon_Home_Font_FillColor").ejColorPicker("option","value")}}):"Ribbon_Home_Font_FontColor"===t&&i.XLFormat.format({style:{color:e("#"+i._id+"_Ribbon_Home_Font_FontColor").ejColorPicker("option","value")}}),i._setSheetFocus()},_ribbonClickHandler:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j,M,V,B,H,X,U,z,q,G,W,K,J,Q,Y,$,Z={},ee=e("#"+this._id.split("_Ribbon")[0]).data("ejSpreadsheet"),te=ee.getActiveSheetIndex(),ie=ee.getSheet(te),re={},le={},ne=this._id.split("_"),se=t.Spreadsheet.SupportedStyles,oe=ie._selectedCells;if(!ee._shapeChange&&!ee.XLRibbon._isSetModel){if(ee._isRibbonClick=!0,R=ee._getJSSheetContent(te).find(".e-spreadsheetcontentcontainer > .e-content"),o=e("#"+ee._id+"_Ribbon_Home_Number_NumberFormat").data("ejDropDownList"),v=e("#"+ee._id+"_Ribbon_Home_Font_FontSize").data("ejDropDownList"),x=e(ee.getCell(ie._activeCell.rowIndex,ie._activeCell.colIndex)),ee.model.allowSelection&&ee.model.allowFormatAsTable&&ee.model.allowCellFormatting&&(ee.XLFormat._formatEnable||ee.XLSelection._isOutsideBordering||ee.XLSelection._isGridBordering)&&(ee._id+"_Ribbon_Home_Font_BorderColor"===this._id||ee._id+"_Ribbon_bordercolor"===i.ID||ee._borderStyles.indexOf(i.ID)>-1||(ee.XLSelection._isGridBordering=ee.XLSelection._isOutsideBordering=ee.XLFormat._formatEnable=!1,e("#"+ee._id+"_Ribbon_Home_Clipboard_FormatPainter").ejToggleButton("option",{toggleState:!1}),("itemSelected"===i.type||"click"===i.type)&&!ee.isUndefined(i.model.prefixIcon)&&(i.model.prefixIcon.split("e-ss-")[1]===i.ID||i.model.prefixIcon.indexOf("e-ss-drawborder")>-1||i.model.prefixIcon.indexOf("e-ss-drawbordergrid")>-1)&&(ee.XLSelection._isGridBordering=ee.XLSelection._isOutsideBordering=!0),R.addClass("e-ss-cursor"),R.removeClass("e-ss-drwbrdrcursor e-ss-drwbrdrgridcursor e-ss-fpcursor"),ee.XLSelection._cleanUp(!0))),L={Id:this._id,isChecked:i.isChecked,status:i.status,prop:i.model,model:ee.model},ee._trigger("ribbonClick",L))return ee.model.showRibbon&&ee.XLRibbon._updateRibbonIcons(),!1;switch(!t.isNullOrUndefined(ee._getAutoFillOptElem())&&ee.model.autoFillSettings.showFillOptions&&(ee._getAutoFillOptElem().addClass("e-hide"),e("#"+ee._id+"_ctxtmenu").hide()),this._id){case ee._id+"_Ribbon_Home_Clipboard_Cut":ee.XLClipboard.cut();break;case ee._id+"_Ribbon_Home_Clipboard_Copy":ee.XLClipboard.copy();break;case ee._id+"_Ribbon_Home_Clipboard_Paste":case ee._id+"_Ribbon_Home_Clipboard_PasteOptions":ee.XLClipboard._isSpecial=!("PasteValues"===i.ID),ee.XLClipboard.paste();break;case ee._id+"_Ribbon_Home_Actions_Undo":ee.XLClipboard._triggerKeyDown(90,!0);break;case ee._id+"_Ribbon_Home_Actions_Redo":ee.XLClipboard._triggerKeyDown(89,!0);break;case ee._id+"_Ribbon_Home_Alignment_WrapText":ee._textFormatting("wrapText");break;case ee._id+"_Ribbon_PageLayout_Print_Print":ee.XLPrint.printSheet(te);break;case ee._id+"_Ribbon_PageLayout_Print_PrintSelected":ee.XLPrint.printSelection(te);break;case ee._id+"_Ribbon_new":ee._cellFormatHandler(this._id.replace(ee._id+"_Ribbon_",""),i.selectedText);break;case ee._id+"_Ribbon_Home_Font_Bold":le[se.FontWeight]=i.model.toggleState?"bold":"normal",re.style=le,ee.XLFormat.format(re);break;case ee._id+"_Ribbon_Home_Font_Italic":le[se.FontStyle]=i.model.toggleState?"italic":"normal",re.style=le,ee.XLFormat.format(re);break;case ee._id+"_Ribbon_Home_Font_Underline":case ee._id+"_Ribbon_Home_Font_StrikeThrough":F=ee.XLFormat.getFormatFromHashCode(ee.XLFormat.getFormatClass(x[0].className))["text-decoration"]||"",ne.indexOf("StrikeThrough")>-1?ne[ne.indexOf("StrikeThrough")]="line-through":ne.indexOf("Underline")>-1&&(ne[ne.indexOf("Underline")]="underline"),i.model.toggleState?(F=F.replace("none",""),le[se.TextDecoration]=F?F.indexOf("underline")<0?F+" "+ne[ne.length-1]:ne[ne.length-1]+" "+F:ne[ne.length-1]):(F=e.trim(F.replace(ne[ne.length-1],"")),le[se.TextDecoration]=F.length?F:"none"),re.style=le,ee.XLFormat.format(re);break;case ee._id+"_Ribbon_Home_Font_FontSize":le[se.FontSize]=i.value,re.style=le,ee.XLFormat.format(re);break;case ee._id+"_Ribbon_Home_Font_IncreaseFontSize":case ee._id+"_Ribbon_Home_Font_DecreaseFontSize":this._id==ee._id+"_Ribbon_Home_Font_IncreaseFontSize"?(S=t.isNullOrUndefined(v.selectedIndexValue)?6:v.selectedIndexValue+1,t.isNullOrUndefined(ee.XLRibbon._fontSize[S])||v.option({selectedItemIndex:S})):this._id==ee._id+"_Ribbon_Home_Font_DecreaseFontSize"&&(S=t.isNullOrUndefined(v.selectedIndexValue)?4:v.selectedIndexValue-1,t.isNullOrUndefined(ee.XLRibbon._fontSize[S])||v.option({selectedItemIndex:S}));break;case ee._id+"_Ribbon_Home_Alignment_AlignLeft":case ee._id+"_Ribbon_Home_Alignment_AlignRight":case ee._id+"_Ribbon_Home_Alignment_AlignCenter":b=e(this.element.parents("div").eq(1)).find(".e-text-align"),t.isNullOrUndefined(b[0])?this.element.addClass("e-text-align"):(e("#"+b[0].id).ejToggleButton("option","toggleState",!1),b.removeClass("e-text-align"),b[0].id!=this.element[0].id&&this.element.addClass("e-text-align")),le[se.TextAlign]=i.model.toggleState?ne[ne.length-1].split("Align")[1]:"left",re.style=le,ee.XLFormat.format(re);break;case ee._id+"_Ribbon_Home_Alignment_DecreaseIndent":case ee._id+"_Ribbon_Home_Alignment_IncreaseIndent":if(N=0,A=!1,oe.length<2)P=ee.getActiveCell(),E=ee.XLFormat.getFormatFromHashCode(ee.XLFormat.getFormatClass(ee.getCell(P.rowIndex,P.colIndex)[0].className)),T=se.TextIndent in E?this._id===ee._id+"_Ribbon_Home_Alignment_IncreaseIndent"?Number(E[se.TextIndent].replace("pt",""))+6:Number(E[se.TextIndent].replace("pt",""))-6:this._id===ee._id+"_Ribbon_Home_Alignment_DecreaseIndent"?-6:6,ee.XLRibbon._applyTextIndent(P,E,T,this);else{for(s=0,D=oe.length;s<D;s++)"right"==(E=ee.XLFormat.getFormatFromHashCode(ee.XLFormat.getFormatClass(ee.getCell(oe[s].rowIndex,oe[s].colIndex)[0].className)))[se.TextAlign]&&N++;for(N===oe.length&&(A=!0),s=0,D=oe.length;s<D;s++)E=ee.XLFormat.getFormatFromHashCode(ee.XLFormat.getFormatClass(ee.getCell(oe[s].rowIndex,oe[s].colIndex)[0].className)),A||(E[se.TextAlign]="left"),T=se.TextIndent in E?this._id===ee._id+"_Ribbon_Home_Alignment_IncreaseIndent"?Number(E[se.TextIndent].replace("pt",""))+6:Number(E[se.TextIndent].replace("pt",""))-6:this._id===ee._id+"_Ribbon_Home_Alignment_DecreaseIndent"?-6:6,ee.XLRibbon._applyTextIndent(oe[s],E,T,this)}ee.XLSelection.refreshSelection(),ee.XLDragFill&&ee.XLDragFill.positionAutoFillElement();break;case ee._id+"_Ribbon_Home_Alignment_TopAlign":case ee._id+"_Ribbon_Home_Alignment_MiddleAlign":case ee._id+"_Ribbon_Home_Alignment_BottomAlign":b=e(this.element.parents("div").eq(1)).find(".e-vertical-align"),t.isNullOrUndefined(b[0])?this.element.addClass("e-vertical-align"):(e("#"+b[0].id).ejToggleButton("option","toggleState",!1),b.removeClass("e-vertical-align"),b[0].id!=this.element[0].id&&this.element.addClass("e-vertical-align")),le[se.VerticalAlign]=i.model.toggleState?ne[ne.length-1].split("Align")[0]:"bottom",re.style=le,ee.XLFormat.format(re);break;case ee._id+"_Ribbon_Home_Font_FontFamily":le[se.FontFamily]=i.text,re.style=le,ee.XLFormat.format(re);break;case ee._id+"_Ribbon_PageLayout_Show_Headings":ee.showHeadings(i.isChecked);break;case ee._id+"_Ribbon_PageLayout_Show_Gridlines":ee.showGridlines(i.isChecked);break;case ee._id+"_Ribbon_PageLayout_PageLayout_PageSize":case ee._id+"_Ribbon_PageLayout_PageLayout_PageSizeOptions":k=t.isNullOrUndefined(i.ID)?i.model.prefixIcon.substring(12):i.ID,ee.XLPrint._printSetting(k);break;case ee._id+"_Ribbon_Home_Number_NumberFormat":re.type=i.value.toLowerCase(),"custom"!==re.type?ee.XLFormat.format(re):ee._showDialog(ee._id+"_FormatCells");break;case ee._id+"_Ribbon_Home_Number_IncreaseDecimal":case ee._id+"_Ribbon_Home_Number_DecreaseDecimal":"number"!=x.data("type")&&e.isNumeric(ee.XLEdit.getPropertyValueByElem(x))&&(ee.XLRibbon._isSetModel=!0,o.option({selectedItemIndex:1}),ee.XLRibbon._isSetModel=!1),ee.XLFormat.updateDecimalPlaces(ne[ne.length-1]);break;case ee._id+"_Ribbon_Home_Number_Accounting":case ee._id+"_Ribbon_Home_Number_Percentage":this._id===ee._id+"_Ribbon_Home_Number_Accounting"?o.option({selectedItemIndex:3}):o.option({selectedItemIndex:4}),re.type=o.model.value.toLowerCase();break;case ee._id+"_Ribbon_Home_Number_CommaStyle":o.option({selectedItemIndex:1}),re.type=o.model.value.toLowerCase();break;case ee._id+"_Ribbon_Data_SortFilter_SortAtoZ":ee.XLSort._sortHandler("SortAtoZ");break;case ee._id+"_Ribbon_Data_SortFilter_SortZtoA":ee.XLSort._sortHandler("SortZtoA");break;case ee._id+"_Ribbon_Data_SortFilter_Filter":ee.XLFilter.filter();break;case ee._id+"_Ribbon_Data_SortFilter_ClearFilter":C=ee.XLEdit.getPropertyValue(ee.getActiveCell().rowIndex,ee.getActiveCell().colIndex,"tableName"),t.isNullOrUndefined(C)?ee.XLFilter.clearFilter():(w=ee._getTableID(C),ee.XLFilter._clearFilterTable(ee.getActiveSheetIndex(),w,!0));break;case ee._id+"_Ribbon_Home_Font_BorderColor":Z=e("#"+ee._id+"_Ribbon_BorderColor").data("ejColorPicker"),t.isNullOrUndefined(Z)||Z.hide(),t.isNullOrUndefined(i.value)||(ee._borderColor=i.value);break;case ee._id+"_Ribbon_Home_Font_Border":ee._borderStyles.indexOf(i.ID)<0?t.isNullOrUndefined(i.ID)?i.ID=i.model.prefixIcon.substring(12):i.ID.indexOf("bordercolor")<0&&e(this.element).find(".e-icon ").removeClass().addClass("e-icon e-ss-"+i.ID)&&this.option({prefixIcon:"e-icon e-ss-"+i.ID}):ee.XLRibbon._updateBordeStyle(i),d=ee._borderColor||"#000000",g=ie._startCell,p=ie._endCell,j=ee._getAlphaRange(te,g.rowIndex,g.colIndex,p.rowIndex,p.colIndex),ee.model.allowSelection&&(ee.XLSelection._isOutsideBordering||ee.XLSelection._isGridBordering)?!(ee._borderStyles.indexOf(i.ID)>-1)&&i.ID.indexOf("bordercolor")<0&&(ee.XLSelection._isOutsideBordering=ee.XLSelection._isGridBordering=!1):ee.setBorder({type:i.ID,color:d,style:ee._borderStyle},j);break;case ee._id+"_Ribbon_Data_DataTools_DataValidation":case ee._id+"_Ribbon_Data_DataTools_DataValidationOptions":if(ee._showDialog(this._id),"ClearVal"==i.ID)ee.XLValidate.clearDV();else if("HighlightVal"==i.ID)ee.XLValidate.highlightInvalidData();else if("ClearHLVal"==i.ID)ee.XLValidate.clearHighlightedValData();else{for(D=(M=(ie=ee.getSheet(te))._selectedCells).length,k=[],s=0;s<D;s++)ee.XLEdit.getPropertyValue(M[s].rowIndex,M[s].colIndex,"rule")&&(V=ee._dataContainer.sheets[te][M[s].rowIndex][M[s].colIndex].rule.customVal,-1==k.indexOf(V)&&k.push(V));k.length>0?ee._showAlertDlg("","MoreValidationAlert","OpenValDlg",400,130):(e("#"+ee._id+"_ValDialog").ejDialog("open"),e.validator&&e("#"+ee._id+"_Form_ValDialog").validate().resetForm(),e("#"+ee._id+"_Ribbon_ddType_wrapper").focus(),(B=ee.XLEdit.getPropertyValueByElem(ee.getActiveCellElem(te),"rule"))?(H=B.customVal,X=H.split("_"),H.indexOf("list")>-1?(e("#"+ee._id+"_Ribbon_ddType").ejDropDownList("option","selectedItemIndex",5),e("#"+ee._id+"_Ribbon_btnMin").val(X[0])):(ee.XLRibbon._types.some(function(e,t){if(X[4]===e.value)return U=t,!0}),e("#"+ee._id+"_Ribbon_ddType").ejDropDownList("option","selectedItemIndex",U),ee.XLRibbon._actions.some(function(e,t){if(X[0]===e.value)return U=t,!0}),e("#"+ee._id+"_Ribbon_ddAction").ejDropDownList("option","selectedItemIndex",U),e("#"+ee._id+"_Ribbon_btnMin").val(X[1].replace("^","")),e("#"+ee._id+"_Ribbon_btnMax").val(X[2].replace("^",""))),e("#"+ee._id+"_Ribbon_blank").ejCheckBox("option","checked",!B.required),e("#"+ee._id+"_Ribbon_freetext").ejCheckBox("option","checked",JSON.parse(X[X.length-3]))):(e("#"+ee._id+"_Ribbon_ddType").ejDropDownList("option","selectedItemIndex",1),e("#"+ee._id+"_Ribbon_ddAction").ejDropDownList("option","selectedItemIndex",6),e("#"+ee._id+"_Ribbon_btnMin").val(""),e("#"+ee._id+"_Ribbon_btnMax").val(""),e("#"+ee._id+"_Ribbon_blank").ejCheckBox("option","checked",!0),e("#"+ee._id+"_Ribbon_freetext").ejCheckBox("option","checked",!0)))}break;case ee._id+"_Ribbon_Home_Styles_ConditionalFormatting":if(!i.ID.length)break;ee.XLRibbon._currentCFormat=i.ID,i.ID.startsWith("clear")?"clearselected"===i.ID?ee.XLCFormat.clearCF(ee.getSheet(te).selectedRange):ee.XLCFormat.clearCF():i.ID.indexOf("_HLCellRules")>0||i.ID.indexOf("_ClearRules")>0||i.ID.indexOf("_CreateRule")<-1||(ee._showDialog(this._id),ee.XLRibbon._renderCFDialog(i));break;case ee._id+"_Ribbon_Others_Editing_FindSelect":switch(ee._showDialog(this._id),h=e("#"+ee._id+"_GoToDlgTab").data("ejTab"),z=e("#"+ee._id+"_FRDialog_FPDlgTab").data("ejTab"),i.ID){case"Find":ee._responsiveHeight<365&&e("#"+ee._id+"_FRDialog_wrapper").css("top","0px"),e("#"+ee._id+"_FRDialog").ejDialog("open"),ee.XLRibbon._refreshFRDlg(),z.option({selectedItemIndex:0}),e("#"+ee._id+"_Ribbon_textFind").focus().setInputPos(e("#"+ee._id+"_Ribbon_textFind").val().length),ee.model.isReadOnly?e("#"+ee._id+"_FRDialog_FPDlgTab").ejTab("option",{disabledItemIndex:[1,2]}):e("#"+ee._id+"_FRDialog_FPDlgTab").ejTab("option",{enabledItemIndex:[1,2]});break;case"Replace":ee._responsiveHeight<365&&e("#"+ee._id+"_FRDialog_wrapper").css("top","0px"),e("#"+ee._id+"_FRDialog").ejDialog("open"),ee.XLRibbon._refreshFRDlg(),z.option({selectedItemIndex:1}),e("#"+ee._id+"_Ribbon_textFind").focus().setInputPos(e("#"+ee._id+"_Ribbon_textFind").val().length);break;case"GoTo":e("#"+ee._id+"_GoDialog").ejDialog("open"),h.option({selectedItemIndex:0}),e("#"+ee._id+"_textRef").focus().setInputPos(e("#"+ee._id+"_Ribbon_textFind").val().length),e.validator&&e("#"+ee._id+"_Form_GoToDiv").validate().resetForm();break;case"GoToSpecial":e("#"+ee._id+"_GoDialog").ejDialog("open"),h.option({selectedItemIndex:1}),e("#"+ee._id+"_Blanks").focus();break;default:ee.XLSearch._applyGoToRule(i.ID.toLowerCase(),!0,!0,!0,!0)}break;case ee._id+"_Ribbon_Others_CalCulation_CalculationOptions":switch(i.ID){case ee._id+"_CalcAuto":ee.XLEdit.calcOption(!0);break;case ee._id+"_CalcManual":ee.XLEdit.calcOption(!1)}break;case ee._id+"_Ribbon_Others_CalCulation_CalculateNow":ee.XLEdit.calcNow();break;case ee._id+"_Ribbon_Others_CalCulation_CalculateSheet":ee.XLEdit.calcNow(ee.getActiveSheetIndex());break;case ee._id+"_Ribbon_Home_Clipboard_FormatPainter":if(!i.model.toggleState)return ee.performSelection(ee.getActiveCell(),ee.getActiveCell()),!1;ee.XLFormat._formatEnable=!0,R.removeClass("e-ss-cursor"),R.addClass("e-ss-fpcursor"),ee.XLFormat._formatPainter();break;case ee._id+"_Ribbon_Design_Tools_ConvertToRange":ee.XLFormat.convertToRange({alert:!0});break;case ee._id+"_Ribbon_Design_Tools_ResizeTable":w=parseInt(document.getElementById(ee._id+"_tableid").value),y=ie.tableManager[w].range,ee._showDialog(ee._id+"_Ribbon_Design_Tools_ResizeTable"),e("#"+ee._id+"_fatresizetablerange").val(ee._getAlphaRange(te,y[0],y[1],y[2],y[3])),e("#"+ee._id+"_fatresizetabledlg").ejDialog("open");break;case ee._id+"_Ribbon_Design_TableStyleOptions_FirstColumn":case ee._id+"_Ribbon_Design_TableStyleOptions_LastColumn":this._id===ee._id+"_Ribbon_Design_TableStyleOptions_FirstColumn"?(ee.XLRibbon._isFirstColumn=!0,w=document.getElementById(ee._id+"_tableid").value,y=ie.tableManager[w].range,y=ee._getProperAlphaRange(te,y[0]+1,y[1],y[2],y[1]),ee.XLRibbon._firstLastColumn(w,te),u="firstColumn"):(ee.XLRibbon._isFirstColumn=!1,w=document.getElementById(ee._id+"_tableid").value,y=ie.tableManager[w].range,y=ee._getProperAlphaRange(te,y[0]+1,y[3],y[2],y[3]),ee.XLRibbon._firstLastColumn(w,te),u="lastColumn"),_={sheetIndex:te,reqType:"format-table",action:"firstlastcolumn",range:y,check:i.isChecked,id:i.model.id,tableId:parseInt(w),prop:u},ee._completeAction(_),ee._trigActionComplete(_);break;case ee._id+"_Ribbon_Design_TableStyleOptions_TotalRow":w=document.getElementById(ee._id+"_tableid").value,ee.XLRibbon._totalRow(w,te);break;case ee._id+"_Ribbon_Design_TableStyleOptions_FilterColumn":if(!ee.model.allowFiltering)return;I=ie.tableManager,w=document.getElementById(ee._id+"_tableid").value,ee.XLFilter._clearFilterTableIcon(te,parseInt(document.getElementById(ee._id+"_tableid").value)),I[w].isFilter=i.isChecked,_={sheetIndex:te,reqType:"format-table",action:"filtericon",id:i.model.id,check:i.isChecked,tableId:parseInt(w)},ee._completeAction(_),ee._trigActionComplete(_);break;case ee._id+"_Ribbon_Insert_Tables_Table":ee._showDialog(this._id),ee.XLRibbon._openFATDlg();break;case ee._id+"_Ribbon_Review_Comments_NewComment":e("#"+ee._id+"_Ribbon_Review_Comments_NewComment").text()===ee._getLocStr("NewComment")?ee.XLComment.setComment():ee.XLComment.editComment();break;case ee._id+"_Ribbon_Review_Comments_DeleteComment":ee.XLComment.deleteComment();break;case ee._id+"_Ribbon_Review_Comments_ShowAllComments":ee.XLComment.showAllComments();break;case ee._id+"_Ribbon_Review_Comments_ShowHideComment":ee.XLComment.showHideComment();break;case ee._id+"_Ribbon_Review_Comments_NextComment":ee.XLComment.findNextComment();break;case ee._id+"_Ribbon_Review_Comments_PreviousComment":ee.XLComment.findPrevComment();break;case ee._id+"_Ribbon_Insert_Links_Hyperlink":ee._showDialog(this._id);break;case ee._id+"_Ribbon_Home_Editing_SortFilter":switch(i.ID){case"Ribbon_SortAtoZ":case"Ribbon_SortZtoA":ee.model.allowSorting&&ee.XLSort._sortHandler(i.ID);break;case"Ribbon_Filter":ee.model.allowFiltering&&ee.XLFilter.filter();break;default:(C=ee.getCell(ee.getActiveCell().rowIndex,ee.getActiveCell().colIndex)[0].className).indexOf("e-table")<0?ee.XLFilter.clearFilter():(w=ee._getTableID(C),ee.XLFilter._clearFilterTable(ee.getActiveSheetIndex(),parseInt(w),!0))}break;case ee._id+"_Ribbon_Others_Cells_InsertCell":case ee._id+"_Ribbon_Others_Cells_InsertCellOptions":if(oe.length<1)return;switch(g=oe[0],p=oe[oe.length-1],i.ID){case"InsertCells":ee._getJSSheetRowHeaderContent(te).find(".e-rowselected").length?ee.insertEntireRow(g.rowIndex,p.rowIndex):ee._getJSSheetHeader(te).find(".e-colselected").length?(ee._insDelStatus="insert",ee.insertEntireColumn(g.colIndex,p.colIndex)):ee._showDialog(this._id);break;case"InsertSheetRows":ee.insertEntireRow(g.rowIndex,p.rowIndex);break;case"InsertSheetColumns":ee._insDelStatus="insert",ee.insertEntireColumn(g.colIndex,p.colIndex);break;case"InsertSheet":ee.insertSheet();break;default:ee.element.find(".e-rowselected").length>0?ee.insertEntireRow(g.rowIndex,p.rowIndex):ee.element.find(".e-colselected").length>0?(ee._insDelStatus="insert",ee.insertEntireColumn(g.colIndex,p.colIndex)):ee.insertShiftBottom(g,p)}break;case ee._id+"_Ribbon_Others_Cells_DeleteCell":case ee._id+"_Ribbon_Others_Cells_DeleteCellOptions":if(oe.length<1)return;switch(g=oe[0],p=oe[oe.length-1],i.ID){case"DeleteCells":ee._getJSSheetRowHeaderContent(te).find(".e-rowselected").length?ee.deleteEntireRow(g.rowIndex,p.rowIndex,[]):ee._getJSSheetHeader(te).find(".e-colselected").length?(ee._insDelStatus="delete",ee.deleteEntireColumn(g.colIndex,p.colIndex,[])):ee._showDialog(this._id);break;case"DeleteSheetRows":ee.deleteEntireRow(g.rowIndex,p.rowIndex,[]);break;case"DeleteSheetColumns":ee._insDelStatus="delete",ee.deleteEntireColumn(g.colIndex,p.colIndex,[]);break;case"DeleteSheet":ee.deleteSheet(te,!0);break;default:ee.element.find(".e-rowselected").length>0?ee.deleteEntireRow(g.rowIndex,p.rowIndex):ee.element.find(".e-colselected").length>0?(ee._insDelStatus="insert",ee.deleteEntireColumn(g.colIndex,p.colIndex)):ee.deleteShiftUp(g,p)}break;case ee._id+"_Ribbon_Home_Editing_Clear":switch(y=ie.selectedRange,i.ID){case"Clear_All":y=ee._getAlphaRange(te,y[0],y[1],y[2],y[3]),ee._isTrigCellSave=!0,ee.clearAll(y);break;case"Clear_Formats":y=ee._getAlphaRange(te,y[0],y[1],y[2],y[3]),ee.clearAllFormat(y);break;case"Clear_Contents":y=ee._getAlphaRange(te,y[0],y[1],y[2],y[3]),ee._isTrigCellSave=!0,ee.clearContents(y);break;case"Clear_Comments":ee.clearComments(te);break;default:ee.clearHyperlinks()}ee.model.allowSelection&&ee.XLSelection._clearBorder(ee._arrayAsString(ee._cutFocus),te);break;case ee._id+"_Ribbon_Insert_Tables_PivotTable":if(ee._showDialog(this._id),r=e("#"+ee._id+"_PvtDialog"),ie=ee.getSheet(te),m={sheetIndex:te,model:ee.model.sheets},ee._trigger("_createPivotTable",m))return;e("#"+ee._id+"_Ribbon_PvtRange").val(""),e("#"+ee._id+"_Ribbon_PvtLocation").val(""),ie._selectedCells.length>1?(y=ie.selectedRange,e("#"+ee._id+"_Ribbon_PvtRange").val(ie.sheetInfo.text+"!$"+ee._generateHeaderText(y[1]+1)+"$"+(y[0]+1)+":$"+ee._generateHeaderText(y[3]+1)+"$"+(y[2]+1))):ee.isUndefined(ee.XLEdit.getPropertyValueByElem(ee.getActiveCellElem()))||(ee.selectAll(!1),e("#"+ee._id+"_Ribbon_PvtRange").val(ie.sheetInfo.text+"!$"+ee._generateHeaderText(ie._startCell.colIndex+1)+"$"+(ie._startCell.rowIndex+1)+":$"+ee._generateHeaderText(ie._endCell.colIndex+1)+"$"+(ie._endCell.rowIndex+1))),r.find(".e-ss-changerange").show(),r.find(".e-ss-movepvttbl").show(),r.data("ejDialog").option("title",ee._getLocStr("CreatePivotTable")),e("#"+ee._id+"_dlg_newsheet").click(),r.ejDialog("open");break;case ee._id+"_Ribbon_Insert_Sparkline_Column":case ee._id+"_Ribbon_Insert_Sparkline_Line":case ee._id+"_Ribbon_Insert_Sparkline_Pie":case ee._id+"_Ribbon_Insert_Sparkline_Area":case ee._id+"_Ribbon_Insert_Sparkline_Winloss":ee.XLRibbon._sparklineDesignType=this._id.split("_")[4],ee._showDialog(this._id),ee.XLSparkline._sparklineDlgBox();break;case ee._id+"_Ribbon_Analyze_Show_FieldList":i.model.toggleState?(ee.XLPivot._displayActPanel=!0,ee.getActivationPanel().find("#"+ee._id+"_PivotTableSchema_"+ee._getContent(te).find(".e-ss-activepivot")[0].id).show(),ee.showActivationPanel()):(ee.hideActivationPanel(),ee.XLPivot._displayActPanel=!1);break;case ee._id+"_Ribbon_Analyze_Actions_ClearAll":q=ee.element.find(".e-ss-activepivot")[0].id,G=e("#"+q).data("ejPivotGrid"),W=e("#"+ee._id+"_PivotTableSchema_"+q).data("ejPivotSchemaDesigner"),ee.XLPivot._clearFilters(G,W),W.model.pivotControl=G;break;case ee._id+"_Ribbon_Analyze_Actions_MovePivotTable":r=e("#"+ee._id+"_PvtDialog"),te=ee.getActiveSheetIndex(),r.find(".e-ss-movepvttbl").show(),r.find(".e-ss-changerange").hide(),n=ee.getSheet(te).pivotMngr.pivot[ee.element.find(".e-ss-activepivot")[0].id],e("#"+ee._id+"_Ribbon_PvtLocation").val(ee.getSheet(te).sheetInfo.text+"!$"+ee._generateHeaderText(n.colIndex+1)+"$"+(n.rowIndex+1)),r.data("ejDialog").option("title",ee._getLocStr("MovePivotTable")),e("#"+ee._id+"_dlg_existsheet").click(),r.ejDialog("open");break;case ee._id+"_Ribbon_Analyze_DataSource_Refresh":ee.XLPivot.refreshDataSource();break;case ee._id+"_Ribbon_Analyze_DataSource_ChangeDataSource":(r=e("#"+ee._id+"_PvtDialog")).find(".e-ss-changerange").show(),r.find(".e-ss-movepvttbl").hide(),y=(n=ee.getSheet(te).pivotMngr.pivot[ee.element.find(".e-ss-activepivot")[0].id]).dataRange,e("#"+ee._id+"_Ribbon_PvtRange").val(n.dataSheetName+"!$"+ee._generateHeaderText(y[1]+1)+"$"+(y[0]+1)+":$"+ee._generateHeaderText(y[3]+1)+"$"+(y[2]+1)),r.data("ejDialog").option("title",ee._getLocStr("ChangePivotTableDataSource")),r.ejDialog("open");break;case ee._id+"_Ribbon_ChartDesign_Type_ChangeChartType":ee._showDialog(this._id),ee.XLRibbon._refreshChartTypeDlg();break;case ee._id+"_Ribbon_Insert_Illustrations_Pictures":if(ee.model.importSettings.importMapper.length<1)return void ee._showAlertDlg("Alert","ImportExportUrl","",266);ee._uploadImage=!0,e("#"+ee._id+"_file .e-uploadinput").click(),ee.XLRibbon._toggleFormatTab();break;case ee._id+"_Ribbon_Others_Formulas_NameManager":ee.XLRibbon._openNameManagerDlg(),ee.XLRibbon._isNmgrid="NameManager";break;case ee._id+"_Ribbon_Others_Formulas_DefineName":ee._showDialog(ee._id+"_Ribbon_Others_NameManager"),(K=e("#"+ee._id+"_nmgrid").data("ejGrid")).getContentTable().find("td").addClass("e-ss-emptyrecord"),K.model.dataSource.length<1?K.getContentTable().find("td").addClass("e-ss-emptyrecord"):K.getContentTable().find(".e-ss-emptyrecord").removeClass("e-ss-emptyrecord"),ee.XLRibbon._refreshNMDlg(),ee.XLRibbon._isNmgrid="DefineName";break;case ee._id+"_Ribbon_Others_Window_FreezePanes":switch(i.ID){case"freezePanes":ee.XLFreeze.freezePanes();break;case"FreezeTopRow":ee.XLFreeze.freezeTopRow();break;case"FreezeFirstColumn":ee.XLFreeze.freezeLeftColumn();break;case"UnFreezePanes":ee.XLFreeze.unfreezePanes()}break;case ee._id+"_Ribbon_Home_Alignment_Merge":switch(t.isNullOrUndefined(i.ID)&&(ee.mergeCenter=!0,ee.mergeCells()),i.ID){case"MergeCells":ee.mergeCells();break;case"MergeAcross":ee.mergeAcrossCells();break;case"MergeAndCenter":ee.mergeCenter=!0,ee.mergeCells();break;case"UnmergeCells":ee.unmergeCells(ie.selectedRange)}break;case ee._id+"_Ribbon_Home_Editing_AutoSum":c=ie.selectedRange,"click"===i.type?ee.XLRibbon.autoSum("SUM",ee._getAlphaRange(te,c[0],c[1],c[2],c[3])):ee.XLRibbon.autoSum(i.ID.toUpperCase(),ee._getAlphaRange(te,c[0],c[1],c[2],c[3]));break;case ee._id+"_Ribbon_ChartDesign_ChartLayouts_AddChartElement":ee.XLChart.updateChartElement(null,i.ID);break;case ee._id+"_Ribbon_ChartDesign_Size_ChartWidth":ee.XLRibbon._changeChartSize("height",i.value);break;case ee._id+"_Ribbon_ChartDesign_Size_ChartHeight":ee.XLRibbon._changeChartSize("width",i.value);break;case ee._id+"_Ribbon_ChartDesign_Data_SwitchRowColumn":ee.XLChart.switchRowColumn();break;case ee._id+"_Ribbon_SparklineDesign_Line":case ee._id+"_Ribbon_SparklineDesign_Column":case ee._id+"_Ribbon_SparklineDesign_Pie":case ee._id+"_Ribbon_SparklineDesign_Area":case ee._id+"_Ribbon_SparklineDesign_Winloss":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),this.sparklineDesignType=this._id.split("_")[3],ee.XLSparkline.changeType(J[0],this.sparklineDesignType);break;case ee._id+"_Ribbon_SparklineDesign_Sparkline_EditData":switch(ee._showDialog(this._id),i.ID){case"EditGroupLocation":ee.XLRibbon._isEditGroupLocationClick=!0,ee.XLRibbon._isEditGroupLocationClick&&ee.XLSparkline._sparklineDlgBox();break;case"EditSingleSparklineData":ee._showDialog(this._id),ee.XLSparkline._sparklinDesignDlg(),ee.XLRibbon._isEditSingleSparklineClick=!0}break;case ee._id+"_Ribbon_SparklineDesign_Show_HighPoint":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),ee.XLSparkline.changePointColor(J[0],{highPointColor:"red"},te,i.isChecked);break;case ee._id+"_Ribbon_SparklineDesign_Show_NegativePoints":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),ee.XLSparkline.changePointColor(J[0],{negativePointColor:"orange"},te,i.isChecked);break;case ee._id+"_Ribbon_SparklineDesign_Show_LowPoint":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),ee.XLSparkline.changePointColor(J[0],{lowPointColor:"orange"},te,i.isChecked);break;case ee._id+"_Ribbon_SparklineDesign_Show_FirstPoint":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),ee.XLSparkline.changePointColor(J[0],{startPointColor:"green"},te,i.isChecked);break;case ee._id+"_Ribbon_SparklineDesign_Show_LastPoint":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),ee.XLSparkline.changePointColor(J[0],{endPointColor:"violet"},te,i.isChecked);break;case ee._id+"_Ribbon_SparklineDesign_Show_Markers":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),ee.XLSparkline.changePointColor(J[0],{markerSettings:{visible:!0}},te,i.isChecked);break;case ee._id+"_Ribbon_SparklineColor":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),l=i.value,ee.XLSparkline.changePointColor(J[0],{fill:l},te,i.isInteraction);break;case ee._id+"_Ribbon_MarkerNegativePoint":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),l=i.value,ee.XLSparkline.changePointColor(J[0],{negativePointColor:l},te,i.isInteraction);break;case ee._id+"_Ribbon_MarkerHighPoint":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),l=i.value,ee.XLSparkline.changePointColor(J[0],{highPointColor:l},te,i.isInteraction);break;case ee._id+"_Ribbon_MarkerLowPoint":J=ee.XLEdit.getPropertyValue(ee._getSelectedCells().selCells[0].rowIndex,ee._getSelectedCells().selCells[0].colIndex,"sparkline"),l=i.value,ee.XLSparkline.changePointColor(J[0],{lowPointColor:l},te,i.isInteraction);break;case ee._id+"_Ribbon_PictureColor":case ee._id+"_Ribbon_Format_Border_PictureBorder":if(-1===["weight","dashes",ee._id+"picturecolor",""].indexOf(i.ID)&&(f=ee.getSheetElement(te).find(".e-ss-activeimg"),Q=new RegExp("\\be-shapebdr.*?\\b","g"),l=(le=f[0].className.match(Q)?ee.XLShape._getImgStyleFromHashCode(f[0].className.match(Q)[0]):{"border-color":"transparent","border-width":"1px","border-style":"solid"})["border-color"],Y=le["border-width"],le=le["border-style"],f[0])){switch(!0){case this._id.indexOf("PictureColor")>-1:l=i.value;break;case i.ID.indexOf("px")>-1:Y=i.ID;break;case"nooutline"===i.ID:l="transparent";break;default:le=i.ID}ee.XLShape.changePictureBorder(f[0].id,Y,le,l)}break;case ee._id+"_Ribbon_Format_Adjust_ResetPicture":ee.XLShape.resetPicture(null,i.ID);break;case ee._id+"_Ribbon_Format_Adjust_ChangePicture":ee._uploadImage=!0,ee.XLShape._changePicture=!0,ee.element.find("#"+ee._id+"_file .e-uploadinput").click(),ee.XLRibbon._toggleFormatTab();break;case ee._id+"_Ribbon_ChartDesign_Data_SelectData":ee._showDialog(this._id),a=document.getElementById(ee._id+"_chart").value,(O=ee.XLChart._getShapeObj(a,"chart")).isChartSeries||(e("#"+ee._id+"_crxaxis").val(O.xRange?ee._getAlphaRange(te,O.xRange[0],O.xRange[1],O.xRange[2],O.xRange[3]):""),e("#"+ee._id+"_cryaxis").val(O.yRange?ee._getAlphaRange(te,O.yRange[0],O.yRange[1],O.yRange[2],O.yRange[3]):""),e("#"+ee._id+"_crlaxis").val(O.lRange?ee._getAlphaRange(te,O.lRange[0],O.lRange[1],O.lRange[2],O.lRange[3]):""),ee._selectDataval={xRange:e("#"+ee._id+"_crxaxis").val(),yRange:e("#"+ee._id+"_cryaxis").val(),lRange:e("#"+ee._id+"_crlaxis").val()},e("#"+ee._id+"_chartrangedlg").ejDialog("open"),e("#"+ee._id+"_crxaxis").focus().setInputPos(0));break;case ee._id+"_Ribbon_ChartDesign_ChartThemes_ChartThemes":ee.XLChart.changeTheme(ee.element.find("#"+ee._id+"_chart").val(),this._selectedValue);break;case ee._id+"_Ribbon_Review_Changes_LockCell":ee.lockCells(null,i.model.toggleState);break;case ee._id+"_Ribbon_Review_Changes_ProtectSheet":ee.protectSheet(i.model.toggleState);break;case ee._id+"_Ribbon_Review_Changes_ProtectWorkbook":ee._showDialog(this._id),$=e("#"+ee._id+"_PasswordDialog").data("ejDialog"),ee.model.exportSettings.password||($.option("title",ee._getLocStr("ProtectWorkbook")),e("#"+ee._id+"_confirm").show()),$.open()}(this._id.indexOf("Comment")<0&&this._id.indexOf("FindSelect")<0||ee.XLSearch._isApplied)&&(ee._setSheetFocus(),ee.XLSearch._isApplied=!1),ee._isRibbonClick=!1}},_applyTextIndent:function(e,i,r,l){var n,s,o,a,d,h,c,u=this.XLObj,g=u.getActiveSheetIndex(),p={},m=t.Spreadsheet.SupportedStyles,_=u.getCell(e.rowIndex,e.colIndex),f=u.getSheet(g);if(d=u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"value2"),h=u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"value"),!(l._id.indexOf("DecreaseIndent")<0&&u._hasClass(_[0],"e-sswraptext")&&Math.round(4/3*r)+u._detailsFromGlobalSpan(e.rowIndex,e.colIndex,"width","W")>f.columnsWidthCollection[e.colIndex])){if(u.isFormula(h)&&(h=d),!i[m.TextIndent]&&l._id===u._id+"_Ribbon_Home_Alignment_DecreaseIndent"||r<0)return!1;i[m.TextIndent]=r+"pt",("center"===i[m.TextAlign]||u.isNumber(h)&&!i[m.TextAlign])&&(i[m.TextAlign]="left"),p.style=i,u.XLFormat.format(p,[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex]),!i[m.TextIndent]||u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"merge")||u.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"mergeIdx")||((c=_.outerHeight())>=u.model.rowHeight&&(_.parent().outerHeight(c),f.rowsHeightCollection[e.rowIndex]=c,u._updateFormatColl(g,e.rowIndex,e.colIndex,c),u._setRowHdrHeight(g,e.rowIndex)),n=u._detailsFromGlobalSpan(e.rowIndex,e.colIndex,"width",d,null,!0),o=4/3*r,s=Math.round(o+n),a=f.columnsWidthCollection[e.colIndex],u.XLResize&&u.isNumber(h)&&l._id===u._id+"_Ribbon_Home_Alignment_IncreaseIndent"&&s>=a&&u.XLResize.setColWidth(e.colIndex,8+a))}},_changeChartSize:function(t,i){if(!this._ctrlCreated){var r,l=this.XLObj,n=document.getElementById(l._id+"_chart").value,s=e("#"+n).ejChart("instance"),o=e("#"+n),a=l.XLChart._getShapeObj(n,"chart"),d={sheetIndex:l.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:t,cid:n,rowIndex:l.XLShape._picCellIdx.rowIndex,colIndex:l.XLShape._picCellIdx.colIndex,prev:{width:s.model.size.width,height:s.model.size.height}};l.model.allowFormulaBar&&(r=l.element.find(".e-formulabar")[0]),r&&(r.style.display="none"),"height"===t?(s.option("size",{width:i.toString()}),a.width=i,o[0].style.width=i+"px",d.cur={width:i.toString(),height:s.model.size.height}):(s.option("size",{height:i.toString()}),a.height=i,o[0].style.height=i+"px",d.cur={width:s.model.size.width,height:i.toString()}),r&&(r.style.display="block"),l._completeAction(d),l._trigActionComplete(d),l.XLShape._shapeType="chart",l.XLShape._updateShapeObj(o[0]),l.XLShape._shapeType="img"}},_updateBordeStyle:function(e){this.XLObj._borderStyle=e.ID&&e.ID.length>0&&e.ID},_colorPickerHandler:function(t,i){var r,l,n=this.XLObj;"open"===i.type?(e("#"+n._id+"_"+t+"_popup").find(".e-buttons, .e-button").hide(),e("#"+n._id+"_"+t+"_popup").focus()):"change"===i.type&&(r=n.XLFormat,l=e("#"+n._id+"_"+t).data("ejColorPicker"),"Ribbon_Home_Font_FontColor"===t?(r.format({style:{color:i.value}}),e("#"+n._id+"_Ribbon_home_Font_Color").find(".e-selected-color").css("background-color",i.value)):(r.format({style:{"background-color":i.value}}),e("#"+n._id+"_Ribbon_home_Font_Background").find(".e-selected-color").css("background-color",i.value)),l.hide(),n._dupDetails=!0,l.setValue(i.value),n._dupDetails=!1)},updateRibbonIcons:function(){this._updateRibbonIcons()},_updateRibbonIcons:function(){var i,r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(o);if(this.XLObj.model.showRibbon&&(!a._isImported||a._isLoaded)){var d,h,c,u,g,p,m,_,f=e("#"+s._id+"_Ribbon_Home_Number_NumberFormat").data("ejDropDownList"),b=e("#"+s._id+"_Ribbon_Home_Font_FontSize").data("ejDropDownList");e("#"+s._id+"_Ribbon_Home_Font_FontSize").css("width","auto");var C=e("#"+s._id+"_Ribbon_Home_Font_FontFamily").data("ejDropDownList"),S=-1,x=e("#"+s._id+"_Ribbon").data("ejRibbon"),v=x.getTabText(x.model.selectedItemIndex);switch(v){case s._getLocStr("HOME"):if(m=a._activeCell,u=s.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"wrap"),c=s.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"merge"),l=s.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"format"),g=s.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"type"),t.isNullOrUndefined(s.XLFormat)||(p=s.XLFormat.getFormatFromHashCode(l)),s.isUndefined(u)&&(u=!1),e("#"+s._id+"_Ribbon_Home_Alignment_WrapText").ejToggleButton("option",{toggleState:u}),s.isUndefined(c)?(e("#"+s._id+"_Ribbon_Home_Alignment_Merge").removeClass("e-ss-active"),e("#"+s._id+"_Ribbon_Home_Alignment_Mergedrpbtn").removeClass("e-ss-active")):(e("#"+s._id+"_Ribbon_Home_Alignment_Merge").addClass("e-ss-active"),e("#"+s._id+"_Ribbon_Home_Alignment_Mergedrpbtn").addClass("e-ss-active")),["date"].indexOf(g)>-1&&(g="custom"),g)for(S=-1,i=0,r=this._numberFormat.length;i<r;i++)if(g===this._numberFormat[i].value.toLowerCase()){S=i;break}if(t.isNullOrUndefined(f)||(f._initValue=!0,S>-1?f.option({selectedItemIndex:S}):!t.isNullOrUndefined(f.selectedIndexValue)&&0!=f.selectedIndexValue&&f.option({selectedItemIndex:0}),f._initValue=!1),p){if(S=-1,!t.isNullOrUndefined(p["font-size"]))for(i=0,r=this._fontSize.length;i<r;i++)if(p["font-size"]===this._fontSize[i].value){S=i;break}if(!t.isNullOrUndefined(b)&&(b._initValue=!0,S>-1?b.option({selectedItemIndex:S})||(S=-1):!t.isNullOrUndefined(b.selectedIndexValue)&&3!=b.selectedIndexValue&&b.option({selectedItemIndex:3}),b._initValue=!1,S=-1,!t.isNullOrUndefined(p["font-family"])))for(i=0,r=this._fontFamily.length;i<r;i++)if(p["font-family"]===this._fontFamily[i].text.toLowerCase()){S=i;break}t.isNullOrUndefined(C)||(C._initValue=!0,S>-1?C.option({selectedItemIndex:S}):!t.isNullOrUndefined(C.selectedIndexValue)&&6!=C.selectedIndexValue&&C.option({selectedItemIndex:6}),C._initValue=!1),e("#"+s._id+"_Ribbon_Home_Font_Bold").length&&("bold"==p["font-weight"]?e("#"+s._id+"_Ribbon_Home_Font_Bold").data("ejToggleButton").option("toggleState",!0):e("#"+s._id+"_Ribbon_Home_Font_Bold").data("ejToggleButton").option("toggleState",!1)),e("#"+s._id+"_Ribbon_Home_Font_Italic").length&&("italic"==p["font-style"]?e("#"+s._id+"_Ribbon_Home_Font_Italic").data("ejToggleButton").option("toggleState",!0):e("#"+s._id+"_Ribbon_Home_Font_Italic").data("ejToggleButton").option("toggleState",!1)),p["text-decoration"]=p["text-decoration"]||"",e("#"+s._id+"_Ribbon_Home_Font_Underline").length&&e("#"+s._id+"_Ribbon_Home_Font_Underline").data("ejToggleButton").option("toggleState",-1!==p["text-decoration"].indexOf("underline")),e("#"+s._id+"_Ribbon_Home_Font_StrikeThrough").length&&e("#"+s._id+"_Ribbon_Home_Font_StrikeThrough").data("ejToggleButton").option("toggleState",-1!==p["text-decoration"].indexOf("line-through")),this._tglAlignBtn(e(s.element).find(".e-text-align"),p,"text-align"),this._tglAlignBtn(e(s.element).find(".e-vertical-align"),p,"vertical-align").isVertical||(_=s.element.find("#"+s._id+"_Ribbon_Home_Alignment_BottomAlign")).length&&(_.data("ejToggleButton").option("toggleState",!0),_.addClass("e-vertical-align")),s.getSheetElement(o).find(".e-ss-activeimg").length>0&&((_=s.element.find("#"+s._id+"_Ribbon_Home_Alignment_Merge")).length&&_.data("ejSplitButton").option("enabled",!1))}break;case s._getLocStr("REVIEW"):n=e("#"+s._id+"_Ribbon_Review_Changes_LockCell"),!s.model.allowLockCell||s.XLComment&&s.XLComment._isCommentEdit||s.XLEdit._isEdit||s._isSheetRename||!n.length||(h=n.data("ejToggleButton"),d=s.XLEdit.getPropertyValue(a._activeCell.rowIndex,a._activeCell.colIndex,"isLocked"),s.isUndefined(d)&&(d=!1),h.option("toggleState",d),e("#"+s._id+"_Ribbon_Review_Changes_ProtectSheet").length&&e("#"+s._id+"_Ribbon_Review_Changes_ProtectSheet").data("ejToggleButton").option("toggleState",a.isSheetProtected),a.isSheetProtected?h.disable():h.enable()),a.isSheetProtected&&s.model.allowLockCell||!s.model.allowComments||s.XLComment._isCommentEdit||s.XLEdit._isEdit||s._isSheetRename||s.XLComment._updateCmntRibIcons(s.getActiveCell())}!s.model.allowLockCell||a.isSheetProtected||!s.model.allowComments||s.XLComment._isCommentEdit||s._isSheetRename||this._refreshRibbonIcons(v),s.model.isReadOnly&&s._readOnly()}},_tglAlignBtn:function(e,i,r){var l,n=!1,s=this.XLObj;return t.isNullOrUndefined(e[0])||((l=s.element.find("#"+e[0].id)).length&&l.data("ejToggleButton").option("toggleState",!1),e.removeClass("e-"+r)),t.isNullOrUndefined(i[r])||((l="vertical-align"===r?s.element.find("#"+s._id+"_Ribbon_Home_Alignment_"+i[r].charAt(0).toUpperCase()+i[r].slice(1)+"Align"):s.element.find("#"+s._id+"_Ribbon_Home_Alignment_Align"+i[r].charAt(0).toUpperCase()+i[r].slice(1))).length&&(l.data("ejToggleButton").option("toggleState",!0),l.addClass("e-"+r)),"vertical-align"===r&&(n=!0)),{isVertical:n}},_disableButtons:function(e,i){for(var r,l=-1,n=this.XLObj,s=0,o=e.length;s<o;s++)n.model.allowLockCell&&(n.XLEdit._isEdit||n._isSheetRename||!n.getSheet(n.getActiveSheetIndex()).isSheetProtected||(l=this._protectStateBtnIds.indexOf(e[s]))),-1===l&&((r=n.element.find("#"+n._id+"_Ribbon_"+e[s])).length&&!t.isNullOrUndefined(r.data(i))&&r.data(i).disable())},_enableButtons:function(e,i){for(var r,l=0,n=this.XLObj,s=0,o=e.length;s<o;s++)n.model.allowLockCell&&!n._isSheetRename&&n.getSheet(n.getActiveSheetIndex()).isSheetProtected&&(l=this._protectStateBtnIds.indexOf(e[s])),l>-1&&((r=n.element.find("#"+n._id+"_Ribbon_"+e[s])).length&&!t.isNullOrUndefined(r.data(i))&&r.data(i).enable())},_disableInputs:function(t,i){for(var r=0,l=t.length;r<l;r++)e("#"+this.XLObj._id+"_"+t[r]).attr("disabled",i)},_enableRibbonIcons:function(t){if(this.XLObj.model.showRibbon){var i,r,l,n,s,o,a=this.XLObj,d=e("#"+a._id+"_Ribbon").data("ejRibbon"),h=a.getActiveSheetIndex(),c=a.getSheet(h)._filterColl;switch(i=t||d.model.selectedItemIndex,d.getTabText(i)){case a._getLocStr("HOME"):this._enableButtons(this._homeBtnIds,"ejButton"),this._enableButtons(this._homeSptBtnIds,"ejSplitButton"),this._enableButtons(this._homeToggleBtnIds,"ejToggleButton"),this._enableButtons(this._homeDdIds,"ejDropDownList"),this._enableButtons(this._homeCpIds,"ejColorPicker"),a._removeClass(d.element.find("#"+d._id+"_Number_e-groupexpander")[0],"e-disable");break;case a._getLocStr("INSERT"):this._enableButtons(this._insertBtnIds,"ejButton"),this._enableButtons(this._insertSptBtnIds,"ejSplitButton");break;case a._getLocStr("DATATAB"):this._enableButtons(this._dataBtnIds,"ejButton"),this._enableButtons(this._dataSptBtnIds,"ejSplitButton");break;case a._getLocStr("PAGELAYOUT"):this._enableButtons(this._pageLayBtnIds,"ejButton"),this._enableButtons(this._pageLaySptBtnIds,"ejSplitButton"),this._enableButtons(this._pageLayChckBxIds,"ejCheckBox"),e("#"+d._id+"_pagesetup_viewhdrlbl").eq(0).removeClass("e-disable"),e("#"+d._id+"_pagesetup_viewgrdlnlbl").eq(0).removeClass("e-disable");break;case a._getLocStr("REVIEW"):a.model.allowComments&&!a.XLComment._isCommentEdit&&a.XLComment._updateCmntRibIcons(),this._enableButtons(this._reviewTglBtnIds,"ejToggleButton");break;case a._getLocStr("OTHERS"):this._enableButtons(this._othersBtnIds,"ejButton"),this._enableButtons(this._othersSptBtnIds,"ejSplitButton");break;case a._getLocStr("Design"):this._enableButtons(this._contextualBtnIds,"ejButton"),this._enableButtons(this._contextualCheckBoxIds,"ejCheckBox"),this._disableInputs(this._contextualInputIds,!1)}for(a.XLClipboard._copyBackup.cells||a.XLClipboard._copyBackup.elem||a.XLRibbon._disableButtons(["Home_Clipboard_Paste"],"ejButton")||a.XLRibbon._disableButtons(["Home_Clipboard_PasteOptions"],"ejSplitButton"),e.isEmptyObject(c)&&this._disableButtons(["Data_SortFilter_ClearFilter"],"ejButton"),l=0,s=(o=a.getObjectKeys(c)).length;l<s;l++)for(n=0,s=(r=a.getObjectKeys(c[o[l]])).length;n<s;n++)c[o[l]][r[n]].status.indexOf("e-ssfiltered")<0&&this._disableButtons(["Data_SortFilter_ClearFilter"],"ejButton");a._updateUndoRedoIcons()}},_disableRibbonIcons:function(){var t,i=this.XLObj;if(i.model.showRibbon)switch((t=e("#"+i._id+"_Ribbon").data("ejRibbon")).getTabText(t.model.selectedItemIndex)){case i._getLocStr("HOME"):this._disableButtons(this._homeBtnIds,"ejButton"),this._disableButtons(this._homeSptBtnIds,"ejSplitButton"),this._disableButtons(this._homeToggleBtnIds,"ejToggleButton"),this._disableButtons(this._homeDdIds,"ejDropDownList"),this._disableButtons(this._homeCpIds,"ejColorPicker"),i.addClass(t.element.find("#"+t._id+"_Number_e-groupexpander"),"e-disable");break;case i._getLocStr("INSERT"):this._disableButtons(this._insertBtnIds,"ejButton"),this._disableButtons(this._insertSptBtnIds,"ejSplitButton");break;case i._getLocStr("DATATAB"):this._disableButtons(this._dataBtnIds,"ejButton"),this._disableButtons(this._dataSptBtnIds,"ejSplitButton");break;case i._getLocStr("PAGELAYOUT"):this._disableButtons(this._pageLayBtnIds,"ejButton"),this._disableButtons(this._pageLaySptBtnIds,"ejSplitButton"),this._disableButtons(this._pageLayChckBxIds,"ejCheckBox"),e("#"+t._id+"_pagesetup_viewhdrlbl:eq(0)").addClass("e-disable"),e("#"+t._id+"_pagesetup_viewgrdlnlbl:eq(0)").addClass("e-disable");break;case i._getLocStr("REVIEW"):this._disableButtons(this._cmntBtnIds,"ejButton"),this._disableButtons(this._cmntTglBtnIds,"ejToggleButton"),this._disableButtons(this._reviewTglBtnIds,"ejToggleButton");break;case i._getLocStr("OTHERS"):this._disableButtons(this._othersBtnIds,"ejButton"),this._disableButtons(this._othersSptBtnIds,"ejSplitButton");break;case this.XLObj._getLocStr("Design"):this._disableButtons(this._contextualBtnIds,"ejButton"),this._disableButtons(this._contextualCheckBoxIds,"ejCheckBox"),this._disableInputs(this._contextualInputIds,!0)}},_capitalize:function(e){return e[0].toUpperCase()+e.slice(1)},_generateToggleBtn:function(e,i,r,l,n,s,o,a,d,h,c,u,g,p,m){var _=a instanceof Array?this.XLObj._getLocStr(a[0])+"<br /><br />"+this.XLObj._getLocStr(a[1]):this.XLObj._getLocStr(a);return{id:e,toolTip:this.XLObj._getLocStr(i),type:t.Ribbon.type.toggleButton,enableSeparator:d,toggleButtonSettings:{width:s,height:o,contentType:r,cssClass:h,toggleState:p,defaultPrefixIcon:l,activePrefixIcon:g||l,defaultText:this.XLObj._getLocStr(i),activeText:u?this.XLObj._getLocStr(u):this.XLObj._getLocStr(i),imagePosition:"imagetop"==c?t.ImagePosition.ImageTop:t.ImagePosition.ImageLeft,click:this._ribbonClickHandler},customToolTip:{title:m?this.XLObj._getLocStr(n)+m:this.XLObj._getLocStr(n),content:"<h6>"+_+"</h6>"}}},_generateBtn:function(e,i,r,l,n,s,o,a,d,h,c,u){var g=a instanceof Array?this.XLObj._getLocStr(a[0])+"<br /><br />"+this.XLObj._getLocStr(a[1]):this.XLObj._getLocStr(a);return{id:e,text:this.XLObj._getLocStr(i),toolTip:this.XLObj._getLocStr(i),cssClass:c,enableSeparator:d,buttonSettings:{type:t.Ribbon.type.button,contentType:r,width:n,height:s,imagePosition:"imagetop"==h?t.ImagePosition.ImageTop:t.ImagePosition.ImageLeft,prefixIcon:l,click:this._ribbonClickHandler},customToolTip:{title:u?this.XLObj._getLocStr(o)+u:this.XLObj._getLocStr(o),content:"<h6>"+g+"</h6>"}}},_generateDD:function(e,i,r,l,n,s,o,a){return{id:e,text:this.XLObj._getLocStr(i),toolTip:this.XLObj._getLocStr(i),type:t.Ribbon.type.dropDownList,dropdownSettings:{dataSource:r,value:l,change:this._ribbonClickHandler,width:n,height:s-1,cssClass:"e-"+this.XLObj._id+"-ddl"},customToolTip:{title:this.XLObj._getLocStr(o),content:"<h6>"+this.XLObj._getLocStr(a)+"</h6>"}}},_generateCustomControl:function(e,i,r,l){return{type:t.Ribbon.type.custom,contentID:e,toolTip:this.XLObj._getLocStr(i),click:this._ribbonClickHandler,change:this._ribbonClickHandler,customToolTip:{title:this.XLObj._getLocStr(r),content:"<h6>"+this.XLObj._getLocStr(l)+"</h6>"}}},_generateSplitBtn:function(i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f){var b=_ instanceof Array?this.XLObj._getLocStr(_[0])+"<br /><br />"+this.XLObj._getLocStr(_[1]):this.XLObj._getLocStr(_);return{id:i,toolTip:this.XLObj._getLocStr(r),text:this.XLObj._getLocStr(r),type:t.Ribbon.type.splitButton,cssClass:p+" e-"+this.XLObj._id+"-spltbtn",enableSeparator:a,splitButtonSettings:{contentType:l,targetID:n,arrowPosition:"bottom"==c?t.ArrowPosition.Bottom:t.ArrowPosition.Right,imagePosition:"imagetop"==u?t.ImagePosition.ImageTop:t.ImagePosition.ImageLeft,buttonMode:"dropdown"==g?t.ButtonMode.Dropdown:t.ButtonMode.Split,fields:s,prefixIcon:o,click:this._ribbonClickHandler,itemSelected:this._ribbonClickHandler,height:h,width:d,beforeOpen:e.proxy(this._splitBeforeOpen,this,i),close:e.proxy(this._splitbtnClose,this,i)},customToolTip:{title:f?this.XLObj._getLocStr(m)+f:this.XLObj._getLocStr(m),content:"<h6>"+b+"</h6>"}}},_splitBeforeOpen:function(i,r){var l,n=this.XLObj;if("Home_Editing_SortFilter"===i)this._sfbeforeOpen(r);else if("Others_Cells_InsertCellOptions"===i||"Others_Cells_DeleteCellOptions"===i)this._insdelbeforOpen(r);else if("Others_Window_FreezePanes"===i)this._fpbeforeOpen(r);else if("ChartDesign_ChartLayouts_AddChartElement"===i)this._celementpbeforeOpen(r);else if("Data_DataTools_DataValidationOptions"===i||"Home_Clipboard_PasteOptions"===i)this._validpasteOpen(r);else if("Home_Editing_Clear"===i)this._clearbeforeOpen(r);else if("Home_Styles_FormatAsTable"===i)(l=document.getElementById(n._id+"_formatastable"))&&(!l||l.children.length)||this._renderFormatAsTable(),n.XLFormat._resizeFormatTableMenu();else if("Home_Styles_CellStyles"===i)n.XLFormat._resizeStyleMenu();else if("Home_Font_Border"===i){n.XLFormat._resizeBorderMenu(r),this._renderBorderCP(r);var s,o=window.innerHeight,a=e("#"+this.XLObj._id+"_Ribbon_Home_Font_Border")[0].getBoundingClientRect(),d=e("#"+this.XLObj._id+"_Ribbon_Border"),h=d.data("ejMenu"),c=d.find("#"+this.XLObj._id+"_customup")[0],u=d.find("#"+this.XLObj._id+"_customdown")[0],g=d.children(),p=g.length,m=Math.round((o-(a.top+a.height))/26);if(26*p>o-(a.top+a.height)){for(t.isNullOrUndefined(c)&&t.isNullOrUndefined(u)&&(h.insert([{id:this.XLObj._id+"_customdown",parentId:null,text:" ",spriteCssClass:"e-icon e-chevron-down"}],"#"+this.XLObj._id+"_Ribbon_Border"),h.insertBefore([{id:this.XLObj._id+"_customup",parentId:null,text:" ",spriteCssClass:"e-icon e-chevron-up"}],"#"+this.XLObj._id+"_Ribbon_Border"),c=d.find("#"+this.XLObj._id+"_customup")[0],u=d.find("#"+this.XLObj._id+"_customdown")[0],"msie"===n._browserDetails.name&&"8.0"===n._browserDetails.version?(c.attachEvent("onclick",this._menuclick,!0),u.attachEvent("onclick",this._menuclick,!0)):(c.addEventListener("click",this._menuclick,!0),u.addEventListener("click",this._menuclick,!0)),n.addClass(c.querySelector("span"),"e-customup"),n.addClass(u.querySelector("span"),"e-customup")),s=1;s<p-1;s++)n.addClass(g[s],"e-hide");for(s=0;s<m-2;s++)n._removeClass(g[s],"e-hide");h.disableItemByID(c.id),h.enableItemByID(u.id)}else t.isNullOrUndefined(c)||t.isNullOrUndefined(u)||(n.addClass(c,"e-hide"),n.addClass(u,"e-hide"))}else"Home_Styles_ConditionalFormatting"===i?(e("#"+n._id+"_CFormat").width(200),n._phoneMode?e("#"+n._id+"_CFormat").find("ul").addClass("e-adaptive"):e("#"+n._id+"_CFormat").find("ul").removeClass("e-adaptive")):"Others_CalCulation_CalculationOptions"==i&&(n._calcEngine.getCalculatingSuspended()?(e("#"+n._id+"_CalcManual").find("span").addClass("e-ss-calcauto"),e("#"+n._id+"_CalcAuto").find("span").removeClass("e-ss-calcauto")):(e("#"+n._id+"_CalcAuto").find("span").addClass("e-ss-calcauto"),e("#"+n._id+"_CalcManual").find("span").removeClass("e-ss-calcauto")))},_menuclick:function(t){if(t.stopImmediatePropagation(),t.target){var i,r=t.currentTarget,l=e("#"+r.parentElement.id),n=l.children(),s=l.data("ejMenu"),o=l.children()[0],a=l.children()[18],d=e("#"+r.parentElement.id).find("li:visible"),h=d[d.length-2],c=e(h).index(),u=d[1],g=e(u).index();if(t.currentTarget.id.indexOf("customup")>0)if("bottom"!=u.id){for(i=1;i<3;i++)d.eq(d.length-(i+1)).addClass("e-hide"),n.eq(g-i).removeClass("e-hide");e(a).hasClass("e-disable-item")&&s.enableItemByID(a.id)}else"bottom"==u.id&&s.disableItemByID(o.id);else if(-1==h.id.indexOf("borderstyle")){for(i=1;i<3;i++)d.eq(i).addClass("e-hide"),n.eq(c+i).removeClass("e-hide");e(o).hasClass("e-disable-item")&&s.enableItemByID(o.id)}else h.id.indexOf("borderstyle")>-1&&s.disableItemByID(a.id)}},_renderBorderCP:function(){var t=this.XLObj._id,i=t+"_Ribbon_Home_Font_";e("#"+i+"BorderColor").data("ejColorPicker")||(e("#"+i+"BorderColor").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:this._ribbonClickHandler}),e("#"+i+"BorderColorWrapper").hide(),e("#"+t+"_bordercolor ul li").find("a").remove(),e("#"+t+"_bordercolor ul li").append(e("#"+i+"BorderColor_popup")),e("#"+i+"BorderColor_popup").css({display:"block"}))},_splitbtnClose:function(t){if("Home_Font_Border"==t){var i=e("#"+this.XLObj._id+"_Ribbon_Border"),r=i.data("ejMenu"),l=i.children(),n=i.children().length;l.removeClass("e-hide"),e(l[0]).hasClass("e-disable-item")&&r.enableItemByID(l[0].id),e(l[n-1]).hasClass("e-disable-item")&&r.enableItemByID(l[n-1].id)}else this.XLObj.element.find("#"+this.XLObj._id+"_Ribbon_"+t).parents("div.e-controlpadding").siblings().children("button").removeClass("e-active")},_fpbeforeOpen:function(){var t=this.XLObj,i=e("#"+t._id+"_Ribbon_FPane").data("ejMenu"),r=i.model.fields.dataSource.slice(0);t.getSheet()._isFreezed?(r[0].id="UnFreezePanes",r[0].text=t._getLocStr("UnFreezePanes")):(r[0].id="freezePanes",r[0].text=t._getLocStr("FreezePanes")),i.option("fields",{id:"id",dataSource:r,parentId:"parentId"})},_sfbeforeOpen:function(){var t=this.XLObj,i=e("#"+t._id+"_Ribbon_SortFilter").data("ejMenu");t.model.allowFiltering||i.disableItemByID("Ribbon_Filter"),t.model.allowSorting||(i.disableItemByID("Ribbon_SortAtoZ"),i.disableItemByID("Ribbon_SortZtoA")),this._refreshRibbonIcons(),this._isFilterSelect.isFiltered?i.enableItemByID("Ribbon_ClearFilter"):i.disableItemByID("Ribbon_ClearFilter")},_validpasteOpen:function(t){var i,r=this.XLObj;t.model.targetID===r._id+"_Ribbon_Validation"?r.element.find("#"+r._id+"_Ribbon_Data_DataTools_DataValidation").addClass("e-active"):(i=e("#"+r._id+"_Ribbon_Paste").data("ejMenu"),r.element.find("#"+r._id+"_Ribbon_Home_Clipboard_Paste").addClass("e-active"),r.isPasteValuesOnly?i.disableItemByID("PasteSpecial"):i.enableItemByID("PasteSpecial"))},_insdelbeforOpen:function(t){var i,r,l,n,s=this.XLObj,o=e("#"+s._id+"_Ribbon_Ins").data("ejMenu"),a=e("#"+s._id+"_Ribbon_Del").data("ejMenu"),d=["DeleteCells","DeleteSheetRows","DeleteSheetColumns"],h=["InsertCells","InsertSheetRows","InsertSheetColumns"];if(t.model.targetID===s._id+"_Ribbon_Ins"?s.element.find("#"+s._id+"_Ribbon_Others_Cells_InsertCell").addClass("e-active"):s.element.find("#"+s._id+"_Ribbon_Others_Cells_DeleteCell").addClass("e-active"),i=s.element.find(".e-colselected").length?"disableItemByID":"enableItemByID",o&&o[i]("InsertSheetRows"),a&&a[i]("DeleteSheetRows"),r=s.element.find(".e-rowselected").length?"disableItemByID":"enableItemByID",o&&o[r]("InsertSheetColumns"),a&&a[r]("DeleteSheetColumns"),l=s.model.exportSettings.password?"disableItemByID":"enableItemByID",o&&o[l]("InsertSheet"),a&&a[l]("DeleteSheet"),s.getSheet(s.getActiveSheetIndex()).isSheetProtected)for(n=0;n<3;n++)a&&a.disableItemByID(d[n]),o&&o.disableItemByID(h[n]);else a&&a.enableItemByID("DeleteCells"),o&&o.enableItemByID("InsertCells")},_celementpbeforeOpen:function(){var t,i=this.XLObj,r=e("#"+i._id+"_chart").val(),l=i.XLChart._getShapeObj(r,"chart").type,n=e("#"+i._id+"_Ribbon_CElement").data("ejMenu"),s=["Axes","AxisTitle","Gridline"],o=["AxisTitle","PMinorH","PMinorV"],a=["Axes","AxisTitle","Gridline","PMinorH","PMinorV"],d=0;if(n)return!1;for(t=0,d=a.length;t<d;t++)n.enableItemByID(a[t]);if("pie"===l||"doughnut"===l)for(t=0,d=s.length;t<d;t++)n.disableItemByID(s[t]);else if("radar"===l)for(t=0,d=o.length;t<d;t++)n.disableItemByID(o[t])},_clearbeforeOpen:function(){var t=this.XLObj,i=0,r=e("#"+t._id+"_Ribbon_Clear").data("ejMenu"),l=["Clear_Hyperlinks","Clear_Comments"];if(t.model.allowLockCell)if(t.getSheet(t.getActiveSheetIndex()).isSheetProtected)for(;i<l.length;)r.disableItemByID(l[i]),i++;else for(;i<l.length;)r.enableItemByID(l[i]),i++},_changeClrFltrStatus:function(e,t){this.XLObj.isUndefined(e)||(this._isFilterSelect.isFiltered?"menu"===t?e._id.indexOf("Ribbon")>-1?e.enableItemByID("Ribbon_ClearFilter"):e.enableItemByID("ClearFilter"):e.enable():"menu"===t?e._id.indexOf("Ribbon")>-1?e.disableItemByID("Ribbon_ClearFilter"):e.disableItemByID("ClearFilter"):e.disable())},_onControlCreated:function(){this._ctrlCreated=!0,this.XLObj.model.ribbonSettings.enableOnDemand||(this._homeTabControls(),this._othersTabControls(),this._pageTabControls(),this._appTabControls()),this._hideTabs(),this._ctrlCreated=!1},_appTabControls:function(){var t=this.XLObj,i=t._id,r={height:158,width:163,text:t._getLocStr("BlankWorkbook"),contentType:"textandimage",imagePosition:"imagetop",prefixIcon:"e-ss-blank",click:e.proxy(this._onBackStageItemClick,this)};e("#"+i+"_bstab_new_blank").ejButton(r),delete r.text,r.height=r.width=72,r.prefixIcon="e-icon e-ss-exportxl",e("#"+i+"_bstab_saveas_excel").ejButton(r),r.prefixIcon="e-icon e-ss-exportcsv",e("#"+i+"_bstab_saveas_csv").ejButton(r),r.prefixIcon="e-icon e-ss-exportpdf",e("#"+i+"_bstab_saveas_pdf").ejButton(r),r.prefixIcon="e-icon e-ss-print",e("#"+i+"_bstab_print_sheet").ejButton(r),r.prefixIcon="e-icon e-ss-printselected",e("#"+i+"_bstab_print_selected").ejButton(r)},_othersTabControls:function(){var e=this.XLObj;!e.model.allowInsert&&e.model.scrollSettings.allowScrolling&&(this._disableButtons(["Others_Cells_InsertCellOptions"],"ejSplitButton"),this._disableButtons(["Others_Cells_InsertCell"],"ejButton")),!e.model.allowDelete&&e.model.scrollSettings.allowScrolling&&(this._disableButtons(["Others_Cells_DeleteCellOptions"],"ejSplitButton"),this._disableButtons(["Others_Cells_DeleteCell"],"ejButton"))},_pageTabControls:function(){var t=this.XLObj,i=t._id,r=i+"_Ribbon_pagesetup",l=i+"_Ribbon_PageLayout_Show_";e("#"+r+"left").show(),e("#"+l+"Headings").ejCheckBox({change:this._ribbonClickHandler,checked:!0}),e("#"+l+"Gridlines").ejCheckBox({change:this._ribbonClickHandler,checked:!0}),e("#"+r+"_viewhdrlbl").text(t._getLocStr("Heading")),e("#"+r+"_viewgrdlnlbl").text(t._getLocStr("Gridlines"))},_homeTabControls:function(){var t=this.XLObj,i=t._id+"_Ribbon_",r=i+"Home_Font_";e("#"+r+"FillColor").ejColorPicker({value:"#FFFF00",locale:t.model.locale,modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",toolIcon:"e-ss-backgroundcolor e-icon",open:e.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FillColor"),change:e.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FillColor"),select:e.proxy(this._cpClickHandler,this,"Ribbon_Home_Font_FillColor")}),e("#"+r+"FontColor").ejColorPicker({value:"#FF0000",locale:t.model.locale,modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",toolIcon:"e-ss-fontcolor e-icon",open:e.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FontColor"),change:e.proxy(this._colorPickerHandler,this,"Ribbon_Home_Font_FontColor"),select:e.proxy(this._cpClickHandler,this,"Ribbon_Home_Font_FontColor")}),e("#"+i+"BorderCP").ejColorPicker({value:"#278787",displayInline:!0,modelType:"picker"}),e("#"+i+"BorderCP_Presets").hide(),e("#"+i+"Border").addClass("e-spreadsheet e-border"),e("#"+r+"FontColor_Presets").css({top:"40px"}),e("#"+r+"FillColor_Presets").css({top:"40px"}),this._disableButtons(["Home_Clipboard_Paste"],"ejButton"),this._disableButtons(["Home_Clipboard_PasteOptions","Others_Formulas_UseInFormula"],"ejSplitButton"),e("#"+r+"FillColor_popup").find(".e-buttons, .e-button").hide(),e("#"+r+"FontColor_popup").find(".e-buttons, .e-button").hide()},_hideRibbonElem:function(t){var i,r,l=this.XLObj,n=l._id,s=e("#"+l._id+"_Ribbon").data("ejRibbon"),o=l.model,a=s.element,d=n+"_Ribbon",h=d+"_home_Clipboard_Home_Clipboard_",c=d+"_home_Alignment_Home_Alignment_",u=d+"_separator_Home_Alignment_",g=d+"_home_Styles_Home_Styles_",p=d+"_home_Font_Home_Font_",m=d+"_home_Number_Home_Number_",_=d+"_home_Editing_Home_Editing_",f=d+"_insert_",b=d+"_data_",C=d+"_pagelayout_PageLayout",S=d+"_review_Changes_Review_Changes_",x=d+"_others_";switch(o.allowFormulaBar||l.hideFormulaBar(),"menu"===l.model.ribbonSettings.applicationTab.type&&(i=e("#"+n+"_Menu").data("ejMenu")),t){case l._getLocStr("HOME"):o.allowAutoSum||o.allowFiltering||o.allowUndoRedo||o.allowSorting||o.allowClipboard||o.allowFormatPainter||o.allowCellFormatting||o.allowMerging||o.allowWrap||o.allowConditionalFormats||o.allowFormatAsTable||s.hideTab(l._getLocStr("HOME")),o.allowFormatPainter||a.find("#"+h+"FormatPainter").hide(),o.allowClipboard||(a.find("#"+d+"_home_Clipboard_1").hide(),a.find("#"+h+"Cut").hide(),a.find("#"+h+"Copy").hide()),o.allowClipboard||o.allowFormatPainter||a.find("#"+d+"_home_Clipboard").hide(),o.allowCellFormatting||(a.find("#"+d+"_home_Font").hide(),a.find("#"+d+"_home_Number").hide(),a.find("#"+c+"TopAlign").hide(),a.find("#"+c+"MiddleAlign").hide(),a.find("#"+c+"BottomAlign").hide(),a.find("#"+u+"BottomAlign").hide(),a.find("#"+c+"AlignLeft").hide(),a.find("#"+c+"AlignCenter").hide(),a.find("#"+c+"AlignRight").hide(),a.find("#"+u+"AlignRight").hide(),a.find("#"+c+"DecreaseIndent").hide(),a.find("#"+c+"IncreaseIndent").hide(),a.find("#"+u+"IncreaseIndent").hide(),a.find("#"+g+"CellStyles").hide(),o.allowConditionalFormats||o.allowFormatAsTable||a.find("#"+d+"_home_Styles").hide()),o.allowCellFormatting&&(o.formatSettings.allowFontFamily||a.find("#"+p+"FontFamily").hide(),o.formatSettings.allowDecimalPlaces||(a.find("#"+m+"IncreaseDecimal").hide(),a.find("#"+m+"DecreaseDecimal").hide(),a.find("#"+d+"_separator_Home_Number_CommaStyle").hide()),o.formatSettings.allowCellBorder||a.find("#"+p+"Border").hide()),o.allowMerging||a.find("#"+c+"Merge").hide(),o.allowWrap||a.find("#"+c+"WrapText").hide(),o.allowUndoRedo||a.find("#"+d+"_home_Actions").hide(),o.allowFormatAsTable||a.find("#"+g+"FormatAsTable").hide(),o.allowConditionalFormats||o.allowFormatAsTable||o.allowCellFormatting||a.find("#"+d+"_home_Styles").hide(),o.allowConditionalFormats||a.find("#"+g+"ConditionalFormatting").hide(),o.allowEditing&&(o.allowAutoSum||a.find("#"+_+"AutoSum").hide(),o.allowSorting||o.allowFiltering||a.find("#"+l._id+"_Ribbon_home_Editing_1").hide()),o.allowAutoSum||a.find("#"+_+"AutoSum").hide(),o.allowClear||a.find("#"+_+"Clear").hide();break;case l._getLocStr("INSERT"):o.allowFormatAsTable||o.allowPictures||o.allowHyperlink||o.allowCharts||o.allowSparkline||s.hideTab(l._getLocStr("INSERT")),o.enablePivotTable||o.allowFormatAsTable?o.enablePivotTable?o.allowFormatAsTable||a.find("#"+f+"Tables_Insert_Tables_Table").hide():a.find("#"+f+"Tables_Insert_Tables_PivotTable").hide():(a.find("#"+f+"Tables").hide(),a.find("#"+g+"FormatAsTable").hide(),a.find("#"+f+"Tables_Insert_Tables_PivotTable").hide()),o.pictureSettings.allowPictures||a.find("#"+f+"Illustrations").hide(),o.allowHyperlink||a.find("#"+f+"Links").hide(),o.allowCharts||a.find("#"+f+"Charts").hide(),o.allowSparkline||a.find("#"+f+"SparklineCharts").hide(),o.allowFormatAsTable||o.enablePivotTable||a.find("#"+f+"Tables").hide();break;case l._getLocStr("DATATAB"):o.allowDataValidation||o.allowFiltering||o.allowSorting||s.hideTab(l._getLocStr("DATATAB")),o.allowFiltering||a.find("#"+b+"SortFilter_2").hide(),o.allowSorting||a.find("#"+b+"SortFilter_1").hide(),o.allowDataValidation||a.find("#"+b+"DataTools").hide(),o.allowFiltering||o.allowSorting||a.find("#"+b+"Sort").hide();break;case l._getLocStr("PAGELAYOUT"):o.printSettings.allowPrinting||s.hideTab(l._getLocStr("PAGELAYOUT")),o.printSettings.allowPrinting||a.find("#"+C+"Print_Print").hide(),o.printSettings.allowPageSize||a.find("#"+C).hide(),o.allowComments||o.allowLockCell||s.hideTab(l._getLocStr("REVIEW")),o.allowLockCell||(a.find("#"+S+"ProtectSheet").hide(),a.find("#"+S+"LockCell").hide()),o.allowComments||a.find("#"+d+"_review_Comments").hide();break;case l._getLocStr("OTHERS"):o.allowFreezing||o.allowInsert||o.allowDelete||o.allowSearching||s.hideTab(l._getLocStr("OTHERS")),o.allowInsert||o.allowDelete||a.find("#"+x+"Cells").hide(),o.allowInsert||a.find("#"+x+"Cells_1").hide(),o.allowDelete||a.find("#"+x+"Cells_2").hide(),o.allowFreezing||(l._phoneMode?a.find("#"+x+"Window_1").hide():a.find("#"+x+"Window").hide()),o.allowSearching||a.find("#"+x+"Editing").hide()}o.allowImport&&o.importSettings.importMapper||(a.find("#open_backStageTab").hide(),i&&i.disableItemByID("Open")),o.serverEvents?((r=o.serverEvents).indexOf("excelExporting")<0&&!o.exportSettings.excelUrl&&(a.find("#"+n+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").hide(),i&&i.disableItemByID("ExportXL")),r.indexOf("csvExporting")<0&&!o.exportSettings.csvUrl&&(a.find("#"+n+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").hide(),i&&i.disableItemByID("ExportCsv")),r.indexOf("pdfExporting")<0&&!o.exportSettings.pdfUrl&&(a.find("#"+n+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").hide(),i&&i.disableItemByID("ExportPdf")),r.length||o.exportSettings.excelUrl||o.exportSettings.csvUrl||o.exportSettings.pdfUrl||(a.find("#saveas_backStageTab").hide(),i&&i.disableItemByID("Save"))):(o.exportSettings.excelUrl||(a.find("#"+n+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(0)").hide(),i&&i.disableItemByID("ExportXL")),o.exportSettings.csvUrl||(a.find("#"+n+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(1)").hide(),i&&i.disableItemByID("ExportCsv")),o.exportSettings.pdfUrl||(a.find("#"+n+"_backstagetabsaveas .e-ssr-bssaveasopt:eq(2)").hide(),i&&i.disableItemByID("ExportPdf")),o.exportSettings.allowExporting&&(o.exportSettings.excelUrl||o.exportSettings.csvUrl||o.exportSettings.pdfUrl)||(a.find("#saveas_backStageTab").hide(),i&&i.disableItemByID("Save"))),o.printSettings.allowPrinting||a.find("#print_backStageTab").hide()},_pictureSizeChange:function(t,i){var r,l=this.XLObj,n=l.getActiveSheetIndex(),s=l.getSheetElement(n).find(".e-ss-activeimg"),o={sheetIndex:n,reqType:"shape",shapeType:"picture",action:"picturesize",name:t,id:e(s).attr("id"),prev:{},cur:{}};l._shapeChange||this._isSetModel||(o.prev={width:s.width(),height:s.height()},"PictureHeight"===t?(r=parseInt(s.height()*i.value/s.width()),s.css({width:i.value,height:r}),o.cur={width:i.value,height:r}):(r=parseInt(s.width()*i.value/s.height()),s.css({height:i.value,width:r}),o.cur={height:i.value,width:r}),this._isSetModel=!0,e("#"+l._id+"_Ribbon_Format_Size_"+t).ejNumericTextbox("option",{value:r}),this._isSetModel=!1,l._completeAction(o),l._trigActionComplete(o),l.XLShape._updateShapeObj(s[0]))},_chartTypeOk:function(){var t,i,r,l,n,s,o=this.XLObj,a=o.element.find("#"+o._id+"_chart").val(),d=e("#"+a).data("ejChart");l=["e-dlgcolumnchart4","e-dlgcolumnchart5","e-dlgcolumnchart6","e-dlgbarchart4","e-dlgbarchart5","e-dlgbarchart6","e-dlgpiechart2"],n=["e-dlgstockchart2","e-dlglinechart2","dlgradarchart2"],s={type:(i=(r=e("#"+o._id+"_allchart").find(".e-chartselect:eq(0)").attr("class").split(" ")[1]).split("e-dlg")[1].split("chart"))[0],enable3D:!1,marker:{visible:!1}},("column"===i[0]||"bar"===i[0]||"area"===i[0])&&("1"===i[1]||"4"===i[1]?s.type=i[0]:"2"===i[1]||"5"===i[1]?s.type="stacking"+i[0]:("3"===i[1]||"6"===i[1])&&(s.type="stacking"+i[0]+"100")),l.indexOf(r)>-1&&(s.enable3D=!0),n.indexOf(r)>-1&&(s.marker={visible:!0}),"e-dlgpiechart3"===r&&(s.type="doughnut"),(t={sheetIndex:o.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:"chartType",chartId:a}).prev={chartType:d.model.series[0].type,enable3D:d.model.enable3D,marker:d.model.series[0].marker.visible},s.series=d.model.series,o.XLChart.refreshChart(a,s),t.cur={chartType:d.model.series[0].type,enable3D:d.model.enable3D,marker:d.model.series[0].marker.visible},e("#"+o._id+"_charttypedlg").ejDialog("close"),o._completeAction(t),o._trigActionComplete(t)},_chartTypeCancel:function(){var t=this.XLObj;e("#"+t._id+"_charttypedlg").ejDialog("close"),t._setSheetFocus()},_chartType:function(t,i,r,l,n,s){for(var o,a,d,h,c="<div class='e-chartcontent'>",u="<div class='e-chartheader'><span>",g=t.toLowerCase(),p={visible:!1},m=this.XLObj,_=m._getLocStr(t),f="2-D",b=0;b<i;b++)c+="<div class='e-ss-"+m._id+" e-chartcell e-"+g+(b+1)+"' title="+s[b]+"></div>",b===r&&(c+="</div>"+u+"3-D "+_+"</span></div><div class='e-chartcontent'>");for(c+="</div>",("ScatterChart"===t||"StockChart"===t||"PieChart"===t)&&(f=""),o=(d=e("<div id="+m._id+"_Ribbon_"+t+" class='e-ss-dialog e-ss-chart e-ss-"+m._id+"' style='height:auto;'>"+u+f+_+"</span></div>"+c+"</div>")).find(".e-chartcell"),b=0;b<i;b++)a=e(o[b]),h=n[b],a.data({type:h,enable3D:!1,marker:p}),b>l&&a.data({type:h,enable3D:!0,marker:p});c=e(d).find(".e-"+g+"2"),("StockChart"===t||"LineChart"===t)&&c.data({marker:{visible:!0}}),"PieChart"===t&&c.data({enable3D:!0}),m.element[0].appendChild(d[0])},autoSum:function(i,r){var l;if(this.XLObj.model.allowAutoSum){var n,s,o=this.XLObj,a=o.XLEdit,d=!1,h=o.getActiveSheetIndex(),c={sheetIndex:h,range:r,calcType:i,reqType:"auto-sum",type:"actionBegin"};if(!o._trigActionBegin(c)&&(r=c.range,i=c.calcType,n=o.getActiveCell(h),!t.isNullOrUndefined(n))){var u,g,p,m,_,f=o.getActiveCell(h),b=o._getRangeArgs(r,"object"),C=o._getSelectedCells(h,b).selCells,S=C.length-1,x=C[S].rowIndex-C[0].rowIndex,v=C[S].colIndex-C[0].colIndex,w={sheetIndex:h,range:r,reqType:"auto-sum",oprType:i,updCell:[]},I=o.getRangeData({range:[C[0].rowIndex,C[0].colIndex,C[S].rowIndex,C[S].colIndex],valueOnly:!0}).length,y=o._dataContainer.sheets[h];if(0!==S&&I)if(0===x&&v>0){for(p=o._getAlphaRange(h,C[0].rowIndex,C[0].colIndex,C[S].rowIndex,C[S].colIndex),m=C[S].rowIndex,_=C[S].colIndex+1,s=this.XLObj.XLEdit.getPropertyValue(m,_,"value2");!t.isNullOrUndefined(s)&&""!=s;)_++,s=this.XLObj.XLEdit.getPropertyValue(m,_,"value2");_===o.getSheet(h).colCount&&o.XLScroll._createNewColumn(h,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"insert"),o._isUndoRedo||w.updCell.push({rowIndex:m,colIndex:_,pObj:{},pValue:t.isNullOrUndefined(o.XLEdit.getPropertyValue(m,_,"value2"))?"":o.XLEdit.getPropertyValue(m,_,"value2")}),t.isNullOrUndefined(y[m])&&(y[m]={}),t.isNullOrUndefined(y[m][_])&&(y[m][_]={}),o._isUndoRedo||e.extend(!0,w.updCell[0].pObj,y[m][_]),o._isRowViewable(h,m)&&o.getCell(m,_,h).addClass("e-ralign"),a._updateCellValue({rowIndex:m,colIndex:_},"="+i+"("+p+")"),"COUNT".indexOf(i)<0&&o._autosumFormatUpdate(o.getRangeData({range:[C[0].rowIndex,C[0].colIndex,C[0].rowIndex,C[0].colIndex]})[0],[m,_,m,_],!1,!1)}else{for(g=C[S].colIndex-C[0].colIndex,m=C[S].rowIndex+1,u=0;u<=g;u++)for(_=C[u].colIndex,s=this.XLObj.XLEdit.getPropertyValue(m,_,"value2"),l=m;!t.isNullOrUndefined(s)&&""!=s;)l=++m,s=this.XLObj.XLEdit.getPropertyValue(m,_,"value2");for(u=0;u<=g;u++)_=C[u].colIndex,m=l,o.XLEdit.getPropertyValue(C[S].rowIndex+1,_,"tableName")&&(m-=1),p=o._getAlphaRange(h,C[0].rowIndex,_,C[S].rowIndex,_),C[S].rowIndex===o.getSheet(h).rowCount-1&&o.XLScroll._createNewRow(h,-1,-1,"insert"),o._isUndoRedo||w.updCell.push({rowIndex:m,colIndex:_,pObj:{},pValue:t.isNullOrUndefined(o.XLEdit.getPropertyValue(m,_,"value2"))?"":o.XLEdit.getPropertyValue(m,_,"value2")}),t.isNullOrUndefined(y[m])&&(y[m]={}),t.isNullOrUndefined(y[m][_])&&(y[m][_]={}),o._isUndoRedo||e.extend(!0,w.updCell[u].pObj,y[m][_]),o._isRowViewable(h,m)&&o.getCell(m,_,h).addClass("e-ralign"),a._updateCellValue({rowIndex:m,colIndex:_},"="+i+"("+p+")"),"COUNT".indexOf(i)<0&&o._autosumFormatUpdate(o.getRangeData({range:[C[0].rowIndex,C[u].colIndex,C[0].rowIndex,C[u].colIndex]})[0],[m,_,m,_],!1,!1)}else m=n.rowIndex,_=n.colIndex,w.updCell.push({rowIndex:m,colIndex:_,pObj:{},pValue:t.isNullOrUndefined(o.XLEdit.getPropertyValue(m,_,"value2"))?"":o.XLEdit.getPropertyValue(m,_,"value2")}),t.isNullOrUndefined(y[m])&&(y[m]={}),t.isNullOrUndefined(y[m][_])&&(y[m][_]={}),e.extend(!0,w.updCell[0].pObj,y[m][_]),o._isRowViewable(h,f.rowIndex)||o.XLScroll._scrollSelectedPosition(h,f),a.editCell(f.rowIndex,f.colIndex,!0),o.model.allowFormulaBar&&o._getInputBox().val("="+i+"()"),o._isRowViewable(h,m)&&(o.XLEdit._editElem.text("="+i+"()"),o.XLEdit._editElem.focusEnd()),d=!0;o.performSelection({rowIndex:b[0],colIndex:b[1]},{rowIndex:m,colIndex:_}),o._isUndoRedo||d||(o._completeAction(w),o._trigActionComplete(w))}}},_openNameManagerDlg:function(){var t,i=this.XLObj;i._showDialog(i._id+"_Ribbon_Others_NameManager"),(t=e("#"+i._id+"_nmgrid").data("ejGrid")).getContentTable().find("td").addClass("e-ss-emptyrecord"),t.model.dataSource.length<1?t.getContentTable().find("td").addClass("e-ss-emptyrecord"):t.getContentTable().find(".e-ss-emptyrecord").removeClass("e-ss-emptyrecord"),this._refreshNMDlg(),"msie"==i._browserDetails.name&&t.refreshContent(),e("#"+i._id+"_nmgrid").focus()},_openFATDlg:function(){var t=this.XLObj;e("#"+t._id+"_fatnamedlg").ejDialog("open"),e("#"+t._id+"_fatheader").ejCheckBox("option","checked",!1),e("#"+t._id+"_fatname").val("Table"+t._tableCnt).focus().setInputPos(e("#"+t._id+"_fatname").val().length)},_dirtySelect:function(){var e,t,i,r=this.XLObj,l=r.getActiveSheetIndex(),n=r.getSheet(l).filterSettings.tableRange,s=!1,o=!1,a=!1,d=!1,h=!1,c=!1,u=!1,g=!1,p=!1,m=!1,_=-2,f=!1,b=!1;if(!r.model.allowLockCell||!r.getSheet(l).isSheetProtected){if((e=r.getSheet(l)._selectedCells).length>0)for(t=0,i=n.length;t<i&&(m=u=a=d=f=!1,p=g=h=c=b=!1,n[t].startRow-1<=e[0].rowIndex&&n[t].endRow>=e[e.length-1].rowIndex?m=!0:n[t].startRow-1>e[0].rowIndex&&e[e.length-1].rowIndex>=n[t].startRow-1&&n[t].endRow>=e[e.length-1].rowIndex?u=!0:n[t].startRow-1<=e[0].rowIndex&&e[0].rowIndex<=n[t].endRow&&n[t].endRow<e[e.length-1].rowIndex?u=!0:n[t].startRow-1>e[e.length-1].rowIndex?a=!0:n[t].endRow<e[0].rowIndex?d=!0:n[t].endRow<e[e.length-1].rowIndex&&n[t].startRow>e[0].rowIndex?f=!0:m=!1,n[t].multifilterIdx[0]<=e[0].colIndex&&n[t].multifilterIdx[n[t].multifilterIdx.length-1]>=e[e.length-1].colIndex?p=!0:n[t].multifilterIdx[0]>e[0].colIndex&&e[e.length-1].colIndex>=n[t].multifilterIdx[0]&&n[t].multifilterIdx[n[t].multifilterIdx.length-1]>=e[e.length-1].colIndex?g=!0:n[t].multifilterIdx[0]<=e[0].colIndex&&e[0].colIndex<=n[t].multifilterIdx[n[t].multifilterIdx.length-1]&&n[t].multifilterIdx[n[t].multifilterIdx.length-1]<e[e.length-1].colIndex?g=!0:n[t].multifilterIdx[0]>e[e.length-1].colIndex?h=!0:n[t].multifilterIdx[n[t].multifilterIdx.length-1]<e[0].colIndex?c=!0:n[t].multifilterIdx[0]>e[0].colIndex&&n[t].multifilterIdx[n[t].multifilterIdx.length-1]<e[e.length-1].colIndex?b=!0:p=!1,!(u&&g||u&&p||m&&g||u&&!c&&!h||g&&!a&&!d||f&&b||m&&b||p&&f)||(s=!0,r.XLSelection._isRowSelected&&m&&(s=!1),r.XLSelection._isColSelected&&p&&(s=!1),!s));t++)s||(_=t,(a||d||h)&&(s=!1),m&&p&&(o=!0));this._isDirtySelect=s,this._isMergeSelect=o||s,this._isFilterSelect={status:o,tableIdx:_,isFiltered:!1}}},_refreshRibbonIcons:function(){var t,i,r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=e("#"+s._id+"_contextMenuCell").data("ejMenu"),d=["Home_Editing_SortFilter","Home_Editing_Clear","Home_Styles_FormatAsTable"],h=["Insert_Tables_Table","Data_SortFilter_Filter","Data_SortFilter_ClearFilter"],c=e("#"+s._id+"_Ribbon_Home_Alignment_Merge").data("ejSplitButton");if(!s.XLEdit._isEdit&&s.getSheetElement(o).find(".e-ss-activeimg").length<1&&c&&c.option("enabled",!this._isMergeSelect),"full"!=s._checkTableRange(s._getRangeArgs()).status&&h.push("Design_Tools_ConvertToRange"),this._isDirtySelect?(this._disableButtons(d,"ejSplitButton"),this._disableButtons(h,"ejButton"),a&&a.disableItemByID("Sort")):s.XLEdit._isEdit||(this._enableButtons(d,"ejSplitButton"),this._enableButtons(h,"ejButton"),!s.model.isReadOnly&&a&&s.model.allowSorting&&a.enableItemByID("Sort")),i=s.getSheet(o).filterSettings.tableRange[this._isFilterSelect.tableIdx],this._isFilterSelect.status&&i)for(l=0,n=(r=i.multifilterIdx).length;l<n;l++)if((t=s.XLEdit.getPropertyValue(i.startRow-1,r[l],"filterState"))&&t.indexOf("filtered")>-1){this._isFilterSelect.isFiltered=!0;break}this._isFilterSelect.isFiltered?this._isDataTabCreate&&this._enableButtons(["Data_SortFilter_ClearFilter"],"ejButton"):this._isDataTabCreate&&this._disableButtons(["Data_SortFilter_ClearFilter"],"ejButton")},_onGroupExpander:function(e){var t=this.XLObj;if(!t.model.isReadOnly&&!t.XLEdit._isEdit&&!t.XLComment._isCommentEdit)switch(e.target.id){case t._id+"_Ribbon_Number_e-groupexpander":t._showDialog(t._id+"_FormatCells")}},disableRibbonItems:function(t){var i,r,l,n,s,o,a,d,h,c=this.XLObj;if(!c.model.isReadOnly)for(l=0,n=t.length;l<n;l++){r=t[l].split("_")[2].toUpperCase(),s=t[l].split("_Ribbon_")[1];do{switch(r){case"HOME":this._homeBtnIds.indexOf(s)>-1?(i="ejButton",this._homeBtnIds.splice(this._homeBtnIds.indexOf(s),1)):this._homeSptBtnIds.indexOf(s)>-1?(i="ejSplitButton",this._homeSptBtnIds.splice(this._homeSptBtnIds.indexOf(s),1)):this._homeToggleBtnIds.indexOf(s)>-1?(i="ejToggleButton",this._homeToggleBtnIds.splice(this._homeToggleBtnIds.indexOf(s),1)):this._homeDdIds.indexOf(s)>-1?(i="ejDropDownList",this._homeDdIds.splice(this._homeDdIds.indexOf(s),1)):this._homeCpIds.indexOf(s)>-1&&(i="ejColorPicker",this._homeCpIds.splice(this._homeCpIds.indexOf(s),1));break;case"INSERT":this._insertBtnIds.indexOf(s)>-1?(i="ejButton",this._insertBtnIds.splice(this._insertBtnIds.indexOf(s),1)):this._insertSptBtnIds.indexOf(s)>-1&&(i="ejSplitButton",this._insertSptBtnIds.splice(this._insertSptBtnIds.indexOf(s),1));break;case"DATA":this._dataBtnIds.indexOf(s)>-1?(i="ejButton",this._dataBtnIds.splice(this._dataBtnIds.indexOf(s),1)):this._dataSptBtnIds.indexOf(s)>-1&&(i="ejSplitButton",this._dataSptBtnIds.splice(this._dataSptBtnIds.indexOf(s),1));break;case"PAGELAYOUT":this._pageLayBtnIds.indexOf(s)>-1?(i="ejButton",this._pageLayBtnIds.splice(this._pageLayBtnIds.indexOf(s),1)):this._pageLaySptBtnIds.indexOf(s)>-1?(i="ejSplitButton",this._pageLaySptBtnIds.splice(this._pageLaySptBtnIds.indexOf(s),1)):this._pageLayChckBxIds.indexOf(s)>-1&&(i="ejCheckBox",this._pageLayChckBxIds.splice(this._pageLayChckBxIds.indexOf(s),1));break;case"REVIEW":this._cmntBtnIds.indexOf(s)>-1?(i="ejButton",this._cmntBtnIds.splice(this._cmntBtnIds.indexOf(s),1)):this._cmntTglBtnIds.indexOf(s)>-1?(i="ejToggleButton",this._cmntTglBtnIds.splice(this._cmntTglBtnIds.indexOf(s),1)):this._reviewTglBtnIds.indexOf(s)>-1&&(i="ejToggleButton",this._reviewTglBtnIds.splice(this._reviewTglBtnIds.indexOf(s),1));break;case"OTHERS":this._othersBtnIds.indexOf(s)>-1?(i="ejButton",this._othersBtnIds.splice(this._othersBtnIds.indexOf(s),1)):this._othersSptBtnIds.indexOf(s)>-1&&(i="ejSplitButton",this._othersSptBtnIds.splice(this._othersSptBtnIds.indexOf(s),1));break;case"FORMAT":this._formatBtnIds.indexOf(s)>-1?(i="ejButton",this._formatBtnIds.splice(this._formatBtnIds.indexOf(s),1)):this._formatSptBtnIds.indexOf(s)>-1&&(i="ejSplitButton",this._formatSptBtnIds.splice(this._formatSptBtnIds.indexOf(s),1));break;case"DESIGN":this._contextualBtnIds.indexOf(s)>-1?(i="ejButton",this._contextualBtnIds.splice(this._contextualBtnIds.indexOf(s),1)):this._contextualCheckBoxIds.indexOf(s)>-1?(i="ejCheckBox",this._contextualCheckBoxIds.splice(this._contextualCheckBoxIds.indexOf(s),1)):this._contextualInputIds.indexOf(s)>-1&&(i=!0);break;case"CHARTDESIGN":this._chartDesignBtnIds.indexOf(s)>-1?(i="ejButton",this._chartDesignBtnIds.splice(this._chartDesignBtnIds.indexOf(s),1)):this._chartDesignSptBtnIds.indexOf(s)>-1?(i="ejSplitButton",this._chartDesignSptBtnIds.splice(this._chartDesignSptBtnIds.indexOf(s),1)):this._chartDesignDdIds.indexOf(s)>-1&&(i="ejDropDownList",this._chartDesignDdIds.splice(this._chartDesignDdIds.indexOf(s),1));break;case"SPARKLINEDESIGN":this._sparklineDesignSptBtnIds.indexOf(s)>-1&&(i="ejSplitButton",this._sparklineDesignSptBtnIds.splice(this._sparklineDesignSptBtnIds.indexOf(s),1))}if(i)this._disableButtons([s],i);else for(o=["ejSplitButton","ejButton","ejDropDownList","ejCheckBox","ejToggleButton","ejColorPicker"],a=e("#"+c._id+"_Ribbon_"+s),d=0,h=o.length;d<h;d++)if(a.data(o[d])){a.data(o[d]).disable();break}}while(("PageLayout_PageLayout_PageSize"===s||"Home_Clipboard_Paste"===s||"Others_Cells_InsertCell"===s||"Others_Cells_DeleteCell"===s||"Data_DataTools_DataValidation"===s)&&(s+="Options"))}},enableRibbonItems:function(t){for(var i,r,l,n,s,o,a,d=this.XLObj,h=0,c=t.length;h<c;h++){r=t[h].split("_")[2].toUpperCase(),l=t[h].split("_Ribbon_")[1];do{switch(r){case"HOME":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._homeBtnIds.push(l)):this.allSplitButtonIds.indexOf(l)>-1?(i="ejSplitButton",this._homeSptBtnIds.push(l)):this.allToggleButtonIds.indexOf(l)>-1?(i="ejToggleButton",this._homeToggleBtnIds.push(l)):this.allDropDownIds.indexOf(l)>-1?(i="ejDropDownList",this._homeDdIds.push(l)):this.colorPickerIds.indexOf(l)>-1&&(i="ejColorPicker",this._homeCpIds.push(l));break;case"INSERT":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._insertBtnIds.push(l)):this.allSplitButtonIds.indexOf(l)>-1&&(i="ejSplitButton",this._insertSptBtnIds.push(l));break;case"DATA":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._dataBtnIds.push(l)):this.allSplitButtonIds.indexOf(l)>-1&&(i="ejSplitButton",this._dataSptBtnIds.push(l));break;case"PAGELAYOUT":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._pageLayBtnIds.push(l)):this.allSplitButtonIds.indexOf(l)>-1?(i="ejSplitButton",this._pageLaySptBtnIds.push(l)):this.checkBoxIds.indexOf(l)>-1&&(i="ejCheckBox",this._pageLayChckBxIds.push(l));break;case"REVIEW":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._cmntBtnIds.push(l)):this.allToggleButtonIds.indexOf(l)>-1&&"ShowAllComment"===t[h].split("_")[4]?(i="ejToggleButton",this._cmntTglBtnIds.push(l)):this.allToggleButtonIds.indexOf(l)>-1&&(i="ejToggleButton",this._reviewTglBtnIds.push(l));break;case"OTHERS":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._othersBtnIds.push(l)):this.allSplitButtonIds.indexOf(l)>-1&&(i="ejSplitButton",this._othersSptBtnIds.push(l));break;case"FORMAT":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._formatBtnIds.push(l)):this.allSplitButtonIds.indexOf(l)>-1&&(i="ejSplitButton",this._formatSptBtnIds.push(l));break;case"DESIGN":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._contextualBtnIds.push(l)):this.checkBoxIds.indexOf(l)>-1?(i="ejCheckBox",this._contextualCheckBoxIds.push(l)):this._contextualInputIds.indexOf(l)>-1&&(i=!0);break;case"CHARTDESIGN":this.allButtonIds.indexOf(l)>-1?(i="ejButton",this._chartDesignBtnIds.push(l)):this.allSplitButtonIds.indexOf(l)>-1?(i="ejSplitButton",this._chartDesignSptBtnIds.push(l)):this.allDropDownIds.indexOf(l)>-1&&(i="ejDropDownList",this._chartDesignDdIds.push(l))}if(i)this._enableButtons([l],i);else for(n=["ejSplitButton","ejButton","ejDropDownList","ejCheckBox","ejToggleButton","ejColorPicker"],s=e("#"+d._id+"_Ribbon_"+l),o=0,a=n.length;o<a;o++)if(s.data(n[o])){s.data(n[o]).enable();break}}while(("PageLayout_PageLayout_PageSize"===l||"Home_Clipboard_Paste"===l||"Others_Cells_InsertCell"===l||"Others_Cells_DeleteCell"===l||"Data_DataTools_DataValidation"===l)&&(l+="Options"))}},_refreshFRDlg:function(){var t=this.XLObj;t._dlgWidth<365?(e("#"+t._id+"_Ribbon_lbFind").text(t._getLocStr("Find")),e("#"+t._id+"_Ribbon_lbReplace").text(t._getLocStr("Replace"))):(e("#"+t._id+"_Ribbon_lbFind").text(t._getLocStr("FindLabel")),e("#"+t._id+"_Ribbon_lbReplace").text(t._getLocStr("ReplaceLabel")))},_refreshChartTypeDlg:function(){var t=this.XLObj;e("#"+t._id+"_charttypedlg").ejDialog("open"),e("#"+t._id+"_chartdlg_allcharttab_list").ejListBox("refresh")},_refreshNMDlg:function(){var t=this.XLObj;e("#"+t._id+"_nmdlg").ejDialog("open"),e("#"+t._id+"_nmgrid").data("ejGrid")._refreshScroller({requestType:"refresh"})},_menuCustomize:function(){var i=this.XLObj,r=i._id,l=i.model.ribbonSettings.applicationTab,n=l.menuSettings;"menu"===l.type?(n.isAppend?this._fileMenuData=this._fileMenuData.concat(n.dataSource):n.dataSource.length&&(this._fileMenuData=[{id:"File",text:i._getLocStr("File"),parentId:null}].concat(n.dataSource)),this._appTabCollection={type:t.Ribbon.ApplicationTabType.Menu,menuItemID:r+"_Menu",menuSettings:{click:e.proxy(this._onBackStageItemClick,this),openOnClick:!1,fields:{dataSource:this._fileMenuData,id:"id",parentId:"parentId",text:"text",spriteCssClass:"sprite"}}}):n.isAppend?(this._renderAppTab(),this._appTabCollection.backstageSettings.pages=this._appTabCollection.backstageSettings.pages.concat(n.dataSource)):n.dataSource.length?this._appTabCollection={type:t.Ribbon.applicationTabType.backstage,backstageSettings:{text:i._getLocStr("File"),headerWidth:124,height:i._responsiveHeight,width:i.model.scrollSettings.width,pages:n.dataSource}}:this._renderAppTab()},_refreshBackstageHeight:function(){var e=this.XLObj,i=e.element.find("#"+e._id+"_Ribbon").data("ejRibbon"),r=e._isAutoWHMode?e._responsiveHeight:e._responsiveHeight-2;i.model.applicationTab.type===t.Ribbon.ApplicationTabType.Backstage&&(i.setModel({applicationTab:{backstageSettings:{height:r,width:e._isAutoWHMode?e._responsiveWidth:e._responsiveWidth-2}}}),i.element.find(".e-responsivebackstagecontent .e-resbackstagecontent").css({height:r-(10+i.element.find(".e-backstagerestop").outerHeight())}))},_refreshBSItems:function(i){var r=this.XLObj;i===t.Ribbon.ApplicationTabType.Menu&&(e("#"+r._id+"_backstagetabnew").remove(),e("#"+r._id+"_backstagetabsaveas").remove(),e("#"+r._id+"_backstagetabprint").remove())},hideMenu:function(){var t=this.XLObj;t.model.isReadOnly||("menu"===t.model.ribbonSettings.applicationTab.type?e("#"+t._id+"_Menu").hide():t.element.find("#"+t._id+"_Ribbon").find(".e-backstagetab").hide())},showMenu:function(){var t=this.XLObj;t.model.isReadOnly||("menu"===t.model.ribbonSettings.applicationTab.type?e("#"+t._id+"_Menu").show():t.element.find("#"+t._id+"_Ribbon").find(".e-backstagetab").show())},addTab:function(e,t,i){var r=this.XLObj;r.model.isReadOnly||r.element.find("#"+r._id+"_Ribbon").ejRibbon("addTab",e,t,i)},addTabGroup:function(e,t,i){var r=this.XLObj;r.model.isReadOnly||r.element.find("#"+r._id+"_Ribbon").ejRibbon("addTabGroup",e,t,i)},addContextualTabs:function(e,t){var i=this.XLObj;i.model.isReadOnly||i.element.find("#"+this.XLObj._id+"_Ribbon").ejRibbon("addContextualTabs",e,t)},removeTab:function(e,i){var r,l=this.XLObj;l.model.isReadOnly||(t.isNullOrUndefined(e)&&i?(r=l.element.find("#"+l._id+"_Ribbon .e-apptab")).length&&(r.find("a").empty(),r.find(".e-menu-wrap").remove(),r.hide(),l.element.find("#"+l._id+"_Ribbon_BackStage").remove()):l.element.find("#"+l._id+"_Ribbon").ejRibbon("removeTab",e))},removeTabGroup:function(e,t){var i=this.XLObj;i.model.isReadOnly||i.element.find("#"+i._id+"_Ribbon").ejRibbon("removeTabGroup",e,t)},addBackStageItem:function(e,t){var i=this.XLObj;i.model.isReadOnly||"backstage"!=this._appTabCollection.type||i.element.find("#"+i._id+"_Ribbon").ejRibbon("addBackStageItem",e,t)},removeBackStageItem:function(e){var t=this.XLObj;t.model.isReadOnly||"backstage"!=this._appTabCollection.type||t.element.find("#"+t._id+"_Ribbon").ejRibbon("removeBackStageItem",e)},updateBackStageItem:function(e,t){var i=this.XLObj;i.model.isReadOnly||"backstage"!=this._appTabCollection.type||i.element.find("#"+i._id+"_Ribbon").ejRibbon("updateBackStageItem",t,e)},removeMenuItem:function(t){var i,r=this.XLObj;r.model.isReadOnly||"menu"!=this._appTabCollection.type||(i=e("#"+r._id+"_Menu")).data("ejMenu").remove(["#"+i.find("li").eq(t).attr("id")])},updateMenuItem:function(t,i){var r,l,n=this.XLObj;n.model.isReadOnly||"menu"!=this._appTabCollection.type||((l=(r=e("#"+n._id+"_Menu")).data("ejMenu")).insertBefore(t,"#"+r.find("li").eq(i).attr("id")),l.remove(["#"+r.find("li").eq(i+1).attr("id")]))},addMenuItem:function(t,i){var r,l=this.XLObj;l.model.isReadOnly||"menu"!=this._appTabCollection.type||(r=e("#"+l._id+"_Menu")).data("ejMenu").insertAfter(t,"#"+r.find("li").eq(i).attr("id"))}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.freezepane=function(e){this.XLObj=e,this._hfreeze=null,this._vfreeze=null},t.spreadsheetFeatures.freezepane.prototype={_setHFreeze:function(e){this._hfreeze=e},_getHFreeze:function(){return this._hfreeze},_setVFreeze:function(e){this._vfreeze=e},_getVFreeze:function(){return this._vfreeze},_initFreeze:function(){var t,i,r="e-hide",l=this.XLObj,n=l.getMainPanel().find(".e-spreadsheet-list")[0];(t=document.createElement("div")).id=l._id+"_hfreeze",t.className="e-frow "+r,n.appendChild(t),this._setHFreeze(e(t)),(i=document.createElement("div")).id=l._id+"_vfreeze",i.className="e-fcol "+r,n.appendChild(i),this._setVFreeze(e(i))},_refreshFreeze:function(){var e="px",t="e-hide",i=this.XLObj,r=i.getSheet(),l=this._getHFreeze()[0];l||this._initFreeze(),i._isFrozen(i.getFrozenRows())?(i._removeClass(l,t),l.style.top=r._fDivTop,l.style.width=i.model._isActPanelVisible?i._getJSSheetContent(i.getActiveSheetIndex()).width()-(r.showHeadings?i._rowHeaderWidth:0)+10+e:r._vPortWth+(r.showHeadings?i._rowHeaderWidth:0)-4+e):i.addClass(l,t),l=this._getVFreeze()[0],i._isFrozen(i.getFrozenColumns())?(i._removeClass(l,t),l.style.left=r._fDivLeft,l.style.height=r._vPortHgt+(r.showHeadings?i._colHeaderHeight:0)-4+e):i.addClass(l,t)},freezeTopRow:function(){var e=this.XLObj,t=e.getSheet();(e._isFrozen(t.frozenRows)||e._isFrozen(t.frozenColumns))&&(e._intrnlReq=!0,this.unfreezePanes(),e._intrnlReq=!1),this._freeze(t._topRow.idx+1)},freezeLeftColumn:function(){var e=this.XLObj,t=e.getSheet();e._isFrozen(t.frozenColumns)&&(e._intrnlReq=!0,this.unfreezePanes(),e._intrnlReq=!1),this._freeze(null,t._leftCol.idx+1)},freezeRows:function(e){var t=this.XLObj,i=t.getSheet();(t._isFrozen(i.frozenRows)||t._isFrozen(i.frozenColumns))&&(t._intrnlReq=!0,this.unfreezePanes(),t._intrnlReq=!1),this._freeze(e)},freezeColumns:function(e){var t=this.XLObj,i=t.getSheet();t._isFrozen(i.frozenColumns)&&(t._intrnlReq=!0,this.unfreezePanes(),t._intrnlReq=!1),this._freeze(null,e)},freezePanes:function(e,t){var i,r=this.XLObj;r.isNumber(e)||(e=(i=r._toIntrnlRange(e))[0],t=i[1]),this._freeze(e,t)},unfreezePanes:function(){this._freeze(),this._refreshSelection()},_freeze:function(e,i){var r,l,n,s,o,a,d,h,c,u,g=this.XLObj,p={sheetIndex:g.getActiveSheetIndex()},m=t.isNullOrUndefined(e),_=t.isNullOrUndefined(i);if(p.reqType=m&&_?"unfreezePanes":_?"freezeRow":m?"freezeColumn":"freezePanes",d=h=!0,g.model.allowFreezing){if(r="px",n="e-hide",s=g.getSheet(),a=this._getHFreeze()[0],t.isNullOrUndefined(e))if(l=g.getFrozenRows(),g._isFrozen(l)){for(e=0,c=s._ftopRowIdx-1,this._showFreezeRow(l,c),g.model.scrollSettings.allowVirtualScrolling&&g.refreshContent();c>=l;)s._fHMergeRows.indexOf(l)>-1&&(s._fHMergeRows.splice(s._fHMergeRows.indexOf(l),1),g._refreshSHMergeCells(null,[l],1,"row","show")),l++;g.addClass(a,n),s._isFreezed=!1}else d=!1;else(0===e||e<s._topRow.idx||e>s._bottomRow.idx)&&(e=g._getMidCell().rowIdx),o=g._getIdxWithOffset(e).yOffset,s._topRow.idx===e&&s._scrollTop!==o&&g.XLScroll._vScroller().scroll(o),g._removeClass(a,n),s._isFreezed=!0,a.style.top=s._fDivTop=o-s._scrollTop+(s.showHeadings?g._colHeaderHeight-2:0)+r,a.style.width=s._vPortWth+(s.showHeadings?g._rowHeaderWidth:0)-4+r,s._contScrollTop=s._scrollTop;if(d&&(s._ftopRowIdx=e,s._frozenHeight=g._getRowOffsetTop(s,e),s.paneTopLeftCell=g.getAlphaRange(e,s._fleftColIdx),g.setFrozenRows(e),s._frozenRows=e+1),a=this._getVFreeze()[0],t.isNullOrUndefined(i))if(l=g.getFrozenColumns(),g._isFrozen(l)){for(i=0,u=s._fleftColIdx-1,this._showFreezeCol(l,u);u>=l;)s._fHMergeCols.indexOf(l.toString())>-1&&(s._fHMergeCols.splice(s._fHMergeCols.indexOf(l.toString()),1),g._refreshSHMergeCells(null,[l],1,"column","show")),l++;g.addClass(a,n),s._isFreezed=!1}else h=!1;else(0===i||i<s._leftCol.idx||i>s._rightCol.idx)&&(i=g._getMidCell().colIdx),o=g._getIdxWithOffset(null,i).xOffset,s._leftCol.idx===i&&s._scrollLeft!==o&&g.XLScroll._hScroller().scroll(o),o=o+(s.showHeadings?g._rowHeaderWidth:0)-1,g._removeClass(a,n),s._isFreezed=!0,a.style.left=s._fDivLeft=o-s._scrollLeft+r,a.style.height=s._vPortHgt+(s.showHeadings?g._colHeaderHeight:0)-4+r,s._contScrollLeft=s._scrollLeft;h&&(s._fleftColIdx=i,s._frozenWidth=g._getColOffsetLeft(s,i),s.paneTopLeftCell=g.getAlphaRange(s._ftopRowIdx,i),g.setFrozenColumns(i),s._frozenColumns=i+1),(d||h)&&(g.XLScroll._refreshScroller(null,null,d&&h?"all":d?"vertical":"horizontal"),d&&g.model.scrollSettings.allowScrolling&&g.XLScroll._vScroller().scroll(g._isFrozen(g.getFrozenRows())?0:s._contScrollTop),h&&g.model.scrollSettings.allowScrolling&&g.XLScroll._hScroller().scroll(g._isFrozen(g.getFrozenColumns())?0:s._contScrollLeft)),d&&(p.rowIndex=e),h&&(p.colIndex=i),g._intrnlReq||g._trigActionComplete(p)}},_frozenScrollHandler:function(e){var i,r,l,n=0,s=this.XLObj,o=s.XLScroll,a=s.getSheet(),d=s.getActiveSheetIndex(),h=o._vScroller(d),c=o._hScroller(d);if(e.model.orientation===t.ScrollBar.Orientation.Vertical){if(l=h.element.find(".e-vhandle")[0].getBoundingClientRect(),e.reachedEnd=l.top+l.height>=h.element.find(".e-vhandlespace").height()-2,(e.scrollData.up||e.reachedEnd&&s.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite)&&(i=(e.scrollTop-a._scrollTop)/a.rowHeight,a._bottomRow.idx+i>=a.rowCount-1)){if(s.model.scrollSettings.allowVirtualScrolling)for(;i>=a.rowCount;)for(n=0,a._virtualBlockCnt++,a.rowCount+=a._virtualBlockRowCnt;n<a._virtualBlockRowCnt;)a.rowsHeightCollection.push(a.rowHeight),n++;else s.XLScroll._scrollBottom(d);s.XLScroll._refreshScroller(d,"refresh","vertical")}o._isIntrnlScroll?(this._scrollFreeze(o._scrollIdx),o._scrollIdx=0,a._scrollTop=e.scrollTop):e.scrollTop==a._scrollTop||e.reachedEnd&&s.model.scrollSettings.scrollMode!==t.Spreadsheet.scrollMode.Infinite||(r=this._ensureFreezeScrollPos(e),s.isUndefined(r.resetTo)?(this._scrollFreeze(r.rowIdx),a._scrollTop=e.scrollTop):(o._isIntrnlScroll=!0,o._scrollIdx=r.rowIdx,o._vScroller().scroll(r.resetTo),o._isIntrnlScroll=!1))}else e.reachedEnd=Math.ceil(parseFloat(c.element.find(".e-hhandle").css("left")))+Math.ceil(parseFloat(c.element.find(".e-hhandle").width()))>=s.element.find(".e-hhandlespace").width()-2,i=(e.scrollLeft-a._scrollLeft)/a.columnWidth,(e.reachedEnd||s.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&a._rightCol.idx+i>=a.colCount-1)&&(s.XLScroll._scrollRight(d),s.XLScroll._refreshScroller(d,"refresh","horizontal")),o._isIntrnlScroll?(this._scrollFreeze(null,o._scrollIdx),o._scrollIdx=0,a._scrollLeft=e.scrollLeft):e.scrollLeft==a._scrollLeft||e.reachedEnd&&s.model.scrollSettings.scrollMode!==t.Spreadsheet.scrollMode.Infinite||(r=this._ensureFreezeScrollPos(e),s.isUndefined(r.resetTo)?(this._scrollFreeze(null,r.colIdx),a._scrollLeft=e.scrollLeft):(o._isIntrnlScroll=!0,o._scrollIdx=r.colIdx,o._hScroller().scroll(r.resetTo),o._isIntrnlScroll=!1));s.model.allowComments&&s.XLComment._updateCmntArrowPos()},_ensureFreezeScrollPos:function(e){var i,r,l={},n=[t.Spreadsheet.HideTypes.Freeze],s=this.XLObj,o=s.getSheet();return e.model.orientation===t.ScrollBar.Orientation.Vertical?(i=e.scrollTop+o._frozenHeight,r=s._getIdxWithOffset(i,null,!0,n),l.rowIdx=r.rowIdx,i!==r.yOffset&&(l.resetTo=r.yOffset-o._frozenHeight)):(i=e.scrollLeft+o._frozenWidth,r=s._getIdxWithOffset(null,i,!0,n),l.colIdx=r.colIdx,i!==r.xOffset&&(l.resetTo=r.xOffset-o._frozenWidth)),l},_scrollFreeze:function(t,i){var r,l=this.XLObj,n=l.getSheet(),s=l.getActiveSheetIndex(),o=n.shapeMngr;if(t&&n._ftopRowIdx!==t){for(n._ftopRowIdx<t?(r=t-n._ftopRowIdx==1?n._ftopRowIdx:t-1,this._hideFreezeRow(n._ftopRowIdx,r),(this.XLObj.getObjectLength(o.chart)||this.XLObj.getObjectLength(o.picture))&&this._refreshShape(n._ftopRowIdx,r,!0)):(r=n._ftopRowIdx-t==1?t:n._ftopRowIdx-1,this._showFreezeRow(t,r),(this.XLObj.getObjectLength(o.chart)||this.XLObj.getObjectLength(o.picture))&&this._refreshShape(t,r,!0)),l.model.scrollSettings.allowVirtualScrolling&&(l._refreshContent(s,!0),l.XLScroll._isScrollToCell||0!=n._topRow.idx||e("#"+l._id+"_content").scrollLeft(n._scrollLeft));r>=t;)n._fHMergeRows.indexOf(r)>-1&&(n._fHMergeRows.splice(n._fHMergeRows.length-1,1),l._refreshSHMergeCells(null,[r],1,"row","show")),r--;n._ftopRowIdx=t,n.paneTopLeftCell=l.getAlphaRange(t,n._fleftColIdx),l.model.scrollSettings.allowScrolling&&(l.XLScroll._getRowHeights(s,1,null,!0),l.XLScroll._refreshScroller(s,"refresh","vertical"),l.XLScroll._getFirstRow(s))}else if(i&&n._fleftColIdx!==i){for(n._fleftColIdx<i?(r=i-n._fleftColIdx==1?n._fleftColIdx:i-1,this._hideFreezeCol(n._fleftColIdx,r),(this.XLObj.getObjectLength(o.chart)||this.XLObj.getObjectLength(o.picture))&&this._refreshShape(n._fleftColIdx,r)):(r=n._fleftColIdx-i==1?i:n._fleftColIdx-1,this._showFreezeCol(i,r),(this.XLObj.getObjectLength(o.chart)||this.XLObj.getObjectLength(o.picture))&&this._refreshShape(i,r));r>=i;)n._fHMergeCols.indexOf(r.toString())>-1&&(n._fHMergeCols.splice(n._fHMergeCols.length-1,1),l._refreshSHMergeCells(null,[r],1,"column","show")),r--;n._fleftColIdx=i,n.paneTopLeftCell=l.getAlphaRange(n._ftopRowIdx,i)}this._refreshSelection()},_refreshShape:function(t,i,r){var l,n,s,o,a,d,h,c,u,g=this.XLObj,p=g.getActiveSheetIndex(),m=g.getSheet(p),_=m.shapeMngr,f=m.pivotMngr,b=r?[t,0,i,m.colCount]:[0,t,m.rowCount,i],C=g.getObjectLength(_.chart),S=!1,x=g.getObjectLength(_.picture);if(C)for(c=g.getObjectKeys(_.chart),h=0;h<C;h++)if(g.inRange(b,_.chart[c[h]].rowIndex,_.chart[c[h]].colIndex)){S=!0;break}if(x)for(u=g.getObjectKeys(_.picture),h=0;h<x;h++)if(g.inRange(b,_.picture[u[h]].rowIndex,_.picture[u[h]].colIndex)){S=!0;break}if(S){for(n=g.getRangeData({range:b,property:["picture","chart"]}),l=0;l<n.length;l++)n[l].picture&&(a=n[l].picture[g.getObjectLength(n[l].picture)],o=r?_.picture[a].rowIndex:_.picture[a].colIndex,this._freezeShape(e("#"+a)[0],r?m._hiddenFreezeRows.indexOf(o)>-1:m._hiddenFreezeCols.indexOf(o)>-1)),n[l].chart&&(s=n[l].chart[g.getObjectLength(n[l].chart)],o=r?_.chart[s].rowIndex:_.chart[s].colIndex,this._freezeShape(e("#"+s)[0],r?m._hiddenFreezeRows.indexOf(o)>-1:m._hiddenFreezeCols.indexOf(o)>-1)),n[l].pivot&&(d=n[l].pivot[g.getObjectLength(n[l].pivot)],o=r?f.pivot[d].rowIndex:f.pivot[d].colIndex,this._freezeShape(e("#"+d)[0],r?m._hiddenFreezeRows.indexOf(o)>-1:m._hiddenFreezeCols.indexOf(o)>-1));this._updateShapePos(r)}},_updateShapePos:function(e){var t,i,r,l,n,s,o,a,d,h=0,c=0,u=this.XLObj,g=u.getSheet(),p=g.shapeMngr,m=g._hiddenFreezeRows,_=g._hiddenFreezeCols;for(d in e?h=this._getFreezeHidenDim(!0):c=this._getFreezeHidenDim(),p)if(["chart","picture"].indexOf(d)>-1)for(n in a=p[d])s=(o=a[n]).id,t=o.top,i=o.left,r=m[m.length-1]||0,l=_[_.length-1]||0,e?r<=o.rowIndex&&(t-=h,u.getSheetElement().find("#"+s).css({top:t})):l<=o.colIndex&&(i-=c,u.getSheetElement().find("#"+s).css({left:i}))},_getFreezeHidenDim:function(e){var t,i,r=this.XLObj.getSheet(),l=0,n=0;for(e?(t=r._hiddenFreezeRows,i=r.rowsHeightCollection):(t=r._hiddenFreezeCols,i=r.columnsWidthCollection),n=0;n<t.length;n++)l+=i[t[n]];return l},_freezeShape:function(e,t){var i=this.XLObj;t?i.addClass(e,"e-hide"):i._removeClass(e,"e-hide")},_hideFreezeRow:function(e,t){for(var i,r,l=this.XLObj,n=l.model.scrollSettings,s=n.allowScrolling&&n.allowVirtualScrolling,o=l.getActiveSheetIndex(),a=l.getRows(o),d=a[0],h=a[1],c=l.getSheet(o),u=c.usedRange,g=!1,p=c.mergedCells.length;e<=t;){for(i=0,-1===c._hiddenFreezeRows.indexOf(e)&&c._hiddenFreezeRows.push(e),!s&&l._isRowViewable(o,e)&&(l.addClass(h[e],"e-r-hide"),l.addClass(d[e],"e-r-hide"));i<u.colIndex;){for(r=0;r<p;r++)g=l.inRange(l._getRangeArgs(c.mergedCells[r].range),e,i);if(g&&l.XLCellNav._isMergedCell({rowIndex:e,colIndex:i})){c._fHMergeRows.push(e),l._refreshSHMergeCells(o,[e],1,"row","hide");break}i++}e++}},_showFreezeRow:function(e,t){for(var i,r=!1,l=this.XLObj,n=l.model.scrollSettings,s=n.allowScrolling&&n.allowVirtualScrolling,o=l.getActiveSheetIndex(),a=l.getRows(o),d=a[0],h=a[1],c=l.getSheet();e<=t;)i=c._hiddenFreezeRows.indexOf(e),l.model.allowFiltering&&l.getObjectLength(c._filterColl)&&(r=this._refreshFiltering(e)),i>-1&&(c._hiddenFreezeRows.splice(i,1),s||!l._isRowViewable(o,e)||r||(l._removeClass(h[e],"e-r-hide"),l._removeClass(d[e],"e-r-hide"))),e++},_refreshFiltering:function(e){var i=this.XLObj,r=i.getActiveSheetIndex(),l=i.getSheet();return!t.isNullOrUndefined(i.XLEdit.getPropertyValue(e,0,"isFilterHide",r))&&(-1===l._filterHRowsColl.indexOf(e)&&l._filterHRowsColl.push(e),!0)},_hideFreezeCol:function(e,t){for(var i,r,l="e-fcol-hide",n=e,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(),d=a.usedRange,h=s.model.scrollSettings.allowVirtualScrolling?a._virtualRowIdx:a._rowIdxColl,c=s._getJSSheetHeader(o),u=s._getContent(o),g=c.find("th"),p=c.find("col"),m=u.find("col"),_=c.find("table"),f=s._getWidth(e,t);n<=t;){for(r=0,-1===a._hiddenFreezeCols.indexOf(n)&&a._hiddenFreezeCols.push(n),s.addClass(g[n],l),s.addClass(p[n],l),s.addClass(m[n],l);r<d.rowIndex;){if(s.XLCellNav._isMergedCell({rowIndex:r,colIndex:n})){a._fHMergeCols.push(n.toString()),s._refreshSHMergeCells(o,[n],1,"column","hide");break}r++}n++}if(n=(i=s.getRange([h[0],e,h[h.length-1],t])).length)for(;n--;)s.addClass(i[n],l);f=_.width()-f,_.width(f),u.find(".e-table").width(f)},_getWidth:function(e,t){for(var i=0,r=this.XLObj.getSheet();e<=t;e++)i+=r.columnsWidthCollection[e];return i},_showFreezeCol:function(e,t){for(var i,r,l="e-fcol-hide",n=e,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(),d=s._getJSSheetHeader(o),h=s._getContent(o),c=d.find("th"),u=s.model.scrollSettings.allowVirtualScrolling?a._virtualRowIdx:a._rowIdxColl,g=d.find("col"),p=h.find("col"),m=d.find("table"),_=s._getWidth(0,a.colCount-1)-(a._frozenColumns-1<e?s._getWidth(a._frozenColumns-1,e):0);n<=t;)(i=a._hiddenFreezeCols.indexOf(n))>-1&&(a._hiddenFreezeCols.splice(i,1),s._removeClass(c[n],l),s._removeClass(g[n],l),s._removeClass(p[n],l)),n++;if(n=(r=s.getRange([u[0],e,u[u.length-1],t])).length)for(;n--;)s._removeClass(r[n],l);m[0].style.width=_+"px",h.find("table")[0].width=_+"px"},_refreshSelection:function(){var e,t,i,r,l=!1,n=this.XLObj,s=n.getSheet(),o=s.selectedRange,a=o[2],d=o[3],h=o[0],c=o[1];if(s._endCell.rowIndex+1>=s._frozenRows&&s._endCell.rowIndex<s._ftopRowIdx&&s._startCell.rowIndex<s._frozenRows-1)a=s._frozenRows-2,l=!0;else if(e=o[0],t=o[2],s._frozenRows-1<=e)for(;e<=t;){if(!(e<s._ftopRowIdx)){h=e;break}e++}if(o[3]+1>=s._frozenColumns&&o[3]<s._fleftColIdx&&o[1]<s._frozenColumns-1)d=s._frozenColumns-2,l=!0;else if(i=o[1],r=o[3],s._frozenColumns-1<=i)for(;i<=r;){if(!(i<s._fleftColIdx)){c=i;break}i++}e==t+1||i==r+1?n.XLSelection._hideShowSelElem("hide"):(n.model.allowSelection&&n.XLSelection._refreshBorder([h,c,a,d]),l?n.addClass(n.getAutoFillElem()[0],"e-hide"):n.model.allowAutoFill&&n.XLDragFill.positionAutoFillElement())},_selectionScroll:function(){var e,t,i,r,l=r=0,n=this.XLObj,s=n.getSheet(),o=n.getActiveSheetIndex();if(n._isFrozen(s.frozenRows))if(s._startCell.rowIndex+1<s._frozenRows&&s._endCell.rowIndex+1>s._frozenRows&&s.selectedRange[2]<s._ftopRowIdx){if(s._ftopRowIdx+1-s._frozenRows>0){for(t=s._endCell.rowIndex-s._ftopRowIdx,s._endCell.rowIndex=s._frozenRows-1+t,e=s._frozenRows-1;e<s._ftopRowIdx;e++)l+=s.rowsHeightCollection[e];n._scrollContent({y:-l})}}else s.selectedRange[2]-s._endCell.rowIndex>0&&s._ftopRowIdx>s._frozenRows-1&&!s._isColSelected&&s._endCell.rowIndex<s._frozenRows-1&&s.selectedRange[2]-s.selectedRange[0]>0&&s.selectedRange[2]>=s._ftopRowIdx-1&&(s._endCell.rowIndex=s._ftopRowIdx-1,i=n.getCell(s._frozenRows-2,s._endCell.colIndex)[0],n.XLSelection._scrollCalculation(o,i,{position:"vertical",action:"Decrement"}));if(n._isFrozen(s.frozenColumns))if(s._startCell.colIndex+1<s._frozenColumns&&s._endCell.colIndex+1>s._frozenColumns&&s.selectedRange[3]<s._fleftColIdx){if(s._fleftColIdx+1-s._frozenColumns>0){for(t=s._endCell.colIndex-s._fleftColIdx,s._endCell.colIndex=s._frozenColumns-1+t,e=s._frozenColumns-1;e<s._fleftColIdx;e++)r+=s.columnsWidthCollection[e];n._scrollContent({x:-r})}}else s.selectedRange[3]-s._endCell.colIndex>0&&s._fleftColIdx>s._frozenColumns-1&&!s._isRowSelected&&s._endCell.colIndex<s._frozenColumns-1&&s.selectedRange[3]-s.selectedRange[1]>0&&s.selectedRange[3]>=s._fleftColIdx-1&&(s._endCell.colIndex=s._fleftColIdx-1,i=n.getCell(s._frozenColumns-2,s._endCell.colIndex)[0],n.XLSelection._scrollCalculation(o,i,{position:"horizontal",action:"Decrement"}))},_refreshFColResize:function(e){var t,i=this.XLObj,r=i.getActiveSheetIndex(),l=i.getSheet(),n=i.getFrozenColumns()+1,s=this._getVFreeze()[0],o=l._frozenWidth,a=parseInt(this._getVFreeze()[0].style.left);i.XLScroll._getColWidths(r,e),l._frozenWidth=i._getColOffsetLeft(l,n-1),t=o>l._frozenWidth?o-l._frozenWidth:l._frozenWidth-o,e<n-1&&(s.style.left=l._fDivLeft=o>=l._frozenWidth?a-t+"px":a+t+"px")},_refreshFRowResize:function(e){var t,i=this.XLObj,r=i.getActiveSheetIndex(),l=i.getSheet(),n=i.getFrozenRows()+1,s=this._getHFreeze()[0],o=l._frozenHeight,a=parseInt(this._getHFreeze()[0].style.top);i.XLScroll._getRowHeights(r,e),l._frozenHeight=i._getRowOffsetTop(l,n-1),t=o>l._frozenHeight?o-l._frozenHeight:l._frozenHeight-o,e<n-1&&(s.style.top=l._fDivTop=o>=l._frozenHeight?a-t+"px":a+t+"px")},_refreshFreezeRowDiv:function(){var e=this.XLObj,t=e.getSheet();t._fDivTop=e._getIdxWithOffset(t._frozenRows-1).yOffset-t._contScrollTop+(t.showHeadings?e._colHeaderHeight-2:0)+"px",t._frozenHeight=e._getRowOffsetTop(t,t._frozenRows-1),this._refreshFreeze()},_refreshFreezeColDiv:function(){var e=this.XLObj,t=e.getSheet();t._fDivLeft=e._getColOffsetLeft(t,t._frozenColumns-1)-t._contScrollLeft+(t.showHeadings?e._rowHeaderWidth:0)-1+"px",t._frozenWidth=e._getColOffsetLeft(t,t._frozenColumns-1),this._refreshFreeze()}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.math={toFraction:function(e){if(this.isNumber(e)){var t=e.toString(),i=t.split(".")[0],r=t.split(".")[1];if(!r)return{integer:e};var l=(+r).toString(),n=this.getPlaceValue(r,l),s=this.getGcd(l,n);return{integer:i,numerator:Number(l)/s,denominator:Number(n)/s}}return null},toExponential:function(e,t){if(this.isNumber(e)){var i,r,l=Number(e);return(t=t||2)>20&&(t=20),(i=l.toExponential(t)).indexOf("e+")>-1?(r=i.split("e+"))[0]+"E+"+this.padZeros(r[1]):(r=i.split("e-"))[0]+"E-"+this.padZeros(r[1])}return null},toAccounting:function(i,r,l){if(this.isNumber(r)&&i){var n,s,o=t.widgetBase.formatting(i,r,l),a=this._currencySymbol,d=e.trim(o.replace(a,"")),h=o.indexOf(a);!h||r<0&&1===h?(n=a,s=Number(r)?d:"-"):(n=Number(r)?d:"-",s=a),r=n+"   "+s}return r},intToDate:function(e){return new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime())},getGcd:function(e,t){return e=Number(e),(t=Number(t))?this.getGcd(t,e%t):e},isNumber:function(e){return e-parseFloat(e)>=0},isTime:function(e){return!!e&&-1!==e.toString().indexOf(":")},isFormula:function(e){return!!(e&&!e.toString().indexOf("=")&&e.length>1)&&e.split("(").length-1===e.split(")").length-1},getPlaceValue:function(e,t){var i=e.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},padZeros:function(e,i,r){return this.isNumber(e)?(i=this.isNumber(i)?i:2,(r=t.isNullOrUndefined(t.Spreadsheet.autoFillDirection[r])?t.Spreadsheet.autoFillDirection.Left:t.Spreadsheet.autoFillDirection[r])===t.Spreadsheet.autoFillDirection.Left?e<=this.maxValue(i)?Array(i-this.getDigits(e)+1).join("0")+e.toString():e.toString():e<this.minValue(i)?e.toString()+Array(i-this.getDigits(e)+1).join("0"):e.toString()):null},maxValue:function(e){return this.isNumber(e)?Number(Array(e+1).join("9")):null},minValue:function(e){return this.isNumber(e)?Number("1"+Array(e).join("0")):null},getDigits:function(e){return this.isNumber(e)?e.toString().length:null},_round:function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)},_parseTime:function(e){var t,i,r,l=0,n=3,s={};if(this.isTime(e))for(t=(i=(e=e.toString()).split(" ")).length;l<t;){if(this.isTime(i[l]))for(r=i[l].split(":");n<6;)s[this._datePattern[n]]=r[n-3]||"0",n++;l++}return s},_dateToInt:function(e,t){var i=new Date("01/01/1900"),r=((this._isDateTime(e)?e:new Date(e)).getTime()-i.getTime())/864e5+2;return t?r%1:r},_defTimeFormat:function(e){return[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")},_isDate:function(e){var i={};return t.isNullOrUndefined(t.parseDate(e.toString()))||(e=this._dateToInt(e.toString())),/^((0?[1-9]|1[012])[-.](0?[1-9]|[12][0-9]|3[01])[-.](19|20)?[0-9]{2})*$/.test(e.toString())?(e=e.toString().replace("-","/","g"),e=this._dateToInt(e.toString()),i.text=e,i.isDate=!0):(i.text=e,i.isDate=!1),i},_defDateFormat:function(e){return[e.getMonth()+1,e.getDate(),e.getFullYear()].join("/")},_isCellReference:function(e){return/^[a-z]{1,3}\d{1,7}$/gi.test(e)?"relative":/^\$[a-z]{1,3}\$\d{1,7}$/gi.test(e)?"absolute":!!/^((\$[a-z]{1,3})\d{1,7}|[a-z]{1,3}(\$\d{1,7}))$/gi.test(e)&&"mixed"},_isDateTime:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())},_decimalCnt:function(e){var t,i;return this.isNumber(e)&&(t=(e=Number(e)).toString()).indexOf(this._decimalSeparator)>-1?(i=e.toFixed(),t.length-i.length-1):0},_getPosDiff:function(e,t){return e>t?e-t:t-e}}}(jQuery,Syncfusion),function(e,t,i){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.resizing=function(t){this.XLObj=t,this._$visualElem=e(),this._currentHCell=-1,this._colMinWidth=15,this._rowMinHeight=20,this._allowStart=!1,this._resizeStart=!1,this._resizeType="",this._tableY=null,this._oldWidth=null,this._orgX=null,this._orgY=null,this._extra=null,this._initialTableWidth=null,this._resizeElt=null,this._tableX=null,this._oldHeight=null,this._initialTableHeight=null,this._resizerowId=0,this._sparklineResize=!1},t.spreadsheetFeatures.resizing.prototype={getColWidth:function(e){return this.XLObj.getSheet(this.XLObj.getActiveSheetIndex()).columnsWidthCollection[e]},getRowHeight:function(e){return this.XLObj.getSheet(this.XLObj.getActiveSheetIndex()).rowsHeightCollection[e]},setColWidth:function(e,t){if(this.XLObj.model.allowResizing){var i=this.XLObj.getActiveSheetIndex();this._currentHCell=e,this._resizeColumnUsingDiff(t,this.XLObj.getSheet(i).columnsWidthCollection[e],[e]),this.XLObj.XLScroll._getColWidths(i,e),this.XLObj.XLSelection.refreshSelection()}},setRowHeight:function(e,t){var i,r=this.XLObj;r.model.allowResizing&&(i=r.getActiveSheetIndex(),this._currentHCell=e,this._resizeRowUsingDiff(t,r.getSheet(i).rowsHeightCollection[e],[e]))},_headerMouseDown:function(e){e.preventDefault(),this._colMouseDown(e)},_colMouseDown:function(t){var i,r=this.XLObj,l={};if(i=r._setXY(t,navigator.userAgent.indexOf("WebKit")>-1),this._orgX=i[0]+document.documentElement.scrollLeft,this._orgY=i[1],r._isTouchEvt&&this._mouseHover(t),this._allowStart&&("col-resize"===e(t.target).css("cursor")||r._isTouchEvt)){if(l.event=t,l.target=t.target,l.colIndex=this._currentHCell,l.oldWidth=t.target.getBoundingClientRect().width,l.reqType="column-resize",r._trigger("resizeStart",l))return;2!==t.button&&this._start(this._orgX,this._orgY),this._resizeType="Col",t.preventDefault()}},_mouseHover:function(t){var i,r=this.XLObj,l=t.target,n=r.getActiveSheetIndex(),s=r._getJSSheetHeader(n);if(!this._$visualElem.is(":visible")&&(r._hasClass(l,"e-headercelldiv")&&(l=l.parentNode),r._hasClass(l,"e-headercell"))){var o=l,a=o.getBoundingClientRect(),d=r._setXY(t),h=d[0],c=d[1];if(i=e(s.find(".e-table")[0]).width()+e(s.find(".e-columnheader")[0]).offset().left,(h>=a.left+document.documentElement.scrollLeft+o.offsetWidth-(r._isTouchEvt?15:7)||h<a.left+(r._isTouchEvt?13:0))&&h<i&&h>=a.left&&c<=a.top+document.documentElement.scrollTop+l.offsetHeight){if(this._currentHCell=s.find(".e-headercell").index(o),this._currentHCell<1&&h<a.left+o.offsetWidth-(r._isTouchEvt?15:5)||this._preventColResize(this._currentHCell,!1))return;r.addClass(l,"e-ss-colresize"),this._allowStart=!0}else r._removeClass(e(".e-ss-colresize")[0],"e-ss-colresize"),this._allowStart=!1,this._currentHCell=-1}},_preventColResize:function(e,t){this._currentHCell=e;var i,r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(o).pivotMngr.pivot,d=s.getObjectKeys(a),h=d.length;if(d.length)for(n=0;n<h;n++)return i=a[d[n]].colIndex,(l=s.element.find("#"+d[n]).data("ejPivotGrid").calculateCellWidths().columnWidths.length)||(l=3),r=i+l,t?this._currentHCell>=i&&this._currentHCell<r:this._currentHCell>=i&&this._currentHCell<=r},_start:function(i){var r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=s._getJSSheetHeader(o),d=a.find(".e-columnheader").find(".e-headercell");this._currentHCell>-1&&this._currentHCell<d.length&&(l=d[this._currentHCell]),t.isNullOrUndefined(l)||(n=l.getBoundingClientRect(),this._tableY=n.top+parseInt(navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollTop:document.documentElement.scrollTop),this._allowStart?(this._$visualElem=e(document.createElement("div")),r=s._getJSSheetContent(o).height()+a.height(),this._$visualElem.addClass("e-reSizeColbg").appendTo(s.element).css({height:r+"px"}).addClass("e-ss-colresize"),this._$visualElem.css({left:i-1,top:this._tableY}),this._oldWidth=l.offsetWidth,this._extra=i-this._orgX,this._resizeStart=!0):this._currentHCell=-1)},_cMouseMove:function(e){if(this._resizeStart){var t=this.XLObj._setXY(e,navigator.userAgent.indexOf("WebKit")>-1)[0];t+=document.documentElement.scrollLeft,e.preventDefault(),this._moveVisual(t),this.XLObj.addClass(e.target,"e-ss-colresize")}else this._mouseHover(e)},_reSize:function(t){var i,r,l,n,s,o=this.XLObj,a=o.getActiveSheetIndex(),d=o._getJSSheetHeader(a).find(".e-colselected"),h=d.length,c=[];if(this._initialTableWidth=o._getJSSheetHeader(a).find(".e-headercontent").width(),this._getResizableCell(),this._currentHCell>-1&&this._resizeStart){for(i=o.getSheet(a).columnsWidthCollection[this._currentHCell],h>0&&(n=d[0].cellIndex),l=0;l<h;l++)this._currentHCell===n&&(r=!0),c.push(n),n++;r||(c=[this._currentHCell]),this._resizeColumnUsingDiff(t-this._orgX+i,i,c),o._isAutoWHMode&&(o._autoSSWidthHeight(),s=o._getElementDimension(),o.element.css({height:s.height,width:s.width})),o.model.allowAutoFill&&(o.XLDragFill.positionAutoFillElement(),o.XLDragFill.hideAutoFillOptions()),e("#"+o._id+"ddlspan").length&&o._ddlPosition()}o.XLScroll._getRowHeights(a,this._currentHCell),o.model.allowFreezing&&o.XLFreeze._refreshFColResize(this._currentHCell),o.model.allowSelection&&o.XLSelection._refreshBorder(),this._removeVisualElem()},_resizeColumnUsingDiff:function(t,i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x=this.XLObj,v={},w=x.getActiveSheetIndex(),I=x._getJSSheetHeader(w),y=x.getSheet(w);if(t>0){for(t=t>this._colMinWidth?t:this._colMinWidth,_=0,f=r.length;_<f;_++)if(x.XLEdit.getPropertyValue(0,r[_],"wrapCol")&&x.XLEdit.getPropertyValue(0,r[_],"wrapWidth")>t)x._dupDetails=!0;else if(g=I.find("col:eq("+r[_]+")"),p=x._getJSSheetContent(w).find(".e-spreadsheetcontentcontainer").find("col:eq("+r[_]+")"),g.outerWidth(t),p.width(t),x.XLShape&&x.XLShape._refreshShapePosOnResize(r[_],t,!0,w),y.columnsWidthCollection[r[_]]=t,t<i)for(b=0,C=(c=x._getContent(w).find(".e-rowcell:nth-child("+(r[_]+1)+")")).length;b<C;b++)a=x._getCellIdx(c[b]),d=x.XLEdit.getPropertyValue(a.rowIndex,a.colIndex,"value2"),(s=x.XLEdit.getPropertyValue(a.rowIndex,a.colIndex,"sparkline",w))&&x.XLSparkline._sparklineResize(s[0],{width:t},w),d&&(x._refreshGlobalSpan(),o=e("#"+x._id+"_emptySpan"),x.addClass(o[0],"e-rowcell"),o.text(d),h=o.outerWidth(),x._refreshGlobalSpan(),t<h&&(x._textClip(a.rowIndex,a.colIndex,"delete"),x._textClip(a.rowIndex,a.colIndex,"add",h)));else{if(u=x._getContent(w).find(".e-rowcell.e-ofbrdr:nth-child("+(r[_]+1)+")"),m=y.usedRange.rowIndex,x.model.allowSparkline&&x.getObjectLength(y.shapeMngr.sparkline)>0)for(S=0;S<=m;S++)(s=x.XLEdit.getPropertyValue(S,r[_],"sparkline",w))&&(x.XLScroll._getColWidths(w,r[0]),l=x._getCellInfo({rowIndex:S,colIndex:r[_]},w),x._getContent(w).find("#"+s[0]).css({top:l.top,left:l.left}),x._dataContainer.sheets[w][S][r[_]].sparkline[0].split("_")[4]==r[_]&&x.XLSparkline._sparklineResize(s[0],{width:t},w));for(b=0,n=u.length;b<n;b++)a=x._getCellIdx(u[b]),x._textClip(a.rowIndex,a.colIndex,"delete","",!0),x._textClip(a.rowIndex,a.colIndex,"add","",!0)}I.find(".e-columnheader").css("cursor","default"),x._dupDetails||(v={sheetIndex:w,cols:r,newWidth:t,oldWidth:i,reqType:"resize-column"},i!==t&&(x._completeAction(v),x._trigActionComplete(v))),x._dupDetails&&(x._dupDetails=!1),x.XLScroll._getColWidths(w,r[0]),x.model.scrollSettings.allowScrolling&&(x.XLScroll._refreshScroller(w,"refresh","all"),x.XLScroll._getFirstColumn(w)),x.XLSparkline&&x.XLSparkline._refreshSparklinePos({rowIndex:0,colIndex:r[0]},w)}},_calculateWidth:function(){for(var e=this.XLObj,t=e._getJSSheetHeader(e.getActiveSheetIndex()).find("col"),i=0,r=0;r<t.length;r++)i+=t.eq(r).width();return i},_cMouseUp:function(e){if(this._resizeStart){var t,i=this.XLObj,r=this._currentHCell,l=i.getSheet(i.getActiveSheetIndex()).columnsWidthCollection,n={};if(t=i._setXY(e,navigator.userAgent.indexOf("WebKit")>-1)[0],t+=document.documentElement.scrollLeft,n.event=e,n.target=e.target,n.oldWidth=l[r],n.colIndex=this._currentHCell,this._reSize(t),n.newWidth=l[r],n.reqType="column-resize",this.XLObj._trigger("resizeEnd",n))return;i.element.find("#"+i._id+"ddl").ejDropDownList("hidePopup")}},_getResizableCell:function(e){var t,i,r,l=this.XLObj,n=l.getActiveSheetIndex(),s=l._getJSSheetHeader(n).find(".e-columnheader"),o=navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollLeft:document.documentElement.scrollLeft;for(i=0,r=(t=this._resizeStart?s.find(".e-headercell"):s.find(".e-headercell").not(".e-hide")).length;i<r;i++)if(t[i].getBoundingClientRect().left+o+5>this._orgX)return void(l.isUndefined(e)?this._currentHCell=this._getVisibleCell(t,i-1):e.target=l._getJSSheetHeader(n).find("th:eq("+(i-1)+")")[0])},_getVisibleCell:function(t,i){return e(t[i]).is(":visible")?i:this._getVisibleCell(t,i-1)},_moveVisual:function(e){var t=this.XLObj,i=t._getJSSheetHeader(t.getActiveSheetIndex()).find(".e-headercontent")[0].getBoundingClientRect();i.left+document.documentElement.scrollLeft+i.width<e||e<i.left+document.documentElement.scrollLeft?this._$visualElem.remove():this._currentHCell>-1&&this._$visualElem.css({left:e-1,top:this._tableY})},_rowMouseDown:function(t){var i,r,l,n={},s=this.XLObj;if(s._isTouchEvt&&this._rowMouseHover(t),this._allowStart&&"row-resize"===e(t.target).css("cursor")){if(i=(l=s._setXY(t,navigator.userAgent.indexOf("WebKit")>-1))[0],r=l[1],r+=document.documentElement.scrollTop,n.event=t,n.target=t.target,n.rowIndex=this._currentHCell,n.oldHeight=t.target.getBoundingClientRect().height,n.reqType="row-resize",this.XLObj._trigger("resizeStart",n))return;2!==t.button&&this._rowStart(i,r),this._resizeType="Row",t.preventDefault()}return!1},_rowMouseHover:function(t){var i;if(!this._$visualElem.is(":visible")&&(i=e(t.target)).hasClass("e-rowheader")){var r=this.XLObj,l=r.getActiveSheetIndex(),n=r._getJSSheetRowHeaderContent(l),s=i.get(0),o=s.getBoundingClientRect(),a=r._setXY(t),d=a[0],h=a[1],c=r._getJSSheetRowHeader(l).find(".e-table").height()+n.find("tbody").offset().top;if((h>=o.top+document.documentElement.scrollTop+s.offsetHeight-(r._isTouchEvt?8:7)||h<o.top+(r._isTouchEvt?8:0))&&h<c&&h>=o.top&&d<=o.left+document.documentElement.scrollLeft+t.target.offsetWidth){if(this._resizeElt=i.parent(),this._currentHCell=r.model.scrollSettings.allowVirtualScrolling?parseInt(this._resizeElt.attr("data-idx")):this._resizeElt[0].rowIndex,this._currentHCell<1&&h<o.top+s.offsetHeight-(r._isTouchEvt?8:5)||this._preventRowResize(this._currentHCell,!1))return;i.addClass("e-ss-rowresize"),this._allowStart=!0}else e(".e-ss-rowresize").removeClass("e-ss-rowresize"),this._allowStart=!1,this._currentHCell=-1;this._resizerowId=t.target.parentNode.getAttribute("data-idx")}},_preventRowResize:function(e,t){this._currentHCell=e;var i,r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(o).pivotMngr.pivot,d=s.getObjectKeys(a),h=d.length;if(d.length)for(n=0;n<h;n++)return i=a[d[n]].rowIndex,(l=s.element.find("#"+d[n]).data("ejPivotGrid")._rowCount)||(l=4),r=i+l,t?this._currentHCell>=i&&this._currentHCell<r:this._currentHCell>=i-1&&this._currentHCell<=r},_rowStart:function(t,i){var r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=this._resizeElt[0].rowIndex,d=s._getJSSheetRowHeader(o).find(".e-rowheader");this._currentHCell>-1&&a<d.length&&(r=d[a]),r&&(l=r.getBoundingClientRect(),this._tableX=l.left+parseInt(navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollLeft:document.documentElement.scrollLeft),this._allowStart?(this._$visualElem=e(document.createElement("div")),n=s._getJSSheetContent(o).width(),this._$visualElem.addClass("e-reSizeRowbg").appendTo(s.element).css({width:n+"px"}).addClass("e-ss-rowresize"),this._$visualElem.css({top:i-3,left:this._tableX}),this._oldHeight=r.offsetHeight,this._orgX=t,this._orgY=i,this._extra=i-this._orgY,this._resizeStart=!0):this._currentHCell=-1)},_rMouseMove:function(t){if(this._resizeStart){var i=this.XLObj._setXY(t,navigator.userAgent.indexOf("WebKit")>-1)[1];i+=document.documentElement.scrollTop,t.preventDefault(),e(t.target).addClass("e-ss-rowresize"),this._moveRowVisual(i)}else this._rowMouseHover(t)},_rowResize:function(t,i){var r,l,n,s,o,a,d=this.XLObj,h=d.getActiveSheetIndex(),c=d.getRows(h)[1],u=d._getJSSheetRowHeaderContent(h).find(".e-rowselected"),g=u.length,p=[],m=0;if(this._initialTableHeight=d._getJSSheetRowHeader(h).find(".e-rowheadercontent").height(),this._getResizableRowCell(),l=e(c[this._currentHCell]).find(".e-sswraptext").length>0,this._currentHCell>-1&&this._resizeStart){for(a=0;a<=this._resizerowId;a++)d.XLEdit.getPropertyValue(a,0,"isRHide")&&m++;if(r=d.getSheet(h).rowsHeightCollection[this._currentHCell+m],!l||l&&i-this._orgY+r>r){for(g>0&&(s=u[0].parentNode.rowIndex),n=0;n<g;n++)this._currentHCell===s&&(o=!0),p.push(s),s++;o||(p=[this._currentHCell]),this._resizeRowUsingDiff(i-this._orgY+r,r,p)}d.model.allowAutoFill&&(d.XLDragFill.positionAutoFillElement(),d.XLDragFill.hideAutoFillOptions()),d._isAutoWHMode&&d.model.showRibbon&&d._autoSSWidthHeight(h,!0)}d.model.allowSelection&&d.XLSelection._refreshBorder(),this._removeVisualElem()},_resizeRowUsingDiff:function(t,i,r){var l,n,s,o,a,d,h,c,u,g,p,m=this.XLObj,_=m.getActiveSheetIndex(),f={},b=m._getJSSheetRowHeaderContent(_);if(t>0){for(t=t>this._rowMinHeight?t:this._rowMinHeight,l=0,s=r.length;l<s;l++){if(d=r[l],h=m.model.scrollSettings.allowVirtualScrolling?m.getSheet(_)._virtualRowIdx.indexOf(d):d,c=this._getContentHeight(d,_)<=t,m._isRowViewable(_,d)&&(m._isUndoRedo||c))for(o=b.find("tr:eq("+h+")"),a=m._getJSSheetContent(_).find(".e-content").find("tr:eq("+h+")"),o.outerHeight(t),a.height(t),g=m.getSheet(_).usedRange.colIndex,p=0;p<=g;p++)(u=m.XLEdit.getPropertyValue(r[l],p,"sparkline",_))&&(m.XLScroll._getRowHeights(_,r[0]),n=m._getCellInfo({rowIndex:r[l],colIndex:g},1),e("#"+u[0]).css({top:n.top}),m._dataContainer.sheets[_][r[l]][p].sparkline[0].split("_")[3]==r[l]&&m.XLSparkline._sparklineResize(u[0],{height:t},_));m.XLShape&&m.XLShape._refreshShapePosOnResize(r[l],t,!1,_),(m._isUndoRedo||c)&&(m.getSheet(_).rowsHeightCollection[d]=t)}m.XLScroll._getRowHeights(_,r[0]),b.find("tbody").css("cursor","default"),b.find("tbody").children().css("cursor","default"),m._dupDetails||(f={sheetIndex:_,rows:r,newHeight:t,oldHeight:i,reqType:"resize-row"},i===t||m._dupDetails||(m._completeAction(f),m._trigActionComplete(f))),m.model.allowFreezing&&m.XLFreeze._refreshFRowResize(d),m.model.scrollSettings.allowScrolling&&(m.XLScroll._refreshScroller(_,"refresh","all"),m.XLScroll._getFirstRow(_)),m.XLSparkline&&m.XLSparkline._refreshSparklinePos({rowIndex:r[0],colIndex:0},_)}},_findRowsHeight:function(e){for(var t,i=this.XLObj,r=i.getActiveSheetIndex(),l=i.getSheet(r),n=i._getJSSheetContent(r).find("tbody").children(),s=0,o=e.length;s<o;s++)t=e[s],i._sheets[r]._Rows[0]&&(l.rowsHeightCollection[t]=n.eq(t).height())},_calculateHeight:function(){for(var e=this.XLObj,t=e.getRows(e.getActiveSheetIndex())[0],i=0,r=0,l=t.length;r<l;r++)i+=t.eq(r).height();return i},_rMouseUp:function(t){if(this._resizeStart){var i,r,l=this.XLObj,n=this._currentHCell,s=l.getSheet(l.getActiveSheetIndex()).rowsHeightCollection,o={},a=l._setXY(t,navigator.userAgent.indexOf("WebKit")>-1);if(i=a[0],r=a[1],r+=document.documentElement.scrollTop,o.event=t,o.target=t.target,o.oldHeight=s[n],o.rowIndex=this._currentHCell,this._rowResize(i,r),o.newHeight=s[n],o.reqType="row-resize",this.XLObj._trigger("resizeEnd",o))return;e("#"+this.XLObj._id+"ddlspan").length&&this.XLObj._ddlPosition()}},_getResizableRowCell:function(t){for(var i,r,l=this.XLObj,n=l.getActiveSheetIndex(),s=l._getJSSheetContent(n).find(".e-rowheader"),o=navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollTop:document.documentElement.scrollTop,a=1,d=0,h=s.length;d<h;d++)if(0===(i=s[d].getBoundingClientRect()).top&&a++,i.top+o+5>this._orgY)return void(l.isUndefined(t)?(r=e(s[d-1]).is(":visible")?d-1:d-a,this._currentHCell=l._getCellIdx(s[r]).rowIndex):t.target=l._getJSSheetRowHeader(n).find("tr:eq("+d+") td")[0])},_moveRowVisual:function(e){var t=this.XLObj,i=t._getJSSheetContent(t.getActiveSheetIndex()).find(".e-rowheadercontent")[0].getBoundingClientRect();i.top+document.documentElement.scrollTop+i.height<e||e<i.top+document.documentElement.scrollTop?this._$visualElem.remove():this._currentHCell>-1&&this._$visualElem.css({top:e-3,left:this._tableX})},_apMouseDown:function(t){var i,r=this.XLObj;return r._isTouchEvt&&this._apMouseHover(t),this._allowStart&&"col-resize"===e(t.target).closest("div").css("cursor")&&(i=r._setXY(t,navigator.userAgent.indexOf("WebKit")>-1)[0],i+=document.documentElement.scrollLeft,2!==t.button&&this._apStart(i),this._resizeType="AP",t.preventDefault()),!1},_apMouseHover:function(t){var i=this.XLObj;if(!this._$visualElem.is(":visible")){var r=e(t.target),l=i.getActivationPanel()[0].getBoundingClientRect(),n=i._setXY(t)[0];n<=l.left+(i._isTouchEvt?20:4)&&n>=l.left?(r.parent().addClass("e-ss-apresize"),this._allowStart=!0):(i.element.find(".e-ss-apresize").removeClass("e-ss-apresize"),this._allowStart=!1)}},_apStart:function(t){var i,r=this.XLObj,l=r.getActivationPanel()[0].getBoundingClientRect(),n=r.getActiveSheetIndex();this._tableY=l.top+parseInt(navigator.userAgent.indexOf("WebKit")>-1?document.body.scrollTop:document.documentElement.scrollTop),this._allowStart&&(this._$visualElem=e(document.createElement("div")),i=r._getJSSheetContent(n).height()+r._getJSSheetHeader(n).height(),this._$visualElem.addClass("e-reSizeAPbg").appendTo(r.element).css({height:i+"px"}).addClass("e-ss-apresize"),this._$visualElem.css({left:t,top:this._tableY}),this._resizeStart=!0)},_apMouseMove:function(e){if(this._resizeStart){var t=this.XLObj._setXY(e,navigator.userAgent.indexOf("WebKit")>-1)[0];t+=document.documentElement.scrollLeft,e.preventDefault(),this._apMoveVisual(t)}else this._apMouseHover(e)},_apMouseUp:function(e){if(this._resizeStart){var t=this.XLObj._setXY(e,navigator.userAgent.indexOf("WebKit")>-1)[0];t+=document.documentElement.scrollLeft,this._apReSize(t)}},_apMoveVisual:function(e){this._$visualElem.css({left:e-5,top:this._tableY})},_apReSize:function(t){var i,r=this.XLObj,l=r.model.activationPanelWidth,n=0,s=e.extend(!0,{},r.model.scrollSettings),o=r.getActivationPanel();s.width=r._responsiveWidth,s.height=r._responsiveHeight,r.model.activationPanelWidth=Math.abs(s.width-(t-r.element.offset().left)),r.model.enablePivotTable&&(i=r.getActivationPanel().data("ejScroller"),n=r.getActivationPanel().find(".e-vscrollbar").length?20:2,o.find(".e-ss-pivotfield").width(r.model.activationPanelWidth-n),o.find("#"+r._id+"_PivotField").width(r.model.activationPanelWidth-n),l>r.model.activationPanelWidth?(i.option({width:r.model.activationPanelWidth-1}),r._setSheetWidthHeight(r.getActiveSheetIndex(),{width:s.width,height:s.height},null,"resize")):(r._setSheetWidthHeight(r.getActiveSheetIndex(),{width:s.width,height:s.height},null,"resize"),i.option({width:r.model.activationPanelWidth-1})),r.getActivationPanel().find("#"+r._id+"_PivotTableSchema_"+r._getContent(r.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).data("ejPivotSchemaDesigner")._reSizeHandler(),i.refresh()),this._removeVisualElem()},_removeVisualElem:function(){var e=this.XLObj;this._$visualElem.remove(),e.element.find(".e-reSizeRowbg").remove(),this._resizeStart=!1,this._currentHCell=-1,this._resizeType="",this._allowStart=!1,e.model.allowComments&&e.XLComment._updateCmntArrowPos()},fitWidth:function(e){var t,i,r=this.XLObj,l=r.getActiveSheetIndex();if(r.model.allowResizing){for(t=0,i=e.length;t<i;t++)this._fitWidth(e[t],0,r.getSheet(l).usedRange.rowIndex);r.model.scrollSettings.allowScrolling&&(r.XLScroll._getColWidths(l,e[0]+1),r.XLScroll._refreshScroller(l,"refresh","horizontal")),r.model.allowSelection&&r.XLSelection._refreshBorder(),r.model.allowComments&&r.XLComment._updateCmntArrowPos(null,l,{colIndex:e[t]})}},_resizeToFitWidth:function(e){var t=this.XLObj,i=t.getActiveSheetIndex(),r=t.getSheet(i).usedRange.rowIndex,l=e.target.cellIndex;this._getResizableCell(e),this._fitWidth(l,0,r),t.model.scrollSettings.allowScrolling&&(t.XLScroll._getColWidths(t.getActiveSheetIndex(),e.target.cellIndex+1),t.XLScroll._refreshScroller(i,"refresh","horizontal")),t.model.allowSelection&&t.XLSelection._refreshBorder(),t.model.allowAutoFill&&t.XLDragFill.positionAutoFillElement(),t.model.allowComments&&t.XLComment._updateCmntArrowPos(null,i,{colIndex:e.target.cellIndex})},_fitWidth:function(t,i,r){var l,n,s,o,a,d=this.XLObj,h=d.getActiveSheetIndex(),c=d._getJSSheetHeader(h).find(".e-headercell")[t],u=e(c).children(".e-headercelldiv"),g=0,p=d.getSheet(h);if(r=r||p.usedRange.rowIndex,s=Math.round(this._getContentWidth(t,h,i,r)),n=this._getHeaderContentWidth(u,h),s>1&&(o={target:c,sheetIndex:h,colIndex:t,newWidth:g=n>s?n:s,oldWidth:c.offsetWidth,reqType:"resize-fit-width"},g>0)){for(g<20&&(g=30),a=i;a<=r+1;a++)(l=d.XLEdit.getPropertyValue(i,t,"sparkline",h))&&d.XLSparkline._sparklineResize(l[0],{width:g},h),i++;d.XLShape&&d.XLShape._refreshShapePosOnResize(t,g,!0,h),this._applyWidth(c,h,t,g),d.model.allowFreezing&&d.XLFreeze._refreshFColResize(t),d.model.allowAutoFill&&d.XLDragFill.positionAutoFillElement(),p._isImported&&!p._isLoaded||d._isUndoRedo||d._dupDetails||d._isExport||(d._completeAction(o),d._trigActionComplete(o))}d.XLEdit._updateDataContainer({rowIndex:0,colIndex:t},{dataObj:{isFitWidth:!0}})},_applyWidth:function(e,t,i,r){var l=this.XLObj;l._getJSSheetHeader(t).find("col:eq("+i+")").width(r),l._getJSSheetContent(t).find("col:eq("+(i+1)+")").width(r),l.getSheet(t).columnsWidthCollection[i]=r,l.getSheet(t).columns[i].width=r},_getContentWidth:function(e,r,l,n){var s,o,a,d,h=0,c=this.XLObj,u=c._dataContainer.sheets[r],g=c.getSheet(r),p=c._getSelectedCells(r,[l,e,n,e]).selCells;for(p.length&&(delete g._wrapValColl.cols[e],c._wrapTextLenCln(p,g,"isFitWidth",r)),s=l;s<=n;s++)t.isNullOrUndefined(u[s])||(o=u[s][e]),t.isNullOrUndefined(o)?(o={},a={spanWidth:0,paddingWidth:0}):a=this._getCalculatedCellWidth(r,o),(d=(d=g._wrapValColl.cols[e]&&g._wrapValColl.cols[e][s]?c._detailsFromGlobalSpan(s,e,"width",c.XLEdit.getPropertyValue(s,e,"value2"),i,!0):0)+a.spanWidth+a.paddingWidth+4)>h&&(h=d);return h},_getCalculatedCellWidth:function(e,t){var i=0;return"isFilterHeader"in t?"isFilterVisible"in t&&(i+=17):i+=0,3,{spanWidth:i,paddingWidth:3}},_getHeaderContentWidth:function(e){var i=0,r=t.buildTag("span",{},{}),l=e.html();return r.html(l),e.html(r),i=e.find("span:first").width(),i+=10,e.html(l),i},fitHeight:function(e){var t,i,r,l=this.XLObj;if(l.model.allowResizing){for(t=l.getActiveSheetIndex(),i=0,r=e.length;i<r;i++)this._fitHeight(e[i],e[i]),l._setRowHdrHeight(t,e[i]);l.model.scrollSettings.allowScrolling&&(l.XLScroll._getRowHeights(t,e[0]),l.XLScroll._refreshScroller(t,"refresh","vertical")),l.model.allowSelection&&l.XLSelection._refreshBorder(),l.model.allowComments&&l.XLComment._updateCmntArrowPos(null,t,{rowIndex:e[0]})}},_resizeToFitHeight:function(e){var t,i=this.XLObj,r=i.getActiveSheetIndex(),l=e.target.parentNode.rowIndex;t=i.model.scrollSettings.allowVirtualScrolling?i.getSheet(r)._virtualRowIdx[l]:l,this._getResizableRowCell(e),this._fitHeight(l,t),i._setRowHdrHeight(r,t),i.model.scrollSettings.allowScrolling&&(i.XLScroll._getRowHeights(i.getActiveSheetIndex(),t),i.XLScroll._refreshScroller(r,"refresh","vertical")),i.model.allowSelection&&i.XLSelection._refreshBorder(),i.model.allowAutoFill&&i.XLDragFill.positionAutoFillElement(),i.model.allowComments&&i.XLComment._updateCmntArrowPos(null,r,{rowIndex:l})},_fitHeight:function(i,r){var l,n,s,o,a,d,h,c=this.XLObj,u=c.getActiveSheetIndex(),g=c.getSheet(u),p=c._getJSSheetRowHeader(u).find(".e-rowheader")[i],m=t.buildTag("span",{},{height:20,width:30});for(o=this._getContentHeight(r,u,c.XLEdit.getPropertyValue(r,0,"wrapRow")),m.html(r+1),c.element.append(m),a=c.element.find("span:last").outerHeight(!0),c.element.find("span:last").remove(),d={target:p,sheetIndex:u,rowIndex:r,newHeight:s=o<(a+=4)?a:o,oldHeight:g.rowsHeightCollection[i],reqType:"resize-fit-height"},c.XLShape&&c.XLShape._refreshShapePosOnResize(i,s,!1,u),c._isRowViewable(u,r)&&(e(p.parentElement).height(s),e(c._getContent(u).find("tr")[i]).height(s)),c.getSheet(u).rowsHeightCollection[r]=s,l=c.getSheet(u).usedRange.colIndex,h=0;h<=l;h++)(n=c.XLEdit.getPropertyValue(i,l,"sparkline",u))&&c.XLSparkline._sparklineResize(n[0],{height:s},u);c.model.allowFreezing&&c.XLFreeze._refreshFRowResize(i),c.model.scrollSettings.allowScrolling&&c.XLScroll._refreshScroller(u,"refresh","all"),g._isImported&&!g._isLoaded||c._dupDetails||c._isExport||(c._completeAction(d),c._trigActionComplete(d)),c.model.allowAutoFill&&c.XLDragFill.positionAutoFillElement(),c.XLEdit._updateDataContainer({rowIndex:r,colIndex:0},{dataObj:{isFitHeight:!0}})},_getContentHeight:function(e,t,r){for(var l,n,s=this.XLObj,o=0,a=s.getSheet(t),d=s.getObjectKeys(s._dataContainer.sheets[t][e]),h=a.rowsHeightCollection,c=a.columnsWidthCollection,u=0,g=d.length;u<g;u++)(n=s.getRangeData({range:[e,d[u],e,d[u]],property:["value2","merge"]})[0])&&((l=n.merge?h[e]:s._detailsFromGlobalSpan(e,d[u],"height",n.value2,r?c[u]:i,!0))>o&&(o=l));return o},_setRowHdrHeightResize:function(i,r){for(var l,n=this.XLObj,s=n.getRows(i)[0],o=n.getSheet(i).usedRange.rowIndex,a=0;a<=o;a++)t.isNullOrUndefined(n.XLEdit.getPropertyValue(a,r,"mergeIdx"))&&t.isNullOrUndefined(n.XLEdit.getPropertyValue(a,r,"merge"))&&n._isRowViewable(i,a)&&(l=n._detailsFromGlobalSpan(a,r,"height",n.XLEdit.getPropertyValue(a,r,"value2")),e(s[a]).height(l))}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.editing=function(e){this.XLObj=e,this._EditCellDetails={value:null,rowIndex:-1,columnIndex:-1,fieldName:null,cell:null},this._isEdit=!1,this._isFEdit=!1,this._isFormulaEdit=!1,this._isFBarFocused=!1,this._skipHTML=!1,this._editElem=null,this._filterIcon=null,this._isCellEdit=!0,this._validOperators=["+","-","*","/",","],this._invalidOperators=["%"],this._validCharacters=["+","-","*","/",",","(","=","&"],this._textDecoration=!1,this._editCell=null,this._acPosition={left:0,top:0},this._isValidation=!1,this._cursorPosn=-1,this._formulaArrayRange="",this._formatCellVal=null,this._sheetNameSpclchar=!1,this._singleQuote=!1,this._isSplChar=!1},t.spreadsheetFeatures.editing.prototype={getCurrentEditCellData:function(){var e,t,i=this.XLObj;return this._isEdit?(e=i.element.find("#"+i._id+"_Edit").text(),t=i._getCellIdx(this._editCell[0]),"text"!=this.getPropertyValue(t.rowIndex,t.colIndex,"type")&&"en-US"==i.model.locale&&i.isNumber(e)&&(e=parseFloat(e)),e):null},getColumnIndexByField:function(e){for(var t=this.XLObj,i=t.getSheet(t.getActiveSheetIndex()),r=0,l=i.columns.length;r<l&&i.columns[r].field!==e;r++);return r},_processEditing:function(){this._editElem||(this._editElem=t.buildTag("div.e-field e-ss-input","",{},{id:this.XLObj._id+"_Edit",contenteditable:!0}),this._editElem.data("parentID",this.XLObj._id))},editCell:function(i,r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L=this.XLObj;if(L.model.allowEditing&&L.model.allowSelection&&!L._isCellProtected(i,r,!0)&&!L.model.isReadOnly){if(C=L.element.find("#"+L._id+"_ValElem"),I=L.XLEdit.getPropertyValue(i,r,"merge"),!L._intrnlReq&&L.XLEdit.getPropertyValue(i,r,"mergeIdx")||(p={rowIndex:i,colIndex:r},a=L.getActiveSheetIndex(),d=L.getSheet(a),n=L.getActiveCell(a),L._isRowViewable(a,i)&&(this._textDecoration="none"===L.getCell(i,r).find("a").css("text-decoration")),g=L.getCell(i,r),o=d.columns[r],this._editCell=g,c={columnName:o.field,value:L.getRangeData({range:[i,r,i,r],valueOnly:!0,sheetIdx:a,skipDateTime:!0})[0],columnObject:o,cell:g,rowIndex:i,colIndex:r},!L.isFormula(c.value)&&["longdate","shortdate","date","time"].indexOf(this.getPropertyValue(i,r,"type",a))>-1&&!L.isNumber(this.getPropertyValue(i,r,"value",a))&&(c.value=L._getEditValOfDateTime(i,r)),"en-US"!=L.model.locale&&L.isNumber(c.value)&&(S=this.getPropertyValue(i,r,"value2",a),x=c.value+"",v=t.preferredCulture(L.model.locale).numberFormat,w=new RegExp("\\"+v[","]+"\\d{3}"),"."==v[","]&&(w.test(x)||c.value!=S)&&(c.value=L._getlocaleNumVal(x,!0))),L._trigger("cellEdit",c)))return!1;L._cureditedCell=c.value,this._isValidation&&(C.rules("remove"),this._isValidation=!1),n.rowIndex===i&&n.colIndex===r||I||(d._activeCell=p,d._startCell.rowIndex<=i&&d._startCell.colIndex<=r&&d._endCell.rowIndex>=i&&d._endCell.colIndex>=r?L.XLSelection.selectRange(d._startCell,d._endCell):L.XLSelection.selectRange(p,p),L.model.allowAutoFill&&L.XLDragFill.positionAutoFillElement()),!L._intrnlReq&&I&&(L.XLSelection.selectRange(I.mRange),L.model.allowAutoFill&&L.XLDragFill.positionAutoFillElement()),this._EditCellDetails={rowIndex:i,value:c.value,columnIndex:r,fieldName:o.field,cell:g},l||(c.value=""),T=L.XLEdit.getPropertyValue(i,r,"value"),y=L.isFormula(T)?T:L.XLEdit.getPropertyValue(i,r,"value2"),u=l?t.isNullOrUndefined(y)?c.value:y.toString().indexOf("%")>-1?y:c.value:c.value,this._renderBulkEditObject(c,g,u),this.getPropertyValue(d._activeCell.rowIndex,d._activeCell.colIndex,"rule",a)&&L.model.allowDataValidation&&L.XLValidate._setValidation(),h=e("#"+L._id+"_Edit"),this.getPropertyValue(i,r,"hyperlink",a)&&h.addClass("e-hyperlinks"),this._textDecoration&&h.css("text-decoration","none"),L.model.allowComments&&g.hasClass("e-commentcell")&&L.XLComment._visibleCmntCnt(g),c.cell.addClass("msie"===L._browserDetails.name?"e-editedcell e-msie-edit":"e-editedcell"),L.isFormula(c.value)&&this._processFormulaEditRange(c.value),L.model.allowKeyboardNavigation&&(L.XLCellNav._isNavigate=!1),L.model.enableContextMenu&&e("#"+L._id+"_contextMenuCell").data("ejMenu")._contextMenuEvents("_off"),I&&((s=L.getCell(i,r).find("#"+L._id+"_Merge")[0])&&(s.innerHTML="")),m=L.getFrozenColumns()?d._leftCol.idx:0,d._rightCol.idx+m===n.colIndex&&n.colIndex!=d.colCount-1&&this._isEdit&&(f=L._getIdxWithOffset(null,d._scrollLeft,!0),L.getFrozenColumns()&&(b=parseInt(L.element.find("#"+L._id+"_Edit")[0].style.left),L.element.find("#"+L._id+"_Edit")[0].style.left=b-d.columnsWidthCollection[f.colIdx]+"px")),_=L.getFrozenRows()?d._topRow.idx:0,d._bottomRow.idx+_===n.rowIndex&&n.rowIndex!=d.rowCount-1&&this._isEdit&&(f=L._getIdxWithOffset(d._scrollTop,null,!0),L.getFrozenRows()&&(b=parseInt(L.element.find("#"+L._id+"_Edit")[0].style.left),L.element.find("#"+L._id+"_Edit")[0].style.left=b-d.columnsWidthCollection[f.colIdx]+"px"))}},_renderBulkEditObject:function(i,r,l){var n,s,o,a,d=this.XLObj,h=r.height(),c=d.getActiveSheetIndex(),u=r.find(".e-filterspan"),g=d._getJSSheetContent(c).find(".e-spreadsheetcontentcontainer > .e-content"),p=d.XLFormat.getFormatClass(r[0].className);({})[i.columnObject.field]=i.value,u.length&&(s={filterIcon:u,rowIndex:u.parentsUntil("table").eq(1).index(),colIndex:u.parent().index()},this._filterIcon=s),n=r.height(),this._refreshTextNode(r[0]),r.hasClass("e-sswraptext")&&h!==n&&r.height(h),(a=this._editElem).text(""),t.isNullOrUndefined(l)||a.text(l),g.append(a),o=d._isClassHasProperty(p,"text-align","right")?{right:g.width()-r[0].offsetLeft-r[0].offsetWidth+2,left:"",maxWidth:r[0].offsetLeft+r[0].offsetWidth+2}:{left:r[0].offsetLeft+2,right:"",maxWidth:g.width()-(r.offset().left-(d.element.offset().left+e(d.getRows(c)[0][0]).width()))-2},a.css({left:o.left,right:o.right,top:r[0].offsetTop+1,"-webkit-user-select":"text",cursor:"text","min-height":n-1,height:"auto",lineHeight:"normal",wordWrap:"break-word",position:"absolute",minWidth:r.width(),whiteSpace:"pre-wrap"}),this._editCell.hasClass("e-sswraptext")?(a.css({width:r.width(),maxWidth:""}),e(d.getRows(c)[1][r.parent().attr("data-idx")]).height(d.model.sheets[c].rowsHeightCollection[r.parent().attr("idx")]),d.XLScroll._getRowHeights(c,r.parent().index())):a.css({width:"",maxWidth:o.maxWidth}),a.show(),this._refreshEditForm(r,a,i.value,l,n),this._isEdit=!0,d.model.showRibbon&&d.XLRibbon._disableRibbonIcons()},_refreshEditForm:function(t,i,r,l){var n,s,o=this.XLObj;i[0].className="","percentage"!=(s=this.getPropertyValueByElem(t,"type")||"")||o.isFormula(r)||l.indexOf("%")>-1||i.prepend("%"),!o.isNumber(l)||s.indexOf("text")>-1||i.addClass("e-ralign"),(s.indexOf("date")>-1||s.indexOf("time")>-1)&&i.addClass("e-ralign"),i.css({border:"none",outline:"none"}),this.XLObj.model.allowCellFormatting&&(n=o.XLFormat.getFormatClass(t[0].className)),i.addClass(n),o.model.allowCellFormatting&&(i.css({color:t.css("color")}),i.css({"background-color":t.css("background-color")})),i.on("keyup",{xlObj:o},function(t){var i=t.data.xlObj;i.XLEdit._isFormulaEdit=!e(t.target).text().indexOf("="),i.XLEdit._isFormulaEdit&&i.XLEdit._processFormulaEditRange(e(t.target).text()),i.model.allowFormulaBar&&i._getInputBox().val(e(t.target).text()),i.XLEdit._isCellEdit=!0}),i.on("focus",{xlObj:o},function(e){e.data.xlObj.XLEdit._isCellEdit=!0}),o._setFormulaSuggElem(e("#"+o._id+"_AutoComplete_suggestion")),"percentage"==s?i.focus():i.focusEnd()},_renderAutoComplete:function(t,i,r,l){var n=this.XLObj,s=l?" e-cell-ac e-ss-editinput":"";t.ejAutocomplete({dataSource:n._formulaCollection,value:i,cssClass:"e-ss-autocomplete"+s,width:"100%",height:r,htmlattributes:l?{display:"none"}:"",delaySuggestionTimeout:10,minCharacter:2,popupWidth:"170px",popupHeight:"150px",showEmptyResultText:!1,autoFocus:!0,template:"<span class='e-icon e-ss-function'> </span><div> ${display} </div>",select:e.proxy(this._formulaSelect,n),open:e.proxy(this._formulaSuggestionStatus,n),close:e.proxy(this._formulaSuggestionStatus,n)}),t.data("ejAutocomplete")._bubbleEvent(!0)},_refreshAutoComplete:function(t){var i,r,l=this.XLObj,n="ejAutocomplete",s="dataSource";r=e("#"+l._id+"_inputbox").data(n),i=e("#"+l._id+"_AutoComplete").data(n),l.model.allowFormulaBar&&r&&r.option(s,t?l._tableFormulaCollection[t]:l._formulaCollection),i&&i.option(s,t?l._tableFormulaCollection[t]:l._formulaCollection)},_captureEditing:function(t){var i,r,l,n,s,o=this.XLObj,a=document.activeElement,d=o.getActiveCell(),h=e("#"+o._id+"_AutoComplete_suggestion");a&&"DIV"===a.tagName&&o._isRowViewable(null,d.rowIndex)&&(i=o.element.find("#"+o._id+"_AutoComplete"),t?i.val("["):i.val(e(a).text()),i.data("ejAutocomplete").search(),s=h.find("li span.e-ss-function"),t?s.removeClass("e-ss-function"):s&&s.addClass("e-ss-function"),r=o.getActiveCellElem(),l=o.element.find("#"+o._id+"_Edit")[0],n=r[0].getBoundingClientRect(),this._acPosition.left=n.left+window.pageXOffset,this._acPosition.top=n.top+window.pageYOffset+e(l).height(),h.css({left:this._acPosition.left,top:this._acPosition.top}))},saveCell:function(){var t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A=this.XLObj;if(A.model.allowEditing&&!A.model.isReadOnly&&(this._cursorPosn=-1,L=!1,R=["ABS","LEFT","RIGHT","TRIM","UPPER","VALUE","YEAR"],this._isEdit)){if(w=A.getActiveSheetIndex(),I=A.getSheet(w),l=e("#"+A._id+"EditForm"),u=this._editCell,h=I.columns[this._EditCellDetails.columnIndex],g=A.element.find("#"+A._id+"_ValElem"),O=A.element.find("#"+A._id+"_Edit")[0],F=e(O).html(),b=(p=A._getCellIdx(u[0])).rowIndex,C=p.colIndex,S={columnName:h.field,value:this.getCurrentEditCellData(),prevValue:this._EditCellDetails.value,columnObject:h,rowIndex:b,colIndex:C,cell:u,isRefCells:!1,sheetIdx:w},this.getPropertyValue(b,C,"hasMultipleFormulaArray"))return A.XLCellNav&&(A.XLCellNav._isNavigate=!0),A._showAlertDlg("Alert","ArrayaFormula","multipleArrayFormula",430),void A.XLSelection._clearBorder(A._arrayAsString(A._ctrlFormulaBorder.concat(A._formulaBorder)));if(A.model.allowDataValidation&&this._isValidation){if(g.val(S.value),l.css("display","block"),!l.validate().element(g[0]))return l.css("display","none"),!1;l.css("display","none"),S.hasValidation=!0}if(S.value!==S.prevValue&&A._trigger("cellSave",S))return;if(a=A.getRangeData({range:[b,C,b,C],property:["type","formatStr","decimalPlaces"]})[0],A.isFormula(S.value)){if(!this._formulaValidate(S.value))return;E=S.value.indexOf("(worksheet)")>-1&&S.value.split(" (worksheet)")[0].replace("=",""),S.value=I._scopeRanges[E]?"="+I._scopeRanges[E].name:S.value}if(x=this._EditCellDetails.value||"",(v={sheetIndex:w,rowIndex:b,colIndex:C,cValue:S.value,reqType:"edit",iconName:"",pValue:x}).prevHeight=I.rowsHeightCollection[b],A._dupDetails=!0,A.isFormula(S.value)&&(A._saveTriggered=!0),this._updateCellValue({rowIndex:b,colIndex:C},S.value),A.isFormula(S.value)&&(A._saveTriggered=!1),A._dupDetails=!1,this.getPropertyValue(b,C,"wrap",w)&&(x.length!==S.value.length&&A._wrapTextLenCln([{rowIndex:b,colIndex:C}],I,"savcell",w),m=A._getWrapCellHeight(w,b,C),A._wrapCollection(b,C,m.cellHt,w),A._getRowHeight(b,w)<m.rowHt&&(A.setHeightToRows([{rowIndex:b,height:m.rowHt}]),A.model.allowAutoFill&&A.XLDragFill.positionAutoFillElement()),this._updateDataContainer({rowIndex:b,colIndex:C},{dataObj:{}})),A.XLEdit.getPropertyValue(b,C,"isFilterHeader")&&A._removeClass(S.cell[0],A._rAlign),this._textDecoration&&S.cell.find("a").css("text-decoration","none"),S.hasValidation&&(v.hasValidation=!0),A.isFormula(S.value)&&(!A.getObjectLength(a)||"general"===a.type)&&(v.operation="formula",o=S.value,o=A.XLDragFill._parseFormula(o),-1===R.indexOf(o[0]))){for(i=0,d=o.length;i<d;i++)if((s=o[i]).indexOf("!")>-1)w=A._getSheetIndexByName(s.split("!")[0])||w;else if("("!=s&&"("!=o[i+1])break;s.indexOf(":")>-1&&(s=s.split(":")[0]),A._isCellReference(s)&&(s=s.replace(/\$/g,""),y=A.getRangeIndices(s),T=A.getRangeData({range:y,property:["type","formatStr","decimalPlaces"],sheetIdx:w})[0],A.getObjectLength(T)&&T.type!=a.type&&"general"!==T.type&&"shortdate"!==T.type&&(A._dupDetails=!0,L=!0,A.XLFormat.format(T,A._getAlphaRange(A.getActiveSheetIndex(),b,C,b,C)),A._dupDetails=!1,v.prevFrmtObj=A.getObjectLength(a)?a:{type:"general"},v.curFrmtObj=T))}if(A._setRowHdrHeight(w,b),A.model.scrollSettings.allowScrolling&&A.XLScroll._getRowHeights(w,b),this._isEdit=this._isFormulaEdit=!1,A.model.allowFormulaBar&&A.updateFormulaBar(),S.cell.removeClass("e-editedcell e-msie-edit"),A.model.allowKeyboardNavigation&&(A.XLCellNav._isNavigate=!0),A.model.showRibbon&&(A.XLRibbon._enableRibbonIcons(),A.XLRibbon._updateRibbonIcons()),A._updateUndoRedoIcons(),A.model.allowInsert||(A.XLRibbon._disableButtons(["Others_Cells_InsertCellOptions"],"ejSplitButton"),A.XLRibbon._disableButtons(["Others_Cells_InsertCell"],"ejButton")),A.model.allowDelete||(A.XLRibbon._disableButtons(["Others_Cells_DeleteCellOptions"],"ejSplitButton"),A.XLRibbon._disableButtons(["Others_Cells_DeleteCell"],"ejButton")),v.cFormatRule=_=this.getPropertyValue(b,C,"cFormatRule",w),A._dupDetails=!0,A.model.allowConditionalFormats&&_){for(t=0,f=_.length;t<f;t++)"formularule"!==(c=_[t].split("_"))[0]&&A.XLCFormat._cFormat(c[0],c[2],c[3],c[4],c[5],A._generateHeaderText(C+1)+(b+1));A.XLCFormat.refreshCFormat(A._getAlphaRange(w,b,C,b,C))}return A._dupDetails=!1,v.endCell=I._endCell,v.startCell=I._startCell,(r=A.getActiveCellElem())&&(A.model.allowComments&&r.hasClass("e-commentcell")&&A.XLComment._visibleCmntCnt(r,!0),r.hasClass("e-hlcell")&&A.XLValidate.highlightInvalidData()),this._shiftKeyEnabled=this._isFBarFocused=!1,A._ctrlKeyCount=0,!this._isFormulaEdit&&A.model.allowSelection&&A.XLSelection._clearBorder(A._formulaBorder.join(" ").replace(/,/g," ")+" "+A._ctrlFormulaBorder.join(" ").replace(/,/g," ")),A.model.allowFormulaBar&&((n=e("#"+A._id+"_inputbox").data("ejAutocomplete"))&&n.hide()),this._editElem.hide(),A._setSheetFocus(),"mozilla"===A._browserDetails.name&&(F=F.slice(0,-4)),F.indexOf("\n")>-1&&(v.altwrap=!0,this._updateDataContainer({rowIndex:b,colIndex:C},{dataObj:{altTxt:!0}})),this.getPropertyValue(b,C,"altTxt",w)&&(this.getPropertyValue(b,C,"wrap",w)||A.wrapText([b,C,b,C]),F.match(/\n/g)||this._clearDataContainer({cellIdx:{rowIndex:b,colIndex:C},property:["altTxt"]})),D=this.getPropertyValue(b,C,"sparkline",w),A.model.allowSparkline&&D&&(A.getCell(b,C,w).find(".e-sparkline").length<1&&(N=I.shapeMngr.sparkline[D[0]],A.XLSparkline._createSparkline(N,null,w))),v.newHeight=I.rowsHeightCollection[b],A.XLScroll._getRowHeights(w,b),A.model.enableContextMenu&&e("#"+A._id+"_contextMenuCell").data("ejMenu")._contextMenuEvents("_on"),(S.value!==S.prevValue||L)&&(A._completeAction(v),A._trigActionComplete(v)),!0}},_getCellPosition:function(e,t){var i,r,l=this.XLObj,n=this._formulaArrayRange||l.getSheet(l.getActiveSheetIndex()).selectedRange,s=0,o={},a=n[2]-n[0],d=n[3]-n[1],h=!1;for(1<t&&(h=!0),i=0;i<=d;i++){for(r=0;r<=a;r++)l.isUndefined(o[n[0]+r])&&(o[n[0]+r]={}),e<=r||h&&t<=i?o[n[0]+r][n[1]+i]=-1:(o[n[0]+r][n[1]+i]=s,h||s++);h?s++:s=0}return o},_formulaValidate:function(e){for(var t,i,r,l,n,s,o,a=e,d=this.XLObj,h=d.model.customFormulas,c=["RAND","TODAY","NOW","TRUE","FALSE","ROW","COLUMN","SHEET","SHEETS"],u=e.split("[")[0],g=0;g<h.length;g++)c.push(h[g].formulaName.toUpperCase());if(d._tableRangesFormula[u.slice(1)]){if((i=a.split("[").length)!==(r=a.split("]").length))return void d._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440)}else if(!this._isNamedRange(e)){if(e=e.startsWith("=")&&e.replace("=",""),d.getCalcEngine().getNameRangeValues().contains(e.toUpperCase()))return!0;if(l=a.length,i=a.split("(").length,r=a.split(")").length,n=d.getCalcEngine().getLibraryFunctions(),a.startsWith("=")&&l>1){if(t=a=a.substring(1),i!==r)return void d._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440);if(1===i&&1===r&&d.isUndefined(n.getItem(t.toUpperCase()))&&!this._isValidCell(a)&&"TRUE"!=t.substring(0,s)&&"FALSE"!=t.substring(0,s))return void d._showAlertDlg("Alert","CorrectFormula","FormulaAlert",372);do{if(s=t.indexOf("("),o=t.indexOf(")"),c.indexOf(t.substring(0,s).toUpperCase())<0&&s+1===o)return void d._showAlertDlg("Alert","CorrectArgument","FormulaAlert",372);(t=t.substring(s+1)).indexOf(",")>-1&&(t=t.substring(t.indexOf(",")+1))}while(t.indexOf("(")>-1)}}return!0},_isValidCell:function(e){for(var i,r,l,n,s=this.XLObj,o=!0,a=!0,d=["<=",">=","<",">","=","+","-","/","*","^","&"],h=0,c=d.length;h<c;h++){if(e.indexOf(d[h])>-1)for(n=0,l=(r=e.split(d[h])).length;n<l;n++){if(!(r[n].length||t.isNullOrUndefined(r[n+1])||r[n+1].length))return!1;if(l==n+1&&r[n].length)return!0}if(e.indexOf("%")>-1&&2==e.split("%").length)return!0}return(e=(e=e.trim()).startsWith("=")?e.substring(1):e).indexOf("!")>-1&&(e=(i=e.split("!"))[1],s._getSheetIndexByName(i[0])<1&&(o=!1)),this._isNamedRange("="+e)||(a=e.indexOf(":")>-1?s._isvalidRange(e):s._isvalidRange(e+":"+e)),a&&o},updateValue:function(e,t,i,r){var l,n,s=this.XLObj;s.model.isReadOnly||(n={rowIndex:(l=s.getRangeIndices(e))[0],colIndex:l[1]},s._isPublic=!0,s.model.allowCellFormatting&&s.XLFormat._hasFormat(i)&&(s.XLFormat._createFormatClass(s.XLFormat.getFormatFromHashCode(i),i),s.XLFormat._updateFormatClass(n,i)),this._updateCellValue(n,t,i,r),s._isPublic=!1)},updateCellValue:function(e,t,i,r){var l=this.XLObj;l._isPublic=!0,l.model.allowCellFormatting&&l.XLFormat._hasFormat(i)&&(l.XLFormat._createFormatClass(l.XLFormat.getFormatFromHashCode(i),i),l.XLFormat._updateFormatClass(e,i)),this._updateCellValue(e,t,i,r),l._isPublic=!1},_updateCellValue:function(e,i,r,l,n){var s=this.XLObj;if(l=s._getSheetIndex(l),e&&!s.model.isReadOnly){var o,a=e.colIndex,d=e.rowIndex,h=s.getActiveCell(),c=s._getSheetNames();if(s.isFormula(i)&&"text"!==this.getPropertyValue(d,a,"type",l)){for(o=0;o<s.model.sheetCount;o++)isNaN(c[o].text)&&/^[a-zA-Z0-9- ]*$/.test(c[o].text)&&!c[o].text.match("\\s+")||(this._sheetNameSpclchar=!0,i=this._parseSheetRef(i));this._sheetNameSpclchar=!1,this._updateDataContainer({rowIndex:d,colIndex:a},{dataObj:{value:i,hasFormulaArray:s._hasFormulaArray,hasMultipleFormulaArray:s._hasMultipleFormulaArray},sheetIdx:l}),this._refreshCalcEngine(d,a,!0,i,l),s._isFormulaSuggestion=!1}else i&&"'"==i[0]?this._updateDataContainer({rowIndex:d,colIndex:a},{dataObj:{value:i,value2:i.substr(1)},sheetIdx:l}):(this._updateCell({rowIndex:d,colIndex:a},i,l,n),this._refreshCalcEngine(d,a,!1,null,l));s._isPublic&&(s.model.allowDataValidation&&this.getPropertyValue(d,a,"isHighlight",l)&&s.XLValidate.highlightInvalidData(),s.model.allowConditionalFormats&&s.XLCFormat.refreshCFormat([d,a,d,a]),s.model.allowComments&&s.XLComment._updateCmntArrowPos(),h.rowIndex===d&&h.colIndex===a&&(s.model.showRibbon&&s.XLRibbon._updateRibbonIcons(),s.model.allowFormulaBar&&s.updateFormulaBar()),this.getPropertyValue(d,a,"wrap",l)&&s._updateWrapCol("updatecellvalue",[e],s.getSheet(l),l,d),t.isNullOrUndefined(r)||s.XLFormat._updateRowHeight([d,a,d,a],l))}},updateCell:function(e,t,i){var r=this.XLObj;r._isPublic=!0,this._updateCell(e,t,i),r._isPublic=!1},_updateCell:function(i,r,l,n){var s,o,a,d=this.XLObj;if(i&&!d.model.isReadOnly){l=d._getSheetIndex(l);var h,c,u,g=!0,p=d.getSheet(l),m=i.rowIndex,_=i.colIndex,f=t.Spreadsheet.CellType,b=this.getPropertyValue(m,_,"value2")||"",C=p.rowsHeightCollection[m],S=d.getCell(m,_),x=this._parseValue(r,i),v=x.type,w=d.getRangeData({range:[m,_,m,_],property:["formatStr","type","thousandSeparator","decimalPlaces","cellType","customFormat"],sheetIdx:l})[0],I=d._dataContainer,y=!1;if(!d.model.isReadOnly&&(w.type&&w.type!=f.General&&(x.type=w.type,x.type==f.Text&&(x.align=t.Spreadsheet.Align.Left,x.value=x.value2=r),delete x.formatStr),w.formatStr||w.type===f.Scientific||w.type===f.Fraction?(x.value2.indexOf("%")>-1&&(x.value=d.isNumber(x.value)?x.value/100:x.value),x.value2=d.XLFormat._format(x.value,{formatStr:w.formatStr,type:w.type,thousandSeparator:w.thousandSeparator,decimalPlaces:w.decimalPlaces,isTime:v===t.Spreadsheet.CellType.Time},i),this._formatCellVal&&(x.value=this._formatCellVal)):x.formatStr&&"percentage"==x.type&&x.value2.indexOf("%")>-1&&(x.value=d.isNumber(x.value)?x.value/100:x.value,x.value2=d.XLFormat._format(x.value,{formatStr:x.formatStr,type:x.type,thousandSeparator:x.thousandSeparator,decimalPlaces:x.decimalPlaces},i)),this._formatCellVal=null,d.model.allowCellType&&!d.isUndefined(w.cellType)&&(g=d.XLCellType._rfrshCtrlText(w,x.value)),g?(d._isInitLoad||d.isImport||d.model.isImport||(h=this.getPropertyValue(m,_,"tableName",l),!d.XLFormat._isFAT&&h&&(s=this.getPropertyValue(m,_,"value2",l),x.value2=d.XLFormat._updateTableColName(m,_,s,x.value2,l,h),"general"===x.type&&(x.value=x.value2))),"(#,##0);#,##0"==w.customFormat&&x.value2.indexOf("-")>-1&&(y=!0),w.customFormat&&(x.value2="currency"==w.type?w.customFormat.indexOf(")")>-1?x.value2:x.value2.split(/[(\)]/)[1]:w.customFormat.indexOf(")")>-1&&!y?"("+(x.value2.indexOf("-")>-1?x.value2.split("-")[1]:x.value2)+")":x.value2.split("-")[1]),this._updateDataContainer(i,{dataObj:x,sheetIdx:l})):(!d.isUndefined(w.cellType)&&t.isNullOrUndefined(n)&&(e("#"+I.sheetCellType[w.cellType].id).data("ej"+I.sheetCellType[w.cellType].type).destroy(),S&&(S[0].innerHTML=""),d._removeClass(S[0],"e-cellreadonly"),delete I.sheets[l][m][_].cellType),this._updateDataContainer(i,{dataObj:x,sheetIdx:l})),d._isPublic&&!d._isScrolling&&this.getPropertyValue(m,_,"wrap")&&((c=d._getWrapCellHeight(l,m,_)).cellHt>p.rowsHeightCollection[m]&&(d._isRowViewable(l,m)?d.setHeightToRows([{rowIndex:m,height:c.rowHt}]):(p.rowsHeightCollection[m]=c.rowHt,d.XLScroll._getRowHeights(l,m)),d._wrapCollection(m,_,c.cellHt,l))),this.getPropertyValue(m,_,"wrap",l)&&d._updateWrapCol("updatecellvalue",[i],d.getSheet(l),l,m),u={sheetIndex:l||d.getActiveSheetIndex(),rowIndex:m,colIndex:_,reqType:"edit",cValue:r,pValue:b||"",prevHeight:C,newHeight:p.rowsHeightCollection[m],isHighlightData:!1},d._dupDetails||(d._completeAction(u),d._trigActionComplete(u)),u.isHighlightData&&(d._pushHighlightData([m,_,m,_]),d.XLClipboard._highLightRange.length&&"hl-data"!=u.operation))){for(o=0,a=d.XLClipboard._highLightRange.length;o<a;o++)d.XLValidate.highlightInvalidData(d.XLClipboard._highLightRange[o]);d.XLClipboard._highLightRange=[]}}},_parseValue:function(i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=this.XLObj.model.locale,C=i,S=t.isNullOrUndefined(i);r&&(n=this.getPropertyValue(r.rowIndex,r.colIndex,"decimalPlaces"),s=this.getPropertyValue(r.rowIndex,r.colIndex,"thousandSeparator"),o=this.getPropertyValue(r.rowIndex,r.colIndex,"type")),d=(a=t.preferredCulture(b)).numberFormat[","]||",",c=a.numberFormat["."]||".",h=new RegExp("^\\d+(\\"+d+"\\d{3,})+$|^\\d+(\\"+d+"\\d{3,})+\\"+c+"\\d+$|^\\d+(\\"+c+"\\d+)+$"),(u=!S&&t.parseFloat(i.toString(),10,b))&&(C=u),r&&"text"==o||(S||(l=this.XLObj._getlocaleNumVal(C)),i=t.isNullOrUndefined(i)?"":"object"!=typeof i||this.XLObj._isDateTime(i)?i:JSON.stringify(i));var x,v,w,I,y,T,L=this.XLObj,R=t.Spreadsheet.CellType,O=t.Spreadsheet.Align.Right,F="object"!=typeof i||this.XLObj._isDateTime(i)?i+"":JSON.stringify(i),E=R.General,D=F.indexOf(L._currencySymbol);if(l&&(i=l),(0===D||D>-1&&D===F.length-1)&&(v=t.parseFloat(F,10,b)))return T=F.indexOf(L._decimalSeparator)>-1?L._decimalCnt(v):0,T=n>-1?n:T,{type:R.Currency,value:v,value2:F,formatStr:L._getFormatString(R.Currency,T),decimalPlaces:T,align:O};if(F.indexOf(L._percentSymbol)>-1&&(v=e.trim(F).replace(L._percentSymbol,""),g=t.parseFloat(v,10,b),L.isNumber(g)))return T=F.indexOf(L._decimalSeparator)>-1?L._decimalCnt(v):0,T=n>-1?n:T,{type:R.Percentage,value:g,value2:F,formatStr:L._getFormatString(R.Percentage,T),decimalPlaces:T,align:O};if(F.indexOf(L._decimalSeparator)>-1&&o&&"general"!=o&&(v=t.parseFloat(F,10,b)))return(T=v.toString().substr(F.indexOf(L._decimalSeparator)+1).length)>2&&(T=2),F=t.format(v,"N"+T,b),T=n>-1?n:T,{type:R.Number,value:v,value2:F,formatStr:L._getFormatString(R.Number,T),decimalPlaces:T,thousandSeparator:!!this.XLObj.isUndefined(s)||s};if(F.indexOf(d)>-1&&"shortdate"!=o&&"date"!=o&&"time"!=o&&"longdate"!=o&&h.test(F)&&(v=t.parseInt(F,10,b)))return T=0,F=t.format(v,"N"+T,b),T=n>-1?n:T,{type:R.Number,value:v,value2:F,formatStr:L._getFormatString(R.Number,T),decimalPlaces:T,thousandSeparator:!!this.XLObj.isUndefined(s)||s};for(x in w=a.calendar.patterns,I=!0,h=a.calendar._parseRegExp,w)if(h&&w[x]in h?v=new RegExp(h[w[x]].regExp).exec(F):(I=!1,v=t.parseDate(F,w[x],b)),v){if(I||(I=!0),"d"==x){for(_=0,f=(m=w.d.split(a.calendar["/"])).length;_<f;_++)if("m"===m[_].toLowerCase()){p=_+1;break}if(parseInt(v[p])>12){v=null;continue}}break}return v&&(I&&(v=t.parseDate(F,w[x],b)),v)?("T"===x||"t"===x||L.XLFormat._customFormatSpecifierType[x]===R.Time?(v.setYear(1990),v.setMonth(0),v.setDate(1),E=R.Time):E="d"===x?R.ShortDate:"D"===x?R.LongDate:R.Date,y="{0:"+w[x]+"}",{type:E,value:v,value2:F=L.XLFormat._format(v,{type:E,formatStr:y}),formatStr:y,align:O}):(("true"===F.toLowerCase()||"false"===F.toLowerCase())&&(i=F=F.toUpperCase()),{type:E,value:i,value2:F})},updateCellWithContainer:function(e,i,r,l){var n,s,o,a,d,h,c,u,g,p=this.XLObj;if(!p.model.isReadOnly){for(r=p._getSheetIndex(r),u=0,g=0,i=i||p.getSheet(r).selectedRange,c=(h=p._getSelectedRange({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]})).length;u<c;)o=(d=h[u]).rowIndex,l&&p._isHiddenRow(o)||(s=d.colIndex,a=e[g],n=p.getCell(o,s,r),this._updateDataContainer(d,{dataObj:a}),this._refreshCalcEngine(o,s,p.isFormula(a.value),a.value),n&&a.format&&p.addClass(n[0],a.format),n&&a.hyperlink&&n.html(t.buildTag("a.e-hyperlinks",a.value2,"","cellAdr"in a.hyperlink?{href:"#"}:{href:a.hyperlink.webAdr,target:"_blank"})),a.comment&&p.XLComment.setComment([o,s,o,s],null,!1),a.border&&p.XLFormat.applyBorder(p.XLFormat.getBorderFromHashCode(a.border),p._getAlphaRange(r,o,s,o,s)),n&&(a.rule&&a.rule.isApply?p.addClass(n[0],"e-hlcell"):p._removeClass(n[0],"e-hlcell")),g++),u++;p.model.allowConditionalFormats&&p.XLCFormat.refreshCFormat(i)}},_refreshCellAlignment:function(e){e=e||{};var i,r,l=t.Spreadsheet.Align,n=this.XLObj,s=e.cellIdx.rowIndex,o=e.cellIdx.colIndex,a=this.getPropertyValue(s,o,"merge"),d=this.XLObj._getlocaleNumVal(e.value);l in e||(e.value=t.isNullOrUndefined(e.value)?this.getPropertyValue(s,o,"value"):e.value,e.type=e.type?e.type:this.getPropertyValue(s,o,"type"),"en-US"!==n.model.locale&&!isNaN(d)&&["currency","accounting","number","scientific","fraction"].indexOf(e.type)>-1&&(e.value=d),n.isFormula(e.value)&&(e.value=n.XLEdit.getPropertyValue(s,o,"calcValue")),e.align=!n.isNumber(e.value)&&"object"!=typeof e.value&&("shortdate"!==e.type&&"longdate"!==e.type&&"time"!==e.type||!n._isDateTime(new Date(e.value&&e.value.toString())))||e.type===t.Spreadsheet.CellType.Text||a&&a.isCenterAlign?n._isBool(e.value)||a&&a.isCenterAlign?l.Center:l.Left:l.Right),i=this.getPropertyValue(s,o,"align"),!n._isInitLoad||n.isImport||n.model.isImport||(r=!0),(!e.align||i&&i!=e.align)&&n.clearRangeData([s,o,s,o],["align"],"","","",r),e.align&&this._updateDataContainer(e.cellIdx,{dataObj:{align:e.align},skipCell:r,sheetIdx:e.sheetIdx})},_editingHandler:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k;if(!e(i.target).parents(".e-backstagecontent").length){if(n=this.XLObj,53===i.keyCode&&i.shiftKey&&(2==(r=this._editElem.text()).split("%").length&&this._cursorPosn-r.indexOf("%")==-1))return this._editElem.setCursorPosition("8.0"===n._browserDetails.version?document.selection.anchorOffset+1:window.getSelection().anchorOffset+1),i.preventDefault(),void(this._cursorPosn=-1);if(!(61===i.keyCode||!i.shiftKey&&32===i.keyCode||i.keyCode>=48&&i.keyCode<=59||i.keyCode>=65&&i.keyCode<=90||i.keyCode>=96&&i.keyCode<=111||173===i.keyCode||i.keyCode>=186&&i.keyCode<=192||i.keyCode>=219&&i.keyCode<=222)||i.ctrlKey||i.altKey)if(113!==i.keyCode||i.shiftKey||i.ctrlKey)if(27===i.keyCode&&this._isEdit&&n.model.allowKeyboardNavigation)s=n.getActiveSheetIndex(),c=(o=n.getSheet(s))._activeCell.rowIndex,u=o._activeCell.colIndex,a=n.getCell(c,u),d=n._dataContainer.sheets[s],n.XLEdit.getPropertyValue(c,u,"wrap")&&n.XLEdit.getPropertyValue(c,u,"merge")&&(T=n.getCell(c,u,s).find("#"+n._id+"_Merge")[0]),L=(h=c in d&&u in d[c]?d[c][u]:h)?"string"==typeof h.value2?h.value2:n._dataContainer.sharedData[h.value]:"",n.isFormula(L)&&(L=this.getPropertyValue(c,u,"value2")),n.element.find("#"+n._id+"_Edit").hide(),(l=n._isRowViewable(s,c))&&(T?T.innerHTML=L:this._refreshTextNode(a[0],L),n._setSheetFocus(),n._setRowHdrHeight(s,o._selectedCells[0].rowIndex)),n.model.allowFormulaBar&&n.updateFormulaBar(),this._isFormulaEdit&&e("#"+n._id+"_AutoComplete").data("ejAutocomplete").suggestionList.hide(),this._isEdit=this._isFormulaEdit=this._isFBarFocused=!1,n._getContent(s).find("td[class *='border']").removeClass(n._formulaBorder.join(" ").replace(/,/g," ")+" "+n._ctrlFormulaBorder.join(" ").replace(/,/g," ")),l&&(n.model.allowComments&&a.hasClass("e-commentcell")&&n.XLComment._visibleCmntCnt(a,!0),n.model.allowAutoFill&&n.XLDragFill.positionAutoFillElement(),a.removeClass("e-editedcell e-msie-edit")),n.model.showRibbon&&n.XLRibbon._enableRibbonIcons(),n._getContent(n.getActiveSheetIndex()).find(".e-error").remove(),t.isNullOrUndefined(n.XLCellNav)||(n.XLCellNav._isNavigate=!0);else if(46===i.keyCode&&n.model.allowKeyboardNavigation)if(this._isEdit)n._ctrlKeyCount>0&&(n._ctrlKeyCount=0,n._formulaRange=[],n.XLSelection._clearBorder(n._formulaBorder.join(" ").replace(/,/g," ")+" "+n._ctrlFormulaBorder.join(" ").replace(/,/g," ")));else{if(n._preventctrlkey)return void n._showAlertDlg("Alert","CtrlKeyErrorAlert","CtrlKeyErrorAction",450);if(s=n.getActiveSheetIndex(),o=n.getSheet(s),D={range:E=n._getRangeArgs(o.selectedRange,"string"),sheetIndex:s,reqType:"clear-content",type:"actionBegin",action:"clearContent"},n._trigActionBegin(D))return;if(E!=D.range&&n.XLSelection.selectRange(D.range),a=n.getCell(o._activeCell.rowIndex,o._activeCell.colIndex),I=o._selectedCells,r=n.getRangeData({range:[I[0].rowIndex,I[0].colIndex,I[I.length-1].rowIndex,I[I.length-1].colIndex]}),n.model.allowLockCell&&o.isSheetProtected&&n._isPropExists([o.selectedRange],"isLocked",s))return;if(n._isPropExists([o.selectedRange],"isReadOnly",s))return;if((O=this.getPropertyValue(I[0].rowIndex,I[0].colIndex,"formulaRange"))&&((F=n.getRangeIndices(O))&&(F[2]!=I[I.length-1].rowIndex||F[0]!=I[0].rowIndex||F[3]!=I[I.length-1].colIndex||F[1]!=I[0].colIndex)))return void n._showAlertDlg("Alert","ArrayaFormula",430);if(!this._isEdit){for(n.element.find(".e-cdata").length&&n.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),N=n.model.sheets[s].tableManager,P=n.getObjectKeys(N),C=0,S=n.getObjectLength(N);C<S;C++)if(A=N[P[C]].range,n.XLClipboard._compareRange([I[0].rowIndex,I[0].colIndex,I[I.length-1].rowIndex,I[I.length-1].colIndex],A))return v=n._getAlphaRange(s,A[0],A[1],A[2],A[3]),void n.clearAll(v);for(n._hasClass(a,"e-readonly")||(n._isTrigCellSave=!0,n.clearRangeData(null,["value","value2","hyperlink","hasFormulaArray","hasMultipleFormulaArray"]),n._isTrigCellSave=!1),g=I[0].rowIndex,_=0,b=I.length;_<b;_++)if(p=I[_].rowIndex,m=I[_].colIndex,n._textClip(p,m,"delete"),!this.getPropertyValue(p,m,"isReadOnly")){if(n.model.allowFormulaBar&&n._getInputBox().val(""),w=this.getPropertyValue(p,m,"cFormatRule"),n.model.allowConditionalFormats&&w&&w.length)for(f=0,S=w.length;f<S;f++)x=w[f].split("_"),n.XLCFormat._cFormat(x[0],x[2],x[3],x[4],x[5],x[6]);g!==p&&(n._setRowHdrHeight(s,p),g++)}n.XLSelection._refreshBorder()}y={sheetIndex:s,range:[I[0].rowIndex,I[0].colIndex,I[I.length-1].rowIndex,I[I.length-1].colIndex],bData:r,reqType:"clear-content"},n._completeAction(y),n._trigActionComplete(y)}else i.ctrlKey||i.shiftKey||8!==i.keyCode?(13!==i.keyCode||i.altKey)&&9!==i.keyCode||!this._isEdit||!n.model.allowKeyboardNavigation||n.XLCellNav._isNavigate||this._isFormulaEdit?13===i.keyCode&&i.altKey&&this._isEdit&&(i.preventDefault(),(k=n.element.find("#"+n._id+"_Edit")).focus(),k.altEnter()):(i.preventDefault(),t.isNullOrUndefined(n.XLCellNav)||(n.XLCellNav._isNavigate=!0)):(s=n.getActiveSheetIndex(),o=n.getSheet(s),a=n.getCell(o._activeCell.rowIndex,o._activeCell.colIndex),this._isEdit||n._hasClass(a,"e-readonly")||n._hasClass(a,"e-cellreadonly")||(n.element.find(".e-cdata").length&&n.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),a=n.getCell(o._activeCell.rowIndex,o._activeCell.colIndex),R=n.XLEdit.getPropertyValue(o._activeCell.rowIndex,o._activeCell.colIndex,"mergeIdx"),n._intrnlReq=!0,this.editCell(R?R.rowIndex:o._activeCell.rowIndex,R?R.colIndex:o._activeCell.colIndex,!1),n._intrnlReq=!1,n._setRowHdrHeight(s,o._activeCell.rowIndex),n.model.allowFormulaBar&&n._getInputBox().val("")));else s=n.getActiveSheetIndex(),o=n.getSheet(s),a=n.getCell(o._activeCell.rowIndex,o._activeCell.colIndex),this._isFEdit=!0,this._isEdit||n._hasClass(a,"e-readonly")||n._hasClass(a,"e-cellreadonly")||(n.element.find(".e-cdata").length&&n.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),n.model.allowKeyboardNavigation&&n.XLCellNav._navToCell(o._activeCell.rowIndex,o._activeCell.colIndex),R=n.XLEdit.getPropertyValue(o._activeCell.rowIndex,o._activeCell.colIndex,"mergeIdx"),n._intrnlReq=!0,this.editCell(R?R.rowIndex:o._activeCell.rowIndex,R?R.colIndex:o._activeCell.colIndex,!0),n._intrnlReq=!1),this._cursorPosn++;else s=n.getActiveSheetIndex(),o=n.getSheet(s),a=n.getCell(o._activeCell.rowIndex,o._activeCell.colIndex),this._isEdit||n._hasClass(a,"e-readonly")||n._hasClass(a,"e-cellreadonly")||(n.element.find(".e-cdata").length&&n.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"),n.model.allowKeyboardNavigation&&n.XLCellNav._navToCell(o._activeCell.rowIndex,o._activeCell.colIndex),R=n.XLEdit.getPropertyValue(o._activeCell.rowIndex,o._activeCell.colIndex,"mergeIdx"),n._intrnlReq=!0,this.editCell(R?R.rowIndex:o._activeCell.rowIndex,R?R.colIndex:o._activeCell.colIndex,!1),n._intrnlReq=!1),this._cursorPosn++}},_focusElements:function(t){e(t).not(":hidden").focus().setInputPos(e(t).text().length)},_updateUsedRange:function(e,t,i){var r=this.XLObj,l=r.getSheet(i||r.getActiveSheetIndex()).usedRange;l.rowIndex<e&&(l.rowIndex=e),l.colIndex<t&&(l.colIndex=t)},_updateDataContainer:function(i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j,M,V,B=!1,H=r.dataObj,X=this.XLObj,U=X._getSheetIndex(r.sheetIdx),z=X.getSheet(U);if(!r.skipCell&&X._isRowViewable(U,i.rowIndex)&&(a=(o=X.getCell(i.rowIndex,i.colIndex,U))[0]),H){for(l in u=t.Spreadsheet.CellType,g=t.Spreadsheet.Align,y=X._dataContainer,C=i.colIndex,S=i.rowIndex,f=X._cellProp,S in(T=y.sheets[U])?C in(L=T[S])?p=L[C]:L[C]=p={}:(L=T[S]={})[C]=p={},a&&this.getPropertyValue(i.rowIndex,i.colIndex,"merge",U)&&((d=o.find("#"+X._id+"_Merge")[0])&&((E=d.lastChild)?1===E.nodeType?(X._hasClass(E,"e-hyperlinks")&&(E.textContent=""),X._hasClass(E,"e-comment")&&(E.lastChild.textContent="")):E.textContent="":d.textContent="",h=d.innerHTML,e(d).remove())),H)switch("string"==typeof(_=H[l])&&0===e.trim(_).length&&(_=""),l){case f[0]:case f[4]:case f[5]:case f[11]:-1===(m=y.sharedData.indexOf(_))&&(m=y.sharedData.push(_),m--),p[l]=m,z._isLoaded&&l===f[0]&&!X._intrnlUpdate&&(B=!0);break;case f[1]:if(F=this.getPropertyValue(S,C,"value2",U),H.type&&H.type!=u.General&&H.type!=u.Text?p[l]=H.value2:(-1===(m=y.sharedData.indexOf(H.value2))&&(m=y.sharedData.push(H.value2),m--),p[l]=m),a&&!("cellType"in H))if(a.getElementsByTagName("a").length)this._refreshTextNode(a,H.value2);else if(p[f[24]]>-1){if(I=(w=y.sheetCellType[p[f[24]]]).id,0===e("#"+I).length)return;if(H.value2)switch(w.type){case"Button":e("#"+I).ejButton("instance").option("text",H.value2)}}else H.value2&&(x=H.value2.toString().length>7&&!isNaN(new Date(H.value2).valueOf()),v=["true","yes","false","no"].indexOf(H.value2.toString().toLowerCase())>-1),X.model.allowCellType&&X.model.allowAutoCellType&&(x||v)?x?(X.XLCellType._rangeCellTypes([{settings:{type:"DatePicker"},range:X._getAlphaRange(U,S,C,S,C)}],U,!0),e("#"+X._dataContainer.sheetCellType[p[f[24]]].id).ejDatePicker("instance").option("value",H.value2)):v&&(X.XLCellType._rangeCellTypes([{settings:{type:"CheckBox"},range:X._getAlphaRange(U,S,C,S,C)}],U,!0),e("#"+X._dataContainer.sheetCellType[p[f[24]]].id).ejCheckBox("instance").option("checked",["true","yes"].indexOf(H.value2.toString().toLowerCase())>-1)):this._skipHTML?a.innerHTML.concat(H.value2):this._refreshTextNode(a,H.value2);this._refreshCellAlignment({cellIdx:i,value:H.value,type:H.type,sheetIdx:U}),X._isSort||(X.model.allowOverflow&&X._canOverflow?(F||H.value2)&&(D=!!t.isNullOrUndefined(F)||F.length<=H.value2.length,X._textClip(S,C,D?"add":"delete"),!D&&H.value2.length>0&&X._textClip(S,C,"add")):X._canOverflow&&X.refreshOverflow([S,C,S,C],U)),p.isDirty=!0;break;case f[2]:p[l]=y.cellType.indexOf(H.type);break;case f[3]:for(n=0,s=_.length;n<s;)-1===(m=y.cFormatData.indexOf(_[n]))&&(m=y.cFormatData.push(_[n]),m--),p[l]?-1===p[l].indexOf(m)&&p[l].push(m):p[l]=[m],n++;break;case f[6]:-1===(m=y.valData.indexOf(_.customVal))&&(m=y.valData.push(_.customVal),m--),p[l]=JSON.parse(JSON.stringify(_)),p[l].customVal=m;break;case f[7]:case f[8]:a&&(R=l===f[8]?"e-border":"e-format",O=new RegExp("\\b"+R+".*?\\b","g"),a.className=a.className.replace(O,""),X.addClass(a,_)),-1===(m=y.hashCode.indexOf(_))&&(m=y.hashCode.push(_),m--),p[l]=m;break;case f[9]:case f[10]:case f[26]:case f[27]:p[l]?-1===p[l].indexOf(_)&&p[l].push(_):p[l]=[_];break;case f[12]:p[l]=_,a&&(_===g.Center?X.addClass(a,X._cAlign):_===g.Right?X.addClass(a,X._rAlign):e(a).removeClass(X._rAlign+" "+X._cAlign));break;case f[14]:case f[16]:N=X.XLFormat.getFormatHashCode(_),-1===(m=y.hashCode.indexOf(N))&&(X.XLFormat._createFormatClass(_,N),m=y.hashCode.push(N),m--),p[l]=m;break;case f[15]:case f[17]:_=X.XLFormat._getBorderHashCode(_,!0),-1===(m=y.hashCode.indexOf(_))&&(m=y.hashCode.push(_),m--),p[l]=m;break;default:p[l]=_}if(this._updateUsedRange(i.rowIndex,i.colIndex,U),B&&(X.model.allowCharts&&X.XLChart._refreshChartElements(S,C,U),X.model.allowSparkline&&X.XLSparkline.refreshSparkline(S,C,U),X.model.allowConditionalFormats&&X.XLCFormat._refreshCFormatFormula(S,C,U),X._updateBatchDetails(S,C,U),B=!1),a&&this.getPropertyValue(i.rowIndex,i.colIndex,"merge",U)&&(M=this.getPropertyValue(i.rowIndex,i.colIndex,"merge",U),V=z._rowHeightCollection[i.rowIndex+M.mSpan.rowSpan]-z._rowHeightCollection[i.rowIndex]||Math.floor(o.height()),X._isRowViewable(U,i.rowIndex)&&(c=(c=this.getPropertyValue(i.rowIndex,i.colIndex,"value2",U))||"",(d=o.find("#"+X._id+"_Merge")[0])||this._refreshTextNode(a),h=h?h.concat(H.value2||c):H.value2||c,d||(k=this.getPropertyValue(i.rowIndex,i.colIndex,"sparkline",U),!X._isCopyPaste&&X.model.allowSparkline&&k?(k=k[0],j=X.getSheet(U).shapeMngr.sparkline[k],o.find(".e-ss-sparkline").length?(e("#"+k).ejSparkline("destroy"),X.XLSparkline._wireSparklineEvents("_off"),a.innerHTML="<div id ="+X._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(V-1)+"px'>"+a.innerHTML.concat(t.isNullOrUndefined(h)?"":h)+"</div>",e("#"+k).ejSparkline(j),X.XLSparkline._wireSparklineEvents("_on")):(a.innerHTML="<div id ="+X._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(V-1)+"px'>"+a.innerHTML.concat(t.isNullOrUndefined(h)?"":h)+"</div>",e(a).find('svg[id *= "sparkline_svg"]').length?(e(a).find('svg[id *= "sparkline_svg"]').remove(),e("#"+k).ejSparkline(j),X.XLSparkline._wireSparklineEvents("_on")):(P=X._getCellInfo(i,U),X.XLSparkline._createSparkline(j,P,U)))):(a.innerHTML="<div id ="+X._id+"_Merge style = 'border :0px;overflow: hidden;max-height:"+(V-1)+"px'>"+a.innerHTML.concat(t.isNullOrUndefined(h)?"":h)+"</div>",X._hasClass(a,"e-rightalign")&&(X._removeClass(a,"e-rightalign"),o.find("#"+this.XLObj._id+"_Merge")[0].classList.add("e-rightalign"))),d=o.find("#"+X._id+"_Merge")[0]),(A=d.children).length)))for(l=0;l<A.length;l++)X._hasClass(d.children[l],"e-comment")&&(d.children[l].lastChild.textContent=this.getPropertyValue(i.rowIndex,i.colIndex,"comment",U).value),X._hasClass(d.children[l],"e-hyperlinks")&&(d.lastChild.textContent="",d.children[l].textContent=this.getPropertyValue(i.rowIndex,i.colIndex,"value2",U));3===(Object.keys?Object.keys(p).length:X.getObjectLength(p))&&(""===(b=X.getRangeData({range:[S,C,S,C],property:f.slice(0,3)})[0]).value&&""===b.value2&&b.type===t.Spreadsheet.CellType.General&&X.clearRangeData([S,C,S,C],f.slice(0,3))),!z._isLoaded||X.isDirty||X._intrnlReq||X.isImport||X.model.isImport||(X.isDirty=!0)}else a&&this._refreshTextNode(a)},_clearDataContainer:function(i){var r,l,n,s,o,a,d,h,c,u,g,p=!1,m=this.XLObj,_=m._getSheetIndex(i.sheetIdx),f=m._cellProp,b=i.cellIdx.rowIndex,C=i.cellIdx.colIndex,S=i.property||[],x=!1,v=m._dataContainer.sheets[_];if(S.length&&b in v&&C in v[b]){for(d=v[b][C],r=S.length,!i.skipCell&&m._isRowViewable(_,b)&&(l=m.getCell(b,C,_));r--;){switch(u=null,c=!1,s=S[r]){case f[0]:u=this.getPropertyValue(b,C,s,_),c=!0;break;case f[1]:a=this.getPropertyValue(b,C,"value2"),l&&(this._refreshTextNode(l[0]),(o=l.find("#"+m._id+"_Merge")).length&&(o[0].innerHTML="")),a&&(p=!0);break;case f[3]:(u=this.getPropertyValue(b,C,s,_))&&l&&l.length>0&&(e(l).removeClass("e-redft e-yellowft e-greenft e-redf e-redt"),l[0].style.color="",l[0].style.backgroundColor="",l.removeClass("e-cformat"));break;case f[7]:case f[8]:(u=this.getPropertyValue(b,C,s,_))&&l&&m._removeClass(l[0],u);break;case f[14]:(u=this.getPropertyValue(b,C,s,_))&&u["text-align"]&&"right"===u["text-align"]&&l&&m._removeClass(l[0],"e-rightalign");break;case f[12]:(u=d[s])&&l&&m._removeClass(l[0],u===t.Spreadsheet.Align.Center?m._cAlign:m._rAlign);break;case f[13]:if((u=d[s])&&l){if(h=l[0].lastChild.textContent,"clear-content"===i.status){l[0].lastChild.textContent="";break}if("clear-format"===i.status){n=l.find("a"),m._hasClass(n[0],"e-hyperlinks")&&n.css({color:"#444445","text-decoration":"none"}).removeClass("e-hyperlinks");break}l.find("a").remove(),t.isNullOrUndefined(l[0].lastChild)?l[0].textContent=h:l[0].lastChild.textContent=h}break;case f[18]:(u=d[s])&&l&&(l.removeClass("e-filterhdr"),l.find(".e-filterspan").remove());break;case f[21]:m.XLComment&&m.XLComment.deleteComment([b,C,b,C]);break;case f[5]:case f[22]:case f[23]:x||(u=this.getPropertyValue(b,C),m.isUndefined(u)&&(u=""),(g={decimalPlaces:0,thousandSeparator:!1,formatStr:"",type:"general",value:u}).value2=m.XLFormat._getFormattedValue(b,C,g,u),m.XLEdit._updateDataContainer({rowIndex:b,colIndex:C},{dataObj:g}),x=!0);break;case f[25]:delete v[b][C][s]}"clear-content"===i.status&&"hyperlink"===s?this.getPropertyValue(b,C,s,_)&&(delete v[b][C][s].webAddr,delete v[b][C][s].cellAddr):delete v[b][C][s],c&&(this._refreshCalcEngine(b,C,!1,u),m._updateBatchDetails(b,C,_),m.model.allowCharts&&m.XLChart._refreshChartElements(b,C,_),m.model.allowSparkline&&m.XLSparkline.refreshSparkline(b,C,_))}p&&m._textClip(b,C,"delete"),m._overFlowRowIdx||m.getObjectLength(v[b])||delete v[b],v[b]&&!m.getObjectLength(v[b][C])&&delete v[b][C]}},getPropertyValue:function(i,r,l,n){var s,o,a,d,h,c,u,g=this.XLObj,p=g._dataContainer,m=p.sheets,_=g._cellProp;if(n=g._getSheetIndex(n),g._intrnlUpdate||this._refreshContainer(i,n),m[n]&&m[n][i]&&m[n][i][r]){if(o=m[n][i][r])switch(a=o[l=l||"value"],l){case"value":case"range":case"thousandSeparator":case"calcValue":s=p.sharedData[a];break;case"format":case"border":s=p.hashCode[a];break;case"value2":c=t.Spreadsheet.CellType,s=g.isUndefined(o.type)||-1!==[c.General,c.Text].indexOf(p.cellType[o.type])?p.sharedData[o.value2]:o.value2;break;case"type":s=p.cellType[o.type];break;case"cFormatRule":for(d=h=0,s=[],g.isUndefined(a)||(h=a.length);d<h;)o[l][d]in p.cFormatData&&s.push(p.cFormatData[o[l][d]]),d++;break;case"rule":g.isUndefined(a)||(s={},e.extend(!0,s,a),s.customVal=p.valData[s.customVal]);break;case _[14]:case _[15]:case _[16]:case _[17]:g.isUndefined(a)||(s=-1===(s=p.hashCode[a]).indexOf("e-format")?g.XLFormat.getBorderFromHashCode(s,!0):g.XLFormat.getFormatFromHashCode(s));break;case"cTypeDetail":(u=g._dataContainer.sheetCellType[o.cellType])&&"DropDownList"==u.type&&u.selectedIndex>-1&&u.dataSource&&(u.text=u.dataSource[u.selectedIndex].text,u.value=u.dataSource[u.selectedIndex].value),s=u;break;case"isLocked":s=a,g._isDefaultLocked&&(s=!s);break;default:s=a}}else g._isDefaultLocked&&"isLocked"===l&&(s=!s);return s},_refreshContainer:function(e,t){var i,r=this.XLObj,l=r.getSheet(t);!l._isImported&&l._hasDataSrc&&(r._intrnlUpdate=!0,r.model.scrollSettings.allowVirtualScrolling?(i=r._getBlockInfo(e,t,!0),-1===l._virtualDataMngrLoadedBlks.indexOf(i.orgIdx)&&(l._virtualDataMngrLoadedBlks.push(i.orgIdx),this._ensureDataMngr(i.orgRange,t)),-1===l._virtualDataLoadedBlks.indexOf(i.orgIdx)&&(l._virtualDataLoadedBlks.push(i.orgIdx),r._canOverflow=!1,r._refreshDataSrc(i.orgRange,t),r._refreshCellData(i.orgRange,t),r._canOverflow=!0,r._refreshOverflow(i.orgRange))):l._isLoaded||l._isDataMoved||(l._isDataMoved=!0,r._canOverflow=!1,r._refreshDataSrc(null,t),r._refreshCellData(null,t),r._canOverflow=!0,r._refreshOverflow()),r._intrnlUpdate=!1)},_ensureDataMngr:function(e,i){var r,l,n,s,o,a,d,h=0,c=this.XLObj,u=c.getDataSettings(i);if(u)for(a=u.length;h<a;)o=u[h],c._inRow(o.range,e[0])&&o._dataManager&&(s=this._getQueryPropWithValues(e.slice(0),o.range),d=t.pvt.filterQueries(o.query.queries,"onSkip"),n=s.skip||0,o._skip&&(n+=o._skip),n&&(d.length?d[0].e.nos=n:o.query.skip(n)),d=t.pvt.filterQueries(o.query.queries,"onTake"),s.take&&(d.length?d[0].e.nos=s.take:o.query.take(s.take)),o._dataManager.dataSource.async=!1,o._dataManager.executeQuery(o.query).done(function(e){if(r=e.result.length)for(l=0;l<r;)o._jsonData[s.skip+l]=e.result[l],l++}),o._dataManager.dataSource.async=!0),h++},_getQueryPropWithValues:function(e,t){var i,r={},l=this.XLObj;return i=e[0]-t[0],r.skip=i,t[2]<e[2]&&(e[2]=t[2]),l._inRow(t,e[2])&&(i=e[2]-e[0]+1,r.take=i),r},getPropertyValueByElem:function(e,i,r){var l;if(!t.isNullOrUndefined(e[0]))return l=e.hasClass("e-hyperlinks")?this.XLObj._getCellIdx(e.parent()[0]):this.XLObj._getCellIdx(e[0]),this.getPropertyValue(l.rowIndex,l.colIndex,i,r)},_getPropWithCellIdx:function(e,t,i,r){var l=this.XLObj;i=l._getSheetIndex(i);for(var n,s,o=[],a=e[0],d=e[2],h=e[3],c=l._dataContainer.sheets[i];a<=d;){if(c[a])for(s=e[1];s<=h;)c[a][s]&&(n=this.getPropertyValue(a,s,t,i),l.isUndefined(n)||(r?l.isFormula(n)&&o.push({rowIdx:a,colIdx:s,value:n}):o.push({rowIdx:a,colIdx:s,value:n}))),s++;a++}return o},_refreshCalcEngine:function(e,i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f=this.XLObj;if(n=f._getSheetIndex(n),d=f.getSheet(n),h=f._calcEngine,r)l=this._parseSheetRef(l),s=new ValueChangedArgs(e+1,i+1,l),h.valueChanged(d.sheetInfo.value,s,!!f._computeFormula||(!f._impData||d._isLoaded)),f._applyFormula(n,e,i);else if(o=CalcEngine.getSheetFamilyItem(d.sheetInfo.value),a=RangeInfo.getAlphaLabel(i+1)+(e+1),h.isSheetMember()&&!t.isNullOrUndefined(o.parentObjectToToken)&&(a=o.parentObjectToToken.getItem(d.sheetInfo.value)+a),h.getFormulaInfoTable().containsKey(a)&&(h.getFormulaInfoTable().remove(a),h.getDependentCells().contains(a)&&h.clearFormulaDependentCells(a)),h.getComputedValue().clear(),h.refresh(a),h.getComputedValue().clear(),(c=h.getDependentCells().keys().indexOf(a))>-1)for(m=0,_=(p=h.getDependentCells().values()[c]).length;m<_;m++)u=p[m].split("!"),g=f.getRangeIndices(u[2]),f.model.allowCharts&&f.XLChart._refreshChartElements(g[0],g[1],parseInt(u[1])+1)},_parseSheetRef:function(e,t){for(var i,r=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),l=0,n=this.XLObj,s=n.model.sheetCount,o=[],a=[],d=n._getSheetNames(),h='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',c=/'[^'"]*'(?=(?:[^"]*"[^"]*")*[^"]*$)/g;l<d.length;)a.push(d[l].text),l++;for(l=0;l<s;l++)d[l].value!==d[l].text&&(i=new RegExp(d[l].text.replace(r,"\\$&")+h,"gi"),e.match(c)&&(this._singleQuote=!0),e.match(i)&&(e=e.replace(i,l+"/"),o.push(l)),a.indexOf(d[l].value)<0&&e.indexOf(d[l].value)>-1&&!t&&(i=new RegExp(d[l].value+h,"gi"),e.match(i)&&(e=e.replace(i,n._newSIndex+"/"),o.push(n._newSIndex))));for(l=0;l<o.length;){if(i=new RegExp(o[l]+"/"+h,"gi"),this._sheetNameSpclchar){if(!isNaN(d[o[l]].text)||!/^[a-zA-Z0-9- ]*$/.test(d[o[l]].text)||d[l].text.match("\\s+"))return e.replace(i,o[l]===n._newSIndex?n._generateSheetName(n._newSIndex):this._singleQuote?d[o[l]].text:"'"+d[o[l]].text+"'")}else e=e.replace(i,o[l]===n._newSIndex?n._generateSheetName(n._newSIndex):d[o[l]].value);l++,this._singleQuote=!1}return e},_refreshTextNode:function(e,i){var r,l=this.XLObj;i=t.isNullOrUndefined(i)?"":i,l.isUndefined(e)||((r=e.lastChild)&&(3===r.nodeType||1===r.nodeType&&"A"===r.tagName)?"msie"===l._browserDetails.name&&"8.0"===l._browserDetails.version?r.nodeValue=i:r.textContent=i:e.appendChild(document.createTextNode(i)))},_formulaSelect:function(e){var t,i=t=e.text,r=this.XLEdit._editElem.text().slice(1);i.indexOf("(worksheet)")>-1&&(t=t.split(" (worksheet)")[0]),r.endsWith("[")&&this._tableRangesFormula[r.split("[")[0]]?(i=t="="+r+e.text.slice(1),this.XLEdit._processFormulaEditRange(i)):this.XLEdit._isNamedRange(t)||"TRUE"==i.slice(1)||"FALSE"==i.slice(1)||(i+="("),this.XLEdit._editElem.text(i),this.model.allowFormulaBar&&this._getInputBox().val(i),this.XLEdit._editElem.focusEnd(),this._isFormulaSuggestion=!1,this.XLCellNav._canKeyBoardNavigate=!1},_isNamedRange:function(e){var t=this.XLObj.model.nameManager,i=t.length;if(e=e.slice(1),i)for(;i--;)if(t[i].name.toUpperCase()===e.toUpperCase())return!0;return!1},_getTableRange:function(e){var t=this.XLObj;return e.startsWith("=")&&(e=e.slice(1)),(e=e.split(/[\[\]]+/)).length>=2&&e[1].length?t._tableRangesFormula[e[0]][e[1]]:t._tableRangesFormula[e[0]]["#Data"]},_formulaBoxInputChange:function(e){var t,i=this.getActiveSheetIndex(),r=this.getSheet(i)._activeCell,l=this.element.find("#"+this._id+"_Edit");this.XLEdit._isFormulaEdit=!e.target.value.indexOf("="),this.XLEdit._isFormulaEdit&&this.XLEdit._processFormulaEditRange(e.target.value,!0),this.XLEdit._isEdit||(this.model.allowKeyboardNavigation&&this.XLCellNav._navToCell(r.rowIndex,r.colIndex),t=this.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"mergeIdx"),this._intrnlReq=!0,this.XLEdit.editCell(t?t.rowIndex:r.rowIndex,t?t.colIndex:r.colIndex,!0),this._intrnlReq=!1,l=this.element.find("#"+this._id+"_Edit")),l.text(e.target.value),e.target.focus(),this.XLEdit._isCellEdit=!1},_formulaSuggestionStatus:function(e){this._isFormulaSuggestion="open"===e.type},_updateFormulaCellRange:function(e,t){var i,r,l,n=this.XLObj,s=n.element.find("#"+n._id+"_Edit").not(":hidden");!s.length&&this._isFormulaEdit&&(s=n.element.find("#"+n._id+"_Edit"),e=n.getSheet().sheetInfo.text+"!"+e),l=(r=s.text())[r.length-1],t&&-1===this._validCharacters.indexOf(l)?r+=",":(i=this._getCharPosition(r))>-1&&(r=r.substr(0,[i+1])),e=this._isSplChar?r+e.split("!")[1]:r+e,this._isSplChar=!1,s.text(e),this._editElem.focusEnd(),n.model.allowFormulaBar&&n._getInputBox().val(e)},_getCharPosition:function(e){var t=e.length;for(this.XLObj.getSheet().sheetInfo;t--;){if("!"==e[t])return this._isSplChar=!0,t;if(this._validCharacters.indexOf(e[t])>-1)return t}return-1},_processFormulaEditRange:function(t,i){var r,l,n,s,o,a=0,d=this.XLObj,h=d.XLDragFill._parseFormula(t),c=h.length;for(d._ctrlKeyCount=0,d._formulaRange=[],d.XLSelection._clearBorder(d._arrayAsString(d._ctrlFormulaBorder.concat(d._formulaBorder)));a<c&&(r=h[a],!(this._invalidOperators.indexOf(r)>-1));)d._isCellReference(r)?(r=r.replace(/\$/g,""),":"===h[a+1]&&(a++,d._isCellReference(h[a+1])&&(r=r+":"+h[a+1],a++)),this._updateFormulaEditRange(r,d._ctrlKeyCount),d._ctrlKeyCount++):d._tableRangesFormula[r.split(/[\[\]]+/)[0]]&&((n=this._getTableRange(r))&&(s=n.split("!"),o=d._getSheetIndexByName(s[0]),n=s[1].split("$").join(""),o===d.getActiveSheetIndex()&&this._updateFormulaEditRange(n,d._ctrlKeyCount))),a++;"("===(l=t.charAt(t.length-1))&&2===t.split("(").length?(d._isFormulaSuggestion=!1,d.model.allowFormulaBar&&d._getInputBox().val(t),i?e("#"+d._id+"_inputbox_suggestion").hide():d._getFormulaSuggElem().hide()):")"===l&&d.isFormula(t)&&(d.XLEdit._isFormulaEdit=!1,d._formulaRange=[],d._ctrlKeyCount=0),":"===l?(d._shiftKeyEnabled=!0,d._ctrlKeyCount--):this._validOperators.indexOf(l)>-1&&(d._dStartCell=d.getSheet(d.getActiveSheetIndex())._activeCell,d._shiftKeyEnabled=!1)},_updateFormulaEditRange:function(e,t){var i=this.XLObj,r=i.getRangeIndices(e);i._formulaRange[t]=e,i._dStartCell={rowIndex:r[0],colIndex:r[1]},i._dEndCell={rowIndex:r[2],colIndex:r[3]},i.XLSelection._focusBorder(i._dStartCell,i._dEndCell,i._formulaBorder[t%6])},calcOption:function(e){var t,i,r,l,n,s,o=this.XLObj;if(!o.model.isReadOnly&&(r={sheetIndex:i=o.getActiveSheetIndex(),reqType:"calc-option",type:"actionBegin",action:"calcoption"},!o._trigActionBegin(r))){for(s=1,t=o._sheets.length;s<t;s++)l=o._calcEngine,e?(l.setCalculatingSuspended(!1),n=o.getSheet(s).usedRange,o.setActiveSheetIndex(s),l.grid=o.model.sheets[s].sheetInfo.value,l.refreshRange(RangeInfo.cells(1,1,n.rowIndex+1,n.colIndex+1))):l.setCalculatingSuspended(!0);o.setActiveSheetIndex(i)}},calcNow:function(e){var t=this.XLObj;if(!t.model.isReadOnly){var i,r,l,n=t.getActiveSheetIndex(),s={sheetIndex:n,reqType:"calc-now",type:"actionBegin",action:"calcnow"},o=1,a=t._sheets.length;if(!t._trigActionBegin(s)){for(e&&(o=e,a=e+1);o<a;)(i=t._calcEngine).setCalculatingSuspended(!1),r=t.getSheet(o).usedRange,t.setActiveSheetIndex(o),i.grid=t.model.sheets[o].sheetInfo.value,i.refreshRange(RangeInfo.cells(1,1,r.rowIndex+1,r.colIndex+1)),i.setCalculatingSuspended(!0),o++;t.setActiveSheetIndex(n),l={sheetIndex:n,reqType:"calc-now"},t._completeAction(l),t._trigActionComplete(l)}}},_rangeHasProperty:function(e,t,i){e&&(i=this.XLObj.getRangeData({range:e,property:[t]}));for(var r=0,l=i.length;r<l;){if(!this.XLObj.isUndefined(i[r][t]))return!0;r++}},saveEditingValue:function(){var e,t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_=this.XLObj;if(!_.model.isReadOnly){for(h={},p=_._dataContainer,l=Object.getOwnPropertyNames(p.sheets),h.EditedData=[],i=0,o=l.length;i<o;i++)for(r=p.sheets[l[i]],e=0,u=(d=Object.getOwnPropertyNames(r)).length;e<u;e++)for(n=parseInt(d[e]),t=0,g=(c=Object.getOwnPropertyNames(r[n])).length;t<g;t++)s=parseInt(c[t]),r[n][s].isDirty&&(a={SheetIndex:m=parseInt(l[i]),Value:this.getPropertyValue(n,s,"value2",m),CellIndex:{RowIndex:n,ColIndex:s}},delete r[n][s].isDirty,h.EditedData.push(a));return h}}},e.fn.focusEnd=function(){var t;e(this).focus();var i=e("<span />").appendTo(e(this)),r=i.get(0),l=null,n=null;return document.selection?((l=document.body.createTextRange()).moveToElementText(r),l.select()):window.getSelection&&(t=this[0],l=document.createRange(),n=window.getSelection(),l.setStart(t,1),l.collapse(!0),n.removeAllRanges(),n.addRange(l),t.focus()),i.remove(),this},e.fn.altEnter=function(){var t,i,r,l,n,s,o;r=3===(i=(t=window.getSelection()).anchorNode).nodeType?t.anchorOffset:i.textContent.length,n=(l=i.textContent).slice(0,r),s=l.slice(r)||" ",i.textContent=n+"\n"+s,o=document.createRange(),3===i.nodeType?(o.setStart(i,r+1),o.setEnd(i,r+1)):1===i.nodeType?(o.setStart(i.firstChild,r+1),o.setEnd(i.firstChild,r+1)):e(i).setInputPos(r+1),t.removeAllRanges(),t.addRange(o)},e.fn.setCursorPosition=function(e){var t,i,r;this.focus(),t=this[0].firstChild,i=document.createRange(),t&&(i.setStart(t,e),i.setEnd(t,e)),(r=window.getSelection()).removeAllRanges(),r.addRange(i)}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.validation=function(e){this.XLObj=e,this._ruleSymbols={Greater:">",GreaterOrEqual:">=",Less:"<",LessOrEqual:"<=",Equal:"==",NotEqual:"!=",Between:">=&&<=&&=",NotBetween:">=&&<=&&!"},this._isErrorVisible=!1},t.spreadsheetFeatures.validation.prototype={_setValidation:function(){this.XLObj.model.allowDataValidation&&e.validator&&(this._initValidator(),this._setValidationToField())},_initValidator:function(){var i=e("#"+this.XLObj._id+"EditForm");t.isOnWebForms&&e.data(i[0],"validator",null),i.validate({errorClass:"e-field-validation-error",errorElement:"div",wrapper:"div",errorPlacement:function(i,r){var l=e("#"+e(r).data("id")).data("ejSpreadsheet"),n=l._getJSSheetContent(l.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content"),s=l.XLEdit._editCell,o=e(i).addClass("e-error");n.append(o),o.prepend(t.buildTag("div.e-errortail e-toparrow")),o.css({left:s[0].offsetLeft,top:s[0].offsetTop+s[0].offsetHeight}),l.XLValidate._isErrorVisible=!0}})},_setValidationToField:function(){var e,i=this.XLObj,r=i.XLEdit.getPropertyValueByElem(i.getActiveCellElem(),"rule");delete r.type,delete r.isApply,delete r.isHighlight,i.element.find("#"+i._id+"_ValElem").rules("add",r),e=i.element.find("#"+i._id+"EditForm").validate(),t.isNullOrUndefined(r.required)||(e.settings.messages[name]={},e.settings.messages[name].required=i.XLEdit._EditCellDetails.fieldName+(i.XLEdit._EditCellDetails.rowIndex+1)+" is required"),i.XLEdit._isValidation=!0},applyDVRules:function(e,i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f,b,C={},S=this.XLObj,x=S.getActiveSheetIndex(),v=S.getSheet(x),w=!1,I={range:e,values:i,numType:r,required:l,showErrorAlert:n,sheetIndex:x,reqType:"data-validation",type:"actionBegin",action:"applyvalidation"};if(!S._trigActionBegin(I)){switch(e=I.range,i=I.values,l=I.required,n=I.showErrorAlert,r=I.numType){case"decimal":if(parseFloat(i[1])>parseFloat(i[2]))return void S._showAlertDlg("Alert","NumberValidationAlert","",400);break;case"date":if(new Date(i[1])>new Date(i[2]))return void S._showAlertDlg("Alert","DateValidationAlert","",400);break;case"time":if(g=Date.parse("01/01/1990 "+i[1]),p=Date.parse("01/01/1990 "+i[2]),i[2]&&i[2].length&&g>p)return void S._showAlertDlg("Alert","TimeValidationAlert","",400);break;default:if(parseInt(i[1])>parseInt(i[2]))return void S._showAlertDlg("Alert","NumberValidationAlert","",400)}if(!S.model.isReadOnly&&S.model.allowDataValidation&&(S.model.allowSelection||!t.isNullOrUndefined(e))){switch(h=S._getRangeArgs(e,"object"),c=S._getSelectedCells(x,h).selCells,S._showDialog(S._id+"_Ribbon_Data_DataTools_DataValidation"),C.required=!l,("Between"!=i[0]||"NotBetween"!=i[0])&&i.length<3&&i.push(""),r){case"number":i.push("parseInt"),C.digits=!0,i.push("number");break;case"decimal":i.push("parseFloat"),C.number=!0,i.push("decimal");break;case"date":i.push("parseDate"),C.date=!0,i.push("date");break;case"time":i.push("parseTime"),i.push("time");break;case"text":i[1]="^"+i[1],i[2]="^"+i[2],i.push("length"),i.push("text");break;case"list":m=i[1],(i=[]).push(m),i.push("list")}for(i.push(n),i.push(e||S._getSelectedItems(x,e)[1]),i.push(x),C.customVal=i.join("_"),C.isApply=!1,C.type=r,_=[],f={},b=0,a=c.length;b<a;b++)f={rowIndex:c[b].rowIndex,colIndex:c[b].colIndex,prevRule:S.XLEdit.getPropertyValue(c[b].rowIndex,c[b].colIndex,"rule")},S._isRowViewable(x,c[b].rowIndex)&&((o=S.getCell(c[b].rowIndex,c[b].colIndex)).hasClass("e-hlcell")&&(w=!0),o.removeData("rule"),o.removeClass("e-hlcell")),S.XLEdit._updateDataContainer({rowIndex:c[b].rowIndex,colIndex:c[b].colIndex},{dataObj:{rule:C}}),null!==S.model.actionComplete&&(f.newRule=S.XLEdit.getPropertyValue(c[b].rowIndex,c[b].colIndex,"rule")),_.push(f);!0===w&&this.highlightInvalidData(),v._isImported&&!v._isLoaded||S._isUndoRedo||S._isExport||(u=""==i[2]?[i[0],i[1]]:[i[0],i[1],i[2]],d={showErrorAlert:(s={showErrorAlert:i[5],values:u,required:!C.required,rule:C,sheetIndex:x,reqType:"validation",operation:"apply-validation",selectedCell:_,range:S._getAlphaRange(x,c[0].rowIndex,c[0].colIndex,c[c.length-1].rowIndex,c[c.length-1].colIndex)}).showErrorAlert,values:s.values,isRequired:s.required,rule:s.rule,sheetIndex:s.sheetIndex,reqType:s.reqType,operation:s.operation,selectedCell:s.selectedCell,range:s.range},S._completeAction(s),S._trigActionComplete(d))}}},clearDV:function(e){var i,r,l,n,s,o,a,d=this.XLObj;if(d.model.allowDataValidation&&!d.model.isReadOnly&&d.model.allowSelection){for(s={sheetIndex:n=d.getActiveSheetIndex(),reqType:"validation",operation:"clear-validation",selectedCell:[]},l=d._getRangeArgs(e,"object"),o=0,a=(r=d._getSelectedCells(n,l).selCells).length;o<a;o++)s.selectedCell.push({rowIndex:r[o].rowIndex,colIndex:r[o].colIndex,rules:d.XLEdit.getPropertyValue(r[o].rowIndex,r[o].colIndex,"rule")}),d.clearRangeData([r[o].rowIndex,r[o].colIndex,r[o].rowIndex,r[o].colIndex],["rule"]),d._isRowViewable(n,r[o].rowIndex)&&(i=d.getCell(r[o].rowIndex,r[o].colIndex),t.isNullOrUndefined(d._ddlCell)||(d.element.find("#"+d._id+"ddl").ejDropDownList("hidePopup"),d.element.find("#"+d._id+"ddlspan").remove(),d._ddlCell=null),s.hlStatus=i.hasClass("e-hlcell"),i.removeClass("e-hlcell"));s.range=d._getAlphaRange(n,r[0].rowIndex,r[0].colIndex,r[r.length-1].rowIndex,r[r.length-1].colIndex),d._isUndoRedo||d._dupDetails||(d._completeAction(s),d._trigActionComplete(s))}},clearHighlightedValData:function(e){var i,r,l,n,s,o,a=this.XLObj;if(a.model.allowDataValidation&&!a.model.isReadOnly){for(l=a.getActiveSheetIndex(),r=a._getRangeArgs(e,"object"),n=0,s=(i=a._getSelectedCells(l,r).selCells).length;n<s;n++)a._isRowViewable(l,i[n].rowIndex)&&a.getCell(i[n].rowIndex,i[n].colIndex).removeClass("e-hlcell"),t.isNullOrUndefined(a.XLEdit.getPropertyValue(i[n].rowIndex,i[n].colIndex,"rule"))||(a._dataContainer.sheets[l][i[n].rowIndex][i[n].colIndex].rule.isApply=!1);a._isUndoRedo||(o={sheetIndex:l,reqType:"validation",operation:"cl-hl-data",range:t.isNullOrUndefined(e)?this.XLObj._getAlphaRange(1,i[0].rowIndex,i[0].colIndex,i[i.length-1].rowIndex,i[i.length-1].colIndex):e},a._completeAction(o),a._trigActionComplete(o))}},_checkValidation:function(e,i,r,l){var n,s,o,a,d,h,c,u,g,p,m=this.XLObj,_=m.model.locale,f=e;if(l=m._getSheetIndex(l),!JSON.parse(i[i.length-3])&&!r)return!0;if("time"===i[4]&&(d=t.preferredCulture(_).calendar.patterns,(e=m.formatting("{0:"+d.T+"}",t.parseDate(e,d.dT),_)).length||(e=f)),e=this._convertValueByType(e,i[4]),i[1]=this._convertValueByType(i[1],i[4]),i[2]=this._convertValueByType(i[2],i[4]),e.length){if("list"===i[i.length-4]){for(c=!1,i[0].indexOf(",")>-1?s=i[0].split(","):i[0].indexOf("=")>-1?(o=i[0].split("=")[1],(a=m.getCalcEngine().getNamedRanges().getItem(o.toUpperCase()))&&(o=a),o.indexOf("!")>-1?(l=a?m._getSheetIdxFromSheetValue(o.split("!")[0]):m._getSheetIndexByName(o.split("!")[0]),s=o.split("!")[1].indexOf("$")>-1?m.getRangeData({sheetIdx:l,range:m.getRangeIndices(o.split("!")[1].split("$").join("")),valueOnly:!0}):o.indexOf("$")>-1?m.getRangeData({sheetIdx:l,range:m.getRangeIndices(o.split("$").join("")),valueOnly:!0}):m.getRangeData({sheetIdx:l,range:m.getRangeIndices(o.split("!")[1]),valueOnly:!0})):s=m.getRangeData({sheetIdx:l,range:m.getRangeIndices(o),valueOnly:!0})):s=e,h=0,n=s.length;h<n&&!(c=s[h].toString()===e);h++);return t.Spreadsheet.msg=m._getLocStr("ListAlertMsg"),c}return i[0]=this._ruleSymbols[i[0]],i[1].indexOf("=")>-1&&(u=i[1].replace("=",""),g=this.getRangeIndices(u+":"+u),i[1]=m.XLEdit.getPropertyValue(g[0],g[1],null,l).toString()),i[2].indexOf("=")>-1&&(u=i[2].replace("=",""),g=this.getRangeIndices(u+":"+u),i[2]=m.XLEdit.getPropertyValue(g[0],g[1],null,l).toString()),i[0].length<=2?(t.Spreadsheet.msg="The "+i[4]+" should be "+t.Spreadsheet.ValidationText[i[0]]+" "+i[1].replace("^",""),m.operators[i[0]](m.parse[i[3]](e),m.parse[i[3]](i[1]))):(p=[],p=i[0].split("&&"),t.Spreadsheet.msg="The "+i[4]+" should"+t.Spreadsheet.ValidationText[p[2]]+" be between "+i[1].replace("^","")+" and "+i[2].replace("^",""),m.operators[p[2]](m.operators[p[0]](m.parse[i[3]](e),m.parse[i[3]](i[1]))&&m.operators[p[1]](m.parse[i[3]](e),m.parse[i[3]](i[2]))))}return!0},_convertValueByType:function(t,i){if(t.length){var r=this.XLObj;switch(i){case"number":case"decimal":r._isValidDate(t)&&(t=r._dateToInt(t));break;case"date":e.isNumeric(t)&&(t=r.intToDate(t).toString())}}return t},highlightInvalidData:function(e){var i,r,l,n,s,o,a,d,h,c,u=this.XLObj;if(u.model.allowDataValidation&&!u.model.isReadOnly){for(d=u.getActiveSheetIndex(),a=u._getRangeArgs(e,"object"),l=u._getSelectedCells(d,a).selCells,e=u._getAlphaRange(d,a[0],a[1],a[2],a[3]),o=0,i=l.length;o<i;o++)(h=u.XLEdit.getPropertyValue(l[o].rowIndex,l[o].colIndex,"rule",d))&&(u.XLEdit.getPropertyValue(l[o].rowIndex,l[o].colIndex,null,d)&&!t.isNullOrUndefined(h)?(r="datetime"===u.XLEdit.getPropertyValue(l[o].rowIndex,l[o].colIndex,"type",d)||"time"===u.XLEdit.getPropertyValue(l[o].rowIndex,l[o].colIndex,"type",d)?u.XLEdit.getPropertyValue(l[o].rowIndex,l[o].colIndex,"value2",d).toString():u.XLEdit.getPropertyValue(l[o].rowIndex,l[o].colIndex,null,d).toString(),s=!!h&&!this._checkValidation(r,h.customVal.split("_"),!0,d),u._dataContainer.sheets[d][l[o].rowIndex][l[o].colIndex].rule.isApply=s):t.isNullOrUndefined(h)||(s=h.required),u._isRowViewable(d,l[o].rowIndex)&&(n=u.getCell(l[o].rowIndex,l[o].colIndex,d),s?n.addClass("e-hlcell"):n.removeClass("e-hlcell")),u.XLEdit._updateDataContainer({rowIndex:l[o].rowIndex,colIndex:l[o].colIndex},{dataObj:{isHighlight:!0},sheetIdx:d}));u._isUndoRedo||(c={sheetIndex:d,reqType:"validation",operation:"hl-data",range:e},u._completeAction(c),u._trigActionComplete(c))}},_replaceRule:function(e,t){this.XLObj._dataContainer.cFormatData[e]=t},_addDVMethod:function(){t.isNullOrUndefined(e.validator)||e.validator.addMethod("customVal",function(t,i,r){var l=e("#"+e(i).data("id")).data("ejSpreadsheet");return l._getJSSheetContent(l.getActiveSheetIndex()).find(".e-spreadsheetcontentcontainer > .e-content").find(".e-error").remove(),!(!l.model.showRibbon||!e("#"+l._id+"_Ribbon_freetext").length||e("#"+l._id+"_Ribbon_freetext").data("ejCheckBox").isChecked())||l.XLValidate._checkValidation(t,r.split("_"))},t.Spreadsheet.getMsg)}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.dragFill=function(e){this.XLObj=e,this._customList=[["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["January","February","March","April","May","June","July","August","September","October","November","December"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]],this._property=["value","value2","type","formatStr","decimalPlaces","thousandSeparator","hyperlink","format","rule"],this._fillInfo=null,this._verticalFill=!1,this._uniqueOBracket=String.fromCharCode(129),this._uniqueCBracket=String.fromCharCode(130),this._uniqueCSeparator=String.fromCharCode(131),this._uniqueCOperator=String.fromCharCode(132),this._uniquePOperator=String.fromCharCode(133),this._uniqueSOperator=String.fromCharCode(134),this._uniqueMOperator=String.fromCharCode(135),this._uniqueDOperator=String.fromCharCode(136),this._uniqueModOperator=String.fromCharCode(137),this._uniqueConcateOperator=String.fromCharCode(138),this._uniqueEqualOperator=String.fromCharCode(139),this._uniqueExpOperator=String.fromCharCode(140),this._uniqueGTOperator=String.fromCharCode(141),this._uniqueLTOperator=String.fromCharCode(142)},t.spreadsheetFeatures.dragFill.prototype={positionAutoFillElement:function(e){var t,i,r,l,n,s,o=0,a=0,d=0,h=0,c=0,u=0,g=this.XLObj,p="e-hide";if(g.model.allowAutoFill&&g.model.allowSelection){if(n=g.getActiveSheetIndex(),(s=g.getSheet(n))._isRowSelected)d=-3,h=-1,c=5,u=4,i=s.selectedRange[2],r=s.selectedRange[1],a=g._isFrozen(s.frozenColumns)?g._getContent(n).find(".e-content").scrollLeft():s._scrollLeft;else if(s._isColSelected)h=-3,u=5,i=s.selectedRange[0],r=s.selectedRange[3],o=g._isFrozen(s.frozenRows)?g._getContent(n).find(".e-content").scrollTop():s._scrollTop;else{if(s._isSheetSelected)return void this.hideAutoFillElement();d=-3,h=-3,c=1,u=3,i=s.selectedRange[2],r=s.selectedRange[3]}i=(t=g._getMergedIdx(i,r)).rowIndex,r=t.colIndex,l=g._getCellInfo({rowIndex:i,colIndex:r}),s._isColSelected||(o+=l.height),s._isRowSelected||(a+=l.width),o+=l.top,a+=l.left,g.getAutoFillElem()&&g.getAutoFillElem().removeClass(p).css({top:Math.round(o)+d,left:Math.round(a)+h}),g.model.autoFillSettings.showFillOptions&&e&&g.model.allowEditing&&!g.model.isReadOnly&&g._getAutoFillOptElem().removeClass(p).css({top:o+c,left:a+u}),s._autoFillCell=g._dautoFillCell={rowIndex:i,colIndex:r}}},hideAutoFillElement:function(){var e=this.XLObj.getAutoFillElem();e&&e.addClass("e-hide")},hideAutoFillOptions:function(){var e=this.XLObj._getAutoFillOptElem();e&&(e.find("button").data("ejSplitButton")||this.XLObj._initializeSplitButton(),e.find("button").data("ejSplitButton")._hidePopup(),e.addClass("e-hide"))},autoFill:function(i){var r,l=this.XLObj;if(i=i||{},l.model.allowAutoFill&&i.dataRange&&i.fillRange&&i.direction&&l.model.allowEditing&&!l.model.isReadOnly){var n,s,o=l.getActiveSheetIndex(),a=l.getSheet(o),d=t.Spreadsheet.AutoFillOptions;if(this._fillInfo=this._getFillInfo(i),i.fillType=i.fillType||this._fillInfo.fillType,this._verticalFill="down"===i.direction||"up"===i.direction,i.sheetIdx=o,i.dataRange=l._toIntrnlRange(i.dataRange,o),i.fillRange=l._toIntrnlRange(i.fillRange,o),n=e.extend(!0,{},a.rowsHeightCollection),(s={sheetIndex:i.sheetIdx,bHeight:n,reqType:"auto-fill",direction:i.direction,range:i.fillRange,bRange:i.dataRange,bData:l.getRangeData({range:i.fillRange}),bFormat:l.model.allowCellFormatting&&l.XLFormat.getHashCodeClassAsArray(i.fillRange),isHighlightData:!1}).rowSel=a._isRowSelected,s.colSel=a._isColSelected,l._trigger("autoFillBegin",i))return!1;switch(i.fillType){case d.FillSeries:case d.FillWithoutFormatting:this._fillSeries(i);break;case d.CopyCells:case d.FillFormattingOnly:this._copyCells(i);break;case d.FlashFill:s.actionType="flash-fill",s.bdData=l.getRangeData({range:i.dataRange}),this._flashFill(i),s.adData=l.getRangeData({range:i.dataRange})}if(s.aData=l.getRangeData({range:i.fillRange}),s.aHeight=e.extend(!0,{},a.rowsHeightCollection),l.model.allowCellFormatting&&(s.aFormat=l.XLFormat.getHashCodeClassAsArray(i.fillRange)),i.isKeyFill||this.positionAutoFillElement(!0),l._completeAction(s),l._trigActionComplete(s),l._trigger("autoFillComplete",i),s.isHighlightData&&(l._pushHighlightData(s.range),l.XLClipboard._highLightRange.length&&"hl-data"!=s.operation)){for(r=0;r<l.XLClipboard._highLightRange.length;r++)l.XLValidate.highlightInvalidData(l.XLClipboard._highLightRange[r]);l.XLClipboard._highLightRange=[]}}},_updateFillValues:function(e,t,i,r,l,n,s,o,a,d){var h,c,u,g;return e?(h={rowIndex:t,colIndex:i+d},c={rowIndex:r,colIndex:i+d},u={rowIndex:n,colIndex:s+d},g={rowIndex:o,colIndex:s+d}):(h={rowIndex:t+d,colIndex:i},c={rowIndex:t+d,colIndex:l},u={rowIndex:n+d,colIndex:s},g={rowIndex:n+d,colIndex:a}),{patrnRange:[h.rowIndex,h.colIndex,c.rowIndex,c.colIndex],fillRange:[u.rowIndex,u.colIndex,g.rowIndex,g.colIndex]}},_fillSeries:function(e){for(var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y=0,T={},L=this.XLObj,R=t.Spreadsheet.autoFillDirection,O=t.Spreadsheet.CellType,F=e.dataRange[0],E=e.dataRange[1],D=e.dataRange[2],N=e.dataRange[3],A=e.fillRange[0],P=e.fillRange[1],k=e.fillRange[2],j=e.fillRange[3],M=[R.Down,R.Up].indexOf(e.direction)>-1,V=[R.Up,R.Left].indexOf(e.direction)>-1,B=M?N-E:D-F,H=e.fillType===t.Spreadsheet.AutoFillOptions.FillSeries;y<=B;){if(o=(s=this._updateFillValues(M,F,E,D,N,A,P,k,j,y)).patrnRange,a=s.fillRange,l=this._getPattern(o,{isRFill:V,isVFill:M}),c=(d=L.getRangeData({range:o,property:["hyperlink","rule","cFormatRule","type","formatStr","decimalPlaces","wrap"]})).length,!l)return;for(r=l.length,L.clearRangeData(a,[H?"formatStr":null,"hyperlink",H?"cFormatRule":null,"rule","format"]),H&&(L.model.allowCellFormatting&&L.XLFormat.removeStyle(a),b=L.getRangeData({range:o,property:["format","formats"]})),x=(S=L._getSelectedRange({rowIndex:a[0],colIndex:a[1]},{rowIndex:a[2],colIndex:a[3]})).length,V&&(S=S.reverse(),l=l.reverse(),l=this._ensurePattern(l),d=d.reverse(),H&&(b=b.reverse())),u=0;u<x;){switch(T={},v=S[u],n=l[u%r],L.isNumber(n)&&(n=l[n]),n.type){case O.Number:i=L._round(n.regVal.a+n.regVal.b*n.i,5),V?n.i--:n.i++;break;case O.String:i=n.val[n.i%n.val.length],n.i++;break;case O.Formula:for(f=!1,i="=",g=0,m=n.val.length;g<m;)h=n.val[g],L._isObject(h)?(f=!0,i+=(_=L._round(h.a+h.b*n.i,0))<1?"#REF!":M?h.c+(h.b?_:"$"+_):(h.b?L._generateHeaderText(_):"$"+L._generateHeaderText(_))+h.c):i+=h,g++;f&&V?n.i--:n.i++;break;case O.Custom:(i=L._round(n.regVal.a+n.regVal.b*n.i,0))<0&&(i=i%n.len+n.len),i>=n.len&&(i%=n.len),i=n.val[i],V?n.i--:n.i++}if(w=d[p=u%c],L._dupDetails=!0,I={cellIndex:v,value:i,prevValue:L._getCellValue(v.rowIndex,v.colIndex).value,sheetIdx:L.getActiveSheetIndex(),reqType:"auto-fill",action:"fill-series"},L._trigger("cellSave",I))return;"formula"==n.type&&(L._saveTriggered=!0),L.XLEdit.updateCellValue(I.cellIndex,I.value,H?b[p].format:null),"formula"==n.type&&(L._saveTriggered=!1),L._dupDetails=!1,H&&(L.model.allowCellFormatting&&w.type&&"general"!=w.type&&this._updateNFormat(w,I.cellIndex.rowIndex,I.cellIndex.colIndex),L.model.allowConditionalFormats&&w.cFormatRule&&this._updateCFormat(I.cellIndex,w.cFormatRule),(C=b[p].formats)&&(T.formats=C),L.model.allowHyperlink&&w.hyperlink&&this._updateHyperlinkTag(w.hyperlink,I.cellIndex)),L.model.allowDataValidation&&w.rule&&(T.rule=w.rule),L.getObjectLength(T)&&L.XLEdit._updateDataContainer(I.cellIndex,{dataObj:T}),L.model.allowWrap&&w.wrap&&L.setWrapText("wrap",[I.cellIndex.rowIndex,I.cellIndex.colIndex,I.cellIndex.rowIndex,I.cellIndex.colIndex]),u++}y++}},_copyCells:function(e){for(var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=0,S={},x=this.XLObj,v=t.Spreadsheet.autoFillDirection,w=e.dataRange[0],I=e.dataRange[1],y=e.dataRange[2],T=e.dataRange[3],L=e.fillRange[0],R=e.fillRange[1],O=e.fillRange[2],F=e.fillRange[3],E=[v.Down,v.Up].indexOf(e.direction)>-1,D=[v.Up,v.Left].indexOf(e.direction)>-1,N=E?T-I:y-w,A=e.fillType===t.Spreadsheet.AutoFillOptions.FillFormattingOnly;C<=N;){if(l=(s=this._updateFillValues(E,w,I,y,T,L,R,O,F,C)).patrnRange,n=s.fillRange,x.model.allowCellFormatting)if(n[0]==n[2])for(_=[1];_<=[3];_++)x.XLEdit.getPropertyValue(n[0],_,"tformats")||x.XLEdit.getPropertyValue(n[0],_,"formats")||x.XLFormat.removeStyle([n[0],_,n[2],_]);else for(f=n[0];f<=n[2];f++)x.XLEdit.getPropertyValue(f,n[1],"tformats")||x.XLEdit.getPropertyValue(n[0],_,"formats")||x.XLFormat.removeStyle([f,n[1],f,n[3]]);if(A?(x.clearRangeData(n,["format"]),o=x.getRangeData({range:l,property:["cFormatRule","type","decimalPlaces","formatStr"]})):(g=["value","value2","type","formatStr","format","decimalPlaces","thousandSeparator","hyperlink"],x.model.allowConditionalFormats&&g.push("cFormatRule"),x.model.allowDataValidation&&g.push("rule"),x.clearRangeData(n,g),o=x.getRangeData({range:l,property:["value","hyperlink","rule","cFormatRule","type","decimalPlaces","formatStr"]})),a=(d=x.getRangeData({range:l,property:["format","formats"]})).length,u=(c=x._getSelectedRange({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]})).length,i=0,D&&(c=c.reverse(),d=d.reverse(),A||(o=o.reverse())),A)for(;i<u;)S={},r=i%a,m=c[i],p=o[r],x.model.allowCellFormatting&&(x.XLFormat._updateFormatClass(m,d[r].format),this._updateNFormat(p,m.rowIndex,m.colIndex)),(h=d[r].formats)&&(S.formats=h),x.getObjectLength(S)&&x.XLEdit._updateDataContainer(m,{dataObj:S}),x.model.allowConditionalFormats&&p.cFormatRule&&this._updateCFormat(m,p.cFormatRule),x.model.allowCellType&&x.XLCellType._rfrshCtrlText(m),i++;else for(;i<u;){if(S={},r=i%a,m=c[i],p=o[r],x._dupDetails=!0,b={cellIndex:m,value:p.value,prevValue:x._getCellValue(m.rowIndex,m.colIndex).value,format:d[r].format,sheetIdx:x.getActiveSheetIndex(),reqType:"auto-fill",action:"copy-cells"},x._trigger("cellSave",b))return;x.XLEdit.updateCellValue(b.cellIndex,b.value,b.format),x._dupDetails=!1,x.model.allowCellFormatting&&p.type&&"general"!=p.type&&this._updateNFormat(p,b.cellIndex.rowIndex,b.cellIndex.colIndex),x.model.allowHyperlink&&p.hyperlink&&this._updateHyperlinkTag(p.hyperlink,b.cellIndex),(h=d[r].formats)&&(S.formats=h),x.model.allowDataValidation&&p.rule&&(S.rule=p.rule),x.getObjectLength(S)&&x.XLEdit._updateDataContainer(b.cellIndex,{dataObj:S}),x.model.allowConditionalFormats&&p.cFormatRule&&this._updateCFormat(b.cellIndex,p.cFormatRule),i++}C++}},_flashFill:function(e){var t,i,r,l,n=this.XLObj,s=e.dataRange[0],o=e.dataRange[2],a=e.fillRange[0],d=e.fillRange[1],h=e.fillRange[2],c=e.fillRange[3],u=this._getFlashFillPattern(e.dataRange,"left");if(u)for(i=n.getRangeData({range:[a,u.colIndex,h,u.colIndex],valueOnly:!0,skipDateTime:!0}),u.subStr>-1&&(i=this._splitString(i," ",u.subStr)),r=(t=n._getSelectedRange({rowIndex:a,colIndex:d},{rowIndex:h,colIndex:c})).length;r--;){if(l={cellIndex:t[r],value:i[r],sheetIdx:n.getActiveSheetIndex(),prevValue:n._getCellValue(t[r].rowIndex,t[r].colIndex).value,reqType:"auto-fill",action:"flash-fill"},n._trigger("cellSave",l))return;n.XLEdit._updateCellValue(l.cellIndex,l.value)}else a>s&&(a=s),h<o&&(h=o),n._getAutoFillOptElem().addClass("e-hide"),n.updateUniqueData({value:"",value2:"",type:"general"},[a,d,h,c]),n._showAlertDlg("Alert","FlashFillAlert")},_getFlashFillPattern:function(e,i){var r,l,n,s,o,a,d=0,h=-1,c=this.XLObj,u=c.getRangeData({range:e,valueOnly:!0,skipDateTime:!0}),g=u.length,p=e[0],m=t.Spreadsheet.autoFillDirection.Right,_=i===m;if(u.join().replace(/,/g,"").length){for(a=u[0].toString(),0===(d=e[1])&&(_=!0),_?d++:d--;d>-1&&(l=c.XLEdit.getPropertyValue(p,d),(l=c.isUndefined(l)?"":l.toString()).length);){if(l===a){if(!(g>1))return{colIndex:d,subStr:h};if(r=this._matchData(p,d,u))return r}for(s=(n=l.split(" ")).length,o=0;o<s;){if(a===n[o]){if(h=o,!(g>1))return{colIndex:d,subStr:h};if(r=this._matchData(p,d,u))return h>r.subStr&&(r.subStr=h),r}o++}_?d++:d--}if(!_)return this._getFlashFillPattern(e,m)}},_matchData:function(e,i,r){for(var l,n,s,o,a,d=!1,h=1,c=-1,u=r.length;h<u;)if(d=!1,n=r[h].toString(),s=this.XLObj.XLEdit.getPropertyValue(e+h,i),n!==(s=t.isNullOrUndefined(s)?"":s.toString())){for(a=(o=s.split(" ")).length,l=0;l<a;){if(n===o[l]){c<l&&(c=l),d=!0;break}l++}h++}else d=!0,h++;if(d&&h===u)return{colIndex:i,subStr:c}},_splitString:function(e,t,i){for(var r,l,n,s=e.length;s--;){for(n=i,r=e[s].split(t);n>-1&&!(l=r[n]);)n--;e[s]=l}return e},_getPattern:function(e,i){var r,l,n,s,o,a,d,h,c,u,g,p=0,m=[],_=this.XLObj,f=t.Spreadsheet.CellType,b=this._getDataPattern(e),C=b.length;if(b){for(;p<C;){switch((g=b[p]).type){case f.Number:for(l=m.length,u=g.val.length,c=i.isRFill?-1:u,1===u&&g.val.push(g.val[0]+1),n={regVal:s=this._getPredictionValue(g.val),type:g.type,i:c},m.push(n),r=1;r<u;)m.push(l),r++;break;case f.String:for(l=m.length,n={val:g.val,type:g.type,i:0},m.push(n),r=1,u=g.val.length;r<u;)m.push(l),r++;break;case f.Formula:if(u=g.val.length,g=this._getFormulaPattern(g.val,i),c=i.isRFill?-1:u,g.isInPattern)for(l=m.length,n={val:g.val,type:f.Formula,i:c},m.push(n),r=1;r<u;)m.push(l),r++;else for(r=0,c=i.isRFill?-1:1;r<u;)m.push({val:g.val[r],type:f.Formula,i:c}),r++;break;default:if(g.type.indexOf(f.Custom)>-1)for(l=m.length,u=g.val.length,c=i.isRFill?-1:u,h=-1===(o=this._customList[Number(g.type.replace(f.Custom,""))]).indexOf(g.val[0]),a=_.toArrayLowerCase(o.slice(0)),d=_.toArrayLowerCase(g.val),s=this._getCustomPredictionValue(d,a),n={val:h?a:o,regVal:s,i:c,type:f.Custom,len:o.length},m.push(n),r=1;r<u;)m.push(l),r++}p++}return m}},_getCustomPredictionValue:function(e,t){for(var i=0,r=[],l=e.length;i<l;)r.push(t.indexOf(e[i])),i++;return 1===r.length&&r.push(r[0]+1),this._getPredictionValue(r)},_getDataPattern:function(e){var t,i,r=0,l={},n=[],s=this.XLObj.getRangeData({range:e,valueOnly:!0,skipDateTime:!0}),o=s.length;if(o){for(;r<o;)t=s[r],i=this._getType(t),0===r?l={val:[t],type:i}:i===l.type?l.val.push(t):(n.push(l),l={val:[t],type:i}),r++;return n.push(l),n}},_getFormulaPattern:function(e,t){for(var i,r,l,n,s,o=this.XLObj,a=[],d=0,h=e.length;d<h;)a.push(this._parseFormula(e[d])),d++;if(n=this._isInPattern(a,t.isVFill)){for(d=(i=a[0]).length;d--;)l=i[d],(s=o._isCellReference(l))&&"absolute"!==s&&(i[d]=this._getCellRefPrediction(l,t,null,s));return{isInPattern:n,val:i}}for(d=0;d<h;){for(r=(i=a[d]).length;r--;)l=i[r],(s=o._isCellReference(l))&&"absolute"!==s&&(a[d][r]=this._getCellRefPrediction(l,t,h,s));d++}return{isInPattern:n,val:a}},_getCellRefPrediction:function(e,t,i,r){e=e.toUpperCase();var l=new RegExp("[a-z$]","gi"),n=new RegExp("[0-9$]","g"),s=t.isVFill?e.replace(n,""):e.replace(l,""),o=t.isVFill?Number(e.replace(l,"")):this.XLObj._generateColCount(e.replace(n,"")),a=[o],d="$"===e[0];return i&&1!==i?a.push(o+i):a.push(o+1),o=this._getPredictionValue(a),r&&"mixed"===r&&(d===t.isVFill?s="$"+s:o.b=0),o.c=s,o},_isInPattern:function(e,t){var i,r,l,n,s,o,a,d=this.XLObj,h=0,c=1,u=e.length,g=new RegExp("[0-9$]","g"),p=new RegExp("[a-z$]","gi");if(1===u)return!1;for(;c<u;){if(i=e[h],l=e[c],(r=i.length)!==l.length)return!1;for(;r--;)if(n=i[r],s=l[r],d._isCellReference(n)===d._isCellReference(s)){if(t?(o=Number(n.replace(p,"")),a=Number(s.replace(p,""))):(o=d._generateColCount(n.replace(g,"")),a=d._generateColCount(s.replace(g,""))),o!==a-1)return!1}else if(n!==s)return!1;h++,c++}return!0},_parseFormula:function(e){var t,i,r,l=0,n=[];for(r=(e=(e=this._markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;l<r;)(t=e[l])?(1===t.length?n.push(this._isUniqueChar(t)?this._getUniqueCharVal(t):t):(i=t[0],t.indexOf("!")>0?(this._isUniqueChar(i)&&(n.push(this._getUniqueCharVal(i)),t=t.substr(1)),i=t.indexOf("!")+1,n.push(t.substr(0,i)),n.push(t.substr(i))):this._isUniqueChar(i)?(n.push(this._getUniqueCharVal(i)),n.push(t.substr(1))):n.push(t)),l++):l++;return n},_getUniqueCharVal:function(e){switch(e){case this._uniqueOBracket:return"(";case this._uniqueCBracket:return")";case this._uniqueCSeparator:return",";case this._uniqueCOperator:return":";case this._uniquePOperator:return"+";case this._uniqueSOperator:return"-";case this._uniqueMOperator:return"*";case this._uniqueDOperator:return"/";case this._uniqueModOperator:return"%";case this._uniqueConcateOperator:return"&";case this._uniqueEqualOperator:return"=";case this._uniqueExpOperator:return"^";case this._uniqueGTOperator:return">";case this._uniqueLTOperator:return"<"}return""},_isUniqueChar:function(e){var t=e.charCodeAt(e);return t>=129&&t<=142},_markSpecialChar:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\(/g,"("+this._uniqueOBracket).replace(/\)/g,")"+this._uniqueCBracket)).replace(/,/g,","+this._uniqueCSeparator).replace(/:/g,":"+this._uniqueCOperator)).replace(/\+/g,"+"+this._uniquePOperator).replace(/-/g,"-"+this._uniqueSOperator)).replace(/\*/g,"*"+this._uniqueMOperator).replace(/\//g,"/"+this._uniqueDOperator)).replace(/&/g,"&"+this._uniqueConcateOperator)).replace(/=/g,"="+this._uniqueEqualOperator)).replace(/\^/g,"^"+this._uniqueExpOperator)).replace(/>/g,">"+this._uniqueGTOperator).replace(/</g,"<"+this._uniqueLTOperator)).replace(/%/g,"%"+this._uniqueModOperator)},_getPredictionValue:function(e){for(var t=0,i=0,r=0,l=0,n=0,s=e.length;t<s;)i+=t,r+=Number(e[t]),l+=t*Number(e[t]),n+=t*t,t++;return{a:this.XLObj._round((r*n-i*l)/(s*n-i*i),5),b:this.XLObj._round((s*l-i*r)/(s*n-i*i),5)}},_getType:function(e){var i,r=this._isCustomType(e),l=t.Spreadsheet.CellType,n=this.XLObj;return r?i=r:n.isFormula(e)?i=l.Formula:n.isNumber(e)&&(i=l.Number),i||l.String},_isCustomType:function(e){e=(e+="").toLowerCase();for(var i=this._customList.length;i--;)if(this.XLObj.toArrayLowerCase(this._customList[i].slice(0)).indexOf(e)>-1)return t.Spreadsheet.CellType.Custom+i;return!1},_ensurePattern:function(e){for(var i,r=-1,l=e.length;l--;)i=e[l],this.XLObj._isObject(i)?(r=l,i.type===t.Spreadsheet.CellType.String&&(i.val=i.val.reverse())):e[l]=r;return e},_selectAutoFillRange:function(e,t){e&&(t=this.XLObj._getCellIdx(e));var i,r,l=this.XLObj,n=this._getAutoFillRange(t);if(n){for(this._autoFillCleanUp(),i=(r=l.getRange([n.startCell.rowIndex,n.startCell.colIndex,n.endCell.rowIndex,n.endCell.colIndex])).length;i--;)l.addClass(r[i],"e-autofillcell");l.XLSelection._focusRange(n.startCell,n.endCell,l._autofillBorder),l._dautoFillCell=t}},_getAutoFillRange:function(e){var i=t.Spreadsheet.autoFillDirection,r=this.XLObj,l=r.getSheet(r.getActiveSheetIndex()),n=l._startCell,s=l._endCell,o=l._autoFillCell,a=l.selectedRange,d=a[0],h=a[1],c=a[2],u=a[3],g=r.inRange(a,e.rowIndex,e.colIndex),p={rowIndex:d,colIndex:h},m={rowIndex:c,colIndex:u};if(e.rowIndex<o.rowIndex){if(l._isFreezed&&e.rowIndex<=l.frozenRows&&l._hiddenFreezeRows.indexOf(l.frozenRows)>-1&&(e.rowIndex=l._ftopRowIdx),d-e.rowIndex>e.colIndex-u&&d-e.rowIndex>h-e.colIndex)return g?{startCell:p,endCell:{rowIndex:e.rowIndex,colIndex:u}}:{startCell:m,endCell:{rowIndex:e.rowIndex,colIndex:h},fillRange:[e.rowIndex,h,d-1,u],direction:i.Up};if(e.colIndex>o.colIndex)return{startCell:p,endCell:{rowIndex:c,colIndex:e.colIndex},fillRange:[d,u+1,c,e.colIndex],direction:i.Right};if(e.colIndex<o.colIndex)return g?{startCell:p,endCell:m}:{startCell:m,endCell:{rowIndex:d,colIndex:e.colIndex},fillRange:[d,e.colIndex,c,h-1],direction:i.Left}}else{if(e.colIndex>o.colIndex)return e.rowIndex-c>e.colIndex-u?{startCell:p,endCell:{rowIndex:e.rowIndex,colIndex:u},fillRange:[c+1,h,e.rowIndex,u],direction:i.Down}:{startCell:p,endCell:{rowIndex:c,colIndex:e.colIndex},fillRange:[d,u+1,c,e.colIndex],direction:i.Right};if(e.colIndex<o.colIndex)return l._isFreezed&&e.colIndex<=l.frozenColumns&&l._hiddenFreezeCols.indexOf(l.frozenColumns)>-1&&(e.colIndex=l._fleftColIdx),e.rowIndex-c>u-e.colIndex||e.rowIndex-d>u-e.colIndex&&e.rowIndex!==c?{startCell:p,endCell:{rowIndex:e.rowIndex,colIndex:u},fillRange:[c+1,h,e.rowIndex,u],direction:i.Down}:g?{startCell:p,endCell:m}:{startCell:m,endCell:{rowIndex:d,colIndex:e.colIndex},fillRange:[d,e.colIndex,c,h-1],direction:i.Left};if(e.rowIndex>o.rowIndex)return{startCell:p,endCell:{rowIndex:e.rowIndex,colIndex:u},fillRange:[c+1,h,e.rowIndex,u],direction:i.Down};if(e.rowIndex===o.rowIndex&&e.colIndex===o.colIndex)return{startCell:n,endCell:s}}},_getDirection:function(e,i,r){var l=t.Spreadsheet.autoFillDirection;if(r=this.XLObj.isUndefined(r)?this._verticalFill:r){if(i.rowIndex<e.rowIndex)return l.Up;if(i.rowIndex>e.rowIndex)return l.Down;if(i.colIndex>e.colIndex)return l.Right;if(i.colIndex<e.colIndex)return l.Left}else{if(i.colIndex>e.colIndex)return l.Right;if(i.colIndex<e.colIndex)return l.Left;if(i.rowIndex<e.rowIndex)return l.Up;if(i.rowIndex>e.rowIndex)return l.Down}return null},_getFillRange:function(e,i,r,l){var n=t.Spreadsheet.autoFillDirection;switch(l){case n.Up:return[r.rowIndex,e.colIndex,e.rowIndex-1,i.colIndex];case n.Right:return[e.rowIndex,i.colIndex+1,i.rowIndex,r.colIndex];case n.Down:return[i.rowIndex+1,e.colIndex,r.rowIndex,i.colIndex];case n.Left:return[e.rowIndex,r.colIndex,i.rowIndex,e.colIndex-1]}return null},_autoFillOptionClick:function(t){var i,r,l,n,s,o,a,d=e("#"+t.model.targetID).find("#"+t.ID).find(">>");this._hasClass(d[0],"e-ss-fillselect")||(i=this.XLDragFill,r=this.getSheet(this.getActiveSheetIndex()),l=i._getDirection(this._pEndCell,this._pFillCell),n=this.swapRange([this._pStartCell.rowIndex,this._pStartCell.colIndex,this._pEndCell.rowIndex,this._pEndCell.colIndex]),s=i._getFillRange(this._pStartCell,this._pEndCell,this._pFillCell,l),o=r._startCell,a=r._endCell,this._isUndo=!0,this._performUndoRedo(),r._isColSelected||r._isRowSelected||(r._startCell=o,r._endCell=a,this.XLSelection.selectRange(r._startCell,r._endCell)),i.positionAutoFillElement(!0),i.autoFill({dataRange:n,fillRange:s,direction:l,fillType:t.ID}),i._fillInfo.fillType=t.ID,this._isUndo=!1)},_autoFillCleanUp:function(){var e,t,i,r,l="e-hide",n=this.XLObj,s=n.getAutoFillElem(),o=n._getAutoFillOptElem();for(s&&n.addClass(s[0],l),o&&n.addClass(o[0],l),e=(i=n._getContent(n.getActiveSheetIndex())[0].querySelectorAll("td.e-autofillcell")).length;e--;)t=(t=(t=(r=i[e]).className).replace(/e-autofillcell|e-blur/g,"")).replace(/ +/g," "),r.className=t},_autoFillClick:function(){var t,i=0,r="e-ss-fillselect",l=e("#"+this._id+"_ctxtmenu").find("li"),n=l.find("."+r);for(n.length&&(n=n[0],this._removeClass(n,r),this.addClass(n,"e-ss-filloption")),l.show(),t=this.XLDragFill._fillInfo.disableItems.length;i<t;)e(l[this.XLDragFill._fillInfo.disableItems[i]]).hide(),i++;l.filter("#"+this.XLDragFill._fillInfo.fillType).find("span").addClass(r)},_fillRange:function(e,i){var r,l,n,s,o,a,d,h={isKeyFill:!0},c=this.XLObj,u=c.getActiveSheetIndex(),g=c.getSheet(u),p=t.Spreadsheet.autoFillDirection;if(s=(i=i||g.selectedRange)[0],o=i[1],a=i[2],d=i[3],r=this._getDirection({rowIndex:s,colIndex:o},{rowIndex:a,colIndex:d},e),l=e?r===p.Down:r===p.Right,c.isRange(i)&&l)e?(h.dataRange=[s,o,s,d],h.fillRange=[s+1,o,a,d]):(h.dataRange=[s,o,a,o],h.fillRange=[s,o+1,a,d]);else{if(e){if(!s)return;h.dataRange=[s-1,o,s-1,d]}else{if(!o)return;h.dataRange=[s,o-1,a,o-1]}h.fillRange=i}h.direction=e?p.Down:p.Right,h.fillType=t.Spreadsheet.AutoFillOptions.CopyCells,n=c.swapRange(h.fillRange),c.model.allowLockCell&&g.isSheetProtected&&c._isPropExists([n],"isLocked",u)||c._isPropExists([n],"isReadOnly",u)||this.autoFill(h)},_getFillInfo:function(e){var i,r,l=!0,n=t.Spreadsheet.AutoFillOptions.CopyCells,s=[],o=this.XLObj,a=t.Spreadsheet.autoFillDirection,d=[a.Down,a.Up].indexOf(e.direction)>-1,h=o.getRangeData({range:e.dataRange,valueOnly:!0,skipDateTime:!0}),c=h.join().replace(/,/g,"").length;if(o.isRange(e.dataRange)&&c){for(i=h.length;i--;)if(r=h[i],o.isNumber(r)||o.isFormula(r)||this._isCustomType(r)){l=!1,n=o.model.autoFillSettings.fillType;break}}else r=h[0],(o.isNumber(r)||o.isFormula(r)||this._isCustomType(r))&&(l=!1,n=o.model.autoFillSettings.fillType);return(!c||l)&&(s.push(1),n="fillseries"==e.fillType?n:e.fillType),(!d||d&&e.dataRange[1]!==e.dataRange[3])&&s.push(4),{fillType:n,disableItems:s}},_updateHyperlinkTag:function(i,r){var l,n=this.XLObj,s=n.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"value2");n._isRowViewable(n.getActiveSheetIndex(),r.rowIndex)&&(3===(l=n.getCell(r.rowIndex,r.colIndex))[0].lastChild.nodeType&&e(l[0].lastChild).remove(),l.append(t.buildTag("a.e-hyperlinks",s,"",i.webAddr?{href:i.webAddr,target:"_blank"}:{href:"#"}))),n.XLEdit._updateDataContainer(r,{dataObj:{hyperlink:i}})},_updateCFormat:function(e,t){var i,r=0,l=this.XLObj,n=t.length;for(l._dupDetails=!0;r<n;)i=t[r].split("_"),l.XLCFormat._cFormat(i[0],i[2],i[3],i[4],i[5],null,null,[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex]),r++;l._dupDetails=!1},_updateNFormat:function(e,t,i){var r={type:e.type},l=this.XLObj;"general"!=e.type&&(e.formatStr&&(r.formatStr=e.formatStr),"decimalPlaces"in e&&(r.decimalPlaces=e.decimalPlaces)),l._dupDetails=!0,l.XLFormat.format(r,l._getAlphaRange(l.getActiveSheetIndex(),t,i,t,i)),l._dupDetails=!1}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.cellNavigation=function(e){this.XLObj=e,this._canKeyBoardNavigate=!0,this._isNavigate=!0},t.spreadsheetFeatures.cellNavigation.prototype={_selectionKeyDownHandler:function(e){var t,i,r,l,n,s,o,a,d,h,c=!1,u=[],g=this.XLObj,p=g.getActiveSheetIndex(),m=g.getSheet(p),_=e.keyCode,f=e.shiftKey,b=e.ctrlKey,C={keyCode:_,shiftKey:f,ctrlKey:b,altKey:e.altKey},S=!1,x=m._activeCell,v=m._endCell,w=m.rowCount,I=m.colCount,y=g._dataContainer,T=m.usedRange;if((9===_&&this._canKeyBoardNavigate||13===_)&&!b){if(e.preventDefault(),t=g.XLEdit.getCurrentEditCellData(),g.isFormula(t)&&!g.XLEdit._formulaValidate(t))return;if(g.XLEdit._isFormulaEdit&&!g._isFormulaSuggestion)if(t.length>1){if(!this._isValidParameter(t))return void g._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440);if(!g.isFormula(t)){if((t+=")").split("(").length!==t.split(")").length)return void g._showAlertDlg("Alert","MissingParenthesisAlert","FormulaAlert",440);g.XLEdit._editElem.text(t),g.model.allowFormulaBar&&g._getInputBox().val(t)}g.XLEdit.saveCell(),g._getContent(p).find("td").removeClass(g._formulaBorder.join(" ").replace(/,/g," ")+" "+g._ctrlFormulaBorder.join(" ").replace(/,/g," ")),g.XLSelection._cleanUp(),g.XLSelection.selectRange(m._activeCell,m._activeCell),g.XLEdit._isFormulaEdit=!1,g._formulaRange=[],g._ctrlKeyCount=0}else g.XLEdit.saveCell(),g.XLEdit._isFormulaEdit=!1;else 9===_&&g.XLEdit._isEdit&&g.XLEdit.saveCell();i=m.selectedRange,(a=m._isRowSelected||m._isColSelected)&&(i[0]===i[2]||i[1]===i[3])?u.push({rowIndex:i[0],colIndex:i[1]}):u=m._selectedCells,u.length&&(1===u.length||!a&&this._isRangeMerged(u)?m._isRowSelected?f?x.colIndex>0&&this._navigateRow("Backward",C):x.colIndex<39&&this._navigateRow("Forward",C):m._isColSelected?f?x.rowIndex>0&&this._navigateCol("Backward",C):x.rowIndex<39&&this._navigateCol("Forward",C):f?9===_&&x.colIndex>0?this._navigateCell(x.rowIndex,x.colIndex-1,C):13===_&&x.rowIndex>0&&this._navigateCell(x.rowIndex-1,x.colIndex,C):9===_&&x.colIndex<I?this._navigateCell(x.rowIndex,x.colIndex+1,C):13===_&&x.rowIndex<w&&this._navigateCell(x.rowIndex+1,x.colIndex,C):f?9===_?this._navigateRange("ShiftTab",C):this._navigateRange("ShiftEnter",C):9===_?this._navigateRange("Tab",C):this._navigateRange("Enter",C))}else if((37===_||38===_&&!g._isFormulaSuggestion||39===_||40===_&&!g._isFormulaSuggestion)&&this._isNavigate)if(e.preventDefault(),g.XLEdit._isFormulaEdit)n=g.swapRange([g._dStartCell.rowIndex,g._dStartCell.colIndex,g._dEndCell.rowIndex,g._dEndCell.colIndex]),g.getRange([n[0]?n[0]-1:n[0],n[1]?n[1]-1:n[1],n[2],n[3]]).removeClass(g._formulaBorder[g._ctrlKeyCount%6].join(" ")+" "+g._ctrlFormulaBorder[g._ctrlKeyCount%6].join(" ")),b&&(r=g._dStartCell,37===_&&r.colIndex>0?g._dStartCell=g._dEndCell={rowIndex:r.rowIndex,colIndex:0}:38===_&&r.rowIndex>0?g._dStartCell=g._dEndCell={rowIndex:0,colIndex:r.colIndex}:39===_&&r.colIndex<m.colCount?g._dStartCell=g._dEndCell={rowIndex:r.rowIndex,colIndex:m.colCount}:40===_&&r.rowIndex<w&&(g._dStartCell=g._dEndCell={rowIndex:m.colCount,colIndex:r.colIndex})),f||g._shiftKeyEnabled?(l=g._dEndCell,r=g._dStartCell,37===_&&r.colIndex>0?g._dStartCell={rowIndex:r.rowIndex,colIndex:r.colIndex-1}:38===_&&r.rowIndex>0?g._dStartCell={rowIndex:r.rowIndex-1,colIndex:r.colIndex}:39===_&&l.colIndex<m.colCount?g._dEndCell={rowIndex:l.rowIndex,colIndex:l.colIndex+1}:40===_&&l.rowIndex<m.rowCount&&(g._dEndCell={rowIndex:l.rowIndex+1,colIndex:l.colIndex})):(r=g._dStartCell,37===_&&r.colIndex>0?g._dStartCell=g._dEndCell={rowIndex:r.rowIndex,colIndex:r.colIndex-1}:38===_&&r.rowIndex>0?g._dStartCell=g._dEndCell={rowIndex:r.rowIndex-1,colIndex:r.colIndex}:39===_&&r.colIndex<m.colCount?g._dStartCell=g._dEndCell={rowIndex:r.rowIndex,colIndex:r.colIndex+1}:40===_&&r.rowIndex<m.rowCount&&(g._dStartCell=g._dEndCell={rowIndex:r.rowIndex+1,colIndex:r.colIndex})),g.XLSelection._processFormulaRange(g._ctrlFormulaBorder),g._formulaRange[g._ctrlKeyCount]=g._getProperAlphaRange(p,g._dStartCell.rowIndex,g._dStartCell.colIndex,g._dEndCell.rowIndex,g._dEndCell.colIndex);else if(b){if(37===_&&x.colIndex>0){if(d=y.sheets[p][x.rowIndex],h=x.colIndex-1,d&&h<T.colIndex)if(g.XLEdit.getPropertyValue(x.rowIndex,h+1,"value2")&&g.XLEdit.getPropertyValue(x.rowIndex,h,"value2")){for(;g.XLEdit.getPropertyValue(x.rowIndex,h,"value2")&&h<=T.colIndex;)h--;I=h+1}else{for(;!g.XLEdit.getPropertyValue(x.rowIndex,h,"value2")&&h<T.colIndex&&h>0;)h--;I=h}else if(g.XLEdit.getPropertyValue(x.rowIndex,T.colIndex,"value2"))I=T.colIndex;else{for(h=T.colIndex;h>0&&!g.XLEdit.getPropertyValue(x.rowIndex,h,"value2");)h--;I=h}this._navigateCell(x.rowIndex,I,C)}else if(38===_&&x.rowIndex>0){if(d=y.sheets[p],(h=x.rowIndex-1)<=T.rowIndex)if(d[h]&&g.XLEdit.getPropertyValue(h+1,x.colIndex,"value2")&&g.XLEdit.getPropertyValue(h,x.colIndex,"value2")){for(;g.XLEdit.getPropertyValue(h,x.colIndex,"value2")&&h<=T.rowIndex;)h--;w=h+1}else{for(;!g.XLEdit.getPropertyValue(h,x.colIndex,"value2")&&h>0;)h--;w=h}else if(g.XLEdit.getPropertyValue(T.rowIndex,x.colIndex,"value2"))w=T.rowIndex;else{for(h=T.rowIndex;h>0&&!g.XLEdit.getPropertyValue(h,x.colIndex,"value2");)h--;w=h}this._navigateCell(w,x.colIndex,C)}else if(39===_&&x.colIndex<I-1){if(d=y.sheets[p][x.rowIndex],h=x.colIndex+1,d&&h<=T.colIndex)if(g.XLEdit.getPropertyValue(x.rowIndex,h-1,"value2")&&g.XLEdit.getPropertyValue(x.rowIndex,h,"value2")){for(;g.XLEdit.getPropertyValue(x.rowIndex,h,"value2")&&h<=T.colIndex;)h++;I=h-1}else{for(;!g.XLEdit.getPropertyValue(x.rowIndex,h,"value2")&&h<T.colIndex;)h++;I=g.XLEdit.getPropertyValue(x.rowIndex,h,"value2")?h:m.colCount}else I=m.colCount;I===m.colCount&&--I,this._navigateCell(x.rowIndex,I,C)}else if(40===_&&x.rowIndex<w-1){if(d=y.sheets[p],(h=x.rowIndex+1)<T.rowIndex)if(d[h]&&g.XLEdit.getPropertyValue(h-1,x.colIndex,"value2")&&g.XLEdit.getPropertyValue(h,x.colIndex,"value2")){for(;g.XLEdit.getPropertyValue(h,x.colIndex,"value2")&&h<=T.rowIndex;)h++;w=h-1}else{for(;!g.XLEdit.getPropertyValue(h,x.colIndex,"value2")&&h<m.rowCount;)h++;w=h}else w=m.rowCount-1;w===m.rowCount&&--w,this._navigateCell(w,x.colIndex,C)}}else if(f){if(37===_&&v.colIndex>0?m._endCell={rowIndex:v.rowIndex,colIndex:v.colIndex-1}:38===_&&v.rowIndex>0?(S=!0,m._endCell={rowIndex:v.rowIndex-1,colIndex:v.colIndex}):39===_&&v.colIndex<I?m._endCell={rowIndex:v.rowIndex,colIndex:v.colIndex+1}:40===_&&v.rowIndex<w&&(S=!0,m._endCell={rowIndex:v.rowIndex+1,colIndex:v.colIndex}),(m.rowCount===m._endCell.rowIndex||m.colCount===m._endCell.colIndex)&&"normal"===g.model.scrollSettings.scrollMode)return;if((m.rowCount===m._endCell.rowIndex||m.colCount===m._endCell.colIndex)&&!g.model.scrollSettings.allowScrolling)return;g.model.scrollSettings.allowScrolling&&(m.rowCount===m._endCell.rowIndex&&40===_?g._scrollContent({x:0,y:+g.model.rowHeight}):m.colCount-1===m._endCell.colIndex&&39===_&&g._scrollContent({x:+g.model.columnWidth,y:0})),this._isHiddenCell(m._endCell)&&(s={rowIndex:m._endCell.rowIndex,colIndex:m._endCell.colIndex},this._skipHiddenRowsAndCols(s,C),m._endCell.rowIndex=s.rowIndex,m._endCell.colIndex=s.colIndex),(g._isPropExists([[m._startCell.rowIndex,m._endCell.colIndex,m._endCell.rowIndex,m._endCell.colIndex]],"merge")||g._isPropExists([[m._startCell.rowIndex,m._endCell.colIndex,m._endCell.rowIndex,m._endCell.colIndex]],"isMHide"))&&(c=!0),(g.XLEdit.getPropertyValue(m._endCell.rowIndex,m._endCell.colIndex,"isMHide")||g.XLEdit.getPropertyValue(m._endCell.rowIndex,m._endCell.colIndex,"merge")||S&&g._isPropExists([[m._endCell.rowIndex,m._startCell.colIndex,m._endCell.rowIndex,m._endCell.colIndex]],"merge")||g._isPropExists([[m._endCell.rowIndex,m._startCell.colIndex,m._endCell.rowIndex,m._endCell.colIndex]],"isMHide")||c)&&(S=!1,g.XLSelection._processBoundary(),(37===_||38==_)&&(o=m._endCell,m._endCell=m._startCell,m._startCell=o)),(m._endCell.colIndex<=m._leftCol.idx||m._endCell.colIndex>=m._rightCol.idx||m._endCell.rowIndex<=m._topRow.idx||m._endCell.rowIndex>=m._bottomRow.idx)&&this._scrollToCell(m._endCell,C),g.XLSelection.selectRange(m._startCell,m._endCell),g.model.allowAutoFill&&g.XLDragFill.positionAutoFillElement()}else if(C={keyCode:_,shiftKey:!1,ctrlKey:!1,altKey:!1},37===_&&x.colIndex>0)this._navigateCell(x.rowIndex,x.colIndex-1,C);else if(38===_&&x.rowIndex>0)this._navigateCell(x.rowIndex-1,x.colIndex,C);else if(39===_&&x.colIndex<I)this._navigateCell(x.rowIndex,x.colIndex+1,C);else{if(!(40===_&&x.rowIndex<w))return!1;this._navigateCell(x.rowIndex+1,x.colIndex,C)}},_navigateCell:function(i,r,l){var n,s,o,a,d,h,c,u,g,p,m={rowIndex:i,colIndex:r},_=this.XLObj,f=_.getActiveSheetIndex(),b=_.getSheet(f),C=_._getContent(f),S=C.find("#hscrollBar").data("ejScrollBar"),x=C.find("#vscrollBar").data("ejScrollBar"),v=C.find(".e-content"),w=_.XLEdit,I=!1,y=v[0].offsetWidth;if((b.rowCount!==m.rowIndex&&b.colCount!==m.colIndex||"normal"!==_.model.scrollSettings.scrollMode)&&(b.rowCount!==m.rowIndex||!_.model.scrollSettings.allowVirtualScrolling)&&(b.rowCount!==m.rowIndex&&b.colCount!==m.colIndex||_.model.scrollSettings.allowScrolling)){for(b.rowCount===m.rowIndex&&(_.XLScroll._scrollY(f),I=!0),_._isAutoWHMode||b.colCount!==m.colIndex||_.model.scrollSettings.scrollMode!==t.Spreadsheet.scrollMode.Infinite||(_.XLScroll._scrollX(f),I=!0),this._navToCell(i,r),this._isHiddenCell(m)&&this._skipHiddenRowsAndCols(m,l),(d=w.getPropertyValue(b._activeCell.rowIndex,b._activeCell.colIndex,"merge"))&&w.getPropertyValue(m.rowIndex,m.colIndex,"mergeIdx")&&this._updateMergeRange(d,m,l),b._activeCell=b._endCell=b._startCell=m,(_.XLEdit.getPropertyValue(m.rowIndex,m.colIndex,"mergeIdx")||_.hasSpan(m))&&(_.XLSelection._processBoundary(),b._activeCell=b._startCell,o=!0),s=_._getCellInfo(m,f),a=b._leftCol.idx>0?b._leftCol.idx-1:b._leftCol.idx,_.model.scrollSettings.allowScrolling&&b._bottomRow.idx<=m.rowIndex&&(40===l.keyCode||13===l.keyCode&&!l.shiftKey)&&!I&&!b._isFreezed?(x._scrollData.step=1,l.ctrlKey&&40===l.keyCode?_.XLScroll._scrollSelectedPosition(f,_.getActiveCell(f)):x.scroll(x.value()+(_._isFrozen(b.frozenRows)?_._getRowHeight(b._ftopRowIdx,f):s.height),!0)):_.model.scrollSettings.allowScrolling&&!_._isFrozen(b.frozenRows)&&b._topRow.idx>m.rowIndex&&(38===l.keyCode||13===l.keyCode&&l.shiftKey)&&!I&&!_._hasClass(C.find("tr").eq(m.rowIndex)[0],"e-fr-hide")&&(x._scrollData.step=-1,m.rowIndex>0?l.ctrlKey?x.scroll(s.top,!0):x.scroll(x.value()-s.height,!0):x.scroll(0)),_.model.scrollSettings.allowScrolling&&r>=b._rightCol.idx&&y<=b._colWidthCollection[b._activeCell.colIndex]-b._colWidthCollection[a]+s.width&&(39===l.keyCode||9===l.keyCode&&!l.shiftKey)&&!I?(S._scrollData.step=1,l.ctrlKey&&39===l.keyCode?S.scroll(s.left+s.width-S._scrollData.handleSpace,!0):S.scroll(S.value()+(_._isFrozen(b.frozenColumns)?_._getColWidth(b._fleftColIdx,f):s.width),!0)):_.model.scrollSettings.allowScrolling&&!_._isFrozen(b.frozenColumns)&&a>=m.colIndex&&(37===l.keyCode||9===l.keyCode&&l.shiftKey)&&!I?(S._scrollData.step=-1,m.colIndex>0?l.ctrlKey?S.scroll(s.left,!0):S.scroll(S.value()-s.width,!0):S.scroll(0)):_.model.scrollSettings.allowScrolling&&l.ctrlKey&&!I&&!b._isFreezed&&(37===l.keyCode?S.scroll(s.left,!0):38===l.keyCode?x.scroll(s.top,!0):39===l.keyCode?S.scroll(s.left-S._scrollData.handleSpace,!0):_.XLScroll._scrollSelectedPosition(f,_.getActiveCell(f))),n=C.find("col"),h=e(_.getRows(f)[1]),c=b._startCell.rowIndex,u=b._startCell.colIndex,(y>=s.left||v.offset().left+y>=s.left+s.width)&&(39==l.keyCode||9==l.keyCode&&!l.shiftKey)?_.XLSelection.selectRange(b._startCell,b._startCell):!n.eq(u).hasClass("e-fc-hide")||37==l.keyCode||9==l.keyCode&&l.shiftKey?_.XLSelection.selectRange(b._startCell,b._endCell):!h.eq(c).hasClass("e-fr-hide")&&(38==l.keyCode||13==l.keyCode&&l.shiftKey)?_.XLSelection.selectRange(b._startCell,b._endCell):(v.offset().top+v[0].offsetHeight>=s.top||v.offset().top+v[0].offsetHeight>=s.top+s.height)&&(40==l.keyCode||13==l.keyCode&&!l.shiftKey)&&_.XLSelection.selectRange(b._startCell,b._endCell),o&&(37===l.keyCode||l.shiftKey&&9===l.keyCode?m.colIndex=b._startCell.colIndex:38===l.keyCode||l.shiftKey&&13===l.keyCode?m.rowIndex=b._startCell.rowIndex:39===l.keyCode||9===l.keyCode?m.colIndex=b._endCell.colIndex:(40===l.keyCode||13===l.keyCode)&&(m.rowIndex=b._endCell.rowIndex),b._activeCell=m),b._startCell=m;(37===l.keyCode||l.shiftKey&&9===l.keyCode)&&_._hasClass(n[b._startCell.colIndex],"e-c-hide");)_._removeClass(n[b._startCell.colIndex],"e-fc-hide"),b._startCell.colIndex--;for(;(38===l.keyCode||l.shiftKey&&13===l.keyCode)&&_._hasClass(C.find("tr")[b._startCell.rowIndex],"e-r-hide");)_._removeClass(C.find("tr")[b._startCell.rowIndex],"e-fr-hide"),b._startCell.rowIndex--;for(;(39===l.keyCode||9===l.keyCode)&&_._hasClass(n[b._startCell.colIndex],"e-c-hide");)b._startCell.colIndex++;for(;(40===l.keyCode||13===l.keyCode)&&_._hasClass(C.find("tr")[b._startCell.rowIndex],"e-r-hide");)b._startCell.rowIndex++;g=b._startCell.rowIndex,p=b._startCell.colIndex,"row"===_.model.selectionSettings.selectionType?_.XLSelection.selectRows(g,g):"column"===_.model.selectionSettings.selectionType&&_.XLSelection.selectColumns(p,p),_.model.showRibbon&&_.XLRibbon._updateRibbonIcons(),_.model.allowAutoFill&&_.XLDragFill.positionAutoFillElement()}},_navToCell:function(e,t){var i,r,l,n=this.XLObj,s=n.getSheet();if(i=r=0,s._isFreezed){if(s._frozenRows-1<=e&&e<s._ftopRowIdx){for(l=e;l<s._ftopRowIdx;l++)i+=s.rowsHeightCollection[l];n._scrollContent({y:-i})}else if(s._frozenRows-1<=e&&e>s._bottomRow.idx){for(l=s._bottomRow.idx;l<e;l++)i+=s.rowsHeightCollection[l];n._scrollContent({y:+i})}if(s._frozenColumns-1<=t&&t<s._fleftColIdx){for(l=t;l<s._fleftColIdx;l++)r+=s.columnsWidthCollection[l];n._scrollContent({x:-r})}else if(s._frozenColumns-1<=t&&t>s._rightCol.idx){for(l=s._rightCol.idx;l<t;l++)r+=s.columnsWidthCollection[l];n._scrollContent({x:+r})}}},_navigateRange:function(e,t){var i=this.XLObj,r=i.getSheet(i.getActiveSheetIndex()),l=r._startCell,n=r._endCell,s=r._activeCell,o=l.rowIndex<n.rowIndex?l.rowIndex:n.rowIndex,a=l.rowIndex>n.rowIndex?l.rowIndex:n.rowIndex,d=l.colIndex<n.colIndex?l.colIndex:n.colIndex,h=l.colIndex>n.colIndex?l.colIndex:n.colIndex;if("Tab"==e)if(s.colIndex<h)this._navigateRow("Forward",t);else if(s.rowIndex<a)this._updateActiveCell(s.rowIndex+1,d,t,e);else{if(s.rowIndex!=a||s.colIndex!=h)return!1;this._updateActiveCell(o,d,t,e)}else if("Enter"==e)if(s.rowIndex<a)this._navigateCol("Forward",t);else if(s.colIndex<h)this._updateActiveCell(o,s.colIndex+1,t,e);else{if(s.rowIndex!=a||s.colIndex!=h)return!1;this._updateActiveCell(o,d,t,e)}else if("ShiftTab"==e)if(s.colIndex>d)this._navigateRow("Backward",t);else if(s.rowIndex>o)this._updateActiveCell(s.rowIndex-1,h,t,e);else{if(s.rowIndex!=o||s.colIndex!=d)return!1;this._updateActiveCell(a,h,t,e)}else if(s.rowIndex>o)this._navigateCol("Backward",t);else if(s.colIndex>d)this._updateActiveCell(a,s.colIndex-1,t,e);else{if(s.rowIndex!=o||s.colIndex!=d)return!1;this._updateActiveCell(a,h,t,e)}},_navigateRow:function(e,t){var i,r,l=this.XLObj,n=l.getSheet(l.getActiveSheetIndex())._activeCell;"Forward"===e?(i=1,r="Tab"):(i=-1,r="ShiftTab"),this._updateActiveCell(n.rowIndex,n.colIndex+i,t,r)},_navigateCol:function(e,t){var i,r,l=this.XLObj,n=l.getSheet(l.getActiveSheetIndex())._activeCell;"Forward"===e?(i=1,r="Enter"):(i=-1,r="ShiftEnter"),this._updateActiveCell(n.rowIndex+i,n.colIndex,t,r)},_updateActiveCell:function(e,t,i,r){var l=this.XLObj,n=l.getSheet(l.getActiveSheetIndex()),s=n._activeCell;l._removeClass(l.getCell(s.rowIndex,s.colIndex),"e-activecell"),n._activeCell={rowIndex:e,colIndex:t},i&&this._isHiddenCell(n._activeCell)&&this._skipHiddenRowsAndCols(n._activeCell,i,!0,r),this._isMergedCell(n._activeCell)&&this._skipMergedCells(n._activeCell,i),this._scrollToCell(n._activeCell,i),l.addClass(l.getCell(n._activeCell.rowIndex,n._activeCell.colIndex),"e-activecell"),l.model.allowFormulaBar&&l.updateFormulaBar(),l._setSheetFocus()},_isValidParameter:function(e){return!(e.indexOf("(")>-1)||(e=e.split("("))[1].length>0},_skipHiddenRowsAndCols:function(e,i,r,l){var n=this.XLObj,s=n.getSheet(n.getActiveSheetIndex()),o=!0;r?this._navigateRange(l,i):((37===i.keyCode||9===i.keyCode&&i.shiftKey||39===i.keyCode&&i.ctrlKey)&&e.colIndex?e.colIndex--:(38===i.keyCode||13===i.keyCode&&i.shiftKey||40===i.keyCode&&i.ctrlKey)&&e.rowIndex?e.rowIndex--:(39===i.keyCode||9===i.keyCode||37===i.keyCode&&i.ctrlKey)&&e.colIndex<s.colCount-1?e.colIndex++:(40===i.keyCode||13===i.keyCode||38===i.keyCode&&i.ctrlKey)&&e.rowIndex<s.rowCount-1?e.rowIndex++:o=!1,this._isHiddenCell(e)&&o?this._skipHiddenRowsAndCols(e,i):o||((37===i.keyCode||9===i.keyCode&&i.shiftKey)&&!e.colIndex?e.colIndex=37===i.keyCode&&i.shiftKey?s._endCell.colIndex+1:s._startCell.colIndex:(38===i.keyCode||13===i.keyCode&&i.shiftKey)&&!e.rowIndex?e.rowIndex=38===i.keyCode&&i.shiftKey?s._endCell.rowIndex+1:s._startCell.rowIndex:n.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(40===i.keyCode||13===i.keyCode||40===i.keyCode&&i.shiftKey)&&e.rowIndex==s.rowCount-1&&(e.rowIndex=40===i.keyCode&&i.shiftKey?s._endCell.rowIndex-1:s._startCell.rowIndex)))},_isHiddenCell:function(e){return this.XLObj.XLEdit.getPropertyValue(0,e.colIndex,"isCHide")||this.XLObj.XLEdit.getPropertyValue(e.rowIndex,0,"isRHide")||this.XLObj.XLEdit.getPropertyValue(e.rowIndex,0,"isFilterHide")||!1},_isMergedCell:function(e){return this.XLObj.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"isMHide")||this.XLObj.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"merge")},_skipMergedCells:function(e,t){var i=this.XLObj,r=i.getSheet(i.getActiveSheetIndex()),l=r._startCell,n=r._endCell,s=!0,o=l.rowIndex<n.rowIndex?l.rowIndex:n.rowIndex,a=l.rowIndex>n.rowIndex?l.rowIndex:n.rowIndex,d=l.colIndex<n.colIndex?l.colIndex:n.colIndex,h=l.colIndex>n.colIndex?l.colIndex:n.colIndex;t.shiftKey&&9===t.keyCode?e.colIndex--:9===t.keyCode?e.colIndex++:t.shiftKey&&13===t.keyCode?e.rowIndex--:13===t.keyCode?e.rowIndex++:s=!1,e.colIndex>h?(e.colIndex=d,e.rowIndex=e.rowIndex===a?o:e.rowIndex+1):e.colIndex<d?(e.colIndex=h,e.rowIndex=e.rowIndex===o?a:e.rowIndex-1):e.rowIndex>a?(e.rowIndex=o,e.colIndex=e.colIndex===h?d:e.colIndex+1):e.rowIndex<o&&(e.rowIndex=a,e.colIndex=e.colIndex===d?h:e.colIndex-1),this._isMergedCell(e)&&s&&this._skipMergedCells(e,t)},_updateMergeRange:function(e,t,i){var r=e.mSpan.colSpan-1,l=e.mSpan.rowSpan-1;i.shiftKey||39!==i.keyCode&&9!==i.keyCode?i.shiftKey||40!==i.keyCode&&13!==i.keyCode||(t.rowIndex=t.rowIndex+l):t.colIndex=t.colIndex+r},_isRangeMerged:function(e){var t={},i=this.XLObj,r=e[0],l=i.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"merge");if(l&&(t={rowIndex:e[0].rowIndex+l.mSpan.rowSpan-1,colIndex:e[0].colIndex+l.mSpan.colSpan-1},i._getSelectedRange(e[0],t).length===e.length))return!0},_scrollToCell:function(e,t){var i=this.XLObj,r=i.getActiveSheetIndex(),l=i._getCellInfo(e,r),n=i.getSheet(r),s=i._getContent(r),o=s.find(".e-content"),a=s.find("#hscrollBar").data("ejScrollBar"),d=s.find("#vscrollBar").data("ejScrollBar");("normal"!==i.model.scrollSettings.scrollMode||n.colCount-1!==e.colIndex)&&(n._bottomRow.idx>0&&e.rowIndex>n._bottomRow.idx-1&&n.rowCount-1>e.rowIndex&&40===t.keyCode?d.scroll(d.value()+l.height,!0):e.rowIndex-1<n._topRow.idx&&38===t.keyCode?(d._scrollData.step=-1,e.rowIndex>0?d.scroll(l.top,!0):d.scroll(0)):e.colIndex<n._leftCol.idx?e.colIndex>0?a.scroll(a.value()-l.width,!0):a.scroll(0):o[0].offsetWidth<=l.left+l.width&&(39===t.keyCode?n.colCount===e.colIndex+1?i.XLScroll._scrollX(r):a.scroll(a.value()+l.width,!0):37===t.keyCode&&(a._scrollData.step=-1,a.scroll(l.left,!0))))}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.cellFormatting=function(e){this.XLObj=e,this._formatEnable=!1,this._thousandSeparator=t.preferredCulture(this.XLObj.model.locale).numberFormat[","],this._formatAsTableStyle={},this._rowLength=null,this._colLength=null,this._getFormat=null,this._getEformatClass=null,this._borderPosition=["top","right","bottom","left"],this._cellObj=null,this._isFAT=!1,this._customFormatSpecifierType={},this._customFontFamily={},this._isHeaderAdded=!1,this._styleDlgClick=!1,this._isTableNameAdded=!1},t.spreadsheetFeatures.cellFormatting.prototype={format:function(i,r){var l,n=this.XLObj;if(n.model.allowCellFormatting&&!n.model.isReadOnly){var s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w=0,I={},y=[],T="style",L="format",R=n.getActiveSheetIndex(),O=n.getSheet(R),F=n._dataContainer,E={formatObj:i,sheetIndex:R,reqType:"cell-format",type:"actionBegin",action:"cellformat"},D={sheetIndex:R,reqType:"cell-format"},N=n._dupDetails,A=!1;if(!n._trigActionBegin(E)){if(m=(a=n._getMultiRangeCells(r)).length,n._trigger("beforeCellFormat",{sheetIndex:R,format:i,cells:a}))return!1;if(m){if(T in(i=this._getFormatObj(i))||L in i){for((D.oprType=T in i?"style":"format",x=a[m-1].colIndex);w<m;)E={sheetIndex:R,format:i,cell:o=a[w]},this._cellObj={},s={rowIndex:o.rowIndex,colIndex:o.colIndex,beforeFormat:{},afterFormat:{},bRowHeight:n.model.allowResizing&&n.XLResize.getRowHeight(o.rowIndex)},I=t.isNullOrUndefined(F.sheets[R][s.rowIndex])?{}:t.isNullOrUndefined(F.sheets[R][s.rowIndex][s.colIndex])?{}:F.sheets[R][s.rowIndex][s.colIndex],n._isRowViewable(R,o.rowIndex)&&(p=(g=n.getCell(o.rowIndex,o.colIndex))[0]),T in i&&(s.prevClass=n.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,L),s.prevClass=s.prevClass?s.prevClass:"",(S=this._getExtendedFormat(o,i.style)).format["text-align"]&&"right"===S.format["text-align"].toLowerCase()&&!n._hasClass(p,"e-rightalign")?n.addClass(p,"e-rightalign"):(!S.format["text-align"]||"right"!==S.format["text-align"].toLowerCase())&&n._hasClass(p,"e-rightalign")&&n._removeClass(p,"e-rightalign"),this._cellObj.formats=e.extend(!0,{},S.format),(h=n.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"tformats"))&&(S.format=e.extend(h,S.format)),this._cellObj.format=s.className=this._createFormatClass(S.format),s.beforeFormat=e.extend(!0,{},I),("font-family"in i.style||"font-size"in i.style)&&!n.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"isMHide")&&t.isNullOrUndefined(n.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"merge"))&&(C=n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex),n.model.allowResizing&&(n.isNumber(C)||n._isDateTime(C)||n.isTime(C))&&((b=n.XLResize._getContentWidth(s.colIndex,R,s.rowIndex,s.rowIndex)+2)>O.columnsWidthCollection[s.colIndex]&&n.setWidthToColumns([{colIndex:s.colIndex,width:b}])),n.model.allowSelection&&n.XLSelection._refreshBorder(),A=!0),E.cssClass=S.className),L in i&&i.type&&(_=n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex),_=t.isNullOrUndefined(_)?"":_,this._cellObj.value=_,this._cellObj.type=i.type,this._cellObj.formatStr=i.format.formatStr,this._cellObj.decimalPlaces=i.format.decimalPlaces,this._cellObj.thousandSeparator=!!i.format.thousandSeparator,this._cellObj.canUpdate=!0,s.beforeFormat=e.extend(!0,{},I),_=this._getFormattedValue(s.rowIndex,s.colIndex,this._cellObj,_),E.value=this._cellObj.value,E.value2=this._cellObj.value2=t.isNullOrUndefined(_)?"":"'"==_[0]?_.substr(1):_+"",delete this._cellObj.canUpdate,s.beforeFormat.Oprtype=this._cellObj.type),n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"value2")&&n._textClip(s.rowIndex,s.colIndex,"delete"),n.XLEdit._updateDataContainer(s,{dataObj:this._cellObj}),T in i&&("font-family"in i.style||"font-size"in i.style)&&!n.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"isMHide")&&(d=O.columnsWidthCollection[s.colIndex],f=n._detailsFromGlobalSpan(s.rowIndex,s.colIndex,"height",n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"value2"),d),(!n.XLEdit.getPropertyValue(s.rowIndex,0,"wrapRow")||O.rowsHeightCollection[s.rowIndex]<f)&&(v=n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"merge")),(f>=n.model.rowHeight&&!n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"mergeIdx")&&!v||v&&v.mSpan.rowSpan<=1)&&(n._updateFormatColl(R,s.rowIndex,s.colIndex,f),f=n._getFormattedHeight(R,s.rowIndex),p&&g.parent().outerHeight(f),O.rowsHeightCollection[s.rowIndex]=f,n.XLEdit._updateDataContainer({rowIndex:s.rowIndex,colIndex:0},{dataObj:{pHeight:O.rowsHeightCollection[s.rowIndex],cHeight:f}}),A=!0,n.model.allowFreezing&&(n.XLFreeze._refreshFRowResize(o.rowIndex),n.XLFreeze._refreshFColResize(o.colIndex)))),c=n._getCellInfo(o),n._dupDetails=!0,L in i&&-1===["text","general"].indexOf(this._cellObj.type)&&(l=n.getRangeData({range:[o.rowIndex,o.colIndex,o.rowIndex,o.colIndex],property:["value2","formats","altTxt","type"]}),u="msie"==n._browserDetails.name&&"8.0"==n._browserDetails.version?n._detailsFromGlobalSpan(o.rowIndex,o.colIndex,"width",this._cellObj.value2):n._getTextContentWidth(l[0],this._cellObj.value2),n.model.allowResizing&&u>c.width&&n.XLResize.setColWidth(o.colIndex,u),n.model.allowFreezing&&n.XLFreeze._refreshFColResize(o.colIndex)),n._dupDetails=!1,n._dupDetails=N,O._isColSelected&&O.selectedRange[1]<=s.colIndex&&s.colIndex<=O.selectedRange[3]&&(O._columnStyles[s.colIndex]=e.extend(!0,O._columnStyles[s.colIndex],this._cellObj)),O._isRowSelected&&O.selectedRange[0]<=s.rowIndex&&s.rowIndex<=O.selectedRange[2]&&(O._rowStyles[s.rowIndex]=e.extend(!0,O._rowStyles[s.rowIndex],this._cellObj)),this._cellObj=null,I=t.isNullOrUndefined(F.sheets[R][s.rowIndex])?{}:t.isNullOrUndefined(F.sheets[R][s.rowIndex][s.colIndex])?{}:F.sheets[R][s.rowIndex][s.colIndex],s.afterFormat=e.extend(!0,{},I),s.afterFormat.Oprtype=s.beforeFormat.Oprtype,s.aRowHeight=n.model.allowResizing&&n.XLResize.getRowHeight(o.rowIndex),y.push(s),n._trigger("cellFormatting",E),n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"value2")&&n._textClip(s.rowIndex,s.colIndex,"add"),x===s.colIndex&&n._setRowHdrHeight(R,s.rowIndex),w++;D.selectedCell=y,D.range=O.selectedRange,n.XLScroll._getRowHeights(R,a[0].rowIndex),A&&(!O._isImported||O._isLoaded)&&n.model.allowComments&&!n._isExport&&n.XLComment._updateCmntArrowPos(null,R)}n.model.allowFormulaBar&&n.updateFormulaBar(),"border"in i&&!n._isMultiRange(r)?this.applyBorder(i.border,r,D):O._isImported&&!O._isLoaded||n._isUndoRedo||n._dupDetails||n._isSort||n._isExport||(n._completeAction(D),n._trigActionComplete(D))}}}},_getFormattedValue:function(e,i,r,l){var n,s=this.XLObj,o={};return l=t.isNullOrUndefined(l)?"":s.XLEdit.getPropertyValue(e,i),t.isNullOrUndefined(l)&&(l=""),s.isFormula(l)&&(l=s.XLEdit.getPropertyValue(e,i,"calcValue"),r.canUpdate=!1),-1!==["text","general"].indexOf(r.type)?(s._isDateTime(l)&&(n=s.XLEdit.getPropertyValue(e,i,"type"),l=s._dateToInt(l,n===t.Spreadsheet.CellType.Time),r.value=l),r.type===t.Spreadsheet.CellType.Text?o.align="":s.isNumber(l)&&"right"!=s.XLEdit.getPropertyValue(e,i,"align")&&(o.align=t.Spreadsheet.Align.Right),"align"in o&&(o.cellIdx={rowIndex:e,colIndex:i},s.XLEdit._refreshCellAlignment(o))):(s._isDateTime(l)&&(n=s.XLEdit.getPropertyValue(e,i,"type")),l=this._format(l,{formatStr:r.formatStr,type:r.type,thousandSeparator:r.thousandSeparator,decimalPlaces:r.decimalPlaces,cellObj:r,isTime:n===t.Spreadsheet.CellType.Time},{rowIndex:e,colIndex:i})),l},_format:function(e,i){var r=this.XLObj,l=i.formatStr,n=r.isUndefined(e)?"":e,s=i.type||"",o=t.Spreadsheet.CellType,a=r.model.locale,d=["."].indexOf(this._thousandSeparator)>-1?"\\":"",h=new RegExp(d+this._thousandSeparator,"g");switch(e=n.toString(),r.XLEdit._formatCellVal=null,s){case o.Accounting:r._isDateTime(n)&&(n=r._dateToInt(n),r.XLEdit._formatCellVal=n,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=n)),r.isNumber(n)&&(n=r.toAccounting(l,n,a));break;case o.Currency:case o.Number:case o.Percentage:r._isDateTime(n)&&(n=r._dateToInt(n),r.XLEdit._formatCellVal=n,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=n)),r.isNumber(n)&&(n=r.formatting(l,n,a),!i.thousandSeparator&&[o.Number,o.Percentage].indexOf(s)>-1&&this._thousandSeparator&&(n=n.replace(h,"")));break;case o.Scientific:r._isDateTime(n)&&(n=r._dateToInt(n),r.XLEdit._formatCellVal=n,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=n)),r.isNumber(n)&&(n=r.toExponential(n,i.decimalPlaces));break;case o.Fraction:r._isDateTime(n)&&(n=r._dateToInt(n),r.XLEdit._formatCellVal=n,this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=n)),r.isNumber(n)&&(n="numerator"in(n=r.toFraction(n))?n.integer+" "+n.numerator+"/"+n.denominator:n.integer);break;case o.LongDate:case o.ShortDate:case o.Date:case o.Time:case o.DateTime:"string"==typeof n&&(n=r._isValidTime(n)?new Date("01/01/1990 "+n):new Date(n)),isNaN(t.parseFloat(n.toString(),10,a))?r._isDateTime(n)||(n=t.parseDate(n)):n=r.intToDate(n),n&&this._cellObj&&this._cellObj.canUpdate&&(this._cellObj.value=n,r.XLEdit._formatCellVal=n),r._isDateTime(n)&&(n=r.formatting(l,n,a));break;case o.String:var c=l.indexOf("\\"),u=l.indexOf("#"),g=l.split("\\").join("");u<0&&(u=l.indexOf("0")),c<u?n=g.substr(c,g.length-1)+e:c>u&&(n=e+g.substr(u+1,g.length))}return t.isNullOrUndefined(n)?e:n},createTable:function(i,r){var l,n,s,o,a=this.XLObj;if(a.model.allowFormatAsTable&&(a.model.allowSelection||!t.isNullOrUndefined(r))&&(!a.getSheet()._isLoaded||!a.model.isReadOnly)){t.isNullOrUndefined(i.format)&&(i.format=this._getTableLayoutFromName(i.formatName).format),t.isNullOrUndefined(i.showHeaderRow)&&(i.showHeaderRow=!0);var d,h,c,u,g,p,m,_,f=i.name||"",b=a.getActiveSheetIndex(),C=a.getSheet(b),S=C.tableManager,x=C._startCell,v=C._endCell,w="formatName",I={sheetIndex:b,tableStyle:i,reqType:"format-table"},y=i.format||this._getTableLayoutFromName(i.formatName).format,T={format:y},L=a._dupDetails,R=a.element.find("#"+a._id+"_Ribbon_tsofiltercolumn");if(h={range:t.isNullOrUndefined(r)?[x.rowIndex,x.colIndex,v.rowIndex,v.colIndex]:r,sheetIndex:I.sheetIndex,tableStyle:I.tableStyle,reqType:I.reqType},!a._trigActionBegin(h)&&y){if(i=I.tableStyle,this._isFAT=!0,r=a._getRangeArgs(r,"object"),a._isUndoRedo)u=e.merge([],r);else for(l=(u=r||C.selectedRange)[0];l<=u[2];l++)for(n=u[1];n<=u[3];n++)if(_=a.XLFilter._getFilterHeader(b,l,n),!t.isNullOrUndefined(_)&&_.status.indexOf("e-ssfilter")>-1)return void a._showAlertDlg("Alert","FilterAlert","",440);if(!i.name||a.XLRibbon._validateNamedRange(i.name,a._getDollarAlphaRange(u,!0),"Workbook")||a.XLClipboard._isCut){if(g=a.XLEdit.getPropertyValue(u[0],u[1],"tableName")||"",(!C._isImported||C._isLoaded)&&(c=a.getRange(u),d={sheetIndex:b,reqType:"format-table",beforeFormat:this.getHashCodeClassAsArray(),beforeRange:e.extend(!0,[],u),pcells:c,beforeRangeHeader:a.getRangeData({range:[u[0],u[1],u[0],u[3]]})},p=i.header?[u[0],u[1],u[2],u[3]]:[u[0],u[1],u[2]+1,u[3]],d.beforeRangeData=a.getRangeData({range:p}),d.beforeMergeRange=a.XLEdit._getPropWithCellIdx(p,"merge",b),a._dupDetails=!0,d.beforeMergeRange.length&&a.unmergeCells(a._getAlphaRange(b,p[0],p[1],p[2],p[3])),a._dupDetails=!1),w in i&&(T[w]=i.formatName),"showHeaderRow"in i&&(T.showHeaderRow=i.showHeaderRow),"totalRow"in i&&(T.totalRow=i.totalRow),g)this._formatAsTableStyle=T,a._dupDetails=!0,this._createTable(a._getTableID(g),T),a._dupDetails=!1,a._undoCollection.pop(),a._undoCollection.pop();else{if(a.XLClipboard._isCut){for(;i.tblId in S;)i.tblId++;m=parseInt(i.tblId)}else m=a.getObjectLength(S)+1;f=f.length?f:"Table"+m,a.model.sheets[b]._header[m]={header:i.header},C._isLoaded&&(i.header?(r?(C._startCell={rowIndex:r[0],colIndex:r[1]},C._endCell={rowIndex:r[2],colIndex:r[3]},a.XLSelection.selectRange(C._startCell,C._endCell),a.model.allowAutoFill&&(!C._isImported||C._isLoaded)&&a.XLDragFill.positionAutoFillElement()):r=a.swapRange([x.rowIndex,x.colIndex,v.rowIndex,v.colIndex]),r[0]===r[2]&&((u=r)[2]=u[2]+1)):(a._isUndoRedo?u=e.extend(!0,[],r):r=u=r||a.swapRange([x.rowIndex,x.colIndex,v.rowIndex,v.colIndex]),a.model.allowDragAndDrop&&a.XLDragDrop._moveRangeTo(u,[u[0]+1,u[1],u[2]+1,u[3]],["value","value2","type","formatStr","decimalPlaces","thousandSeparator","range","format","border","borders","comment","hyperlink","picture","cFormatRule","rule","chart","isLocked","wrap","formats","tformats","tborders","tableName"]),C._startCell={rowIndex:u[0],colIndex:u[1]},C._endCell={rowIndex:u[2]+1,colIndex:u[3]},a.XLSelection.selectRange(C._startCell,C._endCell),a.model.allowAutoFill&&(!C._isImported||C._isLoaded)&&a.XLDragFill.positionAutoFillElement(),u[2]=u[2]+1)),"dataSource"in i&&a._updateRangeValue(b,{showHeader:!("showHeader"in i)||i.showHeader,startCell:a._getAlphaRange(b,r[0],r[1],r[0],r[1]),dataSource:i.dataSource},!1),a.updateUniqueData({tableName:"e-table"+m},r),S[m]={name:f,range:u,showHeaderRow:i.showHeaderRow},i.fnNumber&&(S[m].fnNumber=i.fnNumber),S[m].isFilter=i.showHeaderRow,a.XLRibbon._isDesignTab=!0,a._dupDetails=!0,this._createTable(m,T),i.showHeaderRow&&a.model.allowFiltering&&a.XLFilter._filterTable(b,m,{startCell:{rowIndex:r[0],colIndex:r[1]},endCell:{rowIndex:r[2],colIndex:r[3]}}),a._dupDetails=!1,this._updateTblStyleOptns(m,i),C._isImported&&!C._isLoaded||i.hideTab||a.XLRibbon._designTabUpdate(m,{rowIndex:r[0],colIndex:r[1]}),a.model.allowComments&&a.XLComment._updateCmntArrowPos()}for((!C._isImported||C._isLoaded)&&(a.XLRibbon._dirtySelect(a.getRange(r)),d.tableID=m,d.tableStyle=i,d.afterRange=u,a._dupDetails=L,h={pCells:d.pcells,reqType:d.reqType,sheetIndex:d.sheetIndex,tableID:d.tableID,tableStyle:d.tableStyle},a._isPaste||a._isUndoRedo||a._dupDetails||a._isExport||(a._completeAction(d),a._trigActionComplete(h))),R.length&&R.ejCheckBox("option",{checked:!0}),this._isTableNameAdded||a.XLRibbon.addNamedRange(f,a._getDollarAlphaRange(r,!0),null,b,"Workbook"),this._updateTableFormula("addRange",S[m],b),o=(s=a.getObjectKeys(a._tableRangesFormula[f])).length,a._tableFormulaCollection[f]=[],n=0;n<o;n++)a._tableFormulaCollection[f].push({text:"["+s[n]+"]",display:s[n]});return C._isLoaded&&a.XLSelection._refreshBorder(),this._isFAT=!1,i.name}}}},_createTable:function(t,i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=1,S="tableName",x="e-table"+t,v=this.XLObj,w=v.getActiveSheetIndex(),I=v.getSheet(w).tableManager[t],y=I.range,T=y[0],L=y[1],R=y[2],O=y[3],F=[],E=2;if(I.format=i.format,i.formatName&&(I.formatName=i.formatName),I.showHeaderRow&&(i.showHeaderRow=I.showHeaderRow),this.removeStyle(y,{tableStyle:!0,border:!0,sheetIdx:w}),i.showHeaderRow&&"headerLayout"in i.format&&("border"in(a=e.extend(!0,{},i.format.headerLayout))&&(d=v._getProperAlphaRange(w,T,L,T,O),v._intrnlReq=!0,v._isTableBrdrEnd=!0,this.applyBorder(a.border,d),v._intrnlReq=!1,delete a.border)),f=v.getObjectLength(a)>0,l=T,n=L,s=O,i.showHeaderRow)for(;n<=s;)p=!1,m={},r={rowIndex:l,colIndex:n},h=v.XLEdit.getPropertyValue(l,n,"value2")||"",c="Column"+C,v.XLEdit.getPropertyValue(l,n,S,w)!==x&&(m.tableName=x,p=!0),h.length?h.toLowerCase()===c.toLowerCase()&&C++:(v.XLEdit._updateCell(r,c),C++),b=h.toLowerCase(),h.length&&(F.indexOf(b)<0?F.push(b):(h+=E,E++,F.push(h.toLowerCase()),v.XLEdit._updateCell(r,h))),f&&(g=this._getExtendedFormat(r,a,this._isFAT),m.format=this._createFormatClass(g.format),m.tformats=a,p=!0),p&&v.XLEdit._updateDataContainer(r,{dataObj:m,sheetIdx:w}),n++;if((v.isImport||v.model.isImport)&&(R=i.totalRow?R+1:R),"contentLayout"in i.format)for(u=i.format.contentLayout.length,C=0,l=i.showHeaderRow?T+1:T,n=R;l<=n;){if("border"in(a=e.extend(!0,{},i.format.contentLayout[C%u]))&&(d=v._getProperAlphaRange(w,l,L,l,O),v._intrnlReq=!0,v._isTableBrdrEnd=!0,this.applyBorder(a.border,d),v._intrnlReq=!1,delete a.border),v.getObjectLength(a))for(s=L,o=O;s<=o;)m={},r={rowIndex:l,colIndex:s},_=e.extend({},a),v.XLEdit.getPropertyValue(l,s,S,w)!==x&&(m.tableName=x),_.color&&v.XLEdit.getPropertyValue(l,s,"hyperlink")&&delete _.color,g=this._getExtendedFormat(r,_,this._isFAT),m.format=this._createFormatClass(g.format),m.tformats=a,v.XLEdit._updateDataContainer(r,{dataObj:m,sheetIdx:w}),s++;l++,C++}"contentBorder"in i.format&&(d=v._getProperAlphaRange(w,T+1,L,R,O),v._intrnlReq=!0,v._isTableBrdrEnd=!0,this.applyBorder(e.extend({},i.format.contentBorder.border),d),v._intrnlReq=!1),v.model.scrollSettings.allowVirtualScrolling&v._isTableBrdrEnd&&(v.XLScroll._refreshScroller(w,"refresh","vertical"),v._isTableBrdrEnd=!1),v.XLClipboard._isCut||v._tableCnt++},resizeTable:function(e,t,i){var r=this.XLObj,l=r._getTableID(null,t);r.XLRibbon._resizeTable(e,l,i)},firstColumn:function(e,t){var i=this.XLObj,r=i._getTableID(null,e);i.XLRibbon._isFirstColumn=!0,i.XLRibbon._firstLastColumn(r,t),i.XLRibbon._isFirstColumn=!1},lastColumn:function(e,t){var i=this.XLObj,r=i._getTableID(null,e);i.XLRibbon._firstLastColumn(r,t)},totalRow:function(e,t){var i=this.XLObj,r=i._getTableID(null,e);i.XLRibbon._totalRow(r,t)},filterButton:function(e,t,i){var r=this.XLObj,l=r.getSheet(t).tableManager,n=r._getTableID(null,e);r.XLFilter._clearFilterTableIcon(t,n),l[n].isFilter=i},_updateTblStyleOptns:function(e,t){var i,r,l="firstColumn",n="lastColumn",s="bold",o="normal",a="totalRow",d="isFilter",h=this.XLObj,c=h._getSheetIndex(),u=h.getSheet(c).tableManager;e in u&&(r=(i=u[e]).range,i[d]=d in t?t.isFilter:!("showHeaderRow"in t)||t.showHeaderRow,h.model.allowFiltering&&!i[d]&&h.XLFilter._clearFilterTableIcon(c,e),h._dupDetails=!0,l in t&&(i[l]=t.firstColumn,this.format({style:{"font-weight":i[l]?s:o}},h._getProperAlphaRange(c,r[0]+1,r[1],r[2],r[1]))),n in t&&(i[n]=t.lastColumn,this.format({style:{"font-weight":i[n]?s:o}},h._getProperAlphaRange(c,r[0]+1,r[3],r[2],r[3]))),h._dupDetails=!1,a in t&&(i[a]=t.totalRow))},removeTable:function(t){var i=this.XLObj;if(i.model.allowFormatAsTable&&!i.model.isReadOnly){var r,l,n,s,o,a,d=0,h=i.getActiveSheetIndex(),c=i.getSheet(h).tableManager,u=c[t].range,g=c[t].name,p=i.element.find("#"+i._id+"_Ribbon_tsofiltercolumn");if(this._updateTableFormula("removeTable",c[t],h),t in c){if(i.clearRangeData(u,["tableName"]),l=(r=i._getSelectedRange({rowIndex:u[0],colIndex:u[1]},{rowIndex:u[2],colIndex:u[3]})).length)for(;d<l;)n=i.XLEdit.getPropertyValue(r[d].rowIndex,r[d].colIndex,"formats"),s=i.XLEdit.getPropertyValue(r[d].rowIndex,r[d].colIndex,"tformats"),o=i.XLEdit.getPropertyValue(r[d].rowIndex,r[d].colIndex,"borders"),a=i.XLEdit.getPropertyValue(r[d].rowIndex,r[d].colIndex,"tborders"),s&&(e.extend(s,n),i.XLEdit._updateDataContainer(r[d],{dataObj:{formats:s}})),a&&(e.extend(a,o),i.XLEdit._updateDataContainer(r[d],{dataObj:{borders:a}})),i.XLEdit._clearDataContainer({cellIdx:{rowIndex:r[d].rowIndex,colIndex:r[d].colIndex},property:["tformats","tborders"]}),d++;i.model.allowFiltering&&!i._isFATResize&&i.XLFilter._clearFilterTable(h,parseInt(t)),delete c[t],delete i.model.sheets[h]._header[t],i.XLRibbon.removeNamedRange(g),p.length&&p.ejCheckBox("option",{checked:!1}),i.XLRibbon._toggleDesignTab(i.getActiveCell(h))}}},_renameTable:function(t){var i,r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(o).tableManager,d=s._getTableID(t),h=e("#"+s._id+"_Ribbon").data("ejRibbon");d&&(n=document.getElementById(s._id+"_Ribbon_Design_Properties_TableName")&&document.getElementById(s._id+"_Ribbon_Design_Properties_TableName").value,(i=a[d].name)!=n&&(r=s._getDollarAlphaRange(a[d].range,!0),s.XLRibbon._validateNamedRange(n,r)&&(l={sheetIndex:o,reqType:"format-table",action:"renaming",range:r,tableId:parseInt(d),prevName:i},s.XLRibbon.removeNamedRange(i),a[d].name=n,s.XLRibbon.addNamedRange(a[d].name,r,null,o),this._updateTableFormula("rename",a[d],o,i),l.newName=a[d].name,h.showTab(s._getLocStr("Design")),s._completeAction(l),s._trigActionComplete(l))))},_getTableLayoutFromName:function(e){if(e)return this.XLObj._FATStyles[e]},_getTableIdxFromName:function(e){var t=this.XLObj,i=t.getSheet(t.getActiveSheetIndex()).tableManager,r=t.getObjectLength(i);if(r)for(;r--;)if(i[r].name===e)return r;return-1},convertToRange:function(e){var t=this.XLObj;t.model.isReadOnly||(e.alert?t._showAlertDlg("","ConverToRangeAlert","ConvertToRange",498):this._convertToRange(e))},_convertToRange:function(t){for(var i,r,l=this.XLObj,n=t.sheetIdx||l.getActiveSheetIndex(),s=l.getSheet(n),o=l.getSheet(n).tableManager,a=s.filterSettings.tableRange,d=t.tableId||l._getTableID(null,document.getElementById(l._id+"_Ribbon_Design_Properties_TableName")&&document.getElementById(l._id+"_Ribbon_Design_Properties_TableName").value),h=0;h<a.length;h++)a[h].tableID==d&&(i=h);l.getObjectLength(o)&&(r={sheetIndex:n,reqType:"format-table",action:"Design_Tools_ConvertToRange",beforeFormat:l.XLFormat.getHashCodeClassAsArray(),tableID:d,name:o[d].name,format:o[d].format,formatName:o[d].formatName,tableRange:a[i],beforeRange:o[d].range,isFilter:o[d].isFilter,header:e.extend(!0,[],s._header[d]),firstColumn:o[d].firstColumn,lastColumn:o[d].lastColumn,totalRow:o[d].totalRow,fnNumber:o[d].fnNumber}),l.isNumber(d)&&l.XLFormat.removeTable(d),l.model.showRibbon&&l.XLRibbon._toggleDesignTab(l.getActiveCell()),l._completeAction(r),l._trigActionComplete(r)},_calculateTotalRow:function(e,i,r,l,n){var s,o,a,d,h,c,u,g,p,m=this.XLObj,_=[],f=[],b=!1,C=m.getSheet(e),S=C.tableManager,x=C._selectedCells,v=m._id+"_Ribbon_Design_TableStyleOptions_TotalRow",w=m._isUndo,I=m._isUndoRedo,y=m._dupDetails;if(h=S[i=i||parseInt(document.getElementById(m._id+"_tableid").value)].range,_.push(m.getRangeData({range:[h[2]+1,h[1],h[2]+1,h[3]]})),a=m._getProperAlphaRange(e,h[0]+1,h[3],h[2],h[3]),o=m._getSelectedRange({rowIndex:h[2]+1,colIndex:h[1]},{rowIndex:h[2]+1,colIndex:h[3]}),r){if(g={rowIndex:h[2]+1,colIndex:h[1]},p={rowIndex:h[2]+1,colIndex:h[3]},m._dupDetails=m._isTotalRow=!0,m._insRows={startRow:g.rowIndex,endRow:p.rowIndex},m._isUndo=!1,!n&&m.insertShiftBottom(g,p))return;if(m._isUndo=w,m._isUndoRedo=I,m._dupDetails=m._isTotalRow=!1,!m._isFilterApplied||"insert"==m._insDelStatus){if(o.length>1&&m.XLEdit._updateCellValue(o[0],r?"Total":""),!S[i].fnNumber&&r){if(s=(c=(c=t.distinct(m.getRangeData({range:m.getRangeIndices(a),valueOnly:!0}))).filter(Boolean)).length){for(;s--;)if(!m.isNumber(c[s])){b=!0;break}}else b=!0;S[i].fnNumber=b?103:109}m.XLEdit._updateCellValue(o[o.length-1],r?"=SUBTOTAL("+S[i].fnNumber+","+a+")":""),S[i].range[2]+=1,m._insDelStatus}}else g={rowIndex:h[2],colIndex:h[1]},p={rowIndex:h[2],colIndex:h[3]},m._dupDetails=m._isTotalRow=!0,m.model.allowFiltering&&m.XLFilter._checkFilterApplied(e,g.rowIndex,1,g.colIndex,1,"filter"),m._checkTableApplied(e,g.rowIndex,1,g.colIndex,1,"shiftUp"),m._isFilterApplied||m._isTableApplied?(m._intrnlReq=!0,m._isUndo=!1,m.deleteEntireRow(g.rowIndex,p.rowIndex),m._isUndo=w,m._intrnlReq=!1,l=!1):m._deleteShiftUp(e,g,p,{startCol:g.colIndex,colCount:p.colIndex-g.colIndex+1,startRow:g.rowIndex,rowCount:p.rowIndex-g.rowIndex+1,status:"shiftUp"}),m._isTotalRow=!1,S[i].range[2]-=1;m._dupDetails=y,r?S[i].totalRow=!0:"totalRow"in S[i]&&delete S[i].totalRow,d=S[i].range,m.XLFormat._createTable(i,{format:S[i].format}),this._updateTableFormula("totalRow",S[i],e),f.push(m.getRangeData({range:[d[2]+1,d[1],d[2]+1,d[3]]})),u={sheetIndex:e,reqType:"format-table",action:"totalrow",range:a,check:r,id:v,cell:o,tmgr:S,tableId:i,pcells:_[0],curCells:f[0],fnNumber:S[i].fnNumber,isShift:l},n&&(m._dupDetails=m._isUndoRedo=!1),m._dupDetails||(m._completeAction(u),m._trigActionComplete(u)),m.performSelection({rowIndex:x[0].rowIndex,colIndex:x[0].colIndex},{rowIndex:x[x.length-1].rowIndex,colIndex:x[x.length-1].colIndex}),m._dupDetails=!1},_updateTotalRow:function(e,t,i,r,l){var n=this.XLObj,s=n.getSheet(e).tableManager;s[t].fnNumber=i,l&&n._clearFormula(r[2],r[3]),n.XLEdit._updateCellValue({rowIndex:r[2],colIndex:r[3]},"=SUBTOTAL("+s[t].fnNumber+","+n._getAlphaRange(e,r[0]+1,r[3],r[2]-1,r[3])+")")},customFormatParser:function(e){if(this.XLObj.model.allowCellFormatting){var i,r,l={},n=t.Spreadsheet.CellType,s="{0:",o="}",a=".";return e=t.isNullOrUndefined(e)?"":e.toString(),0===Number(e)?(e.indexOf(a)>-1?i=s+"N"+e.split(a)[1].length+o:i=s+"D"+e.length+o,r=n.Number):!e.indexOf("#")&&e.indexOf(",")>-1&&e.lastIndexOf("0")===e.length-1?(e.indexOf(a)>-1?i=s+"N"+e.split(a)[1].length+o:i="{0:N0}",l.thousandSeparator=!0,r=n.Number):e.lastIndexOf("%")===e.length-1&&0===Number(e.replace(/%/g,""))?(e.indexOf(a)>-1?i=s+"P"+--e.split(a)[1].length+o:i="{0:P0}",r=n.Percentage):/^[dMy/\-\s,]+$/.test(e)?(i=s+e+o,r=n.Date):/^[hmst:\s]+$/.test(e)?(i=s+e+o,r=n.Time):e.indexOf("\\")>-1&&(l.formatStr=e,l.type="string"),i&&(l.formatStr=i,l.type=r),l}},addCustomFormatSpecifier:function(e,i,r){var l,n=t.Spreadsheet.CellType,s=t.preferredCulture(this.XLObj.model.locale);if([n.Date,n.DateTime,n.LongDate,n.ShortDate,n.Time].indexOf(r)>-1){for(l in s.calendar.patterns)if(s.calendar.patterns[l]==i)return;e||(e="cDFrmt"+Object.keys(s.calendar.patterns).length),s.calendar.patterns[e]=i,t.globalize._getDateParseRegExp(s.calendar,i),this._customFormatSpecifierType[e]=r}},addFontFamily:function(i){var r,l,n,s,o,a=i,d=this._customFontFamily,h=this.XLObj,c=49;if(i=i.toLowerCase(),h.isUndefined(d[i])){for(r in d)(o=parseInt(d[r]))>c&&(c=o);c++,h.model.showRibbon&&(l=e("#"+h._id+"_Ribbon_Home_Font_FontFamily").data("ejDropDownList"),(n=e.extend(!0,[],h.XLRibbon._fontFamily)).push({text:a,value:c}),l&&(s=l.model.selectedItemIndex,l.option({dataSource:n}),l._initValue=!0,l.selectItemByIndex(s),l._initValue=!1,h.XLRibbon._fontFamily=n)),d[i]=c+"",t.Spreadsheet.FontFamily[i]=c+""}},removeFontFamily:function(i){var r,l,n,s,o=this._customFontFamily,a=this.XLObj;if(a.model.showRibbon)for(l=e("#"+a._id+"_Ribbon_Home_Font_FontFamily").data("ejDropDownList"),n=e.extend(!0,[],a.XLRibbon._fontFamily),r=0;r<n.length;r++)if(n[r].text===i){n.splice(r,1),l&&(s=l.model.selectedItemIndex,l.option({dataSource:n}),l._initValue=!0,l.selectItemByIndex(s),l._initValue=!1),a.XLRibbon._fontFamily=n;break}i=i.toLowerCase(),a.isUndefined(o[i])||(delete o[i],a.isUndefined(t.Spreadsheet.FontFamily[i])||delete t.Spreadsheet.FontFamily[i])},applyBorder:function(i,r,l){var n=this.XLObj,s=n.getActiveSheetIndex(),o=n.getSheet(s),a={options:i,range:r,details:l,sheetIndex:s,reqType:"cell-format",type:"actionBegin",action:"applyborder"};n._trigActionBegin(a)||n.model.allowCellFormatting&&n.model.formatSettings.allowCellBorder&&(!o._isLoaded||!n.model.isReadOnly)&&(r=n._getRangeArgs(a.range,"object",s),(!o._isImported||o._isLoaded)&&(l||(l={sheetIndex:s,reqType:"cell-format",process:"border",options:e.extend(!0,{},i)}),l.range=r,l.beforeFormat=this.getHashCodeClassAsArray(r),l.property=i.property,l.prevHeight=[],l.newHeight=[],delete i.property),n.getObjectLength(i)?i.isGridBorder?this._applyAllBorderCss(i,r,l):this._applyBorderCss(i,r,l):this.removeStyle(r,{cellStyle:!0,border:!0,sheetIdx:s}),o._isImported&&!o._isLoaded||n._isUndoRedo||(n._refreshRangeTRHght(s,r),t.isNullOrUndefined(i.tableID)&&!this._dupDetails&&(l.afterFormat=this.getHashCodeClassAsArray(r),n._intrnlReq||(n._completeAction(l),n._trigActionComplete(l)))))},updateDecimalPlaces:function(i,r){var l,n,s=this.XLObj;if(s.model.allowCellFormatting&&s.model.formatSettings.allowDecimalPlaces&&!s.model.isReadOnly&&(n={range:r,type:i,sheetIndex:l=s.getActiveSheetIndex(),reqType:"cell-format",type:"actionBegin",action:"decimal"},!s._trigActionBegin(n))){var o,a,d,h,c,u,g,p,m=0,_={},f=s.getSheet(l),b={action:"decimal",reqType:"cell-format",sheetIndex:l,oprType:"format"},C=[];for(r=s._getRangeArgs(n.range,"object"),o=(h=s._getSelectedCells(l,r).selCells).length;m<o;)c=h[m].rowIndex,u=h[m].colIndex,g=s.getRangeData({range:[c,u,c,u]})[0],s.isFormula(g.value)&&(g.type="general",g.value=parseInt(g.value2)),a={rowIndex:c,colIndex:u,afterFormat:{},beforeFormat:{}},p=s._dataContainer.sheets[l][c][u],e.extend(!0,a.beforeFormat,p),s.isNumber(g.value)&&(s.isUndefined(g.decimalPlaces)&&(g.decimalPlaces=s._decimalCnt(g.value)),_.type=g.type===t.Spreadsheet.CellType.General?t.Spreadsheet.CellType.Number:g.type,_.decimalPlaces=g.decimalPlaces="DecreaseDecimal"===i?g.decimalPlaces>0?g.decimalPlaces-1:g.decimalPlaces:g.decimalPlaces+1,_.formatStr=s._getFormatString(_.type,_.decimalPlaces),d=this._format(g.value,{formatStr:_.formatStr,type:_.type,thousandSeparator:g.thousandSeparator,decimalPlaces:_.decimalPlaces}),_.value2=d,s.XLResize&&s.XLResize._getContentWidth(u,l,0,s.getSheet(l).usedRange.rowIndex)>=f.columnsWidthCollection[u]-5&&(s._dupDetails=!0,s.XLResize._fitWidth(u),s._dupDetails=!1,s.XLSelection.refreshSelection(),s.model.allowAutoFill&&s.XLDragFill.positionAutoFillElement()),s.XLEdit._updateDataContainer({rowIndex:c,colIndex:u},{dataObj:_}),a.beforeFormat.Oprtype=_.type),g=s.getRangeData({range:[c,u,c,u]})[0],p=s._dataContainer.sheets[l][c][u],e.extend(!0,a.afterFormat,p),a.afterFormat.Oprtype=a.beforeFormat.Oprtype,C.push(a),m++;b.selectedCell=C,s._isUndoRedo||(s._completeAction(b),s._trigActionComplete(b))}},getFormatClass:function(e,t){var i=t?"e-border":"e-format",r=new RegExp("\\b"+i+".*?\\b","g");return-1!==e.indexOf(i)?e.match(r)[0]:""},getHashCodeClassAsArray:function(e){var t,i,r,l=0,n={format:[]},s=this.XLObj,o=s.getActiveSheetIndex(),a=["topborder","leftborder"];for(e=(e=s._toIntrnlRange(e,o))?s.swapRange(e):s.getSheet(o).selectedRange,i=(t=s.getRange(e)).length;l<i;)r=t[l].className,n.format.push(this.getFormatClass(r)+" "+this.getFormatClass(r,!0)),l++;for(l=2;l--;)n[a[l]]=this._getBorderArray(e,a[l]);return n},_getBorderArray:function(e,t){var i,r,l=0,n=[],s=this.XLObj,o="topborder";if((t===o?e[0]-1:e[1]-1)>=0)for(i=(r=t===o?s.getRange([e[0]-1,e[1],e[0]-1,e[3]]):s.getRange([e[0],e[1]-1,e[2],e[1]-1])).length;l<i;)n.push(this.getFormatClass(r[l].className,!0)),l++;else for(i=t===o?e[3]-e[1]+1:e[2]-e[0]+1;i--;)n.push("");return n},removeStyle:function(t,i){var r=this.XLObj;if(!r.model.isReadOnly){i=i||{cellStyle:!0,tableStyle:!0,format:!0,border:!0};var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b=0,C=this._borderPosition,S=r._getSheetIndex(i.sheetIdx),x=r.getSheet(S),v=r.getActiveSheetIndex();for(t=r._getRangeArgs(t,"object"),n=(l=r._getSelectedCells(S,t).selCells).length,i.sheetIdx&&i.sheetIdx!=v&&r.gotoPage(i.sheetIdx,!1);b<n;)_=!1,o=l[b],i.skipHiddenRow&&r._isHiddenRow(o.rowIndex,i.sheetIdx)||(i.format&&(i.cellStyle&&i.tableStyle?r.XLEdit._clearDataContainer({cellIdx:o,property:["format","formats","tformats"],sheetIdx:i.sheetIdx}):(i.cellStyle&&r._hasCellStyle(o.rowIndex,o.colIndex,i.sheetIdx)||i.tableStyle&&r._isTableRange(o.rowIndex,o.colIndex,i.sheetIdx))&&(m=[i.cellStyle?"formats":"tformats"],(d=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,i.cellStyle?"tformats":"formats",i.sheetIdx))?(a=this.getFormatHashCode(d),this._updateFormatClass(o,a)):m.push("format"),r.XLEdit._clearDataContainer({cellIdx:o,property:m,sheetIdx:i.sheetIdx}))),i.border&&(i.cellStyle&&i.tableStyle?(h=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"borders",i.sheetIdx)||{},c=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"tborders",i.sheetIdx)||{},e.extend(c,h),C[0]in c&&o.rowIndex&&(s=o.rowIndex-1,a=r.XLEdit.getPropertyValue(s,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),g=r.XLEdit.getPropertyValue(s,o.colIndex,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(s,o.colIndex,"tborders",i.sheetIdx)||{},e.extend(p,g),this._remStyle(s,o.colIndex,p,u,"bottom","bottom",!0),_=!0),C[1]in c&&(f=!0,s=o.colIndex+1,a=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),s<x.colCount&&(g=r.XLEdit.getPropertyValue(o.rowIndex,s,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(o.rowIndex,s,"tborders",i.sheetIdx)||{},e.extend(p,g),C[3]in p&&(u.right!=p.left&&(u.right=p.left,a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)),f=!1)),f&&(delete u.right,r.getObjectLength(u)?(a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)):r.XLEdit._clearDataContainer({cellIdx:o,property:["border"]})),_=!0),C[2]in c&&(f=!0,s=o.rowIndex+1,a=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),s<x.rowCount&&(g=r.XLEdit.getPropertyValue(s,o.colIndex,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(s,o.colIndex,"tborders",i.sheetIdx)||{},e.extend(p,g),C[0]in p&&(u.bottom!=p.top&&(u.bottom=p.top,a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)),f=!1)),f&&(delete u.bottom,r.getObjectLength(u)?(a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)):r.XLEdit._clearDataContainer({cellIdx:o,property:["border"]})),_=!0),C[3]in c&&o.colIndex&&(s=o.colIndex-1,a=r.XLEdit.getPropertyValue(o.rowIndex,s,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),g=r.XLEdit.getPropertyValue(o.rowIndex,s,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(o.rowIndex,s,"tborders",i.sheetIdx)||{},e.extend(p,g),this._remStyle(o.rowIndex,s,p,u,"right","right",!0),_=!0),_&&r.XLEdit._clearDataContainer({cellIdx:o,property:["borders","tborders"]})):i.cellStyle?(h=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"borders",i.sheetIdx)||{},c=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"tborders",i.sheetIdx)||{},C[0]in h&&o.rowIndex&&(s=o.rowIndex-1,a=r.XLEdit.getPropertyValue(s,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),g=r.XLEdit.getPropertyValue(s,o.colIndex,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(s,o.colIndex,"tborders",i.sheetIdx)||{},e.extend(p,g),"bottom"in p?h.bottom===u.bottom&&("top"in c?(u.bottom=c.top,a=this._getBorderHashCode(u),this._updateFormatClass({rowIndex:s,colIndex:o.colIndex},a,!0)):p.bottom!=u.bottom&&(u.bottom=p.bottom,a=this._getBorderHashCode(u),this._updateFormatClass({rowIndex:s,colIndex:o.colIndex},a,!0))):this._remStyle(s,o.colIndex,p,u,"top","bottom"),_=!0),C[1]in h&&(s=o.colIndex+1,a=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),s<x.colCount?(g=r.XLEdit.getPropertyValue(o.rowIndex,s,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(o.rowIndex,s,"tborders",i.sheetIdx)||{},e.extend(p,g),"left"in p?h.right===u.right&&("right"in c?(u.right=c.right,a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)):p.left!=u.right&&(u.right=p.left,a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0))):this._remStyle(o.rowIndex,o.colIndex,c,u,"right","right")):this._remStyle(o.rowIndex,o.colIndex,c,u,"right","right"),_=!0),C[2]in h&&(s=o.rowIndex+1,a=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),s<x.rowCount?(g=r.XLEdit.getPropertyValue(s,o.colIndex,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(s,o.colIndex,"tborders",i.sheetIdx)||{},e.extend(p,g),"top"in p?h.bottom===u.bottom&&("bottom"in c?(u.bottom=c.bottom,a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)):p.top!=u.bottom&&(u.bottom=p.top,a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0))):this._remStyle(o.rowIndex,o.colIndex,c,u,"bottom","bottom")):this._remStyle(o.rowIndex,o.colIndex,c,u,"bottom","bottom"),_=!0),C[3]in h&&o.colIndex&&(s=o.colIndex-1,a=r.XLEdit.getPropertyValue(o.rowIndex,s,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),g=r.XLEdit.getPropertyValue(o.rowIndex,s,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(o.rowIndex,s,"tborders",i.sheetIdx)||{},e.extend(p,g),"right"in p?h.left===u.right&&("left"in c?(u.right=c.left,a=this._getBorderHashCode(u),this._updateFormatClass({rowIndex:o.rowIndex,colIndex:s},a,!0)):p.right!=u.right&&(u.right=p.right,a=this._getBorderHashCode(u),this._updateFormatClass({rowIndex:o.rowIndex,colIndex:s},a,!0))):this._remStyle(o.rowIndex,s,c,u,"left","right"),_=!0),_&&r.XLEdit._clearDataContainer({cellIdx:o,property:["borders"]}),r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"merge",S)&&r.XLEdit._clearDataContainer({cellIdx:o,property:["border"]})):i.tableStyle&&(h=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"borders",i.sheetIdx)||{},"top"in(c=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"tborders",i.sheetIdx)||{})&&!("top"in h)&&o.rowIndex&&(s=o.rowIndex-1,a=r.XLEdit.getPropertyValue(s,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),g=r.XLEdit.getPropertyValue(s,o.colIndex,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(s,o.colIndex,"tborders",i.sheetIdx)||{},e.extend(p,g),this._remStyle(s,o.colIndex,p,u,"bottom","bottom",!0),_=!0),"right"in c&&!("right"in h)&&(s=o.colIndex+1,a=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),s<x.colCount?(g=r.XLEdit.getPropertyValue(o.rowIndex,s,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(o.rowIndex,s,"tborders",i.sheetIdx)||{},e.extend(p,g),this._remStyle(o.rowIndex,o.colIndex,p,u,"left","right",!0)):(delete u.right,r.getObjectLength(u)?(a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)):r.XLEdit._clearDataContainer({cellIdx:o,property:["border"]})),_=!0),"bottom"in c&&!("bottom"in h)&&(s=o.rowIndex+1,a=r.XLEdit.getPropertyValue(o.rowIndex,o.colIndex,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),s<x.rowCount?(g=r.XLEdit.getPropertyValue(s,o.colIndex,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(s,o.colIndex,"tborders",i.sheetIdx)||{},e.extend(p,g),this._remStyle(o.rowIndex,o.colIndex,p,u,"top","bottom",!0)):(delete u.bottom,r.getObjectLength(u)?(a=this._getBorderHashCode(u),this._updateFormatClass(o,a,!0)):r.XLEdit._clearDataContainer({cellIdx:o,property:["border"]})),_=!0),"left"in c&&!("left"in h)&&o.colIndex&&(s=o.colIndex-1,a=r.XLEdit.getPropertyValue(o.rowIndex,s,"border",i.sheetIdx),u=this.getBorderFromHashCode(a),g=r.XLEdit.getPropertyValue(o.rowIndex,s,"borders",i.sheetIdx)||{},p=r.XLEdit.getPropertyValue(o.rowIndex,s,"tborders",i.sheetIdx)||{},e.extend(p,g),this._remStyle(o.rowIndex,s,p,u,"right","right",!0),_=!0),_&&r.XLEdit._clearDataContainer({cellIdx:o,property:["tborders"]})))),b++;i.sheetIdx&&i.sheetIdx!=v&&r.gotoPage(v,!1)}},_remStyle:function(e,t,i,r,l,n,s){var o=this.XLObj;l in i?s&&i[l]==r[n]||(r[n]=i[l],this._updateFormatClass({rowIndex:e,colIndex:t},this._getBorderHashCode(r),!0)):(delete r[n],o.getObjectLength(r)?this._updateFormatClass({rowIndex:e,colIndex:t},this._getBorderHashCode(r),!0):o.XLEdit._clearDataContainer({cellIdx:{rowIndex:e,colIndex:t},property:["border"]}))},_refreshStyles:function(t,i){for(var r,l,n,s,o="format",a="border",d=!i||i===o,h=!i||i===a,c=this.XLObj,u=c._getSelectedRange({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]}),g=u.length;g--;)s=u[g],d&&(r=c.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"formats")||{},l=c.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"tformats")||{},e.extend(l,r),c.getObjectLength(l)?(n=this._createFormatClass(l),this._updateFormatClass(s,n,!1)):c.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,o)&&c.XLEdit._clearDataContainer({cellIdx:s,property:[o]})),h&&(r=c.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"borders")||{},l=c.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"tborders")||{},e.extend(l,r),c.getObjectLength(l)?(n=this._getBorderHashCode(l),this._updateFormatClass(s,n,!0)):c.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,a)&&c.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,a)&&c.XLEdit._clearDataContainer({cellIdx:s,property:[a]}))},updateFormat:function(e,t){var i,r,l,n,s=this.XLObj;if(!s.model.isReadOnly){for(l=["topborder","leftborder"],n=e.format,t=s._getRangeArgs(t,"object"),i=(r=s._getSelectedCells(s.getActiveSheetIndex(),t).selCells).length;i--;)n[i]&&this._createFormatClass(this.getFormatFromHashCode(n[i]),n[i]),this._updateHashCodeClass(r[i],n[i]);for(i=2;i--;)this._updateBorderClass(t,e[l[i]],l[i])}},_updateBorderClass:function(e,t,i){var r,l,n=this.XLObj,s="topborder";if((i===s?e[0]-1:e[1]-1)>=0)for(r=(l=i===s?n._getSelectedRange({rowIndex:e[0]-1,colIndex:e[1]},{rowIndex:e[0]-1,colIndex:e[3]}):n._getSelectedRange({rowIndex:e[0],colIndex:e[1]-1},{rowIndex:e[2],colIndex:e[1]-1})).length;r--;)this._createFormatClass({border:this.getBorderFromHashCode(t[r])},t[r]),this._updateFormatClass(l[r],t[r],!0)},updateUniqueFormat:function(e,i,r){var l,n,s,o,a,d=this.XLObj;if(!d.model.isReadOnly){for(l=d.getActiveSheetIndex(),i=d._getRangeArgs(i,"object"),o=(n=d._getSelectedCells(l,i).selCells).length;o--;)s=d._isUndoRedo?t.isNullOrUndefined(e[o].format)?"e-format":e[o].format:e,this._createFormatClass(s.indexOf("e-format")>-1?this.getFormatFromHashCode(s):{border:this.getBorderFromHashCode(s)},s,r),this._updateFormatClass(n[o],s),a=this.getFormatFromHashCode(s),d.XLEdit._updateDataContainer(n[o],{dataObj:{formats:a},sheetIdx:l});"Title"!=r&&"Heading 4"!=r&&t.isNullOrUndefined(a["font-size"])||this._updateRowHeight(i,l)}},_updateRowHeight:function(e,t){var i,r,l,n,s,o=this.XLObj;for(t=t||o.getActiveSheetIndex(),i=o.getSheet(t),r=(l=o._getSelectedCells(t,e).selCells).length;r--;)o._isRowViewable(t,l[r].rowIndex)&&(n=o.getCell(l[r].rowIndex,l[r].colIndex)),!((s=o._detailsFromGlobalSpan(l[r].rowIndex,l[r].colIndex,"height",o.XLEdit.getPropertyValue(l[r].rowIndex,l[r].colIndex,"value2"),i.columnsWidthCollection[l[r].colIndex]))>=o.model.rowHeight)||o.XLEdit.getPropertyValue(l[r].rowIndex,l[r].colIndex,"wrap")&&o.XLEdit.getPropertyValue(l[r].rowIndex,l[r].colIndex,"merge")||o.XLEdit.getPropertyValue(l[r].rowIndex,l[r].colIndex,"mergeIdx")||(o._updateFormatColl(t,l[r].rowIndex,l[r].colIndex,s),s=o._getFormattedHeight(t,l[r].rowIndex),n&&n.parent().outerHeight(s),o.XLEdit._updateDataContainer({rowIndex:l[r].rowIndex,colIndex:0},{dataObj:{pHeight:i.rowsHeightCollection[l[r].rowIndex],cHeight:s}}),i.rowsHeightCollection[l[r].rowIndex]=s,o.model.allowFreezing&&o.XLFreeze._refreshFRowResize(l[r].rowIndex));o._refreshRangeTRHght(t,o.swapRange(e))},_hasFormat:function(e){return!!e&&!t.isNullOrUndefined(e.match(/e-format|e-border/))},getFormatHashCode:function(e){var t,i="",r=0,l="background-color",n="color",s="font-family",o="font-size",a=["font-style","text-decoration","vertical-align","text-align","font-weight"],d=a.length,h=["FontStyle","TextDecoration","VerticalAlign","TextAlign","FontWeight"],c="text-indent";for((i=l in e?e[l].replace("#",""):"6N",i+=n in e?e[n].replace("#",""):"6N",s in e?i+=this._getStyleCode("FontFamily",e[s])||"2N":i+="2N",i+=o in e?this._getFontCode(e[o]):"2N");r<d;)(t=a[r])in e?i+=this._getStyleCode(h[r],e[t])||"1N":i+="1N",r++;return i.endsWith("N")||(i+="N"),c in e&&(i+=e[c].replace(/pt|-|\+/g,"")),"e-format"+i},getFormatFromHashCode:function(e){var t,i,r,l,n,s,o,a,d,h,c,u={},g="e-format";if(!(e=e||"").indexOf(g)){for(r="pt",t=i=0,h=["FontStyle","TextDecoration","VerticalAlign","TextAlign"],a=(o=["font-style","text-decoration","vertical-align","text-align"]).length,1===(c=e.replace(g,"").split("N"))[t].length?t++:(u["background-color"]="#"+c[t].slice(0,6),c[t]=c[t].substr(6)),1===c[t].length?t++:(u.color="#"+c[t].slice(0,6),c[t]=c[t].substr(6)),1===(d=c[t].length)?t++:(n="FontFamily",l="font-family",2===d?(u[l]=this._getCodeStyle(n,c[t].slice(0,1)+"1N"),t++):(u[l]=this._getCodeStyle(n,c[t].slice(0,2)),c[t]=c[t].substr(2))),1===(d=c[t].length)?t++:(s="font-size",2===d?(u[s]=c[t].slice(0,1)+r,t++):(u[s]=c[t].slice(0,2)+r,c[t]=c[t].substr(2)));i<a;)1===c[t].length?t++:(u[o[i]]=this._getCodeStyle(h[i],c[t].slice(0,1)),c[t]=c[t].substr(1)),i++;"2"===c[t]&&(u["font-weight"]="bold"),c[++t]&&(u["text-indent"]=c[t]+r)}return u},getBorderFromHashCode:function(e,t){var i,r=0,l={},n="e-border",s=this._borderPosition;return(e=e||"").indexOf(n)||((i=e.replace(n,"").split("N"))[r].length>1?(l[s[1]]=this._concatBorderCode(i[r]),i[r]=i[r].substr(8)):r+=3,i[r].length>1?(l[s[2]]=this._concatBorderCode(i[r]),t&&(i[r]=i[r].substr(8))):r+=3,t&&(i[r].length>1?(l[s[0]]=this._concatBorderCode(i[r]),i[r]=i[r].substr(8)):r+=3,i[r].length>1&&(l[s[3]]=this._concatBorderCode(i[r])))),l},_formatPainter:function(){var e,t,i,r=this.XLObj;if(r.model.allowFormatPainter&&r.model.allowCellFormatting){var l,n,s=r.getActiveSheetIndex(),o=0,a=r.getSheet(s),d=a._startCell,h=a._endCell,c={sheetIndex:s,reqType:"format-painter",type:"actionBegin",action:"formatpainter"};if(!r._trigActionBegin(c)){for(this._rowLength=h.rowIndex-d.rowIndex+1,this._colLength=h.colIndex-d.colIndex+1,e=this._rowLength,t=this._colLength,i=r.getRangeData({range:[d.rowIndex,d.colIndex,h.rowIndex,h.colIndex],property:["value","value2","type","wrap","formatStr","thousandSeparator","decimalPlaces","cFormatRule","hyperlink","format","cellType"]}),this._getEformatClass=new Array(e),l=0;l<e;l++)for(this._getEformatClass[l]=new Array(t),n=0;n<t;n++)this._getEformatClass[l][n]={rangeData:i[o]},o++;c={sheetIndex:s,reqType:"format-painter",type:"actionComplete",action:"formatpainter"},r._trigActionComplete(c)}}},_fPMouseUp:function(){var e,i,r,l,n,s,o,a,d,h,c,u,g,p=this.XLObj,m=p.getActiveSheetIndex(),_=p.getSheet(m),f=p._getContent(m).find("div.e-content"),b=0,C=_._selectedCells,S=_._startCell,x=_._endCell,v=0,w=0,I=x.rowIndex-S.rowIndex,y=x.colIndex-S.colIndex,T=p.XLEdit,L=_.selectedRange,R=p.getRangeData({range:L,property:["wrap","hyperlink","value","value2","cFormatRule","format","cellType","formats","formatStr","decimalPlaces","thousandSeparator","type"]}),O={sheetIndex:m,reqType:"format-painter",range:L,beforeData:R,bFormat:this.getHashCodeClassAsArray(L),unwrapCells:[],wrapCells:[]},F=p.element.find("#"+p._id+"_Ribbon_Home_Clipboard_FormatPainter");for(p._dupDetails=!0,n=0;n<=I;n++){for(w++,s=0;s<=y;s++){if(b++,u=p._getAlphaRange(m,C[v].rowIndex,C[v].colIndex,C[v].rowIndex,C[v].colIndex),i=C[v],g=this._getEformatClass[n][s],this.removeStyle([C[v].rowIndex,C[v].colIndex,C[v].rowIndex,C[v].colIndex],{cellStyle:!0,tableStyle:!1,format:!0}),e={type:g.rangeData.type?g.rangeData.type:"general"},g.rangeData.format&&(e.style=this.getFormatFromHashCode(g.rangeData.format)),g.rangeData.formatStr&&(e.formatStr=g.rangeData.formatStr),g.rangeData.decimalPlaces&&(e.decimalPlaces=g.rangeData.decimalPlaces),g.rangeData.thousandSeparator&&(e.thousandSeparator=g.rangeData.thousandSeparator),this.format(e,u),g.rangeData.cellType&&((r=p._dataContainer.sheetCellType[g.rangeData.cellType]).text="",p.XLCellType._renderControls(C[v].rowIndex,C[v].colIndex,m,r)),!t.isNullOrUndefined(g.rangeData.cFormatRule))for(c=0,h=g.rangeData.cFormatRule.length;c<h;c++)d=(a=g.rangeData.cFormatRule[c].split("_"))[5],a[a.indexOf(d)]=u,p._dataContainer.cFormatRule=a.join("_"),o=p._dataContainer.cFormatRule.split("_"),p.XLCFormat._cFormat(o[0],o[2],o[3],o[4],o[5]);if(R[v].wrap&&!g.rangeData.wrap?(p.setWrapText("unwrap",u),O.wrapCells.push({rowIndex:C[v].rowIndex,colIndex:C[v].colIndex})):!R[v].wrap&&g.rangeData.wrap&&(p.setWrapText("wrap",u),O.unwrapCells.push({rowIndex:C[v].rowIndex,colIndex:C[v].colIndex})),g.rangeData.hyperlink&&!R[v].hyperlink?this.format({style:{"text-decoration":"underline",color:p._hlColor}},u):!g.rangeData.hyperlink&&R[v].hyperlink&&(this.format({style:{"text-decoration":"none"}},u),p.addClass(p.getCell(i.rowIndex,i.colIndex,m).find("a"),T.getPropertyValue(i.rowIndex,i.colIndex,"format",m))),v++,b===y+1){b=0;break}this._colLength===s+1&&(s=-1)}if(w===I+1)break;this._rowLength===n+1&&(n=-1)}this._formatEnable=!1,f.addClass("e-ss-cursor"),f.removeClass("e-ss-fpcursor"),F.length&&F.ejToggleButton("option",{toggleState:!1}),p._dupDetails=!1,O.afterData=p.getRangeData({range:L,property:["wrap","hyperlink","value","value2","cFormatRule","format","cellType","formats","formatStr","decimalPlaces","thousandSeparator","type"]}),O.aFormat=this.getHashCodeClassAsArray(L),p.XLSelection.refreshSelection(),p.XLDragFill&&p.XLDragFill.positionAutoFillElement(),l={sheetIndex:O.sheetIndex,currData:O.afterData,currFormat:O.aFormat,reqType:O.reqType,range:O.range,prevData:O.beforeData,prevFormat:O.bFormat,unwrapCells:O.unwrapCells,wrapCells:O.wrapCells},p._isUndoRedo||(p._completeAction(O),p._trigActionComplete(l))},_getFormatObj:function(e){if("type"in e||"formatStr"in e){var t={},i="thousandSeparator";t.formatStr="formatStr"in e?e.formatStr:this.XLObj._getFormatString(e.type,e.decimalPlaces),t.decimalPlaces="decimalPlaces"in e?e.decimalPlaces:-1!==["currency","accounting","number"].indexOf(e.type)?parseInt(t.formatStr.replace(/{0:|[A-Z]|}/g,"")):0,i in e?t[i]=e[i]:"number"===e.type&&(t[i]=!0),e.format=t}return"style"in e&&e.style.border&&(e.border=e.style.border,delete e.style.border,this.XLObj.getObjectLength(e.style)||delete e.style),e},_createFormatClass:function(e,t,i){var r,l=this.XLObj._dataContainer.hashCode;return t=t||this.getFormatHashCode(e),-1===l.indexOf(t)||i?(r=this._getCssPropertyAsString(e),this._writeCssRules(t,r,i),-1===l.indexOf(t)&&l.push(t),t):t},_writeCssRules:function(e,t,i,r){var l=document.getElementById(this.XLObj._id+"_sscustomformat"),n=".e-js.e-spreadsheet .e-spreadsheetmainpanel ."+e+" {"+t+"}";r||(l.styleSheet?l.styleSheet.cssText+=n:l.appendChild(document.createTextNode(n))),i&&(n=n.replace(".e-spreadsheetmainpanel ",""),l.styleSheet?l.styleSheet.cssText+=n:l.appendChild(document.createTextNode(n)))},_getCssPropertyAsString:function(e){var t,i,r,l="";if("border"in e){for(i in t=e.border)e["border-"+i]=t[i];delete e.border}for(r in e)l=l+(r+":")+e[r]+";";return l},_splitBorderCode:function(e){return(e=e.split(" "))[0].replace("px","")+this._getStyleCode("BorderStyle",e[1])+e[2].replace("#","")},_concatBorderCode:function(e){return e.substr(0,1)+"px "+this._getCodeStyle("BorderStyle",e.substr(1,1))+" #"+e.substr(2,6)},_getCodeStyle:function(e,i){for(var r in e=t.Spreadsheet[e])if(e.hasOwnProperty(r)&&e[r]===i)return r;return""},_getStyleCode:function(e,i){return i=i||"",t.Spreadsheet[e][i.toLowerCase()]},_getFontCode:function(e){var t=e.replace(/pt|-|\+/g,"");return 2===t.length?t:1===t.length?t+"1N":"2N"},_getExtendedFormat:function(t,i,r){var l=this.XLObj.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"formats")||{};return r?(e.extend(i,l),{format:i}):l["text-indent"]&&i["text-align"]?(delete l["text-indent"],delete l["text-align"],e.extend(i,l),{format:i}):(e.extend(l,i),{format:l})},_updateHashCodeClass:function(e,t){var i,r,l=this.XLObj,n={},s=l._formatRegx,o=l._borderRegx;t&&(i=t.indexOf("e-format")>-1,r=t.indexOf("e-border")>-1,i&&(n.format=t.match(s)[0]),r&&(n.border=t.match(o)[0]),(i||r)&&l.XLEdit._updateDataContainer({rowIndex:e.rowIndex,colIndex:e.colIndex},{dataObj:n}))},_updateFormatClass:function(e,t,i){t&&(t.indexOf("e-format")>-1||t.indexOf("e-border")>-1)&&this.XLObj.XLEdit._updateDataContainer(e,{dataObj:i?{border:t}:{format:t}})},_applyBorderCss:function(e,t,i){var r=this._borderPosition,l=r[0],n=r[1],s=r[2],o=r[3],a=t[0],d=t[1],h=t[2],c=t[3];l in e&&(a?this._updateBorder([a-1,d,a-1,c],e,s,!0,i):this._updateBorderObj([a,d,a,c],e,l)),n in e&&this._updateBorder([a,c,h,c],e,n,"",i),s in e&&this._updateBorder([h,d,h,c],e,s,"",i),o in e&&(d?this._updateBorder([a,d-1,h,d-1],e,n,!0,i):this._updateBorderObj([a,d,h,d],e,o))},_applyAllBorderCss:function(e,t,i){var r=this._borderPosition[1],l=this._borderPosition[2],n=t[0],s=t[1],o=t[2],a=t[3];this._updateBorder(t,e,r+" "+l,"",i),n&&this._updateBorder([n-1,s,n-1,a],e,l,!0,i),s&&this._updateBorder([n,s-1,o,s-1],e,r,!0,i)},_updateBorderObj:function(e,t,i){for(var r,l,n,s,o=e[0],a=e[2];o<=a;){for(r=e[1],l=e[3];r<=l;)s={rowIndex:o,colIndex:r},n=this._extendBorderObj(s,this._parseBorder(t,i).border,this._isFAT),this.XLObj.XLEdit._updateDataContainer(s,{dataObj:this._isFAT?{tborders:n}:{borders:n}}),r++;o++}},_updateBorder:function(i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v=!1,w=!1,I=this._borderPosition,y=i[0],T=i[2],L=r.isGridBorder,R=this.XLObj,O=R.getActiveSheetIndex(),F=R.getSheet(O),E=R.getRangeData({range:i,property:["merge","isMHide","mergeIdx"]}),D=0;for(delete r.isGridBorder;y<=T;){for(o=i[1],a=i[3];o<=a;){if(g={rowIndex:y,colIndex:o},d=y,h=o,n?((w=l===I[2])?d++:h++,f=this._parseBorder(r,w?I[0]:I[3]).border):f=this._parseBorder(r,l).border,L?n||(b=this._extendBorderObj(g,r,this._isFAT),v=!0):n?(p={rowIndex:d,colIndex:h},b=this._extendBorderObj(p,f,this._isFAT),R.XLEdit._updateDataContainer(p,{dataObj:this._isFAT?{tborders:b}:{borders:b},skipCell:r.skipCell})):(b=this._extendBorderObj(g,this._parseBorder(r,l).border,this._isFAT),v=!0),v&&R.XLEdit._updateDataContainer(g,{dataObj:this._isFAT?{tborders:b}:{borders:b},skipCell:r.skipCell}),!n||!R.hasSpan(g)){if(c=g.colIndex,l===I[1]&&n&&c)for(;c&&R.XLEdit.getPropertyValue(0,c,"isCHide");)c--;if(u=g.rowIndex,l===I[2]&&n&&u)for(;u&&R.XLEdit.getPropertyValue(u,0,"isRHide");)u--;S=(S=R.XLEdit.getPropertyValue(u,c,"border"))?this.getBorderFromHashCode(S):R.XLEdit.getPropertyValue(u,c,"borders")||{},n?(b={},I[1]in S&&(b[I[3]]=S[I[1]]),I[2]in S&&(b[I[0]]=S[I[2]]),f=this._isFAT?e.extend(f,b):e.extend(b,f)):f=this._isFAT?e.extend(f,S):e.extend(S,f),C=this._parseBorder(f,I[1]+" "+I[2],n),_=this._getBorderHashCode(C.border),this._createFormatClass(C,_),E[D].isMHide&&this._updateFormatClass({rowIndex:E[D].mergeIdx.rowIndex,colIndex:E[D].mergeIdx.colIndex},_,!0),this._updateFormatClass({rowIndex:u,colIndex:c},_,!0),(R.getObjectKeys(C.border).indexOf("bottom")>-1&&C.border.bottom.indexOf("double")>-1||!t.isNullOrUndefined(C["border-bottom"])&&C["border-bottom"].indexOf("double")>-1)&&m!=u&&((x=Math.round(R._detailsFromGlobalSpan(u,c,"height",R.XLEdit.getPropertyValue(u,c,"value2"),F.columnsWidthCollection[c])))>=F.rowsHeightCollection[u]&&(R._isUndoRedo||F._isImported&&!F._isLoaded||s.prevHeight.push([u,F.rowsHeightCollection[u]]),R._dupDetails=!0,R.XLResize.setRowHeight(u,x+3),R._dupDetails=!1,m=u,F.rowsHeightCollection[u]=x+3,R._isUndoRedo||F._isImported&&!F._isLoaded||s.newHeight.push([u,x+3])))}o++,D++}y++}},_extendBorderObj:function(t,i,r){var l=this.XLObj.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,r?"tborders":"borders")||{};return e.extend(l,i),l},_getBorderHashCode:function(e,t){var i="",r="1N1N6N",l=this._borderPosition,n=l[0],s=l[1],o=l[2],a=l[3];return i=s in e?this._splitBorderCode(e[s]):r,i+=o in e?this._splitBorderCode(e[o]):r,t&&(i+=n in e?this._splitBorderCode(e[n]):r,i+=a in e?this._splitBorderCode(e[a]):r),"e-border"+i},_parseBorder:function(e,t,i){var r,l,n,s,o={border:{}},a=this._borderPosition;for(r=(t=t.split(" ")).length;r--;)n=l=t[r],i&&(n=l===a[1]?a[3]:a[0]),(s=e[n])&&(o.border[l]=s);return o},_refreshTableRowCol:function(e){var t=this.XLObj,i=t.getActiveSheetIndex(),r=t.getSheet(i).tableManager[e.tid];r&&(e.isInsertBefore?"row"===e.pos?(r.range[0]+=e.cnt,r.range[2]+=e.cnt):(r.range[1]+=e.cnt,r.range[3]+=e.cnt):("row"===e.pos?r.range[2]=r.range[2]+e.cnt:r.range[3]=r.range[3]+e.cnt,t._dupDetails=!0,t.XLFormat._createTable(e.tid,{format:r.format}),this._updateTableFormula("updateRange",r,i),t._dupDetails=!1))},_refreshHiddenBorder:function(e,t,i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I=this.XLObj.XLEdit,y=this.XLObj.getSheet().usedRange;if(i?(p="bottom",f="top",m="isRHide",y=y.colIndex):(p="right",f="left",m="isCHide",y=y.rowIndex),r){for(c=e,u=t;u++&&(o=i?u:0,a=i?0:u,I.getPropertyValue(o,a,m)););for(;c&&(o=i?c:0,a=i?0:c,I.getPropertyValue(o,a,m));)c--;for(l=0;l<=y;l++)i?(o=c,n=d=e,s=a=h=l):(a=c,n=o=d=l,s=h=e),I.getPropertyValue(n,s,"isMHide")&&(s=(n=I.getPropertyValue(n,s,"mergeIdx")).colIndex,n=n.rowIndex),b=I.getPropertyValue(o,a,"borders"),C=I.getPropertyValue(n,s,"borders"),S=I.getPropertyValue(o,a,"tborders"),x=I.getPropertyValue(d,h,"tborders"),(!b||b&&!b[p])&&(C&&C[f]||(!S||S&&!S[p])&&x&&x[f])&&(g=I.getPropertyValue(o,a,"border"),delete(_=this.getBorderFromHashCode(g))[p],S&&S[p]&&(_[p]=S[p]),_.bottom||_.right?(g=this._getBorderHashCode(_),I._updateDataContainer({rowIndex:o,colIndex:a},{dataObj:{border:g}})):I._clearDataContainer({cellIdx:{rowIndex:o,colIndex:a},property:["border"]})),i?(h=c,n=o=u,s=a=d=l):(d=c,s=a=u,n=o=h=l),I.getPropertyValue(n,s,"isMHide")&&(s=(n=I.getPropertyValue(n,s,"mergeIdx")).colIndex,n=n.rowIndex),v=I.getPropertyValue(n,s,"borders"),w=I.getPropertyValue(o,a,"tborders"),(!b||b&&!b[p])&&(v&&v[f]||(!S||S&&!S[p])&&w&&w[f])&&(_={},(b||I.getPropertyValue(h,d,"border"))&&(g=I.getPropertyValue(h,d,"border"),_=this.getBorderFromHashCode(g)),_[p]=v&&v[f]?v[f]:w[f],g=this._getBorderHashCode(_),I._updateDataContainer({rowIndex:h,colIndex:d},{dataObj:{border:g}}))}else{if(o=i?e-1:0,a=i?0:e-1,I.getPropertyValue(o,a,m)){for(c=e-1;c&&(o=i?c:0,a=i?0:c,I.getPropertyValue(o,a,m));)c--;for(l=0;l<=y;l++)i?(o=c,s=a=h=l,n=d=e-1):(a=c,n=o=d=l,s=h=e-1),I.getPropertyValue(n,s,"isMHide")&&(s=(n=I.getPropertyValue(n,s,"mergeIdx")).colIndex,n=n.rowIndex),b=I.getPropertyValue(o,a,"borders"),C=I.getPropertyValue(n,s,"borders"),S=I.getPropertyValue(o,a,"tborders"),x=I.getPropertyValue(d,h,"tborders"),_=this.getBorderFromHashCode(I.getPropertyValue(o,a,"border")),(!b||b&&!b[p]||b&&b[p]!==(_&&_[p]))&&(!S||S&&!S[p]||S&&S[p]&&(I.getPropertyValue(o,a,"border")!==this._getBorderHashCode(S)||C&&C[f]))&&(C&&C[f]||_&&_[p]&&(!C||C&&!C[f])||x&&x[f])&&(o=i?n:s,a=i?s:n,this._showHiddenBorder(c,o,a,l,i));for(l=0;l<=y;l++)i?(o=n-1,n=d=e,s=h=a=l):(a=s-1,n=o=d=l,s=h=e),I.getPropertyValue(n,s,"isMHide")&&(s=(n=I.getPropertyValue(n,s,"mergeIdx")).colIndex,n=n.rowIndex),C=I.getPropertyValue(o,a,"borders"),v=I.getPropertyValue(n,s,"borders"),x=I.getPropertyValue(o,a,"tborders"),w=I.getPropertyValue(d,h,"tborders"),_=this.getBorderFromHashCode(I.getPropertyValue(o,a,"border")),(!C||C&&!C[p]||C&&C[p]!==(_&&_[p]))&&(!x||x&&!x[p]||x&&x[p]&&I.getPropertyValue(d,h,"border")!==this._getBorderHashCode(x))&&(v&&v[f]||_&&_[p]&&(!v||v&&!v[f])||w&&w[f])&&(o=i?n:s,a=i?s:n,this._showHiddenBorder(e-1,o,a,l,i))}for(;e<t;e++)if(u=e+1,i?(o=u,a=s=0,n=e):(a=u,o=n=0,s=e),I.getPropertyValue(o,a,m)||I.getPropertyValue(n,s,m))for(l=0;l<=y;l++)i?(n=u,s=a=l,o=e):(n=o=l,s=u,a=e),I.getPropertyValue(n,s,"isMHide")&&(s=(n=I.getPropertyValue(n,s,"mergeIdx")).colIndex,n=n.rowIndex),C=I.getPropertyValue(o,a,"borders"),v=I.getPropertyValue(n,s,"borders"),x=I.getPropertyValue(o,a,"tborders"),w=I.getPropertyValue(n,s,"tborders"),_=this.getBorderFromHashCode(I.getPropertyValue(o,a,"border")),(!C||C&&!C[p]||C&&C[p]!==(_&&_[p]))&&(!x||x&&!x[p]||x&&x[p]&&(I.getPropertyValue(o,a,"border")!==this._getBorderHashCode(x)||v&&v[f]))&&(v&&v[f]||_&&_[p]&&(!v||v&&!v[f])||w&&w[f])&&(n=i?s:n,this._showHiddenBorder(e,u,n,l,i))}},_showHiddenBorder:function(e,t,i,r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=this.XLObj.XLEdit;l?(o=t,h=r,s=a=i,n=d=e,c="bottom",b="top"):(a=t,d=r,n=o=i,s=h=e,c="right",b="left"),u=C.getPropertyValue(n,s,"border"),(g=this.getBorderFromHashCode(u))[c]&&delete g[c],f=C.getPropertyValue(n,s,"tborders"),m=C.getPropertyValue(o,a,"borders"),_=C.getPropertyValue(o,a,"tborders"),(p=C.getPropertyValue(d,h,"borders"))&&p[c]?g[c]=p[c]:m&&m[b]?g[c]=m[b]:(f&&f[c]||_&&_[b])&&(g[c]=f&&f[c]?f[c]:_[b]),g.bottom||g.right?(u=this._getBorderHashCode(g),C._updateDataContainer({rowIndex:d,colIndex:h},{dataObj:{border:u}})):C._clearDataContainer({cellIdx:{rowIndex:n,colIndex:s},property:["border"]})},_resizeFormatTableMenu:function(){var t=this.XLObj,i=document.getElementById(t._id+"_formatastable");t._tabMode||t._phoneMode?(e("#"+t._id+"_Ribbon").append(e("#"+t._id+"_formatastable").parent()),t._removeClass(i,"e-formatastable"),t.addClass(i,"e-formatastable-adaptive"),i.style.height=t._dlgHeight+"px"):(t._removeClass(i,"e-formatastable-adaptive"),t.addClass(i,"e-formatastable"))},_resizeStyleMenu:function(){var t=this.XLObj,i=document.getElementById(t._id+"_cellstyles");t._tabMode||t._phoneMode?(e("#"+t._id+"_Ribbon").append(e("#"+t._id+"_cellstyles").parent()),t._removeClass(i,"e-cellstyles"),t.addClass(i,"e-cellstyles-adaptive"),i.style.height=t._dlgHeight+"px"):(t._removeClass(i,"e-cellstyles-adaptive"),t.addClass(i,"e-cellstyles"))},_resizeBorderMenu:function(t){var i=this.XLObj,r=i.element.find(".e-bordercontainer");i._phoneMode&&(e("#"+i._id+"_Ribbon").append(e("#"+i._id+"_Ribbon_Border").parent()),r.length?r.show():(this._createBorderDiv(),i.element.find(".e-bordercontainer").show()),i.addClass(r[0],"e-border e-adaptive"),t.cancel=!0,e("#"+i._id+"_Ribbon_Home_Font_Border").ejSplitButton("instance").contstatus=!0)},_customStyleDlg:function(){var i,r,l,n,s,o,a=this.XLObj;i=t.buildTag("div","","",{id:a._id+"_CustomCellDialog"}),o=t.buildTag("div.e-dlg-btnfields");var d=t.buildTag("div.e-dlg-btnfields"),h=t.buildTag("div.e-dlg-btnctnr"),c=t.buildTag("div.e-dlg-btnctnr");r="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields '><td style='width: 22%;'><label>"+a._getLocStr("StyleName")+":</label></td><td style= 'padding-left: 10px;'><input id ='"+a._id+"_StyleName' type ='text' value = 'Style' class = 'ejinputtext'/></td></tr></table></div>",i.append(r),l=t.buildTag("input","","",{id:a._id+"_CustomCellDlgOkBtn",type:"submit"}),n=t.buildTag("input","","",{id:a._id+"_CustomCellDlgFrmtBtn",type:"submit"}),s=t.buildTag("input","","",{id:a._id+"_CustomCellDlgCanBtn"}),l.ejButton({text:a._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgOK,this),enabled:!0,cssClass:"e-ss-okbtn"}),n.ejButton({text:a._getLocStr("Format")+"...",showRoundedCorner:!0,width:60,click:t.proxy(this._dlgFrmt,this),enabled:!0,cssClass:"e-ss-okbtn"}),s.ejButton({text:a._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,a),showRoundedCorner:!0,width:60}),i.append(d.append(h.append(n))),o.append(c.append(l,s)),i.append(o),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:a._getLocStr("Style"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+a._id+"-dlg",close:t.proxy(this._dlgCancel,a),open:t.proxy(function(){var t=e("#"+a._id+"_StyleName");t.focus().setInputPos(t.val().length).select()})})},_dlgOK:function(){var t=this.XLObj,i=t.XLFormat,r=t.XLCMenu,l=e("#"+t._id+"_formatdlg_format_dataMnger").data();r?i._styleDlgClick?r._modifyClick?this.modifyCustomStyle(r._oldCustomName,e.extend(!0,{},l),e("#"+t._id+"_StyleName").val()):this.addNewCustomStyle(e("#"+t._id+"_StyleName").val(),e.extend(!0,{},l)):r._modifyClick?this.modifyCustomStyle(r._oldCustomName,t._dataContainer.customCellStyle[r._oldCustomName],e("#"+t._id+"_StyleName").val()):this.addNewCustomStyle(e("#"+t._id+"_StyleName").val(),{style:{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"},NumFormat:{type:"general"}}):i._styleDlgClick?this.addNewCustomStyle(e("#"+t._id+"_StyleName").val(),e.extend(!0,{},l)):this.addNewCustomStyle(e("#"+t._id+"_StyleName").val(),{style:{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"},NumFormat:{type:"general"}}),e("#"+t._id+"_CustomCellDialog").ejDialog("close"),i._styleDlgClick=!1,r&&(r._modifyClick=!1,r._oldCustomName=r._target="")},_dlgFrmt:function(){var e=this.XLObj;e.XLFormat._styleDlgClick=!0,e._showDialog(e._id+"_FormatCells")},_styleDlgOpen:function(){var t=this.XLObj,i=t.model.enableContextMenu?t.XLCMenu._target:"";e("#"+t._id+"_StyleName").val(i),e("#"+t._id+"_CustomCellDialog").ejDialog("open")},_dlgCancel:function(){var t=this.XLCMenu;e("#"+this._id+"_CustomCellDialog").ejDialog("close"),this.XLFormat._styleDlgClick=!1,t&&(t._modifyClick=!1,t._oldCustomName=t._target="")},addNewCustomStyle:function(i,r){var l,n,s=this.XLObj,o=s._dataContainer;if(!s.isImport&&!s.model.isImport&&this._isHeaderAdded&&s.getObjectKeys(o.customCellStyle).indexOf(i)>-1)s._showAlertDlg("Alert","cellStyleAlert","cellStyleAlert",200);else{var a=this._createFormatClass(r.style,"",!0),d=s.XLCMenu,h=e("#"+s._id+"_cellstyles"),c=t.buildTag("div.e-cellstylecell e-customcellstyle "+a,i,"",{title:i});parseInt(r.style["font-size"])>11&&c.css({"font-size":"11pt"}),this._isHeaderAdded?h.children().eq(1).append(c):(l=t.buildTag("div.e-cellstylecontent"),n=t.buildTag("div.e-cellstyleheader","Custom"),l.append(c),h.prepend(l).prepend(n),h.children().eq(0).append(e("#"+s._id+"_cellstyles_back")),this._isHeaderAdded=!0,d&&d._createMenu(t.buildTag("ul .e-spreadsheet e-"+d._uniqueClass," ",{display:"none"},{id:s._id+"_contextMenuCellStyles"}),s.XLCMenu._cellStylesMenuData,"  .e-cellstylecontent")),t.isNullOrUndefined(o.customCellStyle[i])&&(o.customCellStyle[i]=r),d&&(e("#"+s._id+"_contextMenuCellStyles").data("ejMenu").model.contextMenuTarget=" .e-customcellstyle")}},modifyCustomStyle:function(t,i,r){var l,n,s=this.XLObj,o=s._dataContainer;this._isHeaderAdded&&-1===s.getObjectKeys(o.customCellStyle).indexOf(t)?s._showAlertDlg("Alert","modifyCellStyleAlert","modifyCellStyleAlert",200):this._isHeaderAdded&&s.getObjectKeys(o.customCellStyle).indexOf(r)>-1&&t!=r||(e.extend(o.customCellStyle[t],i),l=this._createFormatClass(o.customCellStyle[t].style,"",!0),n=e("#"+s._id+"_cellstyles").children().eq(1).find('div[title="'+t+'"]'),s._removeClass(n[0],n[0].classList[2]),s.addClass(n[0],l),t!=r&&(o.customCellStyle[r]=o.customCellStyle[t],delete o.customCellStyle[t],n.attr("title",r),n.html(r)))},deleteCustomStyle:function(t){var i,r=this.XLObj,l=r._dataContainer;this._isHeaderAdded&&-1===r.getObjectKeys(l.customCellStyle).indexOf(t)?r._showAlertDlg("Alert","modifyCellStyleAlert","",200):((i=e("#"+r._id+"_cellstyles").children()).eq(1).find('div[title="'+t+'"]').remove(),delete l.customCellStyle[t],0===i.eq(1).children().length&&(i[0].remove(),i[1].remove(),e("#"+r._id+"_cellstyles").children().eq(0).append("<span id ='"+r._id+"_cellstyles_back' class = 'e-cellstyles-back e-icon e-ss-leftarrow'/>"),this._isHeaderAdded=!1))},applyCustomCellStyle:function(t,i){var r,l=this.XLObj,n=l._dataContainer;this._isHeaderAdded&&-1===l.getObjectKeys(n.customCellStyle).indexOf(t)?l._showAlertDlg("Alert","modifyCellStyleAlert","modifyCellStyleAlert",200):(r={style:n.customCellStyle[t].style},e.extend(r,n.customCellStyle[t].NumFormat),this.format(r,i))},_createBorderDiv:function(){for(var i=this.XLObj,r="<div class='e-ss-bdr-header'><span id ='"+i._id+"_border_back' class = 'e-border-back e-icon e-ss-leftarrow'/></div><div class='e-ss-border-content'>",l="",n=t.buildTag("div#"+i._id+"_bordercontainer.e-bordercontainer",{},{display:"none",height:i._responsiveHeight-2}),s=i.XLRibbon._borderMenuData,o=0;o<13;o++)l+="<div class = 'e-bordercell' id="+s[o].id+">"+i._renderDIV("e-ss-border "+s[o].sprite+" e-ss-menu","",s[o].text)+"</div>";r+=l+"</div>",n.append(e(r)),e("#"+i._id+"_Ribbon").append(n),i._on(e("#"+i._id+"_bordercontainer"),"click",i._borderSelectionClick)},_updateTableFormula:function(e,t,i,r){var l,n,s=this.XLObj,o=s.getCalcEngine(),a=!1,d=!1,h=s.XLEdit;if("updateRange"===e&&(a=!0),"rename"===e&&(d=!0),"addRange"===e||a){var c,u,g,p=t.range,m=t.name,_={};for(c=0,g=(u=s.getRangeData({range:[p[0],p[1],p[0],p[3]],property:["value2"],sheetIdx:i})).length;c<g;c++)a&&o.removeNamedRange(m+"["+u[c].value2+"]"),_[u[c].value2]=h._parseSheetRef(s._getDollarAlphaRange([p[0]+1,p[1]+c,p[2],p[1]+c])),o.addNamedRange(m+"["+u[c].value2+"]",_[u[c].value2]);a&&(o.removeNamedRange(m+"[#All]"),o.removeNamedRange(m+"[#Data]"),o.removeNamedRange(m+"[#Headers]")),t.totalRow&&(o.removeNamedRange(m+"[#Rows]"),_["#Rows"]=h._parseSheetRef(s._getDollarAlphaRange([p[2],p[1],p[2],p[3]])),o.addNamedRange(m+"[#Rows]",_["#Rows"])),_["#All"]=h._parseSheetRef(s._getDollarAlphaRange(p)),o.addNamedRange(m+"[#All]",_["#All"]),_["#Data"]=h._parseSheetRef(s._getDollarAlphaRange([p[0]+1,p[1],p[2],p[3]])),o.addNamedRange(m+"[#Data]",_["#Data"]),_["#Headers"]=h._parseSheetRef(s._getDollarAlphaRange([p[0],p[1],p[0],p[3]])),o.addNamedRange(m+"[#Headers]",_["#Headers"]),s._tableRangesFormula[t.name]=_}else if("totalRow"===e)o.namedRangeValues.containsKey(t.name+"[#Rows]")&&o.removeNamedRange(t.name+"[#Rows]"),t.totalRow?(s._tableRangesFormula[t.name]["#Rows"]=h._parseSheetRef(s._getDollarAlphaRange([t.range[2],t.range[1],t.range[2],t.range[3]])),o.addNamedRange(t.name+"[#Rows]",s._tableRangesFormula[t.name]["#Rows"])):s._tableRangesFormula[t.name]["#Rows"]&&delete s._tableRangesFormula[t.name]["#Rows"],s._tableRangesFormula[t.name]["#All"]=h._parseSheetRef(s._getDollarAlphaRange(t.range)),o.removeNamedRange(t.name+"[#All]"),o.addNamedRange(t.name+"[#All]",s._tableRangesFormula[t.name]["#All"]);else if("removeTable"===e||d){for(d||(r=t.name),n=s.getObjectKeys(s._tableRangesFormula[r]),m=t.name,c=0,l=n.length;c<l;c++)o.removeNamedRange(r+"["+n[c]+"]"),d&&o.addNamedRange(m+"["+n[c]+"]",s._tableRangesFormula[r][n[c]]);d&&(s._tableFormulaCollection[m]=s._tableFormulaCollection[r]),delete s._tableRangesFormula[r],delete s._tableFormulaCollection[r]}},_updateTableColName:function(e,t,i,r,l,n){var s=this.XLObj,o=s._getTableID(n),a=s.getSheet(l).tableManager,d=a[o].range,h=r.toUpperCase();if(d[0]===e&&i.length&&i.toUpperCase()!==h){for(var c,u,g=s.getCalcEngine(),p=a[o].name,m=s.getRangeData({range:[d[0],d[1],d[0],d[3]],property:["value2"],sheetIdx:l}),_=2,f=[],b=0,C=m.length;b<C;b++)f[b]=m[b].value2?m[b].value2.toUpperCase():"",f[b]===h&&(r+=_,_++);for(;f.indexOf(r.toUpperCase())>-1;)u=parseInt(r.slice(-1)),r=r.substring(0,r.length-1),r=isNaN(u)?r+_:u++&&r+u;for(g.removeNamedRange(p+"["+i+"]"),g.addNamedRange(p+"["+r+"]",s._tableRangesFormula[p][i]),s._tableRangesFormula[p][r]=s._tableRangesFormula[p][i],delete s._tableRangesFormula[p][i],c=s.getObjectKeys(s._tableRangesFormula[p]),s._tableFormulaCollection[p]=[],b=0,C=c.length;b<C;b++)s._tableFormulaCollection[p].push({text:"["+c[b]+"]",display:c[b]})}return r}},t.Spreadsheet.FontFamily={"angsana new":"11N",arial:"21N","arial black":"31N",batang:"41N","book antiqua":"51N","browallia new":"61N",calibri:"71N",cambria:"81N",candara:"91N",century:"10","comic sans ms":"11",consolas:"12",constantia:"13",corbel:"14","cordia new":"15",courier:"16","courier new":"17",dilleniaupc:"18",dotum:"19",fangsong:"20",garamond:"21",georgia:"22",gulim:"23",gungsuh:"24",kaiti:"25",jasmineupc:"26","malgun gothic":"27",mangal:"28",meiryo:"29","microsoft jhenghei":"30","microsoft yahei":"31",mingliu:"32",mingliu_hkscs:"33","ms gothic":"34","ms mincho":"35","ms pgothic":"36","ms pmincho":"37",pmingliu:"38","pmingliu-extb":"39",simhei:"40",simsun:"41","simsun-extb":"42",tahoma:"43",times:"44","times new roman":"45","trebuchet ms":"46",verdana:"47","yu gothic":"48","yu mincho":"49"},t.Spreadsheet.FontStyle={normal:"1",italic:"2",oblique:"3"},t.Spreadsheet.TextAlign={left:"1",right:"2",center:"3",justify:"4"},t.Spreadsheet.VerticalAlign={top:"1",middle:"2",bottom:"3"},t.Spreadsheet.TextDecoration={none:"1",underline:"2",overline:"3","line-through":"4","line-through underline":"5"},t.Spreadsheet.FontWeight={normal:"1",bold:"2"},t.Spreadsheet.BorderStyle={solid:"1",dashed:"2",dotted:"3",double:"4"},t.Spreadsheet.CellFormat={number:"{0:N2}",currency:"{0:C2}",accounting:"{0:C2}",percentage:"{0:P2}",shortdate:"{0:M/d/yyyy}",longdate:"{0:dddd, MMMM dd, yyyy}",time:"{0:h:mm:ss tt}",scientific:"{0:N2}"}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.cellType=function(e){this.XLObj=e,this._isIntrnlUpdate=!1},t.spreadsheetFeatures.cellType.prototype={_renderControls:function(i,r,l,n,s,o){var a,d,h,c,u,g;if(n&&(!this.XLObj.model.isGridMode||!(l>1||n.dataSourceSheetIndex>1))){var p,m,_,f,b,C,S=this.XLObj,x=S._browserDetails.name,v=S._getSheetIndex(l),w=S.getCell(i,r,v),I=S.getSheet(v),y=S.XLEdit.getPropertyValue(i,r,"value2",v),T=n.type,L=S._generateHeaderText(r+1),R=S._dataContainer.sheetCellType,O=S._getRowHeight(i,l),F=S.XLEdit.getPropertyValue(i,r,"cellType"),E=F>-1?F:S.getObjectLength(R);switch(S._textClip(i,r,"delete","",!0),S._textClip(i,r,"add",""),w&&(m=w[0]),S.addClass(m,"e-cellreadonly"),S._dupDetails||(F?n.isChecked=R[E].isChecked:I.cellTypes.push({range:S._getAlphaRange(l,i,r,i,r),settings:e.extend(!0,{},n)})),T){case"Button":p=S._id+"_btn_"+v+L+(i+1),S.XLFormat._writeCssRules("e-btncls"+i+r,"border: 0px; vertical-align: middle;padding: 0px;color:"+n.color+";background:"+n.backgroundColor+";",!0,!0),m&&(m.innerHTML="<button id ="+p+' class = "e-btncls'+i+r+'"></button>'),m&&("mozilla"===x||"msie"===x)&&(S.addClass(m,"e-btnhgt"),S.addClass(w.parents(".e-table")[0],"e-btnhgt")),o||(_={type:T,id:p,text:n.text||y||n.type+L+(i+1),color:n.color||"","background-color":n.backgroundColor||""},R[E]=_,S.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{cellType:E},sheetIdx:v})),e("#"+p).ejButton({type:"button",width:"100%",height:"100%",text:n.text||y||n.type+L+(i+1),create:e.proxy(this._onButtonCreate),click:e.proxy(this.onButtonClick),cssClass:n.class||""});break;case"CheckBox":p=S._id+"_chk_"+v+L+(i+1),m&&(m.innerHTML="<input id ="+p+' style = "" />'),o||(_={type:T,id:p,isChecked:s||y&&y.toLowerCase()||n.isChecked||!1},R[E]=_,(f=S.XLEdit._parseValue(_.isChecked,{rowIndex:i,colIndex:r})).cellType=E,S.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:f,sheetIdx:v}),m&&(m.lastChild.textContent="")),e("#"+p).ejCheckBox({size:"small",change:e.proxy(this.onActiveStateChange),checked:_?"true"==_.isChecked.toString():n.isChecked,cssClass:n.class||""});break;case"DropDownList":if(C=n.dataSourceSheetIndex||v,p=S._id+"_drpdwn_"+v+L+(i+1),b=n.dataSourceRange&&S.getRangeIndices(n.dataSourceRange),S.element.find("#"+p).length>0)return;if(m&&(m.innerHTML="<input id ="+p+" />"),C===v||S.getSheet(C)._isLoaded||S._initSheet(C),S.isUndefined(n.selectedIndex)&&y)for(a=n.dataSource||S.getRangeData({range:b,sheetIdx:C}),h=(n.field=n.field||{text:"value2"}).text,d=a.length;--d>=0;)if(a[d][h]==y){n.selectedIndex=d;break}if(o||(_={type:T,id:p,text:y,style:"",dataSource:n.dataSource||"",dataSourceRange:n.dataSourceRange||"",selectedIndex:n.selectedIndex>-1?n.selectedIndex:-1,dataSourceSheetIndex:C},R[E]=_,S.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{cellType:E},sheetIdx:v})),n.dataSourceRange)if(c=S._getSelectedRange({rowIndex:b[0],colIndex:b[1]},{rowIndex:b[2],colIndex:b[3]}),0===(u=S.XLEdit._getPropWithCellIdx([c[0].rowIndex,c[0].colIndex,c[c.length-1].rowIndex,c[c.length-1].colIndex],"ddlRange",C)).length)S.updateUniqueData({ddlRange:[{rowIndex:i,colIndex:r,sheetIndex:v}]},[c[0].rowIndex,c[0].colIndex,c[c.length-1].rowIndex,c[c.length-1].colIndex],"",C);else for(g=0;g<c.length;g++)(u=S.XLEdit.getPropertyValue(c[g].rowIndex,c[g].colIndex,"ddlRange",C))?(u.push({rowIndex:i,colIndex:r}),S.XLEdit._updateDataContainer({rowIndex:c[g].rowIndex,colIndex:c[g].colIndex},{dataObj:{ddlRange:u},sheetIdx:C})):S.XLEdit._updateDataContainer({rowIndex:c[g].rowIndex,colIndex:c[g].colIndex},{dataObj:{ddlRange:[{rowIndex:i,colIndex:r}]},sheetIdx:C});e("#"+p).ejDropDownList({loadOnDemand:!0,width:"100%",height:S.model.rowHeight-1,change:e.proxy(this.onActiveValueChange),dataSource:n.dataSource||S.getRangeData({range:b,sheetIdx:C}),fields:n.field?n.field:{text:"value2"},watermarkText:n.watermarkText||"Select an option",cssClass:n.class||"",selectedIndex:n.selectedIndex>-1?n.selectedIndex:-1,beforePopupShown:e.proxy(this._onBeforePopupOpen)});break;case"DatePicker":p=S._id+"_dp_"+v+L+(i+1),m&&(m.innerHTML="<input id ="+p+' style = "height:'+(O-1)+'px" />'),o||(_={type:T,id:p,text:y,style:""},R[E]=_,S.XLEdit._updateDataContainer({rowIndex:i,colIndex:r},{dataObj:{cellType:E},sheetIdx:v})),e("#"+p).ejDatePicker({width:"100%",height:S.model.rowHeight-1,value:y&&t.parseDate(y)||n.value||new Date,create:e.proxy(this._onDateCreate),change:e.proxy(this.onDateChange),cssClass:n.class||"",locale:S.model.locale})}}},addCellTypes:function(e,t,i){var r=this.XLObj;r.model.allowCellType&&(r.model.isReadOnly||(r._isPublic=!0,Array.isArray(e)&&(e=r._getAlphaRange(i,e[0],e[1],e[2],e[3])),this._rangeCellTypes([{range:e,settings:t}],i,!0),r._isPublic=!1))},_rangeCellTypes:function(i,r,l){var n,s,o,a,d,h,c,u,g,p,m,_,f,b;if(i){var C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P=this.XLObj,k=P._browserDetails.name,j=P._getSheetIndex(r),M=P._dataContainer,V=P.getSheet(j),B=!1;for((l||!V._isLoaded)&&(JSON.stringify(V.cellTypes)!=JSON.stringify(i)&&t.merge(V.cellTypes,i),i=V.cellTypes),n=0,s=V.cellTypes.length;n<s;n++)if(F=P.getRangeIndices(i[n].range),D=(y=i[n].settings).isChecked,1===(I=P._getSelectedRange({rowIndex:F[0],colIndex:F[1]},{rowIndex:F[2],colIndex:F[3]})).length)P._dupDetails=!0,(P._isRowViewable(j,I[0].rowIndex)||!V._isLoaded)&&this._renderControls(I[0].rowIndex,I[0].colIndex,j,y,D),P._dupDetails=!1;else{for(v=y.dataSourceSheetIndex||j,o=0,a=I.length;o<a;o++)if(N=I[o].rowIndex,A=I[o].colIndex,B=!1,P._isRowViewable(j,N)&&(B=!0),B||!V._isLoaded){switch(P._textClip(N,A,"delete","",!0),P._textClip(N,A,"add"),E=P.getObjectLength(M.sheetCellType),T=B?P.getCell(N,A,j)[0]:null,C=P.XLEdit.getPropertyValue(N,A,"value2",j),T&&(T.innerHTML=""),P._hasClass(T,"e-cellreadonly")||P.addClass(T,"e-cellreadonly"),x=P._generateHeaderText(A+1),y.type){case"Button":if(L=P._id+"_btn"+n+"_"+j+x+(N+1),P.element.find("#"+L).length>0)return;P.XLFormat._writeCssRules("e-btncls"+N+A,"border: 0px; vertical-align: middle; padding: 0px;color:"+(y.color||"")+";background:"+(y.backgroundColor||"")+";",!0,!0),T&&(T.innerHTML="<button id ="+L+' type="button" class = "e-btncls'+N+A+'"></button>'),(T&&"mozilla"===k||"msie"===k)&&(P.addClass(T,"e-btnhgt"),P.addClass(T.parents(".e-table")[0],"e-btnhgt")),(l||!V._isLoaded)&&(w={type:y.type,id:L,text:y.text||C||y.type+P._generateHeaderText(I[o].colIndex+1)+(I[o].rowIndex+1),color:y.color||"","background-color":y.backgroundColor||""},S={cellType:E});break;case"CheckBox":if(L=P._id+"_chk"+n+"_"+j+x+(N+1),P.element.find("#"+L).length>0)return;T&&(T.innerHTML="<input id ="+L+" />"),w={type:y.type,id:L,isChecked:D||C||!1},(l||!V._isLoaded)&&(C&&-1===["false","true","yes","no"].indexOf(C.toLowerCase())&&(C=""),(S=P.XLEdit._parseValue(w.isChecked,{rowIndex:N,colIndex:A})).cellType=E),T&&(T.lastChild.textContent="");break;case"DropDownList":if(L=P._id+"_drpdwn"+n+"_"+j+x+(N+1),P.element.find("#"+L).length>0)return;if(T&&(T.innerHTML="<input id ="+L+" value = "+C+" />"),w={type:y.type,id:L,style:"",dataSource:y.dataSource||"",dataSourceRange:y.dataSourceRange||"",selectedIndex:y.selectedIndex>-1?y.selectedIndex:"",dataSourceSheetIndex:v},y.dataSource&&y.field&&(w.field=y.field),y.dataSourceRange&&(R=P.getRangeIndices(y.dataSourceRange)),l||!V._isLoaded){if(y.dataSourceRange)if(R=P.getRangeIndices(y.dataSourceRange),O=P._getSelectedRange({rowIndex:R[0],colIndex:R[1]},{rowIndex:R[2],colIndex:R[3]}),0===(d=P.XLEdit._getPropWithCellIdx([O[0].rowIndex,O[0].colIndex,O[O.length-1].rowIndex,O[O.length-1].colIndex],"ddlRange",v)).length)P.updateUniqueData({ddlRange:[{rowIndex:N,colIndex:A,sheetIndex:j}]},[O[0].rowIndex,O[0].colIndex,O[O.length-1].rowIndex,O[O.length-1].colIndex],"",v);else for(h=0;h<O.length;h++)(d=P.XLEdit.getPropertyValue(O[h].rowIndex,O[h].colIndex,"ddlRange",v))?(d.push({rowIndex:N,colIndex:A,sheetIndex:j}),P.XLEdit._updateDataContainer({rowIndex:O[h].rowIndex,colIndex:O[h].colIndex},{dataObj:{ddlRange:d},sheetIdx:v})):P.XLEdit._updateDataContainer({rowIndex:O[h].rowIndex,colIndex:O[h].colIndex},{dataObj:{ddlRange:[{rowIndex:N,colIndex:A,sheetIndex:j}]},sheetIdx:v});if(v===j||P.getSheet(v)._isLoaded||P._initSheet(v),P.isUndefined(y.selectedIndex)&&C)for(c=y.dataSource||P.getRangeData({range:R,sheetIdx:v}),g=(u=y.field||{text:"value2"}).text,y.field||(y.field=u),h=c.length;--h>=0;){if(c[h][g]==C){w.selectedIndex=h;break}0==h&&delete w.selectedIndex}}S={cellType:E};break;case"DatePicker":if(L=P._id+"_dp"+n+"_"+j+x+(N+1),P.element.find("#"+L).length>0)return;T&&(T.innerHTML="<input id ="+L+" value = "+C+' style = "height:'+(P._getRowHeight(N,j)-1)+'px" />'),(l||!V._isLoaded)&&(w={type:y.type,id:L,value:y.value||C&&t.parseDate(C)||new Date},S={cellType:E})}(l||!V._isLoaded||P._isInsdel)&&(M.sheetCellType[E]=w,P.XLEdit._updateDataContainer({rowIndex:N,colIndex:A},{dataObj:S,sheetIdx:j}))}switch(y.type){case"Button":e("[id^='"+P._id+"_btn"+n+"_"+j+"']").not("[id *= '_hidden']").ejButton({type:"button",width:"100%",height:"100%",text:C,create:e.proxy(this._onButtonCreate),click:e.proxy(this.onButtonClick),cssClass:i.class||""});break;case"CheckBox":e("input[id^='"+P._id+"_chk"+n+"_"+j+"']").not("[id *= '_hidden']").ejCheckBox({change:e.proxy(this.onActiveStateChange),cssClass:i.class||"",checked:D||!1});break;case"DropDownList":e("input[id^='"+P._id+"_drpdwn"+n+"_"+j+"']").not("[id *= '_hidden']").ejDropDownList({loadOnDemand:!0,width:"100%",height:P.model.rowHeight-1,change:e.proxy(this.onActiveValueChange),dataSource:y.dataSource||P.getRangeData({range:R,sheetIdx:v}),fields:y.field?y.field:{text:"value2"},watermarkText:y.watermarkText||"Select an option",cssClass:y.class||"",selectedIndex:y.selectedIndex>-1?y.selectedIndex:-1,beforePopupShown:e.proxy(this._onBeforePopupOpen)});break;case"DatePicker":e("input[id^='"+P._id+"_dp"+n+"_"+j+"']").not("[id *= '_hidden']").ejDatePicker({width:"100%",height:P.model.rowHeight-1,create:e.proxy(this._onDateCreate),change:e.proxy(this.onDateChange),cssClass:i.class||"",locale:P.model.locale})}}for(h=0,b=(_=P.getObjectKeys(V._refrshObj)).length;h<b;h++)for(p=0,m=(f=P.getObjectKeys(V._refrshObj[_[h]])).length;p<m;p++)this._isIntrnlUpdate=!0,"CheckBox"===V._refrshObj[_[h]][f[p]].type?e("#"+V._refrshObj[_[h]][f[p]].id).length&&e("#"+V._refrshObj[_[h]][f[p]].id).ejCheckBox("instance").option("checked",V._refrshObj[_[h]][f[p]].isChecked):"DropDownList"===V._refrshObj[_[h]][f[p]].type?e("#"+V._refrshObj[_[h]][f[p]].id).length&&e("#"+V._refrshObj[_[h]][f[p]].id).ejDropDownList("instance").option("selectedIndex",V._refrshObj[_[h]][f[p]].selectedIndex):"DatePicker"===V._refrshObj[_[h]][f[p]].type&&e("#"+V._refrshObj[_[h]][f[p]].id).length&&e("#"+V._refrshObj[_[h]][f[p]].id).ejDatePicker("instance").option("value",V._refrshObj[_[h]][f[p]].value),this._isIntrnlUpdate=!1}},removeCellTypes:function(e,t){var i,r,l,n,s=this.XLObj;if(!s.model.isReadOnly)for(t=s._getSheetIndex(t),l=s._getRangeArgs(e,"object"),i=0,r=(n=s.XLEdit._getPropWithCellIdx(l,"cellType",t)).length;i<r;i++)this._removeControls(n[i].rowIdx,n[i].colIdx,t)},_removeControls:function(e,t,i,r){var l,n,s,o,a=this.XLObj;i=a._getSheetIndex(i),n=a._dataContainer,s=a.getSheet(i),r||(delete n.sheetCellType[n.sheets[i][e][t].cellType],delete n.sheets[i][e][t].cellType,(o=this._rangeInColl(a._getAlphaRange(i,e,t,e,t),i))>-1&&s.cellTypes.splice(o,1)),a._isRowViewable(i,e)&&((l=a.getCell(e,t,i)[0]).innerHTML=a.XLEdit.getPropertyValue(e,t,"value2",i)||"",a._removeClass(l,"e-cellreadonly"))},onActiveValueChange:function(e){var i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet");if(!i.model.isReadOnly){var r=i._dataContainer,l=this.element.closest("td"),n=i.getActiveSheetIndex(),s=i.getSheet(n),o=i._getCellIdx(l[0]),a=o.rowIndex,d=o.colIndex,h=r.sheetCellType[r.sheets[n][a][d].cellType],c=h.dataSourceRange&&i.getRangeIndices(h.dataSourceRange);h.selectedIndex=e.itemId,"drpdwn"!=h.id.split("_")[1]&&(t.isNullOrUndefined(s._refrshObj[a])&&(s._refrshObj[a]={}),s._refrshObj[a][d]={rowIndex:a,colIndex:d,selectedIndex:e.itemId,type:"DropDownList",id:h.id}),i.XLEdit._updateDataContainer({rowIndex:a,colIndex:d},{dataObj:i.XLEdit._parseValue(e.text,{rowIndex:a,colIndex:d})}),c&&"number"===i.XLEdit.getPropertyValue(c[0]+e.itemId,c[1],"type")&&i.XLFormat.format({type:"number"},[a,d,a,d]),e.cellIndex=o,e.cellType="dropdownlist",i._trigger("cellSave",e),i.model.allowFormulaBar&&i.updateFormulaBar()}},onActiveStateChange:function(e){var i,r,l=this.element.closest(".e-spreadsheet").data("ejSpreadsheet");if(!l.model.isReadOnly&&!l.XLCellType._isIntrnlUpdate){var n,s,o,a=l._dataContainer,d=this.element.closest("td"),h=l.getActiveSheetIndex(),c=l.getSheet(h),u=l._getCellIdx(d[0]),g=l._getRowIdx(u.rowIndex,h),p=u.colIndex;for((s=a.sheetCellType[a.sheets[h][u.rowIndex][p].cellType]).isChecked=e.isChecked,o=l.getAlphaRange(g,p,g,p),i=0,r=c.cellTypes.length;i<r;i++)c.cellTypes[i].range==o&&(c.cellTypes[i].settings.isChecked=e.isChecked);"chk"!=s.id.split("_")[1]&&(t.isNullOrUndefined(c._refrshObj[g])&&(c._refrshObj[g]={}),c._refrshObj[g][p]={rowIndex:g,colIndex:p,isChecked:e.isChecked,type:"CheckBox",id:s.id}),n=["yes","no"].indexOf(l.XLEdit.getPropertyValue(u.rowIndex,p,"value2").toString().toLowerCase())>-1?e.isChecked?"YES":"NO":e.isChecked.toString().toUpperCase(),l.XLEdit._updateDataContainer({rowIndex:u.rowIndex,colIndex:p},{dataObj:l.XLEdit._parseValue(n,{rowIndex:u.rowIndex,colIndex:p})}),e.cellIndex=u,e.cellType="checkbox",l._trigger("cellSave",e),l.model.allowFormulaBar&&l.updateFormulaBar()}},_onDateCreate:function(e){var t=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),i=this.element.closest("td"),r=t.getActiveSheetIndex(),l=t._getCellIdx(i[0]),n=t._getRowIdx(l.rowIndex,r),s=l.colIndex;t.XLEdit._updateDataContainer({rowIndex:n,colIndex:s},{dataObj:t.XLEdit._parseValue(e.model.value?e.model.value.toLocaleString().split(", ")[0]:"",{rowIndex:n,colIndex:s})})},onDateChange:function(e){var i,r=this.element.closest(".e-spreadsheet").data("ejSpreadsheet");if(!r.model.isReadOnly){var l=r._dataContainer,n=this.element.closest("td"),s=r.getActiveSheetIndex(),o=r.getSheet(s),a=r._getCellIdx(n[0]),d=r._getRowIdx(a.rowIndex,s),h=a.colIndex;i=l.sheetCellType[l.sheets[s][a.rowIndex][h].cellType],l.sheets[s][a.rowIndex][h].SelectedTextValue=e.value,"dp"!=i.id.split("_")[1]&&(t.isNullOrUndefined(o._refrshObj[d])&&(o._refrshObj[d]={}),o._refrshObj[d][h]={rowIndex:d,colIndex:h,value:e.model.value,type:"DatePicker",id:i.id}),r.XLEdit._updateDataContainer({rowIndex:d,colIndex:h},{dataObj:r.XLEdit._parseValue(e.model.value?e.model.value.toLocaleString().split(t.isNullOrUndefined(e.model.value.toLocaleString().match(/[,]/))?" ":", ")[0]:"",{rowIndex:d,colIndex:h})}),e.cellIndex=a,e.cellType="datepicker",r._isPublic||r._trigger("cellSave",e),r.model.allowFormulaBar&&r.updateFormulaBar()}},_onButtonCreate:function(e){var t=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),i=this.element.closest("td"),r=t.getActiveSheetIndex(),l=t._getCellIdx(i[0]),n=t._getRowIdx(l.rowIndex,r),s=l.colIndex;t.XLEdit._updateDataContainer({rowIndex:n,colIndex:s},{dataObj:t.XLEdit._parseValue(e.model.text,{rowIndex:n,colIndex:s})})},onButtonClick:function(t){var i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet");i.model.isReadOnly||(t.cellIndex=i._getCellIdx(e(t.target).closest("td")[0]),t.cellType="button",i._trigger("cellClick",t),t.e.stopPropagation())},_onBeforePopupOpen:function(){var t,i=this.element.closest(".e-spreadsheet").data("ejSpreadsheet"),r=i.getActiveSheetIndex(),l=i._dataContainer,n=this.element.closest("td"),s=i._getCellIdx(n[0]),o=s.rowIndex,a=s.colIndex,d=l.sheetCellType[l.sheets[r][o][a].cellType],h=d.dataSourceSheetIndex||r;i.getSheet(h)._isLoaded||i._initSheet(h),t=d.dataSource||i.getRangeData({range:i.getRangeIndices(d.dataSourceRange),sheetIdx:h}),i._isEmptyString(d.dataSourceRange)||(e("#"+d.id).ejDropDownList("instance").option("dataSource",t),e("#"+d.id).ejDropDownList("instance").option("selectedItemIndex",d.selectedIndex))},_rangeInColl:function(e,t){for(var i=this.XLObj,r=i.getSheet(i._getSheetIndex(t)).cellTypes,l=0,n=r.length;l<n;l++)if(r[l].range===e)return l},_rfrshCtrlText:function(i,r){var l,n,s,o=this.XLObj,a=!0;if(o.isUndefined(i.rowIndex)||o.isUndefined(i.colIndex)||(r=(i=o.getRangeData({range:[i.rowIndex,i.colIndex,i.rowIndex,i.colIndex],property:["cellType","value"]})[0]).value),l=o._dataContainer.sheetCellType[i.cellType])switch(l.type){case t.Spreadsheet.CustomCellType.DropDownList:(n=e("#"+l.id).data("ej"+l.type))&&(s=n.selectedIndexValue,n._raiseEvents=!1,n.selectItemByText(r,!0),n._raiseEvents=!0,s!==n.selectedIndexValue?(l.selectedIndex=n.selectedIndexValue,o._isSelIdxChange=!0):a=!1);break;case t.Spreadsheet.CustomCellType.DatePicker:(n=e("#"+l.id).data("ej"+l.type))&&n.option("value",r)}return a},_refreshCellType:function(e){var t,i,r,l,n,s,o,a,d,h=this.XLObj,c=h.getActiveSheetIndex(),u=h.getSheet(c);for(s=0,o=(t=h.getObjectKeys(u._refrshObj)).length;s<o;s++){for(t[s]=parseInt(t[s]),"insertRow"==e.status&&(u._refrshObj[t[s]+e.rowCount]={}),"deleteRow"==e.status&&(u._refrshObj[t[s]-e.rowCount]={}),a=0,d=(i=h.getObjectKeys(u._refrshObj[t[s]])).length;a<d;a++)i[a]=parseInt(i[a]),l=(r=u._refrshObj[t[s]][i[a]]).id.split("_"),e.startCol<=i[a]&&("insertColumn"==e.status&&(l[2]=c+h._generateHeaderText(parseInt(i[a])+e.colCount+1)+(t[s]+1),n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]][parseInt(i[a])+e.colCount]=n,delete u._refrshObj[t[s]][i[a]]),"deleteColumn"==e.status&&(l[2]=c+h._generateHeaderText(parseInt(i[a])-e.colCount+1)+(t[s]+1),n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]][parseInt(i[a])-e.colCount]=n,delete u._refrshObj[t[s]][i[a]])),e.startRow<=t[s]&&("insertRow"==e.status&&(l[2]=c+h._generateHeaderText(parseInt(i[a])+1)+(t[s]+e.rowCount+1),n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]+e.rowCount][i[a]]=n),"deleteRow"==e.status&&(e.startRow==t[s]?delete u._refrshObj[t[s]]:(l[2]=c+h._generateHeaderText(parseInt(i[a])+1)+(t[s]-e.rowCount+1),n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]-e.rowCount][i[a]]=n))),"shiftBottom"==e.status&&(l[2]=c+h._generateHeaderText(parseInt(i[a])+1)+(t[s]+e.rowCount+1),u._refrshObj[t[s]+e.rowCount]={},n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]+e.rowCount][i[a]]=n,delete u._refrshObj[t[s]]),"shiftUp"==e.status&&(l[2]=c+h._generateHeaderText(parseInt(i[a])+1)+(t[s]-e.rowCount+1),u._refrshObj[t[s]-e.rowCount]={},n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]-e.rowCount][i[a]]=n,delete u._refrshObj[t[s]]),"shiftRight"==e.status&&(l[2]=c+h._generateHeaderText(parseInt(i[a])+e.colCount+1)+(t[s]+1),n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]][parseInt(i[a])+e.colCount]=n,delete u._refrshObj[t[s]][i[a]]),"shiftLeft"==e.status&&(l[2]=c+h._generateHeaderText(parseInt(i[a])-e.colCount+1)+(t[s]+1),n={rowIndex:r.rowIndex,colIndex:r.colIndex+e.colCount,type:r.type,id:l.join("_")},"DropDownList"==r.type&&(n.selectedIndex=r.selectedIndex),"CheckBox"==r.type&&(n.isChecked=r.isChecked),"DatePicker"==r.type&&(n.value=r.value),u._refrshObj[t[s]][parseInt(i[a])-e.colCount]=n,delete u._refrshObj[t[s]][i[a]]);("insertRow"==e.status||"deleteRow"==e.status)&&delete u._refrshObj[t[s]]}}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.cFormat=function(e){this.XLObj=e},t.spreadsheetFeatures.cFormat.prototype={getCFRule:function(e,t){var i,r,l,n=this.XLObj,s=n.XLEdit.getPropertyValue(e,t,["cFormatRule"]),o=[],a=n._dataContainer.cFormatData;if(s)for(r=0,l=s.length;r<l;r++)i=a[s[r]].split("_"),o.push({action:i[0],inputs:[i[2],i[3]],color:i[4],bgColor:i[5],range:i[6],isApplied:JSON.parse(i[8])});return o},setCFRule:function(e){var t,i,r=this.XLObj;r.model.isReadOnly||r.model.allowConditionalFormats&&(t=e.inputs[0],i=e.inputs[1],this._cFormat(e.action,t,i,e.color,e.bgColor,e.range,r.getActiveSheetIndex()))},_updateCFormatRule:function(e,t){return e.indexOf("true")>-1?e.replace("true",t):e.replace("false",t)},_getRuleIndex:function(e,i){if(t.isNullOrUndefined(i))return-1;for(var r=0,l=i.length;r<l;r++)if(i[r]===e)return r;return-1},_refreshCFormatFormula:function(e,t,i){var r,l=this.XLObj,n=l.getSheet(i)._cFormatFormula;l.isUndefined(n[e])||l.isUndefined(n[e][t])||(r=n[e][t][0].Formula,this._applyFormulaValues(r.referCell,r.cFColor,r.bgColor,"formularule",r.addr,i,void 0,r.applyCell))},_applyFormulaValues:function(e,i,r,l,n,s,o,a,d,h){var c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j=this.XLObj,M=j.getSheet(s),V=[];if(c=t.isNullOrUndefined(o)&&t.isNullOrUndefined(n)?M._selectedCells:t.isNullOrUndefined(n)?j._getMultiRangeCells(o):j._getMultiRangeCells(n),n=j._getAlphaRange(s,c[0].rowIndex,c[0].colIndex,c[c.length-1].rowIndex,c[c.length-1].colIndex),j.isUndefined(l))y=j._calcEngine,A=new ValueChangedArgs(-1,-1,e),y.valueChanged(M.sheetInfo.value,A),e="TRUE"===y.getFormulaInfoTable().getItem("!"+(s-1)+"!-1").getFormulaValue(),v=!!j._isBool(e)&&e,x="formularule_"+l+"_"+e+"__"+i+"_"+r+"_"+n+"_"+j.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:a.rowIndex,colIndex:a.colIndex},x,-1,v,!0,i,r);else{if(S=["<=",">=","<",">","="],e.startsWith("=")&&(e=e.substr(1)),e.indexOf("==")>-1)return j._showAlertDlg("Alert","NewRuleAlert","",430),!0;for(u=0,p=S.length;u<p;u++)e.indexOf(S[u])>-1&&(V=e.split(S[u]),I=S[u]);if(V.length||(V[0]=e),m=V.slice(),"paste"===d){for(e="",u=0,p=V.length;u<p;u++)j._isvalidRange(V[u]+":"+V[u])&&(a=j._getMultiRangeCells(V[u]),P=o[0]-h.rowIndex,k=o[1]-h.colIndex,V[u]=j._getAlphaRange(s,a[0].rowIndex+P,a[0].colIndex+k,a[0].rowIndex+P,a[0].colIndex+k));e=2===p?V[0]+I+V[1]:V[0]}for(_=this._formulaCellRefer(V,c),u=0,p=c.length;u<p;u++){for(R=!1,O=!1,F=!1,E=!1,L=!1,b=c[u].rowIndex,C=c[u].colIndex,f=(T=this._formulaCellRange({rowIndex:b,colIndex:C},_,m,I,s)).formula,y=j._calcEngine,A=new ValueChangedArgs(-1,-1,f),y.valueChanged(M.sheetInfo.value,A),w="TRUE"===y.getFormulaInfoTable().getItem("!"+(s-1)+"!-1").getFormulaValue(),j._isBool(w)?(v=w)&&(L=!0,D=b,N=C,R=!0):v=!1,e.indexOf("$")>=0&&(2===e.split("$").length?"$"===e.charAt(0)?(v&&c[u].rowIndex===c[0].rowIndex||c[u].rowIndex===D)&&(O=!0):(v&&c[u].colIndex===c[0].colIndex||c[u].colIndex===N)&&(F=!0):E=!0),x="formularule_"+I+"_"+e+"/"+f+"__"+i+"_"+r+"_"+n+"_"+j.getActiveSheetIndex(),g=0;g<j.getObjectLength(T)-1;g++)this._formulaCellUpdate({rowIndex:T["referCell"+g].rowIndex,colIndex:T["referCell"+g].colIndex},{rowIndex:b,colIndex:C},e,f,n,i,r,s);this._applyCFormatRule({rowIndex:b,colIndex:C},x,-1,v,!0,i,r,L,R,O,F,E),v||L||R||O||F||!j._isRowViewable(s,b)||j.getCell(b,C,s).removeClass("e-redft e-yellowft e-greenft e-redf e-redt")}}},_formulaCellUpdate:function(e,t,i,r,l,n,s,o){var a,d=this.XLObj.getSheet(o)._cFormatFormula,h=e.rowIndex,c=e.colIndex;h in d?c in(a=d[h])?a[c].push({Formula:{applyCell:t,formula:i,referCell:r,addr:l,cFColor:n,bgColor:s}}):(a[c]=[],a[c].push({Formula:{applyCell:t,formula:i,referCell:r,addr:l,cFColor:n,bgColor:s}})):((a=d[h]={})[c]=[],a[c].push({Formula:{applyCell:t,formula:i,referCell:r,addr:l,cFColor:n,bgColor:s}}))},_formulaCellRange:function(e,t,i,r,l){for(var n,s,o,a,d,h,c=this.XLObj,u=0,g=[],p=0,m=c.getObjectLength(t),_={},f={},b=0;b<m;b++)c._isObject(t["range"+b])?(d=e.rowIndex+t["range"+b].rowIndex,h=e.colIndex+t["range"+b].colIndex,_["range"+b]=c._getAlphaRange(l,d,h,d,h)):(d=e.rowIndex,h=e.colIndex,_["range"+b]=t["range"+b]),f["referCell"+b]={rowIndex:d,colIndex:h};for(o=0;o<i.length;o++){for(b=0,n=(a=c.XLDragFill._parseFormula("="+i[o])).length;b<n;b++)c._isvalidRange(a[b]+":"+a[b])&&(a[b]=_["range"+u],u++);g[p]=a.join(""),p++}return s=c.isUndefined(r)?"="+g[0]:"="+g[0]+r+g[1],f.formula=s,f},_formulaCellRefer:function(e,t){for(var i,r,l,n,s,o,a,d,h,c=this.XLObj,u=0,g=[],p={},m=0;m<e.length;m++)if(c.isFormula("="+e[m]))for(i=0,r=(n=c.XLDragFill._parseFormula(e[m])).length;i<r;i++)c._isvalidRange(n[i]+":"+n[i])&&(g[u]=n[i],u++);else g[u]=e[m],u++;for(e=g,i=0;i<e.length;i++){if(o=(s=e[i].startsWith("=")?e[i].split("=")[1]:e[i]).split("$").length,c._isvalidRange(e[i]+":"+e[i])){switch(c._isvalidRange(s+":"+s)&&(s.indexOf("$")<0?h="RCRefer":s.startsWith("$")&&3===o?h="CellRefer":s.startsWith("$")&&2===o?h="RRefer":!s.startsWith("$")&&s.indexOf("$")>-1&&(h="CRefer")),e[i].indexOf("$")>-1&&(e[i]=e[i].split("$").join("")),l=c._getMultiRangeCells(e[i]),h){case"RCRefer":case"RRefer":case"CRefer":a=l[0].rowIndex-t[0].rowIndex,d=l[0].colIndex-t[0].colIndex;break;case"CellRefer":a=l[0].rowIndex-t[0].rowIndex,d=l[0].colIndex-t[0].colIndex}e[i]={rowIndex:a,colIndex:d}}p["range"+i]=e[i]}return p},_clearCFormula:function(e,t,i){var r,l,n,s,o,a,d,h=this.XLObj,c=[],u=[],g=0,p=h.XLEdit.getPropertyValue(e,t,"cFormatRule"),m=h.getSheet(i)._cFormatFormula;if(p&&"formularule"===p[0].split("_")[0]&&((r=p[0].split("_")[2].split("/")[1]).startsWith("=")&&(r=r.substr(1)),h.isFormula("="+r))){for(n=0,o=(d=["<=",">=","<",">","="]).length;n<o;n++)r.indexOf(d[n])>-1&&(c=r.split(d[n]));for(c.length||(c[0]=r),n=0,o=c.length;n<o;n++)if(h.isFormula("="+c[n]))for(l=h.XLDragFill._parseFormula(c[n]),s=0;s<l.length;s++)h._isvalidRange(l[s]+":"+l[s])&&(u[g]=l[s],g++);else u[g]=c[n],g++;for(n=0,o=u.length;n<o;n++)a=h._getMultiRangeCells(u[n])[0],h.isUndefined(m[a.rowIndex])||(h.isUndefined(m[a.rowIndex][a.colIndex])||delete m[a.rowIndex][a.colIndex],h.getObjectLength(m[a.rowIndex])||delete m[a.rowIndex])}},_cFormat:function(e,i,r,l,n,s,o,a,d,h){var c,u=this.XLObj;if(u.model.allowConditionalFormats){n=u.isUndefined(n)?"":n,l=u.isUndefined(l)?"":l,u.showWaitingPopUp(),o=o||u.getActiveSheetIndex(),t.isNullOrUndefined(e)&&(e="lessthan");var g=u.getSheet(o),p={cFAction:e,input1:i,input2:r,cFColor:l,bgColor:n,sheetIndex:o,reqType:"cond-format",action:"add",range:s,data:a?u._getRangeArgs(a,"object"):u._getRangeArgs(s,"object")},m={cfAction:e,input1:i,input2:r,cfColor:l,bgColor:n,sheetIndex:o,reqType:"cond-format",type:"actionBegin",action:"add",range:a,addr:s,status:d,copyCell:h};if(e=m.cfAction,i=m.input1,r=m.input2,l=m.cfColor,n=m.bgColor,s=m.addr,a=m.range,d=m.status,h=m.copyCell,!u._trigActionBegin(m)){switch(e){case"greaterthan":this._applyGLEValues(">",i,l,n,e,s,o,a);break;case"greaterequalto":this._applyGLEValues(">=",i,l,n,e,s,o,a);break;case"lessthan":this._applyGLEValues("<",i,l,n,e,s,o,a);break;case"lessequalto":this._applyGLEValues("<=",i,l,n,e,s,o,a);break;case"equalto":this._applyGLEValues("==",i,l,n,e,s,o,a);break;case"notequalto":this._applyGLEValues("!=",i,l,n,e,s,o,a);break;case"between":this._applyBetweenValues("=",i,r,l,n,e,s,o,a);break;case"notbetween":this._applyBetweenValues("!",i,r,l,n,e,s,o,a);break;case"textcontains":this._applyContainsValues(i,l,n,e,s,o,a);break;case"dateoccur":this._applyDateContainsValues(i,l,n,e,s,o,a);break;case"formularule":i.indexOf("/")>-1&&(i=i.split("/")[1]),c=this._applyFormulaValues(i,l,n,e,s,o,a,void 0,d,h)}g._isImported&&!g._isLoaded||u._isUndoRedo||"paste"===d||u._dupDetails||u._isExport||c||(u._completeAction(p),u._trigActionComplete(p)),u.hideWaitingPopUp()}}},clearCF:function(e){var i,r,l,n,s,o=this.XLObj;if(!o.model.isReadOnly){var a,d,h=o.getActiveSheetIndex(),c={sheetIndex:h,reqType:"cond-format",action:"clear",rule:[]},u=o.getSheet(h);if(o.model.allowConditionalFormats){for(l=o._dataContainer.cFormatData,c.selection=!o.isUndefined(e),e=e?o._getRangeArgs(e,"object"):[0,0,u.rowCount-1,u.colCount-1],i=0,r=(n=o._getSelectedCells(h,e).selCells).length;i<r;i++)a=n[i].rowIndex,d=n[i].colIndex,t.isNullOrUndefined(o._dataContainer.sheets[h][a])||t.isNullOrUndefined(o._dataContainer.sheets[h][a][d])||t.isNullOrUndefined(o._dataContainer.sheets[h][a][d].cFormatRule)||(c.rule.push(this.getCFRule(a,d)),this._clearCFormula(a,d,h),o.clearRangeData([a,d,a,d],["cFormatRule"]));s=c.selection?"clear_"+h+"_"+o._getSelectedItems()[1]:"clear_"+h+"_entire",-1===l.indexOf(s)&&l.push(s),o._isUndoRedo||o._dupDetails||(o._completeAction(c),o._trigActionComplete(c))}}},_getValueForCFormat:function(e,i){var r=this.XLObj,l=e.rowIndex,n=e.colIndex,s=r.getRangeData({range:[l,n,l,n],sheetIdx:i}),o=r.XLEdit.getPropertyValue(l,n),a=r.XLEdit.getPropertyValue(l,n,"value2");return o=t.isNullOrUndefined(o)?"":o.toString(),(a&&"string"==typeof a&&!s.formatStr&&"="===o[0]||"datetime"===r.XLEdit.getPropertyValue(l,n,"type")||"shortdate"===r.XLEdit.getPropertyValue(l,n,"type")||"longdate"===r.XLEdit.getPropertyValue(l,n,"type")||"time"===r.XLEdit.getPropertyValue(l,n,"type"))&&(o=a),o},_applyGLEValues:function(i,r,l,n,s,o,a,d){var h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R=this.XLObj,O=new RegExp(/[^.0-9]+/g),F=new RegExp(/[^.-a-zA-Z 0-9]+/g),E=R.getSheet(a),D=E._startCell,N=E._endCell,A=r,P=[],k=d?R._getRangeArgs(d,"object"):R._getRangeArgs(o,"object");if(p=R._getSelectedCells(a,k).selCells,A.startsWith("=")){for(A=A.substr(1),h=0,c=(T=["<=",">=","<",">","="]).length;h<c;h++)A.indexOf(T[h])>-1&&(P=P.split(T[h]),y=T[h]);P.length||(P[0]=A),I=this._formulaCellRefer(P,p)}for(h=0,c=p.length;h<c;h++)if(m=p[h].rowIndex,_=p[h].colIndex,(r=r.replace(/^"|"$/g,"")).startsWith("=")&&(L=R._calcEngine,w=this._formulaCellRange({rowIndex:m,colIndex:_},I,P,y,a),u=new ValueChangedArgs(-1,-1,w.formula),L.valueChanged(R.getSheet(a).sheetInfo.value,u),r=L.getFormulaInfoTable().getItem("!0!-1").getFormulaValue(),f=!!R._isBool(r)&&"TRUE"===r,t.isNullOrUndefined(r)&&(r="0")),!R.XLEdit.getPropertyValue(m,_,"isMHide")&&!R.XLEdit.getPropertyValue(m,_,"isFilterHide")){if(g=this._getValueForCFormat({rowIndex:m,colIndex:_},a),x=R.XLEdit.getPropertyValue(m,_,"type")?R.XLEdit.getPropertyValue(m,_,"type"):"general",b=!0,S=-1,t.isNullOrUndefined(g)||!g.length&&"equalto"!=s||"0"==r)e.isNumeric(r)&&(f=r>0?"lessthan"===s||"lessequalto"===s||"notequalto"===s:r<0?"greaterthan"===s||"greaterequalto"===s||"notequalto"===s:"equalto"===s||"lessequalto"===s||"greaterequalto"===s);else if(e.isNumeric(r))if(e.isNumeric(g))g=parseFloat(g),f=R.operators[i](g,parseFloat(r.replace(F,"")));else if(R._isValidDate(g))f=R.operators[i](R._dateToInt(g),parseFloat(r));else{if(R._isValidTime(g))continue;f=R.operators[i](g.toLowerCase(),r.toLowerCase())}else r.lastIndexOf("%")===r.length-1&&e.isNumeric(r.replace(O,""))?f="percentage"===x?R.operators[i](parseFloat(g),parseFloat(r.replace(O,""))):e.isNumeric(g)?R.operators[i](parseFloat(g),0):R.operators[i](g.length,0):0===r.indexOf("$")&&e.isNumeric(r.replace(O,""))?f="accounting"===x||"currency"!==x||e.isNumeric(g)?R.operators[i](parseFloat(g),parseFloat(r.replace(O,""))):(R.operators[i](g.length,0)||R._isValidDate(g))&&!R._isValidTime(g):R._isValidDate(r)?R._isValidDate(g)?f=R.operators[i](R._dateToInt(new Date(g)),R._dateToInt(new Date(r))):R._isValidTime(g)||(f=e.isNumeric(g)?R.operators[i](parseFloat(g),R._dateToInt(r)):R.operators[i](g.length,R._dateToInt(r))):f=R._isValidTime(r)?R._isValidTime(g)?R.operators[i](R.parse.parseTime(g),R.parse.parseTime(r)):e.isNumeric(g)?R.operators[i](parseFloat(g),0):R.operators[i](g.length,0):R.operators[i](g.toLowerCase(),r.toLowerCase());if(t.isNullOrUndefined(o)&&(o=R._generateHeaderText(D.colIndex+1)+(D.rowIndex+1)+":"+R._generateHeaderText(N.colIndex+1)+(N.rowIndex+1)),C=s+"_"+i+"_"+r+"__"+l+"_"+n+"_"+o+"_"+R.getActiveSheetIndex(),A.startsWith("="))for(C=s+"_"+i+"_"+(r=A.substr(1))+"__"+l+"_"+n+"_"+o+"_"+R.getActiveSheetIndex(),v=0;v<R.getObjectLength(w)-1;v++)this._formulaCellUpdate({rowIndex:w["referCell"+v].rowIndex,colIndex:w["referCell"+v].colIndex},{rowIndex:m,colIndex:_},r,w.formula,o,l,a);this._applyCFormatRule({rowIndex:m,colIndex:_},C,S,f,b,l,n)}},_applyBetweenValues:function(i,r,l,n,s,o,a,d,h){var c,u,g,p,m,_,f,b,C,S,x,v,w=this.XLObj,I=new RegExp(/[^.0-9]+/g),y=new RegExp(/[^.-a-zA-Z 0-9]+/g),T=w.getSheet(d),L=T._startCell,R=T._endCell;for(w.operators["<"](w.isNumber(r)?parseFloat(r):r,w.isNumber(l)?parseFloat(l):l)||(m=l,l=r,r=m),x=0,v=(p=t.isNullOrUndefined(h)&&t.isNullOrUndefined(a)?w.getSheet(d)._selectedCells:w._getSelectedCells(d,a).selCells).length;x<v;x++)if(c=p[x].rowIndex,u=p[x].colIndex,!w.XLEdit.getPropertyValue(c,u,"isMHide")&&!w.XLEdit.getPropertyValue(c,u,"isFilterHide")){if(g=this._getValueForCFormat({rowIndex:c,colIndex:u},d),S=w.XLEdit.getPropertyValue(c,u,"type")?w.XLEdit.getPropertyValue(c,u,"type"):"general",f=!0,C=-1,t.isNullOrUndefined(g)||!g.length)e.isNumeric(r)&&e.isNumeric(l)&&(_=r>0&&l>0||r<0&&l<0?"notbetween"===o:"between"===o);else if(e.isNumeric(r.replace(y,""))&&e.isNumeric(l.replace(y,""))&&"percentage"!==S&&"currency"!==S&&"accounting"!==S)if(r=r.replace(y,""),l=l.replace(y,""),e.isNumeric(g))_=w.operators[i](parseFloat(g)>=parseFloat(r)&&parseFloat(g)<=parseFloat(l));else if(w._isValidDate(g))_=w.operators[i](w._dateToInt(g)>=parseFloat(r)&&void 0<=parseFloat(l));else{if(w._isValidTime(g))continue;_=w.operators[i](g.toLowerCase()>=r.toLowerCase()&&g.toLowerCase()<=l.toLowerCase())}else if(r.lastIndexOf("%")===r.length-1&&e.isNumeric(r.replace(I,""))&&l.lastIndexOf("%")===l.length-1&&e.isNumeric(l.replace(I,""))&&"percentage"===S)_=w.operators[i](parseFloat(g)>=parseFloat(r.replace(I,""))&&parseFloat(g)<=parseFloat(l.replace(I,"")));else if(0===r.indexOf("$")&&e.isNumeric(r.replace(I,""))&&0===l.indexOf("$")&&e.isNumeric(l.replace(I,""))&&("accounting"===S||"currency"!==S))_=w.operators[i](parseFloat(g)>=parseFloat(r.replace(I,""))&&parseFloat(g)<=parseFloat(l.replace(I,"")));else if(w._isValidDate(r)&&w._isValidDate(l)){var O=w._dateToInt(new Date(g)),F=w._dateToInt(new Date(r)),E=w._dateToInt(new Date(l));_=w.operators[i](O>=F&&O<=E)}else _=w._isValidTime(r)&&w._isValidTime(l)&&w._isValidTime(g)?w.operators[i](w.parse.parseTime(g)>=w.parse.parseTime(r)&&w.parse.parseTime(g)<=w.parse.parseTime(l)):e.isNumeric(g)?w.operators[i](parseFloat(g)>=parseFloat(r)&&parseFloat(g)<=parseFloat(l)):w.operators[i](g.toLowerCase()>=r.toLowerCase()&&g.toLowerCase()<=l.toLowerCase());t.isNullOrUndefined(a)&&(a=w._generateHeaderText(L.colIndex+1)+(L.rowIndex+1)+":"+w._generateHeaderText(R.colIndex+1)+(R.rowIndex+1)),b=o+"_"+i+"_"+r+"_"+l+"_"+n+"_"+s+"_"+a+"_"+w.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:c,colIndex:u},b,C,_,f,n,s)}},_applyContainsValues:function(i,r,l,n,s,o,a){var d,h,c,u,g,p,m,_,f,b,C=this.XLObj,S=new RegExp(/[^.-a-zA-Z 0-9]+/g),x=C.getSheet(o),v=x._startCell,w=x._endCell;for(f=0,b=(u=t.isNullOrUndefined(a)&&t.isNullOrUndefined(s)?C.getSheet(o)._selectedCells:C._getSelectedCells(o,s).selCells).length;f<b;f++)d=u[f].rowIndex,h=u[f].colIndex,C.XLEdit.getPropertyValue(d,h,"isMHide")||C.XLEdit.getPropertyValue(d,h,"isFilterHide")||(c=this._getValueForCFormat({rowIndex:d,colIndex:h},o),p=!0,_=-1,t.isNullOrUndefined(c)||!c.length?g=!1:e.isNumeric(i.replace(S,""))?(i=i.replace(S,""),C._isValidDate(c)&&(c=C._dateToInt(c).toString()),g=c.indexOf(i)>-1):C._isValidDate(i)?(C._isValidDate(c)&&(c=C._dateToInt(c).toString()),g=c.indexOf(C._dateToInt(i))>-1):C._isValidTime(i)?(C._isValidTime(c)&&(c=C._dateToInt("01/01/1990 "+c).toString()),g=c.indexOf(C._dateToInt("01/01/1990 "+i))>-1):g=c.toLowerCase().indexOf(i.toLowerCase())>-1,t.isNullOrUndefined(s)&&(s=C._generateHeaderText(v.colIndex+1)+(v.rowIndex+1)+":"+C._generateHeaderText(w.colIndex+1)+(w.rowIndex+1)),m=n+"__"+i+"__"+r+"_"+l+"_"+s+"_"+C.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:d,colIndex:h},m,_,g,p,r,l))},_applyDateContainsValues:function(e,i,r,l,n,s,o){var a,d,h,c,u,g,p,m,_=this.XLObj,f=!1,b=_.getSheet(s),C=b._startCell,S=b._endCell;for(p=0,m=(g=t.isNullOrUndefined(o)&&t.isNullOrUndefined(n)?_.getSheet(s)._selectedCells:_._getSelectedCells(s,n).selCells).length;p<m;p++)a=g[p].rowIndex,d=g[p].colIndex,_.XLEdit.getPropertyValue(a,d,"isMHide")||_.XLEdit.getPropertyValue(a,d,"isFilterHide")||(h=this._getValueForCFormat({rowIndex:a,colIndex:d},s),u=-1,t.isNullOrUndefined(h)||!h.length?f=!1:_._isValidDate(e)&&(f=new Date(h)-new Date(e)==0),t.isNullOrUndefined(n)&&(n=_._generateHeaderText(C.colIndex+1)+(C.rowIndex+1)+":"+_._generateHeaderText(S.colIndex+1)+(S.rowIndex+1)),c=l+"__"+e+"__"+i+"_"+r+"_"+n+"_"+_.getActiveSheetIndex(),this._applyCFormatRule({rowIndex:a,colIndex:d},c,u,f,!0,i,r))},refreshCFormat:function(e){var t,i,r,l,n,s,o,a,d,h,c,u=this.XLObj,g=u._dupDetails;if(!u.model.isReadOnly&&(u._dupDetails=!0,u.model.allowConditionalFormats)){for(r=[],l=u.getActiveSheetIndex(),t=0,a=(s=u._getSelectedCells(l,e).selCells).length;t<a;t++){if(h=s[t].rowIndex,c=s[t].colIndex,o=u.XLEdit.getPropertyValue(h,c,"cFormatRule"),!u.isUndefined(o)&&o.length)for(i=0,d=o.length;i<d;i++)o[i]=o[i].replace("_true","").replace("_false",""),r.indexOf(o[i])<0&&r.push(o[i]);u._isRowViewable(l,h)&&u.getCell(h,c,l).removeClass("e-redft e-yellowft e-greenft e-redf e-redt"),u.clearRangeData([h,c,h,c],["cFormatRule"],s[t])}for(i=0,d=r.length;i<d;i++)n=r[i].split("_"),this._cFormat(n[0],n[2],n[3],n[4],n[5],n[6]);u._dupDetails=g}},_applyColors:function(e,t,i,r){e.length&&t.indexOf(e)>-1?i&&i.removeClass(t).addClass("e-"+e):(e.length&&t.indexOf(e)<0&&i&&i.removeClass(t).css({color:e}).addClass("e-cformat"),r.length&&t.indexOf(r)<0&&i&&(i.removeClass(t).css({"background-color":r}),i.hasClass("e-cformat")||i.addClass("e-cformat")))},_applyCFormatRule:function(e,t,i,r,l,n,s,o,a,d,h,c){var u,g,p,m,_,f,b=this.XLObj,C=b.getActiveSheetIndex(),S=e.rowIndex,x=e.colIndex,v=b.XLEdit.getPropertyValue(S,x,"cFormatRule"),w=!0,I="e-redft e-yellowft e-greenft e-redf e-redt";if(this._getRuleIndex(t+"_true",v)>-1&&(i=this._getRuleIndex(t+"_true",v)),this._getRuleIndex(t+"_false",v)>-1&&(i=this._getRuleIndex(t+"_false",v)),i>-1&&(p=v[i],(m=b._dataContainer.cFormatData.indexOf(this._updateCFormatRule(p,r)))>-1?b._dataContainer.sheets[C][S][x].cFormatRule[i]=m:(b._dataContainer.cFormatData.push(this._updateCFormatRule(p,r)),b._dataContainer.sheets[C][S][x].cFormatRule[i]=b._dataContainer.cFormatData.length-1)),v=b.XLEdit.getPropertyValue(S,x,"cFormatRule"),b._isRowViewable(C,S)&&(u=!0,g=b.getCell(S,x)),!b.isUndefined(v)&&v.length>0&&(t+"_true"!==v[i]&&t+"_false"!==v[i]||v.length>1)){for(_=0,f=v.length;_<f;_++)p=v[_].split("_");u&&(r||o||a||d||h||c)&&(r=!0,this._applyColors(n,I,g,s))}else u&&(r||o||a||d||h||c)&&(r=!0,this._applyColors(n,I,g,s));if(v&&v.length){var y=b.getRangeIndices(t.split("_")[6]),T=b.getRangeIndices(v[0].split("_")[6]),L=t.split("_");L.splice(6,1),L.splice(5,1),v[0].indexOf(L.join("_"))>-1&&b.inRange(T,y[0],y[1])&&(w=!1)}w&&this._getRuleIndex(t+"_true",v)<0&&this._getRuleIndex(t+"_false",v)<0&&b.XLEdit._updateDataContainer(e,{dataObj:{cFormatRule:[t+"_"+r]},skipCell:!r})}}}(jQuery,Syncfusion),function(e,t,i){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.clipboard=function(e){this.XLObj=e,this._cutCells=[],this._copyCells=[],this._copyBackup={},this._cData="",this._isCut=!1,this._copyRange=[],this._isSpecial=!e.isPasteValuesOnly,this._isShape=!1,this._copyRnge={},this._highLightRange=[]},t.spreadsheetFeatures.clipboard.prototype={copy:function(){this._triggerKeyDown(67,!0)},cut:function(){this.XLObj.model.isReadOnly||this._triggerKeyDown(88,!0)},paste:function(){this.XLObj.model.isReadOnly||this._triggerKeyDown(86,!0)},_initCopyPaste:function(){var i=this.XLObj._id,r=t.buildTag("div",{},{position:"fixed",top:-1e3,left:-1e3},{id:i+"_copyPaste"});e("body").append(r),r.append(t.buildTag("textarea ."+i+"_copyTxt",{},{width:1,height:1,overflow:"hidden",opacity:0,resize:"none",cursor:"default"},{id:i+"_hiddenTxt"}))},_copyPasteHandler:function(t){var i,r,l,n=this.XLObj,s=n.getActiveSheetIndex(),o=n.getSheet(s),a=navigator.platform.toLowerCase().indexOf("mac")>-1;if(l=a?""===e("#"+n._id+"_hiddenTxt").val()&&"chrome"===n._browserDetails.name?900:10:0,n._isUndoRedo=!1,!n.model.allowEditing&&(88===t.keyCode||86===t.keyCode))return!1;if(67!==t.keyCode&&88!==t.keyCode&&86!==t.keyCode||!n._preventctrlkey)if(t.ctrlKey){if(67===t.keyCode){if(r={reqType:"copy",startcell:o._startCell,endcell:o._endCell,selectedCells:o._selectedCells},n._trigActionBegin(r))return!1;this._getClipboard(t),this._cutCells=[],e.extend(!0,this._copyCells,o._selectedCells),this._copyCells.length||(this._copyCells=[n.XLShape._picCellIdx]),setTimeout(function(){n._setSheetFocus()},0)}else if(88===t.keyCode){if(i=o._selectedCells,n.model.allowLockCell&&o.isSheetProtected&&n._isPropExists([o.selectedRange],"isLocked",s))return;if(i.length&&n._isPropExists([o.selectedRange],"isReadOnly",s))return;if(r={reqType:"cut",startcell:o._startCell,endcell:o._endCell,selectedCells:o._selectedCells},n._trigActionBegin(r))return!1;i.length&&n._isPropExists([o.selectedRange],"rule",s)&&n.getRange(o.selectedRange,s).removeClass("e-hlcell"),this._copyCells=[],e.extend(!0,this._cutCells,i),this._cutCells.length||(this._cutCells=[n.XLShape._picCellIdx]),this._getClipboard(t),setTimeout(function(){n._setSheetFocus()},0)}else if(86===t.keyCode){if(r={reqType:"paste",isCopy:!this._cutCells.length,isShape:this._isShape,activecell:o._activeCell},this._isShape||(r.cRange=this._copyRange),n._trigActionBegin(r))return;if(n.isUndefined(t.bubbles)||(this._isSpecial=!n.isPasteValuesOnly),this._cData.length||this._copyBackup.elem)e("#"+n._id+"_hiddenTxt").val(this._cData).select();else{if(!t.originalEvent&&!a)return e("#"+n._id+"_hiddenTxt").val(""),void n._showAlertDlg("Alert",["ClipboardAccessError","Cut","Copy","Paste"],"ClipboardAccessError",450);e("#"+n._id+"_hiddenTxt").select()}setTimeout(function(){n.XLClipboard._setClipboard()},l)}}else 27===t.keyCode&&n.element.find(".e-cdata").length&&(n.element.find("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),e("#"+n._id+"_hiddenTxt").val(""),this._cData="",this._copyCells=[]);else n._showAlertDlg("Alert","CtrlKeyErrorAlert","CtrlKeyErrorAction",450)},_triggerKeyDown:function(t,i){var r,l=this.XLObj;l._setSheetFocus(),(r=e.Event("keydown")).keyCode=t,r.ctrlKey=i,e("#"+l._id).trigger(r)},_getClipboard:function(t){var i,r,l,n=this.XLObj,s=n.getActiveSheetIndex(),o=n.getSheet(s),a=o._startCell,d=o._endCell,h=n._getContent(s).find(".e-selected"),c=n.getActiveCellElem(s)[0];if(n.model.allowClipboard)for(n.XLClipboard._copyBackup.cells||!n.model.showRibbon||n.model.isReadOnly||(n.XLRibbon._enableButtons(["Home_Clipboard_Paste"],"ejButton"),n.XLRibbon._enableButtons(["Home_Clipboard_PasteOptions"],"ejSplitButton")),h.length?(this._copyBackup={cells:[],border:n.model.allowCellFormatting&&n.XLFormat.getHashCodeClassAsArray(),table:[],filterRange:[]},l=this._getSelectedData(a,d),n.element.find(".e-cdata").length&&n.element.find("td.e-cutright, td.e-cutbottom").removeClass("e-cutright e-cutbottom"),e(h).addClass("e-cdata"),n.XLSelection._focusBorder(a,d,n._cutFocus),this._cData=h.length<2&&!l.length?l=" ":l,this._isCut=!1,e("#"+n._id+"_hiddenTxt").val(l).select(),navigator.platform.toLowerCase().indexOf("mac")>-1&&document.execCommand("copy"),this._copyBackup.actCellPos={top:c.offsetTop,left:c.offsetLeft},67==t.keyCode&&(this._copyBackup.copypaste=!0),this._isShape=!1):(this._isShape=!0,this._copyBackup={elem:n.getSheetElement(s).find(".e-ss-activeimg"),isCut:88===t.keyCode,sIdx:s}),i=0;i<h.length;i++)(r=n.XLEdit.getPropertyValue(n._getCellIdx(h[i]).rowIndex,n._getCellIdx(h[i]).colIndex,"formulaRange"))&&(this._copyRnge[r]?this._copyRnge[r].push({rowIdx:n._getCellIdx(h[i]).rowIndex,colIdx:n._getCellIdx(h[i]).colIndex}):this._copyRnge[r]=[{rowIdx:n._getCellIdx(h[i]).rowIndex,colIdx:n._getCellIdx(h[i]).colIndex}])},_getSelectedData:function(t,i){var r,l,n,s,o,a,d,h,c=this.XLObj,u="",g=c.getActiveSheetIndex();for(t.rowIndex>=i.rowIndex&&(o=t,t=i,i=o),this._copyRange=[],this._copyRange.push(c.getActiveSheetIndex()),this._copyRange.push(c._getSelectedItems()[1]),l=t.rowIndex;l<=i.rowIndex;l++)if(l!==t.rowIndex&&(u+="\n"),t.colIndex<=i.colIndex)for(n=t.colIndex;n<=i.colIndex;n++)r=c.getRangeData({range:[l,n,l,n],property:["type","value","value2"]})[0],s=c.getObjectLength(r)?"general"!==r.type?r.value2:r.value:"",this._updateCBackupData(l,n),u+=n!==i.colIndex?s+"\t":s;else for(n=i.colIndex;n<=t.colIndex;n++)r=c.getRangeData({range:[l,n,l,n],property:["type","value","value2"]})[0],s=c.getObjectLength(r)?"general"!==r.type?r.value2:r.value:"",this._updateCBackupData(l,n),u+=n!==t.colIndex?s+"\t":s;var p,m,_,f=c.model.sheets[g].tableManager,b=[],C=c.model.sheets[g].selectedRange;for(a=0,d=(p=c.getObjectKeys(f)).length;a<=d;a++)if(m=e.extend(!0,{},f[p[a]]),c.getObjectLength(m)&&(_=m.range,this._compareRange(C,_))){b.push(m.name),m.header=!0,m.tblId=p[a],this._copyBackup.table.push({tblName:b,tblObj:m,range:_,sheetIdx:g});break}return h=c.getRangeIndices(c.model.sheets[g].filterSettings.range),this._compareRange(C,h)&&(this._copyBackup.filterRange=h),u},_updateCBackupData:function(t,i){var r,l,n=this.XLObj,s=n.getActiveSheetIndex(),o=n._dataContainer.sheets[s];t in o&&i in o[t]?r=(l=e.extend(!0,{},o[t][i])).format?l.format:"":(l={},r=""),this._copyBackup.cells.push({cell:l,format:r})},_setClipboard:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E,D,N,A,P,k,j,M,V=this.XLObj;if(!V.model.isReadOnly){V._isCopyPaste=!0;var B,H,X,U,z,q,G,W,K,J,Q,Y,$,Z,ee,te=[],ie=[],re=new RegExp("\\be-format.*?\\b","g"),le=!1,ne=!1,se=V.getActiveSheetIndex(),oe={cSheetIndex:this._copyRange[0],pSheetIndex:se,sheetIndex:se,reqType:this._copyBackup.isCut?"cut-paste":"copy-paste",type:"actionBegin",action:this._copyBackup.isCut?"cut-paste":"copy-paste",copyRange:this._copyRange[1]},ae=[];if(!V._trigActionBegin(oe)){ee={cSheetIndex:this._copyRange[0],pSheetIndex:se,sheetIndex:se,isHighlightData:!1};var de,he,ce,ue,ge,pe,me,_e,fe,be,Ce,Se,xe,ve,we,Ie,ye,Te,Le,Re,Oe,Fe,Ee=V.getSheet(se)._startCell,De=V.getSheet(se)._endCell,Ne=0,Ae={},Pe=new RegExp("\\be-shapebdr.*?\\b","g"),ke=["solid","dashed","dotted"],je=Ee.rowIndex<De.rowIndex?Ee.rowIndex:De.rowIndex,Me=this._copyBackup.table,Ve=Ee.colIndex<De.colIndex?Ee.colIndex:De.colIndex,Be=V._dataContainer,He=this._copyCells.length,Xe=this._cutCells.length;if(V.isPasteValuesOnly&&(this._isSpecial=!1),this._copyRange.length){if(Q=V.swapRange(V.getRangeIndices(this._copyRange[1])),Re=V._getSelectedRange({rowIndex:Q[0],colIndex:Q[1]},{rowIndex:Q[2],colIndex:Q[3]}),X=[je,Ve,je+(Q[2]-Q[0]),Ve+(Q[3]-Q[1])],Le=V._getSelectedRange({rowIndex:X[0],colIndex:X[1]},{rowIndex:X[2],colIndex:X[3]}),V.model.allowLockCell&&V.getSheet(se).isSheetProtected&&V._isPropExists([X],"isLocked",se))return;if(V._isPropExists([X],"isReadOnly",se))return}if(0===je&&0===Ve&&He===this.XLObj.model.rowCount*this.XLObj.model.columnCount||He!==this.XLObj.model.rowCount*this.XLObj.model.columnCount){var Ue,ze,qe,Ge,We,Ke,Je,Qe=V.model.sheets[se],Ye=V.model.sheets[this._copyBackup.sIdx],$e=V.getSheetElement(se).find(".e-activecell"),Ze=V.getSheet(this._copyBackup.sIdx||this._copyRange[0]||se).shapeMngr,et=this._copyRange[0];if(this._isShape){if(!this._isSpecial)return!1;r=V.XLShape._picCellIdx,l=V.getActiveCell(se),i=(_e=this._copyBackup.elem)[0].id,Y=i.indexOf("picture")>-1?"picture":"chart",ee={sheetIndex:se,cSheetIndex:this._copyBackup.sIdx,pSheetIndex:se,operation:"shape",cShapeId:i,reqType:this._copyBackup.isCut?"cut-paste":"copy-paste"},J=e.extend(!0,{},Be.sheets[this._copyBackup.sIdx][r.rowIndex][r.colIndex]),ie=V.getCell(l.rowIndex,l.colIndex),e.extend(!0,Ae,Ze[Y][i]),ee.cutCell={rowIndex:r.rowIndex,colIndex:r.colIndex,obj:J,shapeObj:e.extend(!0,{},Ae)},_e=V.element.find("#"+Ae.id),"picture"===Y?(qe=_e[0].className).indexOf("e-shapebdr")>-1?(ve=(xe=(qe=_e[0].className.match(Pe)[0]).replace("e-shapebdr","").split("N"))[2],V.XLShape._createPicture(se,l,Ze.sharedPics[Ae.data],ie[0].offsetTop,ie[0].offsetLeft,Ae.width,Ae.height,null,"#"+ve,ke[parseInt(xe[1])-1],xe[0]+"px"),V.model.showRibbon&&V.XLRibbon._formatTabUpdate()):(V.XLShape._createPicture(se,l,Ze.sharedPics[Ae.data],ie[0].offsetTop,ie[0].offsetLeft,Ae.width,Ae.height),V.model.showRibbon&&V.XLRibbon._formatTabUpdate()):(Ae.isChartSeries||(Ie=Ae.range,-1===(Ie=V._getAlphaRange(se,Ie[0],Ie[1],Ie[2],Ie[3])).indexOf(":")&&(Ie=Ie+":"+Ie)),Ae.top=ie[0].offsetTop,Ae.left=ie[0].offsetLeft,V.XLChart.createChart(Ae.isChartSeries?null:Ie,e.extend(!0,{},Ae))),this._isShape=!this._copyBackup.isCut,this._cutCells=[],V._isUndoRedo||(J=e.extend(!0,{},Be.sheets[se][l.rowIndex][l.colIndex]),Ae=e.extend(!0,{},Qe.shapeMngr[Y][J[Y][0]]),ee.pShapeId=J[Y][0],ee.pasteCell={rowIndex:l.rowIndex,colIndex:l.colIndex,obj:J,shapeObj:Ae},"cut-paste"===(z={sheetIndex:ee.sheetIndex,cutCell:ee.cutCell,pasteSheetIndex:ee.pSheetIndex,operation:ee.operation,reqType:ee.reqType,pasteShapeId:ee.pShapeId,pasteCell:ee.pasteCell}).reqType?(z.cutSheetIndex=ee.cSheetIndex,z.cutShapeId=ee.cShapeId):(z.copySheetIndex=ee.cSheetIndex,z.copyshapeId=ee.cShapeId),V._completeAction(ee),V._trigActionComplete(z),this._copyBackup.isCut&&((J=e.extend(!0,{},Be.sheets[this._copyBackup.sIdx][r.rowIndex][r.colIndex]))[Y].some(function(e,t){return _e[0].id===Ye.shapeMngr[Y][J[Y][t]].id&&(Ue=t,!0)}),Object.keys(J).length<2&&J[Y].length<2?(delete Be.sheets[this._copyBackup.sIdx][r.rowIndex][r.colIndex],V.getObjectLength(Be.sheets[this._copyBackup.sIdx][r.rowIndex])<1&&delete Be.sheets[this._copyBackup.sIdx][r.rowIndex]):J[Y].length<2?delete J[Y]:J[Y].splice(Ue,1),delete Ye.shapeMngr[Y][ee.cShapeId])),this._copyBackup.isCut&&_e.remove()}else{if(le=this._cData===e("#"+V._id+"_hiddenTxt").val()&&this._copyRange.length>0){if(V.model.allowLockCell&&V.getSheet(se).isSheetProtected&&V._isPropExists([X],"isLocked",se))return;if(V._isPropExists([X],"isReadOnly",se))return}if(ee.reqType=Xe>0?"cut-paste":"copy-paste",V.element.find(".e-selected").hasClass("e-readonly"))return void(V.element.find(".e-cdata").length&&V.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom"));if(ee.text=te=e("#"+V._id+"_hiddenTxt").val().length?e("#"+V._id+"_hiddenTxt").val().split("\n"):[],this._cData.length<1&&ee.text.length<1)return;if(le||""!==te[te.length-1]||te.splice(te.length-1,1),n=[],le?(ee.isSpecial=this._isSpecial,Ie=V.getRangeIndices(this._copyRange[1]),V.setActiveSheetIndex(this._copyRange[0]),ee.cutBorder={range:Ie,prevBorder:V.model.allowCellFormatting&&V.XLFormat.getHashCodeClassAsArray(Ie)},V.setActiveSheetIndex(se)):ee.isSpecial=!1,"cut-paste"==ee.reqType)for(Oe=V.getObjectKeys(this._copyRnge),Fe=V.XLEdit.getPropertyValue(Re[0].rowIndex,Re[0].colIndex,"hasMultipleFormulaArray"),c=0;c<Oe.length;c++)if(1==Xe&&Fe&&V.XLEdit.getPropertyValue(this._cutCells[c].rowIndex,this._cutCells[c].colIndex,"hasFormulaArray"))return V._showAlertDlg("Alert","ArrayaFormula",430),void(this._copyRnge={});if(Xe){for(Je=[],et=this._copyRange[0],Me.length||this._cutPasteBorder(Q,X),de=0;de<Xe;de++){if(a=this._cutCells[de].rowIndex,d=this._cutCells[de].colIndex,$=V.getCell(a,d,et),ie={rowIndex:a,colIndex:d,prevObj:{},newObj:{},shapes:[]},t.isNullOrUndefined(Be.sheets[et][a])?ie.prevObj={}:e.extend(!0,ie.prevObj,Be.sheets[et][a][d]),J=t.isNullOrUndefined(Be.sheets[et][a])?{}:e.extend(!0,{},Be.sheets[et][a][d]),$&&$[0]){if("merge"in ie.prevObj||(V.XLEdit._updateCellValue({rowIndex:a,colIndex:d},"","",et),V._refreshRowHeight(et,a)),"wrap"in J&&(ge=V._generateHeaderText(d+1)+(a+1),V._dupDetails=!0,V.setActiveSheetIndex(et),V.setWrapText("unwrap",ge+":"+ge),V.setActiveSheetIndex(se),V._dupDetails=!1),"cellType"in J&&V.model.allowCellType&&V.XLCellType._removeControls(a,d,et,!0),V.model.allowSparkline&&"sparkline"in J&&(Te=V.XLEdit.getPropertyValue(a,d,"sparkline",et),ie.prevSparklineProp=e.extend(!0,{},V.getSheet(et).shapeMngr.sparkline[Te]),this._copyBackup.sparkline||(this._copyBackup.sparkline={}),this._copyBackup.sparkline[Te]=ie.prevSparklineProp,V.XLSparkline._removeSparklineElem(a,d,et)),$.removeClass("e-hyperlinks e-redft e-yellowft e-greenft e-redf e-redt"),$.find("a").remove(),$.hasClass("e-commentcell")&&V.XLComment.deleteComment([a,d,a,d],et),V.model.allowCellFormatting&&!V.XLRibbon._isDirtySelect)if(ne="partial"==V._checkTableRange(V._getRangeArgs(Ie,"string")).status,Me.length)for(ce=0,ue=Me.length;ce<ue;ce++)V.XLFormat.removeStyle(Ie,{cellStyle:!0,tableStyle:!0,format:!0,border:!0,sheetIdx:Me[ce].sheetIdx});else ne||V.XLFormat.removeStyle(Ie,{cellStyle:!0,tableStyle:!0,format:!0});a in Be.sheets[et]&&d in Be.sheets[et][a]&&(ne?V.XLEdit._clearDataContainer({cellIdx:{rowIndex:a,colIndex:d},sheetIdx:et,property:["value","value2","type","cFormatRule","thousandSeparator","rule","calcValue","align","hyperlink","comment","decimalPlaces","formatStr"]}):(delete Be.sheets[et][a][d],V._textClip(a,d,"delete"))),$[0].className.match(re)&&"partial"!=V._checkTableRange(V._getRangeArgs(Ie,"string")).status&&($[0].className=$[0].className.replace(re,"")),t.isNullOrUndefined(Be.sheets[et][a])?ie.newObj={}:e.extend(!0,ie.newObj,Be.sheets[et][a][d]),V._setRowHdrHeight(et,V._getCellIdx($[0]).rowIndex)}else V.getObjectLength(J)&&(K=V.getObjectKeys(J),(ne="partial"==V._checkTableRange(V._getRangeArgs(Ie,"string")).status)&&(K.splice(K.indexOf("tableName"),1),K.splice(K.indexOf("tformats"),1),K.splice(K.indexOf("format"),1)),V.clearRangeData([a,d,a,d],K),V.model.allowCellType&&"cellType"in J&&delete Be.sheetCellType[Be.sheets[et][a][d].cellType]);Je.push(ie)}for(ce=0,ue=Me.length;ce<ue;ce++)u=V.getActiveSheetIndex(),V.gotoPage(et,!1),Ce=e.trim(Me[ce].tblName),V.XLFormat.removeTable(V._getTableID(null,Ce,et)),V.gotoPage(u,!1);V.model.allowCellFormatting&&!ne&&V.XLFormat.removeStyle(Ie,{cellStyle:!0,tableStyle:!0,format:!0}),V.setActiveSheetIndex(et),V.setActiveSheetIndex(se),ee.cutCells=Je,ee.cfat={table:Ce,range:Ie},Ke=!0,V.element.find(".e-cdata").length&&V.element.find(".e-cutright, .e-cutbottom").removeClass("e-cutright e-cutbottom")}else{if(g=[],this._isSpecial)for(de=0;de<He;de++)ie={rowIndex:a=this._copyCells[de].rowIndex,colIndex:d=this._copyCells[de].colIndex,prevObj:{},newObj:{}},t.isNullOrUndefined(Be.sheets[se][a])||e.extend(!0,ie.prevObj,Be.sheets[se][a][d]),g.push(ie);else g=this._copyCells;ee.cutCells=g}if(te.length?ze=[je,Ve,je+te.length-1,Ve+te[0].split("\t").length-1]:(ze=[je,Ve,je,Ve],de=he=1),ee.pasteBorder={range:ze,prevBorder:V.model.allowCellFormatting&&V.XLFormat.getHashCodeClassAsArray(ze)},He)for(f=[],V.isPasteValuesOnly||V.XLFormat.removeStyle(X,{border:!0,cellStyle:!0,format:!0}),p=0,_=Le.length;p<_;p++)m=Le[p],a=Re[p].rowIndex,d=Re[p].colIndex,f=V.XLEdit.getPropertyValue(a,d,"borders",this._copyRange[0]),V.isUndefined(f)||V.XLFormat.applyBorder(f,[m.rowIndex,m.colIndex,m.rowIndex,m.colIndex]);for(G=V._getContTBody(se).find("rows"),de=0,Ge=te.length;de<Ge;de++){for(he=0,We=(ie=te[de].split("\t")).length;he<We;he++){if($=G[V._getRowIdx(je+de)]?V.getCell(je+de,Ve+he)[0]:void 0,t.isNullOrUndefined($)?(Qe.colCount<=Ve+he?V.XLScroll._createNewColumn(se,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"insert"):V.model.scrollSettings.allowScrolling&&!V.model.scrollSettings.allowVirtualScrolling&&V.XLScroll._createNewRow(se,-1,-1,"insert"),V.XLScroll._refreshScroller(se,"refresh","all"),$=V.getCell(je+de,Ve+he)):$=e($),(Z={rowIndex:je+de,colIndex:Ve+he}).prevObj=t.isNullOrUndefined(Be.sheets[se][je+de])?{}:e.extend(!0,{},Be.sheets[se][je+de][Ve+he]),t.isNullOrUndefined(Z.prevObj)||(delete Z.prevObj.isMHide,delete Z.prevObj.mergeIdx,t.isNullOrUndefined(Z.prevObj.cellType)||(Z.prevObj.cTypeObj=Be.sheetCellType[Z.prevObj.cellType])),this._isCut&&le)return;if(B={rowIndex:je+de,colIndex:Ve+he},this._isSpecial&&le)if(a=B.rowIndex,d=B.colIndex,h=Re[Ne].rowIndex,qe=V._dataContainer.hashCode[this._copyBackup.cells[Ne].format],"merge"in this._copyBackup.cells[Ne].cell||t.isNullOrUndefined(qe)||V.addClass($,qe),J=e.extend(!0,{},this._copyBackup.cells[Ne].cell),a in Be.sheets[se]||(Be.sheets[se][a]={}),d in Be.sheets[se][a]?"comment"in Be.sheets[se][a][d]&&V.getCell(a,d).removeClass("e-commentcell"):Be.sheets[se][a][d]={},J){if(b=e.extend(!0,{},V.XLEdit.getPropertyValue(a,d,"merge")),C=V.XLEdit.getPropertyValue(a,d,"isMHide"),S=e.extend(!0,{},V.XLEdit.getPropertyValue(a,d,"mergeIdx")),delete J.overflow,delete J.isOverflow,delete J.tableName,delete J.isReadOnly,delete J.isLocked,"wrap"in J&&(J.wrap=""),e.extend(!0,Be.sheets[se][a][d],J),x=Be.sheets[se][a][d],V.getObjectLength(b)?x.merge=b:delete x.merge,V.getObjectLength(S)?x.mergeIdx=S:delete x.mergeIdx,V.isUndefined(C)?delete x.isMHide:x.isMHide=C,V.XLEdit.getPropertyValue(a,d,"value2")&&(V._textClip(a,d,"delete"),V._textClip(a,d,"add")),o=J.value2&&"string"==typeof J.value2&&!J.formatStr?"="===Be.sharedData[J.value][0]?Be.sharedData[J.value]:J.value2:Be.sharedData[J.value],3===J.type&&(o=this._getUpdatedCellFormula(o,this._copyCells[Ne],{rowIdx:a,colIdx:d})),!("merge"in J)){if(V._dupDetails=!0,v={cellIndex:B,value:o,prevValue:V._getCellValue(B.rowIndex,B.colIndex).value,sheetIdx:se,reqType:"paste"},V._trigger("cellSave",v))return;V._saveTriggered=!0,V.XLEdit._updateCellValue(v.cellIndex,v.value,null,null,J.cellType),V._saveTriggered=!1,V._dupDetails=!1,H=V.XLEdit.getPropertyValue(h,0,"copy-paste"===ee.reqType?"cHeight":"pHeight",this._copyRange[0]),V.isUndefined(H)||(V.XLEdit._updateDataContainer({rowIndex:v.cellIndex.rowIndex,colIndex:0},{dataObj:{pHeight:V.getSheet(se).rowsHeightCollection[B.rowIndex],cHeight:H}}),V.getSheet(se).rowsHeightCollection[B.rowIndex]=H,V._isRowViewable(se,B.rowIndex)&&(V.getRows(se)[1][V._getRowIdx(B.rowIndex)].style.height=H+"px"))}if("merge"in J){w=0,b=J.merge;var tt,it=(Ie=V.getRangeIndices(b.mRange))[2]-Ie[0],rt=Ie[3]-Ie[1],lt=V.getSheet(se)._selectedCells,nt=V._getAlphaRange(se,Z.rowIndex,Z.colIndex,Z.rowIndex+it,Z.colIndex+rt),st=De.rowIndex-Ee.rowIndex,ot=De.colIndex-Ee.colIndex;if(I=V._getSelectedRange({rowIndex:Z.rowIndex,colIndex:Z.colIndex},{rowIndex:Z.rowIndex+it,colIndex:Z.colIndex+rt}),!(Re.length>=lt.length||(ot+1)%(rt+1)!=0||(st+1)%(it+1)!=0))return(D=e.extend(!0,{},J)).value=D.value2=o,t.isNullOrUndefined(qe)||V.getCell(Ie[0],Ie[1],this._copyRange[0]).addClass(qe),V.XLEdit._updateDataContainer({rowIndex:Ie[0],colIndex:Ie[1]},{dataObj:D}),void V._showAlertDlg("Alert","MergeAlert","",250);for(ce=0,ue=I.length;ce<ue;ce++)t.isNullOrUndefined(V.XLEdit.getPropertyValue(I[ce].rowIndex,I[ce].colIndex,"isMHide"))&&(y=V.XLEdit.getPropertyValue(I[ce].rowIndex,I[ce].colIndex,"merge"),w++,t.isNullOrUndefined(y)||(y&&(T=y.mSpan.rowSpan,L=y.mSpan.colSpan),t.isNullOrUndefined(T)||t.isNullOrUndefined(L)||(w+=parseInt(T)*parseInt(L)-1),y.isCenterAlign&&V._isRowViewable(se,I[ce].rowIndex)&&V.getCell(I[ce].rowIndex,I[ce].colIndex).addClass("e-calign").removeClass("e-ralign")));if(I.length===w&&Xe){for(R=!1,E=V._dataContainer.sheets[et],O=(tt=V._getSelectedCells(et,b.mRange).range)[0];O<=tt[2];O++)for(F=tt[1];F<=tt[3];F++)V._isRowViewable(et,O)&&V.getCell(O,F,et).text(""),t.isNullOrUndefined(E[O])&&(E[O]={}),t.isNullOrUndefined(E[O][F])&&(E[O][F]={}),R?(E[O][F].isMHide=!0,E[O][F].mergeIdx={rowIndex:Ie[0],colIndex:Ie[1]}):(E[O][F].merge=b,R=!0);V.setActiveSheetIndex(et),V._unMergeAllCells(this._copyRange[0],0,V._getSelectedRange({rowIndex:Ie[0],colIndex:Ie[1]},{rowIndex:Ie[2],colIndex:Ie[3]}),[],0,0),V.setActiveSheetIndex(se)}V._paste=!0,V._dupDetails=!0,V.isUndefined(Z.prevObj.merge)||V.unmergeCells(Z.prevObj.merge.mRange),V.unmergeCells(nt),V.mergeCenter=b.isCenterAlign,V.isUndefined(tt)||"1"!==tt?V.mergeCells(nt,!0):V.mergeAcrossCells(nt,!0),V._dupDetails=!1,V.XLEdit._updateCellValue(B,o),t.isNullOrUndefined(qe)||V.addClass($,qe)}if("hyperlink"in J&&(s=J.hyperlink,$&&(s&&!s.webAddr?$.html(t.buildTag("a.e-hyperlinks",V.XLEdit.getPropertyValue(a,d,"value2"),"",{href:"#"})):$.html(t.buildTag("a.e-hyperlinks",V.XLEdit.getPropertyValue(a,d,"value2"),"",{href:s.webAddr,target:"_blank"})))),"comment"in J&&(V._removeClass($,"e-commentcell"),V.XLComment.setComment([a,d,a,d],null,!1)),"cFormatRule"in J)for(pe=e.extend(!0,[],J.cFormatRule),J.cFormatRule=[],ce=0,ue=pe.length;ce<ue;ce++)me=V._dataContainer.cFormatData[pe[ce]].split("_"),V.XLCFormat._cFormat(me[0],me[2],me[3],me[4],me[5],null,null,[a,d,a,d],"paste",this._copyCells[Ne]);if(V._isPaste=!0,"wrap"in J&&(V._dupDetails=!0,ge=V._generateHeaderText(d+1)+(a+1),V.setWrapText("wrap",ge+":"+ge),V._dupDetails=!1),"cellType"in J){for(delete(q=e.extend(!0,{},V._dataContainer.sheetCellType[J.cellType])).id,delete q.value,delete q.selectedIndex,delete q.text,"DropDownList"!==q.type&&(q.text=""),N=V.getAlphaRange(a,d),ce=0;ce<Qe.cellTypes.length;ce++)if(Qe.cellTypes[ce].range==N){Qe.cellTypes.splice(ce,1);break}V.XLEdit._clearDataContainer({cellIdx:{rowIndex:a,colIndex:d},property:["cellType"]}),V.model.allowCellType&&V.XLCellType._renderControls(a,d,se,q,!1)}if(V.model.allowSparkline&&"sparkline"in J&&V.XLSparkline._refreshSparklineClipboard(a,d,se,et,this._copyCells.length),V._isPaste=!0,"picture"in J)for(delete x.picture,ce=0,ue=J.picture.length;ce<ue;ce++)ie=He?this._copyCells[Ne]:this._cutCells[Ne],ye=this._copyBackup.actCellPos,be=V.getRangeData([ie.rowIndex,ie.colIndex,ie.rowIndex,ie.colIndex],"","",this._copyRange[0])[0],(!V.isUndefined(be.picture)&&be.picture.indexOf(J.picture[ce])>-1||!He)&&(e.extend(!0,Ae,Ze.picture[J.picture[ce]]),_e=V.element.find("#"+Ae.id),Ae.rowIndex===ie.rowIndex&&Ae.colIndex===ie.colIndex&&((qe=(_e=V.element.find("#"+Ae.id))[0].className).indexOf("e-shapebdr")>-1?(ve=(xe=(qe=_e[0].className.match(Pe)[0]).replace("e-shapebdr","").split("N"))[2],V.XLShape._createPicture(se,B,Ze.sharedPics[Ae.data],parseInt(_e.css("top"))-ye.top+$e[0].offsetTop,parseInt(_e.css("left"))-ye.left+$e[0].offsetLeft,Ae.width,Ae.height,null,"#"+ve,ke[parseInt(xe[1])-1],xe[0]+"px")):V.XLShape._createPicture(se,B,Ze.sharedPics[Ae.data],parseInt(_e.css("top"))-ye.top+$e[0].offsetTop,parseInt(_e.css("left"))-ye.left+$e[0].offsetLeft,Ae.width,Ae.height),this._copyRange[0]===se&&(Be.sheets[se][je+de][Ve+he].picture[ce]=V.getObjectKeys(Ze.picture)[V.getObjectLength(Ze.picture)-1]),Xe&&_e.remove()));if("chart"in J)for(delete x.chart,be=V.getRangeData([a,d,a,d]),ce=0,ue=J.chart.length;ce<ue;ce++)ie=He?this._copyCells[Ne]:this._cutCells[Ne],ye=this._copyBackup.actCellPos,be=V.getRangeData([ie.rowIndex,ie.colIndex,ie.rowIndex,ie.colIndex])[0],(!V.isUndefined(be.chart)&&be.chart.indexOf(J.chart[ce])>-1||!He)&&(e.extend(!0,Ae,Ze.chart[J.chart[ce]]),_e=V.element.find("#"+Ae.id),Ae.rowIndex===ie.rowIndex&&Ae.colIndex===ie.colIndex&&(Ae.isChartSeries||(Ie=Ae.range,(Ie=V._getAlphaRange(se,Ie[0],Ie[1],Ie[2],Ie[3])).indexOf(":")<0&&(Ie=Ie+":"+Ie)),Ae.top=parseInt(_e.css("top"))-ye.top+$e[0].offsetTop,Ae.left=parseInt(_e.css("left"))-ye.left+$e[0].offsetLeft,V.XLChart.createChart(Ae.isChartSeries?null:Ie,Ae),Be.sheets[se][je+de][Ve+he].chart[ce]=V.getObjectKeys(Ze.chart)[V.getObjectLength(Ze.chart)-1],Xe&&_e.remove()));"rule"in J&&"list"===J.rule.type&&V._setddlCell(),V._isPaste=!1}else V.XLEdit._updateCellValue(B,""),t.isNullOrUndefined(Be.sheets[se][a])||delete Be.sheets[se][a][d];else"time"==(U=V.XLEdit._parseValue(ie[he],B)).type||"datetime"==U.type?(W=V._dateToInt(U.value),V.XLEdit._updateCellValue(B,W)):V.XLEdit._updateCellValue(B,U.value),ie[he].indexOf("=")>-1&&V.XLEdit._updateCellValue(B,$.html());Ne++,Z.newObj=t.isNullOrUndefined(Be.sheets[se][je+de])?{}:e.extend(!0,{},Be.sheets[se][je+de][Ve+he]),t.isNullOrUndefined(Z.newObj)&&(Z.newObj={}),Z.prevObj.cTypeObj&&(Z.prevObj.selIdxChange=V._isSelIdxChange),n.push(Z)}t.isNullOrUndefined($)||(V._setRowHdrHeight(se,V._getCellIdx($[0]).rowIndex),V.model.allowFreezing&&V.getSheet(se)._isFreezed&&V.XLFreeze._refreshFRowResize(V._getCellIdx($[0]).rowIndex))}if(V._hasFormulaArray=!1,V._hasMultipleFormulaArray=!1,te.length<1&&(de=1),Xe&&(this._isCut=Ke,this._cutCells=[],this._cData=""),this._formulaArrayPaste(),this._isSpecial&&le){for(A=this._copyBackup.table,k=V.getSheet(se).tableManager,Ie=V.getRangeIndices(this._copyRange[1]),ce=0,ue=A.length;ce<ue;ce++)Se=this._copyBackup.table[ce].range,P=e.extend(!0,{},this._copyBackup.table[ce].tblObj),this._copyBackup.copypaste&&(P.name="Table"+V._tableCnt),V._dupDetails=!0,V.XLFormat.createTable(P,V._getAlphaRange(this._copyRange[0],Se[0]+je-Ie[0],Se[1]+Ve-Ie[1],je-Ie[0]+Se[2],Ve-Ie[1]+Se[3])),V._dupDetails=!1,j=this._isCut?P.tblId:this.XLObj.getObjectLength(k),ae.push(k[j]),ae[ce].id=j,ae[ce].totalRow&&V.XLFormat._updateTotalRow(se,ae[ce].id,A[0].tblObj.fnNumber,ae[ce].range,!0);ze=[je,Ve,de+je-1,he+Ve-1],Xe&&this._copyBackup.filterRange.length>0&&this._copyRange[0]===se&&(M=this._copyBackup.filterRange,V.XLFilter.clearFilter(),fe=V._generateHeaderText(M[1]+Ve-Ie[1]+1)+(M[0]+je-Ie[0]+1)+":"+V._generateHeaderText(Ve-Ie[1]+M[3]+1)+(je-Ie[0]+M[2]+1),V.XLFilter.filter(fe)),ee.pasteBorder.newBorder=V.model.allowCellFormatting&&V.XLFormat.getHashCodeClassAsArray(ze),V.setActiveSheetIndex(this._copyRange[0]),ee.cutBorder.newBorder=V.model.allowCellFormatting&&V.XLFormat.getHashCodeClassAsArray(Ie),V.setActiveSheetIndex(se)}if(ee.pfat={table:this._copyBackup.table,range:Ie,minRowIdx:je,minColIdx:Ve,ptable:ae},ee.pfilter=fe,ee.pasteCells=n,V.XLSelection.selectRange({rowIndex:je,colIndex:Ve},{rowIndex:de+je-1,colIndex:he+Ve-1}),V.getSheet(se)._startCell={rowIndex:je,colIndex:Ve},V.getSheet(se)._endCell={rowIndex:de+je-1,colIndex:he+Ve-1},V.model.allowAutoFill&&V.XLDragFill.positionAutoFillElement(),ee.sheetIndex=se,V._setSheetFocus(),V.model.showRibbon&&V.XLRibbon._updateRibbonIcons(),"cut-paste"===(z={sheetIndex:ee.sheetIndex,pasteCells:ee.pasteCells,reqType:ee.reqType,isSpecial:ee.isSpecial,cutCells:ee.cutCells,pasteSheetIndex:ee.pSheetIndex,isHighlightData:ee.isHighlightData}).reqType?z.cutSheetIndex=ee.cSheetIndex:z.copySheetIndex=ee.cSheetIndex,V._isUndoRedo||(V._completeAction(ee),V._trigActionComplete(z)),z.isHighlightData&&!z.isSpecial&&(V._pushHighlightData([z.pasteCells[0].rowIndex,z.pasteCells[0].colIndex,z.pasteCells[z.pasteCells.length-1].rowIndex,z.pasteCells[z.pasteCells.length-1].colIndex]),this._highLightRange.length&&"hl-data"!=oe.operation)){for(de=0,Ge=this._highLightRange.length;de<Ge;de++)V.XLValidate.highlightInvalidData(this._highLightRange[de]);this._highLightRange=[]}we=ee.cutCells.length<1?je:ee.cutCells[0].rowIndex,V.XLScroll._getRowHeights(se,je<we?je>0?je-1:0:we>0?we-1:0)}V._isPaste=!1,this._isCut=!1,V.XLSelection._refreshBorder(),V.model.allowAutoFill&&V.XLDragFill.positionAutoFillElement(),V.getSheet(se)._isFreezed&&V.XLFreeze._refreshSelection()}else V._showAlertDlg("Alert","FullSheetCopyPasteAlert","",375);V._isCopyPaste=!1}}},_formulaArrayPaste:function(){for(var e,t,i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L=this.XLObj,R=L.getActiveSheetIndex(),O=0,F=0,E=0,D=0,N=L.getObjectKeys(this._copyRnge),A=0,P=N.length;A<P;A++)for(_=this._copyRnge[N[A]],e=L.getSheet(R)._startCell,t=L.getSheet(R)._endCell,b=[i=e.rowIndex<t.rowIndex?e.rowIndex:t.rowIndex,r=e.colIndex<t.colIndex?e.colIndex:t.colIndex,i+((f=L.swapRange(L.getRangeIndices(N[A])))[2]-f[0]),r+(f[3]-f[1])],n=L._getSelectedRange({rowIndex:b[0],colIndex:b[1]},{rowIndex:b[2],colIndex:b[3]}),s=L.getAlphaRange(n[0].rowIndex,n[0].colIndex,n[n.length-1].rowIndex,n[n.length-1].colIndex),a=0;a<_.length;a++)if(L._hasFormulaArray=!0,L._hasMultipleFormulaArray=!0,0==a){for(d=N[A],p=L.getRangeIndices(d),h=L.getSheet(R).formulaRange[d],u=(o=L.XLDragFill._parseFormula(h))[0]+":"+o[o.length-1],g=L.getRangeIndices(u),this._isCut||(g[0]<p[0]?O=p[0]-g[0]:g[0]>p[0]&&(O=g[0]-p[0]),g[1]<p[1]?D=p[1]-g[1]:g[1]>p[1]&&(D=g[1]-p[1]),C=L._getAlphaRange(R,n[a].rowIndex,n[a].colIndex,n[a].rowIndex,n[a].colIndex),S=L.getRangeIndices(C),g[0]<S[0]?F=S[0]-g[0]:g[0]>S[0]&&(F=g[0]-S[0]),g[1]<S[1]?E=S[1]-g[1]:g[1]>S[1]&&(E=g[1]-S[1])),x=F-O,v=E-D,l=0;l<o.length;l++)w=o[l].trim(),L._isCellReference(w)&&(y=(I=L.getRangeIndices(w))[0]+x,T=I[1]+v,c=L._getAlphaRange(R,y,T,y,T),o[l]=c);m="="+o.join(""),L.getSheet(R).formulaRange[s]=m,L.XLEdit._updateCellValue({rowIndex:n[a].rowIndex,colIndex:n[a].colIndex},m)}else L.XLEdit._updateCellValue({rowIndex:n[a].rowIndex,colIndex:n[a].colIndex},m);this._copyRnge={}},_getUpdatedCellFormula:function(e,t,i){for(var r,l,n,s=this.XLObj,o=/([A-Z].*?[0-9])/g,a=i.rowIdx-t.rowIndex,d=i.colIdx-t.colIndex,h=s.XLDragFill._parseFormula(e),c=0,u=h.length;c<u;c++)h[c].match(o)&&(r=h[c].trim().match(/(\d+|\D+)/g),l=s._generateColCount(r[0])+d,n=parseInt(r[1])+a,h[c]=n>0&&l>0?s._generateHeaderText(l)+n.toString():"#REF!");return"="+(h=h.join(""))},_compareRange:function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[2]&&e[3]>=t[3]},_cutPasteBorder:function(e,t){var i,r,l,n,s,o,a,d=this.XLObj,h=d.getActiveSheetIndex(),c=[];for(d.isPasteValuesOnly||d.XLFormat.removeStyle(t,{cellStyle:!0,border:!0,format:!0,sheetIdx:h}),o=d._getSelectedRange({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[2],colIndex:e[3]}),i=0,s=(a=d._getSelectedRange({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]})).length;i<s;i++)r=a[i],n=o[i].rowIndex,l=o[i].colIndex,c=d.XLEdit.getPropertyValue(n,l,"borders",this._copyRange[0]),d.isUndefined(c)||d.XLFormat.applyBorder(c,[r.rowIndex,r.colIndex,r.rowIndex,r.colIndex]);d.setActiveSheetIndex(this._copyRange[0]),d.XLFormat.removeStyle(e,{cellStyle:!0,border:!0,format:!0}),d.setActiveSheetIndex(h)}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.comments=function(e){this.XLObj=e,this._isCommentEdit=!1,this._isShowAllComments=!1,this._curCommentHCell=null},t.spreadsheetFeatures.comments.prototype={setComment:function(e,i,r,l){var n,s,o=this.XLObj;if(o.model.allowComments&&!o.model.isReadOnly&&!o.model.isGridMode&&(s={sheetIndex:n=o.getActiveSheetIndex(),reqType:"comment",type:"actionBegin",action:"createcomment"},!o._trigActionBegin(s))){var a,d,h,c,u,g,p,m,_,f=!1,b=o.getSheet(n),C=[],S={sheetIndex:n,reqType:"comment"};if(o.model.allowLockCell&&b.isSheetProtected)return!1;if(e)h={rowIndex:c=(a=o._getRangeArgs(e,"object"))[0],colIndex:u=a[1]};else{if(!o.model.allowSelection)return;c=(h=o.getActiveCell(n)).rowIndex,u=h.colIndex}if(s={reqType:"beforeEditComment",cellIndex:h,value:i,sheetIdx:n,disable:!1},o._trigger("beforeEditComment",s)&&(s.disable=!0),i=s.value,!o._isCellProtected(c,u,!1)){if(!o.isUndefined(o.XLEdit.getPropertyValue(c,u,"cellType")))return void o._showAlertDlg("Alert","CellTypeAlert","CellTypeAlert",372);o.model.showRibbon&&(!o._isPaste||!o.XLClipboard._cutCells.length)&&o._commentCount++,o._isRibbonClick||(S.action="add",C.push(h),S.selectedCell=C,S.selectedCell[0].prevComment=o.XLEdit.getPropertyValue(c,u,"comment")),o._isAutoWHMode||o.XLClipboard._copyCells.length||b._isFreezed||o.XLScroll._scrollSelectedPosition(n,h),c in b._commentColl||(b._commentColl[c]={}),b._commentColl[c][u]={isComment:!0},r=!!t.isNullOrUndefined(r)||r,l=!!t.isNullOrUndefined(l)||l,m=(o.model.userName.length>0?o.model.userName:o._getLocStr("UserName"))+":\n",t.isNullOrUndefined(i)?s.disable&&o.XLEdit._updateDataContainer(h,{dataObj:{comment:{value:m,isVisible:t.isNullOrUndefined(o.XLEdit.getPropertyValue(c,u,"comment",n))?r:o.XLEdit.getPropertyValue(c,u,"comment",n).isVisible}}}):(l&&(i=m+i),o.XLEdit._updateDataContainer(h,{dataObj:{comment:{value:i,isVisible:t.isNullOrUndefined(o.XLEdit.getPropertyValue(c,u,"comment",n))?r:o.XLEdit.getPropertyValue(c,u,"comment",n).isVisible}}})),g=t.isNullOrUndefined(o.XLEdit.getPropertyValue(c,u,"comment",n))?(o.model.userName.length>0?o.model.userName:o._getLocStr("UserName"))+":\n":o.XLEdit.getPropertyValue(c,u,"comment",n).value,!o.model.allowComments||o.XLEdit._isEdit||o._isSheetRename||(o._isRowViewable(n,c)&&c<b._bottomRow.idx&&((d=o.getCell(c,u)).prepend(t.buildTag("span.e-comment",t.buildTag("span.e-celltoparrow")).append(t.buildTag("textarea.e-comment-txtarea",g,{"z-index":10,"text-align":"left"}))).addClass("e-commentcell"),this._updateCmntArrowPos(d),p=d.find(".e-comment-txtarea"),this._updateCmtAreaPos(d,p),p.focus().setInputPos(p.val().length),f=!0,s.disable&&(p[0].disabled=!0)),(!b._isImported||b._isLoaded)&&(_=o.XLEdit.getPropertyValue(c,u,"comment",n),t.isNullOrUndefined(_)||(_.value=g)),r&&f?(p.focus(),!this._curCommentHCell||t.isNullOrUndefined(o.XLEdit.getPropertyValueByElem(this._curCommentHCell,"comment"))||o.XLEdit.getPropertyValueByElem(this._curCommentHCell,"comment").isVisible||(this._curCommentHCell.find(".e-comment-txtarea").hide(),this._curCommentHCell=null),o.model.allowDragAndDrop&&!o.XLDragDrop._isDragAndDropped&&this._updateCurrentCell(c,u),s.disable?this._updateCmntRibIcons():(this._isCommentEdit=!0,o.model.showRibbon&&o.XLRibbon._disableRibbonIcons())):f&&(this._isShowAllComments||o.XLEdit.getPropertyValue(c,u,"comment",n).isVisible||p.hide(),o.model.showRibbon&&(!b._isImported||b._isLoaded)&&o.model.allowDragAndDrop&&!o.XLDragDrop._isDragAndDropped&&this._updateCmntRibIcons(o.XLClipboard._isSpecial?o.getActiveCell():{rowIndex:c,colIndex:u})),o._isRibbonClick||o._isUndoRedo||o._hasComment||o._isExport||o._dupDetails||(S.selectedCell[0].curComment=o.XLEdit.getPropertyValue(c,u,"comment"),S.showUserName=l,S.showEditPanel=r,o._completeAction(S),o._trigActionComplete(S)))}}},_updateCmtAreaPos:function(e,t){var i=this.XLObj,r=i.getActiveSheetIndex(),l=i._getContent(r).find("#hscrollBar").offset(),n=i._getContent(r).find("#vscrollBar").offset(),s=i._getJSSheetHeader(r).offset(),o=t.offset(),a=t.height(),d=t.width();i.model.scrollSettings.allowScrolling&&(o.top+a+5>l.top&&o.left+d<n.left?t.css({top:-77}):o.left+d>n.left&&o.top+a+5>l.top?t.css({left:-136,top:-81}):o.top+a>s.top&&o.left+d>n.left&&t.css({left:-137,top:e.height()+8}))},deleteComment:function(e,i,r,l){var n,s,o,a=this.XLObj;if(a.model.allowComments&&!a.model.isReadOnly&&!a.model.isGridMode&&(s={range:e,sheetIndex:n=i||a.getActiveSheetIndex(),reqType:t.isNullOrUndefined(l)?"comment":"clear-comment",type:"actionBegin",action:t.isNullOrUndefined(l)?"delete":"clear-comment"},!a._trigActionBegin(s))){var d,h,c,u,g=[],p=[],m={sheetIndex:n,reqType:"comment",action:"delete",range:s.range};for(e=a._getRangeArgs(s.range,"object"),u=a._getSelectedCells(i,e).selCells,o=0;o<u.length;o++)a.XLEdit.getPropertyValue(u[o].rowIndex,u[o].colIndex,"comment",i)&&g.push(u[o]);if(a.model.allowComments){for(o=0;o<u.length;o++)if(d=u[o].rowIndex,h=u[o].colIndex,c=a.XLEdit.getPropertyValue(d,h,"comment",i),!t.isNullOrUndefined(c)){if(r&&a._isHiddenRow(d)){u.splice(o,1);continue}a.model.showRibbon&&a._commentCount&&a._commentCount--,p.push({rowIndex:d,colIndex:h,prevComment:c,currComment:{}}),a._isRowViewable(n,d)&&a.getCell(d,h,n).removeClass("e-commentcell").find(".e-comment").remove(),a.getSheet(n)._commentColl[d]&&delete a.getSheet(n)._commentColl[d][h],delete a._dataContainer.sheets[n][d][h].comment}m.selectedCell=p,a.model.showRibbon&&g.length&&a.model.allowDragAndDrop&&!a.XLDragDrop._isDragAndDropped&&a.XLComment._updateCmntRibIcons(),m.reqType=t.isNullOrUndefined(l)?"comment":"clear-comment",a._isUndoRedo||a._dupDetails||(a._completeAction(m),a._trigActionComplete(m))}}},editComment:function(e){var i,r,l,n,s,o=this.XLObj;if(o.model.allowComments&&!o.model.isReadOnly&&!o.model.isGridMode&&(n={cellIndex:e,sheetIndex:r=o.getActiveSheetIndex(),reqType:"edit-comment",type:"actionBegin",action:"editcomment"},!o._trigActionBegin(n))){if(e=n.cellIndex,o.model.allowLockCell&&o.getSheet(r).isSheetProtected)return!1;t.isNullOrUndefined(e)&&(e=o.getActiveCell()),n={reqType:"beforeEditComment",cellIndex:e,value:(i=o.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"comment",r)).value,sheetIndex:r,isDisable:!1},o._trigger("beforeEditComment",n)&&(n.disable=!0),i.value=n.value,o.XLEdit._updateDataContainer(e,{dataObj:{comment:{value:i.value,isVisible:i.isVisible}}}),o.XLEdit._isEdit||o._isSheetRename||(o.model.allowComments&&(t.isNullOrUndefined(o.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"comment"))||(o._isAutoWHMode||o.XLScroll._scrollSelectedPosition(r,e),o._isRowViewable(r,e.rowIndex)&&((l=o.getCell(e.rowIndex,e.colIndex).find(".e-comment-txtarea")).text(n.data),l.css("display","inline-table").focus().setInputPos(l.text().length)),n.disable||(this._isCommentEdit=!0))),o.model.showRibbon&&!n.disable&&o.XLRibbon._disableRibbonIcons()),s={cellIndex:e,value:i.value,sheetIndex:r,reqType:"edit-comment",type:"actionComplete",action:"editcomment"},o._completeAction(s),o._trigActionComplete(s)}},showHideComment:function(e){var i=this.XLObj;if(i.model.allowComments&&!i.model.isReadOnly&&!i.model.isGridMode){var r,l,n,s=i.getActiveSheetIndex(),o=!1,a=!1;r=t.isNullOrUndefined(e)?i.getActiveCell():i._getCellIdx(e[0]),l=i.XLEdit.getPropertyValue(r.rowIndex,r.colIndex,"comment"),t.isNullOrUndefined(l)||(i._isRowViewable(s,r.rowIndex)&&(n=i.getCell(r.rowIndex,r.colIndex).find(".e-comment-txtarea"),o=!0),l.isVisible?(o&&n.hide(),a=!1):(o&&n.css("display","inline-table"),this._curCommentHCell=null,a=!0)),i.isUndefined(a)||(l.isVisible=a)}},showAllComments:function(){var t,i=this.XLObj;if(i.model.allowComments&&!i.model.isGridMode){for(var r,l,n,s,o,a,d=i.getActiveSheetIndex(),h=e("#"+i._id+"_Ribbon_Review_Comments_ShowAllComments").data("ejToggleButton"),c=["Review_Comments_PreviousComment","Review_Comments_NextComment"],u=1;u<=i.model.sheetCount;u++)for(s=i.getSheet(u)._commentColl,r=i.getObjectKeys(s),n=0;n<r.length;n++){for(l=i.getObjectKeys(s[r[n]]),t=0;t<l.length;t++)i._isRowViewable(d,parseInt(r[n]))&&(o=i.getCell(parseInt(r[n]),parseInt(l[t]),u).find(".e-comment-txtarea"),this._isShowAllComments?o.hide():o.css("display","inline-table")),i.XLEdit.getPropertyValue(r[n],l[t],"comment",u).isVisible=!this._isShowAllComments;0==n&&(a=!0)}this._isShowAllComments=!this._isShowAllComments,i.model.showRibbon&&h&&h.model.toggleState?i.XLRibbon._disableButtons(c,"ejButton"):i.model.showRibbon&&a&&i.XLRibbon._enableButtons(c,"ejButton")}},findPrevComment:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m=this.XLObj;if(m.model.allowComments&&!m.model.isReadOnly&&!m.model.isGridMode){for(i=m.getActiveSheetIndex(),u=e("#"+m._id+"_Ribbon_Review_Comments_NewComment"),a=i;a>0;a--)if(r=m.getSheet(a),m.getObjectLength(r._commentColl))for(a!==i&&m.gotoPage(a,!1),m.model.showRibbon&&((p=m.XLRibbon._getTabIndex("review"))&&e("#"+m._id+"_Ribbon").ejRibbon("option","selectedItemIndex",p)),l=r.rowCount-1,n=r.colCount-1,a!==i&&this._updateCurrentCell(l-1,n-1),s=r._activeCell.rowIndex,o=r._activeCell.colIndex,d=s;d>=0;d--)for(d!==s&&(o=n-1),h=o;h>=0;h--)if(m.XLEdit.getPropertyValue(d,h,"comment",i)&&(r._hiddenFreezeRows.indexOf(d)>-1&&r._isFreezed?m.XLSearch._freezeScroll(d,h,r):m._isRowViewable(i,d)||m._scrollContent({y:m._getRowOffsetTop(r,d)},!0)),m._isRowViewable(i,d)){if(c=e(m.getCell(d,h)),g=e(c.find(".e-comment-txtarea")),r._activeCell.rowIndex!==d&&r._activeCell.colIndex!==h&&!t.isNullOrUndefined(m.XLEdit.getPropertyValueByElem(c,"comment"))&&m.XLEdit.getPropertyValueByElem(c,"comment").isVisible&&g.hide(),c.hasClass("e-commentcell")&&!g.is(":visible"))return g.css("display","inline-table").focus()&&this._updateCurrentCell(d,h),this._updateCommentsBtns(u),m._setSheetFocus(),!0;this._isShowAllComments||this._isCommentEdit||!c.hasClass("e-commentcell")||m.XLEdit.getPropertyValueByElem(c,"comment").isVisible||g.hide()}0===a&&m._showAlertDlg("","CommentFindEndAlert","findPrevComment",630)}},_updateCommentsBtns:function(e){var t=this.XLObj;t.model.showRibbon&&(t.XLRibbon._enableButtons(["Review_Comments_DeleteComment","Review_Comments_ShowHideComment"],"ejButton"),e.find(".e-icon").removeClass("e-ssr-newcmnt").addClass("e-ssr-editcmnt"),e.find(".e-btntxt").text(t._getLocStr("EditComment")))},findNextComment:function(){var i=this.XLObj;if(i.model.allowComments&&!i.model.isReadOnly&&!i.model.isGridMode){for(var r,l,n,s,o,a,d,h,c,u,g=!1,p=i.getActiveSheetIndex(),m=e("#"+i._id+"_Ribbon_Review_Comments_NewComment"),_=p;_<=i.model.sheetCount;_++)if(r=i.getSheet(_),i.getObjectLength(r._commentColl))for(_!==p&&i.gotoPage(_,!1),i.model.showRibbon&&((u=i.XLRibbon._getTabIndex("review"))&&e("#"+i._id+"_Ribbon").ejRibbon("option","selectedItemIndex",u)),_!==p&&this._updateCurrentCell(0,0),l=r._activeCell.rowIndex,n=r._activeCell.colIndex,s=r.rowCount-1,o=r.colCount-1,a=l;a<s;a++)for(a!==l&&(n=0),d=n;d<o;d++){if(i.XLEdit.getPropertyValue(a,d,"comment",p)&&(r._isFreezed?i.XLSearch._freezeScroll(a,d,r):i._isRowViewable(p,a)||i._scrollContent({y:i._getRowOffsetTop(r,a)},!0),g=!i.getActiveCellElem()),i._isRowViewable(p,a)&&(h=e(i.getCell(a,d)),c=e(h.find(".e-comment-txtarea")),g||i.getActiveCellElem()[0]===h[0]||t.isNullOrUndefined(i.XLEdit.getPropertyValueByElem(h,"comment"))||!i.XLEdit.getPropertyValueByElem(h,"comment").isVisible||c.hide(),h.hasClass("e-commentcell")&&!c.is(":visible")))return c.css("display","inline-table").focus(),this._updateCurrentCell(a,d),this._updateCommentsBtns(m),i._setSheetFocus(),!0;this._isShowAllComments||this._isCommentEdit||!h.hasClass("e-commentcell")||i.XLEdit.getPropertyValueByElem(h,"comment").isVisible||c.hide()}_===i.model.sheetCount+1&&i._showAlertDlg("","CommentFindEndAlert","findNextComment",630)}},_commentMouseMove:function(i){var r,l,n,s=this.XLObj;(r="TD"===i.target.tagName?e(i.target):e(i.target).parent("td")).length&&(l=r.find(".e-comment-txtarea"),this._isCommentEdit||(t.isNullOrUndefined(this._curCommentHCell)||r!==this._curCommentHCell&&(n=s.XLEdit.getPropertyValueByElem(this._curCommentHCell,"comment"),t.isNullOrUndefined(n)||n.isVisible||(this._curCommentHCell.find(".e-comment-txtarea").hide(),this._curCommentHCell=null)),"TD"===r[0].tagName&&r.hasClass("e-commentcell")&&(l.css("display","inline-table"),this._curCommentHCell=r)))},_commentMouseDownHandler:function(t){var i,r,l,n=this.XLObj,s=n.getActiveCell(),o=n.getActiveSheetIndex();n._isRowViewable(o,s.rowIndex)&&(i=n.getCell(s.rowIndex,s.colIndex,o),l=e(i.find(".e-comment-txtarea")),i.hasClass("e-commentcell")&&l.get()[0]!==t.target&&(r=n.XLEdit.getPropertyValue(s.rowIndex,s.colIndex,"comment"),this._isCommentEdit&&this._updateCurCmntVal(s),this._isShowAllComments||n.isUndefined(r)||r.isVisible||l.hide())),n._hasClass(t.target,"e-comment-txtarea")&&!t.target.disabled&&(e(t.target).focus().css("z-index",10)&&(this._isCommentEdit=!0),this._updateCurrentCell(e(t.target).parents("td").parent().index(),e(t.target).parents("td").index()),n.model.showRibbon&&n.XLRibbon._disableRibbonIcons())},_updateCmntRibIcons:function(t){var i=this.XLObj,r=["Review_Comments_ShowHideComment","Review_Comments_DeleteComment"],l=i.getActiveSheetIndex(),n=e("#"+i._id+"_Ribbon_Review_Comments_NewComment"),s=i.getActiveCell(),o=i.getSheet(l),a=o._selectedCells,d=o.selectedRange;t=i.model.allowDragAndDrop&&!i.XLDragDrop._isDragAndDropped?t||s:{rowIndex:i._dStartCell.rowIndex,colIndex:i._dStartCell.colIndex},i.XLRibbon._enableButtons(["Review_Comments_NewComment"],"ejButton"),i.XLRibbon._enableButtons(i.XLRibbon._cmntTglBtnIds,"ejToggleButton"),i.XLEdit.getPropertyValue(t.rowIndex,t.colIndex,"comment",l)?(i.XLRibbon._enableButtons(r,"ejButton"),n.find(".e-icon").removeClass("e-ssr-newcmnt").addClass("e-ssr-editcmnt"),n.find(".e-btntxt").text(i._getLocStr("EditComment"))):(n.find(".e-icon").removeClass("e-ssr-editcmnt").addClass("e-ssr-newcmnt"),n.find(".e-btntxt").text(i._getLocStr("NewComment")),i.XLRibbon._disableButtons(r,"ejButton")),this._isShowAllComments||0===i._commentCount?i.XLRibbon._disableButtons(["Review_Comments_PreviousComment","Review_Comments_NextComment"],"ejButton"):i.XLRibbon._enableButtons(["Review_Comments_PreviousComment","Review_Comments_NextComment"],"ejButton"),a.length&&i.inRange(d,t.rowIndex,t.colIndex)&&i.XLEdit._rangeHasProperty(d,"comment")&&i.XLRibbon._enableButtons(["Review_Comments_DeleteComment"],"ejButton")},_updateCurCmntVal:function(e,i){i=t.isNullOrUndefined(i)?"":i;var r,l=this.XLObj,n=l.getActiveSheetIndex(),s=t.isNullOrUndefined(e)?l.getActiveCell():e,o=[],a="User Name:",d=!1,h={sheetIndex:n,reqType:"comment"},c=s.rowIndex,u=s.colIndex;l._isRowViewable(h.sheetIndex,c)&&(d=!0,(r=l.getCell(c,u,n).find(".e-comment-txtarea")).scrollTop(0)),o.push({rowIndex:c,colIndex:u}),h.action=t.isNullOrUndefined(l.XLEdit.getPropertyValue(c,u,"comment"))?"add":"edit",h.selectedCell=o,h.selectedCell[0].prevComment=l.XLEdit.getPropertyValue(c,u,"comment"),d&&(a=r.css("z-index",9).val()),l.XLEdit._updateDataContainer({rowIndex:c,colIndex:u},{dataObj:{comment:{value:a,isVisible:l.isUndefined(l.XLEdit.getPropertyValue(c,u,"comment"))?this._isShowAllComments:l.XLEdit.getPropertyValue(c,u,"comment").isVisible}}}),!d||this._isShowAllComments||l.XLEdit.getPropertyValue(c,u,"comment").isVisible||r.hide(),l._setSheetFocus(),this._isCommentEdit=!1,l.model.allowKeyboardNavigation&&(l.XLCellNav._isNavigate=!0),l.model.showRibbon&&l.XLRibbon._enableRibbonIcons(),l.XLEdit._updateUsedRange(c,u,n),h.selectedCell[0].curComment=l.XLEdit.getPropertyValue(c,u,"comment"),l._isUndoRedo||"paste"===i||(l._completeAction(h),l._trigActionComplete(h))},_updateCurrentCell:function(e,t,i){var r,l=this.XLObj,n={rowIndex:e,colIndex:t};i=i||l.model.activeSheetIndex,(r=l.getSheet(i))._activeCell=n,l.model.allowSelection&&l.XLSelection.selectRange(n,n,i),r._startCell=r._endCell=n,l.model.allowAutoFill&&l.XLDragFill.positionAutoFillElement()},_visibleCmntCnt:function(e,t){e.find(".e-comment")[t?"show":"hide"]()},_updateCmntArrowPos:function(t,i,r){var l,n,s,o,a,d,h,c,u=this.XLObj;if(i=u._getSheetIndex(i),h=u.getSheet(i),c=t||u._getContent(i).find(".e-commentcell"),r=r||{},u.model.allowComments)for(l=0,n=c.length;l<n;l++)if(d=e(c[l]),!((s=u._getCellIdx(d[0])).rowIndex<r.rowIndex||s.colIndex<r.colIndex)&&(a=d.find(".e-comment"),u._isInsdel&&(s.rowIndex in h._commentColl||(h._commentColl[s.rowIndex]={}),h._commentColl[s.rowIndex][s.colIndex]={isComment:!0}),a.length)){if(o=u._getCellInfo(s,i),h.columnsWidthCollection[s.colIndex]<5){a.hide();continue}a.is(":hidden")&&a.show(),a.css({top:o.top+"px",left:o.left+d.width()+"px"})}},_updateCmntFrmCntnr:function(e,t){var i=this.XLObj;i.XLEdit.getPropertyValue(e,t,"comment")&&(i._isRowViewable(null,t)&&i.getCell(e,t).hasClass("e-commentcell")&&this.deleteComment([e,t,e,t]),i._dupDetails=!0,this.setComment([e,t,e,t],null,!1),i._dupDetails=!1)}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.contextmenu=function(e){this.XLObj=e,this._clrFltrEnable=!1,this._isMenuOpened=!1,this._uniqueClass=e._id+"-cmenu",this._selColor="",this._changedDataSource=!1,this._modifyClick=!1,this._oldCustomName="",this._target="",this._rowCellMenuDataMobile=[{id:"Cut",text:e._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:e._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"PasteSpecial",text:e._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"FormatCells",text:e._getLocStr("FormatCells")+"...",parentId:null,spriteCssClass:"e-icon e-ss-formatcells"},{id:"BackgroundColor",text:e._getLocStr("BackgroundColor"),parentId:null,spriteCssClass:"e-icon e-ss-backgroundcolor"},{id:"FontColor",text:e._getLocStr("FontColor"),parentId:null,spriteCssClass:"e-icon e-ss-fontcolor"}],this._headerMenuDataMobile=[{id:"Cut",text:e._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:e._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"PasteSpecial",text:e._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"Insert",text:e._getLocStr("Insert"),parentId:null},{id:"Delete",text:e._getLocStr("Delete"),parentId:null},{id:"Hide",text:e._getLocStr("Hide"),parentId:null},{id:"Unhide",text:e._getLocStr("Unhide"),parentId:null}],this._rowCellMenuData=[{id:"Cut",text:e._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:e._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"Paste",text:e._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"PasteSpecial",text:e._getLocStr("PasteSpecial"),parentId:"Paste"},{id:"PasteValues",text:e._getLocStr("PasteValues"),parentId:"Paste"},{id:"Insert",text:e._getLocStr("Insert")+"...",parentId:null},{id:"Delete",text:e._getLocStr("Delete")+"...",parentId:null},{id:"Filter",text:e._getLocStr("Filter"),parentId:null,spriteCssClass:"e-icon e-ss-filter"},{id:"ClearFilter",parentId:"Filter",text:e._getLocStr("ClearFilter"),spriteCssClass:"e-icon e-ss-filternone"},{id:"FilterSelected",parentId:"Filter",text:e._getLocStr("FilterSelected"),spriteCssClass:"e-icon e-ss-filter"},{id:"Sort",text:e._getLocStr("Sort"),parentId:null,spriteCssClass:"e-icon e-ss-sortatoz"},{id:"SortAtoZ",parentId:"Sort",text:e._getLocStr("SortAtoZ"),spriteCssClass:"e-icon e-ss-sortatoz"},{id:"SortZtoA",parentId:"Sort",text:e._getLocStr("SortZtoA"),spriteCssClass:"e-icon e-ss-sortztoa"},{id:"PutCellColor",parentId:"Sort",text:e._getLocStr("PutCellColor"),spriteCssClass:""},{id:"PutFontColor",parentId:"Sort",text:e._getLocStr("PutFontColor"),spriteCssClass:""},{id:"ctxComment",parentId:null,text:e._getLocStr("Comment")},{id:"ctxInsrtCmnt",text:e._getLocStr("InsertComment"),parentId:"ctxComment",spriteCssClass:"e-icon e-ss-newcmnt"},{id:"ctxEditCmnt",text:e._getLocStr("EditComment"),parentId:"ctxComment",spriteCssClass:"e-icon e-ss-editcmnt"},{id:"ctxDeleteCmnt",text:e._getLocStr("DeleteComment"),parentId:"ctxComment",spriteCssClass:"e-icon e-ss-deletecmnt"},{id:"ctxShwHdCmnt",text:e._getLocStr("ShowHide"),parentId:"ctxComment",spriteCssClass:"e-icon"},{id:"FormatCells",text:e._getLocStr("FormatCells")+"...",parentId:null,spriteCssClass:"e-icon e-ss-formatcells"},{id:"CmHyperLink",text:e._getLocStr("HyperLink"),parentId:null,spriteCssClass:"e-icon e-ss-hyperlink"},{id:"HyperLink",text:e._getLocStr("HyperLink")+"...",parentId:"CmHyperLink",spriteCssClass:"e-icon e-ss-hyperlink"},{id:"EditLink",text:e._getLocStr("EditLink")+"...",parentId:"CmHyperLink"},{id:"OpenLink",text:e._getLocStr("OpenLink"),parentId:"CmHyperLink"},{id:"RemoveLink",text:e._getLocStr("RemoveLink"),parentId:"CmHyperLink",spriteCssClass:"e-icon e-ss-removelink"},{id:"ClearContents",text:e._getLocStr("ClearContents"),parentId:null,spriteCssClass:"e-icon e-ss-clear"}],this._rowHeaderMenuData=this._columnHeaderMenuData=[{id:"Cut",text:e._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:e._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"Paste",text:e._getLocStr("Paste"),parentId:null,spriteCssClass:"e-icon e-ss-paste"},{id:"PasteSpecial",text:e._getLocStr("PasteSpecial"),parentId:"Paste"},{id:"PasteValues",text:e._getLocStr("PasteValues"),parentId:"Paste"},{id:"Insert",text:e._getLocStr("Insert"),parentId:null},{id:"Delete",text:e._getLocStr("Delete"),parentId:null},{id:"ClearContents",text:e._getLocStr("ClearContents"),parentId:null,spriteCssClass:"e-icon e-ss-clear"},{id:"Hide",text:e._getLocStr("Hide"),parentId:null},{id:"Unhide",text:e._getLocStr("Unhide"),parentId:null}],this._footerMenuData=[{id:"InsertSheet",text:e._getLocStr("InsertSheet"),parentId:null},{id:"DeleteSheet",text:e._getLocStr("DeleteSheet"),parentId:null,spriteCssClass:"e-icon e-ss-delete"},{id:"RenameSheet",text:e._getLocStr("RenameSheet"),parentId:null,spriteCssClass:"e-icon "},{id:"MoveorCopy",text:e._getLocStr("MoveorCopy")+"...",parentId:null,spriteCssClass:"e-icon "},{id:"HideSheet",text:e._getLocStr("HideSheet"),parentId:null,spriteCssClass:"e-icon "},{id:"UnhideSheet",text:e._getLocStr("UnhideSheet"),parentId:null,spriteCssClass:"e-icon "},{id:"ProtectSheet",text:e._getLocStr("Protectsheet"),parentId:null,spriteCssClass:"e-icon e-ss-cmenuprotect"}],this._chartMenuData=[{id:"Cut",text:e._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:e._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"ChartType",text:e._getLocStr("ChangeChartType")+"...",parentId:null},{id:"SelectData",text:e._getLocStr("SelectData")+"...",parentId:null}],this._imgMenuData=[{id:"Cut",text:e._getLocStr("Cut"),parentId:null,spriteCssClass:"e-icon e-ss-cut"},{id:"Copy",text:e._getLocStr("Copy"),parentId:null,spriteCssClass:"e-icon e-ss-copy"},{id:"ChangePicture",text:e._getLocStr("ChangePicture"),parentId:null}],this._pivotMenuData=[{id:"Refresh",text:e._getLocStr("Refresh"),parentId:null,spriteCssClass:"e-icon e-ss-pivotrefresh"}],this._cellStylesMenuData=[{id:"Modify",text:e._getLocStr("Modify"),parentId:null},{id:"DeleteStyle",text:e._getLocStr("Delete"),parentId:null},{id:"Apply",text:e._getLocStr("Apply"),parentId:null}],this._protectRowMenuIds=["Insert","Delete","Filter","ctxComment","Sort","LockCells","CmHyperLink","FormatCells","ClearContents"],this._prtctHeaderIds=["Insert","Delete","Hide","Unhide","ClearContents"],this._footerIds=["InsertSheet","DeleteSheet","RenameSheet","MoveorCopy","HideSheet","UnhideSheet"]},t.Menu.prototype._calculateContextMenuPosition=function(t){var i,r,l,n,s=this.element.get(0).id,o=this.element.data("id"),a=e("#"+o).data("ejSpreadsheet");return this.element.css({top:"",left:""}),i=t.clientX+this.element.width()<e(window).width()?t.pageX:t.pageX-this.element.width(),l=a&&s.indexOf(o+"_contextMenuFooter")>-1?a.element.height():e(window).height(),r=t.clientY+this.element.height()<l?t.pageY:t.clientY>this.element.height()?t.pageY-this.element.height():l-this.element.outerHeight(),{X:i-=(n="static"!=e("body").css("position")?e("body").offset():{left:0,top:0}).left,Y:r-=n.top}},t.spreadsheetFeatures.contextmenu.prototype={_initContextMenu:function(){var e=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none",width:"auto"},{id:this.XLObj._id+"_contextMenuCell"});this._createMenu(e,this.XLObj._phoneMode||this.XLObj._tabMode?this._rowCellMenuDataMobile:this._rowCellMenuData,"#"+this.XLObj._id+" .e-spreadsheetcontentcontainer"),e=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuColumnHeader"}),this._createMenu(e,this._columnHeaderMenuData,"#"+this.XLObj._id+" .e-spreadsheetheader .e-headercontent"),e=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuRowHeader"}),this._createMenu(e,this._rowHeaderMenuData,"#"+this.XLObj._id+" .e-rowheadercontent"),this.XLObj.getObjectLength(this.XLObj._dataContainer.customCellStyle)>=1&&this._createMenu(t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuCellStyles"}),this._cellStylesMenuData,"  .e-cellstylecontent")},_initCMenuFooter:function(){var e=t.buildTag("ul .e-spreadsheet e-"+this._uniqueClass," ",{display:"none"},{id:this.XLObj._id+"_contextMenuFooter"});e.data("id",this.XLObj._id),this._createMenu(e,this._footerMenuData,"#"+this.XLObj._id+" .e-pagercontainer")},_createMenu:function(i,r,l){i.ejMenu({fields:{dataSource:r,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"},menuType:t.MenuType.ContextMenu,openOnClick:!1,beforeOpen:e.proxy(this._beforeOpen,this),close:e.proxy(this._menuClose,this),click:e.proxy(this._menuClick,this),contextMenuTarget:l})},hideCMenu:function(){var t=this.XLObj;t.model.enableContextMenu&&(e("#"+t._id+"_contextMenuCell").data("ejMenu").element.hide(),e("#"+t._id+"_contextMenuColumnHeader").data("ejMenu").element.hide(),e("#"+t._id+"_contextMenuRowHeader").data("ejMenu").element.hide(),e("#"+t._id+"_contextMenuFooter").data("ejMenu").element.hide())},_getCMenuObj:function(i){var r=this.XLObj;switch(i){case t.Spreadsheet.ContextMenu.Cell:return e("#"+r._id+"_contextMenuCell").data("ejMenu");case t.Spreadsheet.ContextMenu.RowHeader:return e("#"+r._id+"_contextMenuRowHeader").data("ejMenu");case t.Spreadsheet.ContextMenu.ColumnHeader:return e("#"+r._id+"_contextMenuColumnHeader").data("ejMenu");case t.Spreadsheet.ContextMenu.Footer:return e("#"+r._id+"_contextMenuFooter").data("ejMenu")}},addItem:function(t,i,r,l){if(t&&!this.XLObj.model.isReadOnly){var n,s,o,a,d=this._getCMenuObj(t),h=!1;switch(n=e.extend(!0,[],d.model.fields.dataSource),r){case"insert":e.merge(n,i),h=!0;break;case"insertbefore":for(s=i.length,a=l-1||0;s>0;)n.splice(a,0,i[s-1]),s--;h=!0;break;case"insertafter":for(s=i.length,o=0,a=l||n.length;o<s;)n.splice(a,0,i[o]),o++,a++;h=!0}h&&this.changeDataSource(t,n)}},removeItem:function(t,i){if(t&&!this.XLObj.model.isReadOnly){var r,l,n,s=this._getCMenuObj(t),o=[];for(l=0,r=(n=e.extend(!0,[],s.model.fields.dataSource)).length;l<r;l++)-1==i.indexOf(n[l].id)&&o.push(n[l]);this.changeDataSource(t,o)}},enableItem:function(e,t){if(e&&!this.XLObj.model.isReadOnly){var i,r,l=this._getCMenuObj(e);if(t&&t.length>0)for(i=0,r=t.length;i<r;i++)l.enableItemByID(t[i]);else l.enable()}},disableItem:function(e,t){if(e&&!this.XLObj.model.isReadOnly){var i,r,l=this._getCMenuObj(e);if(t&&t.length>0)for(i=0,r=t.length;i<r;i++)l.disableItemByID(t[i]);else l.disable()}},hideItem:function(e,t){this._showHideItem(e,t,"hide")},showItem:function(e,t){this._showHideItem(e,t,"show")},_showHideItem:function(e,t,i){if(e&&!this.XLObj.model.isReadOnly){var r,l,n,s=this._getCMenuObj(e);if(t&&t.length>0)for(r=0,n=t.length;r<n;r++)l=t[r],"hide"==i?s.hideItems(["#"+l]):s.showItems(["#"+l])}},changeDataSource:function(e,i){if(e&&!this.XLObj.model.isReadOnly&&i){var r=this._getCMenuObj(e);switch(this._changedDataSource=!0,e){case t.Spreadsheet.ContextMenu.Cell:this._rowCellMenuDataMobile=this._rowCellMenuData=i;break;case t.Spreadsheet.ContextMenu.RowHeader:this._headerMenuDataMobile=this._rowHeaderMenuData=i;break;case t.Spreadsheet.ContextMenu.ColumnHeader:this._headerMenuDataMobile=this._columnHeaderMenuData=i;break;case t.Spreadsheet.ContextMenu.Footer:this._footerMenuData=i}r&&r.option("fields",{dataSource:i})}},_updateContextMenuItems:function(i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f=this.XLObj,b=i[0],C=f.getActiveSheetIndex(),S=f.getSheet(C),x=!t.isNullOrUndefined(f.getActiveCellElem())&&f.getActiveCellElem().length>0?f.getActiveCellElem():i,v=f._phoneMode||f._tabMode?this._rowCellMenuDataMobile:this._rowCellMenuData,w=e("#"+f._id+"_contextMenuCell").data("ejMenu"),I=e("#"+f._id+"_contextMenuFooter").data("ejMenu"),y=f.getActiveCell(C);if(i.hasClass("e-rowcell")||i.hasClass("e-hyperlinks")){var T,L=[],R=f.XLEdit.getPropertyValue(S._activeCell.rowIndex,S._activeCell.colIndex),O=f._getCellIdx(f._hasClass(i,"e-hyperlinks")?i.parents("td")[0]:b);if(this._isMenuOpened=!0,f.model.allowLockCell&&S.isSheetProtected&&f.XLEdit.getPropertyValue(O.rowIndex,O.colIndex,"isLocked",C))this._disableMenuOpt(this._protectRowMenuIds);else{if(i.hasClass("e-hyperlinks")&&(b=(i=i.parents("td"))[0]),f.model.allowHyperlink?(this._enableMenuOpt(["CmHyperLink"]),a=f.XLEdit.getPropertyValue(O.rowIndex,O.colIndex,"hyperlink",C),d=["EditLink","OpenLink","RemoveLink"],t.isNullOrUndefined(a)?(this._disableMenuOpt(d),this._enableMenuOpt(["HyperLink"])):(this._enableMenuOpt(d),this._disableMenuOpt(["HyperLink"]))):this._disableMenuOpt(["CmHyperLink"]),f.model.allowFiltering){if(w.enableItemByID("Filter"),o=f.model.sheets[C].filterSettings.tableRange,h=f.XLEdit.getPropertyValue(y.rowIndex,y.colIndex,"tableName"),c=t.isNullOrUndefined(h)?-1:parseInt(h.replace("e-table","")),o.length>0){for(u=0,g=o.length;u<g;u++)if(o[u].tableID===c){s=u;break}!t.isNullOrUndefined(s)&&y.rowIndex<o[s].selectedRange.endRow+1&&y.rowIndex>o[s].selectedRange.startRow-2&&y.colIndex<o[s].multifilterIdx[o[s].multifilterIdx.length-1]+1&&y.colIndex>o[s].multifilterIdx[0]-1&&((r=f.getCell(o[s].selectedRange.startRow-1,y.colIndex,C).find("span")).length&&r[0].className.indexOf("e-ssfiltered")>-1&&(w.enableItemByID("ClearFilter"),this._clrFltrEnable=!0))}this._clrFltrEnable||w.disableItemByID("ClearFilter")}else w.disableItemByID("Filter");f.model.allowInsert?w.enableItemByID("Insert"):w.disableItemByID("Insert"),f.model.allowDelete?w.enableItemByID("Delete"):w.disableItemByID("Delete"),!f.XLClipboard._copyBackup.cells&&!f.XLClipboard._copyBackup.elem||f.model.isReadOnly?this._disableMenuOpt(["Paste"]):(this._enableMenuOpt(["Paste"]),f.isPasteValuesOnly?w.disableItemByID("PasteSpecial"):w.enableItemByID("PasteSpecial")),f.model.allowSorting?this._enableMenuOpt(["Sort"]):this._disableMenuOpt(["Sort"]),f.model.allowClear?this._enableMenuOpt(["ClearContents"]):this._disableMenuOpt(["ClearContents"]),f.model.allowCellFormatting?this._enableMenuOpt(["FormatCells"]):this._disableMenuOpt(["FormatCells"]),f._phoneMode||f._tabMode||(L=!t.isNullOrUndefined(R)&&e.isNumeric(R)?[f._getLocStr("SortSmallesttoLargest"),f._getLocStr("SortLargesttoSmallest")]:t.isNullOrUndefined(t.parseDate(R))?[f._getLocStr("SortAtoZ"),f._getLocStr("SortZtoA")]:[f._getLocStr("SortOldesttoNewest"),f._getLocStr("SortNewesttoOldest")],f.model.allowComments?(w.element.find("#ctxComment").hasClass("e-disable-item")&&this._enableMenuOpt(["ctxComment"]),(m=(p=f.getSheetElement(f.getActiveSheetIndex()).find(".e-selected")).length>1?x:i).hasClass("e-commentcell")?(this._disableMenuOpt(["ctxInsrtCmnt"]),f.XLEdit.getPropertyValueByElem(m,"comment").isVisible?(T=e.extend(v[19],{text:f._getLocStr("HideComment")}),w.remove(["#"+v[19].id]),w.insert([T],"#"+v[15].id)):(T=e.extend(v[19],{text:f._getLocStr("ShowHide")}),w.remove(["#"+v[19].id]),w.insert([T],"#"+v[15].id)),this._enableMenuOpt(["ctxEditCmnt","ctxDeleteCmnt","ctxShwHdCmnt"])):(this._enableMenuOpt(["ctxInsrtCmnt"]),this._disableMenuOpt(["ctxEditCmnt","ctxDeleteCmnt","ctxShwHdCmnt"])),p.filter(b).length>0&&p.filter(".e-commentcell").length>0&&this._enableMenuOpt(["ctxDeleteCmnt"])):this._disableMenuOpt(["ctxComment"]),v[11].text!==L[0]&&(T=e.extend(v[11],{text:L[0],spriteCssClass:v[11].sprite}),w.remove(["#"+v[11].id]),w.insertBefore([T],"#"+v[13].id)),v[12].text!==L[1]&&(T=e.extend(v[12],{text:L[1],spriteCssClass:v[12].sprite}),w.remove(["#"+v[12].id]),w.insertBefore([T],"#"+v[13].id))),f.model.showRibbon&&f.XLRibbon._dirtySelect(f._getContent(f.getActiveSheetIndex()).find(".e-selected"))}f.model.allowInsert?I.enableItemByID("InsertSheet"):I.disableItemByID("InsertSheet"),f.model.allowDelete?I.enableItemByID("DeleteSheet"):I.disableItemByID("DeleteSheet"),f.model.allowClipboard?this._enableMenuOpt(["Cut","Copy"]):this._disableMenuOpt(["Cut","Copy"]),!f.XLClipboard._copyBackup.cells&&!f.XLClipboard._copyBackup.elem||f.model.isReadOnly?this._disableMenuOpt(["Paste"],_):this._enableMenuOpt(["Paste"],_)}else if(i.hasClass("e-link")){if(l=I.model.fields.dataSource.slice(0),f._isSheetRename&&!f._updateSheetNames())return;n=f.model.allowLockCell&&S.isSheetProtected?f._getLocStr("Unprotect"):f._getLocStr("Protectsheet"),l[6].text=n,I.option("fields",{id:"id",dataSource:l,parentId:"parentId"}),this._isMenuOpened=!0,f._isCommentEdit&&f.XLComment._updateCurCmntVal(),i.not("a.e-currentitem, a.e-PP, a.e-NP").hasClass("e-numericitem")&&f.gotoPage(i.data("index")),f.model.exportSettings.password?this._disableMenuOpt(this._footerIds,"contextMenuFooter"):(f._getSheetNames(!1).length>0?I.enableItemByID("UnhideSheet"):I.disableItemByID("UnhideSheet"),f._getSheetNames(!0).length>1?(I.enableItemByID("DeleteSheet"),I.enableItemByID("HideSheet"),I.enableItemByID("MoveorCopy")):(I.disableItemByID("DeleteSheet"),I.disableItemByID("HideSheet"),I.disableItemByID("MoveorCopy"))),f.model.allowLockCell?I.enableItemByID("ProtectSheet"):I.disableItemByID("ProtectSheet")}else(i.hasClass("e-headercelldiv")||i.hasClass("e-headercell")||i.hasClass("e-rowheader"))&&(_=i.hasClass("e-rowheader")?"contextMenuRowHeader":"contextMenuColumnHeader",f.model.allowClipboard?this._enableMenuOpt(["Cut","Copy"],_):this._disableMenuOpt(["Cut","Copy"],_),!f.XLClipboard._copyBackup.cells&&!f.XLClipboard._copyBackup.elem||f.model.isReadOnly?this._disableMenuOpt(["Paste"],_):this._enableMenuOpt(["Paste"],_),f.model.allowLockCell&&S.isSheetProtected?this._disableMenuOpt(this._prtctHeaderIds,_):(f.model.allowClear?this._enableMenuOpt(["ClearContents"],_):this._disableMenuOpt(["ClearContents"],_),f.model.allowInsert?this._enableMenuOpt(["Insert"],_):this._disableMenuOpt(["Insert"],_),f.model.allowDelete?this._enableMenuOpt(["Delete"],_):this._disableMenuOpt(["Delete"],_),this._enableMenuOpt(["Hide","Unhide"],_)),f.model.showRibbon&&f.XLRibbon._dirtySelect(f._getContent(f.getActiveSheetIndex()).find(".e-selected")));f.model.allowInsert&&t.isNullOrUndefined(f.model.exportSettings.password)&&!f.model.isGridMode?this._enableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter"):this._disableMenuOpt(["InsertSheet","MoveorCopy"],"contextMenuFooter"),f.model.exportSettings.password?this._disableMenuOpt(["RenameSheet"]):this._enableMenuOpt(["RenameSheet"]),f.model.allowDelete&&f._getSheetNames(!0).length>1?this._enableMenuOpt(["DeleteSheet"],"contextMenuFooter"):this._disableMenuOpt(["DeleteSheet"],"contextMenuFooter"),f.model.allowEditing?this._enableMenuOpt(["RenameSheet"],"contextMenuFooter"):this._disableMenuOpt(["RenameSheet"],"contextMenuFooter"),f.model.isReadOnly&&(this._disableMenuOpt(["Cut","Insert","Delete","ClearContents"],"contextMenuColumnHeader"),this._disableMenuOpt(["Cut","Insert","Delete","ClearContents"],"contextMenuRowHeader"),this._disableMenuOpt(["Cut","Insert","Delete","Filter","Sort","ctxComment","FormatCells","CmHyperLink","ClearContents"],"contextMenuCell")),f.model.isGridMode&&(this.hideItem("cell",["Insert","Delete","FormatCells","ClearContents","ctxComment"]),this.hideItem("rowheader",["Hide","Unhide","ClearContents","Paste"]),this.hideItem("footer",["HideSheet","DeleteSheet","MoveorCopy","InsertSheet","UnhideSheet","ProtectSheet"]),this.hideItem("columnheader",["Insert","Delete","Hide","Unhide","ClearContents","Paste","Cut"]))},_beforeOpen:function(i){var r,l,n,s=this.XLObj,o=s.XLResize;if(!s.model.enableContextMenu||"mousedown"==i.events.type&&i.target.id.indexOf("_picture")>-1||e(i.target).hasClass("e-numericitem")&&s.model.isReadOnly)return i.cancel=!0,!1;if(e(i.target).hasClass("e-cellstylecell")){if(!e(i.target).hasClass("e-customcellstyle"))return i.cancel=!0,!1;this._target=i.target.innerText}if(e(i.target).hasClass("e-cellstylecontent"))return i.cancel=!0,!1;this._clrFltrEnable=!1,this.hideCMenu();var a=e("#"+s._id+"_contextMenuColumnHeader").data("ejMenu"),d=e("#"+s._id+"_contextMenuRowHeader").data("ejMenu"),h=i.target,c={target:h},u=e(h),g=s.getActiveSheetIndex(),p=s.getSheet(g),m=s._phoneMode||s._tabMode?this._rowCellMenuDataMobile:this._rowCellMenuData,_=e("#"+s._id+"_contextMenuCell").data("ejMenu");if((s.XLEdit._isEdit||s.model.allowComments&&s.XLComment._isCommentEdit||u.hasClass("e-filterspan")||1===i.events.which&&u.hasClass("e-hyperlinks")||u.parents("div").hasClass("e-vscroll")||u.parents("div").hasClass("e-hscroll")||e(h.parentNode).hasClass("e-pagercontainer")&&!u.hasClass("e-link")||!t.isNullOrUndefined(s.XLResize)&&s.XLResize._resizeStart||i.target.id.indexOf("Sheet_RenamePanel")>-1||u.parents().hasClass("e-grid")||u.hasClass("e-autofill"))&&(i.cancel=!0),o&&o._preventColResize(u.parent()[0].cellIndex,!0)&&u.hasClass("e-headercelldiv")&&(i.cancel=!0),o&&o._preventRowResize(parseInt(u.parent().attr("idx")),!0)&&u.hasClass("e-rowheader")&&(i.cancel=!0),u.hasClass("e-rowcell")||u.hasClass("e-hyperlinks"))r=s._getJSSheetHeader(g).find("th"),l=s._getJSSheetRowHeader(g).find("td"),t.isNullOrUndefined(s.XLEdit.getPropertyValueByElem(s.getCell(p._activeCell.rowIndex,p._activeCell.colIndex),"range"))?e(r[u.index()]).hasClass("e-colselected")||e(l[u.parent().index()]).hasClass("e-rowselected")?(m=e(r[u.index()]).hasClass("e-colselected")?this._columnHeaderMenuData:this._rowHeaderMenuData,JSON.stringify(m)!==JSON.stringify(i.model.fields.dataSource)&&this._changedDataSource&&_.option("fields",{dataSource:m,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"})):JSON.stringify(m)!==JSON.stringify(i.model.fields.dataSource)&&_.option("fields",{dataSource:m,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"}):(n=s.model.sheets[g].rangeSettings[s.XLEdit.getPropertyValueByElem(s.getCell(p._activeCell.rowIndex,p._activeCell.colIndex),"range")],_.option("fields",{dataSource:n.contextMenuSettings.dataSource,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"}),_.option("width",n.contextMenuSettings.width),_.option("height",n.contextMenuSettings.height));else if(u.hasClass("e-ss-imgvisual")||u.hasClass("e-ss-object")||u.closest("div").hasClass("e-ss-object")){if(this._isMenuOpened=!0,"chart"===s.XLShape._shapeType){var f=e.extend(!0,[],this._chartMenuData),b=document.getElementById(s._id+"_chart").value,C=s.XLChart._getShapeObj(b,"chart");m=this.XLObj.model.showRibbon?C.isChartSeries?f.splice(0,3):this._chartMenuData:f.splice(0,2)}else m=this._imgMenuData;JSON.stringify(m)!==JSON.stringify(i.model.fields.dataSource)&&_.option("fields",{dataSource:m,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"})}else u.hasClass("e-ss-pivot")||u.closest("div").hasClass("e-ss-pivot")?(m=this._pivotMenuData,JSON.stringify(m)!==JSON.stringify(i.model.fields.dataSource)&&_.option("fields",{dataSource:m,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"})):(u.hasClass("e-headercelldiv")||u.hasClass("e-headercell")||u.hasClass("e-rowheader"))&&(s._phoneMode||s._tabMode?(a.option("fields",{dataSource:this._headerMenuDataMobile}),d.option("fields",{dataSource:this._headerMenuDataMobile})):this._changedDataSource&&(a.option("fields",{dataSource:this._columnHeaderMenuData}),d.option("fields",{dataSource:this._rowHeaderMenuData})));if(this._changedDataSource||this._updateContextMenuItems(u),s._trigger("beforeOpen",c))return!1;i.cancel&&(this._isMenuOpened=!1)},_menuClick:function(e){if(this.XLObj._trigger("contextMenuClick",e))return!1;this._processCMenu(e.ID,e.events.element)},_menuClose:function(){this._isMenuOpened=!1},_processCMenu:function(i,r){var l,n,s,o,a,d,h,c,u,g,p,m=this.XLObj,_=m.getActiveSheetIndex(),f=m.getSheet(_),b=f._selectedCells;switch(i){case"Cut":m.XLClipboard.cut();break;case"Copy":m.XLClipboard.copy();break;case"PasteSpecial":case"PasteValues":m.XLClipboard._isSpecial=!("PasteValues"===i),m.XLClipboard.paste();break;case"Insert":m._insDelStatus="insert",f._isColSelected?(h=m._getJSSheetHeader(_).find(".e-colhighlight"),m.insertEntireColumn(h[0].cellIndex,h[h.length-1].cellIndex)):f._isRowSelected?(c=m._getJSSheetRowHeader(_).find(".e-rowhighlight"),s=m._getCellIdx(c[0]),o=m._getCellIdx(c[c.length-1]),m.insertEntireRow(s.rowIndex,o.rowIndex)):m._showDialog(m._id+"_Ribbon_Others_Cells_InsertCellOptions");break;case"Delete":h=e(m._getJSSheetHeader(_).find("tr")[0]).find(".e-colselected"),c=e(m.getRows(_)[0]).find(".e-rowselected"),r.parentElement.id.indexOf("ColumnHeader")>-1||f._isColSelected?(h=m._getJSSheetHeader(_).find(".e-colhighlight"),m.deleteEntireColumn(h[0].cellIndex,h[h.length-1].cellIndex,[])):r.parentElement.id.indexOf("RowHeader")>-1||f._isRowSelected?(c=m._getJSSheetRowHeader(_).find(".e-rowhighlight"),s=m._getCellIdx(c[0]),o=m._getCellIdx(c[c.length-1]),m.deleteEntireRow(s.rowIndex,o.rowIndex,[])):m._showDialog(m._id+"_Ribbon_Others_Cells_DeleteCellOptions");break;case"FilterSelected":m._showDialog(m._id+"_Ribbon_Data_SortFilter_Filter"),m.XLFilter.filterByActiveCell(),this._clrFltrEnable=!1;break;case"ClearFilter":a=m.getActiveCell(_),u=m.XLEdit.getPropertyValue(a.rowIndex,a.colIndex,"tableName"),(g=t.isNullOrUndefined(u)?-1:parseInt(u.replace("e-table","")))>-1?(d=m.model.sheets[_].columns[a.colIndex].field,m.XLFilter._clearFilterColumn(d,"","","","","",g),delete m._excelFilter._predicates[_][d]):m.XLFilter.clearFilter("apply"),this._clrFltrEnable=!1;break;case"SortAtoZ":case"SortZtoA":case"SortSmallesttoLargest":case"SortLargesttoSmallest":case"SortOldesttoNewest":case"SortNewesttoOldest":case"PutCellColor":case"PutFontColor":m.model.allowSorting&&m.XLSort._sortHandler(i);break;case"ClearContents":m._isTrigCellSave=!0,p=m.model.sheets[_].selectedRange,m.clearContents(m._getAlphaRange(_,p[0],p[1],p[2],p[3]));break;case"InsertSheet":m.insertSheet();break;case"DeleteSheet":m.deleteSheet(_,!0);break;case"RenameSheet":m._renameSheet();break;case"MoveorCopy":m._showDialog(m._id+"_MoveorCopy");break;case"Hide":f._isColSelected&&m._hideColumn(b[0].colIndex,b[b.length-1].colIndex),f._isRowSelected&&m._hideRow(b[0].rowIndex,b[b.length-1].rowIndex,"isRHide");break;case"Unhide":f._isColSelected&&m._showColumn(b[0].colIndex,b[b.length-1].colIndex),f._isRowSelected&&m._showRow(b[0].rowIndex,b[b.length-1].rowIndex,"isRHide");break;case"HyperLink":case"EditLink":m._showDialog(m._id+"_Ribbon_Insert_Links_Hyperlink");break;case"RemoveLink":m._removeHyperlink();break;case"OpenLink":m._openLink();break;case"ctxInsrtCmnt":m._dupDetails=!0,m.XLComment.setComment(),m._dupDetails=!1;break;case"ctxEditCmnt":m.XLComment.editComment();break;case"ctxDeleteCmnt":m.XLComment.deleteComment();break;case"ctxShwHdCmnt":m.XLComment.showHideComment();break;case"ChangePicture":m._uploadImage=!0,m.XLShape._changePicture=!0,m.element.find("#"+m._id+"_file .e-uploadinput").click();break;case"ChartType":m._showDialog(m._id+"_Ribbon_ChartDesign_Type_ChangeChartType"),m.XLRibbon._refreshChartTypeDlg();break;case"SelectData":m._showDialog(m._id+"_Ribbon_ChartDesign_Data_SelectData"),l=document.getElementById(m._id+"_chart").value,(n=m.XLChart._getShapeObj(l,"chart")).isChartSeries||(e("#"+m._id+"_crxaxis").val(n.xRange?m._getAlphaRange(_,n.xRange[0],n.xRange[1],n.xRange[2],n.xRange[3]):""),e("#"+m._id+"_cryaxis").val(n.yRange?m._getAlphaRange(_,n.yRange[0],n.yRange[1],n.yRange[2],n.yRange[3]):""),e("#"+m._id+"_crlaxis").val(n.lRange?m._getAlphaRange(_,n.lRange[0],n.lRange[1],n.lRange[2],n.lRange[3]):""),m._selectDataval={xRange:e("#"+m._id+"_crxaxis").val(),yRange:e("#"+m._id+"_cryaxis").val(),lRange:e("#"+m._id+"_crlaxis").val()},e("#"+m._id+"_chartrangedlg").ejDialog("open"));break;case"HideSheet":m.hideSheet();break;case"UnhideSheet":m._showDialog(m._id+"_UnhideSheet");break;case"ProtectSheet":m.protectSheet(!f.isSheetProtected);break;case"FormatCells":m._showDialog(m._id+"_FormatCells");break;case"Refresh":m.XLPivot.refreshDataSource();break;case"BackgroundColor":e("#"+this.XLObj._id+"_colordlg").ejDialog("open"),this._selColor={action:"bg-color",color:""};break;case"FontColor":e("#"+this.XLObj._id+"_colordlg").ejDialog("open"),this._selColor={action:"color",color:""};break;case"Modify":this._modifyClick=!0,m._showDialog(this.XLObj._id+"_CustomCellDialog"),this._oldCustomName=e("#"+this.XLObj._id+"_StyleName").val();break;case"DeleteStyle":m.XLFormat.deleteCustomStyle(this._target);break;case"Apply":m.XLFormat.applyCustomCellStyle(this._target)}},_disableMenuOpt:function(t,i){var r,l,n=i||"contextMenuCell",s=e("#"+this.XLObj._id+"_"+n).data("ejMenu");if(s)for(r=0,l=t.length;r<l;r++)s.disableItemByID(t[r])},_enableMenuOpt:function(t,i){var r,l,n=i||"contextMenuCell",s=e("#"+this.XLObj._id+"_"+n).data("ejMenu");if(s)for(r=0,l=t.length;r<l;r++)s.enableItemByID(t[r])},_initColorDialog:function(){var i=this.XLObj,r=i._id+"_colordlg";if(!e("#"+r).length){var l=t.buildTag("div#"+r+".e-colordlg e-"+i._id+"-dlg ","",{display:"none"}),n=t.buildTag("div#"+r+"_dlgcontent .e-colordlgcontent"),s=t.buildTag("input#"+r+"_cpicker"),o=t.buildTag("div#"+r+"_condiv .e-dlg-btnctnr"),a=t.buildTag("input#"+this._id+"_dialog_Ok"),d=t.buildTag("input#"+this._id+"_dialog_Can","",{"margin-left":10}),h=t.buildTag("div#"+r+"_dlgbtncontent .e-dlg-btnfields");n.append(s),l.append(n),i.element.append(l),l.ejDialog({showOnInit:!1,enableModal:!0,enableResize:!1,allowKeyboardNavigation:!1,title:i._getLocStr("ColorPicker"),width:"240",height:"auto",minHeight:0,cssClass:"e-ss-dialog e-"+i._id+"-dlg"}),e("#"+r+"_cpicker").ejColorPicker({value:"#278787",modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",select:e.proxy(this._cpClickHandler,this),showApplyCancel:!1}),e("#"+r+"_cpickerWrapper").hide(),n.append(e("#"+r+"_cpicker_popup").css("display","block")),a.ejButton({text:i._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._colorOkClick,this),enabled:!0}),d.ejButton({text:i._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._colorCanClick,this)}),h.append(o.append(a,d)),l.append(h)}},_cpClickHandler:function(e){this._selColor.color=e.value},_colorOkClick:function(){var t=this.XLObj;t.XLFormat.format({style:"bg-color"===this._selColor.action?{"background-color":this._selColor.color}:{color:this._selColor.color}}),t._setSheetFocus(),e("#"+t._id+"_colordlg").ejDialog("close")},_colorCanClick:function(){e("#"+this.XLObj._id+"_colordlg").ejDialog("close")}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.sorting=function(e){this.XLObj=e,this._isSortByFilter=!1},t.spreadsheetFeatures.sorting.prototype={_sortHandler:function(e){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f={},b="",C={},S=this.XLObj,x=S.getActiveSheetIndex(),v={sheetIndex:x,reqType:"sorting",type:"actionBegin",action:e};if(!S._trigActionBegin(v)){if(m=(p=S.getSheet(x))._selectedCells,b=p.columns[p._activeCell.colIndex].field,this._isSortByFilter=!1,"PutCellColor"!=e&&"PutFontColor"!=e){if(!S.model.allowSorting||!p._selectedCells.length)return;if(1===m.length&&S.selectAll(!1),o="Ribbon_SortZtoA"===e||"SortZtoA"===e?t.sortOrder.Descending:t.sortOrder.Ascending,a=S.XLEdit.getPropertyValue(p._activeCell.rowIndex,p._activeCell.colIndex,"tableName",x)||"",d=S._getTableID(a),t.isNullOrUndefined(d)){if(h=(C=p.selectedRange.slice(0))[0],c=C[1],h===C[2])return;for(n=S.XLEdit.getPropertyValue(h,c),i=h+1;i<=C[2];i++)if(!S._isHiddenRow(i)){s=S.XLEdit.getPropertyValue(i,c);break}r=S.isNumber(n)?t.Spreadsheet.CellType.Number:t.Spreadsheet.CellType.String,l=S.isNumber(s)?t.Spreadsheet.CellType.Number:t.Spreadsheet.CellType.String,S.XLEdit.getPropertyValue(h,c,"merge")||S.XLEdit.getPropertyValue(i,c,"merge")||S.XLEdit.getPropertyValue(C[0],C[1],"calcValue")||(r!=l||S.XLEdit.getPropertyValue(C[0],C[1],"wrap")||S.XLEdit.getPropertyValue(C[0],C[1],"isFilterHeader"))&&C[0]++}else(C=p.tableManager[d].range.slice(0))[0]++;this.sortByRange(C,b,o)}else _=1===m.length?this._selectSortRange(x,m[0]):p._startCell.rowIndex,u=S._getAlphaRange(x,_,m[0].colIndex,1===m.length?m[0].rowIndex:p._endCell.rowIndex,m[0].colIndex),g=S.XLEdit.getPropertyValue(p._activeCell.rowIndex,p._activeCell.colIndex,"formats"),S.isUndefined(g)||(g["background-color"]&&(f["background-color"]=g["background-color"].toLowerCase()),g.color&&(f.color=g.color.toLowerCase()),this.sortByColor(e,f,u));1===m.length&&(S.XLSelection.selectRange(m[0],m[0],x),p._startCell=p._endCell=m[0],S.model.allowAutoFill&&S.XLDragFill.positionAutoFillElement()),v={sheetIndex:x,reqType:"sorting",type:"actionComplete",action:e,operation:"sorting",range:C},S._trigActionComplete(v)}},_selectSortRange:function(e,t){for(var i=this.XLObj,r=i.getSheet(e).filterSettings.tableRange,l=0,n=r.length;l<n;l++)if(r[l].multifilterIdx.indexOf(t.colIndex)>-1&&t.rowIndex>r[l].startRow-1&&t.rowIndex<r[l].endRow+1)return r[l].startRow;return i.selectAll(),i.getSheet(e)._selectedCells[0].rowIndex},sortByColor:function(e,i,r){var l=this.XLObj;if(r=l._getRangeArgs(r,"object"),l.model.allowSorting&&!this._sortRangeAlert(r)&&!l.model.isReadOnly){var n,s,o,a=l.getActiveSheetIndex(),d={oprType:e};o=l.getSheet(a).columns[r[1]].field,t.isNullOrUndefined(i)||("PutCellColor"===e?(i["background-color"]&&(i=i["background-color"]),d.operation="sortbgcolor",d.bgcolor=i):(i.color&&(i=i.color),d.operation="sortfgcolor",d.fgcolor=i),d.requestType=d.action="sortbycolor",d.sortColumn=o,d.selRange={startCell:{rowIndex:r[0],colIndex:r[1]},endCell:{rowIndex:r[2],colIndex:r[3]}},d.rangeData=l.getRangeDataAsObject(d.selRange.startCell,d.selRange.endCell,!0)[0],d.sortRange=r,n=r[0],t.isNullOrUndefined(n)||(s=l.XLFilter._createSelection(a,r[2],r[1],[]).endRowIndex,n=n,d.range=l.model.sheets[a]._selectedRange={startRow:n,endRow:s,dataSourceIndexes:[]},l._processBindings(d)))}},_getSortColorRange:function(e){var t,i=this.XLObj,r=i.getCell(e.rowIndex,e.colIndex),l=!1,n=0,s=!1,o=e.rowIndex,a=e.colIndex;if(r.text().length<1){for(t=o;t<o+2;t++)if((r=i.getCell(t,a)).is(":visible")&&r.text().length>0){l=!0,n=t;break}if(!l){for(t=o;t>o-2;t--)t>-1&&(0===(r=i.getCell(t,a)).text().length&&t>0&&(0==(r=i.getCell(t-1,a)).text().length&&(s=!0)));if(!s)for(t=o-2;t>0;t--)if((r=i.getCell(t,a)).is(":visible")&&0===r.text().length){l=!0,n=t+1;break}}}else for(t=o;t>=0;t--){if((r=i.getCell(t,a)).is(":visible")&&0===r.text().length){l=!0,n=t+1;break}l||0!=t||(n=t,l=!0)}if(l)return n;i._showAlertDlg("Alert","Alert",null,630)},_sortRangeAlert:function(e){var t,i,r,l,n,s,o,a=this.XLObj,d=d||a.getActiveSheetIndex(),h=a.getSheet(d)._mergeColl,c=a.getObjectKeys(h);for(e=a._getRangeArgs(e,"object"),l=0,n=c.length;l<n;l++)for(s=0,o=(t=a.getObjectKeys(h[c[l]])).length;s<o;s++)if(r=a._dataContainer.sheets[d][c[l]][t[s]].merge,i=a.getRangeIndices(r.mRange),e[0]<=i[0]&&e[2]>=i[2]||e[0]>=i[0]&&e[2]<i[2])return a._showAlertDlg("Alert","MergeSortAlert","",380),!0;return!!a.XLEdit._rangeHasProperty(e,"calcValue")&&(a._showAlertDlg("Alert","FormulaSortAlert","",315),!0)},sortByRange:function(e,i,r){var l=this.XLObj;if(l.model.allowSorting&&!l.model.isReadOnly){var n,s,o,a,d=l.getActiveSheetIndex(),h=0,c=[],u={},g=[],p=l._getJSSheetHeader(d).find(".e-colselected").length;if(l.model.allowSorting){if(e=l._getRangeArgs(e,"object"),this._sortRangeAlert(e))return!0;if(this._isSortByFilter&&p<1){for(a=this._isSortByFilter?e[0]-1:e[0],o=l._getAlphaRange(d,a,e[1],a+1,e[3]),n=(s=l._getAlphaRangeCells(o).find(".e-filterspan")).length;h<n;)g.push({colIndex:s[h].parentNode.cellIndex,rowIndex:s.eq(h).parents("tr").index()}),h++;s.length&&(e[0]=this._isSortByFilter?e[0]:e[0]+1)}return c=l.getRangeDataAsObject({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[2],colIndex:e[3]},!0)[0],u.requestType=u.reqType=t.Spreadsheet.Actions.Sorting,u.range=e,u.columnName=i,u.rangeData=c,u.action="sorting",u.sortDirection=r,u.filterIcon=g,u.isSortByFilter=this._isSortByFilter,u.colSelected=p,u.isHightlightData=!1,l._processBindings(u),p&&this._isSortByFilter&&l.XLFilter._changeSortIcon({rowIndex:e[0]-1,colIndex:e[1]},r),!1}}},_sortComplete:function(e){var t=this.XLObj,i=e.range,r=this._swapSortedDatas(e),l=r[1];t._dupDetails=!0,e.rangeData=r[0],t.model.allowComments&&t.XLComment.deleteComment(i,null,!0,"comment"),t._removeHyperlink(null,null,!0,i),t._isSort=!0,t.clearRangeData(i,["value","value2","type","formatStr","decimalPlaces","thousandSeparator","comment","hyperlink","format"],null,!0),t.model.allowCellFormatting&&t.XLFormat.removeStyle(i,{cellStyle:!0,tableStyle:!0,format:!0,skipHiddenRow:!0}),t.XLEdit.updateCellWithContainer(l,i,null,!0),t._isSort=!1,t.refreshOverflow([i[0],i[1],i[2],i[3]],t.getActiveSheetIndex()),this._refreshRowHeight(i,l),t._dupDetails=!1},_refreshRowHeight:function(e,t){for(var i,r,l=0,n=0,s=this.XLObj,o=s._getSheetIndex(),a=s.getSheet(o),d=s._getJSSheetContent(o).find(".e-content"),h=s._getJSSheetRowHeaderContent(o);e[0]+l<=e[2];){for(i=e[0]+l,r=(l-n)*(e[3]-e[1]+1);a.hideRowsCollection.indexOf(i)>-1||a._hiddenFreezeRows.indexOf(i)>-1&&i<e[2];)i++&&l++&&n++;!s.model.scrollSettings.allowVirtualScrolling&&t[r]&&(d.find("tr:eq("+i+")").height(t[r].rheight),h.find("tr:eq("+i+")").height(t[r].rheight)),t[r]&&(a.rowsHeightCollection[i]=t[r].rheight),l++}s.XLScroll._getRowHeights(o,i),s.model.scrollSettings.allowVirtualScrolling&&s.refreshContent(o),a._isFreezed&&s.XLFreeze._refreshFreezeRowDiv()},_swapSortedDatas:function(t){for(var i,r,l,n,s,o=0,a=0,d=0,h=[],c=[],u=[],g=this.XLObj.getSheet(),p=t.model.currentViewData,m=p.length,_=this.XLObj._generateColCount(t.columnName)-1,f=t.range,b=f[3]-f[1]+1,C=_-f[1],S=this.XLObj.getRangeData({range:f,property:["value","value2","type","formatStr","formats","decimalPlaces","thousandSeparator","range","format","comment","hyperlink","rule"],skipHiddenRow:!0});f[0]+a<=f[2];){for(n=f[0]+a,r=(a-d)*(f[3]-f[1]+1);(g.hideRowsCollection.indexOf(n)>-1||g._hiddenFreezeRows.indexOf(n)>-1)&&n<f[2];)n++&&a++&&d++;S[r]&&(S[r].rheight=g.rowsHeightCollection[n]),a++}for(e.extend(!0,h,S),c.push(h);o<m;){for(i=p[o][t.columnName],l=C,s=S.length;l<s;){if(S[l].value===i){r=this._getMinIdx(l,b),u=u.concat(S.splice(r,b));break}l+=b}o++}return c.push(u),c},_getMinIdx:function(e,t){var i,r;if(i=r=t,e<t)return 0;for(;i<=e;){if((r+=t)>e)return i;i+=t}}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.dragAndDrop=function(e){this.XLObj=e,this._isDragAndDropStart=!1,this._dragAndDropCell={rowIndex:0,colIndex:0},this._isDragAndDropped=!1,this._allowDragAndDrop=!1,this._target=null,this._cellIdx={}},t.spreadsheetFeatures.dragAndDrop.prototype={moveRangeTo:function(e,t){this._moveRangeTo(e,t)},_moveRangeTo:function(i,r,l){var n,s,o,a,d=this.XLObj;if(d.model.allowDragAndDrop&&!d.model.isReadOnly&&d.model.allowEditing){var h,c,u,g,p,m,_,f,b,C,S,x,v,w=[],I=[],y=[];for(h=d.getActiveSheetIndex(),c=d.getSheet(h),i=d.swapRange(d._toIntrnlRange(i,h)),(r=d.swapRange(d._toIntrnlRange(r,h)))[2]=r[0]+(i[2]-i[0]),r[3]=r[1]+(i[3]-i[1]),m={rowIndex:r[0],colIndex:r[1]},_={rowIndex:r[2],colIndex:r[3]},l=l||["value","value2","type","formatStr","decimalPlaces","thousandSeparator","range","format","border","borders","comment","hyperlink","picture","cFormatRule","rule","chart","isLocked","wrap","formats","tformats","tborders","isFilterHeader","filterState","isFilterVisible","tableName"],u=d.getRangeData({range:i,property:l}),d.model.allowCellFormatting&&(p=d.XLFormat.getHashCodeClassAsArray(i)),d.model.allowConditionalFormats&&(f=d.XLEdit.getPropertyValue(i[0],i[1],"cFormatRule")),!d.isUndefined(f)&&f.length>0&&(f={action:(C=f[0].split("_"))[0],inputs:[C[2],C[3]],color:C[4],range:C[5]}),n=i[0];n<=i[2];n++)for(w.push({rowIndex:n,height:c.rowsHeightCollection[n]}),s=i[1];s<=i[3];s++)d.XLEdit.getPropertyValue(n,s,"wrap")&&d.setWrapText("unwrap",d._getAlphaRange(h,n,s,n,s));if(g={sheetIndex:h,reqType:"reorder-cells",sourceData:e.extend(!0,[],u),sourceRange:i,destinationRange:r,sourceFormat:p,destinationFormat:d.model.allowCellFormatting&&d.XLFormat.getHashCodeClassAsArray(r),destinationData:d.getRangeData({range:r}),sourceCFormat:f,sourceHeight:w,property:l},d.XLRibbon._isDirtySelect)return d._showAlertDlg("Alert","DragAlert",null,440),void d.performSelection(i);if(x=d._checkTableRange(d._getAlphaRange(h,i[0],i[1],i[2],i[3])),v=d._checkFilterRange(d._getAlphaRange(h,i[0],i[1],i[2],i[3])),d._dupDetails=!0,"full"===x.status)g.tblObj=x.tableObj,g.tblObj.tblId=x.tblId,g.tblObj.header=!0,d.XLFormat.removeTable(x.tblId),d.XLFormat.removeStyle(x.range);else if("full"===v.status)g.tRange=v.tRange,d.XLFilter.clearFilter("remove");else if("partial"===x.status||"partial"===v.status||d.XLRibbon._isFilterSelect.isFiltered)return d._showAlertDlg("Alert","DragAlert",null,440),void d.performSelection(i);for(d.model.allowComments&&d.XLComment.deleteComment(),d._ddCellSave=!0,d.clearRangeData(i,l),d.clearRangeData(r,l),t.isNullOrUndefined(d._ddlCell)||(d.element.find("#"+d._id+"ddl").ejDropDownList("hidePopup"),d.element.find("#"+d._id+"ddlspan").remove(),d._ddlCell=null),d.model.allowCellFormatting&&!d.XLRibbon._isDirtySelect&&(d.XLFormat.removeStyle(i),d.XLFormat.removeStyle(r,{cellStyle:!0,format:!0,border:!0})),d.model.allowConditionalFormats&&d.XLCFormat.clearCF(i,!0),u[0].cFormatRule=[],g.tblObj&&(g.tblObj.destrange=d._getAlphaRange(h,r[0],r[1],r[2],r[3]),d.XLClipboard._isCut=!0,d.XLFormat.createTable(g.tblObj,g.tblObj.destrange),d.XLClipboard._isCut=!1),this._dragDefineName(i,r,h),o=0,a=e.extend(!0,[],c.rowsHeightCollection),n=r[0];n<=r[2];n++)y.push({rowIndex:n,height:a[n]}),I.push({rowIndex:d._getRowIdx(n),height:a[n]>20?a[n]:w[o].height}),o++;d.updateData(u,r),d._ddCellSave=!1,v.tRange&&(d.XLFilter.filter(d._getAlphaRange(h,r[0],r[1],r[2],r[3])),d._dupDetails=!1),g.tblObj&&g.tblObj.totalRow&&d.XLFormat._updateTotalRow(h,g.tblObj.tblId,g.tblObj.fnNumber,r,!1),d.model.allowCellFormatting&&d.XLFormat.updateFormat(p,r),d.model.allowConditionalFormats&&!d.isUndefined(C)&&(S=d._getAlphaRange(1,r[0],r[1],r[2],r[3]),b={action:C[0],inputs:[C[2],C[3]],color:C[4],range:S},g.destinationCFormat=b,d.XLCFormat.setCFRule(b)),d.setHeightToRows(I),g.destHeight=I,g.prevDestRowHt=y,d.setActiveCell(m.rowIndex,m.colIndex),d.model.allowSelection&&(m.rowIndex||_.rowIndex!==c.rowCount-1?m.colIndex||_.colIndex!==c.colCount-1?d.XLSelection.selectRange(m,_):d.XLSelection.selectRows(m.rowIndex,_.rowIndex):d.XLSelection.selectColumns(m.colIndex,_.colIndex),c._isFreezed&&d.XLFreeze._refreshSelection()),d._dupDetails=!1,d._isUndoRedo||!d.XLFormat||d.XLFormat._isFAT||(d._completeAction(g),d._trigActionComplete(g))}},_dragDefineName:function(e,t,i){var r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=this.XLObj,S=C.model.nameManager,x=S.length,v=C._getSelectedCells(i,e).selCells,w=C.getSheet(i),I=C._getSelectedCells(i,t).selCells,y=C._calcEngine;if(x){for(_=0;_<x;_++)if(u=C._getRangeArgs(C.XLRibbon._getAddrFromDollarAddr(S[_].refersto)[1],"object"),C.XLClipboard._compareRange(e,u))for(f=0;f<v.length;f++)v[f].rowIndex==u[0]&&v[f].colIndex==u[3]&&(h=I[f].rowIndex,c=I[f].colIndex,r=y.getDependentCells().items,(l=Object.keys(r)[_])&&((g=l.split("!")[2])==(p=C._getRangeArgs(u,"string"))&&(S[_].refersto=C._getDollarAlphaRange([h,c,h,c])),m=y.getDependentCells().remove("!0!"+g),n=l.replace(p,C._getRangeArgs([h,c,h,c],"string")),y.getDependentCells().add(n,m),d=!0));if(a=Object.keys(w._formulaCollection).length)for(b=0;b<a;b++)d&&m[b]&&(s=C._getRangeArgs(m[b].split("!")[2],"object"),(o=w._formulaCollection[s[0]][s[1]])._formulaValue=C.XLEdit.getPropertyValue(h,c,"value2",i),o._parsedFormula=n,y.getNamedRanges().items[o._formulaText.split("=")[1].toUpperCase()]=n)}},_dMouseHover:function(e){var t,i,r,l,n,s,o,a,d,h=e.target,c=this.XLObj,u=c.getActiveSheetIndex(),g=c.getSheet(u).selectedRange;if(c._hasClass(h,"e-rowcell")&&(t=c._getCellIdx(h)),t&&c.inRange(g,t.rowIndex,t.colIndex)&&(t.rowIndex===g[0]||t.rowIndex===g[2]||t.colIndex===g[1]||t.colIndex===g[3])&&!c._isTouchEvt&&(s=e.target.getBoundingClientRect(),a=(o=c._setXY(e))[0],d=o[1],i=(i=a-c.getFocusLeftElem().offset().left)>=0&&i<=5,r=(r=d-c.getFocusTopElem()[0].getBoundingClientRect().top)>=0&&r<=5,l=(l=c.getFocusRightElem().offset().left-a)>=0&&l<=5,n=(n=c.getFocusBottomElem()[0].getBoundingClientRect().top-d)>=0&&n<=5,i&&a<=s.left+5&&a>=s.left||r&&d<=s.top+5&&d>=s.top||l&&a>=s.right-5&&a<=s.right||n&&d>=s.bottom-5&&d<=s.bottom))return c.addClass(h,"e-cursormove"),void(this._isDragAndDropStart=!0);this._isDragAndDropStart&&!c._isTouchEvt&&(c._getContent(u).find(".e-cursormove").removeClass("e-cursormove"),this._isDragAndDropStart=!1)},_dragtouch:function(e,t){var i,r,l,n,s=this.XLObj;i=e-s.getFocusLeftElem().offset().left,r=t-s.getFocusTopElem().offset().top,l=s.getFocusRightElem().offset().left-e,n=s.getFocusBottomElem().offset().top-t,this._isDragAndDropStart=i>=-10&&i<=10||r>=-5&&r<=0||l>=-10&&l<=10||n>=-5&&n<=0},_dMouseDown:function(e){var t,i,r,l=this.XLObj;!l.model.isReadOnly&&l.model.allowEditing&&(i=l.getActiveSheetIndex(),r=l.getSheet(i),e.preventDefault(),e.stopImmediatePropagation(),t=l.swapRange([r._startCell.rowIndex,r._startCell.colIndex,r._endCell.rowIndex,r._endCell.colIndex]),"TD"===e.target.nodeName&&(this._dragAndDropCell=l._getCellIdx(e.target)),l._dStartCell={rowIndex:t[0],colIndex:t[1]},l._dEndCell={rowIndex:t[2],colIndex:t[3]},l._trigger("dragStart",{sheetIndex:i,target:e.target,currentCell:this._dragAndDropCell,dragAndDropRange:{startCell:r._startCell,endCell:r._endCell}})||(this._allowDragAndDrop=!0))},_dMouseMove:function(e){if(this._allowDragAndDrop){var t,i=this.XLObj,r=i.getActiveSheetIndex(),l=i.getSheet(r),n=e.target,s=i._getCellIdx(n);if(i._isTouchEvt&&(t=i._getOriginalEvt(e),(n=document.elementFromPoint(t.clientX,t.clientY)).parentNode&&n.parentNode.attributes.getNamedItem("data-idx")&&(s=i._getCellIdx(n))),i._trigger("drag",{sheetIndex:r,target:n,currentCell:s,dragAndDropRange:{startCell:l._startCell,endCell:l._endCell}}))return;i._isFrozen(l.frozenRows)&&this._isDragAndDropped&&l._frozenRows-1<l._ftopRowIdx&&l._startCell.rowIndex>l._frozenRows-1&&s.rowIndex<l._frozenRows-1&&(s.rowIndex=l._ftopRowIdx),i._isFrozen(l.frozenColumns)&&this._isDragAndDropped&&l._frozenColumns-1<l._fleftColIdx&&l._startCell.colIndex>l._frozenColumns-1&&s.colIndex<l._frozenColumns-1&&(s.colIndex=l._fleftColIdx),this._cellIdx=s,i.XLSelection._focusBorder(l._startCell,l._endCell,i._thinBorder),this._updateDCells(s),l._isFreezed?this._refreshFocusRange():i.XLSelection._focusRange(i._dStartCell,i._dEndCell,i._autofillBorder)}else this.XLObj._isTouchEvt||this._dMouseHover(e)},_refreshFocusRange:function(){var e=this.XLObj,t=e.getSheet(),i=e._dEndCell.colIndex,r=e._dEndCell.rowIndex,l=e._dStartCell.colIndex,n=e._dStartCell.rowIndex;t._frozenRows-1<t._ftopRowIdx&&(t._startCell.rowIndex<t._frozenRows-1?r>=t._frozenRows-1&&(r<t._ftopRowIdx?r=t._frozenRows-2:r>t._ftopRowIdx&&n<t._ftopRowIdx&&(n=t._ftopRowIdx)):n=n<t._ftopRowIdx&&n>t._frozenRows-1?t._ftopRowIdx:e._dStartCell.rowIndex),t._frozenColumns-1<t._fleftColIdx&&(t._startCell.colIndex<t._frozenColumns-1?i>=t._frozenColumns-1&&(i<t._fleftColIdx?i=t._frozenColumns-2:i>t._fleftColIdx&&l<t._fleftColIdx&&(l=t._fleftColIdx)):l=l<t._fleftColIdx&&l>t._frozenColumns-1?t._fleftColIdx:e._dStartCell.colIndex),e.XLSelection._focusRange({rowIndex:n,colIndex:l},{rowIndex:r,colIndex:i},e._autofillBorder)},_dMouseUp:function(t){var i,r;if(this._isDragAndDropped){var l=this.XLObj,n=!0,s=l.getActiveSheetIndex(),o=l.getSheet(s),a=e("#vscrollBar").data("ejScrollBar"),d=e("#hscrollBar").data("ejScrollBar"),h=!1,c=[l._dStartCell.rowIndex,l._dStartCell.colIndex,l._dEndCell.rowIndex,l._dEndCell.colIndex],u={rowIndex:-1,colIndex:-1},g={sheetIndex:s,isAlert:!1,target:t.target,currCell:this._dragAndDropCell,dragAndDropRange:{startCell:o._startCell,endCell:o._endCell}},p=l._arrayAsString(l._thinBorder);if(l.model.scrollSettings.allowScrolling&&l._dEndCell.rowIndex>o.rowCount){for(i=0,r=l._dEndCell.rowIndex-l._dStartCell.rowIndex;i<r;i++)l.XLScroll._createNewRow(s,-1,-1,"insert");a._scrollData.step=1,a.scroll(o._scrollTop+(l._dEndCell.rowIndex-l._dStartCell.rowIndex)*o.rowHeight)}if(l._dEndCell.colIndex>o.colCount){for(i=0,r=l._dEndCell.colIndex-l._dStartCell.colIndex;i<r;i++)l.XLScroll._createNewColumn(s,u,u,"insert");d._scrollData.step=1,d.scroll(o._scrollLeft+(l._dEndCell.colIndex-l._dStartCell.colIndex)*o.columnWidth)}if(this._target=t.target,l._isUniqueRange(o.selectedRange,l.swapRange(c)))this._preventDrop(o);else{if(l.model.allowLockCell&&o.isSheetProtected&&l._isPropExists([c,o.selectedRange],"isLocked",s)&&(n=!1),n&&l._isPropExists([c,o.selectedRange],"isReadOnly",s)&&(n=!1),!n)return this._preventDrop(o),l.XLSelection._clearBorder(p),void(this._allowDragAndDrop=this._isDragAndDropStart=this._isDragAndDropped=!1);h=l._trigger("beforeDrop",g),g.isAlert||h||!l._rangeHasData(c)?l._rangeHasData(c)?this._preventDrop(o):(this.moveRangeTo([o._startCell.rowIndex,o._startCell.colIndex,o._endCell.rowIndex,o._endCell.colIndex],[l._dStartCell.rowIndex,l._dStartCell.colIndex,l._dEndCell.rowIndex,l._dEndCell.colIndex]),o._startCell=l._dStartCell,o._endCell=l._dEndCell,o._isFreezed&&l.XLFreeze._refreshSelection()):l._showAlertDlg("","DropAlert","Drop",498)}l.XLSelection._clearBorder(p),l.model.allowAutoFill&&l.XLDragFill.positionAutoFillElement()}this._allowDragAndDrop=this._isDragAndDropStart=this._isDragAndDropped=!1},_scrollHover:function(t){var i,r,l,n=this.XLObj,s=n.getActiveSheetIndex(),o=n.getSheet(s),a=this._cellIdx.colIndex,d=this._cellIdx.rowIndex,h=n.XLScroll,c=h._vScroller(s),u=h._hScroller(s);e(t.target).parents(".e-vscrollbar").length>0?r=setInterval(function(){i=o._scrollLeft+(n._isFrozen(o.frozenColumns)?o.columnsWidthCollection[o._fleftColIdx]:o.columnWidth),u._scrollData.step=1,u.scroll(i),n.XLSelection._focusBorder(o._startCell,o._endCell,n._thinBorder),n.XLDragDrop._updateDCells({rowIndex:d,colIndex:o._rightCol.idx-1}),n.XLSelection._focusRange(n._dStartCell,n._dEndCell,n._autofillBorder)},200):t.target.className.indexOf("e-rowheader")>-1?r=setInterval(function(){i=o._scrollLeft-o.columnWidth,u._scrollData.step=-1,i>-1?u.scroll(i):u.scroll(0),n.XLSelection._focusBorder(o._startCell,o._endCell,n._thinBorder),n.XLDragDrop._updateDCells({rowIndex:d,colIndex:o._leftCol.idx}),n.XLSelection._focusRange(n._dStartCell,n._dEndCell,n._autofillBorder)},200):e(t.target).parents(".e-spreadsheetfooter").length>0||t.target.className.indexOf("e-spreadsheetfooter")>-1||e(t.target).parents(".e-hscrollbar").length>0?r=setInterval(function(){n.model.scrollSettings.allowVirtualScrolling?o._isVirtualEndReached?c.scroll(o._scrollTop):c.scroll(o._scrollTop+(n._isFrozen(o.frozenRows)?o.rowsHeightCollection[o._ftopRowIdx]:o.rowHeight)):(c._scrollData.step=1,c.scroll(o._scrollTop+(n._isFrozen(o.frozenRows)?o.rowsHeightCollection[o._ftopRowIdx]:o.rowHeight))),n.XLSelection._focusBorder(o._startCell,o._endCell,n._thinBorder),n.XLDragDrop._updateDCells({rowIndex:o._bottomRow.idx-1,colIndex:a}),n.XLSelection._focusRange(n._dStartCell,n._dEndCell,n._autofillBorder)},200):t.target.className.indexOf("e-headercell")>-1?r=setInterval(function(){i=o._scrollTop-o.rowHeight,c._scrollData.step=-1,i>-1?c.scroll(i):c.scroll(0),n.XLSelection._focusBorder(o._startCell,o._endCell,n._thinBorder),n.XLDragDrop._updateDCells({rowIndex:o._topRow.idx,colIndex:a}),n.XLSelection._focusRange(n._dStartCell,n._dEndCell,n._autofillBorder)},200):t.target.className.indexOf("e-rowcell")>-1&&(l=n._getCellIdx(t.target),n._isFrozen(o.frozenRows)&&l.rowIndex<o._frozenRows-1&&o._startCell.rowIndex>=o._frozenRows-1&&(r=setInterval(function(){n._dStartCell.rowIndex>o._ftopRowIdx||!n.XLDragDrop._isDragAndDropped||o._frozenRows-1===o._ftopRowIdx?(n._dStartCell.colIndex>o._fleftColIdx||!n.XLDragDrop._isDragAndDropped||o._frozenColumns-1===o._fleftColIdx)&&clearInterval(r):(i=o._scrollTop-o.rowHeight,c._scrollData.step=-1,i>-1?c.scroll(i):c.scroll(0),n.XLSelection._focusBorder(o._startCell,o._endCell,n._thinBorder),n.XLDragDrop._updateDCells({rowIndex:o._ftopRowIdx,colIndex:n.XLDragDrop._cellIdx.colIndex}),n.XLSelection._focusRange(n._dStartCell,n._dEndCell,n._autofillBorder),n.XLDragDrop._refreshFocusRange())},200)),n._isFrozen(o.frozenColumns)&&l.colIndex<o._frozenColumns-1&&o._startCell.colIndex>=o._frozenColumns-1&&(r=setInterval(function(){n._dStartCell.colIndex>o._fleftColIdx||!n.XLDragDrop._isDragAndDropped||o._frozenColumns-1===o._fleftColIdx?(n._dStartCell.rowIndex>o._ftopRowIdx||!n.XLDragDrop._isDragAndDropped||o._frozenRows-1===o._ftopRowIdx)&&clearInterval(r):(i=o._scrollLeft-o.columnWidth,u._scrollData.step=-1,i>-1?u.scroll(i):u.scroll(0),n.XLSelection._focusBorder(o._startCell,o._endCell,n._thinBorder),n.XLDragDrop._updateDCells({rowIndex:n.XLDragDrop._cellIdx.rowIndex,colIndex:o._fleftColIdx}),n.XLSelection._focusRange(n._dStartCell,n._dEndCell,n._autofillBorder),n.XLDragDrop._refreshFocusRange())},200))),"msie"===n._browserDetails.name&&"8.0"===n._browserDetails.version?(t.target.attachEvent("onmouseleave",function(){clearInterval(r)}),document.attachEvent("onmouseleave",function(){clearInterval(r)}),t.target.attachEvent("onmouseup",function(){clearInterval(r)})):(t.target.addEventListener("mouseleave",function(){clearInterval(r)}),document.addEventListener("mouseleave",function(){clearInterval(r)}),t.target.addEventListener("mouseup",function(){clearInterval(r),n.XLDragDrop._dMouseUp(t)}))},_preventDrop:function(e){var t=this.XLObj;t.XLSelection._focusRange(e._startCell,e._endCell,t._selectionBorder),t._dStartCell=e._startCell,t._dEndCell=e._endCell},_updateDCells:function(e){var t=this.XLObj,i=t.getActiveSheetIndex(),r=t.getSheet(i),l=t.isRange(r.selectedRange);r._isColSelected&&t.inRange(r.selectedRange,0,r._startCell.colIndex)||(e.rowIndex<this._dragAndDropCell.rowIndex&&t._dStartCell.rowIndex?(t._dStartCell.rowIndex=t._dStartCell.rowIndex-(this._dragAndDropCell.rowIndex-e.rowIndex),t._dEndCell.rowIndex=l?t._dEndCell.rowIndex-(this._dragAndDropCell.rowIndex-e.rowIndex):t._dStartCell.rowIndex):e.rowIndex>this._dragAndDropCell.rowIndex&&(t._dStartCell.rowIndex=t._dStartCell.rowIndex+(e.rowIndex-this._dragAndDropCell.rowIndex),t._dEndCell.rowIndex=l?t._dEndCell.rowIndex+(e.rowIndex-this._dragAndDropCell.rowIndex):t._dStartCell.rowIndex)),r._isRowSelected&&t.inRange(r.selectedRange,r._startCell.rowIndex,0)||(e.colIndex<this._dragAndDropCell.colIndex&&t._dStartCell.colIndex?(t._dStartCell.colIndex=t._dStartCell.colIndex-(this._dragAndDropCell.colIndex-e.colIndex),t._dEndCell.colIndex=l?t._dEndCell.colIndex-(this._dragAndDropCell.colIndex-e.colIndex):t._dStartCell.colIndex):e.colIndex>this._dragAndDropCell.colIndex&&(t._dStartCell.colIndex=t._dStartCell.colIndex+(e.colIndex-this._dragAndDropCell.colIndex),t._dEndCell.colIndex=l?t._dEndCell.colIndex+(e.colIndex-this._dragAndDropCell.colIndex):t._dStartCell.colIndex)),this._dragAndDropCell=e,this._isDragAndDropped=!0}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.exporting=function(e){this.XLObj=e,this._exportType=""},t.spreadsheetFeatures.exporting.prototype={export:function(i,r){var l,n,s,o,a,d,h,c,u,g,p,m,_=this.XLObj;if(_.model.exportSettings.allowExporting&&!_.model.isReadOnly)if(t.isNullOrUndefined(r)&&(r="Sample"),l=_.model.exportSettings,d=i===t.Spreadsheet.exportType.Excel?l.excelUrl:i===t.Spreadsheet.exportType.Csv?l.csvUrl:l.pdfUrl,h=this.getExportProps(),p={exportType:i,url:d,customParams:{}},c=t.raiseWebFormsServerEvents?i.toLowerCase()+"Exporting":"",t.raiseWebFormsServerEvents&&_.model.serverEvents&&_.model.serverEvents.indexOf(c)>-1){if(u={model:e.extend(!0,{},_.model),originalEventType:c},g={sheetModel:h.model,sheetData:h.data,fileName:r,password:l.password?l.password:""},_._trigger("onExport",p))return;_.getObjectLength(p.customParams)&&e.extend(g,p.customParams),t.raiseWebFormsServerEvents(c,u,g),setTimeout(function(){t.isOnWebForms=!0},1e3)}else{if(t.isNullOrUndefined(d))return void _._showAlertDlg("Alert","ImportExportUrl","",266);if(!l.allowExporting||_.isUndefined(d))return;if(_._trigger("onExport",p))return;for(m in n={action:d=p.url,method:"post"},s=t.buildTag("form","",null,n),o={name:"sheetData",type:"hidden",value:h.data},a=t.buildTag("input","",null,o),s.append(a),o={name:"sheetModel",type:"hidden",value:h.model},a=t.buildTag("input","",null,o),s.append(a),o={name:"fileName",type:"hidden",value:r},a=t.buildTag("input","",null,o),s.append(a),o={name:"Password",type:"hidden",value:l.password},a=t.buildTag("input","",null,o),s.append(a),p.customParams)o={name:m,type:"hidden",value:p.customParams[m]},a=t.buildTag("input","",null,o),s.append(a);e("body").append(s),s.submit()}},_getRequriedProp:function(e){for(var t,i,r,l,n,s=this.XLObj,o={},a=["sheetCount","activeSheetIndex","nameManager","exportSettings"],d=0,h=a.length;d<h;d++)o[a[d]]=e[a[d]];for(s.model.allowCellFormatting&&s.getObjectLength(s.XLFormat._customFontFamily)>0&&(o.customFontFamily=s.XLFormat._customFontFamily),s._isDefaultLocked&&(o.ExcelLikeLockedCells=!0),r=e.sheets,o.sheets=[],s._calcEngine.getCalculatingSuspended()&&(o.IsManualCalculation=!0),s.model.exportSettings.enableFormulaCalculation&&(o.exportSettings.EnableFormulaCalculation=!0),a=["paperSettings","_activeCell","_endCell","_startCell","colCount","columnsWidthCollection","rowsHeightCollection","rowCount","frozenColumns","frozenRows","usedRange","dataAttribute","filterSettings","tableManager","sheetInfo","hideColsCollection","hideRowsCollection","showGridlines","showHeadings","isSheetProtected","shapeMngr","chart","pivotMngr","topLeftCell","paneTopLeftCell","formulaRange"],d=0,n=r.length;d<n;d++)for(o.sheets[d]={},l=o.sheets[d],i=r[d],t=0,h=a.length;t<h;t++)l[a[t]]=i[a[t]];return o},getExportProps:function(){var t,i,r,l,n,s,o,a,d,h=this.XLObj;h._isExport=!0,this._renderAll(),h._isExport=!1;var c,u,g,p,m,_=e.extend(!0,{},h._dataContainer),f={},b=[],C={};for(h._refreshHashCode(_.hashCode),f=JSON.parse(JSON.stringify(h.model)),t=1;t<f.sheets.length;t++){for(C={},e.extend(!0,C,f.sheets[t].shapeMngr.chart),b=h.getObjectKeys(C),f.sheets[t].shapeMngr.chart={},i=0,l=b.length;i<l;i++)if(c=C[b[i]].id,s=e("#"+c).data("ejChart")){for(s.model.event=null,r=0,n=(a=(o=JSON.parse(JSON.stringify(s.model))).series).length;r<n;r++)delete a[r].dataSource,delete a[r].query,a[r].fill="array"==jQuery.type(a[r].fill)?a[r].fill[0].color:a[r].fill;if(o.dataSheetIdx=C[c].dataSheetIdx,f.sheets[t].shapeMngr.chart[c]=o,C[c].isChartSeries)for(p=C[c].seriesRange,f.sheets[t].shapeMngr.chart[c].seriesRange=p,d=0;d<p.length;d++)(m=f.sheets[t].shapeMngr.chart[c].seriesRange[d]).xRange=p[d].xRange,m.yRange=p[d].yRange,m.lRange=p[d].lRange;else g=C[c].range,f.sheets[t].shapeMngr.chart[c].range=h._generateHeaderText(g[1]+1)+(g[0]+1)+":"+h._generateHeaderText(g[3]+1)+(g[2]+1);f.sheets[t].shapeMngr.chart[c].top=C[c].top,f.sheets[t].shapeMngr.chart[c].left=C[c].left,f.sheets[t].shapeMngr.chart[c].height=C[c].height,f.sheets[t].shapeMngr.chart[c].width=C[c].width,f.sheets[t].shapeMngr.chart[c].isRowColSwitched=C[c].isRowColSwitched}for(i=0,l=(b=h.getObjectKeys(f.sheets[t].pivotMngr.pivot)).length;i<l;i++)c=b[i],(u=e("#"+c).data("ejPivotGrid"))&&(f.sheets[t].pivotMngr.pivot[c].rows=u.getOlapReport().rows,f.sheets[t].pivotMngr.pivot[c].columns=u.getOlapReport().columns,f.sheets[t].pivotMngr.pivot[c].filters=u.getOlapReport().filters,f.sheets[t].pivotMngr.pivot[c].values=u.getOlapReport().values)}return f.sheets.shift(),{model:JSON.stringify(this._getRequriedProp(f)),data:JSON.stringify(_)}},_renderAll:function(){for(var e,t,i,r=this.XLObj,l=r.getSheets(),n=r.getActiveSheetIndex(),s=1;s<l.length;s++)if(t=l[s],r.model.importSettings.allowSheetOnDemand&&t._isImported&&!t._isRequested&&r._importSheet(s,!1),t._isLoaded||r.gotoPage(s),r.model.scrollSettings.allowVirtualScrolling&&!t._isImported&&t._hasDataSrc)for(e=1;e<=t._virtualBlockCnt;e++)-1===t._virtualDataLoadedBlks.indexOf(e)&&(t._virtualDataLoadedBlks.push(e),i=this._getRange(e,s),r._refreshDataSrc(i,s),r._refreshCellData(i,s));r.hideWaitingPopUp(),r.gotoPage(n)},_getRange:function(e,t){var i=this.XLObj.getSheet(t),r=[0,0,0,i.colCount-1];return r[0]=i._virtualBlockRowCnt*(e-1),r[2]=i._virtualBlockRowCnt*e-1,r},_exportFileNameDlg:function(){var i,r,l,n,s,o,a=this.XLObj;i=t.buildTag("div","","",{id:a._id+"_ExportFileNameDialog"}),s=t.buildTag("div.e-dlg-btnfields"),o=t.buildTag("div.e-dlg-btnctnr"),r="<div class= 'e-dlgctndiv'><table><tr class= 'e-dlgtd-fields'><td><label>"+a._getLocStr("FileName")+":</label></td><td><form id='"+a._id+"_Form_xlFileName' onsubmit='return false'><input id ='"+a._id+"_xlFileName' type ='text' value = 'Sample' class = 'ejinputtext'/></form></td></tr></table></div>",i.append(r),l=t.buildTag("input","","",{type:"submit"}),n=t.buildTag("input"),l.ejButton({text:a._getLocStr("Save"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgSave,this),enabled:!0,cssClass:"e-ss-okbtn"}),n.ejButton({text:a._getLocStr("Cancel"),click:t.proxy(this._dlgCancel,a),showRoundedCorner:!0,width:60}),s.append(o.append(l,n)),i.append(s),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:a._getLocStr("SaveFile"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-"+a._id+"-dlg",close:t.proxy(this._dlgCancel,a),open:t.proxy(function(){var t=e("#"+a._id+"_xlFileName");t.focus().setInputPos(t.val().length).select()})}),a.XLRibbon._dialogValidate("_xlFileName")},_dlgSave:function(){var i=this.XLObj._id;e("#"+i+"_Form_xlFileName").valid()&&(this.export(t.Spreadsheet.exportType[this._exportType],e("#"+i+"_xlFileName").val()),e("#"+i+"_ExportFileNameDialog").ejDialog("close"))},_dlgCancel:function(){e("#"+this._id+"_ExportFileNameDialog").ejDialog("close")}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.findnreplace=function(e){this.XLObj=e,this._findCount=0,this._isApplied=!1,this.caseSen={true:function(e){return e.toString()},false:function(e){return e.toString().toLowerCase()}},this.isEMatch={true:function(e,t){return e==t},false:function(e,t){if(!e.length||t.length)return e.indexOf(t)>-1}}},t.spreadsheetFeatures.findnreplace.prototype={replaceAllBySheet:function(e,t,i,r){this.XLObj.model.allowSearching&&this.XLObj.model.allowEditing&&!this.XLObj.model.isReadOnly&&this._replaceAllData(e,t,i,r,"value","sheet")},replaceAllByBook:function(e,t,i,r){this.XLObj.model.allowSearching&&this.XLObj.model.allowEditing&&!this.XLObj.model.isReadOnly&&this._replaceAllData(e,t,i,r,"value","workbook")},findNext:function(e,i,r){t.isNullOrUndefined(r)&&(r=this.XLObj.getActiveSheetIndex()),this._findNext(e,r,i.isCSen,i.isEMatch,i.type,i.mode,i.searchBy)},findPrevious:function(e,i,r){t.isNullOrUndefined(r)&&(r=this.XLObj.getActiveSheetIndex()),this._findPrev(e,r,i.isCSen,i.isEMatch,i.type,i.mode,i.searchBy)},_findNext:function(e,t,i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I=[],y="rows"===s,T=this.XLObj,L=!1,R=t||T.getActiveSheetIndex(),O=T.getSheet(R),F=O._activeCell,E={sheetIndex:t,value:e,isCaseSensitive:i,isEntireMatch:r,searchBy:s,mode:n,findType:l,reqType:"findNext"};if(v={sheetIndex:E.sheetIndex,value:E.value,isCaseSensitive:E.isCaseSensitive,isEntireMatch:E.isEntireMatch,searchBy:E.searchBy,mode:E.mode,findType:E.findType,reqType:E.reqType},!T._intrnlReq&&T._trigActionBegin(v))return!0;if(T.model.allowEditing&&T.XLEdit._isEdit&&T.XLEdit.saveCell(),e=E.value,t=E.sheetIndex,i=E.isCaseSensitive,r=E.isEntireMatch,l=E.findType,n=E.mode,s=E.searchBy,_=(u=O._selectedCells).length,m=O.usedRange,1===_||"workbook"===n?I=[F.rowIndex,F.colIndex,m.rowIndex+1,m.colIndex+1]:(L=!0,g=u[_-1],I=[F.rowIndex,F.colIndex,g.rowIndex+1,g.colIndex+1]),p=I[0],C=I[1],S=I[2],x=I[3],y||(c=p,p=C,C=c,c=S,S=x,x=c),"sheet"===n){for(o=p;o<S;o++)for(o!==p&&(g=u[0],C=L?y?g.colIndex:g.rowIndex:0),a=C;a<x;a++)if(this._compareValues(y?o:a,y?a:o,R,e,i,r,l)&&(o!==p||a!==C))return this._updateSelection(y?o:a,y?a:o),this._findCount++,E={sheetIdx:t,reqType:"findNext",activeCell:T.getActiveCellElem(),type:"actionComplete",action:"find-next"},!T._trigActionComplete(E)||void 0}else for(d=R,h=T.model.sheetCount;d<=h;d++)for(m=T.model.sheets[d].usedRange,d!==R&&(C=0,p=0,S=y?m.rowIndex:m.colIndex,x=y?m.colIndex:m.rowIndex),o=p;o<S+1;o++)for(o!==p&&(C=0),a=C;a<x+1;a++)if(this._compareValues(y?o:a,y?a:o,d,e,i,r,l)&&(d!==R||o!==p||a!==C))return this._updateSelection(y?o:a,y?a:o,d),this._findCount++,T._intrnlReq=!1,E={reqType:"findNext",activeCell:T.getActiveCellElem()},!T._trigActionComplete(E)||void 0;return!this._findCount&&(f=0,b=0,w="sheet"===n?R:1,L&&(g=u[0],b=u[0].rowIndex,f=u[0].colIndex),this._updateSelection(b,f,w),this._findCount++,!!this._compareValues(b,f,w,e,i,r,l)||(T._intrnlReq=!0,this._findNext(e,w,i,r,l,n,s)))},_findPrev:function(e,t,i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v=!1,w=[],I=0,y=0,T="rows"===s,L=this.XLObj,R=t||L.getActiveSheetIndex(),O=L.getSheet(R),F=O.usedRange,E=O._activeCell,D={sheetIndex:t,value:e,isCaseSensitive:i,isEntireMatch:r,searchBy:s,mode:n,findType:l,reqType:"findPrevious",action:"find-prev",type:"actionBegin"};if(C={sheetIndex:D.sheetIndex,value:D.value,isCaseSensitive:D.isCaseSensitive,isEntireMatch:D.isEntireMatch,searchBy:D.searchBy,mode:D.mode,findType:D.findType,reqType:D.reqType},L._trigActionBegin(C))return!0;if(L.model.allowEditing&&L.XLEdit._isEdit&&L.XLEdit.saveCell(),e=D.value,t=D.sheetIndex,i=D.isCaseSensitive,r=D.isEntireMatch,l=D.findType,n=D.mode,s=D.searchBy,1===(g=(u=O._selectedCells).length)||"workbook"===n?w=[E.rowIndex,E.colIndex,F.rowIndex+1,F.colIndex+1]:(c=u[g-1],w=[E.rowIndex,E.colIndex,c.rowIndex,c.colIndex],v=!0),_=w[0],f=w[1],b=w[2],S=w[3],T||(x=_,_=f,f=x,x=b,b=S,S=x),"sheet"===n){for(v&&(c=u[0],I=T?c.rowIndex:c.colIndex,y=T?c.colIndex:c.rowIndex),o=_;o>=I;o--)for(o!==_&&(f=S),a=f;a>=y;a--)if(this._compareValues(T?o:a,T?a:o,R,e,i,r,l)&&(o!==_||a!==f))return this._updateSelection(T?o:a,T?a:o),this._findCount++,D={sheetIdx:t,reqType:"findPrevious",activeCell:L.getActiveCellElem(),type:"actionComplete",action:"find-prev"},!L._trigActionComplete(D)||void 0}else for(d=R;d>=1;d--)for(F=L.model.sheets[d].usedRange,d!==R&&(b=T?F.rowIndex:F.colIndex,f=S=T?F.colIndex:F.rowIndex,_=b),o=_;o>=0;o--)for(o!==_&&(f=S+1),a=f;a>=0;a--)if(this._compareValues(T?o:a,T?a:o,d,e,i,r,l)&&(d!==R||o!==_||a!==f))return this._updateSelection(T?o:a,T?a:o,d),this._findCount++,D={reqType:"findPrevious",activeCell:L.getActiveCellElem()},!L._trigActionComplete(D)||void 0;return!this._findCount&&(h="sheet"===n?R:L.model.sheetCount,m=L.model.sheets[h].usedRange.rowIndex,p=L.model.sheets[h].usedRange.colIndex,v&&(m=(c=u[g-1]).rowIndex,p=c.colIndex),this._updateSelection(m,p,h),this._findCount++,!!this._compareValues(m,p,h,e,i,r,l)||this._findPrev(e,h,i,r,l,n,s))},_compareValues:function(e,t,i,r,l,n,s){var o=this.XLObj,a=o.XLEdit.getPropertyValue(e,t,null,i)?o.XLEdit.getPropertyValue(e,t,null,i).toString():"",d=o.isFormula(a)||"formula"===s&&"="===a,h=o._isDateTime(o.XLEdit.getPropertyValue(e,t,"value",i));return a="value"===s?h?a?this.caseSen[l](o.XLEdit.getPropertyValue(e,t,"value2",i)):"":a&&!d?this.caseSen[l](a):"":"formula"===s?d?this.caseSen[l](a):"":o.XLEdit.getPropertyValue(e,t,"comment",i)?this.caseSen[l](o.XLEdit.getPropertyValue(e,t,"comment",i).value):"",r=this.caseSen[l](r),this.isEMatch[n](a,r)},_replace:function(e,t,i,r,l){var n=this.XLObj,s=n.getActiveSheetIndex();if(n.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"isLocked",s))return!1;var o=n.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,null,t)?n.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,null,t).toString():"",a=new RegExp(i.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),d=""!==o&&""!==i?l?o.replace(i,r):o.replace(a,r):r;t===s||n.gotoPage(t),n.XLEdit._updateCellValue(e,d)},_replaceData:function(e,t,i,r,l,n,s,o,a){var d,h,c=this.XLObj,u=i||c.model.activeSheetIndex,g=c.getSheet(u),p=g._activeCell.rowIndex,m=g._activeCell.colIndex,_={sheetIndex:u,reqType:"find-replace",action:"replace",type:"actionBegin"};if(!c.model.allowEditing)return!1;if(!c._trigActionBegin(_)){if(c.model.allowLockCell&&c.XLEdit.getPropertyValue(p,m,"isLocked",u))return void c._popUplockCellAlert();c.model.allowEditing&&c.XLEdit._isEdit&&c.XLEdit.saveCell(),this._compareValues(p,m,u,e,r,l,n)?(h="formula"===n?"value":"value2",(d={sheetIndex:u,reqType:"find-replace",operation:"replace",rowIndex:p,colIndex:m,sIndex:i}).prevData={value:c.XLEdit.getPropertyValue(p,m,h)},this._replace({rowIndex:p,colIndex:m},i,e,t,r),d.newData={value:c.XLEdit.getPropertyValue(p,m,h)},this._findCount=0,("up"===s?this._findPrev(e,u,r,l,n,o,a):this._findNext(e,u,r,l,n,o,a))||this._updateSelection(p,m,u),c._isUndoRedo||(c._completeAction(d),c._trigActionComplete(d))):c._showAlertDlg("Alert","ReplaceNotFound","")}},_replaceAllData:function(t,i,r,l,n,s){var o,a,d,h,c,u,g,p,m,_,f=[],b=0,C=!1,S=this.XLObj,x=S.model.sheetCount,v=S.model.activeSheetIndex,w=S.getSheet(v),I=w.usedRange,y=w._activeCell.rowIndex,T=w._activeCell.colIndex,L=0,R={sheetIndex:v,reqType:"find-replace",action:"replaceAll",isCSen:r,isEMatch:l};if(!S._trigActionBegin(R)){if(o={sheetIndex:v,reqType:"find-replace",operation:"replaceAll",isCSen:r,isEMatch:l},a="formula"===n?"value":"value2",!S.model.allowEditing)return!1;if(S._dupDetails=!0,S.model.allowEditing&&S.XLEdit._isEdit&&S.XLEdit.saveCell(),"sheet"===s)if(S.model.allowLockCell&&w.isSheetProtected)C=!0;else for(c=0,p=I.rowIndex+1;c<p;c++)for(u=0,m=I.colIndex+1;u<m;u++)this._compareValues(c,u,v,t,r,l,n)&&(d={rowIndex:c,colIndex:u,prevData:{value:S.XLEdit.getPropertyValue(c,u,a)},sheetIndex:v},this._replace({rowIndex:c,colIndex:u},v,t,i,r),L++,d.newData={value:S.XLEdit.getPropertyValue(c,u,a)},f.push(d));else for(g=1;g<=x;g++)if(h=S.model.sheets[g],S.model.allowLockCell&&h.isSheetProtected)b++;else for(c=0,p=(I=h.usedRange).rowIndex+1;c<p;c++)for(u=0,m=I.colIndex+1;u<m;u++)this._compareValues(c,u,g,t,r,l,n)&&(d={rowIndex:c,colIndex:u,prevData:{value:S.XLEdit.getPropertyValue(c,u,a,g)},sheetIndex:g},this._replace({rowIndex:c,colIndex:u},g,t,i,r),L++,d.newData={value:S.XLEdit.getPropertyValue(c,u,a)},f.push(d));if(C||b===x)return void S._popUplockCellAlert();S._dupDetails=!1,o.selectedCell=f,this._updateSelection(y,T),S._isUndoRedo||(S._completeAction(o),S._trigActionComplete(o)),S.hideWaitingPopUp(),_="T-"+(_=S._getLocStr("ReplaceData").split("/"))[0]+L+" "+_[1],e("#"+S._id+"_FRDialog").ejDialog("close"),S._showAlertDlg("Alert",_,"",325)}},_updateSelection:function(e,t,i){var r={rowIndex:e,colIndex:t},l=this.XLObj,n=l.getActiveSheetIndex(),s=l.getSheet(n);i||(i=n),i&&i!==n&&l.gotoPage(i,!1),l.getSheetElement(n).find(".e-selected:visible").length<2||!l.inRange(s.selectedRange,e,t)?(l.setActiveCell(r.rowIndex,r.colIndex,i),l.XLSelection.selectRange(r,r),s._startCell=r,s._endCell=r):l.XLCellNav._updateActiveCell(e,t),l.model.scrollSettings.allowScrolling&&(l._isFrozen(s.frozenRows)||l._isFrozen(s.frozenColumns)?this._freezeScroll(r.rowIndex,r.colIndex,s):l.XLScroll._scrollSelectedPosition(i,l.getActiveCell(i))),l.model.allowAutoFill&&l.XLDragFill.positionAutoFillElement()},_getSelRangeDetails:function(e){return[e[e.length-1].rowIndex-e[0].rowIndex,e[e.length-1].colIndex-e[0].colIndex,e[0].rowIndex,e[0].colIndex]},goTo:function(t){var i=this.XLObj;if(!i.model.isReadOnly){i._showDialog(i._id+"_Ribbon_Others_Editing_FindSelect"),t.startsWith("=")&&(t=t.split("=")[1]);var r,l,n,s,o=i.getActiveSheetIndex(),a=i.getSheet(o),d=i._getDollarAlphaRange(a.selectedRange),h=i.XLRibbon._getAddrFromDollarAddr(t);t=h[1],h[0]&&i.gotoPage(h[0],!1),t=i.getRangeIndices(t),n=(l=i._getSelectedRange({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]}))[0],s=l[l.length-1],i.setActiveCell(n.rowIndex,n.colIndex),i.model.allowSelection&&i.XLSelection.selectRange(n,s),i._isFrozen(a.frozenRows)||i._isFrozen(a.frozenColumns)?this._freezeScroll(n.rowIndex,n.colIndex,a):i.XLScroll._scrollSelectedPosition(i.getActiveSheetIndex(),n),i.XLDragFill&&i.XLDragFill.positionAutoFillElement(),a._startCell=n,a._endCell=s,i._setSheetFocus(),e.grep(i.XLRibbon._addrList,function(e){return e.value===d}).length<1&&(i.XLRibbon._addrList.push({value:d,text:d}),r=e("#"+i._id+"_GotoAddr").data("ejListBox"),i.XLRibbon._addrList=JSON.parse(JSON.stringify(i.XLRibbon._addrList)),r.model.dataSource=i.XLRibbon._addrList,r.option("fields",{dataSource:i.XLRibbon._addrList}))}},goToSpecial:function(e,t){this._applyGoToRule(e,t.isNumber,t.isText,t.isLogical,t.isError)},_applyGoToRule:function(e,t,i,r,l){var n,s,o=this.XLObj;switch(o.showWaitingPopUp(),e){case"blanks":this._applyGotoBlanks();break;case"formulas":this._applyGotoFormulas(t,i,r,l);break;case"comments":this._applyGotoComments();break;case"datavalidation":this._applyGotoValidation();break;case"cformat":this._applyGotoCFormat();break;case"lastcell":n=o.getActiveSheetIndex(),s=o.model.sheets[n].usedRange,o.XLSelection.selectRange({rowIndex:s.rowIndex,colIndex:s.colIndex},{rowIndex:s.rowIndex,colIndex:s.colIndex}),this._updateSelection(s.rowIndex,s.colIndex,n);break;case"constants":this._applyGotoConstants(t,i,r,l);break;case"rowdiff":this._applyGotoRowDiff();break;case"coldiff":this._applyGotoColDiff()}o.hideWaitingPopUp()},_applyGotoBlanks:function(){var e,t,i,r,l,n,s,o,a,d=!1,h=[],c=this.XLObj,u=c.getActiveSheetIndex(),g=c.model.sheets[u].usedRange,p=g.rowIndex,m=g.colIndex,_=c.getSheet(u),f=_._selectedCells,b=0,C=0,S={sheetIndex:u,reqType:"find-replace",operation:"blanks"};if(!c._trigActionBegin(S)){for(_._goToCollection={multiple:!1,selected:[]},f.length>1&&(p=(o=this._getSelRangeDetails(f))[0],m=o[1],b=o[2],C=o[3],_._goToCollection.multiple=!0),e=0;e<=p;e++){for(t=0;t<=m;t++)n=e+b,s=t+C,a=c.XLEdit.getPropertyValue(n,s)?c.XLEdit.getPropertyValue(n,s).toString():"",c._isRowViewable(u,n)&&(i=c.getCell(n,s,u),d=!0),a.length?d&&i.removeClass("e-selected"):(h.push({rowIndex:n,colIndex:s,isApply:!0}),c.model.scrollSettings.allowVirtualScrolling&&_._goToCollection.selected.push(n+":"+s),d&&(i.addClass("e-selected"),r=[n,s]));d=!1}l=_._goToCollection.selected.length,(c._isFrozen(_.frozenRows)||c._isFrozen(_.frozenColumns))&&(l&&(r=_._goToCollection.selected[l-1].split(":")),r&&r.length&&this._freezeScroll(r[0],r[1],_)),S.selectedCell=h,c._isUndoRedo||(c._completeAction(S),c._trigActionComplete(S))}},_applyGotoComments:function(){var e,i,r,l,n,s,o,a,d,h=!1,c=[],u=this.XLObj,g=u.getActiveSheetIndex(),p=u.getSheet(g).usedRange,m=p.rowIndex,_=p.colIndex,f=u.getSheet(g),b=f._selectedCells,C=0,S=0,x={sheetIndex:g,reqType:"find-replace",operation:"comments"};if(!u._trigActionBegin(x)){for(f._goToCollection={multiple:!1,selected:[]},this._isApplied=!1,b.length>1&&(m=(a=this._getSelRangeDetails(b))[0],_=a[1],C=a[2],S=a[3],f._goToCollection.multiple=!0),e=0;e<=m;e++){for(i=0;i<=_;i++)s=e+C,o=i+S,d=u.XLEdit.getPropertyValue(s,o,"comment"),u._isRowViewable(g,s)&&(r=u.getCell(s,o,g),h=!0),t.isNullOrUndefined(d)?h&&r.removeClass("e-selected"):(c.push({rowIndex:s,colIndex:o,isApply:!0}),u.model.scrollSettings.allowVirtualScrolling&&f._goToCollection.selected.push(s+":"+o),h&&(r.addClass("e-selected"),this._isApplied=!0,l=[s,o]));h=!1}n=f._goToCollection.selected.length,(u._isFrozen(f.frozenRows)||u._isFrozen(f.frozenColumns))&&(n&&(l=f._goToCollection.selected[n-1].split(":")),l&&l.length&&this._freezeScroll(l[0],l[1],f)),this._isApplied||n||u._showAlertDlg("Alert","NoCellFound","",200),x.selectedCell=c,!u._isUndoRedo&&this._isApplied&&(u._completeAction(x),u._trigActionComplete(x))}},_applyGotoFormulas:function(i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f=!1,b=[],C=this.XLObj,S=C.getActiveSheetIndex(),x=C.model.sheets[S].usedRange,v=x.rowIndex,w=x.colIndex,I=C.getSheet(S),y=I._selectedCells,T=0,L=0,R={sheetIndex:S,reqType:"find-replace",operation:"formulas"};if(!C._trigActionBegin(R)){for(I._goToCollection={multiple:!1,selected:[]},this._isApplied=!1,y.length>1&&(v=(g=this._getSelRangeDetails(y))[0],w=g[1],T=g[2],L=g[3],I._goToCollection.multiple=!0),s=0;s<=v;s++){for(o=0;o<=w;o++)d=s+T,h=o+L,p=t.isNullOrUndefined(C.XLEdit.getPropertyValue(d,h))?"":C.XLEdit.getPropertyValue(d,o+L).toString(),m=t.isNullOrUndefined(C.XLEdit.getPropertyValue(d,h,"value2"))?"":C.XLEdit.getPropertyValue(d,h,"value2").toString(),_="="===p.charAt(0)&&"string"==typeof m,C._isRowViewable(S,d)&&(a=C.getCell(d,h,S),f=!0),_&&(i&&e.isNumeric(m)||r&&"true"!==m.toLowerCase()&&"false"!==m.toLowerCase()&&!e.isNumeric(m)&&!(0!==m.length&&0===m.indexOf("#")&&m.lastIndexOf("?")===m.length-1&&m.length>0)||l&&("true"===m.toLowerCase()||"false"===m.toLowerCase())||n&&0!==m.length&&C._calcEngine.getErrorStrings().indexOf(m)>-1)?(b.push({rowIndex:d,colIndex:h,isApply:!0}),C.model.scrollSettings.allowVirtualScrolling&&I._goToCollection.selected.push(d+":"+h),f&&(a.addClass("e-selected"),this._isApplied=!0,c=[d,h])):f&&a.removeClass("e-selected");f=!1}u=I._goToCollection.selected.length,(C._isFrozen(I.frozenRows)||C._isFrozen(I.frozenColumns))&&(u&&(c=I._goToCollection.selected[u-1].split(":")),c&&c.length&&this._freezeScroll(c[0],c[1],I)),this._isApplied||u||C._showAlertDlg("Alert","NoCellFound","",200),R.selectedCell=b,!C._isUndoRedo&&this._isApplied&&(C._completeAction(R),C._trigActionComplete(R))}},_applyGotoValidation:function(){var e,i,r,l,n,s,o,a,d,h=!1,c=[],u=this.XLObj,g=u.getActiveSheetIndex(),p=u.model.sheets[g].usedRange,m=p.rowIndex,_=p.colIndex,f=u.getSheet(g),b=f._selectedCells,C=0,S=0,x={sheetIndex:g,reqType:"find-replace",action:"validations"};if(!u._trigActionBegin(x)){for(this._isApplied=!1,f._goToCollection={multiple:!1,selected:[]},b.length>1&&(m=(a=this._getSelRangeDetails(b))[0],_=a[1],C=a[2],S=a[3],f._goToCollection.multiple=!0),e=0;e<=m;e++){for(i=0;i<=_;i++)l=e+C,n=i+S,d=u.XLEdit.getPropertyValue(l,n,"rule"),u._isRowViewable(g,l)&&(r=u.getCell(l,n,g),h=!0),t.isNullOrUndefined(d)?h&&r.removeClass("e-selected"):(c.push({rowIndex:l,colIndex:n,isApply:!0}),u.model.scrollSettings.allowVirtualScrolling&&f._goToCollection.selected.push(l+":"+n),h&&(r.addClass("e-selected"),this._isApplied=!0,s=[l,n]));h=!1}o=f._goToCollection.selected.length,(u._isFrozen(f.frozenRows)||u._isFrozen(f.frozenColumns))&&(o&&(s=f._goToCollection.selected[o-1].split(":")),s&&s.length&&this._freezeScroll(s[0],s[1],f)),this._isApplied||o||u._showAlertDlg("Alert","NoCellFound","",200),x.selectedCell=c,!u._isUndoRedo&&this._isApplied&&(u._completeAction(x),u._trigActionComplete(x))}},_applyGotoCFormat:function(){var e,i,r,l,n,s,o,a,d,h=!1,c=[],u=this.XLObj,g=u.getActiveSheetIndex(),p=u.model.sheets[g].usedRange,m=p.rowIndex,_=p.colIndex,f=u.getSheet(g),b=f._selectedCells,C=0,S=0,x={sheetIndex:g,reqType:"find-replace",operation:"conditions"};if(!u._trigActionBegin(x)){for(this._isApplied=!1,f._goToCollection={multiple:!1,selected:[]},b.length>1&&(m=(a=this._getSelRangeDetails(b))[0],_=a[1],C=a[2],S=a[3],f._goToCollection.multiple=!0),e=0;e<=m;e++){for(i=0;i<=_;i++)l=e+C,n=i+S,d=u.XLEdit.getPropertyValue(l,n,"cFormatRule"),u._isRowViewable(g,l)&&(r=u.getCell(l,n,g),h=!0),!t.isNullOrUndefined(d)&&d.length?(c.push({rowIndex:l,colIndex:n,isApply:!0}),u.model.scrollSettings.allowVirtualScrolling&&f._goToCollection.selected.push(l+":"+n),h&&(r.addClass("e-selected"),this._isApplied=!0,s=[l,n])):h&&r.removeClass("e-selected");h=!1}o=f._goToCollection.selected.length,(u._isFrozen(f.frozenRows)||u._isFrozen(f.frozenColumns))&&(o&&(s=f._goToCollection.selected[o-1].split(":")),s&&s.length&&this._freezeScroll(s[0],s[1],f)),this._isApplied||o||u._showAlertDlg("Alert","NoCellFound","",200),x.selectedCell=c,!u._isUndoRedo&&this._isApplied&&(u._completeAction(x),u._trigActionComplete(x))}},_applyGotoConstants:function(i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f=!1,b=[],C=this.XLObj,S=C.getActiveSheetIndex(),x=C.model.sheets[S].usedRange,v=x.rowIndex,w=x.colIndex,I=C.getSheet(S),y=I._selectedCells,T=0,L=0;for(this._isApplied=!1,I._goToCollection={multiple:!1,selected:[]},y.length>1&&(v=(p=this._getSelRangeDetails(y))[0],w=p[1],T=p[2],L=p[3],I._goToCollection.multiple=!0),s=0;s<=v;s++){for(o=0;o<=w;o++)d=s+T,h=o+L,m=t.isNullOrUndefined(C.XLEdit.getPropertyValue(d,h))?"":C.XLEdit.getPropertyValue(d,h).toString(),_=t.isNullOrUndefined(C.XLEdit.getPropertyValue(d,h,"value2"))?"":C.XLEdit.getPropertyValue(d,h,"value2").toString(),g="="===m.charAt(0)&&"string"==typeof _,C._isRowViewable(S,d)&&(a=C.getCell(d,h,S),f=!0),!g&&(i&&e.isNumeric(m)||r&&"true"!==m.toLowerCase()&&"false"!==m.toLowerCase()&&!e.isNumeric(m)&&m.length>0||l&&("true"===m.toLowerCase()||"false"===m.toLowerCase())||n&&0!==_.length&&0===_.indexOf("#"))?(b.push({rowIndex:d,colIndex:h,isApply:!0}),C.model.scrollSettings.allowVirtualScrolling&&I._goToCollection.selected.push(d+":"+h),f&&(a.addClass("e-selected"),this._isApplied=!0,c=[d,h])):f&&a.removeClass("e-selected");f=!1}u=I._goToCollection.selected.length,(C._isFrozen(I.frozenRows)||C._isFrozen(I.frozenColumns))&&(u&&(c=I._goToCollection.selected[u-1].split(":")),c&&c.length&&this._freezeScroll(c[0],c[1],I)),this._isApplied||u||C._showAlertDlg("Alert","NoCellFound","",200)},_applyGotoColDiff:function(){var e,t,i,r,l,n,s,o,a,d,h=!1,c=[],u=this.XLObj,g=u.getActiveSheetIndex(),p=u.model.sheets[g].usedRange,m=p.rowIndex,_=p.colIndex,f=u.getSheet(g),b=f._selectedCells,C=0,S=0,x={sheetIndex:g,reqType:"find-replace",operation:"coldiff"};if(!u._trigActionBegin(x)){if(this._isApplied=!1,f._goToCollection={multiple:!1,selected:[]},b.length>1)for(m=(o=this._getSelRangeDetails(b))[0],_=o[1],C=o[2],S=o[3],f._goToCollection.multiple=!0,e=0;e<=_;e++){for(r=e+S,d=u.XLEdit.getPropertyValue(C,r)?u.XLEdit.getPropertyValue(C,r).toString():"",t=0;t<=m;t++)l=t+C,a=u.XLEdit.getPropertyValue(l,r)?u.XLEdit.getPropertyValue(l,r).toString():"",u._isRowViewable(g,l)&&(i=u.getCell(l,r,g),h=!0),a===d?h&&i.removeClass("e-selected"):(c.push({rowIndex:l,colIndex:r,isApply:!0}),u.model.scrollSettings.allowVirtualScrolling&&f._goToCollection.selected.push(l+":"+r),h&&(i.addClass("e-selected"),this._isApplied=!0,n=[l,r]));h=!1}s=f._goToCollection.selected.length,(u._isFrozen(f.frozenRows)||u._isFrozen(f.frozenColumns))&&(s&&(n=f._goToCollection.selected[s-1].split(":")),n&&n.length&&this._freezeScroll(n[0],n[1],f)),this._isApplied||s||u._showAlertDlg("Alert","NoCellFound","",200),x.selectedCell=c,!u._isUndoRedo&&this._isApplied&&(u._completeAction(x),u._trigActionComplete(x))}},_applyGotoRowDiff:function(){var e,t,i,r,l,n,s,o,a,d,h=!1,c=[],u=this.XLObj,g=u.getActiveSheetIndex(),p=u.model.sheets[g].usedRange,m=p.rowIndex,_=p.colIndex,f=u.getSheet(g),b=f._selectedCells,C=0,S=0,x={sheetIndex:g,reqType:"find-replace",operation:"rowdiff"};if(!u._trigActionBegin(x)){if(this._isApplied=!1,f._goToCollection={multiple:!1,selected:[]},b.length>1)for(m=(o=this._getSelRangeDetails(b))[0],_=o[1],C=o[2],S=o[3],f._goToCollection.multiple=!0,e=0;e<=m;e++){for(n=e+C,d=u.XLEdit.getPropertyValue(n,S)?u.XLEdit.getPropertyValue(n,S).toString():"",t=0;t<=_;t++)s=t+S,a=u.XLEdit.getPropertyValue(n,s)?u.XLEdit.getPropertyValue(n,s).toString():"",u._isRowViewable(g,n)&&(i=u.getCell(n,s,g),h=!0),a===d?h&&i.removeClass("e-selected"):(c.push({rowIndex:n,colIndex:s,isApply:!0}),u.model.scrollSettings.allowVirtualScrolling&&f._goToCollection.selected.push(n+":"+s),h&&(i.addClass("e-selected"),this._isApplied=!0,r=[n,s]));h=!1}l=f._goToCollection.selected.length,(u._isFrozen(f.frozenRows)||u._isFrozen(f.frozenColumns))&&(l&&(r=f._goToCollection.selected[l-1].split(":")),r&&r.length&&this._freezeScroll(r[0],r[1],f)),this._isApplied||l||u._showAlertDlg("Alert","NoCellFound","",200),x.selectedCell=c,!u._isUndoRedo&&this._isApplied&&(u._completeAction(x),u._trigActionComplete(x))}},_freezeScroll:function(e,t,i){var r,l=this.XLObj;r=l._getIdxWithOffset(e,t,!1,["freeze"]),(i._ftopRowIdx>e||e>i._bottomRow.idx)&&l._scrollContent({y:r.yOffset-i._frozenHeight+1},!0),(i._fleftColIdx>t||t>i._rightCol.idx)&&l._scrollContent({x:r.xOffset-i._frozenWidth+1},!0)}}}(jQuery,Syncfusion),$.fn.setInputPos=function(e,t){return t||(t=e),$(this).is(":visible")?this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select()}}):void 0},function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.formatCellDialog=function(e){this.XLObj=e,this._categories=[{value:"General",text:e._getLocStr("LGeneral")},{value:"Number",text:e._getLocStr("NumberTab")},{value:"Currency",text:e._getLocStr("LCurrency")},{value:"Accounting",text:e._getLocStr("LAccounting")},{value:"Date",text:e._getLocStr("LDate")},{value:"Time",text:e._getLocStr("LTime")},{value:"Percentage",text:e._getLocStr("LPercentage")},{value:"Fraction",text:e._getLocStr("LFraction")},{value:"Scientific",text:e._getLocStr("LScientific")},{value:"Text",text:e._getLocStr("LText")},{value:"Custom",text:e._getLocStr("LCustom")}],this._effects=[{value:"1",text:"underline"},{value:"1",text:"line-through"},{value:"1",text:"line-through underline"}],this._selValue="General"},t.spreadsheetFeatures.formatCellDialog.prototype={_renderCellFrmtDlg:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p=this.XLObj,m=p._id+"_formatdlg";i=t.buildTag("div#"+m),r=t.buildTag("div#"+m+"_formattab"),l=t.buildTag("div.e-dlg-fields e-dlgctndiv"),n=t.buildTag("ul .e-ul"),s=t.buildTag("a",p._getLocStr("NumberTab"),{},{href:"#"+m+"_number"}),a=t.buildTag("li",s),o=t.buildTag("a",p._getLocStr("FontTab"),{},{href:"#"+m+"_font"}),d=t.buildTag("li",o),n.append(a),n.append(d),r.append(n),l.append(r),h=t.buildTag("div.e-dlg-btnfields"),c=t.buildTag("div.e-dlg-btnctnr"),u=t.buildTag("input#"+m+"_okbtn"),g=t.buildTag("input#"+m+"_cantn"),u.ejButton({text:p._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgCFOk,this),cssClass:"e-ss-okbtn"}),g.ejButton({text:p._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._dlgCFCancel,this)}),h.append(c.append(u,g)),l.append(t.buildTag("div#"+m+"_format_dataMnger","",{display:"none"})),p.element.append(i.append(l,h)),r.ejTab({width:"100%",height:"auto",cssClass:"e-ss-dlgtab",allowKeyboardNavigation:!1,itemActive:t.proxy(this._numberTabChange,this)}),e("#"+p._id+"_formatdlg_format_dataMnger").data("style",{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"}),this._renderNumberTab(),this._renderFontTab(),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:p._getLocStr("Formatcells"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-mattab e-ss-fcdlg e-"+p._id+"-dlg",open:function(){e("#"+p._id+"_formatdlg_okbtn").focus()}})},_renderNumberTab:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v=this.XLObj,w=v._id+"_fdlg_nTab",I=this._categories;r=[{text:"Wednesday, March 14, 2012",value:"{0:dddd, MMMM dd, yyyy}"},{text:"3/14/2012",value:"{0:M/d/yyyy}"},{text:"March 03",value:"{0:MMMM dd}"},{text:"2012 March",value:"{0:yyyy MMMM}"},{text:"3/14/12 1:30 PM",value:"{0:dd/MM/yyyy h:mm tt}"}],l=[{text:"0",type:"default"},{text:"0.00",type:"default"},{text:"#,##0",type:"default"},{text:"#,##00.00",type:"default"},{text:"0%",type:"default"},{text:"0.00%",type:"default"},{text:"MM/dd/yyyy",type:"default"},{text:"d-MMM",type:"default"},{text:"h:mm",type:"default"},{text:"mm:ss",type:"default"}],n=[{text:"1:30:55 PM",value:"{0:h:mm:ss tt}"},{text:"1:30 PM",value:"{0:h:mm tt}"},{text:"13:30:55",value:"{0:h:mm:ss}"},{text:"1:30",value:"{0:hh:mm}"}];var y=t.buildTag("div.e-ss-maindiv"),T=t.buildTag("div.e-ss-topdiv","",{display:"table",width:"100%"}),L=t.buildTag("div.e-ss-centerdiv","",{display:"table",width:"100%"}),R=t.buildTag("div.e-ss-lefttopdiv",""),O=t.buildTag("div.e-ss-righttopdiv","","");for(o=t.buildTag("label.e-dlg-fields",v._getLocStr("FormatSample")),O.append(o),T.append(R,O),R=t.buildTag("div.e-ss-leftdiv",""),O=t.buildTag("div.e-ss-rightdiv","",{float:"left"}),a=t.buildTag("input#"+w+"_sinput.ejinputtext","",{},{disabled:"disabled"}),O.append(a),i=t.buildTag("div#div"+w,""),d=t.buildTag("table","",{"white-space":"normal"}),h=t.buildTag("tr#"+w+"_decimal.e-fdlg-num-options"),c=t.buildTag("td",t.buildTag("label.e-dlg-fields",v._getLocStr("DecimalPlacesTxt")),"",{width:"103px"}),d.append(h.append(c)),h=t.buildTag("tr#"+w+"_decimaldrop.e-fdlg-num-options"),c=t.buildTag("td"),a=t.buildTag("input#"+w+"_decimalplace",""),O.append(i.append(d.append(h.append(c.append(a))))),h=t.buildTag("tr#"+w+"_tseparator.e-fdlg-num-options"),c=t.buildTag("td","","",{colspan:"2"}),s=t.buildTag("input#"+w+"_kseptr"),d.append(h.append(c.append(s))),h=t.buildTag("tr#"+w+"_dtypes.e-fdlg-num-options"),c=t.buildTag("td",t.buildTag("label.e-dlg-fields",v._getLocStr("Type"))),u=t.buildTag("ul#"+w+"_datetypes"),d.append(h.append(c.append(u))),h=t.buildTag("tr#"+w+"_ttypes.e-fdlg-num-options"),c=t.buildTag("td",t.buildTag("label.e-dlg-fields",v._getLocStr("Type"))),g=t.buildTag("ul#"+w+"_timetypes"),d.append(h.append(c.append(g))),h=t.buildTag("tr#"+w+"_custom.e-fdlg-num-options"),c=t.buildTag("td",t.buildTag("label.e-dlg-fields",v._getLocStr("Type"))),p=t.buildTag("input#"+w+"_custominput.ejinputtext"),m=t.buildTag("ul#"+w+"_customtypes"),_=t.buildTag("button#"+w+"_delBtn",v._getLocStr("Delete"),{},{type:"button"}),f=t.buildTag("div",_),d.append(h.append(c.append(p,m,f))),v._on(p,"keydown",this._validateCustomFormat),b=t.buildTag("div#"+w+"_typeinfo.e-ss-fcgdiv","",{}),O.append(i),L.append(R,O),e("#"+v._id+"_formatdlg_number").append(y.append(T,L,b)),d.find(".e-fdlg-num-options").hide(),this._createNumList(I,R),a.ejNumericTextbox({name:"numeric",value:2,height:27,width:"100%",minValue:0,maxValue:30,change:e.proxy(this._refreshFrmtPropChanges,this)}),s.ejCheckBox({change:e.proxy(this._refreshFrmtPropChanges,this)}),s.parent().append(t.buildTag("label.e-dlg-fields",v._getLocStr("ThousandSeparatorTxt"),{"margin-left":6})),u.ejListBox({selectedItemIndex:"0",dataSource:r,fields:{text:"text",value:"value"},width:"100%",height:"120",selected:e.proxy(this._refreshFrmtPropChanges,this)}),g.ejListBox({selectedItemIndex:"0",dataSource:n,fields:{text:"text",value:"value"},width:"100%",height:"120",selected:e.proxy(this._refreshFrmtPropChanges,this)}),m.ejListBox({selectedItemIndex:"0",dataSource:l,fields:{text:"text",value:"value"},width:"100%",height:"100",selected:e.proxy(this._refreshFrmtPropChanges,this)}),e("#"+w+"_datetypes_container").addClass("e-ss-datetypes"),e("#"+w+"_timetypes_container").addClass("e-ss-timetypes"),e("#"+w+"_customtypes_container").addClass("e-ss-customtypes"),C=0;C<4;C++)S=l[C+6].text,x=C>2?t.Spreadsheet.CellType.Date:t.Spreadsheet.CellType.Time,v.XLFormat.addCustomFormatSpecifier(null,S,x);_.ejButton({showRoundedCorner:!0,width:60,click:e.proxy(this._customFormatDelete,this)})},_initFormatCellDlg:function(){var t,i=this.XLObj;if(!i.model.allowCellFormatting)return!1;e("#"+i._id+"_formatdlg").ejDialog("open"),e("#"+i._id+"_formatdlg_format_dataMnger").data("style",{"font-family":"Calibri","font-weight":"normal","font-style":"normal","font-size":"11pt","text-decoration":"none",color:"#333333"}),e("#"+i._id+"_formatdlg_format_dataMnger").removeData("NumFormat"),this._updateFormtdata(),(t=e("#"+i._id+"_formatdlg_formattab").data("ejTab"))&&t._refresh()},_createFontStyleList:function(){var i=this.XLObj,r=i._id+"_fdlg_fonttab",l=t.buildTag("div.e-ss-drpfontdiv"),n=t.buildTag("div .e-ss-stylediv"),s=t.buildTag("div .e-ss-stylediv"),o=t.buildTag("div .e-ss-stylediv"),a=t.buildTag("div .e-ss-stylediv"),d=t.buildTag("input#"+r+"_family"),h=t.buildTag("label",i._getLocStr("Preview"),"",{id:r+"_previewlabel"}),c=t.buildTag("input#"+r+"_sinput2.ejinputtext","",{height:"75px","text-align":"center"},{disabled:"disabled",value:"AaBbCcYyZz"}),u=t.buildTag("input#"+r+"_style"),g=t.buildTag("div#"+r+"_normalfont2","",{"padding-left":"10px"}),p=t.buildTag("div .e-ss-colordiv","",{"padding-right":"0px"}),m=t.buildTag("input#"+r+"_size"),_=t.buildTag("div .e-ss-stylediv"),f=t.buildTag("div .e-ss-fontcntdiv"),b=t.buildTag("div .e-ss-colordiv"),C=t.buildTag("div .e-ss-colordiv"),S=t.buildTag("label",i._getLocStr("Color"),"",{id:r+"_colorlabel"}),x=t.buildTag("label",i._getLocStr("BackgroundColor"),"",{id:r+"_filllabel"}),v=t.buildTag("input#"+r+"_color"),w=t.buildTag("input#"+r+"_fillcolor"),I=t.buildTag("input#"+r+"_effects");n.append(d),s.append(u),o.append(m),a.append(I),b.append(x,w),C.append(S,v),p.append(t.buildTag("label",i._getLocStr("NormalFont")),g),_.append(b,C,p),f.append(h,c),l.append(n,s,o,a,_,f),d.ejDropDownList({dataSource:i.XLRibbon._fontFamily,width:"100%",select:e.proxy(this._onFontFamilySelect,this),selectedItemIndex:6}),u.ejDropDownList({dataSource:i.XLRibbon._fontStyle,width:"100%",select:e.proxy(this._onFontStyleSelect,this),selectedItemIndex:0}),m.ejDropDownList({dataSource:i.XLRibbon._fontSize,width:"100%",select:e.proxy(this._onFontSizeSelect,this),selectedItemIndex:3}),I.ejDropDownList({dataSource:this._effects,width:"100%",watermarkText:"None",select:e.proxy(this._onFontEffectSelect,this)}),v.ejColorPicker({value:"#333333",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_color"),change:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_color"),select:e.proxy(this._selectCPHandler,this,"fdlg_fonttab_color")}),w.ejColorPicker({value:"#FFFFFF",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolor"),change:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolor"),select:e.proxy(this._selectCPHandler,this,"fdlg_fonttab_fillcolor")}),g.ejCheckBox({size:"small",change:e.proxy(this._changeNormalFont,this)}),e("#"+i._id+"_formatdlg_font").prepend(l)},_renderFontTab:function(){var i=this.XLObj,r=i._id+"_fdlg_fonttab",l=t.buildTag("div.e-ss-fontmaindiv"),n=t.buildTag("div .e-ss-fontcntdiv"),s=t.buildTag("div .e-ss-fontstylediv"),o=t.buildTag("div .e-ss-fontstylediv"),a=t.buildTag("div .e-ss-fontstylediv"),d=t.buildTag("label",i._getLocStr("FontFamily"),"",{id:r+"_familylabel"}),h=t.buildTag("label",i._getLocStr("FontStyle"),"",{id:r+"_stylelabel"}),c=t.buildTag("label",i._getLocStr("FontSize"),"",{id:r+"_sizelabel"});s.append(d),a.append(h),o.append(c),n.append(s,a,o);var u=t.buildTag("div .e-ss-fontcntdiv","",{width:"103%"}),g=t.buildTag("div .e-ss-fontstylediv"),p=t.buildTag("div .e-ss-fontstylediv","",{"margin-right":"0px"}),m=t.buildTag("div .e-ss-fontstylediv"),_=t.buildTag("ul#"+r+"_familylist"),f=t.buildTag("ul#"+r+"_stylelist"),b=t.buildTag("ul#"+r+"_sizelist"),C=t.buildTag("input#"+r+"_familytext .ejinputtext","",{width:"150px"},{value:"Calibri"}),S=t.buildTag("input#"+r+"_styletext .ejinputtext","",{width:"150px"},{value:"Normal"}),x=t.buildTag("input#"+r+"_sizetext .ejinputtext","",{width:"150px"},{value:11});g.append(C,_),m.append(S,f),p.append(x,b),_.ejListBox({selectedItemIndex:"6",width:"150px",height:"150px",dataSource:i.XLRibbon._fontFamily,fields:{text:"text",value:"value"},select:e.proxy(this._onFontFamilySelect,this),allowMultiSelection:!1}),f.ejListBox({selectedItemIndex:"0",width:"150px",height:"150px",dataSource:i.XLRibbon._fontStyle,fields:{text:"text",value:"value"},select:e.proxy(this._onFontStyleSelect,this),allowMultiSelection:!1}),b.ejListBox({selectedItemIndex:"3",width:"150px",height:"150px",dataSource:i.XLRibbon._fontSize,fields:{text:"text",value:"value"},select:e.proxy(this._onFontSizeSelect,this),allowMultiSelection:!1}),u.append(g,m,p);var v=t.buildTag("div .e-ss-fontcntdiv"),w=t.buildTag("div .e-ss-fontstylediv"),I=t.buildTag("div .e-ss-fontnrmldiv"),y=t.buildTag("div .e-ss-fontcdiv"),T=t.buildTag("div .e-ss-fontcdiv"),L=t.buildTag("label",i._getLocStr("Effects"),"",{id:r+"_effectslabel"}),R=t.buildTag("label",i._getLocStr("Color"),"",{id:r+"_colorlabel"}),O=t.buildTag("label",i._getLocStr("BackgroundColor"),"",{id:r+"_filllabel"}),F=t.buildTag("input#"+r+"_effectstext .ejinputtext"),E=t.buildTag("input#"+r+"_colortext .ejinputtext",""),D=t.buildTag("input#"+r+"_fillcolortext .ejinputtext",""),N=t.buildTag("label#"+r+"_normalfont","",{"padding-left":"10px"});w.append(L,F),y.append(R,E),T.append(O,D),I.append(t.buildTag("label",i._getLocStr("NormalFont"),"",{id:r+"_fillcolorlabel"}),N),v.append(w,y,T,I),F.ejDropDownList({dataSource:this._effects,watermarkText:"None",select:e.proxy(this._onFontEffectSelect,this),width:"150px"}),N.ejCheckBox({size:"small",change:e.proxy(this._changeNormalFont,this)}),E.ejColorPicker({value:"#333333",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_colortext"),change:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_colortext")}),D.ejColorPicker({value:"#FFFFFF",modelType:"palette",showSwitcher:!1,cssClass:"e-ss-colorpicker",open:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolortext"),change:e.proxy(this._ChangeCPHandler,this,"fdlg_fonttab_fillcolortext")});var A=t.buildTag("div .e-ss-fontcntdiv","",{width:"20px"}),P=t.buildTag("label",i._getLocStr("Preview"),"",{id:r+"_previewlabel"}),k=t.buildTag("input#"+r+"_sinput.ejinputtext","",{height:"80px",width:"480px","padding-top":"10px","text-align":"center"},{disabled:"disabled",value:"AaBbCcYyZz"});A.append(P,k),e("#"+i._id+"_formatdlg_font").append(l.append(n,u,v,A)),this._createFontStyleList()},_updateFormtdata:function(){var i,r,l,n,s,o,a,d,h,c=this.XLObj,u=c.getActiveCell(),g=e("#"+c._id+"_fdlg_nTab_list").data("ejListBox"),p=e("#"+c._id+"_fdlg_nTab_decimalplace").data("ejNumericTextbox"),m=e("#"+c._id+"_fdlg_nTab_datetypes").data("ejListBox"),_=e("#"+c._id+"_fdlg_nTab_timetypes").data("ejListBox"),f=e("#"+c._id+"_fdlg_nTab_input").data("ejDropDownList"),b=e("#"+c._id+"_fdlg_nTab_customtypes").data("ejListBox"),C=e("#"+c._id+"_fdlg_fonttab_familylist").data("ejListBox"),S=e("#"+c._id+"_fdlg_fonttab_stylelist").data("ejListBox"),x=e("#"+c._id+"_fdlg_fonttab_sizelist").data("ejListBox"),v=e("#"+c._id+"_fdlg_fonttab_effectstext").data("ejDropDownList"),w=e("#"+c._id+"_fdlg_fonttab_colortext").data("ejColorPicker"),I=e("#"+c._id+"_fdlg_fonttab_fillcolortext").data("ejColorPicker");g&&g._refreshScroller(),r="decimalPlaces"in(i=c.getRangeData({range:[u.rowIndex,u.colIndex,u.rowIndex,u.colIndex]})[0])?i.decimalPlaces:2,l="thousandSeparator"in i&&i.thousandSeparator,n="type"in i?i.type.indexOf("date")>-1?"date":i.type:"general","formatStr"in i?(s=m.getIndexByValue(i.formatStr),o=_.getIndexByValue(i.formatStr),c.isUndefined(s)&&c.isUndefined(o)&&["date"].indexOf(n)>-1&&(a=b.model.dataSource,d=i.formatStr.replace(/^\{0\:|\}$/g,""),c._isValueAlreadyExist(a,"text",d)||(a.push({text:d,type:"custom"}),b._setModel({dataSource:a})),h=b.getIndexByText(d),n="custom")):s=o=0,g&&g.selectItemByValue(e.camelCase("-"+n)),m.selectItemByIndex(s>-1?s:0),_.selectItemByIndex(o>-1?o:0),b.selectItemByIndex(h>-1?h:0),"string"===n&&(g.selectItemByIndex(10),b.selectItemByText(i.formatStr)),"formats"in i?(t.isNullOrUndefined(i.formats["font-size"])?x.selectItemByText("11"):x.selectItemByText(i.formats["font-size"].split("pt")[0]),t.isNullOrUndefined(i.formats["font-style"])&&t.isNullOrUndefined(i.formats["font-weight"])&&S.selectItemByText("Normal"),t.isNullOrUndefined(i.formats["font-style"]&&t.isNullOrUndefined(i.formats["font-weight"]))||S.selectItemByText(i.formats["font-style"].capitalizeFirstString()),t.isNullOrUndefined(i.formats["font-weight"]&&t.isNullOrUndefined(i.formats["font-style"]))||S.selectItemByText(i.formats["font-weight"].capitalizeFirstString()),t.isNullOrUndefined(i.formats["font-style"])||t.isNullOrUndefined(i.formats["font-weight"])||S.selectItemByText("Bold Italic"),t.isNullOrUndefined(i.formats["font-family"])?C.selectItemByText("Calibri"):C.selectItemByText(i.formats["font-family"].replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})),t.isNullOrUndefined(i.formats["text-decoration"])?v.clearText():v.selectItemByText(i.formats["text-decoration"]),t.isNullOrUndefined(i.formats.color)?w.setValue("#333333"):w.setValue(i.formats.color),t.isNullOrUndefined(i.formats["background-color"])?I.setValue("#FFFFFF"):I.setValue(i.formats["background-color"])):this._changeNormalFont({isChecked:!0}),p.option("value",r),e("#"+c._id+"_fdlg_nTab_kseptr").ejCheckBox({checked:l}),this._onNumFormatSelect({value:g?g.model.value:f.model.value})},_onNumFormatSelect:function(t){var i,r=this.XLObj,l="#"+r._id+"_fdlg_nTab_",n=e("#"+r._id+"_fdlg_nTab_typeinfo"),s=t.value;switch(e("#"+r._id+"_formatdlg_number").find(".e-fdlg-num-options").hide(),s){case"Number":r.model.formatSettings.allowDecimalPlaces&&e(l+"decimal, "+l+"tseparator, "+l+"decimaldrop").show();break;case"Currency":case"Accounting":case"Percentage":case"Scientific":e(l+"decimal").show(),e(l+"decimaldrop").show();break;case"Date":e(l+"dtypes").show(),e("#"+r._id+"_fdlg_nTab_datetypes").data("ejListBox")._refreshScroller();break;case"Time":e(l+"ttypes").show(),e("#"+r._id+"_fdlg_nTab_timetypes").data("ejListBox")._refreshScroller();break;case"Custom":e(l+"custom").show(),e("#"+r._id+"_fdlg_nTab_customtypes").data("ejListBox")._refreshScroller()}i=this._getFormattedText(s),e("#"+r._id+"_fdlg_nTab_decimalplace").data("ejNumericTextbox").option("maxValue","Scientific"===s?20:30),e("#"+r._id+"_fdlg_nTab_sinput").val(i),n.text(r._getLocStr(s)),this._selValue=s},_getFormattedText:function(i){var r,l,n,s,o,a=0,d=this.XLObj,h=d.getActiveCell(),c=e("#"+d._id+"_fdlg_nTab_decimalplace").data("ejNumericTextbox"),u=e("#"+d._id+"_fdlg_nTab_datetypes").data("ejListBox"),g={Number:"0:N",Currency:"0:C",Accounting:"0:C",Percentage:"0:P",Scientific:"0:N"},p=e("#"+d._id+"_fdlg_nTab_timetypes").data("ejListBox"),m=t.Spreadsheet.CellType,_=t.Spreadsheet.CellFormat,f=e("#"+d._id+"_fdlg_nTab_customtypes").data("ejListBox");switch(d.model.formatSettings.allowDecimalPlaces&&(a=c.getValue()),n=d.XLEdit.getPropertyValue(h.rowIndex,h.colIndex)||"",l=e("#"+d._id+"_fdlg_nTab_kseptr").ejCheckBox("checked"),i){case"Number":case"Currency":case"Accounting":case"Percentage":r="{"+g[i]+a+"}",d._isDateTime(n)&&(n=d._dateToInt(n)),n=d.XLFormat._format(n,d.XLFormat._getFormatObj({formatStr:r,thousandSeparator:l,type:m[i],decimalPlaces:a}));break;case"Date":i=(r=u.getSelectedItems()[0].value)===_.longdate?"longdate":r===_.shortdate?"shortdate":"date",n=d.XLFormat._format(n,d.XLFormat._getFormatObj({formatStr:r,type:i}));break;case"Time":r=p.getSelectedItems()[0].value,n=d.XLFormat._format(n,d.XLFormat._getFormatObj({formatStr:r,type:m[i]})),a=0;break;case"Scientific":r="{"+g[i]+a+"}",d._isDateTime(n)&&(n=d._dateToInt(n)),n=d.XLFormat._format(n,d.XLFormat._getFormatObj({formatStr:r,thousandSeparator:l,type:m[i],decimalPlaces:a}));break;case"Fraction":d._isDateTime(n)&&(n=d._dateToInt(n)),(n=d.toFraction(n))&&(n=t.isNullOrUndefined(n.numerator)?n.integer:n.integer+" "+n.numerator+"/"+n.denominator);break;case"General":case"Text":d._isDateTime(n)&&(n=d._dateToInt(n));break;case"Custom":s=f.getSelectedItems()[0].text,o=d.XLFormat.customFormatParser(s),e("#"+d._id+"_fdlg_nTab_custominput").val(s),n=d.XLFormat._format(n,o),f.getSelectedItems()[0].index>-1&&e("#"+d._id+"_fdlg_nTab_delBtn").data("ejButton")._setModel({enabled:"custom"===f.model.dataSource[f.getSelectedItems()[0].index].type})}return e("#"+d._id+"_formatdlg_format_dataMnger").data("NumFormat","Custom"===i?o:{type:i.toLowerCase(),decimalPlaces:a,thousandSeparator:l,formatStr:r}),n},_numberTabChange:function(){var t=this.XLObj,i=e("#"+t._id+"_fdlg_nTab_list").data("ejListBox"),r=e("#"+t._id+"_fdlg_fonttab_familylist").data("ejListBox"),l=e("#"+t._id+"_fdlg_fonttab_stylelist").data("ejListBox"),n=e("#"+t._id+"_fdlg_fonttab_sizelist").data("ejListBox");i&&i._refreshScroller(),l&&l._refreshScroller(),n&&n._refreshScroller(),r&&r._refreshScroller()},_refreshFrmtPropChanges:function(){var t,i=this.XLObj;t=this._getFormattedText(this._selValue),e("#"+i._id+"_fdlg_nTab_sinput").val(t)},_dlgCFCancel:function(){var t=this.XLObj;e("#"+t._id+"_formatdlg").ejDialog("close"),t.model.showRibbon&&t.XLRibbon._updateRibbonIcons(),t._setSheetFocus()},_dlgCFOk:function(t){var i,r=this.XLObj;if(r.XLFormat._styleDlgClick)return e("#"+r._id+"_formatdlg").ejDialog("close"),void r._setSheetFocus();i=e("#"+r._id+"_formatdlg_format_dataMnger").data(),t&&"Custom"===this._selValue&&this._validateCustomFormat()||(r.getObjectLength(i)&&(r.getObjectLength(i.NumFormat)?(i.NumFormat.style=i.style,r.XLFormat.format(i.NumFormat)):r.XLFormat.format(i)),r.model.showRibbon&&r.XLRibbon._updateRibbonIcons(),e("#"+r._id+"_formatdlg").ejDialog("close"),r._setSheetFocus())},_customFormatDelete:function(){var t=e("#"+this.XLObj._id+"_fdlg_nTab_customtypes").data("ejListBox"),i=t.model.dataSource;i.splice(t.model.selectedItemIndex,1),t._setModel({dataSource:i}),t.selectItemByIndex(0),this._refreshFrmtPropChanges()},_validateCustomFormat:function(t){var i,r,l,n=t?this:this.XLObj,s=e("#"+n._id+"_fdlg_nTab_custominput").val(),o=n.XLFormat.customFormatParser(s);if(!t||13===t.keyCode){if(!n.getObjectLength(o))return l=e("#"+n._id+"_alertdlg"),n._renderAlertDlgContent(l,"Alert",n._getLocStr("CustomFormatAlert")),l.ejDialog("open"),!0;r=(i=e("#"+n._id+"_fdlg_nTab_customtypes").data("ejListBox")).model.dataSource,n._isValueAlreadyExist(r,"text",s)||(r.push({text:s,type:"custom"}),i._setModel({dataSource:r})),e("#"+n._id+"_formatdlg_format_dataMnger").data("NumFormat",o),t&&n.XLCellFrmtDlg._dlgCFOk()}},_onFontFamilySelect:function(t){var i=this.XLObj,r=t.text;e("#"+i._id+"_fdlg_fonttab_familytext")[0].value=r,e("#"+i._id+"_fdlg_fonttab_sinput")[0].style.fontFamily=r,e("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.fontFamily=r,e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-family"]=r,"Calibri"!=r&&(e("#"+i._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),e("#"+i._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))},_changeNormalFont:function(t){if(t&&t.isChecked){var i=this.XLObj,r=e("#"+i._id+"_fdlg_fonttab_familylist").data("ejListBox"),l=e("#"+i._id+"_fdlg_fonttab_stylelist").data("ejListBox"),n=e("#"+i._id+"_fdlg_fonttab_sizelist").data("ejListBox"),s=e("#"+i._id+"_fdlg_fonttab_effectstext").data("ejDropDownList"),o=e("#"+i._id+"_fdlg_fonttab_colortext").data("ejColorPicker"),a=e("#"+i._id+"_fdlg_fonttab_fillcolortext").data("ejColorPicker"),d=e("#"+i._id+"_fdlg_fonttab_family").data("ejDropDownList"),h=e("#"+i._id+"_fdlg_fonttab_style").data("ejDropDownList"),c=e("#"+i._id+"_fdlg_fonttab_size").data("ejDropDownList"),u=e("#"+i._id+"_fdlg_fonttab_effects").data("ejDropDownList"),g=e("#"+i._id+"_fdlg_fonttab_color").data("ejColorPicker"),p=e("#"+i._id+"_fdlg_fonttab_fillcolor").data("ejColorPicker");n.selectItemByText("11"),l.selectItemByText("Normal"),r.selectItemByText("Calibri"),s.clearText(),c.selectItemByText("11"),h.selectItemByText("Normal"),d.selectItemByText("Calibri"),u.clearText(),p.setValue("#FFFFFF"),g.setValue("#333333"),e("#"+i._id+"_fdlg_fonttab_sinput")[0].style.textDecoration="none",e("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.textDecoration="none",a.setValue("#FFFFFF"),o.setValue("#333333")}},_onFontStyleSelect:function(t){var i=this.XLObj,r=t.text,l=e("#"+i._id+"_fdlg_fonttab_sinput")[0],n=e("#"+i._id+"_fdlg_fonttab_sinput2")[0],s=e("#"+i._id+"_fdlg_fonttab_normalfont").data("ejCheckBox"),o=e("#"+i._id+"_fdlg_fonttab_normalfont2").data("ejCheckBox");switch(e("#"+i._id+"_fdlg_fonttab_styletext")[0].value=r,r){case"Bold":e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-weight"]=r,l.style.fontWeight=r,l.style.removeProperty("font-style"),n.style.fontWeight=r,n.style.removeProperty("font-style"),s.option({checked:!1}),o.option({checked:!1});break;case"Italic":e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-style"]=r,l.style.fontStyle=r,l.style.removeProperty("font-weight"),n.style.fontStyle=r,n.style.removeProperty("font-weight"),s.option({checked:!1}),o.option({checked:!1});break;case"Bold Italic":e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-weight"]="Bold",e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-style"]="Italic",l.style.fontStyle="Italic",l.style.fontWeight="Bold",n.style.fontStyle="Italic",n.style.fontWeight="Bold",s.option({checked:!1}),o.option({checked:!1});break;case"Normal":e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-weight"]="normal",e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-style"]="normal",l.style.removeProperty("font-weight"),l.style.removeProperty("font-style"),n.style.removeProperty("font-weight"),n.style.removeProperty("font-style")}},_onFontSizeSelect:function(t){var i=this.XLObj,r=t.text;e("#"+i._id+"_fdlg_fonttab_sizetext")[0].value=r,e("#"+i._id+"_fdlg_fonttab_sinput")[0].style.fontSize=r+"pt",e("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.fontSize=r+"pt",e("#"+i._id+"_formatdlg_format_dataMnger").data().style["font-size"]=r+"pt","11"!=r&&(e("#"+i._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),e("#"+i._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))},_onFontEffectSelect:function(t){var i=this.XLObj,r=t.text;e("#"+i._id+"_formatdlg_format_dataMnger").data().style["text-decoration"]=r,e("#"+i._id+"_fdlg_fonttab_sinput")[0].style.textDecoration=r,e("#"+i._id+"_fdlg_fonttab_sinput2")[0].style.textDecoration=r,"None"!=r&&(e("#"+i._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),e("#"+i._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))},_ChangeCPHandler:function(t,i){var r,l=this.XLObj;"open"===i.type?(e("#"+l._id+"_"+t+"_popup").find(".e-buttons, .e-button").hide(),e("#"+l._id+"_"+t+"_popup").focus()):"change"===i.type&&(r=e("#"+l._id+"_"+t).data("ejColorPicker"),"fdlg_fonttab_fillcolortext"===t||"fdlg_fonttab_fillcolor"===t?(e("#"+l._id+"_formatdlg_format_dataMnger").data().style["background-color"]=i.value,e("#"+l._id+"_fdlg_fonttab_sinput").css("background-color",i.value),e("#"+l._id+"_fdlg_fonttab_sinput2").css("background-color",i.value),"#FFFFFF"!=i.value&&(e("#"+l._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),e("#"+l._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))):("fdlg_fonttab_colortext"===t||"fdlg_fonttab_color"===t)&&(e("#"+l._id+"_formatdlg_format_dataMnger").data().style.color=i.value,e("#"+l._id+"_fdlg_fonttab_sinput").css("color",i.value),e("#"+l._id+"_fdlg_fonttab_sinput2").css("color",i.value),"#333333"!=i.value&&(e("#"+l._id+"_fdlg_fonttab_normalfont").ejCheckBox({checked:!1}),e("#"+l._id+"_fdlg_fonttab_normalfont2").ejCheckBox({checked:!1}))),r&&(r.hide(),l._dupDetails=!0,r.setValue(i.value),l._dupDetails=!1))},_createNumList:function(i,r){var l,n,s,o=this.XLObj,a=o._id+"_fdlg_nTab",d=t.buildTag("div.e-ss-drpdiv");n=t.buildTag("input#"+a+"_input"),d.append(n),e("#"+o._id+"_formatdlg_number").prepend(d),n.ejDropDownList({dataSource:i,cssClass:"e-ss-num-format",width:"100%",fields:{id:"value",text:"text",value:"text"},select:e.proxy(this._onNumFormatSelect,this),selectedItemIndex:0}),l=t.buildTag("label#"+a+"_clabel.e-dlg-fields",o._getLocStr("Category")),o.element.find(".e-ss-lefttopdiv").append(l),s=t.buildTag("ul#"+a+"_list"),r.append(s),s.ejListBox({selectedItemIndex:"0",width:"120",height:"250",dataSource:i,fields:{text:"text",value:"value"},select:e.proxy(this._onNumFormatSelect,this),allowMultiSelection:!1})}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.shape=function(e){this.XLObj=e,this._imgX=0,this._imgY=0,this._imgOffsetleft=0,this._imgOffsetTop=0,this._shapeType="img",this._shapeROStart=!1,this._shapeRSStart=!1,this._imgRSWStart=!1,this._imgRSEStart=!1,this._imgRSNStart=!1,this._imgRSSStart=!1,this._changePicture=!1,this._picCellIdx={},this._insertShape=!1,this._isRowGreater=!1},t.spreadsheetFeatures.shape.prototype={_insertPicture:function(e){var t,i,r,l,n=this.XLObj,s="msie"===n._browserDetails.name&&parseInt(n._browserDetails.version)<10?e.responseText:e.xhr.response;if(s.startsWith("Invalid"))n._showAlertDlg("Alert","ImageValAlert");else if(t=n.getActiveSheetIndex(),i=n.getSheet(t),this._changePicture)this.changePicture(null,s);else{var o=n.getActiveCell(),a=n.model.pictureSettings,d=a.height,h=a.width;r=i._colWidthCollection[o.colIndex],l=i._rowHeightCollection[o.rowIndex],this._insertShape=!0,this._createPicture(t,o,s,l,r,h,d)}},changePicture:function(t,i){var r,l,n,s,o,a,d,h=this.XLObj,c=h.getActiveSheetIndex(),u=h.getSheet(c);l=(r=t?e("#"+t).get(0):h.getSheetElement(c).find(".e-ss-activeimg").get(0)).offsetLeft,n=r.offsetTop,s=this._getCellIndexFromOffset(n,l),o=u.shapeMngr,e(r).css("background-image","url('"+i+"')"),a=o.picture[r.id],d={sheetIndex:c,reqType:"shape",shapeType:"picture",action:"changepicture",id:e(r).attr("id"),cell:s,prev:{img:o.sharedPics[a.data],data:a.data,pcIdx:r.id},cur:{img:i,pcIdx:r.id}},-1===o.sharedPics.indexOf(i)&&o.sharedPics.push(i),a.data=o.sharedPics.indexOf(i),d.cur.data=a.data,this._changePicture=!1,h._setSheetFocus(),h._completeAction(d),h._trigActionComplete(d)},setPicture:function(e,t,i,r,l,n){var s,o,a,d,h,c=this.XLObj;if(c.model.pictureSettings.allowPictures&&!c.model.isReadOnly)return s=(e=c._getRangeArgs(e,"object"))[0],o=e[1],c.model.allowLockCell&&c._isCellProtected(s,o,!1)?void 0:(a=c.getActiveSheetIndex(),h=c.model.pictureSettings,r=r||h.height,i=i||h.width,c._isRowViewable(a,s)?(d=c.getCell(s,o)[0],l=l||d.offsetTop,n=n||d.offsetLeft):(l=l||0,n=n||0),this._createPicture(a,{rowIndex:s,colIndex:o},t,l,n,i,r))},resetPicture:function(i,r){var l,n,s,o,a=this.XLObj;l=i?e("#"+i):a.element.find(".e-ss-activeimg"),n=new RegExp("\\be-shapebdr.*?\\b","g"),s={sheetIndex:a.getActiveSheetIndex(),reqType:"shape",shapeType:"picture",action:"resetpicture",id:e(l).attr("id"),actionType:r},a._dupDetails=!0,t.isNullOrUndefined(l[0].className.match(n))||(o=a.XLShape._getImgStyleFromHashCode(l[0].className.match(n)[0])),s.prev=o?{bcolor:o["border-color"],bstyle:o["border-style"],bwidth:o["border-width"]}:{},l[0].className=l[0].className.replace(n,""),s.cur={bcolor:l.css("border-color"),bstyle:l.css("border-style"),bwidth:l.css("border-width")},"resetpicture"!=r&&(s.prev.width=l.css("width"),s.prev.height=l.css("height"),l.css({width:a.model.pictureSettings.width,height:a.model.pictureSettings.height}),s.cur.width=l.css("width"),s.cur.height=l.css("height"),a.XLShape._updateShapeObj(l[0]),a._hasClass(l[0],"e-ss-activeimg")&&a.XLRibbon._formatTabUpdate()),a._dupDetails=!1,a._completeAction(s),a._trigActionComplete(s)},_createPicture:function(e,i,r,l,n,s,o,a,d,h,c,u){var g,p,m;d=d||"transparent",h=h||"solid",c=c||"1px";var _,f,b=this.XLObj,C=b.getSheet(e),S={sheetIndex:e,targetCell:i,top:l,left:n,width:s,height:o,bcolor:d,bstyle:h,bwidth:c,reqType:"picture",add:"add"};if(_={sheetIndex:S.sheetIndex,targetCell:S.targetCell,top:S.top,left:S.left,width:S.width,height:S.height,bcolor:S.bcolor,bstyle:S.bstyle,bwidth:S.bwidth,reqType:"picture",action:"add"},!b._trigActionBegin(_))return C._isImported||(this._insertShape=!0),l=S.top,n=S.left,s=S.width,o=S.height,a=t.isNullOrUndefined(a)?b.model.allowCharts&&b.XLChart._shapeCnt:a,b._isExport&&(u.cnt=a),f=b._id+"_picture"+a,p=(i=this._getCellIndexFromOffset(l,n,e)).rowIndex,m=i.colIndex,!b._isUndoRedo&&b.model.allowCharts&&b.XLChart._shapeCnt++,this._updateShapeMngr(i,{picture:{data:r,id:f,height:o,width:s,left:n,top:l,rowIndex:p,colIndex:m,bwidth:c,bcolor:d,bstyle:h}},"picture"),b._isExport||this._refreshPictureElement({top:l,left:n,width:s,height:o,bcolor:d,bstyle:h,bwidth:c,imgData:r,cnt:a,sheetIdx:e}),b._setSheetFocus(),C._isImported&&!C._isLoaded||b._isUndoRedo||b._isPaste||b.XLClipboard._isShape||b._isExport||((g={sheetIndex:e,reqType:"shape",shapeType:"picture",action:"create",id:f,actCell:i,img:r,cnt:a}).position={top:l,left:n,height:o,width:s},b._completeAction(g),b._trigActionComplete(g)),b.model.showRibbon&&b.XLRibbon._formatTabUpdate(),f},_refreshPictureElement:function(i){var r,l,n,s=this.XLObj;s._getJSSheetContent(i.sheetIdx).find(".e-spreadsheetcontentcontainer > .e-content").append(t.buildTag("div.e-ss-object","","",{id:s._id+"_picture"+i.cnt})),(r=e("#"+s._id+"_picture"+i.cnt)).data("parentID",s._id),r.css({"background-image":"url('"+i.imgData+"')",height:i.height,width:i.width,left:i.left,top:i.top}),l=i.bwidth+" "+i.bstyle+" "+i.bcolor,n=this._getImgBorderHashCode({"border-color":i.bcolor,"border-style":i.bstyle,"border-width":i.bwidth}),s.model.allowCellFormatting&&s.XLFormat._writeCssRules(n,s.XLFormat._getCssPropertyAsString({border:{left:l,right:l,top:l,bottom:l}})),r.addClass(n),this._selectImg(r)},_shapeMouseDown:function(t){var i,r;t.preventDefault(),i=this.XLObj,r=document.activeElement.id,i._isTouchEvt&&this._imgMouseMove(t),(r.indexOf("PictureHeight")>-1||r.indexOf("PictureWidth")>-1)&&i._setSheetFocus();var l,n=t.target.id,s=e(t.target),o=s.get(0),a=o.offsetLeft,d=o.offsetTop,h=i._setXY(t);this._selectImg(s),this._picCellIdx=this._getCellIndexFromOffset(d,a),this._imgOffsetleft=a,this._imgOffsetTop=d,this._imgX=h[0],this._imgY=h[1],this._shapeType=n.indexOf("chart")>-1?"chart":"img",this._shapeROStart=!0,"move"===s.css("cursor")?this._shapeROStart=!0:("col-resize"===s.css("cursor")||"row-resize"===s.css("cursor"))&&(this._shapeRSStart=!0,i._getContent(i.getActiveSheetIndex()).find(".e-ss-imgvisual").css({left:a,top:d,height:s.height(),width:s.width()})),"chart"===this._shapeType&&(l=i.XLChart._getShapeObj(n,this._shapeType),i.getActiveSheetIndex()!==l.dataSheetIdx||l.isChartSeries||i.XLChart._focusChartRange(l.xAxis.range,l.yAxis.range,l.legend.range)),i.model.enableContextMenu&&i.XLCMenu._isMenuOpened&&i.XLCMenu.hideCMenu()},_imgKeyDown:function(e){var t,i,r,l=this.XLObj,n=l.getActiveSheetIndex(),s=l._getContent(n).find(".e-ss-activeimg"),o=s.get(0),a=o.offsetLeft,d=o.offsetTop;if(this._shapeType=s[0].id.indexOf("chart")>-1?"chart":"img",s[0].id.indexOf("_S")&&(this._shapeType="sparkline"),this._picCellIdx=this._getCellIndexFromOffset(d,a),e.shiftKey||e.ctrlKey)e.shiftKey&&!e.ctrlKey&&(39===e.keyCode||38===e.keyCode?(e.preventDefault(),t=s.height()+2,i=s.width()+2,t<400&&i<600&&s.css({width:i,height:t}),this._updateShapeObj(o),l.XLRibbon._formatTabUpdate()):(37===e.keyCode||40===e.keyCode)&&(e.preventDefault(),t=s.height()-2,i=s.width()-2,t>40&&i>60&&s.css({width:i,height:t}),this._updateShapeObj(o),l.XLRibbon._formatTabUpdate()));else{switch(e.keyCode){case 39:e.preventDefault(),s.css({left:a+2}),this._updateShapeObj(o);break;case 37:e.preventDefault(),a>1&&s.css({left:a-2}),this._updateShapeObj(o);break;case 38:e.preventDefault(),d>1&&s.css({top:d-2}),this._updateShapeObj(o);break;case 40:e.preventDefault(),s.css({top:d+2}),this._updateShapeObj(o)}this._onKeyscrollShape(n,s,e)}46===e.keyCode&&(e.preventDefault(),r=!1,l.XLClipboard._isShape&&(l.XLClipboard._isShape=!1,r=!0),this._deleteShape(n,s),r&&(l.XLClipboard._isShape=!0))},_shapeMouseUp:function(t){var i=this.XLObj,r={};if(!i._isExport){var l,n,s,o="chart",a=i.getActiveSheetIndex(),d=i.getSheet(a),h=i._getContent(a),c=h.find(".e-ss-activeimg"),u=h.find(".e-ss-imgvisual"),g=e(t.target),p=g.get(0);if((g.hasClass("e-ss-picture")||g[0].id.indexOf(i._id+"_picture")>-1)&&i.model.showRibbon&&i.XLRibbon._formatTabUpdate(),("svg"===p.localName||"rect"===p.localName||"path"===p.localName||"circle"===p.localName)&&p&&p.id.indexOf("chart")<0?p=e(p).closest("div.e-sparkline")[0]:e(p).hasClass("e-sparkline")&&(p=p),p&&p.id.indexOf(o)>-1&&p.id.indexOf("Ribbon")<0&&(p=p.id.indexOf("_svg")>-1?e(p).parents(".e-ss-object").get(0):p),c.length<1&&(this._shapeROStart=!1),p.id.indexOf("sparkline")>-1||p.className.indexOf("e-ss-imgvisual")>-1||p.className.indexOf("e-ss-object")>-1||(this._shapeROStart&&(p=c[0]),this._shapeRSStart&&(p=u[0])),this._shapeROStart)i._isTouchEvt&&(n=i._getOriginalEvt(t),p=document.elementFromPoint(n.clientX,n.clientY)),i._isUndoRedo||(parseInt(c.css("top"))!==p.offsetTop||parseInt(c.css("left"))!==p.offsetLeft)&&((s={sheetIndex:a,reqType:"shape",shapeType:"chart",action:"edit",actionType:"reorder",id:e(c).attr("id"),visualImg:u,trgt:g}).prev={top:parseInt(c.css("top")),left:parseInt(c.css("left")),height:parseInt(c.css("height")),width:parseInt(c.css("width"))},s.cur={top:p.offsetTop,left:p.offsetLeft,height:g.height(),width:g.width()},c[0].id.indexOf(o)>-1&&(l=i._getIdxWithOffset(s.cur.top,s.cur.left,!0),d.shapeMngr[o][c[0].id].rowIndex=l.rowIdx,d.shapeMngr[o][c[0].id].colIndex=l.colIdx),i._checkIndicesInContainer(a,this._picCellIdx.rowIndex,this._picCellIdx.colIndex)&&(s.obj=e.extend(!0,{},i._dataContainer.sheets[a][this._picCellIdx.rowIndex][this._picCellIdx.colIndex]),i._completeAction(s),i._trigActionComplete(s))),c.css({left:p.offsetLeft,top:p.offsetTop}),this._updateShapeObj(p),u.removeClass("e-ss-picture").hide();else if(this._shapeRSStart&&(i._isUndoRedo||(i._isTouchEvt&&(p=u[0]),p.className.indexOf("e-ss-imgvisual")<0&&u.length>0&&this._shapeROStart&&(p=u[0]),g=e(p),(parseInt(c.css("height"))!==g.height()||parseInt(c.css("width"))!==g.width())&&i._checkIndicesInContainer(a,this._picCellIdx.rowIndex,this._picCellIdx.colIndex)&&((s={sheetIndex:a,reqType:"shape",shapeType:"chart",action:"edit",actionType:"resize",id:e(c).attr("id"),visualImg:u,trgt:g}).prev={top:parseInt(c.css("top")),left:parseInt(c.css("left")),height:parseInt(c.css("height")),width:parseInt(c.css("width"))},s.cur={top:p.offsetTop,left:p.offsetLeft,height:g.height(),width:g.width()},s.obj=e.extend(!0,{},i._dataContainer.sheets[a][this._picCellIdx.rowIndex][this._picCellIdx.colIndex]),i._completeAction(s),i._trigActionComplete(s))),s&&c.css({left:p.offsetLeft,top:p.offsetTop,height:g.height(),width:g.width()}),this._updateShapeObj(p),u.removeClass("e-ss-picture").hide(),"img"===this._shapeType&&i.model.showRibbon&&i.XLRibbon._formatTabUpdate(),this._shapeType===o&&(i.XLChart.resizeChart(c.attr("id"),g.height(),g.width()),i.model.showRibbon&&i.XLRibbon._chartDesignTabUpdate(e("#"+c.attr("id")))),r.event=t,r.target=t.target,s&&s.cur&&s.prev&&(r.newHeight=s.cur.height,r.newWidth=s.cur.width,r.oldHeight=s.prev.height,r.oldWidth=s.prev.width),r.reqType=p.id.indexOf(o)>-1?"chart-resize":"picture-resize",this.XLObj._trigger("resizeEnd",r)))return this._refreshImgResizing(),void(this._shapeRSStart=!1);this._refreshImgResizing(),this._shapeROStart=this._shapeRSStart=!1}},_imgMouseMove:function(e){var t=this.XLObj,i={};if(t._getContent(t.getActiveSheetIndex()).find(".e-ss-activeimg").length){e.preventDefault();var r,l,n,s=t.getActiveSheetIndex(),o=t._getContent(s),a=o.find(".e-ss-activeimg"),d=o.find(".e-ss-imgvisual"),h=a.get(0),c=h.getBoundingClientRect(),u=t._setXY(e),g=u[0],p=u[1];if(this._shapeROStart){if(this.XLObj._trigger("dragShape",e))return!1;d.show(),h.id.indexOf("picture")>-1&&d.addClass("e-ss-picture"),l=g-(this._imgX-this._imgOffsetleft),n=p-(this._imgY-this._imgOffsetTop),l>-1&&n>-1&&d.css({left:l,top:n,height:a.height(),width:a.width()})}else{var m=d.width(),_=d.height(),f=h.offsetWidth,b=h.offsetHeight,C=t._getJSSheetContent(s).find(".e-spreadsheetcontentcontainer > .e-content"),S=o.find(".e-hscrollbar").data("ejScrollBar"),x=o.find(".e-vscrollbar").data("ejScrollBar");if(this._shapeRSStart){if(i.event=e,i.target=e.target,i.height=a.height(),i.width=a.width(),i.reqType=h.id.indexOf("chart")>-1?"chart-resize":"picture-resize",this.XLObj._trigger("resizeStart",i))return void(this._shapeRSStart=!1);if(d.show(),h.id.indexOf("picture")>-1&&d.addClass("e-ss-picture"),"col-resize"===a.css("cursor")||"row-resize"===a.css("cursor"))switch(!0){case this._imgRSWStart:r=this._imgX-g,(l=d[0].offsetLeft-r)>-1&&(d.css({width:m+r,left:l}),this._imgX=g);break;case this._imgRSEStart:r=this._imgX-g,t.model.scrollSettings.allowScrolling&&m-r+d[0].offsetLeft+5<C.width()+S.value()&&(d.css({width:m-r}),this._imgX=g);break;case this._imgRSNStart:r=this._imgY-p,(n=d[0].offsetTop-r)>-1&&(d.css({height:_+r,top:n}),this._imgY=p);break;case this._imgRSSStart:r=this._imgY-p,t.model.scrollSettings.allowScrolling&&_-r+d[0].offsetTop+5<C.height()+x.value()&&(d.css({height:_-r}),this._imgY=p)}}else this._refreshImgResizing(),g<=c.left+(t._isTouchEvt?20:4)&&g>=c.left?(a.addClass("e-ss-imgcresize"),this._imgRSWStart=!0):g<=c.left+f&&g>=c.left+f-(t._isTouchEvt?20:4)?(a.addClass("e-ss-imgcresize"),this._imgRSEStart=!0):o.find(".e-ss-imgcresize").removeClass("e-ss-imgcresize"),p<=c.top+(t._isTouchEvt?20:4)&&p>=c.top?(a.addClass("e-ss-imgrresize"),this._imgRSNStart=!0):p<=c.top+b&&p>=c.top+b-(t._isTouchEvt?20:4)?(a.addClass("e-ss-imgrresize"),this._imgRSSStart=!0):o.find(".e-ss-imgrresize").removeClass("e-ss-imgrresize")}}},_deleteShape:function(e,t){var i,r,l,n=this.XLObj,s=t[0].id.indexOf("_S")>-1?{rowIndex:t[0].id.replace(n._id,"").split("_")[3],colIndex:t[0].id.replace(n._id,"").split("_")[4]}:this._picCellIdx,o=n._dataContainer,a=n.getSheet(e),d=a.shapeMngr,h=o.sheets[e][s.rowIndex][s.colIndex],c=t.data("parentID"),u=t[0].id.indexOf("_S")>-1?t[0].id:t.get(0).id.replace(c+"_",""),g=t[0].id.indexOf("_S")>-1?"sparkline":u.replace(/[0-9]/g,""),p=t.get(0),m=t[0].id.indexOf("_S")>-1?d[g][t[0].id]:d[g][h[g][0]];n._isUndoRedo||n._isPaste||n.XLClipboard._isShape||((r={sheetIndex:e,id:p.id,picIndex:p.id,reqType:"shape",shapeType:g,action:"remove",options:m,range:m.range,img:d.sharedPics[m.data],bcolor:m.bcolor,bstyle:m.bstyle,bwidth:m.bwidth}).actCell={rowIndex:s.rowIndex,colIndex:s.colIndex},r.position={height:m.height,width:m.width,top:m.top,left:m.left},r.cnt=u.replace(/[a-z]/g,""),n._completeAction(r),n._trigActionComplete(r)),h[g].some(function(e,t){return p.id===d[g][h[g][t]].id&&(l=t,!0)}),Object.keys(h).length<2&&h[g].length<2?(delete o.sheets[e][s.rowIndex][s.colIndex],n.getObjectLength(o.sheets[e][s.rowIndex])<1&&delete o.sheets[e][s.rowIndex]):h[g].length<2?delete h[g]:h[g].splice(l,1),delete d[g][p.id],i={rowIndex:s.rowIndex,colIndex:s.colIndex},e===n._getSheetIndex()&&(n.setActiveCell(s.rowIndex,s.colIndex),n.performSelection(i,i)),t.remove(),n.model.allowFormulaBar&&n.updateFormulaBar(),n.model.showRibbon&&("picture"===g?n.XLRibbon._toggleFormatTab():n.XLRibbon._toggleChartDesignTab()),a._isChartBorderDrawn&&n.XLChart._clearChartRange(n._arrayAsString(n._chartBorder))},_selectImg:function(e){this.XLObj._getContent(this.XLObj.getActiveSheetIndex()).find(".e-ss-activeimg").removeClass("e-ss-activeimg"),e.addClass("e-ss-activeimg"),this.XLObj.XLSelection._cleanUp(!0),this.XLObj.model.allowFormulaBar&&this.XLObj.updateFormulaBar()},_refreshImgResizing:function(){this._imgRSEStart=!1,this._imgRSWStart=!1,this._imgRSNStart=!1,this._imgRSSStart=!1},_getShapePropeties:function(e,t,i){for(var r,l=this.XLObj.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,i);r in l;)return l[r].id===t?l[r]:void 0},_updateShapeMngr:function(t,i,r,l){var n,s={},o=this.XLObj,a=l||o.getActiveSheetIndex(),d=o.getSheet(a).shapeMngr,h=d[r];h[i[r].id]=e.extend(!0,{},i[r]),"picture"===r&&(d.sharedPics.indexOf(i[r].data)<0&&d.sharedPics.push(i[r].data),n=d.sharedPics.indexOf(i[r].data),h[i[r].id].data=n),(o._isPaste||this._insertShape||o.XLClipboard._isShape||o.isImport||o.model.isImport||!o.getSheet(a)._isUpdated)&&(s[r]=i[r].id,o.XLEdit._updateDataContainer(t,{dataObj:s,sheetIdx:a}),this._insertShape=!1)},_updateShapeObj:function(e){var i,r,l,n,s,o,a=this.XLObj,d=a.getActiveSheetIndex(),h=a._dataContainer,c="img"===this._shapeType?"picture":"chart",u=a.getSheet(d),g=u.shapeMngr,p={},m=a._getContent(d).find(".e-ss-activeimg");e.id.indexOf("Column")>-1||e.id.indexOf("Line")>-1||e.id.indexOf("Winloss")>-1?(s=e.id.replace(a._id,""),n={rowIndex:parseInt(s.split("_")[3]),colIndex:parseInt(s.split("_")[4])},c="sparkline"):n=this._picCellIdx,a.getObjectLength(this._picCellIdx)||(n=this._picCellIdx=this._getCellIndexFromOffset(e.offsetTop,e.offsetLeft)),i=m.length?m:a._getContent(d).find("#"+e.id),(l=h.sheets[d][n.rowIndex][n.colIndex])&&l[c]&&(r=g[c][i[0].id],l[c].some(function(e,t){return i[0].id===g[c][l[c][t]].id&&(o=t,!0)}),t.isNullOrUndefined(o)||(p[c]=l[c][o],a.getObjectLength(l)<2&&l[c].length<2?delete h.sheets[d][n.rowIndex][n.colIndex]:l[c].length<2?delete h.sheets[d][n.rowIndex][n.colIndex][c]:h.sheets[d][n.rowIndex][n.colIndex][c].splice(o,1),e.id.indexOf("Column")>-1||e.id.indexOf("Line")>-1||e.id.indexOf("Winloss")>-1?(s=e.id.replace(a._id,""),this._picCellIdx=n={rowIndex:parseInt(s.split("_")[3]),colIndex:parseInt(s.split("_")[4])}):this._picCellIdx=n=this._getCellIndexFromOffset(e.offsetTop,e.offsetLeft),"sparkline"!=r.shapeType&&(r.height=i.height(),r.width=i.width()),r.left=u._isFreezed&&a._isFrozen(a.getFrozenColumns())?a.XLFreeze._getFreezeHidenDim()+i[0].offsetLeft:i[0].offsetLeft,r.top=u._isFreezed&&a._isFrozen(a.getFrozenRows())?a.XLFreeze._getFreezeHidenDim(!0)+i[0].offsetTop:i[0].offsetTop,r.rowIndex=n.rowIndex,r.colIndex=n.colIndex,a.XLEdit._updateDataContainer({rowIndex:n.rowIndex,colIndex:n.colIndex},{dataObj:p})))},changePictureBorder:function(i,r,l,n){var s,o,a,d,h=this.XLObj,c=h.getActiveSheetIndex(),u=e("#"+i)[0],g=u.offsetLeft,p=u.offsetTop,m=this._getCellIndexFromOffset(p,g),_=h.getSheet(c).shapeMngr,f=new RegExp("\\be-shapebdr.*?\\b","g");o=_.picture[u.id],s={sheetIndex:c,reqType:"shape",shapeType:"picture",action:"border",id:e(h.getSheetElement(c).find(".e-ss-activeimg")).attr("id"),prevClass:t.isNullOrUndefined(u.className.match(f))?u.className:u.className.match(f)[0],picIdx:void 0,cellIdx:m},a=r+" "+l+" "+n,d=this._getImgBorderHashCode({"border-color":n,"border-style":l,"border-width":r}),h.model.allowCellFormatting&&h.XLFormat._writeCssRules(d,h.XLFormat._getCssPropertyAsString({border:{left:a,right:a,top:a,bottom:a}})),o.bcolor=n,o.bstyle=l,o.bwidth=r,u.className.match(f)&&(u.className=u.className.replace(f,"")),e(u).addClass(d),s.curClass=d,s.borderProp=this._getImgStyleFromHashCode(d),h._dupDetails||h._isUndoRedo||(h._completeAction(s),h._trigActionComplete(s))},_getCellIndexFromOffset:function(e,i,r,l){var n,s,o,a=0,d={},h=this.XLObj,c=h.getSheet(h._getSheetIndex(r));if(!t.isNullOrUndefined(e))for(d.rowIndex=h._getMinRowIdx(c),n=0,s=c._rowHeightCollection.length;n<s;n++){if(o=c._rowHeightCollection[n],(a=h.isUndefined(o)?a+h.model.rowHeight:o)>e){d.rowIndex=n-1;break}n==s-1&&s++}if(!t.isNullOrUndefined(i))for(d.colIndex=0,n=0,a=0,s=c.columnsWidthCollection.length;n<s;n++)if((a+=0===c.columnsWidthCollection[n]&&l?c.hideColsCollection[n]:c.columnsWidthCollection[n])>i){d.colIndex=n;break}return d},_getImgBorderHashCode:function(e){var t=this.XLObj,i="";return"border-width"in e&&(i=parseInt(e["border-width"])+"N"),t.model.allowCellFormatting&&"border-style"in e&&(i=i+t.XLFormat._getStyleCode("BorderStyle",e["border-style"])+"N"),"border-color"in e&&(i+=e["border-color"].replace("#","")),"e-shapebdr"+i},_getImgStyleFromHashCode:function(e){var t={};return(e=(e=e||"").replace("e-shapebdr","").split("N")).length>1&&(t["border-width"]=e[0]+"px",t["border-style"]=["","solid","dashed","dotted"][e[1]],t["border-color"]="#"+e[2]),t},_scrollShape:function(e,t,i,r){var l={position:"none",action:"none"},n=this.XLObj,s=n._getJSSheetContent(e).find(".e-spreadsheetcontentcontainer > .e-content");parseInt(t.css("width"))+(t.offset().left-n._getContent(e).find(".e-content").offset().left)>n._getContent(e).find(".e-content").width()&&this._imgX<=i?l={position:"horizontal",action:"Increment"}:t.offset().left-s.offset().left<=0?l={position:"horizontal",action:"Decrement"}:parseInt(t.css("height"))+(t.offset().top-n._getContent(e).find(".e-content").offset().top)>n._getContent(e).find(".e-content").height()&&this._imgY<=r?l={position:"vertical",action:"Increment"}:t.offset().top-s.offset().top<=0&&(l={position:"vertical",action:"Decrement"}),n.XLSelection._scrollCalculation(e,t.get(0),l)},_onKeyscrollShape:function(e,t,i){var r=this.XLObj,l=r._getJSSheetContent(e).find(".e-spreadsheetcontentcontainer > .e-content"),n=r._getContent(e).find("#hscrollBar").ejScrollBar("instance"),s=r._getContent(e).find("#vscrollBar").ejScrollBar("instance");l.offset().top+l[0].offsetHeight<=t.offset().top+t[0].offsetHeight&&(40===i.keyCode||13===i.keyCode&&!i.shiftKey)?s.scroll(s.value()+2,!0):t.offset().top-r.model.sheets[e]._frozenHeight<=l.offset().top&&(38===i.keyCode||13===i.keyCode&&i.shiftKey)&&s.value()-2>=0&&s.scroll(s.value()-2,!0),l[0].offsetWidth<=t.offset().left+t[0].offsetWidth&&(39===i.keyCode||9===i.keyCode&&!i.shiftKey)?n.scroll(n.value()+2,!0):t.offset().left-r.model.sheets[e]._frozenWidth<=l.offset().left&&(37===i.keyCode||9===i.keyCode&&i.shiftKey)&&n.value()-2>=0&&n.scroll(n.value()-2,!0)},_refreshShapePosOnResize:function(e,t,i,r){var l,n,s,o,a=this.XLObj,d=a.getSheet(r),h=d.shapeMngr.chart,c=d.shapeMngr.picture;if(!a.getObjectLength(c)&&!a.getObjectLength(h))return!1;for(o in l=t-(i?d.columnsWidthCollection[e]:d.rowsHeightCollection[e]),c)s=c[o],i?e<s.colIndex&&(s.left+=l,(n=a.getSheetElement(r).find("#"+s.id)).length&&n.css({left:s.left})):e<s.rowIndex&&(s.top+=l,(n=a.getSheetElement(r).find("#"+s.id)).length&&n.css({top:s.top}));for(o in h)s=h[o],i?e<s.colIndex&&(s.left+=l,(n=a.getSheetElement(r).find("#"+s.id)).length&&n.css({left:s.left})):e<s.rowIndex&&(s.top+=l,(n=a.getSheetElement(r).find("#"+s.id)).length&&n.css({top:s.top}))},_refreshChartdataInsDel:function(i,r,l,n,s){var o,a,d,h,c,u,g,p,m=this.XLObj,_=m.getSheet(n),f=_.shapeMngr.chart,b=i.status,C=[];if(this._isRowGreater=!1,!s){for(o=0;o<r;o++)p=b.indexOf("insert")>-1?2*(b.indexOf("Column")>-1?_.columnsWidthCollection[l+o]:_.rowsHeightCollection[l+o]):0,this._refreshShapePosOnResize(l+o,p,b.indexOf("Column")>-1,n);m.isUndefined(s)&&(s=!0)}if(s)for(c in f)switch(g=(u=f[c]).range,a=u.isRowColSwitched?u.lRange:u.xRange,d=u.yRange,h=u.isRowColSwitched?u.xRange:u.lRange,b){case"insertColumn":g&&(g[2]-g[0]>g[3]-g[1]&&(this._isRowGreater=!0)),m._isUndo?t.isNullOrUndefined(i.prevChartDetails)||m.XLChart.refreshChart(i.prevChartDetails.id,i.prevChartDetails):!m._isUndo&&m._isUndoRedo?t.isNullOrUndefined(i.curChartDetails)||m.XLChart.refreshChart(i.curChartDetails.id,i.curChartDetails):g&&l<=g[1]&&!u.isChartSeries?(m._prevChartDetails=e.extend(!0,{},{id:u.id,range:u.range,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,isRowColSwitched:u.isRowColSwitched}),g[1]+=r,g[3]+=r,u.range=g,m.XLChart.refreshChart(u.id,{range:u.range}),m._curChartDetails=e.extend(!0,{},{id:u.id,range:u.range,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,isRowColSwitched:u.isRowColSwitched})):this._isRowGreater||!m._inColumn(g,l)||u.isChartSeries?(this._isRowGreater||u.seriesRange.length)&&(m._prevChartDetails=e.extend(!0,{},{id:u.id,range:u.range,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isRowColSwitched:u.isRowColSwitched}),(t.isNullOrUndefined(u.seriesRange)||0==u.seriesRange.length)&&(C=this._constructSeriesRange(u,this._isRowGreater)),u.seriesRange=this._isInSeriesRange(u,0!=C.length?C:u.seriesRange,l,r,b),C=[],u.range=null,u.xRange=null,u.yRange=null,u.lRange=null,u.isChartSeries=!0,m.XLChart._refreshChart(u),m._curChartDetails=e.extend(!0,{},{id:u.id,range:u.range,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,isRowColSwitched:u.isRowColSwitched})):(u.seriesRange=null,m._prevChartDetails=e.extend(!0,{},{id:u.id,range:u.range,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,isRowColSwitched:u.isRowColSwitched}),l<d[1]||l<a[1]?(g[1]+=r,g[3]+=r,u.range=g,u.isChartSeries=!1,m.XLChart.refreshChart(u.id,{range:u.range,isChartSeries:u.isChartSeries})):l>d[1]&&l<=d[3]?(g[3]+=r,u.range=g,u.isChartSeries=!1,m.XLChart.refreshChart(u.id,{range:u.range,isChartSeries:u.isChartSeries})):l<=d[1]&&(d[1]+=r,d[3]+=r,a[1]+=r,a[3]+=r,u.range=null,u.xRange=null,u.yRange=null,u.lRange=null,u.isChartSeries=!0,u.isRowColSwitched=!1,u.seriesRange=[{xRange:[a[0],a[1],a[2],a[3]],yRange:[d[0],d[1],d[2],d[3]],lRange:[h[0],h[1],h[2],h[3]]}],u.seriesRange=this._constructSeriesRange(u,this._isRowGreater),m.XLChart._refreshChart(u)),m._curChartDetails=e.extend(!0,{},{id:u.id,range:u.range,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,isRowColSwitched:u.isRowColSwitched}));break;case"deleteColumn":m._prevChartDetails=e.extend(!0,{},{id:u.id,range:u.range,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isRowColSwitched:u.isRowColSwitched}),m._isUndo?t.isNullOrUndefined(i.prevChartDetails)||m.XLChart.refreshChart(i.prevChartDetails.id,i.prevChartDetails):!m._isUndo&&m._isUndoRedo?t.isNullOrUndefined(i.curChartDetails)||m.XLChart.refreshChart(i.curChartDetails.id,i.curChartDetails):g?(l<g[1]?(g[1]-=r,g[3]-=r):l>g[1]&&l<=g[3]?g[3]-=r:l==g[1]&&(g[3]-=r),u.range=g,m.XLChart.refreshChart(u.id,u)):u.seriesRange.length&&(u.seriesRange=this._isInSeriesRange(u,u.seriesRange,l,r,b),m.XLChart._refreshChart(u)),m._curChartDetails=e.extend(!0,{},{id:u.id,range:u.range,xRange:u.xRange,yRange:u.yRange,lRange:u.lRange,isChartSeries:u.isChartSeries,seriesRange:u.seriesRange,isRowColSwitched:u.isRowColSwitched});break;case"insertRow":case"deleteRow":!t.isNullOrUndefined(g)&&l<=g[0]?("insertRow"==b?(g[0]+=r,g[2]+=r):(g[0]-=r,g[2]-=r),m.XLChart.refreshChart(u.id,{range:g})):m._inRow(u.range,l)&&m.XLChart.refreshChart(u.id,{range:g})}},_constructSeriesRange:function(e,i){var r,l,n,s,o,a,d,h,c,u,g,p=0,m=this.XLObj,_=[],f=[],b=[],C=e.seriesRange;for(s=t.isNullOrUndefined(e.xRange)?t.isNullOrUndefined(C)||t.isNullOrUndefined(C[0])||t.isNullOrUndefined(C[0].xRange)?null:C[0].xRange:e.xRange,o=t.isNullOrUndefined(e.yRange)?t.isNullOrUndefined(C)||t.isNullOrUndefined(C[0])||t.isNullOrUndefined(C[0].yRange)?null:C[0].yRange:e.yRange,a=t.isNullOrUndefined(e.lRange)?t.isNullOrUndefined(C)||t.isNullOrUndefined(C[0])||t.isNullOrUndefined(C[0].lRange)?null:C[0].lRange:e.lRange,t.isNullOrUndefined(a)||(d=a[3]-a[1],g=[a[0],a[1],a[2],a[3]-d]),t.isNullOrUndefined(o)||(c=h=o[3]-o[1],u=[o[0],o[1],o[2],o[3]-h]),i||(d=a[2]-a[0],c=h=o[2]-o[0],g=[a[0],a[1],a[2]-d,a[3]],u=[o[0],o[1],o[2]-h,o[3]]),_=[];p<=c;)i?(l=m.getAlphaRange(u[0],u[1]++,u[2],u[3]++),b.push(l),n=m.getAlphaRange(g[0],g[1]++,g[2],g[3]++),f.push(n)):(l=m.getAlphaRange(u[0]++,u[1],u[2]++,u[3]),b.push(l),n=m.getAlphaRange(g[0]++,g[1],g[2]++,g[3]),f.push(n)),r=t.isNullOrUndefined(s)?null:m.getAlphaRange(s[0],s[1],s[2],s[3]),l=b[p],n=f[p],_.push({xRange:r,yRange:l,lRange:n}),p++;return _},_isInSeriesRange:function(e,i,r,l,n){var s,o,a,d,h=this.XLObj,c="insertColumn"==n;for(e.seriesRange=[],d=0;d<i.length;d++)s=t.isNullOrUndefined(i[d].xRange)?[]:h.getRangeIndices(i[d].xRange),o=t.isNullOrUndefined(i[d].yRange)?[]:h.getRangeIndices(i[d].yRange),a=t.isNullOrUndefined(i[d].lRange)?[]:h.getRangeIndices(i[d].lRange),r<=s[1]?(s[1]=c?s[1]+l:s[1]-l,s[3]=c?s[3]+l:s[3]-l):r>s[1]&&r<=s[3]&&(s[3]=c?s[3]+l:s[3]-l),r<=o[1]?(o[1]=c?o[1]+l:o[1]-l,o[3]=c?o[3]+l:o[3]-l):r>o[1]&&r<=o[3]&&(o[3]=c?o[3]+l:o[3]-l),r<=a[1]?(a[1]=c?a[1]+l:a[1]-l,a[3]=c?a[3]+l:a[3]-l):r>a[1]&&r<=a[3]&&(a[3]=c?a[3]+l:a[3]-l),e.seriesRange.push({xRange:0==s.length?null:h.getAlphaRange(s[0],s[1],s[2],s[3]),yRange:0==o.length?null:h.getAlphaRange(o[0],o[1],o[2],o[3]),lRange:0==a.length?null:h.getAlphaRange(a[0],a[1],a[2],a[3])});return e.seriesRange}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.chart=function(e){this.XLObj=e,this._shapeCnt=1,this._isNumber=!1,this._isString=!1},t.spreadsheetFeatures.chart.prototype={createChart:function(e,i){var r,l,n,s,o=this.XLObj;if(this._isNumber=!1,this._isString=!1,o.model.allowCharts&&(!o.getSheet()._isLoaded||!o.model.isReadOnly)&&(s={sheetIndex:n=o._getSheetIndex(i.sheetIdx),reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:i,range:e,id:i.id,position:{top:i.top,left:i.left},operation:"create",seriesRange:i.seriesRange,isChartSeries:i.isChartSeries},!o._trigActionBegin(s))){i=s.options,e=s.range,s.id,s.position,s.seriesRange,s.isChartSeries,i=i||{};var a,d,h,c,u,g,p,m,_,f="chart",b=o.getSheet(n),C=!1;if(o._isUndoRedo&&(a=(_=i.id.split("_"))[_.length-1].replace(/[a-z]/g,"")),i.isChartSeries||(i.isChartSeries=i.series&&null==e),i.isChartSeries||(e=o._getRangeArgs(e,"object")),t.isNullOrUndefined(i.top)||t.isNullOrUndefined(i.left)||(i.activeCell=o.XLShape._getCellIndexFromOffset(i.top,i.left)),i.activeCell||(i.activeCell=b._activeCell),o.isRange(e)&&i.activeCell||i.isChartSeries){if(g=o._getCellInfo(i.activeCell),i.id=a?o._id+"_"+f+a:o._id+"_"+f+this._shapeCnt,i.type=i.type?i.type:"column",i.animation=!!i.animation&&i.animation,i.isChartSeries||(i.range=e),i.dataSheetIdx=i.dataSheetIdx?i.dataSheetIdx:n,i.height=i.height?i.height:o.model.chartSettings.height,i.width=i.width?i.width:o.model.chartSettings.width,i.top=i.top?i.top:g.top+2,i.left=i.left?i.left:g.left+2,i.range&&(i.range[2]-i.range[0]<i.range[3]-i.range[1]&&(C=!0)),i.isRowColSwitched=!!C||!!i.isRowColSwitched&&i.isRowColSwitched,u=o._getIdxWithOffset(i.top,i.left,!0),i.rowIndex=u.rowIdx,i.colIndex=u.colIdx,i.isResponsive=!1,i.canResize=!1,i.isChartSeries||(o.isUndefined(i.xRange)&&(m=this._processChartRange(e,i.dataSheetIdx,i),i.xRange=m.xRange,i.yRange=m.yRange,i.lRange=m.lRange),h=this._processChartSeries(i),i.series&&(o.XLClipboard._copyCells.length||o.XLClipboard._cutCells.length)&&(h.series=i.series)),i.isChartSeries)if(o.isUndefined(i.series))h=this._processChartSeries(i),i.series=h.series;else if(i.seriesRange.length>0)for(l=this._processSeriesValues(i).series,r=0;r<l.length;r++)i.series[r].points=l[r].points;return i.isChartSeries||o.getActiveSheetIndex()===i.dataSheetIdx&&this._focusChartRange(h.xRange,h.yRange,h.lRange),(d=this._renderBaseElem(f,i.top,i.left,a)).ejChart(this._processChartOptions(i,i.isChartSeries?null:h.series)),this._afterChartRefresh(),p=d.ejChart("model"),i.series=i.isChartSeries&&p.series,i.theme=p.theme,p.primaryXAxis.range=p.primaryXAxis.actualRange,p.primaryYAxis.range=p.primaryYAxis.actualRange,i.title={text:p.title.text.length?p.title.text:"",align:p.title.textAlignment,font:p.title.font},i.xAxis={min:p.primaryXAxis.range.min,max:p.primaryXAxis.range.max,interval:p.primaryXAxis.range.interval,title:{text:p.primaryXAxis.title.text.length?p.primaryXAxis.title.text:""},range:i.isChartSeries?null:h.xRange},i.yAxis={min:p.primaryYAxis.range.min,max:p.primaryYAxis.range.max,interval:p.primaryYAxis.range.interval,title:{text:p.primaryYAxis.title.text.length?p.primaryYAxis.title.text:""},range:i.isChartSeries?null:h.yRange},i.legend={visible:p.legend.visible,range:i.isChartSeries?null:h.lRange,position:p.legend.position},b._isImported||(o.XLShape._insertShape=!0),o.XLShape._updateShapeMngr(i.activeCell,{chart:i},"chart"),o.element.append("<input id="+o._id+'_chart type="text" style="display:none;"/>'),i.theme.indexOf("dark")>-1&&d.addClass("e-ss-charttheme"),o.model.showRibbon&&!i.hideTab&&o.XLRibbon._chartDesignTabUpdate(d),o._on(d,t.eventType.mouseDown,o._mouseDownHandler),o._on(d,t.eventType.mouseMove,o._mouseMove),d.height(d.height()-5),o._setSheetFocus(),o._isSheetNavigate||b._isImported&&!b._isLoaded||o._isUndoRedo||o._isPaste||o.XLClipboard._isShape||(c={sheetIndex:n,reqType:"shape",shapeType:"chart",action:"create",options:i,range:i.range,id:i.id,position:{top:i.top,left:i.left},operation:"create",seriesRange:i.seriesRange,isChartSeries:i.isChartSeries},o._completeAction(c),o._trigActionComplete(c)),i.id}}},resizeChart:function(i,r,l){var n,s={},o=e("#"+i),a=o.ejChart("model"),d=this.XLObj;d.model.isReadOnly||o.length&&(s.height=!t.isNullOrUndefined(r)&&r>180?r.toString():"180",s.width=!t.isNullOrUndefined(l)&&l>180?l.toString():"180",d.model.allowFormulaBar&&(n=d.element.find(".e-formulabar")[0]),n&&(n.style.display="none"),o.ejChart("option",{size:s}),n&&(n.style.display="block"),d.XLRibbon._setShapeWidthHeight({height:a.size.height,width:a.size.width,shapeType:"chart"}))},refreshChart:function(i,r){var l=this.XLObj;if(l.model.allowCharts&&!l.model.isReadOnly){var n,s,o,a,d="marker",h=this._getShapeObj(i,"chart"),c=l.element.find("#"+i),u=c.data("ejChart");if(h){for(n in r)h[n]=r[n];r.type&&(r.commonSeriesOptions={type:r.type},delete r.type),d in r&&(r.commonSeriesOptions?r.commonSeriesOptions.marker={visible:r.marker.visible}:r.commonSeriesOptions={marker:r.marker},delete r[d]),r.range?(u.model.series.length=0,r.range[0].xRange||r.range[0].yRange||r.range[0].lRange?(r.range[0].lRange=t.isNullOrUndefined(r.range[0].lRange)?"":r.range[0].lRange,h.isChartSeries=!0,h.seriesRange=r.range,s=this._processSeriesValues(h)):(u.model.series.length=0,a=l._getRangeArgs(r.range,"object"),o=this._processChartRange(a,h.dataSheetIdx,h),h.isChartSeries=!1,h.xRange=o.xRange,h.yRange=o.yRange,h.lRange=o.lRange,h.legend.range=o.lRange,s=this._processChartSeries(h),r.xRange=o.xRange,r.yRange=o.yRange,r.lRange=o.lRange,this._focusChartRange(o.xRange,o.yRange,o.lRange)),h.xAxis.range=h.isChartSeries?null:o.xRange,h.yAxis.range=h.isChartSeries?null:o.yRange,r.series=s.series):r.seriesRange&&(h.seriesRange=r.seriesRange,s=this._processSeriesValues(h)),e("#"+i).ejChart("option",r),("left"in r||"top"in r)&&(l.XLShape._shapeType="chart",c.css({left:h.left,top:h.top}),l.XLShape._picCellIdx={rowIndex:h.rowIndex,colIndex:h.colIndex},l.XLShape._selectImg(c),l.XLShape._updateShapeObj(c[0]),l.XLShape._shapeType="img")}}},_processChartOptions:function(e,i){var r,l,n,s,o={commonSeriesOptions:{type:e.type,enableAnimation:e.animation},series:null==i?e.series:i,canResize:e.canResize,size:{height:e.height.toString(),width:e.width.toString()},enableRotation:!1,depth:100,wallSize:2,tilt:0,rotation:34,perspectiveAngle:90,sideBySideSeriesPlacement:!0};if(e.series)for(n=0,s=e.series.length;n<s;n++)t.isNullOrUndefined(o.series[n])||(o.series[n].trendlines=e.series[n].trendlines);return r=l=!1,e.enable3D&&(o.enable3D=!0),e.marker&&(o.commonSeriesOptions.marker=e.marker),e.theme&&(o.theme=e.theme),o.title=e.title||{},this.XLObj.getObjectLength(o.title)>0&&(o.title.textAlignment=e.title.align,delete o.title.align),o.legend=e.legend||{},e.xAxis&&e.xAxis.minorGridLines&&(r=e.xAxis.minorGridLines.visible),e.yAxis&&e.yAxis.minorGridLines&&(l=e.yAxis.minorGridLines.visible),o.primaryYAxis=e.primaryYAxis||{labelFormat:this._chartYAxisFormat(e.yRange),minorTicksPerInterval:5,minorGridLines:{visible:l},minorTickLines:{visible:!1}},o.primaryXAxis=e.primaryXAxis||{labelFormat:this._chartYAxisFormat(e.xRange),minorTicksPerInterval:5,minorGridLines:{visible:r},minorTickLines:{visible:!1},labelIntersectAction:"wrapByWord"},this._isNumber&&this._isString&&(o.primaryXAxis.valueType="category"),o},_chartYAxisFormat:function(e){if(!t.isNullOrUndefined(e)){var i,r=this.XLObj,l=t.globalize.preferredCulture().numberFormat.currency.symbol;return"accounting"===(i=r.XLEdit.getPropertyValue(e[0],e[1],"type"))?l+" {value}":"currency"===i?l+"{value}":"percentage"===i?"{value}%":"{value}"}},_processChartRange:function(e,i,r){var l,n,s,o,a,d,h=this.XLObj,c=e[0],u=e[1],g=!1,p=e[2],m=e[3],_=c===p,f=u===m;return o=h.XLEdit.getPropertyValue(c,m,"value2",i),o=h.XLEdit._parseValue(o).value,a=h.XLEdit.getPropertyValue(p,u,"value2",i),a=h.XLEdit._parseValue(a).value,d=h.XLEdit.getPropertyValue(c,u,"value2",i),d=h.XLEdit._parseValue(d).value,h.isNumber(a)&&d||(g=!0),h.isUndefined(d)&&!_&&!f||"scatter"==r.type&&e[3]-e[1]==1?(l=[c+1,u,p,u],n=[c+1,u+1,p,m],s=[c,u+1,c,m]):t.isNullOrUndefined(a)||!g||_||f?(n=[c,u,p,m],t.isNullOrUndefined(o)||h.isNumber(o)||h._isDateTime(o)?t.isNullOrUndefined(d)&&(_||f)&&(s=[c,u,c,m],_?(n[1]=n[1]+1,s[3]=s[1]):n[0]=n[0]+1):(s=[c,u,c,m],n[0]=n[0]+1)):t.isNullOrUndefined(o)||h.isNumber(o)&&d?(l=[c,u,p,u],n=[c,u+1,p,m]):(l=[c+1,u,p,u],n=[c+1,u+1,p,m],s=[c,u+1,c,m]),{xRange:l,yRange:n,lRange:s}},_processChartSeries:function(e){e=e||{};var t,i,r,l,n,s,o,a,d,h,c,u,g,p=this.XLObj,m=e.xRange,_=e.yRange,f=e.lRange,b=0,C=0,S=[],x=["value2"];if(e.isChartSeries)S=this._processSeriesValues(e).series;else for(l=p.getRangeData({range:_,sheetIdx:e.dataSheetIdx,skipFormula:!0}),o=_[2]-_[0]+1,a=_[3]-_[1]+1,e.isRowColSwitched?(r=f?p._toArrayData(p.getRangeData({range:f,property:x,sheetIdx:e.dataSheetIdx})):this._getVirtualXValues(a+1),m&&(n=p._toArrayData(p.getRangeData({range:m,property:x,sheetIdx:e.dataSheetIdx}))),s=o):(r=m?p._toArrayData(p.getRangeData({range:m,property:x,sheetIdx:e.dataSheetIdx})):this._getVirtualXValues(o+1),f&&(n=p._toArrayData(p.getRangeData({range:f,property:x,sheetIdx:e.dataSheetIdx}))),s=a),i=r.length,u=e.isRowColSwitched?1:s;b<s;){for(c=0,d=[],C=e.isRowColSwitched?C:b;c<i;)l[C]&&(t=l[C].value,p.isFormula(t)&&(t=l[C].value2,"percentage"===l[C].type&&(t=p.XLEdit._parseValue(t).value/100),("currency"===l[C].type||"accounting"===l[C].type)&&(t=p.XLEdit._parseValue(t).value)),p.isNumber(t)?t=Number(t):(g=p._dateToInt(t),t=isNaN(g)?0:g),d.push({x:r[c],y:t})),p.isNumber(r[c])?this._isNumber=!0:this._isString=!0,C+=u,c++;h={points:d},"doughnut"===e.type&&(h.explode=e.explode,h.enableAnimation=e.enableAnimation),n&&(h.name=n[b]),S.push(h),b++}return{series:S,xRange:e.isChartSeries?null:e.isRowColSwitched?f:m,yRange:e.isChartSeries?null:_,lRange:e.isChartSeries?null:e.isRowColSwitched?m:f}},_processSeriesValues:function(e){for(var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x=this.XLObj,v=e.seriesRange,w=v.length,I=[],y=[],T={},L=0;L<w;L++){if(y[L]={xValues:[],yValues:[],lValues:[]},d=v[L].xRange,t.isNullOrUndefined(d))for(o=t.isNullOrUndefined(v[L].points)?e.series[L].points.length:v[L].points.length,a=t.isNullOrUndefined(v[L].points)?e.series[L].points:v[L].points,s=0;s<o;s++)y[L].xValues[s]=a[s].x;else for(h=this._processRangeValues(d,e.dataSheetIdx),b=0;b<h.length;b++)h[b]instanceof Date&&(h[b]=h[b].toLocaleDateString(t.cultureObject.name)),y[L].xValues[b]=h[b];if(c=v[L].yRange,t.isNullOrUndefined(c))for(o=t.isNullOrUndefined(v[L].points)?e.series[L].points.length:v[L].points.length,a=t.isNullOrUndefined(v[L].points)?e.series[L].points:v[L].points,n=0;n<o;n++)y[L].yValues[n]=a[n].y;else for(u=this._processRangeValues(c,e.dataSheetIdx),C=0;C<u.length;C++)_=u[C],x.isNumber(_)?_=Number(_):(f=x._dateToInt(_),_=isNaN(f)?0:f),y[L].yValues[C]=_;if(g=v[L].lRange,t.isNullOrUndefined(g))y[L].lValues[0]=t.isNullOrUndefined(v[L].name)?e.series[L].name:v[L].name;else for(p=this._processRangeValues(g,e.dataSheetIdx),S=0;S<p.length;S++)p[S]instanceof Date&&(p[S]=p[S].toLocaleDateString(t.cultureObject.name)),y[L].lValues[S]=p[S]}for(l=0;l<w;){for(r=0,m=[];r<y[l].xValues.length;)m.push({x:x.isNumber(y[l].xValues[r])?y[l].xValues[r]:"Invalid Date"!==new Date(y[l].xValues[r]).toString()?y[l].xValues[r]:0,y:x.isNumber(y[l].yValues[r])?Number(y[l].yValues[r]):0}),r++;for(T={points:m},i=0;i<y[l].lValues.length;)T.name=y[l].lValues[i],i++;I.push(T),l++}return{series:I}},_processRangeValues:function(e,t){var i,r,l,n,s=this.XLObj;if(e.indexOf(":")>=0)i=s.getRangeData({range:e,property:["value"],sheetIdx:t,valueOnly:!0,skipFormula:!0});else if(e.indexOf(",")>=0)for(r=e.split(","),i=[],n=0;n<r.length;n++)l=s.getRangeData({range:r[n],property:["value"],sheetIdx:t,valueOnly:!0,skipFormula:!0}),i.push(l);else i=s.getRangeData({range:e,property:["value"],sheetIdx:t,valueOnly:!0,skipFormula:!0});return i},_getVirtualXValues:function(e){for(var t=1,i=[];t<e;)i.push(t.toString()),t++;return i},_focusChartRange:function(e,t,i){var r=this.XLObj,l=r._chartBorder;this._clearChartRange(r._arrayAsString(l)),i&&r.XLSelection._focusBorder({rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]},l[0]),e&&r.XLSelection._focusBorder({rowIndex:e[0],colIndex:e[1]},{rowIndex:e[2],colIndex:e[3]},l[1]),r.XLSelection._focusBorder({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]},l[2]),r.getSheet(r.getActiveSheetIndex())._isChartBorderDrawn=!0},_clearChartRange:function(e){var t=this.XLObj;t.XLSelection._clearBorder(e),t.getSheet(t.getActiveSheetIndex())._isChartBorderDrawn=!1},_renderBaseElem:function(i,r,l,n){n=t.isNullOrUndefined(n)?this._shapeCnt:n;var s=this.XLObj,o=e("<div id='"+s._id+"_"+i+n+"' class='e-ss-object' style='top:"+r+"px;left:"+l+"px; min-height:180px; min-width:180px' ></div>");return o.data("parentID",s._id),s._getContent(s.getActiveSheetIndex()).find(".e-content").first().append(o),s.XLShape._selectImg(o),s._isUndoRedo||this._shapeCnt++,o},_refreshChartElements:function(e,t,i){for(var r,l,n,s=this.XLObj,o=1,a=s.model.sheetCount+1;o<a;){if(r=s.getSheet(o).shapeMngr.chart,l=s.getObjectLength(r))for(;l--;)(n=r[s.getObjectKeys(r)[l]]).dataSheetIdx===i&&(this.XLObj.inRange(n.range,e,t)||this.XLObj._inRow(n.range,e)||this.XLObj._inColumn(n.range,t)||this.XLObj.XLChart._isSeriesRange(n,e,t))&&this._refreshChart(n);o++}},_isSeriesRange:function(e,t,i){var r,l,n,s,o,a;if(e.seriesRange)for(a=0;a<e.seriesRange.length;a++)if((r=e.seriesRange[a]).xRange&&(n=this._isChartSeriesRange(r.xRange,t,i)),r.yRange&&(s=this._isChartSeriesRange(r.yRange,t,i)),r.lRange&&(o=this._isChartSeriesRange(r.lRange,t,i)),l=n||s||o)return l;return!1},_isChartSeriesRange:function(e,t,i){var r,l,n,s,o=this.XLObj;if(e.indexOf(":")>=0){if(r=o._getRangeArgs(e),o.inRange(r,t,i))return!0}else if(e.indexOf(",")>=0){for(l=e.split(","),s=0;s<l.length;s++)if(n=o._getRangeArgs(l[s]),o.inRange(n,t,i))return!0}else if(r=o._getRangeArgs(e),o.inRange(r,t,i))return!0;return!1},_refreshChart:function(t){if(0!==e("#"+t.id).length){var i,r,l=this.XLObj,n=e("#"+t.id).data("ejChart"),s={xRange:t.xRange,yRange:t.yRange,lRange:t.lRange,isRowColSwitched:t.isRowColSwitched,dataSheetIdx:t.dataSheetIdx,seriesRange:t.seriesRange,isChartSeries:t.isChartSeries,series:t.series};n.model.series.length=0,r=this._processChartSeries(s),l.model.allowFormulaBar&&(i=l.element.find(".e-formulabar")[0]),i&&(i.style.display="none"),n.model.primaryXAxis.range.min=n.model.primaryXAxis.range.max=n.model.primaryXAxis.range.interval=null,n.model.primaryYAxis.range.min=n.model.primaryYAxis.range.max=n.model.primaryYAxis.range.interval=null,n.option({series:r.series,primaryXAxis:{labelFormat:this._chartYAxisFormat(t.xRange)},primaryYAxis:{labelFormat:this._chartYAxisFormat(t.yRange)}}),n.model.primaryXAxis.range=n.model.primaryXAxis.actualRange,n.model.primaryYAxis.range=n.model.primaryYAxis.actualRange,i&&(i.style.display="block")}},switchRowColumn:function(t){var i,r=this.XLObj;if(!r.model.isReadOnly&&(i={sheetIndex:r.getActiveSheetIndex(),reqType:"shape",type:"actionBegin",shapeType:"chart",action:"srcolumn",chartId:t,rowIndex:r.XLShape._picCellIdx.rowIndex,colIndex:r.XLShape._picCellIdx.colIndex},!r._trigActionBegin(i))){var l,n,s=(t=i.chartId)||document.getElementById(r._id+"_chart").value,o=e("#"+s).ejChart("instance"),a=r.XLChart._getShapeObj(s,"chart"),d={sheetIndex:r.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:"srcolumn",cid:s,rowIndex:r.XLShape._picCellIdx.rowIndex,colIndex:r.XLShape._picCellIdx.colIndex};a.isChartSeries||(o.model.series.length=0,a.isRowColSwitched=!a.isRowColSwitched,n={xRange:a.xRange,yRange:a.yRange,lRange:a.lRange,isRowColSwitched:a.isRowColSwitched,dataSheetIdx:a.dataSheetIdx},l=r.XLChart._processChartSeries(n),o.option({series:l.series}),r.getActiveSheetIndex()===a.dataSheetIdx&&r.XLChart._focusChartRange(l.xRange,l.yRange,l.lRange),a.xAxis.range=l.xRange,a.yAxis.range=l.yRange,a.legend.range=l.lRange,r._completeAction(d),r._trigActionComplete(d))}},updateChartElement:function(i,r,l){var n,s,o=this.XLObj;if(!o.model.isReadOnly&&(s={sheetIndex:n=o.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",type:"actionBegin",action:"updatechartelem",chartId:i,value:r,title:l,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex},!o._trigActionBegin(s))){i=s.chartId,r=s.value,o._showDialog(o._id+"_chartname");var a,d,h,c=i||document.getElementById(o._id+"_chart").value,u=e("#"+c).ejChart("instance"),g={sheetIndex:n,reqType:"shape",shapeType:"chart",cid:c,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex},p=o.getSheet(n).shapeMngr.chart[o.XLEdit.getPropertyValue(o.XLShape._picCellIdx.rowIndex,o.XLShape._picCellIdx.colIndex,"chart")[0]];switch(l?s={model:{text:o._getLocStr("Ok")}}:l="",o.model.allowFormulaBar&&(a=o.element.find(".e-formulabar")[0]),a&&(a.style.display="none"),r){case"PHAxis":g.visibility=!u.model.primaryXAxis.visible,u.option("primaryXAxis",{visible:g.visibility}),p.xAxis.visible=g.visibility,g.action=g.operation=r;break;case"PVAxis":g.visibility=!u.model.primaryYAxis.visible,u.option("primaryYAxis",{visible:g.visibility}),p.yAxis.visible=g.visibility,g.action=g.operation=r;break;case"PHAxisTitle":o._cOpt.prev={text:p.xAxis.title.text},0!=u.model.primaryXAxis.title.text.length?(u.option("primaryXAxis",{title:{text:""}}),p.xAxis.title.text="",g={sheetIndex:n,reqType:"shape",shapeType:"chart",operation:"PHAxisTitle",action:"PX",cid:c,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex,prev:{text:o._cOpt.prev.text},cur:{text:""}},o._completeAction(g),o._trigActionComplete(g)):(o._hasTitle="PX",document.getElementById(o._id+"_chartname").value=p.xAxis.title.text,l.length<1?(e("#"+o._id+"_chartnamedlg").ejDialog("open"),e("#"+o._id+"_chartname").focus().setInputPos(p.xAxis.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(s,l,"PHAxisTitle"),o._cOpt={prevText:p.title.text,prevAlign:u.model.title.textAlignment,curAlign:u.model.title.textAlignment});break;case"PVAxisTitle":o._cOpt.prev={text:p.yAxis.title.text},0!=u.model.primaryYAxis.title.text.length?(u.option("primaryYAxis",{title:{text:""}}),p.yAxis.title.text="",g={sheetIndex:n,reqType:"shape",shapeType:"chart",operation:"PVAxisTitle",action:"PY",cid:c,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex,prev:{text:o._cOpt.prev.text},cur:{text:""}},o._completeAction(g),o._trigActionComplete(g)):(o._hasTitle="PY",document.getElementById(o._id+"_chartname").value=p.yAxis.title.text,l.length<1?(e("#"+o._id+"_chartnamedlg").ejDialog("open"),e("#"+o._id+"_chartname").focus().setInputPos(p.yAxis.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(s,l,"PVAxisTitle"),o._cOpt={prevText:p.title.text,prevAlign:u.model.title.textAlignment,curAlign:u.model.title.textAlignment});break;case"CTNone":case"CTnone":o._cOpt.prev={text:p.title.text},u.model.title.text.length&&(u.option("title",{text:""}),p.title.text="",g={sheetIndex:n,reqType:"shape",shapeType:"chart",action:"CT",operation:"CTNone",cid:c,rowIndex:o.XLShape._picCellIdx.rowIndex,colIndex:o.XLShape._picCellIdx.colIndex,prev:{text:o._cOpt.prev.text},cur:{text:""}},o._completeAction(g),o._trigActionComplete(g));break;case"CTCenter":case"CTcenter":o._hasTitle="CT",o._cOpt={prevText:u.model.title.text,prevAlign:u.model.title.textAlignment},document.getElementById(o._id+"_chartname").value=p.title.text,l.length<1?(e("#"+o._id+"_chartnamedlg").ejDialog("open"),e("#"+o._id+"_chartname").focus().setInputPos(p.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(s,l,"CTCenter"),u.option("title",{textAlignment:"center"}),o._cOpt.curAlign=u.model.title.textAlignment,p.title.align="center";break;case"CTFar":case"CTfar":o._hasTitle="CT",o._cOpt={prevText:u.model.title.text,prevAlign:u.model.title.textAlignment},document.getElementById(o._id+"_chartname").value=p.title.text,l.length<1?(e("#"+o._id+"_chartnamedlg").ejDialog("open"),e("#"+o._id+"_chartname").focus().setInputPos(p.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(s,l,"CTFar"),u.option("title",{textAlignment:"far"}),o._cOpt.curAlign=u.model.title.textAlignment,p.title.align="far";break;case"CTNear":case"CTnear":o._hasTitle="CT",o._cOpt={prevText:u.model.title.text,prevAlign:u.model.title.textAlignment},document.getElementById(o._id+"_chartname").value=p.title.text,l.length<1?(e("#"+o._id+"_chartnamedlg").ejDialog("open"),e("#"+o._id+"_chartname").focus().setInputPos(p.title.text.length)):o.XLRibbon._chartNameDlgBtnClick(s,l,"CTNear"),u.option("title",{textAlignment:"near"}),o._cOpt.curAlign=u.model.title.textAlignment,p.title.align="near";break;case"DLNone":for(d=[],g.action="DL",g.operation="DLNone",g.prev={series:e.extend(!0,[],u.model.series)},h=0;h<u.model.series.length;h++)d.push({marker:{dataLabel:{visible:!1,verticalTextAlignment:"far",textPosition:"top"}}});u.option({series:d}),g.cur={series:e.extend(!0,[],u.model.series)},p.dataLabel={visible:!1},p.series=u.model.series;break;case"DLCenter":for(d=[],g.action="DL",g.operation="DLCenter",g.prev={series:e.extend(!0,[],u.model.series)},h=0;h<u.model.series.length;h++)d.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"center",textPosition:"middle",offset:{y:0}}}});u.option({series:d}),g.cur={series:e.extend(!0,[],u.model.series)},p.dataLabel={visible:!0,vAlign:"center",tPosn:"middle"},p.series=u.model.series;break;case"DLIBase":for(d=[],g.action="DL",g.operation="DLIBase",g.prev={series:e.extend(!0,[],u.model.series)},h=0;h<u.model.series.length;h++)d.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"far",textPosition:"bottom",offset:{y:0}}}});u.option({series:d}),g.cur={series:e.extend(!0,[],u.model.series)},p.dataLabel={visible:!0,vAlign:"far",tPosn:"bottom"},p.series=u.model.series;break;case"DLIEnd":for(d=[],g.action="DL",g.operation="DLIEnd",g.prev={series:e.extend(!0,[],u.model.series)},h=0;h<u.model.series.length;h++)d.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"near",textPosition:"top",offset:{y:-10}}}});u.option({series:d}),g.cur={series:e.extend(!0,[],u.model.series)},p.dataLabel={visible:!0,vAlign:"near",tPosn:"top"},p.series=u.model.series;break;case"DLOEnd":for(d=[],g.action="DL",g.operation="DLOEnd",g.prev={series:e.extend(!0,[],u.model.series)},h=0;h<u.model.series.length;h++)d.push({marker:{dataLabel:{visible:!0,verticalTextAlignment:"near",textPosition:"top",offset:{y:0}}}});u.option({series:d}),g.cur={series:e.extend(!0,[],u.model.series)},p.dataLabel={visible:!0,vAlign:"near",tPosn:"top"},p.series=u.model.series;break;case"PMajorH":g.visibility=!u.model.primaryYAxis.majorGridLines.visible,u.option("primaryYAxis",{majorGridLines:{visible:g.visibility}}),p.yAxis.majorGridLines={visible:g.visibility},g.action=g.operation=r;break;case"PMajorV":g.visibility=!u.model.primaryXAxis.majorGridLines.visible,u.option("primaryXAxis",{majorGridLines:{visible:g.visibility}}),p.xAxis.majorGridLines={visible:g.visibility},g.action=g.operation=r;break;case"PMinorH":g.visibility=!u.model.primaryYAxis.minorGridLines.visible,u.option("primaryYAxis",{minorGridLines:{visible:g.visibility},minorTicksPerInterval:5,minorTickLines:{visible:g.visibility}}),p.yAxis.minorGridLines={visible:g.visibility},g.action=g.operation=r;break;case"PMinorV":g.visibility=!u.model.primaryXAxis.minorGridLines.visible,u.option("primaryXAxis",{minorGridLines:{visible:g.visibility},minorTicksPerInterval:5,minorTickLines:{visible:g.visibility}}),p.xAxis.minorGridLines={visible:g.visibility},g.action=g.operation=r;break;case"LNone":g.visibility=!1,u.option("legend",{visible:g.visibility}),p.legend.visible=g.visibility,g.action=r,g.operation="LNone";break;case"LLeft":g.prev={position:u.model.legend.position},u.option("legend",{position:"left",visible:!0}),p.legend.position="left",g.cur={position:u.model.legend.position},g.action="Legend",g.operation="LLeft";break;case"LRight":g.prev={position:u.model.legend.position},u.option("legend",{position:"right",visible:!0}),p.legend.position="right",g.cur={position:u.model.legend.position},g.action="Legend",g.operation="LRight";break;case"LBottom":g.prev={position:u.model.legend.position},u.option("legend",{position:"bottom",visible:!0}),p.legend.position="bottom",g.cur={position:u.model.legend.position},g.action="Legend",g.operation="LBottom";break;case"LTop":g.prev={position:u.model.legend.position},u.option("legend",{position:"top"}),p.legend.position="top",g.cur={position:u.model.legend.position},g.action="Legend",g.operation="LTop"}a&&(a.style.display="block"),t.isNullOrUndefined(g.action)||(o._completeAction(g),o._trigActionComplete(g))}},changeTheme:function(t,i){var r,l=this.XLObj;t=t||l.element.find("#"+l._id+"_chart").val(),(r={sheetIndex:l.getActiveSheetIndex(),reqType:"shape",action:"chartTheme",chartId:t}).prev={theme:e("#"+t).data("ejChart").model.theme},i&&i.indexOf("dark")>-1?e("#"+t).addClass("e-ss-charttheme"):e("#"+t).removeClass("e-ss-charttheme"),l.XLChart.refreshChart(t,{theme:i}),r.cur={theme:i},l._completeAction(r),l._trigActionComplete(r)},changeType:function(t,i){var r=this.XLObj,l=e("#"+t).data("ejChart"),n={sheetIndex:r.getActiveSheetIndex(),reqType:"shape",shapeType:"chart",action:"chartType",chartId:t};n.prev={chartType:l.model.series[0].type,enable3D:l.model.enable3D,marker:l.model.series[0].marker.visible},r.XLChart.refreshChart(t,i),n.cur={chartType:l.model.series[0].type,enable3D:l.model.enable3D,marker:l.model.series[0].marker.visible},e("#"+r._id+"_charttypedlg").ejDialog("close"),r._completeAction(n),r._trigActionComplete(n)},_getShapeObj:function(e,t){var i=this.XLObj,r=i.getSheet(i.getActiveSheetIndex()).shapeMngr[t];if(i.getObjectLength(r))return r[e]},_validateChartRange:function(e,t,i,r){var l=this.XLObj;if(!i)return{msg:l._getLocStr("YAxisMissing")};if(!l.inRange(e,i[0],i[1])&&!l.inRange(e,i[2],i[3]))return{msg:l._getLocStr("InvalidYAxis")};if(t){if(!l.inRange(e,t[0],t[1])&&!l.inRange(e,e[2],e[3]))return{msg:l._getLocStr("InvalidXAxis")};if(t[3]-t[1]!=0)return{msg:l._getLocStr("InvalidXAxisColumns")}}return!r||l.inRange(e,r[0],r[1])||l.inRange(e,r[2],r[3])?{status:!0}:{msg:l._getLocStr("InvalidLegend")}},_renderChartRangeDialog:function(){var t=this.XLObj,i={width:"25%",showRoundedCorner:!0,click:e.proxy(this._chartRangeDlgBtnClick,this)},r=e("<div id='"+t._id+"_chartrangedlg'><div class='e-dlgctndiv e-dlg-fields'><table cellpadding='0' cellspacing='0'><tr class='e-dlgtd-fields'><td>"+t._getLocStr("XAxisRange")+"</td><td><input type='text' class='ejinputtext' id='"+t._id+"_crxaxis'/></td></tr><tr class='e-dlgtd-fields'><td>"+t._getLocStr("YAxisRange")+"</td><td><input type='text' class='ejinputtext' id='"+t._id+"_cryaxis' /></td></tr><tr class='e-dlgtd-fields'><td>"+t._getLocStr("LegendRange")+"</td><td><input type='text' class='ejinputtext' id='"+t._id+"_crlaxis'/></td></tr></table></div><div class='e-dlg-btnfields' ><div class='e-dlg-btnctnr'><button id='"+t._id+"_crok' >"+t._getLocStr("Ok")+"</button><button id='"+t._id+"_crcancel'>"+t._getLocStr("Cancel")+"</button></div></div></div>");t.element.append(r),r.ejDialog({width:310,height:"auto",enableResize:!1,showOnInit:!1,enableModal:!0,cssClass:"e-ss-dialog e-"+t._id+"-dlg e-ss-chartrange",title:t._getLocStr("ChartRange")}),e("#"+t._id+"_crok").ejButton(i),e("#"+t._id+"_crok").ejButton("option","cssClass","e-ss-okbtn"),e("#"+t._id+"_crcancel").ejButton(i)},_chartRangeDlgBtnClick:function(t){var i,r,l,n,s=this.XLObj;t.model.text===s._getLocStr("Ok")&&(i=document.getElementById(s._id+"_chart").value,r=e("#"+s._id+"_crxaxis").val(),l=e("#"+s._id+"_cryaxis").val(),n=e("#"+s._id+"_crlaxis").val(),this.changeDataRange(i,r,l,n)),e("#"+s._id+"_chartrangedlg").ejDialog("close")},changeDataRange:function(t,i,r,l){var n,s,o,a,d,h,c,u=this.XLObj,g=u._getSheetIndex(u.getActiveSheetIndex()),p=u.getSheet(g),m=this._getShapeObj(t,"chart");i.length&&(s=u.getRangeIndices(i)),r.length&&(o=u.getRangeIndices(r)),l.length&&(a=u.getRangeIndices(l)),h={xRange:i,yRange:r,lRange:l},(n=this._validateChartRange(m.range,s,o,a)).status?(m.xRange=s,m.yRange=o,m.lRange=a,this._refreshChart(m),c=e("#"+t).ejChart("model"),m.xAxis={min:c.primaryXAxis.range.min,max:c.primaryXAxis.range.max,interval:c.primaryXAxis.range.interval,title:{text:c.primaryXAxis.title.text.length?c.primaryXAxis.title.text:""},range:s},m.yAxis={min:c.primaryYAxis.range.min,max:c.primaryYAxis.range.max,interval:c.primaryYAxis.range.interval,title:{text:c.primaryYAxis.title.text.length?c.primaryYAxis.title.text:""},range:o},m.legend={visible:c.legend.visible,range:a},u.getActiveSheetIndex()===m.dataSheetIdx&&this._focusChartRange(s,o,a)):(!1,u._showAlertDlg("Alert","T-"+n.msg,"",400)),p._isImported&&!p._isLoaded||u._isUndoRedo||u._isExport||(d={sheetIndex:g,reqType:"shape",shapeType:"chart",action:"selectData",id:t,prev:u._selectDataval,cur:h},u._completeAction(d),u._trigActionComplete(d))},_afterChartRefresh:function(){var e,t=this.XLObj;t.model.allowFormulaBar&&((e=t.element.find(".e-formulabar")[0]).style.display="none",e.style.display="")}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.print=function(e){this.XLObj=e,this._printHeight=950,this._pageHeight=970,this._pageWidth=750,this._marginTop=30,this._marginBottom=150,this._printRowLabels=!1,this._isPrintSelection=!1,this._stRow=0,this._stColumn=0,this.shpIndex=[],this.shpObj=[],this.shpPicObj=[]},t.spreadsheetFeatures.print.prototype={_printSetting:function(e){switch(this.XLObj.model.pageSize=e,e){case t.Spreadsheet.pageSize.A4:this._printHeight=950,this._pageHeight=970,this._pageWidth=750,this._marginTop=30,this._marginBottom=150;break;case t.Spreadsheet.pageSize.A3:this._printHeight=1350,this._pageHeight=1330,this._pageWidth=860,this._marginTop=30,this._marginBottom=150;break;case t.Spreadsheet.pageSize.Letter:this._printHeight=1040,this._pageHeight=920,this._pageWidth=860,this._marginTop=30,this._marginBottom=60}},printSelection:function(){var i,r,l,n,s,o=this.XLObj;if(o.model.printSettings.allowPrinting&&!o.model.isReadOnly)if(o.model.printSettings.allowPageSize){var a,d,h,c=o.getActiveSheetIndex(),u=o.getSheet(c)._selectedCells,g=u[0],p=u[u.length-1],m=p.colIndex-g.colIndex,_=t.buildTag("table.e-table"),f=t.buildTag("colgroup"),b=o._getContent(c).find("col"),C=t.buildTag("div#printDiv.e-spreadsheet e-js",null,{border:"none"});for(o._refreshTemplates(c,!0,g.colIndex,g.colIndex+m+1),o._isPrint=!0,a=g.colIndex;a<p.colIndex;a++)e(b[a].outerHTML).attr("id","cc").appendTo(f);h=o.getRangeData({range:[g.rowIndex,g.colIndex,p.rowIndex,p.colIndex],property:["value","value2","format","border","type","isFilterHide","isRHide","isFHide","isMHide","merge","hRow","wrap","overflow","align","hyperlink","cFormatRule","rule"],sheetIdx:c,withRowIdx:!0}),_.html(o._renderData(h,c,g.colIndex,m+1,!0)),f.insertBefore(_.find("tbody")),this._stRow=g.rowIndex,this._stCol=g.colIndex,this._isPrintSelection=!0,o._isPrint=!1,this._printRowLabels?this._calculateTabCount():this._constructSheet(C,c,_,_[0].rows),o._refreshTemplates(c,!0)}else if(g=(u=o.getSheet(c)._selectedCells)[0],p=u[u.length-1],n=[],s=o.element.find(".e-ss-activeimg").clone(),u.length)this._flatPrint([g.rowIndex,g.colIndex,p.rowIndex,p.colIndex]);else if(s.length){for(i=0,d=(r=e("head").find("link").add("style")).length;i<d;i++)l=r[i].href||"",("STYLE"===r[i].tagName&&(r[i].id.indexOf(o._id+"_sshide")>-1||r[i].id.indexOf(o._id+"_sscustomformat")>-1)||l.indexOf("ej.pivotintegration.css")>-1||l.indexOf("ej.widgets.core")>-1||l.indexOf("ej.web.all")>-1||l.indexOf("ej.theme")>-1)&&n.push(r[i]);this.print(t.buildTag("div#printDiv.e-spreadsheet e-js",s.css({top:0,left:0}),{border:"none"}),n)}},printSheet:function(){var i=this.XLObj;if(i.model.printSettings.allowPrinting&&!i.model.isReadOnly)if(i.model.printSettings.allowPageSize){var r,l,n,s=t.buildTag("div#printDiv"),o=i.getActiveSheetIndex(),a=i.getSheet(o),d=a.columnsWidthCollection,h=i._getContent(o).find("col"),c=t.buildTag("table"),u=t.buildTag("colgroup");for(i._refreshTemplates(o,!0,0,a.usedRange.colIndex+1),i._isPrint=!0,r=0,l=d.length;r<l;r++)e(h[r].outerHTML).attr("id","cc").appendTo(u);n=i.getRangeData({range:[0,0,a.usedRange.rowIndex,a.usedRange.colIndex],property:["value","value2","format","border","type","isFilterHide","isRHide","isFHide","isMHide","merge","hRow","wrap","overflow","align","hyperlink","cFormatRule","rule"],sheetIdx:o,withRowIdx:!0}),c.html(i._renderData(n,o,0,a.usedRange.colIndex+1,!0)),u.insertBefore(c.find("tbody")),this._printRowLabels?this._calculateTabCount():this._constructSheet(s,o,c,c[0].rows),i._isPrint=!1,i._refreshTemplates(o,!0)}else this._flatPrint()},_flatPrint:function(i){var r,l,n,s,o,a,d,h,c,u,g=this.XLObj,p=0,m=0,_=t.buildTag("div#printDiv.e-spreadsheet e-js",null,{border:"none"}),f=g.getActiveSheetIndex(),b=g.getSheet(f),C=b.columnsWidthCollection,S=b.usedRange.colIndex,x=g._getContent(f).find("col"),v=t.buildTag("table.e-table"),w=t.buildTag("colgroup"),I=e("head").find("link").add("style"),y=[],T=g.element.find(".e-ss-object, .e-ss-pivot").clone(),L="",R=b.hideRowsCollection;for(g._refreshTemplates(f,!0,0,b.usedRange.colIndex+1),g._isPrint=!0,i&&(p=i[1],S=i[3]),n=p;n<=S;n++)e(x[n].outerHTML).attr("id","cc").appendTo(w),m+=C[n],0===C[n]&&(L+="td.e-rowcell:nth-of-type("+(n+1)+"){display: none}");for(_.width(m),c=g.getRangeData({range:i||[0,0,b.usedRange.rowIndex,b.usedRange.colIndex],property:["value","value2","format","border","type","isFilterHide","isRHide","isFHide","isMHide","merge","hRow","wrap","overflow","align","hyperlink","cFormatRule","rule","isOverflow","isOfBrdr"],sheetIdx:f,withRowIdx:!0}),v.append(w,g._renderData(c,f,i?i[1]:0,(i?i[3]-i[1]:b.usedRange.colIndex)+1,!0)),v.width(m),i&&v.find('td[class=""]').remove(),n=0;n<R.length;n++)(!i||g.inRange(i,n,i[1]))&&v.find("tr:eq("+R[n]+")").addClass("e-r-hide");if(i)for(_.css({overflow:"hidden"}),o=b._colWidthCollection[i[1]],h=b._rowHeightCollection[i[0]],n=0;n<T.length;n++)a=parseInt(T[n].style.top),d=parseInt(T[n].style.left),e(T[n]).css({top:a-h,left:d-o});for((s=t.buildTag("div.e-content e-ss-cursor",v)).append(T),s=t.buildTag("div.e-spreadsheetcontentcontainer",s),s=t.buildTag("div.e-spreadsheetmainpanel",s,{width:m,float:"none"}),L+=".e-spreadsheet .e-spreadsheetmainpanel .e-content .e-table tr td:first-child{ border-left-width: 1px; }.e-spreadsheet .e-spreadsheetmainpanel .e-content .e-table tr:first-child td{border-top-width: 1px;}table{page-break-inside: auto !important;}table tr{page-break-inside: avoid !important;}html,body{margin: 0; padding: 0; }",_.append(s,t.buildTag("style",L,{},{type:"text/css"})),l=0,r=I.length;l<r;l++)u=I[l].href||"",("STYLE"===I[l].tagName&&(I[l].id.indexOf(g._id+"_sshide")>-1||I[l].id.indexOf(g._id+"_sscustomformat")>-1)||u.indexOf("ej.pivotintegration.css")>-1||u.indexOf("ej.widgets.core")>-1||u.indexOf("ej.web.all")>-1||u.indexOf("ej.theme")>-1)&&y.push(I[l]);this.print(_,y),g._isPrint=!1,g._refreshTemplates(f,!0)},_calculateTabCount:function(){for(var e=this.XLObj,t=[],i=0,r=e.getSheet(e.getActiveSheetIndex()).columnsWidthCollection,l=0,n=r.length;l<n;l++)(i+=r[l])>=this._pageWidth&&(t.push({tCount:1,cellCount:l}),i=0)},_calculateCellRowCount:function(e,t,i){for(var r,l,n=this.XLObj,s=n.getActiveSheetIndex(),o=n.getSheet(s),a=o.columnsWidthCollection,d=o.rowsHeightCollection,h=0,c=0,u=12,g=40,p=0,m=0,_=t,f=a.length;_<f;_++){if((h+=a[_])>=this._pageWidth){m=u=_;break}r=Math.floor((this._pageWidth-h)/o.columnWidth),m=u=a.length+r}for(l=i,f=d.length;l<f;l++){if((c+=d[l])>=this._pageHeight){p=g=l;break}r=Math.floor((this._pageHeight-c)/n.model.rowHeight),p=g=d.length+r}return{startCell:t,endCell:m,startRow:i,endRow:p,cellCount:u,rowCount:g}},_constructSheet:function(e,i,r,l){var n=t.buildTag("div .e-spreadsheet","",{}),s=t.buildTag("div .e-spreadsheetmainpanel","",{}),o=0,a=this._calculateCellRowCount(l,0,0),d=l[0].cells.length,h=l.length;o=Math.ceil(d/a.cellCount),1==(o*=Math.ceil(h/a.rowCount))&&(a.rowCount=l.length),n.append(s),this._constructPrintableElement(i,e,n.find(".e-spreadsheetmainpanel"),r,l,h,d,o,a.cellCount,a.rowCount,a.startRow,a.startCell,a.endRow,a.endCell)},_constructPrintableElement:function(i,r,l,n,s,o,a,d,h,c,u,g,p,m){for(var _,f,b,C,S,x,v,w,I,y,T,L,R,O,F,E=!1,D=this.XLObj,N=D.getSheet(i),A=t.buildTag("div"),P=!1,k=!0,j=!1,M=!1,V=0,B=N.rowsHeightCollection,H=d;H>0;H--){for(g=(x=this._calculateCellRowCount(s,g,u)).startCell,m=x.endCell,u=x.startRow,p=x.endRow,h=x.cellCount,c=x.rowCount,S=this._constructTable(i,g,m),N.showHeadings&&this._constructHeaders(g,m,p,S),I=u;I<p;I++){for(t.isNullOrUndefined(n[0].rows[I])?(k=!1,b=t.buildTag("tr","",{height:D.model.rowHeight})):(k=!0,b=(v=B[I])>0?t.buildTag("tr","",{height:v}):t.buildTag("tr","",{height:D.model.rowHeight})),k&&(j=D.XLEdit.getPropertyValue(I,0,"isRHide"),t.isNullOrUndefined(j)||D.addClass(b[0],"e-r-hide")),y=g;y<m;y++)N.showHeadings&&!E&&(C='<td class="{0}">{1}</td>',e(String.format(C,"e-rowcell e-header",I+1)).appendTo(b),E=!0),e(s[I]).length>0&&e(s[I].cells[y]).length>0?(T=e(s[I].cells[y].outerHTML).attr("id","ss")).appendTo(b):(T=t.buildTag("td.e-rowcell")).appendTo(b),M=D.XLEdit.getPropertyValue(0,y,"isCHide"),t.isNullOrUndefined(M)||D.addClass(T[0],"e-col-hide");E=!1,S.append(b)}if(r.append(S),p<o)u=p,p+=c;else if(p>=o){if(m>=a)break;u=0,p=c,g=m,m+=h}}for(I=r.find("table").length-1;I>=0;--I)w=e(r.find("table")[I]),P||this._checkEmptyRow(i,w,"first"),V=N.showHeadings?w.find("tr.empty").length+1:w.find("tr.empty").length,(w.find("tr").length!==V||P)&&(e(w.get(0).outerHTML).attr("id","cc").appendTo(A),P=!0);for(I=(R=A.find("table")).length-1;I>=0;--I)R.length-1!==I?(D.model.pageSize===t.Spreadsheet.pageSize.A4&&R.eq(I).css({"margin-top":300,"margin-bottom":300}),D.model.pageSize===t.Spreadsheet.pageSize.A3&&R.eq(I).css({"margin-top":120,"margin-bottom":110}),D.model.pageSize===t.Spreadsheet.pageSize.Letter&&(N.showHeadings?R.eq(I).css({"margin-top":70,"margin-bottom":50}):R.eq(I).css({"margin-top":0,"margin-bottom":50}))):R.length-1===I&&R.eq(I).css({"margin-top":30,"margin-bottom":N.showHeadings?20:0}),I||(R.length>1&&R.eq(I).css({"margin-top":120,"margin-bottom":0}),this._checkEmptyRow(i,R.eq(I),"last")),e(R[I].outerHTML).attr("id","cc").appendTo(l);for(f=[],I=0,L=(_=e("head").find("link")).length;I<L;I++)if(F=_[I].href||"",_[I].href.indexOf("ej.pivotintegration.css")>-1||F.indexOf("ej.theme")>-1){f.push(_[I]);break}O=this._constructChartPicElement(l),l.append(O),l=l.parent(),D._trigger("_pivotPrint",{element:l}),this.print(l,f,i)},_hideShapeElement:function(e){if(this._isPrintSelection){var t,i,r,l=this.XLObj,n=l.getActiveSheetIndex(),s=l.getSheet(n)._selectedCells,o=l.getSheet(n).shapeMngr,a=l.getObjectLength(o.chart),d=l.getObjectLength(o.picture);if(e.find(".e-ss-object").hide(),a>=1)for(i=0;i<a;i++)for(t=0,r=s.length;t<r;t++)o.chart[l.getObjectKeys(o.chart)[i]].rowIndex==s[t].rowIndex&&o.chart[l.getObjectKeys(o.chart)[i]].colIndex==s[t].colIndex&&e.find("#"+o.chart[l.getObjectKeys(o.chart)[i]].id).show();if(d>=1)for(i=0;i<d;i++)for(t=0,r=s.length;t<r;t++)o.picture[l.getObjectKeys(o.picture)[i]].rowIndex==s[t].rowIndex&&o.picture[l.getObjectKeys(o.picture)[i]].colIndex==s[t].colIndex&&e.find("#"+o.picture[l.getObjectKeys(o.picture)[i]].id).show()}},_constructChartPicElement:function(t){var i,r,l,n,s,o,a,d,h,c,u,g,p=this.XLObj,m=p.getActiveSheetIndex(),_=p.element.find(".e-ss-object").clone(),f=p.getSheet(m).shapeMngr,b=p.getObjectLength(f.chart),C=p.getObjectLength(f.picture),S=t.find("table"),x=S.length;for(this.shpIndex=[],this.shpObj=[],this.shpPicObj=[],g=0;g<x;g++)n=S[g],u=e(n).find("tr"),s=parseInt(u.eq(1).find("td").eq(0).text())-1,o=p.XLEdit.getColumnIndexByField(u.eq(0).find("td").eq(1).children().text().trim()),a=s+(u.length-1),d=o+u.eq(0).children().length-1,this.shpIndex.push({pageNumber:g,startColIdx:o,startRowIdx:s,endRowIdx:a,endColIdx:d,top:n.style.marginTop,bottom:n.style.marginBottom,height:n.style.height});if(b>=1)for(r=0;r<b;r++){for(h=f.chart[_[r].id].rowIndex,c=f.chart[_[r].id].colIndex,i=0,l=this.shpIndex.length;i<l;i++)h>=this.shpIndex[i].startRowIdx&&h<this.shpIndex[i].endRowIdx&&c>=this.shpIndex[i].startColIdx&&c<this.shpIndex[i].endColIdx&&(this.shpObj.push({ID:_[r].id,rowIndex:h,colIndex:c,tableNumber:i}),this.shpObj[r].colIndex=this.shpObj[r].colIndex-this.shpIndex[i].startColIdx,this.shpObj[r].rowIndex=this.shpObj[r].rowIndex-this.shpIndex[i].startRowIdx);e(_[r]).addClass(".e-spreadsheet .e-ss-object .e-datavisualization-chart .e-js"),e(_[r]).css({border:"1px solid gray",position:"absolute"})}if(C>=1)for(r=0;r<C;r++){for(h=f.picture[_[b+r].id].rowIndex,c=f.picture[_[b+r].id].colIndex,i=0,l=this.shpIndex.length;i<l;i++)h>=this.shpIndex[i].startRowIdx&&h<this.shpIndex[i].endRowIdx&&c>=this.shpIndex[i].startColIdx&&c<this.shpIndex[i].endColIdx&&(this.shpPicObj.push({ID:_[b+r].id,rowIndex:h,colIndex:c,tableNumber:i}),this.shpPicObj[r].colIndex=this.shpPicObj[r].colIndex-this.shpIndex[i].startColIdx,this.shpPicObj[r].rowIndex=this.shpPicObj[r].rowIndex-this.shpIndex[i].startRowIdx);e(_[b+r]).addClass(".e-spreadsheet .e-ss-object"),e(_[b+r]).css({position:"absolute","background-size":"100% 100%"})}return _},_calculateTopForShapes:function(e){for(var t,i,r,l,n,s,o,a,d=this.XLObj,h=d.getActiveSheetIndex(),c=d.getSheet(h),u=this.shpObj.concat(this.shpPicObj),g=u.length,p=0;p<g;p++)if(0==u[p].tableNumber)o=c._colWidthCollection[u[p].colIndex],a=c._rowHeightCollection[u[p].rowIndex],e.find("#"+u[p].ID).css({top:a+60,left:o+20+8});else{for(i=0,t=0;t<u[p].tableNumber;t++)l=(r=e.find(".e-table")[t]).getBoundingClientRect(),n=parseInt(r.style.marginBottom),s=parseInt(r.style.marginTop),i+=l.height+n+s;o=c._colWidthCollection[u[p].colIndex],a=c._rowHeightCollection[u[p].rowIndex],e.find("#"+u[p].ID).css({top:a+i+30+parseInt(this.shpIndex[u[p].tableNumber].top),left:o+20+18})}},_checkEmptyRow:function(t,i,r){for(var l,n,s,o,a,d=i.find("tr"),h=d.length-1;h>=0;--h){if(l=e(d[h]).find(".e-rowcell").length,n=e(d[h]).find(".e-rowcell:empty").length,n=this.XLObj.getSheet(t).showHeadings?n+1:n,s=e(d[h]).find('td[class *= "e-format"]').length,o=e(d[h]).find('td[class *= "e-border"]').length,a=e(d[h]).find('td[class *= "e-mc-hide"]').length,!(n===l&&s<1&&o<1&&a<1)){e(d[h]).addClass("nonempty");break}e(d[h]).addClass("empty")}"last"===r&&(i.find("tr.empty").find("td").removeClass("e-rowcell"),i.find("tr.empty").find("td.e-header").text(""))},_constructTable:function(i,r,l){var n,s=t.buildTag("colgroup"),o=this.XLObj,a=t.buildTag("div","",{height:this._printHeight,"margin-top":this._marginTop,"margin-bottom":this._marginBottom}),d=t.buildTag("table.e-table","",{height:this._printHeight,"margin-top":this._marginTop,"margin-bottom":this._marginBottom}),h=o._getContent(o.getActiveSheetIndex()).find("col");for(o.getSheet(i).showHeadings&&e('<col class="{0}" style= "width: 30px;" >{1}</col>').appendTo(s),n=r;n<l;n++)e(h[n]).length>0?e(h[n].outerHTML).attr("id","cc").appendTo(s):e('<col style= "width: 64px;" ></col>').appendTo(s);return d.append(s),a.append(d),d},_constructHeaders:function(i,r,l,n){var s,o,a,d,h,c,u=this.XLObj,g=t.buildTag("tr","",{height:30}),p=!1,m="e-rowcell";for(this._isPrintSelection&&i<this._stCol&&(r+=this._stCol-i,i=this._stCol),s='<td class="{0}">{1}</td>',o='<div class = "{0}" > {1}</div>',c=i;c<=r;c++)p?(a=u._generateHeaderText(c),m=t.isNullOrUndefined(u.XLEdit.getPropertyValue(0,c-1,"isCHide"))?"e-rowcell e-headercell":"e-rowcell e-col-hide"):(a="",p=!0),d=String.format(o,"e-headercelldiv",a),h=String.format(s,m,d),e(g[0]).append(h);n.append(g)},print:function(i,r,l){var n,s,o,a,d,h=this.XLObj;if(h.model.printSettings.allowPrinting&&!h.model.isReadOnly){var c=window.open("","print","height="+screen.height+",width="+screen.width+",tabbar=no"),u={styleTag:""},g=t.buildTag("style");if(!h.isUndefined(c)){if(a=t.buildTag("div"),d=i.clone(),a.append(d),c.document.write("<!DOCTYPE html>"),"msie"===h._browserDetails.name?(o="",r.length>0&&e(r).each(function(t,i){e(i).attr("href",i.href),o+="STYLE"==i.tagName&&i.styleSheet?"<style>"+i.styleSheet.cssText+"</style>":i.outerHTML}),c.document.write("<html><head></head><body>"+o+a[0].innerHTML+"</body></html>")):(o="",c.document.write("<html><head>"),r.length>0&&e(r).each(function(t,i){e(i).attr("href",i.href),o+=i.outerHTML}),c.document.writeln(o+"</head><body>"),c.document.writeln(a[0].innerHTML+"</body></html>"),h.model.printSettings.allowPageSize&&(e(c.document.head).append("<style></style>"),n=(n=h.model.sheets[l].showGridlines?".e-spreadsheet .e-table{table-layout: fixed; width: 100%;}.e-spreadsheet .e-rowcell {border: 1px solid #000000;line-height: 14px;overflow: hidden;white-space: pre;vertical-align: bottom;}.e-spreadsheet .e-table{border-collapse: collapse}":".e-spreadsheet .e-table{table-layout: fixed; width: 100%;}.e-spreadsheet .e-rowcell {line-height: 14px;overflow: hidden;white-space: pre;vertical-align: bottom;}.e-spreadsheet .e-table{border-collapse: collapse}").concat(e(document).find("style#"+this.XLObj._id+"_sscustomformat").text()),s=e(c.document.head).find("style"),n=(n=n.concat(".e-spreadsheet .e-fr-hide { display: none !important;}.e-spreadsheet .e-fc-hide { display: none !important;}.e-spreadsheet .e-sswraptext {word-break: break-all; white-space: normal;}.e-spreadsheet .e-headercell{text-align:center;}.e-spreadsheet .e-ralign{text-align:right;}.e-spreadsheet .e-calign{text-align:center;}")).concat(".e-spreadsheet .e-hyperlinks { text-decoration: underline;}"),s.append(n))),h._trigger("beforePrint",u))return!1;u.styleTag&&("object"==typeof u.styleTag?c.document.head.appendChild(u.styleTag):(g[0].append(u.styleTag),c.document.head.appendChild(g[0]))),h.model.printSettings.allowPageSize&&e(c.document).find(".e-ss-object").clone().length&&(this._calculateTopForShapes(e(c.document).find(".e-spreadsheetmainpanel")),this._hideShapeElement(e(c.document).find(".e-spreadsheetmainpanel"))),this._isPrintSelection=!1,c.document.close(),c.focus(),setTimeout(function(){("msie"===h._browserDetails.name?!h.getObjectLength(c)||t.isNullOrUndefined(c.window)||t.isNullOrUndefined(c.location):t.isNullOrUndefined(c.window)||t.isNullOrUndefined(c.location))||c.print(),setTimeout(function(){c.close()},2e3)},2e3)}}}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.scroller=function(e){this.XLObj=e,this._isIntrnlScroll=!1,this._isScrollToCell=!1},t.spreadsheetFeatures.scroller.prototype={_getColWidths:function(e,t){var i,r,l,n=this.XLObj.getSheet(e),s=n.columnsWidthCollection,o=n._colWidthCollection,a=n._ofColWidthColl;for(t||(t=1),i=t,r=s.length;i<r;i++)o[i]=o[i-1]+s[i-1],l=0===s[i-1]?n.hideColsCollection[i-1]:s[i-1],a[i]=a[i-1]+l},_getRowHeights:function(e,t,i,r){var l,n,s=this.XLObj,o=s.getSheet(e),a=o.rowsHeightCollection,d=o._rowHeightCollection,h=o.hideRowsCollection;for(t||(t=1),l=t,n=a.length;l<n;l++)d[l]=d[l-1]+(h.indexOf(l-1)>-1?0:a[l-1]);!i&&s.model.scrollSettings.allowScrolling&&(s.model.scrollSettings.allowVirtualScrolling&&s._refreshVrtlBlocks(e),r||s._isTableBrdrEnd||this._refreshScroller(e,"refresh","vertical"))},_createScroller:function(i,r,l){var n=this.XLObj,s=!0,o=!0,a=n._getContent(i),d=t.buildTag("div#vscrollBar"),h=t.buildTag("div#hscrollBar"),c=n.getSheet(i),u=n.model.scrollSettings.isResponsive?r.width-2:r.width;c._contWidth=u,c._contHeight=r.height,n.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(c._contWidth>n._getEntireColWidth(i)&&(s=!1),c._contHeight>n._getEntireRowHeight(i)&&(o=!1),h[0].style.display=s?"block":"none",d[0].style.display=o?"block":"none"),a.append(d).append(h),n._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").width(u-(o?18:0)).height(r.height-(s?18:0)),d.ejScrollBar({orientation:"vertical",height:r.height-(s?18:0),minimum:0,viewportsize:r.height,infiniteScrolling:!0,scroll:e.proxy(this._scrollSpreadY,this)}),h.ejScrollBar({orientation:"horizontal",width:u-(o?17:0),minimum:0,infiniteScrolling:!0,viewportsize:r.width,scroll:e.proxy(this._scrollSpreadX,this)}),"initial"!=l&&this._refreshScroller(i,"initial","all")},_hScroller:function(e){return this.XLObj._getContent(this.XLObj._getSheetIndex(e)).find("#hscrollBar").data("ejScrollBar")},_vScroller:function(e){return this.XLObj._getContent(this.XLObj._getSheetIndex(e)).find("#vscrollBar").data("ejScrollBar")},_refreshScroller:function(e,i,r){var l,n=this.XLObj;e=n._getSheetIndex(e);var s,o,a,d,h,c,u=0,g=n.getSheet(e),p=this._hScroller(e),m=g.columnWidth,_=g.rowHeight,f=this._vScroller(e),b=n.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal,C=n._getContent(e),S=C.find(".e-content")[0];if(b&&p&&f&&C.find("table").length&&(this._refreshContHgt(e),r="horizontal"===r?"all":r),p&&("all"===r||"horizontal"===r)){if(s=S.offsetWidth,(o=n._getWidth(0,g.colCount-1,e)-g._frozenWidth)<s+2*m&&!b)for(h=Math.floor((s+5*m-o)/m),l=0;l<h;l++)this._createNewColumn(e,{rowIndex:-1,colIndex:-1},{rowIndex:-1,colIndex:-1},"insert"),o+=m;p._scrollData.handleSpace=s-2*p.model.buttonSize,u=n._isFrozen(n.getFrozenColumns())?n._getColOffsetLeft(g,n.getFrozenColumns())-g._contScrollLeft:0,p._scrollData.handle=Math.floor((s-u)/o*p._scrollData.handleSpace),p._scrollData.handle<15&&(p._scrollData.handle=15),p._scrollData.scrollable=p.model.maximum=o-(s-u),p._scrollData.onePx=p._scrollData.scrollable/(p._scrollData.handleSpace-p._scrollData.handle)||1,p["e-hhandle"].width(p._scrollData.handle),p.model.scrollLeft=p._scrollData.handleSpace-p._scrollData.handle}if(f&&("all"===r||"vertical"===r)){if(a=S.offsetHeight,d=n._getMaxHgt(e,!0,!0)-g._frozenHeight,!b&&d<a+2*_)for(c=Math.floor((a+5*_-d)/_),l=0;l<c;l++)this._createNewRow(e,-1,-1,"insert"),d+=_;f._scrollData.handleSpace=a-2*f.model.buttonSize,u=n._isFrozen(n.getFrozenRows())?n._getRowOffsetTop(g,n.getFrozenRows())-g._contScrollTop:0,f._scrollData.handle=Math.floor((a-u)/d*f._scrollData.handleSpace),f._scrollData.handle<15&&(f._scrollData.handle=15),f._scrollData.handle>f._scrollData.handleSpace&&n.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Normal&&(f._scrollData.handle=f._scrollData.handleSpace),f._scrollData.scrollable=f.model.maximum=d-(a-u),f._scrollData.onePx=f._scrollData.scrollable/(f._scrollData.handleSpace-f._scrollData.handle),f["e-vhandle"].height(f._scrollData.handle),f.model.scrollTop=f._scrollData.handleSpace-f._scrollData.handle}},_refreshContHgt:function(e){var t,i,r,l,n,s,o,a,d="px",h="none",c="block",u="width",g="height",p=this.XLObj,m=p.getSheet(e),_=p._getEntireColWidth(e),f=p._getEntireRowHeight(e),b=p._getContent(e),C=b.find(".e-content"),S=b.find("#hscrollBar")[0].style,x=b.find("#vscrollBar")[0].style;t=C[0].offsetHeight,i=C[0].offsetWidth,r=S.display===h&&m._contWidth<_,l=x.display===h&&m._contHeight<f,(r||S.display===c&&m._contWidth>_)&&(S.display=r?c:h,t=r?t-18:t+19,r=!0),(l||x.display===c&&m._contHeight>f)&&(x.display=l?c:h,i=l?i-19:i+19,l=!0),(r||l)&&(s=t-36+d,t+=d,n=b.find("#vscrollBar"),C[0].style[g]=t,p._getJSSheetRowHeaderContent(e)[0].style[g]=t,n[0].style[g]=t,n.find(".e-vscroll")[0].style[g]=t,n.find(".e-vhandlespace")[0].style[g]=s,a=b.find("#hscrollBar"),C[0].style[u]=i+d,x.display===c&&i++,o=i-36+d,i+=d,a[0].style[u]=i,a.find(".e-hscroll")[0].style[u]=i,a.find(".e-hhandlespace")[0].style[u]=o),_+=d,C.find("table")[0].style[u]=_,p._getJSSheetHeader(e).find("table")[0].style[u]=_},_changeTopSpread:function(e,t,i,r){var l=e.value()+i;t.step=i,(t.enableRTL?l<t.scrollable:l>t.scrollable)&&(l=t.scrollable),(t.enableRTL?l>0:l<0)&&(l=0),e.scroll(l,r)},_changeLeftSpread:function(e,t,i,r){var l=e.value()+i;t.step=i,(t.enableRTL?l<t.scrollable:l>t.scrollable)&&(l=t.scrollable),(t.enableRTL?l>0:l<0)&&(l=0),e.scroll(l,r)},_spreadMouseWheel:function(i){var r,l,n,s,o=this.XLObj,a=this._vScroller(o.getActiveSheetIndex()),d=this._hScroller(o.getActiveSheetIndex());if(o._filterClose(i.target),i.stopImmediatePropagation(),i.preventDefault(),!o.element.find(".e-excelfilter.e-dlgcontainer").is(":visible")&&!o._isSubMenuOpen()&&!o._isSheetRename&&(o.model.allowComments&&o.XLComment._isCommentEdit&&(r=o.getActiveCell(),t.isNullOrUndefined(r)||o.XLComment._updateCurCmntVal({rowIndex:r.rowIndex,colIndex:r.colIndex})),o.model.allowDataValidation&&e("#"+o._id+"ddl").ejDropDownList("hidePopup"),n=0,s=i,(i=i.originalEvent).wheelDelta?(l=i.wheelDeltaY,n=-i.wheelDelta/120,window.opera&&parseFloat(window.opera.version,10)<10&&(n=-n)):i.detail&&(n=i.detail/3,l=1==i.axis?0:1),n)){if(0!=l){if(t.isNullOrUndefined(a)||!a.element.is(":visible"))return;this._changeTopSpread(a,a._scrollData,n*a._scrollData.scrollOneStepBy,"wheel")&&(i.preventDefault?i.preventDefault():s.preventDefault())}else{if(t.isNullOrUndefined(d)||!d.element.is(":visible"))return;this._changeLeftSpread(d,d._scrollData,n*d._scrollData.scrollOneStepBy,"wheel")&&(i.preventDefault?i.preventDefault():s.preventDefault())}e.data(this,"timer",setTimeout(function(){o._trigger("scrollStop",{originalEvent:i,scrollData:a._scrollData,reqType:"vertical",position:a.model.value})},250))}},_scrollSpreadX:function(e){var t=this.XLObj;t.XLEdit._isEdit&&t.XLEdit.saveCell(),t._isScrolling=!0,t.getSheet()._isFreezed&&t._isFrozen(t.getFrozenColumns())?(t.XLFreeze._frozenScrollHandler(e),this._getFirstColumn(t.getActiveSheetIndex())):this._spreadHS(e),t._isScrolling=!1},_scrollDirection:function(e,t){var i=this.XLObj;(e=i._getContent(i.getActiveSheetIndex()).find("#"+e).ejScrollBar("instance")).value()<t?e._scrollData.step=1:e.value()>t&&(e._scrollData.step=-1),e.scroll(t)},_spreadHS:function(e){var i,r,l=this.XLObj,n=l.getActiveSheetIndex(),s=l.getSheet(n),o=this._hScroller(n),a=o.element.find(".e-hhandle")[0],d=l._getContent(n).find(".e-content"),h=(e.scrollLeft-s._scrollLeft)/s.columnWidth;if(e.reachedEnd=Math.ceil(parseFloat(a.offsetLeft))+Math.ceil(parseFloat(o.element.find(".e-hhandle").width()))>=l.element.find(".e-hhandlespace").width()-2,i=e.scrollLeft,l.model.enableContextMenu&&l.XLCMenu.hideCMenu(),l.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&e.scrollData.step>-1&&!l._scrollReverse)if(e.reachedEnd&&s._leftCol.idx+h<=s.colCount)e.scrollLeft=e.scrollLeft+o._scrollData.scrollOneStepBy,e.cancel=!0,this._scrollRight(n),this._isScrollToCell||(i=(o._scrollData.handleSpace-o._scrollData.handle)*o._scrollData.onePx),this._refreshScroller(n,"refresh","horizontal"),o.element.find(".e-hhandle")[0].style.left=o._scrollData.handleSpace-(o._scrollData.handle+1)+"px",o.value(i);else if(s._leftCol.idx+h>s.colCount&&e.scrollLeft>=s._scrollLeft&&e.scrollLeft>0&&s.colCount<l._maxColCnt){for(;e.scrollLeft>s._colWidthCollection[s._colWidthCollection.length-1];)this._scrollRight(n);this._refreshScroller(n,"refresh","horizontal")}r=this._ensureScrollPos(e),s._scrollLeft=l.isUndefined(r.resetTo)||l.model.scrollSettings.scrollMode==t.Spreadsheet.scrollMode.Normal?e.scrollLeft=i:e.scrollLeft=r.resetTo,l._scrollReverse=!1,d.scrollLeft(e.scrollLeft),e.scrollLeft=i,s._scrollLeft=d.scrollLeft(),o.value(e.scrollLeft),this._getFirstColumn(n),l._refreshViewVar(null,e.scrollLeft,n)},_scrollSpreadY:function(e){var i,r,l,n,s=0,o=this.XLObj,a=o.getActiveSheetIndex(),d=o.getSheet(a),h=o.getSheetElement(a).find("#vscrollBar");o._isScrolling=!0,o.XLEdit._isEdit&&o.XLEdit.saveCell(),d._isFreezed&&o._isFrozen(o.getFrozenRows())?(o.XLFreeze._frozenScrollHandler(e),this._isIntrnlScroll||this._getFirstRow(o.getActiveSheetIndex())):(l=o.getDigits(d._bottomRow.idx),this.XLObj.model.scrollSettings.allowVirtualScrolling?this._scrollHandler(e):this._spreadVS(e),this.XLObj.model.allowComments&&this.XLObj.XLComment._isCommentEdit&&(n=this.XLObj.getActiveCell(),t.isNullOrUndefined(n)||this.XLObj.XLComment._updateCurCmntVal({rowIndex:n.rowIndex,colIndex:n.colIndex})),(i=o.getDigits(d._bottomRow.idx))-l&&(i>3&&(s=10*(i-3)),r=o._rowHeaderWidth+s,o._getJSSheetRowHeaderContent(a).find("col").width(r),o._getJSSheetRowHeader(a).width(r),o._getJSSheetHeader(a).find(".e-spreadsheetcolumnheader").width(r-1),o._getJSSheetContent(a).find(".e-spreadsheetcontentcontainer > .e-content").width(d._contWidth-s-("none"===h[0].style.display?0:18)))),o._isScrolling=!1},_scrollHandler:function(e){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T=this.XLObj,L=T.getActiveSheetIndex(),R=T.getSheet(L),O=e.scrollTop>=R._scrollTop,F=(e.scrollTop-R._scrollTop)/R.rowHeight+1,E=T._getContent(L).find(".e-content");if(m=_=f=0,b=C=!1,(e.scrollTop===R._scrollTop||R._bottomRow.idx+F>R.rowCount)&&T.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite){if(O&&e.scrollTop>0&&R.rowCount<T._maxRowCnt){l=R.rowCount;do{for(i in R._virtualBlockCnt++,R.rowCount+=R._virtualBlockRowCnt,R._columnStyles)for(r=R._virtualBlockRowCnt;r<R.rowCount;)T.XLEdit._updateDataContainer({rowIndex:r,colIndex:parseInt(i)},{dataObj:R._columnStyles[i]}),r++;for(;m<R._virtualBlockRowCnt;)R.rowsHeightCollection.push(R.rowHeight),-1===R.hideRowsCollection.indexOf(l)&&-1===R._hiddenFreezeRows.indexOf(l)?(R._rowIdxColl.push(l),_=R._rowHeightCollection[R._rowHeightCollection.length-1]+R.rowHeight,R._virtualTBodyHgt+=R.rowHeight):_=R._rowHeightCollection[R._rowHeightCollection.length-1],R._rowHeightCollection.push(_),l++,m++;m=0}while(e.scrollTop+R._virtualBlockRowCnt*R.rowHeight>R._rowHeightCollection[R._rowHeightCollection.length-1]);this._refreshScroller(L,"refresh","vertical"),R._scrollTop=e.scrollTop,T._refreshViewport(e.scrollTop,L),E.scrollTop(e.scrollTop),R._scrollTop=E.scrollTop(),b=!0}}else S=["value","value2","comment","hyperlink","format","border","type","isFilterHide","filterState","isMHide","isFHide","merge","isFilterHeader","isFilterVisible","text","general","cFormatRule","wrap","wrapRow","rule","align","isOverflow","isOfBrdr","altTxt"],o=T._getRowHdrTBody(L),n=T._getContTBody(L),O?e.scrollTop>=R._virtualContTBodyOffset.bottom&&e.scrollTop<=R._virtualBottomTBodyOffset.bottom?(f=R._virtualTopTBodyOffset.bottom-R._virtualTopTBodyOffset.top,R._virtualTopTBodyOffset.top=R._virtualContTBodyOffset.top,R._virtualTopTBodyOffset.bottom=R._virtualContTBodyOffset.bottom,R._virtualContTBodyOffset.top=R._virtualBottomTBodyOffset.top,R._virtualContTBodyOffset.bottom=R._virtualBottomTBodyOffset.bottom,R._virtualContBlockIdx++,R._virtualContBlockIdx===R._virtualBlockCnt?(R._virtualBottomTBodyOffset.top=R._virtualBottomTBodyOffset.bottom=0,R._isVirtualEndReached=!0):(R._virtualBottomTBodyOffset.top=R._virtualBottomTBodyOffset.bottom,h=T._getRowIdx(R._virtualContBlockIdx*R._virtualBlockRowCnt,L,!0),c=T._getRowIdx(R._virtualContBlockIdx*R._virtualBlockRowCnt+(R._virtualBlockRowCnt-1),L,!0),R._virtualBottomTBodyOffset.bottom=T._getRowOffsetBottom(c,L),p=R._rowIdxColl.slice(R._rowIdxColl.indexOf(h),R._rowIdxColl.indexOf(c)+1),a=T.getRangeData({property:S,sheetIdx:L,rowIdxs:p,withRowIdx:!0}),o.append(T._renderRowHdr(a.rowIdx,L)),n.append(T._renderData(a,L)),I=T._getContTBody(L).find("tr"),y=T._getRowHdrTBody(L).find("tr"),T.setRows([y,I],L),R._virtualRowIdx=R._virtualRowIdx.concat(a.rowIdx),b=!0),R._isVirtualTopReached||(T._removeRange(0,R._virtualBlockRowCnt),R._virtualRowIdx.splice(0,R._virtualBlockRowCnt),R._virtualTopTBodyHgt+=f),w="msie"===T._browserDetails.name||"edge"===T._browserDetails.name?n[0].getBoundingClientRect().height:window.getComputedStyle(n[0],null).height,R._virtualBottomTBodyHgt=R._virtualTBodyHgt-(R._virtualTopTBodyHgt+Math.floor(parseFloat(w))),T._refreshTBodiesHgt(),R._isVirtualTopReached=!1):!R._isVirtualEndReached&&e.scrollTop>=R._virtualBottomTBodyOffset.bottom&&(T._refreshViewport(e.scrollTop,L),b=C=!0):e.scrollTop+e.model.viewportsize<R._virtualContTBodyOffset.top&&e.scrollTop+e.model.viewportsize>=R._virtualTopTBodyOffset.top?(f=R._virtualBottomTBodyOffset.bottom-R._virtualBottomTBodyOffset.top,R._virtualBottomTBodyOffset.top=R._virtualContTBodyOffset.top,R._virtualBottomTBodyOffset.bottom=R._virtualContTBodyOffset.bottom,R._virtualContTBodyOffset.top=R._virtualTopTBodyOffset.top,R._virtualContTBodyOffset.bottom=R._virtualTopTBodyOffset.bottom,R._virtualContBlockIdx--,R._virtualTopTBodyOffset.bottom=R._virtualContTBodyOffset.top,1===R._virtualContBlockIdx?(R._virtualTopTBodyOffset.top=0,R._isVirtualTopReached=!0):(u=T._getRowIdx((R._virtualContBlockIdx-2)*R._virtualBlockRowCnt,L,!0),g=T._getRowIdx((R._virtualContBlockIdx-2)*R._virtualBlockRowCnt+(R._virtualBlockRowCnt-1),L,!0),R._virtualTopTBodyOffset.top=T._getRowOffsetTop(R,u),p=R._rowIdxColl.slice(R._rowIdxColl.indexOf(u),R._rowIdxColl.indexOf(g)+1),a=T.getRangeData({property:S,sheetIdx:L,rowIdxs:p,withRowIdx:!0}),o.prepend(T._renderRowHdr(a.rowIdx,L)),n.prepend(T._renderData(a,L)),I=T._getContTBody(L).find("tr"),y=T._getRowHdrTBody(L).find("tr"),T.setRows([y,I],L),R._virtualRowIdx=a.rowIdx.concat(R._virtualRowIdx),b=!0),R._isVirtualEndReached||(T._removeRange(1===R._virtualContBlockIdx?2*R._virtualBlockRowCnt:3*R._virtualBlockRowCnt,R._virtualBlockRowCnt),R._virtualRowIdx.splice(1===R._virtualContBlockIdx?2*R._virtualBlockRowCnt:3*R._virtualBlockRowCnt,R._virtualBlockRowCnt),R._virtualBottomTBodyHgt+=f,u=T._getRowIdx((R._virtualContBlockIdx-2)*R._virtualBlockRowCnt,L,!0),g=T._getRowIdx((R._virtualContBlockIdx-2)*R._virtualBlockRowCnt+(R._virtualBlockRowCnt-1),L,!0),R._virtualTopTBodyOffset.top=T._getRowOffsetTop(R,u)),w="msie"===T._browserDetails.name||"edge"===T._browserDetails.name?n[0].getBoundingClientRect().height:window.getComputedStyle(n[0],null).height,R._virtualTopTBodyHgt=R._virtualTBodyHgt-(R._virtualBottomTBodyHgt+Math.floor(parseFloat(w))),T._refreshTBodiesHgt(),R._isVirtualEndReached=!1,T.model.allowCellType&&T.XLCellType._rangeCellTypes(R.cellTypes,L),T.model.allowSparkline&&T.XLSparkline._refreshContentWithSparkline(L)):!R._isVirtualTopReached&&e.scrollTop+e.model.viewportsize<=R._virtualTopTBodyOffset.top&&(T._refreshViewport(e.scrollTop,L),b=C=!0),s=this._ensureScrollPos(e),T.isUndefined(s.resetTo)||T.model.scrollSettings.scrollMode==t.Spreadsheet.scrollMode.Normal?R._scrollTop=e.scrollTop:e.scrollTop=s.resetTo,C||T._refreshViewVar(e.scrollTop,null,L);if(E.scrollTop(e.scrollTop),R._scrollTop=E.scrollTop(),this._getFirstRow(L),T.model.allowSelection&&(R._isRowSelected||R._isColSelected||R._isSheetSelected)&&(T.XLSelection.refreshSelection(),T.XLDragFill&&T.XLDragFill.positionAutoFillElement()),b){for(T.XLComment&&T.XLComment._updateCmntArrowPos(T._getContent(L).find(".e-commentcell")),d=T.getObjectKeys(T._dataContainer.sheets[L][0]),T._dupDetails=!0,m=0,x=d.length;m<x;m++)v=T.XLEdit.getPropertyValue(0,d[m],"isFitWidth"),t.isNullOrUndefined(v)||T.XLResize._fitWidth(d[m]);T._dupDetails=!1}},_spreadVS:function(e){var i,r,l=this.XLObj,n=l.getActiveSheetIndex(),s=l.getSheet(n),o=this._vScroller(n),a=o.element.find(".e-vhandle")[0],d=a.getBoundingClientRect(),h=l._getJSSheetContent(n).find(".e-spreadsheetcontentcontainer > .e-content"),c=(e.scrollTop-s._scrollTop)/s.rowHeight;if(e.reachedEnd=Math.ceil(parseFloat(a.offsetTop))+Math.ceil(parseFloat(d.height))>=o.element.find(".e-vhandlespace").height()-2,i=e.scrollTop,l.model.enableContextMenu&&l.XLCMenu.hideCMenu(),l.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&e.scrollData.step>-1&&!l._scrollReverse)if(e.reachedEnd&&s._bottomRow.idx+c<=s.rowCount){var u,g=!1,p=!1,m=this;!l.isUndefined(e.scrollData.target)&&l._hasClass(e.scrollData.target,"e-vdown")&&(u=setInterval(function(){g=!0;for(var e=0;e<20;e++)m._scrollBottom(n);this._isScrollToCell||(i=(o._scrollData.handleSpace-o._scrollData.handle)*o._scrollData.onePx),m._refreshScroller(n,"refresh","vertical"),o.element.find(".e-vhandle")[0].style.top=o._scrollData.handleSpace-o._scrollData.handle+"px",o.scroll(i),clearInterval(u)},1e3),"msie"===l._browserDetails.name&&"8.0"===l._browserDetails.version?(o.element.find(".e-vdown")[0].attachEvent("onmouseup",function(){clearInterval(u)}),document.attachEvent("onmouseup",function(){clearInterval(u)})):(o.element.find(".e-vdown")[0].addEventListener("mouseup",function(){clearInterval(u)}),document.addEventListener("mouseup",function(){clearInterval(u)})),p=!0),e.cancel=!0,g&&p||(this._scrollBottom(n,(e.scrollTop-s._scrollTop)/20+1),this._isScrollToCell||(i=(o._scrollData.handleSpace-o._scrollData.handle)*o._scrollData.onePx),m._refreshScroller(n,"refresh","vertical"),o.element.find(".e-vhandle")[0].style.top=o._scrollData.handleSpace-o._scrollData.handle+"px",o.value(i))}else s._bottomRow.idx+c>s.rowCount-1&&e.scrollTop>=s._scrollTop&&e.scrollTop>0&&s.rowCount<l._maxRowCnt&&(this._scrollBottom(n,(e.scrollTop-s._scrollTop)/20+1),this._refreshScroller(n,"refresh","vertical"));r=this._ensureScrollPos(e),e.scrollTop=l.isUndefined(r.resetTo)||l.model.scrollSettings.scrollMode==t.Spreadsheet.scrollMode.Normal?s._scrollTop=i:s._scrollTop=r.resetTo,l._scrollReverse=!1,h.scrollTop(e.scrollTop),s._scrollTop=h.scrollTop(),this._getFirstRow(n)},_scrollX:function(i){var r,l,n,s=this.XLObj,o=this._hScroller(i),a=[1],d=s._getContent(i).find("colgroup"),h=s.getSheet(i);for(s.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&this._scrollRight(i),o.model.maximum=o.model.maximum+h.columnWidth,o._scrollData.scrollable=o._scrollData.scrollable+h.columnWidth,this._refreshScroller(i,"refresh","horizontal"),o.element.find(".e-hhandle").css("left",o._scrollData.handleSpace-(o._scrollData.handle+1)),n=(o._scrollData.handleSpace-o._scrollData.handle)*o._scrollData.onePx,o.value(n),r=0,l=s.model.sheets[i]._fCol;r<l;r++)a.push(a[a.length-1]+e(d.find("col")[r]).width());h._isFreezed&&s._isFrozen(s.getFrozenColumns())?o.scroll(o.value()+s._getColWidth(h._fleftColIdx,i),!0):s._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").scrollLeft(n,o._scrollData.onePx),h._scrollLeft=n,this._getFirstColumn(i)},_scrollY:function(i){var r,l,n,s=this.XLObj,o=this._vScroller(i),a=[1],d=s.getRows(i)[1];for(s.model.scrollSettings.scrollMode===t.Spreadsheet.scrollMode.Infinite&&this._scrollBottom(i),o.model.maximum=o.model.maximum+s.model.rowHeight,o._scrollData.scrollable=o._scrollData.scrollable+s.model.rowHeight,this._refreshScroller(i,"refresh","vertical"),o.element.find(".e-vhandle")[0].style.top=o._scrollData.handleSpace-(o._scrollData.handle+1)+"px",n=(o._scrollData.handleSpace-o._scrollData.handle)*o._scrollData.onePx,o.value(n),r=0,l=s.model.sheets[i]._fRow;r<l;r++)a.push(a[a.length-1]+e(d[r]).height());s._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer > .e-content").scrollTop(n,o._scrollData.onePx),this._getFirstRow(i)},_getFirstRow:function(e){var t,i,r=this.XLObj,l=r.getSheet(e),n=0,s=l._rowHeightCollection;r.getFrozenRows(e)<1&&(n=r._getContent(e).find(".e-content").scrollTop(),t=r._getIdxWithOffset(n,null,!0,null,e).rowIdx,l._topRow={idx:t,value:s[t]}),i=r._getIdxWithOffset(n+l._vPortHgt,null,!0,null,e).rowIdx||l.rowCount-1,l._bottomRow={idx:i,value:s[i]},l.topLeftCell=r.getAlphaRange(l._topRow.idx,l._leftCol.idx)},_getFirstColumn:function(e){var t,i,r=this.XLObj,l=r.getSheet(e),n=0,s=l._colWidthCollection;r.getFrozenColumns(e)<1&&(n=document.getElementById(r._id+"_content").scrollLeft,t=r._getIdxWithOffset(null,n,!0,null,e).colIdx,l._leftCol={idx:t,value:s[t]}),i=r._getIdxWithOffset(null,n+l._vPortWth,!0,null,e).colIdx||l.colCount-1,l._rightCol={idx:i,value:s[i]},l.topLeftCell=r.getAlphaRange(l._topRow.idx,l._leftCol.idx)},scrollToCell:function(e){var t,i,r=0,l=0,n=this.XLObj,s=n.getRangeIndices(e),o=n.getActiveSheetIndex(),a=n.getSheet(o);t=s[0]>a.rowCount?n._getRowOffsetBottom(a.rowCount-1,o)+(s[0]-a.rowCount)*a.rowHeight:n._getRowOffsetBottom(s[0]-1,o),i=s[1]>a.colCount?n._getWidth(0,a.colCount-1)+(s[1]-a.colCount)*a.columnWidth:n._getWidth(0,s[1]-1),n._isFrozen(a.frozenRows)&&(r=n._getRowOffsetTop(a,a._frozenRows-1)),n._isFrozen(a.frozenColumns)&&(l=n._getColOffsetLeft(a,a._frozenColumns-1)),this._isScrollToCell=!0,n._scrollContent({x:(i||0)-a._scrollLeft-l,y:(t||0)-a._scrollTop-r}),this._isScrollToCell=!1},_scrollSelectedPosition:function(e,t){if(!this.XLObj._isExport){var i,r=0,l=this.XLObj,n=this._hScroller(e),s=this._vScroller(e),o=l._getCellInfo(t),a=l.getSheet(e),d=l._getJSSheetContent(e).find(".e-spreadsheetcontentcontainer > .e-content"),h=s.element.find(".e-vhandle")[0].getBoundingClientRect(),c=l._dupDetails,u=h.top+s._scrollData.handle>=s._scrollData.handleSpace,g=h.left+n._scrollData.handle>=n._scrollData.handleSpace;l.isUndefined(n)||parseInt(o.width)+(o.left-d.offset().left)>d.width()&&((i=o.left-(n._scrollData.handleSpace+n.model.buttonSize))<0?n.scroll(0):(g&&(l._scrollReverse=!0),(parseInt(o.width)+o.left>n._scrollData.handleSpace+2*n.model.buttonSize||o.left-d.offset().left<=0)&&0!=i&&n.scroll(o.left+o.width+1-(n._scrollData.handleSpace+2*n.model.buttonSize)),l._scrollReverse=!1)),l.isUndefined(s)||(parseInt(o.height)+(o.top-d.offset().top)>d.height()||o.top-d.offset().top<=0)&&(t.rowIndex<a._topRow.idx||t.rowIndex>a._bottomRow.idx)&&(!t.rowIndex<a._bottomRow.idx&&t.rowIndex<a.rowCount-1&&(r=o.height),o.top+r-(s._scrollData.handleSpace+s.model.buttonSize)<0?s.scroll(0):(u&&(l._scrollReverse=!0),s.scroll(o.top+o.height+1-(s._scrollData.handleSpace+2*s.model.buttonSize)),l._scrollReverse=!1)),l._dupDetails=c}},_rowTemplate:function(e,t){for(var i,r="",l=this.XLObj,n=l.getSheet(e),s=0,o=l.model.sheets[e].colCount;s<o;s++)i="e-rowcell",n.showGridlines||(i=i.concat(" e-hborder")),n._hiddenFreezeCols.indexOf(s)>-1&&(i+=" e-fcol-hide"),r+=String.format('<td class="{0}" style="{2}"  >{1}</td>',i,"");return String.format("<tr style='{0}' data-idx=\"{1}\">"+r+"</tr>","height:"+l.model.rowHeight+"px;",t-1)},_rowHeaderTemplate:function(e,t){var i;return t=t||this.XLObj.model.rowHeight,i=String.format('<td class="{0}"  >{1}</td>',"e-rowheader",e),String.format("<tr style='{0}' data-idx=\"{1}\">"+i+"</tr>","height:"+t+"px;",e-1)},_columnTemplate:function(){var e="e-rowcell e-wrapword",t=this.XLObj,i=t.getActiveSheetIndex();return t.getSheet(i).showGridlines||(e=e.concat(" e-hborder")),String.format('<td class="{0}" style="{2}" >{1}</td>',e,"")},_colGroupTemplate:function(e,t){return t=t||this.XLObj.getSheet(e).columnWidth,String.format("<col style = '{0}'></col>","width:"+t+"px;")},_columnHeaderTemplate:function(e,t){var i,r,l=this.XLObj,n=l.getSheet(t),s=l.getObjectLength(l._copyColumns);return i=l._generateHeaderText(e),n.fieldAsColumnHeader&&s&&l._copyColumns[i]&&(i=l._copyColumns[i].text),r=String.format('<div class = "{0}" > {1}</div>',"e-headercelldiv",i),String.format('<th class="{0}"  >{1}</th>',"e-headercell",r)},_createNewRow:function(t,i,r,l){var n,s,o,a,d,h,c,u=this.XLObj,g=u.model.scrollSettings.allowVirtualScrolling,p=u.XLSelection,m=u.getSheet(t);if(g?(n=u._getContent(t).find("tbody")[1],a=u._getJSSheetRowHeaderContent(t).find("tbody")[1]):(n=u._getContent(t).find("tbody").not("[class *= 'e-ss-virtual']")[0],a=u._getJSSheetRowHeaderContent(t).find("tbody").not("[class *= 'e-ss-virtual']")[0]),o=this._rowTemplate(t,parseInt(a.lastChild.textContent)+1),-1===i||r>-1&&i>-1&&"shift"===l?(e(a).append(this._rowHeaderTemplate(parseInt(a.lastChild.textContent)+1)),e(n).append(o),"shift"==l&&(e(n).find("tr:last td:last").remove(),u._getRowIdx(i),e(n).find("tr: eq(' + rowElemIdx + ') td:eq(' + (colIdx - 1) + ')").after(this._columnTemplate()))):(s=n.insertRow(i),e(s).height(u.model.rowHeight),e(s).append(e(o)[0].innerHTML),s=a.insertRow(i),e(s).height(u.model.rowHeight),e(s).append("<td class='e-rowheader'></td>")),m.rowCount=u.model.sheets[t].rowCount+1,m.rowsHeightCollection.push(u.model.rowHeight),i>-1){for(h=0,c=(d=e(a).find("td")).length;h<c;h++)e(d[h]).text(h+1);u.XLScroll._getRowHeights(t,i+1)}m._rowHeightCollection.push(m._rowHeightCollection[m._rowHeightCollection.length-1]+u.model.rowHeight),u.model.allowSelection&&(m._isColSelected||m._isSheetSelected)&&p.refreshSelection(),u._refreshRows(t)},_createNewColumn:function(i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T=this.XLObj,L=T.getSheet(i),R=T.XLSelection,O=!1;for(d=T._getContTBody(i)[0],h=T._getJSSheetHeader(i).find("tr")[0],c=T._getJSSheetContent(i).find(".e-spreadsheetcontentcontainer colgroup"),u=T._getJSSheetHeader(i).find("colgroup"),g=L.colCount,s=0,a=(v=L.filterSettings.tableRange).length;s<a;s++)if(S=v[s].multifilterIdx,r.colIndex>S[0]&&l.colIndex<S[S.length-1]){O=!0,x=v[s].startRow-1,v=v[s];break}if(-1===r.colIndex||r.colIndex>-1&&r.rowIndex>-1&&"shift"===n){if(-1===r.colIndex&&"insert"===n){for(_=this._columnHeaderTemplate(g+1,i),e(h).append(_),p=this._colGroupTemplate(i),u.append(p),s=0,a=d.rows.length;s<a;s++)m=this._columnTemplate(s),e(d.rows[T._getRowIdx(s,i,!1,!0)]).append(m);c.append(p)}if("shift"===n){for(w=g,s=r.colIndex;s<=l.colIndex;s++)_=this._columnHeaderTemplate(w+1,i),e(h).append(_),p=this._colGroupTemplate(i),u.append(p),c.append(p),w+=1;for(s=0,a=d.rows.length;s<a;s++)for(o=r.colIndex;o<=l.colIndex;o++)m=this._columnTemplate(s),e(d.rows[T._getRowIdx(s)]).append(m);if(T._insDelStatus.indexOf("insert")>-1)for(s=r.rowIndex;s<=l.rowIndex;s++)for(o=r.colIndex;o<=l.colIndex;o++)e(d).find("tr:eq("+T._getRowIdx(s)+") td:last").remove(),m=this._columnTemplate(s),e(d).find("tr").eq(T._getRowIdx(s)).find("td:eq("+o+")").before(m),O&&s===x&&T.model.allowFiltering&&T.XLFilter._insertFilterIcon(s,o,v,x,O);else for(s=r.rowIndex;s<=l.rowIndex;s++)for(o=l.colIndex;o>=r.colIndex;o--)e(d).find("tr:eq("+T._getRowIdx(s)+") td:eq("+o+")").remove(),m=this._columnTemplate(s),e(d).find("tr:eq("+T._getRowIdx(s)+")").append(m),O&&s===x&&T.model.allowFiltering&&T.XLFilter._insertFilterIcon(s,o,v,x,O)}L.colCount=L.colCount+1,L.columnsWidthCollection.push(L.columnWidth)}else{if(L._isTemplate&&(r.colIndex<L._templateColCount||l.colIndex<L._templateColCount))return;if(y=e.extend(!0,[],T.getSheet(i).columnsWidthCollection),T._insDelStatus.indexOf("insert")>-1){for(I=y.splice(0,r.colIndex),s=r.colIndex;s<=l.colIndex;s++)_=this._columnHeaderTemplate(s+1,i),e(h).find("th:eq("+s+")").before(_),p=this._colGroupTemplate(i),I.push(L.columnWidth),u.find("col:eq("+s+")").before(p),c.find("col:eq("+s+")").before(p),L.colCount=L.colCount+1;for(t.merge(I,y),L.columnsWidthCollection=I,s=0,a=d.rows.length;s<a;s++)for(o=r.colIndex;o<=l.colIndex;o++)m=this._columnTemplate(s),e(d.rows[T._getRowIdx(s)]).find("td:eq("+o+")").before(m),O&&s===x&&T.model.allowFiltering&&T.XLFilter._insertFilterIcon(s,o,v,x,O)}else{for(I=y.splice(0,r.colIndex),s=l.colIndex;s>=r.colIndex;s--)e(h).find("th:eq("+s+")").remove(),u.find("col:eq("+s+")").remove(),c.find("col:eq("+s+")").remove(),L.colCount=L.colCount-1;for(y.splice(0,l.colIndex-r.colIndex+1),t.merge(I,y),L.columnsWidthCollection=I,s=0,a=d.rows.length;s<a;s++)for(o=l.colIndex;o>=r.colIndex;o--)e(d.rows[T._getRowIdx(s)]).find("td:eq("+o+")").remove()}for(s=0,a=(b=e(h).find("th>.e-headercelldiv")).length;s<a;s++)e(b[s]).text(T._generateHeaderText(s+1))}C=e.trim(e(_).text()),f=e(m).text(),L.columns.push({field:C,text:C,type:null!=f?f.getDay?"date":typeof f:null,width:e(m).width()}),T.XLScroll._getColWidths(i,r.colIndex>-1?r.colIndex:L.colCount-2),T.model.allowSelection&&(L._isRowSelected||L._isSheetSelected)&&R.refreshSelection(),T._refreshTemplates(i,!0)},_insertColHeaders:function(t,i,r){var l,n=this._columnHeaderTemplate(i+1,t);e(r).append(n),l=this._colGroupTemplate(t),e(r.parentNode.previousSibling).append(l)},_scrollBottom:function(e,t){var i,r,l=this.XLObj.getSheet(e);if(t)this._createRows(l.rowCount-1,l.rowCount+t,e);else for(i in this._createNewRow(e,-1,-1,"insert"),l._columnStyles)r=parseInt(i),this.XLObj.XLEdit._updateDataContainer({rowIndex:l.rowCount-1,colIndex:r},{dataObj:l._columnStyles[i]})},_createRows:function(e,t,i){i=i||this.XLObj.getActiveSheetIndex();for(var r=e,l=t;r<l;r++)this._createNewRow(i,-1,-1,"insert")},_scrollRight:function(e){var t,i,r,l={rowIndex:-1,colIndex:-1};for(r in this._createNewColumn(e,l,l,"insert"),(t=this.XLObj.getSheet(e))._rowStyles)i=parseInt(r),this.XLObj.XLEdit._updateDataContainer({rowIndex:i,colIndex:t.colCount-1},{dataObj:t._rowStyles[r]})},_ensureScrollPos:function(e){var i,r,l={},n=this.XLObj;return e.model.orientation===t.ScrollBar.Orientation.Vertical?(i=e.scrollTop,r=n._getIdxWithOffset(i,null,!0),l.rowIdx=r.rowIdx,i!==r.yOffset&&(l.resetTo=r.yOffset)):(i=e.scrollLeft,r=n._getIdxWithOffset(null,i,!0),l.colIdx=r.colIdx,i!==r.xOffset&&(l.resetTo=r.xOffset)),l},_refreshRowCol:function(e,t){t=this.XLObj._getSheetIndex(t);var i,r=this.XLObj.getSheet(t),l=!1;if(r.colCount<e[3]+1){for(i=e[3]-(r.colCount-1);i--;)this._scrollRight(t);l=!0}if(r.rowCount<e[2]+1){for(i=e[2]-(r.rowCount-1);i--;)this._scrollBottom(t);l=!0}l&&this._refreshScroller(t,"refresh","all")}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.pivot=function(e){this.XLObj=e,this._pivotCnt=1,this._hasPvtField=!1,this._displayActPanel=!0,this.names={},this._valueFieldName=""},t.spreadsheetFeatures.pivot.prototype={createPivotTable:function(t,i,r,l,n){var s,o,a=this.XLObj,d=new RegExp("[^a-z0-9\\s]","gi");if(r&&(r.indexOf(" ")>-1||r.match(d))&&(o=r,r=r.replace(d,"").replace(/ /g,"_")),a.model.enablePivotTable&&(!a.getSheet()._isLoaded||!a.model.isReadOnly)){var h,c,u,g,p,m,_,f=a.XLRibbon,b=a.getActiveSheetIndex(),C=[];if(a._showDialog(a._id+"_Ribbon_Insert_Tables_PivotTable"),g=f._getAddrFromDollarAddr(t),h=a.model.sheets[g[0]].sheetInfo.text,t=a.getRangeIndices(g[1]),c=a.getRangeDataAsJSON({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]},!1,g[0]),e("#"+a._id+"_dlg_existsheet").data("ejRadioButton").model.checked||a.isImport||a.model.isImport||!a.getSheet(b)._isLoaded?(g=f._getAddrFromDollarAddr(i),C=a.getRangeIndices(g[1]),a._isExport||b===g[0]||(a.gotoPage(g[0],!1),b=g[0])):(a.insertSheet(),b=a.getActiveSheetIndex(),C=[2,0]),a.isUndefined(n)&&(n={}),m=a.model.sheets[g[0]]._rowHeightCollection[C[0]],p=a.model.sheets[g[0]]._colWidthCollection[C[1]],a.hideActivationPanel(),r&&r.length){if(a.getObjectKeys(this.names).indexOf(r)>-1)do{r+=this._pivotCnt,this._pivotCnt++}while(a.getObjectKeys(this.names).indexOf(r)>-1)}else do{r="PivotTable"+this._pivotCnt,this._pivotCnt++}while(a.getObjectKeys(this.names).indexOf(r)>-1);return s=a._id+"_"+r,this.names[s]=o||r,n.pvtRange=C,n.sheetIdx=b,n.temp=g[0],n.datasource=c,a.getSheet(b)._isUpdated||this._updatePivotMngr({},{pivot:{id:s,top:m,left:p,rowIndex:C[0],colIndex:C[1],dataRange:t,dataSheetName:h,sheetIdx:b,tableName:this.names[s]}}),this._refreshPivotElement(t,i,r,l,n),_=a.element.find("#"+s).data("ejPivotGrid"),this._refreshRowColumn(C,_),a.showActivationPanel(),u={sheetIndex:n.sheetIdx,reqType:"shape",shapeType:"pivot",range:n.pvtRange,ID:s,dataSource:n.datasource},a._trigActionComplete(u),s}},_refreshRowColumn:function(e,t){var i,r,l,n,s,o=this.XLObj,a=o.getActiveSheetIndex(),d=o.getSheet(a);for(l=t._rowCount,s=t.calculateCellWidths().rowHeight,i=(r=t.calculateCellWidths().columnWidths).length,o._focusTopElem||o._createFocusElement(),l||(l=4),n=e[0];n<l+e[0];n++)o.XLResize.setRowHeight(n,s);if(i>0)for(n=0;n<i+e[1];n++)o.XLResize.setColWidth(n+e[1],r[n]);else for(n=0;n<3+e[1];n++)o.XLResize.setColWidth(n+e[1],81);d._isFreezed&&(o.XLFreeze._refreshFreezeRowDiv(),o.XLFreeze._refreshFreezeColDiv())},_refreshPivotElement:function(i,r,l,n,s){var o,a,d,h,c,u=this.XLObj;h=u.model.sheets[s.sheetIdx]._rowHeightCollection[s.pvtRange[0]],c=u.model.sheets[s.sheetIdx]._colWidthCollection[s.pvtRange[1]],d={dataSource:{data:s.datasource},enableToolTipAnimation:!1,cellDoubleClick:e.proxy(this._cellDblClick,this),enableCellDoubleClick:!0,renderSuccess:e.proxy(this._renderSuccess,this),drillSuccess:e.proxy(this._renderSuccess,this)},t.isNullOrUndefined(n)||(d.dataSource={data:s.datasource,rows:n.rows,columns:n.columns,values:n.values,filters:n.filters}),u.getSheetElement(u.getActiveSheetIndex()).find(".e-ss-activepivot").removeClass("e-ss-activepivot"),(o=t.buildTag("div.e-ss-pivot","","",{id:u._id+"_"+l})).css({left:c-2,top:h-2}).addClass("e-ss-activepivot"),u._getContent(s.sheetIdx).find(".e-content").append(o),this._hasPvtField||u.getActivationPanel().append(t.buildTag("div","",{overflow:"hidden"},{id:u._id+"_PivotField"})),u.element.find("#"+u._id+"_PivotField").append(t.buildTag("div.e-ss-pivotfield","","",{id:u._id+"_PivotTableSchema_"+u._id+"_"+l})),a=u.element.find("#"+u._id+"_PivotTableSchema_"+u._id+"_"+l),u.getActivationPanel().find("#"+a[0].id).show(),o.ejPivotGrid(d),a.find("#"+u._id+"_PivotTableSchema_"+u._id+"_"+l+"_schemaFieldTree").data("ejTreeView").option("allowDragAndDrop",!1),a.css({float:"left",width:u.model.activationPanelWidth-20}),a.find(".schemaFieldList").css({height:150}),this._hasPvtField||(u.getActivationPanel().ejScroller({width:u.model.activationPanelWidth,height:u._getContent(s.sheetIdx).height(),scroll:e.proxy(this._pivotScroll,this)}),this._hasPvtField=!0),this._clearBackgroundData(o.data("ejPivotGrid"),u.getSheet(s.sheetIdx).pivotMngr.pivot[o[0].id],s.sheetIdx,"update"),u.XLRibbon&&u.XLRibbon._analyzeTabUpdate(),u.XLSelection._cleanUp(!0),u.getActivationPanel().data("ejScroller").refresh()},deletePivotTable:function(e){var t,i,r,l,n=this._getPivotIDFromName(e),s=this.XLObj,o=s._dataContainer;if(s.model.enablePivotTable&&!s.model.isReadOnly)for(l=1,t=s.model.sheetCount;l<=t;l++)s._getContent(l).find("#"+n).length&&(r=s.getSheet(l).pivotMngr.pivot[n],i=o.sheets[l][r.rowIndex][r.colIndex],s.getObjectLength(i)<2&&i.pivot.length<2?delete o.sheets[l][r.rowIndex][r.colIndex]:i.pivot.length<2&&delete o.sheets[l][r.rowIndex][r.colIndex].pivot,delete s.getSheet(l).pivotMngr.pivot[n],s._getContent(l).find("#"+n).remove(),s.hideActivationPanel(),s.getActivationPanel().find("#"+s._id+"_PivotTableSchema_"+n).remove(),s.XLRibbon._toggleAnalyzeTab(),s._trigActionComplete({ID:n,rowIndex:r.rowIndex,colIndex:r.colIndex,reqType:"shape",shapeType:"pivot",sheetIndex:l}))},refreshDataSource:function(e,t){var i,r,l,n,s,o=this.XLObj;o.model.enablePivotTable&&!o.model.isReadOnly&&(e&&t?(i=o.element.find("#"+o._id+"_"+e))&&(r=i[0].id):(t=o.getActiveSheetIndex(),r=(i=o._getContent(t).find(".e-ss-activepivot"))[0].id),(l=i.data("ejPivotGrid"))&&(n=o.getSheet(t).pivotMngr.pivot[r].dataRange,s=o.getRangeDataAsJSON({rowIndex:n[0],colIndex:n[1]},{rowIndex:n[2],colIndex:n[3]},!1,o._getSheetIndexByName(o.getSheet(t).pivotMngr.pivot[r].dataSheetName)),l.model.dataSource.data=s,l.refreshPivotGrid()))},clearPivotFieldList:function(e){var t=this.XLObj,i=this._getPivotIDFromName(e);t.model.enablePivotTable&&!t.model.isReadOnly&&this._clearFilters(t.element.find("#"+i).data("ejPivotGrid"),t.getActivationPanel().find("#"+t._id+"_PivotTableSchema_"+i).data("ejPivotSchemaDesigner"))},_cellDblClick:function(e){if(e.selectedData.length){var t,i=this.XLObj,r=i.XLFormat;i.insertSheet(),t=i.getActiveSheetIndex(),i._updateRangeValue(t,{dataSource:e.selectedData,startCell:"A1",showHeader:!0},!1),r.createTable({header:!0,name:"Table"+i._tableCnt,format:r._getTableLayoutFromName("TableStyleMedium9").format,formatName:"TableStyleMedium9"},"A1:"+i._generateHeaderText(i.getObjectLength(e.selectedData[0]))+(e.selectedData.length+1))}},_dragMove:function(){var t,i=this.XLObj,r=i.getActivationPanel().data("ejScroller"),l=i.element.find(".e-spreadsheetactpanel"),n=l.offset().top;l.height()+n-45<e(".e-dragedNode").offset().top?t=setInterval(function(){l.height()+n-45<e(".e-dragedNode").offset().top&&r.scrollY(r.model.scrollTop+25)},300):n+45>e(".e-dragedNode").offset().top&&(t=setInterval(function(){n+45>e(".e-dragedNode").offset().top&&r.scrollY(r.model.scrollTop-25)},300)),"msie"===i._browserDetails.name&&"8.0"===i._browserDetails.version?(e(".e-dragedNode")[0].attachEvent("onmouseup",function(){clearInterval(t)}),document.attachEvent("onmouseup",function(){clearInterval(t)})):(e(".e-dragedNode")[0].addEventListener("mouseup",function(){clearInterval(t)}),document.addEventListener("mouseup",function(){clearInterval(t)}))},_renderSuccess:function(i){"drillSuccess"===i.type&&(i=i.gridObj);var r,l,n,s,o=this.XLObj,a=o.getActiveSheetIndex(),d=i;o._isExport||this._clearBackgroundData(i,o.getSheet(a).pivotMngr.pivot[i._id],a,"update"),o.element.find("#"+o._id+"_PivotTableSchema_"+i._id).ejPivotSchemaDesigner({pivotControl:i,layout:t.PivotSchemaDesigner.Layouts.Excel,dragMove:e.proxy(this._dragMove,this),fieldItemDropped:e.proxy(this._fieldItemDropped,this)}),n=o.getSheet(a).pivotMngr.pivot[i._id],l=d._rowCount,r=d.getJSONRecords().length/d._rowCount,s=[n.rowIndex,n.colIndex,n.rowIndex+l,n.colIndex+r],this._refreshRowColumn(s,d),e(".e-spreadsheet .e-pivotgrid th[role='columnheader'").addClass("e-ss-pivottableheader"),e(".e-spreadsheet .e-pivotgrid tr:last th.rgtot").addClass("e-ss-pivottableheader"),o.XLDragFill.hideAutoFillElement()},_clearBackgroundData:function(e,t,i,r){var l,n,s,o,a=this.XLObj;l=e.getJSONRecords().length/e._rowCount,s=!(n=e._rowCount)||isNaN(n)?t.rowIndex+17:t.rowIndex+n,o=!l||isNaN(l)?t.colIndex+2:t.colIndex+l-1,r&&"update"!==r?a.getRange([t.rowIndex,t.colIndex,s,o],i).removeClass("e-readOnly"):a.getRange([t.rowIndex,t.colIndex,s,o],i).removeClass("e-readOnly").addClass("e-readonly"),a._dupDetails=!0,a.clearRangeData([t.rowIndex,t.colIndex,s,o],["value","value2","hyperlink","cFormatRule","comment","format","formats"],"",!1),a._dupDetails=!1},_fieldItemDropped:function(e){if("filter"===e.axis)for(var t,i=this.XLObj,r=i.getActiveSheetIndex(),l=i._getContent(r).find(".e-ss-activepivot").data("ejPivotGrid"),n=i.getSheet(r).pivotMngr.pivot[l._id];n.rowIndex<=l.getOlapReport().filters.length;)n.rowIndex=n.rowIndex+1,t=i.getCell(n.rowIndex,n.colIndex)[0],l.element.css({left:t.offsetLeft-2,top:t.offsetTop-2})},_updatePivotMngr:function(t,i){var r=this.XLObj;r.getSheet(r.getActiveSheetIndex()).pivotMngr.pivot[i.pivot.id]=e.extend(!0,{},i.pivot),r.XLEdit._updateDataContainer({rowIndex:i.pivot.rowIndex,colIndex:i.pivot.colIndex},{dataObj:{pivot:i.pivot.id}})},_pivotMouseDown:function(t){var i=this.XLObj;t.preventDefault(),i.getActivationPanel().find("#"+i._id+"_PivotTableSchema_"+t.target.id).show(),i._getContent(i.getActiveSheetIndex()).find(".e-ss-activepivot").removeClass("e-ss-activepivot"),e(t.target).hasClass("e-ss-pivot")?e(t.target).addClass("e-ss-activepivot"):e(t.target).parents("e-ss-object").addClass("e-ss-activepivot"),i.XLSelection._cleanUp(!0),i.showActivationPanel()},_pivotScroll:function(t){var i=this.XLObj,r=i.getActivationPanel().find("#"+i._id+"_PivotTableSchema_"+i._getContent(i.getActiveSheetIndex()).find(".e-ss-activepivot")[0].id).data("ejPivotSchemaDesigner");"thumb"===t.source&&(e(".e-dragedNode").length||r._isDragging||this.XLObj.XLResize._allowStart)&&(t.cancel=!0)},_pivotMouseUp:function(i){var r,l=this.XLObj,n=e(i.target),s=e("#"+l._id+"_Ribbon").data("ejRibbon"),o=l._getContent(l.getActiveSheetIndex()).find(".e-ss-activepivot"),a=1==o.length?e("#"+l._id+"_PivotTableSchema_"+o[0].id+"_pivotTreeContextMenu"):null,d=t.isNullOrUndefined(a)?null:a.find("#"+l._id+"_fieldSettings")[0];l.model.showRibbon&&(l._getContent(l.getActiveSheetIndex()).find(".e-ss-activepivot").length&&(n.hasClass("e-ss-pivot")||n.parents(".e-ss-pivot").length)?l.XLRibbon._analyzeTabUpdate():!l._getContent(l.getActiveSheetIndex()).find(".e-ss-activepivot").length&&(s.model.selectedItemIndex===l.XLRibbon._getTabIndex("analyze")||s.isVisible("Analyze"))&&l.XLRibbon._toggleAnalyzeTab()),this._valueFieldName=i.target.textContent,(r=t.isNullOrUndefined(a)?null:a.data("ejMenu"))&&e(i.target).parents().eq(2).hasClass("e-schemaValue")&&e(i.target).hasClass("e-pvtBtn")?d?r.showItems(["#"+d.id]):(r.insert([{id:l._id+"_fieldSettings",parentId:null,text:"Value Field Settings "}],"#"+a[0].id),d=a.find("#"+l._id+"_fieldSettings")[0],"msie"==l._browserDetails.name&&"8.0"==l._browserDetails.version?e(d)[0].attachEvent("onclick",this._cmenuclick,!0):e(d)[0].addEventListener("click",this._cmenuclick,!0)):t.isNullOrUndefined(d)||e(i.target).parents().eq(2).hasClass("e-schemaValue")||r.hideItems(["#"+d.id])},_cmenuclick:function(t){var i=e("#"+t.currentTarget.id.split("_fieldSettings")[0]).data("ejSpreadsheet"),r=i._id,l=e("#"+r+"_fielddlg");l.hasClass("e-dialog")?(l.ejDialog("open"),i.XLPivot._refreshSummaryList()):i.XLPivot._renderFieldSettingDlg()},_renderFieldSettingDlg:function(){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f,b,C=this.XLObj,S=C._id+"_fielddlg";i=t.buildTag("div#"+S),r=t.buildTag("div#"+S+"_fieldtab"),l=t.buildTag("div.e-dlg-fields e-dlgctndiv"),a=t.buildTag("div.e-ss-maindiv"),c=t.buildTag("div.e-ss-topmaindiv"),u=t.buildTag("label",C._getLocStr("FieldValue"),"",{id:S+"_fieldnamelabel"}),(h=t.buildTag("label#"+S+"_fieldnamevaluelabel.e-dlg-fieldlabel")).text(this._valueFieldName),c.append(u,h),i.append(c),g=t.buildTag("div"),d=t.buildTag("label#"+S+"_fieldvallabel.e-dlg-fieldvaluelabel",C._getLocStr("SummarizeChooseType")),b=t.buildTag("ul#"+S+"_summarylist","",{width:"150px",height:"150px"}),g.append(d,b),a.append(g),n=t.buildTag("ul .e-ul"),s=t.buildTag("a",C._getLocStr("SummarizeValue"),{},{href:"#"+S+"_summary"}),o=t.buildTag("li",s),b.ejListBox({selectedItemIndex:"0",width:"150px",height:"150px",dataSource:[{value:"sum",text:"Sum"},{value:"count",text:"Count"},{value:"average",text:"Average"},{value:"max",text:"Max"},{value:"min",text:"Min"}],fields:{text:"text",value:"value"},allowMultiSelection:!1}),n.append(o),r.append(n),l.append(r),p=t.buildTag("div.e-dlg-btnfields"),m=t.buildTag("div.e-dlg-btnctnr"),_=t.buildTag("input#"+S+"_okbtn"),f=t.buildTag("input#"+S+"_cantn"),_.ejButton({text:C._getLocStr("Ok"),showRoundedCorner:!0,width:60,click:t.proxy(this._fielddlgOk,this),cssClass:"e-ss-okbtn"}),f.ejButton({text:C._getLocStr("Cancel"),showRoundedCorner:!0,width:60,click:t.proxy(this._fielddlgCancel,this)}),p.append(m.append(_,f)),C.element.append(i.append(l,p)),r.ejTab({width:"100%",height:"auto",cssClass:"e-ss-dlgtab",allowKeyboardNavigation:!1}),e("#"+S+"_summary").append(a),i.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:C._getLocStr("ValueFieldSettings"),width:"auto",height:"auto",cssClass:"e-ss-dialog e-ss-mattab e-ss-fcdlg e-"+C._id+"-dlg",open:function(){e("#"+C._id+"_formatdlg_okbtn").focus()}}),i.ejDialog("open"),this._refreshSummaryList()},_refreshSummaryList:function(){for(var i,r,l=this.XLObj,n=l._id,s=n+"_fielddlg",o=l.getActiveSheetIndex(),a=l._getContent(o).find(".e-ss-activepivot")[0].id,d=e("#"+a).data("ejPivotGrid"),h=d.model.dataSource.values.length,c=d.model.dataSource,u=0;u<h;u++)c.values[u].fieldName==this._valueFieldName&&(r=t.isNullOrUndefined(c.values[u].summaryType)?"sum":c.values[u].summaryType);e("#"+s+"_fieldnamevaluelabel").text(this._valueFieldName),e("#"+s+"_summarylist").data("ejListBox").selectItemByValue(r),(i=e("#"+n+"_fielddlg_fieldtab").data("ejTab"))&&i._refresh()},_fielddlgOk:function(){for(var i=this.XLObj,r=i.getActiveSheetIndex(),l=i._id+"_fielddlg",n=e("#"+l+"_summarylist").data("ejListBox"),s=i._getContent(r).find(".e-ss-activepivot")[0].id,o=e("#"+s).data("ejPivotGrid"),a=o.model.dataSource,d=a.values.length,h=n.getSelectedItems()[0].text,c=0;c<d;c++)a.values[c].fieldName==this._valueFieldName&&(a.values[c].summaryType=t.PivotAnalysis.SummaryType[h]);o.refreshControl(),e("#"+l).ejDialog("close")},_fielddlgCancel:function(){e("#"+this.XLObj._id+"_fielddlg").ejDialog("close")},_changePvtName:function(){var e=this.XLObj,t=e.element.find("#"+e._id+"_Ribbon_Analyze_PivotTable_PivotTableName").val(),i=e.getActiveSheetIndex(),r=e._getContent(i).find(".e-ss-activepivot")[0].id;e.getSheet(i).pivotMngr.pivot[r].tableName=this.names[r]=t,e._trigActionComplete({pvtName:t,reqType:"shape",shapeType:"pivot",sheetIndex:i,ID:r})},_checkRange:function(e,t){var i,r,l,n,s,o,a,d,h,c,u,g,p,m,_,f=this.XLObj,b=f.getActiveCell(),C=b.rowIndex,S=b.colIndex,x=[],v=f._getContent(f.getActiveSheetIndex()).find(".e-ss-activepivot"),w={isHeader:!1,isRows:!1};if(i=(l=f.XLRibbon._getAddrFromDollarAddr(e))[0],C=(x=f.getRangeIndices(l[1]))[0],S=x[1],e.length)for(n=0,s=x[3]-S+1;n<s;n++)r=f.XLEdit.getPropertyValue(C,S+n,"value",i),(f.isUndefined(r)||""==r)&&(w.isHeader=!0);if(C===x[2]&&(w.isRows=!0),t.length)for(i=(l=f.XLRibbon._getAddrFromDollarAddr(t))[0],x=f.getRangeIndices(l[1]),n=1,s=f.model.sheetCount;n<=s;n++)for(o=f.model.sheets[n].pivotMngr.pivot,d=0,h=(a=f.getObjectKeys(o)).length;d<h;d++)if((!v.length||v.length&&a[d]!==v[0].id)&&(c=f.element.find("#"+a[d]).data("ejPivotGrid"),_=o[a[d]],u=c.getJSONRecords().length/c.rowCount,p=!(g=c.rowCount)||isNaN(g)?_.rowIndex+17:_.rowIndex+g-1,m=!u||isNaN(u)?_.colIndex+2:_.colIndex+u-1,x[0]>=_.rowIndex&&x[0]<=p&&x[1]>=_.colIndex&&x[1]<=m)){w.isOverlap=!0;break}return w},_updateSheetName:function(e){for(var t,i,r,l,n=this.XLObj,s=n.getSheet(n.getActiveSheetIndex()).sheetInfo.text,o=1,a=n.model.sheetCount;o<=a;o++)for(i=n.getSheet(o).pivotMngr.pivot,t=0,l=(r=n.getObjectKeys(i)).length;t<l;t++)i[r[t]].dataSheetName===s&&(i[r[t]].dataSheetName=e)},_getSheetIdxFromName:function(e){for(var t=this.XLObj,i=1,r=t.model.sheetCount;i<=r;i++)if(t.model.sheets[i].sheetInfo.text==e)return i},_changeDataSource:function(){var t,i,r,l,n,s,o=this.XLObj,a=o.getActiveSheetIndex(),d=o._getContent(a).find(".e-ss-activepivot")[0].id,h=e("#"+d).data("ejPivotGrid"),c=h.getOlapReport();r=o.XLRibbon._getAddrFromDollarAddr(e("#"+o._id+"_Ribbon_PvtRange").val()),l=o.model.sheets[r[0]].sheetInfo.text,t=o.getRangeIndices(r[1]),(s=o.getSheet(o.getActiveSheetIndex()).pivotMngr.pivot[d]).dataRange=t,s.dataSheetName=l,n=o.getRangeDataAsJSON({rowIndex:t[0],colIndex:t[1]},{rowIndex:t[2],colIndex:t[3]},!1,r[0]),o.getObjectKeys(h.model.dataSource.data[0]).length!==o.getObjectKeys(n[0]).length&&(c.rows=[],c.columns=[],c.values=[],c.filters=[]),c.data=n,i=e("#"+o._id+"_PivotTableSchema_"+d).data("ejPivotSchemaDesigner"),h.model.dataSource.data=n,this._refreshFieldList(h,i,n),o._trigActionComplete({sheetIndex:a,dataRange:s.dataRange,ID:d,pvtData:n,reqType:"shape",shapeType:"pivot"})},_refreshFieldList:function(i,r,l){for(var n,s=this.XLObj,o=s.getObjectKeys(l[0]),a=0,d=o.length;a<d;a++)n={droppedFieldName:o[a],droppedFieldCaption:o[a],droppedClass:"row",droppedPosition:"",isMeasuresDropped:0==o[a].toLocaleLowerCase().indexOf("measures")},t.Pivot.addReportItem(i.model.dataSource,n);i.refreshPivotGrid(),r.model.pivotControl=i,e(r.element).html(""),r._load(),s._refreshActivationPanel()},_getPivotIDFromName:function(e){for(var t in this.names)if(e===this.names[t])return t},_clearFilters:function(t,i){var r=this.XLObj,l=t.getOlapReport();l.rows=[],l.columns=[],l.values=[],l.filters=[],t.refreshPivotGrid(),i.model.pivotControl=t,e(i.element).html(""),i._load(),r._refreshActivationPanel()},_movePivotTable:function(){var t,i,r,l,n,s,o,a,d,h,c,u=this.XLObj,g=u.getActiveSheetIndex(),p=u._getContent(g).find(".e-ss-activepivot"),m=p[0].id,_=p.data("ejPivotGrid"),f=!0;if(t=u.getSheet(g).pivotMngr.pivot[m],e("#"+u._id+"_dlg_existsheet").data("ejRadioButton").model.checked?(f=!1,i=e("#"+u._id+"_Ribbon_PvtLocation").val().split("!"),r=this._getSheetIdxFromName(i[0]),s=u.getRangeIndices(u.XLRibbon._getAddrFromDollarAddr(i[1])[1]),g!==r&&(u._getContent(r).find(".e-content").append(p),u.gotoPage(r,!1),u.XLSelection._cleanUp(!0),f=!0),t.rowIndex=s[0],t.colIndex=s[1]):(u.insertSheet(),g=u.getActiveSheetIndex(),u._getContent(g).find(".e-content").append(p),s=[2,0]),f&&(o=u.getActiveSheetIndex(),u.getSheet(o).pivotMngr.pivot[m]={},e.extend(!0,u.getSheet(o).pivotMngr.pivot[m],t),o!==g&&delete u.getSheet(g).pivotMngr.pivot[m]),!(n=u.getCell(s[0],s[1]))&&u.model.scrollSettings.allowVirtualScrolling&&(c=u.getSheet(u.getActiveSheetIndex()),u._scrollContent({y:c._rowHeightCollection[s[0]+1]-c._scrollTop}),n=u.getCell(s[0],s[1])),l=n[0],p.css({left:l.offsetLeft-2,top:l.offsetTop-2}),_.getOlapReport().filters.length)for(;t.rowIndex<=_.getOlapReport().filters.length;)t.rowIndex=t.rowIndex+1,l=u.getCell(t.rowIndex,t.colIndex)[0],p.css({left:l.offsetLeft-2,top:l.offsetTop-2});h=_._rowCount,d=_.calculateCellWidths().columnWidths.length,a=[s[0],s[1],s[0]+h,s[1]+d],this._refreshRowColumn(a,_),u._trigActionComplete({sheetIndex:g,newRange:a,ID:m,reqType:"shape",shapeType:"pivot"})}}}(jQuery,Syncfusion),function(e,t){t.spreadsheetFeatures=t.spreadsheetFeatures||{},t.spreadsheetFeatures.sparkLine=function(e){this.XLObj=e,this.rowIdx="",this.colIdx="",this.dRange="",this.location=""},t.spreadsheetFeatures.sparkLine.prototype={createSparkline:function(t,i,r,l,n){var s,o,a,d,h,c,u,g,p,m,_,f,b,C,S,x,v,w,I,y,T,L,R,O,F=this.XLObj,E=!1,D=[],N=[],A=!1,P={};if(F.model.allowSparkline&&!F.model.ReadOnly){if(l=l||{},(""==t||""==i)&&F._showAlertDlg("Alert","EmptyDLRnge",630),n=n||F.getActiveSheetIndex(),p=F.XLRibbon._getAddrFromDollarAddr(t),m=F.XLRibbon._getAddrFromDollarAddr(i),R=F._getSelectedCells(n,p[1])||F._getSelectedCells(),O=F._getSelectedCells(n,m[1])||F._getSelectedCells(),l.highPointColor=l.highPointColor||null,l.lowPointColor=l.lowPointColor||null,l.negativePointColor=l.negativePointColor||null,l.startPointColor=l.startPointColor||null,l.endPointColor=l.endPointColor||null,d=(v=R.range)[2]-v[0]+1,h=v[3]-v[1]+1,c=(w=O.range)[2]-w[0]+1,u=w[3]-w[1]+1,O.range[0]==O.range[2]||O.range[1]==O.range[3])if(R.range[0]==R.range[2]||R.range[1]==R.range[3])if(1==O.selCells.length){for(s=0,S=O.selCells.length;s<S;s++){for(this.rowIdx=O.selCells[s].rowIndex,this.colIdx=O.selCells[s].colIndex,(_=F.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"))&&F._getContent(n).find("#"+_[0]).remove(),x=F._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},n),o=0,L=R.selCells.length;o<L;o++)y=R.selCells[o].rowIndex,T=R.selCells[o].colIndex,"string"==typeof(I=F.XLEdit.getPropertyValue(y,T,"value",n))&&(E=!0),D.push(I),N.push(y,T);g=F._getAlphaRange(n,N[0],N[1],N[N.length-2],N[N.length-1])}E?F._showAlertDlg("Alert","SparklineDataAlert",630):"number"==typeof I&&(P={dataSource:D,type:r,isResponsive:!0,id:(f=this._renderBaseElem(x,r,this.rowIdx,this.colIdx,n))[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:x,DataRange:g,LocationRange:m[1],reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:N,fill:"#33ccff"},f.ejSparkline(e.extend(P,l)),F.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:e.extend(P,l)},"sparkline"),F._isUndoRedo||((b=e.extend(P,l)).sheetIndex=n,F._completeAction(b),F._trigActionComplete(b)),A=!0)}else if(R.selCells.length==O.selCells.length)for(a=0,L=R.selCells.length;a<L;a++)this.rowIdx=O.selCells[a].rowIndex,this.colIdx=O.selCells[a].colIndex,(_=F.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"))&&F._getContent(n).find("#"+_[0]).remove(),x=F._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},n),I=F.XLEdit.getPropertyValue(R.selCells[a].rowIndex,R.selCells[a].colIndex,"value",n),N.push(R.selCells[a].rowIndex,R.selCells[a].colIndex),"string"==typeof I?F._showAlertDlg("Alert","SparklineDataAlert",630):"number"==typeof I&&(f=this._renderBaseElem(x,r,this.rowIdx,this.colIdx,n),g=F._getAlphaRange(n,R.selCells[a].rowIndex,R.selCells[a].colIndex,R.selCells[a].rowIndex,R.selCells[a].colIndex),P={dataSource:[I],type:r,isResponsive:!0,id:f[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:x,DataRange:g,LocationRange:m[1],reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:N,fill:"#33ccff"},f.ejSparkline(e.extend(P,l)),F.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:e.extend(P,l)},"sparkline"),F._isUndoRedo||((b=e.extend(P,l)).sheetIndex=n,F._completeAction(b),F._trigActionComplete(b)),A=!0);else F._showAlertDlg("Alert","SparklineLocAlert",630);else if(d==c||d==u)for(y=R.selCells[0].rowIndex,s=0,S=O.selCells.length;s<S;s++){for(this.rowIdx=O.selCells[s].rowIndex,this.colIdx=O.selCells[s].colIndex,(_=F.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"))&&F._getContent(n).find("#"+_[0]).remove(),x=F._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},n),N=[],o=0;o<h;o++)T=R.selCells[o].colIndex,"string"==typeof(I=F.XLEdit.getPropertyValue(y,T,"value",n))&&(E=!0),D.push(I),N.push(y,T);C=F._getAlphaRange(n,this.rowIdx,this.colIdx,this.rowIdx,this.colIdx),g=F._getAlphaRange(n,N[0],N[1],N[N.length-2],N[N.length-1]),E?F._showAlertDlg("Alert","SparklineDataAlert",630):"number"==typeof I&&(f=this._renderBaseElem(x,r,this.rowIdx,this.colIdx,n)),P={dataSource:D,type:r,isResponsive:!0,id:f[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:x,DataRange:g,LocationRange:C,reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:N,fill:"#33ccff"},f.ejSparkline(e.extend(P,l)),F.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:e.extend(P,l)},"sparkline"),y++,D=[],F._isUndoRedo||((b=e.extend(P,l)).sheetIndex=n,F._completeAction(b),F._trigActionComplete(b)),A=!0}else if(h==c||h==u)for(T=R.selCells[0].colIndex,s=0,S=O.selCells.length;s<S;s++){for(this.rowIdx=O.selCells[s].rowIndex,this.colIdx=O.selCells[s].colIndex,(_=F.XLEdit.getPropertyValue(this.rowIdx,this.colIdx,"sparkline"))&&F._getContent(n).find("#"+_[0]).remove(),x=F._getCellInfo({rowIndex:this.rowIdx,colIndex:this.colIdx},n),y=R.selCells[0].rowIndex,N=[],o=0;o<d;o++)"string"==typeof(I=F.XLEdit.getPropertyValue(y,T,"value",n))&&(E=!0),D.push(I),N.push(y,T),y++;C=F._getAlphaRange(n,this.rowIdx,this.colIdx,this.rowIdx,this.colIdx),g=F._getAlphaRange(n,N[0],N[1],N[N.length-2],N[N.length-1]),E?F._showAlertDlg("Alert","SparklineDataAlert",630):"number"==typeof I&&(f=this._renderBaseElem(x,r,this.rowIdx,this.colIdx,n)),P={dataSource:D,type:r,isResponsive:!0,id:f[0].id,rowIndex:this.rowIdx,colIndex:this.colIdx,cellInfo:x,DataRange:g,LocationRange:C,reqType:"sparkline",shapeType:"sparkline",action:"create",sparklineType:r,range:N,fill:"#33ccff"},f.ejSparkline(e.extend(P,l)),F.XLShape._updateShapeMngr({rowIndex:this.rowIdx,colIndex:this.colIdx},{sparkline:e.extend(P,l)},"sparkline"),T++,D=[],F._isUndoRedo||((b=e.extend(P,l)).sheetIndex=n,F._completeAction(b),F._trigActionComplete(b)),A=!0}else F._showAlertDlg("Alert","SparklineLocAlert",630);else F._showAlertDlg("Alert","SparklineAlert",630);F.model.showRibbon&&A&&this._sparklineDesignTabUpdate(f[0].id),this._wireSparklineEvents("_on")}},_createSparkline:function(e,t,i){var r,l=this.XLObj;i=i||l.getActiveSheetIndex(),l.isImport||l.model.isImport?((r=this._renderBaseElement(t.top,t.left,t.height,t.width,e.rowIndex,e.colIndex,i,e.id)).ejSparkline(e),e.cellInfo=t,e.id=r[0].id,l.XLShape._updateShapeMngr({rowIndex:e.rowIndex,colIndex:e.colIndex},{sparkline:e},"sparkline")):(t=t||e.cellInfo,(r=this._renderBaseElement(t.top,t.left,e.cellInfo.height,e.cellInfo.width,e.rowIndex,e.colIndex,i,e.id)).ejSparkline(e)),this._wireSparklineEvents("_on")},_renderBaseElement:function(t,i,r,l,n,s,o,a){var d,h,c=this.XLObj;return(d=e("<div id='"+a+"' class='e-ss-sparkline'  style='top:"+t+"px; left:"+i+"px; height:"+(r-1)+"px; width:"+l+"px;' ></div>")).data("parentID",c._id),(h=c.getCell(n,s,o)).find('div[id *= "_Merge"]').length?h.find('div[id *= "_Merge"]').prepend(d[0]):h.prepend(d[0]),d},_initSparklineDialog:function(){var e,i,r,l,n,s=this.XLObj;e=t.buildTag("div#"+s._id+"_SparklineDialog"),s.element.append(e),e.append(t.buildTag("div#"+s._id+"_Sparkline.e-dlgctndiv")),l=t.buildTag("div#"+s._id+"sparklineBtnDiv.e-dlg-btnfields"),n=t.buildTag("div.e-dlg-btnctnr"),i=t.buildTag("input#"+s._id+"sparklineDialog_OKBtn","",{},{type:"button"}),r=t.buildTag("input#"+s._id+"sparklineDialog_CancelBtn","",{},{type:"button"}),i.ejButton({text:s._getLocStr("Ok"),showRoundedCorner:!0,width:"25%",click:t.proxy(this._dlgSparklineOk,this),enabled:!0,cssClass:"e-ss-okbtn"}),r.ejButton({text:s._getLocStr("Cancel"),click:t.proxy(this._dlgSparklineCancel,this),showRoundedCorner:!0,width:"25%"}),l.append(n.append(i,r)),e.append(l),e.ejDialog({enableModal:!0,showOnInit:!1,enableResize:!1,allowKeyboardNavigation:!1,title:s._getLocStr("SparklineChart"),width:"auto",cssClass:"e-ss-dialog e-ss-sparklinedlg e-"+s._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_dlgSparklineOk:function(){var t,i,r,l,n,s=this.XLObj,o=s.getActiveSheetIndex(),a=s.getSheet(o),d=e("#"+s._id+"_SparklineDialog");e("#"+s._id+"_Form_Ribbon_SparklineRange").valid()&&e("#"+s._id+"_Form_Ribbon_SparklineLocation").valid()&&(s.XLRibbon._isEditGroupLocationClick?(l=s.XLRibbon._getAddrFromDollarAddr(this.dRange),t=e("#"+s._id+"_Ribbon_SparklineLocation").val(),i=e("#"+s._id+"_Ribbon_SparklineRange").val(),((l[1]==i||l[1].toLowerCase()==i)&&this.location!=t||(l[1]!=i||l[1].toLowerCase()!=i)&&this.location==t||(l[1]!=i||l[1].toLowerCase()!=i)&&this.location!=t)&&(r=s._getContent(o).find("#"+s._id+"_S"+o+"_"+s.XLRibbon._sparklineDesignType+"_"+this.rowIdx+"_"+this.colIdx),n=a.shapeMngr.sparkline[r[0].id].type,delete s._dataContainer.sheets[o][this.rowIdx][this.colIdx],delete a.shapeMngr.sparkline[r[0].id],r.remove(),this.createSparkline(i,t,n),d.ejDialog("close"),s.XLRibbon._isEditGroupLocationClick=!1)):(this.dRange=e("#"+s._id+"_Ribbon_SparklineRange").val(),this.location=e("#"+s._id+"_Ribbon_SparklineLocation").val(),this.createSparkline(this.dRange,this.location,s.XLRibbon._sparklineDesignType)),d.ejDialog("close"))},_dlgSparklineDesignOk:function(){var t,i,r=this.XLObj,l=r.getActiveSheetIndex(),n=e("#"+r._id+"_sparklinedesigndlg");e("#"+r._id+"_Form_datarange").valid()&&(i=r.getAlphaRange(r._getSelectedCells(l).selCells[0].rowIndex,r._getSelectedCells(l).selCells[0].colIndex),t=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline")[0],this.createSparkline(e("#"+r._id+"_datarange").val(),i,r.getSheet(l).shapeMngr.sparkline[t].type),r.XLRibbon._isEditSingleSparklineClick=!1,n.ejDialog("close"))},_dlgSparklineCancel:function(){var t=this.XLObj;e("#"+t._id+"_SparklineDialog").ejDialog("close"),t._setSheetFocus()},_dlgSparklineDesignCancel:function(){var t=this.XLObj;e("#"+t._id+"_sparklinedesigndlg").ejDialog("close"),t._setSheetFocus()},_renderSparklineDialog:function(){var i,r,l,n,s,o,a=this.XLObj;e("#"+a._id+"_Ribbon_SparklineDiv").length<1&&(i=t.buildTag("div.e-dlgctndiv","",{},{id:a._id+"_Ribbon_SparklineDiv"}),l=t.buildTag("table","",{},{cellpadding:0,cellspacing:0}),n=t.buildTag("tr"),(s=t.buildTag("td")).attr("colspan",1),l.append(n.append(s)),n=t.buildTag("tr.e-ss-changerange"),s=t.buildTag("td",""),r=t.buildTag("label"," "+a._getLocStr("DataRange")),s.append(r),n.append(s),s=t.buildTag("td",""),(o=t.buildTag("input.ejinputtext","",{},{id:a._id+"_Ribbon_SparklineRange",type:"text"})).data("parentID",a._id),n.append(s.append(o)),l.append(n),n=t.buildTag("tr"),s=t.buildTag("td"),r=t.buildTag("label",""),s.append(r),s.attr("colspan",2),l.append(n.append(s)),n=t.buildTag("tr"),s=t.buildTag("td"),r=t.buildTag("label"," "+a._getLocStr("LocationRange")),s.append(r),r=t.buildTag("label","  "),s.append(r),n.append(s),s=t.buildTag("td"),(o=t.buildTag("input.ejinputtext","",{},{id:a._id+"_Ribbon_SparklineLocation",type:"text"})).data("parentID",a._id),n.append(s.append(o)),l.append(n),e("#"+a._id+"_Sparkline").append(i.append(l)),e("#"+a._id+"_Ribbon_SparklineLocation").wrap("<form id='"+a._id+"_Form_Ribbon_SparklineLocation' onsubmit='return false'></form>"),a.XLRibbon._dialogValidate("_Ribbon_SparklineLocation"),e("#"+a._id+"_Ribbon_SparklineRange").wrap("<form id='"+a._id+"_Form_Ribbon_SparklineRange' onsubmit='return false'></form>"),a.XLRibbon._dialogValidate("_Ribbon_SparklineRange"))},_tabInsert:function(){var e=this.XLObj;return{text:"Sparkline Charts",id:"SparklineCharts",alignType:t.Ribbon.alignType.rows,content:[{groups:[e.XLRibbon._generateBtn("Insert_Sparkline_Line","LineChart","imageonly","e-icon e-ss-linesparkline",30,e.XLRibbon._smallBtnHeight,"LineSparklineTitle","LineSparklineContent",!1,"ej.ImagePosition.ImageTop"),e.XLRibbon._generateBtn("Insert_Sparkline_Column","ColumnChart","imageonly","e-icon e-ss-columnsparkline",30,e.XLRibbon._smallBtnHeight,"ColumnSparklineTitle","ColumnSparklineContent",!1,"ej.ImagePosition.ImageTop"),e.XLRibbon._generateBtn("Insert_Sparkline_Winloss","Win/Loss Chart","imageonly","e-icon e-ss-winlosssparkline",30,e.XLRibbon._smallBtnHeight,"WinLossSparklineTitle","WinLossSparklineContent",!1,"ej.ImagePosition.ImageTop")]},{groups:[]}]}},_contextualTabInsert:function(){var e=this.XLObj,i=e._id,r="imagetop";return{backgroundColor:"#EAF6BD",borderColor:"#90AA3C",tabs:[{id:"sparklinedesign",text:e._getLocStr("SPARKLINEDESIGN"),groups:[{text:"Sparkline",alignType:t.Ribbon.alignType.columns,content:[{groups:[e.XLRibbon._generateSplitBtn("SparklineDesign_Sparkline_EditData","EditData","textandimage",i+"_Ribbon_SElement","","e-icon e-ss-editdata",!1,65,e.XLRibbon._bigBtnHeight,"bottom",t.ImagePosition.ImageTop,"dropdown","e-spreadsheet e-sparklineeditdatabtn","EditData","EditDataContent")]}]},{text:"Type",alignType:t.Ribbon.alignType.rows,content:[{groups:[e.XLRibbon._generateBtn("SparklineDesign_Line","LineChart","imageonly","e-icon e-ss-linesparkline",30,e.XLRibbon._smallBtnHeight,"LineSparklineTitle","LineSparklineContent",!1,r),e.XLRibbon._generateBtn("SparklineDesign_Column","ColumnChart","imageonly","e-icon e-ss-columnsparkline",30,e.XLRibbon._smallBtnHeight,"ColumnSparklineTitle","ColumnSparklineContent",!1,r),e.XLRibbon._generateBtn("SparklineDesign_Winloss","Win/Loss Chart","imageonly","e-icon e-ss-winlosssparkline",30,e.XLRibbon._smallBtnHeight,"WinLossSparklineTitle","WinLossSparklineContent",!1,r)]},{groups:[]}]},{text:"Show",alignType:t.Ribbon.alignType.rows,type:"custom",contentID:i+"_Ribbon_SparklineDesign_Show"},{text:"Style",alignType:t.Ribbon.alignType.columns,content:[{groups:[e.XLRibbon._generateSplitBtn("SparklineDesign_Style_SparklineColor","SparklineColor","textandimage",i+"_Ribbon_SparklineBorder","","e-icon e-ss-sparklinecolor",!1,140,e.XLRibbon._mediumBtnHeight,"left","","dropdown","e-ss-pictbrdrbtn","SparklineColorTitle","SparklineColorContent"),e.XLRibbon._generateSplitBtn("SparklineDesign_Style_MarkerColor","MarkerColor","textandimage",i+"_Ribbon_MarkerColorBorder","","e-icon e-ss-markercolor",!1,140,e.XLRibbon._mediumBtnHeight,"left","","dropdown","e-ss-markercolorbtn","MarkerColor","MarkerColorContent")]}]}]}]}},_sparklineDlgBox:function(){var t,i,r=this.XLObj,l=r.getActiveSheetIndex(),n=e("#"+r._id+"_SparklineDialog"),s=r.getSheet(l);e("#"+r._id+"_Ribbon_SparklineRange").val(""),e("#"+r._id+"_Ribbon_SparklineLocation").val(""),s._selectedCells.length>=1?(t=s.selectedRange,(i=r.XLEdit.getPropertyValue(r._getSelectedCells().selCells[0].rowIndex,r._getSelectedCells().selCells[0].colIndex,"sparkline"))?e("#"+r._id+"_Ribbon_SparklineRange").val(r.getSheet(l).shapeMngr.sparkline[i].DataRange):e("#"+r._id+"_Ribbon_SparklineRange").val(s.sheetInfo.text+"!$"+r._generateHeaderText(t[1]+1)+"$"+(t[0]+1)+":$"+r._generateHeaderText(t[3]+1)+"$"+(t[2]+1))):r.isUndefined(r.XLEdit.getPropertyValueByElem(r.getActiveCellElem()))||(r.selectAll(!1),e("#"+r._id+"_Ribbon_SparklineRange").val(s.sheetInfo.text+"!$"+r._generateHeaderText(s._startCell.colIndex+1)+"$"+(s._startCell.rowIndex+1)+":$"+r._generateHeaderText(s._endCell.colIndex+1)+"$"+(s._endCell.rowIndex+1))),n.find(".e-ss-changerange").show(),n.data("ejDialog").option("title",r._getLocStr("CreateSparkline")),n.ejDialog("open")},_sparklinDesignDlg:function(){var t=this.XLObj;e("#"+t._id+"_sparklinedesigndlg").ejDialog("open")},_renderSparklineDesignDlg:function(){var i,r=this.XLObj,l=r._getLocStr("SelectDataSource");i="<div id="+r._id+'_sparklinedesigndlg><div class="e-dlg-fields e-dlgctndiv"><table cellspacing="0" cellpadding="0"><tr><td>'+l+'</td></tr><tr><td style="padding-top: 11px;"><input id="'+r._id+'_datarange" class="e-ss-changerange" style="width: 100%;"/></td><tr class="e-dlgtd-fields"><td></td></tr></table></div><div class="e-dlg-btnfields"><div class="e-dlg-btnctnr"><button id='+r._id+"_sparklinedesigndlgok>"+r._getLocStr("Ok")+"</button><button id="+r._id+"_sparklinedesigndlgcancel>"+r._getLocStr("Cancel")+"</button></div></div></div>",r.element.append(i),e("#"+r._id+"_datarange").data("parentID",r._id),e("#"+r._id+"_datarange").wrap("<form id='"+r._id+"_Form_datarange' onsubmit='return false'></form>"),r.XLRibbon._dialogValidate("_datarange"),e("#"+r._id+"_sparklinedesigndlgok").ejButton({showRoundedCorner:!0,width:"20%",click:e.proxy(this._dlgSparklineDesignOk,this)}),e("#"+r._id+"_sparklinedesigndlgcancel").ejButton({showRoundedCorner:!0,width:"20%",click:e.proxy(this._dlgSparklineDesignCancel,this)}),e("#"+r._id+"_sparklinedesigndlg").ejDialog({showOnInit:!1,width:"auto",showRoundedCorner:!0,title:r._getLocStr("EditSingleSparklineData"),enableModal:!0,enableResize:!1,cssClass:"e-ss-dialog e-"+r._id+"-dlg",close:t.proxy(this._dialogClose,this)})},_renderBaseElem:function(t,i,r,l,n){var s,o=this.XLObj;return(s=e("<div id='"+o._id+"_S"+n+"_"+i+"_"+r+"_"+l+"' class='e-ss-sparkline'  style='top:"+t.top+"px; left:"+t.left+"px; height:"+(t.height-1)+"px; width:"+t.width+"px;'></div>")).data("parentID",o._id),o.getCell(this.rowIdx,this.colIdx).prepend(s),o._selectActiveCell(this.rowIdx,this.colIdx),s},_sparklineElementTag:function(){var e=this.XLObj,t="<ul id="+e._id+'_Ribbon_SElement class="selement" style="width: 17%">';return(t+='<li class="editgrouplocation" id="EditGroupLocation"><a><span id="editsparkline" class="e-ss-editdatasparkline" style= margin-top:"0px";></span>'+e._getLocStr("EditDataContent")+"</a><li>")+'<li class="editsinglesparklinedata" id="EditSingleSparklineData"><a>'+e._getLocStr("EditSingleSparklineData")+"</a><li>"},_sparklineColor:function(){var e=this.XLObj;return"<ul id="+e._id+"_Ribbon_SparklineBorder style='width:16%'><li id='"+e._id+"sparklinecolor'><input id='"+e._id+"_Ribbon_SparklineColor' style='display:none; width: 18%'></input></li></ul>"},_markerColor:function(){var e=this.XLObj;return"<ul id="+e._id+"_Ribbon_MarkerColorBorder style='display:none' class='e-ss-pictureborder'><li id='"+e._id+"MarkerNegativePoint'><a>"+e._getLocStr("NegativePoints")+"</a><ul><li><input id='"+e._id+"_Ribbon_MarkerNegativePoint'></input></li></ul></li><li id='"+e._id+"MarkerHighPoint'><a>"+e._getLocStr("HighPoint")+"</a><ul><li><input id='"+e._id+"_Ribbon_MarkerHighPoint'></input></li></ul></li><li id='"+e._id+"MarkerLowPoint'><a>"+e._getLocStr("LowPoint")+"</a><ul><li><input id='"+e._id+"_Ribbon_MarkerLowPoint'></input></li></ul></li></ul>"},_renderSparklineTab:function(){var t,i=this.XLObj,r=i.element,l=i._id+"_Ribbon",n=i._id+"_Ribbon_SparklineDesign_Show";r.append(this._sparklineElementTag()),r.append(this._sparklineColor()),r.append(this._markerColor()),t="<div id="+n+'><div class="e-tablestyleoptionsrow"><div class="e-sparklinedesignshowcell"><input id='+n+'_HighPoint type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+n+'_HighPoint">'+i._getLocStr("HighPoint")+'</label></div><div class="e-sparklinedesignshowcell"><input id='+n+'_FirstPoint type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+n+'_FirstPoint">'+i._getLocStr("FirstPoint")+'</label></div></div><div class="e-tablestyleoptionsrow"><div class="e-sparklinedesignshowcell"><input id='+n+'_LowPoint type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+n+'_LowPoint">'+i._getLocStr("LowPoint")+'</label></div><div class="e-sparklinedesignshowcell"><input id='+n+'_LastPoint type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+n+'_LastPoint">'+i._getLocStr("LastPoint")+'</label></div></div><div class="e-tablestyleoptionsrow"><div class="e-sparklinedesignshowcell"><input id='+n+'_NegativePoints type="checkbox"/><label class="e-tablestyleoptionslabel" for="'+n+'_NegativePoints">'+i._getLocStr("NegativePoint")+'</label></div><div id= "markers" class="e-sparklinedesignshowcell"><input id='+n+'_Markers type="checkbox" /><label class="e-tablestyleoptionslabel" for="'+n+'_Markers">'+i._getLocStr("Markers")+"</label></div></div>",i.element.append(t),e("#"+n+"_HighPoint").ejCheckBox({change:i.XLRibbon._ribbonClickHandler}),e("#"+n+"_FirstPoint").ejCheckBox({change:i.XLRibbon._ribbonClickHandler}),e("#"+n+"_LowPoint").ejCheckBox({change:i.XLRibbon._ribbonClickHandler}),e("#"+n+"_LastPoint").ejCheckBox({change:i.XLRibbon._ribbonClickHandler}),e("#"+n+"_NegativePoints").ejCheckBox({change:i.XLRibbon._ribbonClickHandler}),e("#"+n+"_Markers").ejCheckBox({change:i.XLRibbon._ribbonClickHandler}),e("#"+l+"_SparklineColor").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",open:e.proxy(i.XLRibbon._colorPickerHandler,this,"Ribbon_SparklineDesign_Style_SparklineColor"),change:i.XLRibbon._ribbonClickHandler}),e("#"+l+"_SparklineColor_popup").css({display:"block",height:"135px"}),e("#"+i._id+"sparklinecolor").append(e("#"+l+"_SparklineColor_popup")),e("#"+l+"_SparklineColorWrapper").hide(),e("#"+l+"_MarkerNegativePoint").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:i.XLRibbon._ribbonClickHandler}),e("#"+l+"_MarkerNegativePoint_popup").css({display:"block",height:"135px"}),e("#"+i._id+"MarkerNegativePoint ul li").append(e("#"+l+"_MarkerNegativePoint_popup")),e("#"+l+"_MarkerNegativePointWrapper").hide(),e("#"+l+"_MarkerHighPoint").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:i.XLRibbon._ribbonClickHandler}),e("#"+l+"_MarkerHighPoint_popup").css({display:"block",height:"135px"}),e("#"+i._id+"MarkerHighPoint ul li").append(e("#"+l+"_MarkerHighPoint_popup")),e("#"+l+"_MarkerHighPointWrapper").hide(),e("#"+l+"_MarkerLowPoint").ejColorPicker({modelType:"palette",presetType:"basic",cssClass:"e-ss-colorpicker e-ss-menuclrpkr",change:i.XLRibbon._ribbonClickHandler}),e("#"+l+"_MarkerLowPoint_popup").css({display:"block",height:"135px"}),e("#"+i._id+"MarkerLowPoint ul li").append(e("#"+l+"_MarkerLowPoint_popup")),e("#"+l+"_MarkerLowPointWrapper").hide()},_sparklineDesignTabUpdate:function(t){var i,r,l=this.XLObj,n=l.getSheet(l.getActiveSheetIndex()),s=l._id;i=n.shapeMngr.sparkline,l.model.showRibbon&&((r=e("#"+l._id+"_Ribbon").data("ejRibbon")).showTab(l._getLocStr("SPARKLINEDESIGN")),r._isCollapsed||r.option({selectedItemIndex:l.XLRibbon._getTabIndex("sparklinedesign")}),"Winloss"==i[t].type?(e("#"+s+"_Ribbon_SparklineDesign_Show_FirstPoint").ejCheckBox({enabled:!1}),e("#"+s+"_Ribbon_SparklineDesign_Show_LastPoint").ejCheckBox({enabled:!1}),e("#"+s+"_Ribbon_SparklineDesign_Show_HighPoint").ejCheckBox({enabled:!1}),e("#"+s+"_Ribbon_SparklineDesign_Show_LowPoint").ejCheckBox({enabled:!1}),e("#"+s+"_Ribbon_SparklineDesign_Show_NegativePoints").ejCheckBox({enabled:!1}),e("#"+s+"_Ribbon_SparklineDesign_Show_Markers").ejCheckBox({enabled:!1}),l.element.find("#"+l._id+"_Ribbon_sparklinedesign_Style_SparklineDesign_Style_MarkerColor").hide()):(e("#"+s+"_Ribbon_SparklineDesign_Show_FirstPoint").ejCheckBox({enabled:!0}),e("#"+s+"_Ribbon_SparklineDesign_Show_LastPoint").ejCheckBox({enabled:!0}),e("#"+s+"_Ribbon_SparklineDesign_Show_HighPoint").ejCheckBox({enabled:!0}),e("#"+s+"_Ribbon_SparklineDesign_Show_LowPoint").ejCheckBox({enabled:!0}),e("#"+s+"_Ribbon_SparklineDesign_Show_NegativePoints").ejCheckBox({enabled:!0}),e("#"+s+"_Ribbon_SparklineDesign_Show_Markers").ejCheckBox({enabled:!0}),l.element.find("#"+l._id+"_Ribbon_sparklinedesign_Style_SparklineDesign_Style_MarkerColor").show()),"Column"==i[t].type||"Winloss"==i[t].type?l.element.find("#markers").hide():l.element.find("#markers").show(),l.XLRibbon._isSetModel=!0,e("#"+s+"_Ribbon_SparklineDesign_Show_FirstPoint").data("ejCheckBox").option({checked:!!i[t].FirstPoint}),e("#"+s+"_Ribbon_SparklineDesign_Show_LastPoint").data("ejCheckBox").option({checked:!!i[t].LastPoint}),e("#"+s+"_Ribbon_SparklineDesign_Show_HighPoint").data("ejCheckBox").option({checked:!!i[t].HighPoint}),e("#"+s+"_Ribbon_SparklineDesign_Show_LowPoint").data("ejCheckBox").option({checked:!!i[t].LowPoint}),e("#"+s+"_Ribbon_SparklineDesign_Show_NegativePoints").data("ejCheckBox").option({checked:!!i[t].NegativePoints}),e("#"+s+"_Ribbon_SparklineDesign_Show_Markers").length&&e("#"+s+"_Ribbon_SparklineDesign_Show_Markers").data("ejCheckBox").option({checked:!!i[t].Markers}),l.XLRibbon._isSetModel=!1)},_toggleSparklineDesignTab:function(){var e=this.XLObj;e.XLRibbon._toggleContextualTab(e._getLocStr("SPARKLINEDESIGN"))},_undoForSparkline:function(e){var t,i=this.XLObj,r=i.getSheet(e.sheetIndex),l=i._dataContainer,n=r.shapeMngr.sparkline,s=i._getContent(e.sheetIndex).find("#"+e.id);switch(e.action){case"create":t=s,i.XLEdit.getPropertyValue(e.rowIndex,e.colIndex,"sparkline")&&(t.remove(),n==t[0].id&&delete n[t[0].id],delete n[e.id],delete l.sheets[e.sheetIndex][e.rowIndex][e.colIndex]),e.action="remove";break;case"sparklinehighpoint":i._isUndo?s.ejSparkline({highPointColor:e.prev.sparklinehighpoint}):(s.ejSparkline({highPointColor:e.sparklinehighpoint}),n[e.id].HighPoint=!0,n[e.id].highPointColor=e.sparklinehighpoint);break;case"sparklinenegativepoint":i._isUndo?s.ejSparkline({negativePointColor:e.prev.sparklinenegativepoint}):(s.ejSparkline({negativePointColor:e.sparklinenegativepoint}),n[e.id].NegativePoints=!0,n[e.id].negativePointColor=e.sparklinehighpoint);break;case"sparklinelowpoint":i._isUndo?s.ejSparkline({lowPointColor:e.prev.sparklinelowpoint}):(s.ejSparkline({lowPointColor:e.sparklinelowpoint}),n[e.id].LowPoint=!0,n[e.id].lowPointColor=e.sparklinelowpoint);break;case"sparklinefirstpoint":i._isUndo?s.ejSparkline({startPointColor:e.prev.sparklinefirstpoint}):(s.ejSparkline({startPointColor:e.sparklinefirstpoint}),n[e.id].FirstPoint=!0,n[e.id].startPointColor=e.sparklinefirstpoint);break;case"sparklinelastpoint":i._isUndo?s.ejSparkline({endPointColor:e.prev.sparklinelastpoint}):(s.ejSparkline({endPointColor:e.sparklinelastpoint}),n[e.id].LastPoint=!0,n[e.id].endPointColor=e.sparklinelastpoint);break;case"sparklinetype":i._isUndo?this.changeType(e.id,e.prev.sparklineType,e.sheetIndex):this.changeType(e.prev.sparklineId,e.sparklineType,e.sheetIndex);break;case"sparklinecolor":i._isUndo?s.ejSparkline({fill:e.prev.sColor}):(s.ejSparkline({fill:e.sColor}),n[e.id].sparklineColor=!0,n[e.id].sparklineColor=e.sColor);break;case"remove":this.createSparkline(e.DataRange,e.LocationRange,e.sparklineType,{highPointColor:e.highPointColor,lowPointColor:e.lowPointColor,NegativePointColor:e.NegativePointColor,startPointColor:e.startPointColor,endPointColor:e.endPointColor}),e.action="create";break;case"markerSettings":e.isVisible?(n[e.id].Markers=!0,n[e.id].markerSettings={visible:!0},s.ejSparkline({markerSettings:{visible:!0}})):(n[e.id].Markers=!1,n[e.id].markerSettings={visible:!1},s.ejSparkline({markerSettings:{visible:null}})),e.isVisible=!e.isVisible}},changeType:function(e,t,i){var r,l,n,s,o=this.XLObj;i=o.getActiveSheetIndex(),r=o.getSheet(i),s=o._getContent(i).find("#"+e),n=r.shapeMngr.sparkline[e],s.remove(),delete o._dataContainer.sheets[i][n.rowIndex][n.colIndex],n.type=t,n.id=o._id+"_S"+i+"_"+t+"_"+n.rowIndex+"_"+n.colIndex,this._createSparkline(n,n.cellInfo,i),delete r.shapeMngr.sparkline[e],o.XLShape._updateShapeMngr({rowIndex:n.rowIndex,colIndex:n.colIndex},{sparkline:n},"sparkline"),(l={sheetIndex:i,reqType:"sparkline",action:"sparklinetype",id:n.id,cellInfo:n.cellInfo,rowIndex:n.rowIndex,colIndex:n.colIndex,dataSource:n.dataSource}).prev={sparklineType:n.sparklineType,sparklineId:e},l.sparklineType=t,o._completeAction(l),o._trigActionComplete(l)},changePointColor:function(t,i,r,l){var n,s,o,a,d,h,c,u=this.XLObj;for(h in r=r||u.getActiveSheetIndex(),n=u.getSheet(r),a=u._getContent(r).find("#"+t),o=n.shapeMngr.sparkline,i)d=i[h];switch(h){case"highPointColor":(s={sheetIndex:r,reqType:"sparkline",action:"sparklinehighpoint",id:t}).prev="line"==o[t].type.toLowerCase()?{sparklinehighpoint:a.data("ejSparkline").model.stroke}:{sparklinehighpoint:o[t][h]},l?(o[t].HighPoint=!0,o[t].highPointColor=d):(delete o[t].HighPoint,delete o[t].highPointColor,i={highPointColor:null}),a.ejSparkline(i),s.sparklinehighpoint=d;break;case"lowPointColor":(s={sheetIndex:r,reqType:"sparkline",action:"sparklinelowpoint",id:t}).prev="line"==o[t].type.toLowerCase()?{sparklinelowpoint:a.data("ejSparkline").model.stroke}:{sparklinelowpoint:o[t][h]},l?(o[t].LowPoint=!0,o[t].lowPointColor=d):(delete o[t].LowPoint,delete o[t].lowPointColor,i={lowPointColor:null}),a.ejSparkline(i),s.sparklinelowpoint=d;break;case"startPointColor":(s={sheetIndex:r,reqType:"sparkline",action:"sparklinefirstpoint",id:t}).prev={sparklinefirstpoint:a.data("ejSparkline").model.stroke},l?(o[t].FirstPoint=!0,o[t].startPointColor=d):(delete o[t].FirstPoint,delete o[t].startPointColor,i={startPointColor:null}),a.ejSparkline(i),s.sparklinefirstpoint=d;break;case"endPointColor":(s={sheetIndex:r,reqType:"sparkline",action:"sparklinelastpoint",id:t}).prev={sparklinelastpoint:a.data("ejSparkline").model.stroke},l?(o[t].LastPoint=!0,o[t].endPointColor=d):(delete o[t].LastPoint,delete o[t].endPointColor,i={endPointColor:null}),a.ejSparkline(i),s.sparklinelastpoint=d;break;case"negativePointColor":(s={sheetIndex:r,reqType:"sparkline",action:"sparklinenegativepoint",id:t}).prev="line"==o[t].type.toLowerCase()?{sparklinenegativepoint:a.data("ejSparkline").model.stroke}:{sparklinenegativepoint:o[t][h]},l?(o[t].NegativePoints=!0,o[t].negativePointColor=d):(delete o[t].NegativePoints,delete o[t].negativePointColor,i={negativePointColor:null}),a.ejSparkline(i),s.sparklinenegativepoint=d;break;case"fill":o[t].sparklinecolor=!0,(s={sheetIndex:r,reqType:"sparkline",action:"sparklinecolor",id:t}).sColor=d,"line"==o[t].type.toLowerCase()?(o[t].stroke=d,s.prev={sColor:a.data("ejSparkline").model.stroke},a.ejSparkline("option",{stroke:d})):(o[t][h]=d,s.prev={sColor:a.data("ejSparkline").model.fill},a.ejSparkline("option",{fill:d}));break;case"markerSettings":s={sheetIndex:r,reqType:"sparkline",action:"markerSettings",id:t,isVisible:o[t].Markers},"Line"==o[t].type&&(l?(c={visible:!0},e("#"+t).ejSparkline("option",{markerSettings:{visible:!0}}),o[t].Markers=!0):(c={visible:!1},e("#"+t).ejSparkline("option",{markerSettings:{visible:null}}),o[t].Markers=!1),o[t].markerSettings=c)}u._completeAction(s),u._trigActionComplete(s)},_sparklineResize:function(e,t,i){var r,l,n=this.XLObj,s=n._getContent(i).find("#"+e);s.css(t),(r=s.data("ejSparkline")).model.size=t,r.resize(),(l=n.getSheet(i).shapeMngr.sparkline)[e].cellInfo.width=t.width,l[e].cellInfo.height=t.height},_clearSparkline:function(e){var t=this.XLObj;t.XLSelection._clearBorder(e),t.getSheet(t.getActiveSheetIndex())._isSparklineBorder=!1},refreshSparkline:function(e,t,i){for(var r,l,n,s,o,a,d,h,c=this.XLObj,u=!1,g=1,p=c.model.sheetCount+1;g<p;){if(r=c.getSheet(g).shapeMngr.sparkline,o=c.getObjectLength(r))for(;o--;)if(a=r[c.getObjectKeys(r)[o]],n=c.getRangeIndices(a.DataRange),g===i&&this.XLObj.inRange(n,e,t)){for(d=0,h=(s=c.getRangeData({range:n,valueOnly:!0,sheetIdx:a.sheetIndex,skipFormula:!0})).length;d<h;d++)if(""==(l=s[d]))s[d]=0;else if("string"==typeof l){u=!0;break}u?(c._showAlertDlg("Alert","SparklineDataAlert",630),u=!1):(c._getContent(i).find("#"+a.id).ejSparkline({dataSource:s}),a.dataSource=s)}g++}},_refreshContentWithSparkline:function(t){for(var i,r,l,n,s=this.XLObj,o={},a=e.extend(!0,{},s.getSheet(t).shapeMngr.sparkline),d=s.getObjectKeys(a),h=0,c=d.length;h<c;h++)i=a[d[h]],s._copySheet&&(delete s.getSheet(t).shapeMngr.sparkline[d[h]],(l=d[h].replace(s._id,"").split("_"))[0]=s._id,l[1]="S"+t,n=l.join("_"),i.id=n,o[n]=i,s._dataContainer.sheets[t][i.rowIndex][i.colIndex].sparkline=[n]),s._isRowViewable(t,i.rowIndex)&&(s._getContent(t).find("#"+i.id).length||(r=s._getCellInfo({rowIndex:i.rowIndex,colIndex:i.colIndex},t),this._createSparkline(i,r,t)));s._copySheet&&(s.getSheet(t).shapeMngr.sparkline=o)},_renderSparklineContent:function(t,i){for(var r,l,n,s,o,a=this.XLObj,d=a.getSheet(i).shapeMngr.sparkline,h=a.getObjectKeys(d),c=0,u=h.length;c<u;c++)s=(r=d[h[c]]).rowIndex,o=r.colIndex,l=t.rows[s].cells[o],n=e("<div id='"+a._id+"_S"+i+"_"+r.type+"_"+s+"_"+o+"' class='e-ss-sparkline'  style='height:"+(r.height-1)+"px; width:"+r.width+"px;' ></div>"),e(l).append(n),e(t).find("#"+n[0].id).ejSparkline(r)},_refreshSparklinePos:function(t,i){var r,l,n,s,o,a,d=this.XLObj;for(i=i||d._getSheetIndex(i),a=d._getContent(i).find(".e-ss-sparkline"),t=t||{},r=0,l=a.length;r<l;r++)o=e(a[r]),(s=d._getCellIdx(e(o[0]).parents("td")[0])).rowIndex<t.rowIndex||s.colIndex<t.colIndex||(n=d._getCellInfo({rowIndex:s.rowIndex,colIndex:s.colIndex},i),o.css({top:n.top+"px",left:n.left+"px"}))},_refreshSparklineForInsDel:function(t,i,r,l,n,s){var o,a,d,h=this.XLObj;h._checkIndicesInContainer(s,t,i,"sparkline")&&(a=h.XLEdit.getPropertyValue(t,i,"sparkline",s)[0],o=e.extend(!0,{},h.getSheet(s).shapeMngr.sparkline[a]),d=a.replace(h._id,"").split("_"),"row"===l?d[3]="insert"===n?parseInt(d[3])+r:parseInt(d[3])-r:d[4]="insert"===n?parseInt(d[4])+r:parseInt(d[4])-r,d[0]=h._id,d=d.join("_"),o.id=d,o.rowIndex=t,o.colIndex=i,delete h.getSheet(s).shapeMngr.sparkline[a],h.getSheet(s).shapeMngr.sparkline[d]=o,h._dataContainer.sheets[s][t][i].sparkline=[d])},_refreshSparklineClipboard:function(t,i,r,l,n){var s,o,a=this.XLObj,d=a.XLEdit.getPropertyValue(t,i,"sparkline",r)[0],h=e.extend(!0,{},a.getSheet(l).shapeMngr.sparkline[d]);h=a.XLClipboard._copyBackup.sparkline&&a.XLClipboard._copyBackup.sparkline[d]?a.XLClipboard._copyBackup.sparkline[d]:e.extend(!0,{},a.getSheet(l).shapeMngr.sparkline[d]),(s=d.replace(a._id,"").split("_"))[0]=a._id,s[1]="S"+r,s[3]=t,s[4]=i,s=s.join("_"),h.id=s,h.rowIndex=t,h.colIndex=i,a.getSheet(r).shapeMngr.sparkline[s]=h,a._dataContainer.sheets[r][t][i].sparkline=[s],a._isRowViewable(r,t)&&(a._getContent(r).find("#"+s).length||(o=a._getCellInfo({rowIndex:t,colIndex:i},r),this._createSparkline(h,o,r))),n||delete a.getSheet(l).shapeMngr.sparkline[d]},_removeSparklineElem:function(e,t,i,r){var l,n,s=this.XLObj,o=s.XLEdit.getPropertyValue(e,t,"sparkline",i);o&&(o=o[0],(l=s._getContent(i).find("#"+o)).ejSparkline("destroy"),this._wireSparklineEvents("_off"),n={sheetIndex:i,reqType:"sparkline",shapeType:"sparkline",action:"remove"},s._completeAction(n),s._trigActionComplete(n),l.remove(),r&&(delete s._dataContainer.sheets[i][e][t].sparkline,delete s.getSheet(i).shapeMngr.sparkline[o]))},_wireSparklineEvents:function(t){var i=this.XLObj,r=i.element;i[t](r,e.isFunction(e.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",".e-ss-sparkline",i._dblClickHandler),i[t](e("#svg"),e.isFunction(e.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler),i[t](e("#rect"),e.isFunction(e.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler),i[t](e("#path"),e.isFunction(e.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler),i[t](e("#circle"),e.isFunction(e.fn.doubletap)&&i.model.enableTouch&&parseInt(i._browserDetails.version)>8&&!i._browserDetails.isMSPointerEnabled?"doubletap":"dblclick",i._dblClickHandler)}}}(jQuery,Syncfusion)})},469:function(e,t,i){"use strict";var r=this&&this.__decorate||function(e,t,i,r){var l,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(l=e[o])&&(s=(n<3?l(s):n>3?l(t,i,s):l(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(t,"__esModule",{value:!0});var l=i(5),n=i(78),s=i(1515),o=i(1423),a=i(1421),d=i(1422);t.spreadsheetAppRoutes=[{path:"default",component:o.DefaultComponent,data:{name:"Default",location:"app/components/spreadsheet/default.component"}},{path:"celldatabinding",component:a.CellDataBindingComponent,data:{name:"CellDataBinding",location:"app/components/spreadsheet/celldatabinding.component"}},{path:"conditionalformatting",component:d.ConditionalFormattingComponent,data:{name:"ConditionalFormatting",location:"app/components/spreadsheet/conditionalformatting.component"}},{path:"",redirectTo:"default"}],t.SpreadsheetRouting=n.RouterModule.forChild(t.spreadsheetAppRoutes);var h=function(){function e(){}return e=r([l.NgModule({imports:[t.SpreadsheetRouting],declarations:[o.DefaultComponent,s.EJ_SPREADSHEET_COMPONENTS,a.CellDataBindingComponent,d.ConditionalFormattingComponent]})],e)}();t.SpreadsheetModule=h}});