webpackJsonp([31],{1007:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){}return e.prototype.pivot_data=function(){return[{Amount:100,Country:"Canada",Date:"FY 2005",Product:"Bike",Quantity:2,State:"Alberta"},{Amount:200,Country:"Canada",Date:"FY 2006",Product:"Van",Quantity:3,State:"British Columbia"},{Amount:300,Country:"Canada",Date:"FY 2007",Product:"Car",Quantity:4,State:"Brunswick"},{Amount:150,Country:"Canada",Date:"FY 2008",Product:"Bike",Quantity:3,State:"Manitoba"},{Amount:200,Country:"Canada",Date:"FY 2006",Product:"Car",Quantity:4,State:"Ontario"},{Amount:100,Country:"Canada",Date:"FY 2007",Product:"Van",Quantity:1,State:"Quebec"},{Amount:200,Country:"France",Date:"FY 2005",Product:"Bike",Quantity:2,State:"Charente-Maritime"},{Amount:250,Country:"France",Date:"FY 2006",Product:"Van",Quantity:4,State:"Essonne"},{Amount:300,Country:"France",Date:"FY 2007",Product:"Car",Quantity:3,State:"Garonne (Haute)"},{Amount:150,Country:"France",Date:"FY 2008",Product:"Van",Quantity:2,State:"Gers"},{Amount:200,Country:"Germany",Date:"FY 2006",Product:"Van",Quantity:3,State:"Bayern"},{Amount:250,Country:"Germany",Date:"FY 2007",Product:"Car",Quantity:3,State:"Brandenburg"},{Amount:150,Country:"Germany",Date:"FY 2008",Product:"Car",Quantity:4,State:"Hamburg"},{Amount:200,Country:"Germany",Date:"FY 2008",Product:"Bike",Quantity:4,State:"Hessen"},{Amount:150,Country:"Germany",Date:"FY 2007",Product:"Van",Quantity:3,State:"Nordrhein-Westfalen"},{Amount:100,Country:"Germany",Date:"FY 2005",Product:"Bike",Quantity:2,State:"Saarland"},{Amount:150,Country:"United Kingdom",Date:"FY 2008",Product:"Bike",Quantity:5,State:"England"},{Amount:250,Country:"United States",Date:"FY 2007",Product:"Car",Quantity:4,State:"Alabama"},{Amount:200,Country:"United States",Date:"FY 2005",Product:"Van",Quantity:4,State:"California"},{Amount:100,Country:"United States",Date:"FY 2006",Product:"Bike",Quantity:2,State:"Colorado"},{Amount:150,Country:"United States",Date:"FY 2008",Product:"Car",Quantity:3,State:"New Mexico"},{Amount:200,Country:"United States",Date:"FY 2005",Product:"Bike",Quantity:4,State:"New York"},{Amount:250,Country:"United States",Date:"FY 2008",Product:"Car",Quantity:3,State:"North Carolina"},{Amount:300,Country:"United States",Date:"FY 2007",Product:"Van",Quantity:4,State:"South Carolina"}]},e.prototype.pivot_rows=function(){return[{fieldName:"Country",fieldCaption:"Country"},{fieldName:"State",fieldCaption:"State"}]},e.prototype.pivot_columns=function(){return[{fieldName:"Product",fieldCaption:"Product"}]},e.prototype.pivot_values=function(){return[{fieldName:"Amount",fieldCaption:"Amount"},{fieldName:"Quantity",fieldCaption:"Quantity"}]},e.prototype.pivot_chartvalues=function(){return[{fieldName:"Amount",fieldCaption:"Amount"}]},e.prototype.pivot_Olaprows=function(){return[{fieldName:"[Date].[Fiscal]"}]},e.prototype.pivot_namedsetrows=function(){return[{fieldName:"[Core Product Group]",isNamedSets:!0}]},e.prototype.pivot_gaugerows=function(){return[{fieldName:"[Date].[Fiscal]",filterItems:{filterType:"include",values:["[Date].[Fiscal].[Fiscal Year].&amp;[2004]"]}}]},e.prototype.pivot_gaugecolumns=function(){return[{fieldName:"[Customer].[Customer Geography]",filterItems:{filterType:"include",values:["[Customer].[Customer Geography].[Country].&amp;[Australia]"]}}]},e.prototype.pivot_Olapcolumns=function(){return[{fieldName:"[Customer].[Customer Geography]"}]},e.prototype.pivot_Olapvalues=function(){return[{measures:[{fieldName:"[Measures].[Internet Sales Amount]"}],axis:"columns"}]},e.prototype.pivot_MultipleAxesvalues=function(){return[{measures:[{fieldName:"[Measures].[Internet Sales Amount]"},{fieldName:"[Measures].[Customer Count]"}],axis:"columns"}]},e.prototype.pivot_gaugevalues=function(){return[{measures:[{fieldName:"[Measures].[Internet Sales Amount]"},{fieldName:"[Measures].[Internet Revenue Status]"},{fieldName:"[Measures].[Internet Revenue Trend]"},{fieldName:"[Measures].[Internet Revenue Goal]"}],axis:"columns"}]},e.prototype.pivot_Olapfilters=function(){return[]},e.prototype.pivot_cube=function(){return"Adventure Works"},e.prototype.pivot_datacube=function(){return"//bi.syncfusion.com/olap/msmdpump.dll"},e.prototype.pivot_catelog=function(){return"Adventure Works DW 2008 SE"},e.prototype.size=function(){return{height:"460px",width:"950px"}},e.prototype.primaryYAxis=function(){return{title:{text:"Amount"}}},e.prototype.primaryYAxisOlap=function(){return{title:{text:"Customer Count"}}},e.prototype.primaryXAxis=function(){return{title:{text:"Fiscal Year"},labelRotation:0}},e.prototype.legend=function(){return{visible:!0}},e.prototype.commonSeriesOptions=function(){return{enableAnimation:!0,type:ej.PivotChart.ChartTypes.Column,tooltip:{visible:!0}}},e.prototype.zooming=function(){return{enableScrollbar:!0}},e.prototype.axes=function(){return[{orientation:"vertical",rowIndex:0,majorGridLines:{visible:!1},axisLine:{visible:!0},name:"yAxisConfig",title:{text:"Internet Sales Amount"},opposedPosition:!0,labelFormat:"c"}]},e.prototype.scales=function(){return[{showRanges:!0,radius:150,showScaleBar:!0,size:1,border:{width:.5},showIndicators:!0,showLabels:!0,pointers:[{showBackNeedle:!0,backNeedleLength:20,length:120,width:7},{type:"marker",markerType:"diamond",distanceFromScale:5,placement:"center",backgroundColor:"#29A4D9",length:25,width:15}],ticks:[{type:"major",distanceFromScale:2,height:16,width:1,color:"#8c8c8c"},{type:"minor",height:6,width:1,distanceFromScale:2,color:"#8c8c8c"}],labels:[{color:"#8c8c8c"}],ranges:[{distanceFromScale:-5,backgroundColor:"#fc0606",border:{color:"#fc0606"}},{distanceFromScale:-5}],customLabels:[{position:{x:180,y:290},font:{size:"10px",fontFamily:"Segoe UI",fontStyle:"Normal"},color:"#666666"},{position:{x:180,y:320},font:{size:"10px",fontFamily:"Segoe UI",fontStyle:"Normal"},color:"#666666"},{position:{x:180,y:150},font:{size:"12px",fontFamily:"Segoe UI",fontStyle:"Normal"},color:"#666666"}]}]},e}();t.PivotDataService=l},1009:function(e,t,i){var l,a,r;
/*!
*  filename: ej.olap.base.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.olap.base.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(n){a=[i(4)],void 0===(r="function"==typeof(l=n)?l.apply(t,a):l)||(e.exports=r)}(function(){!function(e,t,i){t.olap=t.olap||{},t.olap.base={_initProperties:function(){this._columnHeaders=[],this._rowHeaders=[],this._valueCells=[],this.pivotEngine=[],this.olapCtrlObj=null,this._cBIndx=null,this._rBIndx=null,this._OlapDataSource,this._measureDt={},this._cTotIndexInfo=null,this._rTotIndexInfo=null,this._kpi=null,this._rowCount=0,this._colCount=0,this._isPaging=!1,this._indexRCell=0,this._indexCCell=0},_initControlProperties:function(e){e._drilledCellSet=e.model.enablePaging||e.model.enableVirtualScrolling?t.isNullOrUndefined(e._drilledCellSet)?[]:e._drilledCellSet:[],e.XMLACellSet=null,e._isMondrian=e.model.dataSource.providerName==t.olap.Providers.Mondrian,(t.isNullOrUndefined(e._fieldData)||!t.isNullOrUndefined(e._fieldData)&&t.isNullOrUndefined(e._fieldData.hierarchy))&&this._getFieldItemsInfo(e),this._currIndex={},this._isRowDrilled=!1,this._isColDrilled=!1,this._isNoSummary="nosummaries"==e.model.layout},getJSONData:function(i,l,a){var r,n,o;i.action&&("initialLoad"==i.action||"navPaging"==i.action)&&(this._initControlProperties(a),this._applyTrim(a)),"loadFieldElements"==i.action&&(a._baseSavedProperties=e.extend(!0,{},{drilledCellSet:a._drilledCellSet,XMLACellSet:a.XMLACellSet,columnHeaders:this._columnHeaders,rowHeaders:this._rowHeaders,valueCells:this._valueCells,pivotEngine:this.pivotEngine,olapCtrlObj:this.olapCtrlObj,cBIndx:this._cBIndx,rBIndx:this._rBIndx,OlapDataSource:this._OlapDataSource,measureDt:this._measureDt,cTotIndexInfo:this._cTotIndexInfo,rTotIndexInfo:this._rTotIndexInfo,kpi:this._kpi,rowCount:this._rowCount,colCount:this._colCount,isPaging:this._isPaging,indexRCell:this._indexRCell,indexCCell:this._indexCCell})),this._initProperties(),this.olapCtrlObj=a,this._OlapDataSource=l,l.data,a.model.enableGroupingBar&&"loadFieldElements"!=i.action&&a._createGroupingBar(l),this._isPaging=!(!this.olapCtrlObj.model.enablePaging&&!this.olapCtrlObj.model.enableVirtualScrolling||t.isNullOrUndefined(this._OlapDataSource.pagerOptions)||0==this._OlapDataSource.pagerOptions.categoricalPageSize||0==this._OlapDataSource.pagerOptions.seriesPageSize),r=l.MDXQuery?l.MDXQuery:this._getParsedMDX(l,l.cube,!(!i.action||"navPaging"==i.action||!this._isPaging||t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions))),o=this._getConnectionInfo(this.olapCtrlObj.model.dataSource.data),n=t.isNullOrUndefined(l.providerName)||l.providerName==t.olap.Providers.SSAS?'<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+r+" </Statement> </Command> <Properties> <PropertyList> <Catalog>"+l.catalog+"</Catalog> <LocaleIdentifier>"+o.LCID+"</LocaleIdentifier> </PropertyList> </Properties></Execute> </Body> </Envelope>":'<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement><![CDATA['+r+"]]></Statement></Command><Properties><PropertyList><DataSourceInfo>"+l.sourceInfo+"</DataSourceInfo><Catalog>"+l.catalog+"</Catalog><AxisFormat>TupleFormat</AxisFormat><Content>Data</Content><Format>Multidimensional</Format></PropertyList></Properties></Execute></SOAP-ENV:Body></SOAP-ENV:Envelope>","drilldown"!=i.action||this._isPaging?this.olapCtrlObj.doAjaxPost("POST",o.url,{XMLA:n},i.action&&"navPaging"!=i.action&&this._isPaging&&!t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)?this._generatePagingData:this._generateJSONData,null,i):this.olapCtrlObj.doAjaxPost("POST",o.url,{XMLA:n},this._onDemandExpand,null,i)},_getParsedMDX:function(e,l,a){var r,n,o,s,d,u;if(e!=i){if(r="",(d=e.providerName==t.olap.Providers.Mondrian)&&0==e.columns.length&&!("columns"==e.values[0].axis&&e.values[0].measures.length>0))return"";n=t.olap._mdxParser._getRowMDX(e),o=t.olap._mdxParser._getcolumnMDX(e),delete e._isCollapse,n=n.length>0?this._isPaging&&!a||d?"("+n+")":"NON EMPTY("+n+")":"",o=o.length>0?this._isPaging&&!a||d?"("+o+")":"NON EMPTY("+o+")":"",!this._isPaging||a||t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)||(n=(u=this._getPagingQuery(n,o)).rowQuery,o=u.columnQuery),s=t.olap._mdxParser._getSlicerMDX(e,this.olapCtrlObj),r="\nSelect \n"+(""==o?"{}":o)+"\ndimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON COLUMNS \n"+(""==n?"":","+n+"\ndimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON ROWS")+"\n "+t.olap._mdxParser._getIncludefilterQuery(e,l,this.olapCtrlObj)+s+"\n CELL PROPERTIES VALUE, FORMAT_STRING, FORMATTED_VALUE \n ",""==o&&r.replace(/NON EMPTY/g," "),r=this._getCalculatedItems(r)}return r},_getCalculatedItems:function(i){var l,a,r=this.olapCtrlObj.model.calculatedMembers;if(r&&r.length>0){for(l="\nWITH",a=0;a<r.length;a++){var n=(r[a].expression.indexOf("Measure")>-1?"[Measures].":r[a].hierarchyUniqueName+".")+"["+(r[a].caption||r[a].name)+"]",o=t.isNullOrUndefined(r[a].formatString)?t.isNullOrUndefined(r[a].format)?null:r[a].format:r[a].formatString;l+="\n MEMBER "+n+" as ("+r[a].expression+" ) "+(t.isNullOrUndefined(o)?"":', FORMAT_STRING ="'+e.trim(o)+'"')}return(l=l.replace(/\&/g,"&amp;"))+" "+i}return i},_getPagingQuery:function(e,t){var i=Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj._categCurrentPage)&&this._colCount>0?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize):this.olapCtrlObj._categCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage),l=Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj._seriesCurrentPage)&&this._rowCount>0?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize):this.olapCtrlObj._seriesCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage),a=e;return{rowQuery:""!=e?"SUBSET({"+(this.olapCtrlObj._isMondrian?"":"NONEMPTY")+"("+e+(this.olapCtrlObj._isMondrian||""==t?"":","+t)+")},"+((0==l?1:l)-1)*this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize+","+this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize+")":"",columnQuery:""!=t?"SUBSET({"+(this.olapCtrlObj._isMondrian?"":"NONEMPTY")+"("+t+(this.olapCtrlObj._isMondrian||""==a?"":","+a)+")},"+((0==i?1:i)-1)*this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize+","+this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize+")":""}},_getAxisElementsUName:function(e){for(var t="",i=0;i<e.length;i++)t+=""==t?"{"+e[i].uniqueName+"}":", {"+e[i].uniqueName+"}";return t},_generatePagingData:function(i,l){var a,r,n;if(e(l).find("Error").length>0)return t.Pivot._createErrorDialog(e(l).find("faultstring").text(),i.action,this.olapCtrlObj),!1;a=e(l).find("Axes, CellData"),this._rowCount=e(a.find("Axis[name|='Axis1']").find("Tuples")).length>0?e(a.find("Axis[name|='Axis1']").find("Tuples")[0]).children().length:0,this._colCount=e(a.find("Axis[name|='Axis0']").find("Tuples")).length>0?e(a.find("Axis[name|='Axis0']").find("Tuples")[0]).children().length:0,r=this._getParsedMDX(this.olapCtrlObj.model.dataSource,this.olapCtrlObj.model.dataSource.cube,!1),n=this._getConnectionInfo(this.olapCtrlObj.model.dataSource.data),this.olapCtrlObj._isMondrian&&(this._controlObj=this.olapCtrlObj),this.olapCtrlObj.doAjaxPost("POST",n.url,{XMLA:t.olap._mdxParser.getSoapMsg(r,this.olapCtrlObj.model.dataSource.data,this.olapCtrlObj.model.dataSource.catalog)},this._generateJSONData,null,i)},_generateJSONData:function(l,a){var r,n,o,s,d,u,c,p,h,g,m,f,_;if(this.olapCtrlObj.model.dataSource=this._OlapDataSource,this._isPaging&&"drilldown"==l.action&&this._onDemandExpand(l,a),r=[],n=[],e(a).find("Error").length>0)return t.Pivot._createErrorDialog(e(a).find("faultstring").text(),"Error",this.olapCtrlObj),!1;if(e(a).find("Axis[name|='SlicerAxis']").remove(),this.olapCtrlObj.XMLACellSet=e(a).find("Axes, CellData"),[],"onDemandDrill"==l&&(this.olapCtrlObj.XMLACellSet=a),o=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple"),s=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple"),o.length>0){if(d=e(this.olapCtrlObj.XMLACellSet[1]).children(),this._rowHeaders=this._getHeaderCollection(s,"rowheader"),this._columnHeaders=this._getHeaderCollection(o,"colheader"),this._valueCells=this._getValueCells(d,o.length),this._indexRCell="rowheader"==this._measureDt.axis?t.sum(this._rowHeaders.maxLvlLen)+1:t.sum(this._rowHeaders.maxLvlLen),this._indexCCell="colheader"==this._measureDt.axis?t.sum(this._columnHeaders.maxLvlLen)+1:t.sum(this._columnHeaders.maxLvlLen),this._rowHeaders.headers.length>0&&0==t.sum(this._rowHeaders.maxLvlLen)&&(this._indexRCell=this._rowHeaders.headers[0].length),this._columnHeaders.headers.length>0&&0==t.sum(this._columnHeaders.maxLvlLen)&&(this._indexCCell=this._columnHeaders.headers[0].length),this._isPaging)for(m=0;m<this._rowHeaders.headers.length;m++)for(_=0;_<this._columnHeaders.headers.length;_++)t.isNullOrUndefined(this._valueCells[m])?(this._valueCells[m]=[],this._valueCells[m][_]={FormatString:"#,#",Value:""}):t.isNullOrUndefined(this._valueCells[m][_])&&(this._valueCells[m][_]={FormatString:"#,#",Value:""});for(this._populateEngine(this._rowHeaders.headers,this._columnHeaders.headers,this._valueCells),e(this.olapCtrlObj).find(".e-pivotGridTable").remove(),this.olapCtrlObj._measureDt=this._measureDt,u=this._rowHeaders.headers.length+this._indexCCell,c=this._columnHeaders.headers.length+this._indexRCell,this.pivotEngine.length>1&&(u=this.pivotEngine.length),m=0;m<u;m++)for(_=0;_<c;_++)r[_]==i&&(r[_]=[]),this.pivotEngine[m]!=i&&this.pivotEngine[m][_]!=i?(r[_][m]={Index:_+","+m,CSS:""==this.pivotEngine[m][_].CSS?"none":this.pivotEngine[m][_].CSS==i?"value":this.pivotEngine[m][_].CSS,Value:this.pivotEngine[m][_].Value,State:this.pivotEngine[m][_].ChildCount>0?2:this.pivotEngine[m][_].ChildCount<0?1:0,RowSpan:this.pivotEngine[m][_].RowSpan!=i?this.pivotEngine[m][_].RowSpan:1,ColSpan:this.pivotEngine[m][_].ColSpan!=i?this.pivotEngine[m][_].ColSpan:1,Info:this.pivotEngine[m][_].UName+"::"+this.pivotEngine[m][_].LName+"::"+this.pivotEngine[m][_].Value+"::"+this.pivotEngine[m][_].PUName,Span:"Block"==this.pivotEngine[m][_].Span?"Block":"None",Expander:1},this.pivotEngine[m][_].kpiInfo&&(r[_][m].kpi=this.pivotEngine[m][_].kpi,r[_][m].kpiInfo=this.pivotEngine[m][_].kpiInfo),this.pivotEngine[m][_].ActualValue&&(r[_][m].ActualValue=this.pivotEngine[m][_].ActualValue,r[_][m].Format=this.pivotEngine[m][_].FormatString)):this.pivotEngine[m]!=i&&(p="none",m<this._indexCCell&&_<this._indexRCell&&(p="rowheader"),r[_][m]={Index:_+","+m,CSS:p,Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"Block",Expander:0});for(m=0;m<c;m++)for(_=0;_<u;_++)r[m]!=i&&r[m][_]!=i&&n.push(r[m][_]);for(h=0,g=0;g<n.length&&0==parseInt(n[g].Index.split(",")[0]);g++)h++}if(this.olapCtrlObj._isExporting&&this.olapCtrlObj.model.enableCompleteDataExport){for(_=0;_<this._indexRCell;_++)for(f="",m=this._indexCCell;m<r[0].length;m++)""!=r[_][m].Info&&(f==r[_][m].Info?r[_][m].Span="Block":f=r[_][m].Info);for(m=0;m<this._indexCCell;m++)for(f="",_=this._indexRCell;_<r.length;_++)""!=r[_][m].Info&&(f==r[_][m].Info?r[_][m].Span="Block":f=r[_][m].Info);this.olapCtrlObj._fullExportedData={jsonObj:n,tranposeEngine:r,rowCount:h},this.olapCtrlObj._drilledCellSet=this.olapCtrlObj._baseSavedProperties.drilledCellSet,this.olapCtrlObj.XMLACellSet=this.olapCtrlObj._baseSavedProperties.XMLACellSet,this._columnHeaders=this.olapCtrlObj._baseSavedProperties.columnHeaders,this._rowHeaders=this.olapCtrlObj._baseSavedProperties.rowHeaders,this._valueCells=this.olapCtrlObj._baseSavedProperties.valueCells,this.pivotEngine=this.olapCtrlObj._baseSavedProperties.pivotEngine,this.olapCtrlObj=this.olapCtrlObj._baseSavedProperties.olapCtrlObj,this._cBIndx=this.olapCtrlObj._baseSavedProperties.cBIndx,this._rBIndx=this.olapCtrlObj._baseSavedProperties.rBIndx,this._OlapDataSource=this.olapCtrlObj._baseSavedProperties.OlapDataSource,this._measureDt=this.olapCtrlObj._baseSavedProperties.measureDt,this._cTotIndexInfo=this.olapCtrlObj._baseSavedProperties.cTotIndexInfo,this._rTotIndexInfo=this.olapCtrlObj._baseSavedProperties.rTotIndexInfo,this._kpi=this.olapCtrlObj._baseSavedProperties.kpi,this._rowCount=this.olapCtrlObj._baseSavedProperties.rowCount,this._colCount=this.olapCtrlObj._baseSavedProperties.colCount,this._isPaging=this.olapCtrlObj._baseSavedProperties.isPaging,this._indexRCell=this.olapCtrlObj._baseSavedProperties.indexRCell,this._indexCCell=this.olapCtrlObj._baseSavedProperties.indexCCell,this.olapCtrlObj._baseSavedProperties={}}else this.olapCtrlObj._pivotRecords={records:n,rowCount:h},"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotGrid"!=this.olapCtrlObj.pluginName?"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotChart"!=this.olapCtrlObj.pluginName&&"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotGauge"!=this.olapCtrlObj.pluginName&&"string"==typeof this.olapCtrlObj.model.dataSource.data&&"ejPivotTreeMap"!=this.olapCtrlObj.pluginName?(this._renderPager(l),this.olapCtrlObj.generateJSON({baseObj:this,tranposeEngine:r,jsonObj:n})):(this.olapCtrlObj.generateJSON({baseObj:this},r),this._isPaging&&this._renderPager(l)):this._renderPivotGrid(l,n),this._columnHeaders=this._rowHeaders=this._valueCells=this.pivotEngine=[],this._cBIndx=this._rBIndx=null,this._measureDt={axis:"",posision:null},this._cTotIndexInfo=this._rTotIndexInfo=null},_renderPager:function(e){var i,l,a,r;this._isPaging&&("navPaging"!=e.action&&(t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)?this.olapCtrlObj.model.enablePaging&&(a={CategoricalCurrentPage:1,CategoricalPageSize:1,SeriesCurrentPage:1,SeriesPageSize:1},r={Column:1,Row:1},this.olapCtrlObj._pagerObj.initPagerProperties(r,a),this.olapCtrlObj._pagerObj.element.css("opacity","0.5"),this.olapCtrlObj._pagerObj.element.find(".e-pagerTextBox").attr("disabled","disabled"),this.olapCtrlObj._pagerObj._unwireEvents()):(i=Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage)?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize)<parseInt(this.olapCtrlObj._categCurrentPage)?Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize):this.olapCtrlObj._categCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage),l=Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)||0==parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage)?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)<parseInt(this.olapCtrlObj._seriesCurrentPage)?Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize):this.olapCtrlObj._seriesCurrentPage:parseInt(this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage),i=0==i?1:i,l=0==l?1:l,this._colCount=0==this._colCount?1:this._colCount,this._rowCount=0==this._rowCount?1:this._rowCount,this.olapCtrlObj.model.enablePaging?(a={CategoricalCurrentPage:i,CategoricalPageSize:this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize,SeriesCurrentPage:l,SeriesPageSize:this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize},r={Column:this._colCount,Row:this._rowCount},this.olapCtrlObj._pagerObj.element.css("opacity","1"),this.olapCtrlObj._pagerObj.element.find(".e-pagerTextBox").removeAttr("disabled"),this.olapCtrlObj._pagerObj._unwireEvents(),this.olapCtrlObj._pagerObj._wireEvents(),this.olapCtrlObj._pagerObj.initPagerProperties(r,a)):this.olapCtrlObj.model.enableVirtualScrolling&&(this.olapCtrlObj._categPageCount=Math.ceil(this._colCount/this.olapCtrlObj.model.dataSource.pagerOptions.categoricalPageSize),this.olapCtrlObj._seriesPageCount=Math.ceil(this._rowCount/this.olapCtrlObj.model.dataSource.pagerOptions.seriesPageSize)),this.olapCtrlObj._categCurrentPage=i,this.olapCtrlObj._seriesCurrentPage=l,t.isNullOrUndefined(this.olapCtrlObj._pivotGrid)||(this.olapCtrlObj._pivotGrid._categCurrentPage=i,this.olapCtrlObj._pivotGrid._seriesCurrentPage=l,this.olapCtrlObj._pivotGrid._categPageCount=this.olapCtrlObj._categPageCount,this.olapCtrlObj._pivotGrid._seriesPageCount=this.olapCtrlObj._seriesPageCount))),t.isNullOrUndefined(this.olapCtrlObj.model.dataSource.pagerOptions)||(this.olapCtrlObj.model.dataSource.pagerOptions.categoricalCurrentPage=this.olapCtrlObj._categCurrentPage,this.olapCtrlObj.model.dataSource.pagerOptions.seriesCurrentPage=this.olapCtrlObj._seriesCurrentPage))},_renderPivotGrid:function(e,i){this.olapCtrlObj._dataModel="XMLA",this.olapCtrlObj.setJSONRecords(JSON.stringify(i)),this.olapCtrlObj.setOlapReport(this.olapCtrlObj.model.dataSource),this._renderPager(e),this.olapCtrlObj.model.enableGroupingBar&&this.olapCtrlObj._createGroupingBar(this.olapCtrlObj.model.dataSource),null!=this.olapCtrlObj.model.layout&&this.olapCtrlObj.layout().toLowerCase()==t.PivotGrid.Layout.ExcelLikeLayout?this.olapCtrlObj.excelLikeLayout(i):this.olapCtrlObj.renderControlFromJSON(i),e.action&&("initialLoad"==e.action||"navPaging"==e.action)&&(this.olapCtrlObj._trigger("renderSuccess",this.olapCtrlObj),this.olapCtrlObj._fieldData={hierarchy:this.olapCtrlObj._fieldData.hierarchy,measures:this.olapCtrlObj._fieldData.measures})},_onDemandExpand:function(t,i){var l,a,r,n,o,s,d,u="",c=this.olapCtrlObj.XMLACellSet,p=e(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis0'] Tuple").length,h=e(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis1'] Tuple").length;h=h||1,e(i).find("CellData Cell").length,e(this.olapCtrlObj.XMLACellSet[1]).children().length,t.cellInfo.previousElements.split(">#>");var g=e(i).find("Axis[name|='Axis0']").find("Tuple"),m=e(i).find("Axis[name|='Axis1']").find("Tuple"),f=g.length;a=m.length,e(i).find("Axis[name='SlicerAxis']").remove();var _,v,b=t.cellInfo.itemPosition,C=0,S=!1,P="";for(v="rowheader"==t.cellInfo.axis?m[0]:g[0],u=_=e(v).find("Member:nth-child("+(b+1)+") PARENT_UNIQUE_NAME").text(),n=b+1;n>0;n--)c=e(c).find("Tuple Member:nth-child("+n+") UName:contains('"+_+"')").parents("tuple"),P=(_=e(v).find("Member:nth-child("+(n-1)+") UName").text())+P;if(u=P+u,r=c.index()+1,u=t.cellInfo.previousElements.split(">#>").join().replace(/,/g,""),l=t.cellInfo.preRepItm.split(">#>").join().replace(/,/g,""),this.olapCtrlObj._drilledCellSet&&(C=this.olapCtrlObj._drilledCellSet.length),u=u+" !#"+t.cellInfo.axis,this.olapCtrlObj._drilledCellSet[0]&&C)for(o=0;o<C;o++){for(s=this.olapCtrlObj._drilledCellSet[o].length,t.cellInfo.parentUniqueName,d=0;d<s;d++){if(t.cellInfo.previousElements.startsWith(this.olapCtrlObj._drilledCellSet[o][d].key)){this.olapCtrlObj._drilledCellSet[o].push({key:u,repItms:l}),S=!0;break}if(this.olapCtrlObj._drilledCellSet[o][d].key.startsWith(t.cellInfo.previousElements)){this.olapCtrlObj._drilledCellSet[o].splice(d,0,{key:u,repItms:l}),S=!0;break}}if(S)break}else this.olapCtrlObj._drilledCellSet[0]=[],this.olapCtrlObj._drilledCellSet[0][0]={key:u,repItms:l},S=!0;S||(this.olapCtrlObj._drilledCellSet[C]=[],this.olapCtrlObj._drilledCellSet[C].push({key:u,repItms:l})),this._isPaging||("rowheader"==t.cellInfo.axis?(e(i).find("Axis[name|='Axis1']").find("Tuple"),this._insertCellSet("rowheader",c,m,g,a,p,f,r,i)):(e(i).find("Axis[name|='Axis1']").find("Tuple"),this._insertCellSet("colheader",c,g,m,h,p,f,r,i)),this._generateJSONData("onDemandDrill",this.olapCtrlObj.XMLACellSet))},_insertCellSet:function(t,i,l,a,r,n,o,s,d){var u,c,p,h,g,m=e(e(d).find("CellData Cell")[0]).clone();e(m).find("FmtValue").text(""),i.length>1?e(i[0]).after(l):e(i).after(l),c=n,"rowheader"==t?u=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple"):(u=e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple"),c=o);var f=0,_=e(u).filter(function(t,i){if(a[f]&&e(i).find("UName").text()==e(a[f]).find("UName").text())return f++,!0}),v=0,b=!1;for(p=0;p<r;p++){var C,S="",P=0,w=0;for(C="rowheader"==t?(s+p)*c:p*(n+c)+s,h=0;h<c;h++)"rowheader"==t&&e(_[P]).index()==h||"colheader"==t&&e(_[v]).index()==p||!u.length?(g="rowheader"==t?p*o:v*o,S=e(e(d).find("CellData Cell")[g+P]).clone(),e(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(C+w)+")").after(S),P++,b=!0):e(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(C+w)+")").after(e(m).clone()),w++;"colheader"==t&&(b&&v++,b=!1)}this._setCellOrdinal(this.olapCtrlObj.XMLACellSet[1])},_clearDrilledCellSet:function(){for(var t,i=e.extend([],this.olapCtrlObj._drilledCellSet),l="",a=0;a<i.length;a++)(l=i[a][0].key.split("!#")).length&&(t=this._getDrilledMemeber({item:{previousElements:l[0]}})),t.length&&this._onDemandCollapse({drilledMembers:t,action:""},l[1])},_onDemandCollapse:function(i,l){e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple"),e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple");try{this.olapCtrlObj.model.dataSource=t.olap._mdxParser._clearCollapsedItems(l,i.drilledMembers[i.drilledMembers.length-1],this.olapCtrlObj.model.dataSource),i.drilledMembers=i.drilledMembers.splice(0,i.drilledMembers.length-1)}catch(e){this.olapCtrlObj._ogridWaitingPopup.hide()}i.drilledMembers.length?this._onDemandCollapse({drilledMembers:i.drilledMembers,action:i.action},l):"collapse"==i.action&&(this.olapCtrlObj.model.dataSource._isCollapse=!0,delete this._currIndex.axis,this.getJSONData({action:"onDemandCollapse"},this.olapCtrlObj.model.dataSource,this.olapCtrlObj))},_removeCellSets:function(t,i,l,a,r,n){for(var o,s,d,u,c,p,h,g=t.length,m=r[0],f=0;f<i.length;f++)if(e(i[f]).find("UName").text()==e(m).find("UName").text()){h=i[f];break}if(o=g,s=e(h).index())if("rowheader"==n){for(p=l.length;o>0;)e(e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1']").find("Tuple")[s]).remove(),o--;for(c=ext=s;c<ext+g;c++)d=e(e(this.olapCtrlObj.XMLACellSet[1]).children()).splice(s*p,p),e(d).remove()}else{for(p=i.length,u=l.length;o>0;)e(e(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0']").find("Tuple")[s]).remove(),o--;for(c=0;c<u;c++)d=e(e(this.olapCtrlObj.XMLACellSet[1]).children()).splice(p*c-c*g+s,g),e(d).remove()}this._setCellOrdinal(this.olapCtrlObj.XMLACellSet[1])},_getDrilledMemeber:function(t){for(var i,l,a=[],r=t.item.previousElements.split(">#>").join().replace(/,/g,""),n=this.olapCtrlObj._drilledCellSet,o=(a=e.map(this.olapCtrlObj._drilledCellSet,function(t){return a=e.map(t,function(e){if(e.key.startsWith(r))return e})}),0);o<n.length;o++)for(i=0,l=n[o];n[o]&&i<n[o].length;i++)l[i]&&l[i].key.startsWith(r)&&(l.splice(i,1),i--,l.length||(n.splice(o,1),o--));return a},_getHeaderCollection:function(t,l){var a,r,n,o,s,d,u,c,p,h,g,m,f=[],_="",v=[],b=null,C={},S={},P=this;if(a=e(t).filter(function(t,i){var a,o,s,d=e(i).find("Member"),u=!("4"==e(d[0]).find("MEMBER_TYPE").text())&&-1!=e(d[0]).find("LName").text().indexOf("[(All)]"),c=u?1:0,p=0;for(b=null,u?(n=0,_="total"):(_="",n=d.length),a=1,-1!=e(d[0]).find("LName").text().toLowerCase().indexOf("[measures]")&&(a=0);a<d.length;a++)o=!1,"colheader"==l&&P._OlapDataSource.columns[a]?(P._OlapDataSource.columns[a].hasAllMember||null!=P._OlapDataSource.columns[a].expression)&&(o=!0):"rowheader"==l&&P._OlapDataSource.rows[a]&&(P._OlapDataSource.rows[a].hasAllMember||null!=P._OlapDataSource.rows[a].expression)&&(o=!0),-1!=e(d[a]).find("LName").text().toLowerCase().indexOf("[measures]")||o?(p=u,S.axis=l,S.posision=a,4==parseInt(e(d[a]).find("MEMBER_TYPE").text())&&(-1!=(s=e(d[a]).find("UName").text().toLowerCase()).indexOf("trend]")?(P._kpi||P._loadKpi(P.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(C=P._isKpi(e(d[a]).find("UName").text(),"trend"))&&(b="trend",S.isKpiExist=!0)):-1!=s.indexOf("status]")?(P._kpi||P._loadKpi(P.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(C=P._isKpi(e(d[a]).find("UName").text(),"status"))&&(b="status",S.isKpiExist=!0)):-1!=s.indexOf("goal]")&&(P._kpi||P._loadKpi(P.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(C=P._isKpi(e(d[a]).find("UName").text()+"::"+e(d[a]).find("Caption").text(),"goal"))&&(b="goal",S.isKpiExist=!0)))):p=-1!=e(d[a]).find("LName").text().indexOf("[(All)]"),(0==u&&1==p||1==u&&0==p)&&(c++,n=a,_="total"),u=p;return r=t,c<2&&f.push({selIndx:r,totLvl:n,type:_,kpi:b,kpiInfo:C}),c<2}).map(function(t,a){for(var r,n,o,s,d=e(a).find("Member"),u=[],c=0;c<d.length;c++)r=!1,n=parseInt(e(d[c]).find("LNum").text()),"colheader"==l&&P._OlapDataSource.columns[c]?P._OlapDataSource.columns[c].hasAllMember||null!=P._OlapDataSource.columns[c].expression?n+=1:r=null!=P._OlapDataSource.columns[c].expression:"rowheader"==l&&P._OlapDataSource.rows[c]&&(P._OlapDataSource.rows[c].hasAllMember||null!=P._OlapDataSource.rows[c].expression?n+=1:r=null!=P._OlapDataSource.rows[c].expression),o=e(d[c]).find("PARENT_UNIQUE_NAME").length?e(d[c]).find("PARENT_UNIQUE_NAME").text():"",u.push({CSS:l,Value:""==e(d[c]).find("Caption").text()?"(Blank)":e(d[c]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:e(d[c]).attr("Hierarchy"),LName:e(d[c]).find("LName").text(),UName:e(d[c]).find("UName").text(),ChildCount:parseInt(e(d[c]).find("CHILDREN_CARDINALITY").text()),PUName:o,isCalcMem:r,LNum:n,MemberType:parseInt(e(d[c]).find("MEMBER_TYPE").text())}),(-1!=e(d[c]).find("LName").text().toLowerCase().indexOf("[measures]")||r)&&f[t].kpi&&(u[u.length-1].kpiInfo=f[t].kpiInfo,u[u.length-1].kpi=f[t].kpi),v[c]==i?v[c]=n:v[c]<n&&(v[c]=n);return(s=[])[0]=u,s}),"colheader"==l?this._cTotIndexInfo=f:this._rTotIndexInfo=f,a={headers:a,indxInfo:f,maxLvlLen:v},e.isEmptyObject(S)||(this._measureDt=e.extend({},S)),1,l.indexOf(this._OlapDataSource.values[0].axis.substring(0,3))>-1&&(this._measureDt.measureCount=this._OlapDataSource.values[0].measures.length),!this._OlapDataSource._enableBasicEngine&&!this._isPaging){var w={headers:[],indxInfo:[]},O=f.length,y=w.length,x=[],M=[];try{for(p=0;p<O;p++)p<O&&"total"==a.indxInfo[p].type&&(w.indxInfo.push(a.indxInfo.splice(p,1)[0]),w.headers.push(a.headers.splice(p,1)[0]),O--,p--);var N=a.headers.length>0?a.headers[0].length:0,T=0,D=0;for(this._measureDt.posision==N-1&&this._measureDt.axis==l&&(D=1),O=a.headers.length,p=0;p<=O;p++){var I=null,L=null,E=null,j=null;for(I=(j=this._updateMemberVariables(a.headers,I,L,E,p)).prev,L=j.next,E=j.cur,j=null,U=N-2-D;U>=0;U--)if(o=this._comparePrevMembers(a.headers,O,p,U,N,-2),p==O||p>0&&(I&&I[U].UName!=E[U].UName||I[U].UName==E[U].UName&&o))if(E&&I[U].UName==E[U].PUName)p-=s=this._removeSubtotalMembers(a,p,U),O-=s,I=(j=this._updateMemberVariables(a.headers,I,L,E,p)).prev,L=j.next,E=j.cur,j=null;else{var A,k=I,V=(y=0,0),R=0;for(I&&(R=I[U].LNum),E&&(V=E[U].LNum),d=!1,u=V;u<=R;u++){for(y=(A=this._getSummaryHeaders(k,w,U,d,D)).headers.length;A.headers.length>0;)a.headers.splice(p,0,A.headers.pop()),a.indxInfo.splice(p,0,A.indexInfo.pop());d=!0,p+=y,O+=y,k=a.headers[p-1]}}if(p==O&&w.headers.length>0){for(c=0;w.headers.length>0;)a.headers.splice(p,0,w.headers.pop()),a.indxInfo.splice(p,0,w.indxInfo.pop()),O++,c++;p+=c}}var U=0,F="";for(x={headers:[],indxInfo:[]},U=N-1-D,O=a.headers.length,p=0;p<O;p++)if(I=this._findPreviousMember(a.headers,p-1,U),p>0&&a.headers[p-1][U].UName!=a.headers[p][U].UName&&U==N-1-D&&v[U]>1){if(p>0&&a.headers[p]!=i&&0!=a.headers[p-1][U].LNum&&a.headers[p-1][U].UName==a.headers[p][U].PUName)for(h=I;h<0;h++)a.indxInfo[p+h].lnum=a.headers[p+h][U].LNum,a.indxInfo[p+h].type="total",x.indxInfo.push(a.indxInfo.splice(p+h,1)[0]),x.headers.push(a.headers.splice(p+h,1)[0]),p+1==O?F=a.headers[p][U].PUName:(p--,O--);0!=p&&a.headers[p]!=i&&a.headers[p-1][U].LNum>a.headers[p][U].LNum&&(g=[],O=(m=this._insertSummaryHeaders(a,x,g,p,U,N,T,F,!1,M)).itmCnt,p=m.hCnt,T=m.insCnt,M[U]=m.subPos)}}catch(e){this.olapCtrlObj._waitingPopup.hide()}}return"rowheader"==l?this._rBIndx=f:this._cBIndx=f,a},_insertSummaryHeaders:function(t,l,a,r,n,o,s,d,u,c){a=[];var p,h,g,m,f,_,v,b="";s=0;for(t.headers[r-1]&&(d=t.headers[r-1][n].PUName),g=t.headers.length,p=t.headers[r][n].LNum,h=t.headers[r-1][n].LNum,m=this._comparePrevMembers(t.headers,g,r,n,o,s),f=p;f<h;f++){for(e.grep(l.headers,function(e,l){(d==e[n].UName||t.headers[r+1+s]!=i&&t.headers[r][n].UName!=t.headers[r+1+s][n].UName&&t.headers[r][n].PUName==e[n].UName&&m)&&(b=e[n].PUName,a.push(l))}),d=b,m&&(a.reverse(),m=!1);a.length>0;){for(_=a.length-1,v=a[a.length-1],t.headers.splice(r,0,l.headers.splice(a[a.length-1],1)[0]),t.indxInfo.splice(r,0,l.indxInfo.splice(a[a.length-1],1)[0]);_>=0;)v<a[_]&&a[_]--,_--;a.pop(),g++,s++,u&&c[n]++}s>0&&(r+=s,s=0)}return{itmCnt:g,hCnt:r,insCnt:s,subPos:c[n]}},_comparePrevMembers:function(e,t,i,l,a,r){var n,o=!1;if(l>0&&i<t&&i+1+r>=0&&i+1+r<t)for(n=l-1;n>=0;n--)e[i][n].UName!=e[i+1+r][n].UName&&(o=!0);return o},_updateMemberVariables:function(e,t,i,l,a){return e[a]&&(l=e[a]),i=e[a+1]?e[a+1]:null,{cur:l,prev:e[a-1]?e[a-1]:null,next:i}},_removeSubtotalMembers:function(e,t,i){for(var l=t-1,a=e.headers[l][i].UName;e.headers[l]&&e.headers[l][i].UName==a;)e.indxInfo.splice(l,1),e.headers.splice(l,1),l--;return t-(l+1)},_getSummaryHeaders:function(t,i,l,a){var r,n=i.headers,o=t,s=l,d=[],u=[],c=i.indxInfo;return r=e.grep(n,function(e,t){for(var i=!1,l=s;l>=0&&(e[l].UName==o[l].UName||a&&l==s&&e[l].UName==o[l].PUName);l--)0==l&&(i=!0,u.push(c[t]));return i}),i.headers=e.grep(n,function(e,t){for(var i=!0,l=s;l>=0&&(e[l].UName==o[l].UName||a&&l==s&&e[l].UName==o[l].PUName);l--)0==l&&(i=!1);return i&&d.push(c[t]),i}),i.indxInfo=d,{headers:r,indexInfo:u}},_drillOrderHeaderCollection:function(t,i,l){var a=i,r=l,n=this;return e(t).map(function(t,i){var l,o,s,d,u=e(a[i.selIndx]).find("Member"),c=[];for(c[0]=[],l=0;l<u.length;l++)o=parseInt(e(u[l]).find("LNum").text()),"colheader"==r&&n._OlapDataSource.columns[l]?n._OlapDataSource.columns[l].hasAllMember&&(o+=1):"rowheader"==r&&n._OlapDataSource.rows[l]&&n._OlapDataSource.rows[l].hasAllMember&&(o+=1),s=e(u[l]).find("PARENT_UNIQUE_NAME").length?e(u[l]).find("PARENT_UNIQUE_NAME").text():"",c[0].push({CSS:r,Value:e(u[l]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:e(u[l]).attr("Hierarchy"),LName:e(u[l]).find("LName").text(),UName:e(u[l]).find("UName").text(),ChildCount:parseInt(e(u[l]).find("CHILDREN_CARDINALITY").text()),PUName:s,LNum:o,MemberType:parseInt(e(u[l]).find("MEMBER_TYPE").text())}),d=c[0][c[0].length-1],i.kpiInfo&&d.UName.toLowerCase().indexOf("[measures]")>-1&&4==d.MemberType&&(c[0][c[0].length-1].kpiInfo=i.kpiInfo),i.kpi&&d.UName.toLowerCase().indexOf("[measures]")>-1&&4==d.MemberType&&(c[0][c[0].length-1].kpi=i.kpi);return c})},_loadKpi:function(e,t,i){i={action:"loadFieldElements"};var l=this._getConnectionInfo(e.data),a='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_KPIS</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+e.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.catalog+"</Catalog></PropertyList></Properties></Discover></Body></Envelope>";this.olapCtrlObj.doAjaxPost("POST",l.url,{XMLA:a},this._loadKpiSuccess,null,i)},_loadKpiSuccess:function(e,t){this._kpi=t},_isKpi:function(t,i){var l=e(this._kpi).find("row:contains("+t.split("::")[0]+")"),a={};return!!l.length&&("trend"==i?(a.Graphic=e(l).find("KPI_TREND_GRAPHIC").text(),a.Value=e(l).find("KPI_NAME").text()):"status"==i?(a.Graphic=e(l).find("KPI_STATUS_GRAPHIC").text(),a.Value=e(l).find("KPI_NAME").text()):"goal"==i&&(a.Caption=t.split("::")[1],a.Value=e(l).find("KPI_NAME").text()),a)},_getValueCells:function(i,l){var a,r,n,o,s,d=this._columnHeaders.headers.length,u=this._rowHeaders.headers.length?this._rowHeaders.headers.length:1,c=0,p=0;if(this._valueCells[c]=[],this._fillAllValueCells(),i=e(this.olapCtrlObj.XMLACellSet[1]).children(),this._OlapDataSource._enableBasicEngine||this._isPaging)for(n=0;n<i.length;n++)p<d&&(this._valueCells[c][p]={ActualValue:e(i[n]).find("Value").text(),Value:e(i[n]).find("FmtValue")[0]?e(i[n]).find("FmtValue").text():"",FormatString:e(i[n]).find("FormatString")[0]?e(i[n]).find("FormatString").text():"",kpi:!t.isNullOrUndefined(this._cBIndx[p])&&this._cBIndx[p].kpi?this._cBIndx[p].kpi:!t.isNullOrUndefined(this._rBIndx[c])&&this._rBIndx[c].kpi?this._rBIndx[c].kpi:""},p++),p==d&&c+1<u&&(p=0,c++,this._valueCells[c]=[]);else for(a=0;a<u;a++)for(r=this._rBIndx.length?this._rBIndx[a].selIndx:0,n=0;n<d;n++)i&&(o=e(i[r*l+this._cBIndx[n].selIndx]),s="",(this._columnHeaders.indxInfo[n]&&"total"==this._columnHeaders.indxInfo[n].type||this._rowHeaders.indxInfo[a]&&"total"==this._rowHeaders.indxInfo[a].type)&&(s="summary"),p<d&&(this._valueCells[a][n]={ActualValue:e(o).find("Value").text(),Value:e(o).find("FmtValue")[0]?this._getFormatedValue(e(o),e(o).find("FormatString")[0]):"",FormatString:e(o).find("FormatString")[0]?e(o).find("FormatString").text():"",kpi:this._cBIndx[n].kpi?this._cBIndx[n].kpi:this._rBIndx[a]?this._rBIndx[a].kpi:"",summary:s,Span:this._isNoSummary&&"summary"==s?"Block":"None"},p++),p==d&&c+1<u&&(p=0,c++,this._valueCells[c]=[]));return this._valueCells},_fillAllValueCells:function(i){var l,a,r,n,o;i=e(this.olapCtrlObj.XMLACellSet[1]).children();if(!t.isNullOrUndefined(i))for(l=!e(i[0]).clone(),e(l).find("FmtValue").text(""),i,a=0;a<i.length;a++)if(r=parseInt(e(i[a]).attr("CellOrdinal")),i[a+1]&&(n=parseInt(e(i[a+1]).attr("CellOrdinal"))),r+1<n)for(o=r+1;o<n;o++)e(i[a]).after(e(l).clone().attr("CellOrdinal",o)[0]);return i},_setCellOrdinal:function(t){for(var i=e(t).find("Cell"),l=0;l<i.length;l++)e(i[l]).attr("CellOrdinal",l)},_getFormatedValue:function(i,l){var a;if(("en-US"==this.olapCtrlObj.model.locale||!e.isNumeric(parseFloat(e(i).find("Value").text())))&&e(i).length>0)a=e(i).find("FmtValue").text();else switch(l=e(l).length>0?e(l).text().toLowerCase():t.isNullOrUndefined(l)?"":l.length>0?l:"",a=e(i).length>0?parseFloat(i.find("Value").text()):i,l){case"decimal":a=parseFloat(t.widgetBase.formatting("{0:D2}",a,this.olapCtrlObj.model.locale));break;case"percent":a=t.widgetBase.formatting("{0:P0}",a,this.olapCtrlObj.model.locale);break;case"number":a=t.widgetBase.formatting("{0:N}",a,this.olapCtrlObj.model.locale);break;case"currency":a=t.widgetBase.formatting("{0:C2}",a,this.olapCtrlObj.model.locale);break;case"date":a=new Date(864e5*(Number(a)-2)+new Date("01/01/1900").getTime()),this._isDateTime(a)&&(a=t.widgetBase.formatting("{0:MM/dd/yyyy}",a,this.olapCtrlObj.model.locale));break;case"scientific":a=Number(a).toExponential(2).replace("e","E");break;case"accounting":a=this._toAccounting(a,"{0:C2}",this.olapCtrlObj.model.locale);break;case"time":a=new Date(864e5*(Number(a)-2)+new Date("01/01/1900").getTime()),this._isDateTime(a)&&(a=t.widgetBase.formatting("{0:h:mm:ss tt}",a,this.olapCtrlObj.model.locale));break;case"fraction":a="numerator"in(a=this._toFraction(a))?a.integer+" "+a.numerator+"/"+a.denominator:a.integer;break;default:a=e(i).find("FmtValue").text()}return a},_isDateTime:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())},_toAccounting:function(e,i,l){var a,r,n,o,s=t.preferredCulture(l).numberFormat.currency.symbol;return val=t.widgetBase.formatting(i,e,this.olapCtrlObj.model.locale),n=val.replace(s,""),!(o=val.indexOf(s))||e<0&&1===o?(a=s,r=Number(e)?n:"-"):(a=Number(e)?n:"-",r=s),a+"   "+r},_toFraction:function(e){if(this._isNumber(e)){var t=e.toString(),i=t.split(".")[0],l=t.split(".")[1];if(!l)return{integer:e};var a=(+l).toString(),r=this._getPlaceValue(l,a),n=this._getGCD(a,r);return{integer:i,numerator:Number(a)/n,denominator:Number(r)/n}}return null},_isNumber:function(e){return e-parseFloat(e)>=0},_getGCD:function(e,t){return e=Number(e),(t=Number(t))?this._getGCD(t,e%t):e},_getPlaceValue:function(e,t){var i=e.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_populateEngine:function(l,a,r){var n,o,s,d,u,c=l.length,p=a.length,h=c?l[0].length:c,g=p?a[0].length:p,m=[],f=r.length,_=r[0].length;try{this.pivotEngine=[];var v,b=[],C=[],S=[],P=!1;for(d=0;d<p;d++)for(this.pivotEngine[d+g]==i&&(this.pivotEngine[d+g]=[]),0==d&&(this.pivotEngine[0]=[],this.pivotEngine[0][0]={CSS:"none",Value:"",ColSpan:this._indexCCell?this._indexCCell:1,RowSpan:this._indexRCell?this._indexRCell:1,HUName:"",LName:"",UName:"",LNum:""}),n=0;n<g;n++)P=!1,this._OlapDataSource.columns&&this._OlapDataSource.columns[n]&&this._OlapDataSource.columns[n].isNamedSets&&(P=!0),this._pivotEngineSpanCalculation("colheader",a,l,this._columnHeaders.maxLvlLen,r,n,d,C,b,this._cTotIndexInfo,P,S);for(v=this.pivotEngine.slice(),this.pivotEngine=[],d=0;d<v.length;d++)if(v[d])for(n=0;n<v[d].length;n++)v[d][n]&&(this.pivotEngine[n]==i&&(this.pivotEngine[n]=[]),this.pivotEngine[n][d]={CSS:v[d][n].CSS,ColSpan:v[d][n].RowSpan,HUName:v[d][n].HUName,LName:v[d][n].LName,LNum:v[d][n].LNum,RowSpan:v[d][n].ColSpan,UName:v[d][n].UName,PUName:v[d][n].PUName,Value:v[d][n].Value,ChildCount:v[d][n].ChildCount,MemberType:v[d][n].MemberType,Span:"Block"==v[d][n].Span?"Block":"None"},v[d][n].kpiInfo&&(this.pivotEngine[n][d].kpiInfo=v[d][n].kpiInfo,this.pivotEngine[n][d].kpi=v[d][n].kpi));var w=[],O=[];S=[];for(d=0;d<c;d++)for(this.pivotEngine[d+this._indexCCell]==i&&(this.pivotEngine[d+this._indexCCell]=[]),n=0;n<h;n++)P=!1,this._OlapDataSource.rows&&this._OlapDataSource.rows[n]&&this._OlapDataSource.rows[n].isNamedSets&&(P=!0),this._pivotEngineSpanCalculation("rowheader",l,a,this._rowHeaders.maxLvlLen,r,n,d,O,w,this._rTotIndexInfo,P,S);for(m=e.extend(!0,[],this.pivotEngine),h="rowheader"==this._measureDt.axis?this._indexRCell+1:this._indexRCell,g=this._indexCCell?this._indexCCell:g,d=0;d<f;d++)for(this.pivotEngine[d+g]!=i&&(h=this.pivotEngine[d+g].length),n=0;n<_;n++)t.isNullOrUndefined(r[d][n])||(this.pivotEngine[d+g]==i&&(this.pivotEngine[d+g]=[]),o=this._setClassName(r[d][n]),r[d][n].CSS=o,o.indexOf("kpiiconvalue")>-1&&("ejPivotGrid"==this.olapCtrlObj.pluginName||"ejPivotClient"==this.olapCtrlObj.pluginName)?r[d][n].Value="":o.indexOf("kpiiconvalue")>-1&&(r[d][n].Value=parseInt(r[d][n].Value)),this.pivotEngine[d+this._indexCCell][n+this._indexRCell]=r[d][n]);if(e.grep(this.pivotEngine,function(e){return e}),this._isPaging){for(t.isNullOrUndefined(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName)||"collapse"!=this.olapCtrlObj._pagingSavedObjects.curDrilledItem.action?t.isNullOrUndefined(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.index)?t.isNullOrUndefined(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName)||(e.each(this.olapCtrlObj._pagingSavedObjects.savedHdrEngine,function(i,l){e.each(l,function(e,l){if(!t.isNullOrUndefined(l)&&l.UName==t.olap.base.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName.split("::")[0].split("amp;").join(""))return t.olap.base.olapCtrlObj._pagingSavedObjects.drillEngine.push(t.olap.base.olapCtrlObj._pagingSavedObjects.savedHdrEngine[i][e]),!1})}),this.olapCtrlObj._pagingSavedObjects.drillEngine[this.olapCtrlObj._pagingSavedObjects.drillEngine.length-1].ChildCount=-1):(this.olapCtrlObj._pagingSavedObjects.drillEngine.push(this.olapCtrlObj._pagingSavedObjects.savedHdrEngine[parseInt(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.index.split(",")[1])][parseInt(this.olapCtrlObj._pagingSavedObjects.curDrilledItem.index.split(",")[0])]),this.olapCtrlObj._pagingSavedObjects.drillEngine[this.olapCtrlObj._pagingSavedObjects.drillEngine.length-1].ChildCount=-1):e.each(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e,i){if(i.UName==t.olap.base.olapCtrlObj._pagingSavedObjects.curDrilledItem.uniqueName.split("::")[0].split("amp;").join(""))return t.olap.base.olapCtrlObj._pagingSavedObjects.drillEngine.splice(e,1),!1}),e.map(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(i){var l=0,a=e.map(t.olap.base.olapCtrlObj.model.dataSource.columns,function(e,a){return t.olap.base.olapCtrlObj._isMondrian?(l=e.fieldName.replace(/\]/g,"").replace(/\[/g,"")==i.HUName.replace(/\[/g," ").replace(/\[/g,"")?a:l,e.fieldName.replace(/\]/g,"").replace(/\[/g,"")==i.HUName.replace(/\[/g," ").replace(/\[/g,"")):(l=e.fieldName==i.HUName?a:l,e.fieldName==i.HUName)});i.CSS=a[l]?"colheader":"rowheader"}),this.olapCtrlObj._pagingSavedObjects.curDrilledItem={},d=this.pivotEngine[0][0].RowSpan-2;d>=0;d--){for("empty",n=1;n<this.pivotEngine[this.pivotEngine[0][0].RowSpan-1].length;n++)t.isNullOrUndefined(this.pivotEngine[d])&&(this.pivotEngine[d]=[]),t.isNullOrUndefined(this.pivotEngine[d+1])||!t.isNullOrUndefined(this.pivotEngine[d][n])||t.isNullOrUndefined(this.pivotEngine[d+1][n])||(this.pivotEngine[d][n]=e.grep(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e){return e.UName==t.olap.base.pivotEngine[d+1][n].PUName})[0],t.isNullOrUndefined(this.pivotEngine[d][n])||(this.pivotEngine[d][n].ColSpan=t.isNullOrUndefined(this.pivotEngine[d][n-1])||this.pivotEngine[d][n-1].UName!=this.pivotEngine[d][n].UName?1:this.pivotEngine[d][n-1].ColSpan+1,this.pivotEngine[d][n].RowSpan=1,this.pivotEngine[d][n].UName));for(s=1,n=this.pivotEngine[this.pivotEngine[0][0].RowSpan-1].length-2;n>0;n--)t.isNullOrUndefined(this.pivotEngine[d])||t.isNullOrUndefined(this.pivotEngine[d][n])||t.isNullOrUndefined(this.pivotEngine[d][n+1])||this.pivotEngine[d][n+1].UName!=this.pivotEngine[d][n].UName?t.isNullOrUndefined(this.pivotEngine[d])||t.isNullOrUndefined(this.pivotEngine[d][n+1])||(this.pivotEngine[d][n+1].ColSpan=1==s?this.pivotEngine[d][n+1].ColSpan:s,s=1):(this.pivotEngine[d][n].ColSpan,this.pivotEngine[d][n+1].ColSpan,s++)}for(d=this.pivotEngine[0][0].RowSpan;d<this.pivotEngine.length;d++)for(u="empty",n=this.pivotEngine[0][0].ColSpan-1;n>=0;n--)t.isNullOrUndefined(this.pivotEngine[d][n])?t.isNullOrUndefined(this.pivotEngine[d-1][n])||this.pivotEngine[d-1][n].UName!=u?(this.pivotEngine[d][n]=e.grep(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e){return e.UName==u})[0],t.isNullOrUndefined(this.pivotEngine[d][n])||(this.pivotEngine[d][n].RowSpan=1,this.pivotEngine[d][n].ColSpan=1,u=this.pivotEngine[d][n].PUName)):(this.pivotEngine[d][n]=e.grep(this.olapCtrlObj._pagingSavedObjects.drillEngine,function(e){return e.UName==u})[0],t.isNullOrUndefined(this.pivotEngine[d][n])||(this.pivotEngine[d][n].RowSpan=this.pivotEngine[d-1][n].RowSpan+1,this.pivotEngine[d][n].ColSpan=1,u=this.pivotEngine[d][n].PUName)):u=this.pivotEngine[d][n].PUName;this.olapCtrlObj._pagingSavedObjects.savedHdrEngine=m}}catch(e){this.olapCtrlObj._waitingPopup.hide()}},_pivotEngineSpanCalculation:function(t,l,a,r,n,o,s,d,u,c,p,h){var g,m,f,_,v,b,C,S,P,w,O,y=l.length,x="",M=a.length,N=y?l[0].length:y,T=M?a[0].length:M;n.length,n[0].length;"rowheader"==t?(T=this._indexCCell?this._indexCCell:T,x="row"):(T=this._indexRCell?this._indexRCell:T,x="col"),m=0,p&&(l[s][o].ChildCount=0),this._measureDt.axis==t&&this._measureDt.posision==N-1&&(m=1),d[o]||(d[o]=[]),this._isNoSummary&&!h[o]&&(h[o]=[]),this.pivotEngine[s+T]||(this.pivotEngine[s+T]=[]),u[o]=s;var D=r[o]?r[o]:1,I=0,L=0;for(f=0;f<o;f++)r[f]&&(I+=r[f]-1,L+=r[f]);if(!this._OlapDataSource._enableBasicEngine||this._OlapDataSource._checkSummaryHeaders)for(_=1;_<=D;_++){var E,j=!1,A=l[s][o].LNum;if(d[o][_]==i&&(d[o][_]=0),this._isNoSummary&&h[o][_]==i&&(h[o][_]=0),l[s-1]&&d[o][A]&&(0!=l[s][o].LNum&&l[s-1][o].PUName==l[s][o].UName||o+m==N-1&&l[s-1][o].LNum<l[s][o].LNum)&&(v=d[o][A],this._isNoSummary&&(v+=h[o][A],h[o][A]=0),this.pivotEngine[s+T-v][o+A-1+I]=l[s][o],o+m!=N-1&&(this.pivotEngine[s+T][o+A-1+I]=e.extend({},l[s][o]),this._isNoSummary&&(this.pivotEngine[s+T][o+A-1+I].Span="Block")),this._isNoSummary&&(this.pivotEngine[s+T-v][o+A-1+I].RowSpan=0),p||(this.pivotEngine[s+T-v][o+A-1+I].ChildCount=-1),this.pivotEngine[s+T-v][o+A-1+I].ColSpan=1,this.pivotEngine[s+T-v][o+A-1+I].RowSpan+=d[o][A],this._drilledJSONData(s+T-v,s+T,o+A-1+I,l[s][o]),d[o][A]=0,o+m==N-1&&l[s-1][o].LNum>l[s][o].LNum)){for(b=r[o]-A,C=this._findNextMember(l,s,o),S=0;S<C;S++)this.pivotEngine[s+T+S]||(this.pivotEngine[s+T+S]=[]),this.pivotEngine[s+T+S][o+I+A]={CSS:"summary "+x,Value:"Total",ColSpan:b,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:"",Span:this._isNoSummary?"Block":"None"};this._isNoSummary||(this.pivotEngine[s+T-v][o+A-1+I].RowSpan+=C-1)}if(l[s][o].LNum>_&&(!this._isNoSummary||"total"!=c[s].type)?d[o][_]++:l[s][o].LNum>_&&this._isNoSummary&&"total"==c[s].type&&h[o][_]++,E=s+T,_==l[s][o].LNum&&0==s&&l[s][o].LNum>1)this.pivotEngine[E]||(this.pivotEngine[E]=[]),this.pivotEngine[E][o+_-1+I]=l[s][o],(!(l[s+1]!=i&&l[s][o].LNum<l[s+1][o].LNum)||o+m==N-1&&l[s+1]&&l[s][o].LNum<l[s+1][o].LNum)&&(this.pivotEngine[E][o+_-1+I].ColSpan+=r[o]-this.pivotEngine[E][o+_-1+I].LNum);else if(0!=s&&l[s][o].LNum>1&&_==l[s][o].LNum&&l[s-1][o].UName!=l[s][o].UName&&l[s-1][o].PUName!=l[s][o].UName)this.pivotEngine[E]==i&&(this.pivotEngine[E]=[]),this.pivotEngine[E][o+_-1+I]=l[s][o],(!(l[s+1]!=i&&l[s][o].LNum<l[s+1][o].LNum)||o+m==N-1&&l[s+1]&&l[s][o].LNum<l[s+1][o].LNum)&&(this.pivotEngine[E][o+_-1+I].ColSpan+=r[o]-this.pivotEngine[E][o+_-1+I].LNum);else if(0!=s&&_==l[s][o].LNum&&l[s-1][o].UName==l[s][o].UName)this._isNoSummary&&"total"==c[s].type?this._isNoSummary&&"total"==c[s].type&&h[o][_]++:d[o][_]++,this.pivotEngine[s+T][o+_-1+I]=l[s][o],this._isNoSummary&&"total"==c[s].type&&(this.pivotEngine[s+T][o+_-1+I].Span="Block"),(l[s+1]!=i&&l[s+1][o].UName!=l[s][o].UName||s+1==y&&d[o][_]>0)&&(P=d[o][_],w=l[s][o].LNum,this._isNoSummary&&(P+=h[o][_],h[o][_]=0),P&&this.pivotEngine[s+T-P][o+w-1+I]!=i&&this.pivotEngine[s+T-P][o+w-1+I].Value!=i&&(this.pivotEngine[s+T-P][o+w-1+I].RowSpan+=d[o][_],this._drilledJSONData(s+T-P,s+T,o+w-1+I,l[s][o])),d[o][_]=0);else if(l[s][o].LNum<2&&(_==l[s][o].LNum||0==l[s][o].LNum)||l[s][o].LNum<_&&l[s-1]&&l[s][o].LNum<l[s-1][o].LNum&&"total"==c[s].type&&this._measureDt.axis==t)if(_-1,l[s-1]&&l[s-1][o].UName==l[s][o].UName&&l[s][o].LName.toLowerCase().indexOf("[measures]")>-1&&(this.pivotEngine[s+T][o+_-1+I]=e.extend({},l[s][o]),this._measureDt.measureCount>1&&t==this._measureDt.axis||this._isNoSummary&&"total"==c[s].type?this._measureDt.measureCount>1&&t==this._measureDt.axis||!this._isNoSummary||"total"!=c[s].type||h[o][_]++:d[o][_]++,this._isNoSummary&&"total"==c[s].type&&(this.pivotEngine[s+T][o+_-1+I].Span="Block")),-1!=l[s][o].UName.indexOf("Measures")&&this._isPaging||"total"==c[s].type)if("total"==c[s].type&&-1==l[s][o].LName.toLowerCase().indexOf("[measures]")&&l[s][o].LNum!=_&&0!=r[o]){if((l[s][o-1]&&-1==l[s][o-1].LName.toLowerCase().indexOf("[measures]")||this._measureDt.axis!=t)&&(o>c[s].totLvl||o==N-1&&_>c[s].totLvl&&0!=c[s].totLvl||0==c[s].totLvl&&_-1>c[s].totLvl))break;for(var k=1,V=1,R=0;l[s-V][o]&&0==l[s-V][o].LNum&&!l[s][o].LName.toLowerCase().indexOf("[measures]")>-1;)l[s][o-1]&&l[s-V+1][o-1].UName!=l[s-V][o-1].UName&&R++,V++;0==l[s][o].LNum&&!l[s][o].LName.toLowerCase().indexOf("[measures]")>-1&&(O=0,0,s>0&&o>0&&l[s][o].LName.indexOf("(All)")>-1&&l[s][o-1]&&r[o-1]>1&&(O=this._findPreviousMember(l,s,o-1)),0!=s&&l[s][o-1]&&r[o-1]>1&&l[s+O]&&l[s][o-1].LNum<l[s+O][o-1].LNum&&(R=r[o-1]-l[s][o-1].LNum),"rowheader"==t?(k=this._indexRCell-L+R,this._indexRCell-k):"colheader"==t&&(k=this._indexCCell-L+R,this._indexCCell-k),(1!=r.length&&o==N-1||r.length>1&&o<N-1)&&(j=!0),this._measureDt.axis==t&&(k-=1),1,0!=s&&l[s][o-1]&&l[s][o-1].LNum+1,1,O=s+T,this.pivotEngine[s+T][o+_-1+I-R]={CSS:"summary "+x,Value:"Total",ColSpan:k,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:"",Span:this._isNoSummary?"Block":"None"})}else-1!=l[s][o].LName.toLowerCase().indexOf("[measures]")?(l[s-1]&&l[s-1][o].UName==l[s][o].UName||(this.pivotEngine[s+T][o+_-1+I]=e.extend({},l[s][o]),this._isNoSummary&&"total"==c[s].type&&(this.pivotEngine[s+T][o+_-1+I].Span="Block")),(l[s-1]&&l[s-1][o].UName!=l[s][o].UName||s+1==y)&&(g=d[o][_],this._isNoSummary&&(g+=h[o][_],h[o][_]=0),g&&this.pivotEngine[s+T-g][o+_-1+I]!=i&&(this.pivotEngine[s+T-g][o+_-1+I].RowSpan+=d[o][_],this._drilledJSONData(s+T-g,s+T,o+_-1+I,l[s][o])),d[o][_]=0)):"total"==c[s].type&&1==l.length&&(this.pivotEngine[s+T][o+_-1+I]={CSS:"summary "+x,Value:"Total",ColSpan:1,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:"",Span:this._isNoSummary?"Block":"None"});else l[s-1]&&l[s-1][o].UName==l[s][o].UName||(this.pivotEngine[s+T][o+_-1+I]=l[s][o],g=d[o][_],this._isNoSummary&&(g+=h[o][_],h[o][_]=0),g&&this.pivotEngine[s+T-g][o+_-1+I]!=i&&(this.pivotEngine[s+T-g][o+_-1+I].RowSpan+=d[o][_],this._drilledJSONData(s+T-g,s+T,o+_-1+I,l[s][o])),d[o][_]=0),0==!l[s][o].LNum&&(!(l[s+1]!=i&&l[s][o].LNum<l[s+1][o].LNum)||o+m==N-1&&l[s+1]&&l[s][o].LNum<l[s+1][o].LNum)&&this.pivotEngine[s+T][o+_-1+I]&&(this.pivotEngine[s+T][o+_-1+I].ColSpan+=r[o]-this.pivotEngine[s+T][o+_-1+I].LNum);if(j)break}else this.pivotEngine[s+T][o]=l[s][o]},_findNextMember:function(e,t,i){for(var l=0;e[t+l]&&e[t][i].UName==e[t+l][i].UName;)l++;return l},_findPreviousMember:function(e,t,i){for(var l=-1;e[t+l]&&e[t][i].UName==e[t+l][i].UName;)l--;return l},_drilledJSONData:function(t,i,l,a){for(var r=t+1;r<i;r++)this.pivotEngine[r][l]=e.extend({},a),this._isNoSummary&&(this.pivotEngine[r][l].Span="Block")},_setClassName:function(e){var t=parseInt(e.Value),i="value";if(e.kpi)if("trend"==e.kpi)switch(t){case-1:i="value kpiiconvalue kpidownarrow";break;case 0:i="value kpiiconvalue kpirightarrow";break;case 1:i="value kpiiconvalue kpiuparrow"}else if("status"==e.kpi)switch(t){case-1:i="value kpiiconvalue kpidiamond";break;case 0:i="value kpiiconvalue kpitriangle";break;case 1:i="value kpiiconvalue kpicircle"}return e.summary+" "+i},_getFieldItemsInfo:function(e){var t=this._getConnectionInfo(e.model.dataSource.data),i='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_HIERARCHIES</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+e.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.model.dataSource.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+t.LCID+"</LocaleIdentifier></PropertyList></Properties></Discover></Body></Envelope>";e.doAjaxPost("POST",t.url,{XMLA:i},this._getHierarchyInfo,null,{pvtGridObj:e,action:"loadFieldElements"})},_getHierarchyInfo:function(t,i){for(var l,a,r=[],n=t.pvtGridObj,o=this._getConnectionInfo(n.model.dataSource.data),s=0;s<e(i).find("row").length;s++)l=e(e(i).find("row")[s]),r.push({pid:l.find("DIMENSION_UNIQUE_NAME").text(),id:l.find("HIERARCHY_UNIQUE_NAME").text(),name:l.find("HIERARCHY_CAPTION").text(),tag:l.find("HIERARCHY_UNIQUE_NAME").text(),hasAllMember:0==l.children("ALL_MEMBER").length});n._fieldData={hierarchy:r,hierarchySuccess:i,measures:[]},o.LCID.indexOf("1033")>=0&&!n.model.enableDrillThrough||(a='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASURES</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+n.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+n.model.dataSource.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+n.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+o.LCID+"</LocaleIdentifier> </PropertyList></Properties></Discover></Body></Envelope>",n.doAjaxPost("POST",o.url,{XMLA:a},this._getMeasureInfo,null,{pvtGridObj:n,action:"loadFieldElements"}))},_getMeasureInfo:function(t,i){for(var l=[],a=0;a<e(i).find("row").length;a++){var r=e(e(i).find("row")[a]),n=r.children("MEASUREGROUP_NAME").text(),o=r.find("MEASURE_UNIQUE_NAME").text();l.push({id:o,pid:n,name:r.children("MEASURE_CAPTION").text(),tag:o})}t.pvtGridObj._fieldData.measures=l,t.pvtGridObj._fieldData.measureSuccess=i},_getConnectionInfo:function(t){var i={url:"",LCID:"1033"};return""!=t&&e.map(t.split(";"),function(e){e.toLowerCase().indexOf("locale")<0&&0==i.url.length?i.url=e:e.toLowerCase().indexOf("locale")>=0&&(i.LCID=e.replace(/ /g,"").split("=")[1])}),i},_applyTrim:function(l){var a=[],r=l.model.dataSource,n=this;l._fieldData&&l._fieldData.measures&&l._fieldData.hierarchy?(e.merge(a,l._fieldData.hierarchy),e.merge(a,l._fieldData.measures)):!l._fieldData||!l._fieldData.hierarchy||l._fieldData.hierarchy,r.rows=e.map(r.rows,function(l){if(!t.isNullOrUndefined(l)&&l.fieldName!=i)return l.fieldName=e.trim(l.fieldName),n._getCaption(l,a)}),r.columns=e.map(r.columns,function(l){if(!t.isNullOrUndefined(l)&&l.fieldName!=i)return l.fieldName=e.trim(l.fieldName),n._getCaption(l,a)}),r.filters=e.map(r.filters,function(l){if(!t.isNullOrUndefined(l)&&l.fieldName!=i)return l.fieldName=e.trim(l.fieldName),n._getCaption(l,a)}),r.values=r.values.length>0&&r.values[0].measures!=i?r.values:[{measures:[],axis:"columns"}],r.values[0].measures=e.map(r.values[0].measures,function(l){if(!t.isNullOrUndefined(l)&&l.fieldName!=i)return l.fieldName=e.trim(l.fieldName),n._getCaption(l,a)}),l.model.dataSource=r},_getCaption:function(l,a){var r=l.fieldName,n=[];return t.isNullOrUndefined(l.fieldCaption)&&(a.length>0?(n=e.map(a,function(t){if(t.tag!=i&&t.tag.toLowerCase()==e.trim(r.toLowerCase()))return t}),r.toLowerCase().indexOf("[measures]")>=0&&0==n.length&&r.split(".[").length>0?l.fieldCaption=r.split(".[")[1].replace(/]/g,""):n.length>0&&(l.hasAllMember=!!n[0].hasAllMember,l.fieldCaption=n[0].name)):0==n.length&&(l.fieldCaption=r)),l},clearDrilledItems:function(l,a,r){var n=a.action;return l.rows=e.grep(l.rows,function(e){return e.filterItems!=i&&"filtering"!=n&&delete e.filterItems,e.filterItems!=i&&"advancedFilter"!=n&&delete e.advancedFilter,e.drilledItems!=i&&delete e.drilledItems,e._prevDimElements!=i&&delete e._prevDimElements,e}),l.columns=e.grep(l.columns,function(e){return e.filterItems!=i&&"filtering"!=n&&delete e.filterItems,e.filterItems!=i&&"advancedFilter"!=n&&delete e.advancedFilter,e.drilledItems!=i&&delete e.drilledItems,e._prevDimElements!=i&&delete e._prevDimElements,e}),l.filters=e.grep(l.filters,function(e){return e.filterItems!=i&&"filtering"!=n&&delete e.filterItems,e.filterItems!=i&&"advancedFilter"!=n&&delete e.advancedFilter,e.drilledItems!=i&&delete e.drilledItems,e._prevDimElements!=i&&delete e._prevDimElements,e}),"filtering"!=n&&(r._currentReportItems=e.map(r._currentReportItems,function(e){if(!t.isNullOrUndefined(e.dataSrc)){if(e.dataSrc.cube!=l.cube)return e;if(e.dataSrc.reportName!=l.reportName)return e}}),t.isNullOrUndefined(r._schemaData)||r._schemaData.element.find(".filter").remove(),r._savedReportItems=e.extend(!0,[],r._currentReportItems)),t.olap.base._clearDrilledCellSet(),l}},t.olap._mdxParser={_getRowMDX:function(l){var a,r,n=e(l)[0].rows,o="",s="",d=[],u=!1,c=!1,p=l._isCollapse,h=l.values.length>0&&l.values[0].measures!=i&&l.values[0].axis==t.olap.AxisName.Row;if(t.isNullOrUndefined(l.providerName)||l.providerName==t.olap.Providers.SSAS){if(n.length>0){for(c=!t.isNullOrUndefined(n[0].drillCellInfo),a=0;a<n.length;a++){var g=!(t.isNullOrUndefined(n[a].isNamedSets)||!n[a].isNamedSets),m="",f="";n[a].fieldName==i||g?g&&(o=a>0?o+"*{"+n[a].fieldName+"}":"{"+n[a].fieldName+"}"):(m=this._getDimensionQuery(n[a],l,"rows",a,!1),d.push(m.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"").replace(/\levels0/g,"levels(0)")),t.olap.base._isPaging&&c&&(f=this._getDimensionQuery(n[a],l,"rows",a,!0)),n[a].sortOrder&&n[a].sortOrder!=t.olap.SortOrder.None?(r=n[a].sortOrder==t.olap.SortOrder.Ascending?"asc":"desc",u=!0,o=o+(a>0?"*":"")+"{ORDER({HIERARCHIZE({"+(t.olap.base._isPaging&&c?f:m)+"})},"+n[a].fieldName+".CurrentMember.MEMBER_CAPTION,"+r+")}"):o=o+(a>0?"*":"")+"{HIERARCHIZE({({"+(t.olap.base._isPaging&&c?f:m)+"})})}")}t.olap.base._isPaging&&this._updateOlapReport(e(l)[0].rows,o,"rows",d),p&&(u=p),o=(u?" ":" HIERARCHIZE ")+"( {"+(t.olap.base._isPaging?o:this._updateOlapReport(e(l)[0].rows,o,"rows",d))+"})",p&&(o="HIERARCHIZE("+o+")")}h&&(s=t.olap._mdxParser._getMeasuresQuery(l),o=""!=o?(t.olap.base._isPaging?o.slice(0,-1):o)+(""!=o&&""!=s?t.olap.base._isPaging?"*":",":"")+s:(t.olap.base._isPaging&&""!=s?"(":"")+s),t.olap.base._isPaging&&(o=""!=o?""==s?("}"!=o[o.length-1]?o.slice(0,-1):o)+this._getDrilledSection(l,e.extend(!0,{},n),"row",s)+")":o+this._getDrilledSection(l,e.extend(!0,{},n),"row",s)+")":"")}else o=this._generateAxisMDXOnMondrian(l,n,h);return o},_generateAxisMDXOnMondrian:function(e,i,l){for(var a,r,n="",o=0;o<i.length;o++)a=t.olap.base._isPaging?"({"+i[o].fieldName+".children})":"DrillDownLevel({"+i[o].fieldName+"})",!t.isNullOrUndefined(i[o].drilledItems)&&i[o].drilledItems.length>0&&(a=this._getDrilledMDXOnMondrian(i[o].drilledItems,a)),!t.isNullOrUndefined(i[o].filterItems)&&!t.isNullOrUndefined(i[o].filterItems.values)&&i[o].filterItems.values.length>0&&(a="({{hierarchize(Union(Intersect((Except("+("Descendants("+i[o].fieldName+","+e._maxLevel+", SELF_AND_BEFORE)")+","+(r="{"+i[o].filterItems.values.join()+"}")+")),"+a+"),Except("+a+","+r+")))}})"),n+=(""==n?"":"*")+a;return l&&(n+=(""==n?"":"*")+t.olap._mdxParser._getMeasuresQuery(e)),n},_getDrilledMDXOnMondrian:function(e,i){for(var l=0;l<e.length;l++)i=t.olap.base._isPaging?"Except(DrillDownMember("+i+", {"+e[l].join()+"}),{"+e[l].join()+"})":"(DrillDownMember("+i+", {"+e[l].join()+"}))";return i},_getcolumnMDX:function(l){var a,r,n=e(l)[0].columns,o="",s="",d=[],u=!1,c=!1,p=l._isCollapse,h=l.values.length>0&&l.values[0].measures!=i&&l.values[0].axis==t.olap.AxisName.Column;if(t.isNullOrUndefined(l.providerName)||l.providerName==t.olap.Providers.SSAS){if(n.length>0){for(c=!t.isNullOrUndefined(n[0].drillCellInfo),a=0;a<n.length;a++){var g=!(!t.isNullOrUndefined(n[a].isNamedSets)&&n[a].isNamedSets),m=(u=!1,""),f="";n[a].fieldName!=i&&g?(m=this._getDimensionQuery(n[a],l,"columns",a,!1),d.push(m.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"")),t.olap.base._isPaging&&c&&(f=this._getDimensionQuery(n[a],l,"columns",a,!0)),n[a].sortOrder&&n[a].sortOrder!=t.olap.SortOrder.None?(r=n[a].sortOrder==t.olap.SortOrder.Ascending?"asc":"desc",u=!0,o=o+(a>0?"*":"")+"{ ORDER ({HIERARCHIZE ({"+(t.olap.base._isPaging&&c?f:m)+"})},"+n[a].fieldName+".CurrentMember.MEMBER_CAPTION,"+r+")}"):o=o+(a>0?"*":"")+"{"+(t.olap.base._isPaging&&c?f:m)+"}"):o=a>0?o+"*{"+n[a].fieldName+"}":"{"+n[a].fieldName+"}"}t.olap.base._isPaging&&c&&this._updateOlapReport(e(l)[0].columns,o,"columns",d),p&&(u=p),o=(u?" ":" HIERARCHIZE ")+"( {"+(t.olap.base._isPaging?o:this._updateOlapReport(n,o,"columns",d))+"})",p&&(o="HIERARCHIZE("+o+")")}h&&(s=t.olap._mdxParser._getMeasuresQuery(l),o=""!=o?(t.olap.base._isPaging?o.slice(0,-1):o)+(""!=o&&""!=s?t.olap.base._isPaging?"*":",":"")+s:(t.olap.base._isPaging&&""!=s?"(":"")+s),t.olap.base._isPaging&&(o=""!=o?""==s?("}"!=o[o.length-1]?o.slice(0,-1):o)+this._getDrilledSection(l,e.extend(!0,{},n),"column",s)+")":o+this._getDrilledSection(l,e.extend(!0,{},n),"column",s)+")":"")}else o=this._generateAxisMDXOnMondrian(l,n,h);return o},_getDrilledSection:function(i,l,a,r){var n="";l=l;return e.each(l,function(i,l){t.isNullOrUndefined(l.drilledItems)||e.each(l.drilledItems,function(t,l){var a="",o="";e.each(l,function(e,t){a=""==a?"{"+t+"}":a+"*{"+t+"}",t=e==i?t.replace(".children",""):t,o=""==o?"{"+t+"}":o+"*{"+t+"}"}),""!=r&&(a=a+"*"+r,o=o+"*"+r),n=""==n?"+{"+a+"}-{"+o+"}":n+"+{"+a+"}-{"+o+"}"})}),n},_getSortedMembers:function(i){var l,a=i.fieldName;return i.sortOrder&&i.sortOrder!=t.olap.SortOrder.None?(l="ascending"==i.sortOrder?"asc":"desc",e.map(i.drilledItems,function(t){return e.map(t,function(e){return e.indexOf(a)>=0&&(e="order ( "+e+" , "+a+".CurrentMember.MEMBER_CAPTION,"+l+")"),e})})):i.drilledItems},_getAvailCount:function(i,l,a){var r=0;return e.each(i.split("--"),function(e,i){i=i.replace(a[e],""),l.split("--").length>0&&!t.isNullOrUndefined(l.split("--")[e])&&(r+=i.indexOf(l.split("--")[e])>-1&&!((i+"$").indexOf(l.split("--")[e])>-1)||l.split("--")[e].indexOf(i)>-1&&!(l.split("--")[e].indexOf(i+"$")>-1)?1:0)}),r},_updateTmpItems:function(i,l,a,r){var n=e.map(l.split("--"),function(e,i){return t.isNullOrUndefined(a.split("--")[i])||e.replace(r[i],"")!=a.split("--")[i].replace(r[i],"")||-1!=e.indexOf(r[i])?e:a.split("--")[i]}).join("--");-1==i.indexOf(n)&&i.push(n)},_updateExpandCollection:function(i,l,a){return e.each(l,function(r,n){e.each(l,function(l,r){var o,s,d;n!=r&&(o=0,e.each(r.split("--"),function(e,i){i=i.replace(a[e],""),t.isNullOrUndefined(n.split("--")[e])||(o+=r.split(a[e]).join("").indexOf(n.split("--")[e].replace(a[e],""))>-1||n.split("--")[e].replace(a[e],"").indexOf(i)>-1?1:0)}),o==r.split("--").length&&t.olap._mdxParser._updateTmpItems(i,n,r,a),o==n.split("--").length&&t.olap._mdxParser._updateTmpItems(i,r,n,a),s=[],d=0,e.each(r.split("--"),function(e,i){var l=n.split("--").length>e?n.split("--")[e]:"";t.isNullOrUndefined(l)||""==l||(i!=l&&i.indexOf("$")>-1&&(i.indexOf(l)>-1||l.indexOf(i)>-1)&&n.split("--").length-1>e?(s.push(i),d++):s.push(l))}),d>0&&i.push(s.concat(e.map(n.split("--"),function(e,t){if(t>=s.length)return e})).join("--")))})}),i},_updateDrillQuery:function(i,l,a,r){var n,o,s,d=t.olap.base._isRowDrilled||t.olap.base._isColDrilled,u=e.map(i,function(i){var l=e.map(t.olap.base.olapCtrlObj._prevDrillElements,function(e){if(e.indexOf(i.fieldName)>-1)return e}).join("$");if(""!=l)return l}).join("--"),c=e.map(r,function(e){return e.indexOf("DrillDownlevel")>=0&&(e=e.replace("DrillDownlevel","DrillDownlevel(")+")"),e}),p=e.map(i,function(e){return!t.isNullOrUndefined(e.hasAllMember)&&e.hasAllMember?".levels(0).AllMembers":".children"});d||""==u||(t.isNullOrUndefined(i[u.split("--").length-1]._prevDimElements)||-1!=i[u.split("--").length-1]._prevDimElements.indexOf(u+p[u.split("--").length-1])?i[u.split("--").length-1]._prevDimElements=i[u.split("--").length-1]._prevDimElements.filter(function(e){if(t.olap._mdxParser._getAvailCount(e,u,p)!=u.split("--").length)return e}):i[u.split("--").length-1]._prevDimElements.push(u+p[u.split("--").length-1]+"!#collapse")),i=e.map(i,function(i){return t.isNullOrUndefined(i._prevDimElements)?i:(i._prevDimElements=e.map(i._prevDimElements,function(i){var l=-1!=i.indexOf("!#collapse");return d?i.indexOf("!#collapse")>-1?(i=i.replace("!#collapse",""),t.olap._mdxParser._getAvailCount(i,u,p)!=u.split("--").length?i:void 0):i:""!=u?(i=i.replace("!#collapse",""),t.olap._mdxParser._getAvailCount(i,u,p)==u.split("--").length?e.map(i.split("--"),function(e,t){return t==u.split("--").length-1&&-1==e.indexOf(p[t])?u.split("--")[u.split("--").length-1]+"":e}).join("--")+(l?"!#collapse":""):i+(l?"!#collapse":"")):i}),""!=u&&(i._prevDimElements=e.map(i._prevDimElements,function(e){if(!(e.indexOf("!#collapse")>-1&&i._prevDimElements.filter(function(e){if(-1==e.indexOf("!#collapse"))return e}).indexOf(e.replace("!#collapse",""))>-1||-1==e.indexOf("!#collapse")&&i._prevDimElements.map(function(e){if(e.indexOf("!#collapse")>-1)return e.replace("!#collapse","")}).indexOf(e)>-1))return e})),i)});var h=e.map(i,function(e){if(!t.isNullOrUndefined(e._prevDimElements))return e._prevDimElements}).filter(function(e){if(-1==e.indexOf("!#collapse"))return e}),g=e.map(i,function(e){if(!t.isNullOrUndefined(e._prevDimElements))return e._prevDimElements}).filter(function(e){if(e.indexOf("!#collapse")>-1)return e}).map(function(e){return e.replace("!#collapse","")}),m=0==u.length?i.length:u.split("--").length,f=[];return d&&(h=e.map(h,function(e){if(t.olap._mdxParser._getAvailCount(e,u,p)==u.split("--").length)return e})),n=t.olap._mdxParser._updateExpandCollection([],h,p),o=t.olap._mdxParser._updateExpandCollection([],n,p),h=h.concat(n.concat(o)),n=[],e.each(h,function(t,i){e.each(g,function(t,l){var a=[],r=0;i.split("--").length>l.split("--").length&&(e.each(l.split("--"),function(e,t){var l=i.split("--")[e];(t.replace(p[e],"").indexOf(l.replace(p[e],""))>-1||l.replace(p[e],"").indexOf(t.replace(p[e],""))>-1)&&(a.push(t),r++)}),l.split("--").length==r&&r<i.split("--").length&&-1==n.indexOf(a.concat(e.map(i.split("--"),function(e,t){if(t>=a.length)return e})).join("--"))&&-1==g.indexOf(a.concat(e.map(i.split("--"),function(e,t){if(t>=a.length)return e})).join("--"))&&n.push(a.concat(e.map(i.split("--"),function(e,t){if(t>=a.length)return e})).join("--")))})}),g=g.concat(n),h=e.map(h,function(i){var l=d?m:i.split("--").length;return e.map(i.split("--"),function(e,i){return i<l-1?!t.isNullOrUndefined(u.split("--")[i])&&(u.split("--")[i].indexOf(e.replace(p[i],"")>-1)||e.replace(p[i],"").indexOf(u.split("--")[i])>-1)&&d?c[i].split("&amp;").join("&"):e.split("$")[e.split("$").length-1]:i==l-1?d?c[i].split("&amp;").join("&"):e.replace(p[i],"").split("$")[e.split("$").length-1]+p[i]:e.split("$")[e.split("$").length-1]}).join("--")}).sort(function(e,t){return e.split("--").length-t.split("--").length}),h=e.map(h,function(t){var i=[];return(i=t.split("--").length<c.length?[t.split("&").join("&amp;").split("--").concat(e.map(c,function(e,i){if(t.split("--").length-1<i)return e}))]:[t.split("&").join("&amp;").split("--")]).join()!=c.join()?i:void 0}),g=e.map(g,function(t){return t.split("--").length<c.length?[t.split("&").join("&amp;").split("--").map(function(e){return e.split("$")[e.split("$").length-1]}).concat(e.map(c,function(e,i){if(t.split("--").length-1<i)return e}))]:[t.split("&").join("&amp;").split("--").map(function(e){return e.split("$")[e.split("$").length-1]})]}),f=[],e.each(e.map(h,function(e){return e.join("--")}),function(e,t){(0==f.length||-1==f.indexOf(t))&&f.push(t)}),s={expandCollection:h=e.map(f,function(e){return[e.split("--")]}),collapseCollection:g},h.length>0&&i.length>1&&r[r.length-1].indexOf(".children")<0&&(l=this._getDrillQuery(s,l,i)),l},_updateOlapReport:function(l,a,r,n){var o,s,d,u=this;return"rows"==r?(o=e.map(l,function(e,t){if(l[t].drilledItems!=i)return u._getSortedMembers(e,l)}),t.olap.base._isRowDrilled&&"rows"==t.olap.base._currIndex.axis&&l[t.olap.base._currIndex.Index]!=i&&l[t.olap.base._currIndex.Index].drilledItems!=i?(d=e.map(n,function(e){return e.indexOf("DrillDownlevel")>=0&&(e=e.replace("DrillDownlevel","DrillDownlevel(")+")"),e}),l[t.olap.base._currIndex.Index].drilledItems.push(d),t.olap.base._isRowDrilled=!1):o.length>0&&(t.olap.base._currIndex.axis==i||"columns"==t.olap.base._currIndex.axis&&!t.olap.base._isRowDrilled)&&(a=this._getDrillQuery(o,a,l)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||"rows"!=t.olap.base._currIndex.axis||(t.olap.base._currIndex={})):(s=e.map(l,function(e,t){if(l[t].drilledItems!=i)return u._getSortedMembers(e,l)}),t.olap.base._isColDrilled&&"columns"==t.olap.base._currIndex.axis&&l[t.olap.base._currIndex.Index]!=i&&l[t.olap.base._currIndex.Index].drilledItems!=i?(d=e.map(n,function(e){return e.indexOf("DrillDownlevel")>=0&&(e=e.replace("DrillDownlevel","DrillDownlevel(")+")"),e}),l[t.olap.base._currIndex.Index].drilledItems.push(d),t.olap.base._isColDrilled=!1):s.length>0&&(t.olap.base._currIndex.axis==i||"rows"==t.olap.base._currIndex.axis&&!t.olap.base._isColDrilled)&&(a=this._getDrillQuery(s,a,l)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||"columns"!=t.olap.base._currIndex.axis||(t.olap.base._currIndex={})),a},_getDrillQuery:function(l,a,r){for(var n,o,s,d="",u=l,c=0;c<u.length;c++)if(u[c][u[c].length-1].toLowerCase().indexOf(".children")>=0||u[c][u[c].length-1].toLowerCase().indexOf("drilldownlevel")>=0||u[c][u[c].length-1].toLowerCase().indexOf("members")>=0||(u[c][u[c].length-1]=u[c][u[c].length-1]+".children"),u[c].length!=r.length){for(n=e.map(r,function(l){if(l.fieldName!=i&&l.fieldName!=u[c][[u[c].length-1]].split(".").splice(0,2).join("."))return{uniqueName:t.olap.base._isPaging?"("+e.trim(l.fieldName)+").children":"DrillDownLevel("+e.trim(l.fieldName)+")",fieldName:e.trim(l.fieldName)}}),o=0;o<n.length;o++)s=this._getItemPosition(r,n[o].fieldName)[0],u[c].toString().indexOf(n[o].fieldName)>=0||u[c].splice(s,0,n[o].uniqueName);d=d+""+(c>0?",":"")+"\n ("+u[c]+")"}else d=d+""+(c>0?",":"")+"\n ("+u[c].toString()+")\n";return"("+a+"),"+d},_createDrillThroughQuery:function(i,l){var a,r;if(l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)l._waitingPopup.show(),a=e(l.element).hasClass("e-pivotclient")?l.element.find(".e-pivotgrid").data("ejPivotGrid"):l,l.doAjaxPost("POST",l.model.url+"/"+l.model.serviceMethodSettings.drillThroughDataTable,JSON.stringify({currentReport:e(l.element).parents(".e-pivotclient").length>0?l.currentReport:JSON.parse(a.getOlapReport()).Report,layout:e(l.element).hasClass("e-pivotclient")?l.model.gridLayout:l.model.layout,cellPos:"",selector:i}),function(e){this._trigger("drillThrough",{element:e.element,data:e})}),l._waitingPopup.hide();else{var n=l.measureGrp,o="",s="DRILLTHROUGH Select("+l._colHeader.join()+","+l._rowHeader.join()+") on 0 from ["+l.model.dataSource.cube+"]";e.map(l._fieldData.measures,function(e){e.pid==n&&(o+=""==o?"["+n+"]."+e.id.split(".")[1]:",["+n+"]."+e.id.split(".")[1])}),s=s.replace(/&/g,"&amp;"),r=l._getConnectionInfo(l.model.dataSource.data),pData='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+s+" </Statement> </Command> <Properties> <PropertyList> <Catalog>"+l.model.dataSource.catalog+"</Catalog> </PropertyList> </Properties></Execute> </Body> </Envelope>",l.doAjaxPost("POST",r.url,{XMLA:pData},t.Pivot._generateDrillData,null,{pvtGridObj:l,action:"loadFieldElements"})}},_getDimensionQuery:function(l,a,r,n,o){var s="";return l.drillCellInfo==i||o?s=t.isNullOrUndefined(l.expression)?t.isNullOrUndefined(l.hasAllMember)||!l.hasAllMember?t.olap.base._isPaging?"(("+e.trim(l.fieldName)+").children)":"DrillDownlevel(("+e.trim(l.fieldName)+"))":"(("+e.trim(l.fieldName)+").levels(0).AllMembers)":"("+l.hierarchyUniqueName+".["+(l.fieldCaption||l.fieldName)+"])":(s="{("+l.drillCellInfo.uniqueName+")}",delete l.drillCellInfo),s},_updateReport:function(i,l,a,r){var n,o,s,d={};r._isMondrian?(n=l.preRepItm.split(">#>"),o=(s=l.itemPosition)?l.previousElements.split(n[s-1])[1].split("][").length:l.previousElements.split("][").length,a.drilledItems&&(a.drilledItems.length<=o-1&&(a.drilledItems[o-1]=[]),l.action&&"collapse"==l.action?a.drilledItems[o-1]=e.grep(a.drilledItems[o-1],function(e){return e!=n[s]}):a.drilledItems[o-1].push(n[s])),d={action:"mondrianDrilldown"}):(a.drillCellInfo=e.extend({},l),a.drillCellInfo.uniqueName="("+e.trim(a.drillCellInfo.uniqueName)+".children)",d={action:"drilldown",cellInfo:l}),t.olap.base.getJSONData(d,r.model.dataSource,r)},_splitCellInfo:function(e){var i,l=t.olap.base.olapCtrlObj._isMondrian?1:2;return e&&(i={hierarchyUniqueName:e.split("::")[1].split(".").splice(0,l).join("."),uniqueName:e.split("::")[0],levelUniqueName:e.split("::")[1],leveName:e.split("::")[2],parentUniqueName:e.split("::")[3]}),i},updateDrilledReport:function(l,a,r){var n,o,s,d,u;t.olap.base._isPaging&&!t.isNullOrUndefined(r._pagingSavedObjects.curDrilledItem)&&(r._pagingSavedObjects.curDrilledItem=l);t.olap._mdxParser;var c,p,h,g=null,m="",f="";if((c=this._splitCellInfo(l.uniqueName)).targetUName=l.uniqueName,c.previousElements="",(p="rowheader"==a?r.model.dataSource.rows:"colheader"==a?r.model.dataSource.columns:null).length>0){if(g=(h=e.map(p,function(t,l){return t.fieldName!=i&&e.trim(t.fieldName).toLowerCase()==e.trim(c.hierarchyUniqueName).toLowerCase()?{report:t,index:l}:t.hierarchyUniqueName!=i&&e.trim(t.hierarchyUniqueName).toLowerCase()==e.trim(c.hierarchyUniqueName).toLowerCase()?{report:t,index:l}:void 0}))[0].report,c.itemPosition=h[0].index,!t.isNullOrUndefined(r._pivotRecords)||t.isNullOrUndefined(r._pivotClientObj)||t.isNullOrUndefined(r._pivotClientObj._pivotRecords)||(r._pivotRecords=r._pivotClientObj._pivotRecords),n=e.map(r._pivotRecords.records,function(e){if(e.Info.replace(/&/g,"&amp;")==l.uniqueName)return e.Index}),g.drilledItems!=i?g.drilledItems:g.drilledItems=[],t.olap.base._currIndex={axis:"rowheader"==a?"rows":"columns",Index:h[0].index},"ejPivotChart"==r.pluginName||"ejPivotTreeMap"==r.pluginName||t.isNullOrUndefined(l.index)){for(c.cellIndex=n.length>0?"":l.index,c.axis=v=a,"rowheader"!=a?t.olap.base._isColDrilled=l.action==i||"collapse"!=l.action:t.olap.base._isRowDrilled=l.action==i||"collapse"!=l.action,o=0;o<r.model.dataSource.rows.length&&l.seriesInfo[o]!=l.uniqueName;o++)r.model.dataSource.rows[o].drillCellInfo=this._splitCellInfo(l.seriesInfo[o]);for(c.previousElements="",c.preRepItm="",o=0;o<l.uniqueNameArray.length;o++)c.previousElements+=this._splitCellInfo(l.uniqueNameArray[o]).uniqueName;for(o=0;o<l.seriesInfo.length;o++)c.preRepItm+=""==c.preRepItm?this._splitCellInfo(l.seriesInfo[o]).uniqueName:">#>"+this._splitCellInfo(l.seriesInfo[o]).uniqueName}else{c.cellIndex=l.index;var _=c.hierarchyUniqueName,v="",b=(m="",""),C=c.cellIndex.split(",")[0],S=c.cellIndex.split(",")[1];if("rowheader"==a)for(v="rowheader",t.olap.base._isRowDrilled=l.action==i||"collapse"!=l.action,o=parseInt(C);o>=0;o--)!r._pivotRecords.records[parseInt(o*r._pivotRecords.rowCount+parseInt(C))].Info.indexOf(_)>=0&&(b=r._pivotRecords.records[parseInt(o*r._pivotRecords.rowCount+parseInt(S))].Info,(s=this._splitCellInfo(b))&&(m=s.uniqueName+m),""==b||b.indexOf(_)>=0||((d=this._splitCellInfo(b)).uniqueName=d.uniqueName.replace(/&/g,"&amp;"),f=d.uniqueName+">#>"+f,currReport=e.map(p,function(t,l){return t.fieldName!=i&&e.trim(t.fieldName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?l:t.hierarchyUniqueName!=i&&e.trim(t.hierarchyUniqueName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?l:void 0}),"collapse"!=l.action&&(r.model.dataSource.rows[currReport[0]].drillCellInfo=d),_=d.hierarchyUniqueName));else for(v="colheader",t.olap.base._isColDrilled=l.action==i||"collapse"!=l.action,o=parseInt(S);o>=0;o--)!r._pivotRecords.records[parseInt(C*r._pivotRecords.rowCount+parseInt(o))].Info.indexOf(_)>=0&&(b=r._pivotRecords.records[parseInt(C*r._pivotRecords.rowCount+parseInt(o))].Info,(s=this._splitCellInfo(b))&&(m=s.uniqueName+(r._isMondrian?"":">#>")+m),""==b||b.indexOf(_)>=0||((d=this._splitCellInfo(b)).uniqueName=d.uniqueName.replace(/&/g,"&amp;"),f=d.uniqueName+(r._isMondrian?">#>":"")+f,currReport=e.map(p,function(t,l){return t.fieldName!=i&&e.trim(t.fieldName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?l:t.expression!=i&&e.trim(t.hierarchyUniqueName).toLowerCase()==e.trim(d.hierarchyUniqueName).toLowerCase()?l:void 0}),"collapse"!=l.action&&(r.model.dataSource.columns[currReport[0]].drillCellInfo=d),_=d.hierarchyUniqueName));f+=c.uniqueName,c.previousElements=m.replace(/&amp;/g,"&"),c.preRepItm=f.replace(/&amp;/g,"&"),c.axis=v}if(c.previousElements=c.previousElements.replace(/&amp;/g,"&"),c.preRepItm=c.preRepItm.replace(/&amp;/g,"&"),l.action)if(l.action){if(r._isMondrian)return c.action="collapse",void t.olap._mdxParser._updateReport(g.drilledItems,c,g,r);if(t.isNullOrUndefined(c)||t.isNullOrUndefined(c.previousElements)||""==c.previousElements||(t.olap.base.olapCtrlObj._prevDrillElements=c.previousElements.split("][").join("]>#>[").split(">#>")),(u=t.olap.base._getDrilledMemeber({item:c})).length&&!t.olap.base._isPaging)t.olap.base._onDemandCollapse({drilledMembers:u,action:l.action},v);else{for(;0!=u.length;)t.olap.base.olapCtrlObj.model.dataSource=t.olap._mdxParser._clearCollapsedItems(v,u[u.length-1],t.olap.base.olapCtrlObj.model.dataSource),u=u.splice(0,u.length-1);t.olap.base.getJSONData(l,t.olap.base.olapCtrlObj.model.dataSource,t.olap.base.olapCtrlObj)}}else e(l.drilledMember).clone(!0),t.olap.base._onDemandExpand({action:"drilldown",cellInfo:c,isExist:!0},l.drilledMember);else u=t.olap.base._getDrilledMemeber({item:c}),t.olap._mdxParser._updateReport(g.drilledItems,c,g,r)}},_clearCollapsedItems:function(t,l,a){return"rowheader"==t?a.rows=e.map(a.rows,function(t){return t.drilledItems!=i&&t.drilledItems.length&&(t.drilledItems=e.map(t.drilledItems,function(e){if(e.join("").indexOf(l.repItms.replace(/&/g,"&amp;"))<0)return[e]})),t}):"colheader"==t&&(a.columns=e.map(a.columns,function(t){return t.drilledItems!=i&&t.drilledItems.length&&(t.drilledItems=e.map(t.drilledItems,function(e){if(e.join("").indexOf(l.repItms.replace(/&/g,"&amp;"))<0)return[e]})),t})),a},_getSlicerMDX:function(t,l){for(var a=e(t)[0].filters,r="",n=this,o=l._fieldData,s=e.merge(e.merge([],t.columns),t.rows),d=0;d<a.length;d++)e.grep(s,function(e){var t=n._getDimensionUniqueName(e.fieldName,o),i=n._getDimensionUniqueName(a[d].fieldName,o);return t==i&&!(l._isMondrian&&""==i&&""==t)}).length>0||(a[d].fieldName!=i&&a[d].filterItems==i?r=r+(""!=r?"*":"")+"{"+this._getDimensionQuery(a[d])+"}":a[d].filterItems!=i&&(r=r+(""!=r?"*":"")+"{"+a[d].filterItems.values.toString()+"}"));return""!=r?"where ("+r.replace(/DrillDownlevel/g,"")+")":""},_getDimensionUniqueName:function(t,i){var l,a=i.hierarchy;return a?(l=e.map(a,function(e){if(e.id.toLowerCase()==t.toLowerCase())return e.pid})).length>0?l[0]:"":t.split(".")[0]},_getMeasuresQuery:function(t){var l,a,r,n=e(t)[0].values,o=[];return n.length>0&&(null!=(r=(a=jQuery.map(n,function(e,t){if(e.measures!=i)return{measureElements:e.measures,Index:t,axisName:e.axis}})).length>0?e.map(a[0].measureElements,function(e){return e.fieldName}):null)&&o.push({values:r,Index:a[0].Index}),n.axis),""!=(l=e.map(o,function(e){return e.values.toString()}))[0]?"{"+l+"}":""},_getIncludefilterQuery:function(t,l,a){var r,n,o,s="FROM ["+l+"]",d="FROM ( SELECT (",u=a._fieldData,c=[],p="COLUMNS";if(a._isMondrian)return s;for(r=e.map(e(t.rows),function(e){if(e.filterItems!=i)return[e.filterItems.values]}),n=e.map(e(t.columns),function(e){if(e.filterItems!=i)return[e.filterItems.values]}),o=0;o<t.filters.length;o++){var h=t.filters,g=this,m=!1;e.map(t.columns,function(e){g._getDimensionUniqueName(e.fieldName,u)==g._getDimensionUniqueName(h[o].fieldName,u)&&h[o].filterItems!=i&&(n.push(h[o].filterItems.values),m=!0)}),m||e.map(t.rows,function(e){g._getDimensionUniqueName(e.fieldName,u)==g._getDimensionUniqueName(h[o].fieldName,u)&&h[o].filterItems!=i&&r.push(h[o].filterItems.values)})}if(t.enableAdvancedFilter){for(o=0;o<=t.columns.length-1;o++)t.columns[o].advancedFilter&&e.merge(c,this._getAdvancedFilterQuery(t.columns[o],d,p));for(o=0;o<=t.rows.length-1;o++)t.rows[o].advancedFilter&&e.merge(c,this._getAdvancedFilterQuery(t.rows[o],d,p))}for(o=0;o<=n.length-1;o++)d=0==o?d+"{"+n[o].toString()+"}":d+",{"+n[o].toString()+"}";for(n.length>0&&(d=r.length>0?d+" ) on COLUMNS ,(":d+" ) on COLUMNS "),o=0;o<=r.length-1;o++)d=o>0?d+",{"+r[o].toString()+"}":d+"{"+r[o].toString()+"}";return d=n.length>0&&r.length>0?d+=") on ROWS ":0==n.length&&r.length>0?d+") on COLUMNS ":d,c.length>0&&(c=(n.length>0||r.length>0?d:"")+" "+c.join(" ")+" "+s+Array(c.length+1+n.length+r.length).join(")")),s=0==n.length&&0==r.length?s:d+s+")",c.length>0?c:s},_getAdvancedFilterQuery:function(i,l,a){var r=[],n=this;return e.map(i.advancedFilter,function(l){t.isNullOrUndefined(l.labelFilterOperator)&&l.labelFilterOperator==t.olap.LabelFilterOptions.None&&t.isNullOrUndefined(l.valueFilterOperator)&&l.valueFilterOperator==t.olap.ValueFilterOptions.None||r.push("FROM (SELECT Filter("+e.trim(l.name)+".AllMembers, "+n._getAdvancedFilterCondtions(i.fieldName,l.advancedFilterType==t.olap.AdvancedFilterType.LabelFilter||t.isNullOrUndefined(l.advancedFilterType)?l.labelFilterOperator:l.valueFilterOperator,l.values,l.advancedFilterType,l.measure)+")) on "+a)}),r},_getAdvancedFilterCondtions:function(e,i,l,a,r){var n="";a=t.isNullOrUndefined(a)?"label":a;switch(i.toLowerCase()){case"equals":n="("+("value"!=a?e+'.CurrentMember.member_caption ="'+l[0]+'"':r+" = "+l[0]);break;case"notequals":n="("+("value"!=a?e+'.CurrentMember.member_caption &lt;&gt;"'+l[0]+'"':r+" &lt;&gt;"+l[0]);break;case"contains":n="( InStr (1,"+e+'.CurrentMember.member_caption,"'+l[0]+'")&gt;0';break;case"notcontains":n="( InStr (1,"+e+'.CurrentMember.member_caption,"'+l[0]+'")=0';break;case"beginswith":n="( Left ("+e+".CurrentMember.member_caption,"+l[0].length+')="'+l[0]+'"';break;case"notbeginswith":n="( Left ("+e+".CurrentMember.member_caption,"+l[0].length+')&lt;&gt;"'+l[0]+'"';break;case"endswith":n="( Right ("+e+".CurrentMember.member_caption,"+l[0].length+')="'+l[0]+'"';break;case"notendswith":n="( Right ("+e+".CurrentMember.member_caption,"+l[0].length+')&lt;&gt;"'+l[0]+'"';break;case"greaterthan":n="("+("value"!=a?e+'.CurrentMember.member_caption &gt;"'+l[0]+'"':r+" &gt;"+l[0]);break;case"greaterthanorequalto":n="("+("value"!=a?e+'.CurrentMember.member_caption &gt;="'+l[0]+'"':r+" &gt;="+l[0]);break;case"lessthan":n="("+("value"!=a?e+'.CurrentMember.member_caption &lt;"'+l[0]+'"':r+" &lt;"+l[0]);break;case"lessthanorequalto":n="("+("value"!=a?e+'.CurrentMember.member_caption &lt;="'+l[0]+'"':r+" &lt;="+l[0]);break;case"between":n="("+("value"!=a?e+'.CurrentMember.member_caption &gt;="'+l[0]+'"AND '+e+'.CurrentMember.member_caption &lt;="'+l[1]+'"':r+" &gt;="+l[0]+" AND "+r+"&lt;="+l[1]);break;case"notbetween":n="("+("value"!=a?e+'.CurrentMember.member_caption &gt;="'+l[0]+'"OR '+e+'.CurrentMember.member_caption &lt;="'+l[1]+'"':r+" &gt;="+l[0]+" OR "+r+"&lt;="+l[1]);break;default:n="( InStr (1,"+e+'.CurrentMember.member_caption,"'+l[0]+'")&gt;0'}return n},_getItemPosition:function(t,l){return e.map(t,function(t,a){if(t.fieldName!=i&&e.trim(t.fieldName)==e.trim(l))return a})},getAllMember:function(i,l,a){if(!t.isNullOrUndefined(a)){var r="select {"+l+"} dimension properties CHILDREN_CARDINALITY on 0 from ["+e.trim(i.cube)+"]",n=t.olap._mdxParser.getSoapMsg(r,i.data,i.catalog),o=t.olap.base._getConnectionInfo(i.data);a.doAjaxPost("POST",o.url,{XMLA:n},a._generateAllMember,null,{action:"loadFieldElements"})}},getMembers:function(i,l,a){var r=t.Pivot.getReportItemByFieldName(l,i).item;t.olap.base.olapCtrlObj._isMondrian&&(t.isNullOrUndefined(a.model.pivotControl)||(this._controlObj=a.model.pivotControl));var n="select {"+(r&&r.hasAllMember?l+".levels(0).AllMembers":l+".children")+"}dimension properties CHILDREN_CARDINALITY, MEMBER_TYPE on 0 from ["+e.trim(i.cube)+"]",o=t.olap._mdxParser.getSoapMsg(n,i.data,i.catalog),s=t.olap.base._getConnectionInfo(i.data);a.doAjaxPost("POST",s.url,{XMLA:o},a._generateMembers,null,{action:"fetchMembers"})},getChildren:function(e,i,l){var a,r,n="select {"+i+".children} dimension properties CHILDREN_CARDINALITY on 0 from ["+e.cube+"]",o=l.model.pivotControl;!t.isNullOrUndefined(o)&&t.olap.base.olapCtrlObj._isMondrian&&(this._controlObj=l.model.pivotControl),a=t.olap._mdxParser.getSoapMsg(n,e.data,e.catalog),r=t.olap.base._getConnectionInfo(e.data),l.doAjaxPost("POST",r.url,{XMLA:a},t.Pivot.generateChildMembers,null,{action:"nodeExpand",currentNode:i})},getSoapMsg:function(e,i,l){var a,r=t.olap.base._getConnectionInfo(i);return!t.isNullOrUndefined(this._controlObj)||!t.isNullOrUndefined(t.olap.base.olapCtrlObj)&&t.olap.base.olapCtrlObj._isMondrian?(a='<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement><![CDATA['+e+"]]></Statement></Command><Properties><PropertyList><DataSourceInfo>"+(t.isNullOrUndefined(this._controlObj)?t.olap.base.olapCtrlObj.model.dataSource.sourceInfo:this._controlObj.model.dataSource.sourceInfo)+"</DataSourceInfo><Catalog>"+l+"</Catalog><AxisFormat>TupleFormat</AxisFormat><Content>Data</Content><Format>Multidimensional</Format></PropertyList></Properties></Execute></SOAP-ENV:Body></SOAP-ENV:Envelope>",delete this._controlObj):a='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+e+" </Statement> </Command> <Properties> <PropertyList> <Catalog>"+l+"</Catalog> <LocaleIdentifier>"+r.LCID+"</LocaleIdentifier></PropertyList> </Properties> </Execute> </Body> </Envelope>",a}},t.olap.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"},t.olap.Providers={SSAS:"ssas",Mondrian:"mondrian"},t.olap.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"},t.olap.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.olap.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.olap.AxisName={Row:"rows",Column:"columns"}}(jQuery,Syncfusion)})},1010:function(e,t,l){var a,r,n;
/*!
*  filename: ej.pivot.common.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.pivot.common.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(i){r=[l(4)],void 0===(n="function"==typeof(a=i)?a.apply(t,r):a)||(e.exports=n)}(function(){ej.Pivot=ej.Pivot||{},function(e,t,l){t.Pivot={addReportItem:function(e,i){var l,a;if(i.isMeasuresDropped)""!=i.droppedClass?e.values[0].axis="row"==i.droppedClass?"rows":"column"==i.droppedClass?"columns":e.values[0].axis:e.values[0].measures=[];else{for(a in l=this.removeReportItem(e,i.droppedFieldName,i.isMeasuresDropped),t.isNullOrUndefined(l)&&(l={fieldName:i.droppedFieldName,fieldCaption:i.droppedFieldCaption,format:i.droppedFieldFormat,formatString:i.droppedFieldFormatString,showSubTotal:i.droppedFieldShowSubTotal,expression:i.droppedExpression,hierarchyUniqueName:i.droppedHierarchyUniqueName,summaryType:i.summaryType}),l)("format"==a||"formatString"==a)&&(t.isNullOrUndefined(l[a])||""==l[a])&&delete l[a];switch(i.droppedClass){case"row":""!=i.droppedPosition.toString()?e.rows.splice(i.droppedPosition,0,l):e.rows.push(l);break;case"column":""!=i.droppedPosition.toString()?e.columns.splice(i.droppedPosition,0,l):e.columns.push(l);break;case"value":""==e.cube?""!=i.droppedPosition.toString()?e.values.splice(i.droppedPosition,0,l):e.values.push(l):""!=i.droppedPosition.toString()?e.values[0].measures.splice(i.droppedPosition,0,l):e.values[0].measures.push(l);break;case"filter":""!=i.droppedPosition.toString()?e.filters.splice(i.droppedPosition,0,l):e.filters.push(l)}}},removeReportItem:function(i,l,a){var r,n=""==i.cube?t.Pivot.AnalysisMode.Pivot:t.Pivot.AnalysisMode.Olap,o=e.grep(i.columns,function(e){return e.fieldName==l});return a?i.values[0].measures=[]:o.length>0?i.columns=e.grep(i.columns,function(e){return e.fieldName!=l}):(o=e.grep(i.rows,function(e){return e.fieldName==l})).length>0?i.rows=e.grep(i.rows,function(e){return e.fieldName!=l}):(r=n==t.Pivot.AnalysisMode.Olap?i.values[0].measures:i.values,(o=e.grep(r,function(e){return e.fieldName==l})).length>0?i.values=n==t.Pivot.AnalysisMode.Olap?[{measures:e.grep(r,function(e){return e.fieldName!=l}),axis:i.values[0].axis}]:e.grep(r,function(e){return e.fieldName!=l}):(o=e.grep(i.filters,function(e){return e.fieldName==l})).length>0&&(i.filters=e.grep(i.filters,function(e){return e.fieldName!=l}))),o[0]},getReportItemByFieldName:function(i,l){var a,r="columns",n=e.grep(l.columns,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()});return 0==n.length&&(n=e.grep(l.rows,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()}),r="rows"),0==n.length&&(a=""==l.cube?l.values:l.values.length>0&&!t.isNullOrUndefined(l.values[0].measures)?l.values[0].measures:[],n=e.grep(a,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()}),r="values"),0==n.length&&(n=e.grep(l.filters,function(e){return e.fieldName.toLowerCase()==i.toLowerCase()}),r="filters"),{item:n[0],axis:r}},getReportItemByFieldCaption:function(i,l){var a,r="columns",n=e.grep(l.columns,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()});return 0==n.length&&(n=e.grep(l.rows,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()}),r="rows"),0==n.length&&(a=""==l.cube?l.values:l.values.length>0&&!t.isNullOrUndefined(l.values[0].measures)?l.values[0].measures:[],n=e.grep(a,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()}),r="values"),0==n.length&&(n=e.grep(l.filters,function(e){return e.fieldCaption.toLowerCase()==i.toLowerCase()}),r="filters"),{item:n[0],axis:r}},closePreventPanel:function(i){var l="close"!=i.type?i:this;l.element.find("[id^='preventDiv']").remove(),t.isNullOrUndefined(l.model.pivotControl)?l._currentReportItems=e.extend(!0,[],l._savedReportItems):(l.model.pivotControl.element.find("[id^='preventDiv']").remove(),l.model.pivotControl._currentReportItems=e.extend(!0,[],l.model.pivotControl._savedReportItems)),t.isNullOrUndefined(l._waitingPopup)||l._waitingPopup.hide(),t.isNullOrUndefined(l.model.pivotControl)||t.isNullOrUndefined(l.model.pivotControl._waitingPopup)||l.model.pivotControl._waitingPopup.hide()},openPreventPanel:function(i){var l=t.buildTag("div#preventDiv.errorDlg").css({width:e("body").width()+"px",height:e("body").height()+"px",position:"absolute",top:e("body").offset().top+"px",left:e("body").offset().left+"px","z-index":10})[0].outerHTML;e("#"+i._id).append(l)},_createErrorDialog:function(i,l,a){var r,n;if(t.Pivot.closePreventPanel(a),a._errorDialog=l,t.Pivot.openPreventPanel(a),0==a.element.find(".e-errorDialog:visible").length&&(r=t.isNullOrUndefined(i.Exception)?t.buildTag("div.e-errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",i)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn",a._getLocalizedLabels("OK"),{margin:"20px 0 10px 165px"}).attr("title",a._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML)[0].outerHTML).attr("title",l)[0].outerHTML:t.buildTag("div.e-errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",i.Exception.Message)[0].outerHTML+t.buildTag("br")[0].outerHTML+t.buildTag("div."+a._id+"stackTraceContent","Stack Trace :"+i.Exception.StackTraceString)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn",a._getLocalizedLabels("OK"),{margin:"20px 0 10px 165px"}).attr("title",a._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML)[0].outerHTML).attr("title",l)[0].outerHTML,a.element.append(r),a.element.find(".e-errorDialog").ejDialog({target:"#"+a._id,enableResize:!1,enableRTL:a.model.enableRTL,width:"400px",close:t.proxy(t.Pivot.closePreventPanel,a)}),n=a.element.find(".e-errorDialog").data("ejDialog"),e("#"+n._id+"_wrapper").css({left:"50%",top:"50%"}),a.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,width:"50px"}).on(t.eventType.click,function(){"nodeCheck"!=a._errorDialog||t.isNullOrUndefined(a._schemaData)||t.isNullOrUndefined(a._schemaData._selectedTreeNode)||a._schemaData._tableTreeObj.uncheckNode(a._schemaData._selectedTreeNode),a.element.find("#preventDiv").remove(),(a._errorDialog==a._getLocalizedLabels("Success")||a._errorDialog==a._getLocalizedLabels("Warning")||a._errorDialog==a._getLocalizedLabels("Exception")||a._errorDialog==a._getLocalizedLabels("Error"))&&a.element.children("#ErrorDialog_wrapper").remove()}),a.element.find(".e-dialog .e-close").attr("title","Close"),t.isNullOrUndefined(e("#"+a._id).data("ejWaitingPopup"))||e("#"+a._id).data("ejWaitingPopup").hide(),"undefined"!=typeof oclientWaitingPopup&&null!=oclientWaitingPopup&&oclientWaitingPopup.hide(),!t.isNullOrUndefined(i.Exception))){var o="Show more";e("."+a._id+"stackTraceContent").each(function(){var i=e(this).html();if(i.length>50){a._id;var l=i.substr(0,50),r=i.substr(50,i.length-50),n=l+t.buildTag("span."+a._id+"moreellipses","...")[0].outerHTML+t.buildTag("span."+a._id+"morecontent",t.buildTag("span",r).css("display","none")[0].outerHTML+t.buildTag("a."+a._id+"morelink",o).css("display","block")[0].outerHTML)[0].outerHTML;e(this).html(n)}}),e("."+a._id+"morelink").click(function(){return e(this).hasClass("less")?(e(this).removeClass("less"),e(this).html(o)):(e(this).addClass("less"),e(this).html("Show less")),e(this).parent().prev().toggle("slow",function(){}),e(this).prev().toggle("slow",function(){}),!1})}},_updateValueSortingIndex:function(i,a){if(i.SortColIndex!=l)t.PivotAnalysis._valueSorting=JSON.parse(i.SortColIndex)[0],t.PivotAnalysis._sort=a.model.valueSortSettings.sortOrder;else{i=i[0]!=l?i:i.d!=l?i.d:i;var r=e.map(i,function(e){if(null!=e)var t=e.Key;if(null!=t&&t!=l&&"SortColIndex"==t)return e});r.length>0?(i.splice(e.map(i,function(e,t){if("SortColIndex"==e.Key)return t}),1),t.PivotAnalysis._valueSorting=JSON.parse(r[0].Value),t.PivotAnalysis._sort=a.model.valueSortSettings.sortOrder):t.PivotAnalysis._valueSorting=null}},_memberSortBtnClick:function(i){var a,r,n,o,s,d,u,c=this.element.hasClass("e-pivotclient")&&"servermode"==this.model.operationalMode&&"olap"==this.model.analysisMode,p="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl:this,h="ejPivotGrid"==this.pluginName&&p.model.analysisMode==t.Pivot.AnalysisMode.Olap&&p.model.operationalMode==t.Pivot.OperationalMode.ServerMode,g=e(i.target).parents(".e-memberEditorDiv").find(".e-editorTreeView"),m=this._sortType=e(i.target).hasClass("e-memberAscendingIcon")?"ascending":"descending",f=[],_=jQuery.extend(!0,[],this._memberTreeObj._dataSource);if(this.element.find(".e-memberDrillPager").is(":visible")&&(a=this.model.memberEditorPageSize==l?this.model.pivotControl.model.memberEditorPageSize:this.model.memberEditorPageSize,f=t.Pivot._getParentsTreeList(this,this._drilledNode,this._editorTreeData).concat(t.DataManager(this._editorDrillTreeData[this._drilledNode]).executeLocal(t.Query().sortBy("name",this._sortType).page(this._memberDrillPageSettings.currentMemberDrillPage,a)))),!t.isNullOrUndefined(g)&&g.length>0){if(t.Pivot.updateTreeView(this),r=(this.model.enableMemberEditorPaging||!t.isNullOrUndefined(this.model.pivotControl)&&this.model.pivotControl.model.enableMemberEditorPaging)&&!this._isSearchApplied?this._editorTreeData:g.data("ejTreeView").model.fields.dataSource,n=c||"All"!=r[0].id&&"(All)_0"!=r[0].id?r:r.slice(1),f.length>0&&(n=f),n.length>1&&"SearchFilterSelection"==n[0].id&&(n=n.slice(1)),o=c?[]:r.length>1&&("All"==r[0].id||"(All)_0"==r[0].id)?r.splice(0,1):[],s=t.DataManager(n).executeLocal(t.Query().sortBy("name",m)),!t.isNullOrUndefined(o)&&o.length>0&&(s.splice(0,0,o[0]),r.splice(0,0,o[0])),(this.model.enableMemberEditorPaging||!t.isNullOrUndefined(this.model.pivotControl)&&this.model.pivotControl.model.enableMemberEditorPaging)&&0==f.length&&(s=t.DataManager(s).executeLocal(t.Query().page(this._memberPageSettings.currentMemeberPage,(this.model.memberEditorPageSize||this.model.pivotControl.model.memberEditorPageSize)+(1==this._memberPageSettings.currentMemeberPage?1:0)))),p.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&s.length>0&&"All"!=s[0].id&&"(All)_0"!=s[0].id&&!t.isNullOrUndefined(o)&&o.length>0&&s.splice(0,0,o[0]),o={},g.data("ejTreeView").model.fields.dataSource.length>1&&"SearchFilterSelection"==g.data("ejTreeView").model.fields.dataSource[1].id&&"SearchFilterSelection"!=s[1].id&&s.splice(1,0,{id:"SearchFilterSelection",name:this._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:this._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"}),c&&this._isSearchApplied&&s.splice(0,0,{id:"SearchFilterSelection",name:this._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:this._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"}),t.isNullOrUndefined(g)||g.ejTreeView({fields:{dataSource:jQuery.extend(!0,[],s)}}),f.length>0&&!t.isNullOrUndefined(_)&&(this._memberTreeObj._dataSource=_),h)for(d=this.element.find(".e-editorTreeView").find("li"),u=0;u<d.length;u++)t.isNullOrUndefined(e(d[u]).attr("id"))||e(d[u]).attr("data-tag",t.DataManager(g.data("ejTreeView").model.fields.dataSource).executeLocal(t.Query().where("id","equal",e(d[u]).attr("id")))[0].tag);t.Pivot._separateAllMember(this)}},_contextMenuOpen:function(i,l){var a,r,n,o;if(t.Pivot.openPreventPanel(l),l._selectedMember=e(i.target),"ejPivotGrid"==l.pluginName?(a=l.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot",n=e("#pivotTree").data("ejMenu")):(t.isNullOrUndefined(l.model.pivotControl)||(a=l.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot"),n=e("#"+l._id+"_pivotTreeContextMenu").data("ejMenu")),a==t.Pivot.AnalysisMode.Olap){if(t.isNullOrUndefined(e(i.target).parent().attr("data-tag"))&&e(i.target).hasClass("e-pivotButton")&&e(i.target).children(".e-pvtBtn:eq(0)").length>0)return n.disable(),l._selectedMember=e(i.target).children(".e-pvtBtn:eq(0)"),!1;!t.isNullOrUndefined(e(i.target).parent().attr("data-tag"))&&e(i.target).parent().attr("data-tag").split(":")[1].toLowerCase().startsWith("[measures]")?n.disable():t.isNullOrUndefined(l._selectedMember.parent().attr("data-tag"))||"measures"!=l._selectedMember.parent().attr("data-tag").split(":")[1].toLowerCase()?t.isNullOrUndefined(e(i.target).parent().attr("data-tag"))?n.disable():(n.disableItem(l._getLocalizedLabels("AddToValues")),e(i.target.parentElement).find(".e-namedSetCDB").length>0?n.disableItem(l._getLocalizedLabels("AddToFilter")):n.enableItem(l._getLocalizedLabels("AddToFilter")),n.enableItem(l._getLocalizedLabels("AddToRow")),n.enableItem(l._getLocalizedLabels("AddToColumn"))):(n.disableItem(l._getLocalizedLabels("AddToValues")),n.disableItem(l._getLocalizedLabels("AddToFilter")),n.enableItem(l._getLocalizedLabels("AddToRow")),n.enableItem(l._getLocalizedLabels("AddToColumn")))}else a==t.Pivot.AnalysisMode.Pivot&&(r=i.target.textContent,e(i.target).hasClass("e-btn")?(n.enable(),"ejPivotGrid"==l.pluginName&&(n.disableItem(l._getLocalizedLabels("CalculatedField")),"values"==e(i.target).parents(".e-pivotButton").attr("data-tag").split(":")[0].toLowerCase()&&(l.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&e.grep(l.model.dataSource.values,function(e){return e.fieldCaption==r&&1==e.isCalculatedField}).length>0?n.disable():l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&e.grep(JSON.parse(l.getOlapReport()).PivotCalculations,function(e){return e.FieldHeader==r&&8==e.CalculationType}).length>0&&n.disable(),n.enableItem(l._getLocalizedLabels("CalculatedField"))))):e("#pivotTree").length>0?(n=e("#pivotTree").data("ejMenu")).disable():n.disable());o=l.model.pivotControl,t.isNullOrUndefined(o)||o.model.analysisMode!=t.Pivot.AnalysisMode.Pivot||0==e(i.target).parents(".e-schemaValue").length&&n.disableItem(l._getLocalizedLabels("SummarizeValueBy"))},_searchTreeNodes:function(i){var l,a,r,n,o,s,d=e(i.target).hasClass("searchTreeView")?this.element.find(".searchTreeView").data("ejMaskEdit"):this.element.find(".searchEditorTreeView").data("ejMaskEdit"),u=e(i.target).hasClass("searchTreeView")?this.model.operationalMode==t.Pivot.OperationalMode.ClientMode||this.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this.element.find(".e-schemaFieldTree").data("ejTreeView"):this.element.find(".e-cubeTreeView").data("ejTreeView"):this.element.find(".e-editorTreeView").data("ejTreeView"),c={id:"SearchFilterSelection",name:this._getLocalizedLabels("AddCurrentSelectionToFilter"),hasChildren:!1,checkedStatus:!0,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"},p=u.element,h=p.find("li[data-isItemSearch='true']"),g=t.isNullOrUndefined(d.get_StrippedValue())?"":d.get_StrippedValue().toLowerCase();if(h.length>0&&e(h).each(function(e,t){t.removeAttribute("data-isItemSearch")}),g.length>0){var m=[],f=[],_=p.find("ul>li>div>a");for(l=0;l<_.length;l++)-1!=e(_[l]).text().toLowerCase().indexOf(g)||"(All)_0"==e(e(_[l]).closest("li")).attr("id")||"All"==e(e(_[l]).closest("li")).attr("id")||"SearchFilterSelection"==e(e(_[l]).closest("li")).attr("id")?m.push(_[l]):f.push(_[l]);for((a=p.find(m).closest("li").css("display","block")).length>0&&(this._isOptionSearch=!0,e(a).each(function(t,i){"SearchFilterSelection"!=e(i).attr("id")&&i.setAttribute("data-isItemSearch",!0)}),p.hasClass("e-editorTreeView")&&(!p.find("li span.e-searchfilterselection").length>0?("(All)_0"==p.find("li:first").attr("id")||"All"==p.find("li:first").attr("id")?(a.length>1&&u.insertAfter(c,p.find("li:first")),(this.element.hasClass("e-pivotschemadesigner")?this.model.pivotControl.model.analysisMode:this.model.analysisMode)==t.Pivot.AnalysisMode.Pivot&&p.find("li span.e-searchfilterselection").closest("li").css("padding","0")):u.insertBefore(c,p.find("li:first")),p.find("li span.e-searchfilterselection").closest("li").attr("data-tag",c.tag)):p.find("li span.e-searchfilterselection").length>0&&!this._isSelectSearchFilter&&u.uncheckNode(p.find("li span.e-searchfilterselection").closest("li")))),p.find(f).closest("li").css("display","none"),s=0;s<a.length;s++)(n=(r=e(a[s])).parents("ul").closest("li").css("display","block")).length>0&&(u.expandNode(n),-1!=u.model.expandedNodes.indexOf(e(u._liList).index(n))||t.isNullOrUndefined(window._temp)||window._temp.push(n)),(o=r.children("ul")).length>0&&0==o.children("li:visible").length&&(r.children("ul").children("li").css("display","block"),u.expandNode(a[s]),-1!=u.model.expandedNodes.indexOf(e(u._liList).index(a[s]))||t.isNullOrUndefined(window._temp)||window._temp.push(a[s]))}else{p.find("ul>li").css("display","block"),p.find("li span.e-searchfilterselection").closest("li").length>0&&u.removeNode(p.find("#SearchFilterSelection")),e(p.find("ul>li")).each(function(e,t){t.removeAttribute("data-isItemSearch")}),this._isOptionSearch=!1;var v=e(p).find("ul>li"),b=0,C=0;if("(All)_0"==e(e(v)[0]).attr("id")||"All"==e(e(v)[0]).attr("id")){for(s=1;s<e(v).length;s++)e(e(v)[s]).find("span.e-checkmark").length>0?b++:C++;b>0&&C>0?e(p.find("ul>li")[0]).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-checkmark").addClass("e-stop"):b>0&&0==C?e(p.find("ul>li")[0]).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-stop").addClass("e-checkmark"):e(p.find("ul>li")[0]).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-checkmark").removeClass("e-stop")}if(!t.isNullOrUndefined(window._temp))for(s=0;s<window._temp.length;s++)u._collpaseNode(window._temp[s]);window._temp=[],e(i.target).hasClass("searchTreeView")&&u.collapseAll()}},_updateSearchFilterSelection:function(i,l,a){var r,n;"SearchFilterSelection"==e(i.currentElement).attr("id")&&(r=e(l).find("li:not([data-isItemSearch='true'])"),"nodeCheck"==i.type?(a._isSelectSearchFilter=!0,a._isOptionSearch?r.length>0&&e(r).each(function(i,r){"SearchFilterSelection"!=e(r).attr("id")&&!t.isNullOrUndefined(a._currentFilterList[e(r).attr("id")])&&a._currentFilterList[e(r).attr("id")].checkedStatus&&e(l).ejTreeView("checkNode",e(r))}):r.length>0&&(e(a._editorTreeData).each(function(i,l){for(var n=0;n<r.length;n++){if(r[n].id==l.id){l.checkedStatus=e(r[n]).find(".checked").length>0;break}t.isNullOrUndefined(a._currentFilterList)||(l.checkedStatus=a._currentFilterList[e(l).attr("id")].checkedStatus)}}),n=!0,e(a._editorTreeData).each(function(e,t){if(t.checkedStatus)return n=!1,!1}),n&&a._editorTreeData.length>0?(a._dialogOKBtnObj.disable(),a.element.find(".e-dialogOKBtn").attr("disabled","disabled")):(a._dialogOKBtnObj.enable(),a.element.find(".e-dialogOKBtn").removeAttr("disabled")))):"nodeUncheck"==i.type&&(a._isSelectSearchFilter=!1,a._isOptionSearch?r.length>0&&e(r).each(function(t,i){"SearchFilterSelection"!=e(i).attr("id")&&e(l).ejTreeView("uncheckNode",e(i))}):r.length>0&&(e(a._editorTreeData).each(function(t,i){for(var l=0;l<r.length;l++){if(r[l].id==i.id){i.checkedStatus=e(r[l]).find(".checked").length>0;break}i.checkedStatus=!1}}),n=!0,e(a._editorTreeData).each(function(e,t){if(t.checkedStatus)return n=!1,!1}),n&&a._editorTreeData.length>0?(a._dialogOKBtnObj.disable(),a.element.find(".e-dialogOKBtn").attr("disabled","disabled")):(a._dialogOKBtnObj.enable(),a.element.find(".e-dialogOKBtn").removeAttr("disabled")))))},editorTreeNavigatee:function(i,l){var a,r;if(e(i.target).parents(".e-memberPager").length>0){if(r=l._memberPageSettings.currentMemeberPage,!e(i.target).hasClass("e-pageDisabled")){if(e(i.target).hasClass("e-nextPage"))l._memberPageSettings.startPage+=l.model.memberEditorPageSize,l._memberPageSettings.currentMemeberPage+=1,l._memberPageSettings.endPage+=l.model.memberEditorPageSize;else if(e(i.target).hasClass("e-prevPage"))l._memberPageSettings.currentMemeberPage-=1,l._memberPageSettings.startPage=Math.abs(l._memberPageSettings.startPage-(l._memberPageSettings.currentMemeberPage,l.model.memberEditorPageSize)),l._memberPageSettings.endPage-=l.model.memberEditorPageSize;else if(e(i.target).hasClass("e-firstPage"))l._memberPageSettings.currentMemeberPage=1,l._memberPageSettings.endPage=l.model.memberEditorPageSize,l._memberPageSettings.startPage=0;else if(e(i.target).hasClass("e-lastPage"))l._memberPageSettings.currentMemeberPage=parseInt(e.trim(l.element.find(".e-memberPageCount").text().split("/")[1])),l._memberPageSettings.endPage=l._memberPageSettings.currentMemeberPage*l.model.memberEditorPageSize,l._memberPageSettings.startPage=l._memberPageSettings.endPage-l.model.memberEditorPageSize;else{if(parseInt(e(i.target).val())>e.trim(l.element.find(".e-memberPageCount").text().split("/")[1])||0==parseInt(e(i.target).val()))return l.element.find(".e-memberCurrentPage").val(r),!1;l._memberPageSettings.currentMemeberPage=parseInt(e(i.target).val()),l._memberPageSettings.endPage=l._memberPageSettings.currentMemeberPage*l.model.memberEditorPageSize,l._memberPageSettings.startPage=1==l._memberPageSettings.currentMemeberPage||0==l._memberPageSettings.currentMemeberPage?0:l._memberPageSettings.endPage-l.model.memberEditorPageSize}l._waitingPopup.show(),l.element.hasClass("e-pivotclient")&&l.model.analysisMode==t.Pivot.AnalysisMode.Olap&&l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?(l.model.enableMemberEditorSorting&&(l._editorTreeData=t.DataManager(l._editorTreeData).executeLocal(t.Query().sortBy("name",l._sortType))),this.editorTreePageInfoSuccess(l._editorTreeData,l)):("ejPivotSchemaDesigner"!=l.pluginName?l._isMemberPageFilter=!0:l.model.pivotControl._isMemberPageFilter=!0,t.Pivot.updateTreeView(l),a=t.DataManager(l._editorTreeData).executeLocal(t.Query().sortBy("name",t.isNullOrUndefined(l._sortType)?"":l._sortType).where(t.Predicate("pid","equal",null).and("id","notequal","All").and("id","notequal","(All)_0")).page(l._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize:l.model.memberEditorPageSize)),l._memberPageSettings.currentMemeberPage>1?l.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):l.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),l._memberPageSettings.currentMemeberPage==parseInt(e.trim(l.element.find(".e-memberPageCount").text().split("/")[1]))?l.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):l.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),l.element.find(".e-memberCurrentPage").val(l._memberPageSettings.currentMemeberPage),l.element.find(".e-nextPageDiv .e-pageDisabled").css("opacity","0.5"),l.element.find(".e-nextPageDiv .e-pageEnabled").css("opacity","1"),t.Pivot._createSearchTreeview(a,l),l._waitingPopup.hide())}}else if(e(i.target).parents(".e-memberSearchPager").length>0){if(r=l._memberSearchPageSettings.currentMemberSearchPage,!e(i.target).hasClass("e-pageDisabled")){if(e(i.target).hasClass("e-nextPage"))l._memberSearchPageSettings.startSearchPage+=l.model.memberEditorPageSize,l._memberSearchPageSettings.currentMemberSearchPage+=1,l._memberSearchPageSettings.endSearchPage+=l.model.memberEditorPageSize;else if(e(i.target).hasClass("e-prevPage"))l._memberSearchPageSettings.currentMemberSearchPage-=1,l._memberSearchPageSettings.startSearchPage=Math.abs(l._memberSearchPageSettings.startSearchPage-(l._memberSearchPageSettings.currentMemberSearchPage,l.model.memberEditorPageSize)),l._memberSearchPageSettings.endSearchPage-=l.model.memberEditorPageSize;else if(e(i.target).hasClass("e-firstPage"))l._memberSearchPageSettings.currentMemberSearchPage=1,l._memberSearchPageSettings.endSearchPage=l.model.memberEditorPageSize,l._memberSearchPageSettings.startSearchPage=0;else if(e(i.target).hasClass("e-lastPage"))l._memberSearchPageSettings.currentMemberSearchPage=parseInt(e.trim(l.element.find(".e-memberSearchPageCount").text().split("/")[1])),l._memberSearchPageSettings.endSearchPage=l._memberSearchPageSettings.currentMemberSearchPage*l.model.memberEditorPageSize,l._memberSearchPageSettings.startSearchPage=l._memberSearchPageSettings.endSearchPage-l.model.memberEditorPageSize;else{if(parseInt(e(i.target).val())>e.trim(l.element.find(".e-memberSearchPageCount").text().split("/")[1])||0==parseInt(e(i.target).val()))return l.element.find(".e-memberCurrentSearchPage").val(r),!1;l._memberSearchPageSettings.currentMemberSearchPage=parseInt(e(i.target).val()),l._memberSearchPageSettings.endSearchPage=l._memberSearchPageSettings.currentMemberSearchPage*l.model.memberEditorPageSize,l._memberSearchPageSettings.startSearchPage=1==l._memberSearchPageSettings.currentMemberSearchPage||0==l._memberSearchPageSettings.currentMemberSearchPage?0:l._memberSearchPageSettings.endSearchPage-l.model.memberEditorPageSize}l._waitingPopup.show(),l.element.hasClass("e-pivotclient")&&l.model.analysisMode==t.Pivot.AnalysisMode.Olap&&l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._editorTreeSearchPageInfoSuccess(l._editorSearchTreeData,l):("ejPivotSchemaDesigner"!=l.pluginName?l._isMemberPageFilter=!0:l.model.pivotControl._isMemberPageFilter=!0,this._editorTreeSearchPageInfoSuccess(l._editorSearchTreeData,l))}}else if(e(i.target).parents(".e-memberDrillPager").length>0&&(r=l._memberDrillPageSettings.currentMemberDrillPage,!e(i.target).hasClass("e-pageDisabled"))){if(e(i.target).hasClass("e-nextPage"))l._memberDrillPageSettings.startDrillPage+=l.model.memberEditorPageSize,l._memberDrillPageSettings.currentMemberDrillPage+=1,l._memberDrillPageSettings.endDrillPage+=l.model.memberEditorPageSize;else if(e(i.target).hasClass("e-prevPage"))l._memberDrillPageSettings.currentMemberDrillPage-=1,l._memberDrillPageSettings.startDrillPage=Math.abs(l._memberDrillPageSettings.startDrillPage-(l._memberDrillPageSettings.currentMemberDrillPage,l.model.memberEditorPageSize)),l._memberDrillPageSettings.endDrillPage-=l.model.memberEditorPageSize;else if(e(i.target).hasClass("e-firstPage"))l._memberDrillPageSettings.currentMemberDrillPage=1,l._memberDrillPageSettings.endDrillPage=l.model.memberEditorPageSize,l._memberDrillPageSettings.startDrillPage=0;else if(e(i.target).hasClass("e-lastPage"))l._memberDrillPageSettings.currentMemberDrillPage=parseInt(e.trim(l.element.find(".e-memberDrillPageCount").text().split("/")[1])),l._memberDrillPageSettings.endDrillPage=l._memberDrillPageSettings.currentMemberDrillPage*l.model.memberEditorPageSize,l._memberDrillPageSettings.startDrillPage=l._memberDrillPageSettings.endDrillPage-l.model.memberEditorPageSize;else{if(parseInt(e(i.target).val())>e.trim(l.element.find(".e-memberDrillPageCount").text().split("/")[1])||0==parseInt(e(i.target).val()))return l.element.find(".e-memberCurrentDrillPage").val(r),!1;l._memberDrillPageSettings.currentMemberDrillPage=parseInt(e(i.target).val()),l._memberDrillPageSettings.endDrillPage=l._memberDrillPageSettings.currentMemberDrillPage*l.model.memberEditorPageSize,l._memberDrillPageSettings.startDrillPage=1==l._memberDrillPageSettings.currentMemberDrillPage||0==l._memberDrillPageSettings.currentMemberDrillPage?0:l._memberDrillPageSettings.endDrillPage-l.model.memberEditorPageSize}l._waitingPopup.show(),this._editorTreeDrillPageInfoSuccess(l._memberTreeObj._dataSource.slice(),l)}},editorTreePageInfoSuccess:function(i,a){setTimeout(function(){var r,n;a._memberPageSettings.currentMemeberPage>1?a.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):a.element.find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),a._memberPageSettings.currentMemeberPage==parseInt(e.trim(a.element.find(".e-memberPageCount").text().split("/")[1]))?a.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):a.element.find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),a.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&(r=i[0]!=l?i[0].Value:i.d!=l?i.d[0].Value:i.EditorTreeInfo,(n=e.parseJSON(r)).splice(-1,1)),a.element.find(".e-memberCurrentPage").val(a._memberPageSettings.currentMemeberPage),a._appendTreeViewData(a.model.operationalMode==t.Pivot.OperationalMode.ClientMode?n:t.DataManager(a._editorTreeData).executeLocal(t.Query().where("pid","equal",l).page(a._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==a.pluginName?a.model.pivotControl.model.memberEditorPageSize:a.model.memberEditorPageSize)),a.element.find(".pvtBtn").parent("[data-tag='Slicers:"+a._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0),a._waitingPopup.hide()},0)},_editorTreeDrillPageInfoSuccess:function(i,a){setTimeout(function(){var r,n,o;a._memberDrillPageSettings.currentMemberDrillPage>1?a.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):a.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),a._memberDrillPageSettings.currentMemberDrillPage==parseInt(e.trim(a.element.find(".e-memberDrillPageCount").text().split("/")[1]))?a.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):a.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),a.element.find(".e-memberCurrentDrillPage").val(a._memberDrillPageSettings.currentMemberDrillPage),n=0,i.length>0&&i[0].length>0&&"All"==i[0][0].id&&i[0].splice(0,1),e.each(i,function(e,t){if(1!=t.length||!t[0].expanded)return!1;n=e}),o=a.model.enableMemberEditorSorting&&a._sortType?t.DataManager(t.DataManager(a._editorTreeData).executeLocal(t.Query().where("pid","equal",i[n][0].id).sortBy("name",a._sortType))).executeLocal(t.Query().where("pid","notequal",l).page(a._memberDrillPageSettings.currentMemberDrillPage,"ejPivotSchemaDesigner"==a.pluginName?a.model.pivotControl.model.memberEditorPageSize:a.model.memberEditorPageSize)):t.DataManager(t.DataManager(a._editorTreeData).executeLocal(t.Query().where("pid","equal",i[n][0].id))).executeLocal(t.Query().where("pid","notequal",l).page(a._memberDrillPageSettings.currentMemberDrillPage,"ejPivotSchemaDesigner"==a.pluginName?a.model.pivotControl.model.memberEditorPageSize:a.model.memberEditorPageSize)),a._editorDrillTreePageSettings[i[n][0].id]=e.extend(!0,{},a._memberDrillPageSettings),a.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0?(r=t.Pivot._getParentsTreeList(a,i[n][0].id,a._editorTreeData).concat(o),"ejPivotClient"!=a.pluginName?t.Pivot._createSearchTreeview(r,a):a._appendTreeViewData(r,a.element.find(".pvtBtn").parent("[data-tag='Slicers:"+a._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0)):"ejPivotClient"!=a.pluginName?t.Pivot._createSearchTreeview(o,a):a._appendTreeViewData(o,a.element.find(".pvtBtn").parent("[data-tag='Slicers:"+a._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0),a._waitingPopup.hide()},0)},_editorTreeSearchPageInfoSuccess:function(i,l){setTimeout(function(){var a,r="ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize:l.model.memberEditorPageSize;for(l._memberSearchPageSettings.currentMemberSearchPage>1?l.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):l.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),l._memberSearchPageSettings.currentMemberSearchPage==parseInt(e.trim(l.element.find(".e-memberSearchPageCount").text().split("/")[1]))?l.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):l.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),i=t.DataManager(i).executeLocal(t.Query().where(t.Predicate("id","notequal","(All)_0").and("id","notequal","All"))).slice((l._memberSearchPageSettings.currentMemberSearchPage-1)*r,(l._memberSearchPageSettings.currentMemberSearchPage-1)*r+r),a=0;a<i.length;a++)t.isNullOrUndefined(i[a].pid)||(i[a].parentId=i[a].pid);for(a=0;a<i.length;a++)t.Pivot._appendParentNodes(i,i[a],l);l.element.find(".e-memberCurrentSearchPage").val(l._memberSearchPageSettings.currentMemberSearchPage),i.splice(0,0,{id:"SearchFilterSelection",name:l._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:l._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"}),"ejPivotClient"==l.pluginName&&l.model.analysisMode==t.Pivot.AnalysisMode.Olap&&l.model.operationalMode==t.Pivot.OperationalMode.ServerMode?l._appendTreeViewData(i,l.element.find(".pvtBtn").parent("[data-tag='Slicers:"+l._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):t.Pivot._createSearchTreeview(i,l),l._waitingPopup.hide(),l._parentNodeCollection={},l._parentSearchNodeCollection={}},0)},_drillEditorTreeNode:function(i,a,r){var n,o;a._waitingPopup.show(),n=i.childNodes,a._isEditorDrillPaging&&!a._isEditorCollapseDrillPaging?a.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0&&(a._memberDrillPageSettings={currentMemberDrillPage:1,startDrillPage:0,endDrillPage:0},t.isNullOrUndefined(i.parentNode.id)||(a._editorDrillTreeData[i.parentNode.id]=n.slice(),a._editorDrillTreePageSettings[i.parentNode.id]=e.extend(!0,{},a._memberDrillPageSettings)),this._refreshDrillEditorPager(i,a,r)):a._isEditorCollapseDrillPaging&&(a.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0&&(a._isEditorCollapseDrillPaging=!1,a._memberDrillPageSettings=t.isNullOrUndefined(i.parentNode.id)?i.drillPageSettings:i.drillPageSettings[i.parentNode.id]),this._refreshDrillEditorPager(i,a,r)),a._drilledNode=i.parentNode.id,o=t.isNullOrUndefined(i.parentNode.id)?i.parentNode.concat(i.childNodes):this._getParentsTreeList(a,i.parentNode.id,a._editorTreeData).concat(t.DataManager(n).executeLocal(t.Query().where("pid","notequal",l).page(a._memberDrillPageSettings.currentMemberDrillPage,r))),"ejPivotClient"==a.pluginName&&a.model.analysisMode==t.Pivot.AnalysisMode.Olap&&a.model.operationalMode==t.Pivot.OperationalMode.ServerMode?a._appendTreeViewData(o,a.element.find(".pvtBtn").parent("[data-tag='Slicers:"+a._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):t.Pivot._createSearchTreeview(o,a),a._waitingPopup.hide()},_refreshDrillEditorPager:function(t,i,l){i.element.find(".e-memberPager,.e-memberSearchPager").css("display","none"),i.element.find(".e-memberDrillPager").css("display","block");var a=t.childNodes.length/l;a!=Math.round(a)&&(a=parseInt(a)+1),i._memberDrillPageSettings.currentMemberDrillPage==a&&i.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").addClass("disabled"),i.element.find(".e-memberDrillPageCount").html("/ "+a),i.element.find(".e-memberCurrentDrillPage").val(i._memberDrillPageSettings.currentMemberDrillPage),i._memberDrillPageSettings.currentMemberDrillPage>1?i.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):i.element.find(".e-memberDrillPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),i._memberDrillPageSettings.currentMemberDrillPage==parseInt(e.trim(i.element.find(".e-memberDrillPageCount").text().split("/")[1]))?i.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):i.element.find(".e-memberDrillPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"),t.childNodes=t.childNodes.slice((i._memberDrillPageSettings.currentMemberDrillPage-1)*l,i._memberDrillPageSettings.currentMemberDrillPage*l)},_getParentsTreeList:function(e,i,l){var a,r=[];do{parentNodes=t.DataManager(l).executeLocal(t.Query().where("id","equal",i)),a=!t.isNullOrUndefined(parentNodes)&&parentNodes.length>0&&!t.isNullOrUndefined(parentNodes[0].pid),r.push(new t.Predicate("id","equal",i)),i=a?parentNodes[0].pid:null}while(!t.isNullOrUndefined(i));return t.DataManager(l).executeLocal(t.Query().where(t.Predicate.or(r)))},_onNodeCollapse:function(i){var a,r=t.isNullOrUndefined(i.olapCtrlObj)?this:i.olapCtrlObj,n=!1,o={memberEditorPageSize:"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.memberEditorPageSize:r.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl.model.enableMemberEditorPaging:r.model.enableMemberEditorPaging};if(jQuery.each(r._editorTreeData,function(e,l){l.id==i.id?(t.isNullOrUndefined(l.pid)||(i.parentId=l.pid),l.expanded=!1):l.pid==i.id&&(t.isNullOrUndefined(r._editorDrillTreeData[l.id])||(n=!0))}),o.enableMemberEditorPaging&&(n||!t.isNullOrUndefined(r._editorDrillTreeData[i.id])||""==i.parentId)){r.element.find(".searchEditorTreeView").data("ejMaskEdit").clear(),r._lastSavedTree=[],r._isEditorDrillPaging=!1,r.element.find(".e-memberPager").length>0?(r.element.find(".e-memberPager").css("display","block"),r.element.find(".e-memberDrillPager,.e-memberSearchPager").css("display","none")):r.element.find(".e-memberDrillPager, .e-memberSearchPager").css("display","none");var s=[],d=i.parentId,u=!1,c=!1,p="";if(!t.isNullOrUndefined(d)&&""!=d){do{parentNodes=t.DataManager(r._editorTreeData).executeLocal(t.Query().where("id","equal",d)),u=!!(u||o.memberEditorPageSize<=t.DataManager(r._editorTreeData).executeLocal(t.Query().where("pid","equal",d)).length),s.push(new t.Predicate(u?"id":"pid","equal",d)),!c&&u&&o.memberEditorPageSize<t.DataManager(r._editorTreeData).executeLocal(t.Query().where("pid","equal",d)).length&&(c=!0,p=d),d=parentNodes[0].pid}while(!t.isNullOrUndefined(d));u?s.push(new t.Predicate("id","equal",i.parentId)):s.push(new t.Predicate("pid","equal",l))}u?(t.Pivot._makeAncestorsExpandable(r,i.parentId),r._isEditorCollapseDrillPaging=!0,(a={drillPageSettings:t.isNullOrUndefined(r._editorDrillTreePageSettings[p])&&"ejPivotSchemaDesigner"==r.pluginName?r.model.pivotControl._editorDrillTreePageSettings[p]:r._editorDrillTreePageSettings[p],parentNode:t.DataManager(e.extend(!0,[],r._editorTreeData)).executeLocal(t.Query().where(t.Predicate.or(s))),childNodes:t.DataManager(e.extend(!0,[],r._editorTreeData)).executeLocal(t.Query().where("pid","equal",p))}).parentNode=e.grep(a.parentNode,function(t){var i=!1;return e.each(a.childNodes,function(e,l){l.id==t.id&&(l.expanded=!0,i=!0)}),!i}),t.Pivot._drillEditorTreeNode(a,r,o.memberEditorPageSize)):(r.model.enableMemberEditorSorting&&(r._editorTreeData=t.DataManager(r._editorTreeData).executeLocal(t.Query().sortBy("name",r._sortType))),0==s.length&&s.push(new t.Predicate("pid","equal",l)),r.element.find(".e-memberPager").length>0?"ejPivotClient"!=r.pluginName?t.Pivot._createSearchTreeview(t.DataManager(r._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(s)).page(r._memberPageSettings.currentMemeberPage,o.memberEditorPageSize)),r):r._appendTreeViewData(t.DataManager(r._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(s)).page(r._memberPageSettings.currentMemeberPage,o.memberEditorPageSize)),r.element.find(".pvtBtn").parent("[data-tag='Slicers:"+r._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):"ejPivotClient"!=r.pluginName?t.Pivot._createSearchTreeview(t.DataManager(r._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(s))),r):r._appendTreeViewData(t.DataManager(r._editorTreeData).executeLocal(t.Query().where(t.Predicate.or(s))),r.element.find(".pvtBtn").parent("[data-tag='Slicers:"+r._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0))}},_searchEditorTreeNodes:function(i,a){if(t.isNullOrUndefined(window.event)?0!=i.which&&13!=i.which:0!=window.event.which&&13!=window.event.which){t.isNullOrUndefined(a._waitingPopup.element)||a._waitingPopup.show();var r=this;setTimeout(function(){var i,n,o,s={memberEditorPageSize:"ejPivotSchemaDesigner"==a.pluginName?a.model.pivotControl.model.memberEditorPageSize:a.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==a.pluginName?a.model.pivotControl.model.enableMemberEditorPaging:a.model.enableMemberEditorPaging},d="";if("ejPivotClient"!=a.pluginName||t.isNullOrUndefined(a._pivotSchemaDesigner)){if(t.isNullOrUndefined(a.element.find(".searchEditorTreeView"))||0==a.element.find(".searchEditorTreeView").length)return!1;d=t.isNullOrUndefined(e.trim(a.element.find(".searchEditorTreeView").val()))?"":e.trim(a.element.find(".searchEditorTreeView").val()).toLowerCase()}else{if(t.isNullOrUndefined(a._pivotSchemaDesigner.element.find(".searchEditorTreeView"))||0==a._pivotSchemaDesigner.element.find(".searchEditorTreeView").length)return!1;d=t.isNullOrUndefined(e.trim(a._pivotSchemaDesigner.element.find(".searchEditorTreeView").val()))?"":e.trim(a._pivotSchemaDesigner.element.find(".searchEditorTreeView").val()).toLowerCase()}if(""!=d){var u=jQuery.extend(!0,[],t.DataManager(a._editorTreeData).executeLocal(t.Query().where("name","contains",d,!0).sortBy("name",t.isNullOrUndefined(a._sortType)?"":a._sortType))),c=e.extend(!0,[],u.slice(0,s.memberEditorPageSize+1)),p=s.enableMemberEditorPaging?c:u;for(i=0;i<p.length;i++)t.isNullOrUndefined(p[i].pid)||(p[i].parentId=p[i].pid);for(i=0;i<p.length;i++)r._appendParentNodes(p,p[i],a);a._isSearchApplied=!0,u.length>0?(a._isSelectSearchFilter=!0,s.enableMemberEditorPaging&&(a.element.find(".e-memberSearchPager").find(".e-nextPageDiv").length>0||a.element.find(".e-memberDrillPager").find(".e-nextPageDiv").length>0)&&(a._memberSearchPageSettings.currentMemberSearchPage=1,a._memberSearchPageSettings.startSearchPage=0,a._memberSearchPageSettings.endSearchPage=0,a.element.find(".e-memberPager,.e-memberDrillPager").css("display","none"),a._editorSearchTreeData=u.slice(),(n=t.DataManager(u).executeLocal(t.Query().where(t.Predicate("id","notequal","(All)_0").and("id","notequal","All"))).length/s.memberEditorPageSize)!=Math.round(n)&&(n=parseInt(n)+1),n>1&&a.element.find(".e-memberSearchPager").css("display","block"),a._memberSearchPageSettings.currentMemberSearchPage==n&&a.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").addClass("disabled"),a.element.find(".e-memberSearchPageCount").html("/ "+n),a.element.find(".e-memberCurrentSearchPage").val(a._memberSearchPageSettings.currentMemberSearchPage),a._memberSearchPageSettings.currentMemberSearchPage>1?a.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"):a.element.find(".e-memberSearchPager").find(".e-prevPage, .e-firstPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"),a._memberSearchPageSettings.currentMemberSearchPage==parseInt(e.trim(a.element.find(".e-memberSearchPageCount").text().split("/")[1]))?a.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageEnabled").addClass("e-pageDisabled"):a.element.find(".e-memberSearchPager").find(".e-nextPage, .e-lastPage").removeClass("e-pageDisabled").addClass("e-pageEnabled"))):(a.element.find(".e-memberPager,.e-memberSearchPager,.e-memberDrillPager").css("display","none"),a.element.find(".e-dialogFooter").css("margin-top","5px")),p.length>0&&("All"==p[0].id&&p.splice(0,1),p.splice(0,0,{id:"SearchFilterSelection",name:a._getLocalizedLabels("AddCurrentSelectionToFilter"),checkedStatus:a._isSelectSearchFilter,tag:"SearchFilterSelection",spriteCssClass:"e-searchfilterselection",uniqueName:"Add current selection to filter"})),"ejPivotClient"==a.pluginName&&a.model.analysisMode==t.Pivot.AnalysisMode.Olap&&a.model.operationalMode==t.Pivot.OperationalMode.ServerMode?a._appendTreeViewData(p,a.element.find(".pvtBtn").parent("[data-tag='Slicers:"+a._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):r._createSearchTreeview(p,a)}else a._isSearchApplied=!1,a._isSelectSearchFilter=!0,o=!t.isNullOrUndefined(a._lastSavedTree)&&e.grep(a._lastSavedTree,function(e){return e.pid}).length>0,s.enableMemberEditorPaging&&a.element.find(".e-memberSearchPager").find(".e-nextPageDiv").length>0&&(a._editorSearchTreeData=[],""!=a.element.find(".e-memberPageCount").text()&&a.element.find(".e-memberPager").css("display","block"),a.element.find(".e-memberSearchPager").css("display","none")),o&&""!=a.element.find(".e-memberDrillPageCount").text()&&(a.element.find(".e-memberDrillPager").css("display","block"),a.element.find(".e-memberPager").css("display","none")),"ejPivotClient"==a.pluginName&&a.model.analysisMode==t.Pivot.AnalysisMode.Olap&&a.model.operationalMode==t.Pivot.OperationalMode.ServerMode?a._appendTreeViewData(s.enableMemberEditorPaging?o?t.DataManager(a._lastSavedTree).executeLocal(t.Query().sortBy("name",t.isNullOrUndefined(a._sortType)?"":a._sortType)):t.DataManager(a._editorTreeData).executeLocal(t.Query().where("pid","equal",l).page(a._memberPageSettings.currentMemeberPage,s.memberEditorPageSize).sortBy("name",t.isNullOrUndefined(a._sortType)?"":a._sortType)):a._editorTreeData,a.element.find(".pvtBtn").parent("[data-tag='Slicers:"+a._selectedFieldName.replace(/\[/g,"").replace(/\]/g,"")+"']").length>0):r._createSearchTreeview(s.enableMemberEditorPaging?o?t.DataManager(a._lastSavedTree).executeLocal(t.Query().sortBy("name",t.isNullOrUndefined(a._sortType)?"":a._sortType)):t.DataManager(a._editorTreeData).executeLocal(t.Query().where(t.Predicate("pid","equal",null).and("id","notequal","All").and("id","notequal","(All)_0")).page(a._memberPageSettings.currentMemeberPage,s.memberEditorPageSize).sortBy("name",t.isNullOrUndefined(a._sortType)?"":a._sortType)):a._editorTreeData,a);a._waitingPopup.hide(),a._parentNodeCollection={},a._parentSearchNodeCollection={}},0)}},_createSearchTreeview:function(i,l){"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.enableMemberEditorPaging:l.model.enableMemberEditorPaging;var a,r,n="ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.enableAdvancedFilter:l.model.enableAdvancedFilter,o="ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.enableMemberEditorSorting:l.model.enableMemberEditorSorting,s=l.element.find(".e-pvtBtn").parent("[data-tag='Slicers:"+(l._selectedFieldName||l._dialogHead)+"']").length>0,d=("ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.analysisMode:l.model.analysisMode,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.operationalMode:l.model.operationalMode);for(!l._isSearchApplied&&0==l._editorSearchTreeData.length&&i.length>0&&(l._lastSavedTree=i),i.length>0&&(i=t.DataManager(i).executeLocal(t.Query().where(t.Predicate("id","notequal","All").and("id","notequal","(All)_0")))).splice(0,0,{id:"All",name:n&&!s?"(Select All)":d==t.Pivot.OperationalMode.ServerMode?"(All)":"All",checkedStatus:l._isAllMemberChecked,_isAllMemberChecked:l._isAllMemberChecked}),l.element.find(".e-editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,enableRTL:l.model.enableRTL,beforeDelete:function(e){if(!t.isNullOrUndefined(e.event)&&"keydown"==e.event.type&&"delete"==e.event.originalEvent.key.toLowerCase())return!1},height:o?"200px":"245px",fields:{id:"id",text:"name",isChecked:"checkedStatus",parentId:"pid",expanded:"expanded",hasChild:"hasChildren",dataSource:t.Pivot._showEditorLinkPanel(i,l,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl:l)}}),a=l.element.find(".e-editorTreeView").find("li"),r=0;r<a.length;r++)t.isNullOrUndefined(e(a[r]).attr("id"))||e(a[r]).attr("data-tag",t.DataManager(i).executeLocal(t.Query().where("id","equal",e(a[r]).attr("id")))[0].tag);l._memberTreeObj=l.element.find(".e-editorTreeView").data("ejTreeView"),l._memberTreeObj.model.nodeCheck=t.proxy(l._nodeCheckChanges,l),l._memberTreeObj.model.nodeUncheck=t.proxy(l._nodeCheckChanges,l),"ejPivotGrid"==l.pluginName?l.model.operationalMode==t.Pivot.OperationalMode.ClientMode?l._memberTreeObj.model.beforeExpand=t.proxy(l._beforeNodeExpand,l):l._memberTreeObj.model.nodeClick=t.proxy(l._nodeExpand,l):(l.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?l._memberTreeObj.model.beforeExpand=t.proxy(l._beforeNodeExpand,l):l._memberTreeObj.model.nodeClick=t.proxy(l._nodeExpand,l),l._memberTreeObj.model.beforeCollapse=t.proxy(t.Pivot._onNodeCollapse,l)),t.isNullOrUndefined(l.element.find(".e-dialog .e-text:visible").first())||(l.element.find(".e-dialog .e-text:visible").length>0?(l.element.find(".e-dialog .e-text:visible").first().attr("tabindex","-1").addClass("e-hoverCell"),l.element.find(".e-dialog button").removeClass("e-hoverCell")):l.element.find(".e-dialog button:visible").first().attr("tabindex","-1").addClass("e-hoverCell")),0==l._memberTreeObj.element.find(".e-plus").length&&0==l._memberTreeObj.element.find(".e-minus").length&&l._memberTreeObj.element.find(".e-item").css("padding","0px"),l.model.enableMemberEditorSorting&&this._separateAllMember(l)},_separateAllMember:function(e){var i=e.element.hasClass("e-pivotclient")&&"servermode"==e.model.operationalMode&&"olap"==e.model.analysisMode,l="ejPivotSchemaDesigner"==e.pluginName?e.model.pivotControl.model.enableAdvancedFilter:e.model.enableAdvancedFilter,a="ejPivotSchemaDesigner"==e.pluginName?e.model.pivotControl.model.enableRTL:e.model.enableRTL,r="ejPivotSchemaDesigner"==e.pluginName?e.model.pivotControl.model.analysisMode:e.model.analysisMode,n=i?"":t.buildTag("div.e-checkAllBox",t.buildTag("input#allElement.allMember","",{float:a?"right":"left"},{name:"row",type:"checkbox",tabindex:0})[0].outerHTML+" "+t.buildTag("label.e-allElementLabel",l?"(Select All)":"All",{"margin-left":"5px"})[0].outerHTML,{width:"100px",float:a?"right":"left"})[0].outerHTML,o=t.buildTag("div.memberSortDiv",t.buildTag("div.e-icon e-memberAscendingIcon",{margin:"5px"})[0].outerHTML+t.buildTag("div.e-icon e-memberDescendingIcon")[0].outerHTML,{height:"35px","margin-left":"5px",float:a?"left":"right"})[0].outerHTML,s=t.buildTag("div.memberSortingDiv",n+o,{height:"20px",margin:"ejPivotSchemaDesigner"==e.pluginName?a?r==t.Pivot.AnalysisMode.Pivot?"10px 15px 0px 21px":"10px 31px 0px 12px":r==t.Pivot.AnalysisMode.Pivot?"10px 0px 0px 8px":"10px 0px 0px 20px":a?r==t.Pivot.AnalysisMode.Pivot?"10px 15px 0px 20px":"10px 28px 0px 20px":r==t.Pivot.AnalysisMode.Pivot?"10px 0px 0px 20px":"10px 0px 0px 29px"});l&&e.element.find(".e-editorTreeView").css("margin-top","10px"),e.element.find(".memberSortingDiv, .e-separateDiv").remove(),r==t.Pivot.AnalysisMode.Pivot&&e.element.find(".e-editorTreeView").addClass("e-treeViewUl"),i||e.element.find(".e-editorTreeView").before(s),("All"==e.element.find(".e-editorTreeView li:first").attr("id")||"(All)_0"==e.element.find(".e-editorTreeView li:first").attr("id"))&&e.element.find(".e-editorTreeView li:first").css("display","none"),i?(e.element.find(".memberSortDiv, .e-separateDiv").remove(),e.element.find(".e-checkOptions").after(t.buildTag("div.e-separateDiv",{margin:"0px 5px"})[0].outerHTML),e.element.find(".e-checkOptions").append(o),l&&e.element.find(".e-editorTreeView").height(235)):(e.element.find(".memberSortingDiv").after(t.buildTag("div.e-separateDiv",{})[0].outerHTML),e.element.find(".allMember").ejCheckBox({size:"small",width:"40px",checked:"disabled"!=e.element.find(".e-dialogOKBtn").attr("disabled"),change:t.proxy(e._nodeCheckChanges,e)})),"ascending"==e._sortType?e.element.find(".e-memberAscendingIcon").addClass("e-selectedSort"):"descending"==e._sortType&&e.element.find(".e-memberDescendingIcon").addClass("e-selectedSort")},_checkChanges:function(e){var t="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl:this;e.isChecked?t._nodeCheckChanges(e):e.isChecked||t._nodeUnCheckChanges(e)},_fetchMemberPageSuccess:function(i){var a,r="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl:this;i[0]!=l&&i.length>0?(a=i[0].Value,null!=i[1]&&i[1]!=l&&(this.model.customObject=i[1].Value)):i.d!=l&&i.d.length>0?(a=i.d[0].Value,null!=i.d[1]&&i.d[1]!=l&&(this.model.customObject=i.d[1].Value)):i!=l&&i.length>0?(a=i.EditorTreeInfo,null!=i&&i.customObject!=l&&(this.model.customObject=i.customObject)):i!=l&&(a=i.EditorTreeInfo,null!=i&&i.customObject!=l&&(this.model.customObject=i.customObject)),this._memberPageSettings.endPage="ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl.model.memberEditorPageSize:this.model.memberEditorPageSize,this._memberPageSettings.startPage=0,this._memberPageSettings.currentMemeberPage=1,filteredData=JSON.parse(a),this._editorTreeData=e.extend(!0,[],filteredData),r.model.enableAdvancedFilter&&(this._editorTreeData=e.map(this._editorTreeData,function(e){if(t.isNullOrUndefined(e.levels))return e})),("ejPivotSchemaDesigner"==this.pluginName&&this.model.pivotControl&&this.model.pivotControl.model.enableAdvancedFilter&&this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||"ejPivotGrid"==this.pluginName&&this.model.enableAdvancedFilter&&this.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)&&(this._memberPagingAvdData=filteredData.splice(filteredData.length-1,1)),this._memberCount=t.DataManager(this._editorTreeData).executeLocal(t.Query().where(t.Predicate("pid","equal",null).and("id","notequal","All").and("id","notequal","(All)_0"))).length,filteredData=t.DataManager(this._editorTreeData).executeLocal(t.Query().where("pid","equal",l).page(this._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==this.pluginName?this.model.pivotControl.model.memberEditorPageSize+1:this.model.memberEditorPageSize+1)),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(filteredData)})},_memberPageNodeUncheck:function(i,l){var a,r="",n=null,o="ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.enableMemberEditorPaging:l.model.enableMemberEditorPaging;e(i.currentElement).parent().parent().hasClass("e-editorTreeView")&&!l._isSearchApplied&&o?(r=t.DataManager(l._editorTreeData).executeLocal(t.Query().page(l._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize+1:l.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(l._editorSearchTreeData)||(n=t.DataManager(l._editorSearchTreeData).executeLocal(t.Query().page(l._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize+1:l.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0])):(r=t.DataManager(l._editorTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(l._editorSearchTreeData)||(n=t.DataManager(l._editorSearchTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0])),t.isNullOrUndefined(r)||(r.checkedStatus=!1,t.isNullOrUndefined(r.pid)||(a=t.DataManager(l._editorTreeData).executeLocal(t.Query().where("pid","equal",r.pid).where("checkedStatus","equal",!0)),t.isNullOrUndefined(a)||0!=a.length||t.Pivot._unSelectParentTreeNode(r,l)),a=t.DataManager(l._editorTreeData).executeLocal(t.Query().where("pid","equal",r.id)),!t.isNullOrUndefined(a)&&a.length>0&&t.Pivot._unSelectChildTreeNode(r,l)),t.isNullOrUndefined(n)||(n.checkedStatus=!1,t.isNullOrUndefined(n.pid)||(a=t.DataManager(l._editorSearchTreeData).executeLocal(t.Query().where("pid","equal",n.pid).where("checkedStatus","equal",!0)),t.isNullOrUndefined(a)||0!=a.length||t.Pivot._unSelectParentTreeNode(n,l)),a=t.DataManager(l._editorSearchTreeData).executeLocal(t.Query().where("pid","equal",r.id)),!t.isNullOrUndefined(a)&&a.length>0&&t.Pivot._unSelectChildTreeNode(n,l))},_memberPageNodeCheck:function(i,l){var a,r,n="",o=null,s="ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.enableMemberEditorPaging:l.model.enableMemberEditorPaging;if(e(i.currentElement).parent().parent().hasClass("e-editorTreeView")&&!l._isSearchApplied&&s?(n=t.DataManager(l._editorTreeData).executeLocal(t.Query().page(l._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize+1:l.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(l._editorSearchTreeData)||(o=t.DataManager(l._editorSearchTreeData).executeLocal(t.Query().page(l._memberPageSettings.currentMemeberPage,"ejPivotSchemaDesigner"==l.pluginName?l.model.pivotControl.model.memberEditorPageSize+1:l.model.memberEditorPageSize+1).where("id","equal",i.currentElement.attr("id")))[0])):(n=t.DataManager(l._editorTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0],t.isNullOrUndefined(l._editorSearchTreeData)||(o=t.DataManager(l._editorSearchTreeData).executeLocal(t.Query().where("id","equal",i.currentElement.attr("id")))[0])),!t.isNullOrUndefined(n)&&(n.checkedStatus=!0,t.isNullOrUndefined(n.pid)||t.Pivot._selectParentTreeNode(n,l),!t.isNullOrUndefined(n.id)&&(a=t.DataManager(l._editorTreeData).executeLocal(t.Query().where("pid","equal",n.id)),!t.isNullOrUndefined(a)&&a.length>0)))for(r=0;r<a.length;r++)a[r].checkedStatus=!0,(a[r].expanded||a[r].isChildMerged)&&t.Pivot._selectChildTreeNode(a[r],l);if(!t.isNullOrUndefined(o)&&(o.checkedStatus=!0,t.isNullOrUndefined(o.pid)||t.Pivot._selectParentTreeNode(o,l),!t.isNullOrUndefined(o.id)&&(a=t.DataManager(l._editorSearchTreeData).executeLocal(t.Query().where("pid","equal",o.id)),!t.isNullOrUndefined(a)&&a.length>0)))for(r=0;r<a.length;r++)a[r].checkedStatus=!0,t.Pivot._selectChildTreeNode(a[r],l)},_appendParentNodes:function(e,i,l){var a,r;t.isNullOrUndefined(i.pid)||(t.isNullOrUndefined(l._parentNodeCollection[i.pid])?(a=jQuery.extend(!0,[],t.DataManager(l._editorTreeData).executeLocal(t.Query().where("id","equal",i.pid))),l._parentNodeCollection[i.pid]=a):a=l._parentNodeCollection[i.pid],!t.isNullOrUndefined(a)&&a.length>0&&(t.isNullOrUndefined(l._parentSearchNodeCollection[a[0].id])?(r=jQuery.extend(!0,[],t.DataManager(e).executeLocal(t.Query().where("id","equal",a[0].id))),l._parentSearchNodeCollection[a[0].id]=a):r=l._parentSearchNodeCollection[a[0].id]),t.isNullOrUndefined(r)||(0==r.length?(a[0].expanded=!0,e.push(a[0]),t.isNullOrUndefined(a[0].pid)||this._appendParentNodes(e,a[0],l)):r[0].expanded=!0))},_selectParentTreeNode:function(e,i){var l=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("id","equal",e.pid));!t.isNullOrUndefined(l)&&l.length>0&&(l[0].checkedStatus=!0,this._selectParentTreeNode(l[0],i))},_selectChildTreeNode:function(e,i){var l,a=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",e.id));if(!t.isNullOrUndefined(a)&&a.length>0)for(l=0;l<a.length;l++)a[l].checkedStatus=!0,(a[l].expanded||a[l].isChildMerged)&&this._selectChildTreeNode(a[l],i)},_unSelectChildTreeNode:function(e,i){var l,a=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",e.id));if(!t.isNullOrUndefined(a)&&a.length>0)for(l=0;l<a.length;l++)a[l].checkedStatus=!1,(a[l].expanded||a[l].isChildMerged)&&this._unSelectChildTreeNode(a[l],i)},_unSelectParentTreeNode:function(e,i){var l=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("id","equal",e.pid));!t.isNullOrUndefined(l)&&l.length>0&&(l[0].checkedStatus=!1,0==t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",l[0].pid).where("checkedStatus","equal",!0)).length&&this._unSelectParentTreeNode(l[0],i))},_getSelectedTreeState:function(e,i){var a,r,n,o,s,d;if(e){for(s=[],a=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",l)),d=0;d<a.length;d++){if(r=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",a[d].id)),n={caption:a[d].name,parentId:t.isNullOrUndefined(a[d].pid)?"None":a[d].pid,id:a[d].id,checked:a[d].checkedStatus,expanded:r.length>0,childNodes:[],tag:a[d].tag},r.length>0)for(o=0;o<r.length;o++)n.childNodes.push(this._getEditorSlicerInfo(r[o],i));s.push(n)}return JSON.stringify(s)}for(s="",d=0;d<i._editorTreeData.length;d++)1==i._editorTreeData[d].checkedStatus&&(s+="::"+i._editorTreeData[d].id+"||"+i._editorTreeData[d].tag);return s},_getUnSelectedTreeState:function(e){for(var t="",i=0;i<e._editorTreeData.length;i++)0==e._editorTreeData[i].checkedStatus&&(t+="::"+e._editorTreeData[i].id+"||"+e._editorTreeData[i].tag);return t},_getEditorSlicerInfo:function(e,i){var l,a=t.DataManager(i._editorTreeData).executeLocal(t.Query().where("pid","equal",e.id)),r={caption:e.name,parentId:t.isNullOrUndefined(e.pid)?"None":e.pid,id:e.id,checked:e.checkedStatus,expanded:a.length>0,childNodes:[],tag:e.tag};if(a.length>0)for(l=0;l<a.length;l++)r.childNodes.push(this._getEditorSlicerInfo(a[l],i));return r},_editorLinkPanelClick:function(){this.element.find(".e-dialog").hide(),t.Pivot._createErrorDialog(this._getLocalizedLabels("EditorLinkPanelAlert").split("1000").join(this.model.maxNodeLimitInMemberEditor),this._getLocalizedLabels("Warning"),this)},_showEditorLinkPanel:function(i,l,a){var r,n;if(!a.model.enableMemberEditorPaging&&(a.model.analysisMode!=t.Pivot.AnalysisMode.Pivot||l._isSearchApplied||(l._editorTreeData=i),i.length>a.model.maxNodeLimitInMemberEditor+(l._isSearchApplied?1:0))){var o=[],s={},d={},u=!1;for(r=0;r<i.length;r++)t.isNullOrUndefined(s[i[r].pid])?(t.isNullOrUndefined(i[r].pid)||(n=e.grep(i,function(e){if(e.id==i[r].pid)return e})).length>0&&(d[i[r].pid]=!!n[0].expanded),s[i[r].pid]=1):s[i[r].pid]++,s[i[r].pid]<=a.model.maxNodeLimitInMemberEditor+(l._isSearchApplied&&t.isNullOrUndefined(i[r].pid)?1:0)?o.push(i[r]):(t.isNullOrUndefined(d[i[r].pid])||d[i[r].pid])&&(u=!0);i=o,u&&l.element.find("div.e-linkOuterPanel").css("display","block")}return i},createErrorDialog:function(i){var l,a;t.Pivot.openPreventPanel(i),0==i.element.find(".e-errorDialog").length?(a=t.buildTag("div.e-errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent",i._getLocalizedLabels("AlertMsg"))[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title",i._getLocalizedLabels("Warning"))[0].outerHTML,i.element.append(a),i.element.find(".e-errorDialog").ejDialog({target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,width:"400px"}),l=i.element.find(".e-errorDialog").data("ejDialog"),e("#"+l._id+"_wrapper").css({left:"50%",top:"50%"}),i.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(t.Pivot.errOKBtnClick,i)}),i.element.find(".e-dialog .e-close").attr("title",i._getLocalizedLabels("Close"))):(l=i.element.find(".e-errorDialog").data("ejDialog")).open()},errOKBtnClick:function(){this.element.find("#preventDiv").remove(),this.element.find(".e-errorDialog").data("ejDialog")._ejDialog.find("div.e-dialog-icon").trigger("click")},doAjaxPost:function(i,a,r,n,o,s){var d,u,c,p=!0;r.XMLA==l?(d="application/json; charset=utf-8",u="json",c=e.proxy(n,this)):(d="text/xml",u="xml",r=r.XMLA,c=e.proxy(n,t.olap.base,s),p=!("msie"==t.browserInfo().name&&t.browserInfo().version<=9)&&(!t.isNullOrUndefined(s)&&"loadFieldElements"!=s.action)),e.ajax({type:i,url:a,contentType:d,async:p,dataType:u,data:r,success:c,complete:t.proxy(function(t){e.proxy(t,this);this._currentAction,this.element},this),error:t.proxy(function(e){void 0!==this._ogridWaitingPopup&&null!=this._ogridWaitingPopup&&this._ogridWaitingPopup.hide(),"undefined"!=typeof oclientWaitingPopup&&null!=oclientWaitingPopup&&oclientWaitingPopup.hide();var t={action:""!=this._drillAction?this._drillAction:"initialize",customObject:"",element:this.element,Message:e};this._trigger("renderFailure",t),this.renderControlFromJSON(""),"XMLA"==this._dataModel&&this._createErrorDialog(e.statusText,this._getLocalizedLabels("Error")),e.statusText},this)})},getCubeList:function(t,i){for(var l,a=[],r=0;r<e(i).find("row").length;r++)l=e(e(i).find("row")[r]),a.push({name:e(l).children("CUBE_NAME").text()});t.pvtCtrldObj.setCubeList(a)},generateTreeViewData:function(e){var t={catalog:e.model.pivotControl.model.dataSource.catalog,cube:e.model.pivotControl.model.dataSource.cube,url:e.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this._getTreeData(t,this.loadDimensionElements,{schemaData:e,action:"loadFieldElements"})},loadDimensionElements:function(i,a){var r,n=i.schemaData.model.pivotControl,o={},s=(t.olap.base._getConnectionInfo(n.model.dataSource.data),{}),d=n.model.dataSource.providerName==t.olap.Providers.Mondrian;for(s={catalog:n.model.dataSource.catalog,cube:n.model.dataSource.cube,url:n.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},n.schemaTreeView=[],n.reportItemNames=[],r=0;r<e(a).find("row").length;r++){var u=e(e(a).find("row")[r]),c=u.find("DIMENSION_UNIQUE_NAME").text(),p=u.find("DIMENSION_CAPTION").text();c.toLowerCase().indexOf("[measure")>=0?o={hasChildren:!0,isSelected:!1,id:c,name:p,spriteCssClass:"[measures]"==c.toLowerCase()?"e-folderCDB e-icon":"e-dimensionCDB e-icon",tag:c}:!e(e(a).find("row")[0]).find("HIERARCHY_CAPTION").length>0&&n.schemaTreeView.push({hasChildren:!0,isSelected:!1,id:d?c+"~#^Dim":c,name:p,spriteCssClass:"e-dimensionCDB e-icon",tag:c,defaultHierarchy:e(e(a).find("row")[r]).children("DEFAULT_HIERARCHY").text()})}n.schemaTreeView.splice(0,0,o),!n.model.enableDrillThrough||i.schemaData!=l&&i.schemaData.model.olap.showNamedSets?(s.request="MDSCHEMA_SETS",t.Pivot._getTreeData(s,t.Pivot.loadNamedSetElements,i)):(s.request="MDSCHEMA_HIERARCHIES",(t.isNullOrUndefined(n._fieldData)||!t.isNullOrUndefined(n._fieldData)&&t.isNullOrUndefined(n._fieldData.hierarchy))&&this._getFieldItemsInfo(n),n._fieldData.hierarchySuccess==l?t.Pivot._getTreeData(s,n.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,n._fieldData.hierarchySuccess))},loadNamedSetElements:function(i,a){var r,n,o,s=i.schemaData.model.pivotControl,d={catalog:s.model.dataSource.catalog,cube:s.model.dataSource.cube,url:s.model.dataSource.data,request:"MDSCHEMA_HIERARCHIES"},u=(a=s.model.dataSource,[]);for(r=e.map(a.rows,function(e){if(e.fieldName!=l)return e.fieldName}),e.merge(r,e.map(a.columns,function(e){if(e.fieldName!=l)return e.fieldName})),e.merge(r,e.map(a.filters,function(e){if(e.fieldName!=l)return e.fieldName})),n=0;n<e(a).find("row").length;n++)o=e(e(a).find("row")[n]),e.inArray(o.find("DIMENSIONS").text().split(".")[0],u)>=0||(s.schemaTreeView.push({hasChildren:!0,isSelected:!1,pid:o.find("DIMENSIONS").text().split(".")[0],id:o.find("SET_DISPLAY_FOLDER").text()+"_"+o.find("DIMENSIONS").text().split(".")[0],name:o.find("SET_DISPLAY_FOLDER").text(),spriteCssClass:"e-folderCDB e-icon namedSets"}),u.push(o.find("DIMENSIONS").text().split(".")[0])),s.schemaTreeView.push({hasChildren:!0,isSelected:e.inArray("["+e.trim(o.children("SET_NAME").text())+"]",r)>=0,pid:o.find("SET_DISPLAY_FOLDER").text()+"_"+o.find("DIMENSIONS").text().split(".")[0],id:"["+e.trim(o.children("SET_NAME").text()).replace(/\&/g,"&amp;")+"]",name:o.children("SET_CAPTION").text(),spriteCssClass:"e-namedSetCDB e-icon",tag:o.find("EXPRESSION").text()});t.isNullOrUndefined(s._fieldData)||s._fieldData.hierarchySuccess==l?t.Pivot._getTreeData(d,t.Pivot.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,s._fieldData.hierarchySuccess)},loadHierarchyElements:function(i,a){var r,n,o=i.schemaData.model.pivotControl,s={catalog:o.model.dataSource.catalog,cube:o.model.dataSource.cube,url:o.model.dataSource.data,request:"MDSCHEMA_LEVELS"},d=o.model.dataSource,u=o.model.dataSource.providerName==t.olap.Providers.Mondrian;for(r=e.map(d.rows,function(e){if(e.fieldName!=l)return e.fieldName}),e.merge(r,e.map(d.columns,function(e){if(e.fieldName!=l)return e.fieldName})),e.merge(r,e.map(d.filters,function(e){if(e.fieldName!=l)return e.fieldName})),n=0;n<e(a).find("row").length;n++){var c=e(e(a).find("row")[n]),p=c.find("DIMENSION_UNIQUE_NAME").text(),h=c.find("HIERARCHY_UNIQUE_NAME").text();e(o.schemaTreeView).filter(function(e,t){return t.tag==p}).map(function(e,t){return t}).length>0&&(p!=h||u)&&o.schemaTreeView.push({hasChildren:!0,isSelected:e.inArray(h,r)>=0,pid:p+(u?"~#^Dim":""),id:h,name:c.find("HIERARCHY_CAPTION").text(),spriteCssClass:"2"!=c.find("HIERARCHY_ORIGIN").text()&&"6"!=c.find("HIERARCHY_ORIGIN").text()?"e-hierarchyCDB e-icon":"e-attributeCDB e-icon",tag:h})}t.Pivot._getTreeData(s,t.Pivot.loadLevelElements,i)},loadLevelElements:function(i,l){var a,r=i.schemaData.model.pivotControl,n=e.map(e(l).find("row"),function(t){if("1"!=parseInt(e(t).children("LEVEL_TYPE").text())&&"[measures]"!=e(t).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase())return{hasChildren:!1,isChecked:!1,id:e(t).find("LEVEL_UNIQUE_NAME").text(),pid:e(t).find("HIERARCHY_UNIQUE_NAME").text(),name:e(t).find("LEVEL_CAPTION").text(),tag:e(t).find("LEVEL_UNIQUE_NAME").text(),spriteCssClass:"e-level"+parseInt(e(t).children("LEVEL_NUMBER").text())+" e-icon"}});e.merge(r.schemaTreeView,n),(!r.model.enableDrillThrough||r._fieldData.measureSuccess)&&(t.isNullOrUndefined(r._fieldData)||!r._fieldData.measureSuccess?(a={catalog:r.model.dataSource.catalog,cube:r.model.dataSource.cube,url:r.model.dataSource.data,request:"MDSCHEMA_MEASURES"},t.Pivot._getTreeData(a,t.Pivot.loadMeasureElements,i)):t.Pivot.loadMeasureElements(i,r._fieldData.measureSuccess))},loadMeasureGroups:function(i,l){t.isNullOrUndefined(i.pivotControl._fieldData)&&(i.pivotControl._fieldData={}),i.pivotControl._fieldData.measuresGroups=e(l).find("row")},loadMeasureElements:function(i,a){var r,n,o,s,d=i.schemaData.model.pivotControl,u={catalog:d.model.dataSource.catalog,cube:d.model.dataSource.cube,url:d.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},c=[];r=e.map(d.model.dataSource.values,function(e){if(e.measures!=l)return e.measures}),d.reportItemNames=e.map(r,function(e){if(e.fieldName!=l)return e.fieldName}),"en-US"!=d.model.locale&&(u={catalog:d.model.dataSource.catalog,cube:d.model.dataSource.cube,url:d.model.dataSource.data,request:"MDSCHEMA_MEASUREGROUPS"},t.Pivot._getTreeData(u,t.Pivot.loadMeasureGroups,{pivotControl:d,action:"loadFieldElements"}));var p,h,g,m=[],f=[],_=[],v=[],b=[];if("ejPivotClient"==d.pluginName&&(d.model.sortCubeMeasures==t.PivotAnalysis.SortOrder.Ascending||d.model.sortCubeMeasures==t.PivotAnalysis.SortOrder.Descending)&&d.model.sortCubeMeasures!=t.PivotAnalysis.SortOrder.None){for(sortType=d.model.sortCubeMeasures==t.PivotAnalysis.SortOrder.Ascending?"ascending":"descending",o=0;o<e(a).find("row").length;o++)f.push({name:e(a).find("row:eq("+o+") MEASURE_CAPTION").text()});for(h=t.DataManager(f).executeLocal(t.Query().sortBy("name",sortType)),e.each(h,function(t,i){for(var l=0;l<e(a).find("row").length;l++)i.name==e(a).find("row:eq("+l+") MEASURE_CAPTION").text()&&_.push(e(a).find("row:eq("+l+")"))}),o=0;o<_.length;o++)e.inArray(e(_[o]).children("MEASUREGROUP_NAME").text(),m)>=0||(m.push(e(_[o]).children("MEASUREGROUP_NAME").text()),v.push({name:e(_[o]).children("MEASUREGROUP_NAME").text()}));p=t.DataManager(v).executeLocal(t.Query().sortBy("name",sortType)),e.each(p,function(t,i){for(var l=0;l<_.length;l++)i.name==e(_[l]).children("MEASUREGROUP_NAME").text()&&b.push(e(_[l]))}),g=b}else g=e(a).find("row");for(o=0;o<g.length;o++){var C=e(g[o]),S=C.children("MEASUREGROUP_NAME").text(),P=C.find("MEASURE_UNIQUE_NAME").text();e.inArray(S,c)>=0||("en-US"!=d.model.locale?n=(s=e.map(d._fieldData.measuresGroups,function(t){if(e(t).children("MEASUREGROUP_NAME").text()==S)return e(t).children("MEASUREGROUP_CAPTION").text()})).length>0?s[0]:S:n=S,""!=S&&d.schemaTreeView.push({hasChildren:!0,isChecked:!1,pid:"[Measures]",id:S,name:n,spriteCssClass:"e-measureGroupCDB e-icon",tag:S}),c.push(S)),d.schemaTreeView.push({hasChildren:!0,isSelected:e.inArray(P,d.reportItemNames)>=0,id:P,pid:""==S?"[Measures]":S,name:C.children("MEASURE_CAPTION").text(),spriteCssClass:"measure",tag:P}),e.inArray(P,d.reportItemNames)>=0&&d.reportItemNames.splice(d.reportItemNames.indexOf(P),1)}t.isNullOrUndefined(i.schemaData)||!i.schemaData.model.olap.showKpi&&!d.model.enableKPI?t.isNullOrUndefined(i.schemaData)||i.schemaData._createTreeView(this,d.schemaTreeView):(treeNodeElement={hasChildren:!0,isChecked:!1,id:"folderStruct",name:"KPI",spriteCssClass:"kpiCDB e-folderCDB e-icon",tag:""},d.schemaTreeView.splice(1,0,treeNodeElement),u.request="MDSCHEMA_KPIS",t.Pivot._getTreeData(u,t.Pivot.loadKPIElements,i))},loadKPIElements:function(t,i){for(var l=t.schemaData.model.pivotControl,a=this.reportItemNames,r=[],n=0;n<e(i).find("row").length;n++){var o=e(e(i).find("row")[n]),s=o.children("KPI_CAPTION").text(),d=o.children("KPI_goal").text(),u=o.children("KPI_STATUS").text(),c=o.children("KPI_TREND").text(),p=o.find("KPI_VALUE").text();e.inArray(o.children("KPI_NAME").text(),r)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"folderStruct",id:s,name:s,spriteCssClass:"e-measureGroupCDB e-icon",tag:s},l.schemaTreeView.push(treeNodeElement),r.push(s)),treeNodeElement={hasChildren:!0,isSelected:e.inArray(d,a)>=0,id:d,pid:s,name:l.model.enableKPI?"Goal":l._getLocalizedLabels("Goal"),spriteCssClass:"kpiGoal e-icon",tag:d},l.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(u,a)>=0,id:u,pid:s,name:l.model.enableKPI?"Status":l._getLocalizedLabels("Status"),spriteCssClass:"kpiStatus e-icon",tag:u},l.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(c,a)>=0,id:c,pid:s,name:l.model.enableKPI?"Trend":l._getLocalizedLabels("Trend"),spriteCssClass:"kpiTrend e-icon",tag:c},l.schemaTreeView.push(treeNodeElement),treeNodeElement={hasChildren:!0,isSelected:e.inArray(p,a)>=0,id:p,pid:s,name:l.model.enableKPI?"Value":l._getLocalizedLabels("Value"),spriteCssClass:"kpiValue e-icon",tag:p},l.schemaTreeView.push(treeNodeElement)}t.schemaData._createTreeView(this,l.schemaTreeView),delete l.reportItemNames,delete l.schemaTreeView},_createCalcMemberDialog:function(i,a){var r,n,o,s,d,u,c,p;a=t.isNullOrUndefined(a.model)?this:a;r=i.length>1&&i[0]!=l?JSON.parse(i[0].Value):i.d!=l?JSON.parse(i.d[0].Value):JSON.parse(i.CubeTreeInfo),null!=a.model.afterServiceInvoke&&a._trigger("afterServiceInvoke",{action:"fetchCalcMemberTreeView",element:a.element,customObject:a.model.customObject}),t.Pivot.openPreventPanel(a),a.element.find(".e-calcMemberDialog",".e-clientDialog",".e-dialog").remove();var h=t.buildTag("div.e-cubeBrowserCalcMember",t.buildTag("div#"+a._id+"_cubeTreeViewCalcMember.e-cubeTreeViewCalcMember")[0].outerHTML,{})[0].outerHTML,g=t.buildTag("label.lblCaption",a._getLocalizedLabels("Caption"),{})[0].outerHTML+t.buildTag("input#"+a._id+"_captionFieldCM.captionFieldCM","",{}).attr("aria-label",a._getLocalizedLabels("Caption"))[0].outerHTML,m=t.buildTag("label.lblexpression",a._getLocalizedLabels("Expression"),{})[0].outerHTML+t.buildTag("textarea#"+a._id+"_expressionFieldCM.e-textarea e-droppable expressionFieldCM"+(a.model.enableRTL?" e-rtl":""),"",{}).attr("aria-label",a._getLocalizedLabels("Expression"))[0].outerHTML,f=t.buildTag("label.lblmemberType",a._getLocalizedLabels("MemberType"),{})[0].outerHTML+t.buildTag("input#"+a._id+"_memberTypeFieldCM.memberTypeFieldCM","",{}).attr("aria-label",a._getLocalizedLabels("MemberType"))[0].outerHTML+t.buildTag("input#"+a._id+"_dimensionFieldCM.dimensionFieldCM","",{}).attr("aria-label","dimension")[0].outerHTML,_=t.buildTag("label.lblformat",a._getLocalizedLabels("FormatString"),{})[0].outerHTML+t.buildTag("input#"+a._id+"_formatFieldCM.formatFieldCM","",{}).attr("aria-label",a._getLocalizedLabels("FormatString"))[0].outerHTML+t.buildTag("input#"+a._id+"_customFormatFieldCM.customFormatFieldCM","",{}).attr("aria-label","custom format")[0].outerHTML,v=t.buildTag("div.e-calcMemberFieldPanel",g+m+f+_,{})[0].outerHTML,b=t.buildTag("button#"+a._id+"_btnOk.e-btnCalcMemberOk",a._getLocalizedLabels("OK"),{},{name:a._getLocalizedLabels("OK")}).attr("aria-label",a._getLocalizedLabels("OK")).attr("title",a._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,C=t.buildTag("button#"+a._id+"_btnCancel.btnCalcMemberCancel",a._getLocalizedLabels("Cancel"),{},{name:a._getLocalizedLabels("Cancel")}).attr("aria-label",a._getLocalizedLabels("Cancel")).attr("title",a._getLocalizedLabels("Cancel").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,S=t.buildTag("div.e-calcMemberFooter",b+C,{})[0].outerHTML;for(a._calcMemberDialog=t.buildTag("div#"+a._id+"_calcMemberDialog",h+v+S,{})[0].outerHTML,e(a._calcMemberDialog).appendTo("#"+a._id),e("#"+a._id+"_calcMemberDialog").ejDialog({width:"auto",title:a._getLocalizedLabels("CalculatedMember"),cssClass:a.model.cssClass+" e-calcMemberDialog",enableModal:!1,target:"#"+a._id,enableRTL:a.model.enableRTL,enableResize:!1,close:t.proxy(function(){t.Pivot.closePreventPanel(a)},a),beforeOpen:t.proxy(function(){a.element.find(".e-calcMemberDialog .e-dialog").css("display","block")},a)}),a._calcMemberDialog=a.element.find("#"+a._id+"_calcMemberDialog").data("ejDialog"),e("#"+a._id+"_btnCancel").ejButton({type:t.ButtonType.Button,width:"80px",enableRTL:a.model.enableRTL,click:t.proxy(function(){a._calcMemberDialog.close(),a._selectedCalcMember=null,t.Pivot.closePreventPanel(a)},a)}),e("#"+a._id+"_btnOk").ejButton({type:t.ButtonType.Button,width:"80px",enableRTL:a.model.enableRTL,click:t.proxy(function(){var i,l,r,n,o,s,d;if(""!=e.trim(a.element.find("#"+a._id+"_captionFieldCM").val())&&""!=e.trim(a.element.find("#"+a._id+"_expressionFieldCM").val()))if("Custom"!=a.element.find("#"+a._id+"_formatFieldCM").val()||""!=e.trim(a.element.find("#"+a._id+"_customFormatFieldCM").val())){if(t.isNullOrUndefined(a._selectedCalcMember))for(i=0;i<a._calcMembers.length;i++)if(e.trim(a.element.find("#"+a._id+"_captionFieldCM").val()).toLowerCase()==a._calcMembers[i].name.toLowerCase()){if(!confirm(a._getLocalizedLabels("Confirm")))return;a._selectedCalcMember=e.trim(a.element.find("#"+a._id+"_captionFieldCM").val())}if(a._calcMemberDialog.close(),t.Pivot.closePreventPanel(a),l="",t.isNullOrUndefined(a._selectedCalcMember)||(o=t.DataManager(a._calcMembers).executeLocal(t.Query().where("name","equal",a._selectedCalcMember,!0)),!t.isNullOrUndefined(o)&&o.length>0&&(l=o[0].tag)),a._waitingPopup.show(),r={action:"calculatedMember",olapReport:a.currentReport,clientReports:a.reports,caption:a.currentCubeName+"%"+e.trim(a.element.find("#"+a._id+"_captionFieldCM").val()),expression:e.trim(a.element.find("#"+a._id+"_expressionFieldCM").val()),memberType:a.element.find("#"+a._id+"_memberTypeFieldCM").val(),dimension:a.element.find("#"+a._id+"_dimensionFieldCM").val(),formatString:"Custom"==a.element.find("#"+a._id+"_formatFieldCM").val()?e.trim(a.element.find("#"+a._id+"_customFormatFieldCM").val()):a.element.find("#"+a._id+"_formatFieldCM").val(),uniqueName:l,customObject:a.model.customObject},a.model.operationalMode==t.Pivot.OperationalMode.ServerMode)a.doAjaxPost("POST",a.model.url+"/"+a.model.serviceMethodSettings.calculatedMember,JSON.stringify(r),a._calcMemberDroppedSuccess);else{r.caption=r.caption.replace("%",""),n="",n=r.memberType.toLowerCase().indexOf("measure")>-1?"[Measures].["+e.trim(r.caption)+"]":e(jQuery("[id*='["+r.dimension+"]']")[0]).attr("data-defaulthierarchy")+".["+e.trim(r.caption)+"]",o={caption:r.caption,expression:r.expression,tag:n,hierarchyUniqueName:"["+e.trim(r.dimension)+"].["+e.trim(r.dimension)+"]",memberType:r.memberType,formatString:r.formatString?r.formatString:r.format?r.format:null},-1==r.memberType.toLowerCase().indexOf("measure")&&null!=a._selectedCalcMember&&(t.Pivot.getReportItemByFieldName(this._schemaData._selectedFieldName,this.model.dataSource).item.hierarchyUniqueName=o.hierarchyUniqueName),a._selectedCalcMember=null;var u={id:r.caption,pid:"_0",name:r.caption,hasChildren:!1,spriteCssClass:"e-calcMemberCDB e-icon",tag:n,expression:r.expression,formatString:null,nodeType:0,hierarchyUniqueName:"Measure"==r.memberType?"":o.hierarchyUniqueName},c=!1,p=o.caption;a.model.calculatedMembers=e.grep(a.model.calculatedMembers,function(e){return e.caption==p&&(c=!0,e.caption=o.caption,e.expression=o.expression,e.hierarchyUniqueName=o.hierarchyUniqueName,e.memberType=r.memberType,e.formatString=r.formatString),e}),"_0"!=(s=a.element.find(".e-schemaFieldTree").data("ejTreeView").model.fields).dataSource[0].id&&s.dataSource.splice(0,0,{id:"_0",name:"Calculated Members",hasChildren:!0,spriteCssClass:"e-calcMemberGroupCDB e-icon",tag:""}),c?(d=this._schemaData._selectedFieldName,s.dataSource=e.grep(s.dataSource,function(e){return e.id==d&&(e.expression=o.expression,e.hierarchyUniqueName=o.hierarchyUniqueName,e.expression=o.expression,e.memberType=o.memberType,e.formatString=o.formatString),e})):a.model.calculatedMembers.push(o),c?a.refreshControl():s.dataSource.push(u),t.Pivot._refreshFieldList(a)}}else t.Pivot._createErrorDialog(a._getLocalizedLabels("EmptyFormat"),a._getLocalizedLabels("Warning"),a);else t.Pivot._createErrorDialog(a._getLocalizedLabels("EmptyField"),a._getLocalizedLabels("Warning"),a)},a)}),a.element.find("#"+a._id+"_cubeTreeViewCalcMember").ejTreeView({fields:{id:"id",parentId:"pid",text:"name",spriteCssClass:"spriteCssClass",dataSource:r},allowDragAndDrop:!0,enableRTL:a.model.enableRTL,allowDropChild:!1,allowDropSibling:!1,dragAndDropAcrossControl:!0,cssClass:"calcMemberTreeViewDragedNode",nodeDropped:t.proxy(function(t){null!=t.target&&t.target.attr("id")==a._id+"_expressionFieldCM"&&a.element.find("#"+a._id+"_expressionFieldCM").val(a.element.find("#"+a._id+"_expressionFieldCM").val()+e(t.droppedElement).attr("data-tag"))},a),beforeExpand:t.proxy(t.Pivot._getMemberChildNodes,a)}),a.element.find("#"+a._id+"_captionFieldCM").ejMaskEdit({name:"inputbox",inputMode:t.InputMode.Text,watermarkText:"",maskFormat:"",textAlign:a.model.enableRTL?"right":"left",width:"100%"}),a.element.find("#"+a._id+"_customFormatFieldCM").ejMaskEdit({name:"inputbox",inputMode:t.InputMode.Text,watermarkText:"",maskFormat:"",textAlign:a.model.enableRTL?"right":"left",width:"100%",cssClass:"e-calcMemberCustomFormat"}),a.element.find(".e-calcMemberCustomFormat").css("visibility","hidden"),a.element.find("#"+a._id+"_memberTypeFieldCM").ejDropDownList({dataSource:[{text:"Measure",value:"Measure"},{text:"Dimension",value:"Dimension"}],enableRTL:a.model.enableRTL,width:"100%",selectedIndex:0,change:t.proxy(function(e){"Dimension"==e.text?a.element.find(".e-calcMemberDimensionField").css("visibility","visible"):a.element.find(".e-calcMemberDimensionField").css("visibility","hidden")},a)}),n=t.DataManager(r).executeLocal(t.Query().where("spriteCssClass","contains","e-dimensionCDB")),o=[],p=0;p<n.length;p++)o.push({text:n[p].name,value:n[p].name});for(a.element.find("#"+a._id+"_dimensionFieldCM").ejDropDownList({dataSource:o,selectedIndex:0,width:"100%",enableRTL:a.model.enableRTL,cssClass:"e-calcMemberDimensionField"}),a.element.find(".e-calcMemberDimensionField").css("visibility","hidden"),a.element.find("#"+a._id+"_formatFieldCM").ejDropDownList({dataSource:[{text:"Standard",value:"Standard"},{text:"Currency",value:"Currency"},{text:"Percent",value:"Percent"},{text:"Custom",value:"Custom"}],enableRTL:a.model.enableRTL,selectedIndex:0,width:"100%",enableRTL:a.model.enableRTL,change:t.proxy(function(e){"Custom"==e.text?a.element.find(".e-calcMemberCustomFormat").css("visibility","visible"):a.element.find(".e-calcMemberCustomFormat").css("visibility","hidden")},a)}),s=a.element.find(".e-cubeTreeViewCalcMember").find("li"),p=0;p<s.length;p++)t.isNullOrUndefined(e(s[p]).attr("id"))||e(s[p]).attr("data-tag",t.DataManager(r).executeLocal(t.Query().where("id","equal",e(s[p]).attr("id")))[0].tag);for(d=a.element.find(".e-cubeTreeViewCalcMember .e-folderCDB"),p=0;p<d.length;p++)e(d[p].parentElement).removeClass("e-draggable");if(a.element.find(".e-cubeTreeViewCalcMember .calcMemberGroupCDB").length>0&&a.element.find(".e-cubeTreeViewCalcMember .calcMemberGroupCDB").parent().removeClass("e-draggable"),a._calcMemberTreeObj=a.element.find(".e-cubeTreeViewCalcMember").data("ejTreeView"),!t.isNullOrUndefined(a._selectedCalcMember)&&(u={},(u=a.model.operationalMode==t.Pivot.OperationalMode.ServerMode?t.DataManager(a._calcMembers).executeLocal(t.Query().where("name","equal",a._selectedCalcMember)):t.DataManager(a.model.calculatedMembers).executeLocal(t.Query().where("caption","equal",a._selectedCalcMember))).length>0)){if(c=0,c=a.model.operationalMode==t.Pivot.OperationalMode.ServerMode?u[0].nodeType:u.length>0&&u[0].memberType&&("dimension"==u[0].memberType||"Dimension"==u[0].memberType)?1:0,a.element.find("#"+a._id+"_captionFieldCM").val(u[0].caption||u[0].name),a.element.find("#"+a._id+"_expressionFieldCM").val(u[0].expression),a.element.find("#"+a._id+"_memberTypeFieldCM").data("ejDropDownList").selectItemsByIndices(c),1==c){var P=(a.model.operationalMode==t.Pivot.OperationalMode.ServerMode?u[0].tag:u[0].hierarchyUniqueName).split(".")[0].replace(/\[/g,"").replace(/\]/g,""),w=a.element.find("#"+a._id+"_dimensionFieldCM").data("ejDropDownList").model.dataSource;for(p=0;p<w.length;p++)w[p].value==P&&a.element.find("#"+a._id+"_dimensionFieldCM").data("ejDropDownList").selectItemsByIndices(p)}t.isNullOrUndefined(u[0].formatString)||("Standard"==u[0].formatString?a.element.find("#"+a._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(0):"Currency"==u[0].formatString?a.element.find("#"+a._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(1):"Percent"==u[0].formatString?a.element.find("#"+a._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(2):(a.element.find("#"+a._id+"_formatFieldCM").data("ejDropDownList").selectItemsByIndices(3),a.element.find("#"+a._id+"_customFormatFieldCM").val(u[0].formatString)))}a._waitingPopup.hide()},_refreshFieldList:function(i){var l,a,r,n,o,s=i.element.find(".e-schemaFieldTree").data("ejTreeView");for(s.refresh(),l=s.model.fields.dataSource,a=i.element.find(".e-schemaFieldTree li"),r=0;r<e(a).length;r++)n=e(e(a)[r]).attr("id"),(o=e.map(l,function(e){if(e.id==n)return{tag:e.tag,expression:e.expression,defaultHierarchy:e.defaultHierarchy}})).length>0&&""!=o[0]&&(e(e(a)[r]).attr("data-tag",o[0].tag),t.isNullOrUndefined(o[0].expression)||e(e(a)[r]).attr("expression",o[0].expression),t.isNullOrUndefined(o[0].defaultHierarchy)||e(e(a)[r]).attr("data-defaultHierarchy",o[0].defaultHierarchy))},_getMemberChildNodes:function(i){var l,a,r;if((e(i.currentElement).find("a > span")[0].className.indexOf("level")>-1||e(i.currentElement).find("a > span")[0].className.indexOf("member")>-1)&&(l=t.DataManager(this._calcMemberTreeObj.dataSource()).executeLocal(t.Query().where("pid","equal",e(i.currentElement).attr("id")).where("name","equal","(Blank)")),!t.isNullOrUndefined(l)&&l.length>0))if(this._calcMemberTreeObj.hideNode(l[0].id),this.pNode=i.currentElement,this._waitingPopup.show(),a=e(i.currentElement).find("a > span")[0].className.indexOf("level")>-1?"level":"member",this.model.operationalMode==t.Pivot.OperationalMode.ClientMode){var n=this.model.dataSource,o=this.element.find(".e-cubeTreeViewCalcMember").data("ejTreeView"),s=e.map(o.model.fields.dataSource,function(t){if(t.id==e(i.currentElement).attr("id"))return t});if(e(i.currentElement).children("ul").children().length>1)this._waitingPopup&&this._waitingPopup.hide();else{s.length>0&&(this._calcExpanded=s[0]);var d="select {"+e(i.currentElement).attr("data-tag")+".members}dimension properties CHILDREN_CARDINALITY, MEMBER_TYPE on 0 from ["+e.trim(n.cube)+"]",u=t.olap._mdxParser.getSoapMsg(d,n.data,n.catalog),c=t.olap.base._getConnectionInfo(n.data);this.doAjaxPost("POST",c.url,{XMLA:u},t.proxy(this._generateCalculatedMember,this),null,{action:"fetchMembers"})}}else null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:"fetchMemberChildNodes",element:this.element,customObject:this.model.customObject}),r=JSON.stringify(this.model.customObject),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.fetchMemberTreeNodes,JSON.stringify({action:"fetchMemberChildNodes",dimensionName:e(i.currentElement).attr("data-tag")+":"+a+":"+e(i.currentElement).attr("id"),olapReport:this.currentReport,customObject:r}),t.proxy(t.Pivot._fetchMemberSuccess,this))},_fetchMemberSuccess:function(a){var r,n,o;for(r=a.length>1&&a[0]!=l?JSON.parse(a[0].Value):a.d!=l?JSON.parse(a.d[0].Value):JSON.parse(a.MemberChildNodes),null!=this.model.afterServiceInvoke&&this._trigger("afterServiceInvoke",{action:"fetchMemberChildNodes",element:this.element,customObject:this.model.customObject}),this._calcMemberTreeObj.model.beforeExpand=null,this._calcMemberTreeObj.addNode(r,e(this.pNode)),n=t.DataManager(this._calcMemberTreeObj.dataSource()).executeLocal(t.Query().where("pid","equal",e(this.pNode).attr("id")).where("name","equal","(Blank)")),!t.isNullOrUndefined(n)&&n.length>0&&this._calcMemberTreeObj.removeNode(n[0].id),e.each(e(this.pNode).children().find("li"),function(e,t){t.setAttribute("data-tag",r[e].tag)}),o=e(this.pNode).children().find("li"),i=0;i<o.length;i++)1==r[i].hasChildren&&(this._calcMemberTreeObj.addNode({id:r[i].id+"_Blank_"+i,name:"(Blank)",parentId:r[i].id},o[i]),this.element.find("#"+r[i].id).find("> div > div:first").removeClass("e-process"),this._calcMemberTreeObj.collapseNode(this.element.find("#"+r[i].id)));this._calcMemberTreeObj.model.beforeExpand=t.proxy(t.Pivot._getMemberChildNodes,this),this._waitingPopup.hide()},_drillThroughCellClick:function(l,a){var r,n,o,s,d,u,c;if(a._waitingPopup.show(),o=e(l.currentTarget.parentElement).attr("data-p"),a.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)(n=e(a.element).parents(".e-pivotclient").length>0||e(a.element).parents(".e-maximumView").length>0?a._pivotClientObj:a).doAjaxPost("POST",n.model.url+"/"+n.model.serviceMethodSettings.drillThroughDataTable,JSON.stringify({currentReport:JSON.parse(a.getOlapReport()).Report,layout:a.model.layout,cellPos:o,selector:"",customObject:JSON.stringify(n.model.customObject)}),function(e){n._trigger("drillThrough",{element:a.element,data:e})});else{for(s=e("#"+a._id).find("tbody").find("tr:first").find("th").length,i=0;i<s;i++)-1!=(d=-1!=a.getJSONRecords()[parseInt(i*a._rowCount+parseInt(o.split(",")[1]))].Info.indexOf("Measures")||a.getJSONRecords()[parseInt(i*a._rowCount+parseInt(o.split(",")[1]))].RowSpan<=1?a.getJSONRecords()[parseInt(i*a._rowCount+parseInt(o.split(",")[1]))].Info.split("::")[0]:"").indexOf("Measures")&&(r=d),""!=d&&(a._rowHeader[i]=d);for(u=e("#"+a._id).find("tbody").find('[data-p="'+parseInt(o.split(",")[0])+","+parseInt(o.split(",")[1])+'"]').closest("tbody").prev().children("tr").length,i=0;i<u;i++)-1!=(c=-1!=a.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*a._rowCount+i)].Info.indexOf("Measures")||a.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*a._rowCount+i)].ColSpan<=1?a.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*a._rowCount+i)].Info.split("::")[0]:"").indexOf("Measures")&&(r=c),""!=c&&(a._colHeader[i]=c);for((t.isNullOrUndefined(a._fieldData)||!t.isNullOrUndefined(a._fieldData)&&t.isNullOrUndefined(a._fieldData.hierarchy))&&a._getFieldItemsInfo(a),j=0;j<a._fieldData.measures.length;j++)r==a._fieldData.measures[j].id&&(a.measureGrp=a._fieldData.measures[j].pid);a._rowHeader=e.grep(a._rowHeader,function(e){return 0==e||e}),a._colHeader=e.grep(a._colHeader,function(e){return 0==e||e}),a._createDrillThroughQuery("",a)}},openHierarchySelector:function(e,i){var l,a,r;e.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._createDrillThroughDialog(e,i):(e._waitingPopup.show(),a=(l=e.target.className.indexOf("e-pivotclient")>=0?e._pivotGrid:e)._getConnectionInfo(e.model.dataSource.data),r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASUREGROUP_DIMENSIONS</RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+e.model.dataSource.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.model.dataSource.cube+"</CUBE_NAME><MEASUREGROUP_NAME>"+l.measureGrp+"</MEASUREGROUP_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.model.dataSource.catalog+"</Catalog> <LocaleIdentifier>"+a.LCID+"</LocaleIdentifier></PropertyList></Properties></Discover></Body></Envelope>",this.doAjaxPost("POST",a.url,{XMLA:r},l._loadDimensionElements,null,{pvtGridObj:l,action:"loadMeasureElements"}))},_createDrillThroughDialog:function(i,l){var a,r,n,o;i.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode&&l.shift(),i.element.find(".e-dialog:not(.e-calcMemberDialog, .e-calcMemberDialog .e-dialog), .e-clientDialog").remove();var s=t.buildTag("label#",i._getLocalizedLabels("SelectHierarchy"))[0].outerHTML,d="<div class=e-cubeTable style='width:200px; overflow:auto'><div valign=\"bottom\">"+this._createHierarchyBrowser()+"</div></div>",u=t.buildTag("div#dropDlg.dropDlg",'<table class="e-outerTable"><tr><td>'+d+"</td><td>"+s+"<br><textarea id='hrSel' style='width:270px; height:300px; resize:none; margin:0px 5px 0 5px'></textarea></br><br></td></tr></table>")[0].outerHTML+"</br>",c=t.buildTag("div",t.buildTag("button#btnOK.dialogBtnOK",i._getLocalizedLabels("OK")).attr("title",i._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML+t.buildTag("button#btnCancel.dialogBtnCancel",i._getLocalizedLabels("Cancel")).attr("title",i._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,{float:"right",margin:"-5px 0 6px"})[0].outerHTML,p=t.buildTag("div#clientDialog.e-clientDialog",u+c,{opacity:"1"}).attr("title","Hierarchy Selector")[0].outerHTML;for(e(p).appendTo("#"+i._id),e("#btnOK, #btnCancel").ejButton(),e("#btnOK, #btnCancel").css({margin:"0 20px 20px 0",width:"50px"}),i.element.find(".e-clientDialog").ejDialog({width:550,target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,i)}),i.element.find(".cubeTreeViewHierarchy").ejTreeView({showCheckbox:!0,fields:{id:"id",parentId:"pid",text:"name",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.isNullOrUndefined(l.d)?e.parseJSON(l):e.parseJSON(l.d):l},allowDragAndDrop:!0,allowDropChild:!1,allowDropSibling:!1,enableRTL:!!i.model.enableRTL,beforeDelete:function(){return!1},dragAndDropAcrossControl:!0,nodeDropped:t.proxy(this._hierarchyNodeDropped,i)}),i._tableTreeObj=i.element.find(".cubeTreeViewHierarchy").data("ejTreeView"),i._tableTreeObj.element.find(".e-ul").css({width:"100%",height:"100%"}),i._tableTreeObj.element.find(".e-chkbox-wrap").remove(),a=i._tableTreeObj.element.find("li"),r=0;r<a.length;r++)n=i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.isNullOrUndefined(l.d)?e.parseJSON(l)[r].tag:e.parseJSON(l.d)[r].tag:l[r].tag,a[r].setAttribute("data-tag",n);i._tableTreeObj&&i._tableTreeObj.element.find("li").mouseover(t.proxy(function(t){e(t.target).parent().find(".e-measureGroupCDB, .e-dimensionCDB, .e-folderCDB").length>0&&e(t.target).css("cursor","default")},i)),o=i,e("#btnOK").click(function(){var i=e("#hrSel").val();e(".e-dialog:not(.e-calcMemberDialog, .e-calcMemberDialog .e-dialog), .e-clientDialog, .drilltableDialog").remove(),o._waitingPopup.show(),t.olap._mdxParser._createDrillThroughQuery(i,o),o._waitingPopup.hide()}),e("#btnCancel").click(function(){e(".e-dialog:not(.e-calcMemberDialog, .e-calcMemberDialog .e-dialog), .e-clientDialog").remove(),o._waitingPopup.hide()}),i.model.enableRTL&&(e(".e-dialog").addClass("e-rtl"),e(".dialogBtnCancel").css("margin","0 -70px 0 0"))},_createHierarchyBrowser:function(){return t.buildTag("div.cubeBrowserHierarchy",t.buildTag("div.cubeTreeViewHierarchy")[0].outerHTML,{width:"200px",height:"300px",overflow:"auto"})[0].outerHTML},_hierarchyNodeDropped:function(i){var l,a,r;if("hrSel"==i.dropTarget[0].id&&(l=e(e(i.droppedElement).children()[0]).find(".e-dimensionCDB").length>0?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(i.droppedElement).find("li:first").attr("data-tag"):e(i.droppedElement).find("li:first")[0].id:0==e(i.droppedElement).find("li:first").length?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(i.droppedElement.parent().parent()).attr("data-tag"):e(i.droppedElement.parent().parent())[0].id:this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?e(i.droppedElement).attr("data-tag"):i.droppedElementData.id,!t.isNullOrUndefined(l))){for(l=l.replace("[","[$"),a=0;a<e("#hrSel").val().split(",").length;a++)if(l==e("#hrSel").val().split(",")[a])return!1;0!=(r=this.element.find("#hrSel").val()).length?(r=r+","+l,this.element.find("#hrSel").val(r)):this.element.find("#hrSel").val(l)}},_generateDrillData:function(t,i){for(var l=e(i).find("row").children(),a=e.map(l,function(e){var t=e.textContent;return'"'+e.tagName.replace(/_x005B_/g,"[").replace(/_x0020_/g," ").replace(/_x005D_/g,"]").replace(/_x0024_/g,"$").replace("].[","]-[")+'":"'+t+'"'}),r=a[0],n="",o=0;o<a.length;o++)a[o]!=r?n+=","+a[o]:n+=""==n?"[{"+a[o]:"}, {"+a[o];n+="}]",e(t.pvtGridObj.element).parents(".e-pivotclient").length>0?e(t.pvtGridObj.element).parents(".e-pivotclient").data("ejPivotClient")._trigger("drillThrough",{element:t.pvtGridObj.element,data:n}):t.pvtGridObj._trigger("drillThrough",{element:t.pvtGridObj.element,data:n})},_getFilterStateMember:function(i,l,a,r,n){if("include"==a.filterItems.filterType)if(1==a.filterItems.values.length)if(t.isNullOrUndefined(r._fieldSelectedMembers[a.fieldName.toLowerCase()])&&i){var o="select {"+a.filterItems.values[0]+"}dimension properties CHILDREN_CARDINALITY on 0 from ["+e.trim(r.model.dataSource.cube)+"]",s=t.olap._mdxParser.getSoapMsg(o,r.model.dataSource.data,r.model.dataSource.catalog),d=t.olap.base._getConnectionInfo(r.model.dataSource.data);this.doAjaxPost("POST",d.url,{XMLA:s},t.proxy(this._getInitialSlicerName,this),null,{controlObject:r,action:"fetchMembers"}),n=r._slicerName}else i||(n=a.filterItems.values[0]);else n=r._getLocalizedLabels("MultipleItems");else n=l.length-(-1==a.filterItems.values.indexOf("All")?a.filterItems.values.length:a.filterItems.values.length-1)==1?l.filter(function(e){if(-1==a.filterItems.values.indexOf(e))return e}):r._getLocalizedLabels("MultipleItems");return n},_getFilterState:function(i,a,r,n){var o,s,d="";if(n.model.operationalMode==t.Pivot.OperationalMode.ClientMode)i?(t.isNullOrUndefined(t.olap.base.olapCtrlObj)&&(t.olap.base.olapCtrlObj=n),("All"==n._fieldSelectedMembers[r.fieldName.toLowerCase()]||t.isNullOrUndefined(n._fieldSelectedMembers[r.fieldName.toLowerCase()]))&&t.olap._mdxParser.getAllMember(n.model.dataSource,r.fieldName,n),d="All"==n._fieldSelectedMembers[r.fieldName.toLowerCase()]||t.isNullOrUndefined(n._fieldSelectedMembers[r.fieldName.toLowerCase()])?n._allMember:n._fieldSelectedMembers[r.fieldName.toLowerCase()],d=this._getFilterStateMember(i,a,r,n,d)):d=this._getFilterStateMember(i,a,r,n,d);else if(n.model.analysisMode==t.Pivot.AnalysisMode.Pivot)if((o=t.isNullOrUndefined(n._tempFilterData)?[]:e.map(n._tempFilterData,function(e){return e[r.DimensionName]})).length>0&&n._fieldMembers[r.DimensionName])d=n._fieldMembers[r.DimensionName].length-o.length==1?n._fieldMembers[r.DimensionName].filter(function(e){if(-1==o.indexOf(e))return e}):n._getLocalizedLabels("MultipleItems");else if(t.isNullOrUndefined(n._clientReportCollection))d=n._getLocalizedLabels("All");else for(s=0;s<n._clientReportCollection.length;s++){if(!t.isNullOrUndefined(n._clientReportCollection[s]._fieldSelectedMembers)&&(""==n._currentRecordName&&n.element.find("#reportList")!=l&&n.element.find("#reportList")[0].value==n._clientReportCollection[s].name||""!=n._currentRecordName&&n._currentReportName==n._clientReportCollection[s].name)){n._fieldSelectedMembers[r.Tag]=n._clientReportCollection[s]._fieldSelectedMembers[r.DimensionName],d="All"==n._fieldSelectedMembers[r.Tag]||n._fieldSelectedMembers[r.Tag]==l?n._getLocalizedLabels("All"):n._fieldSelectedMembers[r.Tag];break}d=n._getLocalizedLabels("All")}else d=("All"==n._fieldSelectedMembers[r.Tag]?r.AllMember:n._fieldSelectedMembers[r.Tag])||r.AllMember;return d},_getInitialSlicerName:function(t,i){t.controlObject._slicerName=e(e(i).find("Axis:eq(0) Tuple:eq(0)").children().children()[1]).text()},_getTreeViewItems:function(t){for(var i,l=t.element.find(".e-editorTreeView"),a=[],r=e(l).find(":input.nodecheckbox"),n=0;n<r.length;n++)i=e(r[n]).parents("li:eq(0)"),a.push({Id:i[0].id,name:e(i[0]).find("a:eq(0)").text()});return a},_getEditorMember:function(i,l,a){var r,n,o,s=a?l._schemaData._editorTreeData:l._editorTreeData,d=[];if(l.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(0==s.length){var u=this._getTreeViewItems(a?l._schemaData:l,s),c=e.extend(!0,[],a?l._schemaData._memberTreeObj.dataSource():l._memberTreeObj.dataSource()),p=e.map(u,function(i){if("All"!=i.Id)return e.map(c,function(e){i.Id==e.id&&((i=e).name=t.isNullOrUndefined(i.parentId)?i.name+"_1":i.name)}),i}),h=e.map(p,function(t){return e.map(p,function(e){t.parentId==e.id&&(t.name=t.name+"_"+(Number(e.name.split("_")[e.name.split("_").length-1])+1))}),t});e.map(h,function(e){var t=e.name.split("_")[e.name.split("_").length-2],i=Number(e.name.split("_")[e.name.split("_").length-1]),l=e.checkedStatus;d.push({name:t,checked:l,level:Number(i)})})}else e.map(s,function(e){d.push({name:e.name,id:e.id,pid:e.pid,checked:e.checkedStatus,level:e.level})});return this._updateEditorMembers(i,d,l,s)}if(l.model.analysisMode==t.Pivot.AnalysisMode.Olap)return r=a?l._schemaData.element.find(".e-editorTreeView"):l.element.find(".e-editorTreeView"),h=s.length>0?s:e(r).find(":input.nodecheckbox"),s.length>0?e.map(h,function(e){d.push({name:e.name,id:e.id,pid:e.pid,checked:e.checkedStatus,level:Number(e.id.split("_")[e.id.split("_").length-1])})}):e.map(h,function(t){if("All"!=e(t).parents("li:eq(0)").attr("id")){var i=e(t).parent().siblings("a").text(),l=t.value.split("_")[t.value.split("_").length-1],a=!(!t.checked&&"mixed"!=e(t.parentElement).attr("aria-checked"));d.push({name:i,checked:a,level:Number(l)})}}),this._updateEditorMembers(i,d,l,s);for(n=[],o=1;o<i.length;o++)n.push(e(i[o].parentElement).siblings("a").text());return n},_updateEditorMembers:function(i,l,a,r){var n,o,s,d,u,c;if(l.length>0&&"All"==l[0].name&&l.splice(0,1),!t.isNullOrUndefined(a._fieldMembers[i]))if(0==r.length){var p=[],h=0,g="",m=a._fieldMembers[i];for(n=0;n<l.length;n++)if(t.isNullOrUndefined(m[n+h])||l[n].level==m[n+h].level)p.push(l[n]);else if(t.isNullOrUndefined(m[n+h])||l[n].level<m[n+h].level){s=n;do{l[n-1].checked&&p.push(m[s]),h++,s++}while(l[n].level<m[s].level);n--}else if(t.isNullOrUndefined(m[n+h])||l[n].level>m[n+h].level){o=m[n+h].level,s=n;do{p.push(l[s]),h--,n=++s-1}while(l[s].level>o)}a._fieldMembers[i]=p}else d=e.extend(!0,[],a._fieldMembers[i]),u=[],e.each(l,function(e,t){for(var i=!1,l=0;l<d.length;l++)if(t.id==d[l].id){d.splice(l,1,t),i=!0;break}i||u.push(t)}),a._fieldMembers[i]=d.concat(u);a._fieldMembers[i]=t.isNullOrUndefined(a._fieldMembers[i])?l:a._fieldMembers[i];var f=1,_="",v="",b=[];do{if(c=e.map(a._fieldMembers[i],function(e){if(e.level==f)return e}),b=e.map(c,function(e){if(e.checked)return e}),c.length==b.length)g=1==f?"All":_,c.length>1&&(v="All"),f++;else if(1==b.length)_=g="All"==v?"multiple":b[0].name,f++;else if(b.length>1&&c.length>b.length){g="multiple";break}}while(b.length>0&&"All"!=g&&"multiple"!=g&&e.map(a._fieldMembers[i],function(e){if(e.level==f)return e}).length>0);return g},_getTreeData:function(e,i,l){var a=t.olap.base._getConnectionInfo(e.url),r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+e.request+"</RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+e.catalog+"</CATALOG_NAME>"+("loadcubelist"==l.action?"":"<CUBE_NAME>"+e.cube+"</CUBE_NAME>")+"</RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.catalog+"</Catalog><LocaleIdentifier>"+a.LCID+"</LocaleIdentifier> </PropertyList></Properties></Discover></Body></Envelope>";l.action="loadFieldElements",this.doAjaxPost("POST",a.url,{XMLA:r},i,null,l)},updateTreeView:function(i){var l,a,r,n,o,s,d=i.element.find(".e-editorTreeView").find("li"),u=d.length,c=i._memberTreeObj.dataSource(),p=c.length;if(i.element.find(".e-editorTreeView").parents("#"+i._id+"_ClientDialog").find(".e-editorPara").text()==i._getLocalizedLabels("KPIs"))for(o=0;o<u;o++)for(l=e(d[o]).find("span:first").attr("aria-checked"),s=0;s<p;s++)d[o].id!=c[s].id||"mixed"!=l&&"true"!=l?d[o].id==c[s].id&&"false"==l&&(t.isNullOrUndefined(c[s].parentId)?c[s].checkedStatus=!1:e(d[o].parentElement).parent().attr("id")==c[s].parentId&&(c[s].checkedStatus=!1)):t.isNullOrUndefined(c[s].parentId)?c[s].checkedStatus=!0:e(d[o].parentElement).parent().attr("id")==c[s].parentId&&(c[s].checkedStatus=!0);else for(o=0;o<u;o++)for(l=e(d[o]).find("span:first").attr("aria-checked"),s=0;s<p;s++){if(d[o].id==c[s].id&&("mixed"==l||"true"==l)){c[s].checkedStatus=!0;break}if(d[o].id==c[s].id&&"false"==l){c[s].checkedStatus=!1;break}}for(o=0;o<c.length;o++)if(a=!1,1==c[o].checkedStatus){for(s=0;s<c.length;s++)if(c[s].hasOwnProperty("parentId")&&c[s].parentId==c[o].id&&1==c[s].checkedStatus){a=!0;break}if(!a)for(r=0;r<c.length;r++)c[r].hasOwnProperty("parentId")&&c[r].parentId==c[o].id&&(c[r].checkedStatus=!0)}else if(0==c[o].checkedStatus)for(n=0;n<c.length;n++)c[n].hasOwnProperty("parentId")&&c[n].parentId==c[o].id&&(c[n].checkedStatus=!1);for(o=0;o<u;o++)if(null==e(d[o]).attr("data-tag"))for(s=0;s<p;s++)if(e(d[o]).attr("id")==c[s].id){e(d[o]).attr("data-tag",c[s].tag);break}return i._memberTreeObj},getNodesState:function(e){for(var t="",i="",l="ejTreeView"==e.pluginName?e.dataSource():e,a=0;a<l.length;a++)1==l[a].checkedStatus?t+="::"+l[a].id+"||"+l[a].tag+"||"+(l[a].parentId||l[a].pid)+"||"+l[a].name:i+="::"+(l[a].parentId||l[a].pid)+"||"+l[a].tag+"||"+l[a].name;return{selectedNodes:t,unSelectedNodes:i}},removeParentSelectedNodes:function(t){for(var i,a=e.extend([],t),r=0;r<t.length;r++)for(i=0;i<a.length;i++)a[i].Id==t[r].parentId&&a.splice(i,1);return e.map(a,function(e){if(""!=e.tag&&e.tag!=l)return e.tag.replace(/\&/g,"&amp;")})},getChildNodes:function(i,a,r,n,o){var s,d,u,c=i.targetElement,p=(n.cube,n.catalog,n.data,o._generateChildMembers,e(i.currentElement).find("li").length),h=!1,g={memberEditorPageSize:"ejPivotSchemaDesigner"==o.pluginName?o.model.pivotControl.model.memberEditorPageSize:o.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==o.pluginName?o.model.pivotControl.model.enableMemberEditorPaging:o.model.enableMemberEditorPaging};if(g.enableMemberEditorPaging){for(s=0;s<o._memberTreeObj.dataSource().length;s++)if(o._memberTreeObj.dataSource()[s].parentId==i.id||o._memberTreeObj.dataSource()[s].pid==i.id)return i.isChildLoaded=!0,void t.Pivot.closePreventPanel(o)}else o._isSearchApplied=!1;if(jQuery.each(o._editorTreeData,function(e,t){if(t.id==i.id)return t.expanded=!0,t.isChildMerged=!0,!1}),0==p){var m=t.buildTag("span.nodeExpand e-load e-icon")[0].outerHTML,f=e(c).parents("li:eq(0)").attr("id");e.map(r,function(i){var r,n,s,d;i.fieldName!=a||t.isNullOrUndefined(i.filterItems)||(r=i.filterItems,(t.isNullOrUndefined(o.model.pivotControl)?o.model.enableMemberEditorPaging:o.model.pivotControl.model.enableMemberEditorPaging)?(r=e.map(r,function(e){if(e.pid!=l&&e.pid==f.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"))return h=!0,e})).length>0&&1==h&&(n=t.Pivot._generateChildWithAncestors(o,e(c).parents("li:eq(0)"),g.enableMemberEditorPaging,g.memberEditorPageSize),g.enableMemberEditorPaging&&(r.length>=g.memberEditorPageSize||n.lstChildren.length>=g.memberEditorPageSize)?(o._isEditorDrillPaging=!0,o.element.find(".searchEditorTreeView").data("ejMaskEdit").clear(),o._lastSavedTree=[],t.Pivot._makeAncestorsExpandable(o,e(c).parents("li:eq(0)")[0].id),s=n.allLvlLst.length>1&&n.lstChildren.length>=g.memberEditorPageSize?t.Pivot._getParentsTreeList(o,n.lstParents[0].id,o._editorTreeData):e.grep(o._editorTreeData,function(t){return t.id==e(c).parents("li:eq(0)")[0].id})[0],d={childNodes:n.allLvlLst.length>1&&n.lstChildren.length>=g.memberEditorPageSize?n.lstChildren:r,parentNode:s},t.Pivot._drillEditorTreeNode(d,o,g.memberEditorPageSize)):(e(c).parents("li:eq(0)").find(".nodeExpand").remove(),e(c).parents("li:eq(0)").removeClass("e-load"),e.each(r,function(e,t){delete t.parentId}),o._onDemandNodeExpand=!1,o._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(r,o,"ejPivotSchemaDesigner"==o.pluginName?o.model.pivotControl:o),e(c).parents("li:eq(0)")),o._onDemandNodeExpand=!1,o._memberTreeObj.model.nodeCheck=t.proxy(o._nodeCheckChanges,o),o._memberTreeObj.model.nodeUncheck=t.proxy(o._nodeCheckChanges,o),e.each(e(c).parents("li:eq(0)").find("li"),function(e,i){t.isNullOrUndefined(r[e])||i.setAttribute("data-tag",r[e].tag)}))):e.map(r,function(e){(e.parentId!=l&&e.parentId==f.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-")||e.pid!=l&&e.pid==f.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"))&&(h=!0)}))});i.isChildLoaded=!!h,h?jQuery.grep(o._editorTreeData,function(e){if(e.pid==i.id)return e}).length>10&&o.element.find("a.e-linkPanel").css("display","block"):(e(c).parents("li:eq(0)").prepend(m),e(c).parents("li:eq(0)").attr("data-tag")==l&&((d=e.map(r,function(e){if(e.fieldName==a)return e})[0])&&e.map(d.filterItems,function(t){t.id==e(c).parents("li:eq(0)").attr("id")&&e(c).parents("li:eq(0)").attr("data-tag",t.tag)})),u=e(c).parents("li:eq(0)").attr("data-tag").replace(/\&/g,"&amp;"),t.olap._mdxParser.getChildren(n,u,o))}},_getFilterParams:function(e,i,l){var a,r,n,o="";if("schemaValue"!=e){if(a="",!t.isNullOrUndefined(i))for(r=0;r<i.length;r++)if(!t.isNullOrUndefined(i[r][l]))for(n=0;n<i[r][l].length;n++)a+="##"+i[r][l][n];""!=a&&(o=e+"::"+l+"::FILTERED"+a)}return o},generateChildMembers:function(i,l){var a,r,n,o,s,d,u=e(l).find("Axis:eq(0) Tuple"),c=[],p=this;t.isNullOrUndefined(p.olapCtrlObj)||(p=p.olapCtrlObj);var h={memberEditorPageSize:"ejPivotSchemaDesigner"==p.pluginName?p.model.pivotControl.model.memberEditorPageSize:p.model.memberEditorPageSize,enableMemberEditorPaging:"ejPivotSchemaDesigner"==p.pluginName?p.model.pivotControl.model.enableMemberEditorPaging:p.model.enableMemberEditorPaging},g={currentReportItems:"ejPivotSchemaDesigner"==p.pluginName?p.model.pivotControl._currentReportItems:p._currentReportItems,savedReportItems:"ejPivotSchemaDesigner"==p.pluginName?p.model.pivotControl._savedReportItems:p._savedReportItems},m=p.element.find("[data-tag='"+i.currentNode.replace(/&amp;/g,"&")+"']");for(r=0;r<u.length;r++){var f=e(e(l).find("Axis:eq(0) Tuple:eq("+r+")").children().children()[0]).text(),_=""==e(e(l).find("Axis:eq(0) Tuple:eq("+r+")").children()).find("Caption").text()?"(Blank)":e(e(l).find("Axis:eq(0) Tuple:eq("+r+")").children()).find("Caption").text(),v={hasChildren:"0"!=e(u[r]).find("CHILDREN_CARDINALITY").text(),checkedStatus:"true"==e(e(m).find("input.nodecheckbox")[0]).parent().attr("aria-checked"),id:f.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-").replace(/ /g,"_"),name:_,tag:f,level:parseInt(e(u[r]).find("LNum").text())};c.push(v)}c.length>0&&p.model.enableMemberEditorSorting&&null!=p._sortType&&(c=t.DataManager(c).executeLocal(t.Query().sortBy("name",p._sortType))),a=e(m).parents("li").length>1?e(m).parents("li").first():e(m).parents("li"),e(e(a).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1}),p._memberTreeObj=p.element.find(".e-editorTreeView").data("ejTreeView"),c.length>0&&(n="ejPivotGrid"==p.pluginName?p._selectedField:p._selectedFieldName,e.map(g.currentReportItems,function(i){i.fieldName!=n||t.isNullOrUndefined(i.filterItems)||(e.each(c,function(t,i){i.pid=e(m).attr("id")}),e.merge(i.filterItems,c),p._editorTreeData=i.filterItems)}),0==g.currentReportItems.length&&p._editorTreeData.concat(c)),m.find(".nodeExpand").remove(),m.find(".e-load").removeClass("e-load"),jQuery.each(p._editorTreeData,function(e,t){if(t.id==m[0].id)return t.expanded=!0,!1}),h.enableMemberEditorPaging?(o=t.Pivot._generateChildWithAncestors(p,m,h.enableMemberEditorPaging,h.memberEditorPageSize),c.length>=h.memberEditorPageSize||o.lstChildren.length>=h.memberEditorPageSize?(p._isEditorDrillPaging=!0,p.element.find(".searchEditorTreeView").data("ejMaskEdit").clear(),p._lastSavedTree=[],t.Pivot._makeAncestorsExpandable(p,m[0].id),s=o.allLvlLst.length>1&&o.lstChildren.length>=h.memberEditorPageSize?t.Pivot._getParentsTreeList(p,o.lstParents[0].id,p._editorTreeData):e.grep(p._editorTreeData,function(e){return e.id==m[0].id})[0],d={childNodes:o.allLvlLst.length>1&&o.lstChildren.length>=h.memberEditorPageSize?o.lstChildren:c,parentNode:s},t.Pivot._drillEditorTreeNode(d,p,h.memberEditorPageSize)):p._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(c,p,"ejPivotSchemaDesigner"==p.pluginName?p.model.pivotControl:p),e(m))):p._memberTreeObj.addNode(t.Pivot._showEditorLinkPanel(c,p,"ejPivotSchemaDesigner"==p.pluginName?p.model.pivotControl:p),e(m)),e.each(m.find("li"),function(e,i){t.isNullOrUndefined(c[e])||i.setAttribute("data-tag",c[e].tag)}),g.savedReportItems=e.extend(!0,[],g.currentReportItems)},_generateChildWithAncestors:function(i,l,a,r){var n,o,s=[],d=[e.grep(i._editorTreeData,function(e){return e.id==l[0].id})[0]],u=[];if(a){jQuery.each(i._editorTreeData,function(e,t){if(t.id==l[0].id)return t.expanded=!0,!1}),s.push(d[0]);do{for(n=[],u=[],o=0;o<d.length&&(e.each(i._editorTreeData,function(e,i){t.isNullOrUndefined(i.pid)||i.pid!=d[o].id||(i.expanded&&(n.push(i),s.push(i)),u.push(i))}),!(u.length>=r));o++)u=[];if(d=n.length>0&&u.length<r?n:d,u.length>=r)break}while(n.length>0)}return{allLvlLst:s,lstParents:d,lstChildren:u}},_makeAncestorsExpandable:function(e,i){var l=t.DataManager(e._editorTreeData).executeLocal(t.Query().where("id","equal",i));l.length>0&&(l[0].expanded=!0,i=l[0].pid),!t.isNullOrUndefined(i)&&l.length>0&&this._makeAncestorsExpandable(e,i)},_jsonToEngine:function(e){for(var i,l=e,a=[],r=0;r<l.length;r++)i=parseInt(l[r].Index.split(",")[0]),t.isNullOrUndefined(a[i])?(a[i]=[],a[i].push(l[r])):a[i].push(l[r]);return a},_cropJson:function(i,l){var a,r,n,o,s,d,u,c,p=0,h=0,g=1;if(r=(a=i.model.operationalMode==t.Pivot.OperationalMode.ServerMode?{columns:JSON.parse(i.getOlapReport()).PivotColumns,rows:JSON.parse(i.getOlapReport()).PivotRows,values:JSON.parse(i.getOlapReport()).PivotCalculations}:{columns:i.model.dataSource.columns,rows:i.model.dataSource.rows,values:i.model.dataSource.values}).columns.length+(a.values.length>0&&"rows"!=a.values[0].axis?1:0),n=a.rows.length+(a.values.length>0&&"rows"==a.values[0].axis?1:0),r=0==r?1:r,n=0==n?1:n,""==i._drillAction&&i.model.enableCollapseByDefault){if(f=e.extend(!0,[],t.Pivot._jsonToEngine(l)),r+n>2){for(;h<f[0].length;)if(a.rows.length>1&&-1==f[0][h].CSS.indexOf("summary")&&h+g>r||0==a.columns.length&&0==a.values.length&&-1==f[0][h].CSS.indexOf("summary")||h>0&&g<a.columns.length){for(o=0;o<f.length;o++)f[o].splice(h,1);g++}else h++;for(g=1;p<f.length;)a.columns.length>1&&-1==f[p][0].CSS.indexOf("summary")&&p+g>n||0==a.rows.length&&0==a.values.length&&-1==f[p][0].CSS.indexOf("summary")||p>0&&g<a.rows.length?(f.splice(p,1),g++):p+=f[p][0].CSS.indexOf("summary")>-1?f[p][0].ColSpan:1}for((f=e.map(f,function(t){return[e.map(t,function(e){return("summary rstot"==e.CSS||"summary cstot"==e.CSS||"summary stot"==e.CSS)&&(e.State=2,e.Value=e.Value.replace("Total","")),e})]}))[0][0].ColSpan="none"==f[0][0].CSS&&a.values.length>0&&"rows"==a.values[0].axis&&a.rows.length>0?2:1,f[0][0].RowSpan="none"==f[0][0].CSS&&a.values.length>0&&"rows"!=a.values[0].axis&&a.columns.length>0?2:1,r=a.values.length>0&&"rows"==a.values[0].axis?a.values.length:1,n=a.values.length>0&&"rows"!=a.values[0].axis?a.values.length:1,p=0;p<f[0].length;p++)f[0][p].CSS.indexOf("summary")>-1&&(f[0][p].RowSpan=r,f[0][p].ColSpan=1);for(p=0;p<f.length;p++)f[p][0].CSS.indexOf("summary")>-1&&(f[p][0].ColSpan=n,f[p][0].RowSpan=1);return e.map(f,function(e){return e})}if(i.model.enableCollapseByDefault||""!=i._drillAction){var m=0,f=e.extend(!0,[],t.Pivot._jsonToEngine(i._croppedJson)),_=e.extend(!0,[],t.Pivot._jsonToEngine(i._compJson)),v=e.extend(!0,[],i._compJson),b=""==i._drillParams.currRow?"column":"row";for(s=0;s<i._compJson.length&&0==parseInt(i._compJson[s].Index.split(",")[0]);s++)m++;return d=t.Pivot._getDrillRange(a,b,i,m,v),u=t.Pivot._sliceJson(a,b,r,n,i,v,d.startPos,d.endPos,m,f),"drilldown"==i._drillAction&&(c=t.Pivot._mergeJson(a,i,b,r,n,v,_,f,u,d.startPos,d.endPos,m)),e.map("drilldown"==i._drillAction?c:u,function(e){return e})}return l},_getEnginePos:function(i,l,a){var r=e.map(t.isNullOrUndefined(a[parseInt(i.split(",")[0])])?a[parseInt(l.split(",")[0])]:a[parseInt(i.split(",")[0])],function(e,t){if(e.Index==e.Index.split(",")[0]+","+l.split(",")[1])return t})[0];return{colPos:e.map(a,function(t,i){var a=!1;return e.each(t,function(e,t){t.Index==l&&(a=!0)}),a?i:void 0})[0],rowPos:r}},_mergeJson:function(i,l,a,r,n,o,s,d,u,c,p,h){var g,m,f,_,v,b,C=t.Pivot._getIndices(a,o,l,d,c,p,h),S=C.columnIndices,P=C.rowIndices,w=C.rowSpan,O=C.colSpan,y=t.Pivot._getEnginePos(c,p,d),x=y.colPos,M=y.rowPos,N=[];if("row"==a){if(t.isNullOrUndefined(d[parseInt(c.split(",")[0])+1])){g=parseInt(c.split(",")[0])+1;do{N=e.map(s[g],function(e){if(P.indexOf(parseInt(e.Index.split(",")[1]))>-1)return e.Span="Block",e}),d[g]=N,g++}while(g<O&&!l.model.enableCollapseByDefault)}}else if(parseInt(d[0][parseInt(c.split(",")[1])+1].Index.split(",")[1])!=parseInt(c.split(",")[1])+1)for(b=0;b<s.length;b++){g=parseInt(c.split(",")[1])+1;do{m=s[b][g],S.indexOf(parseInt(m.Index.split(",")[0]))>-1&&(m.Span="Block",d[b].splice(g,0,m)),g++}while(g<w&&!l.model.enableCollapseByDefault)}if("row"==a){for(v=0,b=0;b<d.length;b++)if(!t.isNullOrUndefined(d[b])){f=M,_=0;do{f==M&&d[b].splice(f,1,u[v][_]),f++,_++,d[b].splice(f,0,u[v][_])}while(t.isNullOrUndefined(u[v][_])||parseInt(u[v][_].Index.split(",")[1])<parseInt(p.split(",")[1]));v++}}else for(v=u.length-1,b=x;b>=n;b--)t.isNullOrUndefined(u[v])||d.splice(b,1,u[v]),v--;return t.Pivot._drillSpanCalculation(d,l)},_getIndices:function(i,l,a,r,n,o,s){var d,u=e.map(r,function(e){if(!t.isNullOrUndefined(e))return parseInt(e[0].Index.split(",")[0])}),c=e.map(r[0],function(e){if(!t.isNullOrUndefined(e))return parseInt(e.Index.split(",")[1])});if(a.model.enableCollapseByDefault)"row"==i?u.push(parseInt(n.split(",")[0])+1):c.push(parseInt(n.split(",")[1])+1);else{var p=l[parseInt(o.split(",")[0])*s+parseInt(o.split(",")[1])],h=parseInt(p.Index.split(",")[0]),g=parseInt(p.Index.split(",")[1]),m=p.ColSpan,f=p.RowSpan;if("row"==i)for(d=h+1;d<m;d++)-1==u.indexOf(d)&&u.push(d);else for(d=g+1;d<f;d++)-1==c.indexOf(d)&&c.push(d)}return{columnIndices:u,rowIndices:c,colSpan:m,rowSpan:f}},_sliceJson:function(i,l,a,r,n,o,s,d,u,c){var p,h,g,m,f,_,v,b,C,S,P,w,O=[],y=i.values.length>0&&"rows"!=i.values[0].axis?1:0;if("drilldown"==n._drillAction){var x="row"==l?"0,"+parseInt(s.split(",")[1]):parseInt(s.split(",")[0])+",0",M="row"==l?"0,"+parseInt(d.split(",")[1]):parseInt(d.split(",")[0])+",0",N=t.Pivot._getIndices(l,o,n,c,s,d,u),T=N.columnIndices,D=N.rowIndices,I=parseInt(x.split(",")[0])*u+u,L=0;x="row"==l?x:parseInt(x.split(",")[0])*u+",0";do{for(p="row"==l?parseInt(x.split(",")[1]):parseInt(x.split(",")[0]),L="row"==l?0:L;!t.isNullOrUndefined(o[p])&&("column"!=l||I>p);)("row"==l?T.indexOf(parseInt(o[p].Index.split(",")[0]))>-1:D.indexOf(parseInt(o[p].Index.split(",")[1]))>-1)&&(t.isNullOrUndefined(O[L])&&(O[L]=[]),O[L].push(o[p]),"row"==l&&L++),p+="row"==l?u:1;"column"==l&&(I+=u,L++),x="row"==l?"0,"+(parseInt(x.split(",")[1])+1):parseInt(x.split(",")[0])+u+",0"}while(x!=("row"==l?"0,"+(parseInt(M.split(",")[1])+1):(parseInt(M.split(",")[0])+1)*u+",0"));if(("row"==l?r-1>parseInt(n._drillParams.currPos.split(",")[0])+1:a-y-1>parseInt(n._drillParams.currPos.split(",")[1])+1)&&n.model.enableCollapseByDefault){V="row"==l?0:parseInt(n._drillParams.currPos.split(",")[1])+1,E="row"==l?parseInt(n._drillParams.currPos.split(",")[0])+1:0;do{if(h=!1,!(t.isNullOrUndefined(O[E])||t.isNullOrUndefined(O[E][V])||-1!=O["row"==l?E-1:E]["row"==l?V:V-1].CSS.indexOf("summary")||"rowheader"!=O[E][V].CSS&&"colheader"!=O[E][V].CSS&&"none"!=O[E][V].CSS&&""!=O[E][V].Value))if("row"==l)for(w=0;w<O.length;w++)t.isNullOrUndefined(O[w])||(O[w].splice(V,1),h=!0);else delete O[E],h=!0;"row"==l?V=h?V:V+1:E+=1}while("row"==l?V<O[0].length:E<O.length)}var E=parseInt(n._drillParams.currPos.split(",")[0])+("row"==l?1:0),j="",A=0,k=0,V=parseInt(n._drillParams.currPos.split(",")[1])+1;if(n.model.enableCollapseByDefault)do{if("row"==l?E==parseInt(n._drillParams.currPos.split(",")[0])+1:V==parseInt(n._drillParams.currPos.split(",")[1])+1){for(w="row"==l?O[E].length-1:O.length-1;w>=0;w--)if(("column"!=l||!t.isNullOrUndefined(O[w]))&&(b="row"==l?O[E][w]:O[w][V]).CSS.indexOf("summary")>-1){b.State=2,b.Expander=1;var R=E,U=V,F=0;if("row"==l){do{F++,R++}while(!t.isNullOrUndefined(c[R])&&("none"==c[R][0].CSS||""==c[R][0].Value));b.ColSpan=F}else{do{F++,U++}while(!t.isNullOrUndefined(c[0][U])&&("none"==c[0][U].CSS||""==c[0][U].Value));b.RowSpan=F}b.Value=b.Value.replace(" Total","")}}else for(g="","column"==l&&(g=e.map(O,function(e,i){if(!t.isNullOrUndefined(e))return i})[0]),w="row"==l?O[E].length-1:O.length-1;w>=0;w--)"column"==l&&t.isNullOrUndefined(O[w])||(m=(b="row"==l?O[E][w]:O[w][V]).Value.replace(" Total",""),j=""==j&&""!=b.Value.replace(" Total","")?b.Value.replace(" Total",""):""!=b.Value.replace(" Total","")&&j!=b.Value.replace(" Total","")?b.Value.replace(" Total",""):j,""!=m&&m!=j||0==w||g==w?(b.CSS="row"==l?"rowheader":"colheader",b.State=1,b.Expander=1,b.Value=j,"row"==l?b.RowSpan=E>parseInt(n._drillParams.currPos.split(",")[0])-1?A:b.RowSpan:b.ColSpan=V>parseInt(n._drillParams.currPos.split(",")[1])-1?k:b.ColSpan,A=1,k=1):(b.CSS.indexOf("summary")>-1&&("row"==l?b.ColSpan=parseInt(n._drillParams.currPos.split(",")[0])+2-E:b.RowSpan=parseInt(n._drillParams.currPos.split(",")[1])+2-V),A++,k++));"row"==l?E--:V--}while("row"==l?E>=0:V>=0)}else{var H=t.Pivot._getEnginePos(s,d,c);E=H.colPos,V=H.rowPos;if("row"==l){for(f=0,e.each(c[0],function(e,t){if(parseInt(t.Index.split(",")[1])==parseInt(s.split(",")[1]))return f=e,!1}),w=parseInt(s.split(",")[1]);w<parseInt(d.split(",")[1]);w++)for(_=0;_<c.length;_++)if(!t.isNullOrUndefined(c[_])){for(v="",b="",U=f;U<c[_].length;U++)if(parseInt(c[_][U].Index.split(",")[1])==w){b=c[_][U],v=U,c[_].splice(U,1);break}t.isNullOrUndefined(c[_][v])||"none"!=c[_][v].CSS&&""!=c[_][v].Value&&("rowheader"!=c[_][v].CSS||0!=c[_][v].Expander)||"rowheader"!=b.CSS||(c[_][v].CSS="rowheader",c[_][v].Value=b.Value,c[_][v].State=b.State,c[_][v].Expander=b.Expander)}}else for(C=[],w=parseInt(s.split(",")[0]);w<parseInt(d.split(",")[0]);w++)if(C=0!=C.length||t.isNullOrUndefined(c[w])?C:c[w],delete c[w],parseInt(d.split(",")[0])-w==1){S=0;do{("none"==c[w+1][S].CSS||""==c[w+1][S].Value||"colheader"==c[w+1][S].CSS&&0==c[w+1][S].Expander)&&(c[w+1][S].CSS=C[S].CSS,c[w+1][S].Value=C[S].Value,c[w+1][S].State=C[S].State,c[w+1][S].Expander=C[S].Expander),S++}while(S<=parseInt(d.split(",")[1]))}if(0==(P="row"==l?e.map(c[parseInt(d.split(",")[0])+1],function(e){if("rowheader"==e.CSS||e.CSS.indexOf("summary")>-1)return e}).length:e.map(c,function(e){if(!t.isNullOrUndefined(e)&&!t.isNullOrUndefined(e[V+1])&&("colheader"==e[V+1].CSS||e[V+1].CSS.indexOf("summary")>-1))return e}).length))if("row"==l){E=parseInt(d.split(",")[0])+1;do{delete c[E],E++}while(!t.isNullOrUndefined(c[E])&&("none"==c[E][0].CSS||""==c[E][0].Value))}else{V=parseInt(d.split(",")[1])+1;do{for(w=0;w<c.length;w++)t.isNullOrUndefined(c[w])||(c[w]=e.map(c[w],function(e){if(parseInt(e.Index.split(",")[1])!=V)return e}));V++}while(V<c[0][0].RowSpan-(i.values.length>0&&"rows"!=i.values[0].axis?1:0))}if(E=(H=t.Pivot._getEnginePos(s,d,c)).colPos,V=H.rowPos,"row"==l){for(w=0;w<c[parseInt(d.split(",")[0])].length;w++)if(c[parseInt(d.split(",")[0])][w].Index==d){c[parseInt(d.split(",")[0])][w].Value=c[parseInt(d.split(",")[0])][w].Value.replace(" Total",""),c[parseInt(d.split(",")[0])][w].State=2,c[parseInt(d.split(",")[0])][w].ColSpan=0==P?c[parseInt(d.split(",")[0])][w].ColSpan-1:c[parseInt(d.split(",")[0])][w].ColSpan;break}}else c[E][V].Value=c[E][V].Value.replace(" Total",""),c[E][V].State=2,c[E][V].RowSpan=0==P?c[E][V].RowSpan-1:c[E][V].RowSpan;O=t.Pivot._drillSpanCalculation(c,n)}return O},_getDrillRange:function(i,l,a,r,n){var o,s,d=0,u=0,c="",p="",h=r,g="row"==l?a._drillParams.currRow.split(">#>"):a._drillParams.currCol.split(">#>");do{if((o="row"==l?parseInt((d-1)/r):u)+1==g.length){if((!("none"!=n[d].CSS&&""!=n[d].Value||t.isNullOrUndefined(n["row"==l?d-r:d-1])||"string"!=typeof n["row"==l?d-r:d-1].Value||n["row"==l?d-r:d-1].Value.replace(" Total","")!=e.trim(g[o<1?0:o-1]))||"string"==typeof n[d].Value&&""!=n[d].Value&&n[d].Value.replace(" Total","")!=e.trim(g[o]))&&""!=c){for(s="row"==l?d-1:d-r;!t.isNullOrUndefined(n[s])&&"summary rstot"!=n[s].CSS&&"summary cstot"!=n[s].CSS&&"summary stot"!=n[s].CSS;)s="row"==l?s-1:s-r;t.isNullOrUndefined(n[s])||(p=n[s].Index);break}"string"==typeof n[d].Value&&n[d].Value.replace(" Total","")==e.trim(g[o])&&(c=""==c?n[d].Index:c)}else n[d].Value.replace(" Total","")==e.trim(g[o])&&(d="row"==l?h*(o+1)+(d-1):d-h+1);u=(d="row"==l?d+1:d+r)%r,"column"==l&&d>n.length&&(d=++u)}while(n.length>d&&""==p);return"drillup"==a._drillAction&&a.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&("column"==l&&i.values.length>0&&"row"!=i.values[0].axis?p=parseInt(p.split(",")[0])-(i.values.length-1)+","+p.split(",")[1]:"row"==l&&i.values.length>0&&"row"==i.values[0].axis&&(p=p.split(",")[0]+","+(parseInt(p.split(",")[1])-(i.values.length-1)))),{startPos:c,endPos:p}},_drillSpanCalculation:function(i,l){for(var a,r,n,o,s,d=l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(l.getOlapReport()).PivotCalculations:l.getOlapReport().values,u=l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(l.getOlapReport()).PivotColumns:l.getOlapReport().columns,c=l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(l.getOlapReport()).PivotRows:l.getOlapReport().rows,p=[],h=[],g=e.map(i,function(e){if(!t.isNullOrUndefined(e))return e[0]}).length,m=0;m<i[0].length;m++){for(O=0,a=0,s=0;s<i.length;s++)t.isNullOrUndefined(i[s])||t.isNullOrUndefined(i[s][m])||(O++,i[s][m].ColSpan>g-O+1&&(i[s][m].ColSpan=g-O+1),"none"!=i[s][m].CSS&&""!=i[s][m].Value&&a++);0==a&&p.push(m)}for(m=0;m<i.length;m++)t.isNullOrUndefined(i[m])||(r=e.map(i[m],function(e,t){if(-1==p.indexOf(t))return e.RowSpan>=i[m].length-t&&(e.RowSpan=i[m].length-t),"summary value"==e.CSS&&(e.RowSpan=1,e.ColSpan=1),e}),h[m]=r);i=h;var f=u.length+(d.length>0&&"rows"!=d[0].axis?d.length:0),_=c.length+(d.length>0&&"rows"==d[0].axis?d.length:0),v=-1;do{v++}while(!(t.isNullOrUndefined(i[0])||t.isNullOrUndefined(i[0][v])||"none"!=i[0][v].CSS&&""!=i[0][v].Value));i[0][0].RowSpan=v>f?f:v,v=d.length>0&&"rows"!=d[0].axis?v-1:v,n=-1,o=0;do{n++}while(!t.isNullOrUndefined(i[n])&&("none"==i[n][0].CSS||""==i[n][0].Value));for(i[0][0].ColSpan=n>_?_:n,m=0;m<i[0].length;m++)for(O=d.length>0&&"rows"==d[0].axis?1:0,s=0;s<i[0][0].ColSpan;s++)t.isNullOrUndefined(i[s][m])||(O++,(0!=m||0!=s)&&i[s][m].ColSpan>i[0][0].ColSpan-O+1&&i[0][0].ColSpan-O+1>0&&(i[s][m].ColSpan=i[0][0].ColSpan-O+1));for(m=i[0][0].ColSpan-1;m<i.length;m++)if(O=d.length>0&&"rows"!=d[0].axis?1:0,!t.isNullOrUndefined(i[m]))for(s=0;s<i[0][0].RowSpan;s++)O++,(0!=m||0!=s)&&i[m][s].RowSpan>i[0][0].RowSpan-O+1&&i[0][0].RowSpan-O+1>0&&(i[m][s].RowSpan=i[0][0].RowSpan-O+1);if(!t.isNullOrUndefined(c)&&c.length>1){n=d.length>0&&"rows"==d[0].axis?n-1:n;do{i[o]=e.map(i[o],function(e){return e.CSS.indexOf("summary")>-1&&(e.ColSpan=n-o),e});var b=0,C=!1,S="";for(m=i[o].length-1;m>=i[0][0].RowSpan;m--)"summary rstot"==i[o][m].CSS||"summary stot"==i[o][m].CSS?(t.isNullOrUndefined(i[o][m+1])||"rowheader"!=i[o][m+1].CSS||(i[o][m+1].RowSpan=b),b=0,C=!0,S=""):i[0][0].RowSpan-m==0?i[o][m].RowSpan=C||S==i[o][m].Value?b+1:i[o][m].RowSpan:(S=i[o][m].Value,b++);o++}while(n>o+(d.length>0&&"rows"==d[0].axis?1:0))}if(!t.isNullOrUndefined(u)&&u.length>1){o=0;do{for(m=0;m<i.length;m++)!t.isNullOrUndefined(i[m])&&i[m][o].CSS.indexOf("summary")>-1&&(i[m][o].RowSpan=v-o);var P=0,w=(C=!1,""),O=(S="",e.grep(i,function(e,i){if(!t.isNullOrUndefined(e)&&"none"!=e[0].CSS&&""!=e[0].Value)return w=""==w?i:w,e}).length);for(m=i.length-1;m>=w;m--)O-=t.isNullOrUndefined(i[m])||"none"==i[m][0].CSS||""==i[m][0].Value?0:1,t.isNullOrUndefined(i[m])||"summary cstot"!=i[m][o].CSS&&"summary stot"!=i[m][o].CSS?0!=O||t.isNullOrUndefined(i[m])?t.isNullOrUndefined(i[m])||(S=i[m][o].Value,P++):i[m][o].ColSpan=C||S==i[m][o].Value?P+1:i[m][o].ColSpan:(t.isNullOrUndefined(i[m+1])||t.isNullOrUndefined(i[m+1][o])||"rowheader"!=i[m+1][o].CSS&&"colheader"!=i[m+1][o].CSS||(i[m+1][o].ColSpan=P),P=0,C=!0,S="");o++}while(v>o+(d.length>0&&"rows"!=d[0].axis?1:0))}return i},_calculatePagingSpan:function(i,l){var a,r;if(null!=i&&""!=i&&i.length>0){for(l._rowCount=0,a=jQuery.extend(!0,[],i),l._compJson=""==l._drillAction?jQuery.extend(!0,[],a):l._compJson,l._croppedJson=t.Pivot._cropJson(l,a),a=e.extend(!0,[],l._croppedJson),r=0;r<a.length&&0==parseInt(a[r].Index.split(",")[0]);r++)l._rowCount++;var n=l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(l.getOlapReport()).PivotRows.length:l.getOlapReport().rows.length,o=l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(l.getOlapReport()).PivotColumns.length:l.getOlapReport().columns.length,s=l.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(l.getOlapReport()).PivotCalculations.length:l.getOlapReport().values.length;a.length,l._rowCount;for(r=(0==a[0].RowSpan?0:a[0].RowSpan-1)+l.model.dataSource.pagerOptions.seriesPageSize;r<a.length&&r<l._rowCount;r+=l.model.dataSource.pagerOptions.seriesPageSize){if(a[r].CSS.indexOf("summary")>-1||a[r].CSS.indexOf("rowheader")>-1&&0==a[r].Expander&&null!=a[r+l._rowCount]&&a[r+l._rowCount].CSS.indexOf("value")>-1)continue;n>1&&t.Pivot._calculateRowPagingSpan(r,a,1,n,l)}for(r=((0==a[0].ColSpan?0:a[0].ColSpan-1)+l.model.dataSource.pagerOptions.categoricalPageSize)*l._rowCount;r<a.length;r+=l.model.dataSource.pagerOptions.categoricalPageSize*l._rowCount){if(a[r].CSS.indexOf("summary")>-1&&s<=1)continue;if(1==l.model.dataSource.pagerOptions.categoricalPageSize&&(a[r].CSS.indexOf("stot")>-1&&null!=a[r+l._rowCount]&&a[r+l._rowCount].CSS.indexOf("gtot")>-1||a[r].CSS.indexOf("gtot")>-1&&null==a[r+l._rowCount]))continue;t.Pivot._calculateColumnPagingSpan(r,a,1,o,s,l)}l._relPagingRecords=jQuery.extend(!0,[],a),l._rowCount=0}},_generatePagingRecords:function(i){var l,a,r,n,o;if(null!=i._relPagingRecords&&i._relPagingRecords.length>0){for(l=e.extend(!0,[],i._relPagingRecords),i._rowCount=0,g=0;g<l.length&&0==parseInt(l[g].Index.split(",")[0]);g++)i._rowCount++;var s=l.length/i._rowCount,d=0==l[0].RowSpan?0:l[0].RowSpan-1,u=0==l[0].ColSpan?0:l[0].ColSpan-1,c=Math.ceil((s-(u+1))/i.model.dataSource.pagerOptions.categoricalPageSize),p=Math.ceil((i._rowCount-(d+1))/i.model.dataSource.pagerOptions.seriesPageSize);i.model.dataSource.pagerOptions.categoricalCurrentPage=i.model.dataSource.pagerOptions.categoricalCurrentPage>c?c:i.model.dataSource.pagerOptions.categoricalCurrentPage,i.model.dataSource.pagerOptions.seriesCurrentPage=i.model.dataSource.pagerOptions.seriesCurrentPage>p?p:i.model.dataSource.pagerOptions.seriesCurrentPage,i._seriesPageCount=i.model.enablePaging?i._rowCount-(d+1):p,i._categPageCount=i.model.enablePaging?s-(u+1):c,i._categCurrentPage=i.model.dataSource.pagerOptions.categoricalCurrentPage,i._seriesCurrentPage=i.model.dataSource.pagerOptions.seriesCurrentPage;var h,g,m,f,_,v,b,C,S,P,w=[],O=d+1+i.model.dataSource.pagerOptions.seriesPageSize,y=u+1+i.model.dataSource.pagerOptions.categoricalPageSize;for(h=g=m=f=_=v=b=C=S=P=0,n=0;n<d+1;n++){for(o=0;o<u+1;o++)null!=l[g]&&(w[f]=l[g],g+=i._rowCount,f+=O);g=++h,f=++m}for(_=g=d+(0==i.model.dataSource.pagerOptions.seriesCurrentPage||1==i.model.dataSource.pagerOptions.seriesCurrentPage?0:(i.model.dataSource.pagerOptions.seriesCurrentPage-1)*i.model.dataSource.pagerOptions.seriesPageSize)+1,v=f=d+1,n=0;n<i.model.dataSource.pagerOptions.seriesPageSize;n++){for(o=0;o<u+1;o++)null!=l[g]&&(w[f]=l[g],g+=i._rowCount,f+=O);if(f=++v,(g=++_)>i._rowCount-1)break}for(b=g=(u+1)*i._rowCount+(0==i.model.dataSource.pagerOptions.categoricalCurrentPage||1==i.model.dataSource.pagerOptions.categoricalCurrentPage?0:(i.model.dataSource.pagerOptions.categoricalCurrentPage-1)*i.model.dataSource.pagerOptions.categoricalPageSize*i._rowCount),C=f=(u+1)*O,n=0;n<d+1;n++){for(o=0;o<i.model.dataSource.pagerOptions.categoricalPageSize;o++)null!=l[g]&&(w[f]=l[g],g+=i._rowCount,f+=O);if(f=++C,null==l[g=++b])break}for(S=g=(u+1)*i._rowCount+(0==i.model.dataSource.pagerOptions.categoricalCurrentPage||1==i.model.dataSource.pagerOptions.categoricalCurrentPage?0:(i.model.dataSource.pagerOptions.categoricalCurrentPage-1)*i.model.dataSource.pagerOptions.categoricalPageSize*i._rowCount)+d+(0==i.model.dataSource.pagerOptions.seriesCurrentPage||1==i.model.dataSource.pagerOptions.seriesCurrentPage?0:(i.model.dataSource.pagerOptions.seriesCurrentPage-1)*i.model.dataSource.pagerOptions.seriesPageSize)+1,P=f=(u+1)*O+d+1,a=0,n=0;n<i.model.dataSource.pagerOptions.seriesPageSize;n++){for(o=0;o<i.model.dataSource.pagerOptions.categoricalPageSize;o++)null!=l[g]&&(w[f]=l[g],a=parseInt(l[g].Index.split(",")[1]),g+=i._rowCount,f+=O);if(f=++P,null==l[g=++S]||a>parseInt(l[g].Index.split(",")[1]))break}for(i._rowCount=0,w=w.filter(function(e){return null!=e}),O=0,g=0;g<w.length&&0==parseInt(w[g].Index.split(",")[0]);g++)O++;for(y=w.length/O,n=0;n<y;n++)for(o=0;o<O;o++)t.isNullOrUndefined(w[n*O+o])||(w[n*O+o].Index=n+","+o);for(r=t.Pivot._drillSpanCalculation(t.Pivot._jsonToEngine(w),i),n=0;n<r.length;n++)for(o=0;o<r[n].length;o++)r[n][o].Index=n+","+o;return e.map(r,function(e){return e})}},_calculateRowPagingSpan:function(e,i,l,a,r){var n,o;if(i[e].CSS.indexOf("summary")>-1||i[e].CSS.indexOf("rowheader")>-1&&0==i[e].Expander&&l<a&&null!=i[e+r._rowCount]&&i[e+r._rowCount].CSS.indexOf("value")>-1)return!1;if(1==i[e].Expander&&i[e].RowSpan>1)i[e+1].RowSpan=i[e].RowSpan-1,i[e].RowSpan=1,i[e+1].Expander=i[e].Expander,i[e+1].State=i[e].State,i[e+1].Value=i[e].Value,i[e+1].CSS=i[e].CSS,-1==i[e+r._rowCount].CSS.indexOf("value")&&l<a-1&&t.Pivot._calculateRowPagingSpan(e+r._rowCount,i,l+1,a,r);else if(0==i[e].Expander&&null!=i[e+r._rowCount]&&l<a&&-1==i[e+r._rowCount].CSS.indexOf("value"))for(n=1,o=e-1;o>=0;o--)if(n++,1==i[o].Expander){i[o].RowSpan!=n&&(i[e+1].RowSpan=i[o].RowSpan-n,i[o].RowSpan=n,i[e+1].Expander=i[o].Expander,i[e+1].State=i[o].State,i[e+1].Value=i[o].Value,i[e+1].CSS=i[o].CSS,-1==i[e+r._rowCount].CSS.indexOf("value")&&l<a-1&&t.Pivot._calculateRowPagingSpan(e+r._rowCount,i,l+1,a,r));break}},_calculateColumnPagingSpan:function(e,i,l,a,r,n){var o,s;if(i[e].CSS.indexOf("summary")>-1&&r<=1)return!1;if(null!=i[e+n._rowCount]&&(1==i[e].Expander&&i[e].ColSpan>1||i[e].CSS.indexOf("summary")>-1&&i[e].ColSpan>1||l==a&&r>1&&i[e].ColSpan>1))i[e+n._rowCount].ColSpan=i[e].ColSpan-1,i[e].ColSpan=1,i[e+n._rowCount].Expander=i[e].Expander,i[e+n._rowCount].RowSpan=i[e].RowSpan,i[e+n._rowCount].State=i[e].State,i[e+n._rowCount].Value=i[e].Value,i[e+n._rowCount].CSS=i[e].CSS,l<a&&-1==i[e].CSS.indexOf("summary")&&t.Pivot._calculateColumnPagingSpan(e+1,i,l+1,a,r,n);else if(0==i[e].Expander&&null!=i[e+n._rowCount]&&1!=i[e+n._rowCount].Expander)for(o=1,s=e-n._rowCount;s>=0;s-=n._rowCount)if(o++,1==i[s].Expander||i[s].CSS.indexOf("summary")>-1&&i[s].ColSpan>1||l==a&&r>1&&i[s].ColSpan>1){i[s].ColSpan!=o&&(i[e+n._rowCount].ColSpan=i[s].ColSpan-o,i[s].ColSpan=o,i[e+n._rowCount].RowSpan=i[s].RowSpan,i[e+n._rowCount].Expander=i[s].Expander,i[e+n._rowCount].State=i[s].State,i[e+n._rowCount].Value=i[s].Value,i[e+n._rowCount].CSS=i[s].CSS,l<a&&-1==i[s].CSS.indexOf("summary")&&t.Pivot._calculateColumnPagingSpan(e+1,i,l+1,a,r,n));break}},createAdvanceFilterTag:function(i,l){var a,r,n,o,s,d,u,c,p,h,g="",m=(t.buildTag("li.e-separator").css("margin-left","29px")[0].outerHTML,l.element.hasClass("e-pivotschemadesigner")?l.model.pivotControl.model.operationalMode:l.model.operationalMode),f=l.element.hasClass("e-pivotschemadesigner")?l.model.pivotControl.model.analysisMode:l.model.analysisMode;if("filterTag"==i.action)g=[{id:"ascOrder",text:l._getLocalizedLabels("SortAtoZ"),parentId:null,spriteCssClass:"e-ascImage e-icon"},{id:"descOrder",text:l._getLocalizedLabels("SortZtoA"),parentId:null,spriteCssClass:"e-descImage e-icon"},{id:"clearSorting",text:l._getLocalizedLabels("ClearSorting"),parentId:null,spriteCssClass:"e-clrSort e-icon"},{id:"sep1",parentId:null,text:"",spriteCssClass:"e-seperator"},{id:"clearAllFilters",text:l._getLocalizedLabels("ClearFilterFrom"),parentId:null,spriteCssClass:"e-clrFilter e-icon"},{id:"labelFilterBtn",text:l._getLocalizedLabels("LabelFilters"),parentId:null},{id:"valueFilterBtn",text:l._getLocalizedLabels("ValueFilters"),parentId:null},{id:"labelClearFilter",parentId:"labelFilterBtn",text:l._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep2",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals_labelFilter",parentId:"labelFilterBtn",text:l._getLocalizedLabels("Equals"),spriteCssClass:"sprite"},{id:"notequals_labelFilter",parentId:"labelFilterBtn",text:l._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep3",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"beginswith",parentId:"labelFilterBtn",text:l._getLocalizedLabels("BeginsWith")+"...",spriteCssClass:"sprite"},{id:"notbeginswith",parentId:"labelFilterBtn",text:l._getLocalizedLabels("DoesNotBeginsWith")+"...",spriteCssClass:"sprite"},{id:"endswith",parentId:"labelFilterBtn",text:l._getLocalizedLabels("EndsWith")+"...",spriteCssClass:"sprite"},{id:"notendswith",parentId:"labelFilterBtn",text:l._getLocalizedLabels("DoesNotEndsWith")+"...",spriteCssClass:"sprite"},{id:"sep4",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"contains",parentId:"labelFilterBtn",text:l._getLocalizedLabels("Contains")+"...",spriteCssClass:"sprite"},{id:"notcontains",parentId:"labelFilterBtn",text:l._getLocalizedLabels("DoesNotContains")+"...",spriteCssClass:"sprite"},{id:"sep5",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan_labelFilter",parentId:"labelFilterBtn",text:l._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto_labelFilter",parentId:"labelFilterBtn",text:l._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan_labelFilter",parentId:"labelFilterBtn",text:l._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto_labelFilter",parentId:"labelFilterBtn",text:l._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"valueClearFilter",parentId:"valueFilterBtn",text:l._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep6",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals_valueFilter",parentId:"valueFilterBtn",text:l._getLocalizedLabels("Equals"),spriteCssClass:"equals"},{id:"notequals_valueFilter",parentId:"valueFilterBtn",text:l._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep7",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan_valueFilter",parentId:"valueFilterBtn",text:l._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto_valueFilter",parentId:"valueFilterBtn",text:l._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan_valueFilter",parentId:"valueFilterBtn",text:l._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto_valueFilter",parentId:"valueFilterBtn",text:l._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"sep8",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"between",parentId:"valueFilterBtn",text:l._getLocalizedLabels("Between")+"...",spriteCssClass:"sprite"},{id:"notbetween",parentId:"valueFilterBtn",text:l._getLocalizedLabels("NotBetween")+"...",spriteCssClass:"sprite"},{id:"topCount",parentId:"valueFilterBtn",text:l._getLocalizedLabels("Top10")+"...",spriteCssClass:"sprite"}],(m==t.Pivot.OperationalMode.ClientMode||m==t.Pivot.OperationalMode.ServerMode&&f==t.Pivot.AnalysisMode.Pivot)&&g.splice(g.length-1,2);else if("clearFilter"==i.action)g=t.buildTag("div.clearSorting",t.buildTag("span.e-clrSort","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label","clear sort")[0].outerHTML+t.buildTag("span.clearSortText","Clear Sorting",{padding:"5px 0px"})[0].outerHTML)[0].outerHTML+t.buildTag("div.separator",{padding:"5px 0px"})[0].outerHTML+t.buildTag("div.clearAllFilters",t.buildTag("span.e-clrFilter","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label"," clear filter")[0].outerHTML+t.buildTag("span.clearFltrText",'Clear Filter From"'+i.selectedLevel.text+'"',{padding:"5px 0px"})[0].outerHTML)[0].outerHTML;else if("sort"==i.action)g=t.buildTag("div#sortDiv.sortDiv",t.buildTag("li#ascOrder.e-ascOrder",t.buildTag("span.e-ascImage").addClass("e-icon").attr("aria-label","ascending")[0].outerHTML+l._getLocalizedLabels("Sort")+" A to Z")[0].outerHTML+t.buildTag("li#descOrder.e-descOrder",t.buildTag("span.e-descImage").addClass("e-icon").attr("aria-label","descending")[0].outerHTML+l._getLocalizedLabels("Sort")+" Z to A")[0].outerHTML)[0].outerHTML;else if("labelFilterDlg"==i.action||"valueFilterDlg"==i.action){if(a="",r=[],"labelFilterDlg"==i.action)a=t.buildTag("table.labelfilter",t.buildTag("tr",t.buildTag("td",l._getLocalizedLabels("LabelFilterLabel")).attr("colspan","2")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'  style='width:220px'/>")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1'  value='"+(i.filterInfo.length>0?m==t.Pivot.OperationalMode.ClientMode?i.filterInfo[0].values[0]:i.filterInfo[0].value1:"")+"' style='display:inline; width:160px; height:19px; margin-left:7px;' class='e-filterValues'/></br>")[0].outerHTML)[0].outerHTML)[0].outerHTML,r=[{value:"equals",option:l._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:l._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"begins with",option:l._getLocalizedLabels("BeginsWith").toLowerCase()},{value:"not begins with",option:l._getLocalizedLabels("DoesNotBeginsWith").toLowerCase()},{value:"ends with",option:l._getLocalizedLabels("EndsWith").toLowerCase()},{value:"not ends with",option:l._getLocalizedLabels("DoesNotEndsWith").toLowerCase()},{value:"contains",option:l._getLocalizedLabels("Contains").toLowerCase()},{value:"not contains",option:l._getLocalizedLabels("DoesNotContains").toLowerCase()},{value:"greater than",option:l._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:l._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:l._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:l._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()}];else{if(n=[],s="between"==e(i.selectedArgs.element).attr("id")||"notbetween"==e(i.selectedArgs.element).attr("id")||"between"==i.selectedArgs.value||"not between"==i.selectedArgs.value?"4":"3",l.element.find(".e-cubeTreeView ").length>0)n=e.map(l.element.find(".e-cubeTreeView [data-tag*='[Measures]'] "),function(t){return{option:e(t).text(),value:e(t).attr("data-tag")}});else for(d=l.element.hasClass("e-pivotschemadesigner")?l.element.find(".e-schemaValue .e-pivotButton"):l.element.find(".groupingBarPivot .values .e-pivotButton"),d=l._schemaData&&0==d.length?e(l._schemaData.element.find(".e-schemaValue .e-pivotButton")):d,u=0;u<d.length;u++)n.push({option:e(d[u]).text(),value:e(d[u]).attr("data-tag").split(":")[1]});o=e(i.selectedArgs.element).hasClass("topCount")?t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions' />").attr("width","80px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterValue1' class='e-filterValues' />").attr("width","50px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML:t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'/>").attr("width","180px")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1' value='"+(i.filterInfo.length>0?m==t.Pivot.OperationalMode.ClientMode?i.filterInfo[0].values[0]:i.filterInfo[0].value1:"")+"' style='display:inline; width:190px; height:19px;' class='e-filterValues'/>"+("4"==s?"<span>"+l._getLocalizedLabels("and")+" </span><input type='text' id='filterValue2' value='"+(i.filterInfo.length>0?m!=t.Pivot.OperationalMode.ClientMode||t.isNullOrUndefined(i.filterInfo[0].values[1])?m!=t.Pivot.OperationalMode.ServerMode||t.isNullOrUndefined(i.filterInfo[0].value2)?"":i.filterInfo[0].value2:i.filterInfo[0].values[1]:"")+"' style='display:inline; width:190px; height:19px;' class='e-filterValues'/> </br>":"</br>"))[0].outerHTML,a=t.buildTag("table.valuefilter",t.buildTag("tr",t.buildTag("td",l._getLocalizedLabels("ValueFilterLabel")).attr("colspan","Between"==i.text?"4":"3")[0].outerHTML)[0].outerHTML+t.buildTag("tr",o)[0].outerHTML)[0].outerHTML,r=[{value:"equals",option:l._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:l._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"greater than",option:l._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:l._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:l._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:l._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()},{value:"between",option:l._getLocalizedLabels("Between").toLowerCase()},{value:"not between",option:l._getLocalizedLabels("NotBetween").toLowerCase()}]}c=t.buildTag("div",t.buildTag("button#filterDlgOKBtn.e-dialogOKBtn",l._getLocalizedLabels("OK")).attr("title",l._getLocalizedLabels("OK").replace(/(<([^>]+)>)/gi,""))[0].outerHTML+t.buildTag("button#filterDlgCancelBtn.e-dialogCancelBtn",l._getLocalizedLabels("Cancel")).attr("title",l._getLocalizedLabels("Cancel").replace(/(<([^>]+)>)/gi,""))[0].outerHTML,{float:l.model.enableRTL?"left":"right",margin:"8px 0 6px"})[0].outerHTML,l.element.find(".e-dialog").remove(),e(t.buildTag("div#filterDialog.filterDialog",a+c,{opacity:"1"})).appendTo("#"+l._id),l.element.find(".filterDialog").ejDialog({enableRTL:l.model.enableRTL,enableResize:!1,cssClass:"e-labelValueFilterDlg",width:"auto",content:"#"+l._id,close:t.proxy(t.Pivot.closePreventPanel,l)}),"valueFilterDlg"==i.action&&(l.element.find(".filterMeasures").ejDropDownList({dataSource:n,width:"180px",height:"25px",fields:{text:"option",value:"value"},create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),l._measureDDL=l.element.find(".filterMeasures").data("ejDropDownList"),""!=(p=i.filterInfo.length>0&&!t.isNullOrUndefined(i.filterInfo[0].measure)?i.filterInfo[0].measure:n.length>0?n[0].value:"")&&l._measureDDL.selectItemByValue(p)),"topCount"==e(i.selectedArgs.element).attr("id")?(l.element.find("#filterOptions").ejDropDownList({dataSource:[{option:"Top",value:"topCount"},{option:"Bottom",value:"BottomCount"}],fields:{text:"option",value:"value"},value:i.filterInfo.length>0?i.filterInfo[0].operator:"topCount",create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),l.element.find("#filterValue1").ejNumericTextbox({value:i.filterInfo.length>0?parseInt(i.filterInfo[0].value1):5,minValue:1})):(h=e(i.selectedArgs.element).parent().children('li:not([id^="sep"])').index(i.selectedArgs.element),l.element.find(".filterOptions").ejDropDownList({dataSource:r,width:"180px",height:"25px",fields:{value:"value",text:"option"},selectedIndices:[h-1],change:t.proxy(l._filterOptionChanged,l),create:function(){e(this.wrapper.find(".e-input")).focus(function(){e(this).blur()})}}),0==e(i.selectedArgs.element).length&&l.element.find(".filterOptions").data("ejDropDownList").selectItemByValue(i.selectedArgs.selectedValue)),l.element.find("#filterDlgOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(l._filterElementOkBtnClick,l)}),l.element.find("#filterDlgCancelBtn").ejButton({type:t.ButtonType.Button,click:function(){e(".e-dialog").hide(),t.Pivot.closePreventPanel(l)}}),l.element.find(".e-titlebar").prepend(t.buildTag("div",("valueFilterDlg"==i.action?l._getLocalizedLabels("ValueFilters")+"(":l._getLocalizedLabels("LabelFilters")+"(")+(-1==l._selectedLevelUniqueName.indexOf(".")?l._selectedLevelUniqueName:l._selectedLevelUniqueName.indexOf(".")<0?l._selectedLevelUniqueName:l._selectedLevelUniqueName.split(".")[2].replace(/\[/g,"").replace(/\]/g,""))+")",{display:"inline"}))}return g}},t.Pivot.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"},t.Pivot.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"},t.Pivot.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.Pivot.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"},t.Pivot.AnalysisMode={Olap:"olap",Pivot:"pivot"},t.Pivot.OperationalMode={ClientMode:"clientmode",ServerMode:"servermode"}}(jQuery,Syncfusion)})},1011:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
*  filename: ej.pivotanalysis.base.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.pivotanalysis.base.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(4)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=e)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(function(){!function($,ej,undefined){ej.PivotAnalysis={_initProperties:function(){this._colkeyvalues=[],this._rowKeyValues=[],this._colKeysCalcValues=[],this._rowKeysCalcValues=[],this._tableKeysCalcValues=[],this._gridMatrix=null,this._rowTotCalc=[],this._colTotCalc=[],this._transposeEngine=[],this._tRowCnt=0,this._tColCnt=0,this._cellType="",this._valueFilterArray=ej.isNullOrUndefined(this._valueFilterArray)?[]:this._valueFilterArray,this._currentFilterVal={},this._fieldMembers={},this._summaryTypes=[],this._editCellsInfo=[],this._locale="en-US",this._valueSorting=ej.isNullOrUndefined(this._valueSorting)?null:this._valueSorting,this._sort=ej.isNullOrUndefined(this._sort)?null:this._sort,this._isPaging=!1,this._colHdrLen=1,this._rowHdrLen=1,this._rowMembers={},this._colMembers={},this._calcMembers={}},setFieldCaptions:function(e){$.each(e.rows,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)}),$.each(e.columns,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)}),$.each(e.filters,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)}),$.each(e.values,function(e,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)})},getTreeViewData:function(e){var t,i,l,a,r,n,o=[],s=[];if(null!=e.data)for(l=0;l<e.data.length;l++)jQuery.each(e.data[l],function(e){-1==jQuery.inArray(e,o)&&o.push(e)});for(jQuery.each(e.values,function(e,t){1==t.isCalculatedField&&-1==jQuery.inArray(t.fieldName,o)&&o.push(t.fieldName)}),t=[e.rows,e.columns,e.filters,e.values],i=[].concat.apply([],t),l=0;l<o.length;l++){for(a=0;a<i.length;a++)(o[l].caption==undefined||""==o[l].caption)&&i[a].fieldName==o[l]&&(o[l]={name:i[a].fieldName,caption:i[a].fieldCaption,format:i[a].format,formatString:i[a].formatString,showSubTotal:!!ej.isNullOrUndefined(i[a].showSubTotal)||i[a].showSubTotal});(o[l].caption==undefined||""==o[l].caption)&&(o[l]={name:o[l].name||o[l],caption:o[l].name||o[l]})}for(r=0;r<o.length;r++)n=$.grep(e.rows,function(e){return e.fieldName==o[r].name}).length>0||$.grep(e.columns,function(e){return e.fieldName==o[r].name}).length>0||$.grep(e.values,function(e){return e.fieldName==o[r].name}).length>0||$.grep(e.filters,function(e){return e.fieldName==o[r].name}).length>0,s.push({id:o[r].name,name:o[r].name,caption:o[r].caption,format:o[r].format,formatString:o[r].formatString,showSubTotal:!!ej.isNullOrUndefined(o[r].showSubTotal)||o[r].showSubTotal,isSelected:n,spriteCssClass:""});return s},pivotEnginePopulate:function(model){var dataSource=model.dataSource,currentObj=this,isLiteral=!1,rowFilters,lit,formatSt,uV,fields,vC,list,cnt,nC,outputString,rC,cC,isFiltered,cCnt,rCnt,temp,value,val,j,k,formula,oldValue,newValue,i;this._initProperties(),model.dataSource.enableAdvancedFilter&&0==this._valueFilterArray.length&&(this._valueFilterArray=$.grep(dataSource.columns,function(e){if(e.advancedFilter&&e.advancedFilter.length>0&&e.advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter)return e.advancedFilter}),rowFilters=$.grep(dataSource.rows,function(e){if(e.advancedFilter&&e.advancedFilter.length>0&&e.advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter)return e.advancedFilter}),rowFilters.length>0&&$.merge(this._valueFilterArray,rowFilters)),this._locale=model.locale;var colAxis=dataSource.columns,rowAxis=dataSource.rows,filters=dataSource.filters,calcValues=dataSource.values,colLen,jsonObj=[],pivotFieldList=[],rowLen;for(lit=0;dataSource.values.length>lit;lit++)if(formatSt="",dataSource.values[lit].format&&(formatSt=dataSource.values[lit].format.toLowerCase()),"string"==formatSt||"text"==formatSt||"literal"==formatSt){isLiteral=!0;break}if(this._editCellsInfo=[],!ej.isNullOrUndefined(model.editCellsInfo)){var rowHeaders=model.editCellsInfo.rowHeader,colHeaders=model.editCellsInfo.columnHeader,values=model.editCellsInfo.JSONRecords;if(!ej.isNullOrUndefined(values)){for(uV=0;uV<values.length;uV++)fields={},rowAxis.length>0&&(fields.row=rowHeaders[uV].toString().split("#").splice(0,rowAxis.length).join(">#>")),colAxis.length>0&&(fields.column=colHeaders[uV].toString().split("#").splice(0,colAxis.length).join(">#>")),fields.value=colHeaders[uV].toString().split("#")[colHeaders[uV].toString().split("#").length-1]+"#"+values[uV].Value,this._editCellsInfo.push(fields);for(vC=0;vC<calcValues.length;vC++)$.each(this._editCellsInfo,function(e,t){calcValues[vC].fieldName==t.value.split("#")[0]&&(ej.PivotAnalysis._editCellsInfo[e].value=vC+"#"+t.value.split("#")[1])})}}for(i=0;i<calcValues.length;i++)this._summaryTypes.push(null!=calcValues[i].summaryType&&calcValues[i].summaryType!=undefined?calcValues[i].summaryType:ej.PivotAnalysis.SummaryType.Sum);if(null!=dataSource.data)for(cnt=0;cnt<dataSource.data.length;cnt++){list=jQuery.extend(!0,{},dataSource.data[cnt]);var table={keys:[],uniqueName:"",value:null},row={keys:[],uniqueName:"",value:null},col={keys:[],uniqueName:"",value:null},values={keys:[],uniqueName:"",value:null},isExcluded=!1;for(i=0;i<filters.length;i++)if(val=this._getReflectedValue(list,filters[i].fieldName,null,null),this._fieldMembers[filters[i].fieldName]==undefined||null==this._fieldMembers[filters[i].fieldName]?this._fieldMembers[filters[i].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[filters[i].fieldName])&&this._fieldMembers[filters[i].fieldName].push(val),null!=filters[i].filterItems&&filters[i].filterItems!=undefined&&((filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||null==filters[i].filterItems.filterType)&&$.inArray(val,filters[i].filterItems.values)>=0||filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val,filters[i].filterItems.values)<0)){isExcluded=!0;break}for(nC=0;nC<calcValues.length;nC++)val="",calcValues[nC]!=undefined&&null!=calcValues[nC]&&(list[calcValues[nC].fieldName]=model.dataSource.isFormattedValues?this._getNumber($(list).prop(calcValues[nC].fieldName),calcValues[nC].formatString):list[calcValues[nC].fieldName],val=this._getReflectedValue(list,calcValues[nC].fieldName,calcValues[nC].format,calcValues[nC].formatString),this._fieldMembers[calcValues[nC].fieldName]==undefined||null==this._fieldMembers[calcValues[nC].fieldName]?this._fieldMembers[calcValues[nC].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[calcValues[nC].fieldName])&&this._fieldMembers[calcValues[nC].fieldName].push(val)),outputString=null!=val?val.toString().replace(/([AMPME~!@#$%^&*()_+=`{}\[\]\|\\:;'<>,-.\/? ])+/g,""):"0",outputString=outputString.replace(ej.globalize.preferredCulture(this._locale).numberFormat.currency.symbol,""),$.isNumeric(outputString)||"date"==calcValues[nC].format?values.keys.push(null!=val?val:null):(values.keys.push(1),isLiteral&&(""==values.uniqueName&&(values.uniqueName=[]),ej.isNullOrUndefined(calcValues[nC].format)||"string"!=calcValues[nC].format.toLowerCase()&&"literal"!=calcValues[nC].format.toLowerCase()&&"text"!=calcValues[nC].format.toLowerCase()?values.uniqueName.push(" "):values.uniqueName.push(val)));for(rC=0;rC<rowAxis.length;rC++){if(val="",rowAxis[rC]!=undefined&&null!=rowAxis[rC])if(val=this._getReflectedValue(list,rowAxis[rC].fieldName,ej.isNullOrUndefined(rowAxis[rC].format)?null:rowAxis[rC].format,ej.isNullOrUndefined(rowAxis[rC].format)||ej.isNullOrUndefined(rowAxis[rC].formatString)?null:rowAxis[rC].formatString),this._fieldMembers[rowAxis[rC].fieldName]==undefined||null==this._fieldMembers[rowAxis[rC].fieldName]?this._fieldMembers[rowAxis[rC].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[rowAxis[rC].fieldName])&&this._fieldMembers[rowAxis[rC].fieldName].push(val),dataSource.enableAdvancedFilter&&!ej.isNullOrUndefined(rowAxis[rC].advancedFilter)&&rowAxis[rC].advancedFilter.length&&rowAxis[rC].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.LabelFilter){if(isFiltered=this._applyLabelFilter(rowAxis[rC].advancedFilter,val),isFiltered){isExcluded=!0;break}}else if(null!=rowAxis[rC].filterItems&&rowAxis[rC].filterItems!=undefined&&((rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||null==rowAxis[rC].filterItems.filterType)&&$.inArray(val,rowAxis[rC].filterItems.values)>=0||rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val,rowAxis[rC].filterItems.values)<0)){isExcluded=!0;break}null!=val&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)"),row.keys.push(val),row.uniqueName+=""==row.uniqueName?val:">#>"+val,table.keys.push(val),table.uniqueName+=""==table.uniqueName?val:">#>"+val}for(cC=0;cC<colAxis.length;cC++){if(val="",colAxis[cC]!=undefined&&null!=colAxis[cC])if(val=this._getReflectedValue(list,colAxis[cC].fieldName,ej.isNullOrUndefined(colAxis[cC].format)?null:colAxis[cC].format,ej.isNullOrUndefined(colAxis[cC].format)||ej.isNullOrUndefined(colAxis[cC].formatString)?null:colAxis[cC].formatString),this._fieldMembers[colAxis[cC].fieldName]==undefined||null==this._fieldMembers[colAxis[cC].fieldName]?this._fieldMembers[colAxis[cC].fieldName]=[val]:-1==$.inArray(val,this._fieldMembers[colAxis[cC].fieldName])&&this._fieldMembers[colAxis[cC].fieldName].push(val),dataSource.enableAdvancedFilter&&!ej.isNullOrUndefined(colAxis[cC].advancedFilter)&&colAxis[cC].advancedFilter.length&&colAxis[cC].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.LabelFilter){if(isFiltered=this._applyLabelFilter(colAxis[cC].advancedFilter,val),isFiltered){isExcluded=!0;break}}else if(null!=colAxis[cC].filterItems&&colAxis[cC].filterItems!=undefined&&((colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||null==colAxis[cC].filterItems.filterType)&&$.inArray(val,colAxis[cC].filterItems.values)>=0||colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val,colAxis[cC].filterItems.values)<0)){isExcluded=!0;break}null!=val&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)"),col.keys.push(val),col.uniqueName+=""==col.uniqueName?val:">#>"+val,table.keys.push(val),table.uniqueName+=""==table.uniqueName?val:">#>"+val}if(!isExcluded)if(this._isMemberExist("row",row,$.extend(!0,{},values),dataSource),this._isMemberExist("column",col,$.extend(!0,{},values),dataSource),!model.enablePaging&&!model.enableVirtualScrolling||0==row.keys.length&&0==col.keys.length)this._isMemberExist("calc",table,$.extend(!0,{},values),dataSource);else if(row.keys.length>0&&col.keys.length>0)for(rCnt=0;rCnt<row.keys.length;rCnt++)for(cCnt=0;cCnt<col.keys.length;cCnt++)row.keys.length==rCnt+1&&col.keys.length==cCnt+1?this._isMemberExist("calc",{keys:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)),uniqueName:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)).join(">#>"),value:null},$.extend(!0,{},values),dataSource):this._isMemberExist("calc",{cellType:"SubTot",keys:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)),uniqueName:row.keys.slice(0,rCnt+1).concat(col.keys.slice(0,cCnt+1)).join(">#>"),value:null},$.extend(!0,{},values),dataSource);else if(0==row.keys.length)for(cCnt=0;cCnt<col.keys.length;cCnt++)col.keys.length==cCnt+1?this._isMemberExist("calc",{keys:col.keys.slice(0,cCnt+1),uniqueName:col.keys.slice(0,cCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource):this._isMemberExist("calc",{cellType:"SubTot",keys:col.keys.slice(0,cCnt+1),uniqueName:col.keys.slice(0,cCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource);else for(rCnt=0;rCnt<row.keys.length;rCnt++)row.keys.length==rCnt+1?this._isMemberExist("calc",{keys:row.keys.slice(0,rCnt+1),uniqueName:row.keys.slice(0,rCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource):this._isMemberExist("calc",{cellType:"SubTot",keys:row.keys.slice(0,rCnt+1),uniqueName:row.keys.slice(0,rCnt+1).join(">#>"),value:null},$.extend(!0,{},values),dataSource)}for(i=0;i<calcValues.length;i++)if(temp=$.grep(calcValues,function(e){return 1==e.isCalculatedField}),calcValues[i].isCalculatedField&&temp.length!=calcValues.length)for(j=0;j<this._tableKeysCalcValues.length;j++){for(formula=calcValues[i].formula.replace(/\s/g,""),k=0;k<calcValues.length;k++)1!=calcValues[k].isCalculatedField&&(value=ej.globalize.parseFloat(null==this._tableKeysCalcValues[j].value.keys[k]?"0":"date"==calcValues[k].format?this._dateToInt(this._tableKeysCalcValues[j].value.keys[k].toString()).toString():"time"==calcValues[k].format?this._dateToInt(new Date("1900",this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[0],this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[1],this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[2].split(" ")[0]).toString()).toString():this._tableKeysCalcValues[j].value.keys[k].toString(),this._locale),formula=formula.replace(new RegExp(calcValues[k].fieldName,"g"),"percentage"==calcValues[k].format&&0!=value?value<0?"("+value/100+")":value:value<0?"("+value+")":value));formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",calcValues[i].format,calcValues[i].formatString):null==dataSource.values[i].format?0:"0",newValue=null==dataSource.values[i].format?0:"0",this._tableKeysCalcValues[j].value.keys[i]=this._getSummaryValue(oldValue,newValue,1,this._summaryTypes[i],dataSource.values[i].format,dataSource.values[i].formatString)}else if(calcValues[i].isCalculatedField)for(val={keys:[],uniqueName:"",value:null},j=0;j<this._tableKeysCalcValues.length;j++){for(k=0;k<calcValues.length&&calcValues[k].isCalculatedField;k++)formula=calcValues[k].formula.replace(/\s/g,""),formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",calcValues[k].format,calcValues[k].formatString):null==dataSource.values[k].format?0:"0",newValue=null==dataSource.values[k].format?0:"0",val.keys.push(this._getSummaryValue(oldValue,newValue,1,"sum",dataSource.values[k].format,dataSource.values[k].formatString));this._tableKeysCalcValues[j].value=val,val={keys:[],uniqueName:"",value:null}}if(rowAxis.length>0&&(this._rowKeysCalcValues=this._sortHeaders(this._rowKeysCalcValues,rowAxis,0)),colAxis.length>0&&(this._colKeysCalcValues=this._sortHeaders(this._colKeysCalcValues,colAxis,0)),this._colkeyvalues=$.extend([],this._colKeysCalcValues),this._rowKeyValues=$.extend([],this._rowKeysCalcValues),colAxis.length>0&&this._insertTotalHeader(colAxis,this._colKeysCalcValues),rowAxis.length>0)this._insertTotalHeader(rowAxis,this._rowKeysCalcValues);else if(calcValues.length>0)if(this._rowKeysCalcValues.length>0)this._rowKeysCalcValues[0].keys[0]="Grand Total";else{for(this._rowKeysCalcValues.push({keys:[""],value:{keys:[]}}),i=0;i<calcValues.length;i++)this._rowKeysCalcValues[0].value.keys.push();this._rowKeysCalcValues[0].keys[0]="Grand Total"}return this._fillEngine(model)},_fillEngine:function(e){var t,i,l,a,r,n,o,s,d;(e.enablePaging||e.enableVirtualScrolling)&&(this._isPaging=!0,this._colHdrLen=1,this._rowHdrLen=1,this._controlObj._colKeysCalcValues=$.extend(!0,[],this._colKeysCalcValues),this._controlObj._rowKeysCalcValues=$.extend(!0,[],this._rowKeysCalcValues),this._controlObj._tableKeysCalcValues=$.extend(!0,[],this._tableKeysCalcValues),this._cropHeaders(),this._applyPaging());var u=e.dataSource,c=[],p=u.columns,h=u.rows,g=(u.filters,u.values);for(this._tRowCnt=0,this._tColCnt=0,this._currentFilterVal=this._valueFilterArray.length>0?this._valueFilterArray[0]:{},this._calculateValues(u),l=0;l<this._valueFilterArray.length;l++)this._advancedFilterInfo.length>0&&(this,this._rowKeysCalcValues=this._filterKeyValues(this._rowKeyValues),this._colKeysCalcValues=this._filterKeyValues(this._colkeyvalues),this._gridMatrix=null,this._colkeyvalues=$.extend([],this._colKeysCalcValues),this._rowKeyValues=$.extend([],this._rowKeysCalcValues),p.length>0&&this._insertTotalHeader(p,this._colKeysCalcValues),h.length>0?this._insertTotalHeader(h,this._rowKeysCalcValues):g.length>0&&(this._rowKeysCalcValues[0].keys[0]="Grand Total"),this._tRowCnt=0,this._tColCnt=0,this._currentFilterVal=this._valueFilterArray.length!=l+1?this._valueFilterArray[l+1]:{},this._calculateValues(u));if(t=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType,this._colTotCalc=[],this._rowTotCalc=[],this._colKeysCalcValues=[],this._rowKeysCalcValues=[],this._tableKeysCalcValues=[],this._transposeEngineCreation(),!ej.isNullOrUndefined(e.valueSortSettings)&&!ej.isNullOrUndefined(e.valueSortSettings.sortOrder)&&"none"!=e.valueSortSettings.sortOrder&&e.dataSource.values.length>0&&(!ej.isNullOrUndefined(this._valueSorting)||!ej.isNullOrUndefined(e.valueSortSettings.headerText)&&""!=e.valueSortSettings.headerText))if(i=0,e.valueSortSettings.headerDelimiters=e.valueSortSettings.headerDelimiters==undefined?"##":e.valueSortSettings.headerDelimiters,ej.isNullOrUndefined(this._valueSorting)){for(l=0;l<this._transposeEngine.length;l++){for(a=0;a<e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters).length;a++)ej.isNullOrUndefined(this._transposeEngine[l][a])||this._transposeEngine[l][a].Value!=e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters)[a]||i++;if(i==e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters).length){this._valueSorting=l;break}i=0}this._sort=ej.isNullOrUndefined(e.valueSortSettings)||ej.isNullOrUndefined(e.valueSortSettings.sortOrder)?this._sort:e.valueSortSettings.sortOrder,e.dataSource.columns.length+1!=e.valueSortSettings.headerText.split(e.valueSortSettings.headerDelimiters).length||ej.isNullOrUndefined(this._valueSorting)||this._applyValueSorting(e)}else this._applyValueSorting(e);for(r=0;r<this._tColCnt-1;r++){if(r<(n=0==h.length?1:this._isPaging?this._rowHdrLen:h.length))for(0==(o=(t?1:this._isPaging?this._colHdrLen:p.length)+(u.values.length>0?1:0))&&n>0&&(o=1),s=0;s<o;s++)this._gridMatrix.length>0&&c.push({Index:r+","+s,CSS:"none",Value:"",State:0,ColSpan:0==r&&0==s?n:1,RowSpan:0==r&&0==s?(t?1:this._isPaging?this._colHdrLen:p.length)+(u.values.length>0?1:0):1,Info:"",Span:"None",Expander:0});for(d=0;d<this._tRowCnt-1;d++)this._transposeEngine[r]==undefined||this._transposeEngine[r][d]==undefined||d<(t?1:this._isPaging?this._colHdrLen:p.length)+(u.values.length>0?1:0)&&r<n||c.push(this._transposeEngine[r][d])}return this._gridMatrix=[],u.rows[0]==undefined&&(u.rows.length=0),{json:c,pivotEngine:this._transposeEngine}},_cropHeaders:function(){var e,t,i,l,a=this._controlObj._drillHeaders.row,r=this._controlObj._drillHeaders.column,n=[],o=2,s=this._controlObj.model.enableCollapseByDefault,d=this._controlObj.model.dataSource.rows.length,u=this._controlObj.model.dataSource.columns.length;do{if(t=2==o?$.extend(!0,[],this._rowKeysCalcValues):$.extend(!0,[],this._colKeysCalcValues),s||(2==o?a.length>0:r.length>0)){for(i=0,e="",l=t.length-1;l>=0;l--)if(!ej.isNullOrUndefined(t[l])){ej.isNullOrUndefined(t[l].cellType)||ej.isNullOrUndefined(t[l].uniqueName)||(-1==t[l].uniqueName.indexOf(">#>")?t[l].uniqueName==e:-1!=t[l].uniqueName.indexOf(e))||(e="",i=t[l].level),s&&0==t[l].level&&""==e&&(i=0),(s?t[l].level!=i:""!=e)||ej.isNullOrUndefined(t[l].cellType)||ej.isNullOrUndefined(t[l].uniqueName)||!(2==o?a.indexOf(t[l].uniqueName)>-1:r.indexOf(t[l].uniqueName)>-1)||(e=t[l].uniqueName,i++);var c=e==t[l].uniqueName,p="RGTot"==t[l].cellType,h=t[l].level==i;(s?c||p||h||(2==o?i>d-2:i>u-2):""==e||ej.isNullOrUndefined(t[l].uniqueName)||c)&&((s?h:c)&&!ej.isNullOrUndefined(t[l].keys)&&t[l].keys.length>0&&!p&&""!=t[l].uniqueName&&(t[l].keys[t[l].keys.length-1]=t[l].keys[t[l].keys.length-1].replace(" Total","").replace("%####%",""),t[l].expander=2),n.push(t[l]))}2==o?this._rowKeysCalcValues=$.extend(!0,[],n.reverse()):this._colKeysCalcValues=$.extend(!0,[],n.reverse())}n=[],o--}while(o>0)},_applyPaging:function(){var e,t=[];this._controlObj._seriesPageCount=this._controlObj.model.enablePaging?this._rowKeysCalcValues.length:Math.ceil(this._rowKeysCalcValues.length/this._controlObj.model.dataSource.pagerOptions.seriesPageSize),this._controlObj._categPageCount=this._controlObj.model.enablePaging?this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1):Math.ceil(this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)/this._controlObj.model.dataSource.pagerOptions.categoricalPageSize),this._controlObj._categPageCount=0==this._controlObj._categPageCount?1:this._controlObj._categPageCount,this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage=this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage*this._controlObj.model.dataSource.pagerOptions.seriesPageSize>this._rowKeysCalcValues.length?Math.ceil(this._rowKeysCalcValues.length/this._controlObj.model.dataSource.pagerOptions.seriesPageSize):this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage,this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage=this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize>this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)?Math.ceil(this._colKeysCalcValues.length*(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)/this._controlObj.model.dataSource.pagerOptions.categoricalPageSize):this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage,this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage=0==this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage?1:this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage,this._controlObj._seriesCurrentPage=this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage,this._controlObj._categCurrentPage=this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage;var i=this._controlObj.model.dataSource.pagerOptions.seriesCurrentPage*this._controlObj.model.dataSource.pagerOptions.seriesPageSize-this._controlObj.model.dataSource.pagerOptions.seriesPageSize,l=Math.ceil((this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize-this._controlObj.model.dataSource.pagerOptions.categoricalPageSize)/(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1)),a=i+this._controlObj.model.dataSource.pagerOptions.seriesPageSize,r=Math.ceil(this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize/(this._controlObj.model.dataSource.values.length>0?this._controlObj.model.dataSource.values.length:1));l=(this._controlObj.model.dataSource.pagerOptions.categoricalCurrentPage-1)*this._controlObj.model.dataSource.pagerOptions.categoricalPageSize%this._controlObj.model.dataSource.values.length>0?l-1:l;for(e=i;e<a;e++)t.push(this._rowKeysCalcValues[e]);for(t=this._spanCalculation(t),this._rowKeysCalcValues=$.extend(!0,[],t),t=[],e=l;e<r;e++)t.push(this._colKeysCalcValues[e]);t=this._spanCalculation(t),this._colKeysCalcValues=$.extend(!0,[],t)},_spanCalculation:function(e){for(var t,i,l,a,r=0;r<e.length;r++)if(e.length>0&&!ej.isNullOrUndefined(e[r])&&!ej.isNullOrUndefined(e[r].uniqueName)){for(t=e[r].uniqueName.split(">#>"),[],e[r].keys[e[r].level]=e[r].keys[0],e[r].span=ej.isNullOrUndefined(e[r].span)?[]:e[r].span,i=ej.isNullOrUndefined(e[r].level)?e[r].span.length>0?e[r].span.length-2:e[r].keys.length-2:e[r].level-1;i>=0;i--){l=r+1,e[r].keys[i]=t[i],e[r].span[i]=1;do{if(!(!ej.isNullOrUndefined(e[l])&&e[l].uniqueName.split(">#>").indexOf(t[i])>-1&&e[l].uniqueName.split(">#>").indexOf(t[i])<e[l].uniqueName.split(">#>").length-1))break;e[r].span[i]++,l++}while(l<e.length)}ej.isNullOrUndefined(e[r].span)||0!=e[r].span.length||delete e[r].span}return a=e.length,$.map(e,function(e,t){if(!ej.isNullOrUndefined(e)&&!ej.isNullOrUndefined(e.span))for(var i=0;i<e.span.length;i++)e.span[i]=e.span[i]>a-t?a-t:e.span[i];return e})},_applyValueSorting:function(e){for(var t,i,l,a,r,n,o,s,d,u,c=[],p=[],h=0,g=0,m="",f=0;f<this._transposeEngine.length;f++)for(c[h]=[],ej.isNullOrUndefined(p[g])&&(p[g]=[]),u=0;u<this._transposeEngine[f].length&&this._valueSorting==Number(this._transposeEngine[f][u].Index.split(",")[0]);u++)("colheader"==this._transposeEngine[f][u].CSS||"calc"==$.trim(this._transposeEngine[f][u].CSS)||"colheader calc"==this._transposeEngine[f][u].CSS||"summary cstot"==this._transposeEngine[f][u].CSS||"summary cstot calc"==this._transposeEngine[f][u].CSS||"summary cgtot"==this._transposeEngine[f][u].CSS||"summary cgtot calc"==this._transposeEngine[f][u].CSS)&&(m=""==m?this._transposeEngine[f][u].Value:m+e.valueSortSettings.headerDelimiters+this._transposeEngine[f][u].Value),"value"==this._transposeEngine[e.dataSource.rows.length][u].CSS&&(c[h].push(this._transposeEngine[f][u]),g=0),"summary value"==this._transposeEngine[e.dataSource.rows.length][u].CSS&&(p[g].push(this._transposeEngine[f][u]),c[h].length>0&&(c[h+=1]=[]),"summary rgtot"!=this._transposeEngine[0][u].CSS&&p[g].length>0&&g++,ej.isNullOrUndefined(p[g])&&(p[g]=[]));for(e.valueSortSettings.headerText=m,e.valueSortSettings.sortOrder=this._sort,h=0;h<c.length;h++)for(f=0;f<c[h].length;f++)for(u=f;u<c[h].length;u++)("descending"==this._sort?this._getNumber(c[h][f].Value)<this._getNumber(c[h][u].Value):this._getNumber(c[h][f].Value)>this._getNumber(c[h][u].Value))&&(l=c[h][u],c[h][u]=c[h][f],c[h][f]=l);for(h=0;h<c.length;h++)0==c[h].length&&c.splice(h,1);for(t=[],f=0;f<this._tRowCnt-1;f++)t[f]={index:0,level:-1};var _=0,v=[],b=[];for(h=p.length-2;h>=0;h--){for(i=0,u=0;u<p[h].length;u++)for(f=u;f<p[h].length;f++)("descending"==this._sort?this._getNumber(p[h][u].Value)<this._getNumber(p[h][f].Value):this._getNumber(p[h][u].Value)>this._getNumber(p[h][f].Value))&&(l=p[h][f],p[h][f]=p[h][u],p[h][u]=l);if(0==_)for(u=0;u<p[h].length;u++)t[i=0==i?this._transposeEngine[_][Number(p[h][u].Index.split(",")[1])].MCnt+e.dataSource.columns.length+1:this._transposeEngine[_][Number(p[h][u].Index.split(",")[1])].MCnt+i+1]={index:Number(p[h][u].Index.split(",")[1]),level:_},v[u]==undefined&&(v[u]={}),v[u].end=Number(p[h][u].Index.split(",")[1]),v[u].start=Number(p[h][u].Index.split(",")[1])-this._transposeEngine[_][Number(p[h][u].Index.split(",")[1])].MCnt;else{for(a=[],r=0,s=0;s<v.length;s++){for(a=[],u=0;u<p[h].length;u++)Number(p[h][u].Index.split(",")[1])>v[s].start&&Number(p[h][u].Index.split(",")[1])<v[s].end&&a.push(p[h][u]);for(u=0;u<a.length;u++)t[i=0==i?this._transposeEngine[_][Number(a[u].Index.split(",")[1])].MCnt+e.dataSource.columns.length+1:this._transposeEngine[_][Number(a[u].Index.split(",")[1])].MCnt+i+1]={index:Number(a[u].Index.split(",")[1]),level:_},b[r]==undefined&&(b[r]={}),b[r].end=Number(a[u].Index.split(",")[1]),b[r].start=Number(a[u].Index.split(",")[1])-this._transposeEngine[_][Number(a[u].Index.split(",")[1])].MCnt,r++;for(;i<this._tRowCnt-2&&t[i].level>t[i+1].level;)i++;i--}v=jQuery.extend(!0,[],b)}_++}if(1==p.length&&p[0].length>0)for(n=e.dataSource.columns.length+1,f=0;f<c[0].length;f++)t[n]={index:Number(c[0][f].Index.split(",")[1])},n++;for(o=e.dataSource.columns.length+1,s=0;s<v.length;s++)for(h=0;h<c.length;h++)if(Number(c[h][0].Index.split(",")[1])>=v[s].start&&Number(c[h][0].Index.split(",")[1])<=v[s].end){for(u=0,f=v[s].start;f<v[s].end;f++)t[o]={index:Number(c[h][u].Index.split(",")[1])},u++,o++;for(o++;0!=t[o].index&&o<=t.length;)o++}for(d=[],f=0;f<e.dataSource.columns.length+1;f++)t[f]={index:f};for(f=0;f<t.length-1;f++)d.push(this._gridMatrix[t[f].index]);for(d.push(this._gridMatrix[f]),f=0;f<this._gridMatrix.length&&this._gridMatrix[f]!=undefined&&d[f]!=undefined;f++)for(u=0;u<this._gridMatrix[f].length&&this._gridMatrix[f][u]!=undefined;u++)this._gridMatrix[f][u]!=undefined&&d[f][u]!=undefined&&(d[f][u].Index=this._gridMatrix[f][u].Index);for(u=0;u<e.dataSource.rows.length-1;u++){var C=e.dataSource.columns.length+1,S=0,P=(h=0,!1);for(f=e.dataSource.columns.length+(e.dataSource.values.length>0?1:0);f<d.length;f++)if(d[f]!=undefined&&d[f][u]!=undefined&&"rowheader"==d[f][u].CSS&&d[f][u].RowSpan!=undefined&&(P=!0,S=S>d[f][u].RowSpan?S:d[f][u].RowSpan),d[f]!=undefined&&d[f][u]!=undefined&&"summary rstot"==d[f][u].CSS&&P&&!ej.isNullOrUndefined(d[C])){for(P=!1;d[C]==undefined||d[C][u]==undefined;)C++;d[C][u].RowSpan=S,S=0,0,C=f+1,h++}}this._gridMatrix=d,this._transposeEngineCreation()},_transposeEngineCreation:function(){var e,t,i;for(this._tColCnt=this._isPaging&&this._gridMatrix.length>0?!ej.isNullOrUndefined(this._gridMatrix[0])&&this._gridMatrix[0].length>0?this._gridMatrix[0].length+1:this._gridMatrix[this._gridMatrix.length-1].length+1:this._tColCnt,e=0;e<this._tRowCnt-1;e++)for(t=0;t<this._tColCnt-1;t++)this._transposeEngine[t]==undefined&&(this._transposeEngine[t]=[]),this._gridMatrix[e]!=undefined&&this._gridMatrix[e][t]!=undefined?(i="string"==typeof this._gridMatrix[e][t]||"number"==typeof this._gridMatrix[e][t]||"object"==typeof this._gridMatrix[e][t]?0==this._gridMatrix[e][t].Value?this._gridMatrix[e][t].Value:this._gridMatrix[e][t].Value==undefined?"":ej.isNullOrUndefined(this._gridMatrix[e][t].valueText)?this._gridMatrix[e][t].Value:this._gridMatrix[e][t].valueText:"",this._transposeEngine[t][e]={Index:t+","+e,CSS:this._gridMatrix[e][t].CSS,Value:"string"==typeof i&&i.indexOf("%####%")>-1?i.replace("%####%",""):i,State:this._gridMatrix[e][t].State,RowSpan:this._gridMatrix[e][t].RowSpan!=undefined?this._gridMatrix[e][t].RowSpan:1,ColSpan:this._gridMatrix[e][t].ColSpan!=undefined?this._gridMatrix[e][t].ColSpan:1,Info:this._gridMatrix[e][t].Info,Span:"None",Expander:this._gridMatrix[e][t].Expander,MCnt:this._gridMatrix[e][t].MCnt!=undefined?this._gridMatrix[e][t].MCnt:1}):this._gridMatrix[e]!=undefined&&(this._transposeEngine[t][e]={Index:t+","+e,CSS:"none",Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0})},_filterKeyValues:function(e){var t=this;return $.grep(e,function(e){for(var i=!1,l=0;l<(!ej.isNullOrUndefined(e.uniqueName)&&e.uniqueName.split(">#>").length)&&(i=$.inArray(e.uniqueName.split(">#>")[l],t._advancedFilterInfo)>-1||i,!(i=$.inArray(e.uniqueName,t._advancedFilterInfo)>-1||i));l++);if(!i)return e})},_getFilteredIndex:function(e,t,i,l){return $.map(t,function(t,a){if(e.length>0&&l[i].keys.length>0&&e[l[i].keys.length-1].advancedFilter&&e[l[i].keys.length-1].advancedFilter.length>0&&(e[l[i].keys.length-1].advancedFilter[0].measure==t.fieldName||e[l[i].keys.length-1].advancedFilter[0].name==t.fieldName))return a})[0]},_applyValueFilter:function(e,t){var i,l,a=!1;if(e.length>0&&!ej.isNullOrUndefined(t))switch(t=this._isNumber(t)?t:ej.parseFloat(t,this._locale),i=e[0].valueFilterOperator,l=e[0].values,i.toLowerCase()){case"equals":a=!(t==JSON.parse(e[0].values[0]));break;case"notequals":a=!(t!=JSON.parse(e[0].values[0]));break;case"greaterthan":a=!(t>JSON.parse(e[0].values[0]));break;case"greaterthanorequalto":a=!(t>=JSON.parse(e[0].values[0]));break;case"lessthan":a=!(t<JSON.parse(e[0].values[0]));break;case"lessthanorequalto":a=!(t<=JSON.parse(e[0].values[0]));break;case"between":a=!(t>JSON.parse(l[0])&&t<JSON.parse(l[1]));break;case"notbetween":a=!!(t>JSON.parse(l[0])&&t<JSON.parse(l[1]));break;default:a=!(t==JSON.parse(e[0].values[0]))}return a},_applyLabelFilter:function(e,t){if(e.length>0){var i=e[0].labelFilterOperator,l=e[0].values,a=!1;switch(t=ej.isNullOrUndefined(t)?"":t.toString(),i.toLowerCase()){case"equals":a=!(t.toLowerCase()==l[0].toLowerCase());break;case"notequals":a=t.toLowerCase()==l[0].toLowerCase();break;case"contains":a=!(t.toLowerCase().indexOf(l[0].toLowerCase())>-1);break;case"notcontains":a=t.toLowerCase().indexOf(l[0].toLowerCase())>-1;break;case"beginswith":a=!(0==t.toLowerCase().indexOf(l[0].toLowerCase()));break;case"notbeginswith":a=0==t.toLowerCase().indexOf(l[0].toLowerCase());break;case"endswith":a=ej.isNullOrUndefined(t.toLowerCase().match(l[0].toLowerCase()+"$"));break;case"notendswith":a=!ej.isNullOrUndefined(t.toLowerCase().match(l[0].toLowerCase()+"$"));break;case"greaterthan":a=!(t.toLowerCase()>l[0].toLowerCase());break;case"greaterthanorequalto":a=!(t.toLowerCase()>=l[0].toLowerCase());break;case"lessthan":a=!(t.toLowerCase()<l[0].toLowerCase());break;case"lessthanorequalto":a=!(t.toLowerCase()<=l[0].toLowerCase());break;case"between":a=!(t.toLowerCase()>l[0].toLowerCase()||t.toLowerCase()<l[1].toLowerCase());break;case"notbetween":a=!!(t.toLowerCase()>l[0].toLowerCase()||t.toLowerCase()<l[1].toLowerCase());break;default:a=!(t.toLowerCase().indexOf(l[0].toLowerCase())>-1)}return a}},getMembers:function(e,t){var i,l,a;if(ej.isNullOrUndefined(t))return ej.isNullOrUndefined(this._fieldMembers)?[]:ej.isNullOrUndefined(this._fieldMembers[e])?[]:this._fieldMembers[e];for(i={},l=0;l<t.length;l++)a=t[l],$.each(a,function(e,t){ej.isNullOrUndefined(i[e])?i[e]=[t]:i[e].indexOf(t)<0&&i[e].push(t)});return i[e]},_powerFunction:function(e){if(e.indexOf("^")>-1){for(var t=[];e.indexOf("(")>-1;)e=e.replace(/(\([^\(\)]*\))/g,function(e,i){return t.push(i),"~"+(t.length-1)});for(t.push(e),e="~"+(t.length-1);e.indexOf("~")>-1;)e=e.replace(new RegExp("~(\\d+)","g"),function(e,i){return t[i].replace(/(\w*)\^(\w*)/g,"Math.pow($1,$2)")})}return e},_calculatedFieldSummaryValue:function(index,calValue,dataSource){var formula,i,value,oldValue,newValue;if(1==dataSource.values[index].isCalculatedField){for(formula=dataSource.values[index].formula.replace(/\s/g,""),i=0;i<dataSource.values.length;i++)1!=dataSource.values[i].isCalculatedField&&(value=ej.globalize.parseFloat(null==calValue[i]?"0":"date"==dataSource.values[i].format?this._dateToInt(calValue[i].toString()).toString():"time"==dataSource.values[i].format?this._dateToInt(new Date("1900",calValue[i].toString().split(":")[0],calValue[i].toString().split(":")[1],calValue[i].toString().split(":")[2].split(" ")[0]).toString()).toString():calValue[i].toString(),this._locale),formula=formula.replace(new RegExp(dataSource.values[i].fieldName,"g"),"percentage"==dataSource.values[i].format&&0!=value?value<0?"("+value/100+")":value:value<0?"("+value+")":value));return formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",dataSource.values[index].format,dataSource.values[index].formatString):null==dataSource.values[index].format?0:"0",newValue=null==dataSource.values[index].format?0:"0",this._getSummaryValue(oldValue,newValue,1,"count"==this._summaryTypes[index]?"sum":this._summaryTypes[index],dataSource.values[index].format,dataSource.values[index].formatString)}},_sortHeaders:function(e,t,i){for(var l,a=[],r=[],n=0,o=t[i].sortOrder!=ej.PivotAnalysis.SortOrder.None?ej.isNullOrUndefined(t[i].format)?ej.DataManager(e).executeLocal(ej.Query().sortBy("keys."+i,null!=t[i].sortOrder&&t[i].sortOrder==ej.PivotAnalysis.SortOrder.Descending?ej.sortOrder.Descending:ej.sortOrder.Ascending,!1)):this._getSortedHeaders(e,t,i):e;n<o.length;)l=o[n].keys[i],(a=$.grep(o,function(e){return e.keys[i]==l})).length>1&&i+1<o[n].keys.length&&(a=this._sortHeaders(a,t,i+1)),r=r.concat(a),n+=a.length;return r},_getSortedHeaders:function(e,t,i){return t[i].sortOrder==ej.PivotAnalysis.SortOrder.Descending?e.sort(function(e,l){return ej.PivotAnalysis._formatToInt(l.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)-ej.PivotAnalysis._formatToInt(e.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)}):e.sort(function(e,l){return ej.PivotAnalysis._formatToInt(e.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)-ej.PivotAnalysis._formatToInt(l.keys[i],ej.isNullOrUndefined(t[i].format)?null:t[i].format,ej.isNullOrUndefined(t[i].formatString)?null:t[i].formatString)})},_isValidTime:function(e){var t=e.indexOf(":")>-1?e.split(":"):[];return 3==t.length&&(t[3]=t[2].indexOf(" ")>-1?t[2].split(" ")[1]:"AM",t[2]=t[2].indexOf(" ")>-1?t[2].split(" ")[0]:t[2],!(!(Number(t[0])>-1&&Number(t[0])<13&&Number(t[1])>-1&&Number(t[1])<61&&jQuery.isNumeric(t[2]))||"AM"!=t[3]&&"PM"!=t[3]))},_getNumber:function(e,t){return ej.isNullOrUndefined(e)||(jQuery.isNumeric(e.toString().replace(/[,.]/g,""))?(e=e.toString().replace(/[,]/g,","==ej.preferredCulture(this._locale).numberFormat[","]?"":"~").replace(/[.]/g,"."==ej.preferredCulture(this._locale).numberFormat["."]?".":""),e=Number(e.toString().replace(/[~]/g,"."))):e=this._isValidTime(e)?this._formatToInt(e,"time",t):ej.isNullOrUndefined(ej.parseDate(e,t==undefined?"MM/dd/yyyy":t))?-1!=e.indexOf("/")&&2==e.split("/")?this._formatToInt(e,"fraction",undefined):$.trim(e).indexOf("%")==$.trim(e).length-1?Number(e.replace(/[^\d.-]/g,""))/100:/[a-zA-Z]/.test(e)?1:Number(e.replace(/[^\d.-]/g,"")):this._formatToInt(e,"date",t)),e},_setFormat:function(e,t,i){switch(t){case"percentage":var l=jQuery.isNumeric(e)?1:100;e="string"==typeof e?$.trim(e.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",",".").replace(ej.preferredCulture(this._locale).numberFormat.percent.symbol,"")):e,e=jQuery.isNumeric(e)?e:0,e=ej.widgetBase.formatting(i||"{0:P}",""==e?0:e/l,this._locale);break;case"decimal":case"number":e="string"==typeof e?e.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):e,e=jQuery.isNumeric(e)?e:0,e=ej.widgetBase.formatting(i||"{0:N}",e,this._locale);break;case"currency":e="string"==typeof e?$.trim(e.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",",".").replace(ej.preferredCulture(this._locale).numberFormat.currency.symbol,"")):e,e=jQuery.isNumeric(e)?e:0,e=ej.widgetBase.formatting(i||"{0:C2}",""==e?0:e,this._locale);break;case"date":jQuery.isNumeric(e)?(e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",e,this._locale))):"Invalid Date"!=new Date(e)?(e=new Date(e),e=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",e,this._locale)):(e=new Date(864e5*(Number(0)-2)+new Date("01/01/1900").getTime()),e=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",e,this._locale));break;case"scientific":e="string"==typeof e?e.split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):e,e=jQuery.isNumeric(e)?e:0,e=Number(e).toExponential(2).replace("e","E");break;case"accounting":e=this._toAccounting(e,i||"{0:C2}",this._locale);break;case"time":jQuery.isNumeric(e)?(e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale))):this._isValidTime(e)?e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale):(e=new Date(864e5*(Number(0)-2)+new Date("01/01/1900").getTime()),e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale));break;case"fraction":e="string"==typeof e?e.split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):e,e="numerator"in(e=jQuery.isNumeric(e)?this._toFraction(e):this._toFraction(0))?e.integer+" "+e.numerator+"/"+e.denominator:e.integer}return e},_getReflectedValue:function(e,t,i,l){var a=$(e).prop(t);return null==a?a:(jQuery.isNumeric(a)||"Invalid Date"!=new Date(a)||(i=l=null),this._setFormat(a,i,l))},_formatToInt:function(value,format,formatString){var time;switch(format){case"date":value=null!=ej.parseDate(value.toString(),formatString==undefined?"MM/dd/yyyy":formatString,this._locale)?this._dateToInt(ej.parseDate(value,formatString==undefined?"MM/dd/yyyy":formatString,this._locale)):value;break;case"percentage":value=0!=value?ej.globalize.parseFloat(value.toString(),this._locale)/100:Number(value);break;case"currency":case"accounting":value=0!=value?ej.globalize.parseFloat(ej.globalize.format(value.toString(),"c",this._locale),this._locale):Number(value);break;case"decimal":case"number":value=0!=value?ej.globalize.parseFloat(value.toString(),this._locale):Number(value);break;case"scientific":value=0!=value||0==value?parseFloat(value):Number(value);break;case"time":this._isNumber(value)||(time=value.toString().split(":"),time=new Date("1900",time[0],time[1],time[2].split(" ")[0]).toString(),value=this._dateToInt(time));break;case"fraction":var temp1=parseFloat(value.toString().split(" ")[0]),temp2=eval(value.toString().split(" ")[1])!=undefined?parseFloat(eval(value.toString().split(" ")[1])):parseFloat(0),value=0!=value?temp1+temp2:Number(value)}return value},_isDateTime:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())},_toAccounting:function(e,t,i){var l,a,r,n,o=ej.preferredCulture(i).numberFormat,s=o.currency.symbol;return val=ej.widgetBase.formatting(t,e,i),val=val.indexOf(" ")>-1?val.split(" ").join(""):val,r=val.replace(s,""),n=jQuery.isNumeric(r.toString().split(o[","]).join("").replace(",","."))?val.indexOf(s):0,r=jQuery.isNumeric(r.toString().split(",").join(""))?r:"0.00",!n||Number(r)<0&&1===n?(l=s,a=r):(l=r,a=s),l+"   "+a},_toFraction:function(e){if(this._isNumber(e)){var t=e.toString(),i=t.split(".")[0],l=t.split(".")[1];if(!l)return{integer:e};var a=(+l).toString(),r=this._getPlaceValue(l,a),n=this._getGCD(a,r);return{integer:i,numerator:Number(a)/n,denominator:Number(r)/n}}return null},_isNumber:function(e){return e-parseFloat(e)>=0},_getGCD:function(e,t){return e=Number(e),(t=Number(t))?this._getGCD(t,e%t):e},_getPlaceValue:function(e,t){var i=e.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_cellEdit:function(e,t,i,l){return $.each(this._editCellsInfo,function(a,r){if(e==(ej.isNullOrUndefined(r.row)&&ej.isNullOrUndefined(r.column)?"":ej.isNullOrUndefined(r.row)?r.column:ej.isNullOrUndefined(r.column)?r.row:r.row+">#>"+r.column)&&i==parseInt(r.value.split("#")[0]))return t=ej.PivotAnalysis._setFormat(ej.isNullOrUndefined(l.format)?jQuery.isNumeric(r.value.split("#")[1].toString().split(",").join(""))?parseFloat(r.value.split("#")[1].toString().split(",").join("")):0:r.value.split("#")[1],l.format,l.formatString),!1}),t},_isMemberExist:function(e,t,i,l){var a,r,n,o,s,d;switch(e){case"row":if(r=!1,(n=0==this._rowKeysCalcValues.length?0:this._rowMembers[t.uniqueName])>-1&&(r=!0,a=n),0==this._rowKeysCalcValues.length&&(this._rowKeysCalcValues.push(t),this._rowMembers[t.uniqueName]=this._rowKeysCalcValues.length-1),r)for(o=0;o<i.keys.length;o++){if(null==this._rowKeysCalcValues[a].value){this._rowKeysCalcValues[a].value=i;break}this._rowKeysCalcValues[a].value.keys[o]+=i.keys[o]}else this._rowKeysCalcValues.push(t),this._rowMembers[t.uniqueName]=this._rowKeysCalcValues.length-1;break;case"column":if(r=!1,(n=0==this._colKeysCalcValues.length?0:this._colMembers[t.uniqueName])>-1&&(r=!0,a=n),0==this._colKeysCalcValues.length&&(l.columns.length>0||l.values.length>0)&&(this._colKeysCalcValues.push(t),this._colMembers[t.uniqueName]=this._colKeysCalcValues.length-1),r)for(o=0;o<i.keys.length;o++){if(null==this._colKeysCalcValues[a].value){this._colKeysCalcValues[a].value=i;break}this._colKeysCalcValues[a].value.keys[o]+=i.keys[o]}else(l.columns.length>0||l.values.length>0)&&(this._colKeysCalcValues.push(t),this._colMembers[t.uniqueName]=this._colKeysCalcValues.length-1);break;case"calc":if(r=!1,(n=0==this._tableKeysCalcValues.length?0:this._calcMembers[t.uniqueName])>-1&&(r=!0,a=n),0==this._tableKeysCalcValues.length&&(this._tableKeysCalcValues.push(t),this._calcMembers[t.uniqueName]=this._tableKeysCalcValues.length-1),r)for(o=0;o<i.keys.length;o++){if(null==this._tableKeysCalcValues[a].value){for(this._tableKeysCalcValues[a].value=i,this._tableKeysCalcValues[a].value.count=1,d=0;d<i.keys.length;d++)this._summaryTypes[d]==ej.PivotAnalysis.SummaryType.Count&&(this._tableKeysCalcValues[a].value.keys[d]=this._tableKeysCalcValues[a].value.count);break}s=l.values[o],this._tableKeysCalcValues[a].value.uniqueName[o]==i.uniqueName[o]&&(ej.isNullOrUndefined(s.formatString)||"single-entry"!=s.formatString.toLowerCase())||(this._tableKeysCalcValues[a].value.uniqueName[o]=" "),0==o&&this._tableKeysCalcValues[a].value.count++,1!=l.values[o].isCalculatedField&&(this._tableKeysCalcValues[a].value.keys[o]=this._getSummaryValue(this._tableKeysCalcValues[a].value.keys[o],i.keys[o],this._tableKeysCalcValues[a].value.count,this._summaryTypes[o],l.values[o].format,l.values[o].formatString))}else for(this._tableKeysCalcValues.push(t),this._calcMembers[t.uniqueName]=this._tableKeysCalcValues.length-1,this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value=i,d=0;d<i.keys.length;d++)this._summaryTypes[d]==ej.PivotAnalysis.SummaryType.Count&&(this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value.keys[d]=1),this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value.count=1}},_getSummaryValue:function(e,t,i,l,a,r){if(t=ej.isNullOrUndefined(t)?null:0==t?0:t,e=ej.isNullOrUndefined(e)?null:0==e?0:e,!ej.isNullOrUndefined(t)&&!ej.isNullOrUndefined(e)){switch(e=this._formatToInt(e,a,r),t=this._formatToInt(t,a,r),l){case ej.PivotAnalysis.SummaryType.Sum:e+=t;break;case ej.PivotAnalysis.SummaryType.Average:e=(e*(i-1)+t)/i,Math.floor(e)!=e&&(e=Number(e.toFixed(2)));break;case ej.PivotAnalysis.SummaryType.Min:e=1==i?t:Math.min(e,t);break;case ej.PivotAnalysis.SummaryType.Max:e=1==i?t:Math.max(e,t);break;case ej.PivotAnalysis.SummaryType.Count:e=i}switch(a){case"percentage":e=ej.widgetBase.formatting(r||"{0:P}",e,this._locale);break;case"decimal":case"number":e=ej.widgetBase.formatting(r||"{0:N}",e,this._locale);break;case"date":e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:"+(r==undefined?"MM/dd/yyyy":r)+"}",e,this._locale));break;case"currency":e=ej.widgetBase.formatting(r||"{0:C2}",e,this._locale);break;case"scientific":e=e.toExponential(2).replace("e","E");break;case"accounting":e=this._toAccounting(e,r||"{0:C2}",this._locale);break;case"time":e=new Date(864e5*(Number(e)-2)+new Date("01/01/1900").getTime()),this._isDateTime(e)&&(e=ej.widgetBase.formatting("{0:h:mm:ss tt}",e,this._locale));break;case"fraction":e="numerator"in(e=this._toFraction(e))?e.integer+" "+e.numerator+"/"+e.denominator:e.integer}}return e},_dateToInt:function(e){var t=new Date("01/01/1900");return((this._isDateTime(e)?e:new Date(e)).getTime()-t.getTime())/864e5+2},_insertTotalHeader:function(e,t){var i,l,a,r,n;if(e.length<=1)t.push({cellType:"RGTot",keys:["Grand Total"],tot:"sub"});else{for(i=-1,l=e.length-2;l>=0;l--)if(i++,(a=t.length)>0){r=t[0].uniqueName.split(">#>"),t[0].keys[i],r=r.slice(0,l+1).join(">#>");var o="",s=0,d="";for(n=1;n<=a;n++)t[n]!=undefined?(o=(o=t[n].uniqueName.split(">#>")).slice(0,l+1).join(">#>"),d=t[n].keys[l+1]):o=undefined,o!=undefined&&-1==o.indexOf("%####%")?r!=undefined&&o!=r&&(t.splice(n,0,{keys:[r.split(">#>")[l]+" Total%####%"],cellType:"SubTot",uniqueName:r,level:l,mSpan:n-s}),t[s].span==undefined&&(t[s].span=[]),t[s].span[l]=n-s,a++,r=o,s=++n,d):r!=undefined&&(t.splice(n,0,{keys:[r.split(">#>")[l]+" Total%####%"],cellType:"SubTot:",uniqueName:r,level:l,mSpan:n-s}),t[s].span==undefined&&(t[s].span=[]),t[s].span[l]=n-s,a++,r=o,s=++n,d)}t.push({cellType:"RGTot",keys:["Grand Total"]})}},_isPreviousLevelEqual:function(e,t,i,l){for(var a=l-1;a>=0;a--)return e[t].keys[a]!=e[i].keys[a]},_calculateValues:function(e){var t,i,l=this._rowKeysCalcValues.length+(e.values.length>0?1:0),a=0==this._colKeysCalcValues.length?1:this._colKeysCalcValues.length*(0==e.values.length?1:e.values.length)+1-(this._isPaging&&e.values.length>0&&e.pagerOptions.categoricalPageSize<e.values.length*this._colKeysCalcValues.length?e.values.length-(e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length==0?e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize:e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length):0);this._isPaging&&(0==e.columns.length?ej.PivotAnalysis._colHdrLen=0:$.each(this._colKeysCalcValues,function(e,t){!ej.isNullOrUndefined(t)&&t.keys.length>ej.PivotAnalysis._colHdrLen&&(ej.PivotAnalysis._colHdrLen=t.keys.length)}),0==e.rows.length?ej.PivotAnalysis._rowHdrLen=0:$.each(this._rowKeysCalcValues,function(e,t){!ej.isNullOrUndefined(t)&&t.keys.length>ej.PivotAnalysis._rowHdrLen&&(ej.PivotAnalysis._rowHdrLen=t.keys.length)})),this._gridMatrix=new Array(l+(this._isPaging?this._rowHdrLen:e.rows.length)+1),this._populateRowHeaders(e,l+(this._isPaging?this._rowHdrLen:e.rows.length)+1,0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length),t=(this._isPaging?this._colHdrLen:e.columns.length)+1,i=(this._isPaging&&e.pagerOptions.categoricalPageSize+1<a?e.pagerOptions.categoricalPageSize+1:a)+(0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length),this._populateColumnHeaders(e,t,i),this._advancedFilterInfo=[],e.values.length>0&&this._populateCalcTable(e),this._tRowCnt=l+t,this._tColCnt=i},_populateRowHeaders:function(e,t,i){var l,a,r,n,o;if(0!=this._rowKeysCalcValues.length){for(l=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?1+(e.values.length>0?1:0):(this._isPaging?this._colHdrLen:e.columns.length)+(e.values.length>0?1:0),this._gridMatrix=[],"",a=0;a<this._rowKeysCalcValues.length;a++){this._rowKeysCalcValues[a];var s=0,d=0,u=0,c=0;if(this._rowKeysCalcValues[a].keys!=undefined&&0!=this._rowKeysCalcValues[a].keys.length)for(this._gridMatrix[l]=new Array(i),c=this._rowKeysCalcValues[a].keys.length,r=0;r<c;r++)this._rowKeysCalcValues[a].cellType!=undefined&&ej.isNullOrUndefined(this._rowKeysCalcValues[a].span)?this._rowKeysCalcValues[a].cellType.indexOf("SubTot")>-1?(d=0==s?this._rowKeysCalcValues[a].level+s:s,u=i-this._rowKeysCalcValues[a].level,this._cellType="summary rstot"):(this._cellType="summary rgtot",d=s,u=this._isPaging?this._rowHdrLen:e.rows.length):(this._cellType="rowheader",d=s,u=1),n=c>1&&c-r>1?1:ej.isNullOrUndefined(this._rowKeysCalcValues[a].expander)?0:2,o=$.extend(!0,[],this._rowKeysCalcValues[a].keys),this._gridMatrix[l][d]={Index:d+","+l,CSS:this._cellType,Value:this._rowKeysCalcValues[a].keys[r],State:n,RowSpan:this._rowKeysCalcValues[a].span!=undefined?this._rowKeysCalcValues[a].span[r]:1,ColSpan:u,Info:o.splice(0,r+1).join(">#>"),Span:"None",Expander:this._rowKeysCalcValues[a].span!=undefined?this._rowKeysCalcValues[a].span[r]!=undefined?1:ej.isNullOrUndefined(this._rowKeysCalcValues[a].expander)?0:1:ej.isNullOrUndefined(this._rowKeysCalcValues[a].expander)?0:2,MCnt:this._rowKeysCalcValues[a].mSpan!=undefined&&ej.isNullOrUndefined(this._rowKeysCalcValues[a].span)?this._rowKeysCalcValues[a].mSpan:0},this._rowKeysCalcValues[a].level-r==1&&delete this._rowKeysCalcValues[a].span,s++;l++}this._cellType=""}},_populateColumnHeaders:function(e,t){var i,l,a,r,n,o,s;if(0!=this._colKeysCalcValues.length){var d,u,c,p,h,g,m=d=0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length,f=0==e.values.length?1:e.values.length,_=u=0,v=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?1:this._isPaging?this._colHdrLen:e.columns.length;for(i=0;i<this._colKeysCalcValues.length;i++){for(_=0,c=0,p=0,0,h=f,g=0,this._isPaging&&e.values.length>0&&(g=(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length,0==i?h=(h=(1==e.pagerOptions.categoricalCurrentPage&&e.values.length>e.pagerOptions.categoricalPageSize?e.pagerOptions.categoricalPageSize:e.values.length)-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length)<1?e.values.length:e.values.length>e.pagerOptions.categoricalPageSize&&h>e.pagerOptions.categoricalPageSize?e.pagerOptions.categoricalPageSize:h:this._colKeysCalcValues.length-i==1?h=(h=e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length)<1||e.pagerOptions.categoricalPageSize>=e.values.length*this._colKeysCalcValues.length-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length?e.values.length:h:h=e.values.length),this._colKeysCalcValues[i].keys,this._gridMatrix[_]==undefined&&(this._gridMatrix[_]=[]),u=this._colKeysCalcValues[i].keys.length,l=0;l<u;l++){for(this._gridMatrix[_]==undefined&&(this._gridMatrix[_]=[]),this._colKeysCalcValues[i].cellType!=undefined&&ej.isNullOrUndefined(this._colKeysCalcValues[i].span)?this._colKeysCalcValues[i].cellType.indexOf("SubTot")>-1?(c=0==_?this._colKeysCalcValues[i].level+_:_,p=t-this._colKeysCalcValues[i].level-1,this._cellType="summary cstot"):(c=_,p=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?1:this._isPaging?this._colHdrLen:e.columns.length,this._cellType="summary cgtot"):(c=_,p=1,this._cellType="colheader"),a=u>1&&u-l>1?1:ej.isNullOrUndefined(this._colKeysCalcValues[i].expander)?0:2,o=0;o<h;o++)r=$.extend(!0,[],this._colKeysCalcValues[i].keys),this._gridMatrix[c][f*i+o+d-(i>0?g:0)]={Index:m+","+c,CSS:this._cellType,Value:this._colKeysCalcValues[i].keys[l],State:a,ColSpan:o>0?1:this._isPaging&&0==i&&!ej.isNullOrUndefined(this._colKeysCalcValues[i].span)&&this._colKeysCalcValues[i].span[l]>=this._colKeysCalcValues.length?e.pagerOptions.categoricalPageSize:(this._colKeysCalcValues[i].span!=undefined?this._colKeysCalcValues[i].span[l]==undefined?1:this._colKeysCalcValues[i].span[l]:1)*(this._colKeysCalcValues.length-i==1?h:f)-(0==i?g:0),RowSpan:p,Info:r.splice(0,l+1).join(">#>"),Span:"None",Expander:o>0?ej.isNullOrUndefined(this._colKeysCalcValues[i].expander)?0:1:this._colKeysCalcValues[i].span!=undefined&&this._colKeysCalcValues[i].span[l]!=undefined?1:ej.isNullOrUndefined(this._colKeysCalcValues[i].expander)?0:1};this._colKeysCalcValues[i].level-l==1&&delete this._colKeysCalcValues[i].span,_++}if(e.values.length>0)for(o=0;o<h;o++)this._gridMatrix[v]==undefined&&(this._gridMatrix[v]=[]),n=this._isPaging&&e.values.length>0&&0==i?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length+o:o,this._gridMatrix[v][f*i+o+d-(i>0?g:0)]={Index:f*i+o+d-(i>0?g:0)+","+_,CSS:this._cellType+" calc",Value:e.values[n].fieldCaption==undefined?e.values[n].fieldName:e.values[n].fieldCaption,State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0};m++}if(this._cellType="",this._isPaging&&e.values.length>0&&this._colKeysCalcValues.length>0&&t>1)for(o=0;o<t;o++)for(s=0;s<this._gridMatrix[o].length;s++)!ej.isNullOrUndefined(this._gridMatrix[o][s])&&this._gridMatrix[o][s].ColSpan>this._gridMatrix[o].length-s&&(this._gridMatrix[o][s].ColSpan=this._gridMatrix[o].length-s)}},_populateCalcTable:function(e){var t,i,l,a,r,n,o,s,d,u,c,p,h,g,m,f,_,v,b,C=[],S=null,P=e.values.length,w=this;this._rowTotCalc=[],this._rowTotCalc=[];var O,y=0==e.rows.length?1:this._isPaging?this._rowHdrLen:e.rows.length,x=!1,M=0,N=1==this._colKeysCalcValues.length&&"RGTot"==this._colKeysCalcValues[0].cellType?2:(this._isPaging?this._colHdrLen:e.columns.length)+1,T=N,D=!1,I={};for($.grep(w._tableKeysCalcValues,function(e){I[e.uniqueName]=e}),t=$.grep(this._tableKeysCalcValues,function(e){if(ej.isNullOrUndefined(e.cellType))return e}),$.grep(this._tableKeysCalcValues,function(e){if(!ej.isNullOrUndefined(e.cellType))return e}),f=0;f<this._rowKeysCalcValues.length;f++){for(this._colTotCalc=[],O=y,x=!0,this._gridMatrix[f+N]==undefined&&(this._gridMatrix[f+N]=[]),this._rowTotCalc[M]=[],i=0;i<this._colKeysCalcValues.length;i++){if(C=[],S=null,this._cellType="value",_=this._isPaging&&e.values.length>0&&0==i?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length:0,v=(v=this._isPaging&&e.values.length>0&&this._colKeysCalcValues.length-i==1&&i>0?e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length:P)<1||this._isPaging&&e.pagerOptions.categoricalPageSize>=e.values.length*this._colKeysCalcValues.length-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length?P:v,e.columns.length>0&&e.rows.length>0)if(!w._isPaging||"RGTot"!=w._rowKeysCalcValues[f].cellType&&"RGTot"!=w._colKeysCalcValues[i].cellType){if(l=w._rowKeysCalcValues[f].uniqueName+">#>"+w._colKeysCalcValues[i].uniqueName,a=I[l]){for(s=0;s<a.value.keys.length;s++)C.push(a.value.keys[s]);""!=a.value.uniqueName&&(S=a.value.uniqueName)}}else r=0,$.grep(t,function(t){if("RGTot"==w._rowKeysCalcValues[f].cellType&&"RGTot"==w._colKeysCalcValues[i].cellType||("RGTot"==w._rowKeysCalcValues[f].cellType?t.uniqueName.indexOf(w._colKeysCalcValues[i].uniqueName)>-1:t.uniqueName.indexOf(w._rowKeysCalcValues[f].uniqueName)>-1))for(r++,s=0;s<t.value.keys.length;s++)ej.isNullOrUndefined(C[s])?C.push(t.value.keys[s]):C[s]=e.values[s].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(s,C,e):ej.PivotAnalysis._getSummaryValue(C[s],t.value.keys[s],r,"count"==ej.PivotAnalysis._summaryTypes[s]?"sum":ej.PivotAnalysis._summaryTypes[s],e.values[s].format,e.values[s].formatString)});else 0==e.rows.length?w._isPaging?(r=0,$.grep(t,function(t){if("RGTot"==w._colKeysCalcValues[i].cellType||t.uniqueName.indexOf(w._colKeysCalcValues[i].uniqueName)>-1)for(r++,s=0;s<t.value.keys.length;s++)ej.isNullOrUndefined(C[s])?C.push(t.value.keys[s]):C[s]=e.values[s].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(s,C,e):ej.PivotAnalysis._getSummaryValue(C[s],t.value.keys[s],r,"count"==ej.PivotAnalysis._summaryTypes[s]?"sum":ej.PivotAnalysis._summaryTypes[s],e.values[s].format,e.values[s].formatString)})):$.grep(w._tableKeysCalcValues,function(e){if(e.uniqueName==w._colKeysCalcValues[i].uniqueName){for(s=0;s<e.value.keys.length;s++)C.push(e.value.keys[s]);""!=e.value.uniqueName&&(S=e.value.uniqueName)}}):w._isPaging?(r=0,$.grep(t,function(t){if("RGTot"==w._rowKeysCalcValues[f].cellType||t.uniqueName.indexOf(w._rowKeysCalcValues[f].uniqueName)>-1)for(r++,s=0;s<t.value.keys.length;s++)ej.isNullOrUndefined(C[s])?C.push(t.value.keys[s]):C[s]=e.values[s].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(s,C,e):ej.PivotAnalysis._getSummaryValue(C[s],t.value.keys[s],r,"count"==ej.PivotAnalysis._summaryTypes[s]?"sum":ej.PivotAnalysis._summaryTypes[s],e.values[s].format,e.values[s].formatString)})):$.grep(w._tableKeysCalcValues,function(e){if(e.uniqueName==w._rowKeysCalcValues[f].uniqueName){for(s=0;s<e.value.keys.length;s++)C.push(e.value.keys[s]);""!=e.value.uniqueName&&(S=e.value.uniqueName)}});if(this._editCellsInfo.length>0)for(b=0;b<e.values.length;b++)C[b]=ej.PivotAnalysis._cellEdit(e.columns.length>0&&e.rows.length>0?this._rowKeysCalcValues[f].uniqueName+">#>"+this._colKeysCalcValues[i].uniqueName:0==e.rows.length?this._colKeysCalcValues[i].uniqueName:this._rowKeysCalcValues[f].uniqueName,C[b],b,e.values[b]);if(this._colKeysCalcValues[i].cellType!=undefined&&(this._colKeysCalcValues[i].cellType.indexOf("SubTot")>-1||this._colKeysCalcValues[i].cellType.indexOf("RGTot")>-1)){if(!this._isPaging){for(C=[],S=null,s=0;s<P;s++)for(d=0,r=0,n=O;n<=i*P+y;n++)this._gridMatrix[f+N]!=undefined&&this._gridMatrix[f+N][O+d*P+s]!=undefined&&this._gridMatrix[f+N][O+d*P+s].Value!=undefined&&(C[s]==undefined&&(C[s]=0),r++,C[s]=e.values[s].isCalculatedField?this._calculatedFieldSummaryValue(s,C,e):this._getSummaryValue(C[s],this._gridMatrix[f+N][O+d*P+s].Value,r,"count"==this._summaryTypes[s]?"sum":this._summaryTypes[s],e.values[s].format,e.values[s].formatString)),d++;0,O=(i+1)*P+y,ej.isNullOrUndefined(C)||this._colTotCalc.push({uniqueName:this._colKeysCalcValues[i].uniqueName,level:this._colKeysCalcValues[i].level,value:C}),this._colKeysCalcValues[i-1]!=undefined&&this._colKeysCalcValues[i-1].cellType!=undefined&&this._colKeysCalcValues[i-1].cellType.indexOf("SubTot")>-1&&-1==this._colKeysCalcValues[i-1].cellType.indexOf("RGTot")&&($(this._colTotCalc).filter(function(e,t){return t!=undefined&&t.uniqueName!=undefined&&w._colKeysCalcValues[i].uniqueName!=undefined&&t.level!=undefined&&w._colKeysCalcValues[i].level!=undefined&&0===t.uniqueName.indexOf(w._colKeysCalcValues[i].uniqueName)&&w._colKeysCalcValues[i].level+1==t.level}).map(function(t,i){for(var l=0;l<i.value.length;l++)C[l]=ej.isNullOrUndefined(C[l])?0:C[l],i.value[l]=ej.isNullOrUndefined(i.value[l])?0:i.value[l],e.values[l].isCalculatedField?C[l]=ej.PivotAnalysis._calculatedFieldSummaryValue(l,C,e):C[l]+=i.value[l];return C}),ej.isNullOrUndefined(C)||this._colTotCalc.push({uniqueName:this._colKeysCalcValues[i].uniqueName,level:this._colKeysCalcValues[i].level,value:C}))}this._cellType="summary value"}if(this._colKeysCalcValues[i].cellType!=undefined&&this._colKeysCalcValues[i].cellType.indexOf("RGTot")>-1&&0==C&&(this._isPaging||(C=[],S=null,r=0,$(this._colTotCalc).filter(function(e,t){return t!=undefined&&t!=undefined&&t.level!=undefined&&0==t.level}).map(function(t,i){for(var l=0;l<i.value.length;l++)C[l]=ej.isNullOrUndefined(C[l])?0:C[l],i.value[l]=ej.isNullOrUndefined(i.value[l])?0:i.value[l],r++,C[l]=e.values[l].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(l,C,e):ej.PivotAnalysis._getSummaryValue(C[l],i.value[l],r,"count"==w._summaryTypes[l]?"sum":w._summaryTypes[l],e.values[l].format,e.values[l].formatString);return C})),this._cellType="summary value"),this._rowKeysCalcValues[f].cellType!=undefined&&(this._rowKeysCalcValues[f].cellType.indexOf("SubTot")>-1||this._rowKeysCalcValues[f].cellType.indexOf("RGTot")>-1)){if(!this._isPaging){for(C=[],S=null,this._rowKeysCalcValues[f].uniqueName,this._rowKeysCalcValues[f-1]!=undefined&&this._rowKeysCalcValues[f-1].cellType!=undefined&&this._rowKeysCalcValues[f-1].cellType.indexOf("SubTot")>-1&&-1==this._rowKeysCalcValues[f].cellType.indexOf("RGTot")&&(r=0,$(this._rowTotCalc).filter(function(e,t){return t[0]!=undefined&&t[0].uniqueName!=undefined&&w._rowKeysCalcValues[f].uniqueName!=undefined&&t[0].level!=undefined&&w._rowKeysCalcValues[f].level!=undefined&&0===t[0].uniqueName.indexOf(w._rowKeysCalcValues[f].uniqueName)&&w._rowKeysCalcValues[f].level+1==t[0].level}).map(function(t,l){if(l[y+i].length>0){r++;for(var a=0;a<l[y+i].length;a++)C[a]=ej.isNullOrUndefined(C[a])?0:C[a],l[y+i][a]=ej.isNullOrUndefined(l[y+i][a])?0:l[y+i][a],C[a]=e.values[a].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(a,C,e):ej.PivotAnalysis._getSummaryValue(C[a],l[y+i][a],r,"count"==w._summaryTypes[a]?"sum":w._summaryTypes[a],e.values[a].format)}return C})),this._rowKeysCalcValues[f].cellType!=undefined&&this._rowKeysCalcValues[f].cellType.indexOf("RGTot")>-1&&(r=0,$(this._rowTotCalc).filter(function(e,t){return t!=undefined&&t[0]!=undefined&&t[0].level!=undefined&&0==t[0].level}).map(function(t,l){if(l[y+i].length>0){r++;for(var a=0;a<l[y+i].length;a++)C[a]=ej.isNullOrUndefined(C[a])?0:C[a],l[y+i][a]=ej.isNullOrUndefined(l[y+i][a])?0:l[y+i][a],C[a]=e.values[a].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(a,C,e):ej.PivotAnalysis._getSummaryValue(C[a],l[y+i][a],r,"count"==w._summaryTypes[a]?"sum":w._summaryTypes[a],e.values[a].format,e.values[a].formatString)}return C})),r=1,n=T;n<=f+N;n++){for(o=!1,s=0;s<P;s++)d=0,this._gridMatrix[n]!=undefined&&this._gridMatrix[n][y+i*P+s]!=undefined&&this._gridMatrix[n][y+i*P+s].Value!=undefined&&(C[s]==undefined&&(C[s]=0),o=!0,C[s]=e.values[s].isCalculatedField?this._calculatedFieldSummaryValue(s,C,e):this._getSummaryValue(C[s],this._gridMatrix[n][y+i*P+s].Value,r,"count"==this._summaryTypes[s]?"sum":this._summaryTypes[s],e.values[s].format,e.values[s].formatString)),d++;o&&r++}0,D=!0,x&&(this._rowTotCalc[M][0]={uniqueName:this._rowKeysCalcValues[f].uniqueName,level:this._rowKeysCalcValues[f].level},x=!1),this._rowTotCalc[M][y+i]=C}this._cellType="summary value"}if(e.enableAdvancedFilter){var L=0,E=this._currentFilterVal.fieldName?ej.Pivot.getReportItemByFieldName(this._currentFilterVal.fieldName,e):null;null!=E&&"rows"==E.axis&&(L=this._getFilteredIndex(e.rows,e.values,f,this._rowKeysCalcValues)),ej.isNullOrUndefined(L)||null==E||"rows"==E.axis||(L=this._getFilteredIndex(e.columns,e.values,i,this._colKeysCalcValues)),ej.isNullOrUndefined(L)||(u=this._rowKeysCalcValues[f].keys.length>0&&e.rows.length>0&&e.rows[this._rowKeysCalcValues[f].keys.length-1].advancedFilter&&e.rows[this._rowKeysCalcValues[f].keys.length-1].advancedFilter.length>0&&e.rows[this._rowKeysCalcValues[f].keys.length-1].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter?1:null,c=!(!E||null==E||null==u||e.rows[this._rowKeysCalcValues[f].keys.length-1].fieldName!=E.item.fieldName)&&this._applyValueFilter(e.rows[this._rowKeysCalcValues[f].keys.length-1].advancedFilter,C[L]),this._colKeysCalcValues[i].keys.indexOf("Grand Total")>=0&&c&&this._rowKeysCalcValues[f].uniqueName?this._advancedFilterInfo.push(this._rowKeysCalcValues[f].uniqueName):0==e.columns.length&&c&&this._rowKeysCalcValues[f].uniqueName&&this._advancedFilterInfo.push(this._rowKeysCalcValues[f].uniqueName),p=this._colKeysCalcValues[i].keys.length>0&&e.columns.length>0&&e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter&&e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter.length>0&&e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter[0].advancedFilterType==ej.Pivot.AdvancedFilterType.ValueFilter?1:null,h=null!=E&&null!=p&&e.columns[this._colKeysCalcValues[i].keys.length-1].fieldName==E.item.fieldName&&this._applyValueFilter(e.columns[this._colKeysCalcValues[i].keys.length-1].advancedFilter,C[L]),this._colKeysCalcValues[i].uniqueName&&"string"===jQuery.type(this._rowKeysCalcValues[f].keys[0])&&this._rowKeysCalcValues[f].keys[0].indexOf("Grand Total")>-1&&h&&this._advancedFilterInfo.push(this._colKeysCalcValues[i].uniqueName))}for(g=this._isPaging&&e.values.length>0?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length:0,b=_;b<v;b++)C!=undefined&&C.length!=undefined?(m=null,null!=S&&""!=S[b]&&" "!=S[b]&&(m=S[b]),this._gridMatrix[N+f][P*i+b+y-g]={Index:P*i+b+y-g+","+N+f,CSS:this._cellType,Value:C[b],valueText:m,State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0}):this._gridMatrix[N+f][P*i+b+y-g]=0}D&&(M++,T=f+N+1,D=!1)}for(f=0;f<this._rowKeysCalcValues.length;f++)for(i=0;i<this._colKeysCalcValues.length;i++)for(_=this._isPaging&&e.values.length>0&&0==i?(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length:0,v=(v=this._isPaging&&e.values.length>0&&this._colKeysCalcValues.length-i==1&&i>0?e.pagerOptions.categoricalCurrentPage*e.pagerOptions.categoricalPageSize%e.values.length:P)<1||this._isPaging&&e.pagerOptions.categoricalPageSize>=e.values.length*this._colKeysCalcValues.length-(e.pagerOptions.categoricalCurrentPage-1)*e.pagerOptions.categoricalPageSize%e.values.length?P:v,b=_;b<v;b++)e.values[b].isCalculatedField&&null==this._gridMatrix[N+f][P*i+b+y-g].Value&&(this._gridMatrix[N+f][P*i+b+y-g].Value=this._calculatedFieldSummaryValue(b,[],e));return this._gridMatrix}},ej.PivotAnalysis.SortOrder={Ascending:"ascending",Descending:"descending",None:"none"},ej.PivotAnalysis.FilterType={Exclude:"exclude",Include:"include"},ej.PivotAnalysis.SummaryType={Sum:"sum",Average:"average",Count:"count",Min:"min",Max:"max"}}(jQuery,Syncfusion)})},1037:function(e,t,i){var l,a,r;
/*!
*  filename: ej.treemap.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.treemap.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(n){a=[i(4),i(21),i(15)],void 0===(r="function"==typeof(l=n)?l.apply(t,a):l)||(e.exports=r)}(function(){!function(e,t,i){var l;t.widget({ejTreeMap:"ej.datavisualization.TreeMap"},{validTags:["div"],defaults:{locale:null,enableGroupSeparator:!1,colorPath:null,legendItemRendering:null,itemRendering:null,leafItemSettings:{borderThickness:1,borderBrush:"white",showLabels:!1,labelPath:null,gap:0,itemTemplate:null,textOverflow:"none",labelPosition:"topleft",labelVisibilityMode:"visible"},header:null,isHierarchicalDatasource:!1,dataSource:null,groupColorMapping:[],enableDrillDown:!1,drillDownHeaderColor:null,drillDownValue:null,drillDownLevel:0,drillDownSelectionColor:"#000000",colorValuePath:null,weightValuePath:null,treeMapItems:[],showLegend:!1,borderBrush:"white",borderThickness:1,enableResize:!0,enableGradient:!1,isResponsive:!0,itemsLayoutMode:"squarified",levels:[],headerTemplateRendering:null,doubleClick:"",click:"",rightClick:"",drillStarted:null,drillDownItemSelected:null,treeMapGroupSelected:null,treeMapItemSelected:null,legendSettings:{template:"",iconHeight:15,iconWidth:15,title:"",height:0,width:0,mode:"default",leftLabel:"",rightLabel:"",dockPosition:"top",alignment:"near",columnCount:0},rangeColorMapping:[],uniColorMapping:{color:null},desaturationColorMapping:{from:0,to:0,color:"",rangeMinimum:0,rangeMaximum:0},paletteColorMapping:{colors:[]},highlightOnSelection:!1,selectionMode:"default",highlightGroupOnSelection:!1,groupSelectionMode:"default",draggingOnSelection:!1,draggingGroupOnSelection:!1,showTooltip:!1,tooltipTemplate:null,highlightBorderThickness:5,highlightGroupBorderThickness:4,highlightBorderBrush:"gray",highlightGroupBorderBrush:"gray"},dataTypes:{dataSource:"data",treeMapItems:"array",levels:"array",rangeColorMapping:"array",paletteColorMapping:"object",groupColorMapping:"array"},observables:["dataSource","colorValuePath","weightValuePath","showLegend","enableResize","highlightOnSelection","selectionMode","groupSelectionMode","highlightGroupOnSelection","enableDrillDown","drillDownHeaderColor","drillDownSelectionColor","showTooltip","highlightBorderThickness","highlightBorderBrush","itemsLayoutMode","leafItemSettings.borderThickness","leafItemSettings.borderBrush","leafItemSettings.showLabels","leafItemSettings.labelPath","leafItemSettings.textOverflow","legendSettings.iconWidth","legendSettings.iconHeight","legendSettings.dockPosition","legendSettings.height","legendSettings.width","uniColorMapping.color","desaturationColorMapping.from","desaturationColorMapping.to","desaturationColorMapping.color","desaturationColorMapping.rangeMinimum","desaturationColorMapping.rangeMaximum"],_tags:[{tag:"levels",attr:["groupPath","groupGap","headerHeight","showHeader","groupPadding","showLabels","headerHeight","headerTemplate","headerVisibilityMode","labelPosition","labelTemplate","labelVisibilityMode","groupBackground","groupBorderColor","groupBorderThickness"],singular:"level"},{tag:"rangeColorMapping",attr:["color","legendLabel","from","to"],singular:"rangeColor"},{tag:"groupColorMapping",attr:["groupID",{tag:"groupColorMapping.rangeColorMapping",attr:["color","legendLabel","from","to"],singular:"groupRangeColor"},"uniColorMapping.color","desaturationColorMapping.from","desaturationColorMapping.to","desaturationColorMapping.color","desaturationColorMapping.rangeMinimum","desaturationColorMapping.rangeMaximum"],singular:"groupColor"}],dataSource:t.util.valueFunction("dataSource"),colorValuePath:t.util.valueFunction("colorValuePath"),weightValuePath:t.util.valueFunction("weightValuePath"),showLegend:t.util.valueFunction("showLegend"),enableResize:t.util.valueFunction("enableResize"),highlightOnSelection:t.util.valueFunction("highlightOnSelection"),selectionMode:t.util.valueFunction("selectionMode"),highlightGroupOnSelection:t.util.valueFunction("highlightGroupOnSelection"),groupSelectionMode:t.util.valueFunction("groupSelectionMode"),enableDrillDown:t.util.valueFunction("enableDrillDown"),drillDownValue:t.util.valueFunction("drillDownValue"),drillDownLevel:t.util.valueFunction("drillDownLevel"),drillDownHeaderColor:t.util.valueFunction("drillDownHeaderColor"),drillDownSelectionColor:t.util.valueFunction("drillDownSelectionColor"),showTooltip:t.util.valueFunction("showTooltip"),highlightBorderThickness:t.util.valueFunction("highlightBorderThickness"),itemsLayoutMode:t.util.valueFunction("itemsLayoutMode"),highlightBorderBrush:t.util.valueFunction("highlightBorderBrush"),borderThickness:t.util.valueFunction("leafItemSettings.borderThickness"),borderBrush:t.util.valueFunction("leafItemSettings.borderBrush"),showLabels:t.util.valueFunction("leafItemSettings.showLabels"),labelPath:t.util.valueFunction("leafItemSettings.labelPath"),textOverflow:t.util.valueFunction("leafItemSettings.textOverflow"),iconWidth:t.util.valueFunction("legendSettings.iconWidth"),iconHeight:t.util.valueFunction("legendSettings.iconHeight"),dockPosition:t.util.valueFunction("legendSettings.dockPosition"),legendheight:t.util.valueFunction("legendSettings.height"),legendwidth:t.util.valueFunction("legendSettings.width"),itemTemplate:t.util.valueFunction("leafItemSettings.itemTemplate"),uniColor:t.util.valueFunction("uniColorMapping.color"),_color:t.util.valueFunction("desaturationColorMapping.color"),_from:t.util.valueFunction("desaturationColorMapping.from"),_to:t.util.valueFunction("desaturationColorMapping.to"),_rangeMinimum:t.util.valueFunction("desaturationColorMapping.rangeMinimum"),_rangeMaximum:t.util.valueFunction("desaturationColorMapping.rangeMaximum"),_initPrivateProperties:function(){this._svgDocument=null,this._templateDiv=null,this._legenddiv=null,this._drillHeaderDiv=null,this._drillHoverDiv=null,this._legendHeight=0,this._backgroundTile=null,this._tooltipSize={height:0,width:0},this._height=500,this._margintop=null,this._marginleft=null,this._startPoint={x:0,y:0},this._stopPoint={x:0,y:0},this.mouseClickable=!1,this.dragDiv=null,this._initDiv=null,this._width=500,this._svgns="http://www.w3.org/2000/svg",this._prevSelectedItems=[],this._prevSelectedHeaders=[],this._isLevelColors,null==this.selectedItems&&(this.selectedItems=[]),this._browser=null,this._toolTipElement=null,this._rootTreeMapItems=[],this.treemapgroups=[],this._drillHeader=null,this._drilldownItem=null,this._drilldownItems=[],this._treeMapHeaders=[],this._drilldownHeaders=[],this._treeMapLabels=[],this._labelTemplateElements=[],this._itemGroups=[],this._prevSelectedGroupDatas=[],this._interactiveArrow=null,this._legendRects=[]},_setModel:function(e){for(var t in e)switch(t){case"itemsLayoutMode":this.itemsLayoutMode(e[t]),this.refresh()}},_levels:function(){this.refresh()},_rangeColorMapping:function(){this._setColorMappings(this._rootTreeMapItems,this.model)},_groupColorMapping:function(){this._setColorMappings(this._rootTreeMapItems,this.model)},_groupColorMapping_rangeColorMapping:function(){this._setColorMappings(this._rootTreeMapItems,this.model)},_init:function(){this._initPrivateProperties();var t=e("<style>.e-drillGroupRect:hover{ background-color:"+this.drillDownSelectionColor()+";}</style>");e("html > head").append(t),this._levelInitialize(),this._isSVG()||(document.createStyleSheet().addRule(".vml","behavior:url(#default#VML);display:inline-block"),document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML")),this.refresh()},_destroy:function(){this._unWireEvents(),e(this.element).removeClass("e-treemap e-js").find().remove(".e-tooltipelement"),e(this.element).empty()},_levelInitialize:function(){var t=this;null!=this.model.levels?e.each(this.model.levels,function(i,a){a=t._checkArrayObject(a,i);var r=new l;e.extend(r,a),e.extend(a,r)}):this.levels.treeMapLevel=new l},_checkArrayObject:function(t,i){var a=["borderBrush","dataSource","groupColorMapping","enableDrillDown","drillDownHeaderColor","drillDownSelectionColor","colorValuePath","weightValuePath","treeMapItems","showLegend","borderBrush","borderThickness","enableResize","enableGradient","isResponsive","itemsLayoutMode","levels","groupBackground","groupBorderColor","groupBorderThickness","groupPadding","groupPath","groupGap","headerHeight","showHeader","showLabels","headerTemplate","labelTemplate","labelPosition","textOverflow","headerVisibilityMode","labelVisibilityMode","color","leafItemSettings","showLabels","labelPath","gap","itemTemplate","legendSettings","template","iconHeight","iconWidth","height","width","mode","leftLabel","rightLabel","dockPosition","alignment","highlightOnSelection","selectionMode","highlightGroupOnSelection","groupSelectionMode","draggingOnSelection","draggingGroupOnSelection","showTooltip","tooltipTemplate","highlightBorderThickness","highlightGroupBorderThickness","highlightBorderBrush","highlightGroupBorderBrush"],r=this;return e.each(t,function(e,t){if(a.indexOf(e)>-1)if(t instanceof Array)r._checkArrayObject(t,e);else if(null!=t&&"object"==typeof t){var n=new l;r._loadIndividualDefaultValues(t,n,"number"==typeof e?i:e)}}),t},_loadIndividualDefaultValues:function(t,i,l){var a=null,r=this;return e.each(i,function(e,t){l!=e||(a=t)}),a instanceof Array&&(a=a[0]),e.each(t,function(e,t){t instanceof Array?r._checkArrayObject(t,l):null!=t&&"object"==typeof t&&r._loadIndividualDefaultValues(t,t,"number"==typeof e?l:e)}),e.extend(a,t),e.extend(t,a),t},refresh:function(l){var a,r;if(null!=document.getElementById(this._id)||document.getElementById(this._id)!=i){this._unWireEvents(),l||(this._drilldownItems=[]),this.model.enableResize||this.model.isResponsive?0==this._drilldownItems.length&&this._initPrivateProperties():this._initPrivateProperties(),e(this.element).empty(),null!=this._svgDocument&&e(this._svgDocument).empty(),this._height=this.element.height(),this._width=this.element.width(),0==this._height&&(this._height=0!=this.element[0].parentElement.clientHeight?this.element[0].parentElement.clientHeight:e(document).height()),0==this._width&&(this._width=0!=this.element[0].parentElement.clientWidth?this.element[0].parentElement.clientWidth:e(document).width()),this.showLegend()&&(this.enableDrillDown()&&null!=this.model.colorPath&&(a=this._getGroupitem(this.model.levels[0].groupPath,this.model.dataSource,this.model.levels[0].headerHeight)).sort(function(e,t){return parseFloat(t.weight)-parseFloat(e.weight)}),this._sizeCalculation(a));var n=jQuery.uaMatch(navigator.userAgent).browser.toLowerCase();navigator.userAgent.match(/Trident\/7\./);if(this._browser=n,e(this.element).css({position:"relative"}),0!=this._height&&0!=this._width){if(this._templateDiv=e("<div class='e-_templateDiv'></div>"),this._templateDiv.css({"pointer-events":"none",overflow:"hidden",float:"left","z-index":"2",height:this._height,width:this._width,"margin-top":this._margintop,"margin-left":this._marginleft,position:"absolute",left:"0",top:"0"}),this.enableDrillDown()&&0==this._drilldownItems.length&&(this._drillHeaderDiv=e("<div class='e-_drillHeaderDiv'></div>"),this._drillHeaderDiv.css({overflow:"hidden",float:"left","z-index":"3",position:"absolute",left:"left"!=this.model.legendSettings.dockPosition?"0":this._legendSize.width,top:"0"}),this._drillHoverDiv=e("<div class='e-_drillHoverDiv'></div>"),this._drillHoverDiv.css({overflow:"hidden",float:"left","z-index":"3",height:this._height-30,width:this._width,position:"absolute",left:"left"!=this.model.legendSettings.dockPosition?"0":this._legendSize.width,top:"30px"})),this._backgroundTile=e('<div id="backgroundTile" style="overflow:hidden;z-index:0;"></div>'),this.showLegend()&&null!=this.model.legendSettings&&this._renderLegend(),null!=this.dataSource())if(this._drilldownItems.length>0){if(this.enableDrillDown()&&this.model.levels.length>=1&&(null!=this._drilldownItem||null==this._drilldownItem)){for(r=0;r<this._drillHeaderDiv[0].children[0].children.length;r++)"e-drilldownlabel"==this._drillHeaderDiv[0].children[0].children[r].className&&this._drillHeaderDiv[0].children[0].children[r].innerHTML;this._backgroundTile[0].innerHTML="",this._drillHeaderDiv[0].innerHTML="",this._templateDiv[0].innerHTML="",this._drillHoverDiv[0].innerHTML="",this._drillDownHeader(!0,this.model.levels[0],this.dataSource()),this._groupdrillDownLevels(this._drilldownItems[this._drilldownItems.length-1],this._drilldownItems.length)}this.showLegend()&&this._generateLegend(),this._generateToolTip()}else this.model.dataSource instanceof t.DataManager?this._processOData(this):this._renderTreeMap(this.dataSource());(this.enableResize()||this.model.isResponsive)&&this._on(e(window),"resize",this._treeMapResize)}this._selectItemResize(),this._wireEvents(),this._trigger("refreshed","")}},_renderDrilledState:function(e,t,i){var l,a,r,n,o,s,d;if(0==i||null==this.model.drillDownLevel||this._initialLevel)this._groupLevels(e),this._renderWithDrilledLevel=!1;else if(l=this._getPreRenderEventData(e,i-1),this._drillCurrentItem=l,this.enableDrillDown())for(a=0;a<l.length;a++)if(this._originalHeaders=[],this.renderHeader=!0,l[a].header==t){if(this.model.levels.length>0){if(this.model.levels[i].groupingLevel=0,this._drilldownHeaders.push(this.model.header||this.model.levels[0].groupPath),this._originalHeaders.push(this.model.header||this.model.levels[0].groupPath),i>1)for(r=this._getPreRenderEventData(this.dataSource(),i-2),this._drillPreviousItem=r,n=l[a].Data[0],o=2;o<=i;o++)s=this.model.levels[o-2].groupPath,d=this._reflection(n,s),l[a]._previousHeader=d,this._drilldownHeaders.push(l[a]._previousHeader),this._originalHeaders.push(l[a]._previousHeader);this._drilldownHeaders.push(t),this._originalHeaders.push(t),this._drillDownHeader(!0,this.model.levels[i-1],l[a])}else this._drilldownHeaders.push(""),this._drillDownHeader(!1);this._groupdrillDownLevels(l[a],i),this._renderWithDrilledLevel=!0,this._initialLevel=!0}},_renderTreeMap:function(e){this.model.browserInfo=this.browserInfo(),this.showLegend()&&"interactive"==this.model.legendSettings.mode&&this._generateLegend(),this._renderDrilledState(e,this.model.drillDownValue,this.model.drillDownLevel),this.renderHeader=!1,this._generateToolTip(),this._renderLabels(),this.showLegend()&&"interactive"!=this.model.legendSettings.mode&&this._generateLegend()},_renderLegend:function(){this._legenddiv=e("<div class='e-LegendDiv'/>"),this._legenddiv.appendTo(this.element),this._legenddiv.css({"pointer-events":"none",overflow:"hidden",position:"absolute","z-index":"2",height:this._legendSize.height,width:this._legendSize.width})},_processOData:function(e){var t=this;e.model.dataSource.executeQuery(e.model.query).done(function(e){null!=e.result&&t._renderTreeMap(e.result)})},_treeMapResize:function(e){e.preventDefault(),e.stopPropagation();var t=this;this.resizeTO&&clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){t.refresh(!0)},500)},_unWireEvents:function(){jQuery.uaMatch(navigator.userAgent).browser.toLowerCase();this._off(e(this.element),"contextmenu",this._tmRightClick),this._off(e(this.element),"click",this._tmClick)},_wireEvents:function(){this._on(e(this.element),"contextmenu",this._tmRightClick),this._on(e(this.element),"click",this._tmClick)},_tmClick:function(e){var t=new Date;""!=this.model.click&&this._trigger("click",{data:{event:e}}),null!=this._doubleTaptimer&&t-this._doubleTaptimer<300&&this._tmDoubleClick(e),this._doubleTaptimer=t},_tmDoubleClick:function(e){""!=this.model.doubleClick&&this._trigger("doubleClick",{data:{event:e}})},_tmRightClick:function(e){""!=this.model.rightClick&&this._trigger("rightClick",{data:{event:e}})},_groupLevels:function(t){var i,l,a,r,n,o,s=null,d=this.model.isHierarchicalDatasource;if(this.enableDrillDown()&&(this._originalHeaders=[],this.renderHeader=!0,this.model.levels.length>0?(this.model.levels[0].groupingLevel=0,this._drilldownHeaders.push(this.model.header||this.model.levels[0].groupPath),this._originalHeaders.push(this.model.levels[0].groupPath),this._drillDownHeader(!1,this.model.levels[0],t)):(this._drilldownHeaders.push(""),this._drillDownHeader(!1))),s=i=this._getTopGroupitem(this.labelPath(),t,0),0==this.model.levels.length&&(a=this.model.leafItemSettings,this._rootTreeMapItems=i,this._getTopLevels(i[0].innerItems,a),this._generateTreeMapItems(i[0].innerItems,"gray",this.colorValuePath()),this.showLabels()&&this._generateLabels(i[0].innerItems,a)),this.model.levels.length>0)for(l=0;l<=this.model.levels.length;l++)if(null!=(a=this.model.levels[l])&&(e.isNumeric(a.groupGap)||(a.groupGap=0),e.isNumeric(a.groupPadding)||(a.groupPadding=0),e.isNumeric(a.groupBorderThickness)||(a.groupBorderThickness=0)),0!=l){if(r=s,n=this.model.levels[l-1],s=[],null==a&&(a=this.model.leafItemSettings),this._generateSubItems(r,a,s,n,null,null,l-1),this._rootTreeMapItems=s,this.enableDrillDown()){if(1==l)return this._generateTreeMapItems(s,"gray",n.DisplayPath,r),this.showLabels()&&this._generateLabels(s,a),!1}else l==this.model.levels.length&&this._generateTreeMapItems(s,"gray",n.DisplayPath,r);this.showLabels()&&l==this.model.levels.length&&this._generateLabels(s,a)}else o=this._getGroupitem(d?this.labelPath():a.groupPath,i[0].Data,a.headerHeight),this._rootTreeMapItems=o,this._getTopLevels(o,a),s=o},_groupdrillDownLevels:function(t,i){var l,a,r,n,o,s,d=null,u=this.model.isHierarchicalDatasource;if(i==this.model.levels.length-1?this._drillHoverDiv.css("pointer-events","none"):this._drillHoverDiv.css("pointer-events","auto"),this.model.levels.length>0)for(l=!1,a=u?i-1:0;a<this.model.levels.length;a++)null!=(r=this.model.levels[a])&&(e.isNumeric(r.groupGap)||(r.groupGap=0),e.isNumeric(r.groupPadding)||(r.groupPadding=0),e.isNumeric(r.groupBorderThickness)||(r.groupBorderThickness=0)),a!=(u?i-1:0)?(n=d,o=this.model.levels[a-1],d=[],null==r&&(r=this.model.leafItemSettings),a==i+1?(this._generateSubItems(n,r,d,o,null,i+1!=a,t.GroupingLevel),this.showLabels()&&this._generateLabels(d,r)):(this._generateSubItems(n,r,d,o,!0,i+1!=a,t.GroupingLevel),!r.showLabels&&this.showLabels()&&a==this.model.levels.length-1&&this._generateLabels(d,r)),this._rootTreeMapItems=d,a!=i+1&&a!=this.model.levels.length-1||l||(this.showLegend()&&this.model.colorPath&&(this._height=this.element.height(),this._width=this.element.width(),this._sizeCalculation(a==i+1?n:d),this._legenddiv.empty(),this._legenddiv.css({width:this._legendSize.width+"px",height:this._legendSize.height+"px"}),"top"==this.model.legendSettings.dockPosition.toLowerCase()?(this._templateDiv.css({"margin-top":this._margintop}),this._drillHeaderDiv.css({top:this._legendSize.height}),this._drillHoverDiv.css({top:30+this._legendSize.height})):"left"==this.model.legendSettings.dockPosition.toLowerCase()&&(this._drillHeaderDiv.css({left:this._legendSize.width}),this._drillHoverDiv.css({left:this._legendSize.width}),this._templateDiv.css({"margin-left":this._marginleft}))),this._generateTreeMapItems(d,"gray",o.DisplayPath,a==i+1?n:d),l=!0),i==this.model.levels.length-1&&a==i&&r.showLabels&&this._generateLabels(d,r),this.renderHeader=a==t.GroupingLevel):(s=this._getGroupitem(this.model.isHierarchicalDatasource?null:r.groupPath,t.Data,r.headerHeight),this._rootTreeMapItems=s,this._getTopLevels(s,r),d=s);this.showLegend()&&this._generateLegend(),this._renderLabels(),this.renderHeader=!1,this._trigger("drillDownItemSelected",{level:i,header:this.getDrillDownHeader(this._drilldownHeaders),prevLevel:i-1})},drillDown:function(t,i){e("#"+this._id).find(".e-_templateDiv").parent().children().empty(),this._drilldownHeaders=[];var l=this.model.dataSource;this._initialLevel=0==this.model.drillDownLevel&&this._initialLevel,this._renderDrilledState(l,t,i)},_getTopLevels:function(e,i){var l=null!=i.groupGap?i.groupGap:null!=i.gap?i.gap:0,a=this.itemsLayoutMode(),r=0,n=0;this.enableDrillDown()&&(n=30),this.showLegend()&&null!=this.model.legendSettings&&(r=r),this._legendHeight=r,this.enableDrillDown()&&(this._drillHeaderDiv.css({top:this.showLegend()&&"top"==this.model.legendSettings.dockPosition.toLowerCase()?this._legendSize.height:r}),this._drillHoverDiv.css({top:30+(this.showLegend()&&"top"==this.model.legendSettings.dockPosition.toLowerCase()?this._legendSize.height:r)})),a==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceHorizontal?this._calculateSliceAndDiceItemSize(e,0,r,this._width,this._height,l,n,!0,r):a==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceVertical?this._calculateSliceAndDiceItemSize(e,0,r,this._width,this._height,l,n,!1,r):a==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceAuto?this._calculateSliceAndDiceItemSize(e,0,r,this._width,this._height,l,n,null,r):this._calculateSquarifiedItemSize(e,0,r,this._width,this._height,l,n,r)},_generateSubItems:function(e,l,a,r,n,o,s,d){var u,c,p,h,g,m,f=r.groupPadding;""==f&&(f=0);var _=this.itemsLayoutMode(),v=e.length,b=this.model.isHierarchicalDatasource?null:l.groupPath;null==b&&(b=this.labelPath()),null==b&&(b=this.weightValuePath());var C=null!=l.groupGap?l.groupGap:null!=l.gap?l.gap:0,S=!r.showHeader&&null!=r.showHeader||this.enableDrillDown()?this.renderHeader&&r.showHeader?r.headerHeight:0:r.headerHeight,P=0;for(u=0;u<v;u++){if(c=this._getGroupitem(b,e[u].Data,l.headerHeight,this.model.isHierarchicalDatasource?r.groupPath:null),d||(_==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceHorizontal?this._calculateSliceAndDiceItemSize(c,e[u].LeftPosition+parseFloat(f),e[u].TopPosition+parseFloat(f),e[u].ItemWidth-(r.groupBorderThickness+2*parseFloat(f)),e[u].ItemHeight-(r.groupBorderThickness+2*parseFloat(f)),parseFloat(C),S,!0,0):_==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceVertical?this._calculateSliceAndDiceItemSize(c,e[u].LeftPosition+parseFloat(f),e[u].TopPosition+parseFloat(f),e[u].ItemWidth-(r.groupBorderThickness+2*parseFloat(f)),e[u].ItemHeight-(r.groupBorderThickness+2*parseFloat(f)),parseFloat(C),S,!1,0):_==t.datavisualization.TreeMap.ItemsLayoutMode.SliceAndDiceAuto?this._calculateSliceAndDiceItemSize(c,e[u].LeftPosition+parseFloat(f),e[u].TopPosition+parseFloat(f),e[u].ItemWidth-(r.groupBorderThickness+2*parseFloat(f)),e[u].ItemHeight-(r.groupBorderThickness+2*parseFloat(f)),parseFloat(C),S,null,0):this._calculateSquarifiedItemSize(c,e[u].LeftPosition+parseFloat(f),e[u].TopPosition+parseFloat(f),e[u].ItemWidth-(r.groupBorderThickness+2*parseFloat(f)),e[u].ItemHeight-(r.groupBorderThickness+2*parseFloat(f)),parseFloat(C),S,0),(p=this._rootTreeMapItems[u]).headerHeight=r.headerHeight,p.showHeader=r.showHeader,p.headerWidth=e[u].ItemWidth,p.headerTemplate=r.headerTemplate,p.headerLeftPosition=e[u].LeftPosition,p.headerTopPosition=e[u].TopPosition,this.enableDrillDown()&&this._createBackGround(p,r,e[u],o),(r.showHeader||null==r.showHeader)&&(this.enableDrillDown()?(this.renderHeader||(this.previousItem=p),(0==s||s==i||null==s)&&(this.previousItem=null),this.renderHeader&&(this._trigger("headerTemplateRendering",{levelItems:this._rootTreeMapItems,childItems:p.Data,headerItem:p,groupPath:r.groupPath,groupingLevel:t.util.isNullOrUndefined(s)?0:s,prevItem:this.previousItem}),this._generateHeaders(p,r))):(this._createBackGround(p,r,e[u]),this._trigger("headerTemplateRendering",{levelItems:this._rootTreeMapItems,childItems:p.Data,headerItem:p,groupPath:r.groupPath,groupingLevel:s,prevItem:r}),this._generateHeaders(p,r)))),e[u].ChildtreeMapItems=c,e[u].GroupingLevel=this.model.levels.indexOf(r)+1,0!=this.model.levels.indexOf(r)||d){if(this.model.levels.indexOf(r)>0&&!d&&null!=this.model.groupColorMapping&&this.model.groupColorMapping.length>0)for(h=0;h<this.model.groupColorMapping.length;h++)(g=this.model.groupColorMapping[h]).groupID==e[u].ParentHeader&&this._setColorMappings(c,g,!0)}else if(null!=this.model.groupColorMapping&&this.model.groupColorMapping.length>0)for(this._isLevelColors=!0,h=0;h<this.model.groupColorMapping.length;h++)(g=this.model.groupColorMapping[h]).groupID==p.header&&this._setColorMappings(c,g,!0);for(m=0;m<c.length;m++)a[P]=c[m],null==c[m].backgroundColor&&(c[m].backgroundColor=e[u].backgroundColor),null==c[m].backgroundOpacity&&(c[m].backgroundOpacity=e[u].backgroundOpacity),(this.enableDrillDown()||a[P].ItemHeight<p.ItemHeight-p.headerHeight)&&!d&&(a[P].ParentHeader=p.header,a[P].ItemHeight-=f,a[P].ItemWidth-=f,a[P].LeftPosition+=r.groupBorderThickness,a[P].TopPosition+=r.groupBorderThickness),P++}n==i&&r.showLabels&&!d&&this._generateLabels(e,r)},_createBackGround:function(t,i,l,a){var r,n,o=e("<div />"),s=t.showHeader||null==t.showHeader||this.enableDrillDown()?t.ItemHeight-2*i.groupBorderThickness:0,d=t.showHeader||null==t.showHeader||this.enableDrillDown()?t.TopPosition:0;o.css({height:s+"px",width:t.ItemWidth-2*i.groupBorderThickness+"px",left:t.LeftPosition+"px",top:d+"px","border-style":"solid","border-width":i.groupBorderThickness+"px",position:"absolute"}),null!=i.groupBorderColor&&o.css("border-color",i.groupBorderColor),null!=i.groupBackground&&o.css("background-color",i.groupBackground),this.treemapgroups.push({header:t.header,element:o}),o.appendTo(this._backgroundTile),s=parseFloat(o[0].style.top)-30-this._legendHeight+"px",this.enableDrillDown()&&!a&&((r=e("<div class='e-drillGroupRect'/>")).css({height:o[0].style.height,width:o[0].style.width,left:o[0].style.left,top:s,position:"absolute",opacity:.2,display:"block"}),this._drillHoverDiv.append(r),e(r).mousedown({treemap:this,level:i,param1:l},this._headerClickFunction),e(r).mouseleave({treemap:this,param1:t.header},this._mouseLeaveFunction),n={data:t.Data,label:t.header,header:t.header},e(r).mousemove({treemap:this,hoverItem:n},this._mouseRectHoverFunction)),e(o).mousedown({treemap:this,level:i,param1:l},this._headerClickFunction),e(o).mousemove({treemap:this,hoverItem:t.Data},this._mouseRectHoverFunction)},_mouseRectHoverFunction:function(t){var i,l,a,r,n,o,s=t.data.treemap,d=t.data.hoverItem;s.showTooltip()&&(i=s._toolTipElement,l=s.model.tooltipTemplate,null!=i&&null!=l&&(e(i).css({left:t.pageX+10,top:t.pageY+10,display:"block"}),a=e("#"+l).render(d),e(i).html(a),r=null!=i[0]?i[0].clientHeight:i.clientHeight,n=null!=i[0]?i[0].clientWidth:i.clientWidth,s._tooltipSize={height:r,width:n}),(o=s._tooltipSize).width+t.pageX>=s._width&&(t.pageX-o.width<0&&10),o.height+t.pageY>=s._height&&(t.pageY-o.height<0&&10),null!=i&&(s.enableDrillDown()?e(i).css({left:t.pageX+10,top:t.pageY+10,display:"block"}):e(i).css({left:t.pageX+10,top:t.pageY+10,display:"none"})))},_mouseLeaveFunction:function(t){var i=t.data.treemap;i.showTooltip()&&null!=i._toolTipElement&&e(i._toolTipElement).css("display","none")},_headerClickFunction:function(t){var i,l,a,r,n,o,s,d=t.data.level,u=t.data.param1,c=t.ctrlKey,p=t.data.treemap;if(p.highlightGroupOnSelection())if("msie"!=p._browser&&(i=p._backgroundTile[0].children[p._backgroundTile[0].children.length-0],p._backgroundTile[0].insertBefore(this,i)),"multiple"==p.groupSelectionMode()&&c)-1==e.inArray(this,p._prevSelectedHeaders)?(e(this).css({"border-width":p.model.highlightGroupBorderThickness,"border-color":p.highlightBorderBrush()}),p._prevSelectedHeaders.push(this),p._prevSelectedGroupDatas.push(t.data.Param1)):(e(this).css({"border-width":d.groupBorderThickness,"border-color":d.groupBorderColor}),l=p._prevSelectedHeaders.indexOf(this),p._prevSelectedHeaders.splice(l,1),p._prevSelectedGroupDatas.splice(l,1));else{for(a=0;a<p._prevSelectedHeaders.length;a++)e(p._prevSelectedHeaders[a]).css({"border-width":d.groupBorderThickness,"border-color":d.groupBorderColor});-1==e.inArray(this,p._prevSelectedHeaders)?(e(this).css({"border-width":p.model.highlightGroupBorderThickness,"border-color":p.highlightBorderBrush()}),p._prevSelectedHeaders=[],p._prevSelectedHeaders.push(this)):p._prevSelectedHeaders=[],p._prevSelectedGroupDatas.push(t.data.Param1)}if(p.enableDrillDown()&&p._trigger("drillStarted",t),p.enableDrillDown()&&p.model.levels.length>1&&(null!=p._drilldownItem&&p._drilldownItem.header!=u.header||null==p._drilldownItem)){for("",r=0;r<p._drillHeaderDiv[0].children[0].children.length;r++)"e-drilldownlabel"==p._drillHeaderDiv[0].children[0].children[r].className&&p._drillHeaderDiv[0].children[0].children[r].innerHTML;if(p._backgroundTile[0].innerHTML="",p._labelTemplateElements=[],p._drillHeaderDiv[0].innerHTML="",p._templateDiv[0].innerHTML="",p._drillHoverDiv[0].innerHTML="",p._originalHeaders.push(u.header),p._drilldownHeaders.push(u.header),(n=p.model.levels[p._drilldownHeaders.length-1]).groupingLevel=u.GroupingLevel,p._drillDownHeader(!0,n,u.Data),p._drilldownItem=u,p._renderWithDrilledLevel)for(o=p._drillCurrentItem,s=0;s<o.length;s++)o[s].header==p.model.drillDownValue&&0==p._drilldownItems.length&&p._drilldownItems.push(o[s]);return p._drilldownItems.push(u),p._groupdrillDownLevels(u,p._drilldownItems.length),!1}},_rectMouseDown:function(e){var t=e.data.treeMap;t.isTouch(e)&&""!=t.model.doubleClick&&""!=t.model.rightClick&&e.preventDefault()},_docClickFunction:function(i){i.data.treemap;var l=this._toolTipElement,a=this;clearTimeout(a.model.timer),l&&(a.model.trackerElement=l,a.model.timer=setTimeout(function(){a.model.trackerElement&&e(a.model.trackerElement).fadeOut(500,function(){a.model.trackerElement=null})},1200)),t.isTouchDevice()&&""!=this.model.rightClick&&new Date-this._longPressTimer>1500&&this._tmRightClick(i)},mousePosition:function(e){return!t.util.isNullOrUndefined(e.pageX)&&e.pageX>0?e:e.originalEvent&&!t.util.isNullOrUndefined(e.originalEvent.pageX)&&e.originalEvent.pageX>0?e.originalEvent:e.originalEvent&&e.originalEvent.changedTouches!=i&&!t.util.isNullOrUndefined(e.originalEvent.changedTouches[0].pageX)&&e.originalEvent.changedTouches[0].pageX>0?e.originalEvent.changedTouches[0]:e},_highlightTreemap:function(t){var i,l,a,r,n,o,s,d=t.data.treemap,u=(t.data.Param1,d.model.levels[0]),c=t.ctrlKey,p=d.mousePosition(t);if(d.highlightGroupOnSelection()){for(a=0;a<d.treemapgroups.length;a++)if(l=d.treemapgroups[a],(n=(r=d.treemapgroups[a].element)[0].getBoundingClientRect()).left<p.clientX&&n.left+n.width>p.clientX&&n.top<p.clientY&&n.top+n.height>p.clientY){e(r).css({"border-width":d.model.highlightGroupBorderThickness,"border-color":d.highlightBorderBrush(),"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"}),i=!0;break}if(i)if("multiple"==d.groupSelectionMode()&&c)-1==e.inArray(r,d._prevSelectedHeaders)?(e(r).css({"border-width":d.model.highlightGroupBorderThickness,"border-color":d.highlightBorderBrush()}),d._prevSelectedHeaders.push(l),d._prevSelectedGroupDatas.push(t.data.Param1)):(e(r).css({"border-width":u.groupBorderThickness,"border-color":u.groupBorderColor}),o=d._prevSelectedHeaders.indexOf(l),d._prevSelectedHeaders.splice(o,1),d._prevSelectedGroupDatas.splice(o,1));else{for(s=0;s<d._prevSelectedHeaders.length;s++)e(d._prevSelectedHeaders[s].element).css({"border-width":u.groupBorderThickness,"border-color":u.groupBorderColor});-1==e.inArray(r,d._prevSelectedHeaders)?(e(r).css({"border-width":d.model.highlightGroupBorderThickness,"border-color":d.highlightBorderBrush()}),d._prevSelectedHeaders=[],d._prevSelectedHeaders.push(l)):d._prevSelectedHeaders=[],d._prevSelectedGroupDatas.push(t.data.Param1)}d._trigger("treeMapGroupSelected",{selectedGroups:d._prevSelectedHeaders,orginalEvent:t})}if(d.highlightOnSelection()){for(a=0;a<d._rootTreeMapItems.length;a++)if((n=(r=d._rootTreeMapItems[a]).Rectangle.getBoundingClientRect()).left<p.clientX&&n.left+n.width>p.clientX&&n.top<p.clientY&&n.top+n.height>p.clientY){e(r.Rectangle).css({"border-width":d.highlightBorderThickness(),"border-color":d.highlightBorderBrush(),"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"}),i=!0;break}if(i){if("multiple"==d.selectionMode()&&c)-1==e.inArray(r.Rectangle,d._prevSelectedItems)?(e(r.Rectangle).css({"border-width":d.highlightBorderThickness(),"border-color":d.highlightBorderBrush(),"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"}),d._prevSelectedItems.push(r.Rectangle),d.selectedItems.push(r.Data)):(e(r.Rectangle).css({"border-width":d.borderThickness(),"border-color":d.borderBrush()}),o=d._prevSelectedItems.indexOf(r.Rectangle),d._prevSelectedItems.splice(o,1),d.selectedItems.splice(o,1));else{for(s=0;s<d._prevSelectedItems.length;s++)e(d._prevSelectedItems[s]).css({"border-width":d.borderThickness(),"border-color":d.borderBrush()});-1==e.inArray(r.Rectangle,d._prevSelectedItems)?(e(r.Rectangle).css({"border-width":d.highlightBorderThickness(),"border-color":d.highlightBorderBrush()}),d._prevSelectedItems=[],d.selectedItems=[],d._prevSelectedItems.push(r.Rectangle),d.selectedItems.push(r.Data)):(d._prevSelectedItems=[],d.selectedItems=[])}d._trigger("treeMapItemSelected",{selectedItems:d.selectedItems,originalEvent:t})}}},doubleTap:function(e){var t=e.targetTouches?e.targetTouches[0]:e,i=t.pageX,l=t.pageY,a=(this.model,e.data.treemap);a.model.cachedX=a.model.cachedX||i,a.model.cachedY=a.model.cachedY||l,(new Date).getTime(),Math.abs(i-a.model.cachedX)<200&&Math.abs(l-a.model.cachedY)<200&&a.model.tapNum++},rectClick:function(e){var i=e.data.treemap;i.doubleTap(e),i.isTouch(e)||i._highlightTreemap(e),t.isTouchDevice()&&""!=this.model.rightClick&&(this._longPressTimer=new Date)},dragDown:function(t){var i,l,a=t.data.treemap,r=a.model.levels[0],n=a._svgDocument;if("mousedown"==t.type?(a._startPoint={x:t.pageX-n[0].offsetLeft,y:t.pageY-n[0].offsetTop},a._stopPoint={x:t.pageX-n[0].offsetLeft,y:t.pageY-n[0].offsetTop}):"touchstart"==t.type?(a._startPoint={x:t.originalEvent.changedTouches[0].pageX-n[0].offsetLeft,y:t.originalEvent.changedTouches[0].pageY-n[0].offsetTop},a._stopPoint={x:t.originalEvent.changedTouches[0].pageX-n[0].offsetLeft,y:t.originalEvent.changedTouches[0].pageY-n[0].offsetTop}):"MSPointerDown"==t.type&&(a._startPoint={x:t.originalEvent.pageX-n[0].offsetLeft,y:t.originalEvent.pageY-n[0].offsetTop},a._stopPoint={x:t.originalEvent.pageX-n[0].offsetLeft,y:t.originalEvent.pageY-n[0].offsetTop}),a.mouseClickable=!0,a.model.draggingGroupOnSelection&&a._prevSelectedGroupDatas.length>0){for(i=0;i<a._prevSelectedGroupDatas.length;i++)(l=a._prevSelectedGroupDatas[i][0]).getBoundingClientRect(),-1==e.inArray(l,a._prevSelectedGroupDatas[i][0])&&e(a._prevSelectedGroupDatas[i]).css({"border-width":r.groupBorderThickness,"border-color":a.model.highlightGroupBorderBrush});a._prevSelectedGroupDatas=[]}if(a.model.draggingOnSelection&&a._prevSelectedItems.length>0){for(i=0;i<a._prevSelectedItems.length;i++)(l=a._prevSelectedItems[i].rectangle).getBoundingClientRect(),-1==e.inArray(l,a._prevSelectedItems[i].rectangle)&&e(a._prevSelectedItems[i].rectangle).css({"border-width":r.groupBorderThickness,"border-color":a.model.highlightGroupBorderBrush});a._prevSelectedItems=[]}},dragMove:function(t){var i,l,a,r=t.data.treemap,n=r._svgDocument;(r.model.draggingGroupOnSelection||r.model.draggingOnSelection)&&r.mouseClickable&&("mousemove"==t.type?r._stopPoint={x:t.pageX-n[0].offsetLeft,y:t.pageY-n[0].offsetTop}:"touchmove"==t.type?r._stopPoint={x:t.originalEvent.changedTouches[0].pageX-n[0].offsetLeft,y:t.originalEvent.changedTouches[0].pageY-n[0].offsetTop}:"MSPointerMove"==t.type&&(r._stopPoint={x:t.originalEvent.pageX-n[0].offsetLeft,y:t.originalEvent.pageY-n[0].offsetTop}),e("#dragDiv").remove(),a=e('<div id = "dragDiv"></div>'),i=Math.abs(r._stopPoint.x-r._startPoint.x),l=Math.abs(r._stopPoint.y-r._startPoint.y),e(a).css({top:Math.min(r._startPoint.y,r._stopPoint.y),left:Math.min(r._startPoint.x,r._stopPoint.x),width:i,height:l,border:"1px solid green",position:"absolute","z-index":100}),e(a).appendTo("#svgDocument"))},dragUp:function(t){var i,l,a,r=t.data.treemap,n=Math.abs(r._stopPoint.x-r._startPoint.x),o=Math.abs(r._stopPoint.y-r._startPoint.y),s=r._svgDocument;if((r.model.draggingGroupOnSelection||r.model.draggingOnSelection)&&(e("#dragDiv").remove(),e("#dragDiv").css({display:"none"}),r.mouseClickable=!1),r.model.draggingGroupOnSelection){for(i=0;i<r.treemapgroups.length;i++)(a=(l=r.treemapgroups[i].element)[0].getBoundingClientRect()).left-s[0].offsetLeft+a.width<Math.min(r._startPoint.x,r._stopPoint.x)||Math.min(r._startPoint.x,r._stopPoint.x)+n<a.left-s[0].offsetLeft||a.top-s[0].offsetTop+a.height<Math.min(r._startPoint.y,r._stopPoint.y)||Math.min(r._startPoint.y,r._stopPoint.y)+o<a.top-s[0].offsetTop||r._contains(r._prevSelectedGroupDatas,l)||r._prevSelectedGroupDatas.push(l);for(i=0;i<r._prevSelectedGroupDatas.length;i++)a=(l=r._prevSelectedGroupDatas[i][0]).getBoundingClientRect(),e(l).css({"border-width":r.model.highlightGroupBorderThickness,"border-color":r.model.highlightGroupBorderBrush,"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"});r.selectedItems.push(r._prevSelectedGroupDatas)}if(r.model.draggingOnSelection){for(i=0;i<r._rootTreeMapItems.length;i++)(a=(l=r._rootTreeMapItems[i]).rectangle.getBoundingClientRect()).left-s[0].offsetLeft+a.width<Math.min(r._startPoint.x,r._stopPoint.x)||Math.min(r._startPoint.x,r._stopPoint.x)+n<a.left-s[0].offsetLeft||a.top-s[0].offsetTop+a.height<Math.min(r._startPoint.y,r._stopPoint.y)||Math.min(r._startPoint.y,r._stopPoint.y)+o<a.top-s[0].offsetTop||r._contains(r._prevSelectedItems,l)||r._prevSelectedItems.push(l);for(i=0;i<r._prevSelectedItems.length;i++)a=(l=r._prevSelectedItems[i].rectangle).getBoundingClientRect(),e(l).css({"border-width":r.model.highlightGroupBorderThickness,"border-color":r.model.highlightGroupBorderBrush,"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"});r.selectedItems.push(r._prevSelectedItems)}},_measureText:function(t,l,a){var r,n,o,s,d,u=e(document).find("#measureTex");e("#measureTex").css("display","block"),0==u.length?(r=document.createElement("text"),e(r).attr({id:"measureTex"}),document.body.appendChild(r)):r=u[0];var c=null,p=null,h=null;if("string"==typeof t&&(t.indexOf("<")>-1||t.indexOf(">")>-1)){for(n=t.split(" "),o=0;o<n.length;o++)-1==n[o].indexOf("<br/>")&&(n[o]=n[o].replace(/[<>]/g,"&"));t=n.join(" ")}return r.innerHTML=t,a!=i&&a.size==i&&(c=(s=(s=a).split(" "))[0],p=s[1],h=s[2],s[3]),null!=a&&(r.style.fontSize=a.size>0?a.size+"px":a.size?a.size:p,r.style.fontStyle&&(r.style.fontStyle=a.fontStyle?a.fontStyle:c),r.style.fontFamily=a.fontFamily?a.fontFamily:h),r.style.backgroundColor="white",r.style.position="absolute",r.style.top=-100,r.style.left=0,r.style.visibility="hidden",r.style.whiteSpace="nowrap",l&&(r.style.maxwidth=l+"px"),d={width:r.offsetWidth,height:r.offsetHeight},e("#measureTex").css("display","none"),d},_rowsCalculation:function(e,t,i,l,a,r){this.model;var n,o,s,d,u=[],c=e?e.toString():"",p=c.length,h=this._measureText(c,t,a).width,g=this._measureText(c,t,a).height,m=c.split(" "),f=0,_=0,v=Math.round(t),b=m.length;i="centerleft"==(r=r.toLowerCase())||"center"==r||"centerright"==r?i/2:i;if("wrap"==l||"hide"==l){if(h>v)for(d=1;d<=c.length;d++)if(e=c.substring(0,d),(h=this._measureText(e,t,a).width)>v){if(_+=1,""==(e=c.substring(0,d-1)))break;_*g<i&&(u[f]=e),c=c.slice(d-1,p),f++,d=0}return(_+=1)*g<i&&(u[f]=e),("hide"==l||"wrap"==l&&("bottomleft"==r||"bottomright"==r||"bottomcenter"==r))&&(u=u.slice(0,1)),u}if("wrapbyword"==l){for(f=0;f<b;f++)if(n=m[f],_+=1,(o=this._measureText(n,t,a).width)<v){for(;f<b&&(o=this._measureText(n,t,a).width,s=m[f+1]?this._measureText(m[f+1],t,a).width:0,o+(s=Math.round(s))<v&&s>0);)n=n.concat(" "+m[f+1]),f++;_*g<i&&u.push(n)}return("bottomleft"==r||"bottomright"==r||"bottomcenter"==r)&&(u=u.slice(0,1)),u}},getStyleRuleValue:function(e,t){for(var i,l,a,r,n=void 0!==i?[i]:document.styleSheets,o=0,s=n.length;o<s;o++){i=n[o];try{if(!i.cssRules)continue;for(l=0,a=i.cssRules.length;l<a;l++)if((r=i.cssRules[l]).selectorText&&-1!==r.selectorText.split(",").indexOf(t))return r.style[e]}catch(e){if("securityerror"!==e.name.toLowerCase())throw e}}return null},_generateLabels:function(l,a){for(var r,n,o,s,d,u,c,p,h,g,m,f,_,v=this.model.leafItemSettings.textOverflow.toLowerCase(),b=0;b<l.length;b++){if(r=l[b],null!=a.labelTemplate&&"none"!=v)var C=document.getElementById(a.labelTemplate).innerHTML,S=e(C).find("label").eq(0).text().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,""),P=r.Data[S];if(null!=a.labelTemplate&&"none"==v)n=e("#"+a.labelTemplate),(o=e("<div style='overflow:hidden;display:block;position:absolute;pointer-events: none;'></div>"))[0].data=r,r.labelPosition=a.labelPosition,r.labelVisibilityMode=a.labelVisibilityMode,s=e.templates(n.html()),d="",d=r.Data instanceof Array?s.render(r.Data[0]):s.render(r.Data),e(o).html(d),this._templateDiv.append(o),this._labelTemplateElements.push(o);else{var w=this.getStyleRuleValue("font-size",".e-treemap-label");if(w=t.util.isNullOrUndefined(w)?"14px":w,u=null!=a.labelTemplate?P:r.label,v=this.model.leafItemSettings.textOverflow.toLowerCase(),null==a.labelTemplate)var O=Math.round(r.ItemWidth-16),y=Math.round(r.ItemHeight-10-(r.showHeader?r.headerHeight:0)),x={fontWeight:"Normal",size:w,color:"black"};else x={fontWeight:"Normal",size:"16px",color:"black"},O=Math.round(r.ItemWidth),y=Math.round(r.ItemHeight);for("none"!=v?c=this._rowsCalculation(u,O,y,v,x,a.labelPosition):(c=[]).push(u),p=[],h=0;h<c.length;h++)p[h]=null==a.labelTemplate?e('<label class="e-treemap-label" >'+c[h]+"</label>"):e("<label>"+c[h]+"</label>"),this.enableDrillDown()?e(p[h]).css({position:"absolute",color:"black",overflow:"hidden",left:r.LeftPosition+8+"px",top:r.TopPosition+5+"px","font-weight":"normal","pointer-events":"none"}):e(p[h]).css({position:"absolute",color:null==a.labelTemplate?"white":"black",overflow:"hidden",left:r.LeftPosition+8+"px",top:r.TopPosition+5+"px","font-weight":"normal","pointer-events":"none"}),this._treeMapLabels.push(p[h]),this._templateDiv.append(p[h]),g=0,m=0,a.groupPadding!=i&&(g=a.groupPadding),a.groupBorderThickness!=i&&(m=a.groupBorderThickness),f=p[h][0].getBoundingClientRect().width>0?p[h][0].getBoundingClientRect().width+g+m+2:8*r.label.length,0==(_=p[h][0].getBoundingClientRect().height)&&r.ItemHeight>18?_=18:_>0&&_>r.ItemHeight&&(_=r.ItemHeight-5),e(p[h]).css({width:f+"px",height:_+"px"}),r.labelPosition=a.labelPosition,r.labelVisibilityMode=m,r.groupPadding=a.groupPadding,r.groupBorderThickness=a.groupBorderThickness,p[h][0].data=r,a.labelVisibilityMode==t.datavisualization.TreeMap.VisibilityMode.HideOnExceededLength?(f>r.ItemWidth&&(e(p[h]).css({display:"none"}),null!=r.Rectangle&&(r.Rectangle.title=r.label)),a.labelVisibilityMode):f<r.ItemWidth?e(p[h]).css({width:f}):e(p[h]).css({width:r.ItemWidth});this._labelTemplateElements.push(p)}}},_generateToolTip:function(){var t,i,l;this.showTooltip()&&(null!=(t=8==document.documentMode?document.querySelectorAll("e-tooltipelement"):document.getElementsByClassName("e-tooltipelement"+this._id))&&0==t.length?(i=e("<div></div>").attr("class","e-tooltipelement"+this._id).css({position:"absolute","z-index":"1000",display:"none","pointer-events":"none"}),e(document.body).append(i),this._toolTipElement=i):this._toolTipElement=t[0],null==this.model.tooltipTemplate&&(null!=(l=null!=this.labelPath()?this.labelPath():this.weightValuePath())&&(this.model.tooltipTemplate="defaultTooltip",this.element.append(e('<div id="defaultTooltip" style="display:none;"><div style="margin-left:10px;margin-top:-25px;"><div class="e-defaultToolTip"><p style="margin-top:-4px"><label  style="color:rgb(27, 20, 20);font-size:14px;font-weight:normal;font-family:Segoe UI">{{:#data["'+l+'"]}}</label></p></div></div></div>')))))},_generateLegend:function(){var e,l,a;if(null!=this.model.rangeColorMapping||null!=this.model.colorPath){var r=null!=this.model.rangeColorMapping&&this.model.rangeColorMapping.length>0?this.model.rangeColorMapping:this._legendItem,n=null!=this.model.rangeColorMapping&&this.model.rangeColorMapping.length>0,o=this.model.legendSettings;if(o.mode!=t.datavisualization.TreeMap.LegendMode.Interactive){var s,d=0,u=0,c=0,p=(this.iconWidth(),this.iconHeight(),this.model.legendSettings.columnCount);for(e=0;e<r.length;e++)s={color:n?r[e].color:r[e]._color?r[e]._color:r[e].color,legendLabel:r[e].legendLabel,dataSource:n?i:r[e].Data,mapping:n?r[e]:i},this._trigger("legendItemRendering",{model:this.model,data:s}),l=this._calcWidth(s.legendLabel),a=this.iconWidth()+10+l,0!=p?e%p!=0?(this._drawLegend(s,d,u),d+=a+5):(0!=e&&(u+=this.iconHeight()+18),d=0,this._drawLegend(s,d,u),d+=a+5):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?this._legendSize.width<d+a?(u+=this.iconHeight()+18,d=0,this._drawLegend(s,d,u),d+=a):(this._drawLegend(s,d,u),d+=a):this._legendSize.height<u+this.iconHeight()?(u=0,d+=c+10,this._drawLegend(s,d,u),c=0,u+=this.iconHeight()+18):(this._drawLegend(s,d,u),c=Math.max(c,a),u+=this.iconHeight()+18)}else this._drawInteractiveLegend();this.dockPosition()!=t.datavisualization.TreeMap.DockPosition.Top&&this.dockPosition()!=t.datavisualization.TreeMap.DockPosition.Bottom||o.alignment!=t.datavisualization.TreeMap.Alignment.Center?this.dockPosition()!=t.datavisualization.TreeMap.DockPosition.Top&&this.dockPosition()!=t.datavisualization.TreeMap.DockPosition.Bottom||o.alignment!=t.datavisualization.TreeMap.Alignment.Far?this.dockPosition()!=t.datavisualization.TreeMap.DockPosition.Left&&this.dockPosition()!=t.datavisualization.TreeMap.DockPosition.Right||o.alignment!=t.datavisualization.TreeMap.Alignment.Center?(this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Left||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Right)&&o.alignment==t.datavisualization.TreeMap.Alignment.Far&&this._legenddiv.css({"margin-top":this._height-this._legendSize.height}):this._legenddiv.css({"margin-top":this._height/2-this._legendSize.height/2}):this._legenddiv.css({"margin-left":this._width-this._legendSize.width}):this._legenddiv.css({"margin-left":this._width/2-this._legendSize.width/2}),this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?this._legenddiv.css({"margin-top":this._height+5}):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Right&&this._legenddiv.css({"margin-left":this._width+5})}},_drawLegend:function(t,i,l){var a,r;a="Ellipse"==this.model.legendSettings.template?this._getEllipseLegend(this.model.legendSettings,i,l):this._getRectLegend(this.model.legendSettings,i,l),i+=this.iconWidth()+5,e(a).css("background-color",t.color),a.appendTo(this._legenddiv),(r=e("<div class='e-treemap-legendLabel'/>")).css({left:i+"px",top:l+"px",position:"absolute"}),r[0].innerHTML=t.legendLabel,r.appendTo(this._legenddiv)},_calcWidth:function(t){var i,l=e('<span class ="e-treemap-legendLabel" >'+t+"</span>");return e("body").append(l),i=l.width(),l.remove(),i},_getEllipseLegend:function(t,i,l){var a=e("<div class='e-mapLegend'/>");return a.css({height:this.iconHeight()+"px",width:this.iconWidth()+"px","border-radius":this.iconHeight()/2+"px",left:i+"px",top:l+"px",position:"absolute"}),a},_getRectLegend:function(t,i,l){var a=e("<div />");return a.css({height:this.iconHeight()+"px",width:this.iconWidth()+"px",left:i+"px",top:l+"px",position:"absolute"}),a},_getPositionFromParent:function(e,t){var i=e.getBoundingClientRect(),l=t.getBoundingClientRect(),a=window.SVGSVGElement?i.width:i.right-i.left,r=window.SVGSVGElement?i.height:i.bottom-i.top;return{left:i.left-l.left,top:i.top-l.top,height:r,width:a}},_renderLabels:function(){for(var i,l=0;l<this._labelTemplateElements.length;l++)for(i=0;i<this._labelTemplateElements[l].length;i++){var a=this._labelTemplateElements[l][i],r=a[0]?a[0]:a,n=this._getPositionFromParent(r,this._templateDiv[0]),o=r.data,s=this._getDockPositionPoint({left:o.LeftPosition,top:o.TopPosition,width:o.ItemWidth,height:o.ItemHeight},n,o),d=o.labelPosition.toLowerCase();("bottomleft"==d||"bottomright"==d||"bottomcenter"==d)&&o.showHeader&&this.enableDrillDown()&&(s.y=s.y+o.headerHeight),e(a).css({left:s.x,top:s.y+18*i,"pointer-events":"none",overflow:"hidden"}),o.labelVisibilityMode==t.datavisualization.TreeMap.VisibilityMode.HideOnExceededLength&&(n.height>o.ItemHeight||n.width>o.ItemWidth)&&e(a).css("display","none")}},_generateHeaders:function(i,l){var a,r,n,o,s,d,u=!1;l.headerVisibilityMode==t.datavisualization.TreeMap.VisibilityMode.HideOnExceededLength?(a=e("<span>"+i.header+"</span>"),e(document.body).append(a),r=a.outerWidth(),a.remove(),i.headerHeight<i.ItemHeight-4&&r<i.ItemWidth-4&&(u=!0)):i.headerHeight<i.ItemHeight&&(u=!0),u&&(null==i.headerTemplate?(n=e('<div style="display:block;position:absolute;pointer-events: stroke;overflow: hidden;"><label class="e-treemap-header">'+i.header+"</label></div>"),e(n).css({left:i.headerLeftPosition+2,top:i.headerTopPosition+2,width:i.headerWidth-l.groupPadding,height:i.headerHeight,"margin-left":l.groupPadding}),this._templateDiv.append(n)):(o=e("<div style='display:block;position:absolute;pointer-events: none;overflow: hidden;'></div>"),this._templateDiv.append(o),e(o).css({left:i.headerLeftPosition,width:i.headerWidth,top:i.headerTopPosition,height:i.headerHeight}),s={header:i.header,data:i.Data},d=e("#"+i.headerTemplate).render(s),e(o).html(d)))},getDrillDownHeader:function(e){var t,i="";if(1==e.length)return e[0];for(t=0;t<e.length;t++)i+=e[t],t!=e.length-1&&(i+=this.model._connectorText||".");return i},_getPreRenderEventData:function(e,t){var l,a,r,n,o;for(a=(t=t>=this.model.levels.length-1?this.model.levels.length-1:t)===i?this.model.levels[this._drilldownItems.length]:this.model.levels[t],l=this._getGroupitem(a.groupPath,e,a.headerHeight),r=this._getTotalWeight(l),n=l.length-1;n>=0;n--)(o=l[n]).AreaByWeight=o.weight/r;return l.sort(this._orderByAreaWight)},_drillDownHeader:function(t,i,l){var a,r,n,o={groupingLevel:i.groupingLevel,groupPath:i.groupPath,childItems:l,levelItems:i,headerItem:{drilldownHeaders:this._drilldownHeaders,originalHeaders:this._originalHeaders},connectorText:"."};for(this._trigger("headerTemplateRendering",o),this.model._connectorText=o.connectorText,a=[],[],r=0;r<this._drilldownHeaders.length;r++)a+="<label class='e-drilldownlabel' style='margin-left:-8px'>"+this._drilldownHeaders[r]+"</label>",this._drilldownHeaders.length>1&&r<this._drilldownHeaders.length-1&&(a+=this.model._connectorText);n=e("<div class='e-drilldownHeader' style='display:block;overflow: hidden;'><div class='e-drilldownlabel'  style='position:absolute;height:30px;position:absolute;margin-top: 5px;top: 0px;'>"+a+"</div></div>"),t&&(n=e("<div class='e-drilldownHeader' style='display:block;overflow: hidden;'><svg class='e-drilldownarrow' style='width:15px;height:15px;margin-top: 10px;'><polyline points='8,0 8,10 0,5 8,0'/></svg><label class='e-drilldownlabel'  style='left:17px;position:absolute;height:30px;position:absolute;margin-top: 5px;top: 0px;'>"+a+"</label></div>")),e(n).css({left:"0px",width:this._width+"px",top:0,height:"30px",cursor:"pointer"}),null!=this.drillDownHeaderColor()&&e(n).css("background-color",this.drillDownHeaderColor()),this._drillHeaderDiv.append(n),e(n).mousedown({treemap:this},this._drilldownfunction),e(n).find(".e-drilldownlabel").mousedown({treemap:this},this._drilldownLabel)},_drilldownLabel:function(e){var i,l,a,r,n,o,s,d=this.innerHTML,u=e.data.treemap;if(u._drilldownHeaders[0]!=d){for("",u._drillHeaderDiv[0].innerHTML="",u._backgroundTile[0].innerHTML="","",l=0;l<u._drilldownHeaders.length;l++)d==u._drilldownHeaders[l]&&(i=l+1,u._originalHeaders.splice(l+1),u._drilldownHeaders.splice(l+1));if(0==u._drilldownItems.length&&u._initialLevel)for(a=u._drilldownHeaders.length,r=0;r<a;r++)for(n=u._getPreRenderEventData(this.dataSource(),r),o=0;o<n.length;o++)n[o].header==u._drilldownHeaders[r+1]&&(s=n[o],u._drilldownItems.push(s),u._drilldownItem=s,g=u._drilldownItems[0]);u._labelTemplateElements=[];var c=u.model.levels[u._drilldownHeaders.length-1],p=u._drilldownHeaders.length-u._drilldownItems.length,h=u._drilldownItems.length,g=1==u._drilldownItems.length?u._drilldownItems[0].Data:u._drilldownItems[p<0?h+p:p].Data;return u._drillDownHeader(!0,c,g),i&&(u._drilldownItem=u._drilldownItems[i-2],u._drilldownItems.splice(i-1)),u._templateDiv[0].innerHTML="",t.util.isNullOrUndefined(u._drilldownItem)||u._groupdrillDownLevels(u._drilldownItem,u._drilldownItems.length),!1}u._drilldownItems=[],u.refresh()},_drilledStateDrillDownFunction:function(e){var t,i,l,a,r;if(0==e._drilldownItems.length&&e._initialLevel)for(e._originalHeaders=e._drilldownHeaders,t=e._drilldownHeaders.length-1,i=0;i<t;i++)for(l=e._getPreRenderEventData(this.dataSource(),i),a=0;a<l.length;a++){var n=e._drilldownHeaders[i+1],o=-1!=n.indexOf(e.model.drillDownValue),s=-1!=l[a].header.indexOf(e.model.drillDownValue);(l[a].header==n||s&&o)&&(r=l[a],e._drilldownItems.push(r),e._drilldownItem=r)}},_drilldownfunction:function(e){var t,i,l,a=e.data.treemap;if(a._trigger("drillStarted",e),a._drilledStateDrillDownFunction(a),a._drilldownItems.length>0){if(1==a._drilldownItems.length)a._drilldownItems=[],a.refresh();else{for(t="",i=0;i<a._drillHeaderDiv[0].children[0].children.length;i++)"e-drilldownlabel"==a._drillHeaderDiv[0].children[0].children[i].className&&(t=a._drillHeaderDiv[0].children[0].children[i].innerHTML);t.split(a.model._connectorText||"."),a._drillHeaderDiv[0].innerHTML="",a._backgroundTile[0].innerHTML="","",a._drilldownHeaders.length>1&&a._drilldownHeaders.pop(a._drilldownHeaders.length-1),a._labelTemplateElements=[],(l=a.model.levels[a._drilldownHeaders.length-1]).groupingLevel=e.data.treemap._drilldownItem.GroupingLevel?e.data.treemap._drilldownItem.GroupingLevel:a.model.drillDownLevel,a._drillDownHeader(!0,l,a._drilldownItem.Data),a._drilldownItem=a._drilldownItems[a._drilldownItems.length-2],a._drilldownItems.pop(a._drilldownItems[a._drilldownItems.length-1]),a._templateDiv[0].innerHTML="",a._groupdrillDownLevels(a._drilldownItem,a._drilldownItems.length)}a._trigger("drillDownItemSelected",{level:a._drilldownItems.length,header:a.getDrillDownHeader(a._drilldownHeaders),prevLevel:a._drilldownItems.length-1})}},_sizeCalculation:function(l){var a,r;if(null!=this.model.rangeColorMapping||null!=this.model.colorPath){var n,o=null!=this.model.rangeColorMapping&&this.model.rangeColorMapping.length>0?this.model.rangeColorMapping:l||e.extend(!0,[],this.model.dataSource),s=null!=this.model.rangeColorMapping&&this.model.rangeColorMapping.length>0,d=0,u=0,c=this.iconWidth()+5,p=this.iconHeight()+15,h=0,g=this.model.legendSettings.columnCount,m=this.model.legendSettings;if(this.model.legendSettings.mode!=t.datavisualization.TreeMap.LegendMode.Interactive){if(0==this.legendheight()&&0==this.legendwidth()&&0==g){for(s||(this._legendItem=o,this._generateLegendLabels(this.model,this._legendItem)),r=0;r<o.length;r++)o[r].legendLabel==i&&(o[r].legendLabel=o[r].from+"-"+o[r].to),a=c+this._calcWidth(o[r].legendLabel)+10,0==this.legendheight()&&0==this.legendwidth()?this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?this._width<d+a?(p=this.iconHeight()+15+p,h=Math.max(h,d),d=a):d+=a:this._height<u+this.iconHeight()+15?(h+=d,p=Math.max(p,u),d=a,u=0):(u+=this.iconHeight()+18,d=Math.max(a,d)):(n+=a+18)+150>=this.legendwidth()&&(n=10,40);this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top||this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?(h=Math.max(h,d),p+=5):(h+=d+15,p=Math.max(p,u))}else if(0==g){for(r=0;r<o.length;r++)o[r].legendLabel==i&&(o[r].legendLabel=o[r].from+"-"+o[r].to);p=-1!=this.legendheight().toString().indexOf("%")?this._height/100*parseInt(this.legendheight().replace("%","")):this.legendheight(),h=-1!=this.legendwidth().toString().indexOf("%")?this._width/100*parseInt(this.legendwidth().replace("%","")):this.legendwidth()}if(0!=g)for(r=0;r<o.length;r++)o[r].legendLabel==i&&(o[r].legendLabel=o[r].from+"-"+o[r].to),a=c+this._calcWidth(o[r].legendLabel)+10,r%g!=0?(d+=a,r==g-1&&(h=Math.max(h,d))):(0!=r&&(p=this.iconHeight()+15+p),h=Math.max(h,d),d=a)}else p=(0!=m.height?m.height:30)+18,null!=m.title&&""!=m.title&&(p+=25),h=(0!=m.width?m.width:100)+20+10*m.leftLabel.length+10*m.rightLabel.length;this._legendSize={height:p,width:h},null!=this.model.legendSettings&&(this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Bottom?(this._height=this._height-parseFloat(p),this.model.legendSettings.tempWidth=d):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Top?(this._height=this._height-parseFloat(p),this._margintop=parseFloat(p)):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Left?(this._width=this._width-h,this._marginleft=h):this.dockPosition()==t.datavisualization.TreeMap.DockPosition.Right&&(this._height=this._height,this._width=this._width-h))}},_generateLegendLabels:function(e,t){for(var i=e.colorPath,l=0;l<t.length;l++)this.enableDrillDown()?t[l].legendLabel=t[l].header:(t[l].legendLabel=this.labelPath()?t[l][this.labelPath()]:t[l][e.weightValuePath],t[l].color=t[l][i])},_getDockPositionPoint:function(e,l,a){var r=a.labelPosition,n=2,o=2;return a.groupPadding!=i&&a.groupBorderThickness!=i&&(n=a.groupPadding+a.groupBorderThickness+n,o=a.groupPadding+a.groupBorderThickness+o),a.showHeader&&(o+=a.headerHeight),r==t.datavisualization.TreeMap.Position.TopCenter?n=e.width/2-l.width/2:r==t.datavisualization.TreeMap.Position.TopRight?n=e.width-l.width-n:r==t.datavisualization.TreeMap.Position.CenterLeft?o=e.height/2-l.height/2:r==t.datavisualization.TreeMap.Position.Center||null==r?(n=e.width/2-l.width/2,o=e.height/2-l.height/2):r==t.datavisualization.TreeMap.Position.CenterRight?(n=e.width-l.width-n,o=e.height/2-l.height/2):r==t.datavisualization.TreeMap.Position.BottomLeft?o=e.height-l.height-o:r==t.datavisualization.TreeMap.Position.BottomCenter?(n=e.width/2-l.width/2,o=e.height-l.height-o):r==t.datavisualization.TreeMap.Position.BottomRight&&(n=e.width-l.width-n,o=e.height-l.height-o),{x:e.left+n,y:e.top+o}},_generateTreeMapItems:function(t,l,a,r){var n,o,s,d,u,c;if(this._rootTreeMapItems=t,this._getTreeMapItemTemplate(t),null!=t){for(this._isLevelColors||this._setColorMappings(t,this.model,i,r),n=0;n<t.length;n++){if(s=(o=t[n]).rectangle,null!=o.Data&&o.Data.length>0&&(o.Data=o.Data[0]),o.Rectangle=s,d={borderThickness:this.model.leafItemSettings.borderThickness,borderBrush:this.model.leafItemSettings.borderBrush,fill:o.backgroundColor,dataSource:o.Data},this._trigger("itemRendering",{model:this.model,data:d}),d.fill!=o.backgroundColor&&(o._color=d.fill,this.enableDrillDown()))for(u=0;u<r.length;u++)if(r[u].ChildtreeMapItems)for(c=0;c<r[u].ChildtreeMapItems.length;c++)o.header==r[u].ChildtreeMapItems[c].header&&(r[u]._color=d.fill);e(s).css({"box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","border-color":d.borderBrush,"border-width":d.borderThickness+"px"}),d.fill?e(s).css("background-color",d.fill):e(s).css("background-color","#E5E5E5"),null!=o.backgroundOpacity&&e(s).css("opacity",o.backgroundOpacity),this._wireEventForTreeMapItem(o,s)}0==this.model.rangeColorMapping.length&&null==this.uniColor()&&""!=this._color()?this._setDesaturationColor(t,this.model.desaturationColorMapping):null!=this.model.PaletteColorMapping&&this._setPaletteColor(t,this.model.PaletteColorMapping)}},browserInfo:function(){var e={},t=[],i={webkit:/(chrome)[ \/]([\w.]+)/i,safari:/(webkit)[ \/]([\w.]+)/i,msie:/(msie) ([\w.]+)/i,opera:/(opera)(?:.*version|)[ \/]([\w.]+)/i,mozilla:/(mozilla)(?:.*? rv:([\w.]+)|)/i};for(var l in i)if(i.hasOwnProperty(l)&&(t=navigator.userAgent.match(i[l]))){e.name=t[1].toLowerCase(),e.version=t[2],!navigator.userAgent.match(/Trident\/7\./)||(e.name="msie");break}return e.isMSPointerEnabled="msie"==e.name&&e.version>9&&window.navigator.msPointerEnabled,e.pointerEnabled=window.navigator.pointerEnabled,e},isTouch:function(e){var t=e.originalEvent?e.originalEvent:e;return"touch"==t.pointerType||2==t.pointerType||t.type.indexOf("touch")>-1},_wireEventForTreeMapItem:function(t,i){var l=this.model.browserInfo,a=l.isMSPointerEnabled,r=l.pointerEnabled,n=a?r?"pointerdown":"MSPointerDown":"touchstart mousedown",o=a?r?"pointerup":"MSPointerUp":"touchend mouseup",s=a?r?"pointermove":"MSPointerMove":"touchmove mousemove",d=a?r?"pointerenter":"MSPointerEnter":"touchenter mouseenter",u=a?r?"pointerleave":"MSPointerOut":"touchleave mouseleave";this._on(e(i),s,{Param1:t,Param2:this},this._rectMouseMove),this._on(e(i),u,{treeMap:this},this._rectMouseLeave),this._on(e(i),o,{Param1:t,Param2:this},this._rectMouseUp),this._on(e(i),n,{treeMap:this},this._rectMouseDown),this._on(e(i),d,{Param1:t,Param2:this},this._rectMouseEnter)},_getTreeMapItemTemplate:function(i){for(var l,a,r,n="",o=0;o<i.length;o++)l=i[o],null==this.model.leafItemSettings.itemTemplate?n+='<div style="border-style:solid;position:absolute;left:'+l.LeftPosition+"px;top:"+l.TopPosition+"px;height:"+l.ItemHeight+"px;width:"+l.ItemWidth+"px;border-width:"+this.borderThickness()+"px;border-color:"+this.borderBrush()+'"></div>':(a=e("#"+this.model.leafItemSettings.itemTemplate),null!=l.Data&&1==l.Data.length&&(l.Data=l.Data[0]),r=e.templates(a.html()),n+="<div style='overflow:hidden;position:absolute;left:"+l.LeftPosition+"px;top:"+l.TopPosition+"px;height:"+l.ItemHeight+"px;width:"+l.ItemWidth+"px'>"+r.render(l)+"</div>");null!=this._svgDocument&&this.enableDrillDown()&&(this._svgDocument[0].innerHTML=""),this._svgDocument=e('<div style= "overflow:hidden;z-index:1;"id="svgDocument">'+n+"</div>"),this._backgroundTile.appendTo(this.element),this._svgDocument.appendTo(this.element),this._svgDocument.css({height:this._height+"px",width:this._width+"px","margin-top":this._margintop+"px","margin-left":this._marginleft,overflow:"hidden","z-index":1,position:"absolute",left:"0",top:"0"}),e(this._backgroundTile).css({height:this._height+"px",width:this._width+"px","margin-top":this._margintop+"px","margin-left":this._marginleft,overflow:"hidden","z-index":0,position:"absolute",left:"0",top:"0"}),this._templateDiv.appendTo(this.element),e(this._templateDiv).mousemove({Param2:this},this._rectMouseMove);var s=this.model.browserInfo,d=s.isMSPointerEnabled,u=s.pointerEnabled,c=d?u?"pointerdown":"MSPointerDown":"touchstart mousedown",p=d?u?"pointerup":"MSPointerUp":"touchend mouseup";for(this._off(e(this.element),c,this.rectClick),this._off(e(this.element),p,this._docClickFunction),this._off(e(this.element),t.eventType.mouseDown,this.dragDown),this._off(e(this.element),t.eventType.mouseMove,this.dragMove),this._off(e(this.element),t.eventType.mouseUp,this.dragUp),this._on(e(this.element),c,{treemap:this,Param1:i},this.rectClick),this._on(e(this.element),p,{treemap:this,Param1:i},this._docClickFunction),this._on(e(this.element),t.eventType.mouseDown,{treemap:this},this.dragDown),this._on(e(this.element),t.eventType.mouseMove,{treemap:this},this.dragMove),this._on(e(this.element),t.eventType.mouseUp,{treemap:this},this.dragUp),this.enableDrillDown()&&(this._drillHeaderDiv.appendTo(this.element),this._drillHoverDiv.appendTo(this.element)),o=0;o<i.length;o++)i[o].rectangle=this._svgDocument[0].childNodes[o]},selectItem:function(t){var i,l,a,r;if(null!=this._rootTreeMapItems)for(i=0;i<this._rootTreeMapItems.length;i++)a=(l=this._rootTreeMapItems[i]).rectangle,null!=l.Data&&l.Data.length>0&&(l.Data=l.Data[0]),t==l.Data&&this.highlightOnSelection()&&(e(a).css({"border-width":this.highlightBorderThickness(),"border-color":this.highlightBorderBrush()}),"msie"!=this._browser&&(r=this._svgDocument[0].children[this._svgDocument[0].children.length-1],this._svgDocument[0].insertBefore(a,r)),this._prevSelectedItems.push(a),this._trigger("treeMapItemSelected",{selectedItems:t,originalEvent:event}))},_selectTreemapItem:function(t){var i,l,a,r;if(null!=this._rootTreeMapItems)for(i=0;i<this._rootTreeMapItems.length;i++)a=(l=this._rootTreeMapItems[i]).rectangle,null!=l.Data&&l.Data.length>0&&(l.Data=l.Data[0]),t!=l.Data||this._contains(this.selectedItems,t)||this.highlightOnSelection()&&(e(a).css({"border-width":this.highlightBorderThickness(),"border-color":this.highlightBorderBrush()}),"msie"!=this._browser&&(r=this._svgDocument[0].children[this._svgDocument[0].children.length-1],this._svgDocument[0].insertBefore(a,r)),this._prevSelectedItems=[],this.selectedItems=[],this._prevSelectedItems.push(a),this.selectedItems.push(t))},_selectItemResize:function(){for(var e,t=0;t<this._rootTreeMapItems.length;t++)(e=this._rootTreeMapItems[t]).rectangle,null!=e.Data&&e.Data.length>0&&(e.Data=e.Data[0]),this._contains(this.selectedItems,e.Data)&&this.selectItem(e.Data)},_updateLegendRange:function(e,t){for(var l,a,r,n,o,s,d,u,c=this.model.rangeColorMapping,p=0;p<c.length;p++)if(l=null,a=c[p],this.model.enableGradient&&(l=this._generateGradientCollection(a.gradientColors)),e>=a.from&&e<=a.to)for(r=p,0!=p&&(r=10*p),n=a.from,o=a.from+(a.to-a.from)/10,s=r;s<r+10;s++){if(e>=n&&e<=o)return d={},u=this._getColorRatio(.7,1,e,a.from,a.to),this._legendRects[s]!=i&&(d=this._legendRects[s]),t.backgroundColor=this.model.enableGradient?0!=p?l[s-10*p]:l[s]:a.color,t.backgroundOpacity=u,d.color=t.backgroundColor,d;n=o,o+=(a.to-a.from)/10}},selectItemByPath:function(e,t,i){for(var l,a,r,n,o,s=e.split(i),d=t.split(i),u=this._rootTreeMapItems,c=0;c<s.length;c++){e=s[c],t=d[c];var p=[];for(l=0;l<u.length;l++){for(a=(o=u[l]).Data,n=0;n<s.length;n++)r=this._reflection(a,e);t==r&&p.push(o)}u=p}for(c=0;c<u.length;c++)o=u[c],this.selectItem(o.Data)},_getColorRatio:function(e,t,i,l,a){var r=100/(a-l)*(i-l);return(parseFloat(t)-parseFloat(e))/100*r+parseFloat(e)},_contains:function(e,t){var i=e.length;if(i>0)for(;i--;)if(e[i]===t)return!0;return!1},_rectMouseEnter:function(l){var a,r,n,o,s,d,u,c,p,h,g,m,f,_=l.data.Param2,v=_.model.legendSettings,b=l.data.Param1.Data;if(null!=b&&(a=l.data.Param2._toolTipElement,r=l.data.Param2.model.tooltipTemplate,null!=a&&null!=r)){if(_.isTouch(l)||e(a).css({left:l.pageX+10,top:l.pageY+10,display:"block"}),n=this.model.locale,o=e.extend({},b),n&&this.model.enableGroupSeparator)for(s in o)o[s]=isNaN(parseFloat(o[s]))?o[s]:parseFloat(o[s]).toLocaleString(n);d=e("#"+r).render(o),e(a).html(d),u=null!=a[0]?a[0].clientHeight:a.clientHeight,c=null!=a[0]?a[0].clientWidth:a.clientWidth,l.data.Param2._tooltipSize={height:u,width:c}}if(null!=v&&v.mode==t.datavisualization.TreeMap.LegendMode.Interactive&&null!=_.model.rangeColorMapping&&(_.showLegend()==i||_.showLegend()))for(p=0;p<_._rootTreeMapItems.length;p++)if(_._rootTreeMapItems[p].Rectangle==l.target&&(h=null,_.model.rangeColorMapping!=i&&(h=_.model.rangeColorMapping),g=v.width,v.width==i&&(g=150),m=g/h.length/10,null!=_._rootTreeMapItems[p].legendrect)){f=_._rootTreeMapItems[p].legendrect.marginLeft+Math.ceil(m)-_._interactiveArrow.width()/2,e(_._interactiveArrow).css({"margin-left":f,display:"block"});break}},displayTooltip:function(t){var l,a,r,n,o,s,d,u,c,p=t.data.Param2,h=p._toolTipElement,g=p.mousePosition(t),m=!0;if(p.model.trackerElement&&(clearTimeout(p.model.timer),e(".e-tooltipelement"+this._id).finish()),t.data.Param1==i&&null!=h){for(u=0;u<p._rootTreeMapItems.length;u++)if((a=p._rootTreeMapItems[u]).rectangle.offsetLeft<g.offsetX&&a.rectangle.offsetLeft+a.rectangle.offsetWidth>g.offsetX&&a.rectangle.offsetTop<g.offsetY&&a.rectangle.offsetTop+a.rectangle.offsetHeight>g.offsetY){l=a.Data;break}null!=l?(r=t.data.Param2.model.tooltipTemplate,null!=h&&null!=r&&(e(h).css({left:g.pageX+10,top:g.pageY+10,display:"block"}),n=e("#"+r).render(l),e(h).html(n),o=null!=h[0]?h[0].clientHeight:h.clientHeight,s=null!=h[0]?h[0].clientWidth:h.clientWidth,p._tooltipSize={height:o,width:s})):null!=h&&(m=!1,e(h).css("display","none"))}if(m){if((d=p._tooltipSize).width+g.pageX>=p._width&&(g.pageX-=d.width,g.pageX<0&&(g.pageX=10)),d.height+g.pageY>=p._height&&(g.pageY-=d.height,g.pageY<0&&(g.pageY=10)),p.enableDrillDown()&&"msie"!=p._browser)for(u=0;u<p._drillHoverDiv[0].children.length;u++)(c=p._drillHoverDiv[0].children[u]).className==t.data.Param1.ParentHeader&&e(c).css({display:"block"});null!=h&&e(h).css({left:g.pageX+10,top:g.pageY+10,display:"block"})}},_rectMouseUp:function(e){this.isTouch(e)&&this.displayTooltip(e)},_rectMouseMove:function(e){e.data.Param2.isTouch(e)||e.data.Param2.displayTooltip(e)},_rectMouseLeave:function(t){var i=t.data.treeMap._toolTipElement;null==i||t.data.treeMap.isTouch(t)||e(i).css("display","none")},_setColorMappings:function(e,i,l,a){var r,n,o,s=this.model.legendSettings;if(null!=i.rangeColorMapping&&i.rangeColorMapping.length>0||null!=i.uniColorMapping&&(null!=i.uniColorMapping.color||null!=this.uniColor()))for(r=0;r<e.length;r++)l||(n=e[r].Data instanceof Array?this._reflection(e[r].Data[0],this.colorValuePath()):this._reflection(e[r].Data,this.colorValuePath())),s.mode==t.datavisualization.TreeMap.LegendMode.Interactive||this.model.enableGradient?e[r].legendrect=this._updateLegendRange(n,e[r]):(o=e[r]._generateColorMappings(i,this),e[r].backgroundColor=o);else null==i.desaturationColorMapping||""==i.desaturationColorMapping.color&&""==this._color()?null!=i.paletteColorMapping&&i.paletteColorMapping.colors.length>0?this._setPaletteColor(e,i.paletteColorMapping):null!=this.model.colorPath&&this._setFillColor(e,this.model.colorPath,a):this._setDesaturationColor(e,i.desaturationColorMapping)},_setFillColor:function(e,t,i){for(var l,a=0;a<e.length;a++)e[a].color=e[a].backgroundColor=e[a].Data[0]?e[a].Data[0][t]:e[a].Data[t],e[a].legendLabel=e[a].header;if(this.enableDrillDown()&&this.showLegend()){for(l=0;l<i.length;l++)i[l].ChildtreeMapItems&&(i[l].ChildtreeMapItems.sort(function(e,t){return parseFloat(t.weight)-parseFloat(e.weight)}),i[l].color=i[l].ChildtreeMapItems[0].Data[0][t],i[l].legendLabel=i[l].header);this._legendItem=i}else this.enableDrillDown()||!this.showLegend()||this.model.isHierarchicalDatasource||(this._legendItem=e)},_setDesaturationColor:function(e,t){var i,l,a,r,n;e=e.sort(this._orderBycolorWeight);var o="number"==typeof t.from?t.from:this._from(),s="number"==typeof t.to?t.to:this._to(),d="number"==typeof t.rangeMinimum?t.rangeMinimum:this._rangeMinimum(),u="number"==typeof t.rangeMaximum?t.rangeMaximum:this._rangeMaximum(),c=[];for(i=0;i<e.length;i++)l=e[i].Data[0],null!=(a=this._reflection(l,this.colorValuePath()))&&"number"!=typeof a&&(a=Number(a.replace(/[^0-9\.]+/g,""))),c.push(a);for(0==this._rangeMinimum()&&(d=Math.min.apply(Math,c)),0==this._rangeMaximum()&&(u=Math.max.apply(Math,c)),(o<0||o>1)&&(o=1),(s>1||s<0)&&(s=0),r=(o-s)/e.length,n=0;n<e.length;n++)e[n].backgroundColor="string"==typeof t.color?t.color:this._color(),e[n].colorWeight>=d&&e[n].colorWeight<=u&&(e[n].backgroundOpacity=o,o-=r)},_generateGradientCollection:function(e){for(var t=[],i=e[0],l=e[e.length-1],a=this._hexToR(i),r=this._hexToG(i),n=this._hexToB(i),o=this._hexToR(l),s=this._hexToG(l),d=this._hexToB(l),u=this._getRangeColorValues(10,a,o),c=this._getRangeColorValues(10,r,s),p=this._getRangeColorValues(10,n,d),h=0;h<10;h++)t.push(this._rgbToHex(u[h],c[h],p[h]));return t},_hexToR:function(e){return parseInt(this._cropHex(e).substring(0,2),16)},_hexToG:function(e){return parseInt(this._cropHex(e).substring(2,4),16)},_hexToB:function(e){return parseInt(this._cropHex(e).substring(4,6),16)},_cropHex:function(e){return"#"==e.charAt(0)?e.substring(1,7):e},_rgbToHex:function(e,t,i){return"#"+this._toHex(e)+this._toHex(t)+this._toHex(i)},_toHex:function(e){var t="0123456789ABCDEF";return e=parseInt(e,10),isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)),t.charAt((e-e%16)/16)+t.charAt(e%16))},_getRangeColorValues:function(e,t,i){var l,a,r=[];if(r.push(t),t>i)for(l=(t-i)/(e-1),a=e;a>2;a--)t-=l,r.push(t);else for(l=(i-t)/(e-1),a=2;a<e;a++)t+=l,r.push(t+l);return r.push(i),r},_isSVG:function(){return!!window.SVGSVGElement},_drawInteractiveLegend:function(){var l,a,r,n,o,s,d,u,c,p,h,g,m,f,_,v,b,C,S,P,w=this.model.legendSettings,O=0,y=0,x=this._legenddiv,M=0!=this.model.legendSettings.height?this.model.legendSettings.height:30,N=0!=this.model.legendSettings.width?this.model.legendSettings.width:100;if(w.mode==t.datavisualization.TreeMap.LegendMode.Interactive||null!=this.model.rangeColorMapping){for(P="",0==w.height&&(M=30),0==w.width&&(N=100),null==w.leftLabel&&(w.leftLabel=""),null!=w.title&&(n=O,w.showLabels||(n=O+10*w.leftLabel.length),o=10*w.title.length,s=l=w.title,o>N&&(s=this._trimFunction(s,N)),(P=this._createLabel(s,n,y,"e-interactivelegend-title"))[0].title=l,P.css({width:N+"px"}),this._isSVG()?P.appendTo(x):x.append(P),y+=25),w.showLabels&&(y+=25),null==w.leftLabel||w.showLabels||(P=this._createLabel(w.leftLabel,O,y-3,"e-interactivelegend-leftlabel"),this._isSVG()?P.appendTo(x):x.append(P),O+=10*w.leftLabel.length),(d=this._createInteractiveArrow(O,y+M)).appendTo(x),this._interactiveArrow=d,u=null,!this._isSVG()&&this.model.enableGradient&&((u=this._createGroup(!1,"legendGroup")).style.left="0px",u.style.top="0px",u.style.position="relative",x.append(u)),c=this.model.rangeColorMapping,p=0;p<c.length;p++)if(!(h=c[p]).hideLegend){if(g=[],this.model.enableGradient&&(g=this._generateGradientCollection(h.gradientColors)),m={},this.model.enableGradient)if(this._isSVG()){var T=e("<canvas/>"),D=T[0].getContext("2d"),I=D.createLinearGradient(0,0,300,0),L=0;for(C=0;C<10;C++)L+=.1,0==C?(I.addColorStop(0,h.gradientColors[0]),I.addColorStop(L,g[C])):C==g.length-1?(I.addColorStop(L-.1,g[C]),I.addColorStop(L,h.gradientColors[1])):(I.addColorStop(L-.1,g[C]),I.addColorStop(L,g[C+1]));D.fillStyle=I,D.fillRect(0,0,300,300),T.css({height:M+"px",width:N/c.length+"px","margin-left":O+"px","margin-top":y+"px",opacity:"0.9",filter:"alpha(opacity=90)",position:"absolute"}),T.appendTo(x)}else _="<v:rect id="+(f="legend"+p)+' display="block" style="position:absolute;top: '+(y-2)+"px;left:"+O+"px;width:"+N/c.length+"px;height:"+M+'px;"><v:fill opacity="0.9px" type="gradient" method="linear sigma" angle="270"/><v:stroke opacity="0px"/></v:rect>',u.innerHTML=u.innerHTML+_,(v=document.getElementById(f)).fillcolor=h.gradientColors[0],v.fill.color2=h.gradientColors[1];else(b=e("<div/>")).css({height:M+"px",width:N/this.model.rangeColorMapping.length+"px","background-color":h.color,"margin-left":O+"px","margin-top":y+"px",opacity:"0.9",filter:"alpha(opacity=90)",position:"absolute"}),this._isSVG()?b.appendTo(x):x.append(b);for(C=0;C<10;C++)(m={}).marginLeft=O,this._legendRects.push(m),O+=N/c.length/10;if(this.model.legendSettings.showLabels){var E=O-N/c.length,j=y-25,A=this._createLabel(h.from,E,j,"e-legend-rangestartlabel");E=O,S=this._createLabel(h.to,E,j),h.legendLabel!=i&&(S=this._createLabel(h.legendLabel,E-5*h.legendLabel.length,j,"e-legend-rangeendlabel")),this._isSVG()?(h==c[0]&&A.appendTo(x),S.appendTo(x)):(h==c[0]&&x.append(A),x.append(S))}}null==w.rightLabel||w.showLabels||(P=this._createLabel(w.rightLabel,O+10,y-3,"e-interactivelegend-rightlabel"),this._isSVG()?P.appendTo(x):x.append(P),O+=10*w.rightLabel.length),a=O+10,r=y+M+this._interactiveArrow.height(),this._legendSize={width:a,height:r},"left"==w.dockPosition?this._marginleft=a:"top"==w.dockPosition&&(this._margintop=r)}},_trimFunction:function(t,i){var l,a=e('<div style="width:auto;position:absolute;" class= "e-interactivelegend-title">'+t+"</div>");for(e(document.body).append(a),l=t;a.width()>i;)l=l.slice(0,-2),a.text(l+"...");return document.body.removeChild(a[0]),a.text()},_createLabel:function(t,i,l,a){var r=e("<div class="+a+"></div>");return r[0].innerHTML=t,r.css({"margin-left":i+"px","margin-top":l+"px",position:"absolute"}),r},_createInteractiveArrow:function(t,i){var l=e("<div class='e-icon1 e-interactiveArrow'></div>");return l[0].innerHTML="&#9650",l.css({"margin-left":t+"px","margin-top":i+"px",position:"absolute"}),l},_createGroup:function(e,t){var i;return(i=document.createElement("<v:group class="+t+">")).style.width=this._width+"px",i.style.height=this._height+"px",i.coordorigin="0 0",i.coordsize=this._width+" "+this._height,e&&(this._rootgroup=i,i.style.left="20px",i.style.top="20px"),i},_setPaletteColor:function(e,t){e=e.sort(this._orderBycolorWeight);for(var i=0;i<e.length;i++)null!=t.colors&&t.colors.length>0&&(e[i].backgroundColor=t.colors[i%t.colors.length])},_orderBycolorWeight:function(e,t){return e.colorWeight==t.colorWeight?0:e.colorWeight<t.colorWeight?1:-1},_orderByAreaWight:function(e,t){return e.AreaByWeight==t.AreaByWeight?0:e.AreaByWeight<t.AreaByWeight?1:-1},_calculateSliceAndDiceItemSize:function(e,t,l,a,r,n,o,s,d){var u,c,p,h,g,m,f,_,v,b,C;""==n&&(n=0),u=n,c=this._getTotalWeight(e),s==i&&(s=a>r),h=o<(p={Width:a,Height:r-d}).Height?o:0,p.Height=p.Height-h;p.Width,p.Height;var S=p.Height*p.Width,P=e.length;if(s)for(g=p.Height,m=0,b=0;b<P;b++)n=(f=S/c*e[b].weight/g)>u?u:0,m<=p.Width&&(e[b].ItemWidth=b!=P-1?f-parseFloat(n):f,e[b].ItemHeight=g,e[b].LeftPosition=m+t,e[b].TopPosition=l+o,m+=f);else for(_=p.Width,v=0,b=0;b<P;b++)n=(C=S/c*e[b].weight/_)>u?u:0,v<=p.Height&&(e[b].ItemWidth=_,e[b].ItemHeight=b!=P-1?C-parseFloat(n):C,e[b].LeftPosition=t,e[b].TopPosition=v+l+h,v+=C)},_calculateSquarifiedItemSize:function(e,t,i,l,a,r,n,o){var s,d,u,c,p,h,g;""==r&&(r=0);var m=this._getTotalWeight(e),f={Width:l,Height:a-o},_=n<f.Height?n:0;for(f.Height=f.Height-_,s=e.length-1;s>=0;s--)(p=e[s]).AreaByWeight=f.Height*f.Width*p.weight/m,p.headerTopPosition=i;var v={X:t,Y:i+_,Width:f.Width,Height:f.Height},b=e.sort(this._orderByAreaWight),C=0,S=0,P=0;for(s=0;s<e.length;s=P){var w=b[s],O=this._getGroupTotalWeight(w,b,v,s),y=O.totalWeight;for(P=O.index,d={},u=v.Width>v.Height,c=s;c<P;c++)p=b[c],h=y,c==s&&(d.X=v.X,d.Y=v.Y,u?(d.Width=h/v.Height,d.Height=v.Height,v.X+=d.Width,v.Width=Math.max(0,v.Width-d.Width)):(d.Width=v.Width,d.Height=h/v.Width,v.Y+=d.Height,v.Height=Math.max(0,v.Height-d.Height)),C=d.X,S=d.Y),g={},b.indexOf(p)!=b.length-1?(g.X=0,g.Y=0,g.Width=u?d.Width-parseFloat(r):p.AreaByWeight/d.Height,g.Height=u?p.AreaByWeight/d.Width:d.Height-parseFloat(r),P-c!=1&&(u?g.Height-=parseFloat(r):g.Width-=parseFloat(r))):(g.Width=u?d.Width:p.AreaByWeight/d.Height,g.Height=u?p.AreaByWeight/d.Width:d.Height),p.ItemWidth=g.Width,p.ItemHeight=g.Height,p.LeftPosition=C,p.TopPosition=S,u?S+=P-c!=1?g.Height+parseFloat(r):g.Height:C+=P-c!=1?g.Width+parseFloat(r):g.Width}},_getGroupTotalWeight:function(e,t,i,l){for(var a,r,n,o=0,s=0;l<t.length;l++){a=this._getShortersideLength(i.Width,i.Height);var d=(o+=(r=t[l]).AreaByWeight)/a,u=e.AreaByWeight/d,c=r.AreaByWeight/d;if(0==l&&(s=this._aspectRatio(d,a)),n=Math.max(this._aspectRatio(u,d),this._aspectRatio(c,d)),!(o==r.AreaByWeight||n<s)){d=(o-=r.AreaByWeight)/a,s=Math.max(this._aspectRatio(u,d),this._aspectRatio(c,d));break}s=n}return{totalWeight:o,index:l}},_aspectRatio:function(e,t){return e>t?e/t:t/e},_getShortersideLength:function(e,t){return e>t?t:e},_getTotalWeight:function(e){for(var t=0,i=0;i<e.length;i++)t+=parseFloat(e[i].weight);return t},_getGroupitem:function(t,i,l,r){var n,o,s,d,u,c,p,h,g=[];if(r&&(i=i[0]?i[0][r]:i[r]),null==t&&(t=this.labelPath()||this.weightValuePath()),null!=i&&null!=this.weightValuePath()){for(o in i)(null!=(d=i[o])&&d.hasOwnProperty(t)||this._containsProperty(d,t))&&(u=this._reflection(d,t),-1==e.inArray(u,g)&&g.push(u));for(n=[],o=0;o<g.length;o++){var m={},f=[],_=g[o],v=0,b=0;for(s=0;s<i.length;s++)d=i[s],(u=this._reflection(d,t))==_&&(null!=(c=this._reflection(d,this.weightValuePath()))&&"number"!=typeof c&&(c=Number(c.replace(/[^0-9\.]+/g,""))),c<0&&(c*=-1),null!=(p=this._reflection(d,this.colorValuePath()))&&"number"!=typeof p&&(p=Number(p.replace(/[^0-9\.]+/g,""))),f.push(d),0,null!=c&&(b+=parseFloat(c)),null!=p&&(v+=parseFloat(p)));m.header=_,m.data=f,m.weight=b,m.colorWeight=v,m.headerHeight=l,b>0&&(h=new a(m),n.push(h))}return n}return null},_getTopGroupitem:function(e,t){var i,l,r,n,o;null==e&&(e=this.labelPath()),null==e&&(e=this.weightValuePath());var s={},d=0,u=0,c=[],p=[];for(i=0;i<t.length;i++){var h=t[i],g=this._reflection(h,e),m={},f=this._reflection(h,this.weightValuePath());null!=f&&"number"!=typeof f&&(f=Number(f.replace(/[^0-9\.]+/g,""))),f<0&&(f*=-1),null!=(l=this._reflection(h,this.colorValuePath()))&&"number"!=typeof l&&(l=Number(l.replace(/[^0-9\.]+/g,""))),null!=f&&(d+=parseFloat(f)),null!=l&&(u+=parseFloat(l)),p.push(h),m.weight=f,m.data=h,m.header=g,m.colorWeight=l,r=new a(m),c.push(r)}return s.header="",s.data=p,s.weight=d,s.innerItem=c,s.colorWeight=u,n=[],o=new a(s),n.push(o),n},_containsProperty:function(e,t){for(var i in e)if(i==t)return!0;return!1},_reflection:function(t,i){var l,a,r=t;if(null!=i&&null!=t){for((l=i.split(".")).push(i),a=0;a<l.length;a++)null!=r&&((!!r.hasOwnProperty(l[a])||this._containsProperty(r,l[a]))&&e.each(r,function(e,t){if(e==l[a])return r=t,!1}));return r}return null}}),(l=function(){this.groupBackground=null,this.groupBorderColor=null,this.groupBorderThickness=1,this.groupPadding=4,this.groupPath=null,this.groupGap=1,this.headerHeight=20,this.showHeader=!0,this.showLabels=!1,this.headerTemplate=null,this.labelTemplate=null,this.labelPosition="center",this.labelVisibilityMode="visible",this.headerVisibilityMode="visible",this.treeMapItems=[]}).prototype={};var a=function(e){this.weight=e.weight,this.colorWeight=e.colorWeight,this.Data=e.data,this.headerHeight=e.headerHeight,this.header=e.header,this.label=e.header,this.headerLeftPosition=0,this.headerTopPosition=0,this.innerItems=e.innerItem,this.headerWidth=0,this.headerTemplate=null};a.prototype={_generateColorMappings:function(e,t){return null!=e.rangeColorMapping&&e.rangeColorMapping.length>0?this._getRangeBrushColor(e.rangeColorMapping):null!=t.uniColor()&&null!=e.uniColorMapping?t.uniColor():null!=e.uniColorMapping.color&&null!=e.uniColorMapping?this._getUniColor(e.uniColorMapping):void 0},_getUniColor:function(e){return e.color},_getRangeBrushColor:function(e){for(var t,i=0;i<e.length;i++)if(t=e[i],this.colorWeight>=t.from&&this.colorWeight<=t.to)return t.color}},t.datavisualization.TreeMap.selectionMode={Default:"default",Multiple:"multiple"},t.datavisualization.TreeMap.textOverflow={None:"none",Hide:"hide",Wrap:"wrap",WrapByWord:"wrapbyword"},t.datavisualization.TreeMap.groupSelectionMode={Default:"default",Multiple:"multiple"},t.datavisualization.TreeMap.ItemsLayoutMode={Squarified:"squarified",SliceAndDiceHorizontal:"sliceanddicehorizontal",SliceAndDiceVertical:"sliceanddicevertical",SliceAndDiceAuto:"sliceanddiceauto"},t.datavisualization.TreeMap.DockPosition={Top:"top",Bottom:"bottom",Right:"right",Left:"left"},t.datavisualization.TreeMap.LegendMode={Default:"default",Interactive:"interactive"},t.datavisualization.TreeMap.Position={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",CenterLeft:"centerleft",Center:"center",CenterRight:"centerright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"},t.datavisualization.TreeMap.Alignment={Near:"near",Center:"center",Far:"far"},t.datavisualization.TreeMap.VisibilityMode={Visible:"visible",HideOnExceededLength:"hideonexceededlength"}}(jQuery,Syncfusion)})},1058:function(e,t){e.exports=".e-pivottreemap {\r\n    min-height: 275px; \r\n    display: block;\r\n    min-width: 525px; \r\n    height: 460px !important; \r\n    width: 99%\r\n}"},1361:function(e,t,i){"use strict";var l=this&&this.__decorate||function(e,t,i,l){var a,r=arguments.length,n=r<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,i):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,l);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var r=i(5),n=i(1007),o=function(){function e(e){this.pivotdataservice=e,this.data=e.pivot_datacube(),this.cube=e.pivot_cube(),this.catalog=e.pivot_catelog(),this.rows=e.pivot_Olaprows(),this.columns=e.pivot_Olapcolumns(),this.values=e.pivot_Olapvalues(),this.filters=e.pivot_Olapfilters()}return e.prototype.onRenderSuccess=function(e){var t=$("#pivotTreeMapTreeMapContainer").data("ejTreeMap");t.model.tooltipTemplate=null,t.model.showTooltip=!1,t.model.colorValuePath="",t.model.enableGradient=!1,t.model.showLegend=!1,t.model.legendSettings.leftLabel="",t.model.legendSettings.rightLabel="",t.model.rangeColorMapping=[],t.model.colorValuePath="Index",t.model.rangeColorMapping=[];for(var i=[{color:"#9de24f",from:"0",to:"0"},{color:"#a2e2fe",from:"1",to:"1"},{color:"#ffff66",from:"2",to:"2"},{color:"#FF0040",from:"3",to:"3"},{color:"#f6b53f",from:"4",to:"4"},{color:"#6FAAB0",from:"5",to:"5"},{color:"#C4C24A",from:"6",to:"6"}],l=0;l<i.length;l++)t.model.rangeColorMapping.push(i[l])},e=l([r.Component({selector:"ej-app",template:i(1860),styles:[i(1058)],providers:[n.PivotDataService]}),a("design:paramtypes",[n.PivotDataService])],e)}();t.ColorMappingComponent=o},1362:function(e,t,i){"use strict";var l=this&&this.__decorate||function(e,t,i,l){var a,r=arguments.length,n=r<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,i):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,l);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var r=i(5),n=i(1007),o=function(){function e(e){this.pivotdataservice=e,this.data=e.pivot_datacube(),this.cube=e.pivot_cube(),this.catalog=e.pivot_catelog(),this.rows=e.pivot_Olaprows(),this.columns=e.pivot_Olapcolumns(),this.values=e.pivot_Olapvalues(),this.filters=e.pivot_Olapfilters()}return e.prototype.onRenderSuccess=function(e){var t=$("#pivotTreeMapTreeMapContainer").data("ejTreeMap");t.model.tooltipTemplate=null,t.model.showTooltip=!1,t.refresh()},e=l([r.Component({selector:"ej-app",template:i(1861),styles:[i(1058)],providers:[n.PivotDataService]}),a("design:paramtypes",[n.PivotDataService])],e)}();t.DefaultComponent=o},1502:function(e,t,i){"use strict";var l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function l(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)}}();Object.defineProperty(t,"__esModule",{value:!0}),i(2041);var a=i(12),r=i(5),n=function(e){function t(t,i,l,a){var n=e.call(this,"PivotTreeMap",t,i,[],l,a)||this;return n.el=t,n.cdRef=i,n._ejIterableDiffers=l,n._ejkeyvaluediffers=a,n.afterServiceInvoke_output=new r.EventEmitter,n.beforeServiceInvoke_output=new r.EventEmitter,n.load_output=new r.EventEmitter,n.drillSuccess_output=new r.EventEmitter,n.renderComplete_output=new r.EventEmitter,n.renderFailure_output=new r.EventEmitter,n.renderSuccess_output=new r.EventEmitter,n}return l(t,e),t.decorators=[{type:r.Component,args:[{selector:"ej-pivottreemap",template:""}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:r.ChangeDetectorRef},{type:r.IterableDiffers},{type:r.KeyValueDiffers}]},t.propDecorators={cssClass_input:[{type:r.Input,args:["cssClass"]}],dataSource_input:[{type:r.Input,args:["dataSource"]}],customObject_input:[{type:r.Input,args:["customObject"]}],isResponsive_input:[{type:r.Input,args:["isResponsive"]}],locale_input:[{type:r.Input,args:["locale"]}],operationalMode_input:[{type:r.Input,args:["operationalMode"]}],serviceMethodSettings_input:[{type:r.Input,args:["serviceMethodSettings"]}],url_input:[{type:r.Input,args:["url"]}],enableXHRCredentials_input:[{type:r.Input,args:["enableXHRCredentials"]}],dataSource_data_input:[{type:r.Input,args:["dataSource.data"]}],dataSource_cube_input:[{type:r.Input,args:["dataSource.cube"]}],dataSource_sourceInfo_input:[{type:r.Input,args:["dataSource.sourceInfo"]}],dataSource_providerName_input:[{type:r.Input,args:["dataSource.providerName"]}],dataSource_catalog_input:[{type:r.Input,args:["dataSource.catalog"]}],serviceMethodSettings_initialize_input:[{type:r.Input,args:["serviceMethodSettings.initialize"]}],serviceMethodSettings_drillDown_input:[{type:r.Input,args:["serviceMethodSettings.drillDown"]}],dataSource_columns_input:[{type:r.Input,args:["dataSource.columns"]}],dataSource_rows_input:[{type:r.Input,args:["dataSource.rows"]}],dataSource_values_input:[{type:r.Input,args:["dataSource.values"]}],dataSource_filters_input:[{type:r.Input,args:["dataSource.filters"]}],options:[{type:r.Input,args:["options"]}],afterServiceInvoke_output:[{type:r.Output,args:["afterServiceInvoke"]}],beforeServiceInvoke_output:[{type:r.Output,args:["beforeServiceInvoke"]}],load_output:[{type:r.Output,args:["load"]}],drillSuccess_output:[{type:r.Output,args:["drillSuccess"]}],renderComplete_output:[{type:r.Output,args:["renderComplete"]}],renderFailure_output:[{type:r.Output,args:["renderFailure"]}],renderSuccess_output:[{type:r.Output,args:["renderSuccess"]}]},t}(a.EJComponents);t.PivotTreeMapComponent=n,t.EJ_PIVOTTREEMAP_COMPONENTS=[n]},1860:function(e,t){e.exports='<ej-pivottreemap id="pivotTreeMap" [dataSource.data]="data" [dataSource.catalog]="catalog" [dataSource.cube]="cube" [dataSource.rows]="rows" [dataSource.columns]="columns" [dataSource.values]="values" (renderSuccess)="onRenderSuccess($event)">\r\n</ej-pivottreemap>'},1861:function(e,t){e.exports='<ej-pivottreemap id="pivotTreeMap" [dataSource.data]="data" [dataSource.catalog]="catalog" [dataSource.cube]="cube" [dataSource.rows]="rows" [dataSource.columns]="columns" [dataSource.values]="values" (renderSuccess)="onRenderSuccess($event)">\r\n</ej-pivottreemap>'},2041:function(e,t,i){var l,a,r;
/*!
*  filename: ej.pivottreemap.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
/*!
*  filename: ej.pivottreemap.min.js
*  version : 17.1.0.47
*  Copyright Syncfusion Inc. 2001 - 2018. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(n){a=[i(15),i(4),i(21),i(65),i(66),i(1037),i(1011),i(1009),i(1010)],void 0===(r="function"==typeof(l=n)?l.apply(t,a):l)||(e.exports=r)}(function(){!function(e,t,i){t.widget("ejPivotTreeMap","ej.PivotTreeMap",{_rootCSS:"e-pivottreemap",element:null,model:null,validTags:["div","span"],defaults:e.extend(t.datavisualization.TreeMap.prototype.defaults,{url:"",cssClass:"",currentReport:"",operationalMode:"clientmode",customObject:{},isResponsive:!1,enableXHRCredentials:!1,dataSource:{data:null,isFormattedValues:!1,columns:[],cube:"",catalog:"",rows:[],values:[],filters:[]},serviceMethodSettings:{initialize:"InitializeTreeMap",drillDown:"DrillTreeMap"},locale:"en-US",drillSuccess:null,beforeServiceInvoke:null,afterServiceInvoke:null,load:null,renderComplete:null,renderFailure:null,renderSuccess:null,beforePivotEnginePopulate:null}),dataTypes:{dataSource:{data:"data",columns:"array",rows:"array",values:"array",filters:"array"},serviceMethodSettings:{initialize:"enum",drillDown:"enum"},customObject:"data"},locale:t.util.valueFunction("locale"),getOlapReport:function(){return this._olapReport},setOlapReport:function(e){this._olapReport=e},getJsonRecords:function(){return this._JSONRecords},setJsonRecords:function(e){this._JSONRecords=JSON.parse(e)},_init:function(){this._initPrivateProperties(),this._load()},_destroy:function(){this.element.empty().removeClass("e-pivottreemap"+this.model.cssClass),this._waitingPopup!=i&&this._waitingPopup.destroy(),""==this.element.attr("class")&&this.element.removeAttr("class")},_initPrivateProperties:function(){this._id=this.element.attr("id"),this._olapReport="",this._JSONRecords=null,this._treeMapDatasource=[],this._currentAction="initialize",this._selectedItem="",this._selectedTagInfo=null,this._tagCollection=[],this._drilledMembers=[],this._startDrilldown=!1,this._isDrilled=!1,this._treeMap=null,this._pivotClientObj=null,this._waitingPopup=null,this._drillText="",this._showDrillText="",this._isOnlyMeasureElement=!1},_load:function(){this.element.addClass(this.model.cssClass),e(this.element).parents(".e-pivotclient").length>0?(this._pivotClientObj=e(this.element).parents(".e-pivotclient").data("ejPivotClient"),this.model.customObject=this._pivotClientObj.model.customObject,e("#"+this._pivotClientObj._id+"_maxView")[0]?e("#"+this._pivotClientObj._id+"_maxView").ejWaitingPopup({showOnInit:!0}):t.isNullOrUndefined(this._pivotClientObj._waitingPopup)||this._pivotClientObj._waitingPopup.show()):(this.element.ejWaitingPopup({showOnInit:!0}),this._waitingPopup=this.element.data("ejWaitingPopup"),this._waitingPopup.show());var l=JSON.stringify(this.model.customObject);if(null==this.model.dataSource.data&&""==this.model.url&&""==this.model.dataSource.cube)return this.renderTreeMapFromJSON(null),void this._waitingPopup.hide();null==this.model.dataSource.data&&""!=this.model.url||null!=this.model.dataSource.data&&""!=this.model.url&&this.model.operationalMode==t.PivotTreeMap.OperationalMode.ServerMode?(this.model.operationalMode=t.PivotTreeMap.OperationalMode.ServerMode,null!=this.model.beforeServiceInvoke&&this._trigger("beforeServiceInvoke",{action:this._currentAction,element:this.element,customObject:l}),""!=this.model.customObject&&null!=this.model.customObject&&this.model.customObject!=i?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initialize",currentReport:this.model.currentReport,customObject:l}),this.renderControlSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initialize"}),this.renderControlSuccess)):(this.model.operationalMode=t.PivotTreeMap.OperationalMode.ClientMode,this.model.dataSource.rows.length>1&&(this.model.dataSource.rows=[this.model.dataSource.rows[this.model.dataSource.rows.length-1]]),""!=this.model.dataSource.cube&&(this._trigger("beforePivotEnginePopulate",{treeMapObject:this}),this._dataTrans(this.model.dataSource),this.setOlapReport(this.model.dataSource),t.olap.base.getJSONData({action:"initialLoad"},this.model.dataSource,this)))},_setFirst:!1,_setModel:function(e){for(var t in e)switch(t){case"operationalMode":this.model.operationalMode=e[t];break;case"analysisMode":this.model.analysisMode=e[t];break;case"customObject":this.model.customObject=e[t];break;case"isResponsive":this.model.isResponsive=e[t],this._load();break;case"locale":this.model.locale=e[t],this._load()}},generateJSON:function(e,i){for(var l,a,r,n,o,s,d,u,c,p,h=[],g=[],m="",f=[],_=[],v=[],b=[],C={},S=0;S<this.model.dataSource.values[0].measures.length;S++)m+=""==m?this.model.dataSource.values[0].measures[S].fieldCaption:"~"+this.model.dataSource.values[0].measures[S].fieldCaption;var P=this.model.dataSource.values[0].axis,w=this.model.dataSource.rows.length,O=i[0][0].ColSpan,y=0;for(O-w<=0?(O=0,y=w):O=(y="rows"==P?O-1:O)-1,u=[],S=0;S<i.length;S++)for(c=0;c<i[S].length;c++)if(l=null," value"==i[S][c].CSS&&b.push(i[S][c].Value),"rowheader"==i[S][c].CSS&&""!=i[S][c].Value){if(p={},l=i[S][c].Info+"::"+i[S][c].State,g.push(i[S][c].Info.replace(/&/g,"&amp;")),h.push(l),0==u.length&&i[S][c].Info.split(".")[0].indexOf("Measures")<0&&(p.level=S,p.index=c,p.label=i[S][c].Value,u.push(p)),0!=u.length&&i[S][c].Info.split(".")[0].indexOf("Measures")<0)for(d=0;d<u.length;d++)if(!t.isNullOrUndefined(u[d])){if(u[d].index==c&&u[d].level!=S){u[d].level=S,u[d].label=u[d].label+"~~"+i[S][c].Value;break}if(u[d].level==S){for(a=!1,r=0;r<u.length;r++)if(!t.isNullOrUndefined(u[r])&&u[r].index==c){a=!0;break}if(!a&&i[S][c].Info.split(".")[0].indexOf("Measures")<0){p.level=S,p.index=c,p.label=i[S][c].Value,u.push(p);break}}}}else if("summary"==i[S][c].CSS&&0!=u.length)for(d=0;d<u.length;d++)if(!t.isNullOrUndefined(u[d])&&u[d].index==c){delete u[d];break}for(d=0;d<u.length;d++)t.isNullOrUndefined(u[d])||y==u[d].label.split("~~").length&&v.push(u[d].label);for(u=[],S=0;S<i.length;S++)for(c=0;c<i[S].length;c++)if("colheader"==i[S][c].CSS&&""!=i[S][c].Value){if(p={},0==u.length&&(p.level=c,p.index=S,p.label=this._isOnlyMeasureElement?"Total":i[S][c].Value,u.push(p)),0!=u.length)for(d=0;d<u.length;d++)if(!t.isNullOrUndefined(u[d])){if(u[d].index==S&&u[d].level!=c&&i[S][c].Info.split(".")[0].indexOf("Measures")<0){u[d].index=S,u[d].label=u[d].label+"~~"+i[S][c].Value;break}if(u[d].level==c&&i[S][c].Info.split(".")[0].indexOf("Measures")<0||this._isOnlyMeasureElement){for(a=!0,r=0;r<u.length;r++)if(!t.isNullOrUndefined(u[r])&&(a=!1,u[r].index==S)){a=!0;break}if(!a&&(i[S][c].Info.split(".")[0].indexOf("Measures")<0||this._isOnlyMeasureElement)){p.level=c,p.index=S,p.label=this._isOnlyMeasureElement?"Total":i[S][c].Value,u.push(p);break}}}}else if("summary"==i[S][c].CSS&&0!=u.length)for(d=0;d<u.length;d++)if(!t.isNullOrUndefined(u[d])&&u[d].index==S){delete u[d];break}for(d=0;d<u.length;d++)t.isNullOrUndefined(u[d])||_.push(u[d].label);if(""!=m&&P==t.olap.AxisName.Column)for(S=0;S<_.length;S++)_[S]=_[S]+"~"+m;if(0==O)for(n=b.length/_.length,S=0;S<v.length;S++){for(u=[],c=S;c<b.length;c+=n)(p={}).Item1=v[S].indexOf("~~")>=0?v[S].split("~~")[0]:v[S],p.Item2=b[c],u.push(p);f.push(u)}else{for(o=[],s=null,S=0;S<v.length;S++)for(u=[],c=0;c<i[O].length;c++)if("rowheader"==i[O][c].CSS&&""!=i[O][c].Value&&v[S].split("~~")[v[S].split("~~").length-1]==i[O][c].Value){s=c,u.push(s),u.push(v[S]),o.push(u);break}for(d=0;d<o.length;d++){for(u=[],S=0;S<i.length;S++)for(c=o[d][0];c<i[S].length;c++){" value"==i[S][c].CSS&&((p={}).Item1=o[d][1].indexOf("~~")>=0?o[d][1].split("~~")[0]:o[d][1],p.Item2=i[S][c].Value,u.push(p));break}0!=u.length&&f.push(u)}}C.labelTags=h,C.drillTags=g,C.measureNames=m,C.points_Y=f,C.seriesNames=_,C.treemapLabels=v,this._JSONRecords=C,this.renderTreeMapFromJSON(C),this._unWireEvents(),this._wireEvents()},_dataTrans:function(e){if(0==e.columns.length&&e.rows.length>0){e.values.length>0&&e.values[0].measures.length>0&&(e.values[0].axis==t.olap.AxisName.Row&&(e.values[0].axis=t.olap.AxisName.Column),this._isOnlyMeasureElement=!0)}},_wireEvents:function(){e(window).on("resize",e.proxy(this._reSizeHandler,this)),this._on(this.element,"click",".drillItem",this._drillTreeMap)},_drillTreeMap:function(l){var a,r,n,o,s=t.isNullOrUndefined(this.model.ptreemapProxy)?this:this.model.ptreemapProxy,d=null;if("treeMapGroupSelected"==l.type){if(s._treemapWaitingPopup({show:!0}),0==l.selectedGroups.length)return void s._treemapWaitingPopup({show:!1});for(s._currentAction="drilldown",s._selectedItem=l.selectedGroups[0].header,a=0;a<s._treeMapDatasource.length;a++)if(s._treeMapDatasource[a].Tag.split("::")[2]==s._selectedItem){if(s._selectedTagInfo=s._treeMapDatasource[a].Tag,s.model.operationalMode==t.PivotTreeMap.OperationalMode.ClientMode&&(d=s._treeMapDatasource[a].drillTag),2!=s._selectedTagInfo.split("::")[s._selectedTagInfo.split("::").length-1])return s._treeMap.refresh(),void s._treemapWaitingPopup({show:!1});break}s._startDrilldown=!0,s.model.operationalMode==t.PivotTreeMap.OperationalMode.ServerMode?(null!=s.model.beforeServiceInvoke&&s._trigger("beforeServiceInvoke",{action:s._currentAction,element:s.element,customObject:s.model.customObject}),n=JSON.stringify(s.model.customObject),""!=s.model.customObject&&null!=s.model.customObject&&s.model.customObject!=i?t.isNullOrUndefined(s._pivotClientObj)?s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drilldown",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport(),customObject:n}),s.renderControlSuccess):s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drilldown",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport(),clientReports:s._pivotClientObj.reports,customObject:n}),s.renderControlSuccess):t.isNullOrUndefined(s._pivotClientObj)?s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drilldown",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport(),clientReports:s._pivotClientObj.reports}),s.renderControlSuccess):s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drilldown",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport()}),s.renderControlSuccess)):(s._drilledMembers.push(d),t.olap._mdxParser.updateDrilledReport({uniqueName:d,seriesInfo:[d],uniqueNameArray:s._drilledMembers},"rowheader",s))}else{if(s._treemapWaitingPopup({show:!0}),s._currentAction="drillup",e(l.target).hasClass("drillItem")){if(!(s.getJsonRecords().treemapLabels[0].indexOf("~~")>=0))return void s._treemapWaitingPopup({show:!1});for(s._selectedItem=e(l.target).text(),r=0;r<s.getJsonRecords().labelTags.length;r++)if(s.getJsonRecords().labelTags[r].split("::")[2]==s._selectedItem&&1==s.getJsonRecords().labelTags[r].split("::")[s.getJsonRecords().labelTags[r].split("::").length-1]){if(s._selectedTagInfo=s.getJsonRecords().labelTags[r],s.model.operationalMode==t.PivotTreeMap.OperationalMode.ClientMode&&(d=s.getJsonRecords().drillTags[r]),1!=s._selectedTagInfo.split("::")[s._selectedTagInfo.split("::").length-1])return void s._treemapWaitingPopup({show:!1});break}}0==s._tagCollection.length&&(s._isDrilled=!1),s._startDrilldown=!0,s.model.operationalMode==t.PivotTreeMap.OperationalMode.ServerMode?(null!=s.model.beforeServiceInvoke&&s._trigger("beforeServiceInvoke",{action:s._currentAction,element:s.element,customObject:s.model.customObject}),n=JSON.stringify(s.model.customObject),""!=s.model.customObject&&null!=s.model.customObject&&s.model.customObject!=i?t.isNullOrUndefined(s._pivotClientObj)?s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillup",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport(),customObject:n}),s.renderControlSuccess):s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillup",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport(),clientReports:s._pivotClientObj.reports,customObject:n}),s.renderControlSuccess):t.isNullOrUndefined(s._pivotClientObj)?s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillup",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport(),clientReports:s._pivotClientObj.reports}),s.renderControlSuccess):s.doAjaxPost("POST",s.model.url+"/"+s.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillup",drillInfo:s._selectedTagInfo,olapReport:s.getOlapReport()}),s.renderControlSuccess)):(o=s._drilledMembers.slice(0,e.inArray(d,s._drilledMembers)+1),s._drilledMembers=s._drilledMembers.slice(0,e.inArray(d,s._drilledMembers)),t.olap._mdxParser.updateDrilledReport({uniqueName:d,seriesInfo:[d],uniqueNameArray:o,action:"collapse"},"rowheader",s))}},_unWireEvents:function(){e(window).off("resize",e.proxy(this._reSizeHandler,this)),this._off(this.element,"click",".drillItem",this._drillTreeMap)},renderControlSuccess:function(l){var a;this._treemapWaitingPopup({show:!0});try{l[0]!=i?(this.setJsonRecords(l[0].Value),this.setOlapReport(l[1].Value),t.isNullOrUndefined(this._pivotClientObj)||(this._pivotClientObj.currentReport=l[1].Value,null!=l[2]&&l[2]!=i&&("ClientReports"==l[2].Key&&(this._pivotClientObj.reports=l[2].Value))),null!=l[2]&&l[2]!=i&&("ClientReports"==!l[2].Key&&(this.model.customObject=l[2].Value))):l.d!=i?(this.setJsonRecords(l.d[0].Value),this.setOlapReport(l.d[1].Value),t.isNullOrUndefined(this._pivotClientObj)||(this._pivotClientObj.currentReport=l.d[1].Value,null!=l.d[2]&&l.d[2]!=i&&("ClientReports"==l.d[2].Key&&(this._pivotClientObj.reports=l.d[2].Value))),null!=l.d[2]&&l.d[2]!=i&&("ClientReports"==l.d[2].Key||(this.model.customObject=l.d[2].Value))):(this.setJsonRecords(l.JsonRecords),this.setOlapReport(l.OlapReport),null!=l.customObject&&null!=l.customObject&&(this.model.customObject=l.customObject),t.isNullOrUndefined(this._pivotClientObj)||(void 0!==this._pivotClientObj.currentReport&&(this._pivotClientObj.currentReport=l.OlapReport),void 0!==this._pivotClientObj.reports&&l.reports!=i&&"undefined"!=l.reports&&(this._pivotClientObj.reports=l.reports))),null!=this.model.afterServiceInvoke&&this.model.operationalMode==t.PivotTreeMap.OperationalMode.ServerMode&&(this._currentAction,a={action:this._currentAction,element:this.element,customObject:this.model.customObject},this._trigger("afterServiceInvoke",a)),this.renderTreeMapFromJSON(this.getJsonRecords()),this._unWireEvents(),this._wireEvents(),"initialize"!=this._currentAction&&(this.model.currentReport=this.getOlapReport(),t.isNullOrUndefined(this._pivotClientObj)?this._trigger("drillSuccess",this.element):this._pivotClientObj._trigger("treeMapDrillSuccess",this.element)),t.isNullOrUndefined(this._pivotClientObj)||(this._pivotClientObj._isTimeOut=!1),void 0!==this._pivotClientObj&&null!=this._pivotClientObj._waitingPopup?(e("#"+this._pivotClientObj._id+"_maxView")[0]?e("#"+this._pivotClientObj._id+"_maxView").ejWaitingPopup({showOnInit:!1}):void 0!==this._pivotClientObj._pivotGrid&&(this._pivotClientObj&&this._pivotClientObj._pivotGrid._drillAction&&!this._pivotClientObj._pivotGrid._startDrilldown||this._pivotClientObj.otreemapObj._currentAction&&!this._pivotClientObj.otreemapObj._startDrilldown?this._pivotClientObj._waitingPopup.hide():(!this._pivotClientObj||""!=this._pivotClientObj._pivotGrid._drillAction||""!=this._pivotClientObj.otreemapObj._currentAction||this._pivotClientObj._pivotGrid._startDrilldown||this._pivotClientObj.otreemapObj._startDrilldown||null==this._pivotClientObj._pivotGrid._JSONRecords&&null!=this._pivotClientObj.otreemapObj._JSONRecords)&&(!this._pivotClientObj.otreemapObj._startDrilldown||this._pivotClientObj._pivotGrid._startDrilldown||e("#"+this._pivotClientObj._id+"_maxView")[0])&&(this._pivotClientObj.otreemapObj._startDrilldown||this._pivotClientObj._pivotGrid._startDrilldown||""!=this._pivotClientObj.otreemapObj._currentAction||""!=this._pivotClientObj._pivotGrid._drillAction||null==this._pivotClientObj._pivotGrid._JSONRecords&&null!=this._pivotClientObj.otreemapObj._JSONRecords)||this._pivotClientObj._waitingPopup.hide()),"chartonly"==this._pivotClientObj.model.displaySettings.mode&&this._pivotClientObj._waitingPopup.hide()):this._waitingPopup.hide(),void 0!==this._pivotClientObj&&(this._pivotClientObj.otreemapObj._startDrilldown=!1)}catch(e){}t.isNullOrUndefined(l.Exception)||t.Pivot._createErrorDialog(l,"Exception",this)},renderTreeMapFromJSON:function(i){var l,a,r,n,o,s,d,u,c,p,h,g,m,f,_=this;if(this._treeMapDatasource=[],l="",t.isNullOrUndefined(i)||i.length<=0||0==i.labelTags.length||0==i.points_Y.length)_._treemapWaitingPopup({show:!1});else{if(t.isNullOrUndefined(i.chartLables)?i.treemapLabels:i.treemapLabels=i.chartLables,i.points_Y.length!=i.treemapLabels.length)for(this._pivotClientObj._onFiltered=!1,a=[],g=0;g<JSON.parse(JSON.stringify(_.getJsonRecords().points_Y)).length-1;g++)a.push(JSON.parse(JSON.stringify(_.getJsonRecords().points_Y))[g]);else a=JSON.parse(JSON.stringify(_.getJsonRecords().points_Y));for(t.isNullOrUndefined(this._pivotClientObj)||this._pivotClientObj.model.enableDeferUpdate&&this._pivotClientObj._ischartTypesChanged&&(this._pivotClientObj._ischartTypesChanged=!1),g=0;g<a.length;g++)for(r=_.getJsonRecords().treemapLabels[g].split("~~")[_.getJsonRecords().treemapLabels[g].split("~~").length-1],c=0;c<a[g].length;c++)a[g][c].Item1=a[g][c].Item1.replace(a[g][c].Item1,r),a[g][c].Column=_.getJsonRecords().seriesNames[c].split("~")[0],a[g][c].Measures=_.getJsonRecords().measureNames,a[g][c].Tag=e.grep(_.getJsonRecords().labelTags,function(e){return e.split("::")[2]==a[g][c].Item1})[0],this.model.operationalMode==t.PivotTreeMap.OperationalMode.ClientMode&&(a[g][c].drillTag=e.grep(_.getJsonRecords().drillTags,function(e){return e.split("::")[2]==a[g][c].Item1})[0]),a[g][c][a[g][c].Tag.split("::")[1].split(".")[0].replace("[","").replace("]","")]=a[g][c].Item1,a[g][c].RowItem=a[g][c].Item1,a[g][c].Value=""!=a[g][c].Item2?a[g][c].Item2:"0",a[g][c].Index=c,delete a[g][c].Item1,delete a[g][c].Item2,l+=(""==l?"":";")+a[g][c].Tag.split("::")[1].split(".")[0].replace("[","").replace("]","");if(t.isNullOrUndefined(_.getJsonRecords().measureNames)||(n=_.getJsonRecords().measureNames.split("~")),2!=n.length)for(g=0;g<a.length;g++)for(c=0;c<a[g].length;c++)a[g][c].Value=t.isNullOrUndefined(a[g][c].Value)?0:(a[g][c].Value.indexOf(",")||a[g][c].Value.indexOf(".")||a[g][c].Value.indexOf(" "))>-1?t.globalize.parseFloat(t.globalize.format(a[g][c].Value,"c",this.model.locale),this.model.locale):t.globalize.parseFloat(a[g][c].Value),this._treeMapDatasource.push(a[g][c]),(t.isNullOrUndefined(o)||o>=a[g][c].Value)&&(o=a[g][c].Value),(t.isNullOrUndefined(s)||s<=a[g][c].Value)&&(s=a[g][c].Value);else 2==n.length&&(d=[],e.each(a,function(i,l){for(var a=0;a<l.length;a++)t.isNullOrUndefined(l[a].Value)||(l[a].Value=t.isNullOrUndefined(l[a].Value)?0:(l[a].Value.indexOf(",")||l[a].Value.indexOf(".")||l[a].Value.indexOf(" "))>-1?t.globalize.parseFloat(t.globalize.format(l[a].Value,"c",_.model.locale),_.model.locale):t.globalize.parseFloat(l[a].Value),l[a].Color=l[a].Value,t.isNullOrUndefined(l[a+1])?l[a].Value=0:l[a].Column==l[a+1].Column&&(l[a].Value=t.isNullOrUndefined(l[a+1].Value)?0:(l[a+1].Value.indexOf(",")||l[a+1].Value.indexOf(".")||l[a+1].Value.indexOf(" "))>-1?t.globalize.parseFloat(t.globalize.format(l[a+1].Value,"c",_.model.locale),_.model.locale):t.globalize.parseFloat(l[a+1].Value),a+=1));e.each(l,function(e,i){t.isNullOrUndefined(i)||t.isNullOrUndefined(i.Value)||!t.isNullOrUndefined(i.Color)||l.splice(e,1)}),e.each(l,function(e,i){t.isNullOrUndefined(i)||(i.Index=e,d.push(i))})}),this._treeMapDatasource=d,e.each(this._treeMapDatasource,function(e,i){t.isNullOrUndefined(i.Color)||((t.isNullOrUndefined(o)||o>=i.Color)&&(o=i.Color),(t.isNullOrUndefined(s)||s<=i.Color)&&(s=i.Color))}));if(_.getJsonRecords().treemapLabels.length>0){for(_._drillText="",u=[],g=0;g<_.getJsonRecords().treemapLabels.length;g++)if(_.getJsonRecords().treemapLabels[g].split("~~").length>1)for(c=0;c<_.getJsonRecords().treemapLabels[g].split("~~").length-1;c++){for(p=0,h=0;h<_.getJsonRecords().labelTags.length;h++)if(_.getJsonRecords().labelTags[h].split("::")[2]==_.getJsonRecords().treemapLabels[g].split("~~")[c]&&1==_.getJsonRecords().labelTags[h].split("::")[_.getJsonRecords().labelTags[h].split("::").length-1]){p=1;break}0==u.length&&1==p?u.push(_.getJsonRecords().treemapLabels[g].split("~~")[c]):u.length>0&&(-1==jQuery.inArray(_.getJsonRecords().treemapLabels[g].split("~~")[c],u)&&1==p&&u.push(_.getJsonRecords().treemapLabels[g].split("~~")[c]))}for(g=0;g<u.length;g++)_._drillText+=""==_._drillText?t.buildTag("a.drillItem",u[g])[0].outerHTML:" > "+t.buildTag("a.drillItem",u[g])[0].outerHTML}this._showDrillText=""==_._drillText?t.buildTag("span.drillup",l.split(";")[0],{"margin-left":"5px"})[0].outerHTML:t.buildTag("span.drillup",l.split(";")[0],{"margin-left":"5px"})[0].outerHTML+": "+_._drillText,m=t.buildTag("div#"+this._id+"TreeMapContainer","",{height:t.isNullOrUndefined(this._pivotClientObj)?this.element.height():(parseInt(this._pivotClientObj._chartHeight)-50).toString()+"px",width:t.isNullOrUndefined(this._pivotClientObj)?this.element.width():this._pivotClientObj._chartWidth,"margin-top":"50px"})[0].outerHTML,this.element.html(m),o-=1,s+=1,l=l.split(";")[0],e("#"+this._id+"TreeMapContainer").ejTreeMap({ptreemapProxy:this,dataSource:this._treeMapDatasource,showTooltip:!0,colorValuePath:2==n.length?"Color":"Value",tooltipTemplate:"tooltipTemplate",enableDrillDown:!1,enableGradient:!0,isResponsive:this.model.isResponsive,highlightGroupOnSelection:!!t.isNullOrUndefined(this._pivotClientObj)||!this._pivotClientObj.model.enableDeferUpdate,treeMapGroupSelected:this._drillTreeMap,refreshed:this._treeMapRenderSuccess,showLegend:!0,legendSettings:{leftLabel:o.toString(),width:150,height:20,title:this._treeMapDatasource[0].Measures,rightLabel:s.toString(),mode:"interactive",dockPosition:"bottom",alignment:"center"},rangeColorMapping:[{from:o,to:s,gradientColors:["#fde6cc","#fab665"]}],weightValuePath:"Value",leafItemSettings:{showLabels:!0,labelPath:"Column",labelVisibilityMode:"hideonexceededlength"},levels:[{groupPath:l,groupGap:2,showHeader:!0,headerHeight:25,labelPosition:"topleft",headerVisibilityMode:"hideonexceededlength"}]}),this._treeMap=this.element.find("#"+this._id+"TreeMapContainer").data("ejTreeMap"),this._treeMap.rowItem=l,e.views.helpers({Measures:function(e){return e.Measures},Column:function(e){return e.Column},Row:function(e){return e.RowItem},Value:function(e){return e.Value},Color:function(e){return t.isNullOrUndefined(e.Color)?e.Value:e.Color}}),f={action:this._currentAction,customObject:this.model.customObject,element:this.element},this._trigger("renderSuccess",f),t.isNullOrUndefined(this._pivotClientObj)||e("#"+this._id+"TreeMapContainer").css({width:"100%"}),this._treeMap.refresh(),(_=this)._JSONRecords=i,_._treemapWaitingPopup({show:!1})}},_treemapWaitingPopup:function(i){var l=e(this.element).hasClass("e-pivottreemap")?e(this.element).data("ejPivotTreeMap"):e(this.element).parents(".e-pivottreemap").data("ejPivotTreeMap");e(l.element).parents(".e-pivotclient").length>0?(t.isNullOrUndefined(l._pivotClientObj)||i.show||(l._pivotClientObj._isTimeOut=!1),e("#"+l._pivotClientObj._id+"_maxView")[0]?e("#"+l._pivotClientObj._id+"_maxView").ejWaitingPopup({showOnInit:i.show}):t.isNullOrUndefined(l._pivotClientObj._waitingPopup)||(i.show?l._pivotClientObj._waitingPopup.show():l._pivotClientObj._waitingPopup.hide())):!t.isNullOrUndefined(l._waitingPopup)&&i.show?l._waitingPopup.show():l._waitingPopup.hide()},_treeMapRenderSuccess:function(){var i=this.model.ptreemapProxy;i._treeMap=e("#"+i._id+"TreeMapContainer").data("ejTreeMap"),t.isNullOrUndefined(i._treeMap)||("top"==i._treeMap.model.legendSettings.dockPosition?i.element.find("#"+i._id+"TreeMapContainer").children().hasClass("e-drillupAction")||e(t.buildTag("div#drillHeader .e-drillupAction",i._showDrillText,{height:"25px",width:"99.8%","z-index":"10",position:"absolute","margin-top":"33px"})[0].outerHTML).insertAfter(e("#"+i._id+"TreeMapContainer").find(".LegendDiv").css("margin-top","-50px").css("font-size","12px")):(e("#"+i._id+"TreeMapContainer").find(".LegendDiv").css("font-size","12px").insertAfter(e("#"+i._id+"TreeMapContainer").find("._templateDiv")),e(t.buildTag("div#drillHeader .e-drillupAction",i._showDrillText,{height:"25px",width:"99.8%",position:"absolute","margin-top":"-32px"})[0].outerHTML).insertBefore(e("#"+i._id+"TreeMapContainer").find("#backgroundTile"))))},_reSizeHandler:function(){var e=this,i=e.element.find("#"+e._id+"TreeMapContainer").width(e.element.width()).data("ejTreeMap");t.isNullOrUndefined(i)||i.refresh()},doAjaxPost:function(l,a,r,n,o,s){var d,u,c,p,h=!0,g=this,m=this.model.enableXHRCredentials||!t.isNullOrUndefined(this._pivotClientObj)&&this._pivotClientObj.model.enableXHRCredentials;r.XMLA==i?(d="application/json; charset=utf-8",u="json",c=e.proxy(n,this)):(d="text/xml",u="xml",r=r.XMLA,c=e.proxy(n,t.olap.base,s),h=!("msie"==t.browserInfo().name&&t.browserInfo().version<=9)&&(!t.isNullOrUndefined(s)&&"loadFieldElements"!=s.action)),p={type:l,url:a,contentType:d,async:h,dataType:u,data:r,success:c,xhrFields:{withCredentials:m},complete:t.proxy(function(t){e.proxy(t,this);var i={action:this._currentAction,customObject:this.model.customObject,element:this.element};this._trigger("renderComplete",i)},this),error:t.proxy(function(e){void 0!==this._waitingPopup&&null!=this._waitingPopup&&this._waitingPopup.hide(),g._treemapWaitingPopup({show:!1});var t={action:this._currentAction,customObject:this.model.customObject,element:this.element,Message:e};this._trigger("renderFailure",t),this.renderTreeMapFromJSON("")},this)},m||delete p.xhrFields,e.ajax(p)},doPostBack:function(t,i){var l=e("<form>").attr({action:t,method:"POST",name:"export"}),a=function(t,i){e('<input type="hidden" title="params">').attr({id:t,name:t,value:i}).appendTo(l)};for(var r in i)a(r,i[r]);l.appendTo(document.body).submit().remove()}}),t.PivotTreeMap.OperationalMode={ClientMode:"clientmode",ServerMode:"servermode"}}(jQuery,Syncfusion)})},450:function(e,t,i){"use strict";var l=this&&this.__decorate||function(e,t,i,l){var a,r=arguments.length,n=r<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,i):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,l);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});var a=i(5),r=i(78),n=i(64),o=i(1502),s=i(1362),d=i(1361);t.pivottreemapAppRoutes=[{path:"default",component:s.DefaultComponent,data:{name:"Default",location:"app/components/pivottreemap/default.component"}},{path:"colormapping",component:d.ColorMappingComponent,data:{name:"Color Mapping",location:"app/components/pivottreemap/colormapping.component"}},{path:"",redirectTo:"default"}],t.PivotTreeMapRouting=r.RouterModule.forChild(t.pivottreemapAppRoutes);var u=function(){function e(){}return e=l([a.NgModule({imports:[t.PivotTreeMapRouting,n.FormsModule],declarations:[s.DefaultComponent,d.ColorMappingComponent,o.EJ_PIVOTTREEMAP_COMPONENTS]})],e)}();t.PivotTreeMapModule=u}});